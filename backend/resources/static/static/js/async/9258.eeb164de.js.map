{"version":3,"file":"static/js/async/9258.eeb164de.js","sources":["webpack://@coze-studio/app/../../packages/common/md-editor-adapter/src/editor.tsx"],"sourcesContent":["/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  useRef,\n  useImperativeHandle,\n  forwardRef,\n  useState,\n  useEffect,\n} from 'react';\n\nimport { TextArea, withField } from '@coze-arch/coze-design';\n\nimport {\n  type EditorInputProps,\n  type EditorHandle,\n  type Editor,\n  type Delta,\n} from './types';\n\nexport const EditorFullInputInner = forwardRef<EditorHandle, EditorInputProps>(\n  (props: EditorInputProps, ref) => {\n    const {\n      value: propsValue,\n      onChange: propsOnChange,\n      getEditor,\n      ...restProps\n    } = props;\n    const [value, setValue] = useState(propsValue);\n    const [isComposing, setIsComposing] = useState(false);\n\n    // Create a mutable reference to store the latest value\n    const valueRef = useRef(value);\n\n    // When value is updated, synchronously update valueRef\n    useEffect(() => {\n      valueRef.current = value;\n    }, [value]);\n\n    const editorRef = useRef<Editor>({\n      setHTML: (htmlContent: string) => {\n        setValue(htmlContent);\n      },\n      setText: (text: string) => {\n        setValue(text);\n      },\n      setContent: (content: { deltas: Delta[] }) => {\n        setValue(content.deltas[0].insert);\n      },\n      getContent: () => ({\n        deltas: [{ insert: valueRef.current ?? '' }],\n      }),\n      getText: () => valueRef.current || '',\n      getRootContainer: () => null,\n      getContentState: () => ({\n        getZoneState: (zone: any) => null,\n      }),\n      selection: {\n        getSelection: () => ({\n          start: 0,\n          end: 0,\n          zoneId: '0',\n        }),\n      },\n      registerCommand: () => null,\n      scrollModule: {\n        scrollTo: () => null,\n      },\n      on: () => null,\n    });\n\n    useImperativeHandle(ref, () => ({\n      setDeltaContent(delta) {\n        editorRef.current && delta && editorRef.current.setContent(delta);\n      },\n      getEditor() {\n        return editorRef.current;\n      },\n      getMarkdown() {\n        return editorRef.current?.getText() || '';\n      },\n    }));\n\n    useEffect(() => {\n      getEditor?.(editorRef.current);\n    }, [getEditor]);\n\n    return (\n      <TextArea\n        {...restProps}\n        value={value}\n        onChange={v => {\n          setValue(v);\n          if (isComposing) {\n            return;\n          }\n          propsOnChange?.(v);\n        }}\n        onCompositionStart={() => setIsComposing(true)}\n        onCompositionEnd={e => {\n          setIsComposing(false);\n          propsOnChange?.(e.currentTarget.value);\n        }}\n      />\n    );\n  },\n);\n\nexport const EditorInput: typeof EditorFullInputInner = withField(\n  EditorFullInputInner,\n  {\n    valueKey: 'value',\n    onKeyChangeFnName: 'onChange',\n  },\n);\n"],"names":["EditorFullInputInner","forwardRef","props","ref","propsValue","propsOnChange","getEditor","restProps","value","setValue","useState","isComposing","setIsComposing","valueRef","useRef","useEffect","editorRef","htmlContent","text","content","_valueRef_current","zone","useImperativeHandle","delta","_editorRef_current","TextArea","v","e","EditorInput","withField"],"mappings":"qSAkCaA,EAAuBC,AAAAA,GAAAA,EAAAA,UAAAA,AAAAA,EAClC,CAACC,EAAyBC,KACxB,GAAM,CACJ,MAAOC,CAAU,CACjB,SAAUC,CAAa,CACvBC,UAAAA,CAAS,CAEV,CAAGJ,EADCK,EAAAA,AAAAA,GAAAA,EAAAA,CAAAA,AAAAA,EACDL,EAAAA,CAJF,QACA,WACAI,Y,EAGI,CAACE,EAAOC,EAAS,CAAGC,AAAAA,GAAAA,EAAAA,QAAAA,AAAAA,EAASN,GAC7B,CAACO,EAAaC,EAAe,CAAGF,AAAAA,GAAAA,EAAAA,QAAAA,AAAAA,EAAS,IAGzCG,EAAWC,AAAAA,GAAAA,EAAAA,MAAAA,AAAAA,EAAON,GAGxBO,AAAAA,GAAAA,EAAAA,SAAAA,AAAAA,EAAU,KACRF,EAAS,OAAO,CAAGL,CACrB,EAAG,CAACA,EAAM,EAEV,IAAMQ,EAAYF,AAAAA,GAAAA,EAAAA,MAAAA,AAAAA,EAAe,CAC/B,QAAS,AAACG,IACRR,EAASQ,EACX,EACA,QAAS,AAACC,IACRT,EAASS,EACX,EACA,WAAY,AAACC,IACXV,EAASU,EAAQ,MAAM,CAAC,EAAE,CAAC,MAAM,CACnC,EACA,WAAY,K,IACSC,E,MADF,CACjB,OAAQ,CAAC,CAAE,OAAQA,AAAgB,OAAhBA,CAAAA,EAAAA,EAAS,OAAO,AAAD,GAAfA,AAAAA,KAAAA,IAAAA,EAAAA,EAAoB,EAAG,EAAE,AAC9C,C,EACA,QAAS,IAAMP,EAAS,OAAO,EAAI,GACnC,iBAAkB,IAAM,KACxB,gBAAiB,IAAO,EACtB,aAAc,AAACQ,GAAc,IAC/B,GACA,UAAW,CACT,aAAc,IAAO,EACnB,MAAO,EACP,IAAK,EACL,OAAQ,GACV,EACF,EACA,gBAAiB,IAAM,KACvB,aAAc,CACZ,SAAU,IAAM,IAClB,EACA,GAAI,IAAM,IACZ,GAkBA,MAhBAC,AAAAA,GAAAA,EAAAA,mBAAAA,AAAAA,EAAoBnB,EAAK,IAAO,EAC9B,gBAAgBoB,CAAK,EACnBP,EAAU,OAAO,EAAIO,GAASP,EAAU,OAAO,CAAC,UAAU,CAACO,EAC7D,EACA,cACSP,EAAU,OAAO,CAE1B,c,IACSQ,EAAP,MAAOA,AAAAA,CAAiB,OAAjBA,CAAAA,EAAAA,EAAU,OAAO,AAAD,GAAhBA,AAAAA,KAAAA,IAAAA,EAAAA,KAAAA,EAAAA,EAAmB,OAAO,EAAC,GAAK,EACzC,CACF,IAEAT,AAAAA,GAAAA,EAAAA,SAAAA,AAAAA,EAAU,KACRT,MAAAA,GAAAA,EAAYU,EAAU,OAAO,CAC/B,EAAG,CAACV,EAAU,EAGZ,UAACmB,EAAAA,EAAQA,CAAAA,AAAAA,GAAAA,EAAAA,CAAAA,AAAAA,EAAAA,AAAAA,GAAAA,EAAAA,CAAAA,AAAAA,EAAAA,CAAAA,EACHlB,GAAAA,CACJ,MAAOC,EACP,SAAUkB,AAAAA,IAER,GADAjB,EAASiB,IACLf,EAGJN,MAAAA,GAAAA,EAAgBqB,EAClB,EACA,mBAAoB,IAAMd,EAAe,IACzC,iBAAkBe,AAAAA,IAChBf,EAAe,IACfP,MAAAA,GAAAA,EAAgBsB,EAAE,aAAa,CAAC,KAAK,CACvC,C,GAGN,GAGWC,EAA2CC,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EACtD7B,EACA,CACE,SAAU,QACV,kBAAmB,UACrB,E"}