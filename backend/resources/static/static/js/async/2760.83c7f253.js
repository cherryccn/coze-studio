/*
 * Copyright 2025 coze-dev Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";(self.webpackChunk_coze_studio_app=self.webpackChunk_coze_studio_app||[]).push([["2760"],{769094:function(e,t,n){n.r(t),n.d(t,{OnboardingEditor:()=>V,default:()=>W});var r,o,i=n("808549"),l=n("120454"),a=n("151064"),d=n("455069"),u=n("252237"),s=n.n(u),c=n("336205"),p=n("775699"),g=n("178626"),v=n("58118"),m=n("915757"),h=()=>({image:{display:g.displayType.inline,displayEnter:!1}}),f=e=>{var{editorRef:t,onEditorFocus:n,onEditorBlur:r}=e;(0,d.useEffect)(()=>{var e,o,i,l;if(!!t.current)null===(o=t.current)||void 0===o||null===(e=o.getRootContainer())||void 0===e||e.addEventListener("focus",n,{capture:!0}),null===(l=t.current)||void 0===l||null===(i=l.getRootContainer())||void 0===i||i.addEventListener("blur",r,{capture:!0})},[t.current])},_=n("124922"),b=n("211236"),x=e=>{var{children:t,tooltipText:n,pluginValue:r}=e;return(0,a.jsx)(g.ToolbarButton,{extra:{size:"small"},icon:t,tooltipText:n,pluginKey:"insertTemplate",pluginValue:r})};class y extends g.Plugin{match(e){return e===y.KEY}render(e){return(0,a.jsx)(g.Text,{className:"font-medium",children:e.children})}insertTemplate(){var{start:e,end:t}=this.editor.selection.getSelection(),n=e.zoneId,r=this.editor.getContentState().getZoneState(n);if(!r||!r.getLine(e.line))return;var o=r.pointToOffset(e),i=r.pointToOffset(t);if(null!==o&&null!==i){var l=new g.ZoneDelta({zoneId:n});l.retain(o).delete(i-o),l.insert(this.template),this.editor.getContentState().apply(l)}}constructor(e){var{editor:t,template:n}=e;super(),this.editor=t,this.template=n,this.editor.registerCommand(y.KEY,this.insertTemplate.bind(this))}}y.KEY="insertTemplate";var E=(e,t)=>{if(!e.current)return;var n=e.current,{start:r}=n.selection.getSelection(),o=r.zoneId,i=n.getContentState().getZoneState(o);if(!!i){var l=i.totalWidth()-1-t;if(l>0){var a=new g.ZoneDelta({zoneId:o});a.retain(t).delete(l),n.getContentState().apply(a)}}},T=e=>{var t,{prologue:n,editorRef:r}=e,o=(0,g.md2html)(n);null===(t=r.current)||void 0===t||t.setHTML(o)},C=n("825955"),S=n("382534");var j=(r=(0,C._)(function*(){var{code:e,msg:t,data:n}=yield S.nA.GetUploadAuthToken({scene:"bot_task"},{timeout:6e4});return{code:Number(e),message:t,data:(0,i._)({},n,n.auth)}}),function(){return r.apply(this,arguments)});var I=(o=(0,C._)(function*(e){var t,{Key:n}=e,{code:r,msg:o,data:i}=yield S.pr.GetImagexShortUrl({uris:[n]}),l=null==i?void 0:null===(t=i.url_info)||void 0===t?void 0:t[n],a=null==l?void 0:l.review_status,d=null==l?void 0:l.url;if(!a)throw p.FN.error({content:c.o.t("inappropriate_contents"),showClose:!1}),Error("inappropriate_contents");if(!d)throw Error("inappropriate_contents");return{code:Number(r),message:o,data:{url:d}}}),function(e){return o.apply(this,arguments)}),L=n("297158"),Z=(e,t)=>{var r,[o,i]=(0,d.useState)(!1),[l,a]=(0,d.useState)(0),[u,s]=(0,d.useState)(0);return{submitEditor:(r=(0,C._)(function*(){try{i(!0);var r,o,l,d,{checkAndGetMarkdown:u}=yield Promise.resolve().then(n.bind(n,178626));if(!(yield u({editor:e.current.getEditor(),validate:!1,onImageUploadProgress:(e,t)=>{a(t),s(e)}})))return;var c=null===(o=e.current)||void 0===o?void 0:null===(r=o.getEditor())||void 0===r?void 0:r.getContent();null==t||null===(d=t.current)||void 0===d||null===(l=d.getEditor())||void 0===l||l.setContent(c),i(!1)}catch(e){i(!1),L.E7.error({message:"onboarding-editor-modal-checkAndGetMarkdown-error",error:e})}}),function(){return r.apply(this,arguments)}),isModalEditorSubmitting:o,editorImageUploadNum:l,editorImageTotalNum:u}},k=e=>{var{props:t,editorRef:n}=e,{initValues:r}=t,{prologue:o}=r||{},i=(0,d.useRef)(!1);(0,d.useEffect)(()=>{var e,r;if(!i.current&&!!o&&!!n.current)i.current=!0,t.plainText?n.current.setText(o):T({prologue:o,editorRef:n}),null===(r=n.current)||void 0===r||null===(e=r.scrollModule)||void 0===e||e.scrollTo({top:0})},[o,n.current])},w=n("407821"),z=n.n(w),R=n("472772"),A=n.n(R),G=n("395245"),H=n.n(G),K=n("297998"),N=n.n(K),M=n("646576"),F=n.n(M),P=n("606121"),U=n.n(P),B=n("13432"),O={};O.styleTagTransform=U(),O.setAttributes=N(),O.insert=H().bind(null,"head"),O.domAPI=A(),O.insertStyleElement=F(),z()(B.Z,O);var Y=B.Z&&B.Z.locals?B.Z.locals:void 0,D=(0,d.forwardRef)((e,t)=>{var n,r,o,u=(0,d.useRef)(null),b=(0,d.useRef)(null),C={props:e,editorRef:u,api:b},[S,L]=(0,d.useState)(!1);return k(C),f((0,l._)((0,i._)({},C),{onEditorBlur:()=>{var t;L(!1),null==e||null===(t=e.onBlur)||void 0===t||t.call(e,C)},onEditorFocus:()=>{L(!0)}})),(0,d.useImperativeHandle)(t,()=>({reInit:t=>{if(e.plainText)return u.current.setText(t.prologue);T({prologue:t.prologue,editorRef:u})},getEditor:()=>u.current})),(0,a.jsxs)(a.Fragment,{children:[(null==e?void 0:e.noLabel)?null:(0,a.jsx)("div",{className:s()(_.Z["onboarding-message-title"],_.Z.text),children:(0,a.jsx)("span",{className:"coz-fg-secondary",children:c.o.t("bot_edit_opening_text_title")})}),(0,a.jsx)(p.l0,{getFormApi:e=>b.current=e,children:(0,a.jsx)(p.yC,{"data-testid":"bot-editor.onboarding-editor",spinning:null!==(n=null==e?void 0:e.isGenerating)&&void 0!==n&&n,tip:c.o.t("generating"),children:(0,a.jsx)(g.LazyEditorFullInput,{businessKey:null!==(r=e.businessKey)&&void 0!==r?r:"onboarding-editor",fieldStyle:{padding:"0"},disabled:e.isReadonly,field:"prologue",onChange:()=>{var t;E(u,v.p.getInputLengthLimit("onboarding")),null==e||null===(t=e.onChange)||void 0===t||t.call(e,C)},noExpand:null!==(o=null==e?void 0:e.noExpand)&&void 0!==o&&o,schema:h(),style:(0,i._)({height:S?"unset":132,minHeight:132},null==e?void 0:e.style),getEditor:e=>{u.current=e},noToolbar:e.isReadonly,onExpand:null==e?void 0:e.onExpand,plainText:e.plainText,className:Y["onboarding-editor"],getUploadToken:j,getImgURL:I,registerPlugins:(e,t)=>{var{editor:n}=t;return e.concat([[y,{editor:n,template:"{{user_name}}"}]])},registerToolItem:e=>e.concat([()=>(0,a.jsx)(x,{tooltipText:c.o.t("add_nickname"),style:{color:"rgba(6,7,8,0.5)",height:"22px"},pluginValue:"{{user_name}}",children:(0,a.jsx)(m.U5H,{})})]),noLabel:!0,label:c.o.t("community_Group_Title_content"),maxCount:v.p.getInputLengthLimit("onboarding"),placeholder:c.o.t("community_Please_enter_please_enter_your_post")})})})]})}),V=(0,d.forwardRef)((e,t)=>{var[n,r]=(0,d.useState)(!1),o=(0,d.useRef)(null),{isModalEditorSubmitting:u,editorImageUploadNum:s,editorImageTotalNum:g,submitEditor:v}=Z(o,t);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(b.C,{visible:n,onCancel:()=>{if(!u)r(!1)},children:[(0,a.jsx)(D,(0,l._)((0,i._)({},e),{ref:o,noExpand:!0,businessKey:"onboarding-editor-modal",noLabel:!0,style:{height:572},onChange:v})),u?(0,a.jsx)(p.ZT.Text,{size:"small",className:"coz-fg-secondary",children:c.o.t("community_Image_uploading",{upload_num:s,total_num:g})}):null]}),(0,a.jsx)(D,(0,l._)((0,i._)({ref:t},e),{onExpand:()=>r(!0)}))]})}),W=V},13432:function(e,t,n){var r=n(125161),o=n.n(r),i=n(404442),l=n.n(i)()(o());l.push([e.id,".onboarding-editor-HrGuMA .icon-expand{cursor:pointer;color:rgba(6,7,8,.5)}.onboarding-editor-HrGuMA .editor-kit-container{padding-top:6px!important}",""]),l.locals={"onboarding-editor":"onboarding-editor-HrGuMA",onboardingEditor:"onboarding-editor-HrGuMA"},t.Z=l}}]);
//# sourceMappingURL=2760.83c7f253.js.map