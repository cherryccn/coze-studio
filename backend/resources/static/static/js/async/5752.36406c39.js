/*
 * Copyright 2025 coze-dev Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";(self.webpackChunk_coze_studio_app=self.webpackChunk_coze_studio_app||[]).push([["5752"],{508197:function(e,t,n){n.d(t,{P:function(){return i}});var o=n(808549),r=n(151064),a=n(515107),i={key:"question-limit",component:e=>(0,r.jsx)(a.e,(0,o._)({},e))}},287314:function(e,t,n){n.d(t,{k:function(){return l}});var o=n(808549),r=n(151064),a=n(265842),i=n(201521),l={key:"Radio",component:e=>(0,r.jsx)("div",{className:i.Z["workflow-node-setter-radio"],children:(0,r.jsx)(a.Y,(0,o._)({},e))})}},541292:function(e,t,n){n.d(t,{Y:function(){return u}});var o=n(808549),r=n(120454),a=n(151064),i=n(455069),l=n(450562),s=n(336205),d=n(674343),u={key:"Select",component:e=>{var{value:t,onChange:n,options:u,readonly:c}=e,{options:p,size:v="small",style:m={},emptyContent:f}=u,{getNodeSetterId:g,concatTestId:h}=(0,l.FCD)(),_=h(g("select"),t),y=i.useCallback(e=>{n(e)},[]);return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(d.Ph,{size:v,value:t,style:(0,r._)((0,o._)({width:"100%"},m),{pointerEvents:c?"none":"auto"}),onChange:y,defaultValue:null==p?void 0:p[0],optionList:p,emptyContent:f||s.o.t("workflow_detail_node_nodata"),"data-testid":_})})}}},505036:function(e,t,n){n.d(t,{h:function(){return a}});var o=n(151064);n(455069);var r=n(420481),a={key:"SettingOnError",component:(0,n(577060).Sj)(e=>{var{value:t,onChange:n,readonly:a,context:i,options:l}=e;return(0,o.jsx)(r.FV,{value:t,onChange:n,readonly:a,context:i,options:l})})}},441211:function(e,t,n){n.d(t,{$:function(){return l}});var o=n(151064);n(455069);var r=n(155440),a=n(450562),i=n(674343),l={key:"Slider",component:e=>{var{value:t,onChange:n,options:l,readonly:s}=e,{max:d,min:u,step:c,marks:p}=l,{getNodeSetterId:v}=(0,a.FCD)();return(0,o.jsx)("div",{className:"pb-1",children:(0,o.jsx)(i.iR,{"data-testid":v("slider"),marks:p,step:c,max:d,min:u,value:(0,r.Z)(t)?void 0:Number(t),onChange:e=>n(e),readonly:s,disabled:s})})}}},69450:function(e,t,n){n.d(t,{$:()=>ee});var o,r,a,i=n("825955"),l=n("808549"),s=n("120454"),d=n("670324"),u=n("408487"),c=n("336205"),p=n("382534"),v=n("151064"),m=n("455069"),f=n("252237"),g=n.n(f),h=n("686436"),_=n("450562"),y=n("44172"),x=n("674343"),w=n("577060"),b=n("66483"),j=n("114648"),k=e=>{var{isLoading:t,data:n}=(0,j.t)();return!e||t?[]:e.map(e=>{if(!(null==e?void 0:e.biz_role_id))return e;var t=null==n?void 0:n.find(t=>t.biz_role_id===(null==e?void 0:e.biz_role_id));return t?(null==t?void 0:t.nickname)&&e.nickname?(0,s._)((0,l._)({},e),{role:t.role,nickname:t.nickname}):e:e})},N=n("740573");var S=((o={})[o.FixedContent=0]="FixedContent",o[o.GenerateByAgent=1]="GenerateByAgent",o);var C=((r={}).Role="1",r.Nickname="2",r),I=e=>(0,v.jsxs)("div",{className:"h-full w-full flex items-center",children:[(0,v.jsxs)("div",{className:"font-medium pr-2 whitespace-nowrap",children:[e.label," : "]}),(0,v.jsx)("div",{className:"flex-1 flex-nowrap overflow-hidden",children:e.content})]}),T=e=>{var{value:t}=e;return t.generate_mode===S.FixedContent?(0,v.jsx)(x.u,{content:t.content,children:(0,v.jsx)("div",{className:"truncate",children:t.content})}):(0,v.jsx)(N.p,{className:"!inline",children:c.o.t("scene_workflow_chat_node_conversation_content_speaker_generate",{},"Generate by Agent")})},P=e=>{var{value:t}=e;return t?(0,v.jsx)(I,{label:(0,v.jsxs)(v.Fragment,{children:[t.role,t.nickname?"(".concat(t.nickname,")"):"(".concat(c.o.t("scene_edit_roles_list_nickname_empty_seat",{},"空位"),")")]}),content:(0,v.jsx)(T,{value:t})}):null},D=e=>{var{value:t}=e;return(0,v.jsx)(I,{label:t.nickname,content:(0,v.jsx)(T,{value:t})})},E=()=>(0,v.jsx)("div",{className:"text-[var(--semi-color-text-0)] opacity-30",children:c.o.t("scene_workflow_chat_message_content_placeholder",{},"This is a sample message, click to edit.")}),O=e=>""!==e.biz_role_id,L=e=>""!==e.biz_role_id,M=n("473980"),F=n("902272"),Z=()=>{var{data:e=[]}=(0,j.t)(),t=1;return e.map(e=>{var n;return{label:(0,v.jsxs)(x.T,{className:"overflow-hidden",children:[(0,v.jsx)(x.u,{content:e.role,children:(0,v.jsx)("div",{className:"overflow-hidden truncate",children:e.role})}),(0,v.jsx)(N.p,{children:e.nickname?e.nickname:"".concat(c.o.t("scene_edit_roles_list_nickname_empty_seat",{},"空位")).concat(t++)})]}),value:e.biz_role_id,biz_role_id:e.biz_role_id,role:e.role,nickname:null!==(n=e.nickname)&&void 0!==n?n:"",extra:{biz_role_id:e.biz_role_id,role:e.role,nickname:e.nickname,role_type:e.role_type}}})},R=n("569502"),V=n("551386"),A=()=>(0,V.w)().filter(e=>e.type===R.ow.String).map(e=>({label:(0,v.jsxs)(x.T,{className:"overflow-hidden",children:[(0,v.jsx)(x.u,{content:e.name,children:(0,v.jsx)("div",{className:"overflow-hidden truncate",children:e.name})}),(0,v.jsx)(N.p,{children:R.Iu[e.type]})]}),value:e.name,biz_role_id:"",role:"",nickname:e.name,extra:{biz_role_id:"",role:"",nickname:e.name,role_type:void 0}})),z=(0,m.createContext)({testId:""}),B=z.Provider,U=()=>(0,m.useContext)(z),q=n("610496"),W=(0,x.Q2)(e=>{var{value:t,onChange:n}=e,{value:o,testId:r}=U(),a=Z(),i=A(),[d,u]=(0,m.useState)(),[p,f]=(0,m.useState)(C.Role);(0,m.useEffect)(()=>{if(!t){u(t);return}L(t)?(u(t.biz_role_id),f(C.Role)):(u(t.nickname),f(C.Nickname))},[t]);var g=(0,v.jsxs)(x.FX,{className:"".concat(q.Z["speaker-type-radio"]," w-full mb-4"),type:"button",value:p,onChange:e=>{f(e.target.value)},children:[(0,v.jsx)(x.Y8,{value:C.Role,className:"w-[50%]","data-testid":(0,_.xtp)(r,"messageSet","speakerSlect","type","player"),children:c.o.t("scene_workflow_chat_node_conversation_visibility_custom_roles",{},"Player")}),(0,v.jsx)(x.Y8,{value:C.Nickname,className:"w-[50%]","data-testid":(0,_.xtp)(r,"messageSet","speakerSlect","type","nickname"),children:c.o.t("scene_workflow_chat_node_conversation_visibility_custom_variable",{},"Nickname Variables")})]});function h(e,t){var n=null==o?void 0:o.filter(e=>(null==e?void 0:e[t])!==d);return e.map(e=>(null==n?void 0:n.find(n=>(null==e?void 0:e[t])===(null==n?void 0:n[t])))?(0,s._)((0,l._)({},e),{disabled:!0}):e)}var y=p===C.Role?h(a,"biz_role_id"):h(i,"nickname");return(0,v.jsx)(x.Ph,{value:d,className:"w-full",dropdownMatchSelectWidth:!0,outerTopSlot:g,dropdownStyle:{width:320},placeholder:c.o.t("scene_workflow_chat_node_conversation_content_speaker_placeholder",{},"请选择发言人"),onSelect:(e,t)=>{null==n||n((0,l._)({},null==t?void 0:t.extra))},"data-testid":(0,_.xtp)(r,"messageSet","speakerSelect"),emptyContent:c.o.t("workflow_detail_node_nodata"),children:y.map(e=>(0,v.jsx)(x.Ph.Option,(0,s._)((0,l._)({},e),{"data-testid":(0,_.xtp)(r,"messageSet","speakerSelect","option",e.value),children:e.label}),e.value))})}),G=n("462977"),H=(0,x.Q2)(e=>{var{value:t,onChange:n,context:o,placeholder:r,validateStatus:a}=e;return(0,v.jsx)(G.M,{onChange:n,value:t,context:o,placeholder:r,isError:"error"===a})}),$=n("688623"),{Radio:J,RadioGroup:Y}=x.l0,Q=e=>e?{speaker:{biz_role_id:e.biz_role_id,nickname:e.nickname,role:e.role,role_type:e.role_type},generate_mode:e.generate_mode,content:e.content}:e,X=e=>{var t,n,{testId:o}=U(),{initialValue:r,onSubmit:a,onCancel:i,setterContext:s}=e,d=(0,m.useRef)(null),[u,p]=(0,m.useState)(Q(r));return(0,v.jsx)("div",{className:"w-[480px] p-6",children:(0,v.jsxs)(x.l0,{initValues:Q(r),onSubmit:e=>{var t=e||{},{speaker:n={}}=t,o=(0,M._)(t,["speaker"]);null==a||a((0,l._)({},n,o))},onValueChange:e=>{p((0,l._)({},e))},ref:d,className:$.Z["speaker-message-set-form"],children:[(0,v.jsx)(W,{field:"speaker",label:c.o.t("scene_workflow_chat_node_conversation_content_speaker",{},"Speaker"),rules:[{required:!0,message:c.o.t("scene_workflow_chat_node_conversation_batch_empty",{},"你必须添加一个发言人列表")}],onChange:e=>{if(void 0!==e){if(!e.biz_role_id||e.biz_role_id&&!e.nickname){var t;(null===(t=d.current)||void 0===t?void 0:t.formApi.getValue("generate_mode"))===S.FixedContent&&(d.current.formApi.setValue("generate_mode",S.GenerateByAgent),d.current.formApi.setValue("content",void 0))}}}}),(0,v.jsxs)(Y,{field:"generate_mode",label:c.o.t("scene_workflow_chat_node_conversation_content_speaker_message_type",{},"Message type"),rules:[{required:!0}],onChange:e=>{if(e.target.value===S.GenerateByAgent){var t;null===(t=d.current)||void 0===t||t.formApi.setValue("content","")}},children:[(0,v.jsx)(J,{value:S.FixedContent,disabled:null!=u&&!!u.speaker&&(!(null==u?void 0:null===(t=u.speaker)||void 0===t?void 0:t.biz_role_id)||!!u.speaker.biz_role_id&&!u.speaker.nickname),"data-testid":(0,_.xtp)(o,"messageSet","contentMode"),children:c.o.t("scene_workflow_chat_node_conversation_content_speaker_fixed",{},"Fixed content")}),(0,v.jsx)(J,{value:S.GenerateByAgent,disabled:(null==u?void 0:null===(n=u.speaker)||void 0===n?void 0:n.role_type)===F.GD.Host,children:c.o.t("scene_workflow_chat_node_conversation_content_speaker_generate",{},"Generate by Agent")})]}),(0,v.jsx)(H,{field:"content",fieldClassName:g()({"!block":(null==u?void 0:u.generate_mode)===S.FixedContent,hidden:!0}),label:c.o.t("scene_workflow_chat_node_conversation_content_speaker_fixed_content",{},"Content"),context:s,placeholder:c.o.t("scene_workflow_chat_node_conversation_content_speaker_fixed_placeholder",{},"You can use the {variable name}} method to introduce variables from the input parameters."),rules:[{required:(null==u?void 0:u.generate_mode)===S.FixedContent}],fieldStyle:{overflow:"visible"}}),(0,v.jsx)("div",{className:"flex justify-end mt-6",children:(0,v.jsxs)(x.T,{children:[(0,v.jsx)(x.zx,{color:"primary",onClick:i,"data-testid":(0,_.xtp)(o,"messageSet","cancel"),children:c.o.t("cancel")}),(0,v.jsx)(x.zx,{color:"hgltplus",htmlType:"submit",className:"btn-margin-right",onClick:()=>{var e;return null===(e=d.current)||void 0===e?void 0:e.formApi.submitForm()},"data-testid":(0,_.xtp)(o,"messageSet","submit"),children:c.o.t("confirm",{},"Confirm")})]})})]})})},K=e=>{var{readonly:t,testId:n}=U(),{value:o,onChange:r,defaultFocused:a,setterContext:i,onVisibleChange:l,index:s}=e,[d,u]=(0,m.useState)(a),c=e=>{null==r||r(e),u(!1)},p=e=>{u(e),null==l||l()};return(0,v.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,v.jsx)(w.Ce,{path:"[".concat(s,"]"),errorCompClassName:"output-param-name-error-type",children:e=>(0,v.jsx)(x.J2,{visible:d,onVisibleChange:p,trigger:"click",content:(0,v.jsx)(X,{setterContext:i,initialValue:o,onSubmit:t=>{e.onChange(),c(t)},onCancel:()=>u(!1)}),children:(0,v.jsx)("div",{className:g()("rounded-lg coz-bg-max h-[32px] cursor-pointer px-3 py-[6px] flex  items-center gap-2 overflow-hidden border-solid border",{"pointer-events-none":t,"border-[var(--semi-color-danger)]":e.showError,"border-white":!e.showError}),"data-testid":(0,_.xtp)(n,"selectedSpeaker"),onBlur:e.onBlur,children:(0,v.jsx)("div",{className:"flex-1 overflow-hidden",children:o?O(o)?(0,v.jsx)(P,{value:o}):(0,v.jsx)(D,{value:o}):(0,v.jsx)(E,{})})})})})})};var ee={key:"SpeakerMessageSetArray",component:(0,w.Sj)(e=>{var{value:t,onChange:n,context:o,options:r,readonly:a}=e,i=k(t),{getNodeSetterId:l}=(0,_.FCD)(),s=l(o.path),{sortable:d}=r,u=(0,m.useRef)(),p=(0,h.PF)(),f=e=>t=>{u.current=void 0,null==n||n(i.map((n,o)=>o===e?t:n))},w=e=>()=>{u.current=void 0,null==n||n(i.filter((t,n)=>n!==e))},j=()=>{u.current=void 0};return(0,v.jsx)(B,{value:{value:i,readonly:a,testId:s},children:(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"flex flex-col gap-3",children:d&&!a?(0,v.jsx)(b.c,{value:i,onChange:e=>{u.current=void 0,null==n||n(e)},renderItem:(e,t,n)=>(0,v.jsxs)("div",{className:"flex gap-3 items-start",children:[d?(0,v.jsx)(b.D,{ref:null==n?void 0:n.dragRef,testId:(0,_.xtp)(s,"drag"),className:"pt-2"}):null,(0,v.jsx)(K,{setterContext:o,value:e,onChange:f(t),defaultFocused:t===u.current,onVisibleChange:j,index:t}),(0,v.jsx)(x.hU,{color:"secondary",size:"small",icon:(0,v.jsx)(y.XvT,{}),onClick:w(t),"data-testid":(0,_.xtp)(s,"remove"),style:{marginTop:4}})]})}):(0,v.jsx)(v.Fragment,{children:i.map((e,t)=>(0,v.jsxs)("div",{className:"flex gap-3 items-start",children:[(0,v.jsx)(K,{setterContext:o,value:e,onChange:f(t),onVisibleChange:j,defaultFocused:t===u.current,index:t}),(0,v.jsx)(x.hU,{className:g()({"pointer-events-none":a}),color:"secondary",size:"small",icon:(0,v.jsx)(y.XvT,{}),onClick:w(t),"data-testid":(0,_.xtp)(s,"remove"),style:{marginTop:4}})]}))})}),(0,v.jsx)(x.zx,{className:g()("mt-3",{"cursor-pointer":i.length<10,"cursor-not-allowed":10===i.length,"pointer-events-none":a}),color:"highlight",icon:(0,v.jsx)(y.N_R,{}),onClick:()=>{u.current=i.length,null==n||n([...null!=i?i:[],void 0])},"data-testid":"playground.node.".concat(null==p?void 0:p.id,".").concat(o.path,".addbutton"),disabled:10===i.length,children:c.o.t("workflow_add_input")})]})})}),validator:(a=(0,i._)(function*(e){var{value:t,context:n}=e,{playgroundContext:o}=n,{globalState:r}=o,a=yield u.fB_.fetchQuery({queryKey:["scene_flow_role_list"],staleTime:1/0,queryFn:()=>p.fc.GetMetaRoleList({meta_id:r.bindBizID})}),i=d.z.object({biz_role_id:d.z.string(),role:d.z.string(),nickname:d.z.string(),generate_mode:d.z.number(),content:d.z.string().optional()}).nullish().refine(e=>!!e||!1,{message:c.o.t("scene_workflow_chat_message_error_content_empty",{},"对话内容不可为空")}).refine(e=>{if(!(null==e?void 0:e.biz_role_id))return!0;var t=a.role_list.find(t=>t.biz_role_id===(null==e?void 0:e.biz_role_id));return!!t&&((null==e?!void 0:!e.nickname)||!!t.nickname)&&!0},{message:c.o.t("scene_workflow_invalid",{},"已失效")});if(!(null==t?void 0:t.length))return!0;var v=t.map((e,t)=>{var n,o=i.safeParse(e);return o.success?{success:o.success}:(0,s._)((0,l._)({success:o.success},null===(n=JSON.parse(o.error.message))||void 0===n?void 0:n[0]),{path:[t]})});return!!v.every(e=>e.success)||JSON.stringify({name:"ZodError",issues:v.reduce((e,t)=>(!t.success&&e.push(t),e),[]),errors:v})}),function(e){return a.apply(this,arguments)})}},748494:function(e,t,n){n.d(t,{i:()=>c});var o=n("808549"),r=n("120454"),a=n("151064"),i=n("455069"),l=n("336205"),s=n("666919"),d=n("940492"),u=n("23383"),c={key:"sql",component:e=>{var{onChange:t,readonly:n}=e,[c,p]=(0,i.useState)(0);return(0,a.jsxs)("div",{className:u.Z.container,children:[!n&&(0,a.jsx)(d.h,{className:u.Z["auto-generate"],onSubmit:function(e){t(e),p(c+1)}}),(0,a.jsx)(s.i,(0,r._)((0,o._)({},e),{options:{key:"",placeholder:l.o.t("workflow_240218_12")}}),c)]})}}},940492:function(e,t,n){n.d(t,{h:()=>b});var o=n("151064"),r=n("455069"),a=n("450562"),i=n("674343"),l=n("184449"),s=n("808549"),d=n("979838"),u=n("336205"),c=n("825955"),p=n("280990"),v=n("382534"),m=()=>{var e,t=(0,l.s5)();var{data:n,mutate:o,isPending:r}=(0,p.D)({mutationFn:(e=(0,c._)(function*(e){var{text:n}=e;return(yield v.v6.GetNL2SQL({bot_id:0,database_id:t,text:n,table_type:1})).sql}),function(t){return e.apply(this,arguments)})});return{sql:n,nl2sql:o,isFetching:r}},f=n("542633"),g=e=>{var{value:t,isFetching:n,testId:r}=e;return(0,o.jsx)(i.yC,{wrapperClassName:f.Z.result,tip:"Optimizing Prompt...",spinning:n,"data-testid":r,children:t})},h=n("915757"),_=e=>{var{onClick:t,className:n,disabled:r=!1}=e;return(0,o.jsx)(i.hU,{color:"highlight",size:"small",className:"".concat(n),disabled:r,onClick:t,icon:(0,o.jsx)(h.epB,{})})},y=n("277483"),x=e=>{var{onSubmit:t,onCancel:n}=e,l=(0,r.useRef)(null),[c={},p]=(0,r.useState)(),{text:v}=c,f=!!v,{getNodeSetterId:h}=(0,a.FCD)(),{sql:x,isFetching:w,nl2sql:b}=m(),j=!!x;return(0,o.jsxs)("div",{onClick:e=>e.stopPropagation(),children:[(0,o.jsxs)("header",{className:y.Z.header,children:[(0,o.jsx)("span",{className:y.Z.title,children:u.o.t("workflow_240218_11")}),(0,o.jsx)(d.Z,{className:y.Z.close,onClick:n,"data-testid":h("popover-close")})]}),(0,o.jsxs)(i.l0,{className:y.Z.form,ref:l,layout:"vertical",onChange:e=>{var t=null==e?void 0:e.values;p((0,s._)({},t))},children:[(0,o.jsx)(i.l0.TextArea,{field:"text",label:u.o.t("workflow_240218_15"),placeholder:u.o.t("workflow_240218_16"),onFocus:e=>{e.preventDefault(),e.stopPropagation()},onClick:e=>e.stopPropagation(),"data-testid":h("popover-textarea")}),(0,o.jsx)(i.l0.Slot,{label:(0,o.jsxs)("div",{className:y.Z["text-label"],children:[u.o.t("workflow_240218_09"),(0,o.jsx)(_,{disabled:!f,className:y.Z["auto-generate-button"],onClick:()=>{f&&b({text:v})},"data-testid":h("popover-generate-btn")})]}),children:(0,o.jsx)(g,{isFetching:w,value:x,testId:h("popover-result")})})]}),(0,o.jsx)("footer",{className:y.Z.footer,children:(0,o.jsxs)(i.T,{spacing:12,children:[(0,o.jsx)(i.zx,{color:"primary",onClick:n,"data-testid":h("popover-cancel-btn"),children:u.o.t("workflow_240218_17")}),(0,o.jsx)(i.zx,{color:"hgltplus",theme:"solid",type:"primary",onClick:()=>{j&&t(x)},disabled:!j,"data-testid":h("popover-use-btn"),children:u.o.t("workflow_240218_18")})]})})]})},w=n("117909"),b=e=>{var{onSubmit:t,className:n}=e,{getNodeSetterId:s}=(0,a.FCD)(),[d,u]=(0,r.useState)(!1),c=(0,l.s5)();return(0,o.jsx)(i.J2,{keepDOM:!0,visible:d,className:w.Z.popover,trigger:"custom",content:(0,o.jsx)(x,{onSubmit:e=>{t(e),u(!1)},onCancel:()=>{u(!1)}}),position:"leftBottom",onClickOutSide:()=>u(!1),style:{marginLeft:44},children:(0,o.jsx)("div",{className:n,onClick:()=>{u(e=>!e)},"data-testid":s("auto-generate-button"),children:(0,o.jsx)(_,{disabled:!c})})})}},668918:function(e,t,n){n.d(t,{D:function(){return s}});var o=n(808549),r=n(120454),a=n(151064),i=n(455069),l=n(674343),s={key:"Switch",component:e=>{var{value:t,onChange:n,options:s,readonly:d}=e,{size:u="default",style:c={}}=s,p=(0,i.useCallback)(e=>{n(e)},[]),v=(0,i.useMemo)(()=>(0,r._)((0,o._)({},c),{verticalAlign:"bottom"}),[c]);return(0,a.jsx)(l.rs,{disabled:d,size:u,checked:t,style:v,onChange:p})}}},852135:function(e,t,n){n.d(t,{U:()=>F});var o=n("808549"),r=n("120454"),a=n("151064"),i=n("455069"),l=n("724847"),s=n("227048"),d=n("340291"),u=n("184449"),c=n("1334"),p=n("56695"),v=n("252237"),m=n.n(v),f=n("450562"),g=n("887874"),h=n("219263"),_=n("539227"),y=n("944881"),x=n("310904"),w=n("336205"),b=n("706489"),j=n("538597"),k=n("775699"),N=n("189914"),S=e=>{var{defaultValue:t,wrapperClassName:n="",wrapperStyle:o,readonly:r,placeholder:l,value:d,onChange:u,isControled:c,dataTestID:p,onFocus:v,onBlur:m}=e,[f,g]=(0,i.useState)(!1);return(0,a.jsx)(k.u,{content:w.o.t("db_table_0129_003"),trigger:"custom",position:"top",autoAdjustOverflow:!1,visible:f&&r,getPopupContainer:()=>{var e;return null!==(e=document.getElementById(N.I7))&&void 0!==e?e:document.body},children:(0,a.jsx)("div",{className:n,style:o,onMouseEnter:()=>{g(!0)},onMouseLeave:()=>{g(!1)},children:(0,a.jsx)(s.gv,{defaultValue:null!=t?t:d,value:d,onChange:u,readonly:r,placeholder:l,options:{minHeight:112},dataTestID:p,isControled:c,onFocus:()=>{g(!0),null==v||v()},onBlur:()=>{g(!1),null==m||m()}})})})},C=n("25232"),I=n("915757"),T=n("99285"),P=n("936381"),D=n("202682"),E=n("808390"),O=e=>{var t,n,{getNodeSetterId:o}=(0,f.FCD)(),r=o(e.context.path),v=(0,j.V)(),m=(0,s.jE)(),g=null==m?void 0:m.getValue(),{setFullscreenPanel:h}=(0,d.Tk)(),{spaceId:b,info:{name:N="",desc:C=""}}=(0,u.j1)(),O=(0,p._)(),L=(0,c.Dv)(null==e?void 0:e.value,O),M=()=>"",F=(0,i.useMemo)(()=>()=>({botId:"",name:N,description:C,contextHistory:L}),[L,N,C]);return(0,a.jsxs)("div",{className:"relative w-full h-full bg-[#FCFCFF] py-[12px] rounded-[8px]",children:[(0,a.jsxs)("div",{className:"w-full flex justify-between mb-[12px] px-[20px]",children:[(0,a.jsx)("div",{className:"flex items-center gap-[8px]",children:(0,a.jsx)("div",{className:"text-[16px] leading-[22px] font-medium",style:{color:"var(--Fg-COZ-fg-plus, rgba(6, 7, 9, 0.96))"},children:w.o.t("workflow_LLM_node_sp_title")})}),(0,a.jsxs)("div",{className:"flex items-center gap-[8px]",children:[(0,a.jsx)(l.ad,{disabled:null==e?void 0:e.readonly,children:w.o.t("prompt_optimization_button")}),(0,a.jsx)(k._3,{onClick:()=>h(null),icon:(0,a.jsx)(I.syE,{color:"#060709CC"})})]})]}),(0,a.jsxs)("div",{className:"w-full pl-[8px] pr-[20px]",style:{height:"calc(100% - 25px)"},children:[(0,a.jsx)(S,{defaultValue:null==e?void 0:e.value,onChange:null==e?void 0:e.onChange,readonly:null==e?void 0:e.readonly,placeholder:null==e?void 0:null===(n=e.options)||void 0===n?void 0:null===(t=n.placeholder)||void 0===t?void 0:t.call(n),wrapperClassName:E.Z["prompt-editor"],wrapperStyle:{height:"100%"},dataTestID:r}),(0,a.jsx)(y.Vv,{mode:"input"}),(0,a.jsx)(_.jy,{librarys:[],readonly:!0,spaceId:b}),(0,a.jsx)(l.YN,{shortcutKey:"/"}),(0,a.jsx)(x.Af,{}),(0,a.jsx)(x.ID,{variableTree:v}),(0,a.jsx)(x.iA,{variableTree:v}),!(null==e?void 0:e.readonly)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(P.ol,{children:[(0,a.jsx)(l.Ys,{}),(0,a.jsx)(T.aS,{})]}),(null==g?void 0:g.length)===0?(0,a.jsx)(D.u,{source:"app_detail_page",tabs:["Recommended","Team"],importPromptWhenEmpty:null==e?void 0:e.value,spaceId:b,getConversationId:M,getPromptContextInfo:F,onInsertPrompt:t=>{var n;null==e||null===(n=e.onChange)||void 0===n||n.call(e,t)},listContainerClassName:"h-[211px]",cardClassName:"w-[240xp]"}):null]})]}),(0,a.jsx)(l.fP,{getConversationId:M,getPromptContextInfo:F})]})},L=e=>{var{openPromptLibrary:t,readonly:n}=e,{fullscreenPanel:r,setFullscreenPanel:i}=(0,d.Tk)(),u=!!r;return(0,a.jsxs)("div",{className:"flex justify-between items-center gap-[8px] h-[28px] ".concat(E.Z["kit-button-container"]),children:[(0,a.jsx)(k.u,{content:w.o.t("workflow_prompt_editor_view_library"),children:(0,a.jsx)(k._3,{onClick:e=>{e.stopPropagation(),t()},icon:(0,a.jsx)(I.Guk,{color:"rgba(107, 109, 117, ".concat(n?.5:1,")")}),disabled:n})}),(0,a.jsx)(k.u,{content:w.o.t(u?"collapse":"workflow_prompt_editor_expand"),children:(0,a.jsx)(k._3,{onClick:()=>{i(u?null:(0,a.jsx)(C.n,{children:(0,a.jsx)(s.hT,{children:(0,a.jsx)(O,(0,o._)({},e))})}))},icon:u?(0,a.jsx)(I.qSn,{color:"#6B6D75"}):(0,a.jsx)(I.ltt,{color:"#6B6D75"}),color:"#6B6D75"})}),(0,a.jsx)(k.u,{content:w.o.t("prompt_optimization_button_hover_tooltip"),children:(0,a.jsx)("div",{children:(0,a.jsx)(l.ad,{disabled:n,onlyIcon:!0,className:"!h-6 !p-1 !rounded-lg",style:{minWidth:"24px"}})})})]})},M=e=>{var{context:t,feedbackText:n,feedbackStatus:s,getConversationId:d,getPromptContextInfo:c,readonly:p,options:{placeholder:v},value:k,onChange:N}=e,{getNodeSetterId:C}=(0,f.FCD)(),I=C(t.path),{spaceId:T,projectId:P,workflowId:D}=(0,u.j1)(),O=(0,j.V)(),[M,F]=(0,i.useState)(!1),Z=(0,g.jE)(),R=(0,i.useRef)(k||""),{open:V,node:A}=(0,h.d)({spaceId:T,getConversationId:d,source:"app_detail_page",projectId:P,workflowId:D,editor:Z,getPromptContextInfo:c,onInsertPrompt:t=>null==e?void 0:e.onChange(t)});return(0,a.jsxs)("div",{className:E.Z.container,onBlur:()=>null==N?void 0:N(R.current),children:[(0,a.jsxs)(b.E,{defaultExpand:!0,showBottomBorder:!0,noPadding:!0,header:w.o.t("workflow_LLM_node_sp_title"),tooltip:w.o.t("workflow_detail_llm_sys_prompt_content_tips"),contentClassName:m()(E.Z["code-content"],{[E.Z["code-content-focus"]]:M}),feedbackText:n,feedbackStatus:s,actionButton:(0,a.jsx)(L,(0,r._)((0,o._)({},e),{getConversationId:d,getPromptContextInfo:c,onInsertPrompt:t=>{null==e||e.onChange(t)},openPromptLibrary:V})),children:[(0,a.jsx)(S,{defaultValue:k,value:k,onChange:e=>R.current=e,readonly:p,placeholder:null==v?void 0:v(),isControled:!0,dataTestID:I,onFocus:()=>{F(!0)},onBlur:()=>{F(!1)}}),(0,a.jsx)(y.Vv,{mode:"input"}),(0,a.jsx)(_.jy,{librarys:[],readonly:!0,spaceId:T}),(0,a.jsx)(x.Af,{}),(0,a.jsx)(x.ID,{variableTree:O}),(0,a.jsx)(x.iA,{variableTree:O})]}),(0,a.jsx)(l.fP,{getConversationId:d,getPromptContextInfo:c}),A]})},F={key:"SystemPrompt",component:e=>{var{readonly:t,value:n}=e,{fullscreenPanel:v}=(0,d.Tk)(),{info:{name:m="",desc:f=""}}=(0,u.j1)(),g=(0,p._)(),h=(0,c.Dv)(n,g),_=(0,i.useMemo)(()=>()=>({botId:"",name:m,description:f,contextHistory:h}),[m,f,h]);return(0,a.jsx)(s.hT,{children:(0,a.jsx)(l.rZ,{children:(0,a.jsx)(M,(0,r._)((0,o._)({},e),{readonly:t||!!v,getConversationId:()=>"",getPromptContextInfo:_}))})})}}},973725:function(e,t,n){n.d(t,{B:function(){return a}});var o=n(151064);n(455069);var r=n(674343),a={key:"Temperature",component:e=>{var{value:t,onChange:n}=e;return(0,o.jsx)(r.Rn,{min:.1,max:1,step:.1,value:t,onChange:n})}}},245795:function(e,t,n){n.d(t,{e:function(){return s}});var o=n(808549),r=n(120454),a=n(473980),i=n(151064);n(455069);var l=n(674343),s={key:"TextArea",component:e=>{var{value:t,onChange:n,options:s,readonly:d}=e,{key:u,max:c}=s,p=(0,a._)(s,["key","max"]);return(0,i.jsx)(l.Kx,(0,r._)((0,o._)({},p),{readonly:d,value:t,onChange:n,maxCount:c,maxLength:c}))}}},970767:function(e,t,n){n.d(t,{A:function(){return a}});var o=n(151064),r=n(205641),a={key:"TextDisplay",component:e=>{var{value:t}=e;return(0,o.jsx)(r.x,{className:"h-8 leading-8",text:t})}}},522801:function(e,t,n){n.d(t,{D:()=>O});var o=n("151064"),r=n("455069"),a=n("392300"),i=n("335740"),l=n("808914"),s=n("252237"),d=n.n(s),u=n("450562"),c=n("336205"),p=n("707107"),v=n("674343"),m=n("520862"),f=n("431421"),g=n("998262"),h=n("44408"),_=n.n(h),y=n("233773"),x=n.n(y),w=n("703999"),b=n.n(w),j=n("468329"),k=n.n(j),N=n("479886"),S=n.n(N),C=n("297158"),I="Asia/Shanghai",T="UTC+08:00",P="Others";S().extend(k()),S().extend(b()),S().extend(_()),S().extend(x());var D=()=>{var e=[],t=[];try{var n,o=null!==(n=c.o.language)&&void 0!==n?n:"en-US",r=Intl.supportedValuesOf("timeZone").map(e=>{var t=new Intl.DateTimeFormat(o,{timeZone:e,timeZoneName:"longGeneric"}).formatToParts(new Date),{value:n}=(0,l.Z)(t,["type","timeZoneName"]),r=S()().tz(e);return{value:e,label:"".concat(n," - ").concat(e),offset:"UTC".concat(r.format("Z")),utcOffset:r.utcOffset()}});e=(0,m.Z)((0,f.Z)((0,g.Z)(r,"offset")),e=>{var t,[n]=e;return null===(t=(0,l.Z)(r,["offset",n]))||void 0===t?void 0:t.utcOffset},["asc"]).map(e=>{var[t,n]=e;return{value:t,label:t,children:(0,m.Z)(n,["label"],["asc"])}}),t=r}catch(n){e=[{value:T,label:T,children:[{value:I,label:I}]}],t=[{value:I,offset:T}],C.kg.persist.error({message:"Custom Error: Unable to obtain accurate time zone list",error:n})}return{timezoneOptions:e,timezoneMap:t}},E=n("219899"),O={key:"Timezone",component:e=>{var t,n,{options:s,value:m,onChange:f=a.Z,readonly:g}=e,{className:h,showClear:_=!1,defaultValue:y}=s,x=null!==(n=null!==(t=null==m?void 0:m.content)&&void 0!==t?t:m)&&void 0!==n?n:y,{timezoneOptions:w,timezoneMap:b}=(0,r.useMemo)(()=>D(),[]),[j,k]=(0,r.useMemo)(()=>{var e=(0,i.Z)(w),t=(0,i.Z)(b);return x&&t.every(e=>e.value!==x)&&(e.push({value:P,label:P,children:[{value:x,label:x}]}),t.push({value:x,offset:P})),[e,t]},[]),N=(0,r.useMemo)(()=>{var e=(0,l.Z)(k,["value",x]);return e?[e.offset,e.value]:void 0},[x,k]),S=(e,t)=>{if(Array.isArray(e)&&e.length>1){var[n,o]=e,r=(0,l.Z)(j,["value",n]);if(r&&Array.isArray(r.children)){var a=(0,l.Z)(r.children,[t,o]);if(a&&a.value)return a.value}}};return(0,o.jsx)(v.vT,{size:"small",className:"".concat(h," w-full"),dropdownClassName:E.Z.dropdown,showClear:_,filterTreeNode:!0,filterSorter:(e,t,n)=>{if(Array.isArray(e)&&e.length>1&&Array.isArray(t)&&t.length>1){var o=(n||"").toLowerCase(),r=(e[1].label||"").toLowerCase(),a=(t[1].label||"").toLowerCase(),i=r.split(" "),l=a.split(" ");if(0===i.findIndex(e=>e===o))return -1;if(0===l.findIndex(e=>e===o))return 1;if(r.includes(o))return -1;if(a.includes(o))return 1}return 0},filterRender:e=>{var{className:t,inputValue:n,data:r,onClick:a}=e,i=r.map(e=>e.label).join(" / ");return(0,o.jsx)("li",{role:"menuitem",className:d()("semi-cascader-option-flatten",t),onClick:a,children:(0,o.jsxs)("span",{className:"semi-cascader-option-label",children:[(0,o.jsx)("span",{"aria-hidden":"true",className:"semi-cascader-option-icon semi-cascader-option-icon-empty"}),(0,o.jsx)(v.y$,{sourceString:i,searchWords:[n],highlightStyle:{color:"var(--light-usage-primary-color-primary, #4d53e8)",backgroundColor:"transparent"}})]})})},disabled:g,placeholder:c.o.t("task_preset_timezone"),treeData:j,value:N,onChange:e=>{var t=S(e,"value");f({type:u.YX3.LITERAL,content:t}),t&&(0,p.Gg)(p.Kg.select_scheduled_tasks_timezone,{timezone:t})},displayRender:e=>S(e,"label")})}}},756088:function(e,t,n){n.d(t,{p:function(){return s}});var o=n(808549),r=n(120454),a=n(151064),i=n(450562),l=n(693539);function s(e){return function(t){var{value:n,onChange:s,readonly:d=!1,options:u,feedbackStatus:c}=t,{getNodeSetterId:p}=(0,i.FCD)(),v=p(""),m=(0,l.m)(c);return(0,a.jsx)(e,(0,r._)((0,o._)({value:n,onChange:s},u),{readonly:d||u.readonly,testId:v,validateStatus:m}))}}},379098:function(e,t,n){n.d(t,{C:function(){return p}});var o=n(151064),r=n(39823),a=n(614904),i=n(532267),l=n(336205),s=n(915757),d=n(674343),u=n(184449),c=n(319529),p={key:"TriggerBindWorkflow",component:e=>{var{value:t,onChange:n,options:p,readonly:v}=e,{selectedWorkflowInfo:m}=p,{projectId:f,workflowId:g,spaceId:h,getProjectApi:_,playgroundProps:y}=(0,u.j1)(),x=_(),w=(0,a.ds)(),b=l.o.t("workflow_241119_01"),{node:j,open:k,close:N}=(0,a.Zv)({from:a.wL.ProjectWorkflowAddNode,flowMode:i.wz.Workflow,onAdd:(e,t)=>{null==n||n(e.workflow_id),N()},onRemove:e=>{null==n||n(void 0),N()},onCreateSuccess:e=>{var t;N(),null==y||null===(t=y.refetchProjectResourceList)||void 0===t||t.call(y),w({workflowId:e.workflowId,spaceId:e.spaceId,projectId:f,ideNavigate:null==x?void 0:x.navigate})},i18nMap:{[r.sD.ListItemRemove]:{key:"scene_workflow_delete_workflow_button",options:{source:b}},[r.sD.ListItemRemoveConfirmTitle]:{key:"scene_workflow_delete_workflow_popup_title",options:{source:b}},[r.sD.ListItemRemoveConfirmDescription]:{key:"scene_workflow_delete_workflow_popup_subtitle",options:{source:b}}},hiddenLibrary:!0,projectId:f,excludedWorkflowIds:[g],workFlowList:m?[m]:[]}),S=!m,C=m&&!(null==m?void 0:m.project_id);return(0,o.jsxs)("div",{className:"relative",children:[v?(0,o.jsx)(o.Fragment,{}):(0,o.jsx)("div",{className:"absolute right-[0px] top-[-28px]",children:(0,o.jsx)(d.hU,{onClick:k,icon:(0,o.jsx)(s.PwN,{className:"text-sm"}),color:"highlight",size:"small"})}),t?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.W,{readonly:v,name:S?l.o.t("worklfow_trigger_bind_delete",{},"绑定的工作流已失效"):null==m?void 0:m.name,description:null==m?void 0:m.desc,icon:null==m?void 0:m.icon,onRemove:()=>{null==n||n(void 0)},onClick:()=>{C?window.open("/work_flow?space_id=".concat(h,"&workflow_id=").concat(t),"_blank"):null==x||x.navigate("/workflow/".concat(t))}}),C?(0,o.jsx)("div",{className:"mt-[-4px] text-[12px] coz-fg-hglt-red",children:l.o.t("workflow_trigger_bindwf_lib_error",{},"资源库工作流暂不支持，请先复制到项目中使用。")}):(0,o.jsx)(o.Fragment,{})]}):(0,o.jsx)("div",{className:"text-[12px] coz-fg-secondary",children:l.o.t("workflow_trigger_user_create_bind_tooltips",{},"选择一个工作流，当触发器被激活时，将会执行该工作流。")}),j]})}}},547424:function(e,t,n){n.d(t,{v:function(){return w}});var o=n(825955),r=n(151064),a=n(455069),i=n(479886),l=n.n(i),s=n(252237),d=n.n(s),u=n(444479),c=n(614904),p=n(450562),v=n(336205),m=n(58197),f=n(915757),g=n(674343),h=n(184449),_=n(319529),y=n(453267),x=n(815839),w={key:"TriggerList",component:e=>{var t,n,{value:i,onChange:s,options:w,readonly:b}=e,{spaceId:j,projectId:k,getProjectApi:N}=(0,h.j1)(),S=N(),[C,I]=(0,a.useState)(1),[T,P]=(0,a.useState)(!1),[D,E]=(0,a.useState)(!1),[O,L]=(0,a.useState)({list:[],total:0}),M=(0,u.Z)(T),F=(0,a.useCallback)((0,o._)(function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!M.current)try{P(!0),I(e);var t,n,o,r,a,i=yield p.OHc.ListTriggers({project_id:null!=k?k:"",space_id:j,trigger_id:"",set_type:p.KNf.DEBUG_USERSET,page_size:10,page_num:e});L({list:null!==(r=null==i?void 0:null===(n=i.data)||void 0===n?void 0:null===(t=n.trigger_list)||void 0===t?void 0:t.map(e=>{var t,n;return{triggerId:e.trigger_id,triggerName:e.name,createTime:l()(e.create_time).format("YYYY-MM-DD HH:mm:ss"),triggerTime:null===(t=JSON.parse(null!==(n=e.config)&&void 0!==n?n:"{}"))||void 0===t?void 0:t.crontab,useId:"".concat(e.user_id)}}))&&void 0!==r?r:[],total:Number(null!==(a=null==i?void 0:null===(o=i.data)||void 0===o?void 0:o.total)&&void 0!==a?a:0)})}catch(e){console.error(e)}finally{P(!1)}}),[]),[Z,R]=(0,a.useState)(!1);var V=(t=(0,o._)(function*(e){try{R(!0);var t,n,o,r=yield p.OHc.TestRunTrigger({space_id:j,project_id:null!=k?k:"",trigger_id:null!==(o=e.triggerId)&&void 0!==o?o:""});null==S||S.sendMsgOpenWidget("/workflow/".concat(null==r?void 0:null===(t=r.data)||void 0===t?void 0:t.workflow_id),{name:"process",data:{executeId:null==r?void 0:null===(n=r.data)||void 0===n?void 0:n.execute_id}}),E(!1)}finally{R(!1)}}),function(e){return t.apply(this,arguments)}),A=[{title:v.o.t("workflow_trigger_user_create_id",{},"id"),dataIndex:"triggerId",render:e=>"".concat(e)},{title:v.o.t("workflow_trigger_user_create_name",{},"名称"),dataIndex:"triggerName",render:e=>"".concat(e)},{title:v.o.t("workflow_trigger_user_create_time",{},"创建时间"),dataIndex:"createTime",render:e=>"".concat(e)},{title:v.o.t("workflow_trigger_user_create_schedula",{},"触发时间"),dataIndex:"triggerTime",render:e=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{children:"".concat(e)}),(0,r.jsx)("div",{children:(0,c.pJ)(e)})]})},{title:v.o.t("workflow_trigger_user_create_userid",{},"用户id"),dataIndex:"useId",render:e=>"".concat(e)},{title:v.o.t("workflow_trigger_user_create_action",{},"操作"),width:120,render:e=>(0,r.jsxs)("div",{className:"flex flex-row gap-[8px] justify-end",children:[(0,r.jsx)(g.hU,{color:"secondary",icon:(0,r.jsx)(f.Y6z,{}),loading:Z,onClick:()=>{V(e)}}),b?(0,r.jsx)(r.Fragment,{}):(0,r.jsx)(g.hU,{color:"secondary",icon:(0,r.jsx)(f.dVD,{}),onClick:(0,o._)(function*(){try{var t;yield p.OHc.DeleteTrigger({space_id:j,project_id:null!=k?k:"",trigger_id:null!==(t=e.triggerId)&&void 0!==t?t:"",set_type:p.KNf.DEBUG_USERSET}),F(C)}catch(e){g.FN.error(e.message)}})})]})}];return(0,r.jsxs)("div",{className:"!p-0",children:[(0,r.jsx)("div",{className:"",children:(0,r.jsx)(_.W,{icon:(0,r.jsx)("div",{className:"h-[32px] w-[32px] flex flex-row items-center justify-center rounded-[4px] bg-[#8E4EFF]",children:(0,r.jsx)(f.VGH,{className:"text-white"})}),name:v.o.t("workflow_trigger_user_create_list",{},"触发器列表"),description:v.o.t("workflow_user_trigger_list_descr",{},"查看和管理已创建触发器任务"),readonly:b||!1,showDeleteBtn:!1,alwaysShowActions:!0,actions:(0,r.jsxs)("div",{className:"flex flex-row gap-[2px] items-center",children:[(0,r.jsx)(f.SA_,{}),(0,r.jsx)(g.zx,{color:"secondary",theme:"borderless",onClick:()=>{E(!0),F(1)},className:"!p-0",children:v.o.t("workflow_trigger_user_create_list_read",{},"查看")})]})})}),(0,r.jsx)(g.u_,{title:v.o.t("workflow_trigger_user_create_list",{},"触发器列表"),width:"80%",visible:D,onCancel:()=>{E(!1)},footer:(0,r.jsxs)("div",{className:"flex flex-row gap-[8px] justify-end",children:[(0,r.jsx)(g.zx,{color:"primary",onClick:()=>{E(!1)},loading:T,children:v.o.t("workflow_trigger_user_create_close",{},"关闭")}),(0,r.jsx)(g.zx,{icon:(0,r.jsx)(f.mxP,{}),color:"primary",onClick:()=>{F(1)},className:"!ml-0",children:v.o.t("workflow_trigger_user_create_refresh",{},"刷新")})]}),children:(0,r.jsxs)("div",{className:d()(x.Z["trigger-list"],"flex flex-col"),children:[(0,r.jsx)("div",{className:"coz-bg-max sticky top-0 z-10 pb-[16px]",children:(0,r.jsx)(y.g,{align:"left",className:"rounded-[8px]",isBreakLine:!0,text:v.o.t("workflow_user_trigger_banner",{},"设置以后需要发布到对应渠道才能定时生效")})}),(null==O?void 0:null===(n=O.list)||void 0===n?void 0:n.length)===0?(0,r.jsx)("div",{className:"w-full flex-1 flex flex-col justify-center",children:(0,r.jsx)(g.ub,{size:"full_screen",icon:(0,r.jsx)(m.TL,{}),darkModeIcon:(0,r.jsx)(m.Io,{}),title:v.o.t("workflow_trigger_user_create_nodata",{},"暂时没有数据"),description:v.o.t("workflow_trigger_user_create_advice",{},"您可以使用触发器节点进行创建")})}):(0,r.jsx)(g.iA,{tableProps:{columns:A,dataSource:O.list,loading:T,pagination:{currentPage:C,pageSize:10,total:O.total,onPageChange:F}}})]})})]})}}},717012:function(e,t,n){n.d(t,{E:function(){return r}});var o=n(151064),r={key:"TriggerParameterTitle",component:e=>{var{options:t}=e,{nameLabel:n,valueLabel:r,nameWidth:a}=t;return(0,o.jsxs)("div",{className:"flex flex-row",children:[(0,o.jsx)("div",{className:"coz-fg-secondary",style:{width:a},children:n}),(0,o.jsx)("div",{className:"flex-1 coz-fg-secondary",children:r})]})}}},139655:function(e,t,n){n.d(t,{o:function(){return s}});var o=n(151064);n(455069);var r=n(450562),a=n(561232),i=n(104739),l=n(164634),s={key:"ValueExpressionInput",component:e=>{var{value:t,onChange:n,options:i,feedbackStatus:s,readonly:d,context:u}=e,{style:c,literalStyle:p,disabledTypes:v,availableFileTypes:m,literalDisabled:f=!1,refDisabled:g=!1,showClear:h=!1,hideDeleteIcon:_=!1,hideSettingIcon:y=!1,variableTagStyle:x,readonly:w,inputType:b,constantType:j,customFilterVar:k,literalConfig:N={},inputPlaceholder:S}=i,{getNodeSetterId:C}=(0,r.FCD)(),{variablesDataSource:I,validateStatus:T}=(0,a.IL)({disabledTypes:v,value:t,onChange:n,node:u.node,feedbackStatus:s});return(0,o.jsx)(l.N,{testId:C(u.path),readonly:d||w,value:t,onChange:n,inputType:null!=j?j:b,variablesDatasource:I,validateStatus:T,style:c,disabledTypes:v,availableFileTypes:m,literalDisabled:f,refDisabled:g,showClear:h,customFilterVar:k,literalConfig:N,literalStyle:p,hideDeleteIcon:_,hideSettingIcon:y,variableTagStyle:x,inputPlaceholder:S})},validator:e=>{var{value:t,context:n}=e,{meta:o,playgroundContext:r,node:a}=n,{required:l}=o;return(0,i.s)({value:t,playgroundContext:r,node:a,required:l})}}},353040:function(e,t,n){n.d(t,{u:function(){return s}});var o=n(151064);n(455069);var r=n(962289),a=n(450562),i=n(724375),l=n(493626),s={key:"VariableSelect",component:function(e){var{value:t,onChange:n,options:s}=e,{disabledTypes:d,forArrayItem:u}=s;return(0,o.jsx)(i.W,{className:l.Z["variable-select-setter"],value:(0,r.Z)(t,"content.keyPath"),onChange:e=>{void 0!==e&&(null==n||n({type:a.YX3.REF,content:{keyPath:e}}))},disabledTypes:d,forArrayItem:u})}}},512731:function(e,t,n){n.d(t,{Q:function(){return m}});var o=n(151064),r=n(455069),a=n(962289),i=n(686436),l=n(471583),s=n(538530),d=n(450562),u=n(336205),c=n(524705),p=n(724375),v=n(295141),m={key:"ViewVariableSelect",component:function(e){var{value:t,onChange:n,readonly:c,options:m,context:f}=e,{disabledTypes:g=[],style:h={},forArrayItem:_=!1}=m,[y,x]=(0,r.useState)({status:"default"}),{getNodeSetterId:w}=(0,d.FCD)(),b=(0,i.G2)(l.b),j=(0,i.PF)(),k=(0,a.Z)(t,"content.keyPath");(0,s.M)({keyPath:k,onChange:e=>{var{variableMeta:t}=e;if(!t){x({status:"error",message:u.o.t("card_builder_userVar_list_search_empty")}),n({type:d.YX3.REF});return}if(g.includes(t.type)){x({status:"error"}),n({type:d.YX3.REF});return}x({status:"success"})}});var N=(0,r.useCallback)(e=>{var t=b.getViewVariableByKeyPath(e,{node:j});return(null==t?!!void 0:!!t.type)&&!g.includes(t.type)||!1},[b]);return(0,o.jsx)(p.W,{className:v.Z["view-variable-select-setter"],value:k,readonly:c,onChange:e=>{void 0!==e&&(null==n||n({type:d.YX3.REF,content:{keyPath:e}}),x({status:"success"}))},disabledTypes:g,forArrayItem:_,validateStatus:y.status,invalidContent:y.message,optionFilter:N,style:h,testId:w(f.path)})},validator:e=>{var{value:t,context:n}=e,{meta:o,playgroundContext:r,node:a}=n,{required:i}=o;return(0,c.s)({value:t,playgroundContext:r,node:a,required:i})}}},524705:function(e,t,n){n.d(t,{s:function(){return o.s}});var o=n(104739)},104739:function(e,t,n){n.d(t,{s:function(){return a}});var o=n(450562),r=n(336205),a=e=>{var{value:t,playgroundContext:n,node:a,required:i,emptyErrorMessage:l=r.o.t("workflow_detail_node_error_empty")}=e,{variableValidationService:s}=n;if(o.nZF.isEmpty(t)){if(!i)return;return l}if(t.type===o.YX3.REF)return s.isRefVariableEligible(t,a)}},866471:function(e,t,n){n.d(t,{F3:()=>j,Q4:()=>v,y1:()=>b,l0:()=>a,$0:()=>S,TR:()=>M,oD:()=>j,Ph:()=>Z,__:()=>p,tz:()=>N,cm:()=>F,gN:()=>g,HF:()=>x,az:()=>I,HS:()=>C,F2:()=>h});var o=n("151064"),r=n("385279");function a(e){var{children:t,readonly:n=!1}=e;return(0,o.jsx)(r.RV,{value:{readonly:n},children:t})}var i=n("686436");function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{key:e.key,value:e.value,name:e.name,onBlur:()=>{var t;return null===(t=e.onBlur)||void 0===t?void 0:t.call(e)},onFocus:()=>{var t;return null===(t=e.onFocus)||void 0===t?void 0:t.call(e)},readonly:n,errors:null==t?void 0:t.errors,onChange:t=>{if(!n)null==e||e.onChange(t)}}}function s(){return(0,o.jsx)("span",{className:"coz-fg-hglt-red",children:"*"})}var d=n("915757"),u=n("674343");function c(e){var{tooltip:t}=e;return(0,o.jsx)(u.u,{content:t,children:(0,o.jsx)(d.L03,{className:"text-lg coz-fg-secondary"})})}function p(e){var{className:t,required:n=!1,tooltip:r,extra:a,children:i}=e;return(0,o.jsxs)("div",{className:"flex gap-[4px] items-center ".concat(t," h-[24px]"),children:[(0,o.jsxs)("div",{className:"flex text-[12px]",children:[i,n?(0,o.jsx)(s,{}):null]}),r?(0,o.jsx)(c,{tooltip:r}):null,a]})}var v=e=>{var{label:t,labelExtra:n,tooltip:r,required:a=!1,layout:i="horizontal",children:l}=e;return t?(0,o.jsxs)("div",{className:"horizontal"===i?"flex gap-[4px] min-w-0":"",children:[(0,o.jsx)(p,{className:"horizontal"===i?"w-[148px]":"",required:a,tooltip:r,extra:n,children:t}),(0,o.jsx)("div",{className:"last:flex-1 min-w-0",children:l})]}):l},m=n("455069");function f(e){var{text:t,className:n}=e;return t?(0,o.jsx)("div",{className:"".concat(n," text-[12px] leading-[16px] text-[#ff441e]"),children:t}):null}var g=e=>{var{label:t,labelExtra:n,name:a,tooltip:s,required:d=!1,hasFeedback:u=!0,children:c,layout:p="horizontal",deps:m,defaultValue:g,readonly:h=!1}=e,_=void 0,{readonly:y}=(0,r.Gc)();return(0,o.jsx)(i.gN,{name:a,deps:m,defaultValue:g,children:e=>{var a,i,{field:m,fieldState:g}=e;return(_=l(m,g,h||y),c)?(0,o.jsx)(r.L7,{value:_,children:(0,o.jsxs)(v,{label:t,labelExtra:n,tooltip:s,required:d,layout:p,children:["function"==typeof c?c(_):c,u?(0,o.jsx)(f,{text:null===(i=_.errors)||void 0===i?void 0:null===(a=i[0])||void 0===a?void 0:a.message}):null]})}):(0,o.jsx)(o.Fragment,{})}})},h=e=>{var{name:t,children:n,defaultValue:a,readonly:s=!1,deps:d}=e,u=void 0,{readonly:c}=(0,r.Gc)();return(0,o.jsx)(i.F2,{name:t,defaultValue:a,deps:d,children:e=>{var{field:t,fieldState:a}=e;return u=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=l(e,t,n);return o.remove=t=>null==e?void 0:e.delete(t),o.delete=t=>null==e?void 0:e.delete(t),o.append=t=>{null==e||e.append(t)},o.move=(t,n)=>null==e?void 0:e.move(t,n),o}(t,a,s||c),(0,o.jsx)(r.MK,{value:u,children:"function"==typeof n?n(u):n})}})},_=n("252237"),y=n.n(_);function x(e){var{className:t="",onClick:n,disabled:r=!1,testId:a=""}=e;return(0,o.jsx)(u.hU,{className:"".concat(t," !block"),icon:(0,o.jsx)(d.ozt,{}),color:"secondary",onClick:n,disabled:r,size:"small","data-testid":a})}var w=n("982326");function b(e){var{className:t="",containerClassName:n,removeIconClassName:r,disableDelete:a=!1,hiddenDelete:i=!1,onDelete:l,disableRemove:s=!1,hiddenRemove:d=!1,onRemove:u,children:c,removeTestId:p}=e;return(0,o.jsxs)("div",{className:y()(n,"flex items-start gap-[8px]"),children:[(0,o.jsx)("div",{className:y()("flex gap-[4px] items-start flex-1 ".concat(w.Z.content," min-w-0 min-w-0"),t),children:c}),!d&&!i&&(0,o.jsx)(x,{className:r,disabled:s||a,onClick:u||l,testId:p})]})}function j(e){var{children:t}=e;return(0,o.jsx)("div",{className:"flex flex-col gap-[8px]",children:t})}var k=n("706489");function N(e){var{text:t="",isEmpty:n=!1,children:r}=e;return(0,o.jsx)(o.Fragment,{children:n?(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center h-[95px]",children:[(0,o.jsx)(d.nL$,{className:"mb-[4px] w-[32px] h-[32px] coz-fg-dim"}),(0,o.jsx)("div",{className:"text-center text-[12px] leading-[16px] coz-fg-dim",children:t})]}):r})}var S=(0,m.forwardRef)((e,t)=>{var{title:n,tooltip:r,tooltipClassName:a,actions:i,children:l,isEmpty:s=!1,emptyText:d,collapsible:u,noPadding:c,headerClassName:p,testId:v}=e,f=(0,m.useRef)(null);return(0,m.useImperativeHandle)(t,()=>({open:()=>{var e,t;return null==f?void 0:null===(t=f.current)||void 0===t?void 0:null===(e=t.setOpen)||void 0===e?void 0:e.call(t,!0)},close:()=>{var e,t;return null==f?void 0:null===(t=f.current)||void 0===t?void 0:null===(e=t.setOpen)||void 0===e?void 0:e.call(t,!1)}})),(0,o.jsx)(k.E,{header:n,tooltip:r,tooltipClassName:a,onRef:f,collapsible:u,noPadding:c,testId:v,headerClassName:p,actionButton:(0,o.jsx)("div",{className:"flex gap-[8px] items-center",children:i}),children:(0,o.jsx)(N,{isEmpty:s,text:d,children:l})})});function C(e){var{onClick:t,disabled:n=!1,className:r,dataTestId:a,children:i}=e;return(0,o.jsx)(u.hU,{"data-testid":a,color:"highlight",onClick:t,icon:(0,o.jsx)(d.PwN,{}),size:"small",className:r,disabled:n,children:i})}var I=e=>{var{columns:t}=e;return(0,o.jsx)("div",{className:"flex gap-1 items-center text-xs font-normal leading-4 text-[rgba(28,29,35,0.35)] tracking-[0.12px] mb-[8px]",children:t.map((e,t)=>{var{label:n,style:r,required:a=!1}=e;return(0,o.jsxs)("div",{style:r,children:[n,a?(0,o.jsx)("span",{style:{color:"#f93920",paddingLeft:2},children:"*"}):null]},t)})})},T=n("808549"),P=n("120454"),D=n("670265"),E=n("450562"),O=n("327703"),L=n("184449"),M=e=>{var{children:t,sortableID:n,index:r,containerClassName:a,hanlderClassName:i}=e,{isInIDE:l}=(0,L.j1)(),{getNodeSetterId:s,concatTestId:u}=(0,E.FCD)();return(0,o.jsx)(D._l,{draggableId:"".concat(n),index:r,children:(e,r)=>{if(r.isDragging&&l){var c=(0,O._L)(),p=e.draggableProps.style.left-c.x,v=e.draggableProps.style.top-c.y;e.draggableProps.style.left=p,e.draggableProps.style.top=v}return(0,o.jsx)("div",(0,P._)((0,T._)({ref:e.innerRef},e.draggableProps,e.dragHandleProps),{children:(0,o.jsxs)("div",{className:y()(a,"flex w-full"),children:[(0,o.jsx)("div",{className:y()(i,"flex items-center h-[24px] mr-[4px] pt-[8px] coz-fg-secondary"),"data-testid":u(s("answer-option-item-handle"),n||""),children:(0,o.jsx)(d.TF9,{className:"cursor-grab"})}),(0,o.jsx)("div",{className:"flex-1",children:t})]})}))}})};function F(e){var{children:t,onSortEnd:n}=e;return(0,o.jsx)(D.Z5,{onDragEnd:e=>{n({from:e.source.index,to:e.destination.index})},children:(0,o.jsx)(D.bK,{droppableId:"droppable",children:e=>(0,o.jsxs)("div",(0,P._)((0,T._)({ref:e.innerRef},e.droppableProps),{children:[t,e.placeholder]}))})})}var Z=e=>(0,o.jsx)(u.Ph,(0,T._)({size:"small"},e))},385279:function(e,t,n){n.d(t,{sO:()=>p,Om:()=>d,Gc:()=>i,MK:()=>c,L7:()=>s,RV:()=>a});var o=n("455069"),r=(0,o.createContext)(void 0),a=r.Provider;function i(){var e=(0,o.useContext)(r);if(void 0===e)throw Error("useFormContext must be used within a FormProvider");return e}var l=(0,o.createContext)(void 0),s=l.Provider;function d(){var e=(0,o.useContext)(l);if(void 0===e)throw Error("useFieldContext must be used within a FieldProvider");return e}var u=(0,o.createContext)(void 0),c=u.Provider;function p(){var e=(0,o.useContext)(u);if(void 0===e)throw Error("useFieldArrayContext must be used within a FieldArrayProvider");return e}},801093:function(e,t,n){n.d(t,{KV:()=>f,UP:()=>d,RW:()=>g,mg:()=>v,nk:()=>c,of:()=>x});var o=n("808549"),r=n("120454"),a=n("151064"),i=n("674343"),l=n("175491"),s=n("692724"),d=(0,s.Q)(e=>{var{value:t,onChange:n,onBlur:s,errors:d}=(0,l.U$)();return(0,a.jsx)(i.II,(0,r._)((0,o._)({},e),{value:t,onChange:n,onBlur:s,size:"small",error:d&&d.length>0}))}),u=n("450562"),c=(0,s.Q)(e=>{var{name:t,value:n,onChange:s,onBlur:d,errors:c,readonly:p}=(0,l.U$)(),{getNodeSetterId:v}=(0,u.FCD)();return(0,a.jsx)(i.k7,(0,r._)((0,o._)({},e),{disabled:p,value:n,onChange:s,onBlur:d,size:"small",error:c&&c.length>0,"data-testid":v(t)}))}),p=n("866471"),v=(0,s.Q)(e=>{var{value:t,onChange:n,onBlur:i,errors:s,readonly:d}=(0,l.U$)();return(0,a.jsx)(p.Ph,(0,r._)((0,o._)({},e),{disabled:d,value:t,onChange:e=>n(e),onBlur:i,hasError:s&&s.length>0}))}),m=n("489350");(0,m.Q2)(e=>{var{value:t,onChange:n}=(0,m.U$)();return(0,a.jsx)("div",{className:"flex h-[24px] items-center",children:(0,a.jsx)(i.XZ,(0,r._)((0,o._)({},e),{value:t,onChange:e=>n(!!e.target.checked)}))})});var f=(0,s.Q)(e=>{var{value:t,onChange:n,readonly:s}=(0,l.U$)();return(0,a.jsx)(i.rs,(0,r._)((0,o._)({},e),{disabled:s,checked:t,onChange:n}))}),g=(0,s.Q)(e=>{var{value:t,onChange:n}=(0,l.U$)();return(0,a.jsx)(i.iR,(0,o._)({value:t,onChange:n},e))}),h=n("473980"),_=n("252237"),y=n.n(_);(0,s.Q)(e=>{var{className:t=""}=e,n=(0,h._)(e,["className"]),{value:r,onChange:s,readonly:d=!1}=(0,l.U$)();return(0,a.jsx)(i.Kx,(0,o._)({className:y()(t,"w-full",d?"pointer-events-none":""),value:r,onChange:e=>null==s?void 0:s(e)},n))}),n("455069");var x=(0,s.Q)(e=>{var{name:t,value:n,onChange:s,readonly:d}=(0,l.U$)(),{options:c}=e,p=(0,h._)(e,["options"]),{getNodeSetterId:v,concatTestId:m}=(0,u.FCD)();return(0,a.jsx)(i.FX,(0,r._)((0,o._)({},p),{value:n,disabled:!!d,onChange:e=>s(e.target.value),children:null==c?void 0:c.map(e=>(0,a.jsx)(i.Y8,{className:e.className,value:e.value,"data-testid":m(v(t),"".concat(e.value)),children:e.label}))}))})},692724:function(e,t,n){n.d(t,{Q:()=>l,l:()=>s});var o=n("808549"),r=n("473980"),a=n("151064"),i=n("866471");function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=n=>{var l=(0,o._)({},t,n),{label:s,required:d,tooltip:u,layout:c,defaultValue:p,name:v,deps:m,labelExtra:f,hasFeedback:g}=l,h=(0,r._)(l,["label","required","tooltip","layout","defaultValue","name","deps","labelExtra","hasFeedback"]);return(0,a.jsx)(i.gN,{name:v,label:s,required:d,tooltip:u,layout:c,defaultValue:p,deps:m,labelExtra:f,hasFeedback:g,children:(0,a.jsx)(e,(0,o._)({},h))})};return n.displayName="withField(".concat(e.displayName||"Anonymous",")"),n}function s(e){return t=>{var{name:n,defaultValue:l,deps:s}=t,d=(0,r._)(t,["name","defaultValue","deps"]);return(0,a.jsx)(i.F2,{name:n,defaultValue:l,deps:s,children:(0,a.jsx)(e,(0,o._)({},d))})}}},175491:function(e,t,n){n.d(t,{Dq:()=>l,U$:()=>i,cI:()=>a,nW:()=>o.nW,IK:()=>u,qo:()=>s});var o=n("686436"),r=n("385279");function a(){var e,t=(0,o.cI)(),{readonly:n}=(0,r.Gc)();return{getValueIn:t.getValueIn.bind(t),setValueIn:t.setValueIn.bind(t),validate:null===(e=t.validate)||void 0===e?void 0:e.bind(t),values:t.values,initialValues:t.initialValues,state:t.state,readonly:n,getFieldValue:t.getValueIn.bind(t),setFieldValue:t.setValueIn.bind(t)}}function i(){return(0,r.Om)()}function l(){return(0,r.sO)()}function s(e){return(0,o.qo)("string"==typeof e?e:e.name)}var d=n("455069");function u(){return(0,d.useRef)()}},489350:function(e,t,n){n.d(t,{$0:function(){return a.$0},Dq:function(){return o.Dq},F2:function(){return a.F2},F3:function(){return a.F3},HF:function(){return a.HF},HS:function(){return a.HS},IK:function(){return o.IK},KV:function(){return i.KV},Ph:function(){return a.Ph},Q2:function(){return r.Q},Q4:function(){return a.Q4},RW:function(){return i.RW},TR:function(){return a.TR},U$:function(){return o.U$},UP:function(){return i.UP},__:function(){return a.__},az:function(){return a.az},cI:function(){return o.cI},cm:function(){return a.cm},gN:function(){return a.gN},l0:function(){return a.l0},lw:function(){return r.l},mg:function(){return i.mg},nW:function(){return o.nW},nk:function(){return i.nk},oD:function(){return a.oD},qo:function(){return o.qo},tz:function(){return a.tz},y1:function(){return a.y1}});var o=n(175491),r=n(692724),a=n(866471),i=n(801093)},184449:function(e,t,n){n.d(t,{xv:()=>p,IE:()=>V,aQ:()=>a.a,hZ:()=>ev,zM:()=>d,M_:()=>A.M,j1:()=>o.j,oO:()=>J.o,zr:()=>O,oS:()=>D.o,xs:()=>H,EK:()=>z.E,M9:()=>F,XD:()=>U,LK:()=>Y,bV:()=>X,$:()=>L,Z3:()=>$,zz:()=>r.z,HX:()=>u.H,ui:()=>eo,XW:()=>c.X,X6:()=>z.X,d1:()=>j,$v:()=>Z.$,IW:()=>v,Zp:()=>G,TA:()=>N,nN:()=>g,tF:()=>m,s5:()=>en,u6:()=>P,C5:()=>em,jN:()=>er});var o=n("229342"),r=n("544133"),a=n("771879"),i=n("825955"),l=n("686436"),s=n("994983"),d=()=>{var e,t=(0,l.G2)(l.L4),n=(0,l.G2)(s.PR);return{getLatestWorkflowJson:(e=(0,i._)(function*(){return yield n.waitSaving(),t.toJSON()}),function(){return e.apply(this,arguments)})}},u=n("789927"),c=n("277133"),p=()=>(0,l.G2)(s.GH),v=()=>(0,l.G2)(s.Rq),m=()=>{var e,t=(0,l.G2)(l.oJ),n=(0,l.Dc)();return e=(0,i._)(function*(e){var o=!1,r=n.entityManager.getEntityById(e);return r&&(yield t.selectNodeAndScrollToView(r,!0),o=!0),o}),function(t){return e.apply(this,arguments)}},f=n("816697"),g=()=>{var e,t=(0,c.X)(),n=(0,l.Dc)(),o=(0,l.G2)(l.z2);return e=(0,i._)(function*(e,r){var a=t.getLine(e,r),i=!1;if(a){var l=f.Ae.enlarge([a.bounds]).pad(30,30),s=n.config.getViewport(!1),d=f.rM.fixSize(l,s);o.selection=[a],yield n.config.scrollToView({bounds:l,zoom:d,scrollToCenter:!0,easing:!0}),i=!0}return i}),function(t,n){return e.apply(this,arguments)}},h=n("455069"),_=n("450562"),y=n("808549"),x=n("120454"),w=n("997516"),b=e=>(0,w.Z)(e,"expanded","node"),j=()=>{var e=(0,l.PF)().getData(l.Lz),[t,n]=(0,h.useState)(b(e));return(0,h.useEffect)(()=>{var t=e.onDataChange(e=>{n(b(e))});return()=>{null==t||t.dispose()}},[]),(0,x._)((0,y._)({},t),{expanded:!0,toggleNodeExpand:e.toggleExpand.bind(e)})},k=n("943194"),N=()=>{var e=(0,l.G2)(l.qp),t=(0,l.G2)(k.O);return{start:()=>{e.start(),t.disabled=!1},stop:()=>{e.stop(),t.disabled=!0}}},S=n("617039"),C=n("614904"),I=n("1334"),T=()=>{var e=(0,_.rsR)();return((null==e?void 0:e.inputParameters)||[]).map(e=>{var t,n;return(0,x._)((0,y._)({},e),{keyPath:[...(null===(n=e.input)||void 0===n?void 0:null===(t=n.content)||void 0===t?void 0:t.keyPath)||[]]})})},P=e=>{var{needNullName:t=!0,needNullType:n=!1}=null!=e?e:{},o=(0,I.X_)(),r=T(),a=C.qz.findAvailableVariables({variables:o,inputs:r}).map((e,t)=>{var n;return{name:e.name,id:r[t].id,type:null===(n=e.variable)||void 0===n?void 0:n.type,index:t}}),[i,l]=(0,h.useState)();return(0,S.Z)(()=>{l(a.filter(e=>(!!t||!!e.name)&&(!!n||!!e.type)))},[a.map(e=>"".concat(e.name).concat(e.type)).join(""),t,n],{wait:300}),i},D=n("928633"),E=n("468392"),O=()=>(0,l.G2)(E.N),L=e=>O().store(e);n("206616");var M=n("471583");function F(){return(0,l.G2)(M.b)}var Z=n("369815"),R=n("497744"),V=()=>(0,l.bP)(R.JM,!0),A=n("482023");n("794211");var z=n("181907"),B=n("189914"),U=()=>{var e=(0,z.X)();return{open:(0,h.useCallback)(t=>{e.open(B.Gd.TraceList,"bottom",t)},[e])}};n("88304");var q=n("307765"),W=n("172722"),G=()=>(0,l.G2)(W.i),H=()=>(0,l.bP)(R.sv,!0),$=e=>{var t,{ids:n}=e,[r,a]=(0,h.useState)([]),[l,s]=(0,h.useState)(!1),{spaceId:d,sharedDataSetStore:u}=(0,o.j)(),c=G(),p=(0,h.useRef)(null);var v=(0,h.useCallback)((t=(0,i._)(function*(e){try{var t=yield u.getDataSetInfosByIds(e,d);a(t)}catch(e){console.error(e)}finally{s(!0)}}),function(e){return t.apply(this,arguments)}),[d]);return(0,h.useEffect)(()=>(v(n),!p.current&&(p.current=c.onDependencyChange(e=>{(null==e?void 0:e.bizType)===q.z.Dataset&&v(n)})),()=>{var e,t;null==p||null===(t=p.current)||void 0===t||null===(e=t.dispose)||void 0===e||e.call(t),p.current=null}),[n.join("")]),{dataSets:r,isReady:l,cacheDataSetInfo:u.addDataSetInfo}},J=n("462124"),Y=()=>(0,l.G2)(s.PR),Q=n("357331");function X(){return(0,l.G2)(Q.O)}var K=e=>X().store(e);n("463371");var ee=n("664319"),et=n("602876");function en(){var e,t,n,{data:o}=(0,_.rsR)(),r=null!==(n=null==o?void 0:o.databaseInfoList)&&void 0!==n?n:null==o?void 0:null===(e=o.inputs)||void 0===e?void 0:e.databaseInfoList;return null==r?void 0:null===(t=r[0])||void 0===t?void 0:t.databaseInfoID}function eo(){var e=en(),{data:t,isLoading:n,error:o}=function(e){var{getDatabaseDetail:t,isLoading:n,getError:o}=K((0,ee.N)(e=>({getDatabaseDetail:e.getData,isLoading:e.loading,getError:e.getError}))),r=t(e);return{data:function(e){var t;if(!!e)return{id:e.id,fields:null===(t=e.field_list)||void 0===t?void 0:t.map(e=>({id:e.alterId,name:e.name,type:function(e){var t={[et.wp.Text]:_.owu.String,[et.wp.Number]:_.owu.Integer,[et.wp.Float]:_.owu.Number,[et.wp.Boolean]:_.owu.Boolean,[et.wp.Date]:_.owu.Time};if(!!e)return t[e]||void 0}(e.type),required:e.must_required,description:e.desc,isSystemField:!!e.name&&["id","uuid","bstudio_create_time"].includes(e.name)})),iconUrl:e.icon_url,tableName:e.table_name}}(null==r?void 0:r.database_info),isLoading:n,error:o(e)}}(e),r=(0,h.useRef)(null),a=X(),i=G();return(0,h.useEffect)(()=>(a.load(e),!r.current&&(r.current=i.onDependencyChange(t=>{(null==t?void 0:t.bizType)===q.z.Database&&a.load(e)})),()=>{var e,t;null==r||null===(t=r.current)||void 0===t||null===(e=t.dispose)||void 0===e||e.call(t),r.current=null}),[e]),{data:t,isLoading:n,error:o}}var er=()=>(0,l.G2)(s.mh),ea=n("183794"),ei=n("206058"),el=n("356873"),es=n("847167"),ed=n("945941"),eu=n("616357"),ec=n("612735"),ep=e=>{var t;return(0,es.$2)({getGlobalState:e=>e.get(l.v2).getEntity(R.eI),getNodeTemplate:e=>t=>e.get(ed.j).getNodeTemplateInfoByType(t),onEncapsulate:(t=(0,i._)(function*(t,n){if(!!t.success)if(t.projectId){var o,r;yield null==e?void 0:null===(o=e.refetchProjectResourceList)||void 0===o?void 0:o.call(e),yield null==e?void 0:null===(r=e.renameProjectResource)||void 0===r?void 0:r.call(e,t.workflowId)}else{var a=n.get(s.mh);a.updateRelatedBot(a.getRelatedBotValue(),t.workflowId)}}),function(e,n){return t.apply(this,arguments)})})},ev=e=>(0,h.useCallback)(()=>[(0,l.J2)({renderInsideLine:ec.j}),...(0,ea.E)(),(0,l.ou)({enable:!0,limit:50}),(0,el.h)({}),(0,l.qP)({disableLayer:!0,canvasStyle:{canvasWidth:182,canvasHeight:102,canvasPadding:50,canvasBackground:"rgba(245, 245, 245, 1)",canvasBorderRadius:10,viewportBackground:"rgba(235, 235, 235, 1)",viewportBorderRadius:4,viewportBorderColor:"rgba(201, 201, 201, 1)",viewportBorderWidth:1,viewportBorderDashLength:2,nodeColor:"rgba(255, 255, 255, 1)",nodeBorderRadius:2,nodeBorderWidth:.145,nodeBorderColor:"rgba(6, 7, 9, 0.10)",overlayColor:"rgba(255, 255, 255, 0)"},inactiveDebounceTime:1}),(0,l.Zv)({edgeColor:"#00B2B2",alignColor:"#00B2B2",edgeLineWidth:1,alignLineWidth:1,alignCrossWidth:8}),(0,l.dn)({renderer:eu.K}),(0,l.NS)({}),(0,l.AU)({}),(0,ei.Gt)({}),ep(e)],[]),em=()=>{var e,t=(0,l.G2)(s.we),n=G(),[o,r]=(0,h.useState)(null!==(e=null==t?void 0:t.getModels())&&void 0!==e?e:[]);return(0,h.useEffect)(()=>{var e=n.onDependencyChange(e=>{if(W.r[null==e?void 0:e.bizType]===B.Uv.LLM){var n;r(null!==(n=null==t?void 0:t.getModels())&&void 0!==n?n:[])}});return()=>{var t;null==e||null===(t=e.dispose)||void 0===t||t.call(e)}},[]),{models:o}}},462124:function(e,t,n){n.d(t,{o:()=>a});var o=n("686436"),r=n("994983"),a=()=>(0,o.G2)(r.m3)},522776:function(e,t,n){n.d(t,{k:function(){return i},n:function(){return l}});var o=n(851954),r=n.n(o),a=n(450562),i=(e,t)=>{var{name:n,plugin_name:o,api_id:r,plugin_id:i,desc:l,version_ts:s,plugin_from:d}=e||{},u={data:{nodeMeta:{title:n,icon:t,subtitle:"".concat(o,":").concat(n),description:l},inputs:{apiParam:[a.ycG.create("apiID",r),a.ycG.create("apiName",n),a.ycG.create("pluginID",i),a.ycG.create("pluginName",o),a.ycG.create("pluginVersion",s||""),a.ycG.create("tips",""),a.ycG.create("outDocLink","")]}}};return u.data.inputs.pluginFrom=d,u},l=e=>{var{workflowItem:t,spaceId:n,templateIcon:o,isImageflow:a}=e,{name:i,workflow_id:l,desc:s,version_name:d}=t||{};return{data:{nodeMeta:{title:i,description:s,icon:o,isImageflow:a},inputs:{workflowId:l,spaceId:n,workflowVersion:r().valid(d)?d:""}}}}},848759:function(e,t,n){n.d(t,{U:function(){return b},z:function(){return j}});var o,r=n(825955),a=n(151064),i=n(455069),l=n(686436),s=n(360903),d=n(614904),u=n(450562),c=n(336205),p=n(674343),v=n(287411),m=n(317612),f=n(945941),g=n(994983),h=n(771879),_=n(229342),y=n(184449),x=n(522776),{Text:w}=p.ZT;var b=((o={}).NodeAdded="node-added",o.Cancel="cancel",o.OpenNewTab="new-tab",o),j=e=>{var t,n,o,b=(0,h.a)(),j=(0,_.j)(),k=(0,l.G2)(f.j),N=(0,y.oO)(),S=j.getProjectApi(),C=(0,i.useRef)(),I=(0,i.useRef)(),T=(0,i.useRef)(),P=(0,l.G2)(g.Re),D=(0,l.G2)(s.t),E=(0,d.ds)(),O=t=>{var n;return n=(0,r._)(function*(n,o){if(!n||!(yield N.addSubWorkflowCheck(n.workflow_id,n.version_name)))return!1;var r,i,{name:l}=n,s=null===(i=k.getTemplateList([t?u.nyy.Imageflow:u.nyy.SubWorkflow]))||void 0===i?void 0:null===(r=i[0])||void 0===r?void 0:r.icon_url,d=(0,x.n)({workflowItem:n,spaceId:b,templateIcon:s,isImageflow:t}),v={clientX:e.current.x,clientY:e.current.y},{isDrag:m}=e.current;C.current?C.current({nodeType:u.nyy.SubWorkflow,nodeJSON:d}):P.addNode(u.nyy.SubWorkflow,d,v,m),p.FN.success({content:(0,a.jsxs)(p.T,{spacing:6,children:[(0,a.jsx)(w,{children:t?c.o.t("workflow_add_imageflow_toast_success",{name:l}):c.o.t("wf_node_add_wf_modal_toast_wf_added",{workflowName:l})}),o.isDup?(0,a.jsx)(p.zx,{color:"primary",onClick:()=>{window.open("/work_flow?space_id=".concat(b,"&workflow_id=").concat(n.workflow_id))},children:c.o.t("workflowstore_continue_editing")}):null]})})}),function(e,t){return n.apply(this,arguments)}},L=O(!1),M=O(!0),F=()=>{var e;null===(e=I.current)||void 0===e||e.call(I,T.current),T.current=void 0},Z=j.projectId?d.wL.ProjectWorkflowAddNode:d.wL.WorkflowAddNode,{node:R,open:V,close:A}=(0,d.Zv)({from:Z,flowMode:u.wz8.Workflow,onAdd:L,bindBizId:null===(n=j.config)||void 0===n?void 0:n.bindBizID,bindBizType:null===(o=j.config)||void 0===o?void 0:o.bindBizType,excludedWorkflowIds:[j.workflowId],projectId:j.projectId,onDupSuccess:()=>null,onClose:F,onCreateSuccess:e=>{if(T.current="new-tab",A(),Z===d.wL.ProjectWorkflowAddNode){var t,n;null===(t=(n=j.playgroundProps).refetchProjectResourceList)||void 0===t||t.call(n)}E({workflowId:e.workflowId,spaceId:e.spaceId,projectId:j.projectId,ideNavigate:null==S?void 0:S.navigate})},onItemClick:(e,t)=>{var n,{item:o}=e;return(0,d.Do)(t)?(T.current="new-tab",A(),null==S||null===(n=S.navigate)||void 0===n||n.call(S,"/workflow/".concat(o.workflow_id)),{handled:!0}):{handled:!1}}}),{node:z,open:B,close:U}=(0,d.Zv)({from:d.wL.WorkflowAddNode,flowMode:u.wz8.Imageflow,onAdd:M,excludedWorkflowIds:[j.workflowId],onDupSuccess:()=>null,onClose:F}),q=j.projectId?v.tx.ProjectWorkflow:v.tx.WorkflowAddNode;var{node:W,open:G,close:H}=(0,m.q)({from:q,projectId:j.projectId,closeCallback:F,clickProjectPluginCallback:e=>{T.current="new-tab",H(),null==S||S.navigate("/plugin/".concat(null==e?void 0:e.id))},openModeCallback:(t=(0,r._)(function*(t){if(!t||!(yield N.addApiCheck(t.plugin_id,t.version_ts)))return!1;var n,o=null===(n=k.getNodeTemplateInfoByType(u.nyy.Api))||void 0===n?void 0:n.icon,r=(0,x.k)(t,o),a={clientX:e.current.x,clientY:e.current.y},{isDrag:i}=e.current;C.current?C.current({nodeType:u.nyy.Api,nodeJSON:r}):P.addNode(u.nyy.Api,r,a,i),p.FN.success(c.o.t("bot_edit_tool_added_toast",{api_name:null==t?void 0:t.name}))}),function(e){return t.apply(this,arguments)}),onCreateSuccess:q===v.tx.ProjectWorkflow?e=>{if(T.current="new-tab",H(),(null==e?void 0:e.pluginId)&&q===v.tx.ProjectWorkflow){var t,n;null===(t=(n=j.playgroundProps).refetchProjectResourceList)||void 0===t||t.call(n),null==S||S.navigate("/plugin/".concat(e.pluginId))}}:void 0}),$=function(e,t){return function(){var{onAdd:n,closeOnAdd:o,onClose:r,modalProps:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n?C.current=function(){for(var e,r,a,i=arguments.length,l=Array(i),s=0;s<i;s++)l[s]=arguments[s];var d=null==l?void 0:null===(e=l[0])||void 0===e?void 0:e.nodeJSON;(null==d?void 0:null===(a=d.data)||void 0===a?void 0:null===(r=a.nodeMeta)||void 0===r?void 0:r.title)&&(d.data.nodeMeta.title=D.createUniqTitle(d.data.nodeMeta.title)),T.current="node-added",null==n||n(...l),o&&(null==t||t())}:C.current=void 0,I.current=r,null==e||e(a)}};return{workflowModal:R,openWorkflow:$(V,A),imageFlowModal:z,openImageflow:$(B,U),pluginModal:W,openPlugin:$(G,H)}}},794211:function(e,t,n){n.d(t,{g:function(){return p}});var o=n(825955),r=n(455069),a=n(671261),i=n(686436),l=n(450562),s=n(327703),d=n(994983),u=n(184449),c=n(848759),p=()=>{var e,t,n=(0,r.useRef)({x:0,y:0,isDrag:!1}),{openPlugin:p,openWorkflow:v,openImageflow:m,pluginModal:f,workflowModal:g,imageFlowModal:h}=(0,c.z)(n),_=(0,i.G2)(d.Re),y=(0,u.oO)(),{spaceId:x}=(0,u.j1)();var w=(e=(0,o._)(function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0},o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{nodeType:r,nodeJson:i,nodeVersionInfo:l}=e;if(i){var{workflowId:d,pluginId:u}=l,c=yield(0,s.ZJ)({spaceId:x,pluginId:u});if(c&&(0,a.Z)(i,"data.inputs.workflowVersion",c),!(yield y.addSubWorkflowCheck(d,c)))return;_.addNode(r,i,{clientX:(null==t?void 0:t.x)||0,clientY:(null==t?void 0:t.y)||0},o);return}n.current={x:t.x,y:t.y,isDrag:o},v()}),function(t){return e.apply(this,arguments)});var b=(t=(0,o._)(function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0},o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{nodeType:r,nodeJson:a,modalProps:i,nodeVersionInfo:l}=e;if(a){var{pluginId:s,version:d}=l;if(!(yield y.addApiCheck(s,d)))return;_.addNode(r,a,{clientX:(null==t?void 0:t.x)||0,clientY:(null==t?void 0:t.y)||0},o);return}n.current={x:t.x,y:t.y,isDrag:o},p({modalProps:i})}),function(e){return t.apply(this,arguments)});return{handleAddNode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{nodeType:o}=e;return o===l.nyy.Api?b(e,t,n):o===l.nyy.SubWorkflow?w(e,t,n):void _.addNode(e.nodeType,e.nodeJson,{clientX:(null==t?void 0:t.x)||0,clientY:(null==t?void 0:t.y)||0},n)},openPlugin:p,openWorkflow:v,openImageflow:m,updateAddNodePosition:e=>{n.current=e},modals:[g,f,h]}}},680634:function(e,t,n){n.d(t,{V:function(){return p}});var o=n(825955),r=n(151064),a=n(598208),i=n(336205),l=n(775699),s=n(44172),d=n(864431),u=n(700834),c=(0,a.Ue)(e=>({uniqueId:null,setUniqueId:t=>e({uniqueId:t}),isBizIDEOpen:!1,setIsBizIDEOpen:t=>e({isBizIDEOpen:t}),isBizIDETesting:!1,setIsBizIDETesting:t=>e({isBizIDETesting:t}),setData:t=>e(t)})),p=()=>{var e,t,n,{uniqueId:a,isBizIDEOpen:p,isBizIDETesting:v,setUniqueId:m,setIsBizIDEOpen:f,setIsBizIDETesting:g,setData:h}=c(e=>e),{handleOpen:_,handleClose:y,visible:x,forceClose:w}=(0,d.mx)(a||"");var b=(e=(0,o._)(function*(e){(yield _(e))&&(m(e),f(!0))}),function(t){return e.apply(this,arguments)});var j=(t=(0,o._)(function*(){var e=yield y();return e&&h({uniqueId:null,isBizIDEOpen:!1,isBizIDETesting:!1}),e}),function(){return t.apply(this,arguments)});var k=(n=(0,o._)(function*(e){return!!e&&e!==a||!p||!v||new Promise(e=>{l.u_.warning({icon:(0,r.jsx)(s.O5N,{className:u.Z.warningIcon,style:{width:22,height:22}}),title:i.o.t("workflow_detail_code_is_running"),content:i.o.t("workflow_detail_code_is_terminate_execution"),okType:"warning",okText:i.o.t("Confirm"),cancelText:i.o.t("Cancel"),onOk:()=>{h({uniqueId:null,isBizIDEOpen:!1,isBizIDETesting:!1}),e(!0)},onCancel:()=>{e(!1)}})})}),function(e){return n.apply(this,arguments)});return{uniqueId:a,isBizIDEOpen:p,isBizIDETesting:v,setBizIDEUniqueId:m,setIsBizIDEOpen:f,setIsBizIDETesting:g,closeBizIDE:j,openBizIDE:b,forceCloseBizIDE:()=>{x&&w(),h({uniqueId:null,isBizIDEOpen:!1,isBizIDETesting:!1})},closeConfirm:k}}},980483:function(e,t,n){n.d(t,{bY:function(){return a},dd:function(){return i},uU:function(){return l}});var o,r=n(455069);var a=((o={}).Light="light",o.Dark="dark",o),i=(0,r.createContext)({editorTheme:"light",setEditorTheme:e=>{console.log(e)},isDarkTheme:!1}),l=()=>(0,r.useContext)(i)},544133:function(e,t,n){n.d(t,{z:function(){return a}});var o=n(686436),r=n(407909),a=()=>(0,o.X2)(r.q)},181907:function(e,t,n){n.d(t,{E:function(){return l},X:function(){return i}});var o=n(455069),r=n(686436),a=n(968992),i=()=>(0,r.G2)(a.n),l=()=>{var e=i(),[t,n]=(0,o.useState)(e.size);return(0,o.useEffect)(()=>{var t=e.onSizeChange(n);return()=>t.dispose()},[e,n]),t}},114648:function(e,t,n){n.d(t,{A:function(){return m},t:function(){return v}});var o=n(591806),r=n(643095),a=n(672496),i=n(902272),l=n(674343),s=n(382534),d=n(229342),u=n(928633),c=(0,o.Z)((0,r.Z)(()=>l.FN.warning("当前工作流未关联场景"),1e4)),p=()=>{var e=(0,d.j)(),{isSceneFlow:t}=(0,u.o)(),{bindBizID:n}=e;return t&&!n&&c(),(0,a.a)({queryKey:["scene_flow_role_list"],staleTime:1e4,queryFn:()=>s.fc.GetMetaRoleList({meta_id:n}),placeholderData:{role_list:[]},enabled:t&&!!n})},v=()=>{var{data:e,isLoading:t}=p();return{isLoading:t,data:null==e?void 0:e.role_list.map(e=>({biz_role_id:e.biz_role_id,role:e.name,nickname:e.nickname,role_type:e.role_type,description:e.description}))}},m=()=>{var{data:e,isLoading:t}=p();if(t)return null;var n,o=null==e?void 0:null===(n=e.role_list)||void 0===n?void 0:n.find(e=>e.role_type===i.GD.Host);return{name:null==o?void 0:o.name,participantId:null==o?void 0:o.participant_id}}},928633:function(e,t,n){n.d(t,{o:function(){return i}});var o=n(686436),r=n(408487),a=n(973922),i=()=>{var e=(0,o.X2)(a.e),t=e.flowMode===r.wz8.Imageflow,n=e.flowMode===r.wz8.SceneFlow;return{isImageFlow:t,isSceneFlow:n,isChatflow:e.flowMode===r.wz8.ChatFlow}}},229342:function(e,t,n){n.d(t,{j:function(){return a}});var o=n(686436),r=n(497744),a=function(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return(0,o.bP)(r.eI,e)}},277133:function(e,t,n){n.d(t,{X:function(){return a}});var o=n(686436),r=n(734658),a=()=>(0,o.G2)(r.O)},369815:function(e,t,n){n.d(t,{$:function(){return a}});var o=n(455069),r=n(374499);function a(){var e=(0,o.useContext)(r.u);return{isNewNodeRender:"new-node-render"===e,isOldNodeRender:"old-node-render"===e,isNodeSideSheet:"node-side-sheet"===e}}},340291:function(e,t,n){n.d(t,{Tk:function(){return i},U0:function(){return a},j0:function(){return r}});var o=n(455069),r=(0,n(598208).Ue)(e=>({isNodeSideSheetVisible:!1,leftPanelVisible:!1,mainPanelWidth:360,setMainPanelWidth:t=>e({mainPanelWidth:t}),openNodeSideSheet:t=>e(e=>({isNodeSideSheetVisible:!0,width:(null==t?void 0:t.width)||e.mainPanelWidth})),closeNodeSideSheet:()=>{e({isNodeSideSheetVisible:!1,leftPanelVisible:!1,leftPanelContent:void 0,rightPanelVisible:!1,rightPanelContent:void 0})},openLeftPanel:t=>e({leftPanelVisible:!0,leftPanelContent:t.content,leftPanelContentId:t.contentId}),updateLeftPanel:t=>e({leftPanelContent:t.content}),closeLeftPanel:()=>e({leftPanelVisible:!1,leftPanelContent:void 0,leftPanelContentId:""}),rightPanelWidth:360,openRightPanel:t=>e({rightPanelVisible:!0,rightPanelContent:t.content}),closeRightPanel:()=>e({rightPanelVisible:!1,rightPanelContent:void 0}),closeAllExtraSheets:()=>{e({leftPanelVisible:!1,leftPanelContent:void 0,rightPanelVisible:!1,rightPanelContent:void 0})}})),a=(0,o.createContext)({}),i=()=>(0,o.useContext)(a)},561232:function(e,t,n){n.d(t,{LM:()=>w,HQ:()=>x,IL:()=>p});var o=n("455069"),r=n("962289"),a=n("686436"),i=n("471583"),l=n("68331"),s=n("450562"),d=n("1334"),u=n("693539"),c=n("336383"),p=e=>{var{disabledTypes:t,value:n,onChange:p,node:v,feedbackStatus:m}=e,f=(0,d.X_)(),g=(0,a.G2)(i.b),h=(0,c.yU)(f,t||[]),_=(0,r.Z)(n,"content.keyPath");return(0,o.useEffect)(()=>{var e=Array.isArray(t)&&t.length>0;if(!!_&&!!e){var n=g.onListenVariableTypeChange(_,e=>{e&&(t||[]).includes(e.type)&&p({type:s.YX3.REF})},{node:v});return()=>{null==n||n.dispose()}}},[_,t]),(0,l.S)({keyPath:_,onTypeChange:e=>{var{variableMeta:n}=e;if(!!(Array.isArray(t)&&t.length>0))n&&(t||[]).includes(n.type)&&p({type:s.YX3.REF})}}),{variablesDataSource:h,validateStatus:(0,u.m)(m)}},v=n("151064"),m=n("252237"),f=n.n(m),g=n("915757"),h=n("674343"),_=n("591273"),y=n("724375"),x=e=>{var{value:t,onChange:n,onBlur:r,disabled:a,variablesDataSource:i,validateStatus:l,readonly:d,invalidContent:u,renderDisplayVarName:c,testId:p,disabledTypes:m,showClear:x=!1,customFilterVar:w,setFocused:b,style:j,refTagColor:k,hideDeleteIcon:N,variableTagStyle:S,optionFilter:C,renderExtraOption:I,enableSelectNode:T,popoverStyle:P,handleDataSource:D,variableTypeConstraints:E}=e,O=(0,o.useCallback)(e=>{void 0===e?n(void 0):n({type:s.YX3.REF,content:{keyPath:e}})},[n]),L=()=>{null==n||n(void 0),null==r||r()},[M,F]=(0,o.useState)(!1),Z=(0,o.useCallback)(e=>{F(e),null==b||b(e)},[b]),R=e=>{var n;return d&&e?e:(0,v.jsx)(y.W,{testId:p,disabled:a,disabledTypes:m,dataSource:i,value:t&&s.nZF.isRef(t)?null===(n=t.content)||void 0===n?void 0:n.keyPath:void 0,onChange:O,onBlur:r,validateStatus:l,readonly:d,showClear:x,customFilterVar:w,onPopoverVisibleChange:Z,trigger:e,style:j,invalidContent:u,renderDisplayVarName:c,optionFilter:C,renderExtraOption:I,enableSelectNode:T,popoverStyle:P,handleDataSource:D})},V=e=>(null==e?void 0:e.needWrapper)?(0,v.jsxs)("div",{className:f()("w-full max-w-[100%] h-[24px] pr-[4px]","flex flex-row items-center justify-between","bg-transparent hover:bg-background-5 active:bg-background-6","rounded-lg border border-solid coz-stroke-plus hover:coz-mg-secondary-hovered active:coz-mg-secondary-pressed",{"semi-input-wrapper-error":"error"===l,"coz-stroke-primary":"error"!==l,"!coz-stroke-hglt":M,"pointer-events-none":d}),children:[V(),(0,v.jsx)("div",{children:R((0,v.jsx)(h.hU,{size:"mini",color:"secondary",icon:(0,v.jsx)(g.nwG,{className:"text-[16px]"})}))})]}):R((0,v.jsx)("div",{className:f()("cursor-pointer w-full overflow-hidden flex items-center pl-0.5"),children:(0,v.jsx)(_.q,{value:t,onClose:L,tagColor:k,closable:!N,style:S,variableTypeConstraints:E,readonly:d})}));return{renderVariableSelect:R,renderVariableDisplay:V}},w=e=>{var{node:t,feedbackStatus:n,value:o,onChange:r,onBlur:a,disabled:i,readonly:l,testId:s,disabledTypes:d,showClear:u=!1,customFilterVar:c,setFocused:v,style:m,invalidContent:f,renderDisplayVarName:g}=e,{variablesDataSource:h,validateStatus:_}=p({disabledTypes:d,value:o,onChange:r,node:t,feedbackStatus:n}),{renderVariableSelect:y,renderVariableDisplay:w}=x({value:o,onChange:r,onBlur:a,disabled:i,variablesDataSource:h,validateStatus:_,readonly:l,testId:s,disabledTypes:d,invalidContent:f,renderDisplayVarName:g,showClear:u,customFilterVar:c,setFocused:v,style:m});return{renderVariableSelect:y,renderVariableDisplay:w}}},822229:function(e,t,n){n.d(t,{n:function(){return i}});var o=n(479910),r=n(598208),a="workflow-resizable-side-panel",i=(0,r.Ue)()((0,o.mW)((0,o.tJ)(e=>({width:0,setWidth:t=>e({width:t})}),{name:a}),{enabled:!1,name:a}))},771879:function(e,t,n){n.d(t,{a:function(){return r}});var o=n(229342),r=()=>(0,o.j)().spaceId},338626:function(e,t,n){n.d(t,{O:function(){return a}});var o=n(686436),r=n(497744),a=()=>(0,o.bP)(r.MA,!0)},88304:function(e,t,n){n.d(t,{Q:function(){return u}});var o=n(825955),r=n(455069),a=n(686436),i=n(113051),l=n(994983),s=n(990359),d=n(544133),u=e=>{var{callbacks:t={}}=e||{},{onBeforeTestRun:n,onTestRunStart:u,onTestRunEnd:c,onTestRunFailed:p,onTestRunCanceled:v,onTestRunSucceed:m}=t,f=(0,a.G2)(l.GH),{config:{executeId:g,isSingleMode:h}}=(0,d.z)(),_=(0,r.useRef)(h);_.current=h;var{onTestRunStateChange:y,testRunState:x}=f,{testRunFlow:w}=(0,s.s)(),b={handleTestRun:(0,o._)(function*(){null==n||n(),yield w()}),cancelTestRun:f.cancelTestRun,pauseTestRun:()=>f.pauseTestRun(),continueTestRun:()=>f.continueTestRun(),getTestRunHistory:e=>f.getProcessResult(e),isExecuting:x===i.x.Executing,isSucceed:x===i.x.Succeed,isFailed:x===i.x.Failed,isCanceled:x===i.x.Canceled,isPaused:x===i.x.Paused,isEnd:[i.x.Succeed,i.x.Failed,i.x.Canceled].includes(x)};return(0,r.useEffect)(()=>{var e=y(e=>{var{prevState:t,curState:n}=e;if([i.x.Succeed,i.x.Failed,i.x.Canceled].includes(n))switch(null==c||c(n,g),n){case i.x.Failed:null==p||p(g);break;case i.x.Succeed:null==m||m(g);break;case i.x.Canceled:null==v||v(g)}t===i.x.Idle&&n===i.x.Executing&&(null==u||u(g,_.current))});return()=>e.dispose()},[t,g]),b}},482023:function(e,t,n){n.d(t,{M:function(){return a}});var o=n(686436),r=n(277133),a=e=>{var t=(0,o.PF)(),n=(0,r.X)();return(r,a)=>{if(r!==a){for(var i=r<a?1:-1,l=r;l!==a;l+=i){var s={from:t.id,fromPort:e(l)},d={from:t.id,fromPort:e(l+i)};n.replaceLineByPort(s,d)}t.getData(o.QW).updateDynamicPorts()}}}},740106:function(e,t,n){n.d(t,{Tb:function(){return a},XF:function(){return o},n0:function(){return r}});var o=["jpg","jpeg","png","webp","svg"],r=5242880,a=524288e3},206616:function(e,t,n){n.d(t,{XF:()=>m.XF,td:()=>g.td,Df:()=>g.Df,Vn:()=>f,w_:()=>v,mD:()=>g.mD});var o,r=n("825955"),a=n("455069"),i=n("801815"),l=n("408487"),s=n("336205"),d=n("298203"),u=n("727914"),c=n("674343"),p=n("766009");var v=((o={}).Success="success",o.UploadFail="uploadFail",o.ValidateFail="validateFail",o.Validating="validating",o.Uploading="uploading",o.Wait="wait",o),m=n("740106"),f=e=>{var t,n,o,{initialValue:f=[],customValidate:g,timeout:h,fileType:_,multiple:y=!0,maxSize:x,accept:w,maxFileCount:b=20}=e||{},[j,k]=(0,a.useState)(f),N=j.some(e=>e.status===v.Uploading),S=(e,t)=>{k(n=>{var o=[...n],r=o.findIndex(t=>t.uid===e);return -1!==r&&Object.keys(t).forEach(e=>{o[r][e]=t[e]}),o})};var C=(t=(0,r._)(function*(e){var t;try{var n,o=(n=(0,r._)(function*(){return yield(0,d.fr)({biz:"workflow",fileType:_,file:e,getProgress:t=>{S(e.uid,{percent:t})}})}),function(){return n.apply(this,arguments)});h&&(t=setTimeout(()=>{throw Error("Upload timed out")},h));var a=yield o();if(!a)throw new u.sH("normal_error","no uri");clearTimeout(t);var{url:i}=yield l.OHc.SignImageURL({uri:a},{__disableErrorToast:!0});if(!i)throw Error(s.o.t("imageflow_upload_error"));return S(e.uid,{url:i,status:v.Success}),i}catch(n){S(e.uid,{validateMessage:n.message||"upload failed",status:v.ValidateFail}),clearTimeout(t)}}),function(e){return t.apply(this,arguments)});var I=(n=(0,r._)(function*(e){var t=yield(0,p.G)(e,{customValidate:g,maxSize:(null!=x?x:"image"===_)?m.n0:m.Tb,accept:w});if(t)return t}),function(e){return n.apply(this,arguments)});var T=(o=(0,r._)(function*(e){e.status=v.Uploading,!e.uid&&(e.uid=(0,i.x0)());var t=yield I(e);if(t){c.FN.error(t);return}!y&&j[0]&&k([]);var n=!0;k(t=>t.length>=b?(c.FN.warning(s.o.t("plugin_file_max")),n=!1,t):[...t,e]),n&&(yield C(e))}),function(e){return o.apply(this,arguments)});return{fileList:j,upload:T,isUploading:N,deleteFile:e=>{var t=j.findIndex(t=>e===t.uid);-1!==t&&e&&k(e=>{var n=[...e];return n.splice(t,1),n})},setFileList:e=>k(e)}},g=n("694348")},433081:function(e,t,n){n.d(t,{t:function(){return o}});function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";var n=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,n)).toFixed(t))).concat(["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][n])}},694348:function(e,t,n){n.d(t,{Df:()=>i,td:()=>o.t,mD:()=>l});var o=n("433081");n("458620"),n("727914");var r=n("450562"),a={[r.owu.Image]:["image/*"],[r.owu.Doc]:[".docx",".doc",".pdf"],[r.owu.Audio]:[".mp3",".wav",".aac",".flac",".ogg",".wma",".alac",".mid",".midi",".ac3",".dsd"],[r.owu.Excel]:[".xls",".xlsx",".csv"],[r.owu.Video]:[".mp4",".avi",".mov",".wmv",".flv",".mkv"],[r.owu.Zip]:[".zip",".rar",".7z",".tar",".gz",".bz2"],[r.owu.Code]:[".py",".java",".c",".cpp",".js",".css"],[r.owu.Txt]:[".txt"],[r.owu.Ppt]:[".ppt",".pptx"],[r.owu.Svg]:[".svg"]},i=(e,t)=>{var n,o=r.owu.isArrayType(e)?r.owu.getArraySubType(e):e;return n=o===r.owu.File?(null==t?void 0:t.length)?t.map(e=>{var t;return null===(t=a[e])||void 0===t?void 0:t.join(",")}).join(","):Object.values(a).map(e=>e.join(",")).join(","):(a[o]||[]).join(",")};function l(e){if(!e)return"";var t=e.lastIndexOf(".");return e.slice(t+1).toLowerCase()}},766009:function(e,t,n){n.d(t,{G:()=>g});var o,r,a=n("824946"),i=n("825955"),l=n("336205"),s=n("433081"),d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0x1400000;if(t&&e>t)return l.o.t("imageflow_upload_exceed",{size:(0,s.t)(t)})},u=n("155440");function c(){return(c=(0,i._)(function*(e){var t=URL.createObjectURL(e);return new Promise((e,n)=>{var o=new window.Image;o.onload=()=>{e({width:o.naturalWidth,height:o.naturalHeight})},o.onerror=e=>{n(e)},o.src=t})})).apply(this,arguments)}var p=(o=(0,i._)(function*(e,t){var{maxWidth:n,minWidth:o,maxHeight:r,minHeight:a,aspectRatio:i}=t||{};if(!(0,u.Z)(n||o||r||a||i)){var{width:s,height:d}=yield function(e){return c.apply(this,arguments)}(e);return n&&s>n?l.o.t("imageflow_upload_error5",{value:"".concat(n,"px")}):o&&s<o?l.o.t("imageflow_upload_error3",{value:"".concat(o,"px")}):r&&d>r?l.o.t("imageflow_upload_error4",{value:"".concat(r,"px")}):a&&d<a?l.o.t("imageflow_upload_error2",{value:"".concat(a,"px")}):i&&s/d>i?l.o.t("imageflow_upload_error1"):void 0}}),function(e,t){return o.apply(this,arguments)}),v=n("175399"),m=n("694348"),f=(e,t)=>{if(!t)return;var n,o=t.split(","),r=(0,m.mD)(e),a=v.lookup(r);if(!(o.includes("image/*")&&(null==a?void 0:null===(n=a.startsWith)||void 0===n?void 0:n.call(a,"image/")))){if(!o.includes(".".concat(r)))return l.o.t("imageflow_upload_error_type",{type:"".concat(o.filter(Boolean).join("/"))})}};var g=(r=(0,i._)(function*(e,t){var{size:n,name:o}=e,{maxSize:r,imageSize:l,accept:s,customValidate:u}=t||{},c=[(0,i._)(function*(){return yield null==u?void 0:u(e)}),()=>d(n,r),(0,i._)(function*(){return yield p(e,l)}),()=>f(o,s)],v,m=!1,g=!1;try{for(var h,_=(0,a._)(c);m=!(h=yield _.next()).done;m=!1){var y=h.value,x=yield y();if(x)return x}}catch(e){g=!0,v=e}finally{try{m&&null!=_.return&&(yield _.return())}finally{if(g)throw v}}}),function(e,t){return r.apply(this,arguments)})},586421:function(e,t,n){n.d(t,{Q:function(){return p},z:function(){return v}});var o=n(825955),r=n(455069),a=n(311807),i=n(537845),l=n(686436),s=n(816697),d=n(172637),u=n(220192),c=n(184449),p=()=>{var e=(0,c.XW)(),t=(0,u.c2)(),n=(0,c.j1)(),a=(0,r.useCallback)((0,o._)(function*(){var{hasError:e,nodeErrorMap:o}=yield t.validateWorkflow();return e&&o&&t.setErrorsV2({[n.workflowId]:{workflowId:n.workflowId,errors:o}}),e}),[t,n]),i=(0,r.useCallback)((0,o._)(function*(){var{hasError:e,errors:n}=yield t.validateSchemaV2();return e&&t.setErrorsV2(n),e}),[t]);return{validate:(0,r.useCallback)((0,o._)(function*(){t.validating=!0;try{var n=yield a();if(n)return n;var o=yield i();return!n&&!o&&t.clearErrors(),e.validateAllLine(),o}finally{t.validating=!1}}),[a,i,t,e])}},v=()=>{var{isInIDE:e}=(0,c.j1)(),{validate:t}=p(),n=(0,l.G2)(l.L4),o=(0,i.Z)((0,a.Z)(t,2e3)),u=(0,l.G2)(d.f);(0,r.useEffect)(()=>{var t=new s.K4;t.push(u.onLoaded(()=>{!e&&o()}));var r=n.onContentChange(()=>{o()});return()=>{r.dispose(),t.dispose()}},[n,e])}},789927:function(e,t,n){n.d(t,{H:function(){return a}});var o=n(686436),r=n(994983),a=()=>(0,o.G2)(r.k_)},971183:function(e,t,n){n.d(t,{c:function(){return l}});var o=n(825955),r=n(672496),a=n(789927),i=n(229342),l=()=>{var e,{spaceId:t,workflowId:n}=(0,i.j)(),l=(0,a.H)();var s=(e=(0,o._)(function*(){return{workflowList:yield l.getReference()}}),function(){return e.apply(this,arguments)}),{data:d,refetch:u}=(0,r.a)({queryKey:["workflow_references",t,n],queryFn:s});return{references:d,refetchReferences:u}}},189400:function(e,t,n){n.d(t,{Pv:()=>i.Pv,GR:()=>a.GR,Lw:()=>o.L,cS:()=>r._}),n("497744"),n("973922");var o=n("985467");n("184449"),(0,n("598208").Ue)(e=>({visible:!0,setVisible:t=>e({visible:t})})),n("864431"),n("994983"),n("945941"),n("882617");var r=n("954206");n("81644");var a=n("960238"),i=n("490838")},711835:function(e,t,n){n.d(t,{T:()=>H,n:()=>Q});var o,r,a,i=n("736892"),l=n("450562"),s=n("825955"),d=n("336205"),u=n("686436"),c=n("370354"),p=n("151064"),v=n("676255"),m=n("167985"),f=n("638284"),g=n("962289"),h={width:360,height:139.86},_={width:h.width,height:3*h.width/5};var y=((o={}).ConcurrentSize="inputs.concurrentSize",o.BatchSize="inputs.batchSize",o.Inputs="inputs.inputParameters",o.Outputs="outputs",o),x=(0,f.e)({getNames:e=>{var t,{value:n,formValues:o}=e;return(null!==(t=(0,g.Z)(o,y.Inputs))&&void 0!==t?t:[]).map(e=>e.name).filter(Boolean)},invalidValues:{index:d.o.t("workflow_loop_name_no_index_wrong")}}),w=(0,f.e)({getNames:e=>{var t,{value:n,formValues:o}=e;return(null!==(t=(0,g.Z)(o,y.Outputs))&&void 0!==t?t:[]).map(e=>e.name).filter(Boolean)}}),b=(0,n("899450").vu)({required:!0}),j=n("253921"),k=n("288323"),N=n("164634"),S=n("776274"),C=n("489350"),I=(0,C.Q2)(e=>{var{title:t=d.o.t("workflow_maximum_parallel_runs"),tooltip:n=d.o.t("workflow_maximum_parallel_runs_tips"),testId:o}=e,{name:r,value:a,onChange:i,readonly:s}=(0,C.U$)(),{getNodeSetterId:u}=(0,l.FCD)();return(0,p.jsx)(S.x,{label:t,tooltip:n,layout:"vertical",style:{marginTop:12},labelStyle:{fontSize:12,fontWeight:600,color:"var(--coz-fg-secondary, rgba(6, 7, 9, 0.50))"},children:(0,p.jsx)(N.N,{value:a,onChange:i,testId:null!=o?o:u(r),disabledTypes:l.owu.getComplement([l.owu.Integer]),readonly:s,inputType:l.owu.Integer,literalConfig:{min:1,max:10},literalStyle:{width:"100%"}})})},{defaultValue:{type:l.YX3.LITERAL,content:10}}),T=n("101626"),P=e=>{var{name:t}=e;return(0,p.jsx)(T.nT,{name:null!=t?t:y.Inputs,title:d.o.t("workflow_batch_inputs"),tooltip:d.o.t("workflow_batch_inputs_tooltips"),defaultValue:[{name:"input"}],nthCannotDeleted:1,inputProps:{hideDeleteIcon:!0,disabledTypes:l.owu.getComplement(l.owu.getAllArrayType())}})},D=e=>{var{name:t=y.Outputs,title:n=d.o.t("workflow_batch_outputs"),tooltip:o=d.o.t("workflow_batch_outputs_tooltips")}=e;return(0,p.jsx)(T.JY,{name:t,title:n,tooltip:o,defaultValue:[{name:"output"}],nameProps:{initValidate:!0,suffix:"_list"}})},E=(0,C.Q2)(e=>{var{title:t=d.o.t("workflow_maximum_run_count"),tooltip:n=d.o.t("workflow_maximum_run_count_tips"),testId:o}=e,{name:r,value:a,onChange:i,readonly:s}=(0,C.U$)(),{getNodeSetterId:u}=(0,l.FCD)();return(0,p.jsx)(S.x,{label:t,tooltip:n,layout:"vertical",style:{marginTop:12},labelStyle:{fontSize:12,fontWeight:600,color:"var(--coz-fg-secondary, rgba(6, 7, 9, 0.50))"},children:(0,p.jsx)(N.N,{value:a,onChange:i,testId:null!=o?o:u(r),disabledTypes:l.owu.getComplement([l.owu.Integer]),readonly:s,inputType:l.owu.Integer,literalConfig:{min:1,max:200},literalStyle:{width:"100%"}})})},{defaultValue:{type:l.YX3.LITERAL,content:100}}),O=e=>{var{title:t=d.o.t("workflow_loop_title"),tooltip:n,testId:o,children:r}=e,{getNodeSetterId:a}=(0,l.FCD)();return(0,p.jsx)(C.$0,{title:t,tooltip:n,testId:a(null!=o?o:""),children:r})},L=()=>(0,p.jsxs)(k.X_,{children:[(0,p.jsxs)(j._,{children:[(0,p.jsxs)(O,{children:[(0,p.jsx)(I,{name:y.ConcurrentSize}),(0,p.jsx)(E,{name:y.BatchSize})]}),(0,p.jsx)(P,{name:y.Inputs})]}),(0,p.jsx)(D,{name:y.Outputs})]}),M=n("671261"),F=n("664278"),Z={render:()=>(0,p.jsx)(L,{}),validateTrigger:u.C$.onChange,validate:{nodeMeta:v.O,["".concat(y.Inputs,".*.name")]:x,["".concat(y.Inputs,".*.input")]:b,["".concat(y.Outputs,".*.name")]:w,["".concat(y.Outputs,".*.input")]:b},effect:{nodeMeta:m.Jr,inputs:m.iq,outputs:m.qf},formatOnInit:(e,t)=>{var n,o,r,a=null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.inputParameters,i=null==e?void 0:e.outputs,l=null==e?void 0:null===(o=e.inputs)||void 0===o?void 0:o.concurrentSize,s=null==e?void 0:null===(r=e.inputs)||void 0===r?void 0:r.batchSize;return(!Array.isArray(a)||(null==a?void 0:a.length)===0)&&(0,M.Z)(e,"inputs.inputParameters",[{name:"input"}]),i&&Array.isArray(i)&&i.map((e,n)=>{(0,M.Z)(i,n,F.N.inputValueToVO(e,t.playgroundContext.variableService))}),l&&(0,M.Z)(e,"inputs.concurrentSize",F.N.valueExpressionToVO(l,t.playgroundContext.variableService)),s&&(0,M.Z)(e,"inputs.batchSize",F.N.valueExpressionToVO(s,t.playgroundContext.variableService)),e},formatOnSubmit:(e,t)=>{var n,o,r=null==e?void 0:e.outputs,a=null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.concurrentSize,i=null==e?void 0:null===(o=e.inputs)||void 0===o?void 0:o.batchSize;return r&&Array.isArray(r)&&(r.map((e,n)=>{var o,a,i,l,s,d=F.N.inputValueToDTO(e,t.playgroundContext.variableService,{node:t.node});(null==e?void 0:null===(i=e.input)||void 0===i?void 0:null===(a=i.content)||void 0===a?void 0:null===(o=a.keyPath)||void 0===o?void 0:o[0])!==t.node.id&&(null==d?void 0:d.input)&&((0,M.Z)(d,"input.schema",{type:null===(l=d.input)||void 0===l?void 0:l.type,schema:null===(s=d.input)||void 0===s?void 0:s.schema}),(0,M.Z)(d,"input.type","list")),(0,M.Z)(r,n,d)}),(0,M.Z)(e,"outputs",r.filter(Boolean))),a&&(0,M.Z)(e,"inputs.concurrentSize",F.N.valueExpressionToDTO(a,t.playgroundContext.variableService,{node:t.node})),i&&(0,M.Z)(e,"inputs.batchSize",F.N.valueExpressionToDTO(i,t.playgroundContext.variableService,{node:t.node})),e}},R="BatchFunction_",V=e=>R+e,A=e=>e.replace(R,""),z=(e,t)=>({id:e,type:u.Sy.SUB_CANVAS,data:{},meta:{isContainer:!0,position:t,nodeDTOType:u.Sy.SUB_CANVAS,useDynamicPort:!0,renderKey:u.kD.SUB_CANVAS,size:{width:_.width,height:_.height},defaultPorts:[{type:"input",portID:"batch-function-input",disabled:!0},{type:"input",portID:"batch-function-inline-input"},{type:"output",portID:"batch-function-inline-output"}],padding:e=>({top:100,bottom:60,left:100,right:100}),selectable:(e,t)=>!t||!e.getData(u.eG).bounds.contains(t.x,t.y),renderSubCanvas:()=>({title:d.o.t("workflow_batch_canvas_title"),tooltip:d.o.t("workflow_batch_canvas_tooltips"),style:{minWidth:_.width,minHeight:_.height},renderPorts:[{id:"batch-function-input",type:"input",style:{position:"absolute",left:"50%",top:"0"}},{id:"batch-function-inline-input",type:"input",style:{position:"absolute",right:"0",top:"50%",transform:"translateY(20px)"}},{id:"batch-function-inline-output",type:"output",style:{position:"absolute",left:"0",top:"50%",transform:"translateY(20px)"}}]}),subCanvas:e=>{var t=A(e.id),n=e.document.getNode(t);if(!!n)return{isCanvas:!0,parentNode:n,canvasNode:e}}}}),B=n("816697");var U=(r=(0,s._)(function*(e){yield(0,B.gw)(30);var{document:t,batchId:n,batchFunctionId:o}=e;t.linesManager.createLine({from:n,to:o,fromPort:"batch-output-to-function",toPort:"batch-function-input"})}),function(e){return r.apply(this,arguments)}),q=n("886829"),W=(e,t)=>{var n=e.getData(q.m),o=t.getData(q.m),r=n.getNodeData();if(!!r)o.setNodeData({title:d.o.t("workflow_batch_canvas_title"),description:d.o.t("workflow_batch_canvas_tooltips"),icon:r.icon,mainColor:r.mainColor})};var G=(a=(0,s._)(function*(e,t){var n,o,r,a,i=e.document,l="".concat(R).concat(e.id),s={x:(null===(o=t.meta)||void 0===o?void 0:null===(n=o.position)||void 0===n?void 0:n.x)||0,y:(null===(a=t.meta)||void 0===a?void 0:null===(r=a.position)||void 0===r?void 0:r.y)||0},d=0,u=200,c=z(l,{x:s.x+d,y:s.y+u}),p=yield i.createWorkflowNode(c);W(e,p),U({document:i,batchId:e.id,batchFunctionId:p.id})}),function(e,t){return a.apply(this,arguments)}),H={type:l.nyy.Batch,meta:{nodeDTOType:l.nyy.Batch,style:{width:h.width},size:h,nodeMetaPath:i.je,outputsPath:i.G0,inputParametersPath:y.Inputs,useDynamicPort:!0,defaultPorts:[{type:"input"},{type:"output",portID:"batch-output"},{type:"output",portID:"batch-output-to-function",disabled:!0}],subCanvas:e=>{var t=V(e.id),n=e.document.getNode(t);if(!!n)return{isCanvas:!1,parentNode:e,canvasNode:n}},test:{generateRelatedContext:(e,t)=>(0,s._)(function*(){var{isInProject:e,workflowId:n,spaceId:o}=t;if(e)return{};var r=yield(0,c.m7)({workflowId:n,spaceId:o});return(0,c.UY)(r)})(),generateFormSettingProperties(e){var{formModel:t}=e.getData(u.Ps),n=t.getFormItemValueByPath("/inputs");return(0,c.ee)([{name:"concurrentSize",title:d.o.t("workflow_maximum_parallel_runs"),input:n.concurrentSize},{name:"batchSize",title:d.o.t("workflow_maximum_run_count"),input:n.batchSize}],{node:e})},generateFormInputProperties(e){var t,n=e.getData(u.Ps).formModel.getFormItemValueByPath("/"),o=null==n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.inputParameters;return(0,c.ee)(o,{node:e})}},helpLink:"/open/docs/guides/batch_node"},variablesMeta:{outputsPathList:[],inputsPathList:[y.Inputs]},formMeta:Z,onCreate(e,t){G(e,t)}},$=n("399226"),J=n("109207"),Y=()=>(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(J.G,{id:"batch-output-to-function",type:"output",style:{position:"absolute",width:20,height:20,right:"unset",top:"unset",bottom:0,left:"50%",transform:"translate(-50%, 50%)"}}),(0,p.jsx)(J.G,{id:"batch-output",type:"output",style:{position:"absolute",right:"0"}})]}),Q=()=>(0,p.jsxs)(j._,{children:[(0,p.jsx)($.EU,{}),(0,p.jsx)($.yC,{}),(0,p.jsx)(Y,{})]})},625802:function(e,t,n){n.d(t,{M:()=>p,L:()=>v});var o=n("736892"),r=n("450562"),a=n("151064"),i=n("686436"),l=n("676255"),s=n("167985"),d=n("288323"),u=()=>(0,a.jsx)(d.X_,{}),c={render:()=>(0,a.jsx)(u,{}),validateTrigger:i.C$.onChange,validate:{nodeMeta:l.O},effect:{nodeMeta:s.Jr},formatOnInit:e=>e,formatOnSubmit:e=>e},p={type:r.nyy.Break,meta:{isNodeEnd:!0,hideTest:!0,nodeDTOType:r.nyy.Break,defaultPorts:[{type:"input"}],size:{width:360,height:67.86},nodeMetaPath:o.je},formMeta:c,getOutputPoints:()=>[]};function v(){return(0,a.jsx)(a.Fragment,{})}},198252:function(e,t,n){n.d(t,{K:()=>L,l:()=>O});var o=n("736892"),r=n("450562"),a=n("686436"),i=n("370354"),l=n("808549"),s=n("120454"),d=n("151064"),u=n("676255"),c=n("167985"),p=n("707883"),v=n("950499"),m=n("336205"),f=n("288323"),g=n("101626"),h=n("801815"),_="inputParameters",y="codeParams",x="outputs",w=[{key:(0,h.x0)(),name:"key0",type:r.owu.String},{key:(0,h.x0)(),name:"key1",type:r.owu.ArrayString},{key:(0,h.x0)(),name:"key2",type:r.owu.Object,children:[{key:(0,h.x0)(),name:"key21",type:r.owu.String}]}],b=[{name:"input"}],j=n("674343"),k=n("240960"),N=n("766337"),S=n("175317"),C=n("489350"),I=(0,C.Q2)(e=>{var t,{tooltip:n,outputParams:o,inputParams:r}=e,{value:i,onChange:l,errors:s}=(0,C.U$)(),u=(0,k.j)(),c=(null==s?void 0:null===(t=s[0])||void 0===t?void 0:t.message)||"",p=(0,a.PF)();return(0,d.jsx)(j.iV,{getPopupContainer:()=>document.body,children:(0,d.jsx)(N.I.Provider,{value:{readonly:u,flowNodeEntity:p},children:(0,d.jsx)(S.S,{feedbackStatus:c?"error":void 0,feedbackText:c,inputParams:r,onChange:l,outputParams:o,outputPath:"/outputs",tooltip:n,value:i})})})}),T=()=>{var e=(0,a.cI)();return(0,d.jsxs)(f.X_,{children:[(0,d.jsx)(g.Go,{name:_,tooltip:m.o.t("workflow_detail_code_input_tooltip"),isTree:!0}),(0,d.jsx)(I,{name:y,tooltip:m.o.t("workflow_detail_code_code_tooltip"),inputParams:e.getValueIn(_),outputParams:e.getValueIn(x),hasFeedback:!1}),(0,d.jsx)(g.Nn,{title:m.o.t("workflow_detail_node_output"),tooltip:m.o.t("workflow_detail_code_output_tooltip"),jsonImport:!1,id:"code-node-outputs",name:x,hasFeedback:!1})]})},P=n("473980"),D=n("125002"),E={render:()=>(0,d.jsx)(T,{}),validateTrigger:a.C$.onChange,validate:(0,s._)((0,l._)({nodeMeta:u.O},{inputParameters:(0,v.n)()}),{[y]:e=>{var{value:t}=e;if(!(null==t?void 0:t.code))return m.o.t("workflow_running_results_error_code")},[x]:p.DJ}),effect:{nodeMeta:c.Jr,outputs:c.mw},formatOnInit:(e,t)=>{var{globalState:n}=t.playgroundContext,{isBindDouyin:o}=n,r=(0,D.o)({isBindDouyin:o}),a=e||{inputs:(0,l._)({inputParameters:b},r),outputs:w},{inputs:i={}}=a,d=(0,P._)(a,["inputs"]);return(0,s._)((0,l._)({},d),{inputParameters:i.inputParameters,codeParams:{code:i.code,language:i.language},nodeMeta:null==e?void 0:e.nodeMeta})},formatOnSubmit:e=>({nodeMeta:e.nodeMeta,inputs:(0,l._)({inputParameters:e.inputParameters},e.codeParams),outputs:e.outputs})},O={type:r.nyy.Code,meta:{nodeDTOType:r.nyy.Code,size:o.gu,style:{width:484},test:{generateFormInputProperties(e){var t=e.getData(a.Ps).formModel.getFormItemValueByPath("/"),n=null==t?void 0:t.inputParameters;return(0,i.ee)(n,{node:e})}},nodeMetaPath:o.je,outputsPath:o.G0,inputParametersPath:_,enableCopilotGenerateTestNodeForm:!0,helpLink:"/open/docs/guides/code_node"},formMeta:E};function L(){return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(f.EU,{}),(0,d.jsx)(f.yC,{})]})}},288323:function(e,t,n){n.d(t,{ml:()=>eT,F3:()=>eP,Mt:()=>x,EU:()=>w.E,ru:()=>et,vQ:()=>S,X_:()=>h,gU:()=>P,yC:()=>b.y,rG:()=>k});var o=n("151064"),r=n("25232"),a=n("455543"),i=n("184449"),l=n("489350"),s=n("101626"),d=n("808549"),u=n("120454"),c=n("455069"),p=n("686436"),v=n("450562"),m=n("951114"),f=n("699123");function g(e){var{extraOperation:t,nodeDisabled:n,readonlyAllowDeleteOperation:r}=e,a=(0,m.r)(),s=(0,p.PF)(),{projectId:g}=(0,i.j1)(),h=(0,c.useMemo)(()=>new v.m_1(s),[s]),_=(0,l.qo)("trigger.isOpen"),y=(0,c.useMemo)(()=>{var e,t,n;return null===(n=h.registry)||void 0===n?void 0:null===(t=n.meta)||void 0===t?void 0:null===(e=t.showTrigger)||void 0===e?void 0:e.call(t,{projectId:g})},[g]);return(0,o.jsx)(p.gN,{name:"nodeMeta",deps:["outputs","batchMode"],defaultValue:a,children:e=>{var a,i,l,s,{field:c,fieldState:p}=e;return(0,o.jsx)(f.l7,(0,u._)((0,d._)({},c),{showErrorIgnore:!0,errors:(null==p?void 0:p.errors)||[],hideTest:null===(i=h.registry)||void 0===i?void 0:null===(a=i.meta)||void 0===a?void 0:a.hideTest,readonly:null===(s=h.registry)||void 0===s?void 0:null===(l=s.meta)||void 0===l?void 0:l.headerReadonly,showTrigger:y,triggerIsOpen:_,extraOperation:t,nodeDisabled:n,readonlyAllowDeleteOperation:r}))}})}function h(e){var{children:t,extraOperation:n,batchModePath:d,nodeDisabled:u,readonlyAllowDeleteOperation:c}=e,{readonly:p}=(0,i.j1)(),v=(0,a.im)();return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(g,{extraOperation:n,nodeDisabled:u,readonlyAllowDeleteOperation:c}),(0,o.jsx)(r.n,{children:(0,o.jsxs)(l.l0,{readonly:p,children:[t,v?(0,o.jsx)(s.FV,{batchModePath:d}):null]})})]})}var _=n("674343"),y={[v.owu.String]:"String",[v.owu.Integer]:"Integer",[v.owu.Boolean]:"Boolean",[v.owu.Number]:"Number",[v.owu.Time]:"Time",[v.owu.File]:"File",[v.owu.Image]:"File/Image",[v.owu.Doc]:"File/Doc",[v.owu.Excel]:"File/Excel",[v.owu.Code]:"File/Code",[v.owu.Ppt]:"File/PPT",[v.owu.Txt]:"File/Text",[v.owu.Audio]:"File/Audio",[v.owu.Zip]:"File/ZIP",[v.owu.Video]:"File/Video",[v.owu.Svg]:"File/SVG",[v.owu.Voice]:"File/Voice"};function x(e){var{type:t,disabled:n}=e;return(0,o.jsx)(_.Vp,{color:"primary",size:"mini",disabled:n,children:void 0===t?"undefined":y[t]})}var w=n("808248"),b=n("333882"),j=n("473753"),k=(0,l.Q2)(e=>{var{value:t,readonly:n,onChange:r,errors:a}=(0,l.U$)();return(0,o.jsx)(j.AJ,(0,d._)({value:t,readonly:n,onChange:e=>null==r?void 0:r(e),validateStatus:a&&a.length>0?"error":void 0},e))}),N=n("168628"),S=(0,l.Q2)(e=>{var{name:t,value:n,onChange:r,errors:a,onFocus:i,onBlur:s}=(0,l.U$)(),{placeholder:d,minRows:u,maxLength:c,disableSuggestion:p,disableCounter:v,testIDSuffix:m=t}=e;return(0,o.jsx)(N.i,{name:m,value:n,onChange:e=>r(e),placeholder:d,minRows:u,maxLength:c,isError:a&&(null==a?void 0:a.length)>0,disableSuggestion:p,disableCounter:v,onFocus:i,onBlur:s},t)}),C=n("252237"),I=n.n(C),T=n("205641"),P=e=>{var{text:t,align:n="center",className:r="",isBreakLine:a=!1}=e;return(0,o.jsx)("div",{className:I()("w-full !px-[8px] !py-[6px] flex flex-row items-center coz-mg-hglt-secondary text-[14px]",{"justify-center":"center"===n,"justify-end":"right"===n,"justify-start":"left"===n},r),children:a?t:(0,o.jsx)(T.x,{text:t})})},D=n("392300"),E=n("335740"),O=n("808914"),L=n("336205"),M=n("707107"),F=n("520862"),Z=n("431421"),R=n("998262"),V=n("44408"),A=n.n(V),z=n("233773"),B=n.n(z),U=n("703999"),q=n.n(U),W=n("468329"),G=n.n(W),H=n("479886"),$=n.n(H),J=n("297158"),Y="Asia/Shanghai",Q="UTC+08:00",X="Others";$().extend(G()),$().extend(q()),$().extend(A()),$().extend(B());var K=()=>{var e=[],t=[];try{var n,o=null!==(n=L.o.language)&&void 0!==n?n:"en-US",r=Intl.supportedValuesOf("timeZone").map(e=>{var t=new Intl.DateTimeFormat(o,{timeZone:e,timeZoneName:"longGeneric"}).formatToParts(new Date),{value:n}=(0,O.Z)(t,["type","timeZoneName"]),r=$()().tz(e);return{value:e,label:"".concat(n," - ").concat(e),offset:"UTC".concat(r.format("Z")),utcOffset:r.utcOffset()}});e=(0,F.Z)((0,Z.Z)((0,R.Z)(r,"offset")),e=>{var t,[n]=e;return null===(t=(0,O.Z)(r,["offset",n]))||void 0===t?void 0:t.utcOffset},["asc"]).map(e=>{var[t,n]=e;return{value:t,label:t,children:(0,F.Z)(n,["label"],["asc"])}}),t=r}catch(n){e=[{value:Q,label:Q,children:[{value:Y,label:Y}]}],t=[{value:Y,offset:Q}],J.kg.persist.error({message:"Custom Error: Unable to obtain accurate time zone list",error:n})}return{timezoneOptions:e,timezoneMap:t}},ee=n("261405"),et=e=>{var t,n,{className:r,showClear:a=!1,defaultValue:i,value:l,onChange:s=D.Z,readonly:d}=e,u=null!==(n=null!==(t=null==l?void 0:l.content)&&void 0!==t?t:l)&&void 0!==n?n:i,{timezoneOptions:p,timezoneMap:m}=(0,c.useMemo)(()=>K(),[]),[f,g]=(0,c.useMemo)(()=>{var e=(0,E.Z)(p),t=(0,E.Z)(m);return u&&t.every(e=>e.value!==u)&&(e.push({value:X,label:X,children:[{value:u,label:u}]}),t.push({value:u,offset:X})),[e,t]},[]),h=(0,c.useMemo)(()=>{var e=(0,O.Z)(g,["value",u]);return e?[e.offset,e.value]:void 0},[u,g]),y=(e,t)=>{if(Array.isArray(e)&&e.length>1){var[n,o]=e,r=(0,O.Z)(f,["value",n]);if(r&&Array.isArray(r.children)){var a=(0,O.Z)(r.children,[t,o]);if(a&&a.value)return a.value}}};return(0,o.jsx)(_.vT,{size:"small",className:"".concat(r," w-full"),dropdownClassName:ee.Z.dropdown,showClear:a,filterTreeNode:!0,filterSorter:(e,t,n)=>{if(Array.isArray(e)&&e.length>1&&Array.isArray(t)&&t.length>1){var o=(n||"").toLowerCase(),r=(e[1].label||"").toLowerCase(),a=(t[1].label||"").toLowerCase(),i=r.split(" "),l=a.split(" ");if(0===i.findIndex(e=>e===o))return -1;if(0===l.findIndex(e=>e===o))return 1;if(r.includes(o))return -1;if(a.includes(o))return 1}return 0},filterRender:e=>{var{className:t,inputValue:n,data:r,onClick:a}=e,i=r.map(e=>e.label).join(" / ");return(0,o.jsx)("li",{role:"menuitem",className:I()("semi-cascader-option-flatten",t),onClick:a,children:(0,o.jsxs)("span",{className:"semi-cascader-option-label",children:[(0,o.jsx)("span",{"aria-hidden":"true",className:"semi-cascader-option-icon semi-cascader-option-icon-empty"}),(0,o.jsx)(_.y$,{sourceString:i,searchWords:[n],highlightStyle:{color:"var(--light-usage-primary-color-primary, #4d53e8)",backgroundColor:"transparent"}})]})})},disabled:d,placeholder:L.o.t("task_preset_timezone"),treeData:f,value:h,onChange:e=>{var t=y(e,"value");s({type:v.YX3.LITERAL,content:t}),t&&(0,M.Gg)(M.Kg.select_scheduled_tasks_timezone,{timezone:t})},displayRender:e=>y(e,"label")})},en=n("614904"),eo=n("438111"),er=n("346707"),ea=n("47273"),ei=n.n(ea),el=n("569502"),es=n("458620"),ed=n("727914"),eu=Array.from(Array(24).keys()).map(e=>({label:e.toString().padStart(2,"0").concat(":00"),value:e,isLeaf:!0})),ec=()=>Array.from({length:7}).map((e,t)=>({label:L.o.t("bot_task_preset_day_of_week",{day:t}),value:t,children:eu})),ep=()=>Array.from({length:31}).map((e,t)=>({label:L.o.t("bot_task_preset_day_of_month",{day:t+1}),value:t+1,children:eu})),ev=()=>Array.from({length:5}).map((e,t)=>({label:L.o.t("bot_task_preset_day_of_month",{day:t+2}),value:t+2,children:eu})),em=()=>L.o.t("bot_task_preset_triggered_everyday"),ef=()=>L.o.t("bot_task_preset_triggered_everyweek"),eg=()=>L.o.t("bot_task_preset_triggered_monthly"),eh=()=>L.o.t("bot_task_preset_triggered_interval"),e_=()=>[{label:em(),value:"daily",children:eu},{label:ef(),value:"weekly",children:ec()},{label:eg(),value:"monthly",children:ep()},{label:eh(),value:"intervalDaily",children:ev()}],ey=e=>{var t=e[0],n=new(ei());if("daily"===t){var o=e[1];return n.every(1).days().atHour(o).atMinute(0).toString()}var r=e[1],a=e[2];if((0,er.Z)(a))throw new ed.sH(es.b.parmasValidation,"invalid schedule");return"weekly"===t?n.atHour(a).atMinute(0).onDaysOfWeek(r).toString():"monthly"===t?n.atHour(a).atMinute(0).onDaysOfMonth(r).toString():n.every(r).days().atHour(a).atMinute(0).toString()},ex=e=>{var t,n,o,r=null==e?void 0:null===(n=e.split)||void 0===n?void 0:null===(t=(o=n.call(e," ")).slice)||void 0===t?void 0:t.call(o,1),a=null==r?void 0:r.at(1),i=null==r?void 0:r.at(2),l=null==e?void 0:e.at(-1),s=Number(a);if("*"!==l)return["weekly",Number(l),s];if("*"!==i)return(null==i?void 0:i.startsWith("*"))?["intervalDaily",Number(i.split("/").at(1)),s]:["monthly",Number(i),s];return["daily",s]},ew=e=>{var t,n,o=e.at(0),r=e=>{var t,n;return(null==e?void 0:null===(t=e.startsWith)||void 0===t?void 0:t.call(e,"0"))?null===(n=e.slice)||void 0===n?void 0:n.call(e,1):e};if(o===em()){var a=e.at(1);return L.o.t("bot_task_preset_everyday_task",{time:r(a)})}var i=e.at(1),l=Number(null==i?void 0:null===(n=i.match)||void 0===n?void 0:null===(t=n.call(i,/[0-9]+/))||void 0===t?void 0:t[0]),s=r(e.at(2));return o===ef()?L.o.t("bot_task_preset_everyweek_task",{day:i,time:s}):o===eg()?L.o.t("bot_task_preset_monthly_task",{day:l,time:s}):o===eh()?L.o.t("bot_task_preset_interval_task",{day:l,time:s}):""},eb=e=>{var{value:t,onChange:n,readonly:r,hasError:a}=e,i=(0,c.useRef)(""),l=null==t?void 0:t.content,s=(0,c.useCallback)(e=>{null==n||n({type:el.YX.LITERAL,content:e})},[n]);return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(_.vT,{hasError:a,size:"small",className:"w-full",disabled:r,showClear:!1,placeholder:L.o.t("task_preset_trigger_time"),value:l?ex(l):void 0,onChange:e=>{if(Array.isArray(e)&&e.length){var t="0 ".concat(ey(e));null==s||s(t);return}null==s||s("")},treeData:e_(),displayRender:e=>{if(Array.isArray(e))return i.current=ew(e),i.current}})})},ej=n("825955"),ek=n("915757"),eN=n("561232"),eS=n("396954"),eC=e=>{var{onChange:t}=e,[n,r]=(0,c.useState)(!1),[a,l]=(0,c.useState)(""),[s,d]=(0,c.useState)(""),[u,p]=(0,c.useState)(!1),m=(0,c.useRef)(),{spaceId:f,projectId:g,workflowId:h}=(0,i.j1)();return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(_.gn,{className:"w-[330px]",title:L.o.t("workflow_start_trigger_cron_ai",{},"使用 AI 生成"),trigger:"custom",stopPropagation:!0,onClickOutSide:()=>{r(!1)},content:(0,o.jsxs)("div",{className:"mt-[12px] flex flex-col gap-[12px] text-[12px]",children:[(0,o.jsx)("div",{className:"flex flex-col gap-[4px] p-[8px] rounded-mini coz-mg-hglt",children:(0,o.jsx)("div",{className:"coz-fg-primary",children:L.o.t("workflow_trigger_cron_gen_sample_placeholder",{},"您可以在提示词中用自然语言如“每天18点”，将会生成对应的Cron表达式 0 18 * * * 表示每天 18 点执行。")})}),(0,o.jsxs)("div",{className:"flex flex-col gap-[4px]",children:[(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("div",{className:"text-[14px] font-medium coz-fg-plus",children:L.o.t("Imageflow_prompt",{},"Prompt")}),u?(0,o.jsx)(_.hU,{size:"small",onClick:()=>{try{var e;null===(e=m.current)||void 0===e||e.call(m,"cancel")}finally{p(!1)}},icon:(0,o.jsx)(ek.noE,{}),color:"aihglt",children:L.o.t("workflow_start_trigger_cron_gen_stop",{},"停止")}):(0,o.jsx)(_.mw,{size:"small",disabled:!a,onClick:(0,ej._)(function*(){try{p(!0);var e,t,n=yield v.OHc.CopilotGenerate({space_id:f,project_id:null!=g?g:"",copilot_type:v.BSe.CRONTAB,query:a,workflow_id:h});d(null!==(t=null==n?void 0:null===(e=n.data)||void 0===e?void 0:e.content)&&void 0!==t?t:"")}finally{p(!1)}}),color:"aihglt",children:L.o.t("workflow_start_trigger_cron_gen",{},"生成")})]}),(0,o.jsx)(_.II,{size:"small",value:a,placeholder:L.o.t("workflow_trigger_cron_gen_prompt_placeholder",{},"示例：每天18点"),onChange:l})]}),(0,o.jsxs)("div",{className:"flex flex-col gap-[4px]",children:[(0,o.jsx)("div",{className:"text-[14px] font-medium coz-fg-plus",children:L.o.t("workflow_start_trigger_cron_generated",{},"生成的 Cron 表达式")}),(0,o.jsxs)("div",{className:"flex flex-row gap-[8px]",children:[(0,o.jsx)(_.II,{loading:u,size:"small",disabled:!0,value:s,onChange:d}),(0,o.jsx)(_.zx,{size:"small",loading:u,disabled:!s,onClick:()=>{s&&(t(s),r(!1))},children:L.o.t("workflow_start_trigger_cron_fillin",{},"填入")})]})]})]}),visible:n,onVisibleChange:e=>{r(e)},onCancel:()=>{r(!1)},okText:"",cancelText:L.o.t("workflow_start_trigger_cron_cancel",{},"取消"),children:(0,o.jsx)("div",{children:(0,o.jsx)(_.mw,{size:"mini",onClick:()=>r(!0),color:"aihglt",onlyIcon:!0})})})})},eI=e=>{var{value:t,onChange:n,readonly:r,node:a,needRefInput:i=!1,hasError:l}=e,s=(0,c.useCallback)(e=>{n({type:v.YX3.LITERAL,content:e})},[n]),d=(null==t?void 0:t.type)&&v.nZF.isRef(t),{renderVariableSelect:u,renderVariableDisplay:p}=(0,eN.LM)({value:t,onChange:n,readonly:r,node:a,style:{width:"100%"},disabledTypes:v.owu.getComplement([v.owu.String])});return(0,o.jsx)("div",{className:"w-full flex flex-row gap-[4px]",children:d?p({needWrapper:!0}):(0,o.jsx)(_.II,{error:l,size:"small",disabled:r,className:I()(["w-full flex-1",eS.Z.input]),value:null==t?void 0:t.content,placeholder:L.o.t("workflow_start_trigger_cron_ai_sample",{},"示例：您可以填写 cron 表达式。例如：0 18 * * * 表示每天 18 点执行。"),onChange:s,suffix:(0,o.jsxs)("div",{className:"flex flex-row gap-[4px]",children:[(0,o.jsx)(eC,{onChange:s}),i?(0,o.jsx)("div",{children:u((0,o.jsx)(_.hU,{size:"mini",color:"secondary",icon:(0,o.jsx)(ek.nwG,{className:"text-[16px]"})}))}):void 0]})})})},eT=e=>{var t,{needRefInput:n,className:r="",value:a={type:eo.T.Selecting,content:{type:v.YX3.LITERAL,content:""}},onChange:i,readonly:l}=e,s=(0,p.PF)(),d=(0,p.OP)(s),u=(null!=d?d:[]).length>0,m=null!==(t=a.type)&&void 0!==t?t:eo.T.Selecting,f=e=>{i({type:m,content:null!=e?e:{type:v.YX3.LITERAL}})},g=(0,c.useMemo)(()=>{var e;return u||m===eo.T.Selecting||a.content&&v.nZF.isRef(a.content)?"":(0,en.pJ)(null===(e=a.content)||void 0===e?void 0:e.content)},[u,a.content,m]);return(0,o.jsxs)("div",{className:r,children:[(0,o.jsxs)("div",{className:"flex flex-row gap-[2px]",children:[(0,o.jsx)(_.Ph,{size:"small",value:m,className:"w-fit mb-[4px]",disabled:l,onChange:e=>{i({type:e,content:{type:v.YX3.LITERAL}})},optionList:[{label:L.o.t("workflow_start_trigger_cron_option",{},"选择预设时间"),value:eo.T.Selecting},{label:L.o.t("workflow_start_trigger_cron_job",{},"使用Cron表达式"),value:eo.T.Cronjob}]}),(0,o.jsx)("div",{className:"flex-1 overflow-hidden",children:m===eo.T.Selecting?(0,o.jsx)(eb,{hasError:u,value:a.content,onChange:f,readonly:l}):(0,o.jsx)(eI,{hasError:u,value:a.content,onChange:f,readonly:l,node:s,needRefInput:n})})]}),g?(0,o.jsx)("div",{className:"coz-mg-primary w-full h-[24px] flex flex-row items-center justify-center rounded-[4px]",children:(0,o.jsx)(T.x,{text:g,className:"text-[12px]"})}):null]})},eP=e=>{var{formMeta:t,name:n,components:r,onChange:a}=e,i=(0,c.useMemo)(()=>t.map(e=>{var t,i,s=null!==(t=r[e.setter])&&void 0!==t?t:()=>(0,o.jsxs)("div",{children:["component ",e.setter," not exist"]});return(0,c.createElement)(l.gN,(0,u._)((0,d._)({},e),{key:e.name,name:"".concat(n,".").concat(e.name),layout:null!==(i=e.layout)&&void 0!==i?i:"vertical"}),t=>{var{value:n,onChange:r,readonly:i}=t;return(0,o.jsx)(s,(0,u._)((0,d._)({},e.setterProps),{value:n,onChange:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];r(...t),null==a||a()},readonly:i}))})}),[t,n,r]);return(0,o.jsx)(o.Fragment,{children:i})}},167985:function(e,t,n){n.d(t,{mw:()=>r.m,qf:()=>d,Jr:()=>o.J,iq:()=>l});var o=n("7496"),r=n("645344"),a=n("203995"),i=n("934966"),l=(0,a.W)(i.W),s=n("695569"),d=(0,a.W)(s.K)},101626:function(e,t,n){n.d(t,{u8:()=>ey,lf:()=>es,fB:()=>Y,Nn:()=>O.Nn,U4:()=>E,se:()=>y,FV:()=>F,JY:()=>ei,nT:()=>S,m8:()=>G,ko:()=>z,N0:()=>A,KV:()=>en,j4:()=>eo,L2:()=>U,vQ:()=>$,Go:()=>C,pQ:()=>X});var o=n("151064"),r=n("336205"),a=n("808549"),i=n("240960"),l=n("25804"),s=n("113006"),d=n("489350"),u=(0,l.S)(e=>(0,o.jsx)(s.a,(0,a._)({},e))),c=(0,d.Q2)(e=>{var{title:t,tooltip:n,customReadonly:r,testId:a}=e,{value:l,onChange:s,errors:c}=(0,d.U$)(),p=(0,i.j)();return(0,o.jsx)(u,{value:l,title:t,titleTooltip:n,readonly:p||r,onChange:s,errors:c,testId:a})},{hasFeedback:!1}),p=n("686436"),v=n("425212"),m=n("120454"),f=n("252237"),g=n.n(f),h=n("450562"),_=n("321258"),y=(0,d.Q2)(function(e){var{style:t,inputType:n,disabledTypes:r,availableFileTypes:i,testId:l,customFilterVar:s,selectStyle:u,className:c,inputPlaceholder:p,literalConfig:v,hideDeleteIcon:f,literalDisabled:y,customReadonly:x}=e,{name:w,value:b,onChange:j,errors:k,onBlur:N,readonly:S}=(0,d.U$)(),{getNodeSetterId:C}=(0,h.FCD)();return(0,o.jsx)("div",{className:g()("flex flex-col items-start",c),"data-testid":C(w),style:(0,m._)((0,a._)({},t),{pointerEvents:S?"none":"auto"}),children:(0,o.jsx)(_.N,{value:b,onChange:e=>j(e),name:null!=l?l:w,isError:k&&(null==k?void 0:k.length)>0,onBlur:N,inputType:n,disabledTypes:r,availableFileTypes:i,customFilterVar:s,selectStyle:u,inputPlaceholder:p,literalDisabled:y,literalConfig:v,hideDeleteIcon:f,readonly:x})})}),x=n("455069"),w=n("218353"),b=n("915757"),j=n("674343"),k=n("862868"),N=(0,d.Q2)(e=>{var{style:t,input:n,inputParameters:l,initValidate:s=!1,isPureText:u=!1,prefix:c="",suffix:v="",placeholder:f=r.o.t("workflow_detail_node_input_entername"),format:_,tooltip:y,readonly:N}=e,{name:S,value:C,onChange:I,onBlur:T,errors:P}=(0,d.U$)(),[D,E]=(0,x.useState)(!1),[O,L]=(0,x.useState)(!1),[M,F]=(0,x.useState)(C),[Z,R]=(0,x.useState)(C),V=(0,i.j)()||N,A=(0,p.PF)(),z=(0,p.G2)(w.a),{getNodeSetterId:B}=(0,h.FCD)();(0,x.useEffect)(()=>{C!==Z&&R(C)},[C]);var U=(0,k.H)({input:n,prefix:c,suffix:v,format:_,node:A,variableService:z}),q=(0,x.useCallback)(e=>{L(!0),R(e||""),F(void 0)},[]);if((0,x.useEffect)(()=>{s&&I(C),C&&L(!0),E(!0)},[]),D&&!V&&!O){if(U&&U!==M){var W=(0,k.Zu)({variableName:U,inputParameters:l});I(W),F(U),R(W)}else!U&&M&&(F(void 0),R(void 0))}return(0,o.jsx)("div",{className:"flex flex-col items-start",style:(0,m._)((0,a._)({},t),{pointerEvents:V?"none":"auto"}),children:u?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(j.ZT.Text,{className:"h-8 leading-8 overflow-hidden whitespace-nowrap text-ellipsis",children:C}),y?(0,o.jsx)(j.u,{content:y,children:(0,o.jsx)(b.L03,{className:"ml-1",style:{fontSize:12}})}):null]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(j.II,{className:g()({"semi-input-wrapper-error":null==P?void 0:P.length}),size:"small","data-testid":B(S),value:Z,onChange:q,onBlur:()=>{I(Z||""),null==T||T()},validateStatus:(null==P?void 0:P.length)?"error":void 0,placeholder:f,readonly:V}),y?(0,o.jsx)(j.u,{content:y,children:(0,o.jsx)(b.L03,{className:"ml-1",style:{fontSize:12}})}):null]})})}),S=e=>{var{name:t,defaultValue:n,title:l,tooltip:s,paramsTitle:u,expressionTitle:c,disabledTypes:m,inputPlaceholder:f,literalDisabled:g,onAppend:h,nthCannotDeleted:_,showEmptyText:x=!0,nameProps:w={},inputProps:b={},customReadonly:j,testId:k}=e,S=(0,i.j)()||j;return(0,o.jsx)(p.F2,{name:t,defaultValue:n,children:e=>{var n,{field:i}=e,{value:p=[],delete:C,append:I}=i,T=null!==(n=null==p?void 0:p.length)&&void 0!==n?n:0,P=!T,D=_===T;return(0,o.jsxs)(d.$0,{title:l,tooltip:s,actions:S?[]:[(0,o.jsx)(d.HS,{dataTestId:"".concat(k,".add-button"),onClick:()=>{var e;I(null!==(e=null==h?void 0:h())&&void 0!==e?e:{name:""})}})],isEmpty:x&&P,emptyText:r.o.t("workflow_inputs_empty"),children:[(0,o.jsx)(v.b,{columns:[{title:null!=u?u:r.o.t("workflow_detail_node_parameter_name"),style:{flex:2}},{title:null!=c?c:r.o.t("workflow_detail_end_output_value"),style:{flex:3}}],readonly:S,className:"mb-[8px]",style:{display:P?"none":"flex"}}),(0,o.jsx)(d.oD,{children:i.map((e,n)=>(0,o.jsxs)(d.y1,{disableRemove:D,hiddenRemove:S,onRemove:()=>C(n),children:[(0,o.jsx)("div",{style:{flex:2},children:(0,o.jsx)(N,(0,a._)({name:"".concat(e.name,".name"),placeholder:r.o.t("workflow_detail_node_input_entername"),input:e.value.input,inputParameters:p},w))}),(0,o.jsx)("div",{style:{flex:3},children:(0,o.jsx)(y,(0,a._)({name:"".concat(t,".").concat(n,".input"),disabledTypes:m,inputPlaceholder:f,literalDisabled:g,customReadonly:j},b))})]},e.key))})]})}})},C=e=>{var{name:t="inputs.inputParameters",title:n=r.o.t("workflow_detail_node_parameter_input"),tooltip:a=r.o.t("workflow_240218_07"),paramsTitle:i,expressionTitle:l,disabledTypes:s,defaultValue:d,onAppend:u,inputPlaceholder:p,literalDisabled:v,isTree:m,nameProps:f,customReadonly:g,testId:h}=e;return m?(0,o.jsx)(c,{name:t,defaultValue:d,title:n,tooltip:a,customReadonly:g,testId:h}):(0,o.jsx)(S,{name:t,defaultValue:d,title:n,tooltip:a,paramsTitle:i,expressionTitle:l,disabledTypes:s,onAppend:u,inputPlaceholder:p,literalDisabled:v,nameProps:f,customReadonly:g,testId:h})},I=n("962289"),T=n("264219"),P=n("638284"),D=n("950499");function E(e){return e?{"inputs.inputParameters":(0,D.n)()}:{"inputs.inputParameters.*.name":(0,P.e)({getNames:e=>{var{formValues:t}=e;return((0,I.Z)(t,"inputs.inputParameters")||[]).map(e=>e.name)}}),"inputs.inputParameters.*.input":(0,T.v)({required:!0})}}var O=n("707883"),L=n("420481"),M=(0,d.Q2)(e=>{var{batchModePath:t,outputsPath:n,noPadding:r}=e,l=(0,d.U$)(),s=(0,i.j)();return(0,o.jsx)(L.FV,(0,m._)((0,a._)({},l),{readonly:s,value:l.value,batchModePath:t,outputsPath:n,noPadding:r}))}),F=e=>{var{name:t="settingOnError",batchModePath:n="batchMode",outputsPath:r="outputs",noPadding:a=!1}=e;return(0,o.jsx)(M,{name:t,batchModePath:n,outputsPath:r,noPadding:a,hasFeedback:!1})},Z=n("789541"),R=n("288323"),V=n("879474"),A=e=>{var{name:t,columns:n,nameReadonly:a,fieldEditable:l,hiddenRemove:s,hiddenTypeTag:u=!1,defaultValue:c,inputType:m,disabledTypes:f}=e,h=(0,i.j)();return(0,o.jsx)(p.F2,{name:t,defaultValue:c,children:e=>{var{field:t}=e,{value:i=[],delete:c}=t;return(0,o.jsxs)(d.tz,{isEmpty:!i||(null==i?void 0:i.length)===0,text:r.o.t("workflow_inputs_empty"),children:[(null==n?void 0:n.length)?(0,o.jsx)(v.b,{columns:n,readonly:h,className:g()("mb-[8px]",h?V.Z.parametersTitleReadonly:V.Z.parametersTitle)}):null,(0,o.jsx)(d.oD,{children:t.map((e,t)=>(0,o.jsxs)(d.y1,{onRemove:()=>c(t),disableRemove:!l,hiddenRemove:s,children:[(0,o.jsx)("div",{className:"leading-[24px]",style:{flex:2},children:a?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Z.Z,{label:e.value.name}),!u&&(0,o.jsx)(R.Mt,{type:e.value.type})]}):(0,o.jsx)(N,{name:"".concat(e.name,".name"),placeholder:r.o.t("workflow_detail_node_input_entername"),input:e.value.input,inputParameters:i})}),(0,o.jsx)("div",{style:{flex:3},children:(0,o.jsx)(y,{name:"".concat(e.name,".input"),deps:["".concat(e.name,".type")],inputType:m,disabledTypes:f},e.value.type)})]},e.key))})]})}})},z=e=>{var{name:t,title:n,tooltip:r,columns:a,defaultValue:l,nameReadonly:s,fieldEditable:u=!0,defaultAppendValue:c={name:"",type:h.owu.String,input:{type:h.YX3.LITERAL,content:""}},inputType:p,hiddenTypes:v,disabledTypes:m}=e,f=(0,i.j)();return(0,o.jsx)(d.$0,{title:n,tooltip:r,actions:u&&!f?[(0,o.jsx)(d.F2,{name:t,children:e=>{var{append:t}=e;return(0,o.jsx)(d.HS,{onClick:()=>{t(c)}})}})]:[],children:(0,o.jsx)(A,{name:t,columns:a,defaultValue:l,nameReadonly:s,fieldEditable:u&&!f,hiddenTypes:v,inputType:p,disabledTypes:m})})},B=n("392646"),U=(0,d.Q2)(function(e){var{title:t,tooltip:n}=e,{value:r,onChange:a,readonly:i,name:l}=(0,d.U$)();return(0,o.jsx)(d.$0,{title:t,tooltip:n,children:(0,o.jsx)(B.q,{name:l,value:r,onChange:e=>a(e),readonly:i})})}),q=n("265842"),W=n("502931"),G=(0,d.Q2)(e=>{var{options:t,customReadonly:n}=e,{name:r,value:a,onChange:i,readonly:l}=(0,d.U$)();return(0,o.jsx)("div",{className:W.Z["workflow-node-setter-radio"],children:(0,o.jsx)(q.Y,{value:a,onChange:i,options:t,readonly:!!l||n,context:{meta:{name:r}}})})}),H=n("168628"),$=(0,d.Q2)(function(e){var t,{name:n,value:r,onChange:i,errors:l,onBlur:s,readonly:u}=(0,d.U$)();return(0,o.jsx)(H.i,(0,m._)((0,a._)({},e),{name:null!==(t=null==e?void 0:e.dataTestName)&&void 0!==t?t:n,value:r,onChange:e=>i(e),isError:l&&(null==l?void 0:l.length)>0,onBlur:s,disableSuggestion:u}))}),J=n("77167"),Y=(0,d.Q2)(e=>{var{text:t,itemTooltip:n}=e,{name:r,value:a,onChange:i,readonly:l}=(0,d.U$)();return(0,o.jsx)(J.X,{options:{text:t,itemTooltip:n},context:{meta:{name:r}},value:!!a,onChange:e=>i(e),readonly:!!l})}),Q=n("375525"),X=(0,d.Q2)(()=>{var{value:e}=(0,d.U$)();return(0,o.jsx)(Q.e,{options:{outputInfo:null==e?void 0:e.map(e=>{var t;return(0,m._)((0,a._)({},e),{label:null!==(t=e.name)&&void 0!==t?t:"",type:h.IuB[e.type]})})}})}),K=n("44172"),ee=n("275546"),et=n("168845"),en=(0,d.Q2)(e=>{var{testId:t,customLabel:n,customTooltip:r,customStyles:a,labelStyles:i,switchCustomStyles:l}=e,{getNodeSetterId:s}=(0,h.FCD)(),{value:u,onChange:c,readonly:p}=(0,d.U$)();return(0,o.jsxs)("div",{className:et.Z.switchContainer,style:a,children:[n?(0,o.jsx)("div",{className:et.Z.label,style:i,children:n}):null,r?(0,o.jsx)(ee.Z,{showArrow:!0,position:"top",className:et.Z.popover,content:r,children:(0,o.jsx)(K.aUG,{className:et.Z.icon})}):null,(0,o.jsx)(j.rs,{"data-testid":s(null!=t?t:""),disabled:p,size:"mini",checked:u,onChange:c,style:l})]})}),eo=e=>{var{title:t,tooltip:n,switchLabel:a,switchTooltip:i,enableStreamingOutput:l,editorFieldName:s,switchFieldName:u,switchTestId:c,inputParameters:p,testId:v}=e,{concatTestId:m,getNodeSetterId:f}=(0,h.FCD)();return(0,o.jsx)(d.$0,{title:t,tooltip:n,actions:[l&&u?(0,o.jsx)(en,{name:u,customLabel:a,customTooltip:i,testId:m(null!=v?v:"",null!=c?c:"")}):null],testId:f(null!=v?v:""),children:(0,o.jsx)($,{name:s,placeholder:r.o.t("workflow_detail_end_answer_example"),inputParameters:p,testId:v})})},er=n("301541"),ea=(0,d.Q2)(()=>{var{name:e,value:t,onChange:n,readonly:r}=(0,d.U$)(),{getNodeSetterId:a}=(0,h.FCD)(),i=a(e);return(0,o.jsx)(er.o,{value:t,onChange:n,readonly:r,testId:i})}),ei=e=>{var{name:t,defaultValue:n,title:l,tooltip:s,nameProps:u={}}=e,c=(0,i.j)();return(0,o.jsx)(p.F2,{name:t,defaultValue:n,children:e=>{var{field:t}=e,{value:n=[],delete:i,append:p}=t;return(0,o.jsxs)(d.$0,{title:l,tooltip:s,actions:c?[]:[(0,o.jsx)(d.HS,{onClick:()=>{p({})}})],isEmpty:!n||(null==n?void 0:n.length)===0,emptyText:r.o.t("workflow_inputs_empty"),children:[(0,o.jsx)(v.b,{columns:[{title:r.o.t("workflow_detail_node_parameter_name"),style:{flex:2,minWidth:0}},{title:r.o.t("workflow_detail_node_parameter_value"),style:{flex:3,minWidth:0}},{title:r.o.t("workflow_detail_start_variable_type"),style:{width:90}}],readonly:c,className:"mb-[8px]"}),(0,o.jsx)(d.oD,{children:t.map((e,t)=>(0,o.jsxs)(d.y1,{hiddenRemove:c,onRemove:()=>i(t),children:[(0,o.jsx)("div",{style:{flex:2},children:(0,o.jsx)(N,(0,a._)({name:"".concat(e.name,".name"),placeholder:r.o.t("workflow_detail_node_input_entername"),input:e.value.input,inputParameters:n},u))}),(0,o.jsx)("div",{style:{flex:"3 1 90px",overflow:"hidden"},children:(0,o.jsx)(ea,{name:"".concat(e.name,".input")})})]},e.key))})]})}})},el=n("61872"),es=(0,d.Q2)(()=>{var{name:e,value:t,onChange:n,onBlur:r}=(0,d.U$)();return(0,o.jsx)(el.P,{name:e,value:t,onChange:e=>{null==n||n(e.target.value),null==r||r()},onBlur:r})}),ed=n("473980"),eu=n("1704"),ec=n("316896"),ep=n("6319"),ev=n("297158"),em=n("587256"),ef=[{label:r.o.t("workflow_detail_node_parameter_name"),style:{width:148}},{label:r.o.t("workflow_detail_end_output_value")}],eg={Select:d.mg,Slider:d.RW},eh={Select:{width:"100%"}},e_=(e,t,n)=>{var{title:r,name:i,required:l,description:s,label:u}=e,{key:c}=t,p=(0,ed._)(t,["key"]),v=eg[c];return v?(0,o.jsx)(d.Q4,{label:r||u||i,tooltip:s,required:l,children:(0,o.jsx)(v,(0,m._)((0,a._)({},p),{name:"".concat(n,".").concat(i),style:eh[c]}))}):null},ey=(0,d.Q2)(e=>{var t,{inputsDef:n}=e,{name:a}=(0,d.U$)(),{getNodeSetterId:i}=(0,h.FCD)();return(0,o.jsxs)(d.$0,{title:r.o.t("workflow_detail_node_input"),tooltip:r.o.t("workflow_detail_api_input_tooltip"),testId:i(a),actions:[],children:[(0,o.jsx)(d.az,{columns:ef}),(0,o.jsx)("div",{className:"flex flex-col gap-[8px]",children:null===(t=(0,ec.x)(n))||void 0===t?void 0:t.map(e=>{var t,{title:n,name:r,required:i,description:l,label:s}=e,{inputType:d,disabledTypes:u}=(0,ep.k)(e);try{t=(0,eu.v)(e)}catch(e){t=void 0,ev.E7.error({message:"workflow_plugin_generate_input_json_schema_error",error:e})}var c=(0,em.Hg)(e);return(null==c?void 0:c.key)?e_(e,c,a):(0,o.jsx)(y,{label:n||s||r,tooltip:l,required:i,inputType:d,disabledTypes:u,name:"".concat(a,".").concat(r),literalConfig:t?{jsonSchema:t}:void 0},"".concat(a,".").concat(r))})})]})})},707883:function(e,t,n){n.d(t,{Nn:()=>s,DJ:()=>g});var o=n("808549"),r=n("473980"),a=n("151064"),i=n("594073"),l=n("489350"),s=(0,l.Q2)(e=>{var{id:t="outputs",topLevelReadonly:n=!1,settingOnErrorPath:s="settingOnError.settingOnErrorIsOpen",disabledTypes:d=[],hiddenTypes:u,title:c,tooltip:p,disabled:v,customReadonly:m=!1,noCard:f,jsonImport:g,allowAppendRootData:h,withDescription:_=!0,withRequired:y,batchMode:x}=e,w=(0,r._)(e,["id","topLevelReadonly","settingOnErrorPath","disabledTypes","hiddenTypes","title","tooltip","disabled","customReadonly","noCard","jsonImport","allowAppendRootData","withDescription","withRequired","batchMode"]),{value:b,onChange:j,readonly:k,onBlur:N,errors:S}=(0,l.U$)(),C=(0,l.qo)(s);return(0,a.jsx)(i.y,(0,o._)({id:t,value:b,onChange:e=>{null==j||j(e),null==N||N()},title:c,titleTooltip:p,topLevelReadonly:n,disabledTypes:d,hiddenTypes:u,readonly:k||m,disabled:v,needErrorBody:C,noCard:f,batchMode:x,jsonImport:g,allowAppendRootData:h,withDescription:_,withRequired:y,errors:S},w))});n("645344");var d=n("120454"),u=n("670324"),c=n("962289"),p=n("336205"),v=/^(?!.*\b(true|false|and|AND|or|OR|not|NOT|null|nil|If|Switch)\b)[a-zA-Z_][a-zA-Z_$0-9]*$/,m=u.z.lazy(()=>u.z.object({name:u.z.string({required_error:p.o.t("workflow_detail_node_error_name_empty")}).min(1,p.o.t("workflow_detail_node_error_name_empty")).regex(v,p.o.t("workflow_detail_node_error_format")),children:u.z.array(m).optional()}).passthrough()),f=(e,t)=>t?null==e?void 0:e.map(e=>{var t;return(0,d._)((0,o._)({},e),{children:null==e?void 0:null===(t=e.children)||void 0===t?void 0:t.filter(e=>(null==e?void 0:e.name)!=="errorBody")})}):null==e?void 0:e.filter(e=>(null==e?void 0:e.name)!=="errorBody"),g=e=>{var t,{value:n,formValues:o}=e,{settingOnErrorIsOpen:r=!1}=null!==(t=(0,c.Z)(o,"settingOnError"))&&void 0!==t?t:{},a=(0,c.Z)(o,"batchMode"),i=u.z.array(m).safeParse(r?f(n,"batch"===a):n);if(!i.success)return JSON.stringify(i.error)}},14751:function(e,t,n){n.d(t,{m:()=>i});var o=n("808549"),r=n("151064"),a=n("288323");function i(e){return function(t){return(0,r.jsx)(a.X_,{children:(0,r.jsx)(e,(0,o._)({},t))})}}},587256:function(e,t,n){n.d(t,{qD:()=>i,Hg:()=>l});var o=n("450562"),r=n("155440"),a=n("664278"),i=(e,t)=>{if(!!(null==t?void 0:t.type)&&e.type!==o.YX3.REF&&void 0!==e.content){var n,r,i=a.N.DTOTypeToViewType(t.type,{arrayItemType:null===(n=t.schema)||void 0===n?void 0:n.type,assistType:null===(r=t.schema)||void 0===r?void 0:r.assistType});return[o.owu.Number,o.owu.Integer].includes(i)?Number(e.content):o.owu.Boolean===i?!!e.content||"false"!==e.content:e.content}},l=e=>{var{minimum:t,maximum:n,exclusiveMinimum:o,exclusiveMaximum:a,bizExtend:i,enum:l,enumVarNames:s,defaultValue:d}=e||{},u=!!l,c=!(0,r.Z)(t)&&!(0,r.Z)(n);if(u)return{key:"Select",optionList:l.map((e,t)=>({value:e,label:(null==s?void 0:s[t])||"".concat(e)})),defaultValue:d};if(c){var p=1;try{p=JSON.parse(i||"{}").step}catch(e){return}var v=o?t+p:t;return{key:"Slider",min:v,max:a?n-p:n,step:p,defaultValue:d||v}}}},165395:function(e,t,n){n.d(t,{v:()=>v});var o=n("808549"),r=n("671261"),a=n("385647"),i=n("422133"),l=n("237191"),s=e=>((0,r.Z)(e,"formMeta.validate.settingOnError",l._),e),d=e=>{if(!(0,a.Hz)(e.type))return e;var t=e.meta||{};return!t.useDynamicPort&&(0,r.Z)(e,"meta",(0,o._)({},t,{useDynamicPort:!0,defaultPorts:[{type:"input"},{type:"output"}]})),e},u=e=>{var t=e.formMeta,n=null==t?void 0:t.formatOnInit,a=null==t?void 0:t.formatOnSubmit;return(0,r.Z)(e,"formMeta.formatOnInit",(e,t)=>{var r=n?n(e,t):e;return r?(0,o._)({},r,(0,i.kI)(e,t)):r}),(0,r.Z)(e,"formMeta.formatOnSubmit",(e,t)=>{var n=(0,o._)({},e),l=a?a(n,t):n;return(0,r.Z)(l,"inputs.settingOnError",(0,i.Yf)(n,t).settingOnError),l}),e},c=e=>(0,a.lt)(e.type)?(s(e),u(e),d(e),e):e,p=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>t.reduce((e,t)=>t(e),e)},v={processNodeRegistry:e=>p(v.setNodeSettingOnError)(e),setNodeSettingOnError:e=>c(e)}},950499:function(e,t,n){n.d(t,{n:function(){return r}});var o=n(470248),r=()=>e=>{var{value:t,context:n}=e,r=(0,o.g)({value:t,context:n,options:{}});if(!0!==r)return r}},899450:function(e,t,n){n.d(t,{H:()=>l,W0:()=>a,vu:()=>o.v});var o=n("264219"),r=n("629600"),a=e=>t=>{var{value:n,context:o}=t;return(0,r.a)({value:n,options:e,context:o})},i=n("336205"),l=e=>t=>{if((null==e?!void 0:!e.fieldEnabled)||!!(null==e?void 0:null===(n=e.fieldEnabled)||void 0===n?void 0:n.call(e,t))){var n,{value:o}=t;if(!o)return i.o.t("workflow_detail_node_error_empty")}}},66856:function(e,t,n){n.d(t,{v:()=>p,c:()=>v});var o=n("736892"),r=n("450562"),a=n("151064"),i=n("686436"),l=n("676255"),s=n("167985"),d=n("288323"),u=()=>(0,a.jsx)(d.X_,{}),c={render:()=>(0,a.jsx)(u,{}),validateTrigger:i.C$.onChange,validate:{nodeMeta:l.O},effect:{nodeMeta:s.Jr},formatOnInit:e=>e,formatOnSubmit:e=>e},p={type:r.nyy.Continue,meta:{isNodeEnd:!0,hideTest:!0,nodeDTOType:r.nyy.Continue,defaultPorts:[{type:"input"}],size:{width:360,height:67.86},nodeMetaPath:o.je},formMeta:c,getOutputPoints:()=>[]};function v(){return(0,a.jsx)(a.Fragment,{})}},646909:function(e,t,n){n.d(t,{ID:function(){return a},Ox:function(){return l},nv:function(){return s},v3:function(){return i},wC:function(){return d}});var o=n(336205),r=n(345053),a="inputs.inputParameters",i="inputs.terminatePlan",l="inputs.content",s="inputs.streamingOutput",d=[{value:r.u.ReturnVariables,label:o.o.t("workflow_241111_02")},{value:r.u.UseAnswerContent,label:o.o.t("workflow_241111_03")}]},510149:function(e,t,n){n.d(t,{z:()=>S,r:()=>j});var o=n("736892"),r=n("450562"),a=n("808549"),i=n("120454"),l=n("151064"),s=n("962289"),d=n("686436"),u=n("676255"),c=n("899450"),p=n("167985"),v=n("101626"),m=n("345053"),f=n("336205"),g=n("14751"),h=n("489350"),_=n("646909"),y=()=>(0,l.jsx)(v.m8,{name:_.v3,options:{direction:"horizontal",mode:"button",options:_.wC}}),x=(0,g.m)(()=>{var e,t=(0,h.qo)(_.v3),n=(0,h.qo)(_.ID),{getNodeSetterId:o}=(0,r.FCD)(),a=o("");return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(y,{}),(0,l.jsx)(v.Go,{name:_.ID,title:f.o.t("workflow_detail_end_output"),tooltip:f.o.t("workflow_detail_end_output_tooltip"),isTree:!0,testId:a}),t===m.u.UseAnswerContent?(0,l.jsx)(v.j4,{editorFieldName:_.Ox,switchFieldName:_.nv,title:f.o.t("workflow_detail_end_answer"),tooltip:f.o.t("workflow_detail_end_answer_tooltip"),enableStreamingOutput:!0,switchLabel:f.o.t("workflow_message_streaming_name"),switchTooltip:f.o.t("workflow_message_streaming_tooltips"),testId:"/".concat(_.Ox.split(".").join("/")),switchTestId:null===(e=_.nv.split("."))||void 0===e?void 0:e.at(-1),inputParameters:n}):null]})}),w=n("671261"),b={render:()=>(0,l.jsx)(x,{}),validateTrigger:d.C$.onChange,validate:(0,i._)((0,a._)({nodeMeta:u.O},(0,v.U4)(!0)),{"inputs.content":(0,c.H)({fieldEnabled:e=>{var{formValues:t}=e;return(0,s.Z)(t,"inputs.terminatePlan")===m.u.UseAnswerContent}})}),effect:{nodeMeta:p.Jr},formatOnInit:(e,t)=>{var{playgroundContext:n}=t,{isChatflow:o}=n.globalState,r=(0,i._)((0,a._)({},e),{inputs:(0,i._)((0,a._)({},null==e?void 0:e.inputs),{content:(0,s.Z)(e,"inputs.content.value.content")})});return void 0===r.inputs.inputParameters&&(0,w.Z)(r,"inputs.inputParameters",[{name:"output"}]),void 0===r.inputs.streamingOutput&&(0,w.Z)(r,"inputs.streamingOutput",o),void 0===r.inputs.terminatePlan&&(0,w.Z)(r,"inputs.terminatePlan",o?m.u.UseAnswerContent:m.u.ReturnVariables),r},formatOnSubmit:e=>{var t,n=(0,s.Z)(e,"nodeMeta"),{terminatePlan:o,inputParameters:a,streamingOutput:i,content:l}=null!==(t=e.inputs)&&void 0!==t?t:{};return o===m.u.ReturnVariables?{nodeMeta:n,inputs:{terminatePlan:o,inputParameters:a}}:{nodeMeta:n,inputs:{terminatePlan:o,streamingOutput:i,inputParameters:a,content:{type:r.Rkg.string,value:{type:"literal",content:l}}}}}},j={type:r.nyy.End,meta:{isNodeEnd:!0,deleteDisable:!0,copyDisable:!0,headerReadonly:!0,nodeDTOType:r.nyy.End,size:{width:360,height:78.2},nodeMetaPath:o.je,inputParametersPath:_.ID,defaultPorts:[{type:"input"}],helpLink:"/open/docs/guides/start_end_node"},formMeta:b},k=n("288323"),N=n("850624");function S(){return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(k.EU,{label:f.o.t("workflow_detail_node_output")}),(0,l.jsx)(N.u,{})]})}},345053:function(e,t,n){n.d(t,{u:function(){return r}});var o,r=((o={}).ReturnVariables="returnVariables",o.UseAnswerContent="useAnswerContent",o)},785953:function(e,t,n){n.d(t,{Cd:function(){return i},WP:function(){return s},af:function(){return a},es:function(){return l},gF:function(){return r}});var o,r=((o={}).Input="Input",o.Update="Update",o),a=e=>'<svg width="14" height="14" viewBox="0 0 14 14" fill="none"  xmlns="http://www.w3.org/2000/svg">\n<path d="M7.0026 13.4154C10.5464 13.4154 13.4193 10.5425 13.4193 6.9987C13.4193 3.45487 10.5464 0.582031 7.0026 0.582031C3.45878 0.582031 0.585938 3.45487 0.585938 6.9987C0.585938 10.5425 3.45878 13.4154 7.0026 13.4154Z" fill="#FF7300"/>\n<path d="M6.9974 4.08203C6.67523 4.08203 6.41406 4.3432 6.41406 4.66536V7.58203C6.41406 7.9042 6.67523 8.16536 6.9974 8.16536C7.31956 8.16536 7.58073 7.9042 7.58073 7.58203V4.66536C7.58073 4.3432 7.31956 4.08203 6.9974 4.08203Z" fill="white"/>\n<path d="M6.9974 8.7487C6.67523 8.7487 6.41406 9.00987 6.41406 9.33203C6.41406 9.6542 6.67523 9.91537 6.9974 9.91537C7.31956 9.91537 7.58073 9.6542 7.58073 9.33203C7.58073 9.00987 7.31956 8.7487 6.9974 8.7487Z" fill="white"/>\n</svg>\n',i=e=>'<svg width="14" height="14" viewBox="0 0 16 16" fill="none"  xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M2.00008 1.33301C1.2637 1.33301 0.666748 1.92996 0.666748 2.66634V12.6663C0.666748 13.4027 1.2637 13.9997 2.00008 13.9997H14.0001C14.7365 13.9997 15.3334 13.4027 15.3334 12.6663V3.99967C15.3334 3.26329 14.7365 2.66634 14.0001 2.66634H8.00008L7.05727 1.72353C6.80722 1.47348 6.46809 1.33301 6.11446 1.33301H2.00008ZM8.00008 3.99967C7.64646 3.99967 7.30732 3.8592 7.05727 3.60915L6.11446 2.66634L2.00008 2.66634L2.00008 12.6663H14.0001V3.99967H8.00008Z" fill="'.concat(e,'" fill-opacity="0.9" style="fill:').concat(e,';fill-opacity:0.9;"/>\n</svg>\n'),l=e=>'<svg width="14" height="14" viewBox="0 0 16 16" fill="none"  xmlns="http://www.w3.org/2000/svg">\n<path d="M6 8.66634H10C11.841 8.66634 14 9.95205 14 12.2663V13.333C14 14.0663 13.4 14.6663 12.6667 14.6663H3.33333C2.6 14.6663 2 14.0663 2 13.333V12.2663C2 9.95399 4.15905 8.66634 6 8.66634ZM12.6667 13.333V12.2219C12.6667 10.8209 11.2473 9.99967 10 9.99967H6C4.77998 9.99967 3.33333 10.7808 3.33333 12.2219V13.333H12.6667ZM8 7.99967C6.15905 7.99967 4.66667 6.50729 4.66667 4.66634C4.66667 2.82539 6.15905 1.33301 8 1.33301C9.84095 1.33301 11.3333 2.82539 11.3333 4.66634C11.3333 6.50729 9.84095 7.99967 8 7.99967ZM8 6.66634C9.10457 6.66634 10 5.77091 10 4.66634C10 3.56177 9.10457 2.66634 8 2.66634C6.89543 2.66634 6 3.56177 6 4.66634C6 5.77091 6.89543 6.66634 8 6.66634Z" fill="'.concat(e,'" fill-opacity="0.9" style="fill:').concat(e,';fill-opacity:0.9;"/>\n</svg>\n'),s=e=>'<svg width="14" height="14" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M2.88563 13.156L2.67821 12.9301C1.95205 12.1391 1.40724 11.1957 1.08784 10.1654L0.997803 9.875L2.36317 8.00027L0.997803 6.12554L1.08784 5.83509C1.40724 4.80479 1.95205 3.86139 2.67821 3.07043L2.88563 2.84451L5.18017 3.0953L6.11215 0.970749L6.41099 0.90347C6.92883 0.786888 7.46082 0.727539 8.00006 0.727539C8.5393 0.727539 9.07129 0.786888 9.58912 0.90347L9.88797 0.970749L10.8199 3.0953L13.1145 2.84451L13.3219 3.07043C14.0481 3.86139 14.5929 4.80479 14.9123 5.83509L15.0023 6.12554L13.6369 8.00027L15.0023 9.875L14.9123 10.1654C14.5929 11.1957 14.0481 12.1391 13.3219 12.9301L13.1145 13.156L10.8199 12.9052L9.88797 15.0298L9.58912 15.0971C9.07129 15.2136 8.5393 15.273 8.00006 15.273C7.46082 15.273 6.92883 15.2136 6.41099 15.0971L6.11215 15.0298L5.18017 12.9052L2.88563 13.156ZM5.20903 11.6827C5.63977 11.6356 6.05124 11.8735 6.22531 12.2704L6.97227 13.9731C7.30917 14.0313 7.65258 14.0608 8.00006 14.0608C8.34754 14.0608 8.69095 14.0313 9.02785 13.9731L9.77481 12.2704C9.94888 11.8735 10.3603 11.6356 10.7911 11.6827L12.6272 11.8834C13.0707 11.3496 13.4204 10.7431 13.659 10.0895L12.5628 8.58427C12.3093 8.23618 12.3093 7.76428 12.5628 7.41619L13.659 5.91097C13.4204 5.25737 13.0707 4.65084 12.6272 4.11707L10.7911 4.31776C10.3603 4.36484 9.94888 4.12691 9.77481 3.7301L9.02785 2.02731C8.69095 1.96913 8.34754 1.93962 8.00006 1.93962C7.65258 1.93962 7.30917 1.96913 6.97227 2.02731L6.22531 3.7301C6.05124 4.12691 5.63977 4.36484 5.20903 4.31776L3.37288 4.11707C2.92942 4.65084 2.57977 5.25737 2.34108 5.91097L3.43733 7.41619C3.69085 7.76428 3.69085 8.23618 3.43733 8.58427L2.34108 10.0895C2.57977 10.7431 2.92942 11.3496 3.37288 11.8834L5.20903 11.6827ZM8.00006 11.0306C6.3322 11.0306 4.9813 9.6732 4.9813 8.00026C4.9813 6.32732 6.3322 4.96996 8.00006 4.96996C9.66792 4.96996 11.0188 6.32732 11.0188 8.00026C11.0188 9.6732 9.66792 11.0306 8.00006 11.0306ZM8.00006 9.81849C8.99719 9.81849 9.8067 9.0051 9.8067 8.0003C9.8067 6.9955 8.99719 6.18212 8.00006 6.18212C7.00293 6.18212 6.19342 6.9955 6.19342 8.0003C6.19342 9.0051 7.00293 9.81849 8.00006 9.81849Z" fill="'.concat(e,'" fill-opacity="0.9" style="fill:').concat(e,';fill-opacity:0.9;"/>\n</svg>\n')},130989:function(e,t,n){n.d(t,{Er:function(){return p},SH:function(){return d},W3:function(){return s},_p:function(){return m},dU:function(){return v},ed:function(){return g},oW:function(){return f},zA:function(){return c}});var o=n(455069),r=n(318293),a=n(306215),i=n(562312),l=n(785953);function s(e,t,n){var{globalVariableKey:o,nodePart:r,fieldPart:a,parsedKeyPath:i}=t,l={iconUrl:"",nodeTitle:"",isValid:!!n,globalVariableKey:o,parsedKeyPath:"",isVariableExist:!1};return e.forEach(e=>{var t=e.expressionPath.source===r;(!l.iconUrl||!l.nodeTitle)&&t&&(l.iconUrl=e.iconUrl,l.nodeTitle=e.nodeTitle,l.isVariableExist=!0);var n=null==i?void 0:i.join(".");l.parsedKeyPath=o?n:a}),l}function d(e){var t=[],n=(0,i.qz)(e).cursor();do!function(){var o,r;if("Interpolation"===n.name&&(null===(o=n.node.firstChild)||void 0===o?void 0:o.name)==="{{"&&(null===(r=n.node.lastChild)||void 0===r?void 0:r.name)==="}}"){var i=n.node.firstChild.to,l=n.node.lastChild.from,s=e.sliceDoc(i,l),d=s.match("^(".concat(a.On,"\\d+)\\.?"));if(null===a.kA||void 0===a.kA||a.kA.forEach(e=>{var t=s.match("^(".concat(e,")"));t&&(d=t)}),d){var{length:u}=d[0];t.push({source:{from:n.from,to:i+u},target:{from:n.from,to:n.to}}),t.push({source:{from:l,to:n.node.lastChild.to},target:{from:n.from,to:n.to}})}}}();while(n.next());return t}var u="coz-mg-primary";function c(e,t){if(!e)return;var n=e.querySelectorAll(null!=t?t:".semi-list-item");if(0!==n.length){var o=[...n],r=o.findIndex(e=>e.classList.contains(u));return{elements:o,selectedIndex:r,selectedElement:o[r]}}}function p(e,t){var n=e[t];if(!!n)e.forEach(e=>{e.classList.contains(u)&&e.classList.remove(u)}),n.classList.add(u),n.scrollIntoView({behavior:"smooth",block:"nearest"})}function v(e){var t=(0,o.useRef)(e);return t.current=e,t}function m(e){return e.isUserEvent("api.skip-selection-change")}function f(e){var t,n,o,i,l="",s="",d="",u=e.match("^(".concat(a.On,"\\d+)\\.?"));null===a.kA||void 0===a.kA||a.kA.forEach(t=>{var n=e.match("^(".concat(t,")"));n&&(u=n,l=t)}),d=null==u?void 0:u[0],s=null==u?void 0:u[1];var c=(0,r.Z)(null==s?void 0:s.split("_"));if(u){;n=e.slice(d.length,e.length),i=l?(t=(t=n).slice(2,-2)).split('"]["').map(e=>"".concat(e)):[],o=l?[s].concat(i):[c].concat(n.split("."))}return{nodeId:c,nodeName:s,nodeNameWithDot:d,fieldPart:n,fieldKeyPath:o,parsedKeyPath:i,globalVariableKey:l}}var g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#080D1E";return{delete:(0,l.af)(e),[a.fK.App]:(0,l.Cd)(e),[a.fK.System]:(0,l.es)(e),[a.fK.User]:(0,l.WP)(e)}}},161607:function(e,t,n){n.d(t,{p:function(){return l}});var o=n(808549),r=n(120454),a=n(306215),i=e=>{var{variable:t}=e,n="";return!function e(t){var o;(null==t?void 0:t.key)&&(n+="".concat(t.key," ")),(null==t?void 0:t.children)&&(null==t?void 0:null===(o=t.children)||void 0===o?void 0:o.length)>0&&t.children.forEach(t=>e(t))}(null==t?void 0:t.viewMetaWithUniqKey),n};function l(e,t){return e.map(e=>{var n,l,s=e.node,d=e.groupInfo.key,u=e.groupInfo.label,c=e.groupInfo.icon;if(!e.globalVariableKey){var p,v,m=t(s);u=null!==(v=null==m?void 0:m.nodeTitle)&&void 0!==v?v:""}var f=e.globalVariableKey?e.expressionPath.source:a.On+(null!==(n=null===(p=e.expressionPath.keyPath)||void 0===p?void 0:p[0])&&void 0!==n?n:"");return{keyString:i({variable:e}),expressionPath:(0,r._)((0,o._)({},e.expressionPath),{source:f}),nodeId:d,iconUrl:c,nodeTitle:u,globalVariableKey:null!==(l=e.globalVariableKey)&&void 0!==l?l:""}})}},703188:function(e,t,n){n.d(t,{CH:function(){return v},Gr:function(){return s},bD:function(){return c},bp:function(){return f},dc:function(){return u},eA:function(){return p},pY:function(){return d},pt:function(){return m},w$:function(){return l}});var o,r,a,i,l=((o={}).GET="GET",o.POST="POST",o.PUT="PUT",o.DELETE="DELETE",o.PATCH="PATCH",o.HEAD="HEAD",o);var s=((r={}).BasicAuth="BASIC_AUTH",r.Bearer="BEARER_AUTH",r.Custom="CUSTOM_AUTH",r),d={BASIC_AUTH:"node_http_auth_basic",BEARER_AUTH:"node_http_auth_bearer",CUSTOM_AUTH:"node_http_auth_custom"},u={BASIC_AUTH:"basicAuthData",BEARER_AUTH:"bearerTokenData",CUSTOM_AUTH:"customData"};var c=((a={}).Header="header",a.Query="query",a);var p=((i={}).Empty="EMPTY",i.Json="JSON",i.FormData="FORM_DATA",i.FormUrlEncoded="FORM_URLENCODED",i.RawText="RAW_TEXT",i.Binary="BINARY",i),v={EMPTY:"empty",JSON:"json",FORM_DATA:"formData",FORM_URLENCODED:"formURLEncoded",RAW_TEXT:"rawText",BINARY:"binary"},m={EMPTY:"node_http_body_none",JSON:"node_http_body_json",FORM_DATA:"node_http_body_form_data",FORM_URLENCODED:"node_http_body_form_urlencoded",RAW_TEXT:"node_http_body_raw_text",BINARY:"node_http_body_binary"},f={"text/plain":"RAW_TEXT","multipart/form-data":"FORM_DATA","application/json":"JSON","application/x-www-form-urlencoded":"FORM_URLENCODED","application/octet-stream":"RAW_TEXT",Empty:"EMPTY"}},709253:function(e,t,n){n.d(t,{P:()=>G,X:()=>$});var o=n("736892"),r=n("450562"),a=n("151064"),i=n("813864"),l=n("686436"),s=n("676255"),d=n("167985"),u=n("737805"),c=n("336205"),p=n("288323"),v=n("101626"),m=n("801815"),f="condition";(0,m.x0)(),r.owu.ArrayObject,(0,m.x0)(),r.owu.String,(0,m.x0)(),r.owu.String;var g=n("455069"),h=n("706489"),_=n("489350"),y=(0,_.Q2)(()=>(0,a.jsx)(h.E,{collapsible:!1,portInfo:{portID:"false",portType:"output"},style:{border:"1px solid rgba(var(--coze-stroke-6),var(--coze-stroke-6-alpha))",background:"rgba(var(--coze-bg-3),1)",borderRadius:8,paddingLeft:12,margin:0},headerStyle:{marginBottom:0},header:c.o.t("workflow_detail_condition_else")},"FormCard")),x=n("184449"),w=n("808549"),b=n("120454"),j=n("615655"),k=n("405816"),N=n.n(k),S=n("788377"),C=n("300108"),I=n("172107"),T=n("447303"),P=n("857689"),D=n("253826"),E=n("513537"),O=n("297727"),L=n("830208"),M="true";function F(e){var{value:t=[],onChange:n,readonly:o}=e,i=(0,l.PF)(),{getNodeTestId:s,concatTestId:d}=(0,r.FCD)(),[u,p]=(0,g.useState)((null!=t?t:[]).map((e,t)=>(0,b._)((0,w._)({},e),{uid:t}))),[v,m]=(0,g.useState)(),{expanded:h}=(0,x.d1)(),_=e=>0===e?M:"".concat(M,"_").concat(e),y=(0,x.M_)(_),{validateResults:k,initValidateResultsWithBranches:F,validateAllBranches:Z}=(0,C.L)();(0,g.useEffect)(()=>{F(t||[])},[]),(0,g.useEffect)(()=>{void 0===v?(Z(u),null==n||n(u.map(e=>({condition:e.condition})))):Z(u)},[u,v]),(0,g.useEffect)(()=>{!(0,j.Z)(t,u.map(e=>({condition:e.condition})))&&p((null!=t?t:[]).map((e,t)=>(0,b._)((0,w._)({},e),{uid:t})))},[t]),(0,S.n)(u,{onDataRenamed:e=>{p(e)}});var R=e=>t=>{p(u.map((n,o)=>o===e?t:n))},V=()=>{var e=(null!=u?u:[]).reduce((e,t)=>{var{uid:n}=t;return n&&e.push(n),e},[]);return e.length?Math.max(...e)+1:1},A=e=>()=>{y(e,t.length),p(u.filter((t,n)=>n!==e))},z=(0,g.useCallback)((e,t)=>{p(n=>N()(n,{$splice:[[e,1],[t,0,n[e]]]}))},[]),B=(e,t)=>{m(void 0),setTimeout(()=>{y(e,t)},0)},U=(null!=u?u:[]).find(e=>e.uid===v),q=(null!=u?u:[]).findIndex(e=>e.uid===v);return(0,a.jsx)("div",{className:"mt-3",style:{borderBottomWidth:0,paddingBottom:0},children:(0,a.jsxs)(O.W,{value:{flowNodeEntity:i,readonly:o,expanded:h,setterPath:d(s(),"/".concat(f))},children:[h?(0,a.jsx)(L.i,{onAdd:()=>{p(u.concat([{uid:V(),condition:{logic:I.L.AND,conditions:[{left:void 0,operator:void 0,right:void 0}]}}]))}}):null,(0,a.jsxs)(P.C,{children:[null==u?void 0:u.map((e,t)=>(0,a.jsx)(E.H,{index:t,isFirstBranch:0===t,showDraggable:u.length>1,priority:u.length>1?t+1:void 0,prefixName:0===t?c.o.t("worklfow_condition_if",{},"If"):c.o.t("worklfow_condition_else_if",{},"Else if"),portId:_(t),branch:e,onChange:R(t),onDelete:A(t),deletable:u.length>1,branchValidateResult:k[t],onDragStart:m,onDragEnd:B,onMoveBranch:z},e.uid)),(0,a.jsx)(T.B,{preview:void 0!==v&&U?(0,a.jsx)(D.T,{index:q,priority:q+1,prefixName:0===q?c.o.t("worklfow_condition_if",{},"If"):c.o.t("worklfow_condition_else_if",{},"Else if"),portId:_(q),branch:U}):null})]})]})})}var Z=n("855062"),R=e=>{var{value:t,onChange:n}=e,o=(e,o)=>r=>{var a,i,l=null==t?void 0:t[e],s=null==l?void 0:null===(i=l.condition)||void 0===i?void 0:null===(a=i.conditions)||void 0===a?void 0:a.map((e,t)=>t===o?(0,w._)({},r):e);null==n||n(null==t?void 0:t.map((t,n)=>n===e?{condition:(0,b._)((0,w._)({},t.condition),{conditions:s})}:t))};return(0,a.jsx)(a.Fragment,{children:null==t?void 0:t.map((e,t)=>e.condition.conditions.map((e,n)=>(0,a.jsx)(Z._,{data:e,onDataChange:o(t,n)})))})},V=(0,_.Q2)(()=>{var{value:e,onChange:t,readonly:n}=(0,_.U$)(),{isNewNodeRender:o}=(0,x.$v)();return o?(0,a.jsx)(R,{value:e,onChange:t}):(0,a.jsx)(F,{value:e,onChange:t,readonly:null!=n&&n})}),A=()=>(0,a.jsxs)(p.X_,{children:[(0,a.jsx)(V,{name:f,hasFeedback:!1}),(0,a.jsx)(y,{name:"else"}),(0,a.jsx)(v.Nn,{title:c.o.t("workflow_detail_node_output"),tooltip:c.o.t("node_http_response_data"),id:"if-node-outputs",name:"outputs",topLevelReadonly:!0,customReadonly:!0})]}),z=n("473980"),B=n("155440"),U=n("788637"),q=n("793003"),W={render:()=>(0,a.jsx)(A,{}),validateTrigger:l.C$.onChange,validate:{nodeMeta:s.O,[f]:e=>{var{value:t,context:n}=e,{node:o,playgroundContext:r}=n,a=(0,u.Y6)(t,o,r),l=(0,i.Z)(a).reduce((e,t)=>{var n,o,r,a,i,l,s,d,u,c=e;return(null==t?void 0:null===(n=t.left)||void 0===n?void 0:n.message)&&(c=c?"".concat(c,";").concat(null==t?void 0:null===(a=t.left)||void 0===a?void 0:a.message):null==t?void 0:null===(i=t.left)||void 0===i?void 0:i.message),(null==t?void 0:null===(o=t.operator)||void 0===o?void 0:o.message)&&(c=c?"".concat(c,";").concat(null==t?void 0:null===(l=t.operator)||void 0===l?void 0:l.message):null==t?void 0:null===(s=t.operator)||void 0===s?void 0:s.message),(null==t?void 0:null===(r=t.right)||void 0===r?void 0:r.message)&&(c=c?"".concat(c,";").concat(null==t?void 0:null===(d=t.right)||void 0===d?void 0:d.message):null==t?void 0:null===(u=t.right)||void 0===u?void 0:u.message),c},"");return l||void 0}},effect:{nodeMeta:d.Jr,outputs:d.mw},formatOnInit:(e,t)=>{if(!e)return{condition:[{condition:{logic:2,conditions:[{left:void 0,operator:void 0,right:void 0}]}}]};var n,o=e||{},{inputs:r}=o,a=(0,z._)(o,["inputs"]);return(0,b._)((0,w._)({},a),{condition:(0,B.Z)(null==r?void 0:r.branches)?void 0:(null!==(n=null==r?void 0:r.branches)&&void 0!==n?n:[]).map((e,n)=>{var o,r;return{condition:{logic:e.condition.logic,conditions:(null===(r=e.condition)||void 0===r?void 0:null===(o=r.conditions)||void 0===o?void 0:o.map(e=>"right"in e?{operator:e.operator?Number(e.operator):e.operator,left:q.t.refExpressionDTOToVO(e.left,t),right:q.t.refExpressionDTOToVO(e.right,t)}:{operator:e.operator?Number(e.operator):e.operator,left:q.t.refExpressionDTOToVO(e.left,t)}))||[]}}})})},formatOnSubmit:(e,t)=>{var n=e||{},{condition:o}=n,r=(0,z._)(n,["condition"]),a=(0,w._)({},r);return a.inputs={},o&&!(0,U.Z)(o)&&(a.inputs.branches=o.map(e=>{var n,o;return{condition:{logic:e.condition.logic,conditions:null===(o=e.condition)||void 0===o?void 0:null===(n=o.conditions)||void 0===n?void 0:n.map(e=>{var n=q.t.refExpressionToValueDTO(e.left,t),o=q.t.refExpressionToValueDTO(e.right,t);return{operator:e.operator,left:n,right:o}})}}})),a}},G={type:r.nyy.If,meta:{nodeDTOType:r.nyy.If,style:{width:850},size:{width:o.gu.width,height:116.7},nodeMetaPath:o.je,outputsPath:o.G0,useDynamicPort:!0,defaultPorts:[{type:"input"}],helpLink:"/open/docs/guides/condition_node"},formMeta:W},H=n("399226");function $(){return(0,a.jsx)(H.G3,{})}},43519:function(e,t,n){n.d(t,{t:()=>T,j:()=>P});var o=n("736892"),r=n("450562"),a=n("686436"),i=n("370354"),l=n("151064"),s=n("676255"),d=n("899450"),u=n("167985"),c=n("801815"),p=n("336205"),v=n("288323"),m=n("489350"),f=n("101626"),g="inputs.inputParameters",h=[{key:(0,c.x0)(),name:"data",type:r.owu.Image},{key:(0,c.x0)(),name:"msg",type:r.owu.String}],_=n("825955"),y=n("808549"),x=n("120454"),w=n("455069"),b=n("184449"),j=(0,w.lazy)((0,_._)(function*(){var{Canvas:e}=yield n.e("3215").then(n.bind(n,836117));return{default:e}})),k=(0,m.Q2)(e=>{var t=(0,b.u6)({needNullType:!0,needNullName:!0});return(0,l.jsx)(w.Suspense,{fallback:(0,l.jsx)("div",{children:"canvas loading..."}),children:(0,l.jsx)(j,(0,x._)((0,y._)({},e),{variables:t}))})}),N=()=>(0,l.jsxs)(v.X_,{children:[(0,l.jsx)(f.Go,{name:g,title:p.o.t("imageflow_canvas_element_set"),tooltip:p.o.t("imageflow_canvas_elment_tooltip"),paramsTitle:p.o.t("imageflow_canvas_element_name"),expressionTitle:p.o.t("imageflow_canvas_element_desc"),defaultValue:[],onAppend:()=>({id:(0,c.x0)()}),disabledTypes:r.owu.getComplement([r.owu.String,r.owu.Image]),literalDisabled:!0}),(0,l.jsx)(m.$0,{title:p.o.t("imageflow_canvas_edit"),tooltip:p.o.t("imageflow_canvas_desc"),children:(0,l.jsx)(k,{name:"inputs.canvasSchema"})}),(0,l.jsx)(f.Nn,{title:p.o.t("workflow_detail_node_output"),tooltip:p.o.t("node_http_response_data"),id:"imageCanvas-node-outputs",name:"outputs",topLevelReadonly:!0,customReadonly:!0})]}),S=n("664278"),C={width:1920,height:1080,objects:[],backgroundColor:"#ffffffff",background:"#ffffffff",version:"6.0.0-rc2"},I={render:()=>(0,l.jsx)(N,{}),validateTrigger:a.C$.onChange,validate:{nodeMeta:s.O,"inputs.inputParameters.*.input":(0,d.vu)({required:!0})},effect:{nodeMeta:u.Jr,outputs:u.mw},formatOnInit:(e,t)=>{var n;if(!e)return{inputs:{inputParameters:[],canvasSchema:JSON.stringify(C)},outputs:h};if(null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.inputParameters){var{variableService:o}=t.playgroundContext,r=e=>e?null===S.N||void 0===S.N?void 0:S.N.valueExpressionToVO(e,o):void 0;e.inputs.inputParameters=e.inputs.inputParameters.map(e=>(0,x._)((0,y._)({},e),{input:r(e.input)}))}return e},formatOnSubmit:(e,t)=>{var n;if(null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.inputParameters){var{variableService:o}=t.playgroundContext,r=(e,n,r)=>({name:e,input:S.N.valueExpressionToDTO(n,o,{node:null==t?void 0:t.node}),id:r});e.inputs.inputParameters=e.inputs.inputParameters.map(e=>{var t;return r(null!==(t=e.name)&&void 0!==t?t:"",e.input,e.id)})}return e}},T={type:r.nyy.ImageCanvas,meta:{nodeDTOType:r.nyy.ImageCanvas,size:{width:360,height:130.7},nodeMetaPath:o.je,outputsPath:o.G0,inputParametersPath:g,test:{generateFormInputProperties(e){var t,n=e.getData(a.Ps).formModel.getFormItemValueByPath("/"),o=null==n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.inputParameters;return(0,i.ee)(o,{node:e})}},helpLink:"/open/docs/guides/canvas_node"},formMeta:I,variablesMeta:{inputsPathList:[],outputsPathList:["outputs"]}};function P(){return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(v.EU,{}),(0,l.jsx)(v.yC,{})]})}},986999:function(e,t,n){n.d(t,{p:()=>y,o:()=>w});var o=n("736892"),r=n("450562"),a=n("151064"),i=n("686436"),l=n("676255"),s=n("899450"),d=n("167985"),u=n("336205"),c=n("14751"),p=n("101626"),v=(0,c.m)(()=>(0,a.jsx)(p.Nn,{id:"input-node-output",name:"outputs",title:u.o.t("workflow_detail_node_parameter_input"),tooltip:u.o.t("workflow_241120_01"),addItemTitle:u.o.t("workflow_add_input"),withDescription:!0,withRequired:!0,allowDeleteLast:!0,emptyPlaceholder:u.o.t("workflow_start_no_parameter"),maxLimit:20,hasFeedback:!1})),m=n("808549"),f=n("120454"),g=n("664278"),h=[{key:(0,i.x0)(),name:"input",type:r.owu.String,required:!0}],_={render:()=>(0,a.jsx)(v,{}),validateTrigger:i.C$.onChange,validate:{nodeMeta:l.O,outputs:(0,s.W0)({uniqueName:!0})},defaultValues:{outputs:h},effect:{nodeMeta:d.Jr,outputs:d.mw},formatOnSubmit:e=>{var t;return(0,f._)((0,m._)({},e),{inputs:{outputSchema:JSON.stringify((null===(t=e.outputs)||void 0===t?void 0:t.map(e=>g.N.viewMetaToDTOMeta(e)))||[])}})}},y={type:r.nyy.Input,meta:{nodeDTOType:r.nyy.Input,size:{width:360,height:78.7},nodeMetaPath:o.je,outputsPath:o.G0,test:{generateFormInputProperties:()=>({})},helpLink:"/open/docs/guides/input_node"},variablesMeta:r.VKi.DEFAULT,formMeta:_},x=n("288323");function w(){return(0,a.jsx)(x.yC,{label:u.o.t("workflow_detail_node_parameter_input")})}},813026:function(e,t,n){n.d(t,{_:()=>eg,U:()=>e_});var o=n("736892"),r=n("450562"),a=n("686436"),i=n("370354"),l=n("151064"),s=n("962289"),d=n("676255"),u=n("155440"),c=n("336205"),p=(e,t,n)=>{var o=(0,s.Z)(e,"name"),r=(null==n?void 0:n.split("."))||[],a=r[r.length-1],i=null==t?void 0:t.map(e=>null==e?void 0:e.name);return(!(0,u.Z)(a)&&(null==i||i.splice(Number(a),1)),o&&""!==o.trim())?o.length>1e3?c.o.t("workflow_intent_matchlist_error2"):i&&i.includes(n)?c.o.t("workflow_ques_ans_testrun_dulpicate",{},"选项内容不可重复"):void 0:c.o.t("workflow_intent_matchlist_error1")},v=n("899450"),m=n("167985"),f=n("288323"),g=n("455069"),h=n("101626");function _(){return(0,l.jsx)(h.Nn,{title:c.o.t("workflow_detail_node_output"),tooltip:c.o.t("workflow_intent_output_tooltips"),id:"intent-node-outputs",name:"outputs",topLevelReadonly:!0,customReadonly:!0})}var y=n("801815"),x="inputs.inputParameters",w="inputs.chatHistorySetting.enableChatHistory",b="intentMode",j="intents",k="quickIntents",N="systemPrompt",S=[{label:c.o.t("workflow_detail_node_parameter_name"),style:{width:148}},{label:c.o.t("workflow_detail_end_output_value")}],C=e=>[{key:(0,y.x0)(),name:"classificationId",type:r.owu.Integer},e===o.yp.STANDARD?{key:(0,y.x0)(),name:"reason",type:r.owu.String}:""].filter(Boolean),I=n("489350");function T(){return(0,I.qo)({name:b})===o.yp.STANDARD&&(0,l.jsx)(h.L2,{required:!0,name:"model",title:c.o.t("workflow_detail_llm_model")})}function P(){return null}var D=n("405816"),E=n.n(D),O=n("252237"),L=n.n(O),M=n("915757"),F=n("674343"),Z=n("184449"),R=n("58946"),V=n("66483"),A=n("808549"),z=n("120454"),B=n("646201"),U=n("184877"),q=n("168628"),W=n("877484"),G=e=>{var{content:t,portId:n,readonly:o=!1,disableDelete:a,onChange:i,onDelete:s,optionPlaceholder:d,optionEnableInterpolation:u,errors:c,onFocus:p,onBlur:v,testIdPath:m,name:f=""}=e,{getNodeSetterId:g,concatTestId:h}=(0,r.FCD)();return(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-1 w-full min-h-[24px]",children:[o?(0,l.jsx)("div",{className:"w-full",children:t}):(0,l.jsx)(q.i,{name:f,testId:m,value:t,onChange:e=>{null==i||i(e)},onFocus:()=>null==p?void 0:p(),onBlur:()=>null==v?void 0:v(),isError:c&&(null==c?void 0:c.length)>0,readonly:o,minRows:1,placeholder:d,disableSuggestion:!u,className:"!p-[4px]",containerClassName:L()("!rounded-[6px]",W.Z["option-expression-editor"],u?"":W.Z["expression-editor-no-interpolation"])}),(0,l.jsx)("div",{children:s&&!o?(0,l.jsx)(F.hU,{size:"small",color:"secondary","data-testid":h(g("answer-option-item-delete"),n||""),className:L()("flex",{"cursor-pointer":!a,"cursor-not-allowed":a,"text-[--semi-color-tertiary-active]":a}),onClick:()=>{if(!a)s()},icon:(0,l.jsx)(M.ruq,{className:"text-sm"})}):null})]}),(0,l.jsx)(U.P,{errors:c})]})},H=(0,I.Q2)(e=>{var{onBlur:t,onFocus:n,errors:o}=(0,I.U$)();return(0,l.jsx)(G,(0,z._)((0,A._)({},e),{errors:o,onFocus:n,onBlur:t}))}),$=(0,g.forwardRef)((e,t)=>{var{canDrag:n,portId:o,readonly:a=!1,className:i,optionName:s,showOptionName:d,isField:u,name:c}=e,{getNodeSetterId:p,concatTestId:v}=(0,r.FCD)();return(0,l.jsxs)("div",{className:L()("flex items-start space-x-1 text-xs",i),children:[(0,l.jsx)("div",{className:"flex w-4 min-w-4 shrink-0 mt-[4px]",children:n?(0,l.jsx)(B.Z,{"data-testid":v(p("answer-option-item-handle"),o||""),"data-disable-node-drag":"true",className:L()({"cursor-move":!a,"pointer-events-none":a}),ref:t,style:{color:"#aaa"}}):null}),d?(0,l.jsx)("div",{className:"break-keep min-w-[75px] mt-[5px]",children:s}):null,u&&c?(0,l.jsx)(H,(0,z._)((0,A._)({},e),{name:c,hasFeedback:!1})):(0,l.jsx)(G,(0,A._)({},e))]})}),J=(0,I.Q2)(e=>{var{value:t,onChange:n,readonly:o,name:a}=(0,I.U$)(),{showTitleRow:i=!0,showOptionName:s=!0,optionPlaceholder:d="",defaultOptionText:p="",optionEnableInterpolation:v,maxItems:m=Number.MAX_SAFE_INTEGER,addButtonClassName:f="",showDisableAddTooltip:g=!0,customDisabledAddTooltip:h,customClassName:_}=e,{getNodeSetterId:y}=(0,r.FCD)(),x=e=>{n(e)},w=(0,Z.M_)(R.n),b=e=>{w(e,t.length),x(E()(t,{$splice:[[e,1]]}))},j=(e,n)=>{x(E()(t,{[n]:{name:{$set:e}}}))},k=(0,l.jsx)(F.hU,{className:L()("absolute right-3 top-3",{[f]:f}),color:"highlight",size:"small",disabled:o||t.length>=m,"data-testid":y("answer-option-add-btn"),onMouseDown:()=>{x([...t,{name:""}])},icon:(0,l.jsx)(M.PwN,{className:"text-sm"})});return(0,l.jsxs)("div",{className:(0,u.Z)(_)?void 0:L()({[_]:_}),children:[i?(0,l.jsxs)("div",{className:"flex items-center text-xs text-[#1D1C23] opacity-60 h-7",children:[(0,l.jsx)("div",{className:"ml-1 w-[71px]",children:c.o.t("workflow_ques_ans_type_option_title",{},"options")}),(0,l.jsx)("div",{className:"ml-6",children:c.o.t("workflow_ques_ans_type_option_content",{},"content")})]}):null,(0,l.jsx)(V.c,{value:t,onChange:x,onDragEnd:w,renderItem:(e,n,r)=>{var{dragRef:i,isPreview:u}=r||{};return(0,l.jsx)($,{name:"".concat(a,".").concat(n),testIdPath:"/".concat(a),ref:i,index:n,content:e.name,onChange:e=>j(e,n),portId:u?void 0:(0,R.n)(n),optionName:(0,R.J)(n),onDelete:u?void 0:()=>b(n),disableDelete:t.length<=1,canDrag:!0,readonly:o,showOptionName:s,optionPlaceholder:d,optionEnableInterpolation:v,isField:!0})}}),(0,l.jsx)($,{className:"mt-2",content:p,optionName:c.o.t("workflow_ques_ans_type_option_other",{},"other"),portId:"default",readonly:!0,showOptionName:s,optionPlaceholder:d}),(0,l.jsx)("div",{className:"mt-2 answer-option-add-button",children:g&&t.length>=m?(0,l.jsx)(F.u,{content:h||c.o.t("workflow_250117_05",{maxCount:m}),children:(0,l.jsx)("div",{className:"absolute right-3 top-3 background w-[24px] h-[24px] coz-mg-hglt coz-fg-hglt-dim p-[5px] rounded-[5px] flex items-center cursor-not-allowed",children:(0,l.jsx)(M.PwN,{className:"text-sm"})})}):k})]})}),Y=()=>{var e=(0,I.qo)({name:b})===o.yp.STANDARD,{getNodeSetterId:t}=(0,r.FCD)();return e&&(0,l.jsx)(I.$0,{title:c.o.t("workflow_intent_matchlist_title"),tooltip:c.o.t("workflow_intent_matchlist_tooltips"),testId:t("/".concat(j)),children:(0,l.jsx)(J,{name:j,showTitleRow:!1,showOptionName:!1,optionPlaceholder:c.o.t("workflow_intent_matchlist_placeholder"),defaultOptionText:c.o.t("workflow_intent_matchlist_else"),optionEnableInterpolation:!1,maxItems:o.E4,customDisabledAddTooltip:c.o.t("workflow_250117_02"),hasFeedback:!1})})},Q=()=>{var e=(0,I.qo)({name:b})===o.yp.MINIMAL,{getNodeSetterId:t}=(0,r.FCD)();return e&&(0,l.jsx)(I.$0,{testId:t("/".concat(k)),title:c.o.t("workflow_intent_matchlist_title"),tooltip:c.o.t("workflow_intent_matchlist_tooltips"),children:(0,l.jsx)(J,{name:k,showTitleRow:!1,showOptionName:!1,optionPlaceholder:c.o.t("workflow_intent_matchlist_placeholder"),defaultOptionText:c.o.t("workflow_intent_matchlist_else"),optionEnableInterpolation:!1,maxItems:o.bZ,customDisabledAddTooltip:c.o.t("workflow_250117_01"),hasFeedback:!1})})},X=n("873538"),K=n("208394"),ee=n("205685"),et=(0,I.Q2)(e=>{var{testId:t}=e,{value:n,onChange:o,readonly:r}=(0,I.U$)();return(0,l.jsx)(F.u,{content:c.o.t("wf_chatflow_125"),position:"right",children:(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)("div",{className:ee.Z["chat-history-text"],children:c.o.t("wf_chatflow_124")}),(0,l.jsx)(F.rs,{"data-testid":t,disabled:r,size:"mini",checked:n,onChange:o})]})})}),en=[{key:(0,y.x0)(),name:"chatHistory",type:r.owu.ArrayObject,children:[{key:(0,y.x0)(),name:"role",type:r.owu.String},{key:(0,y.x0)(),name:"content",type:r.owu.String}]}],eo=(0,I.Q2)(()=>{var e=(0,I.qo)({name:w}),{value:t,onChange:n,readonly:o}=(0,I.U$)();return e?(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(X.G,{id:"chat-history",readonly:!0,value:en,defaultCollapse:!0,onChange:()=>{console.log("OutputTree change")},withDescription:!1,withRequired:!1,noCard:!0}),(0,l.jsx)("div",{className:ee.Z.line}),(0,l.jsx)(K.r,{value:t,readonly:o,onChange:e=>{n(Number(e))}})]}):null}),er=(0,I.lw)(()=>{var{name:e,value:t}=(0,I.Dq)(),n=t||[],{getNodeSetterId:o}=(0,r.FCD)(),{isChatflow:a}=(0,Z.j1)();return(0,l.jsxs)(I.$0,{title:c.o.t("workflow_detail_node_parameter_input"),tooltip:c.o.t("workflow_intent_input_tooltips"),testId:o(e),actions:a?[(0,l.jsx)(et,{name:w,testId:o("chatHistorySetting")})]:[],children:[a?(0,l.jsx)(eo,{name:"inputs.chatHistorySetting.chatHistoryRound"}):null,(0,l.jsx)(I.az,{columns:S}),(0,l.jsx)(I.F3,{children:null==n?void 0:n.map((t,n)=>{var{name:o}=t;return(0,l.jsx)(I.y1,{hiddenRemove:!0,children:(0,l.jsx)(h.se,{label:o,required:!0,name:"".concat(e,".").concat(n,".input")},n)})})})]})});function ea(){return(0,l.jsx)(er,{name:x,defaultValue:[{name:"query"}]})}var ei=n("434647");function el(){var e=(0,I.qo)({name:b})===o.yp.STANDARD,t=(0,I.qo)(x);return e&&(0,l.jsx)(I.$0,{title:c.o.t("workflow_LLM_node_sp_title"),tooltip:c.o.t("workflow_intent_advance_set_tooltips"),children:(0,l.jsx)(h.vQ,{className:"!p-[4px]",required:!1,name:N,placeholder:c.o.t("workflow_intent_advance_set_placeholder"),inputParameters:t,testId:"/".concat(N.split(".").join("/")),containerClassName:ei.Z["option-expression-editor"]})})}var es=()=>(0,l.jsxs)(f.X_,{children:[(0,l.jsx)(T,{}),(0,l.jsx)(P,{}),(0,l.jsx)(ea,{}),(0,l.jsx)(Y,{}),(0,l.jsx)(Q,{}),(0,l.jsx)(el,{}),(0,l.jsx)(_,{})]}),ed=n("335740"),eu=n("734658"),ec=e=>e.every(e=>!e.name),ep=n("529801"),ev=n("664278"),em=n("4450"),ef={render:()=>(0,l.jsx)(es,{}),validateTrigger:a.C$.onChange,validate:{nodeMeta:d.O,"inputs.inputParameters.0.input":(0,v.vu)({required:!0}),["".concat(j,".*")]:e=>{var{value:t,formValues:n,name:r}=e;if((0,s.Z)(n,b)===o.yp.STANDARD)return p(t,(0,s.Z)(n,j),r)},["".concat(k,".*")]:e=>{var{value:t,formValues:n,name:r}=e;if((0,s.Z)(n,b)===o.yp.MINIMAL)return p(t,(0,s.Z)(n,k),r)}},effect:{nodeMeta:m.Jr,outputs:m.mw,[b]:[{effect:e=>{var t,{value:n,context:r}=e,i=n===o.yp.MINIMAL;if(!!(null==r?void 0:r.node)){var l=r.node.getData(a.Ps),s=null===(t=r.node)||void 0===t?void 0:t.getService(eu.O),d=s.getAllLines().filter(e=>e.from.id===r.node.id);setTimeout(()=>{var e=l.formModel.getFormItemByPath(o.G0);e&&(e.value=C(n));var t=l.formModel.getFormItemByPath("/intents"),r=l.formModel.getFormItemByPath("/quickIntents");r&&i&&Array.isArray(r.value)&&r.value.length<=1&&ec(r.value)&&(r.value=(0,ed.Z)(null==t?void 0:t.value.slice(0,10)),d.forEach(e=>{var t,n,o;s.createLine({from:e.from.id,to:null===(t=e.to)||void 0===t?void 0:t.id,fromPort:null===(n=e.info)||void 0===n?void 0:n.fromPort,toPort:null===(o=e.info)||void 0===o?void 0:o.toPort})})),t&&!i&&Array.isArray(t.value)&&t.value.length<=1&&ec(t.value)&&(t.value=(0,ed.Z)(null==r?void 0:r.value),d.forEach(e=>{var t,n,o;s.createLine({from:e.from.id,to:null===(t=e.to)||void 0===t?void 0:t.id,fromPort:null===(n=e.info)||void 0===n?void 0:n.fromPort,toPort:null===(o=e.info)||void 0===o?void 0:o.toPort})})),l.formModel.validate()},200)}},event:a.zE.onValueChange}]},formatOnInit:(e,t)=>{var n,r,a,{playgroundContext:i}=t||{},{inputs:l,nodeMeta:d,outputs:c}=e||{},p=(0,s.Z)(l,"llmParam"),{models:v}=i;!p&&(p=(0,em.Vm)(v));var m=(0,A._)({},p);(0,u.Z)(l);var f=(0,s.Z)(l,"inputParameters",[]),g=(0,s.Z)(l,"mode")||o.yp.STANDARD,h=g===o.yp.MINIMAL,_=[{name:""}],y=(0,s.Z)(l,"intents",_);return{nodeMeta:d,outputs:c||C(g),model:(0,ep.Z)(m,["enableChatHistory","systemPrompt","chatHistoryRound"]),intentMode:g,intents:h?_:y,quickIntents:h?y:_,inputs:{chatHistorySetting:{enableChatHistory:p.enableChatHistory||!1,chatHistoryRound:p.chatHistoryRound||3},inputParameters:0===f.length?[{name:"query"}]:f},systemPrompt:null!==(a=null==p?void 0:null===(r=p.systemPrompt)||void 0===r?void 0:null===(n=r.value)||void 0===n?void 0:n.content)&&void 0!==a?a:""}},formatOnSubmit:(e,t)=>{var n,{playgroundContext:r}=t||{},{model:a,inputs:i,intents:l,quickIntents:s,intentMode:d,systemPrompt:u,nodeMeta:c,outputs:p}=e||{},{chatHistorySetting:v,inputParameters:m}=i||{},{enableChatHistory:f,chatHistoryRound:g}=v||{},{models:h,globalState:_,variableService:y,node:x}=r||{},{isChatflow:w}=_||{},b=h.find(e=>e.model_type===a.modelType),j={type:"literal",content:d===o.yp.MINIMAL?"":u};return{nodeMeta:c,outputs:p,inputs:(0,z._)((0,A._)({},i||{}),{inputParameters:m,llmParam:(0,z._)((0,A._)({},(0,em.PB)(a,b)),{modelName:null!==(n=null==b?void 0:b.name)&&void 0!==n?n:"",prompt:ev.N.valueExpressionToDTO({type:"literal",content:"{{query}}"},y,{node:x}),systemPrompt:ev.N.valueExpressionToDTO(j,y,{node:x}),enableChatHistory:!!w&&!!f,chatHistoryRound:g}),intents:d===o.yp.MINIMAL?s:l,mode:d})}}},eg={type:r.nyy.Intent,meta:{nodeDTOType:r.nyy.Intent,size:{width:o.gu.width,height:156.7},nodeMetaPath:o.je,outputsPath:o.G0,inputParametersPath:x,useDynamicPort:!0,getLLMModelIdsByNodeJSON:e=>{var t,n,o;return null==e?void 0:null===(o=e.data)||void 0===o?void 0:null===(n=o.inputs)||void 0===n?void 0:null===(t=n.llmParam)||void 0===t?void 0:t.modelType},defaultPorts:[{type:"input"}],test:{generateRelatedContext(e,t){var n,o,{isInProject:r,isChatflow:l}=t,s=e.getData(a.Ps).formModel.getFormItemValueByPath("/"),d=null==s?void 0:null===(o=s.inputs)||void 0===o?void 0:null===(n=o.chatHistorySetting)||void 0===n?void 0:n.enableChatHistory;return l&&d?(0,i.UY)({isNeedBot:!r,isNeedConversation:!0}):{}},generateFormInputProperties(e){var t,n=e.getData(a.Ps).formModel.getFormItemValueByPath("/"),o=null==n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.inputParameters;return(0,i.ee)(o,{node:e})}},helpLink:"/open/docs/guides/intent_recognition_node"},formMeta:ef},eh=n("399226");function e_(){return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(f.EU,{}),(0,l.jsx)(f.yC,{}),(0,l.jsx)(eh.WA,{})]})}},32448:function(e,t,n){n.d(t,{p:()=>j,s:()=>k});var o=n("736892"),r=n("450562"),a=n("686436"),i=n("370354"),l=n("151064"),s=n("899450"),d=n("167985"),u=n("336205"),c=n("288323"),p=n("101626"),v=n("801815"),m="inputs.inputParameters",f=[{key:(0,v.x0)(),name:"output",type:r.owu.String}],g=n("240960"),h=n("489350"),_=e=>{var{name:t,defaultValue:n,title:o,tooltip:r,disabledTypes:i,inputPlaceholder:s,literalDisabled:d,showEmptyText:c=!0}=e,v=(0,g.j)();return(0,l.jsx)(a.F2,{name:t,defaultValue:n,children:e=>{var n,{field:a}=e,{value:m=[]}=a,f=null!==(n=null==m?void 0:m.length)&&void 0!==n?n:0;return(0,l.jsx)(h.$0,{title:o,tooltip:r,isEmpty:c&&!f,emptyText:u.o.t("workflow_inputs_empty"),children:(0,l.jsx)(h.oD,{children:a.map((e,n)=>(0,l.jsx)(h.y1,{disableRemove:!0,hiddenRemove:!0,children:(0,l.jsx)("div",{style:{flex:3},children:(0,l.jsx)(p.se,{name:"".concat(t,".").concat(n,".input"),disabledTypes:i,readonly:v,inputPlaceholder:s,literalDisabled:d})})},e.key))})})}})},y=()=>(0,l.jsxs)(c.X_,{children:[(0,l.jsx)(_,{name:m,defaultValue:[{name:"input"}],title:u.o.t("node_http_request_params"),tooltip:u.o.t("workflow_250429_03"),required:!1,layout:"horizontal"}),(0,l.jsx)(p.Nn,{title:u.o.t("workflow_detail_node_output"),tooltip:u.o.t("node_http_response_data"),id:"jsonStringify-node-outputs",name:"outputs",topLevelReadonly:!0,customReadonly:!0})]}),x=n("808549"),w=n("120454"),b={render:()=>(0,l.jsx)(y,{}),validateTrigger:a.C$.onChange,validate:{"inputs.inputParameters.0.input":(0,s.vu)({required:!0})},effect:{nodeMeta:d.Jr,outputs:d.mw},formatOnInit:e=>{var t;return(0,w._)((0,x._)({},null!=e?e:{}),{outputs:null!==(t=null==e?void 0:e.outputs)&&void 0!==t?t:f})},formatOnSubmit:e=>e},j={type:r.nyy.JsonStringify,meta:{nodeDTOType:r.nyy.JsonStringify,size:{width:360,height:130.7},nodeMetaPath:o.je,outputsPath:o.G0,inputParametersPath:m,test:{generateFormInputProperties(e){var t,n=e.getData(a.Ps).formModel.getFormItemValueByPath("/"),o=null==n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.inputParameters;return(0,i.ee)(o,{node:e})}}},formMeta:b};function k(){return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c.EU,{}),(0,l.jsx)(c.yC,{})]})}},399163:function(e,t,n){n.d(t,{g:()=>eo,a:()=>ec});var o,r,a,i,l=n("736892"),s=n("450562"),d=n("825955"),u=n("808549"),c=n("336205"),p=n("686436"),v=n("370354"),m={width:360,height:139.86},f={width:m.width,height:3*m.width/5},g="var_";var h=((o={}).LoopType="inputs.loopType",o.LoopCount="inputs.loopCount",o.LoopArray="inputs.inputParameters",o.LoopVariables="inputs.variableParameters",o.LoopOutputs="outputs",o);var _=((r={}).Array="array",r.Count="count",r.Infinite="infinite",r),y="LoopFunction_",x=e=>y+e,w=e=>e.replace(y,""),b=n("886829"),j=(e,t)=>{var n=e.getData(b.m),o=t.getData(b.m),r=n.getNodeData();if(!!r)o.setNodeData({title:c.o.t("workflow_loop_body_canva"),description:c.o.t("workflow_loop_body_canva_tips"),icon:r.icon,mainColor:r.mainColor})},k=n("816697");var N=(a=(0,d._)(function*(e){yield(0,k.gw)(30);var{document:t,loopId:n,loopFunctionId:o}=e;t.linesManager.createLine({from:n,to:o,fromPort:"loop-output-to-function",toPort:"loop-function-input"})}),function(e){return a.apply(this,arguments)}),S=e=>{var{id:t,position:n}=e;return{id:t,type:p.Sy.SUB_CANVAS,data:{},meta:{isContainer:!0,position:n,nodeDTOType:p.Sy.SUB_CANVAS,useDynamicPort:!0,disableSideSheet:!0,renderKey:p.kD.SUB_CANVAS,size:{width:f.width,height:f.height},defaultPorts:[{type:"input",portID:"loop-function-input",disabled:!0},{type:"input",portID:"loop-function-inline-input"},{type:"output",portID:"loop-function-inline-output"}],padding:e=>({top:100,bottom:60,left:100,right:100}),selectable:(e,t)=>!t||!e.getData(p.eG).bounds.contains(t.x,t.y),renderSubCanvas:()=>({title:c.o.t("workflow_loop_body_canva"),tooltip:c.o.t("workflow_loop_body_canva_tips"),style:{minWidth:f.width,minHeight:f.height},renderPorts:[{id:"loop-function-input",type:"input",style:{position:"absolute",left:"50%",top:"0"}},{id:"loop-function-inline-input",type:"input",style:{position:"absolute",right:"0",top:"50%",transform:"translateY(20px)"}},{id:"loop-function-inline-output",type:"output",style:{position:"absolute",left:"0",top:"50%",transform:"translateY(20px)"}}]}),subCanvas:e=>{var t=w(e.id),n=e.document.getNode(t);if(!!n)return{isCanvas:!0,parentNode:n,canvasNode:e}}}}};var C=(i=(0,d._)(function*(e,t){var n,o,r,a,i=e.document,l="".concat(y).concat(e.id),s={x:(null===(o=t.meta)||void 0===o?void 0:null===(n=o.position)||void 0===n?void 0:n.x)||0,y:(null===(a=t.meta)||void 0===a?void 0:null===(r=a.position)||void 0===r?void 0:r.y)||0},d=0,u=200,c=S({id:l,position:{x:s.x+d,y:s.y+u},loopNode:e}),p=yield i.createWorkflowNode(c);j(e,p),N({document:i,loopId:e.id,loopFunctionId:p.id})}),function(e,t){return i.apply(this,arguments)}),I=n("151064"),T=n("676255"),P=n("167985"),D=n("962289"),E=n("638284"),O=(0,E.e)({getNames:e=>{var t,n,{value:o,formValues:r}=e;return[...null!==(t=(0,D.Z)(r,h.LoopArray))&&void 0!==t?t:[],...null!==(n=(0,D.Z)(r,h.LoopVariables))&&void 0!==n?n:[]].map(e=>e.name).filter(Boolean)},invalidValues:{index:c.o.t("workflow_loop_name_no_index_wrong")}}),L=(0,n("899450").vu)({required:!0}),M=(0,E.e)({getNames:e=>{var t,{value:n,formValues:o}=e;return(null!==(t=(0,D.Z)(o,h.LoopOutputs))&&void 0!==t?t:[]).map(e=>e.name).filter(Boolean)}}),F=n("253921"),Z=n("288323"),R=n("101626"),V=n("455069"),A=()=>{var[e,t]=(0,V.useState)(),n=(0,p.PF)().getData(p.Ps).getFormModel(),o=()=>{var e;return null!==(e=n.getValueIn(h.LoopType))&&void 0!==e?e:_.Array};return(0,V.useLayoutEffect)(()=>{t(o())},[n]),(0,V.useEffect)(()=>{var e=n.onFormValuesChange(e=>{var{name:n}=e;if(n===h.LoopType)t(o())});return()=>e.dispose()},[n]),e},z=e=>{var{name:t}=e;return A()!==_.Array?null:(0,I.jsx)(R.nT,{name:null!=t?t:h.LoopArray,title:c.o.t("workflow_loop_loop_times"),tooltip:c.o.t("workflow_loop_loop_times_tips"),defaultValue:[{name:"input"}],nthCannotDeleted:1,inputProps:{hideDeleteIcon:!0,disabledTypes:s.owu.getComplement(s.owu.getAllArrayType())}})},B=n("164634"),U=n("776274"),q=n("489350"),W=(0,q.Q2)(e=>{var{title:t=c.o.t("workflow_loop_count"),tooltip:n=c.o.t("workflow_loop_count_tooltips"),testId:o}=e,{value:r,onChange:a,readonly:i}=(0,q.U$)(),{getNodeSetterId:l}=(0,s.FCD)();return A()!==_.Count?null:(0,I.jsx)(U.x,{label:t,tooltip:n,layout:"vertical",style:{marginTop:12},labelStyle:{fontSize:12,fontWeight:600,color:"var(--coz-fg-secondary, rgba(6, 7, 9, 0.50))"},children:(0,I.jsx)(B.N,{value:r,onChange:a,testId:null!=o?o:l("loopCount"),disabledTypes:s.owu.getComplement([s.owu.Integer]),readonly:i,inputType:s.owu.Integer,literalConfig:{min:1,max:1e3},literalStyle:{width:"100%"}})})},{defaultValue:{type:s.YX3.LITERAL,content:10}}),G=e=>{var t,n,{name:o,prefix:r,suffix:a,input:i,node:l}=e;return i.type!==s.YX3.REF||(null===(n=i.content)||void 0===n?void 0:null===(t=n.keyPath)||void 0===t?void 0:t[0])!==l.id?"".concat(r).concat(o).concat(a):o.startsWith(g)?o.slice(g.length):o},H=e=>{var{name:t=h.LoopOutputs,title:n=c.o.t("workflow_loop_output"),tooltip:o=c.o.t("workflow_loop_output_tips")}=e;return(0,I.jsx)(R.JY,{name:t,title:n,tooltip:o,defaultValue:[{name:"output"}],nameProps:{initValidate:!0,suffix:"_list",format:G}})},$=e=>{var{title:t=c.o.t("workflow_loop_title"),tooltip:n,testId:o,children:r}=e,{getNodeSetterId:a}=(0,s.FCD)();return(0,I.jsx)(q.$0,{title:t,tooltip:n,testId:a(null!=o?o:""),children:r})},J=n("674343"),Y=[{value:_.Array,label:c.o.t("workflow_loop_type_array")},{value:_.Count,label:c.o.t("workflow_loop_type_count")},{value:_.Infinite,label:c.o.t("workflow_loop_type_infinite")}],Q=(0,q.Q2)(e=>{var{title:t=c.o.t("workflow_loop_type"),tooltip:n=c.o.t("workflow_loop_type_tooltips"),emptyContent:o=c.o.t("workflow_detail_node_nodata"),testId:r}=e,{value:a,onChange:i,readonly:l}=(0,q.U$)(),{getNodeSetterId:d,concatTestId:u}=(0,s.FCD)(),p=u(d("select"),a),v=(0,V.useCallback)(e=>{i(e)},[]);return(0,I.jsx)(U.x,{label:t,tooltip:n,layout:"vertical",labelStyle:{fontSize:12,fontWeight:600,color:"var(--coz-fg-secondary, rgba(6, 7, 9, 0.50))"},children:(0,I.jsx)(J.Ph,{size:"small",value:a,optionList:Y,style:{width:"100%",pointerEvents:l?"none":"auto"},onChange:v,"data-testid":null!=r?r:p,emptyContent:o})})},{defaultValue:_.Array}),X=e=>{var{name:t}=e;return(0,I.jsx)(R.nT,{name:null!=t?t:h.LoopVariables,title:c.o.t("workflow_loop_loop_variables"),tooltip:c.o.t("workflow_loop_loop_variables_tips"),defaultValue:[],showEmptyText:!1,nameProps:{prefix:g}})},K=()=>(0,I.jsxs)(Z.X_,{children:[(0,I.jsxs)(F._,{children:[(0,I.jsxs)($,{children:[(0,I.jsx)(Q,{name:h.LoopType}),(0,I.jsx)(W,{name:h.LoopCount})]}),(0,I.jsx)(z,{name:h.LoopArray}),(0,I.jsx)(X,{name:h.LoopVariables})]}),(0,I.jsx)(H,{name:h.LoopOutputs})]}),ee=n("671261"),et=n("664278"),en={render:()=>(0,I.jsx)(K,{}),validateTrigger:p.C$.onChange,validate:{nodeMeta:T.O,["".concat(h.LoopArray,".*.name")]:e=>{var{formValues:t}=e;if((0,D.Z)(t,h.LoopType)===_.Array)return O(e)},["".concat(h.LoopArray,".*.input")]:e=>{var{formValues:t}=e;if((0,D.Z)(t,h.LoopType)===_.Array)return L(e)},["".concat(h.LoopVariables,".*.name")]:O,["".concat(h.LoopVariables,".*.input")]:L,["".concat(h.LoopOutputs,".*.name")]:M,["".concat(h.LoopOutputs,".*.input")]:L},effect:{nodeMeta:P.Jr,inputs:P.iq,outputs:P.qf},formatOnInit:(e,t)=>{var n,o,r=null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.inputParameters,a=null==e?void 0:e.outputs,i=null==e?void 0:null===(o=e.inputs)||void 0===o?void 0:o.loopCount;return(!Array.isArray(r)||(null==r?void 0:r.length)===0)&&(0,ee.Z)(e,"inputs.inputParameters",[{name:"input"}]),a&&Array.isArray(a)&&a.map((e,n)=>{(0,ee.Z)(a,n,et.N.inputValueToVO(e,t.playgroundContext.variableService))}),i&&(0,ee.Z)(e,"inputs.loopCount",et.N.valueExpressionToVO(i,t.playgroundContext.variableService)),e},formatOnSubmit:(e,t)=>{var n,o,r=null==e?void 0:e.outputs,a=null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.loopCount,i=null==e?void 0:null===(o=e.inputs)||void 0===o?void 0:o.loopType;return r&&Array.isArray(r)&&(r.map((e,n)=>{var o,a,i,l,s,d=et.N.inputValueToDTO(e,t.playgroundContext.variableService,{node:t.node});(null==e?void 0:null===(i=e.input)||void 0===i?void 0:null===(a=i.content)||void 0===a?void 0:null===(o=a.keyPath)||void 0===o?void 0:o[0])!==t.node.id&&(null==d?void 0:d.input)&&((0,ee.Z)(d,"input.schema",{type:null===(l=d.input)||void 0===l?void 0:l.type,schema:null===(s=d.input)||void 0===s?void 0:s.schema}),(0,ee.Z)(d,"input.type","list")),(0,ee.Z)(r,n,d)}),(0,ee.Z)(e,"outputs",r.filter(Boolean))),a&&(0,ee.Z)(e,"inputs.loopCount",et.N.valueExpressionToDTO(a,t.playgroundContext.variableService,{node:t.node})),i!==_.Array&&(0,ee.Z)(e,"inputs.inputParameters",[]),e}},eo={type:s.nyy.Loop,meta:{nodeDTOType:s.nyy.Loop,style:{width:m.width},size:m,nodeMetaPath:l.je,outputsPath:l.G0,inputParametersPath:h.LoopArray,useDynamicPort:!0,defaultPorts:[{type:"input"},{type:"output",portID:"loop-output"},{type:"output",portID:"loop-output-to-function",disabled:!0}],test:{generateRelatedContext:(e,t)=>(0,d._)(function*(){var{isInProject:e,workflowId:n,spaceId:o}=t;if(e)return{};var r=yield(0,v.m7)({workflowId:n,spaceId:o});return(0,v.UY)(r)})(),generateFormSettingProperties(e){var{formModel:t}=e.getData(p.Ps),n=t.getFormItemValueByPath("/inputs");return(null==n?void 0:n.loopType)===_.Count&&(null==n?void 0:n.loopCount)?(0,v.ee)([{name:"loopCount",title:c.o.t("workflow_loop_count"),required:!0,input:n.loopCount}],{node:e}):{}},generateFormInputProperties(e){var t,n,o,r=e.getData(p.Ps).formModel.getFormItemValueByPath("/"),a=null==r?void 0:null===(t=r.inputs)||void 0===t?void 0:t.inputParameters,i=null==r?void 0:null===(n=r.inputs)||void 0===n?void 0:n.variableParameters;return(0,u._)({},(null==r?void 0:null===(o=r.inputs)||void 0===o?void 0:o.loopType)===_.Array?(0,v.ee)(a,{node:e}):{},(0,v.ee)(i,{node:e}))}},subCanvas:e=>{var t=x(e.id),n=e.document.getNode(t);if(!!n)return{isCanvas:!1,parentNode:e,canvasNode:n}},helpLink:"/open/docs/guides/loop_node"},variablesMeta:{outputsPathList:[],inputsPathList:[h.LoopArray,h.LoopVariables]},formMeta:en,onCreate(e,t){C(e,t)}},er=n("399226"),ea=n("339328"),ei=n("255481"),el=e=>{var{label:t=c.o.t("workflow_detail_node_parameter_input")}=e,n=(0,s.rsR)(),o=A()===_.Array,r=n.inputParameters,a=(0,ei.l)(r),i=!a||0===a.length;return o?(0,I.jsx)(er.gN,{label:t,isEmpty:i,children:(0,I.jsx)(ea._,{value:a})}):(0,I.jsx)(I.Fragment,{})},es=n("109207"),ed=()=>(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(es.G,{id:"loop-output-to-function",type:"output",style:{position:"absolute",width:20,height:20,right:"unset",top:"unset",bottom:0,left:"50%",transform:"translate(-50%, 50%)"}}),(0,I.jsx)(es.G,{id:"loop-output",type:"output",style:{position:"absolute",right:"0"}})]}),eu=()=>{var e,{data:t,type:n}=(0,s.rsR)(),o=(0,ei.l)(null==t?void 0:null===(e=t.inputs)||void 0===e?void 0:e.variableParameters);if(n!==s.nyy.Loop)return null;var r=c.o.t("workflow_loop_loop_variables"),a=!o||0===o.length;return(0,I.jsx)(er.gN,{label:r,isEmpty:a,children:(0,I.jsx)(ea._,{value:o})})},ec=()=>(0,I.jsxs)(F._,{children:[(0,I.jsx)(el,{}),(0,I.jsx)(eu,{}),(0,I.jsx)(er.yC,{}),(0,I.jsx)(ed,{})]})},253313:function(e,t,n){n.d(t,{w:()=>E,o:()=>O});var o=n("736892"),r=n("450562"),a=n("336205"),i=n("686436"),l=n("370354"),s=n("151064"),d=n("676255"),u=n("899450"),c=n("167985"),p=n("288323"),v=n("101626"),m=n("801815"),f="inputs.inputParameters",g=[{key:(0,m.x0)(),name:"outputList",type:r.owu.ArrayObject,children:[{key:(0,m.x0)(),name:"output",type:r.owu.String},{key:(0,m.x0)(),name:"date",type:r.owu.String}]}],h=[{label:a.o.t("workflow_detail_node_parameter_name"),style:{width:148}},{label:a.o.t("workflow_detail_end_output_value")}];n("455069");var _=n("839974"),y=n("184449"),x=n("489350"),w=n("674343"),b=(0,x.Q2)(()=>{var{name:e,value:t,onChange:n,readonly:o}=(0,x.U$)(),{getNodeSetterId:i}=(0,r.FCD)();return(0,s.jsx)(w.u,{content:a.o.t("wf_chatflow_125"),position:"right",children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"text-[12px]",children:a.o.t("wf_chatflow_124")}),(0,s.jsx)(w.rs,{size:"mini",checked:t,"data-testid":i(e),onChange:e=>{null==n||n(e)},disabled:o})]})})}),j=n("873538"),k=n("208394"),N=[{key:(0,m.x0)(),name:"chatHistory",type:r.owu.ArrayObject,children:[{key:(0,m.x0)(),name:"role",type:r.owu.String},{key:(0,m.x0)(),name:"content",type:r.owu.String}]}],S=(0,x.Q2)(e=>{var{showLine:t}=e,{value:n,onChange:o,readonly:r}=(0,x.U$)();return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(j.G,{id:"chat-history",readonly:!0,value:N,defaultCollapse:!0,onChange:()=>{},withDescription:!1,withRequired:!1,noCard:!0}),t?(0,s.jsx)("div",{className:"h-px -mt-[3px] mb-[14px] bg-[#FFF]"}):null,(0,s.jsx)(k.r,{value:n,readonly:r,onChange:e=>{o(Number(e))}})]})}),C=(0,x.lw)(e=>{var{inputType:t,disabledTypes:n}=e,{name:o,value:i}=(0,x.Dq)(),l=i||[],{getNodeSetterId:d}=(0,r.FCD)(),{isChatflow:u}=(0,y.j1)(),c=(0,x.qo)("inputs.historySetting.enableChatHistory"),p=(0,_.L)();return(0,s.jsxs)(x.$0,{title:a.o.t("workflow_detail_node_parameter_input"),tooltip:a.o.t("ltm_240826_01"),testId:d(o),actions:[u&&p["bot.automation.ltm_enhance"]?(0,s.jsx)(b,{name:"inputs.historySetting.enableChatHistory"}):null],children:[(0,s.jsx)(x.az,{columns:h}),(0,s.jsx)(x.F3,{children:null==l?void 0:l.map((e,r)=>{var{name:a}=e;return(0,s.jsx)(x.y1,{hiddenRemove:!0,children:(0,s.jsx)(v.se,{label:a,required:!0,inputType:t,disabledTypes:n,name:"".concat(o,".").concat(r,".input")},r)})})}),u?(0,s.jsx)("div",{className:"mt-[4px]",children:c?(0,s.jsx)(S,{name:"inputs.historySetting.chatHistoryRound",showLine:!0}):null}):null]})}),I=()=>(0,s.jsxs)(p.X_,{children:[(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)(C,{name:f,inputType:r.owu.String,disabledTypes:r.owu.getComplement([r.owu.String]),defaultValue:[{name:"Query"}]})}),(0,s.jsx)(v.Nn,{title:a.o.t("workflow_detail_node_output"),tooltip:a.o.t("ltm_240826_02"),id:"ltm-node-outputs",name:"outputs",topLevelReadonly:!0,customReadonly:!0})]}),T=["enableChatHistory","chatHistoryRound"],P=[{name:"Query",input:{type:r.YX3.REF}}],D={render:()=>(0,s.jsx)(I,{}),validateTrigger:i.C$.onChange,validate:{nodeMeta:d.O,"inputs.inputParameters.0.input":(0,u.vu)({required:!0})},effect:{nodeMeta:c.Jr,outputs:c.mw},formatOnInit:e=>{var t,n,o,r,a,i,l=null!==(r=null==e?void 0:null===(t=e.inputs)||void 0===t?void 0:t.inputParameters)&&void 0!==r?r:[],s=l.filter(e=>!T.includes(e.name||"")),d=null===(n=l.find(e=>"enableChatHistory"===e.name))||void 0===n?void 0:n.input,u=null===(o=l.find(e=>"chatHistoryRound"===e.name))||void 0===o?void 0:o.input;return{nodeMeta:null==e?void 0:e.nodeMeta,inputs:{inputParameters:0===s.length?P:s,historySetting:{enableChatHistory:!!(null==d?void 0:d.content),chatHistoryRound:null!==(a=null==u?void 0:u.content)&&void 0!==a?a:3}},outputs:null!==(i=null==e?void 0:e.outputs)&&void 0!==i?i:g}},formatOnSubmit:e=>{var{inputParameters:t,historySetting:n}=e.inputs;return(0,_.L)()["bot.automation.ltm_enhance"]&&(t.push({name:"enableChatHistory",input:{content:n.enableChatHistory,type:r.YX3.LITERAL,rawMeta:{type:r.owu.Boolean}}}),t.push({name:"chatHistoryRound",input:{content:n.chatHistoryRound,type:r.YX3.LITERAL,rawMeta:{type:r.owu.Integer}}})),{nodeMeta:null==e?void 0:e.nodeMeta,inputs:{inputParameters:t},outputs:null==e?void 0:e.outputs}}},E={type:r.nyy.LTM,meta:{nodeDTOType:r.nyy.LTM,size:{width:360,height:130.7},nodeMetaPath:o.je,outputsPath:o.G0,inputParametersPath:f,test:{generateRelatedContext(e,t){var{isInProject:n}=t;return n?{}:(0,l.UY)({isNeedBot:!0,hasLTMNode:!0,disableProject:!0,disableProjectTooltip:a.o.t("wf_chatflow_142")})},generateFormInputProperties(e){var t=e.getData(i.Ps).formModel.getFormItemValueByPath("/"),n=null==t?void 0:t.inputs.inputParameters;return(0,l.ee)(n,{node:e})}},helpLink:"/open/docs/guides/ltm_node"},formMeta:D};function O(){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.EU,{}),(0,s.jsx)(p.yC,{})]})}},455262:function(e,t,n){n.d(t,{y:()=>C,W:()=>b});var o=n("736892"),r=n("450562"),a=n("808549"),i=n("151064"),l=n("686436"),s=n("167985"),d=n("676255"),u=n("336205"),c=n("14751"),p=n("489350"),v=n("101626"),m="inputs.inputParameters",f="inputs.content",g="inputs.streamingOutput",h=(0,c.m)(()=>{var e,t=(0,p.qo)(m);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v.Go,{name:m,title:u.o.t("workflow_detail_end_output"),tooltip:u.o.t("workflow_message_variable_tooltips"),isTree:!0},m),(0,i.jsx)(v.j4,{editorFieldName:f,switchFieldName:g,title:u.o.t("workflow_241111_01"),tooltip:u.o.t("workflow_message_anwser_tooltips"),enableStreamingOutput:!0,switchLabel:u.o.t("workflow_message_streaming_name"),switchTooltip:u.o.t("workflow_message_streaming_tooltips"),testId:"/".concat(f.split(".").join("/")),switchTestId:null===(e=g.split("."))||void 0===e?void 0:e.at(-1),inputParameters:t},f)]})}),_=n("120454"),y=n("962289"),x=n("671261"),w={render:()=>(0,i.jsx)(h,{}),validateTrigger:l.C$.onChange,validate:(0,a._)({nodeMeta:d.O},(0,v.U4)(!0)),effect:{nodeMeta:s.Jr},formatOnInit:e=>{var t=(0,_._)((0,a._)({},e),{inputs:(0,_._)((0,a._)({},null==e?void 0:e.inputs),{content:(0,y.Z)(e,"inputs.content.value.content")})});return void 0===t.inputs.inputParameters&&(0,x.Z)(t,"inputs.inputParameters",[{name:"output"}]),t},formatOnSubmit:e=>(0,_._)((0,a._)({},e),{inputs:(0,_._)((0,a._)({},e.inputs),{content:{type:r.Rkg.string,value:{type:"literal",content:e.inputs.content}}})})},b={type:r.nyy.Output,meta:{hideTest:!0,nodeDTOType:r.nyy.Output,size:{width:360,height:78.2},nodeMetaPath:o.je,inputParametersPath:m,helpLink:"/open/docs/guides/message_node"},formMeta:w},j=n("288323"),k=n("189284"),N=n("769834"),S=n("965076");function C(){var[e]=(0,k.V)();return e["bot.automation.output_node_v2"]?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(j.EU,{label:u.o.t("workflow_detail_node_output")}),(0,i.jsx)(S.u,{})]}):(0,i.jsx)(N.E,{})}},490838:function(e,t,n){n.d(t,{Bk:()=>eN,Pv:()=>es,fO:()=>ek});var o,r=n("825955"),a=n("736892"),i=n("450562"),l=n("730274"),s=n("994983"),d=n("801815"),u=n("322512"),c=n("671261"),p=n("953687"),v=n("335740"),m=n("664278"),f=n("364498");function g(e,t){if(!e&&!t)return!1;if((e||[]).length!==(t||[]).length)return!0;for(var n=(0,u.Z)(e,"name"),o=(0,u.Z)(t,"name"),r=!1,a=0;a<n.length;a++){var i=n[a],l=o[a];if(r=i.name!==l.name||i.type!==l.type||g(i.children,l.children))break}return r}function h(e,t,n){var o,r=null===(o=e||[])||void 0===o?void 0:o.find(e=>e.name===t);r&&(0,c.Z)(r,"input.value.content",n)}var _=n("155440");function y(e){return[{name:"apiName",key:"apiName"},{name:"pluginID",key:"pluginID"},{name:"apiID",key:"api_id",optional:!0},{name:"pluginVersion",key:"plugin_version",optional:!0}].reduce((t,n)=>{var o=e.find(e=>e.name===n.name);if(o){var r=i.ycG.toLiteral(o);!(0,_.Z)(r)&&(t[n.key]=r)}return t},{})}var x=n("808549"),w=n("997516"),b=e=>(0,x._)({},(0,w.Z)(e,["icon","description","apiName","pluginID","pluginProductStatus","pluginProductUnlistType","pluginType","spaceID","inputs","outputs","updateTime","plugin_from"])),j=e=>{if(!e||e.projectID)return{};var{latest_version:t,latest_version_name:n,version_name:o}=e;return{latestVersionTs:t,latestVersionName:n,versionName:o}},k=n("718830"),N=[{name:f.b0,generate:k.b},{name:f.n5,generate:k.A}],S=n("686436"),C=n("886829"),I=n("370354"),T=n("151064"),P=n("962289"),D=n("910126"),E=n("676255"),O=n("638284"),L=n("899450"),M=n("167985"),F=n("664319"),Z=n("336205"),R=n("289853"),V=n("288323"),A=n("489350"),z=n("101626"),B=()=>(0,S.G2)(s.LG),U=e=>B().store(e),q="inputs",W="".concat(q,".").concat("inputParameters");"".concat(q,".").concat("apiParam");var G="".concat(q,".").concat("batchMode"),H="".concat(q,".").concat("batch"),$="".concat(H,".").concat("inputLists");Z.o.t("workflow_detail_node_parameter_name"),Z.o.t("workflow_detail_end_output_value");var J={add_text_to_image:"/open/docs/guides/add_text_to_image_plugin",sd_better_prompt:"/open/docs/guides/better_prompt_plugin",cut_image:"/open/docs/guides/cut_image_plugin",add_image_to_image:"/open/docs/guides/add_image_to_image_plugin",resize:"/open/docs/guides/resize_image_plugin",image_rotate:"/open/docs/guides/rotate_image_plugin",FacePretty:"/open/docs/guides/facepretty_plugin",change:"/open/docs/guides/change_image_plugin",text2image:"/open/docs/guides/byteartist_plugin",background_change:"/open/docs/guides/change_background_plugin",spring_pets_image:"/open/docs/guides/pet_image_plugin",gen_image:"/open/docs/guides/doubao_image_plugin",style_transfer:"/open/docs/guides/style_transfer_plugin",light:"/open/docs/guides/light_plugin",image_quality_improve:"/open/docs/guides/improve_image_quality_plugin",image_change:"/open/docs/guides/instruction_editing_plugin",swap_face:"/open/docs/guides/swap_face_plugin",cutout:"/open/docs/guides/cutout_plugin",intelligentImageExpansion:"/open/docs/guides/intelligent_image_expansion_plugin",gen_song:"/open/docs/guides/doubao_song_plugin"},Y=n("455069"),Q=n("834557"),X=n("674343"),K=e=>{var{debugExample:t,inputs:n}=e,{exampleNode:o,doShowExample:r}=(0,Q.p)();return t?(0,T.jsxs)(X.iV,{getPopupContainer:()=>document.body,children:[o,(0,T.jsx)(X.ZT.Text,{className:"cursor-pointer absolute top-[16px] right-[10px] text-xs",onClick:()=>{r({scene:"workflow",requestParams:n,debugExample:t})},link:!0,children:Z.o.t("plugin_edit_tool_view_example")})]}):null},ee=n("157728"),et=n("915757"),en=n("861080"),eo=n("184449"),er=n("672496"),ea=n("117140"),ei=n("382534"),el=new Map;function es(e){var{pluginId:t,needQuery:n}=e,{isLoading:o,data:a}=(0,er.a)({queryKey:["plugin-detail",t],retry:1,queryFn:(0,r._)(function*(){if(!n)return t;if(el.get(t))return el.get(t);var e,o,r=yield ei.yF.PublicGetProductDetail({entity_type:ea._J.Plugin,entity_id:t,need_audit_failed:!0,product_id:""},{__disableErrorToast:!0}),a=null==r?void 0:null===(o=r.data)||void 0===o?void 0:null===(e=o.meta_info)||void 0===e?void 0:e.id;return a&&el.set(t,a),a})});return{isLoading:o,storePluginId:a}}var ed=e=>{var{identifier:t}=e,{getApiNodeDetail:n}=U(e=>({getApiNodeDetail:e.getData})),{getProjectApi:o}=(0,eo.j1)(),[r]=(0,ee.useSearchParams)(),a=r.get("space_id"),{spaceID:i,pluginID:s,projectID:d,pluginProductStatus:u,plugin_from:c}=n(t)||{},p=a===i&&u===en.s7.Default,{isLoading:v,storePluginId:m}=es({pluginId:s||"",needQuery:!p});return v?(0,T.jsx)(et.j2n,{className:"animate-spin text-xs coz-fg-dim"}):(0,T.jsxs)("span",{className:"cursor-pointer flex items-center w-full justify-between",onClick:e=>{var t,n=null===(t=o())||void 0===t?void 0:t.navigate;if(c===l.Xh.FromSaas){var r=window.atob("aHR0cHM6Ly93d3cuY296ZS5jbg==");window.open("".concat(r,"/store/plugin/").concat(s,"?plugin_id=true"),"_blank")}else if(d&&"0"!==d&&n)n("/plugin/".concat(s));else{var a=m&&!p?"/store/plugin/".concat(m):"/space/".concat(i,"/plugin/").concat(s);window.open(a,"_blank")}e.stopPropagation()},children:[Z.o.t("mkpl_plugin_detail",{},"Plugin Detail"),(0,T.jsx)(et.sGJ,{className:"text-xs"})]})},eu=e=>(0,T.jsx)(ed,{identifier:e}),ec=e=>{var t,n,o,{form:r}=e,{loading:a,getApiNodeDetail:i}=U((0,F.N)(e=>({loading:e.loading,getApiNodeDetail:e.getData}))),l=y((null===(n=r.initialValues)||void 0===n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.apiParam)||[]),s=i(l),d=null!==(o=null==s?void 0:s.inputs)&&void 0!==o?o:[],u=(0,A.qo)(G);return a?null:(0,T.jsxs)(V.X_,{extraOperation:(0,T.jsx)(ed,{identifier:l}),batchModePath:G,children:[(0,T.jsx)(z.lf,{name:G}),(0,T.jsx)(R.E,{batchModeName:G,name:"inputs.batch"}),(0,T.jsx)(z.u8,{name:W,inputsDef:d,hasFeedback:!1}),(0,T.jsxs)("div",{className:"relative node-v2-outputs",children:[(0,T.jsx)(z.Nn,{title:Z.o.t("workflow_detail_node_output"),tooltip:Z.o.t("node_http_response_data"),id:"plugin-node-outputs",name:"outputs",batchMode:u,topLevelReadonly:!0,customReadonly:!0}),(0,T.jsx)(K,{inputs:d,debugExample:null==s?void 0:s.debug_example})]})]})},ep=n("120454"),ev=n("316896"),em=n("793003"),ef=n("587256"),eg=e=>e.entityManager.getService(s.LG),eh=e=>{var t;return(null==e?void 0:null===(t=e.inputs)||void 0===t?void 0:t.apiParam)||[]},e_=(e,t)=>{var n=eg(t),o=y(eh(e));return n.getApiDetail(o)},ey=e=>{var t,n,{node:o,context:r,apiDetail:a,nodeMeta:l}=e,{getNodeTemplateInfoByType:s}=r,d=o.getData(C.m);if(d.init(),!a&&l){d.setNodeData((0,x._)({},l));return}var u=b(a);d.setNodeData((0,ep._)((0,x._)({},u,j(a)),{description:a.desc||"",title:a.name||"",icon:a.icon||"",mainColor:null!==(n=null===(t=s(i.nyy.Api))||void 0===t?void 0:t.mainColor)&&void 0!==n?n:"",projectId:a.projectID}))},ex={render:e=>(0,T.jsx)(ec,(0,x._)({},e)),validateTrigger:S.C$.onChange,validate:{nodeMeta:E.O,"inputs.inputParameters.*":(0,L.vu)({required:e=>{var t,{name:n,context:o}=e,{node:r}=o,a=r.getData(C.m).getNodeData(),i=n.replace("inputs.inputParameters.",""),l=null==a?void 0:null===(t=a.inputs)||void 0===t?void 0:t.find(e=>e.name===i);return!!(null==l?void 0:l.required)}}),"inputs.batch.inputLists.*.name":(0,O.e)({getNames:e=>{var{formValues:t}=e;return((0,P.Z)(t,"batch.inputLists")||[]).map(e=>e.name)},skipValidate:e=>{var t,{formValues:n}=e;return(null==n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.batchMode)==="single"}}),"inputs.batch.inputLists.*.input":(0,L.vu)({required:!0,skipValidate:e=>{var t,{formValues:n}=e;return(null==n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.batchMode)==="single"}})},effect:{nodeMeta:M.Jr,[G]:(0,D.Q)(G,$),[$]:(0,D.Q)(G,$),outputs:M.mw},formatOnInit:(e,t)=>{var n,o,r,a,l,s,u,c,_,y,w,b,j,k,S,C,I,T,P,D,{node:E,playgroundContext:O}=t,L=e_(e,O);if(ey({node:E,context:O,apiDetail:L,nodeMeta:e.nodeMeta}),!L)return e;var M=function(e){var t,n,{params:o,inputParameters:r,outputs:a,apiNodeDetail:l,isBatchMode:s}=e,d=null==o?void 0:o.find(e=>"apiName"===e.name),u=(d?i.ycG.toLiteral(d):"")!==l.apiName,c=(r||[]).map(e=>e.name),p=null===(t=l.inputs||[])||void 0===t?void 0:t.map(e=>e.name),v=!c.every(e=>p.includes(e||"")),f=g(s?null==a?void 0:null===(n=a[0])||void 0===n?void 0:n.children:a,(l.outputs||[]).map(m.N.dtoMetaToViewMeta));return u||v||f}({params:null!==(T=null==e?void 0:null===(j=e.inputs)||void 0===j?void 0:j.apiParam)&&void 0!==T?T:[],inputParameters:null!==(P=e.inputs.inputParameters)&&void 0!==P?P:[],outputs:e.outputs,isBatchMode:!!(null===(S=e.inputs)||void 0===S?void 0:null===(k=S.batch)||void 0===k?void 0:k.batchEnable),apiNodeDetail:L});M&&(t.playgroundContext.globalState.inPluginUpdated=!0);var F=M?function(e,t){var n,{apiName:o,updateTime:r,inputs:a,outputs:l}=t,s=(0,v.Z)(e),u=(null==s?void 0:null===(n=s.inputs)||void 0===n?void 0:n.apiParam)||[];return h(u,"apiName",o),h(u,"updateTime",r),!function(e,t){var n;if(null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.inputParameters){var o,r=(0,p.Z)(t,"name");e.inputs.inputParameters=null==e?void 0:null===(o=e.inputs)||void 0===o?void 0:o.inputParameters.filter(e=>r[e.name||""])}}(s,a),!function(e,t){var n,o,r,a,l=!!(null===(o=e.inputs)||void 0===o?void 0:null===(n=o.batch)||void 0===n?void 0:n.batchEnable);if(g(((l?null===(a=e.outputs)||void 0===a?void 0:null===(r=a[0])||void 0===r?void 0:r.children:e.outputs)||[]).filter(e=>![f.b0,f.n5].includes(e.name)),null==t?void 0:t.map(m.N.dtoMetaToViewMeta))){if(t){var s=t.map(m.N.dtoMetaToViewMeta);l?e.outputs=[{key:(0,d.x0)(),type:i.owu.ArrayObject,name:m.N.DEFAULT_OUTPUT_NAME[i.Psf.Batch],children:s}]:e.outputs=s}else e.outputs=[]}}(s,l),s}(e,L):e;n=e,o=F,y=!!(null===(a=(_=(0,v.Z)(o)).inputs)||void 0===a?void 0:null===(r=a.batch)||void 0===r?void 0:r.batchEnable),w=!!(null===(s=_.inputs)||void 0===s?void 0:null===(l=s.settingOnError)||void 0===l?void 0:l.switch),b=(y?null===(c=_.outputs)||void 0===c?void 0:null===(u=c[0])||void 0===u?void 0:u.children:_.outputs)||[],w&&N.forEach(e=>(function(e,t,n){var o,r=null==e?void 0:null===(o=e.outputs)||void 0===o?void 0:o.find(e=>e.name===n.name);!t.find(e=>e.name===n.name)&&t.push(null!=r?r:n.generate())})(n,b,e));var{inputs:Z}=(F=_)||{},R=(null==Z?void 0:Z.inputParameters)||[],{inputs:V,outputs:A}=L,z=(0,ev.x)(V).map(e=>{var{key:t,defaultValue:n}=(0,ef.Hg)(e)||{},o=!!t,r={name:e.name,input:o?n:{type:i.YX3.REF}},a=R.find(t=>t.name===e.name);return a?(o&&(a.input=(0,ef.qD)(a.input,e)),a):r}).reduce((e,t)=>(t.name&&(e[t.name]=t.input),e),{});return{nodeMeta:null==F?void 0:F.nodeMeta,inputs:(0,ep._)((0,x._)({},Z),{batchMode:(null==Z?void 0:null===(C=Z.batch)||void 0===C?void 0:C.batchEnable)?"batch":"single",batch:(null==Z?void 0:null===(I=Z.batch)||void 0===I?void 0:I.batchEnable)?em.t.batchToVO(Z.batch,t):void 0,inputParameters:z}),outputs:null!==(D=null==F?void 0:F.outputs)&&void 0!==D?D:(null!=A?A:[]).map(m.N.dtoMetaToViewMeta)}},formatOnSubmit:(e,t)=>{var n,o,r,{node:a}=t,l=a.getData(C.m).getNodeData(),s=(null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.batchMode)==="batch",d=em.t.batchToDTO(null==e?void 0:null===(o=e.inputs)||void 0===o?void 0:o.batch,t);return{nodeMeta:null==e?void 0:e.nodeMeta,inputs:(0,ep._)((0,x._)({},null==e?void 0:e.inputs),{batchMode:void 0,batch:s&&d?(0,x._)({batchEnable:!0},d):void 0,inputParameters:Object.entries((null==e?void 0:null===(r=e.inputs)||void 0===r?void 0:r.inputParameters)||{}).map(e=>{var t,[n,o]=e,r=null==l?void 0:null===(t=l.inputs)||void 0===t?void 0:t.find(e=>e.name===n),a=r?(0,ef.Hg)(r):{key:void 0},s=!!(null==a?void 0:a.key),d={type:i.YX3.LITERAL,content:"".concat(o)};return{name:n,input:s?d:o}}).filter(e=>e.name)}),outputs:null==e?void 0:e.outputs}}},ew=e=>e.entityManager.getService(s.LG),eb=e=>{var t,n,o;return(null===(n=e.data)||void 0===n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.apiParam)||(null==e?void 0:null===(o=e.inputs)||void 0===o?void 0:o.apiParam)||[]},ej=e=>{var t,n,o;return(null===(n=e.data)||void 0===n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.pluginFrom)||(null==e?void 0:null===(o=e.inputs)||void 0===o?void 0:o.pluginFrom)};var ek={type:i.nyy.Api,meta:{nodeDTOType:i.nyy.Api,size:{width:360,height:130.7},nodeMetaPath:a.je,outputsPath:a.G0,batchPath:a.b2,inputParametersPath:W,test:{generateFormBatchProperties(e){var t,n=e.getData(S.Ps).formModel.getFormItemValueByPath("/inputs/batchMode"),o=null===(t=e.getNodeMeta())||void 0===t?void 0:t.batchPath;if("batch"!==n||!o)return{};var r=e.getData(S.Ps).formModel.getFormItemValueByPath(o);return(0,I.ee)(r,{node:e})},generateFormInputProperties(e){var t,n=e.getData(C.m).getNodeData(),o=null==n?void 0:n.inputs;if(!o||!Array.isArray(o))return{};var r=e.getData(S.Ps).formModel.getFormItemValueByPath("/"),a=(null==r?void 0:null===(t=r.inputs)||void 0===t?void 0:t.inputParameters)||{},i=o.map(e=>({input:a[e.name],name:e.name,required:e.required}));return(0,I.ee)(i,{node:e})}},helpLink:e=>{var{apiName:t}=e;return J[t]||"/open/docs/guides/plugin_node"}},formMeta:ex,onInit:(o=(0,r._)(function*(e,t){if(!!e){var n=ew(t),o=ej(e),r=y(eb(e));yield n.load(r,o)}}),function(e,t){return o.apply(this,arguments)}),checkError:(e,t)=>{if(!!e){var n=ew(t),o=y(eb(e));return n.getApiError(o)}},getHeaderExtraOperation:e=>{var t,n,o,r=y(null!==(o=null==e?void 0:null===(t=e.inputs)||void 0===t?void 0:t.apiParam)&&void 0!==o?o:[]);return(null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.pluginFrom)!==l.Xh.FromSaas?null:eu(r)},onDispose:(e,t)=>{if(!!e){var n=ew(t),o=y(eb(e));n.clearApiError(o)}}};function eN(){var e,{data:t}=(0,i.rsR)(),n=B(),o=y((null==t?void 0:null===(e=t.inputs)||void 0===e?void 0:e.apiParam)||[]),r=(0,S.PF)(),a=(0,eo.Zp)();return(0,Y.useEffect)(()=>{if(!!o){var e=a.onDependencyChange(e=>{var t,a;if(!!(null==e?void 0:null===(a=e.extra)||void 0===a?void 0:null===(t=a.nodeIds)||void 0===t?void 0:t.includes(r.id)))n.load(o)});return()=>{var t;null==e||null===(t=e.dispose)||void 0===t||t.call(e)}}},[o]),(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(V.EU,{}),(0,T.jsx)(V.yC,{})]})}},692883:function(e,t,n){n.d(t,{p:()=>S,M:()=>D});var o=n("736892"),r=n("450562"),a=n("151064"),i=n("686436"),l=n("676255"),s=n("167985"),d=n("336205"),u=n("524705"),c=e=>{var t,n,o,a,i,l,s,d,u,c,{node:p,playgroundContext:v,name:m}=e,f=new r.m_1(p),g=Number(m.slice(23,24)),h=f.getValueByPath("inputs.inputParameters.".concat(g,".left")),_=f.getValueByPath("inputs.inputParameters.".concat(g,".right")),y=null!==(s=null==h?void 0:null===(t=h.content)||void 0===t?void 0:t.keyPath)&&void 0!==s?s:[],x=null!==(d=null==_?void 0:null===(n=_.content)||void 0===n?void 0:n.keyPath)&&void 0!==d?d:[],w=v.variableService.getViewVariableByKeyPath(y,{node:p}),b=v.variableService.getViewVariableByKeyPath(x,{node:p});return{left:w,right:b,leftPath:null==h?void 0:null===(o=h.content)||void 0===o?void 0:o.keyPath,rightPath:null==_?void 0:null===(a=_.content)||void 0===a?void 0:a.keyPath,leftType:null!==(u=null===(i=h.rawMeta)||void 0===i?void 0:i.type)&&void 0!==u?u:null==w?void 0:w.type,rightType:null!==(c=null===(l=_.rawMeta)||void 0===l?void 0:l.type)&&void 0!==c?c:null==b?void 0:b.type}},p=n("288323"),v="inputs.inputParameters",m=n("240960"),f=n("101626"),g=n("425212"),h=n("489350"),_=n("98888"),y=(0,h.Q2)(e=>{var{right:t,inputParameters:n,index:o}=e,l=(0,i.PF)(),{name:s,value:d,onChange:u,readonly:c}=(0,h.U$)(),{getNodeSetterId:p}=(0,r.FCD)(),v=p(s);return(0,a.jsx)(_.r,{value:d,onChange:u,readonly:c,right:t,inputParameters:n,index:o,node:l,testId:v})}),x=e=>{var{name:t,defaultValue:n,title:o=d.o.t("workflow_loop_set_variable_set"),tooltip:r,nthCannotDeleted:l=1}=e,s=(0,m.j)();return(0,a.jsx)(i.F2,{name:t,defaultValue:null!=n?n:[],children:e=>{var t,{field:n}=e,{value:i=[],delete:u,append:c}=n,p=null!==(t=null==i?void 0:i.length)&&void 0!==t?t:0,v=!p,m=l===p;return(0,a.jsxs)(h.$0,{title:o,tooltip:r,actions:s?[]:[(0,a.jsx)(h.HS,{onClick:()=>{c({left:{},right:{}})}})],isEmpty:v,emptyText:d.o.t("workflow_inputs_empty"),children:[(0,a.jsx)(g.b,{columns:[{title:d.o.t("workflow_loop_set_variable_loopvariable"),style:{width:"50%"}},{title:d.o.t("workflow_loop_set_variable_variable"),style:{width:"50%"}}],readonly:s,className:"mb-[8px]",style:{display:v?"none":"flex"}}),(0,a.jsx)(h.oD,{children:n.map((e,t)=>(0,a.jsxs)(h.y1,{disableRemove:m,hiddenRemove:s,onRemove:()=>u(t),children:[(0,a.jsx)("div",{style:{width:"50%"},children:(0,a.jsx)(y,{name:"".concat(e.name,".left"),right:e.value.right,inputParameters:i,index:t})}),(0,a.jsx)("div",{style:{width:"50%"},children:(0,a.jsx)(f.se,{name:"".concat(e.name,".right"),literalDisabled:!0})})]},e.key))})]})}})},w=()=>(0,a.jsx)(p.X_,{children:(0,a.jsx)(x,{name:v})}),b=n("808549"),j=n("120454"),k=n("664278"),N={render:()=>(0,a.jsx)(w,{}),validateTrigger:i.C$.onChange,validate:{nodeMeta:l.O,"inputs.inputParameters.*.left":e=>{var{context:t,value:n,name:o}=e,{playgroundContext:r,node:a}=t,i=(0,u.s)({value:n,playgroundContext:r,node:a,required:!0});if(i)return i;var{left:l,right:s,leftPath:p,rightPath:v,leftType:m,rightType:f}=c({node:a,name:o,playgroundContext:r});return l?s&&m!==f?d.o.t("workflow_loop_set_variable_typewrong"):!p||!v||p.join(".")!==v.join(".")||d.o.t("workflow_loop_set_variable_samewrong"):d.o.t("workflow_detail_node_error_empty")},"inputs.inputParameters.*.right":e=>{var{context:t,value:n,name:o}=e,{playgroundContext:r,node:a}=t,i=(0,u.s)({value:n,playgroundContext:r,node:a,required:!0});if(i)return i;var{right:l}=c({node:a,name:o,playgroundContext:r});return!!l||d.o.t("workflow_detail_node_error_empty")}},effect:{nodeMeta:s.Jr,outputs:s.mw},formatOnInit:(e,t)=>{var n,o,a,i=(null!==(o=null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.inputParameters)&&void 0!==o?o:[]).map(e=>{var n=null==e?void 0:e.left,o=null==e?void 0:e.right;if(!!n&&!!o)return{left:k.N.valueExpressionToVO(n,t.playgroundContext.variableService),right:k.N.valueExpressionToVO(o,t.playgroundContext.variableService)}}).filter(Boolean),l=[{left:{type:r.YX3.REF},right:{type:r.YX3.REF}}];return(0,j._)((0,b._)({},null!=e?e:{}),{inputs:(0,j._)((0,b._)({},null!==(a=null==e?void 0:e.inputs)&&void 0!==a?a:{}),{inputParameters:0===i.length?l:i})})},formatOnSubmit:(e,t)=>{var n,o,r,a=(null!==(o=null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.inputParameters)&&void 0!==o?o:[]).map(e=>{var n,o,r=null==e?void 0:e.left,a=null==e?void 0:e.right;if(!r||!a)return;var i=null===(n=r.content)||void 0===n?void 0:n.keyPath,l=null===(o=a.content)||void 0===o?void 0:o.keyPath;if(!i||!l||!i[0]||!l[0])return;var s=k.N.valueExpressionToDTO(r,t.playgroundContext.variableService,{node:t.node}),d=k.N.valueExpressionToDTO(a,t.playgroundContext.variableService,{node:t.node});if(!!s&&!!d)return{left:s,right:d}}).filter(Boolean);return(0,j._)((0,b._)({},null!=e?e:{}),{inputs:(0,j._)((0,b._)({},null!==(r=null==e?void 0:e.inputs)&&void 0!==r?r:{}),{inputParameters:a})})}},S={type:r.nyy.SetVariable,meta:{hideTest:!0,nodeDTOType:r.nyy.SetVariable,size:{width:360,height:87.86},nodeMetaPath:o.je,outputsPath:o.G0,inputParametersPath:v},variablesMeta:{outputsPathList:[],inputsPathList:[]},formMeta:N},C=n("339328"),I=n("399226"),T=n("184449");function P(){var{inputParameters:e}=(0,r.rsR)(),t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(0,i.PF)(),n=(0,T.M9)();return Array.isArray(e)?e.map(e=>{var o,r,{left:a}=e,i=n.getWorkflowVariableByKeyPath(null==a?void 0:null===(l=a.content)||void 0===l?void 0:l.keyPath,{node:t,checkScope:!0});if(!i){var l,s,d,u,c=null==a?void 0:null===(u=a.content)||void 0===u?void 0:u.keyPath[1];return c?{label:c,invalid:!0}:void 0}var p=null!==(o=null==a?void 0:null===(s=a.rawMeta)||void 0===s?void 0:s.type)&&void 0!==o?o:i.viewType;return{label:null!==(r=null===(d=i.viewMeta)||void 0===d?void 0:d.name)&&void 0!==r?r:i.keyPath[1],type:p}}).filter(Boolean):[]}(e),n=!t||0===t.length;return(0,a.jsx)(I.gN,{label:d.o.t("workflow_loop_set_variable_set"),isEmpty:n,children:(0,a.jsx)(C._,{value:t})})}function D(){return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(P,{})})}},108080:function(e,t,n){n.d(t,{J:()=>q,m:()=>W});var o,r=n("736892"),a=n("450562"),i=n("825955"),l=n("686436"),s=n("1704"),d=n("316896"),u=n("370354"),c=n("151064"),p=n("438111"),v=n("336205"),m=n("994983"),f=n("676255"),g=n("899450"),h=n("167985"),_=n("674343"),y=n("189284"),x=n("14751"),w=n("184449"),b=n("489350"),j=n("279892"),k=n("430859"),N=n("101626"),S=n("288323"),C=n("808549"),I=n("120454"),T=n("455069"),P=n("311807"),D=n("444479"),E=n("346707"),O=n("351600"),L=n("879934");var M=(o=(0,i._)(function*(e){var{workflowId:t,projectId:n,spaceId:o,eventId:r,config:i,parameters:l,isOpen:s,triggerId:d}=e,u=yield a.OHc.SaveTrigger({workflow_id:null!=t?t:"",project_id:null!=n?n:"",space_id:null!=o?o:"",event_id:null!=r?r:"",trigger_id:null!=d?d:"",config:JSON.stringify(i),payload:JSON.stringify(l),status:s?O.ht.Open:O.ht.Close});return null==u?void 0:u.trigger_id}),function(e){return o.apply(this,arguments)}),F=(0,P.Z)(M,1e3);function Z(){return(Z=(0,i._)(function*(e){var t,n,o,{parameters:r,dynamicInputs:a,outputs:i,workflowId:l,projectId:s,spaceId:d,eventId:u,triggerId:c,isOpen:p}=e,v={};null==i||i.forEach(e=>{var t,n=L.e.getVariableName(e);!(0,E.Z)(null==r?void 0:r[n])&&(v[e.name]=null===(t=r[n])||void 0===t?void 0:t.content)});var m={endTime:407088e4,startTime:-1,schedulerType:"custom"};return Object.entries(null!=a?a:{}).forEach(e=>{var t,[n,o]=e;m[n]=null!==(t=null==o?void 0:o.content)&&void 0!==t?t:o}),m[L.e.TriggerFormCronjobName]=null==a?void 0:null===(n=a[L.e.TriggerFormCronjobName])||void 0===n?void 0:null===(t=n.content)||void 0===t?void 0:t.content,m[L.e.TriggerFormCronjobTypeName]=null==a?void 0:null===(o=a[L.e.TriggerFormCronjobName])||void 0===o?void 0:o.type,yield F({workflowId:l,projectId:s,spaceId:d,eventId:u,config:m,parameters:v,isOpen:p,triggerId:c})})).apply(this,arguments)}var R=()=>{var e=(0,l.G2)(m.yM),{dynamicFormMeta:t,eventId:n}=(0,T.useMemo)(()=>{var t=e.getTriggerDynamicFormMeta();return{dynamicFormMeta:null==t?void 0:t.startNodeFormMeta,eventId:null==t?void 0:t[p.e.TriggerFormEventIdName]}},[]),o=e.getStartNodeFormValues(),{triggerId:r}=null!=o?o:{},s=(0,b.qo)("outputs"),d=(0,b.qo)("trigger.isOpen"),u=(0,b.cI)(),c=(0,T.useCallback)(e=>{u.setValueIn("trigger.isOpen",e),x()},[u]),v=(0,b.qo)("trigger"),f=(0,D.Z)(v),g=(0,T.useRef)({}),{workflowId:h,projectId:_,spaceId:y}=(0,w.j1)();(0,T.useEffect)(()=>{g.current={triggerId:r,outputs:s,workflowId:h,projectId:_,spaceId:y,eventId:n}},[h,_,y,r,s,n]);var x=(0,T.useCallback)((0,i._)(function*(){if(f.current){e.setStartNodeFormValues((0,I._)((0,C._)({},f.current),{parameters:u.getValueIn("trigger.parameters"),dynamicInputs:u.getValueIn("trigger.dynamicInputs"),isOpen:u.getValueIn("trigger.isOpen")}));var t,n=yield function(e){return Z.apply(this,arguments)}((0,I._)((0,C._)({},g.current),{parameters:u.getValueIn("trigger.parameters"),dynamicInputs:u.getValueIn("trigger.dynamicInputs"),isOpen:u.getValueIn("trigger.isOpen")}));!(null===(t=g.current)||void 0===t?void 0:t.triggerId)&&(g.current.triggerId=n)}}),[]);return(0,T.useEffect)(()=>{null==s||s.map(e=>{var t=p.e.getVariableName(e);!u.getValueIn("trigger.parameters.".concat(t))&&u.setValueIn("trigger.parameters.".concat(t),{type:a.YX3.LITERAL})})},[null==s?void 0:s.map(e=>p.e.getVariableName(e)).join("")]),{triggerIsOpen:d,setTriggerIsOpen:c,triggerId:r,dynamicFormMeta:t,outputs:s,onDynamicFormChange:(0,P.Z)(x,100)}},V=(0,x.m)(()=>{var e,{isBindDouyin:t,isChatflow:n,projectId:o}=(0,w.j1)(),[r]=(0,y.V)(),i=t?a.vHX:[];i=[a.owu.Voice,a.owu.ArrayVoice];var l=(0,b.qo)("trigger.tab"),{triggerIsOpen:s,setTriggerIsOpen:d,triggerId:u,dynamicFormMeta:m,outputs:f,onDynamicFormChange:g}=R();return(0,c.jsxs)(c.Fragment,{children:[l===p.e.Tab.Trigger&&s?(0,c.jsx)(S.gU,{isBreakLine:!0,className:"!border-b-0 !m-0 !mt-2.5 rounded-lg",text:v.o.t("workflow_user_trigger_banner",{},"设置以后需要发布到对应渠道才能定时生效")}):null,null,(null!=l?l:p.e.Tab.Basic)===p.e.Tab.Basic?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(N.Nn,{id:"start-node-output",name:"outputs",title:v.o.t("workflow_detail_node_parameter_input"),tooltip:v.o.t("workflow_detail_start_input_tooltip"),addItemTitle:v.o.t("workflow_add_input"),withDescription:!0,withRequired:!0,allowDeleteLast:!0,emptyPlaceholder:v.o.t("workflow_start_no_parameter"),hiddenTypes:i,defaultCollapse:!1,needAppendChildWhenNodeIsPreset:void 0,withDefaultValue:!0,columnsRatio:"4:3",hasFeedback:!1}),n&&r["bot.automation.message_auto_write"]?(0,c.jsx)(b.$0,{title:v.o.t("basic_setting"),tooltip:"",children:(0,c.jsx)(N.KV,{customLabel:v.o.t("workflow_250407_001",{},"消息自动写入"),customTooltip:v.o.t("workflow_250407_002"),name:"inputs.auto_save_history",customStyles:{display:"grid",gridTemplateColumns:"auto auto 1fr"},labelStyles:{fontSize:"12px",fontWeight:"normal"},switchCustomStyles:{justifySelf:"end"}})}):null]}):null,l===p.e.Tab.Trigger?(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(b.$0,{title:v.o.t("workflow_start_trigger_setting",{},"触发器设置"),tooltip:v.o.t("workflow_start_trigger_setting_tooltips",{},"选择工作流的启动方式，可以通过预设时间或自定义时间来触发工作流的启动"),actions:[!!s&&(0,c.jsx)(j.BV,{triggerId:u}),(0,c.jsx)(_.rs,{checked:s,onChange:d,size:"mini"})].filter(Boolean),children:s?(0,c.jsx)("div",{className:"flex flex-col gap-[8px]",children:(0,c.jsx)(S.F3,{name:"trigger.dynamicInputs",formMeta:m,components:{Timezone:S.ru,CronJobSelect:S.ml},onChange:g})}):null}),s?(0,c.jsx)(b.$0,{title:v.o.t("parameters",{},"输入"),actions:[],children:(0,c.jsx)("div",{className:"flex flex-col gap-[8px]",children:(0,c.jsx)(k.q,{name:"trigger.parameters",layout:"horizontal",refDisabled:!0,fieldConfig:null==f?void 0:null===(e=f.filter(e=>e.type))||void 0===e?void 0:e.map(e=>{var t;return{label:null==e?void 0:e.name,description:null!==(t=null==e?void 0:e.description)&&void 0!==t?t:"",name:p.e.getVariableName(e),required:!!(null==e?void 0:e.required),type:e.type}}),onChange:g,inputPlaceholder:v.o.t("workflow_trigger_creat_name_placeholder")})})}):null]})}):null]})}),A=n("529801"),z=n("664278"),B=n("839974"),U={render:()=>(0,c.jsx)(V,{}),validateTrigger:l.C$.onChange,validate:{nodeMeta:f.O,outputs:(0,g.W0)({uniqueName:!0}),"trigger.dynamicInputs.*":e=>{var{value:t,formValues:n,context:o,name:r}=e;if(console.log("gjy dynamicInputs",t,r),null==n?void 0:null===(i=n.trigger)||void 0===i?void 0:i.isOpen){var{startNodeFormMeta:a}=o.node.getService(m.yM).getTriggerDynamicFormMeta();if(null===(l=a.find(e=>e.name===(null==r?void 0:r.replace("trigger.dynamicInputs.",""))))||void 0===l?void 0:l.required){var i,l,s,d=!1;return(d="trigger.dynamicInputs.crontab"===r?!(null==t?void 0:null===(s=t.content)||void 0===s?void 0:s.content):!(null==t?void 0:t.content))?v.o.t("workflow_detail_node_error_empty",{},"参数值不可为空"):void 0}}},"trigger.parameters.*":e=>{var t,{value:n,formValues:o,name:r}=e;if((null==o?void 0:null===(t=o.trigger)||void 0===t?void 0:t.isOpen)&&o.outputs.map(e=>p.e.getVariableName(e)).includes(r.replace("trigger.parameters.","")))return(null==n?void 0:n.content)?void 0:v.o.t("workflow_detail_node_error_empty",{},"参数值不可为空")}},effect:{nodeMeta:h.Jr,outputs:h.mw},formatOnInit:(e,t)=>{var n,{playgroundContext:o}=t,{isChatflow:r,readonly:i,projectId:l}=o.globalState,{outputs:s,inputs:d}=e||{},u=(0,I._)((0,C._)({},null!=e?e:{}),{trigger:n,outputs:(s||[]).map(e=>((0,a.GQ8)(e.name)&&(e.isPreset=r,e.enabled=!0,!i&&(e.required=!1)),e))}),c=(0,B.L)();return r&&c["bot.automation.message_auto_write"]&&(u.inputs={auto_save_history:!!(0,E.Z)(null==d?void 0:d.auto_save_history)||!!(null==d?void 0:d.auto_save_history)}),u},formatOnSubmit:e=>{var t,n=e.outputs;e.trigger_parameters=null==n?void 0:null===(t=n.map(t=>{var n,o,r=z.N.viewMetaToDTOMeta(t),a=null==e?void 0:null===(o=e.trigger)||void 0===o?void 0:null===(n=o.parameters)||void 0===n?void 0:n[L.e.getVariableName(t)];if(!(0,E.Z)(a)){var i=null==a?void 0:a.content;return"string"!=typeof i&&(i=JSON.stringify(i)),(0,I._)((0,C._)({},r),{defaultValue:i})}}))||void 0===t?void 0:t.filter(e=>!!e);var{outputs:o}=e;return(0,I._)((0,C._)({},(0,A.Z)(e,"trigger")),{outputs:(o||[]).map(e=>(0,A.Z)(e,["isPreset","enabled"]))})}},q={type:a.nyy.Start,meta:{isStart:!0,nodeDTOType:a.nyy.Start,size:{width:360,height:78.7},deleteDisable:!0,copyDisable:!0,headerReadonly:!0,showTrigger:e=>{var{projectId:t}=e;return!!t&&!1},nodeMetaPath:r.je,outputsPath:r.G0,defaultPorts:[{type:"output"}],helpLink:"/open/docs/guides/start_end_node",test:{testset:!0,generateRelatedContext:(e,t)=>(0,i._)(function*(){var{spaceId:e,workflowId:n,isChatflow:o,isInProject:r}=t;if(r)return(0,u.UY)({isNeedBot:!1});var a=yield(0,u.m7)({spaceId:e,workflowId:n});return a.isNeedConversation=!1,o&&!r&&(a.isNeedBot=!0),(0,u.UY)(a)})(),generateFormInputProperties(e){var t=e.getData(l.Ps).formModel.getFormItemValueByPath("/"),n=((null==t?void 0:t.outputs)||[]).filter(e=>!e.isPreset).map(t=>{var n=e.context.variableService.getWorkflowVariableByKeyPath([e.id,t.name]),{dtoMeta:o}=n,r=(0,s.v)(o);return{name:t.name,title:t.name,type:n.viewType||a.owu.String,defaultValue:t.defaultValue,description:t.description,required:t.required,validateJsonSchema:r,extra:{"x-dto-meta":o}}});return(0,d.x)(n).reduce((e,t)=>(t.name&&(e[t.name]=(0,u.e)(t)),e),{})}}},variablesMeta:a.VKi.DEFAULT,formMeta:U};function W(){return(0,c.jsx)(S.yC,{label:v.o.t("workflow_detail_node_parameter_input")})}},685091:function(e,t,n){n.d(t,{g:()=>eo,l:()=>ee});var o,r=n("825955"),a=n("335740"),i=n("686436"),l=n("736892"),s=n("886829"),d=n("450562"),u=n("801815"),c=n("962289"),p=n("664278"),v=e=>{try{var t,n,o;return(n=new URL(e),null!==(o=void 0===n?void 0:null===(t=n.searchParams)||void 0===t?void 0:t.get("x-wf-file_name"))&&void 0!==o)?o:"unknown"}catch(e){return console.error(e),""}},m=e=>{var{defaultValue:t,assistType:n,type:o}=e;return{type:d.YX3.LITERAL,content:t,rawMeta:{type:p.N.DTOTypeToViewType(o,{assistType:n}),fileName:v(t)}}},f=e=>{var{defaultValue:t,type:n,schema:o}=e,r=JSON.parse(t);return{type:d.YX3.LITERAL,content:r,rawMeta:{type:p.N.DTOTypeToViewType(n,{arrayItemType:null==o?void 0:o.type,assistType:null==o?void 0:o.assistType}),fileName:r.map(v)}}},g=e=>{var t,{defaultValue:n}=e;if(!n)return{type:d.YX3.REF};if(e.type===d.Rkg.list&&(null===(t=e.schema)||void 0===t?void 0:t.assistType))return f(e);if(e.type===d.Rkg.string&&e.assistType)return m(e);if(e.type===d.Rkg.list||e.type===d.Rkg.object)return{type:d.YX3.REF};else return{type:d.YX3.LITERAL,content:p.N.getLiteralValueWithType(e.type,e.defaultValue)}},h=e=>{var t,n;return{workflowId:null!==(t=null==e?void 0:e.workflowId)&&void 0!==t?t:"",workflowVersion:null!==(n=null==e?void 0:e.workflowVersion)&&void 0!==n?n:""}},_=n("90977"),y=n("336205"),x=n("567282"),w=n("370354"),b=n("808549"),j=n("151064"),k=n("237191"),N=n("910126"),S=n("676255"),C=n("638284"),I=n("899450"),T=n("167985"),P=n("664319"),D=n("289853"),E=n("288323"),O=n("101626"),L=()=>(0,i.G2)(_.I),M=e=>L().store(e),F="inputs.inputParameters",Z="inputs.batchMode",R="inputs.batch.inputLists";(0,u.x0)(),d.owu.ArrayObject,(0,u.x0)(),d.owu.String,(0,u.x0)(),d.owu.String,y.o.t("workflow_detail_node_parameter_name"),y.o.t("workflow_detail_end_output_value");var V=n("455069"),A=n("915757"),z=n("184449"),B=e=>{var{workflowDetail:t,identifier:n}=e,{workflowId:o}=n,{getProjectApi:r,spaceId:a}=(0,z.j1)(),i=r(),l=!!(null==t?void 0:t.project_id),s=l?null==t?void 0:t.project_id:void 0,d=(0,V.useMemo)(()=>{var e=l?void 0:t.latest_flow_version,{workflowVersion:o}=n;return o&&o!==e?t.commit_id:void 0},[t,l]),u=e=>{if(s&&(null==i?void 0:i.navigate))null==i||i.navigate("/workflow/".concat(o));else{var t="/work_flow?space_id=".concat(a,"&workflow_id=").concat(o);d&&(t+="&version=".concat(d)),window.open(t,"_blank")}};return(0,j.jsxs)("span",{className:"cursor-pointer flex items-center w-full justify-between",onClick:e=>u(e),children:[y.o.t("workflow_subwf_jump_detail",{},"Workflow Detail"),(0,j.jsx)(A.sGJ,{className:"text-xs"})]})},U=(e,t)=>(0,j.jsx)(B,{workflowDetail:e,identifier:t}),q=e=>{var t,n,o,r,a,l,s,{form:d}=e,{loading:u,getSubWorkflow:c}=M((0,P.N)(e=>({loading:e.loading,getSubWorkflow:e.getData}))),p={workflowId:null!==(a=null==d?void 0:null===(n=d.initialValues)||void 0===n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.workflowId)&&void 0!==a?a:"",workflowVersion:null!==(l=null==d?void 0:null===(r=d.initialValues)||void 0===r?void 0:null===(o=r.inputs)||void 0===o?void 0:o.workflowVersion)&&void 0!==l?l:""},v=c(p),m=null!==(s=null==v?void 0:v.inputs)&&void 0!==s?s:[],f=(0,i.qo)(Z);return u?null:(0,j.jsxs)(E.X_,{extraOperation:(0,j.jsx)(B,{workflowDetail:v,identifier:p}),children:[(0,j.jsx)(O.lf,{name:Z}),(0,j.jsx)(D.E,{batchModeName:Z,name:"inputs.batch"}),(0,j.jsx)(O.u8,{name:F,inputsDef:m,hasFeedback:!1}),(0,j.jsx)(O.Nn,{title:y.o.t("workflow_detail_node_output"),tooltip:y.o.t("node_http_response_data"),id:"subWorkflow-node-outputs",name:"outputs",batchMode:f,topLevelReadonly:!0,customReadonly:!0}),(0,j.jsx)(O.FV,{name:"settingOnError",batchModePath:Z}),(0,j.jsx)("div",{className:"text-[12px] coz-fg-dim hidden",children:"Powered by Flow Engine V2"})]})},W=n("120454"),G=n("529801"),H=n("316896"),$=n("793003"),J=e=>e.entityManager.getService(_.I),Y=(e,t)=>J(t).getApiDetail(e),Q=e=>{var t,n,o,{node:r,context:a,workflow:i,nodeMeta:l}=e,{getNodeTemplateInfoByType:u}=a,c=r.getData(s.m);if(c.init(),!i&&l){c.setNodeData((0,b._)({},l));return}var p=!!(null==i?void 0:i.project_id),v=p?void 0:i.latest_flow_version,m=p?null==i?void 0:i.project_id:void 0;c.setNodeData((0,W._)((0,b._)({},l,(0,G.Z)(i,["inputs","outputs","project_id"])),{inputsDefinition:null!==(n=null==i?void 0:i.inputs)&&void 0!==n?n:[],description:i.desc||"",projectId:m,flow_mode:i.flow_mode,latestVersion:v,mainColor:null!==(o=null===(t=u(d.nyy.SubWorkflow))||void 0===t?void 0:t.mainColor)&&void 0!==o?o:""}))},X={render:e=>(0,j.jsx)(q,(0,b._)({},e)),validateTrigger:i.C$.onChange,validate:{nodeMeta:S.O,"inputs.inputParameters.*":(0,I.vu)({required:e=>{var t,{name:n,context:o}=e,{node:r}=o,a=r.getData(s.m).getNodeData(),i=n.replace("inputs.inputParameters.",""),l=null==a?void 0:null===(t=a.inputsDefinition)||void 0===t?void 0:t.find(e=>e.name===i);return!!(null==l?void 0:l.required)}}),"inputs.batch.inputLists.*.name":(0,C.e)({getNames:e=>{var{formValues:t}=e;return((0,c.Z)(t,"batch.inputLists")||[]).map(e=>e.name)},skipValidate:e=>{var t,{formValues:n}=e;return(null==n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.batchMode)==="single"}}),"inputs.batch.inputLists.*.input":(0,I.vu)({required:!0,skipValidate:e=>{var t,{formValues:n}=e;return(null==n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.batchMode)==="single"}}),settingOnError:k._},effect:{nodeMeta:T.Jr,outputs:T.mw,[Z]:(0,N.Q)(Z,R),[R]:(0,N.Q)(Z,R)},formatOnInit:(e,t)=>{var n,o,r,a,i,l,s,v,m,f,h,_,y,{node:x,playgroundContext:w}=t,j={workflowId:null!==(h=null==e?void 0:null===(v=e.inputs)||void 0===v?void 0:v.workflowId)&&void 0!==h?h:"",workflowVersion:null!==(_=null==e?void 0:null===(m=e.inputs)||void 0===m?void 0:m.workflowVersion)&&void 0!==_?_:""},k=Y(j,w);if(Q({node:x,context:w,workflow:k,nodeMeta:e.nodeMeta,identifier:j}),!k)return e;!function(e,t){var{desc:n}=t;!e.nodeMeta.description&&(e.nodeMeta.description=n)}(n=e,o=k),r=n,s=new Set(null==(a=o)?void 0:null===(i=a.inputs)||void 0===i?void 0:i.map(e=>e.name)),(null==r?void 0:null===(l=r.inputs)||void 0===l?void 0:l.inputParameters)&&(r.inputs.inputParameters=r.inputs.inputParameters.filter(e=>s.has(e.name))),function(e,t){var{workflow_id:n,end_type:o,space_id:r,inputs:a}=t;e.inputs.workflowId=n,e.inputs.spaceId=r,e.inputs.inputDefs=a,e.inputs.type=o}(n,o),function(e,t){var n=(0,c.Z)(t,"outputs"),o=!!n,r=!!(0,c.Z)(e,"outputs"),a=(0,c.Z)(e,"inputs.batch.batchEnable");if(!o||0===n.length){e.outputs=[];return}!r&&(a?e.outputs=[{name:"outputList",type:d.owu.ArrayObject,key:(0,u.x0)(),children:[]}]:e.outputs=[]);var{outputs:i}=t,l=i.map(p.N.dtoMetaToViewMeta);if((0,c.Z)(e,"inputs.settingOnError.switch")){var s,v,m=null===(s=(0,c.Z)(e,"outputs"))||void 0===s?void 0:s.find(e=>"errorBody"===e.name);a&&(m=null===(v=(0,c.Z)(e,"outputs[0].children"))||void 0===v?void 0:v.find(e=>"errorBody"===e.name)),m&&l.push(m)}var f=a?e.outputs[0].children:e.outputs;f&&!function e(t,n){t.map(t=>{var o=n.find(e=>e.name===t.name);return o&&(t.key=o.key,t.children&&o.children&&e(t.children,o.children)),t})}(l,f),a?e.outputs[0].children=l:e.outputs=l}(n,o);var N=null!==(y=null==e?void 0:null===(f=e.inputs)||void 0===f?void 0:f.inputParameters)&&void 0!==y?y:[],S=(0,H.x)(k.inputs).map(e=>{var t={name:e.name,input:{type:d.YX3.REF}},n=N.find(t=>t.name===e.name);return n?n:(t.input=g(e),t)});return e.inputs=(0,W._)((0,b._)({},e.inputs),{inputParameters:S}),e=$.t.dtoToformValue(e,t)},formatOnSubmit:(e,t)=>{var n,o,r,a,{playgroundContext:i}=t,l=Y({workflowId:null!==(r=null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.workflowId)&&void 0!==r?r:"",workflowVersion:null!==(a=null==e?void 0:null===(o=e.inputs)||void 0===o?void 0:o.workflowVersion)&&void 0!==a?a:""},i);return!(0,c.Z)(l,"outputs")&&(e.outputs=[]),e=$.t.formValueToDto(e,t)}},K=e=>e.entityManager.getService(_.I);var ee={type:d.nyy.SubWorkflow,meta:{nodeDTOType:d.nyy.SubWorkflow,size:{width:360,height:130.7},nodeMetaPath:l.je,outputsPath:l.G0,batchPath:l.b2,inputParametersPath:F,test:{generateRelatedContext:(e,t)=>(0,r._)(function*(){var n,{isInProject:o,workflowId:r,spaceId:a}=t,l=e.getData(s.m).getNodeData(),u=(null==l?void 0:l.flow_mode)===x.wz.ChatFlow,c=e.getData(i.Ps).formModel.getFormItemValueByPath("/"),p=(null==c?void 0:null===(n=c.inputs)||void 0===n?void 0:n.inputParameters)||{},v=null==p?void 0:p[d.d9h],m=v&&d.nZF.isRef(v);if(o)return(0,w.UY)({isNeedBot:!1,isNeedConversation:u&&m});var f=yield(0,w.m7)({workflowId:r,spaceId:a});return u&&(f.isNeedBot=!0,f.isNeedConversation=!0,f.disableBot=!0,f.disableBotTooltip=y.o.t("wf_chatflow_141")),(0,w.UY)(f)})(),generateFormBatchProperties(e){var t,n=e.getData(i.Ps).formModel.getFormItemValueByPath("/inputs/batchMode"),o=null===(t=e.getNodeMeta())||void 0===t?void 0:t.batchPath;if("batch"!==n||!o)return{};var r=e.getData(i.Ps).formModel.getFormItemValueByPath(o);return(0,w.ee)(r,{node:e})},generateFormInputProperties(e){var t,n,o=e.getData(i.Ps).formModel.getFormItemValueByPath("/"),r=null==o?void 0:null===(t=o.inputs)||void 0===t?void 0:t.inputDefs;if(!r||!Array.isArray(r))return{};var a=e.getData(s.m).getNodeData(),l=(null==a?void 0:a.flow_mode)===x.wz.ChatFlow,u=(null==o?void 0:null===(n=o.inputs)||void 0===n?void 0:n.inputParameters)||{},c=r.filter(e=>!l||e.name!==d.d9h).map(e=>({input:u[e.name],name:e.name,required:e.required}));return(0,w.ee)(c,{node:e})}},helpLink:"/open/docs/guides/workflow_node"},formMeta:X,onInit:(o=(0,r._)(function*(e,t){if(!!e){var{inputs:n,nodeMeta:o}=e.data||e,r=K(t),a=h(n);yield r.load(a,null==o?void 0:o.title)}}),function(e,t){return o.apply(this,arguments)}),checkError:(e,t)=>{if(!!e){var{inputs:n}=e.data||e,o=K(t),r=h(n);return o.getApiError(r)}},onDispose:(e,t)=>{if(!!e){var{inputs:n}=e.data||e,o=K(t),r=h(n);o.clearApiError(r)}},getHeaderExtraOperation:(e,t)=>{var n,o=h(null!==(n=null==e?void 0:e.inputs)&&void 0!==n?n:[]);return U(t.getService(_.I).getApiDetail(o),o)},onCreate(e,t){var n=e.getData(i.Ps).getFormModel(),{variableService:o,nodesService:r}=e.getService(i.xm),l=r.getStartNode();setTimeout(()=>{if(!!e){var t=e.getData(s.m),r=null==t?void 0:t.getNodeData(),i=(null==r?void 0:r.flow_mode)===d.wz8.ChatFlow;if(o.getWorkflowVariableByKeyPath([l.id,d.d9h],{node:e,checkScope:!0})&&i&&n){var u=n.getValueIn("inputs.inputParameters");if(u){var c=(0,a.Z)(u);c[d.d9h]&&d.nZF.isEmpty(c[d.d9h])&&(c[d.d9h]={type:"ref",content:{keyPath:[l.id,d.d9h]}},n.setValueIn("inputs.inputParameters",c))}}}},1e3)}},et=n("945941"),en=n("769510");function eo(){var e,t=(0,z.Zp)(),n=(0,i.G2)(et.j),{data:o}=(0,d.rsR)(),a=(0,i.PF)(),l=null==a?void 0:a.getData(s.m),u=l.getNodeData(),c=h(null==o?void 0:o.inputs),p=L();return(0,V.useEffect)(()=>{if(!!c){var e,i=t.onDependencyChange((e=(0,r._)(function*(e){if(!!(null==e?void 0:null===(s=e.extra)||void 0===s?void 0:null===(i=s.nodeIds)||void 0===i?void 0:i.includes(null==o?void 0:null===(r=o.inputs)||void 0===r?void 0:r.workflowId))){yield p.load(c,null==o?void 0:null===(d=o.nodeMeta)||void 0===d?void 0:d.title);var r,i,s,d,v,m=p.getApiDetail(c);if((null==m?void 0:m.project_id)||!(null==m?void 0:m.flow_version)){(0,en.BI)(a,n);return}l.init(),l.setNodeData((0,W._)((0,b._)({},u),{latest_flow_version:null==m?void 0:m.latest_flow_version,latest_flow_version_desc:null==m?void 0:m.latest_flow_version_desc,latestVersion:null==m?void 0:m.latest_flow_version})),t.onSubWrokflowVersionChangeEmitter.fire({subWorkflowId:null==o?void 0:null===(v=o.inputs)||void 0===v?void 0:v.workflowId})}}),function(t){return e.apply(this,arguments)}));return()=>{var e;null==i||null===(e=i.dispose)||void 0===e||e.call(i)}}},[c,null==o?void 0:null===(e=o.inputs)||void 0===e?void 0:e.workflowId]),(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(E.EU,{}),(0,j.jsx)(E.yC,{})]})}},90977:function(e,t,n){n.d(t,{I:()=>g});var o=n("825955"),r=n("808549"),a=n("120454"),i=n("130001"),l=n("771531"),s=n("435946"),d=n("450562"),u=n("336205"),c=n("497744"),p=n("716894"),v=n("992499");function m(e){return"".concat(e.workflowId,"_").concat(e.workflowVersion)}var f=()=>(0,p.F)((e,t)=>({loading:!1,data:{},error:{},getData(e){var n=m(e);return t().data[n]},setData(n,o){var i=m(n);e({data:(0,a._)((0,r._)({},t().data),{[i]:o})})},getError(e){var n=m(e);return t().error[n]},setError(n,o){var i=m(n);e({error:(0,a._)((0,r._)({},t().error),{[i]:o})})},clearError(n){var o=m(n);e({error:(0,a._)((0,r._)({},t().error),{[o]:void 0})})}}),v.X);class g{set loading(e){this.store.setState({loading:e})}get state(){return this.store.getState()}getApiDetail(e){return this.state.getData(e)}getApiError(e){return this.state.getError(e)}clearApiError(e){this.state.clearError(e)}fetchData(e){var t=this;return(0,o._)(function*(){var n,o,{spaceId:i}=t.globalState,{workflowId:l,workflowVersion:s}=e,u=yield d.OHc.GetWorkflowDetailInfo({space_id:i,workflow_filter_list:[{workflow_id:l,workflow_version:s||void 0}]},{__disableErrorToast:!0}),c=null==u?void 0:null===(n=u.data)||void 0===n?void 0:n[0];return c?(0,a._)((0,r._)({},c),{inputs:null===(o=c.inputs)||void 0===o?void 0:o.filter(e=>e.name)}):void 0})()}load(e,t){var n=this;return(0,o._)(function*(){var o=void 0,a="";try{n.loading=!0;var i=yield n.fetchData(e);i&&(o=i)}catch(e){a=e.message}finally{n.loading=!1}if(a&&n.state.setError(e,a),o)n.state.setData(e,(0,r._)({},o));else{var l=u.o.t("workflow_node_lose_efficacy_wf",{name:t});n.state.setError(e,a||l);return}return o})()}constructor(){this.store=f()}}(0,i.gn)([(0,l.f)(c.eI),(0,i.w6)("design:type",void 0===c.eI?Object:c.eI)],g.prototype,"globalState",void 0),g=(0,i.gn)([(0,s.b)()],g)},977334:function(e,t,n){n.d(t,{H:function(){return i},I:function(){return a}});var o=n(801815),r=n(450562),a="inputs.inputParameters",i=[{key:(0,o.x0)(),name:"success",type:r.owu.Boolean},{key:(0,o.x0)(),name:"numberOfDeletions",type:r.owu.Number}]},560449:function(e,t,n){n.d(t,{hp:function(){return v},mZ:function(){return p},pH:function(){return c}});var o=n(808549),r=n(120454),a=n(473980),i=n(529801),l=n(793003),s=n(450562),d=n(24682),u=n(977334),c=e=>(t,n)=>{if(!t)return{inputs:{inputParameters:{triggerId:{type:s.YX3.LITERAL},userId:{type:s.YX3.LITERAL}}},outputs:e};var a,d,u,{inputs:c}=t,p={};return(null!==(a=null==c?void 0:c.inputParameters)&&void 0!==a?a:[]).forEach(e=>{p[e.name]=l.t.refExpressionDTOToVO(e,n)}),(0,r._)((0,o._)({},null!=t?t:{}),{outputs:null!==(d=null==t?void 0:t.outputs)&&void 0!==d?d:e,inputs:(0,r._)((0,o._)({},(0,i.Z)(null!==(u=t.inputs)&&void 0!==u?u:{},["inputParameters"])),{inputParameters:p})})},p=c(u.H),v=(e,t)=>{var n,s,{inputs:u}=e,c=(0,a._)(e,["inputs"]);return(0,r._)((0,o._)({},c),{inputs:(0,r._)((0,o._)({},(0,i.Z)(null!==(n=e.inputs)&&void 0!==n?n:{},["inputParameters"])),{inputParameters:Object.entries(null!==(s=u.inputParameters)&&void 0!==s?s:{}).filter(e=>{var[t,n]=e;return!!(0,d.Oe)(n)}).map(e=>{var n,[o,r]=e;return{name:o,input:null===(n=l.t.refExpressionToValueDTO(r,t))||void 0===n?void 0:n.input}})})})}},765878:function(e,t,n){n.d(t,{Q:()=>x,h:()=>w.h});var o=n("736892"),r=n("450562"),a=n("336205"),i=n("686436"),l=n("370354"),s=n("151064"),d=n("676255"),u=n("899450"),c=n("167985"),p=n("489350"),v=n("430859"),m=n("14751"),f=n("101626"),g=n("977334"),h=(0,m.m)(()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.$0,{title:a.o.t("workflow_detail_node_input",{},"输入"),children:(0,s.jsx)("div",{className:"flex flex-col gap-[8px]",children:(0,s.jsx)(v.q,{layout:"horizontal",name:g.I,fieldConfig:[{description:"",name:"triggerId",label:a.o.t("workflow_trigger_user_create_id",{},"id"),required:!1,type:r.owu.String},{label:a.o.t("workflow_trigger_user_create_userid",{},"userId"),description:a.o.t("workflow_trigger_user_create_userid_tooltips",{},"用于设置触发器所属用户，可以使用变量-系统变量中的sys_uuid来唯一标识用户"),name:"userId",required:!0,type:r.owu.String}]})})}),(0,s.jsx)(f.Nn,{title:a.o.t("workflow_detail_node_output"),tooltip:a.o.t("node_http_response_data"),id:"triggerDelete-node-outputs",name:"outputs",topLevelReadonly:!0,customReadonly:!0})]})),_=n("560449"),y={render:()=>(0,s.jsx)(h,{}),validateTrigger:i.C$.onChange,validate:{nodeMeta:d.O,"inputs.inputParameters.userId":(0,u.vu)({required:!0})},effect:{nodeMeta:c.Jr,outputs:c.mw},formatOnInit:_.mZ,formatOnSubmit:_.hp},x={type:r.nyy.TriggerDelete,meta:{nodeDTOType:r.nyy.TriggerDelete,size:{width:360,height:130.7},nodeMetaPath:o.je,outputsPath:o.G0,inputParametersPath:g.I,test:{generateFormInputProperties(e){var t,n={userId:a.o.t("workflow_trigger_user_create_userid")},o=["userId"],r=e.getData(i.Ps).formModel.getFormItemValueByPath("/"),s=null==r?void 0:null===(t=r.inputs)||void 0===t?void 0:t.inputParameters;return(0,l.ee)(Object.entries(s||{}).map(e=>{var[t,r]=e;return{name:t,title:n[t]||t,required:o.includes(t),input:r}}),{node:e})}},helpLink:"/open/docs/guides/delete_timed_trigger"},variablesMeta:{inputsPathList:[],outputsPathList:["outputs"]},formMeta:y},w=n("5439")},5439:function(e,t,n){n.d(t,{h:function(){return u}});var o=n(151064),r=n(450562),a=n(336205),i=n(339328),l=n(255481),s=n(399226),d=n(288323);function u(){var e,t,n,u,c,p,v,m,{data:f}=(0,r.rsR)(),g=(0,l.l)({[a.o.t("workflow_trigger_user_create_id",{},"id")]:r.nZF.isEmpty(null==f?void 0:null===(t=f.inputs)||void 0===t?void 0:null===(e=t.inputParameters)||void 0===e?void 0:e.triggerId)?void 0:null==f?void 0:null===(u=f.inputs)||void 0===u?void 0:null===(n=u.inputParameters)||void 0===n?void 0:n.triggerId,[a.o.t("workflow_trigger_user_create_userid",{},"userId")]:r.nZF.isEmpty(null==f?void 0:null===(p=f.inputs)||void 0===p?void 0:null===(c=p.inputParameters)||void 0===c?void 0:c.userId)?void 0:null==f?void 0:null===(m=f.inputs)||void 0===m?void 0:null===(v=m.inputParameters)||void 0===v?void 0:v.userId});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.gN,{label:a.o.t("workflow_detail_node_parameter_input"),children:(0,o.jsx)(i._,{value:g})}),(0,o.jsx)(d.yC,{})]})}},727508:function(e,t,n){n.d(t,{S:()=>j,D:()=>k.h});var o=n("736892"),r=n("450562"),a=n("336205"),i=n("686436"),l=n("370354"),s=n("151064"),d=n("676255"),u=n("899450"),c=n("167985"),p=n("288323"),v=n("489350"),m=n("430859"),f=n("101626"),g=n("801815"),h="inputs.inputParameters",_=[{key:(0,g.x0)(),name:"outputList",type:r.owu.ArrayObject,children:[{key:(0,g.x0)(),name:"triggerId",type:r.owu.String},{key:(0,g.x0)(),name:"triggerName",type:r.owu.String},{key:(0,g.x0)(),name:"createTime",type:r.owu.String},{key:(0,g.x0)(),name:"triggerTime",type:r.owu.String},{key:(0,g.x0)(),name:"userId",type:r.owu.String}]}],y=()=>(0,s.jsxs)(p.X_,{children:[(0,s.jsx)(v.$0,{title:a.o.t("workflow_detail_node_input",{},"输入"),children:(0,s.jsx)(v.gN,{name:h,children:(0,s.jsx)("div",{className:"flex flex-col gap-[8px]",children:(0,s.jsx)(m.q,{layout:"horizontal",name:h,fieldConfig:[{description:"",name:"triggerId",label:a.o.t("workflow_trigger_user_create_id",{},"id"),required:!1,type:r.owu.String},{label:a.o.t("workflow_trigger_user_create_userid",{},"userId"),description:a.o.t("workflow_trigger_user_create_userid_tooltips",{},"用于设置触发器所属用户，可以使用变量-系统变量中的sys_uuid来唯一标识用户"),name:"userId",required:!0,type:r.owu.String}]})})})}),(0,s.jsx)(f.Nn,{title:a.o.t("workflow_detail_node_output"),tooltip:a.o.t("node_http_response_data"),id:"triggerDelete-node-outputs",name:"outputs",topLevelReadonly:!0,customReadonly:!0})]}),x=n("560449"),w=(0,x.pH)(_),b={render:()=>(0,s.jsx)(y,{}),validateTrigger:i.C$.onChange,validate:{nodeMeta:d.O,"inputs.inputParameters.userId":(0,u.vu)({required:!0})},effect:{nodeMeta:c.Jr,outputs:c.mw},formatOnInit:w,formatOnSubmit:x.hp},j={type:r.nyy.TriggerRead,meta:{nodeDTOType:r.nyy.TriggerRead,size:{width:360,height:130.7},nodeMetaPath:o.je,outputsPath:o.G0,inputParametersPath:h,test:{generateFormInputProperties(e){var t,n={userId:a.o.t("workflow_trigger_user_create_userid")},o=["userId"],r=e.getData(i.Ps).formModel.getFormItemValueByPath("/"),s=null==r?void 0:null===(t=r.inputs)||void 0===t?void 0:t.inputParameters;return(0,l.ee)(Object.entries(s||{}).map(e=>{var[t,r]=e;return{name:t,title:n[t]||t,required:o.includes(t),input:r}}),{node:e})}},helpLink:"/open/docs/guides/query_timed_trigger"},variablesMeta:{inputsPathList:[],outputsPathList:["outputs"]},formMeta:b},k=n("5439")},430859:function(e,t,n){n.d(t,{q:function(){return f}});var o=n(808549),r=n(120454),a=n(151064),i=n(392771),l=n(252237),s=n.n(l),d=n(686436),u=n(450562),c=n(321258),p=n(789541),v=n(184877),m=n(740573),f=e=>{var{fieldConfig:t=[],name:n,layout:l="vertical",refDisabled:f=!1,onChange:g,inputPlaceholder:h}=e;return(0,a.jsx)(a.Fragment,{children:t.map(e=>(0,a.jsxs)("div",{className:s()({"flex flex-row":"horizontal"===l}),children:[(0,a.jsx)("div",{className:"w-full h-[20px] leading-[20px] mb-[4px]",children:(0,a.jsx)(p.Z,{required:null==e?void 0:e.required,label:null==e?void 0:e.label,className:"!items-center",tooltip:null==e?void 0:e.description,tootipIconClassName:"coz-fg-secondary",tag:(null==e?void 0:e.type)?(0,a.jsx)(m.p,{className:"!inline-flex",size:"xs",children:(0,i.Z)(u.owu.getLabel(e.type))}):null})}),(0,a.jsx)(d.gN,{name:"".concat(n,".").concat(null==e?void 0:e.name),children:t=>{var n,{field:i,fieldState:l}=t;return(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)(c.N,(0,r._)((0,o._)({},i),{onChange:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];i.onChange(...t),null==g||g()},inputPlaceholder:h,refDisabled:f,inputType:e.type,disabledTypes:u.owu.getComplement([e.type]),isError:!!(null==l?void 0:null===(n=l.errors)||void 0===n?void 0:n.length)})),(0,a.jsx)(v.P,{errors:null==l?void 0:l.errors})]})}})]},"".concat(e.name)))})}},931188:function(e,t,n){n.d(t,{t:()=>X,H:()=>en});var o=n("736892"),r=n("450562"),a=n("808549"),i=n("686436"),l=n("336205"),s=n("370354"),d=n("120454"),u=n("151064"),c=n("994983"),p=n("676255"),v=n("899450"),m=n("167985"),f=n("24682"),g=n("825955"),h=n("455069"),_=n("989957"),y=n("664278"),x=n("101626"),w=n("288323"),b=n("489350"),j=n("14751"),k=n("801815"),N="inputs",S=[{key:(0,k.x0)(),name:"triggerId",type:r.owu.String}],C=n("479886"),I=n.n(C),T=n("252237"),P=n.n(T),D=n("444479"),E=n("614904"),O=n("58197"),L=n("915757"),M=n("674343"),F=n("184449"),Z=n("319529"),R=n("748734"),V=(0,b.Q2)(e=>{var t,n,{bindWorkflowId:o}=e,{readonly:a}=(0,b.U$)(),{spaceId:i,projectId:s,getProjectApi:d}=(0,F.j1)(),c=d(),[p,v]=(0,h.useState)(1),[m,f]=(0,h.useState)(!1),[_,y]=(0,h.useState)(!1),[x,j]=(0,h.useState)({list:[],total:0}),k=(0,D.Z)(m),N=(0,h.useCallback)((0,g._)(function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!k.current)try{f(!0),v(e);var t,n,o,a,l,d=yield r.OHc.ListTriggers({project_id:null!=s?s:"",space_id:i,trigger_id:"",set_type:r.KNf.DEBUG_USERSET,page_size:10,page_num:e});j({list:null!==(a=null==d?void 0:null===(n=d.data)||void 0===n?void 0:null===(t=n.trigger_list)||void 0===t?void 0:t.map(e=>{var t,n;return{triggerId:e.trigger_id,triggerName:e.name,createTime:I()(e.create_time).format("YYYY-MM-DD HH:mm:ss"),triggerTime:null===(t=JSON.parse(null!==(n=e.config)&&void 0!==n?n:"{}"))||void 0===t?void 0:t.crontab,useId:"".concat(e.user_id)}}))&&void 0!==a?a:[],total:Number(null!==(l=null==d?void 0:null===(o=d.data)||void 0===o?void 0:o.total)&&void 0!==l?l:0)})}catch(e){console.error(e)}finally{f(!1)}}),[]),[S,C]=(0,h.useState)(!1);var T=(t=(0,g._)(function*(e){try{C(!0);var t,n,o,a=yield r.OHc.TestRunTrigger({space_id:i,project_id:null!=s?s:"",trigger_id:null!==(o=e.triggerId)&&void 0!==o?o:""});null==c||c.sendMsgOpenWidget("/workflow/".concat(null==a?void 0:null===(t=a.data)||void 0===t?void 0:t.workflow_id),{name:"process",data:{executeId:null==a?void 0:null===(n=a.data)||void 0===n?void 0:n.execute_id}}),y(!1)}finally{C(!1)}}),function(e){return t.apply(this,arguments)}),V=[{title:l.o.t("workflow_trigger_user_create_id",{},"id"),dataIndex:"triggerId",render:e=>"".concat(e)},{title:l.o.t("workflow_trigger_user_create_name",{},"名称"),dataIndex:"triggerName",render:e=>"".concat(e)},{title:l.o.t("workflow_trigger_user_create_time",{},"创建时间"),dataIndex:"createTime",render:e=>"".concat(e)},{title:l.o.t("workflow_trigger_user_create_schedula",{},"触发时间"),dataIndex:"triggerTime",render:e=>(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{children:"".concat(e)}),(0,u.jsx)("div",{children:(0,E.pJ)(e)})]})},{title:l.o.t("workflow_trigger_user_create_userid",{},"用户id"),dataIndex:"useId",render:e=>"".concat(e)},{title:l.o.t("workflow_trigger_user_create_action",{},"操作"),width:120,render:e=>(0,u.jsxs)("div",{className:"flex flex-row gap-[8px] justify-end",children:[(0,u.jsx)(M.hU,{color:"secondary",icon:(0,u.jsx)(L.Y6z,{}),loading:S,onClick:()=>{T(e)}}),a?(0,u.jsx)(u.Fragment,{}):(0,u.jsx)(M.hU,{color:"secondary",icon:(0,u.jsx)(L.dVD,{}),onClick:(0,g._)(function*(){try{var t;yield r.OHc.DeleteTrigger({space_id:i,project_id:null!=s?s:"",trigger_id:null!==(t=e.triggerId)&&void 0!==t?t:"",set_type:r.KNf.DEBUG_USERSET}),N(p)}catch(e){M.FN.error(e.message)}})})]})}];return(0,u.jsxs)("div",{className:"!p-0",children:[(0,u.jsx)("div",{className:"",children:(0,u.jsx)(Z.W,{icon:(0,u.jsx)("div",{className:"h-[32px] w-[32px] flex flex-row items-center justify-center rounded-[4px] bg-[#8E4EFF]",children:(0,u.jsx)(L.VGH,{className:"text-white"})}),name:l.o.t("workflow_trigger_user_create_list",{},"触发器列表"),description:l.o.t("workflow_user_trigger_list_descr",{},"查看和管理已创建触发器任务"),readonly:a||!1,showDeleteBtn:!1,alwaysShowActions:!0,actions:(0,u.jsxs)("div",{className:"flex flex-row gap-[2px] items-center",children:[(0,u.jsx)(L.SA_,{}),(0,u.jsx)(M.zx,{color:"secondary",theme:"borderless",onClick:()=>{y(!0),N(1)},className:"!p-0",children:l.o.t("workflow_trigger_user_create_list_read",{},"查看")})]})})}),(0,u.jsx)(M.u_,{title:l.o.t("workflow_trigger_user_create_list",{},"触发器列表"),width:"80%",visible:_,onCancel:()=>{y(!1)},footer:(0,u.jsxs)("div",{className:"flex flex-row gap-[8px] justify-end",children:[(0,u.jsx)(M.zx,{color:"primary",onClick:()=>{y(!1)},loading:m,children:l.o.t("workflow_trigger_user_create_close",{},"关闭")}),(0,u.jsx)(M.zx,{icon:(0,u.jsx)(L.mxP,{}),color:"primary",onClick:()=>{N(1)},className:"!ml-0",children:l.o.t("workflow_trigger_user_create_refresh",{},"刷新")})]}),children:(0,u.jsxs)("div",{className:P()(R.Z["trigger-list"],"flex flex-col"),children:[(0,u.jsx)("div",{className:"coz-bg-max sticky top-0 z-10 pb-[16px]",children:(0,u.jsx)(w.gU,{align:"left",className:"rounded-[8px]",isBreakLine:!0,text:l.o.t("workflow_user_trigger_banner",{},"设置以后需要发布到对应渠道才能定时生效")})}),(null==x?void 0:null===(n=x.list)||void 0===n?void 0:n.length)===0?(0,u.jsx)("div",{className:"w-full flex-1 flex flex-col justify-center",children:(0,u.jsx)(M.ub,{size:"full_screen",icon:(0,u.jsx)(O.TL,{}),darkModeIcon:(0,u.jsx)(O.Io,{}),title:l.o.t("workflow_trigger_user_create_nodata",{},"暂时没有数据"),description:l.o.t("workflow_trigger_user_create_advice",{},"您可以使用触发器节点进行创建")})}):(0,u.jsx)(M.iA,{tableProps:{columns:V,dataSource:x.list,loading:m,pagination:{currentPage:p,pageSize:10,total:x.total,onPageChange:N}}})]})})]})}),A=n("39823"),z=n("532267"),B=(0,b.Q2)(e=>{var{selectedWorkflowInfo:t,className:n}=e,{value:o,onChange:r,readonly:a}=(0,b.U$)(),{projectId:i,workflowId:s,spaceId:d,getProjectApi:c,playgroundProps:p}=(0,F.j1)(),v=c(),m=(0,E.ds)(),f=l.o.t("workflow_241119_01"),{node:g,open:h,close:_}=(0,E.Zv)({from:E.wL.ProjectWorkflowAddNode,flowMode:z.wz.Workflow,onAdd:(e,t)=>{null==r||r(e.workflow_id),_()},onRemove:e=>{null==r||r(void 0),_()},onCreateSuccess:e=>{var t;_(),null==p||null===(t=p.refetchProjectResourceList)||void 0===t||t.call(p),m({workflowId:e.workflowId,spaceId:e.spaceId,projectId:i,ideNavigate:null==v?void 0:v.navigate})},i18nMap:{[A.sD.ListItemRemove]:{key:"scene_workflow_delete_workflow_button",options:{source:f}},[A.sD.ListItemRemoveConfirmTitle]:{key:"scene_workflow_delete_workflow_popup_title",options:{source:f}},[A.sD.ListItemRemoveConfirmDescription]:{key:"scene_workflow_delete_workflow_popup_subtitle",options:{source:f}}},hiddenLibrary:!0,projectId:i,excludedWorkflowIds:[s],workFlowList:t?[t]:[]}),y=!t,x=t&&!(null==t?void 0:t.project_id);return(0,u.jsxs)("div",{className:"".concat(n," relative"),children:[a?(0,u.jsx)(u.Fragment,{}):(0,u.jsx)("div",{className:"absolute right-[0px] top-[-28px]",children:(0,u.jsx)(M.hU,{onClick:h,icon:(0,u.jsx)(L.PwN,{className:"text-sm"}),color:"highlight",size:"small"})}),o?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(Z.W,{readonly:a,name:y?l.o.t("worklfow_trigger_bind_delete",{},"绑定的工作流已失效"):null==t?void 0:t.name,description:null==t?void 0:t.desc,icon:null==t?void 0:t.icon,onRemove:()=>{null==r||r(void 0)},onClick:()=>{x?window.open("/work_flow?space_id=".concat(d,"&workflow_id=").concat(o),"_blank"):null==v||v.navigate("/workflow/".concat(o))}}),x?(0,u.jsx)("div",{className:"mt-[-4px] text-[12px] coz-fg-hglt-red",children:l.o.t("workflow_trigger_bindwf_lib_error",{},"资源库工作流暂不支持，请先复制到项目中使用。")}):(0,u.jsx)(u.Fragment,{})]}):(0,u.jsx)("div",{className:"text-[12px] coz-fg-secondary",children:l.o.t("workflow_trigger_user_create_bind_tooltips",{},"选择一个工作流，当触发器被激活时，将会执行该工作流。")}),g]})}),U=n("430859"),q=(0,j.m)(e=>{var t,n,o=(0,b.qo)({name:"inputs.bindWorkflowId"}),s=(0,i.G2)(c.yM),[p,v]=(0,h.useState)({}),{dynamicFormMeta:m}=(0,h.useMemo)(()=>({dynamicFormMeta:s.getTriggerDynamicFormMeta().triggerNodeFormMeta}),[]),f=(0,b.cI)();return(0,_.Z)((0,g._)(function*(){var e,t,n=[];o&&(yield s.setBindWorkflowInfo(o),n=(null!==(t=null==(e=s.getBindWorkflowInfo(o))?void 0:e.inputs)&&void 0!==t?t:[]).map(e=>(0,d._)((0,a._)({},e),{type:y.N.dtoMetaToViewMeta(e).type}))),v({workflowInfo:e,workflowParameters:n}),n.map(e=>{!f.getValueIn("".concat(N,".payload.").concat(e.name))&&f.setValueIn("".concat(N,".payload.").concat(e.name),{type:r.YX3.LITERAL})})}),[o]),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(w.gU,{isBreakLine:!0,className:"!border-b-0 !m-0 !mt-2.5 rounded-lg",text:l.o.t("workflow_user_trigger_banner",{},"设置以后需要发布到对应渠道才能定时生效")}),(0,u.jsx)(b.$0,{title:l.o.t("workflow_trigger_user_create_list",{},"触发器列表"),children:(0,u.jsx)(V,{name:"",bindWorkflowId:o})}),(0,u.jsx)(b.$0,{title:l.o.t("workflow_detail_node_input",{},"输入"),children:(0,u.jsxs)("div",{className:"flex flex-col gap-[8px]",children:[(0,u.jsx)(U.q,{name:"".concat(N,".fixedInputs"),fieldConfig:[{description:l.o.t("workflow_trigger_user_create_id_tooltips",{},"触发器的唯一标识，若填写已存在id触发器列表中则为更新触发器信息。"),name:"triggerId",label:l.o.t("workflow_trigger_user_create_id",{},"id"),required:!1,type:r.owu.String},{label:l.o.t("workflow_trigger_user_create_userid",{},"userId"),description:l.o.t("workflow_trigger_user_create_userid_tooltips",{},"用于设置触发器所属用户，可以使用变量-系统变量中的sys_uuid来唯一标识用户"),name:"userId",required:!0,type:r.owu.String},{label:l.o.t("workflow_trigger_user_create_name",{},"名称"),description:l.o.t("workflow_trigger_user_create_name_tooltips",{},"触发器名称，可用于标识用途。"),name:"triggerName",required:!0,type:r.owu.String}]}),(0,u.jsx)(w.F3,{name:"".concat(N,".dynamicInputs"),formMeta:m,components:{Timezone:w.ru,CronJobSelect:w.ml}}),(0,u.jsx)(B,{className:"mb-[8px]",name:"".concat(N,".bindWorkflowId"),label:"绑定工作流",layout:"vertical",tooltip:"cronjob",required:!0,selectedWorkflowInfo:p.workflowInfo}),(null===(t=p.workflowParameters)||void 0===t?void 0:t.length)?(0,u.jsxs)("div",{className:"coz-mg-card p-[8px] rounded-[6px] border border-solid coz-stroke-primary",children:[(0,u.jsx)(b.az,{columns:[{label:l.o.t("workflow_detail_node_parameter_name"),style:{width:148}},{label:l.o.t("workflow_detail_end_output_value")}]}),(0,u.jsx)("div",{className:"flex flex-col gap-[8px]",children:null===(n=p.workflowParameters)||void 0===n?void 0:n.map(e=>(0,u.jsx)(x.se,{label:null==e?void 0:e.name,required:null==e?void 0:e.required,tooltip:null==e?void 0:e.description,labelExtra:(null==e?void 0:e.type)&&(0,u.jsx)(w.Mt,{type:e.type}),name:"".concat(N,".payload.").concat(null==e?void 0:e.name),inputType:null==e?void 0:e.type,disabledTypes:r.owu.getComplement([null==e?void 0:e.type])}))})]}):null]})}),(0,u.jsx)(x.Nn,{title:l.o.t("workflow_detail_node_output"),tooltip:l.o.t("node_http_response_data"),id:"triggerUpsert-node-outputs",name:"outputs",topLevelReadonly:!0,customReadonly:!0})]})}),W=n("473980"),G=n("962289"),H=n("529801"),$=n("997516"),J=n("879934"),Y=["triggerId","userId","triggerName"],Q={render:()=>(0,u.jsx)(q,{}),defaultValues:e=>{var{triggerNodeDefaultFormValue:t}=e.node.getService(c.yM).getTriggerDynamicFormMeta();return{inputs:{fixedInputs:{},dynamicInputs:t,payload:{}},outputs:S}},validateTrigger:i.C$.onChange,validate:{nodeMeta:p.O,"inputs.fixedInputs.userId":(0,v.vu)({required:!0}),"inputs.fixedInputs.triggerName":(0,v.vu)({required:!0}),"inputs.bindWorkflowId":e=>{var{value:t}=e;return(0,f.Hd)(t)},"inputs.dynamicInputs.timeZone":(0,v.vu)({required:!0}),"inputs.dynamicInputs.crontab":e=>{var t;return(0,v.vu)({required:!0})((0,d._)((0,a._)({},e),{value:null===(t=e.value)||void 0===t?void 0:t.content}))},"inputs.payload.*":e=>{var t,n,o,{value:r,formValues:a,context:i,name:l}=e,s=null==a?void 0:null===(t=a.inputs)||void 0===t?void 0:t.bindWorkflowId;if(!!s){var d=i.node.getService(c.yM).getBindWorkflowInfo(s);if(null==d?void 0:null===(o=d.inputs)||void 0===o?void 0:null===(n=o.find(e=>e.name===(null==l?void 0:l.replace("inputs.payload.",""))))||void 0===n?void 0:n.required)return(0,f.Hd)(r)}}},effect:{nodeMeta:m.Jr,outputs:m.mw},formatOnInit:(e,t)=>{if(!!e){var n,o,r,i,l,s,d,u,{triggerNodeFormMeta:p}=t.node.getService(c.yM).getTriggerDynamicFormMeta(),{variableService:v}=t.playgroundContext,{inputs:m}=e,f=(0,W._)(e,["inputs"]),{config:g,payload:h}=null!=m?m:{},_=e=>e?null===y.N||void 0===y.N?void 0:y.N.valueExpressionToVO(e,v):void 0,x=e=>e.reduce((e,t)=>{var{name:n="",input:o}=t;return e[n]=_(o),e},{}),w=(0,a._)({},x(g.filter(e=>(null==e?void 0:e.name)&&Y.includes(e.name)))),b=null===(n=p.filter(e=>![J.e.TriggerFormCronjobName,J.e.TriggerFormCronjobTypeName].includes(e.name)))||void 0===n?void 0:n.map(e=>e.name),j=(0,a._)({},x(g.filter(e=>(null==e?void 0:e.name)&&b.includes(e.name))));j[J.e.TriggerFormCronjobName]={type:null!==(u=null==g?void 0:null===(i=g.find(e=>(null==e?void 0:e.name)===J.e.TriggerFormCronjobTypeName))||void 0===i?void 0:null===(r=i.input)||void 0===r?void 0:null===(o=r.value)||void 0===o?void 0:o.content)&&void 0!==u?u:J.T.Selecting,content:_(null==g?void 0:null===(l=g.find(e=>(null==e?void 0:e.name)===J.e.TriggerFormCronjobName))||void 0===l?void 0:l.input)};var k=(0,a._)({},x(h)),N=null===(d=e.inputs)||void 0===d?void 0:null===(s=d.meta)||void 0===s?void 0:s.workflowId;return(0,a._)({inputs:{bindWorkflowId:N,fixedInputs:w,dynamicInputs:j,payload:k}},f)}},formatOnSubmit:(e,t)=>{var{variableService:n}=t.playgroundContext,o=t.node.getService(c.yM),{[J.e.TriggerFormEventIdName]:a,[J.e.TriggerFormAppIdName]:i}=o.getTriggerDynamicFormMeta(),l=(0,G.Z)(e,"outputs",[]),{inputs:s,nodeMeta:d}=e,{fixedInputs:u,dynamicInputs:p,bindWorkflowId:v,payload:m}=null!=s?s:{},f=(e,o)=>r.nZF.isExpression(o)?{name:e,input:y.N.valueExpressionToDTO(o,n,{node:null==t?void 0:t.node})}:r.ycG.createString(e,o),g=e=>{var t;return null===(t=Object.entries(null!=e?e:{}))||void 0===t?void 0:t.map(e=>{var[t,n]=e;return f(t,n)})},h=[];h.push(...g(u)),h.push(r.ycG.createString(J.e.TriggerFormCronjobTypeName,null!==(b=null==p?void 0:null===(x=p[J.e.TriggerFormCronjobName])||void 0===x?void 0:x.type)&&void 0!==b?b:J.T.Selecting)),(null==p?void 0:null===(w=p[J.e.TriggerFormCronjobName])||void 0===w?void 0:w.content)&&h.push(f(J.e.TriggerFormCronjobName,null==p?void 0:null===(j=p[J.e.TriggerFormCronjobName])||void 0===j?void 0:j.content)),h.push(...g((0,H.Z)(p,[J.e.TriggerFormCronjobName])));var _=[];if(v){var x,w,b,j,k,N=o.getBindWorkflowInfo(v),S=null==N?void 0:null===(k=N.inputs)||void 0===k?void 0:k.map(e=>e.name);_.push(...g((0,$.Z)(null!=m?m:{},S)))}return{nodeMeta:d,inputs:{meta:{[J.e.TriggerFormAppIdName]:i,[J.e.TriggerFormEventIdName]:a,workflowId:v,triggerType:"CRONJOB"},config:h,payload:_},outputs:l}}},X={type:r.nyy.TriggerUpsert,meta:{nodeDTOType:r.nyy.TriggerUpsert,size:{width:360,height:130.7},nodeMetaPath:o.je,outputsPath:o.G0,inputParametersPath:N,test:{generateFormInputProperties(e){var t,n,o,r,d={triggerName:l.o.t("workflow_trigger_user_create_name"),triggerId:l.o.t("workflow_trigger_user_create_id"),userId:l.o.t("workflow_trigger_user_create_userid")},u=["triggerName","userId"],c=e.getData(i.Ps).formModel.getFormItemValueByPath("/"),p=null==c?void 0:null===(t=c.inputs)||void 0===t?void 0:t.fixedInputs,v=(0,s.ee)(Object.entries(p||{}).map(e=>{var[t,n]=e;return{name:"__trigger_config_".concat(t),title:d[t]||t,required:u.includes(t),input:n}}),{node:e}),m=null==c?void 0:null===(o=c.inputs)||void 0===o?void 0:null===(n=o.dynamicInputs)||void 0===n?void 0:n.crontab,f={};(null==m?void 0:m.type)==="cronjob"&&(f=(0,s.ee)([{name:"__trigger_config_crontab",title:l.o.t("workflow_trigger_user_create_schedula"),required:!0,input:null==m?void 0:m.content}],{node:e}));var g=null==c?void 0:null===(r=c.inputs)||void 0===r?void 0:r.payload,h=(0,s.ee)(Object.entries(g||{}).map(e=>{var[t,n]=e,o=(null==t?void 0:t.split(",")[1])||t;return{name:"__trigger_payload_".concat(o),title:o,input:n}}),{node:e});return(0,a._)({},v,f,h)}},helpLink:"/open/docs/guides/set_timed_trigger"},variablesMeta:{inputsPathList:[],outputsPathList:["outputs"]},formMeta:Q},K=n("339328"),ee=n("255481"),et=n("399226"),en=()=>{var{inputParameters:e}=(0,r.rsR)(),{triggerNodeFormMeta:t}=(0,i.G2)(c.yM).getTriggerDynamicFormMeta(),{fixedInputs:n,dynamicInputs:o,bindWorkflowId:s}=e,p=t.reduce((e,t)=>{if(t.name===J.e.TriggerFormCronjobName){var n;e[t.label]=null==o?void 0:null===(n=o[t.name])||void 0===n?void 0:n.content}else e[t.label]=null==o?void 0:o[t.name];return e},{}),v=(0,ee.l)((0,d._)((0,a._)({[l.o.t("workflow_trigger_user_create_id",{},"id")]:null==n?void 0:n.triggerId,[l.o.t("workflow_trigger_user_create_userid",{},"userId")]:null==n?void 0:n.userId,[l.o.t("workflow_trigger_user_create_name",{},"名称")]:null==n?void 0:n.triggerName},p),{[l.o.t("workflow_trigger_user_create_bind",{},"绑定工作流")]:{content:s,rawMeta:{type:r.owu.String},type:r.YX3.LITERAL}}));return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(et.gN,{label:l.o.t("workflow_detail_node_parameter_input"),children:(0,u.jsx)(K._,{value:v})}),(0,u.jsx)(w.yC,{})]})}},879934:function(e,t,n){n.d(t,{T:function(){return i},e:function(){return a}}),(o=a||(a={})).TriggerFormName="trigger",o.TriggerFormIsOpenName="isOpen",o.TriggerFormEventTypeName="event",o.TriggerFormEventIdName="eventID",o.TriggerFormAppIdName="appID",o.TriggerFormParametersName="parameters",o.TriggerFormCronjobName="crontab",o.TriggerFormCronjobTypeName="crontabType",o.TriggerFormBindWorkflowName="workflowId",o.getVariableName=e=>{var t;return"".concat(null==e?void 0:e.type,",").concat(null!==(t=null==e?void 0:e.key)&&void 0!==t?t:null==e?void 0:e.name)};var o,r,a,i=((r={}).Cronjob="cronjob",r.Selecting="selecting",r)},24682:function(e,t,n){n.d(t,{Hd:()=>s,Oe:()=>a});var o=n("178621"),r=n("569502");n("408487"),n("450562"),n("297158"),n("879934"),new o.S({defaultOptions:{queries:{staleTime:1/0}}});var a=e=>!e||r.nZ.isEmpty(e)?void 0:e,i=n("346707"),l=n("336205"),s=e=>{var t=!0;return((0,i.Z)(e)||""===e)&&(t=!1),r.nZ.isExpression(e)&&r.nZ.isEmpty(e)&&(t=!1),(null==e?void 0:e.content)&&r.nZ.isExpression(null==e?void 0:e.content)&&r.nZ.isEmpty(null==e?void 0:e.content)&&(t=!1),t?void 0:l.o.t("workflow_detail_node_error_empty",{},"参数值不可为空")}},256659:function(e,t,n){n.d(t,{J:()=>x,S:()=>w});var o,r=n("736892"),a=n("450562"),i=n("686436"),l=n("370354"),s=n("151064"),d=n("336205"),u=n("645344"),c=n("7496"),p=n("264219"),v=n("288323"),m=n("489350"),f=n("101626");(0,i.x0)(),a.owu.Boolean,d.o.t("workflow_detail_variable_set_output_tooltip",{},"变量设置是否成功"),(0,i.x0)(),a.owu.String;var g=((o={}).Get="get",o.Set="set",o),h=()=>{var e=(0,m.qo)("mode")===g.Set;return(0,s.jsxs)(v.X_,{nodeDisabled:!0,readonlyAllowDeleteOperation:!0,children:[(0,s.jsx)(f.m8,{name:"mode",defaultValue:g.Set,options:{key:"mode",mode:"button",options:[{value:g.Set,label:d.o.t("workflow_detail_variable_set_title",{},"设置变量值")},{value:g.Get,label:d.o.t("workflow_detail_variable_get_title",{},"获取变量值")}]},customReadonly:!0}),(0,s.jsx)(f.Go,{name:"inputParameters",tooltip:d.o.t("workflow_detail_variable_subtitle",{},"用于在智能体中读取和写入变量，变量名必须与智能体中的变量名匹配。"),nameProps:{isPureText:!e,readonly:!0},customReadonly:!0}),(0,s.jsx)(f.Nn,{title:d.o.t("workflow_detail_node_output"),tooltip:d.o.t("workflow_detail_variable_set_output_tooltip"),id:"variable-node-outputs",name:"outputs",topLevelReadonly:!0,customReadonly:e})]})},_=n("664278"),y={render:()=>(0,s.jsx)(h,{}),validateTrigger:i.C$.onChange,validate:{"inputParameters.*.name":e=>{var{value:t}=e;if(!/^.+$/.test(t))return d.o.t("bot_edit_variable_field_required_error")},"inputParameters.*.input":(0,p.v)({required:!0})},effect:{nodeMeta:c.J,outputs:u.m},formatOnInit:function(e,t){var{playgroundContext:n}=t,{variableService:o}=n,{inputs:r={},outputs:l=[],nodeMeta:s}=e||{},{mode:d=g.Set,inputParameters:u=[]}=r,c=[];u.forEach(e=>{if(!!e)c.push(_.N.inputValueToVO(e,o))});var p=d===g.Set;return{nodeMeta:s,mode:d,inputParameters:c,outputs:l.length>0?l:[{key:(0,i.x0)(),name:p?"isSuccess":"",type:p?a.owu.Boolean:a.owu.String}]}},formatOnSubmit:function(e,t){var{playgroundContext:n,node:o}=t,{variableService:r}=n,{nodeMeta:a,mode:i,inputParameters:l,outputs:s}=e,d=[];return l.forEach(e=>{if(!!e){var t=_.N.inputValueToDTO(e,r,{node:o});d.push(t)}}),{nodeMeta:a,inputs:{mode:i,inputParameters:d},outputs:s}}},x={type:a.nyy.Variable,meta:{nodeDTOType:a.nyy.Variable,headerReadonly:!0,headerReadonlyAllowDeleteOperation:!0,size:{width:r.gu.width,height:156.7},nodeMetaPath:r.je,outputsPath:r.G0,useDynamicPort:!0,inputParametersPath:"/inputParameters",test:{generateRelatedContext(e,t){var{isInProject:n}=t;return n?{}:(0,l.UY)({isNeedBot:!0,hasVariableAssignNode:!0})},generateFormInputProperties(e){var t=e.getData(i.Ps).formModel.getFormItemValueByPath("/"),n=null==t?void 0:t.inputParameters;return(0,l.ee)(n,{node:e})}}},variablesMeta:{outputsPathList:["outputs"],inputsPathList:[]},formMeta:y};function w(){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.EU,{}),(0,s.jsx)(v.yC,{})]})}n("455069")},61872:function(e,t,n){n.d(t,{P:()=>h});var o=n("151064"),r=n("455069"),a=n("686436"),i=n("564803"),l=n("336205"),s=n("674343"),d=n("252237"),u=n.n(d),c=n("450562"),p=n("775699"),v=n("240960"),m=n("834484"),f=e=>{var{value:t,onChange:n,options:a=[],mode:i,name:l}=e,{getNodeSetterId:s,concatTestId:d}=(0,c.FCD)(),f=(0,v.j)(),g=(0,r.useMemo)(()=>a.map(e=>(0,o.jsx)(p.Y8,{className:u()({"border-[#1C1F23]/[8%]":"card"===i&&e.value!==t,"bg-[--semi-color-bg-0]":"card"===i&&e.value!==t}),value:e.value,disabled:e.disabled,"data-testid":d(s(l),"".concat(e.value)),children:e.label},e.value)),[a,i,t,d,s,l]);return(0,o.jsx)(p.FX,{style:{pointerEvents:f?"none":"auto"},className:m.Z.workflowNodeSetterRadio,type:i,value:t,onChange:n,children:g})},g=n("706489"),h=e=>{var{name:t,value:n,onChange:d,onBlur:u}=e,c=(0,a.km)(),{isBatchV2:p}=(0,a.Dc)().context.schemaGray,v=(0,a.cI)().getValueIn("settingOnError.processType"),m=(0,r.useMemo)(()=>{var e,t=v===i.A.EXCEPTION,n=(null===(e=c.parent)||void 0===e?void 0:e.flowNodeType)===a.Sy.SUB_CANVAS||t,r=t?l.o.t("workflow_250416_05",void 0,"需要先把节点的异常处理方式改为中断流程或者返回设定内容，才能改为批处理模式"):"";return[{value:"single",label:l.o.t("workflow_batch_tab_single_radio")},{value:"batch",label:r?(0,o.jsx)(s.u,{content:r,children:(0,o.jsx)("div",{children:l.o.t("workflow_batch_tab_batch_radio")})}):l.o.t("workflow_batch_tab_batch_radio"),disabled:n}]},[c,v]);return p?(0,o.jsx)(o.Fragment,{}):(0,o.jsx)(g.E,{collapsible:!1,children:(0,o.jsx)(f,{name:t,mode:"button",options:m,value:n,onChange:d,onBlur:u})})}},289853:function(e,t,n){n.d(t,{E:()=>I});var o=n("808549"),r=n("120454"),a=n("151064"),i=n("455069"),l=n("962289"),s=n("686436"),d=n("736892"),u=n("450562"),c=n("336205"),p=n("775699"),v=n("44172"),m=n("915757"),f=n("674343"),g=n("240960"),h=n("321258"),_=n("508363"),y=n("184877"),x=n("706489"),w=n("425212"),b=n("311807"),j=n("620715"),k=n("164856"),N=n("317219"),S=e=>{var{value:t,readonly:n=!1,onChange:l}=e,s=(0,i.useRef)(null),u=(0,i.useRef)(!1),v=(0,b.Z)(e=>{if(!u.current)l(e)},10),m={useRcSlider:!0,fieldClassName:N.Z["form-field"],disabled:n,decimalPlaces:0,step:1};return(0,i.useEffect)(()=>()=>{u.current=!0},[]),(0,a.jsxs)("div",{className:N.Z["workflow-batch-setting-panel"],onClick:e=>e.stopPropagation(),children:[(0,a.jsx)(p.ZT.Title,{className:N.Z["workflow-batch-setting-panel-title"],children:c.o.t("workflow_batch_settings")}),(0,a.jsxs)(p.l0,{ref:s,initValues:t,onChange:v,children:[(0,a.jsx)(j.s,(0,r._)((0,o._)({},m),{field:"batchSize",label:(0,a.jsx)(k.n,{label:c.o.t("workflow_maximum_run_count"),tooltip:c.o.t("workflow_maximum_run_count_tips")}),max:d.XE,min:d.bQ})),(0,a.jsx)(j.s,(0,r._)((0,o._)({},m),{field:"concurrentSize",label:(0,a.jsx)(k.n,{label:c.o.t("workflow_maximum_parallel_runs"),tooltip:c.o.t("workflow_maximum_parallel_runs_tips")}),max:d.pd,min:d.fs}))]})]})},C=n("795351"),I=e=>{var t,{batchModeName:n,name:b}=e,j=null===(t=(0,s.U$)(n))||void 0===t?void 0:t.value,k=(0,g.j)(),N=(0,s.cI)(),{isBatchV2:I}=(0,s.Dc)().context.schemaGray,T=(0,i.useMemo)(()=>{var e,t;return(0,a.jsx)("div",{className:C.Z.actionButtonContent,children:(0,a.jsx)(p.J2,{keepDOM:!0,stopPropagation:!0,trigger:"click",position:"bottomRight",content:(0,a.jsx)(S,{readonly:k,value:{batchSize:null!==(e=N.getValueIn("".concat(b,".batchSize")))&&void 0!==e?e:d.F1,concurrentSize:null!==(t=N.getValueIn("".concat(b,".concurrentSize")))&&void 0!==t?t:d.Sk},onChange:e=>{N.setValueIn("".concat(b,".batchSize"),(0,l.Z)(e.values,"batchSize")),N.setValueIn("".concat(b,".concurrentSize"),(0,l.Z)(e.values,"concurrentSize"))}}),children:(0,a.jsx)(f.hU,{color:"secondary",size:"small",icon:(0,a.jsx)(v.k0G,{size:"small"}),style:{marginRight:26}})})})},[N,b,k]);return I?(0,a.jsx)(a.Fragment,{}):"batch"===j?(0,a.jsx)("div",{className:C.Z["batch-container"],children:(0,a.jsx)(s.F2,{name:"".concat(b,".inputLists"),defaultValue:[{name:"item1",input:{type:u.YX3.REF},id:"0"}],children:e=>{var{field:t}=e,n=t.value&&t.value.length<2;return(0,a.jsxs)(x.E,{className:C.Z["batch-content"],header:c.o.t("workflow_detail_node_batch"),tooltip:c.o.t("workflow_detail_node_batch_tooltip"),actionButton:T,children:[(0,a.jsx)("div",{className:C.Z["columns-title"],children:(0,a.jsx)(w.b,{columns:[{title:c.o.t("workflow_detail_variable_input_name"),style:{flex:2}},{title:c.o.t("workflow_detail_variable_input_value"),style:{flex:3}}],readonly:k})}),t.map((e,l)=>(0,a.jsxs)("div",{className:C.Z["input-item"],children:[(0,a.jsx)(s.gN,{name:"".concat(e.name,".name"),children:n=>{var i,{field:l,fieldState:s}=n;return(0,a.jsxs)("div",{style:{flex:2},children:[(0,a.jsx)(_.l,(0,r._)((0,o._)({},l),{input:N.getValueIn("".concat(e.name,".input")),inputParameters:t.value||[],isError:!!(null==s?void 0:null===(i=s.errors)||void 0===i?void 0:i.length)})),(0,a.jsx)(y.P,{errors:null==s?void 0:s.errors})]})}}),(0,a.jsx)(s.gN,{name:"".concat(e.name,".input"),children:e=>{var{field:t,fieldState:n}=e;return(0,a.jsxs)("div",{style:{flex:3,overflow:"hidden"},children:[(0,i.createElement)(h.N,(0,r._)((0,o._)({},t),{key:"ValueExpressionInput",literalDisabled:!1,disabledTypes:u.owu.getComplement(u.owu.getAllArrayType())})),(0,a.jsx)(y.P,{errors:null==n?void 0:n.errors})]})}}),k?(0,a.jsx)(a.Fragment,{}):(0,a.jsx)("div",{className:"leading-none",children:(0,a.jsx)(f.hU,{size:"small",color:"secondary",disabled:n,"data-testid":(0,u.xtp)(e.name,"remove"),icon:(0,a.jsx)(m.ozt,{}),onClick:()=>{if(!n)t.delete(l)}})})]},e.key)),(0,a.jsx)("div",{className:C.Z["input-add-icon"],children:(0,a.jsx)(f.hU,{className:"!block",color:"highlight",size:"small",icon:(0,a.jsx)(m.PwN,{}),onClick:()=>{var e,n;t.append({id:"".concat(null!==(n=null===(e=t.value)||void 0===e?void 0:e.length)&&void 0!==n?n:0),name:"",input:{type:u.YX3.REF}})}})})]})}})}):null}},824253:function(e,t,n){n.d(t,{I:function(){return u},V:function(){return d}});var o=n(455069),r=n(614904),a=n(450562),i=n(897659),l=n(1334),s=()=>{var e,t=(0,a.rsR)(),n=null!==(e=null==t?void 0:t.inputParameters)&&void 0!==e?e:[];return(0,i.t)(n)},d=()=>{var e=(0,l.X_)(),t=s(),n=r.qz.findAvailableVariables({variables:e,inputs:t});return r.qz.createVariableTree(n)},u=e=>(0,o.useMemo)(()=>e?"string"==typeof e?e:"function"==typeof e?e():void 0:void 0,[e])},168628:function(e,t,n){n.d(t,{i:()=>h});var o=n("808549"),r=n("120454"),a=n("151064"),i=n("240960"),l=n("455069"),s=n("311807"),d=n("252237"),u=n.n(d),c=n("686436"),p=n("614904"),v=n("450562"),m=n("824253"),f=n("615158"),g=e=>{var t=(0,l.useRef)(null),{name:n,key:o,onChange:r,onBlur:i,onFocus:d,isError:g,readonly:h=!1,disableSuggestion:_=!1,disableCounter:y=!0,minRows:x=4,className:w,containerClassName:b,shouldUseContainerRef:j,testId:k,onChangeTrigger:N="onBlur"}=e,S=void 0,C=(0,m.V)(),[I,T]=(0,l.useState)(!1),{getNodeSetterId:P}=(0,v.FCD)(),D=(0,c.X2)(c.NQ),[E,O]=(0,l.useState)(e.value||""),L=(0,m.I)(e.placeholder),M=P(null!=k?k:n),F=e.value||"",[Z]=(0,l.useState)(()=>new p.R0(F));Z.setVariableTree(C),Z.setFocus(I);var R=(0,l.useCallback)((0,s.Z)(e=>{T(e)},50),[]),V=(0,l.useMemo)(()=>"number"==typeof S&&Z.value.length>S,[Z.value.length,S]);return(0,l.useEffect)(()=>{var e=Z.on(p.tf.Change,e=>{r&&r(e.value)});return()=>{e()}},[r]),(0,a.jsxs)("div",{className:u()(b,f.Z["expression-editor-container"],{[f.Z["expression-editor-focused"]]:I,[f.Z["expression-editor-error"]]:g||V}),onFocus:()=>{R(!0),null==d||d()},onBlur:()=>{"onBlur"===N&&(null==r||r(E)),R(!1),null==i||i()},ref:t,children:[(0,a.jsxs)(p.A2.EditorProvider,{children:[(0,a.jsx)(p.A2.Renderer,{value:F,variableTree:C,className:u()(w,f.Z["editor-render"],f.Z["editor-render-cm-content"],f.Z["editor-render-cmMinRows-".concat(x)],{[f.Z["editor-render-bottom-padding"]]:!y||V}),readonly:h,placeholder:L,dataTestID:M,onChange:e=>{"onBlur"===N?O(e):null==r||r(e)}}),h||_?null:(0,a.jsx)(p.A2.Popover,{variableTree:C,getPopupContainer:()=>{var e;return j&&null!==(e=t.current)&&void 0!==e?e:document.body},onVisibilityChange:function(e){e?D.disabled=!0:D.disabled=!1}})]}),(0,a.jsx)(p.UF,{model:Z,maxLength:S,disabled:y&&!V,isError:V})]},o)},h=e=>{var t=(0,i.j)();return(0,a.jsx)(g,(0,r._)((0,o._)({},e),{readonly:t}))}},184877:function(e,t,n){n.d(t,{P:function(){return l}});var o=n(151064);n(455069);var r=n(252237),a=n.n(r),i=n(477881),l=e=>{var{errors:t,className:n,style:r}=e;return t?(0,o.jsx)("div",{className:a()(i.Z.formItemError,n),style:r,children:t.map(e=>(0,o.jsx)("span",{children:e.message},e.field))}):null}},40577:function(e,t,n){n.d(t,{G:function(){return o}});var o=/^(?!.*\b(true|false|and|AND|or|OR|not|NOT|null|nil|If|Switch)\b)[a-zA-Z_][a-zA-Z_$0-9]*$/},789541:function(e,t,n){var o=n(151064),r=n(252237),a=n.n(r),i=n(44172),l=n(275546);t.Z=e=>{var{required:t,hideRequiredTag:n=!1,label:r,tooltip:s,tag:d,labelStyle:u={fontSize:12,marginRight:0},className:c,labelClassName:p,tootipPopoverClassName:v,tootipIconClassName:m}=e;return(0,o.jsxs)("div",{className:a()("flex mr-2 items-baseline",c),children:[(0,o.jsxs)("div",{className:"flex overflow-hidden",children:[(0,o.jsx)(l.Z,{content:r,showArrow:!0,position:"top",className:"flex-1 grow-1 truncate",children:(0,o.jsx)("span",{className:a()("flex-1 grow-1 truncate",p),style:u,children:r})}),t&&!n?(0,o.jsx)("span",{style:{color:"var(--light-usage-danger-color-danger,#f93920)"},children:"*"}):null,s?(0,o.jsx)("div",{className:"ml-[4px] mt-[2px]",children:(0,o.jsx)(l.Z,{showArrow:!0,position:"top",className:v,content:s,children:(0,o.jsx)(i.aUG,{className:m})})}):null]}),d?(0,o.jsx)("div",{className:"flex-1 shrink-0 grow-1",children:d}):null]})}},508363:function(e,t,n){n.d(t,{l:()=>f});var o=n("808549"),r=n("120454"),a=n("151064"),i=n("455069"),l=n("686436"),s=n("218353"),d=n("450562"),u=n("336205"),c=n("915757"),p=n("674343"),v=n("240960"),m=n("862868"),f=e=>{var{value:t,onChange:n,onBlur:f,name:g,style:h,input:_,inputParameters:y,initValidate:x=!1,isPureText:w=!1,prefix:b="",suffix:j="",format:k,tooltip:N,isError:S,inputPrefix:C,disabled:I}=e,[T,P]=(0,i.useState)(!1),[D,E]=(0,i.useState)(!1),[O,L]=(0,i.useState)(t),[M,F]=(0,i.useState)(t),Z=(0,v.j)(),R=(0,l.PF)(),V=(0,l.G2)(s.a),{getNodeSetterId:A}=(0,d.FCD)();(0,i.useEffect)(()=>{t!==M&&F(t)},[t]);var z=(0,m.H)({input:_,prefix:b,suffix:j,format:k,node:R,variableService:V}),B=(0,i.useCallback)(e=>{E(!0),F(e||""),L(void 0)},[]);if((0,i.useEffect)(()=>{x&&(n(t),null==f||f()),t&&E(!0),P(!0)},[x,n,t]),T&&!Z&&!D){if(z&&z!==O){var U=(0,m.Zu)({variableName:z,inputParameters:y});n(U),L(z),F(U)}else!z&&O&&(L(void 0),F(void 0))}return(0,a.jsx)("div",{className:"flex items-center",style:(0,r._)((0,o._)({},h),{pointerEvents:Z?"none":"auto"}),children:w?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.ZT.Text,{className:"h-8 leading-8",children:t}),N?(0,a.jsx)(p.u,{content:N,children:(0,a.jsx)(c.L03,{className:"ml-1",style:{fontSize:12}})}):null]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.II,{size:"small","data-testid":A(g),value:M,onChange:B,onBlur:()=>{n(M||""),null==f||f()},validateStatus:S?"error":void 0,placeholder:u.o.t("workflow_detail_node_input_entername"),prefix:C,disabled:I}),N?(0,a.jsx)(p.u,{content:N,children:(0,a.jsx)(c.L03,{className:"ml-1",style:{fontSize:12}})}):null]})})}},638284:function(e,t,n){n.d(t,{e:function(){return i}});var o=n(336205),r=n(40577),a=e=>{var{formValues:t}=e;return t.inputParameters.map(e=>e.name)},i=e=>t=>{var n,i,{value:l,formValues:s}=t,{getNames:d=a,validatorConfig:u,invalidValues:c,skipValidate:p}=e||{};if(null==p?!void 0:!p({value:l,formValues:s})){var v=null!==(n=null==u?void 0:u.rule)&&void 0!==n?n:r.G,m=null!==(i=null==u?void 0:u.errorMessage)&&void 0!==i?i:o.o.t("workflow_detail_node_error_format");return v.test(l)?(null==c?void 0:c[l])?c[l]:d({value:l,formValues:s}).filter(e=>e===l).length>1?o.o.t("workflow_detail_node_input_duplicated"):void 0:m}}},594073:function(e,t,n){n.d(t,{y:function(){return m}});var o=n(808549),r=n(120454),a=n(151064),i=n(455069),l=n(686436),s=n(244829),d=n(455543),u=n(830873),c=n(450562),p=n(240960),v=n(873538),m=(0,n(25804).S)(e=>{var{name:t,value:n,onChange:m,id:f,disabled:g=!1,batchMode:h,withDescription:_=!1,withRequired:y=!1,readonly:x=!1,topLevelReadonly:w=!1,allowDeleteLast:b=!1,emptyPlaceholder:j,hiddenTypes:k,showResponseFormat:N=!1,needErrorBody:S=!1,hide:C=!1,defaultCollapse:I,needAppendChildWhenNodeIsPreset:T,noCard:P,sortValue:D}=e||{},E=(0,l.cI)(),O=(0,p.j)(),L=h===c.Psf.Batch,M=(0,l.G2)(l.qp),F=(0,l.JA)(),Z=(0,d.Od)(),R=(0,i.useRef)(),V=e=>{M.stop(),m(e),M.start()};(0,i.useEffect)(()=>{if(!R.current){R.current=h;return}if(h!==R.current){if(R.current=h,h===c.Psf.Batch){V(s.I.singleOutputMetasToList(n));return}if(h===c.Psf.Single){V(s.I.listOutputMetasToSingle(n));return}}},[h,m]);var{getNodeSetterId:A}=(0,c.FCD)(),z=(0,i.useMemo)(()=>{var e=D?D(n,L):n;return S?(0,u.Eb)({value:e,isBatch:L,isSettingOnErrorV2:Z}):e},[n,S,L,Z]);return C?null:(0,a.jsx)(v.G,(0,r._)((0,o._)({},e),{id:f,testId:A(t),responseFormat:{visible:N,value:E.getValueIn("model.responseFormat"),readonly:S,onChange:e=>{var t=E.getValueIn("model");t&&E.setValueIn("model",(0,r._)((0,o._)({},t),{responseFormat:e})),F()}},readonly:x||O,disabled:g,value:z,onChange:m,isBatch:L,withDescription:_,withRequired:y,topLevelReadonly:w,allowDeleteLast:b,emptyPlaceholder:j,hiddenTypes:k,defaultCollapse:I,needAppendChildWhenNodeIsPreset:T,noCard:P}))})},25804:function(e,t,n){n.d(t,{S:()=>l});var o=n("808549"),r=n("151064");n("455069");var a=n("686436"),i=n("577060");function l(e){return t=>{var{errors:n}=t,l=(null==n?void 0:n.length)?JSON.parse(n[0].message||"").issues:void 0,s=(0,a.km)().getData(a.Ps).getFormModel();return(0,r.jsx)(i.d_,{errors:l,onTestRunValidate:e=>{var{dispose:t}=s.onValidate(e);return t},children:(0,r.jsx)(e,(0,o._)({},t))})}}},321258:function(e,t,n){n.d(t,{N:function(){return m}});var o=n(151064),r=n(455069),a=n(962289),i=n(686436),l=n(471583),s=n(68331),d=n(450562),u=n(240960),c=n(1334),p=n(164634),v=n(336383),m=e=>{var{value:t,onChange:n,onBlur:m,style:f,selectStyle:g,literalStyle:h,disabledTypes:_,availableFileTypes:y=[],literalDisabled:x=!1,refDisabled:w=!1,showClear:b=!1,hideDeleteIcon:j=!1,hideSettingIcon:k=!1,readonly:N,inputType:S,inputTypes:C,customFilterVar:I,name:T,isError:P,placeholder:D,inputPlaceholder:E,refTagColor:O,matchType:L,forbidTypeCast:M,defaultInputType:F,literalConfig:Z}=e,R=(0,u.j)(),V=(0,c.X_)(),{getNodeSetterId:A}=(0,d.FCD)(),z=(0,i.G2)(l.b),B=(0,v.yU)(V,_||[]),U=(0,v._E)(B,L),q=(0,a.Z)(t,"content.keyPath");return(0,r.useEffect)(()=>{var e=Array.isArray(_)&&_.length>0;if(!!q&&!!e){var t=z.onListenVariableTypeChange(q,e=>{e&&(_||[]).includes(e.type)&&n({type:d.YX3.REF})},{});return()=>{null==t||t.dispose()}}},[q,_,z,n]),(0,s.S)({keyPath:q,onTypeChange:e=>{var{variableMeta:t}=e;if(!!(Array.isArray(_)&&_.length>0))t&&(_||[]).includes(t.type)&&n({type:d.YX3.REF})}}),(0,o.jsx)(p.N,{testId:A(T),readonly:R||N,value:t,onChange:n,onBlur:m,inputType:S,inputTypes:C,variablesDatasource:U,validateStatus:P?"error":void 0,style:f,selectStyle:g,literalStyle:h,disabledTypes:_,availableFileTypes:y,literalDisabled:x,refDisabled:w,showClear:b,customFilterVar:I,placeholder:D,inputPlaceholder:E,refTagColor:O,hideDeleteIcon:j,hideSettingIcon:k,forbidTypeCast:M,defaultInputType:F,literalConfig:Z})}},951114:function(e,t,n){n.d(t,{r:function(){return s}});var o=n(808549),r=n(120454),a=n(455069),i=n(686436),l=n(945941);function s(){var e=(0,i.km)(),t=e.getService(l.j);return(0,a.useMemo)(()=>{var n=t.getNodeTemplateInfoByType(e.flowNodeType),{nodesService:a}=t;if(!!n)return(0,r._)((0,o._)({},n),{title:a.createUniqTitle(n.title,e)})},[])}},240960:function(e,t,n){n.d(t,{j:function(){return a}});var o=n(455069),r=n(686436);function a(){var e=(0,r.bP)(r.ER),t=(0,r.JA)();return(0,o.useEffect)(()=>{var n=e.onReadonlyOrDisabledChange(()=>{t()});return()=>{n.dispose()}},[]),e.readonly}},699123:function(e,t,n){n.d(t,{l7:()=>F,zC:()=>su,b6:()=>ss,r8:()=>E.r,pC:()=>sc});var o,r,a,i,l,s,d,u=n("450562"),c=n("808549"),p=n("151064"),v=n("671261"),m=n("686436"),f=n("916107"),g=n("664278"),h=n("676255"),_=n("336205"),y=[[u.owu.Number,u.owu.Integer]],x=n("346707"),w=n("962289");function b(e){return e?y.find(t=>t.includes(e))||[e]:[]}function j(e,t,n){if(!!e)return g.N.getValueExpressionViewType(e,t,{node:n})}var k=n("264219"),N=n("40577");function S(e,t){return N.G.test(e)?e.length>20?_.o.t("workflow_var_merge_name_lengthmax"):t.filter(t=>t===e).length>1?_.o.t("workflow_var_merge_output_namedul"):void 0:_.o.t("workflow_detail_node_error_format")}var C=[(0,m.fq)(m.zE.onValueChange,e=>{var t,n,o,{node:r}=e.context,a=null==r?void 0:null===(n=r.getData(m.Ps))||void 0===n?void 0:null===(t=n.getFormModel())||void 0===t?void 0:t.nativeFormModel;if(!!a)null===(o=a.getField(e.name))||void 0===o||o.map(e=>{null==e||e.validate()})})],I=n("25232"),T=n("240960"),P=n("594073"),D=n("120454"),E=n("951114"),O=n("455069"),L=n("184449"),M=n("936382"),F=(0,n("25804").S)(e=>{var{value:t,onChange:n,onBlur:o,readonly:r=!1,hideTest:a=!1,extraOperation:i,showTrigger:l=!1,triggerIsOpen:s=!1,nodeDisabled:d,readonlyAllowDeleteOperation:u}=e,{title:v,icon:m,subTitle:f,description:g}=t||{},h=(0,T.j)(),{projectId:_,projectCommitVersion:y}=(0,L.j1)(),{isNodeSideSheet:x}=(0,L.$v)();return(0,p.jsx)(M.l,{title:v,subTitle:f,description:g,logo:m,onTitleChange:e=>{n((0,D._)((0,c._)({},t),{title:e})),null==o||o()},onDescriptionChange:e=>{n((0,D._)((0,c._)({},t),{description:e}))},readonly:r||h,readonlyAllowDeleteOperation:!h&&u,hideTest:a||!!(_&&y),showTrigger:l,triggerIsOpen:s,extraOperation:i,showCloseButton:x,nodeDisabled:d})}),Z=e=>{var{fieldName:t="nodeMeta",deps:n,outputsPath:o,batchModePath:r}=e,a=(0,E.r)(),i=(0,m.PF)(),l=new u.m_1(i);return(0,p.jsx)(m.gN,{name:t,deps:n,defaultValue:a,children:e=>{var t,n,{field:a,fieldState:i}=e;return(0,p.jsx)(F,(0,D._)((0,c._)({},a),{outputsPath:o,batchModePath:r,hideTest:!!(null==l?void 0:null===(n=l.registry)||void 0===n?void 0:null===(t=n.meta)||void 0===t?void 0:t.hideTest),errors:(null==i?void 0:i.errors)||[]}))}})},R=n("674343"),V=n("915757"),A=e=>{var{tooltip:t}=e;return(0,p.jsx)(R.u,{content:t,children:(0,p.jsx)(V.L03,{className:"text-lg coz-fg-secondary shrink-0"})})},z=e=>{var{readonly:t=!1}=e;return(0,p.jsxs)("p",{className:"pb-4",children:[(0,p.jsxs)("div",{className:"flex items-center text-xs font-medium gap-1",children:[(0,p.jsx)("span",{children:_.o.t("workflow_var_merge_strategy")}),(0,p.jsx)(A,{tooltip:_.o.t("workflow_var_merge_ strategy_tooltips")})]}),(0,p.jsx)(R.u,{content:_.o.t("workflow_var_merge_strategy_hovertips"),children:(0,p.jsx)("div",{className:"w-full mt-1",children:(0,p.jsx)(R.Ph,{disabled:t,optionList:[],size:"small",className:"w-full",children:(0,p.jsx)(R.Ph.Option,{children:_.o.t("workflow_var_merge_ strategy_returnnotnull")})})})})]})},B=n("66483"),U=n("473980"),q=e=>{var{disabled:t}=e,n=(0,U._)(e,["disabled"]);return t?(0,p.jsx)(p.Fragment,{children:n.children}):(0,p.jsx)(R.u,(0,c._)({},n))},W=n("321258"),G=n("184877"),H=e=>{var t=(0,L.M9)(),n=(0,m.PF)(),o=j(e[0],t,n),r=b(o),a=r.length>0?u.owu.getComplement(r):[],i=e.filter(e=>u.nZF.isRef(e)).map(e=>{var t;return null===(t=e.content)||void 0===t?void 0:t.keyPath}).filter(Boolean).map(e=>e.join("."));return{customFilterVar:e=>{var{meta:t,path:n}=e;return!i.includes((n||[]).join("."))},disabledTypes:a,viewType:o}},$=n("252237"),J=n.n($),Y=n("646201"),Q=n("591273"),X=n("782000"),K=e=>{var t,n,o,r,a,{variablesField:i,readonly:l,groupIndex:s,index:d,variableField:u,dragRef:v,disabledTypes:f,customFilterVar:g,disableDrag:h}=e;var _=(t=s,n=d,o=(0,L.zz)(),r=(0,m.PF)(),a=o.getNodeExecResult(r.id),(0,X.B)(t,n,a));return(0,p.jsx)(m.gN,{name:u.name,children:e=>{var{field:t,fieldState:n}=e;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:"flex w-full items-center",children:[(0,p.jsx)("span",{className:J()("flex items-center",h?"cursor-not-allowed":"cursor-move"),children:(0,p.jsx)(Y.Z,{ref:v,className:J()("px-1 mr-1 coz-fg-secondary",h?"pointer-events-none":"")})}),(0,p.jsx)(W.N,(0,D._)((0,c._)({},t),{readonly:l,disabledTypes:f,customFilterVar:g,onChange:e=>{if(!e){i.delete(d);return}t.onChange(e)},style:{flex:1},literalDisabled:!1,isError:!!((null==n?void 0:n.errors)&&n.errors.length),refTagColor:_?Q.Z.Green:Q.Z.Primary,hideDeleteIcon:!0,forbidTypeCast:!0})),(0,p.jsx)(R.hU,{className:"relative top-[-1px] ml-1",disabled:l,color:"secondary",size:"small",icon:(0,p.jsx)(V.ozt,{className:"text-lg"}),onClick:()=>i.delete(d)})]},d),(null==n?void 0:n.errors)&&n.errors.length?(0,p.jsx)("div",{className:"pl-7",children:(0,p.jsx)(G.P,{errors:null==n?void 0:n.errors})}):null]})}})},ee=e=>{var t,{groupIndex:n,variablesField:o,readonly:r,errors:a}=e,{disabledTypes:i,customFilterVar:l}=H(o.value||[]),s=null===(t=a||[])||void 0===t?void 0:t.filter(e=>e.name===o.name),d=((null==o?void 0:o.value)||[]).length,c=!d,[v,m]=(0,O.useState)(),f=(0,O.useRef)(),g=e=>{m(e),f.current=e},[h,y]=(0,O.useState)(1);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(B.c,{className:"space-y-1 mt-1",value:o.map(e=>e),onChange:e=>{o.onChange(e.map(e=>e.value))},renderItem:(e,t,a)=>(0,p.jsx)(K,{variablesField:o,groupIndex:n,index:t,variableField:e,dragRef:null==a?void 0:a.dragRef,readonly:r,disabledTypes:i,customFilterVar:l,disableDrag:1===d})}),r?null:(0,p.jsx)(q,{disabled:d<50,content:_.o.t("workflow_var_merge_var_number_max"),children:(0,p.jsxs)("div",{className:"flex w-full mt-1",children:[c?null:(0,p.jsx)("div",{className:"w-6 mr-1 shrink-0"}),(0,p.jsx)(W.N,{value:v,style:{flex:1},name:"",onChange:e=>{u.nZF.isLiteral(e)||u.nZF.isEmpty(e)?g(e):(g(void 0),o.append(e))},onBlur:()=>{f.current&&u.nZF.isLiteral(f.current)&&(o.append(f.current),g(void 0),y(e=>e+1))},placeholder:_.o.t("workflow_var_merge_var_placeholder"),literalDisabled:!1,disabledTypes:i,customFilterVar:l,readonly:d>=50,isError:s.length>0},h),c?null:(0,p.jsx)("div",{className:"w-6 shrink-0 ml-1"})]})}),(0,p.jsx)(G.P,{errors:s})]})},et=e=>{var{mergeGroup:t}=e,n=function(e){var t,n,o,r,a,i=(0,L.M9)(),l=(0,m.PF)();return t=e,n=i,o=l,(a=j(null==t?void 0:null===(r=t.variables)||void 0===r?void 0:r[0],n,o))&&u.IuB[a]||""}(t);return n?(0,p.jsx)(R.Vp,{size:"mini",color:"primary",className:"shrink-0 font-medium",children:n}):null},en=e=>{var{mergeGroupsField:t,index:n,readonly:o}=e,r=(t.value||[]).length>1;return(0,p.jsx)(q,{content:_.o.t("workflow_var_merge_delete_limit"),disabled:r,children:(0,p.jsx)(R.hU,{style:{position:"relative",top:"-1px"},size:"small",disabled:o||!r,color:"secondary",onClick:()=>{t.delete(n)},icon:(0,p.jsx)(V.ozt,{className:"text-lg"})})})},eo=e=>{var{value:t,onChange:n,readonly:o,disableEdit:r,onBlur:a}=e,[i,l]=(0,O.useState)(!1),s=(0,O.useRef)(null);return i?(0,p.jsx)(R.II,{value:t,ref:s,onBlur:e=>{null==a||a(e),l(!1)},onChange:n,size:"small",className:"w-full",maxLength:20}):(0,p.jsx)("div",{className:"text-xs font-medium coz-fg-primary hover:coz-mg-secondary-hovered cursor-pointer p-0.5 rounded-[4px] truncate",onClick:()=>{if(!o&&!r)l(!0),setTimeout(()=>{var e;null===(e=s.current)||void 0===e||e.focus()},0)},children:t})},er=e=>{var t,{nameField:n,nameFieldErrors:o,tooltip:r,mergeGroupsField:a,mergeGroupField:i,mergeGroup:l,index:s,readonly:d}=e,{editName:u,handleChange:c,handleBlur:v,editErrors:m}=function(e){var{nameField:t,mergeGroupsField:n,mergeGroupField:o}=e,[r,a]=(0,O.useState)(null==t?void 0:t.value),[i,l]=(0,O.useState)([]),s=e=>{var t=n.map(t=>{var n;return t.name===o.name?e:null==t?void 0:null===(n=t.value)||void 0===n?void 0:n.name});return S(e,t)};return{handleBlur:e=>{var n,o=null===(n=e.target)||void 0===n?void 0:n.value;o&&!s(o)?null==t||t.onChange(o):a(t.value),l([])},handleChange:e=>{var t,n=s(e);a(e),l(n?[(t="".concat(o.name,".name"),{name:t,level:"error",message:n})]:[])},editName:r,editErrors:i}}({nameField:n,mergeGroupField:i,mergeGroupsField:a});return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:"w-full flex items-center h-6",children:[(0,p.jsx)("div",{className:"flex-1 overflow-hidden pr-6",children:(0,p.jsxs)("div",{className:"w-full flex items-center gap-1",children:[(0,p.jsx)(eo,{value:u,readonly:d,onChange:c,onBlur:v}),(0,p.jsx)(et,{mergeGroup:l}),(null==l?void 0:null===(t=l.variables)||void 0===t?void 0:t.length)?(0,p.jsx)(A,{tooltip:r}):null]})}),(0,p.jsx)(en,{mergeGroupsField:a,index:s,readonly:d})]}),m.length||o.length?(0,p.jsx)(G.P,{errors:m.length?m:o}):null]})},ea=e=>{var{mergeGroupsField:t,readonly:n}=e;if(n)return null;var o=(t.value||[]).length>=50;return(0,p.jsx)(q,{content:_.o.t("workflow_var_merge_number_max"),disabled:!o,children:(0,p.jsxs)("div",{onClick:()=>{if(!o)t.append({name:function(e){for(var t,n=(e||[]).map(e=>e.name),o=1;t="".concat("Group").concat(o),n.includes(t);){;o+=1}return t}(t.value),variables:[]})},className:J()("flex justify-center items-center gap-1 w-full h-8 rounded-[8px] select-none bg-[var(--coz-mg-hglt)] hover:bg-[var(--coz-mg-hglt-hovered)]",o?"cursor-not-allowed  text-[var(--coz-fg-hglt-dim)]":"cursor-pointer text-[var(--coz-fg-hglt)]"),children:[(0,p.jsx)("div",{className:"flex items-center justify-center",children:(0,p.jsx)(V.PwN,{})}),(0,p.jsx)("p",{className:"text-[14px] font-medium text-nowrap",children:_.o.t("workflow_var_merge_addGroup")})]})})},ei=e=>{var{readonly:t}=e;return(0,p.jsx)(m.F2,{name:"inputs.mergeGroups",children:e=>{var{field:n}=e;return(0,p.jsxs)("div",{children:[n.map((e,o)=>(0,p.jsxs)("div",{className:"border border-solid border-[var(--coz-stroke-plus)] rounded-[8px] p-2 mb-3 coz-bg-max",children:[(0,p.jsx)(m.gN,{name:"".concat(e.name,".name"),children:r=>{var{field:a,fieldState:i}=r;return(0,p.jsx)(er,{tooltip:_.o.t("workflow_var_merge_group_tooltips"),mergeGroup:e.value,mergeGroupsField:n,mergeGroupField:e,index:o,readonly:t,nameField:a,nameFieldErrors:(null==i?void 0:i.errors)||[]})}}),(0,p.jsx)(m.F2,{name:"".concat(e.name,".variables"),defaultValue:[],children:e=>{var{field:n,fieldState:r}=e;return(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(ee,{variablesField:n,readonly:t,errors:null==r?void 0:r.errors,groupIndex:o})})}})]},e.name)),(0,p.jsx)(ea,{mergeGroupsField:n,readonly:t})]})}})},el=e=>{var{form:t}=e,n=(0,T.j)();return(0,p.jsx)(I.n,{children:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(Z,{}),(0,p.jsxs)("div",{children:[(0,p.jsx)(z,{readonly:n}),(0,p.jsx)(ei,{readonly:n})]}),(0,p.jsx)(m.gN,{name:"outputs",deps:["inputs.mergeGroups"],defaultValue:[],children:e=>{var{field:t,fieldState:n}=e;return(0,p.jsx)(P.y,{id:"llm-node-output",readonly:!0,value:t.value,titleTooltip:_.o.t("workflow_var_merge_output_tooltips"),errors:null==n?void 0:n.errors})}})]})})},es={effect:{"inputs.mergeGroups":f.P,"inputs.mergeGroups.*.variables":C},render:e=>(0,p.jsx)(el,(0,c._)({},e)),validateTrigger:m.C$.onChange,validate:{nodeMeta:h.O,"inputs.mergeGroups.*.name":e=>{var{value:t,formValues:n}=e;return S(t,((0,w.Z)(n,"inputs.mergeGroups")||[]).map(e=>e.name))},"inputs.mergeGroups.*.variables.*":e=>{if((0,x.Z)(null==e?void 0:e.value))return;var t,n,o=(0,k.v)({required:!0})(e);if(o)return o;var r=(0,w.Z)(e,"name","").split(".");if("0"!==r.pop()){var{node:a}=e.context,{variableService:i}=e.context.playgroundContext,l=j((0,w.Z)(e.formValues,r)[0],i,a),s=j(e.value,i,a);if(!l||!s||(t=l,n=s,!b(t).includes(n)))return _.o.t("workflow_var_merge_var_err_sametype")}},"inputs.mergeGroups.*.variables":e=>{var{value:t}=e,{length:n}=t||[];return 0===n?_.o.t("workflow_var_merge_var_err_noempty"):n>50?"variables should not be more than ".concat(50):void 0},"inputs.mergeGroups":e=>{var{value:t}=e,{length:n}=t||[];return 0===n?"merge groups should not be empty":n>50?"merge groups should not be more than ".concat(50):void 0}},formatOnInit(e,t){var n,{playgroundContext:o}=t,{variableService:r}=o,a=e||{inputs:{mergeGroups:[{name:"Group1",variables:[]}]},outputs:[]};return(null==a?void 0:null===(n=a.inputs)||void 0===n?void 0:n.mergeGroups)&&a.inputs.mergeGroups.forEach(e=>{(null==e?void 0:e.variables)&&(0,v.Z)(e,"variables",e.variables.map(e=>g.N.valueExpressionToVO(e,r)))}),a},formatOnSubmit(e,t){var n,{node:o,playgroundContext:r}=t,{variableService:a}=r;return(null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.mergeGroups)&&e.inputs.mergeGroups.forEach(e=>{(null==e?void 0:e.variables)&&(0,v.Z)(e,"variables",e.variables.map(e=>g.N.valueExpressionToDTO(e,a,{node:o})))}),e}},ed={type:u.nyy.VariableMerge,meta:{nodeDTOType:u.nyy.VariableMerge,style:{width:360},size:{width:360,height:130.7},hideTest:!0,helpLink:"/open/docs/guides/variable_merge_node"},formMeta:es},eu=n("736892"),ec=n("370354"),ep=n("155440"),ev=n("645344"),em=n("7496"),ef=n("43529"),eg=e=>{var{label:t,type:n,required:o,style:r}=e;return(0,p.jsxs)("p",{className:ef.Z.content,style:r,children:[(0,p.jsx)("span",{children:t}),o?(0,p.jsx)("span",{style:{color:"#f93920"},children:"*"}):null,n?(0,p.jsx)(R.Vp,{className:ef.Z.tag,children:n}):null]})},eh=n("647938"),e_=n("471583"),ey=n("306215"),ex=n("1334"),ew=n("608406"),eb=n("883150"),ej=n("163772"),{Text:ek}=R.ZT,eN=e=>e?JSON.stringify(e):void 0,eS=e=>e?JSON.parse(e):void 0,eC=e=>e&&eb.z[e]||(0,p.jsx)(V.UoC,{}),eI=e=>{var t,n,{value:o,onChange:r,onBlur:a,readonly:i,placeholder:l=_.o.t("variable_assignment_node_select_placeholder"),disabledTypes:s,isError:d,variablesFilter:v=e=>e,matchType:f,useMatchType:g}=e,h=(0,O.useRef)(null),y=(0,T.j)(),{projectId:x}=(0,L.j1)(),{type:b}=(0,eh.j)(),j=!!x,k=!j&&!!b,N=!j,S=(0,ex.X_)(),C=(0,m.G2)(e_.b),I=(0,w.Z)(o,"content.keyPath");(0,O.useEffect)(()=>{var e=Array.isArray(s)&&s.length>0;if(!!I&&!!e){var t=C.onListenVariableTypeChange(I,e=>{e&&(s||[]).includes(e.type)&&(null==r||r({type:u.YX3.REF}))},{});return()=>{null==t||t.dispose()}}},[I,C,r,s]);var P=(0,O.useMemo)(()=>v(S.filter(e=>e.nodeId&&(0,ey.mN)(e.nodeId))).map(e=>(0,c._)({value:eN([e.nodeId,e.key]),disabled:g&&f&&f!==e.type},e)),[S,v,f,g]),D=(0,O.useCallback)(e=>{var t=e?eS(e):void 0;void 0===t?null==r||r(void 0):null==r||r({type:u.YX3.REF,content:{keyPath:t}})},[r]),E=(0,O.useMemo)(()=>(0,p.jsxs)("div",{className:ej.Z["empty-block"],children:[(0,p.jsx)(V.nL$,{style:{fontSize:"32px",color:"rgba(52, 60, 87, 0.72)"}}),(0,p.jsx)("span",{className:ej.Z.text,children:j?_.o.t("variable_select_empty_appide_tips"):k?_.o.t("variable_select_empty_library_tips_02"):_.o.t("variable_select_empty_library_tips")})]}),[j,k]),M=(0,O.useCallback)(e=>{var t;D(e),null===(t=h.current)||void 0===t||t.close()},[D]);return(0,p.jsx)(R.Ph,{ref:h,hasError:d,dropdownStyle:{width:N?"326px":"228px"},showClear:!0,size:"small",disabled:y||i,clearIcon:(0,p.jsx)(V.rmE,{style:{fontSize:"12px"}}),emptyContent:N?null:E,value:eN(null==o?void 0:null===(t=o.content)||void 0===t?void 0:t.keyPath),onChange:D,onBlur:a,style:{width:"100%"},placeholder:l,renderSelectedItem:e=>{var t=P.find(t=>t.value===e.value);return(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("span",{className:"flex items-center mr-4px",style:{fontSize:"14px",color:(null==t?void 0:t.name)?"rgba(var(--coze-fg-1),var(--coze-fg-1-alpha))":"rgba(var(--coze-yellow-5), 1)"},children:eC(null==t?void 0:t.type)}),(0,p.jsx)("span",{style:{color:(null==t?void 0:t.name)?"rgba(var(--coze-fg-3),var(--coze-fg-3-alpha))":"rgba(var(--coze-yellow-5), 1)"},children:(null==t?void 0:t.name)||_.o.t("workflow_variable_undefined")})]})},outerBottomSlot:N?(0,p.jsx)(ew.o,{onVariableSelect:M,variableValue:eN(null==o?void 0:null===(n=o.content)||void 0===n?void 0:n.keyPath),variablesFormatter:e=>v(e.map(e=>(0,c._)({value:eN([e.nodeId,e.key]),disabled:g&&f&&f!==e.type},e)))}):void 0,children:N?null:P.map(e=>(0,p.jsx)(R.Ph.Option,{value:e.value,className:ej.Z["global-var-option"],disabled:e.disabled,children:(0,p.jsxs)("div",{className:"flex w-full items-center justify-between pl-8px pr-8px",children:[(0,p.jsx)(ek,{disabled:e.disabled,ellipsis:{showTooltip:!0},style:{flex:1},children:e.name}),(0,p.jsx)(R.Vp,{disabled:e.disabled,className:ej.Z.tag,size:"small",children:u.IuB[e.type]})]})},"".concat(e.value,"-").concat(e.disabled)))})},eT=n("706489"),eP=n("425212"),eD=n("485929"),eE=()=>({left:{type:u.YX3.REF},right:{type:u.YX3.REF}}),eO=e=>{var{form:t}=e,n=(0,T.j)(),o=(0,L.M9)(),r=(0,m.PF)(),a=e=>{var n=t.getValueIn(e);return g.N.getValueExpressionViewType(n,o,{node:r})},i=e=>{var n=t.getValueIn(e)||{},o=t.getValueIn("$$input_decorator$$.inputParameters")||[];return e=>{var t,r,a=null==n?void 0:null===(r=n.content)||void 0===r?void 0:null===(t=r.keyPath)||void 0===t?void 0:t.join("."),i=o.map(e=>{var t,n,o;return null===(o=e.left)||void 0===o?void 0:null===(n=o.content)||void 0===n?void 0:null===(t=n.keyPath)||void 0===t?void 0:t.join(".")}).filter(e=>a!==e);return e.filter(e=>!e.readonly).filter(e=>!i.includes([e.nodeId,e.key].join(".")))}};return(0,p.jsx)(I.n,{children:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(Z,{deps:["outputs"],outputsPath:"outputs"}),(0,p.jsx)(m.F2,{name:"$$input_decorator$$.inputParameters",defaultValue:[eE()],children:e=>{var{field:t}=e;return(0,p.jsxs)(eT.E,{header:_.o.t("workflow_detail_node_input"),tooltip:_.o.t("workflow_detail_variable_subtitle"),children:[(0,p.jsx)("div",{className:eD.Z["columns-title"],children:(0,p.jsx)(eP.b,{columns:[{title:_.o.t("workflow_detail_variable_input_name"),style:{flex:2}},{title:_.o.t("workflow_detail_variable_input_value"),style:{flex:3}}]})}),t.map((e,o)=>(0,p.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",paddingBottom:4,gap:4},children:[(0,p.jsx)(m.gN,{name:"".concat(e.name,".left"),children:t=>{var o,r,l,s,{field:d,fieldState:u}=t;return(0,p.jsxs)("div",{style:{flex:2,minWidth:0,flexShrink:0,display:"flex",flexDirection:"column"},children:[(0,p.jsx)(eI,(0,D._)((0,c._)({},d),{variablesFilter:i("".concat(e.name,".left")),isError:!!(null==u?void 0:null===(o=u.errors)||void 0===o?void 0:o.length),disabled:n,useMatchType:!(null===(s=d.value)||void 0===s?void 0:null===(l=s.content)||void 0===l?void 0:null===(r=l.keyPath)||void 0===r?void 0:r[0]),matchType:a("".concat(e.name,".right"))})),(0,p.jsx)(G.P,{errors:null==u?void 0:u.errors})]})}}),(0,p.jsx)(m.gN,{name:"".concat(e.name,".right"),children:t=>{var o,{field:r,fieldState:i}=t,l=a("".concat(e.name,".left"));return(0,p.jsxs)("div",{style:{flex:3,overflow:"hidden"},children:[(0,p.jsx)(W.N,(0,D._)((0,c._)({},r),{inputType:l,matchType:l,isError:!!(null==i?void 0:null===(o=i.errors)||void 0===o?void 0:o.length),readonly:n})),(0,p.jsx)(G.P,{errors:null==i?void 0:i.errors})]})}}),n?(0,p.jsx)(p.Fragment,{}):(0,p.jsx)("div",{children:(0,p.jsx)(R.hU,{size:"small",color:"secondary","data-testid":(0,u.xtp)(e.name,"remove"),icon:(0,p.jsx)(V.ozt,{}),onClick:()=>{t.delete(o)}})})]},e.key)),n?(0,p.jsx)(p.Fragment,{}):(0,p.jsx)("div",{className:eD.Z["input-add-icon"],children:(0,p.jsx)(R.hU,{className:"!block",color:"highlight",size:"small",icon:(0,p.jsx)(V.PwN,{}),onClick:()=>{t.append(eE())}})})]})}}),(0,p.jsx)(m.gN,{name:"outputs",children:(0,p.jsx)(eT.E,{header:_.o.t("workflow_detail_node_output"),tooltip:_.o.t("workflow_detail_variable_set_output_tooltip"),children:(0,p.jsx)(eg,{label:"isSuccess",type:"boolean"})})})]})})},eL={render:e=>(0,p.jsx)(eO,(0,c._)({},e)),validateTrigger:m.C$.onChange,validate:{nodeMeta:h.O,"$$input_decorator$$.inputParameters.*.left":(0,k.v)({required:!0,emptyErrorMessage:_.o.t("variable_assignment_node_select_empty")}),"$$input_decorator$$.inputParameters.*.right":(0,k.v)({required:!0})},effect:{nodeMeta:em.J,outputs:ev.m},formatOnInit(e,t){var n=(0,w.Z)(e,"inputs.inputParameters"),o=(null!=n?n:[]).map(e=>{var n=null==e?void 0:e.left,o=null==e?void 0:e.input;if(!!n&&!!o)return{left:g.N.valueExpressionToVO(n,t.playgroundContext.variableService),right:g.N.valueExpressionToVO(o,t.playgroundContext.variableService)}}).filter(Boolean);return{nodeMeta:null==e?void 0:e.nodeMeta,$$input_decorator$$:{inputParameters:(null==o?void 0:o.length)?o:[eE()]},outputs:[{name:"isSuccess",type:u.owu.Boolean}]}},formatOnSubmit(e,t){var n=(0,w.Z)(e,"$$input_decorator$$.inputParameters");return{nodeMeta:(null==e?void 0:e.nodeMeta)||{},inputs:{inputParameters:null==n?void 0:n.map(e=>{var n,o,r=null==e?void 0:e.left,a=null==e?void 0:e.right,i=g.N.valueExpressionToDTO(r,t.playgroundContext.variableService,{node:t.node}),l=g.N.valueExpressionToDTO(a,t.playgroundContext.variableService,{node:t.node});return{name:null==r?void 0:null===(o=r.content)||void 0===o?void 0:null===(n=o.keyPath)||void 0===n?void 0:n.slice(1).join("."),left:(null==r?void 0:r.content)?i:void 0,input:(0,ep.Z)(null==a?void 0:a.content)?void 0:l}}),variableTypeMap:n.reduce((e,t)=>{var n,o,r,a,i,l,s=null==t?void 0:null===(r=t.left)||void 0===r?void 0:null===(o=r.content)||void 0===o?void 0:null===(n=o.keyPath)||void 0===n?void 0:n[0],d=null==t?void 0:null===(l=t.left)||void 0===l?void 0:null===(i=l.content)||void 0===i?void 0:null===(a=i.keyPath)||void 0===a?void 0:a.slice(1).join(".");return!e[d]&&(e[d]=s),e},{})},outputs:[{name:"isSuccess",type:"boolean"}]}}},eM={type:u.nyy.VariableAssign,meta:{nodeDTOType:u.nyy.VariableAssign,style:{width:360},size:{width:360,height:130.7},nodeMetaPath:eu.je,inputParametersPath:"/$$input_decorator$$/inputParameters",test:{generateRelatedContext(e,t){var{isInProject:n}=t;return n?{}:(0,ec.UY)({isNeedBot:!0,hasVariableAssignNode:!0})},generateFormInputProperties(e){var t,n,o=e.getData(m.Ps).formModel.getFormItemValueByPath("/"),r=null==o?void 0:null===(n=o.$$input_decorator$$)||void 0===n?void 0:null===(t=n.inputParameters)||void 0===t?void 0:t.map(e=>{var t,n,o;return{input:null==e?void 0:e.right,name:null==e?void 0:null===(o=e.left)||void 0===o?void 0:null===(n=o.content)||void 0===n?void 0:null===(t=n.keyPath)||void 0===t?void 0:t[1]}});return(0,ec.ee)(r,{node:e})}},helpLink:"/open/docs/guides/variable_assign_node"},variablesMeta:{outputsPathList:[],inputsPathList:[]},formMeta:eL},eF=n("788637"),eZ=n("529801"),eR=n("793003"),eV=n("994983"),eA=n("910126"),ez=n("801815"),eB=n("873538"),eU=n("208394"),eq=n("265145"),eW=[{key:(0,ez.x0)(),name:"chatHistory",type:u.owu.ArrayObject,children:[{key:(0,ez.x0)(),name:"role",type:u.owu.String},{key:(0,ez.x0)(),name:"content",type:u.owu.String}]}],eG=e=>{var{value:t,onChange:n,name:o,style:r,showLine:a=!0}=e,{getNodeSetterId:i}=(0,u.FCD)(),l=(0,T.j)();return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(eT.E.Action,{children:(0,p.jsx)(R.u,{content:_.o.t("wf_chatflow_125"),position:"right",children:(0,p.jsxs)("div",{className:"flex items-center gap-1",style:r,children:[(0,p.jsx)("div",{className:eq.Z["chat-history-text"],children:_.o.t("wf_chatflow_124")}),(0,p.jsx)(R.rs,{size:"mini",checked:t.enableChatHistory,"data-testid":i(o),onChange:e=>{if(t.enableChatHistory!==e)null==n||n((0,D._)((0,c._)({},t),{enableChatHistory:e}))},disabled:l})]})})}),t.enableChatHistory?(0,p.jsxs)("div",{className:"relative",children:[(0,p.jsx)(eB.G,{id:"chat-history",readonly:!0,value:eW,defaultCollapse:!0,onChange:()=>{},withDescription:!1,withRequired:!1,noCard:!0}),a?(0,p.jsx)("div",{className:eq.Z.line}):null,(0,p.jsx)(eU.r,{value:t.chatHistoryRound,readonly:l,onChange:e=>{n((0,D._)((0,c._)({},t),{chatHistoryRound:Number(e)}))}})]}):null]})},eH=n("638284"),e$=n("508363"),eJ=n("61872"),eY=n("289853"),eQ=n("392646"),eX=n("420481"),eK=e=>{var{fieldName:t="settingOnError",batchModePath:n,outputsPath:o}=e,r=(0,T.j)();return(0,p.jsx)(m.gN,{name:t,children:e=>{var{field:t}=e;return(0,p.jsx)(eX.FV,(0,D._)((0,c._)({},t),{batchModePath:n,outputsPath:o,readonly:r}))}})},e0=e=>{var{disabledTooltip:t,onClick:n}=e;return t?(0,p.jsx)(R.u,{content:t,children:(0,p.jsx)(R.hU,{disabled:!!t,color:"highlight",size:"small",icon:(0,p.jsx)(V.PwN,{className:"text-sm"}),onClick:n})}):(0,p.jsx)(R.hU,{color:"highlight",size:"small",icon:(0,p.jsx)(V.PwN,{className:"text-sm"}),onClick:n})};function e1(){var e;return null===(e=(0,m.cI)().getValueIn("model"))||void 0===e?void 0:e.modelType}var e2=e=>{var t,n;return!!(null==e?void 0:null===(n=e.input)||void 0===n?void 0:null===(t=n.rawMeta)||void 0===t?void 0:t.isVision)},e4={type:u.YX3.REF,rawMeta:{isVision:!0}},e6=e=>{var{enabledTypes:t,name:n}=e,o=u.owu.getComplement([...t,u.owu.String]);return(0,p.jsx)(m.gN,{name:n,children:e=>{var n,{field:r,fieldState:a}=e;return(0,p.jsxs)("div",{className:"flex-[3] min-w-0",children:[(0,p.jsx)(W.N,(0,D._)((0,c._)({},r),{isError:!!(null==a?void 0:null===(n=a.errors)||void 0===n?void 0:n.length),disabledTypes:o,defaultInputType:t[0],inputTypes:t,onChange:e=>{if(!e){null==r||r.onChange(e4);return}var t=(0,D._)((0,c._)({},e),{rawMeta:(0,D._)((0,c._)({},e.rawMeta||{}),{isVision:!0})});null==r||r.onChange(t)}})),(0,p.jsx)(G.P,{errors:null==a?void 0:a.errors})]})}})},e5=n("342138"),e3=e=>{var t,{inputField:n,inputsField:o,enabledTypes:r}=e,a=(0,m.cI)().getValueIn("".concat(n.name,".input")),i=(0,O.useMemo)(()=>{if(!r.length)return _.o.t("workflow_250310_05",void 0,"所选模型不支持视觉理解");var e,t=null==a?void 0:null===(e=a.rawMeta)||void 0===e?void 0:e.type;return!t||[...r,u.owu.String].includes(t)?"":t===u.owu.Image?_.o.t("workflow_250320_01",void 0,"所选模型不支持图片理解"):_.o.t("workflow_250320_02",void 0,"所选模型不支持视频理解")},[r,null==a?void 0:null===(t=a.rawMeta)||void 0===t?void 0:t.type]);return(0,p.jsx)(m.gN,{name:"".concat(n.name,".name"),children:e=>{var t,{field:n,fieldState:r}=e;return(0,p.jsxs)("div",{className:J()("flex-[2] min-w-0 relative",e5.Z["vision-name-container"]),children:[(0,p.jsx)(e$.l,(0,D._)((0,c._)({},n),{input:a,inputParameters:o.value||[],isError:!!(null==r?void 0:null===(t=r.errors)||void 0===t?void 0:t.length),inputPrefix:i?(0,p.jsx)(R.u,{content:i,children:(0,p.jsx)(V.L03,{className:"coz-fg-hglt-yellow cursor-pointer text-sm"})}):null})),(0,p.jsx)(G.P,{errors:null==r?void 0:r.errors})]})}})},e8=e=>{var{readonly:t,inputField:n,inputsField:o,index:r,enabledTypes:a}=e;return e2(null==n?void 0:n.value)?(0,p.jsxs)("div",{className:"flex items-start pb-1 gap-1",children:[(0,p.jsx)(e3,{inputField:n,inputsField:o,enabledTypes:a}),(0,p.jsx)(e6,{name:"".concat(n.name,".input"),enabledTypes:a}),t?(0,p.jsx)(p.Fragment,{}):(0,p.jsx)("div",{className:"leading-none",children:(0,p.jsx)(R.hU,{size:"small",color:"secondary",icon:(0,p.jsx)(V.ozt,{className:"text-sm"}),onClick:()=>{o.delete(r)}})})]}):null},e9=()=>{var e,t,n,o=(e=e1(),t=(0,m.G2)(eV.we).getModelAbility(e),n=[],(null==t?void 0:t.image_understanding)&&n.push(u.owu.Image),(null==t?void 0:t.video_understanding)&&n.push(u.owu.Video),n),r=o.length?"":_.o.t("workflow_250310_05",void 0,"所选模型不支持视觉理解"),a=(0,m.cI)(),i=(0,T.j)();return(0,p.jsx)(m.F2,{name:"$$input_decorator$$.inputParameters",children:e=>{var{field:t}=e;return(0,p.jsxs)(eT.E,{header:_.o.t("workflow_250310_04",void 0,"视觉理解输入"),tooltip:_.o.t("workflow_250320_03",void 0,"用于视觉理解的输入，传入图片or视频的url；并在Prompt中应用该输入"),children:[(0,p.jsx)("div",{className:e5.Z["vision-title"],children:(0,p.jsx)(eP.b,{columns:[{title:_.o.t("workflow_detail_variable_input_name"),style:{flex:2}},{title:_.o.t("workflow_detail_variable_input_value"),style:{flex:3}}],readonly:i})}),t.map((e,n)=>(0,p.jsx)(e8,{inputField:e,inputsField:t,index:n,readonly:i,form:a,enabledTypes:o},e.key)),i?(0,p.jsx)(p.Fragment,{}):(0,p.jsx)("div",{className:e5.Z["vision-add-icon"],children:(0,p.jsx)(e0,{disabledTooltip:r,onClick:()=>{t.append({name:"",input:{type:u.YX3.REF,rawMeta:{isVision:!0}}})}})})]})}})},e7=(e,t)=>e2(e)===e2(t),te=n("670324"),tt="reasoning_content",tn=_.o.t("workflow_250217_02",void 0,"推理内容，支持输出思维链的模型特有"),to=()=>({key:(0,m.x0)(),name:tt,type:u.owu.String,readonly:!0,readonlyTooltip:tn}),tr=e=>e.name===tt,ta=e=>!!(tr(e)&&e.readonly),ti=e=>(null!=e?e:[]).filter(e=>!ta(e)),tl=e=>(null!=e?e:[]).filter(e=>ta(e)),ts=(e,t)=>{if(!e)return e;if(t){var n;return[(0,D._)((0,c._)({},e[0]),{children:[...ti(null===(n=e[0])||void 0===n?void 0:n.children),to()]})]}return[...ti(e),to()]},td=(e,t)=>{if(!e)return e;if(!t)return[...ti(e)];var[n,...o]=e;return[(0,D._)((0,c._)({},n),{children:ti(null==n?void 0:n.children)}),...o]};function tu(e,t,n){if(!!e){if(t){var o,r;return null===(r=e[0])||void 0===r?void 0:null===(o=r.children)||void 0===o?void 0:o.find(e=>n(e))}return e.find(e=>n(e))}}var tc=(e,t)=>{if(!e)return e;if(t){var[n,...o]=e;return[(0,D._)((0,c._)({},n),{children:[...ti(null==n?void 0:n.children),...tl(null==n?void 0:n.children)]}),...o]}return[...ti(e),...tl(e)]},tp=(e,t)=>t?null==e?void 0:e.map(e=>{var t;return(0,D._)((0,c._)({},e),{children:null==e?void 0:null===(t=e.children)||void 0===t?void 0:t.filter(e=>!ta(e))})}):null==e?void 0:e.filter(e=>!ta(e)),tv=[{effect:e=>{var t,n,{value:o,context:{node:r}}=e,a=null==o?void 0:o.modelType,i=null==r?void 0:null===(n=r.getData(m.Ps))||void 0===n?void 0:null===(t=n.getFormModel())||void 0===t?void 0:t.nativeFormModel;if(!!i&&!!a){var l=i.getValueIn("outputs"),s="batch"===i.getValueIn("batchMode"),d=r.getService(eV.we);i.setValueIn("outputs",function(e){var{modelType:t,outputs:n,isBatch:o,modelsService:r}=e;return t?n=r.isCoTModel(t)?ts(n,o):td(n,o):n}({modelType:a,outputs:l,isBatch:s,modelsService:d}))}},event:m.zE.onValueChange}],tm=/^(?!.*\b(true|false|and|AND|or|OR|not|NOT|null|nil|If|Switch)\b)[a-zA-Z_][a-zA-Z_$0-9]*$/,tf=te.z.lazy(()=>te.z.object({name:te.z.string({required_error:_.o.t("workflow_detail_node_error_name_empty")}).min(1,_.o.t("workflow_detail_node_error_name_empty")).regex(tm,_.o.t("workflow_detail_node_error_format")).refine(e=>e!==tt&&!0,{message:_.o.t("workflow_250213_01")}),children:te.z.array(tf).optional()}).passthrough()),tg=(e,t)=>t?null==e?void 0:e.map(e=>{var t;return(0,D._)((0,c._)({},e),{children:null==e?void 0:null===(t=e.children)||void 0===t?void 0:t.filter(e=>(null==e?void 0:e.name)!=="errorBody")})}):null==e?void 0:e.filter(e=>(null==e?void 0:e.name)!=="errorBody"),th=n("941847"),t_=n("178385"),ty=n("566785");var tx=((o={}).Plugin="plugin",o.Workflow="workflow",o.Knowledge="knowledge",o),tw={auto:!1,min_score:.5,no_recall_reply_customize_prompt:_.o.t("No_recall_006"),no_recall_reply_mode:0,search_strategy:0,show_source:!1,show_source_mode:0,top_k:3,use_rerank:!0,use_rewrite:!0,use_nl2_sql:!0},tb=new Map([[1,"String"],[2,"Integer"],[3,"Number"],[4,"Object"],[5,"Array"],[6,"Bool"]]),tj=e=>{var t,n=[];return null==e||null===(t=e.model_params)||void 0===t||t.forEach(e=>{var t,o=(0,th.Z)(e.name),{type:r}=e,a=null!==(t=e.default_val[u.Gu0.Balance])&&void 0!==t?t:e.default_val[u.Gu0.Customize];void 0!==a&&(t_.c4.Float===r?n.push(u.ycG.createFloat(o,a)):(t_.c4.Int===r||["modelType"].includes(o))&&n.push(u.ycG.createInteger(o,a)))}),n},tk=e=>{var t,n,o,r=null!==(t=e.find(e=>e.model_type===eu.Dj))&&void 0!==t?t:e[0];return[u.ycG.createInteger("modelType","".concat(null!==(n=null==r?void 0:r.model_type)&&void 0!==n?n:"")),u.ycG.createString("modelName",null!==(o=null==r?void 0:r.name)&&void 0!==o?o:""),u.ycG.createString("generationDiversity",u.Gu0.Balance),...tj(r)].filter(Boolean)},tN=e=>{var t=(null==e?void 0:e.name)||"";"modleName"===t&&(t="modelName");var n=e.input.value.content;return[u.Rkg.float,u.Rkg.integer].includes(e.input.type)&&(n=Number(e.input.value.content)),[t,n]},tS=(e,t)=>Object.keys(e).map(n=>{var o,r,a=null==t?void 0:null===(r=t.model_params)||void 0===r?void 0:null===(o=r.find(e=>(0,th.Z)(e.name)===n))||void 0===o?void 0:o.type;if(t_.c4.Float===a)return u.ycG.createFloat(n,e[n]);if(t_.c4.Int===a||["modelType"].includes(n))return u.ycG.createInteger(n,e[n]);var i=n;return"modelName"===i&&(i="modleName"),u.ycG.createString(i,e[n])}),tC=e=>"plugin"===e?tx.Plugin:"imageflow"===e||"workflow"===e?tx.Workflow:tx.Knowledge,tI=(e,t)=>{var n=tC(e.type),o=t||{};if(n===tx.Plugin){var r,a,i=(null===(r=o.pluginFCParam)||void 0===r?void 0:r.pluginList)||[],l=null===(a=e.detail_info)||void 0===a?void 0:a.plugin_detail;return i.push({plugin_id:null==l?void 0:l.plugin_id,api_id:null==l?void 0:l.api_id,api_name:null==l?void 0:l.name,plugin_version:"",is_draft:(0,ty.rK)(null==l?void 0:l.project_id)}),(0,D._)((0,c._)({},o),{pluginFCParam:{pluginList:i}})}if(n===tx.Workflow){var s,d,u=(null===(s=o.workflowFCParam)||void 0===s?void 0:s.workflowList)||[],p=null===(d=e.detail_info)||void 0===d?void 0:d.workflow_detail;return u.push({plugin_id:null==p?void 0:p.plugin_id,workflow_id:null==p?void 0:p.workflow_id,plugin_version:"",workflow_version:"",is_draft:(0,ty.rK)(null==p?void 0:p.project_id)}),(0,D._)((0,c._)({},o),{workflowFCParam:{workflowList:u}})}if(n===tx.Knowledge){var v,m,f,g,h=(null===(v=o.knowledgeFCParam)||void 0===v?void 0:v.knowledgeList)||[],_=null===(m=e.detail_info)||void 0===m?void 0:m.knowledge_detail;return h.push({id:null==_?void 0:_.id,name:null==_?void 0:_.name}),(0,D._)((0,c._)({},o),{knowledgeFCParam:(0,D._)((0,c._)({},o.knowledgeFCParam),{knowledgeList:h,global_setting:null!==(g=null===(f=o.knowledgeFCParam)||void 0===f?void 0:f.global_setting)&&void 0!==g?g:tw})})}return o},tT=n("168628"),tP=n("67613"),tD=e=>{var t,n,{field:o,fieldState:r}=e,a=(0,m.cI)(),i=(0,T.j)(),{models:l}=(0,L.C5)(),s=a.getValueIn("model.modelType"),d=null==l?void 0:l.find(e=>e.model_type===s),u=null!==(n=null==d?void 0:d.is_up_required)&&void 0!==n&&n;return(0,O.useEffect)(()=>{o._fieldModel.validate()},[u]),(0,p.jsxs)(eT.E,{header:_.o.t("workflow_detail_llm_prompt"),tooltip:_.o.t("workflow_detail_llm_prompt_tooltip"),required:u,actionButton:i?[(0,p.jsx)(tP.q,{value:null==o?void 0:o.value})]:[],children:[(0,O.createElement)(tT.i,(0,D._)((0,c._)({placeholder:_.o.t("workflow_detail_llm_prompt_content"),maxLength:500},o),{inputParameters:a.getValueIn("$$input_decorator$$.inputParameters"),key:"ExpressionEditor",isError:!!(null==r?void 0:null===(t=r.errors)||void 0===t?void 0:t.length)})),(0,p.jsx)(G.P,{errors:null==r?void 0:r.errors})]},"FormCard")},tE=n("724847"),tO=n("227048"),tL=n("340291"),tM=n("56695"),tF=n("887874"),tZ=n("753015"),tR=n("219263"),tV=n("273757"),tA=n("539227"),tz=n("944881"),tB=n("310904"),tU=n("189284"),tq=n("824253"),tW=(e,t)=>{t&&e.$view.dispatch({selection:{anchor:t.to}}),e.$view.focus()},tG=n("775699"),tH=n("925623"),t$=n("249294"),tJ=n("189914"),tY=e=>{var{readonly:t,placeholder:n,defaultValue:o,value:r,onChange:a,isControled:i,wrapperClassName:l="",wrapperStyle:s,dataTestID:d,onFocus:u,onBlur:c}=e,[v,m]=(0,O.useState)(!1);return(0,p.jsx)(tG.u,{content:_.o.t("db_table_0129_003"),trigger:"custom",position:"top",autoAdjustOverflow:!1,visible:v&&t,getPopupContainer:()=>{var e;return null!==(e=document.getElementById(tJ.I7))&&void 0!==e?e:document.body},children:(0,p.jsxs)("div",{className:l,style:s,onMouseEnter:()=>{m(!0)},onMouseLeave:()=>{m(!1)},children:[(0,p.jsx)(tO.gv,{defaultValue:null!=o?o:r,value:r,onChange:a,readonly:t,placeholder:n,options:{minHeight:112,fontSize:12},dataTestID:d,isControled:i,onFocus:()=>{m(!0),null==u||u()},onBlur:()=>{m(!1),null==c||c()}}),(0,p.jsx)(tH.G,{themes:[t$.tk.theme({".cm-line":{lineHeight:"18px !important"}})]})]})})},tQ=(0,n("598208").Ue)(e=>({libraries:[],updateLibraries:t=>e({libraries:t})})),tX=n("202682"),tK=n("99285"),t0=n("936381"),t1=n("93027"),t2=n("55883"),t4=e=>{var{readonly:t}=e,{getNodeSetterId:n}=(0,u.FCD)(),o=n(e.name),r=(0,tO.jE)(),{id:a,type:i}=(0,eh.j)(),{libraries:l}=tQ(e=>({libraries:e.libraries})),s=(0,tq.V)(),{setFullscreenPanel:d}=(0,tL.Tk)(),{spaceId:v,projectId:m,workflowId:f,info:{name:g="",desc:h=""}}=(0,L.j1)(),y=(0,tM._)(),x=(0,ex.Dv)(null==e?void 0:e.value,y),w=()=>"",b=(0,O.useMemo)(()=>()=>({botId:"",name:g,description:h,contextHistory:x}),[g,h,x]),j=null==r?void 0:r.getValue(),{open:k,node:N}=(0,tR.d)({spaceId:v,getConversationId:w,getPromptContextInfo:b,source:"app_detail_page",projectId:m,workflowId:f,editor:r,onInsertPrompt:(t,n)=>null==e?void 0:e.onChange(t)}),{open:S,node:C}=(0,tZ.c)({spaceId:v,projectId:m,workflowId:f,source:"app_detail_page"});return(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(t1.oP,{id:"system-prompt-expand-editor",closeButton:(0,p.jsxs)("div",{className:"flex items-center gap-[8px]",children:[(0,p.jsx)(R.u,{content:_.o.t("compare_tooltips_submit_to_the_prompt"),children:(0,p.jsx)(R.zx,{color:"secondary",icon:(0,p.jsx)(V.PuI,{}),onClick:()=>S({mode:"create",defaultPrompt:null==r?void 0:r.getValue()})})}),null,(0,p.jsx)(R.u,{content:_.o.t("workflow_prompt_editor_view_library"),children:(0,p.jsx)(R.hU,{onClick:()=>{k()},icon:(0,p.jsx)(V.TU,{}),color:"secondary",disabled:t})}),(0,p.jsx)(R.hU,{onClick:()=>d(null),color:"secondary",icon:(0,p.jsx)(V.syE,{color:"#060709CC"})})]}),containerClassName:"bg-[#FCFCFF]",headerClassName:"bg-[#FCFCFF] text-[16px] leading-[22px] font-medium mb-[12px] !p-[20px]",editorTitle:(0,p.jsx)("div",{className:"flex items-center gap-[8px]",children:(0,p.jsx)("div",{className:"text-[16px] leading-[22px] font-medium",style:{color:"var(--Fg-COZ-fg-plus, rgba(6, 7, 9, 0.96))"},children:_.o.t("workflow_LLM_node_sp_title")})}),contentClassName:t2.Z["editor-content"],editorContent:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:"relative w-full h-full pl-[8px] pr-[20px]",children:[(0,p.jsx)(tY,{defaultValue:null==e?void 0:e.value,onChange:null==e?void 0:e.onChange,readonly:null==e?void 0:e.readonly,placeholder:null==e?void 0:e.placeholder,wrapperClassName:t2.Z["prompt-editor"],wrapperStyle:{height:"100%"},dataTestID:o}),(0,p.jsx)(tz.Vv,{mode:"input"}),(0,p.jsx)(tA.jy,(0,D._)((0,c._)({},{librarys:l,disabledTooltips:e.readonly}),{spaceId:v,projectId:"project"===i?a:void 0,onAddLibrary:e.onAddLibrary,onRename:e=>tW(r,e)})),(0,p.jsx)(tE.YN,{shortcutKey:"/"}),(0,p.jsx)(tB.Af,{}),(0,p.jsx)(tV.e,{variableTree:s,libraries:l,readonly:e.readonly,onInsert:e=>tW(r,e)}),(0,p.jsx)(tB.iA,{variableTree:s}),!(null==e?void 0:e.readonly)&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(t0.ol,{children:[(0,p.jsx)(tE.Ys,{}),(0,p.jsx)(tK.aS,{})]}),(null==j?void 0:j.length)===0?(0,p.jsx)(tX.u,{tabs:["Recommended","Team"],importPromptWhenEmpty:null==e?void 0:e.value,source:"app_detail_page",projectId:m,workflowId:f,spaceId:v,getConversationId:w,getPromptContextInfo:b,onInsertPrompt:(t,n)=>{null==e||e.onChange(t)},listContainerClassName:"h-[211px]",cardClassName:"w-[240xp]"}):null]})]}),(0,p.jsx)(tE.fP,{getConversationId:w,getPromptContextInfo:b}),N,C]})})})},t6=e=>{var{openPromptLibrary:t,readonly:n,value:o,openCreatePrompt:r}=e,{updateLibraries:a}=tQ(e=>({updateLibraries:e.updateLibraries})),{fullscreenPanel:i,setFullscreenPanel:l}=(0,tL.Tk)(),s=!!i;return(0,O.useEffect)(()=>{a(e.libraries||[])},[e.libraries]),(0,p.jsxs)("div",{className:"flex justify-between items-center gap-[8px] h-[28px] ".concat(t2.Z["kit-button-container"]),children:[n?(0,p.jsx)(tP.q,{value:o}):null,(0,p.jsx)(R.u,{content:_.o.t("compare_tooltips_submit_to_the_prompt"),children:(0,p.jsx)(R.zx,{color:"secondary",disabled:n,icon:(0,p.jsx)(V.PuI,{}),onClick:()=>r({mode:"create",defaultPrompt:o})})}),(0,p.jsx)(R.u,{content:_.o.t("workflow_prompt_editor_view_library"),children:(0,p.jsx)(R.hU,{onClick:e=>{e.stopPropagation(),t()},icon:(0,p.jsx)(V.TU,{}),color:"secondary",disabled:n})}),(0,p.jsx)(R.u,{content:_.o.t(s?"collapse":"workflow_prompt_editor_expand"),children:(0,p.jsx)(tG._3,{onClick:()=>{l(s?null:(0,p.jsx)(I.n,{children:(0,p.jsx)(tO.hT,{children:(0,p.jsx)(t4,(0,c._)({},e))})}))},icon:s?(0,p.jsx)(V.qSn,{color:"#6B6D75"}):(0,p.jsx)(V.ltt,{color:"#6B6D75"}),color:"#6B6D75"})}),(0,p.jsx)("div",{className:t2.Z["nl-prompt"],children:null})]})},t5=e=>{var{name:t,getConversationId:n,getPromptContextInfo:o,readonly:r,placeholder:a,value:i,onChange:l,libraries:s=[],onAddLibrary:d}=e,{id:v,type:m}=(0,eh.j)(),{getNodeSetterId:f}=(0,u.FCD)(),g=f(t),{spaceId:h,projectId:y,workflowId:x}=(0,L.j1)(),[w,b]=(0,O.useState)(!1),j=(0,tq.V)(),k=(0,tF.jE)(),N=(0,O.useRef)(i||""),[S]=(0,tU.V)(),C=S["bot.automation.llm_prompt_skills"],{open:I,node:T}=(0,tR.d)({spaceId:h,getConversationId:n,projectId:y,workflowId:x,getPromptContextInfo:o,source:"app_detail_page",editor:k,onInsertPrompt:(t,n)=>null==e?void 0:e.onChange(t)}),{open:P,node:E}=(0,tZ.c)({spaceId:h,source:"app_detail_page",projectId:y,workflowId:x});return(0,p.jsxs)("div",{className:t2.Z.container,onBlur:()=>null==l?void 0:l(N.current),children:[(0,p.jsxs)(eT.E,{defaultExpand:!0,showBottomBorder:!0,noPadding:!0,header:_.o.t("workflow_LLM_node_sp_title"),tooltip:_.o.t("workflow_detail_llm_sys_prompt_content_tips"),contentClassName:J()(t2.Z["code-content"],{[t2.Z["code-content-focus"]]:w}),actionButton:(0,p.jsx)(t6,(0,D._)((0,c._)({},e),{getConversationId:n,getPromptContextInfo:o,onInsertPrompt:t=>null==e?void 0:e.onChange(t),openPromptLibrary:I,openCreatePrompt:P,onAddLibrary:d})),children:[(0,p.jsx)(tY,{defaultValue:i,value:i,onChange:e=>N.current=e,readonly:r,placeholder:a,isControled:!0,dataTestID:g,onFocus:()=>{b(!0)},onBlur:()=>{b(!1)}}),(0,p.jsx)(tz.Vv,{mode:"input"}),(0,p.jsx)(tA.jy,(0,D._)((0,c._)({},C?{librarys:s,disabledTooltips:r}:{librarys:[],readonly:!0}),{spaceId:h,projectId:"project"===m?v:void 0,onAddLibrary:(e,t)=>{tW(k,t),null==d||d(e)},onRename:e=>tW(k,e)})),(0,p.jsx)(tB.Af,{}),C?(0,p.jsx)(tV.e,{variableTree:j,libraries:s,readonly:r,onInsert:e=>tW(k,e)}):(0,p.jsx)(tB.ID,{variableTree:j}),(0,p.jsx)(tB.iA,{variableTree:j})]}),(0,p.jsx)(tE.fP,{getConversationId:n,getPromptContextInfo:o}),T,E]})},t3=e=>{var t=(0,T.j)(),{fullscreenPanel:n}=(0,tL.Tk)(),{info:{name:o="",desc:r=""}}=(0,L.j1)(),a=(0,tM._)(),i=(0,ex.Dv)(null==e?void 0:e.value,a),l=(0,O.useMemo)(()=>()=>({botId:"",name:o,description:r,contextHistory:i}),[o,r,i]);return(0,p.jsx)(tO.hT,{children:(0,p.jsx)(tE.rZ,{children:(0,p.jsx)(t5,(0,D._)((0,c._)({},e),{readonly:t||!!n,getConversationId:()=>"",getPromptContextInfo:l}))})})},t8=n("567282"),t9=n("531566"),t7=(e,t)=>{var n,o,r,a,i,l,s,d,u,c,p,v,m,f,g,h,_,y=[],x=null==t?void 0:null===(o=t.pluginFCParam)||void 0===o?void 0:null===(n=o.pluginList)||void 0===n?void 0:n.map(t=>{var n,o,r=null==e?void 0:null===(n=e.plugin_detail_map)||void 0===n?void 0:n[t.plugin_id],a=null==e?void 0:null===(o=e.plugin_api_detail_map)||void 0===o?void 0:o[t.api_id];return{type:"plugin",id:t.plugin_id,icon_url:(null==r?void 0:r.icon_url)||"",name:(null==a?void 0:a.name)||"",desc:(null==a?void 0:a.description)||"",api_id:null==a?void 0:a.id}}),w=null==t?void 0:null===(i=t.workflowFCParam)||void 0===i?void 0:null===(a=i.workflowList)||void 0===a?void 0:null===(r=a.filter(t=>{var n,o=null==e?void 0:null===(n=e.workflow_detail_map)||void 0===n?void 0:n[t.workflow_id];return(null==o?void 0:o.flow_mode)===t8.wz.Workflow||(null==o?void 0:o.flow_mode)===t8.wz.ChatFlow}))||void 0===r?void 0:r.map(t=>{var n,o=null==e?void 0:null===(n=e.workflow_detail_map)||void 0===n?void 0:n[t.workflow_id];return{type:"workflow",id:t.workflow_id,icon_url:(null==o?void 0:o.icon_url)||"",name:(null==o?void 0:o.name)||"",desc:(null==o?void 0:o.description)||""}}),b=null==t?void 0:null===(d=t.workflowFCParam)||void 0===d?void 0:null===(s=d.workflowList)||void 0===s?void 0:null===(l=s.filter(t=>{var n,o=null==e?void 0:null===(n=e.workflow_detail_map)||void 0===n?void 0:n[t.workflow_id];return(null==o?void 0:o.flow_mode)===t8.wz.Imageflow}))||void 0===l?void 0:l.map(t=>{var n,o=null==e?void 0:null===(n=e.workflow_detail_map)||void 0===n?void 0:n[t.workflow_id];return{type:"imageflow",id:t.workflow_id,icon_url:(null==o?void 0:o.icon_url)||"",name:(null==o?void 0:o.name)||"",desc:(null==o?void 0:o.description)||""}}),j=t=>n=>{var o,r=null==e?void 0:null===(o=e.dataset_detail_map)||void 0===o?void 0:o[n.id];return(null==r?void 0:r.format_type)===t},k=null==t?void 0:null===(p=t.knowledgeFCParam)||void 0===p?void 0:null===(c=p.knowledgeList)||void 0===c?void 0:null===(u=c.filter(j(1)))||void 0===u?void 0:u.map(t=>{var n,o=null==e?void 0:null===(n=e.dataset_detail_map)||void 0===n?void 0:n[t.id];return{type:"table",id:t.id,icon_url:(null==o?void 0:o.icon_url)||"",name:(null==o?void 0:o.name)||"",desc:""}}),N=null==t?void 0:null===(f=t.knowledgeFCParam)||void 0===f?void 0:null===(m=f.knowledgeList)||void 0===m?void 0:null===(v=m.filter(j(2)))||void 0===v?void 0:v.map(t=>{var n,o=null==e?void 0:null===(n=e.dataset_detail_map)||void 0===n?void 0:n[t.id];return{type:"image",id:t.id,icon_url:(null==o?void 0:o.icon_url)||"",name:(null==o?void 0:o.name)||"",desc:""}}),S=null==t?void 0:null===(_=t.knowledgeFCParam)||void 0===_?void 0:null===(h=_.knowledgeList)||void 0===h?void 0:null===(g=h.filter(j(0)))||void 0===g?void 0:g.map(t=>{var n,o=null==e?void 0:null===(n=e.dataset_detail_map)||void 0===n?void 0:n[t.id];return{type:"text",id:t.id,icon_url:(null==o?void 0:o.icon_url)||"",name:(null==o?void 0:o.name)||"",desc:""}});return(null==x?void 0:x.length)&&y.push({type:"plugin",items:x}),(null==w?void 0:w.length)&&y.push({type:"workflow",items:w}),(null==b?void 0:b.length)&&y.push({type:"imageflow",items:b}),(null==k?void 0:k.length)&&y.push({type:"table",items:k}),(null==N?void 0:N.length)&&y.push({type:"image",items:N}),(null==S?void 0:S.length)&&y.push({type:"text",items:S}),y},ne=e=>{var{placeholder:t,inputParameters:n,fcParam:o,onAddLibrary:r}=e,a=(0,U._)(e,["placeholder","inputParameters","fcParam","onAddLibrary"]),i=(0,m.cI)(),l=(0,m.JA)(),{libraries:s,refetch:d}=function(e){var{fcParam:t={}}=e,n=(0,L.j1)(),o=(0,m.PF)(),{data:r,refetch:a}=(0,t9.b)((0,c._)({workflowId:n.workflowId,spaceId:n.spaceId,nodeId:o.id},(0,ty.Vq)(t)));return{libraries:(0,O.useMemo)(()=>t7(r,t),[r,t]),refetch:a}}({fcParam:o}),u=(0,O.useCallback)(e=>{i.setValueIn("fcParam",tI(e,i.getValueIn("fcParam"))),l(),setTimeout(()=>{d()},10)},[r]);return(0,p.jsx)(t3,(0,D._)((0,c._)({},a),{onAddLibrary:u,libraries:s,placeholder:t,inputParameters:n}))},nt=n("182733"),nn=n("280990"),no=n("408487"),nr=e=>{var{workflowId:t,spaceId:n}=(0,L.j1)();return(0,nn.D)({mutationFn:e=>no.OHc.GetLLMNodeFCSettingsMerged({workflow_id:t,space_id:n,plugin_fc_setting:e.pluginFCSetting,workflow_fc_setting:e.workflowFCSetting})})},na=n("319529"),ni=n("335740"),nl=n("44172"),ns=n("740573"),nd=e=>{var t,{initValue:n,onChange:o}=e,r=(e,t)=>r=>{if(!!n){var a,i=(0,ni.Z)(n);(0,v.Z)(null!==(a=i.response_params)&&void 0!==a?a:[],e.join("."),(0,D._)((0,c._)({},t),{local_disable:!r})),null==o||o(i)}},a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return null==e?void 0:e.map((e,n)=>{var o=[...t,n];return{label:(0,p.jsxs)("div",{className:"flex items-center text-xs",children:[(0,p.jsxs)("div",{className:"flex-1",children:[(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("div",{className:"font-medium",children:e.name}),(0,p.jsx)("div",{children:(0,p.jsx)(ns.p,{children:tb.get(e.type)})})]}),e.desc?(0,p.jsx)("div",{className:"coz-fg-dim",children:e.desc}):null]}),(0,p.jsx)("div",{style:{flex:"0 0 60px"},children:(0,p.jsx)(R.rs,{size:"mini",checked:!0!==e.local_disable,onChange:r(o,e)})})]}),value:e.name,key:o.join("-"),children:e.sub_parameters?a(e.sub_parameters,[...o,"sub_parameters"]):null}})};return(0,p.jsxs)("div",{className:"h-full flex flex-col",children:[(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{children:(0,p.jsx)(R.l0.Label,{text:_.o.t("skillset_241115_01")})}),(0,p.jsx)(R.Ph,{className:"mb-4",defaultValue:null==n?void 0:null===(t=n.response_style)||void 0===t?void 0:t.mode,disabled:!0,optionList:[{label:_.o.t("skillset_241115_02"),value:1},{label:_.o.t("skillset_241115_03"),value:0}],onChange:e=>{null==o||o((0,D._)((0,c._)({},n),{response_style:{mode:e}}))}})]}),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{children:(0,p.jsx)(R.l0.Label,{text:_.o.t("workflow_detail_end_output")})}),(0,p.jsx)("div",{className:"text-xs text-left coz-fg-secondary coz-mg-hglt py-2 px-3 rounded-lg",children:_.o.t("plugin_bot_ide_plugin_setting_modal_item_enable_tip")}),(0,p.jsxs)("div",{className:"flex text-xs coz-fg-dim font-medium mt-3",children:[(0,p.jsx)("div",{className:"flex-1 pl-[26px]",children:_.o.t("Create_newtool_s3_table_name")}),(0,p.jsxs)("div",{style:{flex:"0 0 60px"},children:[_.o.t("plugin_edit_tool_default_value_config_item_enable"),(0,p.jsx)(tG.u,{content:_.o.t("plugin_bot_ide_output_param_enable_tip"),children:(0,p.jsx)(nl.aUG,{className:"relative left-[2px] top-[3px]"})})]})]}),(0,p.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,p.jsx)(tG.mp,{treeData:a(null==n?void 0:n.response_params),defaultExpandAll:!0})})]})]})},nu=n("416290"),nc=e=>{var t,n,o,{initValue:r=[],onChange:a}=e;var{containerRef:i,scroll:l}=(t=55,n=(0,O.useRef)(null),o=(0,nu.Z)(n),{containerRef:n,scroll:(0,O.useMemo)(()=>({y:(null==o?void 0:o.height)?o.height-55:0}),[o,t])}),s=e=>t=>{null==a||a(r.map((n,o)=>o===e?(0,D._)((0,c._)({},n),{local_default:t}):n))},d=e=>t=>{null==a||a(r.map((n,o)=>o===e?(0,D._)((0,c._)({},n),{local_disable:!t}):n))};return(0,p.jsx)("div",{ref:i,className:"h-full",children:(0,p.jsx)(R.iA,{tableProps:{dataSource:r,scroll:l,columns:[{title:_.o.t("Create_newtool_s3_table_name"),dataIndex:"name",width:300,render:(e,t,n)=>(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)("div",{children:t.name}),(0,p.jsx)(ns.p,{children:tb.get(t.type)}),t.is_required?(0,p.jsx)(R.Vp,{color:"red",size:"mini",children:_.o.t("required")}):null]}),(0,p.jsx)("div",{className:"coz-fg-dim font-normal leading-4",children:t.desc})]})},{title:_.o.t("plugin_edit_tool_default_value_config_item_default_value"),dataIndex:"defaultValue",width:160,render:(e,t,n)=>(0,p.jsx)(R.II,{size:"small",defaultValue:t.local_default,onChange:s(n)})},{title:()=>(0,p.jsxs)("div",{children:[_.o.t("plugin_edit_tool_default_value_config_item_enable"),(0,p.jsx)(tG.u,{content:_.o.t("plugin_bot_ide_plugin_setting_modal_item_enable_tip"),children:(0,p.jsx)(nl.aUG,{className:"relative left-[2px] top-[2px]"})})]}),dataIndex:"enable",render:(e,t,n)=>(0,p.jsx)(R.rs,{size:"mini",checked:!1===t.local_disable,onChange:d(n)})}]}})})},np=n("232509"),nv=e=>{let t;var{visible:n,setting:o,onSubmit:r,onCancel:a}=e,[i,l]=(0,O.useState)("input"),[s,d]=(0,O.useState)(o);return(0,p.jsx)(R.u_,{className:np.Z["plugin-setting-form-modal"],size:"xl",visible:n,onCancel:a,bodyStyle:{padding:0},height:700,footer:(0,p.jsxs)("div",{className:"pt-0 flex",children:[(0,p.jsx)("div",{className:"coz-bg-primary p-4",style:{flex:"0 0 220px"}}),(0,p.jsx)("div",{className:"flex-1 pb-4 pr-4",children:(0,p.jsx)(R.zx,{color:"hgltplus",onClick:()=>{null==r||r(s)},children:_.o.t("Save")})})]}),children:(0,p.jsxs)("div",{className:"flex h-full",children:[(0,p.jsxs)("div",{className:"coz-bg-primary p-4",style:{flex:"0 0 220px"},children:[(0,p.jsx)(R.ZT.Title,{heading:4,className:"!mb-4 px-2",children:_.o.t("basic_setting")}),(0,p.jsxs)(R.JL,{className:np.Z["plugin-setting-nav"],selectedKeys:[i],onSelect:e=>{var{itemKey:t}=e;return l(t)},children:[(0,p.jsx)(R.LY,{itemKey:"input",text:_.o.t("Create_newtool_s2_title")}),(0,p.jsx)(R.LY,{itemKey:"output",text:_.o.t("Create_newtool_s3_Outputparameters")})]})]}),(0,p.jsxs)("div",{className:"flex-1 px-4 pt-[50px] relative h-full overflow-y-hidden",children:[(0,p.jsx)("div",{className:J()({hidden:"input"!==i,block:"input"===i},"h-full"),children:(0,p.jsx)(nc,{initValue:null==s?void 0:s.request_params,onChange:(t="request_params",e=>{d((0,D._)((0,c._)({},s),{[t]:e}))})})}),(0,p.jsx)("div",{className:J()({hidden:"output"!==i,block:"output"===i},"h-full"),children:(0,p.jsx)(nd,{initValue:{response_params:null==s?void 0:s.response_params,response_style:null==s?void 0:s.response_style},onChange:e=>{d((0,c._)({},s,e))}})})]})]})})},nm=e=>{var{setting:t,onChange:n}=e,o=nr({nodeId:(0,m.PF)().id}),[r,a]=(0,O.useState)(void 0),[i,l]=(0,O.useState)(!1);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(na.L,{tooltip:_.o.t("plugin_bot_ide_plugin_setting_icon_tip"),icon:(0,p.jsx)(V.qBd,{}),onClick:()=>{o.mutate({workflowFCSetting:t?(0,c._)({workflow_id:e.workflow_id,plugin_id:e.plugin_id,is_draft:e.is_draft,workflow_version:e.workflow_version},t):{workflow_id:e.workflow_id,plugin_id:e.plugin_id,request_params:[],response_params:[],workflow_version:e.workflow_version,response_style:{mode:0}}},{onSuccess:e=>{a(null==e?void 0:e.worflow_fc_setting),l(!0)}})}}),i?(0,p.jsx)(nv,{visible:i,setting:r,onSubmit:e=>{null==n||n(e),l(!1)},onCancel:()=>l(!1)}):null]})},nf=e=>{var{setting:t,onChange:n}=e,o=nr({nodeId:(0,m.PF)().id}),[r,a]=(0,O.useState)(void 0),[i,l]=(0,O.useState)(!1);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(na.L,{tooltip:_.o.t("plugin_bot_ide_plugin_setting_icon_tip"),icon:(0,p.jsx)(V.qBd,{}),onClick:()=>{o.mutate({pluginFCSetting:t?(0,c._)({plugin_id:e.plugin_id,api_id:e.api_id,api_name:e.api_name,is_draft:e.is_draft,plugin_version:e.plugin_version,plugin_from:e.plugin_from},t):{plugin_id:e.plugin_id,api_id:e.api_id,api_name:e.api_name,request_params:[],response_params:[],plugin_from:e.plugin_from,response_style:{mode:0},is_draft:e.is_draft,plugin_version:e.plugin_version}},{onSuccess:e=>{a(null==e?void 0:e.plugin_fc_setting),l(!0)}})}}),i?(0,p.jsx)(nv,{visible:i,setting:r,onSubmit:e=>{null==n||n(e),l(!1)},onCancel:()=>l(!1)}):null]})},ng=n("695673"),nh=n("881687"),n_=e=>{var t,n,o,r,a,{visible:i,onSubmit:l}=e,[s,d]=(0,O.useState)(null!==(a=e.setting)&&void 0!==a?a:tw);return(0,p.jsx)(R.u_,{size:"large",height:700,visible:i,onCancel:e.onCancel,title:_.o.t("dataset_settings_title"),footer:(0,p.jsx)("div",{children:(0,p.jsx)(R.zx,{color:"hgltplus",onClick:()=>{null==l||l(s)},children:_.o.t("Save")})}),children:(0,p.jsx)("div",{className:nh.Z["rag-mode-config-wrapper"],children:(0,p.jsx)(ng.Af,{dataSetInfo:(t=s,(0,c._)({recall_strategy:{use_rerank:null===(n=t.use_rerank)||void 0===n||n,use_rewrite:null===(o=t.use_rewrite)||void 0===o||o,use_nl2sql:null===(r=t.use_nl2_sql)||void 0===r||r}},(0,eZ.Z)(t,["use_rerank","use_rewrite","use_nl2_sql"]))),showTitle:!1,onDataSetInfoChange:e=>{var t,n,o,r,a,i;d((0,c._)({use_rerank:null===(r=null===(t=e.recall_strategy)||void 0===t?void 0:t.use_rerank)||void 0===r||r,use_rewrite:null===(a=null===(n=e.recall_strategy)||void 0===n?void 0:n.use_rewrite)||void 0===a||a,use_nl2_sql:null===(i=null===(o=e.recall_strategy)||void 0===o?void 0:o.use_nl2sql)||void 0===i||i},(0,eZ.Z)(e,["recall_strategy"])))},showAuto:!1,showSourceDisplay:!1,showNL2SQLConfig:!0})})})},ny=e=>{var{setting:t,onChange:n}=e,[o,r]=(0,O.useState)(!1);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(na.L,{tooltip:_.o.t("plugin_bot_ide_plugin_setting_icon_tip"),icon:(0,p.jsx)(V.qBd,{}),onClick:()=>r(!0)}),(0,p.jsx)(n_,{visible:o,setting:t,onSubmit:e=>{null==n||n(e),r(!1)},onCancel:()=>r(!1)})]})};function nx(){return(0,p.jsx)("div",{className:"flex justify-center pt-[13px] pb-[3px]",children:(0,p.jsx)(R.ub,{icon:(0,p.jsx)(V.nL$,{}),size:"default",title:_.o.t("wf_chatflow_155")})})}var nw=n("626389"),nb=n.n(nw),nj=n("458620"),nk=n("727914"),nN=e=>{var{title:t,pasteTitle:n,iconUrl:o,description:r,onRemove:a,settingRender:i,versionRender:l,params:s,readonly:d,hideActions:u,className:c}=e,v=(0,p.jsxs)(p.Fragment,{children:[s?(0,p.jsx)(na.L,{tooltip:s.map(e=>(0,p.jsxs)("div",{className:"mb-3",children:[(0,p.jsxs)("div",{className:"flex items-center mb-2 gap-1",children:[e.name,tb.get(e.type)?(0,p.jsx)(ns.p,{size:"xs",children:tb.get(e.type)}):null,e.is_required?(0,p.jsx)(R.Vp,{size:"mini",color:"yellow",children:_.o.t("required")}):null]}),(0,p.jsx)("div",{className:"font-normal coz-fg-secondary leading-4",children:e.desc})]})),icon:(0,p.jsx)(V.L03,{})}):null,(0,p.jsx)(na.L,{tooltip:_.o.t("bot_edit_page_plugin_copy_tool_name_tip"),icon:(0,p.jsx)(V.UtC,{}),onClick:()=>{try{if(!nb()(null!=n?n:t))throw new nk.sH(nj.b.copy,"empty content");R.FN.success({content:_.o.t("copy_success"),showClose:!1,id:"plugin_copy_id"})}catch(e){R.FN.warning({content:_.o.t("copy_failed"),showClose:!1})}}}),i]});return(0,p.jsx)(na.W,{icon:o,name:t,description:r,onRemove:a,actions:u?[]:v,nameSuffix:l,readonly:d,className:c,descriptionTooltipPosition:"bottom"})},nS=n("825955"),nC=n("39823"),nI=n("614904"),nT=n("328591"),nP=n("287411"),nD=n("770131");var nE=((r={}).Library="library",r.Project="project",r),nO=e=>{var{label:t,onClick:n,selected:o}=e;return(0,p.jsxs)("div",{onClick:n,className:J()(["flex items-center gap-[8px] px-[12px]","px-[12px] py-[6px] rounded-[8px]","cursor-pointer","hover:text-[var(--light-usage-text-color-text-0,#1c1f23)]","hover:bg-[var(--light-usage-fill-color-fill-0,rgba(46,50,56,5%))]",o&&"text-[var(--light-usage-text-color-text-0,#1c1d23)] bg-[var(--light-usage-fill-color-fill-0,rgba(46,47,56,5%))]"]),children:[(0,p.jsx)(V.Iqn,{}),t]})},nL=e=>{var{projectId:t,category:n="library",setCategory:o}=e;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(nO,{label:_.o.t("project_resource_modal_library_resources",{resource:_.o.t("resource_type_knowledge")}),onClick:()=>{null==o||o("library")},selected:"library"===n}),t?(0,p.jsx)(nO,{label:_.o.t("project_resource_modal_project_resources",{resource:_.o.t("resource_type_knowledge")}),onClick:()=>{null==o||o("project")},selected:"project"===n}):null]})},nM=n("936526"),nF=e=>{let t;var n,o,r,a,i,l,s,d,{visible:u,onSkillsChange:c,boundSkills:v,onCancel:m}=e,{projectId:f,getProjectApi:g,playgroundProps:h}=(0,L.j1)(),y=(0,O.useRef)(),x=(0,L.aQ)(),w=(0,L.oO)(),[b,j]=(0,O.useState)(nE.Library),k=f?nP.tx.ProjectWorkflow:nP.tx.WorkflowAddNode,[N,S]=(0,O.useState)(tx.Plugin);var C=(0,nD.A)({pluginApiList:null!==(l=null==v?void 0:null===(r=v.pluginFCParam)||void 0===r?void 0:r.pluginList)&&void 0!==l?l:[],onPluginApiListChange:(t=tx.Plugin,e=>c(t,e)),from:k,projectId:f,openModeCallback:(n=(0,nS._)(function*(e){var t,n;if(!!e&&!!(yield w.addApiCheck(e.plugin_id,e.version_ts)))c(tx.Plugin,[...null!==(n=null==v?void 0:null===(t=v.pluginFCParam)||void 0===t?void 0:t.pluginList)&&void 0!==n?n:[],{plugin_id:e.plugin_id,api_id:e.api_id,api_name:e.name,plugin_version:e.version_ts||"",is_draft:(0,ty.rK)(e.project_id),plugin_from:e.plugin_from}])}),function(e){return n.apply(this,arguments)})}),I=_.o.t("workflow_241119_01");var T=(0,nI.md)({from:f?nI.wL.ProjectWorkflowAddNode:nI.wL.WorkflowAddNode,projectId:f,workFlowList:(null!==(s=null==v?void 0:null===(a=v.workflowFCParam)||void 0===a?void 0:a.workflowList)&&void 0!==s?s:[]).map(e=>({workflow_id:e.workflow_id,plugin_id:e.plugin_id,name:"",desc:"",parameters:[],plugin_icon:""})),onWorkFlowListChange:()=>null,onAdd:(o=(0,nS._)(function*(e,t){var n,o;if(!!e&&!!(yield w.addSubWorkflowCheck(e.workflow_id,e.version_name)))c(tx.Workflow,[...null!==(o=null==v?void 0:null===(n=v.workflowFCParam)||void 0===n?void 0:n.workflowList)&&void 0!==o?o:[],{plugin_id:e.plugin_id,workflow_id:e.workflow_id,plugin_version:"",workflow_version:e.version_name||"",is_draft:(0,ty.rK)(e.project_id)}])}),function(e,t){return o.apply(this,arguments)}),onRemove:e=>{var t,n;c(tx.Workflow,(null!==(n=null==v?void 0:null===(t=v.workflowFCParam)||void 0===t?void 0:t.workflowList)&&void 0!==n?n:[]).filter(t=>t.workflow_id!==e.workflow_id))},i18nMap:{[nC.sD.ListItemRemove]:{key:"scene_workflow_delete_workflow_button",options:{source:I}},[nC.sD.ListItemRemoveConfirmTitle]:{key:"scene_workflow_delete_workflow_popup_title",options:{source:I}},[nC.sD.ListItemRemoveConfirmDescription]:{key:"scene_workflow_delete_workflow_popup_subtitle",options:{source:I}}}});return(0,p.jsx)(tG.tz,{visible:u,onCancel:m,tabs:{tabsProps:{lazyRender:!0,activeKey:N,onChange:e=>S(e)},tabPanes:[{tabPaneProps:{tab:_.o.t("Tools"),itemKey:tx.Plugin},content:(0,p.jsxs)("div",{className:nM.Z.main,children:[(0,p.jsx)("div",{className:nM.Z.sider,children:C.sider}),(0,p.jsxs)("div",{className:nM.Z.content,children:[(0,p.jsx)("div",{className:nM.Z.filter,children:C.filter}),(0,p.jsx)("div",{className:nM.Z["content-inner"],children:C.content})]})]})},{tabPaneProps:{tab:_.o.t("Workflow"),itemKey:tx.Workflow},content:(0,p.jsxs)("div",{className:nM.Z.main,children:[(0,p.jsx)("div",{className:nM.Z.sider,children:T.sider}),(0,p.jsxs)("div",{className:nM.Z.content,children:[(0,p.jsx)("div",{className:nM.Z.filter,children:T.filter}),(0,p.jsx)("div",{className:nM.Z["content-inner"],children:T.content})]})]})},{tabPaneProps:{tab:_.o.t("Datasets"),itemKey:tx.Knowledge},content:(0,p.jsxs)("div",{className:nM.Z.main,children:[f?(0,p.jsx)("div",{className:nM.Z.sider,children:(0,p.jsx)(nL,{projectId:f,category:b,setCategory:j})}):null,(0,p.jsx)("div",{className:J()(nM.Z.content,nM.Z["data-sets-content"]),children:(0,p.jsx)("div",{className:nM.Z["content-inner"],children:(0,p.jsx)(nT.$L,{projectID:b===nE.Project?f:void 0,datasetList:(null!==(d=null==v?void 0:null===(i=v.knowledgeFCParam)||void 0===i?void 0:i.knowledgeList)&&void 0!==d?d:[]).map(e=>({dataset_id:e.id,name:e.name})),onDatasetListChange:e=>{c(tx.Knowledge,null==e?void 0:e.map(e=>({id:e.dataset_id,name:e.name})))},beforeCreate:e=>{e&&!f&&(y.current=window.open())},onClickAddKnowledge:(e,t,n)=>{if(n){if(f){var o,r,a=null===(r=g())||void 0===r?void 0:r.navigate;null==a||a("/knowledge/".concat(e,"?module=upload&type=").concat(t))}else y.current&&(e?y.current.location="/space/".concat(x,"/knowledge/").concat(e,"/upload?type=").concat(t):y.current.close())}f&&(null===(o=h.refetchProjectResourceList)||void 0===o||o.call(h))}})})})]})}]}})},nZ=e=>{var[t,n]=(0,O.useState)(!1);return(0,p.jsxs)("div",{onClick:e=>{e.stopPropagation()},children:[(0,p.jsx)(e0,{disabledTooltip:e.disabledTooltip,onClick:e=>{e.stopPropagation(),n(!0)}}),(0,p.jsx)(nF,(0,c._)({visible:t,onCancel:()=>n(!1)},e))]})},nR=e=>{var t,n,o,r,a,i,l,s,{value:d={},onChange:u}=e,v=(0,ty.ae)(d),f=(0,L.j1)(),g=(0,m.PF)(),h=(0,T.j)();var y=(t=e1(),n=(0,m.G2)(eV.we),!(t&&n.isFunctionCallModel(t))),x=y?_.o.t("workflow_250310_03",void 0,"该模型不支持绑定技能"):"",{data:w,refetch:b}=(0,t9.b)((0,c._)({workflowId:f.workflowId,spaceId:f.spaceId,nodeId:g.id},(0,ty.Vq)(d))),j=e=>()=>{var t,n;null==u||u((0,D._)((0,c._)({},d),{pluginFCParam:{pluginList:null==d?void 0:null===(n=d.pluginFCParam)||void 0===n?void 0:null===(t=n.pluginList)||void 0===t?void 0:t.filter(t=>t.api_id!==e.api_id)}}))},k=e=>()=>{var t,n;null==u||u((0,D._)((0,c._)({},d),{workflowFCParam:{workflowList:null==d?void 0:null===(n=d.workflowFCParam)||void 0===n?void 0:null===(t=n.workflowList)||void 0===t?void 0:t.filter(t=>t.workflow_id!==e.workflow_id)}}))},N=e=>()=>{var t,n;null==u||u((0,D._)((0,c._)({},d),{knowledgeFCParam:{knowledgeList:null==d?void 0:null===(n=d.knowledgeFCParam)||void 0===n?void 0:null===(t=n.knowledgeList)||void 0===t?void 0:t.filter(t=>t.id!==e.id)}}))},S=e=>t=>{var n,o;null==u||u((0,D._)((0,c._)({},d),{pluginFCParam:{pluginList:null===(o=d.pluginFCParam)||void 0===o?void 0:null===(n=o.pluginList)||void 0===n?void 0:n.map(n=>n.api_id===e.api_id?(0,D._)((0,c._)({},n),{fc_setting:t}):n)}}))},C=e=>t=>{var n,o;null==u||u((0,D._)((0,c._)({},d),{workflowFCParam:{workflowList:null===(o=d.workflowFCParam)||void 0===o?void 0:null===(n=o.workflowList)||void 0===n?void 0:n.map(n=>n.workflow_id===e.workflow_id?(0,D._)((0,c._)({},n),{fc_setting:t}):n)}}))},I=e=>{null==u||u((0,D._)((0,c._)({},d),{knowledgeFCParam:(0,D._)((0,c._)({},null==d?void 0:d.knowledgeFCParam),{global_setting:e})}))};return(0,p.jsxs)(eT.E,{header:_.o.t("chatflow_agent_skill_name"),actionButton:h?null:(0,p.jsx)(nZ,{boundSkills:d,onSkillsChange:(e,t)=>{if(e===tx.Plugin)null==u||u((0,D._)((0,c._)({},d),{pluginFCParam:{pluginList:t}}));else if(e===tx.Workflow)null==u||u((0,D._)((0,c._)({},d),{workflowFCParam:{workflowList:t}}));else if(e===tx.Knowledge){var n,o;null==u||u((0,D._)((0,c._)({},d),{knowledgeFCParam:(0,D._)((0,c._)({},d.knowledgeFCParam),{knowledgeList:t,global_setting:null!==(o=null===(n=d.knowledgeFCParam)||void 0===n?void 0:n.global_setting)&&void 0!==o?o:tw})}))}setTimeout(()=>{b()},10)},disabledTooltip:x}),children:[v?(0,p.jsx)(nx,{}):null,null===(r=d.pluginFCParam)||void 0===r?void 0:null===(o=r.pluginList)||void 0===o?void 0:o.map(e=>{var t,n,o,r=null==w?void 0:null===(t=w.plugin_detail_map)||void 0===t?void 0:t[e.plugin_id],a=null==w?void 0:null===(n=w.plugin_api_detail_map)||void 0===n?void 0:n[e.api_id],i=r&&a?"".concat(null==r?void 0:r.name," / ").concat(null==a?void 0:a.name):"";return(0,p.jsx)(nN,{title:i,pasteTitle:null==a?void 0:a.name,description:null==a?void 0:a.description,iconUrl:null==r?void 0:r.icon_url,onRemove:j(e),params:null!==(o=null==a?void 0:a.parameters)&&void 0!==o?o:[],readonly:h,hideActions:y,versionRender:(0,p.jsxs)("div",{className:"flex gap-1",children:[(0,p.jsx)(nt.Wy,{versionTs:e.plugin_version,versionName:null==r?void 0:r.version_name,latestVersionName:null==r?void 0:r.latest_version_name,latestVersionTs:null==r?void 0:r.latest_version_ts,pluginId:e.plugin_id}),x?(0,p.jsx)(R.u,{content:x,children:(0,p.jsx)(R.Vp,{size:"mini",color:"yellow",children:_.o.t("workflow_250310_02",void 0,"已失效")})}):null]}),settingRender:(0,p.jsx)(nf,(0,D._)((0,c._)({},e),{setting:e.fc_setting,onChange:S(e)}))})}),null===(i=d.workflowFCParam)||void 0===i?void 0:null===(a=i.workflowList)||void 0===a?void 0:a.map(e=>{var t,n,o,r,a=null==w?void 0:null===(t=w.workflow_detail_map)||void 0===t?void 0:t[e.workflow_id];return(0,p.jsx)(nN,{title:null!==(o=null==a?void 0:a.name)&&void 0!==o?o:"",description:null==a?void 0:a.description,iconUrl:null==a?void 0:a.icon_url,onRemove:k(e),params:null!==(r=null==a?void 0:null===(n=a.api_detail)||void 0===n?void 0:n.parameters)&&void 0!==r?r:[],versionRender:(0,p.jsx)(nt.kl,{versionName:e.workflow_version,latestVersionName:null==a?void 0:a.latest_version_name,workflowId:e.workflow_id}),settingRender:(0,p.jsx)(nm,(0,D._)((0,c._)({},e),{setting:e.fc_setting,onChange:C(e)}))})}),null===(s=d.knowledgeFCParam)||void 0===s?void 0:null===(l=s.knowledgeList)||void 0===l?void 0:l.map(e=>{var t,n,o,r=null==w?void 0:null===(t=w.dataset_detail_map)||void 0===t?void 0:t[e.id];return(0,p.jsx)(nN,{title:null!==(o=null==r?void 0:r.name)&&void 0!==o?o:"",iconUrl:null==r?void 0:r.icon_url,onRemove:N(e),settingRender:(0,p.jsx)(ny,{setting:null===(n=d.knowledgeFCParam)||void 0===n?void 0:n.global_setting,onChange:I})})})]})},nV=n("91598"),nA=e=>{var{form:t}=e,n=(0,T.j)(),{isChatflow:o}=(0,L.oS)(),{isBindDouyin:r}=(0,L.j1)();return(0,p.jsx)(I.n,{children:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(Z,{deps:["outputs","batchMode"],outputsPath:"outputs",batchModePath:"batchMode"}),(0,p.jsx)(m.gN,{name:"batchMode",children:e=>{var{field:t}=e;return(0,p.jsx)(eJ.P,{name:t.name,value:t.value,onChange:t.onChange,onBlur:t.onBlur})}}),(0,p.jsx)(m.gN,{name:"model",children:e=>{var{field:t}=e;return(0,p.jsx)(eT.E,{header:_.o.t("workflow_detail_llm_model"),tooltip:_.o.t("workflow_detail_llm_prompt_tooltip"),children:(0,p.jsx)(eQ.q,(0,D._)((0,c._)({},t),{readonly:n}))})}}),(0,p.jsx)(eY.E,{batchModeName:"batchMode",name:"batch"}),r?null:(0,p.jsx)(m.gN,{name:"fcParam",children:e=>{var{field:t}=e;return(0,p.jsx)(nR,(0,c._)({},t))}}),(0,p.jsx)(m.F2,{name:"$$input_decorator$$.inputParameters",defaultValue:[{name:"input",input:{type:u.YX3.REF}}],children:e=>{var{field:r}=e;return(0,p.jsxs)(eT.E,{header:_.o.t("workflow_detail_node_parameter_input"),tooltip:_.o.t("workflow_detail_llm_input_tooltip"),children:[(0,p.jsx)("div",{className:nV.Z["columns-title"],children:(0,p.jsx)(eP.b,{columns:[{title:_.o.t("workflow_detail_variable_input_name"),style:{flex:2}},{title:_.o.t("workflow_detail_variable_input_value"),style:{flex:3}}],readonly:n})}),r.map((e,o)=>e2(e.value)?null:(0,p.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",paddingBottom:4,gap:4},children:[(0,p.jsx)(m.gN,{name:"".concat(e.name,".name"),children:n=>{var o,{field:a,fieldState:i}=n;return(0,p.jsxs)("div",{style:{flex:2,minWidth:0},children:[(0,p.jsx)(e$.l,(0,D._)((0,c._)({},a),{input:t.getValueIn("".concat(e.name,".input")),inputParameters:r.value||[],isError:!!(null==i?void 0:null===(o=i.errors)||void 0===o?void 0:o.length)})),(0,p.jsx)(G.P,{errors:null==i?void 0:i.errors})]})}}),(0,p.jsx)(m.gN,{name:"".concat(e.name,".input"),children:e=>{var t,{field:n,fieldState:o}=e;return(0,p.jsxs)("div",{style:{flex:3,minWidth:0},children:[(0,p.jsx)(W.N,(0,D._)((0,c._)({},n),{isError:!!(null==o?void 0:null===(t=o.errors)||void 0===t?void 0:t.length)})),(0,p.jsx)(G.P,{errors:null==o?void 0:o.errors})]})}}),n?(0,p.jsx)(p.Fragment,{}):(0,p.jsx)("div",{className:"leading-none",children:(0,p.jsx)(R.hU,{size:"small",color:"secondary","data-testid":(0,u.xtp)(e.name,"remove"),icon:(0,p.jsx)(V.ozt,{className:"text-sm"}),onClick:()=>{r.delete(o)}})})]},e.key)),o?(0,p.jsx)(m.gN,{name:"$$input_decorator$$.chatHistorySetting",children:e=>{var{field:t}=e;return(0,p.jsx)(eG,(0,D._)((0,c._)({},t),{style:{paddingRight:"32px"},showLine:!1}))}}):null,n?(0,p.jsx)(p.Fragment,{}):(0,p.jsx)("div",{className:nV.Z["input-add-icon"],children:(0,p.jsx)(R.hU,{className:"!block",color:"highlight",size:"small",icon:(0,p.jsx)(V.PwN,{className:"text-sm"}),onClick:()=>{r.append({name:"",input:{type:u.YX3.REF}})}})})]})}}),r?null:(0,p.jsx)(e9,{}),(0,p.jsx)(m.gN,{name:"$$prompt_decorator$$.systemPrompt",deps:["$$input_decorator$$.inputParameters"],defaultValue:"",children:e=>{var{field:n}=e;return(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(ne,(0,D._)((0,c._)({},n),{placeholder:_.o.t("workflow_detail_llm_sys_prompt_content"),fcParam:t.getValueIn("fcParam"),inputParameters:t.getValueIn("$$input_decorator$$.inputParameters")}))})}}),(0,p.jsx)(m.gN,{name:"$$prompt_decorator$$.prompt",deps:["$$input_decorator$$.inputParameters","model"],defaultValue:"",children:e=>{var{field:t,fieldState:n}=e;return(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(tD,{field:t,fieldState:n})})}}),(0,p.jsx)(m.gN,{name:"outputs",deps:["batchMode"],defaultValue:[{name:"output",type:u.owu.String}],children:e=>{var{field:n,fieldState:o}=e;return(0,p.jsx)(P.y,{id:"llm-node-output",value:n.value,onChange:n.onChange,batchMode:t.getValueIn("batchMode"),withDescription:!0,showResponseFormat:!0,titleTooltip:_.o.t("workflow_detail_llm_output_tooltip"),disabledTypes:[],needErrorBody:t.getValueIn("settingOnError.settingOnErrorIsOpen"),errors:null==o?void 0:o.errors,sortValue:tc})}}),(0,p.jsx)(eK,{outputsPath:"outputs",batchModePath:"batchMode"})]})})},nz={render:e=>(0,p.jsx)(nA,(0,c._)({},e)),validateTrigger:m.C$.onChange,validate:{nodeMeta:h.O,outputs:e=>{var t,{value:n,formValues:o}=e,{settingOnErrorIsOpen:r=!1}=null!==(t=(0,w.Z)(o,"settingOnError"))&&void 0!==t?t:{},a="batch"===(0,w.Z)(o,"batchMode"),i=tp(n,a),l=te.z.array(tf).safeParse(r?tg(i,a):i);if(!l.success)return JSON.stringify(l.error)},"$$input_decorator$$.inputParameters.*.name":e=>{var{value:t,formValues:n,name:o}=e;if(!N.G.test(t))return _.o.t("workflow_detail_node_error_format");var r=(0,w.Z)(n,"$$input_decorator$$.inputParameters")||[],a=o.split(".");a.pop();var i=(0,w.Z)(n,a);if(!!i){if(r.filter(e=>e.name===t&&e7(e,i)).length>1)return _.o.t("workflow_detail_node_input_duplicated");if(r.filter(e=>e.name===t&&!e7(e,i)).length>0)return e2(i)?_.o.t("workflow_250317_01",void 0,"不能和输入重名"):_.o.t("workflow_250317_02",void 0,"不能和视觉理解输入重名")}},"$$input_decorator$$.inputParameters.*.input":(0,k.v)({required:!0}),"batch.inputLists.*.name":(0,eH.e)({getNames:e=>{var{formValues:t}=e;return((0,w.Z)(t,"batch.inputLists")||[]).map(e=>e.name)},skipValidate:e=>{var{formValues:t}=e;return"single"===t.batchMode}}),"$$prompt_decorator$$.prompt":e=>{var t,n,{value:o,formValues:r,context:a}=e,{playgroundContext:i}=a,l=(0,w.Z)(r,"model.modelType"),s=null==i?void 0:null===(t=i.models)||void 0===t?void 0:t.find(e=>e.model_type===l);if(!!(null!==(n=null==s?void 0:s.is_up_required)&&void 0!==n&&n))return(null==o?void 0:o.length)?void 0:_.o.t("workflow_detail_llm_prompt_error_empty")}},effect:{nodeMeta:em.J,batchMode:(0,eA.Q)("batchMode","batch.inputLists"),"batch.inputLists":(0,eA.Q)("batchMode","batch.inputLists"),outputs:ev.m,model:tv},formatOnInit(e,t){var n,o,r,a,{node:i,playgroundContext:l}=t,s=i.getService(eV.we),d=s.getModels(),c=(0,w.Z)(e,"inputs.llmParam");!c&&(c=tk(d));var p={};c.forEach(e=>{var[t,n]=tN(e);p[t]=n});var{prompt:f}=p;delete p.prompt,delete p.systemPrompt,delete p.enableChatHistory;var g=(0,w.Z)(e,"inputs.inputParameters"),h=(0,w.Z)(e,"outputs"),_=(0,w.Z)(e,"inputs.batch.batchEnable"),y={nodeMeta:null==e?void 0:e.nodeMeta,$$input_decorator$$:{inputParameters:g||[{name:"input",input:{type:u.YX3.REF}}],chatHistorySetting:{enableChatHistory:(0,w.Z)(c.find(e=>"enableChatHistory"===e.name),"input.value.content")||!1,chatHistoryRound:Number((0,w.Z)(c.find(e=>"chatHistoryRound"===e.name),"input.value.content",3))}},outputs:(0,eF.Z)(h)?[{name:"output",type:u.owu.String,key:(0,m.x0)()}]:function(e){var{outputs:t,isBatch:n,modelType:o,modelsService:r}=e;if(!t)return t;var a=t;if(o&&r.isCoTModel(o)){var i=tu(t,n,e=>tr(e)&&e.type===u.owu.String);i?(i.readonly=!0,i.readonlyTooltip=tn):a=ts(t,n)}return a}({modelsService:s,isBatch:_,outputs:h,modelType:p.modelType}),model:(0,eZ.Z)(p,["chatHistoryRound"]),$$prompt_decorator$$:{prompt:f,systemPrompt:(0,w.Z)(c.find(e=>"systemPrompt"===e.name),"input.value.content")},batchMode:_?"batch":"single",batch:eR.t.batchToVO((0,w.Z)(e,"inputs.batch"),t),fcParam:function(e){if(!e)return e;var t,n,o=(0,w.Z)(e,"knowledgeFCParam.global_setting.search_mode");return(0,x.Z)(o)?e:(null==e||null===(n=e.knowledgeFCParam)||void 0===n||null===(t=n.global_setting)||void 0===t||delete t.search_mode,(0,v.Z)(e,"knowledgeFCParam.global_setting.search_strategy",o),e)}((0,w.Z)(e,"inputs.fcParam"))},b=JSON.parse((null===(n=l.globalState.info)||void 0===n?void 0:n.schema_json)||"{}"),j=null==b?void 0:null===(o=b.nodes)||void 0===o?void 0:o.find(e=>e.id===i.id),k=parseInt(null==j?void 0:null===(r=j.data)||void 0===r?void 0:r.version)>=parseInt("3")?null==j?void 0:null===(a=j.data)||void 0===a?void 0:a.version:"3";return(0,v.Z)(y,"version",k),y},formatOnSubmit(e,t){var{node:n,playgroundContext:o}=t,{globalState:r}=o,a=n.getService(eV.we).getModels(),{model:i}=e,l=a.find(e=>e.model_type===i.modelType),s=tS(i,l),{batchMode:d}=e,p=eR.t.batchToDTO(e.batch,t),m=u.ycG.createString("prompt",e.$$prompt_decorator$$.prompt),f=u.ycG.createBoolean("enableChatHistory",!!r.isChatflow&&!!(0,w.Z)(e,"$$input_decorator$$.chatHistorySetting.enableChatHistory")),g=u.ycG.createInteger("chatHistoryRound",(0,w.Z)(e,"$$input_decorator$$.chatHistorySetting.chatHistoryRound")),h=u.ycG.createString("systemPrompt",(0,w.Z)(e,"$$prompt_decorator$$.systemPrompt"));s.push(m,f,g,h);var _="batch"===d;return{nodeMeta:e.nodeMeta,inputs:{inputParameters:(0,w.Z)(e,"$$input_decorator$$.inputParameters"),llmParam:s,fcParam:function(e){if(!e)return e;var t,n,o=(0,w.Z)(e,"knowledgeFCParam.global_setting.search_strategy");return(0,x.Z)(o)?e:(null==e||null===(n=e.knowledgeFCParam)||void 0===n||null===(t=n.global_setting)||void 0===t||delete t.search_strategy,(0,v.Z)(e,"knowledgeFCParam.global_setting.search_mode",o),e)}(e.fcParam),batch:_?(0,c._)({batchEnable:"batch"===d},p):void 0},outputs:function(e,t){if(!e)return e;var n=tu(e,t,ta);return(null==n?void 0:n.readonly)&&delete n.readonly,(null==n?void 0:n.readonlyTooltip)&&delete n.readonlyTooltip,e}(e.outputs,_),version:"3"}}},nB={type:u.nyy.LLM,meta:{nodeDTOType:u.nyy.LLM,style:{width:360},size:{width:360,height:130.7},test:{generateRelatedContext(e,t){var n,o,{isInProject:r,isChatflow:a}=t,i=e.getData(m.Ps).formModel.getFormItemValueByPath("/"),l=null==i?void 0:null===(o=i.$$input_decorator$$)||void 0===o?void 0:null===(n=o.chatHistorySetting)||void 0===n?void 0:n.enableChatHistory;return a&&l?(0,ec.UY)({isNeedBot:!r,isNeedConversation:!0}):{}},generateFormBatchProperties(e){var{formModel:t}=e.getData(m.Ps);if("batch"!==t.getFormItemValueByPath("/batchMode"))return{};var n=t.getFormItemValueByPath("/batch"),o=null==n?void 0:n.inputLists;return(0,ec.ee)(o,{node:e})},generateFormInputProperties(e){var t,n=e.getData(m.Ps).formModel.getFormItemValueByPath("/"),o=null==n?void 0:null===(t=n.$$input_decorator$$)||void 0===t?void 0:t.inputParameters;return(0,ec.ee)(o,{node:e})}},nodeMetaPath:eu.je,batchPath:"/batch",inputParametersPath:"/$$input_decorator$$/inputParameters",getLLMModelIdsByNodeJSON:e=>{var t;return null===(t=e.data.inputs.llmParam.find(e=>"modelType"===e.name))||void 0===t?void 0:t.input.value.content},helpLink:"/open/docs/guides/llm_node"},formMeta:nz},nU=n("198252"),nq={width:240,height:150},nW=JSON.stringify([{type:"paragraph",children:[{text:""}]}]),nG="slate",nH={schemaType:nG,note:nW,size:nq},n$={inputs:{schemaType:nG,note:nW},size:nq},nJ={type:u.nyy.Comment,meta:{disableSideSheet:!0,nodeDTOType:u.nyy.Comment,renderKey:u.nyy.Comment,size:{width:240,height:150}},formMeta:{render:()=>(0,p.jsx)(p.Fragment,{}),formatOnInit:function(){var e,t,n,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n$,{inputs:r}=o,a=(0,U._)(o,["inputs"]);return(0,D._)((0,c._)({},a),{schemaType:null!==(e=null==r?void 0:r.schemaType)&&void 0!==e?e:nG,note:null!==(t=null==r?void 0:r.note)&&void 0!==t?t:nW,size:null!==(n=o.size)&&void 0!==n?n:nq})},formatOnSubmit(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nH,{note:n,schemaType:o}=t,r=(0,U._)(t,["note","schemaType"]);return(0,D._)((0,c._)({},r),{inputs:{schemaType:null!=o?o:nG,note:null!=n?n:nW},size:null!==(e=t.size)&&void 0!==e?e:nq})}},getInputPoints:()=>[],getOutputPoints:()=>[]};function nY(){return[{key:(0,ez.x0)(),name:"outputList",type:u.owu.ArrayObject},{key:(0,ez.x0)(),name:"rowNum",type:u.owu.Integer}]}var nQ=n("489350"),nX=(0,O.createContext)({}),nK=()=>(0,O.useContext)(nX),n0=n("969942"),n1=n("288323"),n2=e=>{var{field:t,onSelect:n}=e;return(0,p.jsx)(R.Lt.Item,{className:"!p-0 m-0",children:(0,p.jsx)(R.u,{className:"!translate-x-[-6px]",content:t.name,position:"left",children:(0,p.jsxs)("div",{className:"w-[196px] h-[32px] p-[8px] flex items-center justify-between",onClick:e=>{e.stopPropagation(),null==n||n(t.id)},children:[(0,p.jsx)("span",{className:"text-[14px] truncate w-[100px]",children:t.name}),(0,p.jsx)(n1.Mt,{type:t.type})]})})})};function n4(e){var{onSelect:t,selectedFieldIDs:n=[],fields:o=[],filterSystemFields:r=!0,readonly:a=!1,testName:i}=e,{state:l,toggle:s}=(0,n0.Z)(!1),{getNodeSetterId:d}=(0,u.FCD)(),c=d(i||"select-fileds-add-button");o=null==o?void 0:o.filter(e=>{var{isSystemField:t,id:o}=e;return(!t||!r)&&!(null==n?void 0:n.includes(o))});var v=a||!o||0===o.length;return((0,O.useEffect)(()=>{v&&l&&s()},[v,l]),v)?(0,p.jsx)(R.u,{content:_.o.t("workflow_database_no_fields",{},"没有可添加的字段"),children:(0,p.jsx)(nQ.HS,{disabled:v})}):(0,p.jsx)(R.Lt,{className:"max-h-[260px] overflow-auto",visible:l,trigger:"custom",render:(0,p.jsx)(R.Lt.Menu,{children:o.map(e=>(0,p.jsx)(n2,{field:e,onSelect:t}))}),position:"bottomRight",onClickOutSide:()=>s(),children:(0,p.jsx)("div",{onClick:()=>s(),children:(0,p.jsx)(nQ.HS,{dataTestId:c})})})}function n6(e){var t,{afterAppend:n}=e,{value:o,append:r,readonly:a}=(0,nQ.Dq)(),{data:i}=(0,L.ui)(),l=null==o?void 0:o.map(e=>{var{fieldID:t}=e;return t});return(0,p.jsx)(n4,{readonly:a,selectedFieldIDs:l,onSelect:e=>{r({fieldID:e}),null==n||n()},fields:null==i?void 0:null===(t=i.fields)||void 0===t?void 0:t.filter(e=>{var{isSystemField:t}=e;return!t})})}function n5(e){var{children:t}=e,{value:n}=(0,nQ.Dq)(),o=(0,nQ.IK)();return(0,p.jsx)(nQ.$0,{ref:o,title:_.o.t("workflow_select_and_set_fields_title"),isEmpty:!n||(null==n?void 0:n.length)===0,emptyText:_.o.t("workflow_select_and_set_fields_empty"),actions:[(0,p.jsx)(n6,{afterAppend:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.open()}})],children:t})}var n3=n("101626");function n8(e){var t,{index:n}=e,{name:o,value:r,remove:a,readonly:i}=(0,nQ.Dq)(),{data:l}=(0,L.ui)(),{shouldDisableRemove:s}=nK(),d=null==r?void 0:r[n],u=null==l?void 0:null===(t=l.fields)||void 0===t?void 0:t.find(e=>{var{id:t}=e;return t===(null==d?void 0:d.fieldID)});return(0,p.jsx)(nQ.y1,{onRemove:()=>a(n),disableRemove:i||(null==s?void 0:s(u)),children:(0,p.jsx)(n3.se,{label:null==u?void 0:u.name,required:null==u?void 0:u.required,tooltip:null==u?void 0:u.description,labelExtra:(null==u?void 0:u.type)&&(0,p.jsx)(n1.Mt,{type:u.type}),name:"".concat(o,".").concat(n,".fieldValue"),inputType:null==u?void 0:u.type})})}function n9(){var{value:e}=(0,nQ.Dq)();return(0,p.jsx)(nQ.F3,{children:null==e?void 0:e.map((e,t)=>{var{fieldID:n}=e;return(0,p.jsx)(n8,{index:t},n)})})}function n7(){return(0,p.jsx)(nQ.az,{columns:[{label:_.o.t("workflow_detail_node_parameter_name"),style:{width:148}},{label:_.o.t("workflow_detail_end_output_value")}]})}var oe=()=>(0,p.jsxs)(n5,{children:[(0,p.jsx)(n7,{}),(0,p.jsx)(n9,{})]}),ot=(0,nQ.lw)(e=>{var{shouldDisableRemove:t=()=>!1}=e;return(0,p.jsx)(nX.Provider,{value:{shouldDisableRemove:t},children:(0,p.jsx)(oe,{})})}),on=n("503291"),oo=e=>{var{name:t,label:n,tooltip:o,afterChange:r}=e,a=(0,U._)(e,["name","label","tooltip","afterChange"]),[i,l]=(0,O.useState)(!1),{data:s,isLoading:d}=(0,L.ui)(),{getNodeSetterId:v}=(0,u.FCD)();return(0,O.useEffect)(()=>{i&&!d&&(null==r||r(s),l(!1))},[null==s?void 0:s.id]),(0,p.jsx)(nQ.$0,{title:_.o.t("workflow_database_node_database_table_title"),children:(0,p.jsx)(nQ.gN,(0,D._)((0,c._)({name:t},a),{children:e=>{var{value:n,onChange:o,readonly:r}=e;return(0,p.jsx)(on.u,{value:n,readonly:r,onChange:e=>{o(e),l(!0)},addButtonTestID:v("".concat(t,".addButton")),libraryCardTestID:v("".concat(t,".libraryCard"))})}}))})},or=n("707883");function oa(e){var{name:t,deps:n}=e;return(0,p.jsx)(or.Nn,{title:_.o.t("workflow_detail_node_output"),tooltip:_.o.t("workflow_240218_08"),id:"database-node-outputs",name:t,deps:n,topLevelReadonly:!0,disabledTypes:[u.owu.Object],defaultValue:[{key:(0,ez.x0)(),name:"outputList",type:u.owu.ArrayObject},{key:(0,ez.x0)(),name:"rowNum",type:u.owu.Integer}]})}var oi=n("917500"),ol=(0,nQ.Q2)(e=>{var{showStroke:t}=e,{name:n,value:o,onChange:r,readonly:a}=(0,nQ.U$)(),{getNodeSetterId:i}=(0,u.FCD)();return(0,p.jsx)(oi.n,{logic:o,readonly:a,onChange:r,showStroke:t,testId:i(n)})}),os=(0,nQ.Q2)(e=>{var{operation:t,dataType:n}=e,{name:o,value:r,onChange:a,readonly:i}=(0,nQ.U$)();return"IS_NULL"===t||"IS_NOT_NULL"===t?(0,p.jsx)(R.II,{value:"empty",disabled:!0,size:"small"}):"BE_TRUE"===t?(0,p.jsx)(R.II,{value:"true",disabled:!0,size:"small"}):"BE_FALSE"===t?(0,p.jsx)(R.II,{value:"false",disabled:!0,size:"small"}):(0,p.jsx)(W.N,{name:o,value:r,inputType:n,readonly:i,onChange:e=>{a(e)}})}),od=n("348785"),ou=(0,nQ.Q2)(e=>{var t,n,{dataType:o}=e,{name:r,value:a,onChange:i,readonly:l}=(0,nQ.U$)();var s=(n=[],((t=o)===u.owu.Number||t===u.owu.Integer)&&(n=["EQUAL","NOT_EQUAL","GREATER_THAN","LESS_THAN","GREATER_EQUAL","LESS_EQUAL","IN","NOT_IN","IS_NULL","IS_NOT_NULL"]),t===u.owu.String&&(n=["EQUAL","NOT_EQUAL","LIKE","NOT_LIKE","IN","NOT_IN","IS_NULL","IS_NOT_NULL"]),t===u.owu.Time&&(n=["EQUAL","NOT_EQUAL","GREATER_THAN","LESS_THAN","GREATER_EQUAL","LESS_EQUAL","IS_NULL","IS_NOT_NULL"]),t===u.owu.Boolean&&(n=["EQUAL","NOT_EQUAL","IS_NULL","IS_NOT_NULL","BE_TRUE","BE_FALSE"]),n.map(e=>({label:od.X[e].label,value:e,operationIcon:od.X[e].operationIcon}))),{getNodeSetterId:d}=(0,u.FCD)();return(0,p.jsx)(nQ.Ph,{className:"w-[42px]","data-testid":d(r),value:a,disabled:l,onChange:e=>{i(e)},optionList:s,placeholder:_.o.t("workflow_detail_condition_pleaseselect"),renderSelectedItem:e=>(0,p.jsx)(R.u,{content:e.label,children:(0,p.jsx)("div",{className:"flex items-center h-[24px]",children:e.operationIcon})})})}),oc=(0,nQ.Q2)(e=>{var t,{onChange:n}=e,{name:o,value:r,onChange:a,readonly:i}=(0,nQ.U$)(),{data:l}=(0,L.ui)(),{getNodeSetterId:s}=(0,u.FCD)();return(0,p.jsx)(nQ.Ph,{"data-testid":s(o),className:"w-full",value:r,onChange:e=>{a(e),null==n||n(e)},disabled:i,placeholder:_.o.t("workflow_condition_left_placeholder",{},"请选择"),optionList:null==l?void 0:null===(t=l.fields)||void 0===t?void 0:t.map(e=>({label:(0,p.jsx)("span",{className:"max-w-[220px] truncate",children:e.name}),value:e.name}))})}),op={[u.owu.String]:u.owu.ArrayString,[u.owu.Integer]:u.owu.ArrayInteger,[u.owu.Time]:u.owu.ArrayTime,[u.owu.Number]:u.owu.ArrayNumber,[u.owu.Boolean]:u.owu.ArrayBoolean},ov=(0,nQ.Q2)(e=>{var{disableRemove:t=!1,onClickRemove:n}=e,{name:o,value:r}=(0,nQ.U$)(),a=function(){var e,{value:t}=(0,nQ.U$)(),{data:n}=(0,L.ui)(),o=null==n?void 0:null===(e=n.fields)||void 0===e?void 0:e.find(e=>e.name===(null==t?void 0:t.left));return null==o?void 0:o.type}(),i=null==r?void 0:r.operator,{getNodeSetterId:l}=(0,u.FCD)(),s=function(){var e=(0,nQ.cI)(),{value:t,name:n}=(0,nQ.U$)();return(0,O.useCallback)(()=>{e.setFieldValue("".concat(n,".operator"),void 0),e.setFieldValue("".concat(n,".right"),void 0)},[e,n,t])}();(function(){var{name:e,value:t}=(0,nQ.U$)(),n=(0,nQ.cI)(),o=(0,L.bV)();(0,O.useEffect)(()=>{o.checkConditionOperatorNoNeedRight(null==t?void 0:t.operator)&&n.setFieldValue("".concat(e,".right"),void 0)},[null==t?void 0:t.operator])})();var d=(0,O.useMemo)(()=>{var e;return["IN","NOT_IN"].includes(i||"")?null!==(e=null==op?void 0:op[a])&&void 0!==e?e:u.owu.ArrayString:a},[i,a]);return(0,p.jsxs)("div",{className:"flex items-center gap-[4px] min-w-0",children:[(0,p.jsxs)("div",{className:"flex flex-1 items-center gap-[4px] min-w-0",children:[(0,p.jsx)("div",{className:"w-[42px]",children:(0,p.jsx)(ou,{dataType:a,name:"".concat(o,".operator")})}),(0,p.jsxs)("div",{className:"flex-1 flex flex-col gap-[4px] min-w-0",children:[(0,p.jsx)(oc,{name:"".concat(o,".left"),onChange:()=>s()}),(0,p.jsx)(os,{operation:null==r?void 0:r.operator,name:"".concat(o,".right"),dataType:d})]})]}),!t&&(0,p.jsx)(nQ.HF,{onClick:n,testId:"".concat(l(o),".remove")})]})});function om(e){var{min:t}=e,{name:n,value:o,remove:r,readonly:a}=(0,nQ.Dq)();return(0,p.jsx)(nQ.F3,{children:null==o?void 0:o.map((e,i)=>(0,p.jsx)(ov,{name:"".concat(n,".[").concat(i,"]"),disableRemove:a||void 0!==t&&(null==o?void 0:o.length)<=t,onClickRemove:()=>{r(i)},hasFeedback:!1}))})}function of(){var{append:e,readonly:t}=(0,nQ.Dq)(),{getNodeSetterId:n}=(0,u.FCD)();return(0,p.jsx)(R.zx,{disabled:t,className:"mt-[4px]",onClick:()=>e({left:void 0,operator:void 0,right:void 0}),icon:(0,p.jsx)(V.PwN,{}),size:"small",color:"highlight","data-testid":n("condition-add-button"),children:_.o.t("workflow_add_condition")})}function og(e){var{name:t,label:n,tooltip:o,min:r}=e,a="".concat(t,".conditionList"),i=(0,nQ.qo)(a);return(0,p.jsx)(nQ.F2,{name:a,children:(0,p.jsx)(nQ.$0,{title:n,tooltip:o,children:(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{className:"flex",children:[(null==i?void 0:i.length)>1&&(0,p.jsx)(ol,{name:"".concat(t,".logic"),defaultValue:u.sSN.AND,showStroke:!0}),(0,p.jsx)("div",{className:"flex-1 min-w-0",children:(0,p.jsx)(om,{min:r})})]}),(0,p.jsx)(nQ.tz,{isEmpty:!i||0===i.length,text:_.o.t("workflow_condition_empty")}),(0,p.jsx)(of,{})]})})})}n("940492");var oh=n("372999"),o_=(0,nQ.Q2)(()=>{var{value:e,onChange:t,readonly:n,errors:o}=(0,nQ.U$)(),[r,a]=(0,O.useState)(0);return(0,p.jsxs)("div",{className:oh.Z.container,children:[null,(0,p.jsx)(tT.i,{value:e,onChange:e=>t(e),readonly:n,isError:!!(null==o?void 0:o.length),placeholder:_.o.t("workflow_240218_12"),name:"/sql"},r.toString())]})}),oy=()=>{var{getNodeSetterId:e}=(0,u.FCD)(),t=e("");return(0,p.jsxs)(n1.X_,{children:[(0,p.jsx)(n3.Go,{testId:t,name:"inputParameters",tooltip:_.o.t("workflow_240218_07",{},"需要添加的输入变量，SQL中可直接引用此处添加的变量")}),(0,p.jsx)(oo,{name:"databaseInfoList"}),(0,p.jsx)(nQ.$0,{title:_.o.t("workflow_240218_09",{},"SQL"),tooltip:_.o.t("workflow_240218_10",{},"要执行的SQL语句,可以直接使用输入参数中的变量,注意rowNum输出返回的行数或者受影响的行数,outputList中的变量名需与SQL中定义的字段名一致。"),children:(0,p.jsx)(o_,{name:"sql"})}),(0,p.jsx)(oa,{name:"outputs"})]})},ox={render:()=>(0,p.jsx)(oy,{}),validateTrigger:m.C$.onChange,validate:{nodeMeta:h.O,"inputParameters.*.name":(0,eH.e)({getNames:e=>{var{formValues:t}=e;return((0,w.Z)(t,"inputParameters")||[]).map(e=>e.name)}}),"inputParameters.*.input":(0,k.v)({required:!0}),sql:e=>{var{value:t}=e;return t?void 0:_.o.t("workflow_detail_node_error_empty")},databaseInfoList:e=>{var{value:t}=e;if(!t||0===t.length)return _.o.t("workflow_detail_node_error_empty")}},defaultValues:{inputParameters:[{name:"input"}],databaseInfoList:[],outputs:nY()},effect:{outputs:ev.m},formatOnInit:function(e){if(!!e){var{inputs:t={},nodeMeta:n,outputs:o}=e;return(0,D._)((0,c._)({nodeMeta:n},t),{outputs:o})}},formatOnSubmit:function(e){var{nodeMeta:t,outputs:n}=e;return{nodeMeta:t,inputs:(0,U._)(e,["nodeMeta","outputs"]),outputs:n}}},ow={type:u.nyy.Database,meta:{nodeDTOType:u.nyy.Database,style:{width:484},size:eu.gu,nodeMetaPath:eu.je,test:{generateFormInputProperties(e){var t=e.getData(m.Ps).formModel.getFormItemValueByPath("/"),n=null==t?void 0:t.inputParameters;return(0,ec.ee)(n,{node:e})}},helpLink:"/open/docs/guides/database_sql_node"},formMeta:ox},ob=n("382534"),oj=n("357331"),ok=e=>({["".concat(e,".*.left")]:e=>{var{value:t}=e;if(void 0===t)return _.o.t("workflow_detail_node_error_empty")},["".concat(e,".*.operator")]:e=>{var{value:t}=e;if(void 0===t)return _.o.t("workflow_detail_condition_condition_empty")},["".concat(e,".*.right")]:e=>{var{name:t,value:n,context:o}=e,r=new u.m_1(o.node),a=t.replace(".right",""),i=r.getValueByPath(a),l=o.node.getService(eV.Of),s=o.node.getService(eV._y);return l.checkConditionOperatorNoNeedRight(null==i?void 0:i.operator)?void 0:void 0===n?_.o.t("workflow_detail_node_error_empty"):s.isRefExpression(n)&&!s.isRefExpressionVariableExists(n,o.node)?_.o.t("workflow_detail_variable_referenced_error"):void 0}}),oN=n("75524"),oS=()=>({[oN.Yv]:e=>{var{value:t}=e;if(!t||0===t.length)return _.o.t("workflow_detail_node_error_empty")}});function oC(){return{"inputs.*.fieldInfo.*.fieldValue":e=>{var{value:t,context:n}=e,o=n.node.getService(eV._y);if(o.isRefExpression(t)&&!o.isRefExpressionVariableExists(t,n.node))return _.o.t("workflow_detail_variable_referenced_error")}}}function oI(e){var t,{data:n}=(0,L.ui)();return null==n?void 0:null===(t=n.fields)||void 0===t?void 0:t.find(t=>t.id===e)}function oT(e){var t=(0,nQ.cI)(),{data:n}=(0,L.ui)();return()=>{n?t.setFieldValue(e,{conditionList:[{left:void 0,operator:void 0,right:void 0}],logic:u.sSN.AND}):t.setFieldValue(e,void 0)}}var oP=n("14751"),oD=(0,oP.m)(()=>{var{data:e}=(0,L.ui)(),t=function(e){var{data:t}=(0,L.ui)(),n=(0,nQ.cI)();return()=>{var o,r,a=(null==t?void 0:null===(r=t.fields)||void 0===r?void 0:null===(o=r.filter(e=>{var{required:t}=e;return t}))||void 0===o?void 0:o.map(e=>{var{id:t}=e;return{fieldID:t}}))||[];n.setFieldValue(e,a)}}(oN.f_);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(oo,{name:oN.Yv,afterChange:()=>{t()}}),e?(0,p.jsx)(ot,{name:oN.f_,shouldDisableRemove:e=>{var t;return null!==(t=null==e?void 0:e.required)&&void 0!==t&&t}}):null,(0,p.jsx)(oa,{name:"outputs"})]})}),oE={render:()=>(0,p.jsx)(oD,{}),validateTrigger:m.C$.onChange,validate:(0,c._)({nodeMeta:h.O},oS(),oC()),defaultValues:{inputs:{databaseInfoList:[]},outputs:nY()},formatOnInit:(e,t)=>e=t.node.getService(oj.O).convertSettingFieldDTOToField(oN.f_,e),formatOnSubmit:(e,t)=>e=t.node.getService(oj.O).convertSettingFieldToDTO(oN.f_,e,t.node),effect:{outputs:ev.m}};var oO={type:u.nyy.DatabaseCreate,meta:{nodeDTOType:u.nyy.DatabaseCreate,test:{generateFormInputProperties:e=>(0,nS._)(function*(){var t,n,o,r,a,i=e.getData(m.Ps).formModel.getFormItemValueByPath("/"),l=null==i?void 0:null===(n=i.inputs)||void 0===n?void 0:null===(t=n.databaseInfoList[0])||void 0===t?void 0:t.databaseInfoID;if(!l)return{};var s=yield ob.v6.GetDatabaseByID({id:l,need_sys_fields:!0}),d=(null!==(a=null==i?void 0:null===(r=i.inputs)||void 0===r?void 0:null===(o=r.insertParam)||void 0===o?void 0:o.fieldInfo)&&void 0!==a?a:[]).map(e=>{var t,n,o=null==s?void 0:null===(n=s.database_info)||void 0===n?void 0:null===(t=n.field_list)||void 0===t?void 0:t.find(t=>t.alterId===e.fieldID);return{name:"__setting_field_".concat(null==e?void 0:e.fieldID),title:null==o?void 0:o.name,input:null==e?void 0:e.fieldValue}});return(0,ec.ee)(d,{node:e})})()},helpLink:"/open/docs/guides/database_insert_node"},formMeta:oE,onInit:(a=(0,nS._)(function*(e,t){if(!e)return;var n,o,r,a=t.entityManager.getService(eV.Of),i=null!==(r=null==e?void 0:null===(o=e.data.inputs.databaseInfoList)||void 0===o?void 0:null===(n=o[0])||void 0===n?void 0:n.databaseInfoID)&&void 0!==r?r:"";if(!!i)yield a.load(i)}),function(e,t){return a.apply(this,arguments)}),onDispose:(e,t)=>{if(!e)return;var n,o=t.entityManager.getService(eV.Of),r=null!==(n=(0,w.Z)(e,"inputs.databaseInfoList[0].databaseInfoID"))&&void 0!==n?n:"";if(!!r)o.clearDatabaseError(r)}},oL=(0,oP.m)(()=>{var{data:e}=(0,L.ui)(),t=oT(oN.W);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(oo,{name:oN.Yv,afterChange:()=>{t()}}),e?(0,p.jsx)(og,{label:_.o.t("workflow_delete_conditon_title"),name:oN.W,min:1}):null,(0,p.jsx)(oa,{name:"outputs"})]})}),oM={render:()=>(0,p.jsx)(oL,{}),validateTrigger:m.C$.onChange,validate:(0,c._)({nodeMeta:h.O},ok(oN.ZD),oS()),defaultValues:{inputs:{databaseInfoList:[]},outputs:nY()},effect:{outputs:ev.m},formatOnInit:(e,t)=>{var n=t.node.getService(eV.Of);return e=n.convertConditionDTOToCondition(oN.ZD,e),e=n.convertConditionLogicDTOToConditionLogic(oN.H5,e)},formatOnSubmit:(e,t)=>{var n=t.node.getService(eV.Of);return e=n.convertConditionToDTO(oN.ZD,e,t.node),e=n.convertConditionLogicToConditionLogicDTO(oN.H5,e)}},oF={type:u.nyy.DatabaseDelete,meta:{nodeDTOType:u.nyy.DatabaseDelete,test:{generateFormInputProperties(e){var t,n,o,r,a=e.getData(m.Ps).formModel.getFormItemValueByPath("/"),i=(null!==(r=null==a?void 0:null===(o=a.inputs)||void 0===o?void 0:null===(n=o.deleteParam)||void 0===n?void 0:null===(t=n.condition)||void 0===t?void 0:t.conditionList)&&void 0!==r?r:[]).map((e,t)=>{var{left:n,right:o}=e;return{name:"__condition_right_".concat(t),title:"".concat(n),input:o}});return(0,ec.ee)(i,{node:e})}},helpLink:"/open/docs/guides/database_delete_node"},formMeta:oM};function oZ(e){var{name:t}=e;return(0,p.jsx)(nQ.$0,{title:_.o.t("workflow_query_limit_title"),children:(0,p.jsx)(nQ.nk,{className:"w-full",name:t,defaultValue:100})})}function oR(e){var{afterAppend:t}=e,{value:n,append:o,readonly:r}=(0,nQ.Dq)(),a=null==n?void 0:n.map(e=>{var{fieldID:t}=e;return t}),i=(0,nQ.cI)(),{data:l}=(0,L.ui)(),s=i.getValueIn("outputs");return(0,p.jsx)(n4,{onSelect:e=>{o({fieldID:e,isDistinct:!1});var n,r,a,d,u,c=null==l?void 0:null===(n=l.fields)||void 0===n?void 0:n.find(t=>t.id===e),p=null===(r=(0,ni.Z)(s))||void 0===r?void 0:r.find(e=>"outputList"===e.name),m=null==s?void 0:s.find(e=>"rowNum"===e.name);!(null==p?void 0:null===(a=p.children)||void 0===a?void 0:a.find(e=>e.name===(null==c?void 0:c.name)))&&(!Array.isArray(null==p?void 0:p.children)&&(0,v.Z)(p,"children",[]),null==p||null===(d=p.children)||void 0===d||d.push({key:(0,ez.x0)(),name:null!==(u=null==c?void 0:c.name)&&void 0!==u?u:"",type:null==c?void 0:c.type}),i.setValueIn("outputs",[p,m])),null==t||t()},selectedFieldIDs:a,fields:null==l?void 0:l.fields,filterSystemFields:!1,readonly:r})}function oV(e){var{children:t}=e,n=(0,O.useRef)(),{value:o}=(0,nQ.Dq)();return(0,p.jsx)(nQ.$0,{ref:n,title:_.o.t("workflow_query_fields_title"),isEmpty:!o||0===o.length,emptyText:_.o.t("workflow_query_fields_empty"),actions:[(0,p.jsx)(oR,{afterAppend:()=>{var e;null===(e=n.current)||void 0===e||e.open()}})],children:t})}function oA(e){var{index:t}=e,{name:n,value:o,remove:r,readonly:a}=(0,nQ.Dq)(),i=oI(null==o?void 0:o[t].fieldID),{getNodeSetterId:l}=(0,u.FCD)();return(0,p.jsx)(nQ.y1,{disableRemove:a,onRemove:()=>r(t),removeTestId:"".concat(l(n),".remove"),children:(0,p.jsx)(nQ.__,{className:"w-[249px]",extra:(0,p.jsx)(n1.Mt,{type:null==i?void 0:i.type}),children:(0,p.jsx)("span",{className:"max-w-[200px] truncate",children:null==i?void 0:i.name})})})}function oz(){var{value:e}=(0,nQ.Dq)();return(0,p.jsx)(nQ.F3,{children:null==e?void 0:e.map((e,t)=>(0,p.jsx)(oA,{index:t}))})}function oB(){return(0,p.jsx)(nQ.az,{columns:[{label:_.o.t("workflow_query_fields_name",{},"字段名"),style:{width:249}}]})}function oU(){return(0,p.jsxs)(oV,{children:[(0,p.jsx)(oB,{}),(0,p.jsx)(oz,{})]})}function oq(e){var{name:t}=e;return(0,p.jsx)(nQ.F2,{name:t,children:(0,p.jsx)(oU,{})})}function oW(){var e=(0,nQ.qo)(oN.uw);return null==e?void 0:e.map(e=>{var{fieldID:t}=e;return t})}var oG=()=>{var{value:e,onChange:t}=(0,nQ.Dq)(),n=oW();(0,O.useEffect)(()=>{t((null==e?void 0:e.filter(e=>{var{fieldID:t}=e;return n.includes(t)}))||[])},[null==n?void 0:n.join(",")])};function oH(e){var{afterAppend:t}=e,n=function(){var e,t=oW(),{data:n}=(0,L.ui)();return null==n?void 0:null===(e=n.fields)||void 0===e?void 0:e.filter(e=>null==t?void 0:t.includes(e.id))}(),{value:o,append:r,readonly:a}=(0,nQ.Dq)(),i=null==o?void 0:o.map(e=>{var{fieldID:t}=e;return t});return(0,p.jsx)(n4,{onSelect:e=>{r({fieldID:e,isAsc:!0}),null==t||t()},selectedFieldIDs:i,fields:n,filterSystemFields:!1,readonly:a,testName:"order-fileds-add-button"})}function o$(e){var{children:t}=e,n=(0,O.useRef)(),{value:o}=(0,nQ.Dq)();return(0,p.jsx)(nQ.$0,{ref:n,title:_.o.t("workflow_order_by_title",{},"排序字段"),actions:[(0,p.jsx)(oH,{afterAppend:()=>{var e;null===(e=n.current)||void 0===e||e.open()}})],isEmpty:!o||0===o.length,emptyText:_.o.t("workflow_order_by_empty",{},"请添加排序字段"),children:t})}var oJ={[u.owu.String]:["A → Z","Z → A"],[u.owu.Integer]:["0 → 9","9 → 0"],[u.owu.Number]:["0 → 9","9 → 0"],[u.owu.Boolean]:["0 → 1","1 → 0"],[u.owu.Time]:["0 → 9","9 → 0"]},oY=(0,nQ.Q2)(e=>{var{type:t}=e,{name:n,value:o,onChange:r,readonly:a}=(0,nQ.U$)(),{getNodeSetterId:i}=(0,u.FCD)(),[l,s]=void 0===t?[]:oJ[t];return(0,p.jsx)(R.q4,{layout:"hug",disabled:a,value:"".concat(o),onChange:e=>r("true"===e.target.value),options:[{label:l,value:"true"},{label:s,value:"false"}],size:"small","data-testid":i(n)})}),oQ=(0,nQ.Q2)(()=>{var{name:e,value:t}=(0,nQ.U$)(),n=oI(null==t?void 0:t.fieldID);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(nQ.__,{className:"w-[138px]",extra:(0,p.jsx)(n1.Mt,{type:null==n?void 0:n.type}),children:(0,p.jsx)("span",{className:"w-[90px] truncate",children:null==n?void 0:n.name})}),(0,p.jsx)(oY,{name:"".concat(e,".isAsc"),type:null==n?void 0:n.type})]})});function oX(){var{value:e,move:t,remove:n,name:o,readonly:r}=(0,nQ.Dq)();return(0,p.jsx)(nQ.F3,{children:(0,p.jsx)(nQ.cm,{onSortEnd:e=>{var{from:n,to:o}=e;t(n,o)},children:null==e?void 0:e.map((e,t)=>(0,p.jsx)(nQ.TR,{sortableID:null==e?void 0:e.fieldID,index:t,children:(0,p.jsx)(nQ.y1,{disableRemove:r,onRemove:()=>{n(t)},children:(0,p.jsx)(oQ,{name:"".concat(o,".").concat(t)})})},null==e?void 0:e.fieldID))})})}function oK(){return oG(),(0,p.jsx)(o$,{children:(0,p.jsx)(oX,{})})}function o0(e){var{name:t}=e;return(0,p.jsx)(nQ.F2,{name:t,children:(0,p.jsx)(oK,{})})}var o1=(0,oP.m)(()=>{var e,t,n,o,r,{data:a}=(0,L.ui)();var i=(e=(0,nQ.cI)(),t=oT(oN._r),n=()=>{e.setFieldValue(oN.uw,void 0)},o=()=>{e.setFieldValue(oN.UZ,void 0)},r=()=>{e.setFieldValue(oN._m,void 0)},()=>{t(),n(),o(),r()});return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(oo,{name:oN.Yv,afterChange:i}),a?(0,p.jsx)(oq,{name:oN.uw}):null,a?(0,p.jsx)(og,{label:_.o.t("workflow_query_condition_title"),name:oN._r}):null,a?(0,p.jsx)(o0,{name:oN.UZ}):null,a?(0,p.jsx)(oZ,{name:oN._m}):null,(0,p.jsx)(oa,{deps:[oN.uw],name:"outputs"})]})}),o2={render:()=>(0,p.jsx)(o1,{}),validateTrigger:m.C$.onChange,validate:(0,c._)({nodeMeta:h.O,[oN._m]:e=>{var{value:t}=e;if(t<1||t>1e3)return _.o.t("workflow_database_query_limit")}},ok(oN.X5),oS()),defaultValues:{inputs:{databaseInfoList:[]},outputs:nY()},effect:{outputs:ev.m},formatOnInit:(e,t)=>{var n=t.node.getService(eV.Of);return e=n.convertConditionDTOToCondition(oN.X5,e),e=n.convertConditionLogicDTOToConditionLogic(oN.iT,e)},formatOnSubmit:(e,t)=>{var n=t.node.getService(eV.Of);return e=n.convertConditionToDTO(oN.X5,e,t.node),e=n.convertConditionLogicToConditionLogicDTO(oN.iT,e)}},o4={type:u.nyy.DatabaseQuery,meta:{nodeDTOType:u.nyy.DatabaseQuery,test:{generateFormInputProperties(e){var t,n,o,r,a=e.getData(m.Ps).formModel.getFormItemValueByPath("/"),i=(null!==(r=null==a?void 0:null===(o=a.inputs)||void 0===o?void 0:null===(n=o.selectParam)||void 0===n?void 0:null===(t=n.condition)||void 0===t?void 0:t.conditionList)&&void 0!==r?r:[]).map((e,t)=>{var{left:n,right:o}=e;return{name:"__condition_right_".concat(t),title:"".concat(n),input:o}});return(0,ec.ee)(i,{node:e})}},helpLink:"/open/docs/guides/database_select_node"},formMeta:o2},o6=(0,oP.m)(()=>{var e,{data:t}=(0,L.ui)(),n=oT(oN.Bf);var o=(e=(0,nQ.cI)(),()=>{e.setFieldValue(oN.PM,void 0)});return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(oo,{name:oN.Yv,afterChange:()=>{n(),o()}}),t?(0,p.jsx)(og,{label:_.o.t("workflow_update_condition_title"),name:oN.Bf,min:1}):null,t?(0,p.jsx)(ot,{name:oN.PM}):null,(0,p.jsx)(oa,{name:"outputs"})]})}),o5={render:()=>(0,p.jsx)(o6,{}),validateTrigger:m.C$.onChange,validate:(0,c._)({nodeMeta:h.O},oS(),ok(oN.rz),oC()),defaultValues:{inputs:{databaseInfoList:[]},outputs:nY()},formatOnInit:(e,t)=>{var n=t.node.getService(oj.O);return e=n.convertSettingFieldDTOToField(oN.PM,e),e=n.convertConditionDTOToCondition(oN.rz,e),e=n.convertConditionLogicDTOToConditionLogic(oN.Gd,e)},formatOnSubmit:(e,t)=>{var n=t.node.getService(oj.O);return e=n.convertSettingFieldToDTO(oN.PM,e,t.node),e=n.convertConditionToDTO(oN.rz,e,t.node),e=n.convertConditionLogicToConditionLogicDTO(oN.Gd,e)},effect:{outputs:ev.m}},o3={meta:{nodeDTOType:u.nyy.DatabaseUpdate,test:{generateFormInputProperties:e=>(0,nS._)(function*(){var t,n,o,r,a,i,l,s,d,u=e.getData(m.Ps).formModel.getFormItemValueByPath("/"),p=null==u?void 0:null===(n=u.inputs)||void 0===n?void 0:null===(t=n.databaseInfoList[0])||void 0===t?void 0:t.databaseInfoID;if(!p)return{};var v=yield ob.v6.GetDatabaseByID({id:p,need_sys_fields:!0}),f=(null!==(s=null==u?void 0:null===(r=u.inputs)||void 0===r?void 0:null===(o=r.updateParam)||void 0===o?void 0:o.fieldInfo)&&void 0!==s?s:[]).map(e=>{var t,n,o=null==v?void 0:null===(n=v.database_info)||void 0===n?void 0:null===(t=n.field_list)||void 0===t?void 0:t.find(t=>t.alterId===e.fieldID);return{name:"__setting_field_".concat(null==e?void 0:e.fieldID),title:null==o?void 0:o.name,input:null==e?void 0:e.fieldValue}}),g=(null!==(d=null==u?void 0:null===(l=u.inputs)||void 0===l?void 0:null===(i=l.updateParam)||void 0===i?void 0:null===(a=i.condition)||void 0===a?void 0:a.conditionList)&&void 0!==d?d:[]).map((e,t)=>{var{left:n,right:o}=e;return{name:"__condition_right_".concat(t),title:"".concat(n),input:o}});return(0,c._)({},(0,ec.ee)(g,{node:e}),(0,ec.ee)(f,{node:e}))})()},helpLink:"/open/docs/guides/database_update_node"},type:u.nyy.DatabaseUpdate,formMeta:o5},o8=n("899450"),o9=n("914173"),o7=(0,nQ.Q2)(()=>{var{value:e,onChange:t,readonly:n,onBlur:o}=(0,nQ.U$)();return(0,p.jsx)(o9.d,{value:e,onChange:e=>{t(e),null==o||o()},readonly:!!n})}),re=n("275546"),rt=n("21621"),rn=e=>{var{inputFiedlName:t,paramName:n,paramType:o,inputType:r,availableFileTypes:a,disabledTypes:i,required:l=!0,defaultValue:s={type:u.YX3.REF},tooltip:d,testId:c}=e;return(0,p.jsxs)(nQ.$0,{title:_.o.t("workflow_detail_node_input"),tooltip:d,children:[(0,p.jsx)(rt.Z,{columns:[{title:_.o.t("workflow_detail_node_parameter_name"),style:{flex:2}},{title:_.o.t("workflow_detail_end_output_value"),style:{flex:3}}],className:"mb-[8px]"}),(0,p.jsxs)("div",{className:"w-full flex gap-[4px] items-center",children:[(0,p.jsx)("div",{style:{flex:2},children:(0,p.jsxs)("div",{className:"flex items-center max-w-[120px]",children:[(0,p.jsx)(re.Z,{content:n,showArrow:!0,position:"top",className:"grow-1 truncate",children:(0,p.jsx)("span",{className:J()("flex-1 grow-1 truncate coz-fg-primary text-[12px] leading-[24px]"),children:n})}),l?(0,p.jsx)("span",{className:"mt-[2px]",style:{color:"var(--light-usage-danger-color-danger,#f93920)"},children:"*"}):null,(0,p.jsx)(n1.Mt,{type:o})]})}),(0,p.jsx)("div",{style:{flex:3},children:(0,p.jsx)(n3.se,{testId:c,name:t,required:l,inputType:r,availableFileTypes:a,disabledTypes:i,defaultValue:s})})]})]})},ro=n("104401"),rr=(0,nQ.Q2)(()=>{var{value:e,onChange:t,onBlur:n,readonly:o}=(0,nQ.U$)(),r=(0,nQ.qo)("inputs.datasetParameters.datasetParam"),{dataSets:a,isReady:i}=(0,L.Z3)({ids:r});return(0,p.jsx)(ro.Y,{dataSetInfo:e,onDataSetInfoChange:e=>{t(e),null==n||n()},readonly:!!o,dataSets:a,isReady:i})}),ra=()=>(0,p.jsxs)(n1.X_,{children:[(0,p.jsx)(rn,{inputFiedlName:"inputs.inputParameters.Query",testId:"/inputs/inputParameters/Query",tooltip:_.o.t("workflow_detail_knowledge_input_tooltip",{},"输入需要从知识中匹配的关键信息"),paramName:"Query",paramType:u.owu.String,inputType:u.owu.String}),(0,p.jsxs)(nQ.$0,{title:_.o.t("workflow_detail_knowledge_knowledge",{},"知识库"),tooltip:_.o.t("workflow_detail_knowledge_knowledge_tooltip",{},"选择需要匹配的知识范围，仅从选定的知识中召回信息"),children:[(0,p.jsx)("div",{className:"w-full mb-[16px]",children:(0,p.jsx)(o7,{name:"inputs.datasetParameters.datasetParam"})}),(0,p.jsx)(rr,{name:"inputs.datasetParameters.datasetSetting"})]}),(0,p.jsx)(n3.Nn,{title:_.o.t("workflow_detail_node_output"),tooltip:_.o.t("workflow_detail_knowledge_output_tooltip"),id:"dataset-node-output",name:"outputs",withDescription:!1,jsonImport:!1,customReadonly:!0,disabled:!0,allowAppendRootData:!1,hasFeedback:!1})]}),ri={render:()=>(0,p.jsx)(ra,{}),validateTrigger:m.C$.onBlur,validate:{nodeMeta:h.O,"inputs.inputParameters.Query":(0,o8.vu)({required:!0}),"inputs.datasetParameters.datasetParam":e=>{var{value:t}=e;if(!t||0===t.length)return _.o.t("workflow_detail_knowledge_error_empty")}},effect:{nodeMeta:em.J,outputs:ev.m},formatOnInit:function(e){if(!e)return{nodeMeta:void 0,inputs:{inputParameters:{Query:{type:"ref",content:""}},datasetParameters:{datasetParam:[],datasetSetting:{}}},outputs:[{key:(0,ez.x0)(),name:"outputList",type:u.owu.ArrayObject,children:[{key:(0,ez.x0)(),name:"output",type:u.owu.String}]}]};var t,n,o,r,a,i,l,s,{inputParameters:d,datasetParam:p}=e.inputs,v=(0,D._)((0,c._)({},e),{inputs:{datasetParameters:{}}});return v.inputs.inputParameters=d.reduce((e,t)=>(e[t.name]=t.input,e),{}),v.inputs.datasetParameters.datasetParam=null===(t=p[0])||void 0===t?void 0:t.input.value.content,v.inputs.datasetParameters.datasetSetting={top_k:null===(n=p.find(e=>"topK"===e.name))||void 0===n?void 0:n.input.value.content,min_score:null===(o=p.find(e=>"minScore"===e.name))||void 0===o?void 0:o.input.value.content,strategy:null===(r=p.find(e=>"strategy"===e.name))||void 0===r?void 0:r.input.value.content,use_nl2sql:null===(a=p.find(e=>"useNl2sql"===e.name))||void 0===a?void 0:a.input.value.content,use_rerank:null===(i=p.find(e=>"useRerank"===e.name))||void 0===i?void 0:i.input.value.content,use_rewrite:null===(l=p.find(e=>"useRewrite"===e.name))||void 0===l?void 0:l.input.value.content,is_personal_only:null===(s=p.find(e=>"isPersonalOnly"===e.name))||void 0===s?void 0:s.input.value.content},v},formatOnSubmit:function(e){var{nodeMeta:t,inputs:n,outputs:o}=e,{inputParameters:r={Query:{type:"ref"}},datasetParameters:a}=null!=n?n:{},{datasetParam:i,datasetSetting:l}=null!=a?a:{},s={nodeMeta:t,outputs:o,inputs:{datasetParam:[]}};return(0,v.Z)(s.inputs,"inputParameters",Object.entries(r).map(e=>{var[t,n]=e;return{name:t,input:n}})||[]),(0,v.Z)(s.inputs,"datasetParam",[{name:"datasetList",input:{type:"list",schema:{type:"string"},value:{type:"literal",content:i||[]}}},{name:"topK",input:{type:"integer",value:{type:"literal",content:null==l?void 0:l.top_k}}},u.ycG.createBoolean("useRerank",null==l?void 0:l.use_rerank),u.ycG.createBoolean("useRewrite",null==l?void 0:l.use_rewrite),u.ycG.createBoolean("isPersonalOnly",null==l?void 0:l.is_personal_only)]),!(0,ep.Z)(null==l?void 0:l.use_nl2sql)&&s.inputs.datasetParam.push(u.ycG.createBoolean("useNl2sql",null==l?void 0:l.use_nl2sql)),(null==l?void 0:l.min_score)&&s.inputs.datasetParam.push({name:"minScore",input:{type:"float",value:{type:"literal",content:null==l?void 0:l.min_score}}}),!(0,ep.Z)(null==l?void 0:l.strategy)&&s.inputs.datasetParam.push({name:"strategy",input:{type:"integer",value:{type:"literal",content:null==l?void 0:l.strategy}}}),s}},rl={type:u.nyy.Dataset,meta:{nodeDTOType:u.nyy.Dataset,style:{width:484},size:{width:eu.gu.width,height:130.7},nodeMetaPath:eu.je,outputsPath:eu.G0,inputParametersPath:"/inputs/inputParameters",test:{generateFormInputProperties(e){var t,n=e.getData(m.Ps).formModel.getFormItemValueByPath("/"),o=null==n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.inputParameters;return(0,ec.ee)(Object.entries(o||{}).map(e=>{var[t,n]=e;return{name:t,required:!0,input:n}}),{node:e})}},helpLink:"/open/docs/guides/knowledge_node"},formMeta:ri},rs=n("167985"),rd=n("54475"),ru=(0,nQ.Q2)(e=>{var{name:t,value:n,onChange:o,readonly:r}=(0,nQ.U$)();return(0,p.jsx)(rd.h,(0,c._)({value:n,onChange:o,readonly:!!r,context:{meta:{name:t}}},e))}),rc=n("522667"),rp=(0,nQ.Q2)(e=>{var{name:t,value:n,onChange:o,onBlur:r,readonly:a}=(0,nQ.U$)(),{getNodeSetterId:i}=(0,u.FCD)();return(0,p.jsx)(rc.$,(0,c._)({value:n,onChange:e=>{o(e),null==r||r()},readonly:!!a,context:{meta:{name:t}},customInputComp:(0,p.jsx)(nQ.UP,{name:"inputs.datasetWriteParameters.chunkStrategy.separator",style:{fontSize:"12px",width:"100%"},placeholder:_.o.t("datasets_custom_segmentID_placeholder"),"data-testid":i("dataset-write-separator-input")})},e))}),rv={color:"var(--Fg-COZ-fg-primary, rgba(6, 7, 9, 0.80))",fontSize:"12px",fontStyle:"normal",fontWeight:"500",lineHeight:"16px"},rm=()=>{var e=(0,nQ.qo)({name:"inputs.datasetParameters.datasetParam"});return(null==e?void 0:e.length)?(0,p.jsxs)(nQ.$0,{title:_.o.t("kl_write_033"),children:[(0,p.jsxs)("div",{className:"pt-[16px]",children:[(0,p.jsx)(rt.Z,{columns:[{title:_.o.t("kl_write_032"),style:rv}]}),(0,p.jsx)(ru,{name:"inputs.datasetWriteParameters.parsingStrategy",options:{mode:"card",direction:"horizontal",options:[{value:"fast",label:_.o.t("kl_write_004"),tooltip:_.o.t("kl_write_005")},{value:"accurate",label:_.o.t("kl_write_006"),tooltip:_.o.t("kl_write_007")}],radioCardClassName:"px-[11px] py-[6px]"}})]}),(0,p.jsx)(rt.Z,{columns:[{title:_.o.t("kl_write_011"),style:rv}]}),(0,p.jsx)(rp,{name:"inputs.datasetWriteParameters.chunkStrategy",feedbackTextClassName:"w-[160px] text-[12px] leading-[16px] text-[#ff441e]",hasFeedback:!1,options:{mode:"card",direction:"horizontal",options:[{value:"default",label:_.o.t("kl_write_012"),tooltip:_.o.t("kl_write_013")},{value:"custom",label:_.o.t("datasets_segment_tag_custom"),tooltip:_.o.t("datasets_createFileModel_step3_customDescription")}],radioCardClassName:"px-[11px] py-[6px]"}})]}):null},rf=()=>(0,p.jsxs)(n1.X_,{children:[(0,p.jsx)(rn,{inputFiedlName:"inputs.inputParameters.knowledge",testId:"/inputs/inputParameters/knowledge",tooltip:_.o.t("knowledge_write_tips_doc",{},"需要写入知识库的文档，必须满足 File-Doc 类型"),paramName:"knowledge",paramType:u.owu.Doc,inputType:u.owu.File,availableFileTypes:[u.owu.Doc,u.owu.Txt],disabledTypes:u.owu.getComplement([u.owu.Doc,u.owu.Txt])}),(0,p.jsx)(nQ.$0,{title:_.o.t("workflow_detail_knowledge_knowledge"),tooltip:_.o.t("knowledge_writing_101"),children:(0,p.jsx)(o7,{name:"inputs.datasetParameters.datasetParam"})}),(0,p.jsx)(rm,{}),(0,p.jsx)(n3.Nn,{title:_.o.t("workflow_detail_node_output"),tooltip:_.o.t("workflow_detail_knowledge_output_tooltip"),id:"dataset-write-node-output",name:"outputs",withDescription:!1,jsonImport:!1,customReadonly:!0,disabled:!0,allowAppendRootData:!1,hasFeedback:!1})]}),rg="x-wf-file_name",rh=e=>{var t,n,o,r=null!==(n=null==e?void 0:e.content)&&void 0!==n?n:"",a=null!==(o=null==e?void 0:null===(t=e.rawMeta)||void 0===t?void 0:t.fileName)&&void 0!==o?o:"";try{var i=new URL(r),l=new URLSearchParams(i.search);return l.has(rg)?l.set(rg,a):l.append(rg,a),i.search=l.toString(),i.toString()}catch(e){return r}},r_={render:()=>(0,p.jsx)(rf,{}),validateTrigger:m.C$.onBlur,validate:{nodeMeta:h.O,"inputs.inputParameters.knowledge":(0,o8.vu)({required:!0}),"inputs.datasetParameters.datasetParam":e=>{var{value:t}=e;if(!t||0===t.length)return _.o.t("workflow_detail_knowledge_error_empty")},"inputs.datasetWriteParameters.chunkStrategy.separator":e=>{var{value:t,formValues:n}=e;if("custom"===(0,w.Z)(n,"inputs.datasetWriteParameters.chunkStrategy.separatorType")&&!t)return _.o.t("datasets_custom_segmentID_error")}},effect:{nodeMeta:rs.Jr,outputs:ev.m},formatOnInit:function(e){if(!e)return{nodeMeta:void 0,inputs:{inputParameters:{knowledge:{type:"ref"}},datasetParameters:{datasetParam:[],datasetSetting:{top_k:1,min_score:0,strategy:0}},datasetWriteParameters:void 0},outputs:[{key:(0,ez.x0)(),name:"documentId",type:u.owu.String},{key:(0,ez.x0)(),name:"fileName",type:u.owu.String},{key:(0,ez.x0)(),name:"fileUrl",type:u.owu.String}]};var t,{inputParameters:n,datasetParam:o,strategyParam:r}=e.inputs,a=(0,c._)({},e);return(0,v.Z)(a,"inputs.inputParameters",n.reduce((e,t)=>(e[t.name]=t.input,e),{})),(0,v.Z)(a,"inputs.datasetParameters.datasetParam",null===(t=o[0])||void 0===t?void 0:t.input.value.content),(0,v.Z)(a,"inputs.datasetWriteParameters",(0,D._)((0,c._)({},r),{indexStrategy:(0,D._)((0,c._)({},r.indexStrategy),{vectorModel:{name:r.indexStrategy.vectorModel}})})),a},formatOnSubmit:function(e){var t,n,o,r,a,i,{nodeMeta:l,inputs:s,outputs:d}=e,{inputParameters:u={knowledge:{type:"ref"}},datasetParameters:p,datasetWriteParameters:m}=null!=s?s:{},{datasetParam:f}=null!=p?p:{},g={nodeMeta:l,outputs:d,inputs:{}},h=Object.entries(u).map(e=>{var[t,n]=e;return{name:t,input:n}})||[];return(null==h?void 0:null===(n=h[0])||void 0===n?void 0:null===(t=n.input)||void 0===t?void 0:t.type)!=="ref"&&(null==h?void 0:null===(r=h[0])||void 0===r?void 0:null===(o=r.input)||void 0===o?void 0:o.content)&&(h[0].input.content=rh(h[0].input)),(0,v.Z)(g.inputs,"inputParameters",h),(0,v.Z)(g.inputs,"datasetParam",[{name:"datasetList",input:{type:"list",schema:{type:"string"},value:{type:"literal",content:f||[]}}}]),(0,v.Z)(g.inputs,"strategyParam",{parsingStrategy:null==m?void 0:m.parsingStrategy,chunkStrategy:null==m?void 0:m.chunkStrategy,indexStrategy:(0,D._)((0,c._)({},null==m?void 0:m.indexStrategy),{vectorModel:null==m?void 0:null===(i=m.indexStrategy)||void 0===i?void 0:null===(a=i.vectorModel)||void 0===a?void 0:a.name})}),g}},ry={type:u.nyy.DatasetWrite,meta:{nodeDTOType:u.nyy.DatasetWrite,nodeMetaPath:eu.je,style:{width:484},size:{width:484,height:416},outputsPath:eu.G0,inputParametersPath:"/inputs/inputParameters",test:{generateFormInputProperties(e){var t,n=e.getData(m.Ps).formModel.getFormItemValueByPath("/"),o=null==n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.inputParameters;return(0,ec.ee)(Object.entries(o||{}).map(e=>{var[t,n]=e;return{name:t,required:!0,input:n}}),{node:e})}},helpLink:"/open/docs/guides/knowledge_base_writing_node"},formMeta:r_},rx=n("510149"),rw=n("966534"),rb=n.n(rw),rj=n("703188"),rk=n("130989"),rN=(e,t)=>{var{node:n,labelPrefix:o="",namePrefix:r=""}=t;if(!e)return{};var a=e.match(/{{([^}]+)}}/g),i=null==a?void 0:a.map(e=>e.replace(/^{{|}}$/g,"")),l=[],s={};return null==i||i.forEach(e=>{var{nodeNameWithDot:t,fieldPart:a,fieldKeyPath:i}=(0,rk.oW)(e),d=r+rb()(t+a),u=n.context.variableService.getWorkflowVariableByKeyPath(i,{node:n});if(!s[d]&&u&&!u.globalVariableKey){s[d]=!0;var c,p=null==u?void 0:u.node,v=p?null===(c=p.getData(m.Ps).formModel.getFormItemValueByPath(eu.je))||void 0===c?void 0:c.title:"";l.push({title:[o,v,a].filter(Boolean).join("-"),name:d,required:!0,input:{type:"ref",content:{keyPath:i}}})}}),(0,ec.ee)(l,{node:n})},rS=e=>{var t,n,o,r,a=e.getData(m.Ps).formModel.getFormItemValueByPath("/"),i=null==a?void 0:null===(n=a.inputs)||void 0===n?void 0:null===(t=n.auth)||void 0===t?void 0:t.authOpen,l=null==a?void 0:null===(r=a.inputs)||void 0===r?void 0:null===(o=r.auth)||void 0===o?void 0:o.authType;if(!i||!l)return{};var s={[rj.Gr.BasicAuth]:"auth.authData.basicAuthData",[rj.Gr.Bearer]:"auth.authData.bearerTokenData",[rj.Gr.Custom]:"auth.authData.customData.data"},d=s[l].split(".").join("_"),u=((0,w.Z)(a.inputs,s[l])||[]).map(e=>(0,D._)((0,c._)({},e),{name:"__".concat(d,"_").concat(e.name),title:"".concat(_.o.t("node_http_auth"),"-").concat(e.name)}));return(0,ec.ee)(u,{node:e})},rC=e=>{var t,n,o=e.getData(m.Ps).formModel.getFormItemValueByPath("/"),r=null==o?void 0:null===(n=o.inputs)||void 0===n?void 0:null===(t=n.body)||void 0===t?void 0:t.bodyType,a={[rj.eA.Binary]:"body.bodyData.binary",[rj.eA.FormData]:"body.bodyData.formData",[rj.eA.FormUrlEncoded]:"body.bodyData.formURLEncoded",[rj.eA.Json]:"body.bodyData.json",[rj.eA.RawText]:"body.bodyData.rawText"}[r],i=(0,w.Z)(o.inputs,a);if(r===rj.eA.FormUrlEncoded||r===rj.eA.FormData){var l=r===rj.eA.FormUrlEncoded?"formUrlEncoded":"formData",s=a.split(".").join("_");return(0,ec.ee)(i.map(e=>(0,D._)((0,c._)({},e),{name:"__".concat(s,"_").concat(rb()(e.name)),title:"".concat(l,"-").concat(e.name)})),{node:e})}if(r===rj.eA.Json||r===rj.eA.RawText)return rN(i,{node:e,labelPrefix:_.o.t("node_http_body"),namePrefix:"__".concat(a.replaceAll(".","_"),"_")});if(r===rj.eA.Binary)return(0,ec.ee)([{name:"__".concat(a.replaceAll(".","_"),"_fileURL"),title:"".concat(_.o.t("node_http_body"),"-").concat(_.o.t("node_http_body_binary")),input:null==i?void 0:i.fileURL}],{node:e});return{}},rI=n("896335"),rT=n("717497"),rP=n("524705"),rD=n("469541"),rE=n("533733"),rO=n("919658"),rL=n("479654"),rM=n("569251"),rF=n("562312");function rZ(e,t){var n=(0,rk.dU)(t);(0,O.useEffect)(()=>{if(!!e)return document.addEventListener("keydown",t,!0),()=>{document.removeEventListener("keydown",t,!0)};function t(e){var t=n.current[e.key];"function"==typeof t&&t(e)}},[e,n])}var rR=n("642199"),rV=n("913693"),rA=n("519143");class rz extends t$.l9{toDOM(){var e,t,n=document.createElement("span");return n.classList.add(rA.Z.content),this.variableContext.varaibleInfo.globalVariableKey&&n.classList.add(rA.Z["pointer-content"]),!this.variableContext.varaibleInfo.isValid&&n.classList.add(rA.Z["error-content"]),(null===(e=this.variableContext)||void 0===e?void 0:e.isDarkTheme)&&n.classList.add(rA.Z["dark-suffix"]),n.onclick=()=>{var e;null===(e=this.openList)||void 0===e||e.call(this,this.range)},(null===(t=this.variableContext)||void 0===t?void 0:t.noLabel)?n.classList.add(rA.Z["variable-suffix"]):n.innerText=this.variableContext.varaibleInfo.parsedKeyPath,n}eq(e){var t,n,o,r;return this.range.from===e.range.from&&this.range.to===e.range.to&&this.variableContext.varaibleInfo===e.variableContext.varaibleInfo&&(null===(t=this.variableContext)||void 0===t?void 0:t.noLabel)===(null===(n=e.variableContext)||void 0===n?void 0:n.noLabel)&&(null===(o=this.variableContext)||void 0===o?void 0:o.isDarkTheme)===(null===(r=e.variableContext)||void 0===r?void 0:r.isDarkTheme)}constructor(e,t,n){super(),this.range=e,this.variableContext=t,this.openList=n}}class rB extends t$.l9{toDOM(){var e,t,n,{range:o,varaibleInfo:r,nodeName:a,isDarkTheme:i,languageId:l}=this.variableContext,s=document.createElement("span");s.classList.add(rA.Z.node),i&&s.classList.add(rA.Z.nodeDark),s.onclick=()=>{if(!this.readonly)this.openList(o)},!r.isValid&&s.classList.add(rA.Z["node-error"]),(null==r?void 0:r.globalVariableKey)?((e=document.createElement("div")).innerHTML=(0,rk.ed)(i?"white":"#080D1E")[null==r?void 0:r.globalVariableKey],e.classList.add(rA.Z.svg)):((e=document.createElement("img")).src=null!==(t=null==r?void 0:r.iconUrl)&&void 0!==t?t:"",e.classList.add(rA.Z.image));var d=document.createElement("span");d.classList.add(rA.Z.nodeName),d.classList.add("json"===l?rA.Z.jsonLineHeight:rA.Z.baseLineHeight),d.innerText=null!==(n=null==r?void 0:r.nodeTitle)&&void 0!==n?n:a;var u=document.createElement("span");u.classList.add(rA.Z.split),u.innerText="-";var c=document.createElement("span");return c.classList.add(rA.Z.wrapper),c.appendChild(e),c.appendChild(d),c.appendChild(u),s.appendChild(c),s}eq(e){return this.openList===e.openList&&this.variableContext.nodeName===e.variableContext.nodeName&&this.variableContext.range.from===e.variableContext.range.from&&this.variableContext.range.to===e.variableContext.range.to&&this.variableContext.varaibleInfo===e.variableContext.varaibleInfo&&this.readonly===e.readonly&&this.variableContext.isDarkTheme===e.variableContext.isDarkTheme}constructor(e,t,n){super(),this.openList=e,this.variableContext=t,this.readonly=n}}class rU extends t$.l9{toDOM(){var e=document.createElement("span");e.classList.add(rA.Z["deleted-variable"]),e.onclick=()=>{this.openList(this.range)};var t=document.createElement("div");t.classList.add(rA.Z.svg),t.innerHTML=(0,rk.ed)().delete;var n=document.createElement("span");return n.classList.add(rA.Z["deleted-text"]),n.innerText=_.o.t("node_http_var_infer_delete",{},"变量失效"),e.appendChild(t),e.appendChild(n),e}eq(e){return this.openList===e.openList&&this.range.from===e.range.from&&this.range.to===e.range.to}constructor(e,t){super(),this.range=e,this.openList=t}}var rq=e=>{var{availableVariables:t,openUpdateDropdown:n,updateRange:o,setPos:r,readonly:a,isDarkTheme:i,languageId:l}=e,s=(0,rk.dU)(i),d=(0,rk.dU)(n),u=(0,O.useRef)(),c=(0,tF.G6)(),p=(0,rD.l)();(0,O.useLayoutEffect)(()=>{var e=rV.QQ.define({create:e=>(0,rk.SH)(e),update:(e,t)=>t.docChanged?(0,rk.SH)(t.state):e});return c.inject([e,rR._h.of(t=>t.field(e)),rR.bi.of(t=>t.field(e)),rR.Cj.whole.of((e,n)=>{var c,v;if("Interpolation"===e.name&&(null===(c=e.node.firstChild)||void 0===c?void 0:c.name)==="{{"&&(null===(v=e.node.lastChild)||void 0===v?void 0:v.name)==="}}"){var m=e.node.firstChild.to,f=e.node.lastChild.from,g=n.sliceDoc(m,f),{globalVariableKey:h,nodeName:_,nodeNameWithDot:y,fieldPart:x,fieldKeyPath:w,parsedKeyPath:b}=(0,rk.oW)(g);if(_&&x){var j=null==y?void 0:y.length,k=p(w),N=(0,rk.W3)(t,{globalVariableKey:h,nodePart:_,fieldPart:x,parsedKeyPath:b},k);if(u.current=N,!(null==N?void 0:N.isVariableExist)){var S=new rU({from:m-2,to:f+2},e=>{d.current(),o.current=e,r(m)});return[{type:"replace",from:e.from,to:e.node.lastChild.to,widget:S,atomicRange:!0}]}var C=new rB(e=>{d.current(),o.current=e,r(m)},{nodeName:_,range:{from:m-2,to:f+2},varaibleInfo:u.current,isDarkTheme:s.current,languageId:l},a),I=new rz({from:m-2,to:f+2},{varaibleInfo:N,isDarkTheme:i},e=>{d.current(),o.current=e,r(m)}),T=new rz({from:m,to:f},{varaibleInfo:N,isDarkTheme:i,noLabel:!0});return[{type:"replace",from:e.from,to:m+j,widget:C,atomicRange:!0},h?{type:"replace",from:m+j,to:f,widget:I,atomicRange:!0}:{type:"className",className:J()(rA.Z.content,{[rA.Z["dark-content"]]:i,[rA.Z["error-content"]]:!N.isValid}),from:m+j,to:f},{type:"replace",from:f,to:e.node.lastChild.to,widget:T,atomicRange:!0}]}}})])},[c,t,i])},rW=e=>{var t,{dropDownVisible:n,editorRef:o,interpolationContent:r,dropdownRef:a,variableMenuRef:i,openMenu:l,setActiveOptionHover:s,setTreeVisible:d,isInputDropdownOpen:u,applyNode:c}=e,p=(0,tF.jE)(),v=(0,rk.zA)(null===(t=i.current)||void 0===t?void 0:t.treeContainerRef,".semi-tree-option-list .semi-tree-option");(0,O.useEffect)(()=>{if(!!p)n&&p.disableKeybindings(["ArrowUp","ArrowLeft","ArrowRight","ArrowDown"]),v&&p.disableKeybindings(["Enter","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"]),!n&&!v&&p.disableKeybindings([])},[n,p,v]);var{prev:m,next:f,left:g,right:h,apply:_}=function(e){var{editorRef:t,dropdownContext:{dropdownRef:n,setActiveOptionHover:o,variableMenuRef:r},setTreeVisible:a,isInputDropdownOpen:i,applyNode:l}=e;return(0,O.useMemo)(()=>({prev:function(){if(r.current){var e,t=(0,rk.zA)(null===(e=r.current)||void 0===e?void 0:e.treeContainerRef,".semi-tree-option-list .semi-tree-option");if(!t)return;var{elements:a,selectedIndex:i}=t;if(1===a.length)return;var l=i-1<0?a.length-1:i-1;(0,rk.Er)(a,l);return}var s=(0,rk.zA)(n.current);if(!s)return;var{elements:d,selectedIndex:u}=s;if(1!==d.length){var c=u-1<0?d.length-1:u-1;(0,rk.Er)(d,c),o(c)}},next:function(){if(r.current){var e,t=(0,rk.zA)(null===(e=r.current)||void 0===e?void 0:e.treeContainerRef,".semi-tree-option-list .semi-tree-option");if(!t)return;var{elements:a,selectedIndex:i}=t,l=i+1>=a.length?0:i+1;(0,rk.Er)(a,l);return}var s=(0,rk.zA)(n.current);if(!!s){var{elements:d,selectedIndex:u}=s,c=u+1>=d.length?0:u+1;(0,rk.Er)(d,c),o(c)}},left:function(){if(a(!1),!!(0,rk.zA)(n.current))o(NaN)},right:function(){!r.current&&a(!0);var e=(0,rk.zA)(n.current);if(!!e){var{selectedIndex:t}=e;o(t)}},apply:function(){if(!(null===(e=r.current)||void 0===e?void 0:e.treeRef))return;var e,n,o,a,s,d,u,c=(0,rk.zA)(null===(n=r.current)||void 0===n?void 0:n.treeContainerRef,".semi-tree-option-list .semi-tree-option");if(!c)return;var{selectedElement:p}=c,v=null==p?void 0:p.getAttribute("data-key");if(!v)return;var m=null===(u=r.current)||void 0===u?void 0:null===(d=u.treeRef)||void 0===d?void 0:null===(s=d.state)||void 0===s?void 0:null===(a=s.keyEntities)||void 0===a?void 0:null===(o=a[v])||void 0===o?void 0:o.data;if(!!m)l(m,{type:i?"input":"update"},t)}}),[i,a])}({editorRef:o,context:r,dropdownContext:{setActiveOptionHover:s,dropdownRef:a,variableMenuRef:i},setTreeVisible:d,isInputDropdownOpen:u,applyNode:c});rZ(n,{ArrowUp:m,ArrowDown:f,ArrowLeft:g,ArrowRight:h,Enter:_}),rZ(n,{Escape(){l(!1),d(!1)}})},rG=n("785953"),rH="tree-variable-selector-dropdown";function r$(e){var t,n,{readonly:o,availableVariables:r,variableDataSource:a,getVariableByKeyPath:i,variableTree:l,isDarkTheme:s,languageId:d}=e,u=(0,tF.jE)(),[v,m]=(0,O.useState)(-1),[f,g]=(0,O.useState)(""),h=(0,O.useRef)(null),y=(0,O.useRef)(null),x=(0,O.useRef)(null),w=(0,O.useRef)(null),b=(0,rk.dU)(u),j=function(e){var[t,n]=(0,O.useState)(),o=(0,rk.dU)(t);return(0,O.useEffect)(()=>{if(!!e){var t=e.$view;return e.$on("selectionChange",a),e.$on("focus",i),()=>{e.$off("selectionChange",a),e.$off("focus",i)}}function r(e){if(null==e?void 0:e.transactions.some(e=>(0,rk._p)(e))){n(void 0);return}var r,a,{from:i,to:l,anchor:s,head:d}=t.state.selection.main;if(r={from:i,to:l,anchor:s,head:d},a=o.current,(!!r||!!a)&&(!r||!a||r.anchor!==a.anchor||r.head!==a.head||r.from!==a.from||r.to!==a.to))n({from:i,to:l,anchor:s,head:d})}function a(e){r(e.update)}function i(){r()}},[e]),t}(u);var k=(t=u,n=null==j?void 0:j.anchor,(0,O.useMemo)(()=>{if(!!t&&void 0!==n)return function(e,t){var n=(0,rF.qz)(e.state).cursorAt(t);do if("Interpolation"===n.node.type.name&&n.node.firstChild&&n.node.lastChild&&t>=n.node.firstChild.to&&t<=n.node.lastChild.from){var o=e.state.sliceDoc(n.node.firstChild.to,n.node.lastChild.from),r=t-n.node.firstChild.to;return{from:n.node.firstChild.to,to:n.node.lastChild.from,text:o,offset:r,textBefore:o.slice(0,r)}}while(n.parent())}(t.$view,n)},[t,n])),[N,S]=(0,O.useState)(!1),[C,I]=(0,O.useState)(!1),[T,P]=(0,O.useState)(rG.gF.Input),E=T===rG.gF.Input,L=(0,O.useRef)({from:0,to:0}),M=C||N;rq({availableVariables:r,openUpdateDropdown:()=>{(null==a?void 0:a.length)&&!o&&I(!0),P(rG.gF.Update)},updateRange:L,setPos:m,readonly:o,isDarkTheme:s,languageId:d});var[F,Z]=(0,O.useState)(""),[V,A]=(0,O.useState)(!1);(0,O.useEffect)(()=>{!M&&Z("")},[M]);var z=(e,t,n)=>{var o,r,a,l,s,{type:d,customRange:p}=t,v=null!=u?u:null==n?void 0:n.current;if(!!v){var m=i(null!==(o=null==e?void 0:e.path)&&void 0!==o?o:[]);if(!(null==m?void 0:m.expressionPath)){R.FN.error(_.o.t("node_http_var_infer_delete",{},"变量失效"));return}v.focus();var{expressionPath:f}=m,g=f.source!==ey.g1,h="";if(h=g?null!==(a=null===(r=f.keyPath)||void 0===r?void 0:r.reduce((e,t)=>e?"".concat(e,'["').concat(t,'"]'):t,""))&&void 0!==a?a:"":ey.On+(null!==(s=null===(l=f.keyPath)||void 0===l?void 0:l.join("."))&&void 0!==s?s:""),A(!1),"input"===d){var y=null!=p?p:(0,rO.m4)(v.$view.state);if(!y)return;v.replaceText((0,D._)((0,c._)({},y),{text:"{{".concat(h,"}}")}))}else v.replaceText((0,D._)((0,c._)({},L.current),{text:"{{".concat(h,"}}")})),I(!1)}};rW({dropDownVisible:M,editorRef:b,interpolationContent:k,dropdownRef:E?h:x,variableMenuRef:E?y:w,openMenu:E?S:I,setActiveOptionHover:e=>{var t;Z(null==a?void 0:null===(t=a[e])||void 0===t?void 0:t.value)},setTreeVisible:A,isInputDropdownOpen:E,applyNode:z});var B=(0,O.useCallback)(e=>{Z(null==e?void 0:e.value)},[Z]);return(0,p.jsxs)("div",{children:[(0,p.jsx)(R.Lt,{trigger:"custom",visible:N,rePosKey:f,motion:!1,position:"bottom",className:"overflow-visible ".concat(rH),style:{minWidth:206},render:(0,p.jsx)("div",{onMouseDown:e=>e.preventDefault(),ref:h,children:(0,p.jsx)(rM.Z,{ref:y,treeData:a,activeOption:F,onSelect:(e,t)=>{if(t!==rL.Q.Option)z(e,{type:"input"})},onOptionHover:B,controlledActive:V,getOptionPopupContainer:()=>document.querySelector(".".concat(rH))||document.body})}),getPopupContainer:()=>document.body,children:(0,p.jsx)(rO.Iq,{position:v-1,onChange:()=>g(String(Math.random()))})}),(0,p.jsx)(R.Lt,{trigger:"custom",visible:C,motion:!1,rePosKey:f,position:"bottom",className:"overflow-visible ".concat(rH),onClickOutSide:e=>{var t,n,o;if(!(!x.current||(null===(o=w.current)||void 0===o?void 0:null===(n=o.treeContainerRef)||void 0===n?void 0:null===(t=n.contains)||void 0===t?void 0:t.call(n,null==e?void 0:e.target))))I(!1),A(!1)},style:{minWidth:206},render:(0,p.jsx)("div",{onMouseDown:e=>e.preventDefault(),ref:x,children:(0,p.jsx)(rM.Z,{ref:w,treeData:a,activeOption:F,onSelect:(e,t)=>{if(t!==rL.Q.Option)z(e,{type:"update"})},onOptionHover:B,controlledActive:V,getOptionPopupContainer:()=>document.querySelector(".".concat(rH))||document.body})}),getPopupContainer:()=>document.body,children:(0,p.jsx)(rO.Iq,{position:v-1,onChange:()=>g(String(Math.random()))})}),(0,p.jsx)(tB.ID,{disabled:M,disableUpdateTrigger:!0,variableTree:null!=l?l:[],customApplyNode:(e,t)=>{var n;z({path:null==e?void 0:null===(n=e.value)||void 0===n?void 0:n.split(".")},{type:"input",customRange:{from:t.from-2,to:t.to+2}})},customInterpolationRule:(e,t)=>{var n=!1;if(null===ey.kA||void 0===ey.kA||ey.kA.forEach(o=>{(null==e?void 0:e.startsWith(o))&&t!==o&&(n=!0)}),!n){var o=new RegExp("".concat(ey.On,"(\\d+)\\.(?!\\S)")),r=null==t?void 0:t.match(o);n=!!((null==e?void 0:e.startsWith(ey.On))&&!r)}return n}}),(0,p.jsx)(rO.pf,{triggerCharacters:["{","{}"],onOpenChange:e=>{var{value:t,state:n}=e,r=n.selection.main.head;(null==a?void 0:a.length)&&!o&&S(t),m(r),t&&P(rG.gF.Input)}})]})}var rJ=n("295197"),rY=n("336383"),rQ=n("881280"),rX=n("15326"),rK=n("486264"),r0=n("213635"),r1=n("161607"),r2=e=>{var{variables:t,getNodeInfoInVariableMeta:n}=e,o=t.map(e=>{var t,o,r,a,i;return{name:e.globalVariableKey?null===(t=e.expressionPath)||void 0===t?void 0:t.source:ey.On+(null===(r=e.expressionPath)||void 0===r?void 0:null===(o=r.keyPath)||void 0===o?void 0:o[0]),keyPath:[null===(i=e.expressionPath)||void 0===i?void 0:null===(a=i.keyPath)||void 0===a?void 0:a[0]],variable:e.viewMeta?(0,D._)((0,c._)({},e.viewMeta,e.node?n(e.node):{nodeTitle:(0,ey.hw)(e.globalVariableKey),nodeId:e.globalVariableKey}),{children:[(0,c._)({},e.viewMeta,e.node?n(e.node):{nodeTitle:(0,ey.hw)(e.globalVariableKey),nodeId:e.globalVariableKey})]}):void 0}});return nI.qz.createVariableTree(o)},r4=n("526900"),r6=n("547014");var r5=((i={}).Light="coze-light",i.Dark="coze-dark",i);_.o.t("workflow_detail_node_parameter_name"),_.o.t("card_builder_api_http_params_columns_type"),_.o.t("workflow_detail_node_parameter_value");var r3=[{title:_.o.t("workflow_detail_node_parameter_name"),style:{flex:2}},{title:_.o.t("workflow_detail_node_parameter_value"),style:{flex:3}}],r8={file:u.owu.File,string:u.owu.String},r9={[u.owu.File]:"file",[u.owu.String]:"string"},r7=(0,r4.Gy)(e=>{var t=function(e,t){for(var n,o=new RegExp(t,t.flags.includes("g")?t.flags:"".concat(t.flags,"g")),r=[];n=o.exec(e);){;n.index===o.lastIndex&&o.lastIndex++,r.push({match:n[0],range:[n.index,n.index+n[0].length]})}return r}(e.toString(),/\{\{([^\}]*)\}\}/g);return t.length>0&&t.forEach(t=>{var{range:n}=t;e.replaceRange(n[0],n[1],"null")}),e}),ae=O.forwardRef((e,t)=>{var n,{value:o,onChange:r,placeholder:a,className:i,isDarkTheme:l,readonly:s,minHeight:d="100px",maxHeight:u,editerHeight:c,padding:v,borderRadius:m}=e,f=(0,O.useRef)(null),g=(0,O.useCallback)(e=>{"function"==typeof r&&r(e.value)},[r]);(0,O.useEffect)(()=>{var e;null===(e=f.current)||void 0===e||e.updateASTDecorations()},[l]),(0,O.useEffect)(()=>{var e=f.current;if(!!e)"string"==typeof o&&o!==e.getValue()&&e.setValue(o)},[o]);var h=(n=(0,nS._)(function*(){var e,t=null===(e=f.current)||void 0===e?void 0:e.$view;if(!!t)t.dispatch((yield rT.AV.languageService.format(t.state,{tabSize:2})))}),function(){return n.apply(this,arguments)});return(0,O.useImperativeHandle)(t,()=>({formatJson:h})),(0,p.jsx)("div",{className:i,children:(0,p.jsx)(r6.pq,{defaultValue:null!=o?o:"",onChange:g,options:{placeholder:a,lineWrapping:!0,theme:l?r5.Dark:r5.Light,languageId:"json",editable:!s,transformer:r7,minHeight:d,maxHeight:u,editerHeight:c,borderRadius:m,padding:v,fontSize:12,lineHeight:20},didMount:e=>f.current=e})})}),at=(0,O.forwardRef)((e,t)=>{var{value:n,onChange:o,placeholder:r,className:a,minHeight:i,readonly:l}=e,s=(0,O.useRef)(null),d=(0,O.useCallback)(e=>{"function"==typeof o&&o(e.value)},[o]);return(0,O.useEffect)(()=>{var e=s.current;if(!!e)"string"==typeof n&&n!==e.getValue()&&e.setValue(n)},[n]),(0,p.jsx)("div",{ref:t,className:a,children:(0,p.jsx)(r6.H4,{defaultValue:null!=n?n:"",onChange:d,options:{placeholder:r,lineWrapping:!0,minHeight:i,fontSize:12,editable:!l,lineHeight:20},didMount:e=>s.current=e})})}),an=e=>{var{value:t,onChange:n,placeholder:o,className:r,isDarkTheme:a,readonly:i,minHeight:l="100px",maxHeight:s,editerHeight:d,padding:u}=e,c=(0,O.useRef)(null),v=(0,O.useCallback)(e=>{"function"==typeof n&&n(e.value)},[n]);return(0,O.useEffect)(()=>{var e=c.current;if(!!e)"string"==typeof t&&t!==e.getValue()&&e.setValue(t)},[t]),(0,p.jsx)("div",{className:r,children:(0,p.jsx)(r6.pq,{defaultValue:null!=t?t:"",onChange:v,options:{placeholder:o,lineWrapping:!0,theme:a?r5.Dark:r5.Light,languageId:"shell",editable:!i,minHeight:l,maxHeight:s,editerHeight:d,padding:u,fontSize:12,lineHeight:20},didMount:e=>c.current=e})})},ao=n("969502"),ar=e=>{var{value:t,onChange:n,placeholder:o,minHeight:r,readonly:a=!1}=e,i=(0,O.useRef)(null),l=(0,rD.l)(),s=(0,rE.Z)(),{getNodeInfoInVariableMeta:d}=(0,rJ.U)(),u=(0,r1.p)(s,d),c=(0,rQ.t)({disabledTypes:[]}),v=(0,rX.Z)(c),m=(0,rY.Qq)({dataSource:v,icon:e=>(0,ey.mN)(e.value)?(0,p.jsx)(rK.Z,{nodeId:e.value}):(0,p.jsx)(r0.q,{size:16,alt:"logo",nodeId:e.value,className:"leading-[0px]"})}),f=(0,rY.xr)(m),g=r2({variables:s,getNodeInfoInVariableMeta:d});return(0,p.jsxs)("div",{className:"w-full",children:[(0,p.jsx)(at,{ref:i,readonly:a,value:t,className:J()(ao.Z["editor-render"],ao.Z["editor-render-cm-content"]),placeholder:o,onChange:n,minHeight:r}),(0,p.jsx)(r$,{readonly:a,availableVariables:u,variableDataSource:f,getVariableByKeyPath:l,variableTree:g})]})},aa=(0,nQ.Q2)(e=>{var{placeholder:t,minHeight:n}=e,{name:o,value:r,onChange:a,onBlur:i,errors:l}=(0,nQ.U$)(),s=(0,T.j)();return(0,p.jsx)(t1.LN,{name:o,onBlur:()=>null==i?void 0:i(),className:ao.Z["raw-editor-container"],isError:!s&&!!(null==l?void 0:l.length),children:(0,p.jsx)(tF.KU,{children:(0,p.jsx)(ar,{name:"http-field-json-editor",placeholder:t,value:r,onChange:a,minHeight:n,readonly:s})})})});function ai(e){return e?Object.entries(e).map(e=>{var[t,n]=e;return{name:t,type:function(e){switch(typeof e){case"string":default:return u.owu.String;case"number":return u.owu.Number;case"boolean":return u.owu.Boolean}}(n),input:{type:"literal",content:n}}}):[]}var al=n("327703"),as=n("980483"),ad=n("241741"),au=e=>{var{id:t,onClose:n,onChange:o}=e,[r,a]=(0,O.useState)(""),{isDarkTheme:i,setEditorTheme:l}=(0,as.uU)(),s=(0,O.useCallback)((0,nS._)(function*(){return new Promise(e=>{R.u_.warning({icon:(0,p.jsx)(nl.O5N,{className:ad.Z.warningIcon,style:{width:22,height:22}}),title:_.o.t("workflow_json_node_update_tips_title"),content:_.o.t("workflow_json_node_update_tips_content"),okType:"warning",okText:_.o.t("Confirm"),cancelText:_.o.t("Cancel"),onOk:()=>{try{var t=new al.Z0(r).parse();if(!(null===rj.w$||void 0===rj.w$?void 0:rj.w$[null==t?void 0:t.method]))throw Error("cURL Method Error");o(t)}catch(e){R.FN.warning({content:"cURL Format Error",duration:3}),console.warn("cURL Format Error",e)}e(!0)},onCancel:()=>e(!1)})})}),[r]);return(0,p.jsx)(t1.oP,{id:t,onClose:n,closeIconClassName:J()({[ad.Z.themeIconDark]:i}),editorTitle:_.o.t("node_http_import_curl",{},"导入 cURL"),headerClassName:J()(ad.Z["expand-header"],{[ad.Z["expand-header-dark"]]:i}),contentClassName:J()(ad.Z["expand-content"],{[ad.Z["expand-content-dark"]]:i}),editorContent:(0,p.jsx)(tF.KU,{children:(0,p.jsx)(an,{className:ad.Z.editorWrapper,placeholder:_.o.t("node_http_import_curl_placeholder",{},"请输入cURL"),value:r,onChange:e=>a(e),minHeight:"100%",maxHeight:"100%",editerHeight:"100%",padding:"12px",isDarkTheme:i})}),actions:[(0,p.jsx)(R.hU,{color:"highlight",className:J()(ad.Z.importButton,{[ad.Z.importButtonDark]:i}),icon:(0,p.jsx)(V.nBN,{className:ad.Z.buttonIcon}),onClick:s,children:_.o.t("import",{},"导入")}),(0,p.jsx)("span",{children:(0,p.jsx)(R.hU,{onClick:()=>{l(i?as.bY.Light:as.bY.Dark)},icon:i?(0,p.jsx)(V.GqL,{fontSize:18,className:ad.Z.themeIconDark}):(0,p.jsx)(V.Rd9,{fontSize:18,className:ad.Z.themeIconLight}),size:"small",color:"secondary","aria-label":"close"})})]})},ac=e=>{var{onChange:t,customClassNames:n="",testId:o,disabled:r,disabledTooltip:a=_.o.t("node_http_import_curl",{},"导入 cURL")}=e,{getNodeSetterId:i}=(0,u.FCD)(),{setFullscreenPanel:l}=(0,tL.Tk)();return(0,p.jsx)("div",{className:J()({[n]:n}),"data-testid":o,children:(0,p.jsx)(R.u,{content:r?a:_.o.t("node_http_import_curl",{},"导入 cURL"),children:(0,p.jsx)(R.hU,{"data-testid":i("apiInfo-import-curl-btn"),className:J()("!block",{[ad.Z.importButton]:!0,[ad.Z.importButtonDisabled]:r}),size:"small",color:"highlight",disabled:r,icon:(0,p.jsx)(V.nBN,{className:ad.Z.buttonIcon}),onClick:()=>{l((0,p.jsx)(I.n,{children:(0,p.jsx)(au,{onChange:t,onClose:()=>{l(null)},id:"import-curl"})}))},children:(0,p.jsx)("span",{style:{fontSize:12,fontWeight:500,lineHeight:"16px"},children:_.o.t("node_http_import_curl",{},"导入 cURL")})})})})},ap=()=>{var e=(0,T.j)(),{getNodeSetterId:t}=(0,u.FCD)(),n=(0,nQ.cI)(),o=(0,O.useMemo)(()=>Object.keys(rj.w$).map(e=>({label:null===rj.w$||void 0===rj.w$?void 0:rj.w$[e],value:null===rj.w$||void 0===rj.w$?void 0:rj.w$[e]})),[]);return(0,p.jsx)(nQ.$0,{title:_.o.t("node_http_api",{},"API"),tooltip:_.o.t("node_http_api_tooltips",{},"API接口的地址"),actions:[(0,p.jsx)(ac,{onChange:e=>{var t,o,r,a,i=e.method===rj.w$.GET;n.setFieldValue("inputs.apiInfo",{method:e.method,url:i?null==e?void 0:e.originPath:null==e?void 0:e.url}),n.setFieldValue("inputs.params",ai(i?null==e?void 0:e.query:null==e?void 0:e.params));var l={};for(var s in null==e?void 0:e.headers)"content-type"!==s.toLowerCase()&&(l[s]=null==e?void 0:e.headers[s]);n.setFieldValue("inputs.headers",ai(l));var d=null==e?void 0:null===(t=e.body)||void 0===t?void 0:t.type,c=null!==(o=null===rj.bp||void 0===rj.bp?void 0:rj.bp[d])&&void 0!==o?o:rj.eA.Empty;n.setFieldValue("inputs.body.bodyType",c);var p=(null==e?void 0:e.body).data;if(d!==rj.eA.Empty)c===rj.eA.Binary?r={fileURL:{type:"literal",content:"",rawMeta:{type:8}}}:c===rj.eA.FormUrlEncoded||c===rj.eA.FormData?r=null===(a=Object.keys(p))||void 0===a?void 0:a.map(e=>({name:e,type:u.owu.String,input:{type:"literal",content:p[e]}})):c===rj.eA.RawText?r=p:c===rj.eA.Json&&(r=JSON.stringify(p)),n.setFieldValue("inputs.body.bodyData",{[rj.CH[c]]:r})},testId:"apiInfo-import-curl",disabled:e})],children:(0,p.jsxs)("div",{className:"flex flex-col gap-[8px]",children:[(0,p.jsx)(nQ.mg,{name:"inputs.apiInfo.method",defaultValue:rj.w$.GET,optionList:o,"data-testid":t("apiInfo-method-select"),style:{width:"100%",borderColor:"var(--Stroke-COZ-stroke-plus, rgba(84, 97, 156, 0.27))"}}),(0,p.jsx)(aa,{name:"inputs.apiInfo.url",placeholder:_.o.t("node_http_url_input",{},'请输入接口的URL，可以使用"{{"引用变量'),minHeight:56})]})})},av=n("288125"),am=O.forwardRef((e,t)=>{var{value:n,onChange:o,placeholder:r,isDarkTheme:a,readonly:i=!1,minHeight:l,maxHeight:s,editerHeight:d,padding:u,borderRadius:c,editorClassName:v}=e,m=(0,rD.l)(),f=(0,rE.Z)(),{getNodeInfoInVariableMeta:g}=(0,rJ.U)(),h=(0,r1.p)(f,g),y=(0,rQ.t)({disabledTypes:[]}),x=(0,rX.Z)(y),w=(0,rY.Qq)({dataSource:x,icon:e=>(0,ey.mN)(e.value)?(0,p.jsx)(rK.Z,{nodeId:e.value}):(0,p.jsx)(r0.q,{size:16,alt:"logo",nodeId:e.value,className:"leading-[0px]"})}),b=(0,rY.xr)(w),j=r2({variables:f,getNodeInfoInVariableMeta:g}),[k,N]=(0,O.useState)(!1);return(0,p.jsx)(R.u,{content:_.o.t("db_table_0129_003"),trigger:"custom",position:"top",autoAdjustOverflow:!1,visible:i&&k,getPopupContainer:()=>{var e;return null!==(e=document.getElementById(tJ.I7))&&void 0!==e?e:document.body},children:(0,p.jsxs)("div",{className:"w-full h-full",onMouseEnter:()=>N(!0),onMouseLeave:()=>N(!1),children:[(0,p.jsx)(ae,{ref:t,readonly:i,value:n,className:J()(av.Z["editor-render"],av.Z["editor-render-cm-content"],v),placeholder:r,onChange:o,minHeight:l,maxHeight:s,editerHeight:d,padding:u,borderRadius:c,isDarkTheme:a}),(0,p.jsx)(r$,{readonly:i,isDarkTheme:a,availableVariables:h,variableDataSource:b,getVariableByKeyPath:m,variableTree:j,languageId:"json"})]})})}),af=e=>{var{id:t,onClose:n,value:o,onChange:r}=e,a=(0,T.j)(),i=(0,O.useRef)(null),{isDarkTheme:l,setEditorTheme:s}=(0,as.uU)();return(0,O.useEffect)(()=>{var e,t;if(!!i.current)null===(t=i.current)||void 0===t||null===(e=t.formatJson)||void 0===e||e.call(t)},[]),(0,p.jsx)(t1.oP,{id:t,onClose:n,closeIconClassName:J()({[av.Z.themeIconDark]:l}),editorTitle:"JSON",headerClassName:J()(av.Z["expand-header"],{[av.Z["expand-header-dark"]]:l}),contentClassName:J()(av.Z["expand-content"],{[av.Z["expand-content-dark"]]:l}),editorContent:(0,p.jsx)(I.n,{children:(0,p.jsx)(tF.KU,{children:(0,p.jsx)(am,{ref:i,value:o,placeholder:_.o.t("node_http_json_data_input"),onChange:e=>{r(e)},name:t,isDarkTheme:l,readonly:a,minHeight:"100%",maxHeight:"100%",editerHeight:"100%",padding:"12px",editorClassName:av.Z.editorWrapper})})}),actions:[(0,p.jsx)(R.u,{content:_.o.t("node_http_json_format"),children:(0,p.jsx)("span",{children:(0,p.jsx)(R.hU,{onClick:()=>{var e,t;null===(t=i.current)||void 0===t||null===(e=t.formatJson)||void 0===e||e.call(t)},icon:(0,p.jsx)(V.bGR,{fontSize:18,className:J()(l?av.Z.themeIconDark:av.Z.themeIconLight)}),size:"small",color:"secondary","aria-label":"format"})})}),(0,p.jsx)("span",{children:(0,p.jsx)(R.hU,{onClick:()=>{s(l?as.bY.Light:as.bY.Dark)},icon:l?(0,p.jsx)(V.GqL,{fontSize:18,className:av.Z.themeIconDark}):(0,p.jsx)(V.Rd9,{fontSize:18,className:av.Z.themeIconLight}),size:"small",color:"secondary","aria-label":"close"})})]})},ag=e=>{var{value:t,onChange:n,customClassNames:o,testId:r,disabled:a,disabledTooltip:i}=e,{getNodeSetterId:l}=(0,u.FCD)(),{setFullscreenPanel:s}=(0,tL.Tk)();return(0,p.jsx)("div",{className:J()({[o]:o}),"data-testid":r,children:(0,p.jsx)(R.u,{content:a?i:"Edit JSON",children:(0,p.jsx)(R.hU,{"data-testid":l("body-json-import-btn"),className:J()("!block",{[av.Z.importButton]:!0,[av.Z.importButtonDisabled]:a}),size:"small",color:"highlight",disabled:a,icon:(0,p.jsx)(V.JAz,{className:av.Z.buttonIcon}),onClick:e=>{e.stopPropagation(),s((0,p.jsx)(af,{value:t,onChange:n,onClose:()=>{s(null)},id:"import-json"}))},children:(0,p.jsx)("span",{style:{fontSize:12,fontWeight:500,lineHeight:"16px"},children:"Edit JSON"})})})})},ah=(0,nQ.Q2)(()=>{var{value:e,onChange:t,onBlur:n,readonly:o}=(0,nQ.U$)();return(0,p.jsx)(ag,{value:e,onChange:t,onBlur:n,disabled:o})}),a_=(0,nQ.Q2)(()=>{var{value:e,errors:t,readonly:n}=(0,nQ.U$)(),{isDarkTheme:o}=(0,as.uU)();return(0,p.jsx)(t1.LN,{name:"http-field-json-container",className:av.Z["json-editor-container"],isError:!n&&!!(null==t?void 0:t.length),children:(0,p.jsx)(tF.KU,{children:(0,p.jsx)(am,{name:"http-field-json-editor",placeholder:_.o.t("node_http_json_input"),value:e,minHeight:78,readonly:!0,borderRadius:8,isDarkTheme:o})})})}),ay=(0,nQ.Q2)(e=>{var{value:t,onChange:n,onBlur:o,errors:r}=(0,nQ.U$)(),{fullscreenPanel:a,setFullscreenPanel:i}=(0,tL.Tk)(),l=e=>{a&&e!==rj.eA.Json&&i(null),n(e)};return(0,p.jsx)(R.Ph,(0,D._)((0,c._)({},e),{value:t,onChange:e=>l(e),onBlur:o,hasError:r&&r.length>0}))}),ax=e=>{var{setterName:t}=e,n=(0,T.j)(),{getNodeSetterId:o}=(0,u.FCD)(),r=(0,O.useMemo)(()=>Object.keys(rj.eA).map(e=>({label:_.o.t(rj.pt[rj.eA[e]]),value:rj.eA[e]})),[]),a=(0,nQ.qo)("".concat(t,".bodyType")),i=(0,O.useMemo)(()=>"".concat(t,".bodyData.").concat(rj.CH[a]),[t,a]),l=(0,O.useMemo)(()=>{if(a===rj.eA.FormData||a===rj.eA.FormUrlEncoded)return n?[]:[(0,p.jsx)(nQ.F2,{name:i,children:e=>{var{append:t}=e;return(0,p.jsx)(nQ.HS,{onClick:()=>t({name:"",type:u.owu.String,input:{type:u.YX3.LITERAL,content:""}})})}},i)];if(a===rj.eA.Json)return n?[(0,p.jsx)(nQ.gN,{name:i,children:e=>{var{value:t}=e;return(0,p.jsx)(tP.q,{value:t})}})]:[(0,p.jsx)(ah,{name:i,hasFeedback:!1})];if(a===rj.eA.RawText)return n?[(0,p.jsx)(nQ.gN,{name:i,children:e=>{var{value:t}=e;return(0,p.jsx)(tP.q,{value:t})}})]:[];return[]},[i,a]);return(0,p.jsx)(nQ.$0,{title:_.o.t("node_http_body"),tooltip:_.o.t("node_http_body_desc"),actions:l,children:(0,p.jsxs)("div",{className:"flex flex-col",children:[(0,p.jsx)(ay,{defaultValue:rj.eA.Empty,name:"".concat(t,".bodyType"),size:"small","data-testid":o("body-type-select"),optionList:r,disabled:n,style:{width:"100%",borderColor:"var(--Stroke-COZ-stroke-plus, rgba(84, 97, 156, 0.27))",marginBottom:"8px"}}),a===rj.eA.Json&&(0,p.jsx)(a_,{name:i}),a===rj.eA.FormData&&(0,p.jsx)(n3.N0,{fieldEditable:!n,columns:r3,name:i,disabledTypes:u.owu.getComplement([u.owu.String,u.owu.File,u.owu.Image,u.owu.Video,u.owu.Svg,u.owu.Txt,u.owu.Doc,u.owu.Excel,u.owu.Ppt,u.owu.Zip,u.owu.Code])}),a===rj.eA.FormUrlEncoded&&(0,p.jsx)(n3.N0,{fieldEditable:!n,hiddenTypes:!0,columns:r3,name:i,inputType:u.owu.String}),a===rj.eA.RawText&&(0,p.jsx)(aa,{name:i,minHeight:78,placeholder:_.o.t("node_http_raw_text_input")}),a===rj.eA.Binary&&(0,p.jsx)(n3.se,{inputType:u.owu.File,availableFileTypes:[u.owu.File,u.owu.Image,u.owu.Video,u.owu.Svg,u.owu.Txt,u.owu.Doc,u.owu.Excel,u.owu.Ppt,u.owu.Zip,u.owu.Code],disabledTypes:u.owu.getComplement([u.owu.File,u.owu.Image,u.owu.Video,u.owu.Svg,u.owu.Txt,u.owu.Doc,u.owu.Excel,u.owu.Ppt,u.owu.Zip,u.owu.Code,u.owu.ArrayFile]),name:"".concat(i,".fileURL")})]})})},aw=n("789541"),ab=(0,nQ.Q2)(e=>{var{readonly:t}=e,{value:n,onChange:o}=(0,nQ.U$)(),{getNodeSetterId:r}=(0,u.FCD)(),a=[{label:"Header",value:rj.bD.Header},{label:"Query",value:rj.bD.Query}];return(0,p.jsxs)("div",{className:"flex items-center pl-[4px] gap-[4px] mt-[6px]",children:[(0,p.jsx)("div",{style:{flex:2},children:(0,p.jsx)(aw.Z,{label:"Add To"})}),(0,p.jsx)("div",{style:{flex:3},children:(0,p.jsx)(R.Ph,{size:"small","data-testid":r("auth-add-to-select"),optionList:a,value:n,disabled:t,style:{width:"100%",borderColor:"var(--Stroke-COZ-stroke-plus, rgba(84, 97, 156, 0.27))"},onChange:e=>o(e)})})]})}),aj=e=>{var{setterName:t}=e,n=(0,O.useRef)(null),{getNodeSetterId:o}=(0,u.FCD)(),r=(0,T.j)(),a=(0,O.useMemo)(()=>[rj.Gr.Bearer,rj.Gr.Custom].map(e=>({label:_.o.t(rj.pY[e]),value:e})),[]),i=(0,nQ.qo)("".concat(t,".authType")),l=(0,nQ.qo)("".concat(t,".authOpen"));(0,O.useEffect)(()=>{var e,t;l?null===(e=n.current)||void 0===e||e.open():null===(t=n.current)||void 0===t||t.close()},[l]);var s=(0,O.useMemo)(()=>i===rj.Gr.Custom?"".concat(t,".authData.").concat(rj.dc[i],".data"):"".concat(t,".authData.").concat(rj.dc[i]),[i,t]),d={[rj.Gr.BasicAuth]:[{name:"username",type:u.owu.String,input:{type:u.YX3.LITERAL,content:""}},{name:"password",type:u.owu.String,input:{type:u.YX3.LITERAL,content:""}}],[rj.Gr.Bearer]:[{name:"token",type:u.owu.String,input:{type:u.YX3.LITERAL,content:""}}],[rj.Gr.Custom]:[{name:"Key",type:u.owu.String,input:{type:u.YX3.LITERAL,content:""}},{name:"Value",type:u.owu.String,input:{type:u.YX3.LITERAL,content:""}}]};return(0,p.jsx)(nQ.$0,{ref:n,title:_.o.t("node_http_auth"),tooltip:_.o.t("node_http_auth_desc"),actions:[(0,p.jsx)(nQ.KV,{name:"".concat(t,".authOpen"),defaultValue:!1,size:"mini"})],isEmpty:!l,emptyText:_.o.t("http_node_auth_notopen"),children:(0,p.jsxs)("div",{className:"flex flex-col",children:[(0,p.jsx)(nQ.mg,{name:"".concat(t,".authType"),size:"small","data-testid":o("auth-type-select"),optionList:a,style:{width:"100%",borderColor:"var(--Stroke-COZ-stroke-plus, rgba(84, 97, 156, 0.27))",marginBottom:"8px"}}),(0,p.jsx)("div",{className:"pl-[4px]",children:(0,p.jsx)(n3.N0,{defaultValue:d[i],name:s,deps:["".concat(t,".authType")],nameReadonly:!0,hiddenTypeTag:!0,fieldEditable:!1,hiddenRemove:!0,hiddenTypes:!0,inputType:u.owu.String},i)}),i===rj.Gr.Custom&&(0,p.jsx)(ab,{deps:["".concat(t,".authType")],defaultValue:rj.bD.Header,name:"".concat(t,".authData.").concat(rj.dc[i],".addTo"),readonly:r})]})})},ak=()=>(0,p.jsxs)(n1.X_,{children:[(0,p.jsx)(ap,{}),(0,p.jsx)(n3.ko,{name:"inputs.params",title:_.o.t("node_http_request_params"),tooltip:_.o.t("node_http_request_params_desc"),hiddenTypes:!0,defaultValue:[],columns:r3,inputType:u.owu.String}),(0,p.jsx)(n3.ko,{name:"inputs.headers",title:_.o.t("node_http_headers"),tooltip:_.o.t("node_http_headers_desc"),hiddenTypes:!0,defaultValue:[],columns:r3,defaultAppendValue:{name:"",type:u.owu.String,input:{type:u.YX3.LITERAL,content:""}},inputType:u.owu.String}),(0,p.jsx)(aj,{setterName:"inputs.auth"}),(0,p.jsx)(ax,{setterName:"inputs.body"}),(0,p.jsx)(nQ.$0,{title:_.o.t("node_http_timeout_setting"),children:(0,p.jsx)(nQ.nk,{name:"inputs.setting.timeout",defaultValue:120,max:180,min:0,className:"w-full",style:{height:"24px",borderColor:"var(--Stroke-COZ-stroke-plus, rgba(84, 97, 156, 0.27))"}})}),(0,p.jsx)(nQ.$0,{title:_.o.t("node_http_retry_count"),children:(0,p.jsx)(nQ.nk,{name:"inputs.setting.retryTimes",defaultValue:3,max:10,min:0,className:"w-full",style:{height:"24px",borderColor:"var(--Stroke-COZ-stroke-plus, rgba(84, 97, 156, 0.27))"}})}),(0,p.jsx)(n3.Nn,{title:_.o.t("workflow_detail_node_output"),tooltip:_.o.t("node_http_response_data"),id:"database-node-outputs",name:"outputs",topLevelReadonly:!0,disabledTypes:[u.owu.Object,u.owu.ArrayBoolean,u.owu.ArrayObject,u.owu.ArrayInteger,u.owu.ArrayNumber,u.owu.ArrayString],customReadonly:!0})]}),aN=(e,t,n)=>{var{node:o}=t,{required:r=!0,emptyMessage:a,invalidMessage:i}=n,l=null==e?void 0:e.match(/{{([^}]+)}}/g),s=null==l?void 0:l.map(e=>e.replace(/^{{|}}$/g,"")),d=!1;return(null==s||s.forEach(e=>{var{fieldKeyPath:t}=(0,rk.oW)(e);!o.context.variableService.getWorkflowVariableByKeyPath(t,{node:o})&&(d=!0)}),r&&!e)?a:d?i:void 0},aS=/^(?!.*\b(true|false|and|AND|or|OR|not|NOT|null|nil|If|Switch)\b)[a-zA-Z_][-a-zA-Z_$0-9]*$/,aC=_.o.t("node_http_name_rule");var aI={render:()=>(0,p.jsx)(ak,{}),validateTrigger:m.C$.onBlur,validate:(0,c._)({nodeMeta:h.O,"inputs.apiInfo.url":e=>{var{value:t,context:n}=e;return(0,rI.Z)(t)&&(null==t?void 0:t.length)>1e4?_.o.t("node_http_url_length_limit"):aN(t,n,{emptyMessage:_.o.t("node_http_url_required"),invalidMessage:_.o.t("node_http_url_invalid_var")})},"inputs.headers.*.name":(0,eH.e)({getNames:e=>{var{formValues:t}=e;return((0,w.Z)(t,"inputs.headers")||[]).map(e=>e.name)},validatorConfig:{rule:aS,errorMessage:aC}}),"inputs.headers.*.input":(0,k.v)({required:!1}),"inputs.params.*.name":(0,eH.e)({getNames:e=>{var{formValues:t}=e;return((0,w.Z)(t,"inputs.params")||[]).map(e=>e.name)},validatorConfig:{rule:aS,errorMessage:aC}}),"inputs.params.*.input":(0,k.v)({required:!1}),"inputs.body.bodyData.json":(l=(0,nS._)(function*(e){var{value:t,formValues:n,context:o}=e;return(0,w.Z)(n,"inputs.body.bodyType")!==rj.eA.Json?void 0:(yield rT.AV.languageService.validate(null!=t?t:"",{transform:e=>{var t=function(e,t){var n=new RegExp(t,t.flags.includes("g")?t.flags:"".concat(t.flags,"g")),o=[];for(var r of e.matchAll(n)){if(void 0!==r.index)o.push({match:r[0],range:[r.index,r.index+r[0].length]})}return o}(e.toString(),/\{\{([^\}]*)\}\}/g);return t.length>0&&t.forEach(t=>{var{range:n}=t;e.replaceRange(n[0],n[1],"null")}),e}})).length>0?_.o.t("workflow_json_syntax_error",{},"JSON 语法错误"):aN(t,o,{emptyMessage:_.o.t("node_http_json_required"),invalidMessage:_.o.t("node_http_json_invalid_var")})}),function(e){return l.apply(this,arguments)}),"inputs.body.bodyData.rawText":e=>{var{value:t,formValues:n,context:o}=e;if((0,w.Z)(n,"inputs.body.bodyType")===rj.eA.RawText)return aN(t,o,{required:!1,emptyMessage:"",invalidMessage:_.o.t("node_http_raw_text_invalid_var")})},"inputs.body.bodyData.formData.*.name":e=>{var{value:t,formValues:n,context:o,name:r}=e;if((0,w.Z)(n,"inputs.body.bodyType")===rj.eA.FormData)return(0,eH.e)({getNames:e=>{var{formValues:t}=e,n=(0,w.Z)(t,"inputs.body.bodyData.formData");return null==n?void 0:n.map(e=>e.name)},validatorConfig:{rule:aS,errorMessage:aC}})({value:t,formValues:n,context:o,name:r})},"inputs.body.bodyData.formData.*.input":e=>{var{value:t,formValues:n,context:o}=e,{node:r,playgroundContext:a}=o;if((0,w.Z)(n,"inputs.body.bodyType")===rj.eA.FormData)return(0,rP.s)({value:t,playgroundContext:a,node:r,required:!1})},"inputs.body.bodyData.formURLEncoded.*.name":e=>{var{value:t,formValues:n,context:o,name:r}=e;if((0,w.Z)(n,"inputs.body.bodyType")===rj.eA.FormUrlEncoded)return(0,eH.e)({getNames:e=>{var{formValues:t}=e,n=(0,w.Z)(t,"inputs.body.bodyData.formURLEncoded");return null==n?void 0:n.map(e=>e.name)},validatorConfig:{rule:aS,errorMessage:aC}})({value:t,formValues:n,context:o,name:r})},"inputs.body.bodyData.formURLEncoded.*.input":e=>{var{value:t,formValues:n,context:o}=e,{node:r,playgroundContext:a}=o;if((0,w.Z)(n,"inputs.body.bodyType")===rj.eA.FormUrlEncoded)return(0,rP.s)({value:t,playgroundContext:a,node:r,required:!1})}},(s={},Object.keys(rj.Gr).forEach(e=>{s["inputs.auth.authData.".concat(rj.dc[rj.Gr[e]]+("Custom"===e?".data.*.input":".*.input"))]=t=>{var{value:n,formValues:o,context:r}=t,a=(0,w.Z)(o,"inputs.auth.authOpen"),i=(0,w.Z)(o,"inputs.auth.authType");if(!!a&&i===rj.Gr[e]){var{playgroundContext:l,node:s}=r;return(0,rP.s)({value:n,playgroundContext:l,node:s,required:!0})}}}),s)),effect:{nodeMeta:em.J,outputs:ev.m},formatOnInit:(e,t)=>{var n,{playgroundContext:o,node:r}=t,{variableService:a}=o,{inputs:i={apiInfo:{method:rj.w$.GET,url:void 0},body:{bodyType:rj.eA.Empty,bodyData:void 0},headers:void 0,params:void 0,auth:{authType:rj.Gr.Bearer,authData:{customData:{data:void 0,addTo:rj.bD.Header},basicAuthData:void 0,bearerTokenData:void 0}},setting:{timeout:120,retryTimes:3}},outputs:l}=e||{},s={nodeMeta:null==e?void 0:e.nodeMeta,inputParameters:[],inputs:i,outputs:(0,eF.Z)(l)?[{key:(0,ez.x0)(),type:u.owu.String,name:"body"},{key:(0,ez.x0)(),type:u.owu.Integer,name:"statusCode"},{key:(0,ez.x0)(),type:u.owu.String,name:"headers"}]:l},d=(0,w.Z)(s,"inputs.headers");if(d){var c=d.map(e=>({name:e.name,type:u.Rkg.string,input:e.input})),p=g.N.inputTypeValueDTOToVO(c,a,{node:r});(0,v.Z)(s,"inputs.headers",p)}var m=(0,w.Z)(e,"inputs.params");if(m){var f=m.map(e=>({name:e.name,type:u.Rkg.string,input:e.input})),h=g.N.inputTypeValueDTOToVO(f,a,{node:r});(0,v.Z)(s,"inputs.params",h)}var _="inputs.auth.authData";["basicAuthData","customData.data","bearerTokenData"].forEach(e=>{var t=(0,w.Z)(s,"".concat(_,".").concat(e));if(t){var n=t.map(e=>({name:e.name,type:g.N.DTOTypeToViewType(e.type),input:g.N.valueExpressionToVO(e.input,a)}));(0,v.Z)(s,"".concat(_,".").concat(e),n)}});var y="inputs.body.bodyData",x="formURLEncoded",b=(0,w.Z)(s,"".concat(y,".").concat(x));if(b){var j=b.map(e=>({name:e.name,type:u.Rkg.string,input:e.input}));(0,v.Z)(s,"".concat(y,".").concat(x),g.N.inputTypeValueDTOToVO(j,a,{node:r}))}var k="formData",N=(0,w.Z)(s,"".concat(y,".").concat(k));if(N){var{data:S=[],typeMapping:C="{}"}=N,I=JSON.parse(C),T=null==S?void 0:S.map(e=>{var t,n,o,r,i,l,s=r8[(0,w.Z)(I,"".concat(e.name,".basicType"))];return(null===(o=e.input)||void 0===o?void 0:null===(n=o.value)||void 0===n?void 0:null===(t=n.rawMeta)||void 0===t?void 0:t.type)&&(s=null===(l=e.input)||void 0===l?void 0:null===(i=l.value)||void 0===i?void 0:null===(r=i.rawMeta)||void 0===r?void 0:r.type),{name:e.name,type:s,input:g.N.valueExpressionToVO(e.input,a)}});(0,v.Z)(s,"".concat(y,".").concat(k),T)}var P="binary.fileURL",D=(0,w.Z)(s,"".concat(y,".").concat(P)),E=g.N.inputValueToVO({name:"fileURL",input:D},a);return(0,v.Z)(s,"".concat(y,".").concat(P),null!==(n=null==E?void 0:E.input)&&void 0!==n?n:{type:"literal",content:""}),s},formatOnSubmit:(e,t)=>{var n,o=(0,c._)({},e),{node:r,playgroundContext:a}=t,{variableService:i}=a,l=(0,w.Z)(e,"inputs.headers");if(l){var s=g.N.inputTypeValueVOToDTO(l,i,{node:r}).map(e=>({name:e.name,input:e.input}));(0,v.Z)(o,"inputs.headers",s)}var d=(0,w.Z)(e,"inputs.params");if(d){var p=g.N.inputTypeValueVOToDTO(d,i,{node:r}).map(e=>({name:e.name,input:e.input}));(0,v.Z)(o,"inputs.params",p)}var m="inputs.auth.authData";["basicAuthData","customData.data","bearerTokenData"].forEach(e=>{var t=(0,w.Z)(o,"".concat(m,".").concat(e));if(t){var n=g.N.inputTypeValueVOToDTO(t,i,{node:r});(0,v.Z)(o,"".concat(m,".").concat(e),n)}});var f="inputs.body.bodyData",h="formURLEncoded",_=(0,w.Z)(o,"".concat(f,".").concat(h));if(_){var y=g.N.inputTypeValueVOToDTO(_,i,{node:r}).map(e=>({name:e.name,input:e.input}));(0,v.Z)(o,"".concat(f,".").concat(h),y)}var x="formData",b=(0,w.Z)(o,"".concat(f,".").concat(x));if(b){var j,k={data:[],typeMapping:{}};null==b||b.forEach(e=>{k.data.push({name:e.name,input:g.N.valueExpressionToDTO(e.input,i,{node:r})}),(0,v.Z)(k.typeMapping,e.name,{basicType:r9[e.type]})}),(0,v.Z)(o,"".concat(f,".").concat(x),(0,D._)((0,c._)({},k),{typeMapping:JSON.stringify(null!==(j=k.typeMapping)&&void 0!==j?j:{})}))}var N="binary.fileURL",S={fileURL:{type:"string",schema:[],assistType:u.owu.String,value:{type:"literal",content:"",rawMeta:{type:u.owu.File}}}},C=null!==(n=(0,w.Z)(o,"".concat(f,".").concat(N)))&&void 0!==n?n:S;if(C){var I=g.N.valueExpressionToDTO(C,i,{node:r});(0,v.Z)(o,"".concat(f,".").concat(N),I)}return o}},aT={type:u.nyy.Http,meta:{nodeDTOType:u.nyy.Http,style:{width:360},size:{width:360,height:130.7},nodeMetaPath:eu.je,outputsPath:eu.G0,test:{generateFormInputProperties(e){var t,n,o,r,a=e.getData(m.Ps).formModel.getFormItemValueByPath("/"),i=null===(n=a.inputs)||void 0===n?void 0:null===(t=n.apiInfo)||void 0===t?void 0:t.url,l=(null==a?void 0:null===(o=a.inputs)||void 0===o?void 0:o.params)||[],s=(null==a?void 0:null===(r=a.inputs)||void 0===r?void 0:r.headers)||[];return(0,c._)({},rN(i,{node:e,labelPrefix:_.o.t("node_http_api"),namePrefix:"__apiInfo_url_"}),(0,ec.ee)(l.map(e=>(0,D._)((0,c._)({},e),{name:"__params_".concat(rb()(e.name)),title:"".concat(_.o.t("node_http_request_params"),"-").concat(e.name)})),{node:e}),(0,ec.ee)(s.map(e=>(0,D._)((0,c._)({},e),{name:"__headers_".concat(rb()(e.name)),title:"".concat(_.o.t("node_http_headers"),"-").concat(e.name)})),{node:e}),rS(e),rC(e))}},helpLink:"/open/docs/guides/http_node"},formMeta:aI},aP=n("43519"),aD=n("563440"),aE=n("136515"),aO=[{label:"16:9 (1024*576)",value:{width:1024,height:576}},{label:"3:2 (1024*682)",value:{width:1024,height:682}},{label:"4:3 (1024*768)",value:{width:1024,height:768}},{label:"1:1 (1024*1024)",value:{width:1024,height:1024}},{label:"3:4 (768*1024)",value:{width:768,height:1024}},{label:"2:3 (682*1024)",value:{width:682,height:1024}},{label:"9:16 (576*1024)",value:{width:576,height:1024}}],aL=(0,nQ.Q2)(()=>{var{value:e,readonly:t,onChange:n}=(0,nQ.U$)();return(0,p.jsx)(nI.CA,{value:e,onChange:n,readonly:t,minWidth:512,maxWidth:1536,minHeight:512,maxHeight:1536,options:aO,layoutStyle:"vertical"})}),aM=n("169198"),aF=n("557415"),aZ=n("341457"),aR=n("804430"),aV=n("559848"),aA=n("621165"),az=n("436599"),aB=[n("330851"),az,aA,aV,aR,aZ,aF,aM],aU=e=>(0,p.jsx)(n1.rG,(0,c._)({options:[1,8,2,3,4,5,6,7].map(e=>({label:_.o.t("Imageflow_model".concat(e)),value:e,thumbnail:aB[e-1]}))},e)),aq=e=>{var{name:t}=e;return(0,p.jsx)(nQ.$0,{title:_.o.t("Imageflow_model_deploy"),children:(0,p.jsxs)("div",{className:"flex flex-col gap-[8px]",children:[(0,p.jsx)(aU,{name:"".concat(t,".model"),layout:"vertical",label:_.o.t("Imageflow_model")}),(0,p.jsx)(aL,{name:"".concat(t,".custom_ratio"),layout:"vertical",label:_.o.t("Imageflow_ratio"),tooltip:_.o.t("Imageflow_size_range")}),(0,p.jsx)(nQ.RW,{name:"".concat(t,".ddim_steps"),layout:"vertical",label:_.o.t("Imageflow_generate_standard"),tooltip:_.o.t("imageflow_generation_desc1"),min:1,max:40,step:1})]})})},aW={weight:.7},aG=n("893387"),aH=n("651934"),a$=n("446179"),aJ=n("724974"),aY=n("536793"),aQ=n("404921"),aX=[n("32053"),aQ,aY,aJ,a$,aH,aG],aK=(0,nQ.lw)(()=>{var{name:e,value:t,append:n,remove:o}=(0,nQ.Dq)(),r=(0,O.useMemo)(()=>(null==t?void 0:t.map(e=>e.preprocessor).filter(e=>void 0!==e))||[],[t]);return(0,p.jsxs)(nQ.$0,{title:_.o.t("Imageflow_reference_image"),actions:[(0,p.jsx)(nQ.HS,{onClick:()=>n(aW),disabled:t&&(null==t?void 0:t.length)>=5},"add")],children:[(0,p.jsx)(nQ.az,{columns:[{label:_.o.t("Imageflow_reference_info1"),style:{width:120}},{label:_.o.t("Imageflow_reference_info2"),style:{width:150}},{label:_.o.t("Imageflow_reference_info3")}]}),(0,p.jsx)(nQ.F3,{children:null==t?void 0:t.map((t,n)=>{var a="".concat(e,".").concat(n,".preprocessor"),i="".concat(e,".").concat(n,".url"),l="".concat(e,".").concat(n,".weight"),s=function(e){var{currentPreprocessor:t,allSelectedPreprocessor:n=[]}=e;return[1,2,3,4,5,7,6].map(e=>({label:_.o.t("Imageflow_reference".concat(e)),value:e,tooltip:_.o.t("imageflow_reference_desc".concat(e)),thumbnail:aX[e-1],disabled:function(e){var{currentItemPreprocessor:t,currentOptionPreprocessor:n,allSelectedPreprocessor:o}=e,r=!1;(o=o.filter(e=>!(e===t&&t===n))).includes(n)&&(r=!0);var a=[1,2,3,4];return a.includes(n)&&2===o.filter(e=>a.includes(e)).length&&(r=!0),r}({currentItemPreprocessor:t,currentOptionPreprocessor:e,allSelectedPreprocessor:n})}))}({currentPreprocessor:t.preprocessor,allSelectedPreprocessor:r});return(0,p.jsxs)(nQ.y1,{onRemove:()=>o(n),children:[(0,p.jsx)("div",{className:"flex-[2_1_0%] min-w-[0px] max-w-[120px]",children:(0,p.jsx)(n1.rG,{name:a,options:s,showClear:!0,placeholder:_.o.t("Imageflow_mode_choose")})}),(0,p.jsx)("div",{className:"w-[150px]",children:(0,p.jsx)(n3.se,{name:i,inputType:u.owu.Image,selectStyle:{width:80}})}),(0,p.jsx)("div",{className:"w-full",children:(0,p.jsx)(nQ.nk,{name:l,min:0,max:1,step:.1})})]})})})]})}),a0=(0,nQ.Q2)(()=>{var{name:e}=(0,nQ.U$)(),t="".concat(e,".prompt"),n="".concat(e,".negative_prompt"),o=e.replace("inputs.",""),r=e.replace("inputs.","");return(0,p.jsxs)(nQ.$0,{title:_.o.t("Imageflow_prompt"),tooltip:_.o.t("imageflow_generation_desc4"),children:[(0,p.jsx)(n1.vQ,{name:t,testIDSuffix:o,label:_.o.t("Imageflow_positive"),placeholder:_.o.t("Imageflow_positive_placeholder"),required:!0,layout:"vertical"}),(0,p.jsx)(n1.vQ,{name:n,testIDSuffix:r,label:_.o.t("Imageflow_negative"),placeholder:_.o.t("Imageflow_negative_placeholder"),layout:"vertical"})]})},{hasFeedback:!1}),a1=(0,oP.m)(()=>((function(e){var t,{values:n}=(0,nQ.cI)(),o=(0,aD.Z)(null==n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.references);(0,aE.Z)(()=>{var t,r,a=null==n?void 0:null===(r=n.inputs)||void 0===r?void 0:null===(t=r.references)||void 0===t?void 0:t.map(e=>e.preprocessor),i=null==o?void 0:o.map(e=>e.preprocessor);!((null==a?void 0:a.length)===(null==i?void 0:i.length)&&(null==a?void 0:a.every((e,t)=>e===(null==i?void 0:i[t]))))&&e()},[n])})((0,nQ.nW)("inputs.modelSetting.model")),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(aq,{name:"inputs.modelSetting"}),(0,p.jsx)(aK,{name:"inputs.references"}),(0,p.jsx)(n3.Go,{name:"inputs.inputParameters"}),(0,p.jsx)(a0,{name:"inputs.prompt"}),(0,p.jsx)(n3.Nn,{name:"outputs",readonly:!0})]}))),a2={render:()=>(0,p.jsx)(a1,{}),validateTrigger:m.C$.onChange,validate:{nodeMeta:h.O,"inputs.modelSetting.model":e=>{var t,{value:n,formValues:o}=e,r=(null==o?void 0:null===(t=o.inputs)||void 0===t?void 0:t.references)||[],a={1:[4,5,6],8:[1,2,3,4,5,6,7],3:[7],6:[6,7]}[n]||[];for(var i of r)if(a.includes(null==i?void 0:i.preprocessor))return _.o.t("Imageflow_not_support")},"inputs.prompt.prompt":e=>{var{value:t}=e;if(!t)return _.o.t("workflow_detail_node_error_empty")}},effect:{nodeMeta:rs.Jr,outputs:rs.mw},defaultValues:()=>({inputs:{modelSetting:{model:1,custom_ratio:{width:1024,height:1024},ddim_steps:25},references:[],prompt:{prompt:"",negative_prompt:""},inputParameters:[]},outputs:[{key:(0,ez.x0)(),name:"data",type:u.owu.Image},{key:(0,ez.x0)(),name:"msg",type:u.owu.String}]}),formatOnInit(e,t){var{node:n}=t,o=n.getService(eV._y),r=(0,w.Z)(e,"inputs.references")||[];return(0,v.Z)(e,"inputs.references",r.map(e=>(0,D._)((0,c._)({},e),{url:o.toVO(e.url)}))),e},formatOnSubmit(e,t){var{node:n}=t,o=n.getService(eV._y),r=(0,w.Z)(e,"inputs.references")||[];return(0,v.Z)(e,"inputs.references",r.map(e=>(0,D._)((0,c._)({},e),{url:o.toDTO(e.url)}))),e}},a4={type:u.nyy.ImageGenerate,width:508,meta:{nodeDTOType:u.nyy.ImageGenerate,test:{generateFormInputProperties(e){var t,n=e.getData(m.Ps).formModel.getFormItemValueByPath("/"),o=(null==n?void 0:n.inputParameters)||(null==n?void 0:n.inputs.inputParameters)||[],r=((null==n?void 0:n.references)||(null==n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.references)||[]).filter(e=>e.preprocessor).map(e=>({name:"__image_references_".concat(e.preprocessor),title:_.o.t("Imageflow_reference".concat(e.preprocessor)),input:e.url}));return(0,c._)({},(0,ec.ee)(r,{node:e}),(0,ec.ee)(o,{node:e}))}},helpLink:"/open/docs/guides/image_generation_node"},formMeta:a2},a6={type:u.nyy.ImageReference,meta:{nodeDTOType:u.nyy.ImageReference},formMeta:()=>{throw Error(_.o.t("workflow_node_invalid"))}},a5=n("986999"),a3=n("399163"),a8=n("253313"),a9=n("455262"),a7=n("537916"),ie="USER_RESPONSE",it="optionId",io="optionContent",ir=[ie,it,io],ia=[{key:(0,m.x0)(),name:ie,type:u.owu.String,required:!0,description:_.o.t("workflow_ques_ans_type_direct_key_decr",{},"用户本轮对话输入内容")}],ii=[{key:(0,m.x0)(),name:"output",type:u.owu.String,required:!0}],il=[{key:(0,m.x0)(),name:it,type:u.owu.String,required:!1},{key:(0,m.x0)(),name:io,type:u.owu.String,required:!1}],is=n("315703"),id=(0,nQ.Q2)(e=>{var{value:t,onChange:n,readonly:o}=(0,nQ.U$)();return(0,p.jsx)(is.G,(0,c._)({value:t,onChange:n,readonly:!!o},e))}),iu=n("571526"),ic=()=>{var{getNodeSetterId:e}=(0,u.FCD)(),t=(0,T.j)(),n=(0,nQ.qo)({name:"llmParam.systemPrompt"}),o=_.o.t("workflow_ques_ans_type_direct_exrtact_title",{},"Extract variables from user's response.");return(0,p.jsxs)("div",{className:"flex flex-col w-full mb-2",children:[(0,p.jsx)(R.iz,{margin:"12px"}),(0,p.jsxs)("div",{className:"flex w-full justify-between items-center",children:[(0,p.jsx)(R.ZT.Text,{className:"mr-[6px] text-xs",ellipsis:{showTooltip:{opts:{content:o}}},style:{maxWidth:"calc(100% - 24px)",color:"#1C1F23"},children:o}),(0,p.jsx)(R.J2,{autoAdjustOverflow:!1,className:iu.Z["limit-wrapper"],trigger:"click",position:"topRight",content:(0,p.jsxs)("div",{className:iu.Z["sys-popover-content"],children:[(0,p.jsxs)("div",{className:"flex items-center mb-[4px]",children:[(0,p.jsx)("span",{className:iu.Z["content-title"],children:_.o.t("workflow_ques_ans_type_direct_exrtact_context_setting",{},"Maximum dialogue rounds")}),(0,p.jsx)(R.u,{content:_.o.t("workflow_ques_ans_type_direct_context_setting_tooltips",{},"允许用户回答该问题的最多次数，当从用户的多次回答中获取不到必填的关键字段时，该工作流将会终止运行。"),children:(0,p.jsx)(V.L03,{className:"text-[#A7A9B0] text-[16px] ml-1"})})]}),(0,p.jsxs)("div",{className:"w-full relative  mb-[16px]",children:[(0,p.jsx)(id,{name:"questionOutputs.limit",defaultValue:3,max:5,min:1,sliderStyle:{width:"100%"}}),(0,p.jsxs)("div",{className:"w-full flex justify-between absolute ".concat(iu.Z["slider-marks"]),children:[(0,p.jsx)("div",{children:1}),(0,p.jsx)("div",{children:5})]})]}),(0,p.jsxs)("div",{className:"flex items-center justify-between mb-[4px]",children:[(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("span",{className:iu.Z["content-title"],children:_.o.t("workflow_question_sp",{},"系统提示词")}),(0,p.jsx)(R.u,{content:_.o.t("workflow_question_sp_setting",{},"系统提示词设置"),children:(0,p.jsx)(V.L03,{className:"text-[#A7A9B0] text-[16px] ml-1"})})]}),t?(0,p.jsx)(tP.q,{value:null!=n?n:""}):null]}),(0,p.jsx)(n3.vQ,{name:"llmParam.systemPrompt",defaultValue:"",placeholder:_.o.t("workflow_question_sp_placeholder",{},"支持额外的系统提示词,如设置人设和回复逻辑,使其追问语气更加自然"),className:"!p-[4px]",containerClassName:"!bg-transparent",shouldUseContainerRef:!0})]}),children:(0,p.jsx)(R.hU,{size:"default",color:"secondary","data-testid":e("question-limit-setting"),wrapperClass:"flex justify-end",className:"!p-[4px] !max-w-[24px] !min-w-[24px] !h-[24px]",icon:(0,p.jsx)(V.qBd,{})})})]})]})},ip=()=>{var e=(0,nQ.qo)({name:"questionParams.answer_type"}),t=(0,nQ.qo)({name:"questionOutputs.extra_output"}),n="option"===e;return(0,p.jsx)(nQ.$0,{title:_.o.t("workflow_detail_node_output"),tooltip:_.o.t("workflow_ques_output_tooltips"),actions:n?[]:[(0,p.jsx)(n3.fB,{name:"questionOutputs.extra_output",defaultValue:!1,text:_.o.t("workflow_ques_ans_type_direct_checkbox",{},"从回复中提取字段"),itemTooltip:_.o.t("workflow_ques_ans_type_direct_checkbox_tooltips",{},"开启后将从用户输入中提取信息")})],children:n?(0,p.jsx)(n3.pQ,{id:"question-node-option-output",name:"questionOutputs.optionOutput",defaultValue:il}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(n3.Nn,{title:"",id:"question-node-user-output",name:"questionOutputs.userOutput",noCard:!0,jsonImport:!1,disabled:!0,allowAppendRootData:!1,topLevelReadonly:!0,withRequired:!0,hasFeedback:!1}),t?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(ic,{}),(0,p.jsx)(n3.Nn,{title:"",id:"question-node-extract-output",name:"questionOutputs.extractOutput",defaultValue:ii,hiddenTypes:[...u.vHX,u.owu.ArrayBoolean,u.owu.ArrayInteger,u.owu.ArrayNumber,u.owu.ArrayObject,u.owu.ArrayString,u.owu.Object],noCard:!0,withRequired:!0,jsonImport:!1,hasFeedback:!1})]}):null]})})},iv=n("405816"),im=n.n(iv),ig=n("801093"),ih=e=>"branch_".concat(e),i_=n("58946"),iy=n("562129"),ix=(0,nQ.Q2)(e=>{var{showOptionName:t,optionPlaceholder:n,optionIndex:o,movePostion:r,onItemDelete:a,answerOptions:i}=e,{value:l,onChange:s,onBlur:d,readonly:u,errors:c}=(0,nQ.U$)();return(0,O.useEffect)(()=>{((null==r?void 0:r.start)===o||(null==r?void 0:r.end)===o)&&(null==d||d())},[r]),(0,p.jsxs)("div",{className:"w-full",children:[(0,p.jsx)(nQ.TR,{sortableID:(0,i_.n)(o),index:o,containerClassName:"items-center",hanlderClassName:"!p-0",children:(0,p.jsxs)(nQ.y1,{className:"!pt-[0px] items-center",containerClassName:"items-center",removeIconClassName:"!h-[24px] !min-w-[24px] !max-w-[24px] !p-[4px]",disableRemove:(null==i?void 0:i.length)<=1||u,onRemove:()=>{if(!((null==i?void 0:i.length)<=1)&&!u)a(o)},children:[t?(0,p.jsx)("div",{className:"break-keep w-[48px]",children:(0,i_.J)(o)}):null,(0,p.jsx)("div",{className:"items-center space-x-1 w-full min-h-[24px] leading-[24px]",children:u?(0,p.jsx)("div",{className:"w-full",children:null!=l?l:""}):(0,p.jsx)(tT.i,{name:"/questionParams/options",value:l,onChangeTrigger:"onChange",onChange:e=>null==s?void 0:s(e),onBlur:()=>{null==d||d()},isError:c&&(null==c?void 0:c.length)>0,minRows:1,placeholder:n,disableSuggestion:!1,className:"!px-[4px] !py-[2px]",containerClassName:iy.Z["answer-editor"]})})]})},o),(0,p.jsx)(G.P,{className:"pl-[68px]",errors:c})]})}),iw=e=>{var{className:t,showDisableAddTooltip:n=!0,maxItems:o=Number.MAX_SAFE_INTEGER,customDisabledAddTooltip:r,value:a,onClick:i,readonly:l,children:s,dataTestId:d}=e;return n&&(null==a?void 0:a.length)>=o?(0,p.jsx)(R.u,{content:r||_.o.t("workflow_250117_05",{maxCount:o}),children:(0,p.jsx)(nQ.HS,{className:t,children:s,dataTestId:d})}):(0,p.jsx)(nQ.HS,{className:t,disabled:l,children:s,onClick:i,dataTestId:d})},ib=e=>{var{optionPlaceholder:t,defaultOptionText:n,showTitleRow:o=!0,showOptionName:r=!0}=e,{value:a,move:i,name:l,readonly:s,onChange:d,append:c}=(0,nQ.Dq)(),v=(0,nQ.qo)({name:"questionParams.answer_type"}),m=(0,nQ.qo)({name:"questionParams.option_type"}),{getNodeSetterId:f}=(0,u.FCD)(),g=(0,L.M_)(ih),[h,y]=(0,O.useState)({}),x=(0,O.useMemo)(()=>m===a7.G.Static,[m]);if("option"===v){var w=e=>{g(e,null==a?void 0:a.length),d(im()(a,{$splice:[[e,1]]}))};return(0,p.jsx)(nQ.$0,{title:(0,p.jsx)("div",{className:"text-xs font-normal",children:_.o.t("workflow_ques_ans_type_option_label",{},"设置选项内容")}),headerClassName:"pt-[12px] !mb-[4px]",noPadding:!0,collapsible:!1,children:(0,p.jsxs)("div",{className:"w-full p-[8px] ".concat(iy.Z["parameters-wrapper"]),children:[(0,p.jsx)("div",{className:"w-full mb-[8px]",children:(0,p.jsx)(ig.of,{name:"questionParams.option_type","data-testid":f("questionParams.option_type"),type:"button",className:"w-full",buttonSize:"middle",defaultValue:a7.G.Static,options:[{label:_.o.t("workflow_question_fixed_content",{},"固定内容"),value:a7.G.Static,className:iy.Z["option-radio-group"]},{label:_.o.t("workflow_question_ dynamic_content",{},"动态内容"),value:a7.G.Dynamic,className:iy.Z["option-radio-group"]}]})}),o?(0,p.jsx)(eP.b,{columns:[{title:_.o.t("workflow_ques_ans_type_option_title"),style:{width:x?"67px":"56px"}},{title:_.o.t("workflow_ques_ans_type_option_content"),style:{flex:1}}],readonly:s,className:J()("mb-[8px]",s?iy.Z.parametersTitleReadonly:iy.Z.parametersTitle)}):null,x?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(nQ.cm,{onSortEnd:e=>{var{from:t,to:n}=e;if(!s)g(t,n),i(t,n),y({start:t,end:n})},children:(0,p.jsx)("div",{className:"w-full flex flex-col gap-[8px] text-xs leading-[24px]",children:null==a?void 0:a.map((e,n)=>(0,p.jsx)(ix,{name:"".concat(l,".").concat(n,".name"),answerOptions:a,optionPlaceholder:t,optionIndex:n,movePostion:h,showOptionName:r,hasFeedback:!1,onItemDelete:w}))})}),(0,p.jsx)(iw,{className:"w-full mt-[8px]",dataTestId:f("answer-option-add-btn"),readonly:s,onClick:()=>{c({name:""})},children:(0,p.jsx)("span",{className:"text-[12px] font-medium",children:_.o.t("workflow_question_add_option",{},"新增选项")}),value:a})]}):(0,p.jsxs)("div",{className:"flex items-center w-full text-xs mt-2",children:[(0,p.jsx)("div",{className:"break-keep mr-[4px]",style:{minWidth:x?"48px":"56px"},children:(0,p.jsx)(R.u,{trigger:"hover",content:_.o.t("workflow_question_dynamic",{},"dynamicOption"),children:(0,p.jsx)("span",{children:_.o.t("workflow_question_az",{},"A~Z")})})}),(0,p.jsx)("div",{className:"w-full items-center",children:(0,p.jsx)(n3.se,{name:"questionParams.dynamic_option",availableFileTypes:[u.owu.ArrayString],disabledTypes:u.owu.getComplement([u.owu.ArrayString])})})]}),(0,p.jsxs)("div",{className:"flex items-center w-full text-xs mt-2",children:[(0,p.jsx)("div",{className:"break-keep mr-[4px]",style:{minWidth:x?"48px":"56px",marginLeft:x?"16px":"0px"},children:_.o.t("workflow_ques_ans_type_option_other",{},"other")}),(0,p.jsx)("div",{className:"space-x-1 w-full leading-[16px]",children:n})]})]})})}},ij=e=>{var{name:t,optionPlaceholder:n,defaultOptionText:o}=e;return(0,p.jsx)(nQ.F2,{name:t,defaultValue:[{name:""},{name:""}],children:(0,p.jsx)(ib,{optionPlaceholder:n,defaultOptionText:o})})},ik=()=>(0,p.jsxs)(n1.X_,{children:[(0,p.jsx)(n3.L2,{name:"llmParam",title:_.o.t("workflow_detail_llm_model")}),(0,p.jsx)(n3.Go,{name:"inputParameters",tooltip:_.o.t("workflow_ques_input_tooltips",{},"输入需要添加到问题的参数,这些参数可以被下方的问题引用")}),(0,p.jsxs)(nQ.$0,{title:_.o.t("workflow_ques_content",{},"提问内容"),tooltip:_.o.t("workflow_ques_content_tooltips",{},"用于对用户发出提问的具体内容描述"),children:[(0,p.jsx)("div",{className:"w-full mb-[12px]",children:(0,p.jsx)(n3.vQ,{name:"questionParams.question",dataTestName:"/questionParams/question",placeholder:_.o.t("workflow_ques_content_placeholder"),className:"!p-[4px]",containerClassName:"!bg-transparent"})}),(0,p.jsx)(nQ.$0,{headerClassName:"!mb-0",title:(0,p.jsx)("div",{className:"text-xs font-normal",children:_.o.t("workflow_ques_ans_type",{},"请选择回答类型")}),noPadding:!0,collapsible:!1,children:(0,p.jsx)(n3.m8,{name:"questionParams.answer_type",defaultValue:a7.o.Text,options:{key:"questionParams.answer_type",mode:"card",direction:"vertical",customClassName:"pt-[4px] gap-y-[4px]",options:[{value:a7.o.Text,label:_.o.t("workflow_ques_ans_type_direct",{},"直接回答")},{value:a7.o.Option,label:_.o.t("workflow_ques_ans_type_option",{},"选项回答")}]}})}),(0,p.jsx)(ij,{name:"questionParams.options",optionPlaceholder:_.o.t("workflow_ans_content_placeholder",{},"可以使用{{变量名}}引入输入参数中的变量"),defaultOptionText:_.o.t("workflow_ques_ans_type_option_other_placeholder",{},"此选项对用户不可见，当用户回复无关内容时，走此分支")})]}),(0,p.jsx)(ip,{})]}),iN=e=>{var{userOutput:t,extractOutput:n,extra_output:o}=e;return o?[...t,...n]:t},iS=n("615655"),iC=e=>{var{value:t,formValues:n,context:o}=e,{node:r}=o,a=r.getData(m.Ps).getFormModel(),i=r.getData(m.QW),l=(0,w.Z)(n,"outputs");"text"===t?i.updateStaticPorts([{type:"input"},{type:"output"}]):i.updateStaticPorts([{type:"input"}]),setTimeout(()=>{var e=[];"text"===t?l&&(e=iN((0,w.Z)(n,"questionOutputs"))):e=(0,w.Z)(n,"questionOutputs.optionOutput"),l&&!(0,iS.Z)(l,e)&&a.setValueIn("outputs",e)},200)},iI=n("4450"),iT={render:()=>(0,p.jsx)(ik,{}),validateTrigger:m.C$.onBlur,validate:{nodeMeta:h.O,"inputParameters.*.name":(0,eH.e)({getNames:e=>{var{formValues:t}=e;return((0,w.Z)(t,"inputParameters")||[]).map(e=>e.name)}}),"inputParameters.*.input":(0,k.v)({required:!0}),"questionParams.question":e=>{var{value:t}=e;return t?void 0:_.o.t("workflow_detail_node_error_empty",{},"参数值不可为空")},"questionParams.options.*.name":e=>{var t,{value:n,formValues:o}=e,r=(0,w.Z)(o,"questionParams.answer_type"),a=(0,w.Z)(o,"questionParams.option_type");return"option"!==r||a!==a7.G.Static?void 0:n?(null===(t=(0,w.Z)(o,"questionParams.options").filter(e=>(null==e?void 0:e.name)===n))||void 0===t?void 0:t.length)>1?_.o.t("workflow_ques_ans_testrun_dulpicate",{},"选项内容不可重复"):void 0:_.o.t("workflow_ques_option_notempty",{},"选项内容不可为空")},"questionParams.dynamic_option":e=>{var{value:t,formValues:n,context:o}=e,{node:r,playgroundContext:a}=o,i=(0,w.Z)(n,"questionParams.answer_type"),l=(0,w.Z)(n,"questionParams.option_type");if("option"===i&&l===a7.G.Dynamic)return(0,rP.s)({value:t,playgroundContext:a,node:r,required:!0})},"questionOutputs.extractOutput":or.DJ},effect:{"questionParams.answer_type":[{effect:iC,event:m.zE.onValueChange},{effect:iC,event:m.zE.onValueInit}],"questionParams.option_type":[{effect:e=>{var{value:t,context:n}=e,{node:o}=n,r=o.getData(m.Ps).getFormModel();if(t!==a7.G.Dynamic)r.setValueIn("questionParams.dynamic_option",null)},event:m.zE.onValueChange}],questionOutputs:[{effect:e=>{var{value:t,formValues:n,context:o}=e,{node:r}=o,a=r.getData(m.Ps).getFormModel();(0,w.Z)(n,"outputs")&&a.setValueIn("outputs",iN(t))},event:m.zE.onValueChange}],nodeMeta:em.J,outputs:ev.m},formatOnInit:function(e,t){var{playgroundContext:n}=t,{variableService:o}=n,{models:r}=n,{inputs:a={},outputs:i=ia,nodeMeta:l}=e||{},{inputParameters:s=[],answer_type:d="text",dynamic_option:u,option_type:c=a7.G.Static,extra_output:p,question:v,options:m,limit:f=3}=a,h="option"===d,_=(i||[]).filter(e=>e.name===ie),y=(i||[]).filter(e=>h?!ir.includes(e.name):e.name!==ie),x=(0,w.Z)(e,"inputs.llmParam");return!x&&(x=(0,iI.Vm)(r)),{llmParam:x,nodeMeta:l,questionOutputs:{limit:f,extra_output:!h&&p,userOutput:_.length>0?_:ia,extractOutput:y.length>0?y:ii,optionOutput:il},outputs:i,inputParameters:null!=s?s:[],questionParams:{answer_type:d,question:v,options:m,option_type:c,dynamic_option:g.N.valueExpressionToVO(u,o)}}},formatOnSubmit:function(e,t){var n,{playgroundContext:o,node:r}=t,{variableService:a}=o,{models:i}=o,{llmParam:l,nodeMeta:s,inputParameters:d,questionOutputs:u,outputs:p,questionParams:v}=e,{limit:m,extra_output:f}=u,{question:h,answer_type:_,options:y,dynamic_option:x,option_type:w}=v,b=i.find(e=>e.model_type===(null==l?void 0:l.modelType));return{inputs:{llmParam:(0,D._)((0,c._)({},(0,iI.PB)(l,b)),{systemPrompt:null!==(n=null==l?void 0:l.systemPrompt)&&void 0!==n?n:""}),inputParameters:null!=d?d:[],extra_output:f,answer_type:_,option_type:w,dynamic_option:x?g.N.valueExpressionToDTO(x,a,{node:r}):null,question:h,options:y,limit:m},nodeMeta:s,outputs:p}}},iP={type:u.nyy.Question,meta:{nodeDTOType:u.nyy.Question,size:{width:eu.gu.width,height:156.7},nodeMetaPath:eu.je,outputsPath:eu.G0,useDynamicPort:!0,inputParametersPath:"/inputParameters",getLLMModelIdsByNodeJSON:e=>{var t,n,o;return null==e?void 0:null===(o=e.data)||void 0===o?void 0:null===(n=o.inputs)||void 0===n?void 0:null===(t=n.llmParam)||void 0===t?void 0:t.modelType},test:{generateFormInputProperties(e){var t=e.getData(m.Ps).formModel.getFormItemValueByPath("/"),n=null==t?void 0:t.inputParameters,o=(0,ec.ee)(n,{node:e}),r=null==t?void 0:null===(l=t.questionParams)||void 0===l?void 0:l.answer_type,a=null==t?void 0:null===(s=t.questionParams)||void 0===s?void 0:s.option_type,i={};if(r===a7.o.Option&&a===a7.G.Dynamic){var l,s,d,u=null==t?void 0:null===(d=t.questionParams)||void 0===d?void 0:d.dynamic_option;i=(0,ec.ee)([{name:"dynamic_option",input:u}],{node:e})}return(0,c._)({},o,i)}},helpLink:"/open/docs/guides/question_node"},formMeta:iT},iD=n("108080");var iE=((d={}).Concat="concat",d.Split="split",d),iO="String",iL={method:"method",concatResult:"concatResult",delimiter:"delimiter",concatChar:"concatChar",outputs:"outputs"},iM={delimiters:"delimiters",allDelimiters:"allDelimiters",allArrayItemConcatChars:"allArrayItemConcatChars",arrayItemConcatChar:"arrayItemConcatChar"},iF=[{label:_.o.t("workflow_stringprocess_node_method_concat"),value:"concat"},{label:_.o.t("workflow_stringprocess_node_method_sep"),value:"split"}],iZ={type:"object",schema:[{type:"string",name:"label",required:!0},{type:"string",name:"value",required:!0},{type:"boolean",name:"isDefault",required:!0}]},iR=[{name:"".concat(iO,"1"),input:{type:"ref"}}],iV={key:"",multiple:!1,enableCustom:!0,maxCustomLength:20,maxTagCount:4,placeholder:_.o.t("workflow_stringprocess_delimiter_option"),inputPlaceholder:_.o.t("workflow_textprocess_custom_shading")},iA={key:"",multiple:!0,enableCustom:!0,maxCustomLength:20,maxTagCount:4,placeholder:_.o.t("workflow_stringprocess_delimiter_option"),inputPlaceholder:_.o.t("workflow_stringprocess_delimiter_option")},iz=e=>e===iE.Split,iB=e=>{var t=iz(e);return[{key:(0,ez.x0)(),name:"output",type:t?u.owu.ArrayString:u.owu.String,required:!0}]},iU=e=>{var{name:t}=e,n=(0,T.j)(),{getNodeSetterId:o}=(0,u.FCD)();return(0,p.jsxs)("div",{className:"flex justify-between align-items",children:[(0,p.jsx)("div",{className:"font-semibold text-[12px] leading-[24px]",children:_.o.t("workflow_stringprocess_node_method")}),(0,p.jsx)("div",{children:(0,p.jsx)(nQ.mg,{name:t,readonly:n,defaultValue:iE.Concat,optionList:iF,"data-testid":o("text-method-select")})})]})},iq=(e,t)=>Array.isArray(e)?(0===e.length?0:Math.max(...e.map(e=>{var n;return Number(null!==(n=null==e?void 0:e.split(t)[1])&&void 0!==n?n:0)}).filter(e=>!isNaN(e))))+1:1,iW=(0,nQ.lw)(e=>{var{children:t,minItems:n=0,inputType:o,disabledTypes:r,maxItems:a=Number.MAX_SAFE_INTEGER}=e,i=(0,nQ.IK)(),{value:l,append:s,remove:d,readonly:c}=(0,nQ.Dq)(),v=l||[];return(0,p.jsxs)(nQ.$0,{ref:i,title:_.o.t("workflow_detail_node_parameter_input"),tooltip:_.o.t("workflow_stringprocess_input_tooltips"),isEmpty:!l||(null==l?void 0:l.length)===0,emptyText:_.o.t("workflow_inputs_empty"),actions:[v.length>=a?null:(0,p.jsx)(nQ.HS,{disabled:c,onClick:()=>{var e,t=iq(v.map(e=>{var t;return null!==(t=null==e?void 0:e.name)&&void 0!==t?t:""}),iO);s({name:"".concat(iO).concat(t),input:{type:u.YX3.REF}}),null===(e=i.current)||void 0===e||e.open()}})],children:[(0,p.jsx)(nQ.az,{columns:[{label:_.o.t("workflow_detail_node_parameter_name"),style:{width:148}},{label:_.o.t("workflow_detail_end_output_value")}]}),(0,p.jsx)(nQ.F3,{children:null==l?void 0:l.map((e,t)=>{var{name:a}=e;return(0,p.jsx)(nQ.y1,{onRemove:()=>d(t),disableRemove:c||v.length<=n,children:(0,p.jsx)(n3.se,{label:a,required:!1,inputType:o,disabledTypes:r,name:"inputParameters.".concat(t,".input")},t)})})}),t]})}),iG=n("777041");n("66924");var iH=n("311807"),i$=n("466105"),iJ=n("164856"),iY=n("884278"),iQ=e=>{var{settingInfo:t,value:n,readonly:o,onChange:r}=e,a=(0,iH.Z)(r,500);return(0,p.jsxs)("div",{className:iY.Z["setting-form"],onClick:e=>e.stopPropagation(),children:[!!(null==t?void 0:t.formTitle)&&(0,p.jsx)(R.ZT.Title,{className:iY.Z["setting-form-title"],children:null==t?void 0:t.formTitle}),!!(null==t?void 0:t.formDescription)&&(0,p.jsx)(R.ZT.Paragraph,{className:iY.Z["setting-form-desc"],children:null==t?void 0:t.formDescription}),(0,p.jsx)(iJ.n,{label:_.o.t("workflow_stringprocess_concat_array_symbol_title"),tooltip:_.o.t("workflow_textprocess_concat_symbol_tips")}),(0,p.jsx)(i$.fO,{readonly:!!o,value:n,onChange:a,options:iV})]})},iX=(0,nQ.Q2)(()=>{var{value:e,onChange:t,readonly:n}=(0,nQ.U$)(),o={formTitle:_.o.t("workflow_stringprocess_concat_array_title"),formDescription:_.o.t("workflow_stringprocess_concat_array_desc")};return(0,p.jsx)(R.J2,{keepDOM:!0,stopPropagation:!0,trigger:"click",position:"bottomRight",className:iY.Z["setting-popover"],content:n?null:(0,p.jsx)(iQ,{settingInfo:o,value:e,onChange:e=>{null==t||t(e)}}),children:(0,p.jsx)(R.hU,{size:"small",disabled:n,icon:(0,p.jsx)(V.qBd,{className:"text-sm"}),color:"highlight"})})}),iK=(0,nQ.Q2)(e=>{var{name:t,value:n,onChange:o,errors:r}=(0,nQ.U$)();return(0,p.jsx)(tT.i,(0,D._)((0,c._)({},e),{name:t,value:n,onChange:e=>{o(e)},isError:r&&(null==r?void 0:r.length)>0}))}),i0=e=>{var{concatCharFieldName:t,concatResultFieldName:n}=e,o=(0,nQ.cI)(),r=(0,nQ.qo)({name:"inputParameters"});return(0,p.jsx)(nQ.$0,{title:_.o.t("workflow_stringprocess_node_method_concat"),tooltip:(0,p.jsx)("img",{src:iG,alt:"alt image",width:"740px"}),tooltipClassName:"toolip-with-white-bg",actions:[(0,p.jsx)(iX,{name:t,defaultValue:{value:eu.p1.comma,options:eu.bd}})],children:(0,p.jsx)(iK,{name:n,defaultValue:"",placeholder:_.o.t("workflow_stringprocess_concat_tips"),inputParameters:r,onChange:e=>{o.setFieldValue(n,e)}})})},i1=(0,nQ.Q2)(e=>{var{value:t,onChange:n,readonly:o,errors:r}=(0,nQ.U$)();return(0,p.jsxs)(nQ.$0,{title:_.o.t("workflow_stringprocess_delimiter_title"),tooltip:_.o.t("workflow_stringprocess_delimiter_tooltips"),children:[(0,p.jsx)(i$.fO,(0,D._)((0,c._)({},e),{value:t,readonly:!!o,onChange:n,options:iA,hasError:r&&(null==r?void 0:r.length)>0})),(0,p.jsx)(G.P,{errors:r})]})}),i2=()=>{var e=iz((0,nQ.qo)({name:"method"}));return(0,p.jsxs)(n1.X_,{children:[(0,p.jsx)(iU,{name:"method"}),(0,p.jsx)(iW,{name:"inputParameters",defaultValue:iR,minItems:e?1:0,maxItems:e?1:Number.MAX_SAFE_INTEGER,inputType:e?u.owu.String:void 0,disabledTypes:e?u.owu.getComplement([u.owu.String]):[]}),e?(0,p.jsx)(i1,{name:"delimiter",hasFeedback:!1}):(0,p.jsx)(i0,{concatCharFieldName:"concatChar",concatResultFieldName:"concatResult"}),(0,p.jsx)(n3.Nn,{name:"outputs",title:_.o.t("workflow_detail_node_output"),tooltip:_.o.t("workflow_stringprocess_output_tooltips"),id:"text-process-node-output",topLevelReadonly:!0,customReadonly:!0})]})};function i4(e,t){return e.find(e=>e.name===t)}var i6={render:()=>(0,p.jsx)(i2,{}),validateTrigger:m.C$.onChange,validate:{nodeMeta:h.O,"inputParameters.*.input":(0,o8.vu)({required:!0}),concatResult:e=>{var{value:t,formValues:n}=e;if((null==n?void 0:n.method)!==iE.Split)return(null==t?void 0:t.length)?void 0:_.o.t("workflow_testset_required_tip",{param_name:_.o.t("Content")})},delimiter:e=>{var{value:t,formValues:n}=e;if((null==n?void 0:n.method)!==iE.Concat){if(!(null==t?void 0:t.value)||(null==t?void 0:t.value.length)===0)return _.o.t("workflow_testset_required_tip",{param_name:_.o.t("workflow_stringprocess_delimiter_title")})}}},effect:{nodeMeta:em.J,outputs:ev.m,method:[{effect:e=>{var{value:t,context:n}=e,{node:o}=n,r=o.getData(m.Ps).getFormModel();if(!!r)r.setValueIn("outputs",iB(t)),iz(t)&&r.setValueIn("delimiter",{value:[],options:eu.bd}),r.setValueIn("inputParameters",[{name:iz(t)?"String":"String1"}])},event:m.zE.onValueChange}]},formatOnInit:e=>{if(!e)return{method:iE.Concat,inputParameters:iR,outputs:iB(iE.Concat)};var{nodeMeta:t,inputs:n,outputs:o}=e,{method:r=iE.Concat,inputParameters:a,splitParams:i,concatParams:l}=n||{},s={method:r,nodeMeta:t,outputs:o,inputParameters:a};if(!iz(r)&&Array.isArray(l)){var d=i4(l,iL.concatResult),c=i4(l,iM.arrayItemConcatChar),p=i4(l,iM.allArrayItemConcatChars),v=p&&u.ycG.toLiteral(p).length>0;d&&(s[iL.concatResult]=u.ycG.toLiteral(d)),v&&c&&(s[iL.concatChar]={value:u.ycG.toLiteral(c),options:u.ycG.toLiteral(p)})}else if(r===iE.Split&&(!(null==a?void 0:a.length)&&Object.assign(s,{inputParameters:[{name:iO}]}),Array.isArray(i))){var m=i4(i,iM.delimiters),f=i4(i,iM.allDelimiters);f&&u.ycG.toLiteral(f).length>0&&m&&(s[iL.delimiter]={value:u.ycG.toLiteral(m),options:u.ycG.toLiteral(f)})}return s},formatOnSubmit:e=>{var t=(0,w.Z)(e,iL.method),n=(0,w.Z)(e,"nodeMeta"),o=(0,w.Z)(e,"".concat(iL.concatChar,".value"),""),r=(0,w.Z)(e,"".concat(iL.concatChar,".options"),[]),a=(0,w.Z)(e,iL.concatResult,""),i=(0,w.Z)(e,"inputParameters",[]),l=(0,w.Z)(e,"".concat(iL.delimiter,".value"),[]),s=(0,w.Z)(e,"".concat(iL.delimiter,".options"),[]),d={nodeMeta:n,inputs:{method:t,inputParameters:i},outputs:(0,w.Z)(e,iL.outputs)};if(!t)return d;switch(t){case iE.Concat:Object.assign(d.inputs,{concatParams:[u.ycG.createString(iL.concatResult,a),u.ycG.createString(iM.arrayItemConcatChar,o),u.ycG.createArray(iM.allArrayItemConcatChars,r,iZ)]});break;case iE.Split:Object.assign(d.inputs,{splitParams:[u.ycG.createArray(iM.delimiters,l,{type:"string"}),u.ycG.createArray(iM.allDelimiters,s,iZ)]})}return d}},i5={type:u.nyy.Text,meta:{nodeDTOType:u.nyy.Text,style:{width:360},size:{width:360,height:130.7},inputParametersPath:"/inputParameters",nodeMetaPath:eu.je,outputsPath:eu.G0,test:{generateFormInputProperties(e){var t=e.getData(m.Ps).formModel.getFormItemValueByPath("/"),n=null==t?void 0:t.inputParameters;return(0,ec.ee)(n,{node:e})}},helpLink:"/open/docs/guides/text_processing_node"},formMeta:i6},i3=n("765878"),i8=n("727508"),i9=n("931188"),i7=n("625802"),le=n("66856"),lt=n("692883"),ln=n("711835"),lo=n("813026"),lr=n("709253"),la=n("490838"),li=n("685091"),ll=n("256659"),ls=n("32448"),ld=eu.gu.width,lu={[u.nyy.ClearContext]:"/open/docs/guides/clear_conversation_history",[u.nyy.CreateConversation]:"/open/docs/guides/create_conversation",[u.nyy.QueryMessageList]:"/open/docs/guides/query_message_list",[u.nyy.UpdateConversation]:"/open/docs/guides/edit_conversation",[u.nyy.DeleteConversation]:"/open/docs/guides/delete_conversation",[u.nyy.QueryConversationList]:"/open/docs/guides/query_conversation_list",[u.nyy.QueryConversationHistory]:"/open/docs/guides/query_conversation_history",[u.nyy.CreateMessage]:"/open/docs/guides/create_message",[u.nyy.UpdateMessage]:"/open/docs/guides/edit_message",[u.nyy.DeleteMessage]:"/open/docs/guides/delete_message"},lc=(e,t,n,o)=>({type:e,meta:(0,c._)({nodeDTOType:e,style:{width:ld},size:{width:ld,height:113},nodeMetaPath:eu.je,inputParametersPath:"/inputParameters",getInputVariableTag(e,t,o){var r=n[e||""],a=!1;if(null==r?void 0:r.required){var i,l=null==t?void 0:t.content,s=(null==l?void 0:null===(i=l.keyPath)||void 0===i?void 0:i.length)>0,d=null==o?void 0:o.variableService.getWorkflowVariableByKeyPath(null==l?void 0:l.keyPath,{node:null==o?void 0:o.node,checkScope:!0});a=u.nZF.isEmpty(t)||s&&!d}return{label:e,type:(null==r?void 0:r.type)?g.N.DTOTypeToViewType(r.type):u.owu.String,invalid:a}},helpLink:lu[e]},o),beforeNodeSubmit:e=>((0,w.Z)(e,"data.inputs.inputParameters",[]).forEach(e=>{var t=n[e.name||""];t&&e.input.type&&(0,v.Z)(e,"input.type",t.type)}),e),formMeta:t}),lp=e=>{var t=(0,D._)((0,c._)({},e),{inputs:{inputParameters:(null==e?void 0:e.inputParameters)||[]}});return(0,eZ.Z)(t,["inputParameters"])},lv=e=>Array.isArray(e)&&0===e.length||null==e,lm=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return n=>{var{inputs:o,outputs:r}=n||{},a=(null==o?void 0:o.inputParameters)||[],i=e.map(e=>{var{name:t}=e,n=a.find(e=>e.name===t);return n?n:e},[]);return(0,D._)((0,c._)({},(0,eZ.Z)(n,["inputs"])),{inputParameters:i,outputs:lv(r)?t:r})}},lf="conversationName";_.o.t("workflow_detail_node_parameter_name"),_.o.t("workflow_detail_node_parameter_value");var lg=[{title:_.o.t("workflow_detail_node_parameter_name"),style:{width:140}},{title:_.o.t("workflow_detail_node_parameter_value"),style:{flex:"1"}}],lh=[{event:m.zE.onValueInit,effect:e=>{var{value:t,context:n}=e;if(!!n){var{node:o,playgroundContext:r}=n,{variableService:a,nodesService:i,globalState:l}=r,s=i.getStartNode(),d=o.getData(m.Ps).getFormModel(),c=l.flowMode===u.wz8.ChatFlow,{isInIDE:p}=l;setTimeout(()=>{var e=a.getWorkflowVariableByKeyPath([s.id,"CONVERSATION_NAME"],{node:o,checkScope:!0}),n=(0,ni.Z)(t),r=n.find(e=>e.name===lf),i=u.nZF.isEmpty(null==r?void 0:r.input);e&&r&&c&&i?d&&((0,v.Z)(r,"input",{type:"ref",content:{keyPath:["100001","CONVERSATION_NAME"]}}),d.setValueIn("inputParameters",n)):!p&&!c&&r&&i&&d&&((0,v.Z)(r,"input",{type:"literal",content:"Default"}),d.setValueIn("inputParameters",n))},200)}}}],l_=e=>{var{fieldName:t="inputParameters",defaultValue:n=[],headerTitle:o,headerTootip:r,columns:a,fieldConfig:i={},readonly:l=!1}=e;return(0,p.jsx)(m.F2,{name:t,defaultValue:n,children:e=>{var{field:t}=e;return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(eT.E,{header:o,tooltip:r,children:[(0,p.jsx)("div",{className:"pb-[8px]",children:(0,p.jsx)(rt.Z,{columns:null!=a?a:[]})}),Object.keys(i).map((e,t)=>{var n,o,r;return(0,p.jsxs)("div",{className:"array-item-wrapper flex items-start pb-[8px]",children:[(0,p.jsx)("div",{className:"w-[140px]",children:(0,p.jsx)(aw.Z,{required:null===(n=i[e])||void 0===n?void 0:n.required,label:null===(o=i[e])||void 0===o?void 0:o.name,tooltip:null===(r=i[e])||void 0===r?void 0:r.description,tootipIconClassName:"coz-fg-secondary",tag:null})}),(0,p.jsx)(m.gN,{name:"inputParameters.".concat(t,".input"),children:t=>{var n,o,{field:r,fieldState:a}=t;return(0,p.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,p.jsx)(W.N,(0,D._)((0,c._)({},r),{readonly:l,disabledTypes:u.owu.getComplement([g.N.DTOTypeToViewType(i[e].type)]),literalConfig:{optionsList:null===(n=i[e])||void 0===n?void 0:n.optionsList},isError:!!(null==a?void 0:null===(o=a.errors)||void 0===o?void 0:o.length)})),(0,p.jsx)(G.P,{errors:null==a?void 0:a.errors})]})}})]},e)})]})})}})},ly=e=>{var{defaultInputValue:t,defaultOutputValue:n,fieldConfig:o,readonly:r,inputTooltip:a="",outputTooltip:i="",hasInputs:l=!0}=e;return(0,p.jsx)(I.n,{children:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(Z,{fieldName:"nodeMeta"}),l?(0,p.jsx)(l_,{fieldName:"inputParameters",defaultValue:t,headerTitle:_.o.t("workflow_detail_node_parameter_input"),headerTootip:a,columns:lg,fieldConfig:o,readonly:r}):null,(0,p.jsx)(m.gN,{name:"outputs",defaultValue:n,children:e=>{var{field:t,fieldState:n}=e;return(0,p.jsx)(P.y,{id:"create-conversation-node-output",value:t.value,onChange:t.onChange,titleTooltip:i,readonly:!0,needErrorBody:!1,errors:null==n?void 0:n.errors})}})]})})},lx={[lf]:{description:_.o.t("wf_chatflow_24"),name:lf,required:!0,type:"string"},limit:{description:_.o.t("wf_chatflow_34"),name:"limit",required:!1,type:"integer"},beforeId:{description:_.o.t("wf_chatflow_35"),name:"beforeId",required:!1,type:"string"},afterId:{description:_.o.t("wf_chatflow_36"),name:"afterId",required:!1,type:"string"}},lw=[{name:lf,input:{type:u.YX3.REF}},{name:"limit",input:{type:u.YX3.REF}},{name:"beforeId",input:{type:u.YX3.REF}},{name:"afterId",input:{type:u.YX3.REF}}],lb=[{key:(0,ez.x0)(),name:"messageList",type:u.owu.ArrayObject,children:[{key:(0,ez.x0)(),name:"messageId",type:u.owu.String},{key:(0,ez.x0)(),name:"role",type:u.owu.String},{key:(0,ez.x0)(),name:"contentType",type:u.owu.String},{key:(0,ez.x0)(),name:"content",type:u.owu.String}]},{key:(0,ez.x0)(),name:"firstId",type:u.owu.String},{key:(0,ez.x0)(),name:"lastId",type:u.owu.String},{key:(0,ez.x0)(),name:"hasMore",type:u.owu.Boolean}],lj=e=>{var{form:t}=e;return ly({defaultInputValue:lw,defaultOutputValue:lb,fieldConfig:lx,readonly:(0,T.j)(),inputTooltip:_.o.t("wf_chatflow_33"),outputTooltip:_.o.t("wf_chatflow_37")})},lk={render:e=>(0,p.jsx)(lj,(0,c._)({},e)),validateTrigger:m.C$.onChange,validate:{"inputParameters.0.input":(0,k.v)({required:!0})},effect:{nodeMeta:em.J,outputs:ev.m,inputParameters:lh},formatOnInit:lm(lw,lb),formatOnSubmit:lp},lN=lc(u.nyy.QueryMessageList,lk,lx,{test:{generateRelatedContext(e,t){var{isInProject:n}=t;return n?{}:(0,ec.UY)({isNeedBot:!0})},generateFormInputProperties(e){var t=e.getData(m.Ps).formModel.getFormItemValueByPath("/");return(0,ec.ee)(null==t?void 0:t.inputParameters,{node:e})}}}),lS={conversationName:{description:_.o.t("wf_chatflow_14"),name:lf,required:!0,type:"string"}},lC=[{name:lf,input:{type:u.YX3.REF}}],lI=[{key:(0,ez.x0)(),name:"isSuccess",type:u.owu.Boolean},{key:(0,ez.x0)(),name:"isExisted",type:u.owu.Boolean},{key:(0,ez.x0)(),name:"conversationId",type:u.owu.String}],lT=()=>ly({defaultInputValue:lC,defaultOutputValue:lI,fieldConfig:lS,readonly:(0,T.j)(),inputTooltip:_.o.t("wf_chatflow_13"),outputTooltip:_.o.t("wf_chatflow_15")}),lP={render:()=>(0,p.jsx)(lT,{}),validateTrigger:m.C$.onChange,validate:{"inputParameters.0.input":(0,k.v)({required:!0})},effect:{nodeMeta:em.J,outputs:ev.m},formatOnInit:lm(lC,lI),formatOnSubmit:lp},lD=lc(u.nyy.CreateConversation,lP,lS,{test:{generateRelatedContext(e,t){var{isInProject:n}=t;return n?{}:(0,ec.UY)({isNeedBot:!0,hasConversationNode:!0,disableBot:!0,disableBotTooltip:_.o.t("wf_chatflow_141")})},generateFormInputProperties(e){var t=e.getData(m.Ps).formModel.getFormItemValueByPath("/");return(0,ec.ee)(null==t?void 0:t.inputParameters,{node:e})}}}),lE={conversationName:{description:_.o.t("wf_chatflow_24"),name:lf,required:!0,type:"string"}},lO=[{name:lf,input:{type:u.YX3.REF}}],lL=[{key:(0,ez.x0)(),name:"isSuccess",type:u.owu.Boolean}],lM=()=>ly({defaultInputValue:lO,defaultOutputValue:lL,fieldConfig:lE,readonly:(0,T.j)(),inputTooltip:_.o.t("wf_chatflow_23"),outputTooltip:_.o.t("wf_chatflow_25")}),lF={render:()=>(0,p.jsx)(lM,{}),validateTrigger:m.C$.onChange,validate:{"inputParameters.0.input":(0,k.v)({required:!0})},effect:{nodeMeta:em.J,outputs:ev.m,inputParameters:lh},formatOnInit:lm(lO,lL),formatOnSubmit:lp},lZ=lc(u.nyy.ClearContext,lF,lE,{test:{generateRelatedContext(e,t){var{isInProject:n}=t;return n?{}:(0,ec.UY)({isNeedBot:!0})},generateFormInputProperties(e){var t=e.getData(m.Ps).formModel.getFormItemValueByPath("/");return(0,ec.ee)(null==t?void 0:t.inputParameters,{node:e})}}}),lR=e=>{var{fieldConfig:t,needSyncConversationName:n,defaultInputValue:o,defaultOutputValue:r,formRenderComponent:a,customValidators:i={}}=e,l={render:()=>(0,p.jsx)(a,{}),validateTrigger:m.C$.onChange,validate:(0,c._)({"inputParameters.*.input":(0,k.v)({required:e=>{var n,{name:o}=e;return!!(null===(n=t[o.replace("inputParameters.","").replace(".input","")])||void 0===n?void 0:n.required)}})},i),effect:{nodeMeta:em.J,outputs:ev.m},formatOnInit:lm(o,r),formatOnSubmit:lp};return n&&Object.assign(l.effect,{inputParameters:lh}),l},lV={conversationName:{description:_.o.t("workflow_250407_019"),name:lf,required:!0,type:"string"},newConversationName:{description:_.o.t("workflow_250407_020"),name:"newConversationName",required:!0,type:"string"}},lA=Object.keys(lV).map(e=>({name:e,input:{type:u.YX3.REF}})),lz=[{key:(0,ez.x0)(),name:"isSuccess",type:u.owu.Boolean},{key:(0,ez.x0)(),name:"isExisted",type:u.owu.Boolean},{key:(0,ez.x0)(),name:"conversationId",type:u.owu.String}],lB=lR({fieldConfig:lV,needSyncConversationName:!1,defaultInputValue:lA,defaultOutputValue:lz,formRenderComponent:()=>ly({defaultInputValue:lA,defaultOutputValue:lz,fieldConfig:lV,readonly:(0,T.j)(),inputTooltip:_.o.t("Input"),outputTooltip:_.o.t("Output")})}),lU=lc(u.nyy.UpdateConversation,lB,lV,{test:{generateRelatedContext(e,t){var{isInProject:n}=t;return n?{}:(0,ec.UY)({isNeedBot:!0,hasConversationNode:!0,disableBot:!0,disableBotTooltip:_.o.t("wf_chatflow_141")})},generateFormInputProperties(e){var t=e.getData(m.Ps).formModel.getFormItemValueByPath("/");return(0,ec.ee)(null==t?void 0:t.inputParameters,{node:e})}}}),lq={conversationName:{description:_.o.t("workflow_250407_023"),name:lf,required:!0,type:"string"}},lW=Object.keys(lq).map(e=>({name:e,input:{type:u.YX3.REF}})),lG=[{key:(0,ez.x0)(),name:"isSuccess",type:u.owu.Boolean}],lH=lR({fieldConfig:lq,needSyncConversationName:!1,defaultInputValue:lW,defaultOutputValue:lG,formRenderComponent:()=>ly({defaultInputValue:lW,defaultOutputValue:lG,fieldConfig:lq,readonly:(0,T.j)(),inputTooltip:_.o.t("Input"),outputTooltip:_.o.t("Output")})}),l$=lc(u.nyy.DeleteConversation,lH,lq,{test:{generateRelatedContext(e,t){var{isInProject:n}=t;return n?{}:(0,ec.UY)({isNeedBot:!0,hasConversationNode:!0,disableBot:!0,disableBotTooltip:_.o.t("wf_chatflow_141")})},generateFormInputProperties(e){var t=e.getData(m.Ps).formModel.getFormItemValueByPath("/");return(0,ec.ee)(null==t?void 0:t.inputParameters,{node:e})}}}),lJ=[{key:(0,ez.x0)(),name:"conversationList",type:u.owu.ArrayObject,children:[{key:(0,ez.x0)(),name:"conversationName",type:u.owu.String},{key:(0,ez.x0)(),name:"conversationId",type:u.owu.String}]}],lY=lR({fieldConfig:{},needSyncConversationName:!1,defaultInputValue:[],defaultOutputValue:lJ,formRenderComponent:()=>ly({defaultInputValue:[],defaultOutputValue:lJ,fieldConfig:{},readonly:(0,T.j)(),inputTooltip:_.o.t("Input"),outputTooltip:_.o.t("Output"),hasInputs:!1})}),lQ=lc(u.nyy.QueryConversationList,lY,{},{test:{generateRelatedContext(e,t){var{isInProject:n}=t;return n?{}:(0,ec.UY)({isNeedBot:!0,hasConversationNode:!0,disableBot:!0,disableBotTooltip:_.o.t("wf_chatflow_141")})}}}),lX={conversationName:{description:_.o.t("workflow_250407_028"),name:lf,required:!0,type:u.Rkg.string},rounds:{description:_.o.t("workflow_250407_029"),name:"rounds",required:!0,type:u.Rkg.integer}},lK=Object.keys(lX).map(e=>({name:e,input:{type:u.YX3.REF}})),l0=[{key:(0,ez.x0)(),name:"messageList",type:u.owu.ArrayObject,children:[{key:(0,ez.x0)(),name:"role",type:u.owu.String},{key:(0,ez.x0)(),name:"content",type:u.owu.String}]}],l1=lR({fieldConfig:lX,needSyncConversationName:!0,defaultInputValue:lK,defaultOutputValue:l0,formRenderComponent:()=>ly({defaultInputValue:lK,defaultOutputValue:l0,fieldConfig:lX,readonly:(0,T.j)(),inputTooltip:_.o.t("Input"),outputTooltip:_.o.t("Output")})}),l2=lc(u.nyy.QueryConversationHistory,l1,lX,{test:{generateRelatedContext(e,t){var{isInProject:n}=t;return n?{}:(0,ec.UY)({isNeedBot:!0})},generateFormInputProperties(e){var t=e.getData(m.Ps).formModel.getFormItemValueByPath("/");return(0,ec.ee)(null==t?void 0:t.inputParameters,{node:e})}}}),l4={conversationName:{description:_.o.t("workflow_250407_005"),name:lf,required:!0,type:u.Rkg.string},role:{description:_.o.t("workflow_250407_006"),name:"role",required:!0,type:u.Rkg.string,defaultValue:"user",optionsList:[{label:"user",value:"user"},{label:"assistant",value:"assistant"}]},content:{description:_.o.t("workflow_250407_007"),name:"content",required:!0,type:u.Rkg.string}},l6=Object.keys(l4).map(e=>"role"===e?{name:e,input:{type:u.YX3.LITERAL,content:l4[e].defaultValue}}:{name:e,input:{type:u.YX3.REF}}),l5=[{key:(0,ez.x0)(),name:"isSuccess",type:u.owu.Boolean},{key:(0,ez.x0)(),name:"message",type:u.owu.Object,children:[{key:(0,ez.x0)(),name:"messageId",type:u.owu.String},{key:(0,ez.x0)(),name:"role",type:u.owu.String},{key:(0,ez.x0)(),name:"contentType",type:u.owu.String},{key:(0,ez.x0)(),name:"content",type:u.owu.String}]}],l3=lR({fieldConfig:l4,needSyncConversationName:!0,defaultInputValue:l6,defaultOutputValue:l5,formRenderComponent:()=>ly({defaultInputValue:l6,defaultOutputValue:l5,fieldConfig:l4,readonly:(0,T.j)(),inputTooltip:_.o.t("Input"),outputTooltip:_.o.t("Output")})}),l8=lc(u.nyy.CreateMessage,l3,l4,{test:{generateRelatedContext(e,t){var{isInProject:n}=t;return n?{}:(0,ec.UY)({isNeedBot:!0})},generateFormInputProperties(e){var t=e.getData(m.Ps).formModel.getFormItemValueByPath("/");return(0,ec.ee)(null==t?void 0:t.inputParameters,{node:e})}}}),l9={conversationName:{description:_.o.t("workflow_250407_010"),name:lf,required:!0,type:u.Rkg.string},messageId:{description:_.o.t("workflow_250407_011"),name:"messageId",required:!0,type:u.Rkg.string},newContent:{description:_.o.t("workflow_250407_012"),name:"newContent",required:!0,type:u.Rkg.string}},l7=Object.keys(l9).map(e=>({name:e,input:{type:u.YX3.REF}})),se=[{key:(0,ez.x0)(),name:"isSuccess",type:u.owu.Boolean}],st=lR({fieldConfig:l9,needSyncConversationName:!0,defaultInputValue:l7,defaultOutputValue:se,formRenderComponent:()=>ly({defaultInputValue:l7,defaultOutputValue:se,fieldConfig:l9,readonly:(0,T.j)(),inputTooltip:_.o.t("Input"),outputTooltip:_.o.t("Output")})}),sn=lc(u.nyy.UpdateMessage,st,l9,{test:{generateRelatedContext(e,t){var{isInProject:n}=t;return n?{}:(0,ec.UY)({isNeedBot:!0})},generateFormInputProperties(e){var t=e.getData(m.Ps).formModel.getFormItemValueByPath("/");return(0,ec.ee)(null==t?void 0:t.inputParameters,{node:e})}}}),so={conversationName:{description:_.o.t("workflow_250407_015"),name:lf,required:!0,type:u.Rkg.string},messageId:{description:_.o.t("workflow_250407_016"),name:"messageId",required:!0,type:u.Rkg.string}},sr=Object.keys(so).map(e=>({name:e,input:{type:u.YX3.REF}})),sa=[{key:(0,ez.x0)(),name:"isSuccess",type:u.owu.Boolean}],si=lR({fieldConfig:so,needSyncConversationName:!0,defaultInputValue:sr,defaultOutputValue:sa,formRenderComponent:()=>ly({defaultInputValue:sr,defaultOutputValue:sa,fieldConfig:so,readonly:(0,T.j)(),inputTooltip:_.o.t("Input"),outputTooltip:_.o.t("Output")})}),sl=lc(u.nyy.DeleteMessage,si,so,{test:{generateRelatedContext(e,t){var{isInProject:n}=t;return n?{}:(0,ec.UY)({isNeedBot:!0})},generateFormInputProperties(e){var t=e.getData(m.Ps).formModel.getFormItemValueByPath("/");return(0,ec.ee)(null==t?void 0:t.inputParameters,{node:e})}}}),ss=[ls.p,lr.P,lo._,li.l,nU.l,a8.w,a4,a6,i8.S,i3.Q,aP.t,a9.W,rx.r,a5.p,iD.J,i9.t,la.fO,nB,aT,a3.g,lt.p,le.v,i7.M,ln.T,nJ,lD,lZ,lN,lU,l$,lQ,l2,l8,sn,sl,ed,eM,oO,o4,oF,o3,iP,ry,rl,i5,ow,ll.J],sd=ss.map(e=>e.type),su=e=>sd.includes(e.flowNodeType),sc=e=>ss.find(t=>t.type===e)},531566:function(e,t,n){n.d(t,{b:()=>i});var o=n("672496"),r=n("408487"),a=new class e{run(e){return this.enable?new Promise((t,n)=>{this.pendingPromises.push({promiseFactory:e,resolve:t,reject:n}),this.next()}):e()}next(){if(this.activeCount<this.concurrency){var e=this.pendingPromises.shift();if(!!e){var{promiseFactory:t,resolve:n,reject:o}=e;this.activeCount++,t().then(e=>{n(e)}).catch(e=>{o(e)}).finally(()=>{this.activeCount--,this.next()})}}}constructor(e,t=!0){this.concurrency=e,this.pendingPromises=[],this.activeCount=0,this.enable=t}}(3,!0),i=e=>{var{nodeId:t,enabled:n=!0}=e;return(0,o.a)({queryKey:[t,"settingDetail"],queryFn:()=>a.run(()=>r.OHc.GetLLMNodeFCSettingDetail({workflow_id:e.workflowId,space_id:e.spaceId,plugin_list:e.plugin_list,workflow_list:e.workflow_list,dataset_list:e.dataset_list})),enabled:n})}},566785:function(e,t,n){function o(e){return!!e&&"0"!==e}function r(e){var t,n,o,r,a,i;return!(null===(n=e.pluginFCParam)||void 0===n?void 0:null===(t=n.pluginList)||void 0===t?void 0:t.length)&&!(null===(r=e.workflowFCParam)||void 0===r?void 0:null===(o=r.workflowList)||void 0===o?void 0:o.length)&&!(null===(i=e.knowledgeFCParam)||void 0===i?void 0:null===(a=i.knowledgeList)||void 0===a?void 0:a.length)}function a(e){var t,n,o,r,a,i;return{plugin_list:null==e?void 0:null===(n=e.pluginFCParam)||void 0===n?void 0:null===(t=n.pluginList)||void 0===t?void 0:t.map(e=>({plugin_id:e.plugin_id,api_id:e.api_id,api_name:e.api_name,is_draft:e.is_draft,plugin_version:e.plugin_version,plugin_from:e.plugin_from})),workflow_list:null==e?void 0:null===(r=e.workflowFCParam)||void 0===r?void 0:null===(o=r.workflowList)||void 0===o?void 0:o.map(e=>({workflow_id:e.workflow_id,plugin_id:e.plugin_id,is_draft:e.is_draft,workflow_version:e.workflow_version})),dataset_list:null==e?void 0:null===(i=e.knowledgeFCParam)||void 0===i?void 0:null===(a=i.knowledgeList)||void 0===a?void 0:a.map(e=>({dataset_id:e.id,is_draft:!1}))}}n.d(t,{Vq:function(){return a},ae:function(){return r},rK:function(){return o}})},264219:function(e,t,n){n.d(t,{v:function(){return i}});var o=n(156133),r=n(345420),a=n(524705),i=e=>{var{required:t,emptyErrorMessage:n,skipValidate:i}=e;return e=>{var{name:l,value:s,formValues:d,context:u}=e,{playgroundContext:c,node:p}=u,v=!1;if(null==i?!void 0:!i({value:s,formValues:d}))return(0,o.Z)(t)&&(v=t),(0,r.Z)(t)&&(v=t({name:l,value:s,formValues:d,context:u})),(0,a.s)({value:s,playgroundContext:c,node:p,required:v,emptyErrorMessage:n})}}},7496:function(e,t,n){n.d(t,{J:function(){return a}});var o=n(686436),r=e=>{var{context:t}=e;if(!!t)t.playgroundContext.nodesService.fireNodesTitleChange()},a=[{event:o.zE.onValueChange,effect:r},{event:o.zE.onValueInit,effect:r}]},676255:function(e,t,n){n.d(t,{O:function(){return r}});var o=n(24269),r=e=>{var{value:t,context:n}=e,r=(0,o.d)({value:t,context:n,options:{}});if(!0!==r)return r}},910126:function(e,t,n){n.d(t,{Q:function(){return l}});var o=n(962289),r=n(686436),a=n(79029);function i(e,t){return n=>{var{formValues:i,context:l}=n,s=(0,o.Z)(i,e),d=(0,o.Z)(i,t),{node:u}=l||{};if(!!u){var c=u.getData(r._J);!c.private&&c.initPrivate();var p=c.private,v="batch"===s?(0,a.OU)(u.id,d):[];p.ast.set("/node/locals",{kind:r.Hx.VariableDeclarationList,declarations:v})}}}function l(e,t){return[{effect:i(e,t),event:r.zE.onValueChange},{effect:i(e,t),event:r.zE.onValueInit}]}},645344:function(e,t,n){n.d(t,{m:function(){return i}});var o=n(686436),r=n(79029);function a(){return e=>{var{value:t,context:n}=e;if(!!n){var{node:a}=n,i=a.getData(o._J).public,l=(0,r.aF)(a.id,t);i.ast.set("/node/outputs",{kind:o.Hx.VariableDeclarationList,declarations:l})}}}var i=[{effect:a(),event:o.zE.onValueChange},{effect:a(),event:o.zE.onValueInit}]},237191:function(e,t,n){n.d(t,{_:function(){return r}});var o=n(294166),r=e=>{var{value:t,context:n}=e,r=(0,o.y)({value:t,context:n,options:{}});if(!0!==r)return r}},782e3:function(e,t,n){n.d(t,{B:function(){return r}});var o=n(297158);function r(e,t,n){if(!n||!n.extra)return!1;try{var r,a=JSON.parse(n.extra);if(!(null==a?void 0:null===(r=a.response_extra)||void 0===r?void 0:r.variable_select))return!1;return a.response_extra.variable_select[e]===t}catch(e){o.kg.error(e)}return!!n}},70630:function(e,t,n){n.d(t,{I:function(){return d}});var o=n(130001),r=n(771531),a=n(435946),i=n(686436),l=n(569502),s=n(734658);class d{isErrorLine(e,t){var n,o;return this.linesServiceProvider().isError(null==e?void 0:null===(n=e.node)||void 0===n?void 0:n.id,null==t?void 0:null===(o=t.node)||void 0===o?void 0:o.id)}isVerticalLine(e){return this.isSubCanvasLinkLine(e)}isHideArrowLine(e){return this.isSubCanvasLinkLine(e)}isDisabledLine(e){return this.isSubCanvasLinkLine(e)}canDeleteLine(e){var t,n,o,r;return((null===(t=e.from)||void 0===t?void 0:t.flowNodeType)!==l.ny.Loop||(null===(n=e.to)||void 0===n?void 0:n.flowNodeType)!==i.Sy.SUB_CANVAS)&&((null===(o=e.from)||void 0===o?void 0:o.flowNodeType)!==l.ny.Batch||(null===(r=e.to)||void 0===r?void 0:r.flowNodeType)!==i.Sy.SUB_CANVAS)&&!0}canAddLine(e,t){var n,o;return e.node!==t.node&&t.node.flowNodeType!==l.ny.Comment&&(e.node.flowNodeType===i.Sy.SUB_CANVAS&&e.node===t.node.parent||t.node.flowNodeType===i.Sy.SUB_CANVAS&&t.node===e.node.parent||"loop-function-inline-input"!==t.portID&&"loop-function-inline-output"!==e.portID&&"loop-output-to-function"!==e.portID&&"batch-function-inline-input"!==t.portID&&"batch-function-inline-output"!==e.portID&&"batch-output-to-function"!==e.portID&&(null===(n=e.node.parent)||void 0===n?void 0:n.id)===(null===(o=t.node.parent)||void 0===o?void 0:o.id)&&"error"!==e.node.flowNodeType&&"error"!==t.node.flowNodeType&&!0)}isSubCanvasLinkLine(e){var t,n;return"loop-output-to-function"===e.fromPort.portID&&(null===(t=e.toPort)||void 0===t?void 0:t.portID)==="loop-function-input"||"batch-output-to-function"===e.fromPort.portID&&(null===(n=e.toPort)||void 0===n?void 0:n.portID)==="batch-function-input"||!1}constructor(){this.allNodesDefaultExpanded=!1}}(0,o.gn)([(0,r.f)(s.e),(0,o.w6)("design:type",Function)],d.prototype,"linesServiceProvider",void 0),d=(0,o.gn)([(0,a.b)()],d)},357331:function(e,t,n){n.d(t,{O:function(){return o}});class o{}},994983:function(e,t,n){n.d(t,{we:()=>U.w,k_:()=>T.k,Re:()=>b,Yy:()=>B,Rq:()=>r.R,G$:()=>H,qD:()=>X,qq:()=>w.q,GH:()=>o.G,PR:()=>j.P,w3:()=>C,LG:()=>ee.L,iP:()=>en.i,Nj:()=>k.N,mh:()=>N.m,Of:()=>$.O,IB:()=>et.I,yM:()=>K.y,m3:()=>I.m3,_y:()=>q,nE:()=>x.n});var o=n("113051"),r=n("708617"),a=n("825955"),i=n("130001"),l=n("671261"),s=n("771531"),d=n("435946"),u=n("686436"),c=n("360903"),p=n("450562"),v=n("336205"),m=n("775699"),f=n("737368"),g=n("945941"),h=n("699123"),_=n("189914"),y=n("497744"),x=n("968992"),w=n("607595");class b{getDropNode(){var e,{activatedNode:t}=this.selectService;if(!t)return this.workflowDocument.root;for(var n=[],o=t;o;)n.push(o),o=o.parent;return null!==(e=n.find(e=>[u.Sy.ROOT,u.Sy.SUB_CANVAS].includes(e.flowNodeType)||e.getNodeMeta().isContainer))&&void 0!==e?e:this.workflowDocument.root}disposeNode(e){if((0,h.zC)(e)){var t,n,o=e.getData(u.Ps).getFormModel();null===(n=e.getNodeRegister())||void 0===n||null===(t=n.onDispose)||void 0===t||t.call(n,o.getValues(),this.context)}e.dispose()}recreateNodeJSON(e){var t,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return r&&(e.id=this.nodesService.createUniqID()),(null===(n=e.data)||void 0===n?void 0:null===(t=n.nodeMeta)||void 0===t?void 0:t.title)&&((0,l.Z)(e,"data.nodeMeta.title",this.nodesService.createUniqTitle(e.data.nodeMeta.title,void 0,o)),o.push(e.data.nodeMeta.title)),e.blocks&&(e.blocks=e.blocks.map(e=>this.recreateNodeJSON(e,o))),e}focusNode(e){if(e&&this.selectService.selectNodeAndFocus(e),this.floatLayoutService.getPanel("right").key===_.Gd.NodeForm){if(!e){this.floatLayoutService.close("right");return}this.floatLayoutService.open(_.Gd.NodeForm,"right",{node:e})}}constructor(){var e,t,n=this;this.addNode=(e=(0,a._)(function*(e,t,o,r){if(!n.globalState.readonly){if(e===p.nyy.Api&&(0,f.E)(),t&&t.data.nodeMeta.title&&(t.data.nodeMeta.title=n.nodesService.createUniqTitle(t.data.nodeMeta.title)),!o){n.dragService.endDrag();return}try{var a,i,l=(0,h.pC)(e);yield null==l?void 0:null===(i=l.onInit)||void 0===i?void 0:i.call(l,t,n.context)}catch(e){p.E7u.errorEvent({eventName:"workflow_registry_v2_on_init_error",namespace:"workflow",error:e})}if(r)a=yield n.dragService.dropCard(e,o,t,n.dragService.state.dropNode);else{var s,d=n.workflowDocument.getNodeRegister(e).meta,{width:c}=(null==d?void 0:d.size)||{width:0,height:0};s=n.playgroundConfig.getPosFromMouseEvent(o),s=(0,u.n2)(n.workflowDocument,{x:s.x+c/2,y:s.y});var v=n.getDropNode(),{allowDrop:m}=n.dragService.canDropToNode({dragNodeType:e,dropNode:v});if(!m)return;if(v&&v.flowNodeType!==u.Sy.ROOT){var g=v.collapsedChildren.length,_=n.workflowDocument.layout.getPadding(v);s={x:_.left+30*g,y:_.top+30*g}}a=yield n.workflowDocument.createWorkflowNodeByType(e,s,t,v.id)}return n.dragService.endDrag(),a&&n.focusNode(a),a}}),function(t,n,o,r){return e.apply(this,arguments)}),this.copyNode=(t=(0,a._)(function*(e){var t,o,r,a=yield n.workflowDocument.toNodeJSON(e),i={x:a.meta.position.x+30,y:a.meta.position.y+30},l=yield n.workflowDocument.copyNodeFromJSON(a.type,n.recreateNodeJSON(a),"",i,null===(t=e.parent)||void 0===t?void 0:t.id),s=null===(r=l.getNodeMeta())||void 0===r?void 0:null===(o=r.subCanvas)||void 0===o?void 0:o.call(r,l);return(null==s?void 0:s.canvasNode)?n.selectService.selection=[l,s.canvasNode]:n.focusNode(l),l}),function(e){return t.apply(this,arguments)}),this.deleteNode=(e,t)=>{t?this.disposeNode(e):m.u_.error({title:v.o.t("workflow_detail_select_delete_popup_title"),content:v.o.t("workflow_detail_select_delete_popup_subtitle"),onOk:()=>this.disposeNode(e),okText:v.o.t("workflow_add_delete"),cancelText:v.o.t("Cancel")})}}}(0,i.gn)([(0,s.f)(y.eI),(0,i.w6)("design:type",void 0===y.eI?Object:y.eI)],b.prototype,"globalState",void 0),(0,i.gn)([(0,s.f)(w.q),(0,i.w6)("design:type",void 0===w.q?Object:w.q)],b.prototype,"dragService",void 0),(0,i.gn)([(0,s.f)(y.eI),(0,i.w6)("design:type",void 0===y.eI?Object:y.eI)],b.prototype,"workflowState",void 0),(0,i.gn)([(0,s.f)(u.L4),(0,i.w6)("design:type",void 0===u.L4?Object:u.L4)],b.prototype,"workflowDocument",void 0),(0,i.gn)([(0,s.f)(u.oJ),(0,i.w6)("design:type",void 0===u.oJ?Object:u.oJ)],b.prototype,"selectService",void 0),(0,i.gn)([(0,s.f)(c.t),(0,i.w6)("design:type",void 0===c.t?Object:c.t)],b.prototype,"nodesService",void 0),(0,i.gn)([(0,s.f)(u.ER),(0,i.w6)("design:type",void 0===u.ER?Object:u.ER)],b.prototype,"playgroundConfig",void 0),(0,i.gn)([(0,s.f)(x.n),(0,i.w6)("design:type",void 0===x.n?Object:x.n)],b.prototype,"floatLayoutService",void 0),(0,i.gn)([(0,s.f)(g.j),(0,i.w6)("design:type",void 0===g.j?Object:g.j)],b.prototype,"context",void 0),b=(0,i.gn)([(0,d.b)()],b);var j=n("15021"),k=n("468392"),N=n("340667"),S=n("816697");class C{setSelectItem(e){this.selectItem=e,this.onSelectItemChangeEmitter.fire(e)}setSelectConversationItem(e){this.selectConversationItem=e,this.onSelectConversationItemChangeEmitter.fire(e)}constructor(){this.onSelectItemChangeEmitter=new S.Q5,this.onSelectItemChange=this.onSelectItemChangeEmitter.event,this.onSelectConversationItemChangeEmitter=new S.Q5,this.onSelectConversationItemChange=this.onSelectConversationItemChangeEmitter.event}}C=(0,i.gn)([(0,d.b)()],C);var I=n("769510"),T=n("706738"),P=n("808549"),D=n("120454"),E=n("473980"),O=n("716894"),L=n("992499"),M=n("172637"),F=n("364498"),Z=n("567282"),R=()=>(0,O.F)(()=>({errors:{},errorsV2:{},validating:!1}),L.X),V=e=>e.type===Z.Gd.BotConcurrentPathErr||e.type===Z.Gd.BotValidatePathErr,A=e=>{var t={};return e?(e.forEach(e=>{var{node_error:n,path_error:o}=e,r=V(e),a=(r?null==o?void 0:o.start:null==n?void 0:n.node_id)||"",i=r?null==o?void 0:o.end:void 0,l={nodeId:a,targetNodeId:i,errorType:r?"line":"node",errorInfo:e.message||"",errorLevel:"error"},s=t[a]||[];s.push(l),t[a]=s}),t):t},z=e=>{var t={};return e?(e.forEach(e=>{var{errors:n,workflow_id:o}=e,r=(0,E._)(e,["errors","workflow_id"]);if(!!(null==n?void 0:n.length)&&!!o)t[o]=(0,D._)((0,P._)({workflowId:o},r),{errors:A(n)})}),t):t};class B{clearValidatedNodeMap(){this.validatedNodeMap={}}validateNode(e){var t=this;return(0,a._)(function*(){var n=[t.validateNodeError(e),(yield t.validateForm(e)),t.validateSubCanvasPort(e),t.validateSettingOnErrorPort(e)].filter(Boolean);return t.mergeValidateResult(...n)})()}validateWorkflow(){var e=this;return(0,a._)(function*(){var t=e.document.getAssociatedNodes(),n=yield Promise.all(t.map(e.validateNode.bind(e)));return e.mergeValidateResult(...n)})()}mergeValidateResult(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=t.some(e=>e.hasError);return{hasError:o,nodeErrorMap:t.reduce((e,t)=>t.hasError?(Object.entries(t.nodeErrorMap).forEach(t=>{var n,[o,r]=t;e[o]=null!==(n=e[o])&&void 0!==n?n:[],e[o].push(...r)}),e):e,{})}}validateNodeError(e){var t=(0,u.k9)(e);if(!!t)return{hasError:!0,nodeErrorMap:{[e.id]:[{errorInfo:t.message,errorLevel:"error",errorType:"node",nodeId:e.id}]}}}validateForm(e){var t=this;return(0,a._)(function*(){var n=(0,u.k9)(e),o=null==e?void 0:e.getData(u.Ps);if(!n&&!!o.formModel.initialized){var r=(yield o.formModel.validateWithFeedbacks()).filter(e=>"warning"===e.feedbackStatus||"error"===e.feedbackStatus).map(t=>{var n=t.feedbackText||"";try{var o,{issues:r,name:a}=JSON.parse(n);"ZodError"===a&&(null==r?void 0:null===(o=r[0])||void 0===o?void 0:o.message)&&(n=null==r?void 0:r[0].message)}catch(e){console.log(e)}return{errorInfo:n,errorLevel:t.feedbackStatus,errorType:"node",nodeId:e.id}}),a=!!r.length;return t.validatedNodeMap[e.id]=!0,{hasError:a,nodeErrorMap:{[e.id]:r}}}})()}validateSubCanvasPort(e){var t,n=e.getNodeMeta(),o=null===(t=n.subCanvas)||void 0===t?void 0:t.call(n,e);if(!o||!o.isCanvas)return;var{parentNode:r,canvasNode:a}=o,{allPorts:i}=e.getData(u.QW),l=i.find(e=>String(e.portID).endsWith("function-inline-output")),s=i.find(e=>String(e.portID).endsWith("function-inline-input"));if(!!l&&!!s){var d=0===l.allLines.length,c=0===s.allLines.length,m=[];if(d){var f=r.flowNodeType===p.nyy.Loop?v.o.t("workflow_testrun_check list_loopbody_start_unconnect"):v.o.t("workflow_testrun_check list_batchbody_start_unconnect");m.push({errorInfo:f,errorLevel:"error",errorType:"node",nodeId:e.id}),l.errorMessage=f,l.hasError=!0}else l.hasError=!1;var g=a.collapsedChildren.filter(e=>0===e.getData(u.Z1).outputNodes.length).every(e=>e.getNodeMeta().isNodeEnd);if(c&&!g){var h=r.flowNodeType===p.nyy.Loop?v.o.t("workflow_testrun_check list_loopbody_end_unconnect"):v.o.t("workflow_testrun_check list_batchbody_end_unconnect");m.push({errorInfo:h,errorLevel:"error",errorType:"node",nodeId:e.id}),s.errorMessage=h,s.hasError=!0}else s.hasError=!1;return{hasError:!!m.length,nodeErrorMap:{[e.id]:m}}}}validateSettingOnErrorPort(e){var{allPorts:t}=e.getData(u.QW),n=t.find(e=>String(e.portID)===F.Xg);if(!!n){var o=0===n.allLines.length,r=[];if(o){var a=v.o.t("workflow_250407_214",void 0,"需要完善节点的异常处理流程");r.push({errorInfo:a,errorLevel:"error",errorType:"node",nodeId:e.id}),n.errorMessage=a,n.hasError=!0}else n.hasError=!1;return{hasError:!!r.length,nodeErrorMap:{[e.id]:r}}}}validateSchema(){var e=this;return(0,a._)(function*(){var t=yield e.document.toJSON(),n="project"===e.globalVariable.state.type?{bind_project_id:e.globalVariable.state.id}:{bind_bot_id:e.globalVariable.state.id},{data:o}=yield p.OHc.ValidateSchema((0,P._)({schema:JSON.stringify(t)},n)),r=!!(null==o?void 0:o.length);return{hasError:r,nodeErrorMap:A(o)}})()}validateSchemaV2(){var e=this;return(0,a._)(function*(){var t={workflow_id:e.globalState.workflowId};"project"===e.globalVariable.state.type?t.bind_project_id=e.globalVariable.state.id:t.bind_bot_id=e.globalVariable.state.id;var n=yield e.document.toJSON(),{data:o}=yield p.OHc.ValidateTree((0,P._)({schema:JSON.stringify(n)},t)),r=z(o);return{hasError:!!Object.keys(r).length,errors:r}})()}getErrors(e){return this.store.getState().errors[e]||[]}setErrors(e,t){var n=this.store.getState().errors,o=t?e:(0,P._)({},n,e);this.store.setState({errors:o})}clearErrors(){this.store.setState({errors:{},errorsV2:{}})}setErrorsV2(e){this.store.setState({errorsV2:e})}isLineError(e,t){var n,o=null===(n=this.store.getState().errorsV2[this.globalState.workflowId])||void 0===n?void 0:n.errors;return!!o&&!!(o[e]||[]).find(e=>"line"===e.errorType&&e.targetNodeId===t)}get validating(){return this.store.getState().validating}set validating(e){this.store.setState({validating:e})}constructor(){this.store=R(),this.validatedNodeMap={}}}(0,i.gn)([(0,s.f)(u.L4),(0,i.w6)("design:type",void 0===u.L4?Object:u.L4)],B.prototype,"document",void 0),(0,i.gn)([(0,s.f)(y.eI),(0,i.w6)("design:type",void 0===y.eI?Object:y.eI)],B.prototype,"globalState",void 0),(0,i.gn)([(0,s.f)(M.f),(0,i.w6)("design:type",void 0===M.f?Object:M.f)],B.prototype,"globalVariable",void 0),B=(0,i.gn)([(0,d.b)()],B);var U=n("286993");class q{}var W=n("664278"),G=n("471583");class H{isValueExpression(e){return null!=e&&p.nZF.isExpression(e)}isValueExpressionDTO(e){var t,n;return"object"==typeof e&&null!==e&&(null===(t=e.value)||void 0===t?void 0:t.type)===p.YX3.REF||(null===(n=e.value)||void 0===n?void 0:n.type)===p.YX3.LITERAL}isRefExpression(e){return null!=e&&p.nZF.isRef(e)}isLiteralExpression(e){return null!=e&&p.nZF.isLiteral(e)}toDTO(e,t){if(!!e)return W.N.valueExpressionToDTO(e,this.variableService,{node:t})}toVO(e){if(!!e)return W.N.valueExpressionToVO(e,this.variableService)}isRefExpressionVariableExists(e,t){var n,o=this.variableService.getViewVariableByKeyPath(null==e?void 0:null===(n=e.content)||void 0===n?void 0:n.keyPath,{node:t});return null!=o}}(0,i.gn)([(0,s.f)(G.b),(0,i.w6)("design:type",void 0===G.b?Object:G.b)],H.prototype,"variableService",void 0),H=(0,i.gn)([(0,d.b)()],H);var $=n("357331"),J=n("962289"),Y=n("382534"),Q=()=>(0,O.F)((e,t)=>({loading:!1,data:{},error:{},getData:e=>t().data[e],setData(n,o){e({data:(0,D._)((0,P._)({},t().data),{[n]:o})})},getError:e=>t().error[e],setError(n,o){e({error:(0,D._)((0,P._)({},t().error),{[n]:o})})},clearError(n){e({error:(0,D._)((0,P._)({},t().error),{[n]:void 0})})}}),L.X);class X{convertSettingFieldToDTO(e,t,n){var o=(0,J.Z)(t,e);if(!o)return t;var r=o.map(e=>{var{fieldID:t,fieldValue:o={type:p.YX3.LITERAL}}=e;return[{name:"fieldID",input:{type:"string",value:{type:p.YX3.LITERAL,content:t.toString()}}},{name:"fieldValue",input:this.valueExpressionService.toDTO(o,n)}]});return(0,l.Z)(t,e,r),t}convertSettingFieldDTOToField(e,t){var n=(0,J.Z)(t,e);if(!n)return t;var o=n.map(e=>{var t;return{fieldID:Number(e[0].input.value.content),fieldValue:this.valueExpressionService.toVO(null===(t=e[1])||void 0===t?void 0:t.input)}});return(0,l.Z)(t,e,o),t}convertConditionDTOToCondition(e,t){var n=(0,J.Z)(t,e);if(!n)return t;var o=n.map(e=>{var[t,n,o]=e;return{left:null==t?void 0:t.input.value.content,operator:null==n?void 0:n.input.value.content,right:this.valueExpressionService.toVO(null==o?void 0:o.input)}});return(0,l.Z)(t,e,o),t}convertConditionToDTO(e,t,n){var o=(0,J.Z)(t,e);if(!o)return t;var r=o.map(e=>{var{left:t,operator:o,right:r}=e;return[t?{name:"left",input:{type:"string",value:{type:p.YX3.LITERAL,content:t}}}:void 0,o?{name:"operation",input:{type:"string",value:{type:p.YX3.LITERAL,content:o}}}:void 0,r?{name:"right",input:this.valueExpressionService.toDTO(r,n)}:void 0]});return(0,l.Z)(t,e,r),t}convertConditionLogicDTOToConditionLogic(e,t){var n=(0,J.Z)(t,e)===p.vTH.AND?p.sSN.AND:p.sSN.OR;return(0,l.Z)(t,e,n),t}convertConditionLogicToConditionLogicDTO(e,t){var n=(0,J.Z)(t,e)===p.sSN.AND?p.vTH.AND:p.vTH.OR;return(0,l.Z)(t,e,n),t}checkConditionOperatorNoNeedRight(e){return["IS_NULL","IS_NOT_NULL","BE_TRUE","BE_FALSE"].includes(e||"")}get state(){return this.store.getState()}set loading(e){this.store.setState({loading:e})}load(e){var t=this;return(0,a._)(function*(){if(!!e)try{t.loading=!0;var n=yield p.fB_.fetchQuery({queryKey:["MemoryApi.GetDatabaseByID",e],queryFn:(0,a._)(function*(){return yield Y.v6.GetDatabaseByID({id:e,need_sys_fields:!0})}),staleTime:2e4});t.state.setData(e,n)}catch(n){t.state.setError(e,n),t.state.setData(e,{database_info:{id:e,table_name:v.o.t("invalid_database",{},"无效数据库")},BaseResp:{}})}finally{t.loading=!1}})()}clearDatabaseError(e){this.state.clearError(e)}constructor(){this.store=Q()}}(0,i.gn)([(0,s.f)(q),(0,i.w6)("design:type",q)],X.prototype,"valueExpressionService",void 0),X=(0,i.gn)([(0,d.b)()],X);var K=n("969234"),ee=n("463371"),et=n("90977"),en=n("172722")},769510:function(e,t,n){n.d(t,{AG:function(){return U},BI:function(){return q},Bj:function(){return C},EW:function(){return b},Iz:function(){return B},RO:function(){return w},SQ:function(){return F},m3:function(){return H}});var o,r,a=n(825955),i=n(808549),l=n(120454),s=n(130001),d=n(771531),u=n(435946),c=n(686436),p=n(886829),v=n(450562),m=n(336205),f=n(674343),g=n(945941),h=n(699123),_=n(497744),y="/fcParam/workflowFCParam/workflowList",x="/fcParam/pluginFCParam/pluginList",w=e=>v.nyy.Api===e.flowNodeType,b=e=>v.nyy.SubWorkflow===e.flowNodeType,j=e=>e.flowNodeType===v.nyy.LLM,k=e=>e.getData(c.Ps).getFormModel(),N=(e,t)=>{var n=e.getData(c.Ps).formModel,o=k(e);return(0,h.zC)(e)&&(null==o?void 0:o.getValueIn)?o.getValueIn(t):n.getFormItemValueByPath(t)},S=(e,t)=>e.getData(c.Ps).formModel.getFormItemByPath(t),C=e=>N(e,"/inputs/workflowVersion"),I=e=>N(e,"/inputs/workflowId"),T=e=>N(e,y),P=e=>N(e,x),D=(e,t)=>(T(e)||[]).find(e=>e.workflow_id===t),E=(e,t)=>(P(e)||[]).find(e=>e.plugin_id===t),O=e=>N(e,"/inputs/apiParam"),L=(e,t)=>{var n=O(e),o=null==n?void 0:n.find(e=>e.name===t);if(!!o)return v.ycG.toLiteral(o)},M=e=>L(e,"pluginID"),F=e=>L(e,"pluginVersion"),Z=e=>L(e,"apiName"),R=(e,t)=>{var n=k(e);if((0,h.zC)(e)&&(null==n?void 0:n.getValueIn)){var o=n.getValueIn("/inputs");n.setValueIn("/inputs",(0,l._)((0,i._)({},o),{workflowVersion:t}));return}var r=S(e,"/inputs");r&&(r.value=(0,l._)((0,i._)({},r.value),{workflowVersion:t}))},V=(e,t)=>{var n=k(e);if((0,h.zC)(e)&&(null==n?void 0:n.getValueIn)){var o=n.getValueIn("/inputs");n.setValueIn("/inputs",(0,l._)((0,i._)({},o),{apiParam:null==o?void 0:o.apiParam.map(e=>"pluginVersion"===e.name?v.ycG.create("pluginVersion",t):e)}));return}var r=S(e,"/inputs");r&&(r.value=(0,l._)((0,i._)({},r.value),{apiParam:r.value.apiParam.map(e=>"pluginVersion"===e.name?v.ycG.create("pluginVersion",t):e)}))},A=(e,t,n)=>{var o=k(e),r=o.getValueIn(y);if(Array.isArray(r)){var a=r.findIndex(e=>e.workflow_id===t);a>-1&&(r[a].workflow_version=n,o.setValueIn(y,[...r]))}},z=(e,t,n)=>{var o=k(e),r=o.getValueIn(x);if(Array.isArray(r)){var a=r.findIndex(e=>e.plugin_id===t);a>-1&&(r[a].plugin_version=n,o.setValueIn(x,[...r]))}},B=e=>{var t=e.getData(p.m).getNodeData();return{latestVersionTs:t.latestVersionTs,latestVersionName:t.latestVersionName,versionName:t.versionName}},U=e=>e.getData(p.m).getNodeData();var q=(o=(0,a._)(function*(e,t){var n,o=e.getData(c.Ps),r=e.getNodeRegistry();yield null==r?void 0:null===(n=r.onInit)||void 0===n?void 0:n.call(r,{data:o.toJSON()},t),yield o.recreateForm(e.getNodeRegister().formMeta,o.toJSON())}),function(e,t){return o.apply(this,arguments)});var W=(r=(0,a._)(function*(e){try{var{data:t}=yield v.OHc.GetApiDetail(e);return{latestVersionName:null==t?void 0:t.latest_version_name,versionName:null==t?void 0:t.version_name}}catch(e){return{}}}),function(e){return r.apply(this,arguments)}),G=(e,t)=>new Promise(n=>f.u_.confirm({title:m.o.t("workflow_version_update_model_title"),content:m.o.t("workflow_version_add_model_content",{oldVersion:e,newVersion:t}),okText:m.o.t("confirm"),cancelText:m.o.t("cancel"),onOk:()=>n(!0),onCancel:()=>n(!1)}));class H{getSubWorkflowNodesWithVersion(e){var t=this.document.getAllNodes(),n=[];return t.forEach(t=>{if(b(t)&&I(t)===e){n.push({node:t,workflowId:e,version:C(t)});return}if(j(t)){var o=D(t,e);o&&n.push({node:t,workflowId:e,version:o.workflow_version})}}),n}getPluginNodesWithVersion(e){var t=this.document.getAllNodes(),n=[];return t.forEach(t=>{if(w(t)&&M(t)===e){n.push({node:t,pluginId:e,apiName:Z(t)||"",version:F(t)});return}if(j(t)){var o=E(t,e);o&&n.push({node:t,pluginId:e,apiName:o.api_name,version:o.plugin_version})}}),n}setSubWorkflowNodesVersion(e,t){var n=this;return(0,a._)(function*(){e.forEach(e=>{var{node:n,workflowId:o}=e;if(b(n)){R(n,t);return}if(j(n)){A(n,o,t);return}}),yield Promise.all(e.map(e=>{var{node:t}=e;return q(t,n.context)}))})()}setApiNodesVersion(e,t){var n=this;return(0,a._)(function*(){e.forEach(e=>{var{node:n,pluginId:o}=e;if(w(n)){V(n,t);return}if(j(n)){z(n,o,t);return}}),yield Promise.all(e.map(e=>{var{node:t}=e;return q(t,n.context)}))})()}updateSubWorkflowNodesVersion(e,t){var n=this;return(0,a._)(function*(){var o=n.getSubWorkflowNodesWithVersion(e);yield n.setSubWorkflowNodesVersion(o,t)})()}updateApiNodesVersion(e,t){var n=this;return(0,a._)(function*(){var o=n.getPluginNodesWithVersion(e);yield n.setApiNodesVersion(o,t)})()}updateNodesVersion(e,t){var n=this;return(0,a._)(function*(){if(b(e)){yield n.updateSubWorkflowNodesVersion(I(e),t);return}if(w(e)){yield n.updateApiNodesVersion(M(e)||"",t);return}})()}nodesCheck(e,t){var n=e.filter(e=>{var{version:n}=e;return n!==t}),o=n.filter(e=>{var{version:t}=e;return!!t}),r=!!n.length;return{needForce:!!o.length,needUpdate:r,needUpdateNodes:n,needForceNodes:o}}addSubWorkflowCheck(e,t){var n=this;return(0,a._)(function*(){if(!t||!e)return!0;var o=n.getSubWorkflowNodesWithVersion(e);if(!o.length)return!0;var{needForce:r,needUpdate:a,needForceNodes:i,needUpdateNodes:l}=n.nodesCheck(o,t);if(r){var s=i[0].version;if(!(yield G(s,t)))return!1}return a&&(yield n.setSubWorkflowNodesVersion(l,t)),!0})()}addApiCheck(e,t){var n=this;return(0,a._)(function*(){if(!e||!t||"0"===t)return!0;var o=n.getPluginNodesWithVersion(e);if(!o.length)return!0;var{needForce:r,needUpdate:a,needForceNodes:i,needUpdateNodes:l}=n.nodesCheck(o,t);if(r){var s=i[0],{latestVersionName:d,versionName:u}=yield W({pluginID:e,apiName:s.apiName,plugin_version:s.version,space_id:n.globalState.spaceId});if(!(yield G(u||s.version,d||t)))return!1}return a&&(yield n.setApiNodesVersion(l,t)),!0})()}}(0,s.gn)([(0,d.f)(c.L4),(0,s.w6)("design:type",void 0===c.L4?Object:c.L4)],H.prototype,"document",void 0),(0,s.gn)([(0,d.f)(_.eI),(0,s.w6)("design:type",void 0===_.eI?Object:_.eI)],H.prototype,"globalState",void 0),(0,s.gn)([(0,d.f)(g.j),(0,s.w6)("design:type",void 0===g.j?Object:g.j)],H.prototype,"context",void 0),H=(0,s.gn)([(0,u.b)()],H)},463371:function(e,t,n){n.d(t,{L:function(){return _}});var o=n(825955),r=n(808549),a=n(120454),i=n(130001),l=n(716894),s=n(992499),d=n(771531),u=n(435946),c=n(450562),p=n(861080),v=n(880623),m=n(336205),f=n(497744);function g(e){return"".concat(e.pluginID,"_").concat(e.plugin_version,"_").concat(e.api_id)}var h=()=>(0,l.F)((e,t)=>({loading:!1,data:{},error:{},getData(e){var n=g(e);return t().data[n]},setData(n,o){var i=g(n);e({data:(0,a._)((0,r._)({},t().data),{[i]:o})})},getError(e){var n=g(e);return t().error[n]},setError(n,o){var i=g(n);e({error:(0,a._)((0,r._)({},t().error),{[i]:o})})},clearError(n){var o=g(n);e({error:(0,a._)((0,r._)({},t().error),{[o]:void 0})})}}),s.X);class _{set loading(e){this.store.setState({loading:e})}get state(){return this.store.getState()}getApiDetail(e){return this.state.getData(e)}getApiError(e){return this.state.getError(e)}clearApiError(e){this.state.clearError(e)}fetchData(e,t){var n=this;return(0,o._)(function*(){var{spaceId:i,projectId:l}=n.globalState;return c.fB_.fetchQuery({queryKey:["loadApiNodeDetail",i,e.pluginID,e.plugin_version,e.apiName,e.api_id,l,t],staleTime:5e3,queryFn:(0,o._)(function*(){return yield c.OHc.GetApiDetail((0,a._)((0,r._)({},e),{space_id:i,project_id:l,plugin_from:t}),{__disableErrorToast:!0})})})})()}isApiNodeDeprecated(e){var{currentSpaceID:t,pluginSpaceID:n,pluginProductStatus:o,pluginProductUnlistType:r}=e;return o===p.s7.Unlisted&&(r===v.U7.ByAdmin||r===v.U7.ByUser&&t!==n||!1)}load(e,t){var n=this;return(0,o._)(function*(){var o,i="";try{n.loading=!0,o=(yield n.fetchData(e,t)).data}catch(t){i=t.message,"702095021"===t.code&&(i=m.o.t("workflow_node_lose_efficacy",{name:e.apiName}))}finally{n.loading=!1}if(i&&n.state.setError(e,i),o)n.state.setData(e,(0,a._)((0,r._)({},o),{apiName:o.name||o.apiName}));else{n.state.setError(e,i||"loadApiNode failed");return}return n.isApiNodeDeprecated({currentSpaceID:n.globalState.spaceId,pluginSpaceID:o.spaceID,pluginProductStatus:o.pluginProductStatus,pluginProductUnlistType:o.pluginProductUnlistType})&&n.state.setError(e,m.o.t("workflow_node_lose_efficacy",{name:e.apiName})),o})()}constructor(){this.store=h()}}(0,i.gn)([(0,d.f)(f.eI),(0,i.w6)("design:type",void 0===f.eI?Object:f.eI)],_.prototype,"globalState",void 0),_=(0,i.gn)([(0,u.b)()],_)},340667:function(e,t,n){n.d(t,{m:function(){return m}});var o=n(825955),r=n(130001),a=n(771531),i=n(435946),l=n(206058),s=n(450562),d=n(287487),u=n(28260);n(824833);var c=n(298203);n(382534);var p=n(497744),v="workflow_current_related_bot_value";class m{getURLSearchParamsBotId(){var e=new URLSearchParams(window.location.search).get("bot_id");if(!!e)return{id:e,type:"bot"}}setDefaultCase(e){return(0,o._)(function*(){var t;d.Z.getUserInfo(),null==e||null===(t=e.nodes)||void 0===t||t.find(e=>e.type===s.nyy.Start)})()}getDefaultCaseCaches(){return this.caseCaches}genSaveTypeFormCaches(){var e,t,n,o=void 0,r=this.getDefaultCaseCaches();return(null==r?void 0:null===(e=r[l.Lp.Bot])||void 0===e?void 0:e.id)&&(o={id:null==r?void 0:null===(t=r[l.Lp.Bot])||void 0===t?void 0:t.id,type:(null===(n=r[l.Lp.Bot])||void 0===n?void 0:n.type)===u.jH.Project?"project":"bot"}),o}getAsyncRelatedBotValue(e){var t=this;return(0,o._)(function*(){var{workflowId:n}=t.globalState;if(!!n){!t.setCasePromise&&(t.setCasePromise=t.setDefaultCase(e));var o=localStorage.getItem(v),r=(0,c.f5)(o),a=void 0;if("object"==typeof r&&(a=null==r?void 0:r["".concat(n)]),!a)try{yield t.setCasePromise,a=t.genSaveTypeFormCaches()}catch(e){console.error("getDefaultCase Error: ",e)}var i=t.getURLSearchParamsBotId();return i&&(a=i),a}})()}getRelatedBotValue(){var{workflowId:e}=this.globalState;if(!!e){var t=localStorage.getItem(v),n=(0,c.f5)(t),o=void 0;"object"==typeof n&&(o=null==n?void 0:n["".concat(e)]),!o&&(o=this.genSaveTypeFormCaches());var r=this.getURLSearchParamsBotId();return r&&(o=r),o}}updateRelatedBot(e,t){var n=t||this.globalState.workflowId;if(!!n){var o=localStorage.getItem(v),r=(0,c.f5)(o);(!r||"object"!=typeof r)&&(r={}),e?r["".concat(n)]=e:delete r["".concat(n)],localStorage.setItem(v,JSON.stringify(r))}}clear(){localStorage.removeItem(v)}constructor(){this.caseCaches=void 0,this.setCasePromise=void 0}}(0,r.gn)([(0,a.f)(p.eI),(0,r.w6)("design:type",void 0===p.eI?Object:p.eI)],m.prototype,"globalState",void 0),m=(0,r.gn)([(0,i.b)()],m)},468392:function(e,t,n){n.d(t,{N:function(){return m}});var o=n(825955),r=n(808549),a=n(130001),i=n(716894),l=n(992499),s=n(311807),d=n(771531),u=n(435946),c=n(450562),p=n(497744),v=()=>(0,i.F)(()=>({isReady:!1,loading:!1,saving:!1,data:null}),l.X);class m{get role(){return this.store.getState().data}set role(e){this.store.setState({data:e})}set loading(e){this.store.setState({loading:e})}load(){var e=this;return(0,o._)(function*(){var{workflowId:t}=e.globalState;e.loading=!0;var n=yield c.OHc.GetChatFlowRole({workflow_id:t,connector_id:"10000010",ext:{_caller:"CANVAS"}});e.store.setState({isReady:!0,loading:!1,data:n.role||null})})()}save(e){var t=this;return(0,o._)(function*(){var{workflowId:n}=t.globalState;yield c.OHc.CreateChatFlowRole({chat_flow_role:(0,r._)({workflow_id:n,connector_id:"10000010"},e)}),t.role=e})()}constructor(){this.store=v(),this.debounceSave=(0,s.Z)(e=>{this.save(e)},1e3)}}(0,a.gn)([(0,d.f)(p.eI),(0,a.w6)("design:type",void 0===p.eI?Object:p.eI)],m.prototype,"globalState",void 0),m=(0,a.gn)([(0,u.b)()],m)},708617:function(e,t,n){n.d(t,{R:function(){return v}});var o=n(808549),r=n(120454),a=n(130001),i=n(771531),l=n(435946),s=n(206058),d=n(309111),u=n(567282),c=n(497744),p={executeStatus2TestRunResult:e=>({[u.z0.Success]:"success",[u.z0.Cancel]:"cancel",[u.z0.Fail]:"fail"})[e]||"success"};class v{send(e,t){if(!!d.ZP&&"function"==typeof d.ZP.event)d.ZP.event(e,t)}workflowCommonParams(){return{space_id:this.globalState.spaceId,workflow_id:this.globalState.workflowId,project_id:this.globalState.projectId,workflow_mode:this.globalState.flowMode}}tryStart(e){var t=(0,o._)({},this.workflowCommonParams(),e);this.send(s.Yh.TryStart,t)}runEnd(e){var t=(0,o._)({},this.workflowCommonParams(),e);this.send(s.Yh.RunEnd,t)}formRunUIMode(e){var t=(0,o._)({},this.workflowCommonParams(),e);this.send(s.Yh.FormRunUIMode,t)}formGenDataOrigin(e){var t=(0,o._)({},this.workflowCommonParams(),e);this.send(s.Yh.FormGenDataOrigin,t)}logRawOutputDifference(e){var t=(0,o._)({},this.workflowCommonParams(),e);this.send(s.Yh.LogOutputDifference,t)}logOutputMarkdown(e){var t=(0,o._)({},this.workflowCommonParams(),e);this.send(s.Yh.LogOutputMarkdown,t)}traceOpen(e){var t=(0,o._)({},this.workflowCommonParams(),e);this.send(s.Yh.TraceOpen,t)}constructor(){this.tracker=new s.fX,this.utils=p,this.formSchemaGen={start:()=>this.tracker.start(),end:(e,t)=>{var n=this.tracker.end(e);if(!!n){var a=(0,o._)((0,r._)((0,o._)({},this.workflowCommonParams()),{duration:n.duration}),t);this.send(s.Yh.FormSchemaGen,a)}}}}}(0,a.gn)([(0,i.f)(c.eI),(0,a.w6)("design:type",void 0===c.eI?Object:c.eI)],v.prototype,"globalState",void 0),v=(0,a.gn)([(0,l.b)()],v)},969234:function(e,t,n){n.d(t,{y:function(){return m}});var o,r=n(825955),a=n(808549),i=n(130001),l=n(771531),s=n(435946),d=n(178621),u=n(450562);n(24682);var c=n(497744),p=new d.S({defaultOptions:{queries:{staleTime:1/0}}});var v=(o=(0,r._)(function*(e){var{spaceId:t,workflowId:n}=e;return yield p.fetchQuery({queryKey:["loadSubWorkflowInfo",t,n],queryFn:(0,r._)(function*(){var e,o=yield u.OHc.GetWorkflowDetailInfo({space_id:t,workflow_filter_list:[{workflow_id:n}]},{__disableErrorToast:!0});return null==o?void 0:null===(e=o.data)||void 0===e?void 0:e[0]})})}),function(e){return o.apply(this,arguments)});class m{load(){var e=this;return(0,r._)(function*(){e.globalState.projectId})()}getTriggerDynamicFormMeta(){return this.formMeta}constructor(){var e,t=this;this.subWorkflowInfos={},this.startNodeFormValues={},this.getBindWorkflowInfo=e=>{if(!!e)return this.subWorkflowInfos[e]},this.setBindWorkflowInfo=(e=(0,r._)(function*(e){if(!!e&&!t.subWorkflowInfos[e]){var n=yield v({spaceId:t.globalState.spaceId,isInProject:!!t.globalState.projectId,workflowId:e});t.subWorkflowInfos[e]=n}}),function(t){return e.apply(this,arguments)}),this.getStartNodeFormValues=()=>this.startNodeFormValues,this.setStartNodeFormValues=e=>{this.startNodeFormValues=(0,a._)({},this.startNodeFormValues,e)}}}(0,i.gn)([(0,l.f)(c.eI),(0,i.w6)("design:type",void 0===c.eI?Object:c.eI)],m.prototype,"globalState",void 0),m=(0,i.gn)([(0,s.b)()],m)},172722:function(e,t,n){n.d(t,{i:function(){return w},r:function(){return x}});var o=n(808549),r=n(120454),a=n(130001),i=n(962289),l=n(311807),s=n(771531),d=n(435946),u=n(686436),c=n(816697),p=n(450562),v=n(839974),m=n(497744),f=n(189914),g=n(15021),h=n(113051),_=n(706738),y=n(286993),x={[p.z7A.Workflow]:f.Uv.Workflow,[p.z7A.Plugin]:f.Uv.Plugin,[p.z7A.Dataset]:f.Uv.DataSet,[p.z7A.Database]:f.Uv.DataBase};class w{updateDependencySources(e,t){if(!!(0,v.L)()["bot.automation.project_multi_tab"]){var n=this.workflowDocument.getAllNodes(),a=n.filter(e=>e.flowNodeType===p.nyy.LLM);null==a||a.forEach(t=>{var n=t.getData(u.Ps).toJSON();if([{field:"fcParam.pluginFCParam.pluginList",key:"api_id"},{field:"fcParam.knowledgeFCParam.knowledgeList",key:"id"},{field:"fcParam.workflowFCParam.workflowList",key:"workflow_id"}].some(t=>{var o;return(null!==(o=(0,i.Z)(n.inputs,t.field))&&void 0!==o?o:[]).find(n=>(0,i.Z)(n,t.key)===(null==e?void 0:e.resId))})){var a=(0,r._)((0,o._)({},e),{extra:{nodeIds:[t.id]}});this.onDependencyChangeEmitter.fire(a)}});var{saveVersion:l}=this.dependencyEntity,s={[f.Uv.Workflow]:(n,a)=>{if((null==a?void 0:a.resId)===this.globalState.workflowId){var i,s,d=(null==a?void 0:a.operateType)===p.ztP.MetaUpdate,c=(null==a?void 0:null===(i=a.extra)||void 0===i?void 0:i.flowMode)!==void 0&&this.globalState.flowMode.toString()!==a.extra.flowMode,v=this.testRunService.testRunState===h.x.Executing||this.testRunService.testRunState===h.x.Paused,m=BigInt(null!==(s=null==a?void 0:a.saveVersion)&&void 0!==s?s:0);if(l>m||this.dependencyEntity.refreshModalVisible||v){d&&c&&this.workflowDocumentReload(t);return}this.workflowDocumentReload(t,m);return}var f=n.filter(e=>e.flowNodeType===p.nyy.SubWorkflow),g=[];if(null==f||f.forEach(e=>{var{workflowId:t}=e.getData(u.Ps).toJSON().inputs;(null==a?void 0:a.resId)===t&&g.push(t)}),!!g.length){var _=(0,r._)((0,o._)({},e),{extra:{nodeIds:g}});this.onDependencyChangeEmitter.fire(_)}},[f.Uv.Plugin]:(t,n)=>{var a=t.filter(e=>e.flowNodeType===p.nyy.Api),i=[];if(null==a||a.forEach(e=>{var t;(null!==(t=e.getData(u.Ps).toJSON().inputs.apiParam.find(e=>"apiID"===e.name).input.value.content)&&void 0!==t?t:"")===(null==n?void 0:n.resId)&&i.push(e.id)}),!!i.length){var l=(0,r._)((0,o._)({},e),{extra:{nodeIds:i}});this.onDependencyChangeEmitter.fire(l)}},[f.Uv.DataSet]:(e,t)=>{this.globalState.sharedDataSetStore.clearDataSetInfosMap(),this.onDependencyChangeEmitter.fire(t)},[f.Uv.DataBase]:(e,t)=>{this.onDependencyChangeEmitter.fire(t)},[f.Uv.LLM]:(e,t)=>{this.onDependencyChangeEmitter.fire(t)}};(null==e?void 0:e.bizType)&&(this.dependencyEntity.setRefreshFunc(()=>{null==t||t()}),s[x[e.bizType]](n,e))}}constructor(){this.onDependencyChangeEmitter=new c.Q5,this.onDependencyChange=this.onDependencyChangeEmitter.event,this.onSubWrokflowVersionChangeEmitter=new c.Q5,this.onSubWrokflowVersionChange=this.onSubWrokflowVersionChangeEmitter.event,this.workflowDocumentReload=(0,l.Z)((e,t)=>{var n=t&&this.dependencyEntity.saveVersion>t;if(!this.dependencyEntity.refreshModalVisible&&!n)null==e||e()},2e3)}}(0,a.gn)([(0,s.f)(y.w),(0,a.w6)("design:type",void 0===y.w?Object:y.w)],w.prototype,"modelsService",void 0),(0,a.gn)([(0,s.f)(u.L4),(0,a.w6)("design:type",void 0===u.L4?Object:u.L4)],w.prototype,"workflowDocument",void 0),(0,a.gn)([(0,s.f)(m.eI),(0,a.w6)("design:type",void 0===m.eI?Object:m.eI)],w.prototype,"globalState",void 0),(0,a.gn)([(0,s.f)(g.P),(0,a.w6)("design:type",void 0===g.P?Object:g.P)],w.prototype,"saveService",void 0),(0,a.gn)([(0,s.f)(_.k),(0,a.w6)("design:type",void 0===_.k?Object:_.k)],w.prototype,"operationService",void 0),(0,a.gn)([(0,s.f)(h.G),(0,a.w6)("design:type",void 0===h.G?Object:h.G)],w.prototype,"testRunService",void 0),(0,a.gn)([(0,s.f)(m.sv),(0,a.w6)("design:type",void 0===m.sv?Object:m.sv)],w.prototype,"dependencyEntity",void 0),w=(0,a.gn)([(0,d.b)()],w)},607595:function(e,t,n){n.d(t,{q:function(){return u}});var o=n(130001),r=n(435946),a=n(771531),i=n(686436),l=n(816697),s=n(569502),d=n(336205);class u extends i.iw{startDrag(e){var{isDragging:t,dragNode:n}=this.state;if(!t||!n){this.isDragging=!0,this.state.isDragging=!0,this.state.dragNode=e;var o=this.document.getRenderDatas(i.eG,!1).filter(e=>{var{entity:t}=e;return t.originParent?t.getNodeMeta().selectable&&t.originParent.getNodeMeta().selectable:t.getNodeMeta().selectable}).filter(e=>{var{entity:t}=e;return t.getNodeMeta().isContainer});this.state.transforms=o,this.cardDragEmitter.fire({type:"startDrag",nodeType:null==e?void 0:e.type,json:null==e?void 0:e.json})}}endDrag(){var{isDragging:e,dragNode:t}=this.state;if(!!e||!!(null==t?void 0:t.type))this.isDragging=!1,this.state.isDragging=!1,this.state.dragNode=void 0,this.state.transforms=void 0,this.cardDragEmitter.fire({type:"endDrag",nodeType:null==t?void 0:t.type,json:null==t?void 0:t.json})}canDrop(e){var{dragNode:t}=e;if(!(null==t?void 0:t.type))return!1;var{allowDrop:n,dropNode:o}=this.computeCanDrop(e);return this.setDropNode(o),n}canDropToNode(e){var{dragNodeType:t}=e,n=null!==(o=e.dropNode)&&void 0!==o?o:this.document.root;if(!t)return{allowDrop:!1};if([s.ny.Start,s.ny.End].includes(t))return{allowDrop:!1,dropNode:n};if([s.ny.Loop,s.ny.Batch].includes(t)&&(null==n?void 0:n.getNodeMeta().isContainer))return{allowDrop:!1,message:d.o.t("workflow_loop_nest_tips"),dropNode:n};if([s.ny.Break,s.ny.Continue,s.ny.SetVariable].includes(t)){var o,r,a=n.getNodeMeta(),l=null===(r=a.subCanvas)||void 0===r?void 0:r.call(a,n);return(null==l?void 0:l.isCanvas)&&l.parentNode.flowNodeType===s.ny.Loop?{allowDrop:!0,message:d.o.t("workflow_loop_release_tips"),dropNode:n}:{allowDrop:!1,message:d.o.t("workflow_loop_onlycanva_tips"),dropNode:n}}return[i.Sy.ROOT,i.Sy.SUB_CANVAS].includes(n.flowNodeType)||n.getNodeMeta().isContainer?{allowDrop:!0,dropNode:n}:{allowDrop:!1}}computeCanDrop(e){var{coord:t,dragNode:n}=e,o=this.playgroundConfig.getPosFromMouseEvent({clientX:t.x+200,clientY:t.y},!0);if(!(null==n?void 0:n.type))return{allowDrop:!1};var r=this.getCollisionTransform({position:o,dragNode:n}),a=null==r?void 0:r.entity;return this.canDropToNode({dragNodeType:n.type,dropNode:a})}initState(){this.state={isDragging:!1,dragNode:void 0,transforms:void 0,dropNode:void 0}}getCollisionTransform(e){var{transforms:t}=this.state,{position:n,dragNode:o}=e;if(!!(null==o?void 0:o.type)&&!!t&&0!==t.length){var r=new l.Ae(n.x,n.y,200,30);return t.find(e=>{var{bounds:t,entity:n}=e,o=this.document.layout.getPadding(n),a=new l.Ae(t.x+o.left+o.right,t.y,t.width,t.height);return l.Ae.intersects(r,a)})}}setDropNode(e){this.state.dropNode=e,e?this.selectService.select(e):this.selectService.clear()}constructor(e,t,n){super(),this.document=e,this.selectService=t,this.playgroundConfig=n,this.cardDragEmitter=new l.Q5,this.onCardDrag=this.cardDragEmitter.event,this.initState(),this._toDispose.pushAll([this.cardDragEmitter])}}u=(0,o.gn)([(0,r.b)(),(0,o.fM)(0,(0,a.f)(i.L4)),(0,o.fM)(1,(0,a.f)(i.oJ)),(0,o.fM)(2,(0,a.f)(i.ER)),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[void 0===i.L4?Object:i.L4,void 0===i.oJ?Object:i.oJ,void 0===i.ER?Object:i.ER])],u)},968992:function(e,t,n){n.d(t,{n:function(){return u}});var o=n(130001),r=n(710705),a=n(896335),i=n(345420),l=n(435946),s=n(816697);class d{update(e){this.onUpdateEmitter.fire(e)}close(){this.panel=null,this.key=null,this.update(null)}open(e,t){this.panel=e,this.key=t,this.update(e)}render(){return this.panel}constructor(){this.key=null,this.panel=null,this.onUpdateEmitter=new s.Q5,this.onUpdate=this.onUpdateEmitter.event}}class u{register(e,t){(0,r.Z)(e)?Object.entries(e).forEach(e=>{var[t,n]=e;this.register(t,n)}):(0,a.Z)(e)&&t&&(0,i.Z)(t)&&this.components.set(e,t)}open(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right",n=arguments.length>2?arguments[2]:void 0,o=this.getPanel(t),r=this.components.get(e);if(r&&(0,i.Z)(r)){var a=o.key;o.open(r(n),e),a&&this.onUnmountEmitter.fire({key:a,area:t}),this.onMountEmitter.fire({key:e,area:t})}}close(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"right",t=this.getPanel(e),n=t.key;t.close(),n&&this.onUnmountEmitter.fire({key:n,area:e})}closeAll(){this.close("right"),this.close("bottom")}getPanel(e){return"right"===e?this.right:this.bottom}setLayoutSize(e){this.size=e,this.onSizeChangeEmitter.fire(e)}constructor(){this.size={height:0,width:0},this.onSizeChangeEmitter=new s.Q5,this.onSizeChange=this.onSizeChangeEmitter.event,this.right=new d,this.bottom=new d,this.components=new Map,this.onMountEmitter=new s.Q5,this.onMount=this.onMountEmitter.event,this.onUnmountEmitter=new s.Q5,this.onUnmount=this.onUnmountEmitter.event}}u=(0,o.gn)([(0,l.b)()],u)},734658:function(e,t,n){n.d(t,{O:function(){return _},e:function(){return h}});var o=n(825955),r=n(808549),a=n(120454),i=n(130001),l=n(192458),s=n(771531),d=n(259674),u=n(435946),c=n(686436),p=n(816697),v=n(220192),m=n(674343),f=n(497744),g=n(607595),h=Symbol("WorkflowLinesServiceProvider");class _{init(){this.toDispose.pushAll([this.onDragLineEnd()])}dispose(){this.toDispose.dispose()}getLine(e,t){return this.linesManager.getAllLines().find(n=>{var o;return n.from.id===e&&(null===(o=n.to)||void 0===o?void 0:o.id)===t})}getAllLines(){return this.linesManager.getAllLines()}createLine(e){return this.linesManager.createLine(e)}isError(e,t){return!e||!!this.getLine(e,t)&&this.validationService.isLineError(e,t)}validateLine(e,t){var n=this.getLine(e,t);null==n||n.validate()}validateAllLine(){this.linesManager.getAllLines().forEach(e=>e.validate())}replaceLineByPort(e,t){var n=this.linesManager.getAllLines(),o=n.filter(t=>t.info.from===e.from&&t.info.fromPort===e.fromPort),i=n.filter(e=>e.info.from===t.from&&e.info.fromPort===t.fromPort),s=(0,l.Z)(o.map(e=>{var t;return null===(t=e.toPort)||void 0===t?void 0:t.id}),i.map(e=>{var t;return null===(t=e.toPort)||void 0===t?void 0:t.id}));o.filter(e=>!s.some(t=>{var n;return t===(null===(n=e.toPort)||void 0===n?void 0:n.id)})).forEach(e=>{this.linesManager.replaceLine(e.info,(0,a._)((0,r._)({},t),{to:e.info.to}))}),i.filter(e=>!s.some(t=>{var n;return t===(null===(n=e.toPort)||void 0===n?void 0:n.id)})).forEach(t=>{this.linesManager.replaceLine(t.info,(0,a._)((0,r._)({},e),{to:t.info.to}))}),this.linesManager.forceUpdate()}onDragLineEnd(){var e,t=this;return this.dragService.onDragLineEnd((e=(0,o._)(function*(e){var{fromPort:n,toPort:o,mousePos:r,line:a,originLine:i}=e;if(!i&&!!a&&!o)yield t.nodePanelService.call({fromPort:n,toPort:void 0,panelPosition:r,enableBuildLine:!0,panelProps:{enableNodePlaceholder:!0,enableScrollClose:!0},canAddNode:e=>{var{nodeType:n,containerNode:o}=e,r=t.dragService.canDropToNode({dragNodeType:n,dropNode:o});return!r.allowDrop&&m.FN.warning({content:r.message}),r.allowDrop}})}),function(t){return e.apply(this,arguments)}))}constructor(){this.toDispose=new p.K4}}(0,i.gn)([(0,s.f)(v.RJ),(0,i.w6)("design:type",void 0===v.RJ?Object:v.RJ)],_.prototype,"validationService",void 0),(0,i.gn)([(0,s.f)(f.eI),(0,i.w6)("design:type",void 0===f.eI?Object:f.eI)],_.prototype,"globalState",void 0),(0,i.gn)([(0,s.f)(c.dm),(0,i.w6)("design:type",void 0===c.dm?Object:c.dm)],_.prototype,"linesManager",void 0),(0,i.gn)([(0,s.f)(c.sS),(0,i.w6)("design:type",void 0===c.sS?Object:c.sS)],_.prototype,"nodePanelService",void 0),(0,i.gn)([(0,s.f)(g.q),(0,i.w6)("design:type",void 0===g.q?Object:g.q)],_.prototype,"dragService",void 0),(0,i.gn)([(0,d.z)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[]),(0,i.w6)("design:returntype",void 0)],_.prototype,"init",null),_=(0,i.gn)([(0,u.b)()],_)},286993:function(e,t,n){n.d(t,{w:function(){return c}});var o=n(825955),r=n(130001),a=n(771531),i=n(435946),l=n(686436),s=n(503655),d=n(450562),u=n(497744);class c{load(){var e=this;return(0,o._)(function*(){if(e.globalState.readonly&&e.globalState.spaceId===d.RV6){e.models=[];return}e.models=yield(0,s.G)({info:e.globalState.info,spaceId:e.globalState.spaceId,document:e.document,isBindDouyin:e.globalState.isBindDouyin})})()}getModels(){return this.models}getCoTModels(){return this.models.filter(e=>{var t;return null===(t=e.model_ability)||void 0===t?void 0:t.cot_display})}isCoTModel(e){return!!this.getCoTModels().find(t=>t.model_type===e)}isFunctionCallModel(e){var t;return!!(null===(t=this.getModelAbility(e))||void 0===t?void 0:t.function_call)}getModelByType(e){return this.models.find(t=>t.model_type===e)}getModelAbility(e){var t;return null===(t=this.getModelByType(e))||void 0===t?void 0:t.model_ability}constructor(){this.models=[]}}(0,r.gn)([(0,a.f)(u.eI),(0,r.w6)("design:type",void 0===u.eI?Object:u.eI)],c.prototype,"globalState",void 0),(0,r.gn)([(0,a.f)(l.L4),(0,r.w6)("design:type",void 0===l.L4?Object:l.L4)],c.prototype,"document",void 0),c=(0,r.gn)([(0,i.b)()],c)},706738:function(e,t,n){n.d(t,{E:function(){return f},k:function(){return g}});var o=n(825955),r=n(808549),a=n(120454),i=n(130001),l=n(671261),s=n(771531),d=n(435946),u=n(267334),c=n(408487),p=n(297158),v=n(839974),m=n(497744),f=Symbol("WorkflowOperationServiceProvider");class g{get spaceId(){return this.globalState.spaceId}get workflowId(){return this.globalState.workflowId}get logId(){return this.globalState.logId}get mocksetFgOption(){return{headers:{"rpc-persist-mock-traffic-enable":1}}}constructor(){var e,t,n,i,s,d,m=this;this.publish=(0,o._)(function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var t,n=!1;m.globalState.updateConfig({publishing:!0});var o=yield c.OHc.PublishWorkflow((0,r._)({workflow_id:m.workflowId,space_id:m.spaceId,has_collaborator:!1,force:!0},e));return n=!!(null===(t=o.data)||void 0===t?void 0:t.success),p.E7.successEvent({eventName:"workflow_publish_success",namespace:"workflow"}),n}catch(e){return p.E7.errorEvent({eventName:"workflow_publish_fail",namespace:"workflow",error:e}),!1}finally{m.globalState.updateConfig({publishing:!1})}}),this.copy=(0,o._)(function*(){if(m.globalState.info.workflowSourceSpaceId===u.RV){var e,t,n,o=yield c.OHc.CopyWkTemplateApi({target_space_id:m.spaceId,workflow_ids:[m.workflowId||""]},{__disableErrorToast:!0});return{workflow_id:null!==(n=null==o?void 0:null===(t=o.data)||void 0===t?void 0:null===(e=t[m.workflowId])||void 0===e?void 0:e.workflow_id)&&void 0!==n?n:""}}var{data:r}=yield c.OHc.CopyWorkflow({space_id:m.spaceId,workflow_id:m.workflowId});return r}),this.save=(e=(0,o._)(function*(e,t){var n=(0,v.L)(),{vcsData:o}=m.globalState.info,{saveVersion:r}=m.dependencyEntity,a={schema:JSON.stringify(e),workflow_id:m.workflowId,space_id:m.spaceId,submit_commit_id:(null==o?void 0:o.submit_commit_id)||"",ignore_status_transfer:t};m.globalState.projectId&&(null==n?void 0:n["bot.automation.project_multi_tab"])&&(0,l.Z)(a,"save_version",r.toString()),yield c.OHc.SaveWorkflow(a),m.globalState.projectId&&m.dependencyEntity.addSaveVersion()}),function(t,n){return e.apply(this,arguments)}),this.testRun=(t=(0,o._)(function*(e){var t,n,{baseParam:o,input:i}=e,l=(0,r._)({},m.mocksetFgOption),s=m.globalState.isViewHistory||m.globalState.isCollaboratorMode&&(null===(t=m.globalState.info.vcsData)||void 0===t?void 0:t.type)!==c.MZY.Draft?null===(n=m.globalState.info.vcsData)||void 0===n?void 0:n.submit_commit_id:"",{data:d}=yield c.OHc.WorkFlowTestRun((0,a._)((0,r._)({},o),{commit_id:s,input:i}),l);return d}),function(e){return t.apply(this,arguments)}),this.testOneNode=(n=(0,o._)(function*(e){return yield c.OHc.WorkflowNodeDebugV2(e,m.mocksetFgOption)}),function(e){return n.apply(this,arguments)}),this.getProcess=(i=(0,o._)(function*(e,t){var n={workflow_id:m.workflowId,space_id:m.spaceId,execute_id:e,sub_execute_id:t};return m.logId&&(n.log_id=m.logId),n.need_async=!t,yield c.OHc.GetWorkFlowProcess(n)}),function(e,t){return i.apply(this,arguments)}),this.queryNodeType=(0,o._)(function*(){var e={workflow_id:m.workflowId,space_id:m.spaceId},{data:t}=yield c.OHc.QueryWorkflowNodeTypes(e);return t}),this.getSubWorkflowList=(s=(0,o._)(function*(e){var{workflowIds:t,filterType:n,pageParam:o,name:r,size:a}=e,{data:i}=yield c.OHc.GetReleasedWorkflows({workflow_ids:t,space_id:m.spaceId,type:n,page:o,name:r,size:a,flow_mode:c.wz8.All}),l=i.workflow_list;return null==l?void 0:l.filter(e=>e.workflow_id!==m.workflowId)}),function(e){return s.apply(this,arguments)}),this.getReference=(0,o._)(function*(){var e={workflow_id:m.workflowId,space_id:m.spaceId},{data:t}=yield c.OHc.GetWorkflowReferences(e);return t.workflow_list||[]}),this.validateSchema=(d=(0,o._)(function*(e,t){var{botId:n,projectId:o}=t||{},{data:r}=yield c.OHc.ValidateSchema({schema:JSON.stringify(e),bind_project_id:o,bind_bot_id:n});return r}),function(e,t){return d.apply(this,arguments)})}}(0,i.gn)([(0,s.f)(m.eI),(0,i.w6)("design:type",void 0===m.eI?Object:m.eI)],g.prototype,"globalState",void 0),(0,i.gn)([(0,s.f)(m.sv),(0,i.w6)("design:type",void 0===m.sv?Object:m.sv)],g.prototype,"dependencyEntity",void 0),g=(0,i.gn)([(0,d.b)()],g)},113051:function(e,t,n){n.d(t,{G:function(){return k},x:function(){return b}});var o,r=n(825955),a=n(808549),i=n(120454),l=n(130001),s=n(529801),d=n(771531),u=n(259674),c=n(435946),p=n(686436),v=n(816697),m=n(408487),f=n(297158),g=n(298203),h=n(707107),_=n(497744),y=n(115597),x=n(706738),w=n(708617);var b=((o={}).Idle="idle",o.Executing="executing",o.Canceled="canceled",o.Paused="paused",o.Succeed="succeed",o.Failed="failed",o),j={[m.MZx.Cancel]:"canceled",[m.MZx.Fail]:"failed",[m.MZx.Success]:"succeed"};class k{get testRunState(){return this._testRunState}setTestRunState(e){if(e!==this.testRunState)this.testRunStateEmitter.fire({prevState:this.testRunState,curState:e}),this._testRunState=e}init(){this.playground.toDispose.onDispose(()=>this.dispose()),this.onTestRunStateChange(e=>{var{prevState:t,curState:n}=e;this.reportTestRunResult(t,n)})}dispose(){this.testFormState.clearFormData(),this.testFormState.clearTestFormDefaultValue(),this.testFormState.unfreezeTestRun(),this.clearTestRun()}getViewStatus(){return this.globalState.viewStatus}getTestFormNode(){var e=this.testFormState.formSchema;return e&&e.id&&this.document.getNode(e.id)||null}testRunOneNode(e){var t=this;return(0,r._)(function*(){var{nodeId:n,input:o,batch:r,setting:i,botId:l,useProject:s}=e;if(!t.globalState.config.saving){t.execState.updateConfig({isSingleMode:!0}),t.testFormState.freezeTestRun(n),t.execState.closeSideSheet();try{t.globalState.viewStatus=_.tn.EXECUTING;var d,u,c={};l&&(s?Object.assign(c,{project_id:l}):Object.assign(c,{bot_id:l})),t.globalState.projectId&&Object.assign(c,{project_id:t.globalState.projectId});var p=yield t.operationService.testOneNode((0,a._)({workflow_id:t.globalState.workflowId,space_id:t.globalState.spaceId,node_id:n,input:o,batch:r,setting:i},c)),v=null===(u=p.data)||void 0===u?void 0:u.execute_id;v&&(t.setTestRunState("executing"),t.execState.updateConfig({executeId:v}),d=yield t.loop(v),t.finishProcess()),t.reporter.runEnd({testrun_type:"node",testrun_result:t.reporter.utils.executeStatus2TestRunResult(d),execute_id:v})}catch(e){throw d=m.MZx.Fail,t.clearTestRunResult(),t.reporter.runEnd({testrun_type:"node",testrun_result:"error"}),e}finally{t.setTestRunState(j[d])}}})()}getRTProcessResult(e){var t=this;return(0,r._)(function*(){var n,{executeId:o}=e;if(!!o)try{var r=yield t.runProcess({executeId:o});t.execState.updateConfig(r||{}),t.updateExecuteState(r),n=null==r?void 0:r.executeStatus,((null==r?void 0:r.executeStatus)===m.MZx.Running||(null==r?void 0:r.executeStatus)===0)&&(t.globalState.viewStatus=_.tn.EXECUTING,t.setTestRunState("executing"),yield Promise.all([(0,g._v)(300),t.waitContinue()]),n=yield t.loop(o)),t.finishProcess()}catch(e){n=m.MZx.Fail,t.clearTestRunResult(),t.execState.updateConfig({systemError:e.msg||e.message})}finally{t.globalState.inPluginUpdated=!1,t.setTestRunState(j[n])}})()}testRunTrigger(e){var t=this;return(0,r._)(function*(){if(!t.globalState.config.saving&&!!t.globalState.projectId){t.testFormState.freezeTestRun(e);var n="";try{t.globalState.viewStatus=_.tn.EXECUTING;var o,r,a=yield m.OHc.TestRunTrigger({space_id:t.globalState.spaceId,project_id:t.globalState.projectId,trigger_id:e});(n=(null==a?void 0:null===(r=a.data)||void 0===r?void 0:r.execute_id)||"")&&(t.execState.updateConfig({executeId:n}),t.setTestRunState("executing"),o=yield t.loop(n),t.finishProcess()),t.reporter.runEnd({testrun_type:"trigger",testrun_result:t.reporter.utils.executeStatus2TestRunResult(o),execute_id:n})}catch(e){o=m.MZx.Fail,t.clearTestRunResult(),t.execState.updateConfig({systemError:e.msg||e.message}),t.reporter.runEnd({testrun_type:"trigger",testrun_result:"error"})}finally{t.globalState.inPluginUpdated=!1,t.setTestRunState(j[o])}}})()}constructor(){var e,t,n,o,l=this;this.testRunStateEmitter=new v.Q5,this.onTestRunStateChange=this.testRunStateEmitter.event,this._testRunState="idle",this.clearTestRun=()=>{this.clearTestRunResult(),this.clearTestRunState()},this.clearTestRunResult=()=>{this.testFormState.unfreezeTestRun(),this.globalState.viewStatus=_.tn.DEFAULT,this.execState.hasNodeResult&&this.execState.clearNodeResult(),this.execState.clearNodeErrorMap(),this.execState.updateConfig({executeLogId:void 0,systemError:void 0,isSingleMode:void 0,executeId:""}),this.execState.clearNodeEvents()},this.clearTestRunState=()=>{this.setTestRunState("idle")},this.cancelTestRun=(0,r._)(function*(){var{executeId:e}=l.execState.config;(0,h.Gg)(h.Kg.workflow_testrun_result_front,{space_id:l.globalState.spaceId,workflow_id:l.globalState.workflowId,testrun_id:e||"",action:"manual_end"});try{yield m.OHc.CancelWorkFlow({execute_id:e||"",workflow_id:l.globalState.workflowId,space_id:l.globalState.spaceId})}catch(e){throw e}finally{l.continueTestRun()}}),this.updateExecuteState=e=>{var{nodeResults:t,executeStatus:n,executeId:o,reason:r,projectId:a,nodeEvents:i}=e;t&&t.length&&t.forEach(e=>{var{nodeId:n}=e;if(n){this.execState.setNodeExecResult(n,e),this.linesManager.getAllLines().filter(t=>{var n;return(null==t?void 0:null===(n=t.to)||void 0===n?void 0:n.id)===e.nodeId}).forEach(n=>{var o,r=null===(o=t.find(e=>e.nodeId===n.from.id))||void 0===o?void 0:o.nodeStatus;n.processing=!!(e.nodeStatus===m.nBi.Running&&(r===m.nBi.Success||r===m.nBi.Running))});var o,r=(null===(o=e.errorLevel)||void 0===o?void 0:o.toLocaleLowerCase())||"";["error","warning","pending"].includes(r||"")&&this.execState.setNodeError(n,[{nodeId:n,errorInfo:e.errorInfo||"",errorLevel:r,errorType:"node"}])}}),this.execState.setNodeEvents(i),this.execState.updateConfig({projectId:a,executeLogId:o,systemError:n&&[m.MZx.Cancel,m.MZx.Fail].includes(n)?r:""})},this.runProcess=(e=(0,r._)(function*(e){var t,{executeId:n,processResp:o,subExecuteId:r}=e,s=o||(yield l.operationService.getProcess(n,r)).data;return null==s||null===(t=s.nodeResults)||void 0===t||t.forEach(e=>{"Warn"===e.errorLevel&&(e.errorLevel="warning");try{if(e.batch){var t=JSON.parse(e.batch);e.batch=JSON.stringify(t.map(e=>(0,i._)((0,a._)({},e),{errorLevel:"Warn"===e.errorLevel?"warning":e.errorLevel})))}}catch(e){console.error(e)}}),s||{}}),function(t){return e.apply(this,arguments)}),this.pauseTestRun=()=>{this.setTestRunState("paused")},this.continueTestRun=()=>{"paused"===this.testRunState&&this.setTestRunState("executing")},this.waitContinue=(0,r._)(function*(){if("paused"===l.testRunState)return new Promise(e=>{l.onTestRunStateChange(t=>{var{curState:n}=t;"paused"!==n&&e(!0)})})}),this.loop=(t=(0,r._)(function*(e){var t=yield l.runProcess({executeId:e});return(l.execState.updateConfig(t||{}),l.updateExecuteState(t),(null==t?void 0:t.executeStatus)!==m.MZx.Running)?null==t?void 0:t.executeStatus:(yield Promise.all([(0,g._v)(300),l.waitContinue()]),l.loop(e))}),function(e){return t.apply(this,arguments)}),this.finishProcess=()=>{this.testFormState.unfreezeTestRun(),this.globalState.viewStatus=_.tn.DONE,!this.globalState.isViewHistory&&this.globalState.reload()},this.reportTestRunResult=(e,t)=>{var{executeId:n,isSingleMode:o}=this.execState.config;if(!o&&!!["succeed","failed"].includes(t))"succeed"===t&&(0,h.Gg)(h.Kg.workflow_testrun_result_front,{space_id:this.globalState.spaceId,workflow_id:this.globalState.workflowId,testrun_id:n,action:"testrun_end",results:"success"}),"failed"===t&&("idle"===e&&(0,h.Gg)(h.Kg.workflow_testrun_result_front,{space_id:this.globalState.spaceId,workflow_id:this.globalState.workflowId,action:"testrun_end",results:"fail",fail_end:"server_end",errtype:"trigger_error"}),(0,h.Gg)(h.Kg.workflow_testrun_result_front,{space_id:this.globalState.spaceId,workflow_id:this.globalState.workflowId,testrun_id:n,action:"testrun_end",results:"fail",fail_end:"server_end",errtype:"run_error"}))},this.testRun=(n=(0,r._)(function*(e,t,n){if(!l.globalState.config.saving){l.testFormState.freezeTestRun(y.TJ);var o,r="";try{l.execState.closeSideSheet(),l.globalState.viewStatus=_.tn.EXECUTING;var s={workflow_id:l.globalState.workflowId,space_id:l.globalState.spaceId};t&&(s[n?"project_id":"bot_id"]=t),l.globalState.projectId&&!s.project_id&&(s.project_id=l.globalState.projectId);var d=yield l.operationService.testRun({baseParam:s,input:e}).catch(e=>{throw(0,h.Gg)(h.Kg.workflow_testrun_result_front,{space_id:l.globalState.spaceId,workflow_id:l.globalState.workflowId,action:"testrun_end",results:"fail",fail_end:"server_end",errtype:"trigger_error"}),(0,i._)((0,a._)({},e),{errtype:"trigger_error"})});(r=(null==d?void 0:d.execute_id)||"")&&(l.execState.updateConfig({executeId:r}),l.setTestRunState("executing"),o=yield l.loop(r),l.finishProcess()),l.reporter.runEnd({testrun_type:"flow",testrun_result:l.reporter.utils.executeStatus2TestRunResult(o),execute_id:r})}catch(e){o=m.MZx.Fail,l.clearTestRunResult(),l.execState.updateConfig({systemError:e.msg||e.message}),l.reporter.runEnd({testrun_type:"flow",testrun_result:"error"})}finally{o===m.MZx.Fail&&l.execState.openSideSheet(),l.globalState.inPluginUpdated=!1,l.setTestRunState(j[o])}}}),function(e,t,o){return n.apply(this,arguments)}),this.getProcessResult=(o=(0,r._)(function*(e){var{showNodeResults:t,executeId:n,processResp:o,subExecuteId:r}=e;try{var a=yield l.runProcess({executeId:n,processResp:o,subExecuteId:r});return l.execState.updateConfig((0,s.Z)(a,"nodeEvents")),t&&(l.globalState.viewStatus=_.tn.DONE,l.updateExecuteState((0,s.Z)(a,"nodeEvents"))),a}catch(e){throw f.E7.errorEvent({eventName:"workflow_get_process_result_fail",namespace:"workflow",error:e}),e}}),function(e){return o.apply(this,arguments)}),this.setTestFormDefaultValue=e=>{this.testFormState.setTestFormDefaultValue(e)}}}(0,l.gn)([(0,d.f)(p.L4),(0,l.w6)("design:type",void 0===p.L4?Object:p.L4)],k.prototype,"document",void 0),(0,l.gn)([(0,d.f)(_.eI),(0,l.w6)("design:type",void 0===_.eI?Object:_.eI)],k.prototype,"globalState",void 0),(0,l.gn)([(0,d.f)(_.qZ),(0,l.w6)("design:type",void 0===_.qZ?Object:_.qZ)],k.prototype,"execState",void 0),(0,l.gn)([(0,d.f)(_.JM),(0,l.w6)("design:type",void 0===_.JM?Object:_.JM)],k.prototype,"testFormState",void 0),(0,l.gn)([(0,d.f)(p.dm),(0,l.w6)("design:type",void 0===p.dm?Object:p.dm)],k.prototype,"linesManager",void 0),(0,l.gn)([(0,d.f)(x.k),(0,l.w6)("design:type",void 0===x.k?Object:x.k)],k.prototype,"operationService",void 0),(0,l.gn)([(0,d.f)(w.R),(0,l.w6)("design:type",void 0===w.R?Object:w.R)],k.prototype,"reporter",void 0),(0,l.gn)([(0,d.f)(p.XQ),(0,l.w6)("design:type",void 0===p.XQ?Object:p.XQ)],k.prototype,"playground",void 0),(0,l.gn)([(0,u.z)(),(0,l.w6)("design:type",Function),(0,l.w6)("design:paramtypes",[]),(0,l.w6)("design:returntype",void 0)],k.prototype,"init",null),k=(0,l.gn)([(0,c.b)()],k)},15021:function(e,t,n){n.d(t,{P:function(){return E}});var o=n(825955),r=n(130001),a=n(311807),i=n(788637),l=n(771531),s=n(435946),d=n(686436),u=n(816697),c=n(172637),p=n(360903),v=n(364676),m=n(408487),f=n(450562),g=n(287487),h=n(458620),_=n(297158),y=n(336205),x=n(839974),w=n(727914),b=n(286993),j=n(969234),k=n(340667),N=n(699123),S=n(945941),C=n(497744),I=n(706738),T="100001",P="900001",D="110100";class E{initNodeData(e){var t=this;return(0,o._)(function*(){for(var n=[],o=[...e];o.length>0;){var r=o.pop(),a=(0,N.pC)(r.type);(null==a?void 0:a.onInit)&&n.push(a.onInit(r,t.context)),r.blocks&&r.blocks.length>0&&o.push(...r.blocks)}yield Promise.all(n)})()}loadDocument(e){var t=this;return(0,o._)(function*(){t.workflowDocument=e;var{workflowId:n,getProjectApi:o}=t.globalState,r=o(),a=Date.now();try{if(!n)throw Error(y.o.t("workflow_detail_error_interface_initialization"));null==r||r.setWidgetUIState("saving"),t.hideRenderLayer();var i,l,s=g.Z.getUserInfo(),d=null!==(l=null!==(i=null==s?void 0:s.locale)&&void 0!==i?i:navigator.language)&&void 0!==l?l:"en-US",[,u]=yield Promise.all([t.context.loadNodeInfos(d),t.loadWorkflowJson()]);yield t.loadGlobalVariables(u),yield t.modelsService.load();try{yield t.triggerService.load()}catch(e){_.kg.error(e.message)}t.context.models=t.modelsService.getModels(),v.I.getState().setNodes(u.nodes),v.I.getState().setEdges(u.edges);var c=Date.now()-a,p=Date.now();yield t.initNodeData(u.nodes),yield t.workflowDocument.fromJSON(u);var m=Date.now()-p;t.globalState.updateConfig({loading:!1}),null==r||r.setWidgetUIState("normal"),!t.globalState.readonly&&(t.saveOnChangeDisposable=e.onContentChange(t.listenContentChange));var h=Date.now();yield t.fitView();var x=Date.now()-h,w=Date.now()-a;f.E7u.event({eventName:"workflow_load_document",meta:{totalTime:w,loadDateTime:c,renderTime:m,fitViewTime:x}})}catch(e){throw t.globalState.updateConfig({loadingError:e.message,loading:!1}),null==r||r.setWidgetUIState("error"),e}finally{t.showRenderLayer()}})()}loadGlobalVariables(e){var t=this;return(0,o._)(function*(){var n;if(!t.globalState.isInIDE&&!(null===(n=t.globalState.playgroundProps)||void 0===n?void 0:n.disableGetTestCase)){var o=yield t.relatedBotService.getAsyncRelatedBotValue(e);if(!(null==o?void 0:o.id)||!(null==o?void 0:o.type))return;return t.globalVariableService.loadGlobalVariables(null==o?void 0:o.type,null==o?void 0:o.id)}return t.globalVariableService.loadGlobalVariables("project",t.globalState.projectId)})()}fitView(){var e=this;return(0,o._)(function*(){yield(0,d.gw)(100),yield new Promise(e=>{window.requestAnimationFrame(()=>e())}),e.workflowDocument.fitView(!1),yield(0,d.gw)(100)})()}isAssociateChange(e){var t=!1,n=this.workflowDocument.getAssociatedNodes();return e instanceof d.GA?t=n.some(t=>t.id===e.id):e instanceof d.e2&&(t=n.some(t=>t.id===e.from.id)),t}hideRenderLayer(){this.stackingContextManager.node.style.opacity="0"}showRenderLayer(){this.stackingContextManager.node.style.opacity="1"}constructor(){var e,t=this;this.onSavedEmitter=new u.Q5,this.onSaved=this.onSavedEmitter.event,this.ignoreStatusTransfer=!0,this.loadWorkflowJson=(e=(0,o._)(function*(e,n,o){var{workflowId:r,spaceId:a,workflowCommitId:i,playgroundProps:l,flowMode:s,logId:d,projectId:u,projectCommitVersion:c}=t.globalState,p=(0,x.L)(),v=!!(u&&c),g=!!(null==l?void 0:l.executeId);if(v)h=yield t.globalState.loadHistory({commit_id:e,project_version:c,project_id:u,log_id:d,type:n||m.lcl.SubmitOperate,env:o});else if(e||g)h=yield t.globalState.loadHistory({commit_id:e,log_id:d,type:n||m.lcl.SubmitOperate,execute_id:g?null==l?void 0:l.executeId:void 0,sub_execute_id:null==l?void 0:l.subExecuteId,env:o});else if(i)h=yield t.globalState.loadHistory({commit_id:i,log_id:d,type:(null===(y=t.globalState.config)||void 0===y?void 0:null===(_=y.playgroundProps)||void 0===_?void 0:_.commitOptType)||m.lcl.SubmitOperate});else if((null==l?void 0:l.from)==="communityTrial")h=yield t.globalState.loadHistory({commit_id:i,type:(null===(b=t.globalState.config)||void 0===b?void 0:null===(w=b.playgroundProps)||void 0===w?void 0:w.commitOptType)||m.lcl.SubmitOperate});else{h=yield t.globalState.load(r,a);var h,_,y,w,b,j,k,N=null===(j=t.globalState.config)||void 0===j?void 0:j.info;(null==p?void 0:p["bot.automation.project_multi_tab"])&&u&&t.dependencyEntity.setSaveVersion(BigInt(null!==(k=null==N?void 0:N.save_version)&&void 0!==k?k:""))}if(!h||0===h.nodes.length)h=s===m.wz8.SceneFlow?{nodes:[{id:T,type:f.nyy.Start,meta:{position:{x:0,y:0}},data:{outputs:[{type:"string",name:"",required:!0}]}},{id:P,type:f.nyy.End,meta:{position:{x:2e3,y:0}}},{id:D,type:f.nyy.SceneChat,meta:{position:{x:1e3,y:0}}}],edges:[{sourceNodeID:T,targetNodeID:D}]}:{nodes:[{id:T,type:f.nyy.Start,meta:{position:{x:0,y:0}},data:{outputs:[{type:"string",name:"",required:!0}]}},{id:P,type:f.nyy.End,meta:{position:{x:1e3,y:0}}}],edges:[]};return!h.edges&&(h.edges=[]),h}),function(t,n,o){return e.apply(this,arguments)}),this.save=(0,o._)(function*(){var{getProjectApi:e}=t.globalState,n=e(),o=(0,x.L)();try{if(t.globalState.readonly||t.globalState.loading)return;f.E7u.event({eventName:"workflow_save"}),t.globalState.updateConfig({saveLoading:!0,saving:!0,savingError:!1}),null==n||n.setWidgetUIState("saving");var r,a=yield t.workflowDocument.toJSON();if(t.globalState.config.schemaGray&&(a.versions=t.globalState.config.schemaGray),v.I.getState().setNodes(a.nodes),v.I.getState().setEdges(a.edges),0===a.nodes.length)throw null==n||n.setWidgetUIState("error"),new w.sH(h.b.parmasValidation,"Saving Error");yield t.operationService.save(a,t.ignoreStatusTransfer),t.ignoreStatusTransfer=!0,yield t.globalState.reload(),t.globalState.updateConfig({saveLoading:!1,saving:!1,savingError:!1}),null==n||n.setWidgetUIState("normal");var i=t.globalState.config.info;(null==o?void 0:o["bot.automation.project_multi_tab"])&&t.globalState.projectId&&t.dependencyEntity.setSaveVersion(BigInt(null!==(r=null==i?void 0:i.save_version)&&void 0!==r?r:""))}catch(e){if(t.globalState.updateConfig({saveLoading:!1,saving:!1,savingError:!0}),null==n||n.setWidgetUIState("error"),"WorkflowSubWorkflowResourceLose"===e.eventName||"WorkflowApiNodeResourceLose"===e.eventName||(null==e?void 0:e.name)==="CustomNodeError")_.kg.warning(e.message);else if("720702239"===e.code&&(null==o?void 0:o["bot.automation.project_multi_tab"]))throw t.dependencyEntity.setRefreshModalVisible(!0),e;else throw e}finally{t.onSavedEmitter.fire()}}),this.listenContentChange=e=>{var{type:t,entity:n}=e,{getProjectApi:o}=this.globalState,r=o();this.globalState.updateConfig({saving:!0}),null==r||r.setWidgetUIState("saving");var a=this.isAssociateChange(n);t!==d.fT.MOVE_NODE&&t!==d.fT.META_CHANGE&&a?(this.ignoreStatusTransfer=!1,this.highPrioritySave()):this.lowPrioritySave()},this.highPrioritySave=(0,a.Z)(()=>{f.E7u.event({eventName:"workflow_high_priority_save"}),this.save()},1e3),this.lowPrioritySave=(0,a.Z)(()=>{f.E7u.event({eventName:"workflow_low_priority_save"}),this.highPrioritySave()},2e3),this.waitSaving=()=>{if(!!this.globalState.config.saving)return new Promise(e=>{this.onSaved(()=>e(!0))})},this.reloadDocument=(0,o._)(function*(){var e,n,{commitId:o,type:r,env:a,customWorkflowJson:l}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};yield t.waitSaving();var s=(0,i.Z)(l)?yield t.loadWorkflowJson(o,r,a):l;if(!!s)t.hideRenderLayer(),null===(e=t.saveOnChangeDisposable)||void 0===e||e.dispose(),yield t.initNodeData(null!==(n=null==s?void 0:s.nodes)&&void 0!==n?n:[]),yield t.workflowDocument.reload(s,500),!t.globalState.readonly&&(t.saveOnChangeDisposable=t.workflowDocument.onContentChange(t.listenContentChange)),yield t.fitView(),t.showRenderLayer()})}}(0,r.gn)([(0,l.f)(C.eI),(0,r.w6)("design:type",void 0===C.eI?Object:C.eI)],E.prototype,"globalState",void 0),(0,r.gn)([(0,l.f)(p.t),(0,r.w6)("design:type",void 0===p.t?Object:p.t)],E.prototype,"nodesService",void 0),(0,r.gn)([(0,l.f)(I.k),(0,r.w6)("design:type",void 0===I.k?Object:I.k)],E.prototype,"operationService",void 0),(0,r.gn)([(0,l.f)(b.w),(0,r.w6)("design:type",void 0===b.w?Object:b.w)],E.prototype,"modelsService",void 0),(0,r.gn)([(0,l.f)(j.y),(0,r.w6)("design:type",void 0===j.y?Object:j.y)],E.prototype,"triggerService",void 0),(0,r.gn)([(0,l.f)(c.f),(0,r.w6)("design:type",void 0===c.f?Object:c.f)],E.prototype,"globalVariableService",void 0),(0,r.gn)([(0,l.f)(k.m),(0,r.w6)("design:type",void 0===k.m?Object:k.m)],E.prototype,"relatedBotService",void 0),(0,r.gn)([(0,l.f)(C.sv),(0,r.w6)("design:type",void 0===C.sv?Object:C.sv)],E.prototype,"dependencyEntity",void 0),(0,r.gn)([(0,l.f)(S.j),(0,r.w6)("design:type",void 0===S.j?Object:S.j)],E.prototype,"context",void 0),(0,r.gn)([(0,l.f)(d.ER),(0,r.w6)("design:type",void 0===d.ER?Object:d.ER)],E.prototype,"playgroundConfig",void 0),(0,r.gn)([(0,l.f)(d.ZO),(0,r.w6)("design:type",void 0===d.ZO?Object:d.ZO)],E.prototype,"resetLayoutService",void 0),(0,r.gn)([(0,l.f)(d.XQ),(0,r.w6)("design:type",void 0===d.XQ?Object:d.XQ)],E.prototype,"playground",void 0),(0,r.gn)([(0,l.f)(d.XN),(0,r.w6)("design:type",void 0===d.XN?Object:d.XN)],E.prototype,"stackingContextManager",void 0),E=(0,r.gn)([(0,s.b)()],E)},786629:function(e,t,n){n.r(t),n.d(t,{WorkflowClipboardJSON:()=>u.WorkflowClipboardJSON,WorkflowPasteShortcutsContribution:()=>G,WORKFLOW_CLIPBOARD_TYPE:()=>c,WorkflowExportShortcutsContribution:()=>eg,bindShortcuts:()=>m,WorkflowClipboardSource:()=>u.WorkflowClipboardSource,WorkflowDeleteShortcutsContribution:()=>eu,WorkflowSelectAllShortcutsContribution:()=>e_,WorkflowClipboardData:()=>u.WorkflowClipboardData,WorkflowCopyShortcutsContribution:()=>em,WorkflowLoadShortcutsContribution:()=>eh,WorkflowLayoutShortcutsContribution:()=>ei,WorkflowZoomShortcutsContribution:()=>ef,WorkflowClipboardNodeJSON:()=>u.WorkflowClipboardNodeJSON});var o,r,a,i,l,s,d,u={};n.r(u);var c="coze-workflow-clipboard-data",p="coze-workflow-export-data",v=n("816697"),m=(e,t,n)=>{n.forEach(n=>{(0,v.KV)(e,n,[t])})},f=n("297158"),g=n("674343"),h=e=>function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];try{return e(...n)}catch(t){g.FN.error({content:"[Coze Workflow] Failed to run function: ".concat(e.name||"() => any")}),console.error("Failed to run function: ",t),f.E7.errorEvent({namespace:"workflow",eventName:"workflow_shortcuts_error",error:t}),f.kg.error(t)}},_=n("825955"),y=n("808549"),x=n("120454"),w=n("473980"),b=n("130001"),j=n("771531"),k=n("435946"),N=n("686436"),S=n("336205"),C=n("973922"),I=n("994983"),T=n("801815"),P=n("450562");o=s||(s={}),r=(0,T.kP)("1234567890",6),o.getAllNodeIds=e=>{var t=new Set,n=e=>{var o;t.add(e.id),(null===(o=e.blocks)||void 0===o?void 0:o.length)&&e.blocks.forEach(e=>n(e))};return e.nodes.forEach(e=>n(e)),Array.from(t)},o.generateNodeReplaceMap=(e,t)=>{var n=new Map;return e.forEach(e=>{if(t(e))n.set(e,e);else{var o;do o="1".concat(r());while(!t(o));n.set(e,o)}}),n},a=e=>null!=e,i=e=>{var t,n,o,r,i,l,s,{node:d}=e;return!!((null==d?void 0:d.key)&&["sourceNodeID","targetNodeID"].includes(d.key)&&(null===(n=d.parent)||void 0===n?void 0:null===(t=n.parent)||void 0===t?void 0:t.key)==="edges"||(null==d?void 0:d.key)==="id"&&a(null===(o=d.container)||void 0===o?void 0:o.type)&&a(null===(r=d.container)||void 0===r?void 0:r.meta)&&a(null===(i=d.container)||void 0===i?void 0:i.data)||(null==d?void 0:d.key)==="blockID"&&a(null===(l=d.container)||void 0===l?void 0:l.name)&&(null===(s=d.container)||void 0===s?void 0:s.source)==="block-output")||!1},o.replaceNodeId=(e,t)=>((0,P.fwJ)(e,e=>{if(!!i(e)){var{node:n}=e;t.has(n.value)&&e.setValue(t.get(n.value))}}),e);var D=e=>{var{json:t,isUniqueId:n}=e,o=s.getAllNodeIds(t),r=s.generateNodeReplaceMap(o,n);return s.replaceNodeId(t,r)},E=n("861080");class O{setNext(e){return this.next=e,e}run(e){var t,n,o=this.validate(e);return null!==o?o:null===(n=null===(t=this.next)||void 0===t?void 0:t.run(e))||void 0===n||n}constructor(){this.next=null}}class L extends O{validate(e){var{node:t}=e;if(t.type!==P.nyy.Api)return null;var n=t._temp.externalData;return(null==n?void 0:n.pluginProductStatus)===E.s7.Listed}}class M extends O{validate(e){var{node:t}=e;return![P.nyy.Dataset,P.nyy.DatasetWrite,P.nyy.Database,P.nyy.DatabaseQuery,P.nyy.DatabaseCreate,P.nyy.DatabaseUpdate,P.nyy.DatabaseDelete,P.nyy.SubWorkflow,P.nyy.Imageflow].includes(t.type)&&null}}class F extends O{validate(e){var{node:t,dragService:n,parent:o}=e;return!!n.canDropToNode({dragNodeType:t.type,dropNode:o}).allowDrop&&null}}class Z extends O{validate(e){var{node:t,parent:n}=e,o=t.type;if(!n)return null;if([P.nyy.Break,P.nyy.Continue,P.nyy.SetVariable].includes(o)){var r,a=n.getNodeMeta(),i=null===(r=a.subCanvas)||void 0===r?void 0:r.call(a,n);return(null==i?void 0:i.isCanvas)&&i.parentNode.flowNodeType===P.nyy.Loop}return null}}class R extends O{validate(e){var{node:t,parent:n}=e,o=t.type;return n?[P.nyy.Loop,P.nyy.Batch].includes(o)?n.flowNodeType!==N.Sy.SUB_CANVAS:null:null}}class V extends O{validate(e){var{source:t,globalState:n}=e;return t.spaceId===n.spaceId||null}}class A extends O{validate(e){var{source:t,globalState:n}=e;return t.workflowId===n.workflowId||null}}class z extends O{validate(e){var{node:t}=e;return t.type!==P.nyy.SceneChat&&t.type!==P.nyy.SceneVariable&&null}}class B extends O{validate(e){var t,n,{node:o,globalState:r}=e;return(o.type!==P.nyy.SubWorkflow||(null===(n=o.data)||void 0===n?void 0:null===(t=n.inputs)||void 0===t?void 0:t.workflowId)!==r.workflowId)&&null}}class U extends O{validate(){return null}}var q=e=>{var t=new U;return t.setNext(new F).setNext(new Z).setNext(new R).setNext(new B).setNext(new A).setNext(new z).setNext(new V).setNext(new L).setNext(new M),t.run(e)},W=e=>{var{data:t,globalState:n}=e;return t.type===c&&t.source.host===window.location.host&&(t.source.isDouyin===n.isBindDouyin&&t.source.flowMode===n.flowMode||(g.FN.warning({content:S.o.t("workflow_node_copy_othercanva",{},"当前画布类型不一致，无法粘贴"),showClose:!1}),!1))};class G{registerShortcuts(e){e.addHandlers({commandId:N.uB.PASTE_NODES,shortcuts:["meta v","ctrl v"],isEnabled:()=>!this.globalState.readonly,execute:h(this.handle.bind(this))})}render(e){var t=this;return(0,_._)(function*(){var{json:n,source:o,titleCache:r=[],offset:a={x:0,y:0},parent:i,toContainer:l}=e,s=yield t.createNodes({json:n.nodes,source:o,titleCache:r,offset:a,parent:i,toContainer:l});return yield t.nextTick(),t.createLines({json:n.edges,parent:i}),s})()}apply(e){var t=this;return(0,_._)(function*(){var{source:n,json:o}=e,r=D({json:o,isUniqueId:e=>!t.entityManager.getEntityById(e)});yield t.saveService.initNodeData(r.nodes);var a=t.calcPasteOffset(e.bounds),i=t.getSelectedContainer(),l=yield t.render({json:r,source:n,titleCache:[],offset:a,parent:i,toContainer:i});return t.selectNodes(l),l})()}handle(e){var t=this;return(0,_._)(function*(){var e=yield t.tryReadClipboard();if(!!e&&!!W({data:e,globalState:t.globalState})){var n=yield t.apply(e);return n.length>0&&(g.FN.success({content:S.o.t("copy_success"),showClose:!1}),t.scrollToNodes(n)),n}})()}tryReadClipboard(){return(0,_._)(function*(){try{var e=(yield navigator.clipboard.readText())||"";return JSON.parse(e)}catch(e){return}})()}calcPasteOffset(e){var{x:t,y:n,width:o,height:r}=e,{center:a}=new v.Ae(t,n,o,r),i=this.hoverService.hoveredPos;return{x:i.x-a.x,y:i.y-a.y}}createNodes(e){var t=this;return(0,_._)(function*(){var n,{json:o,source:r,titleCache:a,offset:i,parent:l,toContainer:s}=e,d=[];return yield Promise.all(o.map((n=(0,_._)(function*(e){var{blocks:n,edges:o}=e,u=(0,w._)(e,["blocks","edges"]),c=yield t.createNode({nodeJSON:u,source:r,titleCache:a,offset:i,parent:l,toContainer:s});if(!!c){var p=t.getNodeSubCanvas(c);if(p&&d.push(p.canvasNode),null==n?void 0:n.length){var v,m,f=null!==(m=null===(v=t.getNodeSubCanvas(c))||void 0===v?void 0:v.canvasNode)&&void 0!==m?m:c;t.render({json:{nodes:n,edges:null!=o?o:[]},source:r,titleCache:a,offset:i,parent:f})}d.push(c)}}),function(e){return n.apply(this,arguments)})).filter(Boolean)),d})()}getNodeSubCanvas(e){if(!!e){var t,n=e.getNodeMeta();return null===(t=n.subCanvas)||void 0===t?void 0:t.call(n,e)}}createNode(e){var t=this;return(0,_._)(function*(){var n,{nodeJSON:o,source:r,titleCache:a,offset:i,parent:l,toContainer:s}=e;if(!!q({node:o,parent:l,source:r,globalState:t.globalState,dragService:t.dragService})){var d=t.editService.recreateNodeJSON(o,a,!1);(null===(n=d.meta)||void 0===n?void 0:n.canvasPosition)&&(d.meta.canvasPosition={x:d.meta.canvasPosition.x+i.x,y:d.meta.canvasPosition.y+i.y});var u=t.calcNodePosition({nodeJSON:o,offset:i,parent:l,toContainer:s});return yield t.document.copyNodeFromJSON(o.type,d,o.id,u,null==l?void 0:l.id)}})()}createLines(e){var{json:t,parent:n}=e;return t.map(e=>this.createLine({edgeJSON:e,parent:n})).filter(Boolean)}createLine(e){var{edgeJSON:t,parent:n}=e,o=this.entityManager.getEntityById(t.sourceNodeID),r=this.entityManager.getEntityById(t.targetNodeID);if(!!o&&!!r){var a={from:t.sourceNodeID,fromPort:t.sourcePortID,to:t.targetNodeID,toPort:t.targetPortID};if(!n)return this.linesManager.createLine(a);var i=this.getNodeSubCanvas(n);return i?a.from===i.parentNode.id?this.linesManager.createLine((0,x._)((0,y._)({},a),{from:i.canvasNode.id})):a.to===i.parentNode.id?this.linesManager.createLine((0,x._)((0,y._)({},a),{to:i.canvasNode.id})):this.linesManager.createLine(a):this.linesManager.createLine(a)}}calcNodePosition(e){var t,{nodeJSON:n,parent:o,offset:r,toContainer:a}=e;if(!(null===(t=n.meta)||void 0===t?void 0:t.position))return this.hoverService.hoveredPos;var i=new v.Ae(n._temp.bounds.x,n._temp.bounds.y,n._temp.bounds.width,n._temp.bounds.height),l=o&&!a?n.meta.position:{x:r.x+i.center.x,y:r.y+i.y};return a?this.dragService.adjustSubNodePosition(n.type,a,l):l}getSelectedContainer(){var{activatedNode:e}=this.selection;if((null==e?void 0:e.flowNodeType)===N.Sy.SUB_CANVAS)return e}get selectedNodes(){return this.selection.selection.filter(e=>e instanceof N.CT)}selectNodes(e){1===e.length?this.editService.focusNode(e[0]):this.selection.selection=e}scrollToNodes(e){var t=this;return(0,_._)(function*(){var n=e.map(e=>e.getData(N.eG).bounds);yield t.document.playgroundConfig.scrollToView({bounds:v.Ae.enlarge(n)})})()}nextTick(){return(0,_._)(function*(){yield(0,v.gw)(16),yield new Promise(e=>requestAnimationFrame(e))})()}}(0,b.gn)([(0,j.f)(N.v2),(0,b.w6)("design:type",void 0===N.v2?Object:N.v2)],G.prototype,"entityManager",void 0),(0,b.gn)([(0,j.f)(N.dm),(0,b.w6)("design:type",void 0===N.dm?Object:N.dm)],G.prototype,"linesManager",void 0),(0,b.gn)([(0,j.f)(N.L4),(0,b.w6)("design:type",void 0===N.L4?Object:N.L4)],G.prototype,"document",void 0),(0,b.gn)([(0,j.f)(N.XH),(0,b.w6)("design:type",void 0===N.XH?Object:N.XH)],G.prototype,"hoverService",void 0),(0,b.gn)([(0,j.f)(I.qq),(0,b.w6)("design:type",void 0===I.qq?Object:I.qq)],G.prototype,"dragService",void 0),(0,b.gn)([(0,j.f)(N.oJ),(0,b.w6)("design:type",void 0===N.oJ?Object:N.oJ)],G.prototype,"selection",void 0),(0,b.gn)([(0,j.f)(I.Re),(0,b.w6)("design:type",void 0===I.Re?Object:I.Re)],G.prototype,"editService",void 0),(0,b.gn)([(0,j.f)(C.e),(0,b.w6)("design:type",void 0===C.e?Object:C.e)],G.prototype,"globalState",void 0),(0,b.gn)([(0,j.f)(I.PR),(0,b.w6)("design:type",void 0===I.PR?Object:I.PR)],G.prototype,"saveService",void 0),G=(0,b.gn)([(0,k.b)()],G);var H=e=>{if(e.entity.flowNodeType===N.Sy.SUB_CANVAS){var t,n=e.entity.getNodeMeta(),o=null===(t=n.subCanvas)||void 0===t?void 0:t.call(n,e.entity);return{followTo:null==o?void 0:o.parentNode.id}}},$=e=>({bounds:e,nodes:[],northWest:null,northEast:null,southWest:null,southEast:null}),J=(e,t)=>t.position.x>=e.x&&t.position.x+t.size.width<=e.x+e.width&&t.position.y>=e.y&&t.position.y+t.size.height<=e.y+e.height,Y=e=>{var{x:t,y:n,width:o,height:r}=e.bounds,a=o/2,i=r/2;return(0,x._)((0,y._)({},e),{northWest:$({x:t,y:n,width:a,height:i}),northEast:$({x:t+a,y:n,width:a,height:i}),southWest:$({x:t,y:n+i,width:a,height:i}),southEast:$({x:t+a,y:n+i,width:a,height:i})})},Q=(e,t,n)=>{if(!J(e.bounds,t))return e;if(!e.northWest){var o=[...e.nodes,t];if(o.length<=n)return(0,x._)((0,y._)({},e),{nodes:o})}var r=e.northWest?e:Y(e),a=e=>!!e&&J(e.bounds,t);if(!a(r.northWest)&&!a(r.northEast)&&!a(r.southWest)&&!a(r.southEast))return(0,x._)((0,y._)({},r),{nodes:[...r.nodes,t]});var i=e=>e?Q(e,t,n):null;return(0,x._)((0,y._)({},r),{northWest:i(r.northWest),northEast:i(r.northEast),southWest:i(r.southWest),southEast:i(r.southEast)})},X=(e,t)=>{var n=e.position.x+e.size.width/2-(t.position.x+t.size.width/2),o=e.position.y+e.size.height/2-(t.position.y+t.size.height/2);return Math.sqrt(n*n+o*o)},K=(e,t)=>{if(J(t,e))return 0;var n=Math.max(t.x-(e.position.x+e.size.width),0,e.position.x-(t.x+t.width)),o=Math.max(t.y-(e.position.y+e.size.height),0,e.position.y-(t.y+t.height));return Math.sqrt(n*n+o*o)},ee=e=>{if(0===e.length)return{x:0,y:0,width:1,height:1};var t=e.map(e=>e.position.x),n=e.map(e=>e.position.y),o=e.map(e=>e.size.width),r=e.map(e=>e.size.height),a=Math.min(...t),i=Math.max(...t.map((e,t)=>e+o[t])),l=Math.min(...n),s=Math.max(...n.map((e,t)=>e+r[t])),d=.1*Math.max(i-a,s-l);return{x:a-d,y:l-d,width:i-a+2*d,height:s-l+2*d}},et=e=>{var t=$(ee(e));return e.forEach(e=>{t=Q(t,e,4)}),t},en=(e,t)=>{var n=(e,o,r)=>{for(var a of e.nodes){if(a!==t){var i=X(t,a);i<r&&(o=a,r=i)}}if(!e.northWest)return{nearest:o,minDistance:r};for(var l of[e.northWest,e.northEast,e.southWest,e.southEast].filter(e=>null!==e).sort((e,n)=>K(t,e.bounds)-K(t,n.bounds)))if(K(t,l.bounds)<r){var s=n(l,o,r);o=s.nearest,r=s.minDistance}return{nearest:o,minDistance:r}};return n(e,null,1/0).nearest};(l=d||(d={})).create=et,l.find=en;var eo=e=>{var t=e.store.nodes.filter(e=>![P.nyy.Comment,N.Sy.SUB_CANVAS].includes(e.entity.flowNodeType));return e.quadTree=d.create(t),e.quadTree},er=(e,t)=>{if(e.entity.flowNodeType!==P.nyy.Comment)return;var n=eo(t),o=d.find(n,e);if(!!o)return e.offset={x:0,y:-5},{followTo:o.id}},ea=(e,t)=>e.entity.flowNodeType===N.Sy.SUB_CANVAS?H(e):e.entity.flowNodeType===P.nyy.Comment?er(e,t):void 0;class ei{registerShortcuts(e){e.addHandlers({commandId:ei.type,shortcuts:["alt shift f"],isEnabled:()=>!this.globalState.readonly,execute:h(this.handle.bind(this))})}handle(){var e=this;return(0,_._)(function*(){yield e.autoLayout()})()}autoLayout(){var e=this;return(0,_._)(function*(){var t=e.document.getAllNodes(),n=t.map(e.getNodePosition);yield e.autoLayoutService.layout({getFollowNode:ea});var o=t.map(e.getNodePosition);e.updateHistory({nodes:t,startPositions:n,endPositions:o})})()}getNodePosition(e){var t=e.getData(N.VO);return{x:t.position.x,y:t.position.y}}updateHistory(e){var{nodes:t,startPositions:n,endPositions:o}=e,r=t.map(e=>e.id);this.historyService.pushOperation({type:N.Nj.dragNodes,value:{ids:r,value:o,oldValue:n}},{noApply:!0})}}ei.type="LAYOUT",(0,b.gn)([(0,j.f)(N.L4),(0,b.w6)("design:type",void 0===N.L4?Object:N.L4)],ei.prototype,"document",void 0),(0,b.gn)([(0,j.f)(C.e),(0,b.w6)("design:type",void 0===C.e?Object:C.e)],ei.prototype,"globalState",void 0),(0,b.gn)([(0,j.f)(N.Yi),(0,b.w6)("design:type",void 0===N.Yi?Object:N.Yi)],ei.prototype,"autoLayoutService",void 0),(0,b.gn)([(0,j.f)(N.qp),(0,b.w6)("design:type",void 0===N.qp?Object:N.qp)],ei.prototype,"historyService",void 0),ei=(0,b.gn)([(0,k.b)()],ei);var el=e=>e.some(e=>[P.nyy.Start,P.nyy.End].includes(e.flowNodeType)),es=e=>e.every(e=>[P.nyy.Start,P.nyy.End].includes(e.flowNodeType)),ed=e=>es(e)?(g.FN.warning({content:S.o.t("workflow_multi_choice_delete_failed"),showClose:!1}),!1):(el(e)&&g.FN.warning({content:S.o.t("workflow_multi_choice_delete_failed"),showClose:!1}),!0);class eu{registerShortcuts(e){e.addHandlers({commandId:N.uB.DELETE_NODES,shortcuts:["backspace","delete"],isEnabled:()=>!this.globalState.readonly,execute:h(this.handle.bind(this))})}handle(){if(!!ed(this.selectedNodes))this.selection.selection.forEach(e=>{e instanceof N.CT?this.removeNode(e):e instanceof N.e2?this.removeLine(e):e.dispose()}),this.selection.selection=this.selection.selection.filter(e=>!e.disposed)}get selectedNodes(){return this.selection.selection.filter(e=>e instanceof N.CT)}removeNode(e){if(!!this.document.canRemove(e)){var t,n=e.getNodeMeta(),o=null===(t=n.subCanvas)||void 0===t?void 0:t.call(n,e);if(null==o?void 0:o.isCanvas){o.parentNode.dispose();return}e.dispose()}}removeLine(e){if(!!this.document.linesManager.canRemove(e))e.dispose()}}(0,b.gn)([(0,j.f)(N.L4),(0,b.w6)("design:type",void 0===N.L4?Object:N.L4)],eu.prototype,"document",void 0),(0,b.gn)([(0,j.f)(N.oJ),(0,b.w6)("design:type",void 0===N.oJ?Object:N.oJ)],eu.prototype,"selection",void 0),(0,b.gn)([(0,j.f)(C.e),(0,b.w6)("design:type",void 0===C.e?Object:C.e)],eu.prototype,"globalState",void 0),eu=(0,b.gn)([(0,k.b)()],eu);var ec=n("886829"),ep=e=>e.filter(e=>![P.nyy.Start,P.nyy.End,N.Sy.SUB_CANVAS].includes(e.flowNodeType)&&!e.getNodeMeta().copyDisable&&!0),ev=e=>es(e)?(g.FN.warning({content:S.o.t("workflow_multi_choice_copy_failed"),showClose:!1}),!1):0!==ep(e).length&&!0;class em{registerShortcuts(e){e.addHandlers({commandId:N.uB.COPY_NODES,shortcuts:["meta c","ctrl c"],isEnabled:()=>!this.globalState.readonly,execute:h(this.handle.bind(this))})}toData(){var e=this;return(0,_._)(function*(){var t=ep(e.selectedNodes),n=e.toSource(),o=yield e.toJSON(t);return{type:c,source:n,json:o,bounds:e.getEntireBounds(t)}})()}toSource(){return{workflowId:this.globalState.workflowId,flowMode:this.globalState.flowMode,spaceId:this.globalState.spaceId,isDouyin:this.globalState.isBindDouyin,host:window.location.host}}toJSON(e){var t=this;return(0,_._)(function*(){return{nodes:yield t.getNodeJSONs(e),edges:t.getEdgeJSONs(e)}})()}handle(){var e=this;return(0,_._)(function*(){if(!(yield e.hasTextSelected())&&!!ev(e.selectedNodes)){var t=yield e.toData();yield e.write(t)}})()}write(e){var t=this;return(0,_._)(function*(){try{yield navigator.clipboard.writeText(JSON.stringify(e)),el(t.selectedNodes)?g.FN.warning({content:S.o.t("workflow_multi_choice_copy_partial_success"),showClose:!1}):g.FN.success({content:S.o.t("workflow_multi_choice_copy_success"),showClose:!1})}catch(e){console.error("Failed to write text: ",e)}})()}hasTextSelected(){return(0,_._)(function*(){var e,t,n;return(null===(e=window.getSelection())||void 0===e?!!void 0:!!e.toString())&&(yield navigator.clipboard.writeText(null!==(n=null===(t=window.getSelection())||void 0===t?void 0:t.toString())&&void 0!==n?n:""),g.FN.success({content:S.o.t("workflow_text_copy",{},"文本已复制到剪贴板")}),!0)})()}get selectedNodes(){return this.selection.selection.filter(e=>e instanceof N.CT)}getNodeJSONs(e){var t=this;return(0,_._)(function*(){return(yield Promise.all(e.map(e=>t.tryToNodeJSON(e)))).filter(Boolean)})()}toNodeJSON(e){var t=this;return(0,_._)(function*(){var n,o,r=yield t.document.toNodeJSON(e);if(r._temp=t.getNodeTemporary(e),null===(o=r.blocks)||void 0===o?void 0:o.length){;yield Promise.all(r.blocks.map((n=(0,_._)(function*(e){var n,o=t.document.getNode(e.id);if(!!o)e._temp=t.getNodeTemporary(o),(null===(n=e.blocks)||void 0===n?void 0:n.length)&&(yield t.processBlocksRecursively(e.blocks))}),function(e){return n.apply(this,arguments)})))}return r})()}processBlocksRecursively(e){var t=this;return(0,_._)(function*(){var n;yield Promise.all(e.map((n=(0,_._)(function*(e){var n,o=t.document.getNode(e.id);if(!!o)e._temp=t.getNodeTemporary(o),(null===(n=e.blocks)||void 0===n?void 0:n.length)&&(yield t.processBlocksRecursively(e.blocks))}),function(e){return n.apply(this,arguments)})))})()}tryToNodeJSON(e){var t=this;return(0,_._)(function*(){try{return yield t.toNodeJSON(e)}catch(e){return}})()}getNodeTemporary(e){return{bounds:this.getNodeBounds(e),externalData:e.getData(ec.m).getNodeData()}}getNodeBounds(e){var t=e.getData(N.VO);return{x:t.bounds.x,y:t.bounds.y,width:t.bounds.width,height:t.bounds.height}}getEdgeJSONs(e){var t=new Set,n=new Set(e.map(e=>e.id));return e.forEach(e=>{var o=e.getData(N.Z1);[...o.inputLines,...o.outputLines].forEach(e=>{var o;n.has(e.from.id)&&(null===(o=e.to)||void 0===o?void 0:o.id)&&n.has(e.to.id)&&t.add(e)})}),Array.from(t).map(e=>e.toJSON())}getEntireBounds(e){var t=e.map(e=>e.getData(N.VO).bounds),n=v.Ae.enlarge(t);return{x:n.x,y:n.y,width:n.width,height:n.height}}}(0,b.gn)([(0,j.f)(N.L4),(0,b.w6)("design:type",void 0===N.L4?Object:N.L4)],em.prototype,"document",void 0),(0,b.gn)([(0,j.f)(N.oJ),(0,b.w6)("design:type",void 0===N.oJ?Object:N.oJ)],em.prototype,"selection",void 0),(0,b.gn)([(0,j.f)(C.e),(0,b.w6)("design:type",void 0===C.e?Object:C.e)],em.prototype,"globalState",void 0),em=(0,b.gn)([(0,k.b)()],em);class ef{registerShortcuts(e){e.addHandlers({commandId:N.uB.ZOOM_IN,shortcuts:["meta =","ctrl ="],execute:h(this.zoomIn.bind(this))}),e.addHandlers({commandId:N.uB.ZOOM_OUT,shortcuts:["meta -","ctrl -"],execute:h(this.zoomOut.bind(this))})}zoomIn(){if(!(this.playgroundConfig.zoom>1.9))this.playgroundConfig.zoomin()}zoomOut(){if(!(this.playgroundConfig.zoom<.1))this.playgroundConfig.zoomout()}}(0,b.gn)([(0,j.f)(N.ER),(0,b.w6)("design:type",void 0===N.ER?Object:N.ER)],ef.prototype,"playgroundConfig",void 0),ef=(0,b.gn)([(0,k.b)()],ef);class eg{registerShortcuts(e){e.addHandlers({commandId:eg.type,shortcuts:["meta shift s","ctrl shift s"],execute:h(this.handle.bind(this))})}handle(){var e=this;return(0,_._)(function*(){var t=yield e.toJSON();e.download({data:t,filename:e.filename})})()}toJSON(){var e=this;return(0,_._)(function*(){var t=e.copyShortcuts.toSource(),n=yield e.copyShortcuts.toJSON(e.validNodes);return{type:p,source:t,json:n}})()}get validNodes(){return this.document.root.blocks.filter(e=>e.flowNodeType!==N.Sy.SUB_CANVAS)}get filename(){return"coze-workflow-".concat(this.globalState.workflowId,".flow")}download(e){var{data:t,filename:n}=e,o=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=URL.createObjectURL(o),a=document.createElement("a");a.href=r,a.download=n,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}}eg.type="EXPORT",(0,b.gn)([(0,j.f)(N.L4),(0,b.w6)("design:type",void 0===N.L4?Object:N.L4)],eg.prototype,"document",void 0),(0,b.gn)([(0,j.f)(C.e),(0,b.w6)("design:type",void 0===C.e?Object:C.e)],eg.prototype,"globalState",void 0),(0,b.gn)([(0,j.f)(em),(0,b.w6)("design:type",void 0===em?Object:em)],eg.prototype,"copyShortcuts",void 0),eg=(0,b.gn)([(0,k.b)()],eg);class eh{registerShortcuts(e){e.addHandlers({commandId:eh.type,shortcuts:["meta shift l","ctrl shift l"],isEnabled:()=>!this.globalState.readonly,execute:h(this.handle.bind(this))})}handle(){var e=this;return(0,_._)(function*(){var t=yield e.load();if(!!t)t.json.nodes.length>200?yield e.refresh(t):yield e.rerender(t)})()}refresh(e){var t=this;return(0,_._)(function*(){yield t.operationService.save(e.json,t.saveService.ignoreStatusTransfer),yield t.globalState.reload(),window.location.reload()})()}rerender(e){var t=this;return(0,_._)(function*(){t.document.clear(),t.entityManager.changeEntityLocked=!0,t.pasteShortcuts.render({json:e.json,source:e.source}),t.entityManager.changeEntityLocked=!1,yield t.saveService.fitView(),t.saveService.save()})()}load(){return new Promise((e,t)=>{var n=t=>{console.error(t),g.FN.error("Load failed: ".concat(t.message)),e(void 0)},o=document.createElement("input");o.type="file",o.accept=".json,.flow",o.addEventListener("change",t=>{var o,r=null===(o=t.target.files)||void 0===o?void 0:o[0];if(!r){e(void 0);return}var a=new FileReader;a.onload=t=>{try{var o,r=JSON.parse(null===(o=t.target)||void 0===o?void 0:o.result);if(!this.validate(r)){n(Error("Invalid file"));return}e(r)}catch(e){n(e)}},a.onerror=()=>n(Error("Read file failed")),a.readAsText(r)}),o.click()})}validate(e){return e.type===p&&!0}}eh.type="LOAD",(0,b.gn)([(0,j.f)(G),(0,b.w6)("design:type",void 0===G?Object:G)],eh.prototype,"pasteShortcuts",void 0),(0,b.gn)([(0,j.f)(N.L4),(0,b.w6)("design:type",void 0===N.L4?Object:N.L4)],eh.prototype,"document",void 0),(0,b.gn)([(0,j.f)(C.e),(0,b.w6)("design:type",void 0===C.e?Object:C.e)],eh.prototype,"globalState",void 0),(0,b.gn)([(0,j.f)(I.PR),(0,b.w6)("design:type",void 0===I.PR?Object:I.PR)],eh.prototype,"saveService",void 0),(0,b.gn)([(0,j.f)(I.k_),(0,b.w6)("design:type",void 0===I.k_?Object:I.k_)],eh.prototype,"operationService",void 0),(0,b.gn)([(0,j.f)(N.v2),(0,b.w6)("design:type",void 0===N.v2?Object:N.v2)],eh.prototype,"entityManager",void 0),eh=(0,b.gn)([(0,k.b)()],eh);class e_{registerShortcuts(e){e.addHandlers({commandId:e_.type,shortcuts:["meta a","ctrl a"],isEnabled:()=>!this.globalState.readonly,execute:h(this.handle.bind(this))})}handle(){var e=this.document.root.blocks;this.selectService.selection=e}}e_.type="SELECT_ALL",(0,b.gn)([(0,j.f)(N.L4),(0,b.w6)("design:type",void 0===N.L4?Object:N.L4)],e_.prototype,"document",void 0),(0,b.gn)([(0,j.f)(C.e),(0,b.w6)("design:type",void 0===C.e?Object:C.e)],e_.prototype,"globalState",void 0),(0,b.gn)([(0,j.f)(N.oJ),(0,b.w6)("design:type",void 0===N.oJ?Object:N.oJ)],e_.prototype,"selectService",void 0),e_=(0,b.gn)([(0,k.b)()],e_)},370354:function(e,t,n){n.d(t,{e:()=>y.e,ee:()=>w,m7:()=>L,UY:()=>C,cd:()=>M,wN:()=>T,UF:()=>F});var o,r,a,i,l,s,d=n("825955"),u=n("206058"),c=n("184449"),p=n("306215"),v=n("316896"),m=n("450562"),f=n("880792"),g=n("808549"),h=n("664278"),_=n("1704"),y=n("786048"),x=(e,t)=>{var{node:n}=t;if(e.input.type===m.YX3.OBJECT_REF){var o=h.N.inputValueToDTO(e,n.context.variableService,{node:n}),r=(0,_.v)(o||{},e=>(0,g._)({name:null==e?void 0:e.name},(null==e?void 0:e.input)||{}));return(0,y.e)({type:m.owu.Object,title:e.title||e.label||e.name,name:e.name,description:e.description,required:null==e?void 0:e.required,validateJsonSchema:r,extra:{"x-dto-meta":o}})}var a=n.context.variableService.getWorkflowVariableByKeyPath(e.input.content.keyPath,{node:n}),i=null==a?void 0:a.viewMeta,l=h.N.getValueExpressionViewType(e.input,n.context.variableService,{node:n})||m.owu.String,s=h.N.getValueExpressionDTOMeta(e.input,n.context.variableService,{node:n}),d=(0,_.v)(s||{});return(0,y.e)({title:e.title||e.label||e.name,name:e.name,type:l,required:null==e?void 0:e.required,description:e.description,validateJsonSchema:d,defaultValue:null==i?void 0:i.defaultValue,extra:{"x-dto-meta":s}})},w=(e,t)=>{var{node:n}=t;if(!e||!Array.isArray(e))return{};var o=e.filter(e=>{if((null===(t=e.input)||void 0===t?void 0:t.type)===m.YX3.OBJECT_REF)return!(0,f.K)(e);if((null===(o=e.input)||void 0===o?void 0:o.type)!=="ref"||!(null===(r=e.input)||void 0===r?void 0:r.content))return!1;var t,o,r,[a]=e.input.content.keyPath||[];return!(a&&a===n.id||(0,p.mN)(a))&&!0});return(0,v.x)(o).map(e=>x(e,{node:n})).reduce((e,t)=>(t.name&&(e[t.name]=t),e),{})};var b=(o=(0,d._)(function*(e){var t,n,{node:o,fnName:r,groupName:a,properties:i}=e,l=o.getNodeRegistry(),s=null==l?void 0:null===(n=l.meta)||void 0===n?void 0:null===(t=n.test)||void 0===t?void 0:t[r];if(s){var d=yield s(o);!(0,y.Bf)(d)&&(i[a]={type:"object",properties:d})}}),function(e){return o.apply(this,arguments)});var j=(r=(0,d._)(function*(e){var{node:t}=e,n={};return(yield Promise.all([b({node:t,fnName:"generateFormBatchProperties",groupName:y.NC.Batch,properties:n}),b({node:t,fnName:"generateFormSettingProperties",groupName:y.NC.Setting,properties:n}),b({node:t,fnName:"generateFormInputProperties",groupName:y.NC.Input,properties:n})]),(0,y.Bf)(n))?null:{type:"object",properties:n,"x-decorator":"NodeFieldCollapse"}}),function(e){return r.apply(this,arguments)}),k=n("860766"),N=n("336205"),S=n("28260"),C=e=>{var t={"x-component":"RelatedFieldCollapse"},{isNeedBot:n,isNeedConversation:o}=e;return n||o?(t["x-component-props"]=e,t["x-validator"]=e=>{var{value:t}=e,r=null==t?void 0:t[y.NC.Bot],a=null==t?void 0:t[y.NC.Conversation];return n&&!r?{type:"bot",message:N.o.t("workflow_testset_required_tip",{param_name:"Bot"})}:o&&(null==r?void 0:r.type)===S.jH.Project&&!a?{type:"conversation",message:N.o.t("workflow_testset_required_tip",{param_name:"Conversation"})}:void 0},t):null};var I=(a=(0,d._)(function*(e){var t,n,{node:o,isChatflow:r,isInProject:a,spaceId:i,workflowId:l}=e,s=o.getNodeRegistry(),d=null;return(null==s?void 0:null===(n=s.meta)||void 0===n?void 0:null===(t=n.test)||void 0===t?void 0:t.generateRelatedContext)&&(d=yield s.meta.test.generateRelatedContext(o,{isChatflow:r,isInProject:a,spaceId:i,workflowId:l})),!d&&!a&&o.getData(k._).hasGlobalRef&&(d=C({isNeedBot:!0})),d}),function(e){return a.apply(this,arguments)});var T=(i=(0,d._)(function*(e){var t,n,{node:o,spaceId:r,isPreview:a}=e,i={type:"object","x-node-id":o.id,"x-node-type":o.flowNodeType,properties:{}},l=yield I(e);l&&(i.properties[y.NC.Related]=l);var s=yield j(e);return s&&(i.properties[y.NC.Node]=s),null===(n=o.getNodeRegistry().meta)||void 0===n||null===(t=n.test)||void 0===t||t.testset,i}),function(e){return i.apply(this,arguments)}),P=n("376604"),D=n("567282");var E=(l=(0,d._)(function*(e){var{spaceId:t,workflowId:n,nodeId:o,nodeType:r}=e,a=(0,P.Z)(m.nyy)[r];if(!!o&&!!a)try{var i,l=yield m.OHc.GetNodeExecuteHistory({workflow_id:n,space_id:t,node_id:o,node_type:a,execute_id:"",node_history_scene:D.IJ.TestRunInput}),s=(0,y.D6)(null===(i=l.data)||void 0===i?void 0:i.input);if(s)return{[y.NC.Node]:{[y.NC.Input]:(0,y.cS)(s)}}}catch(e){}}),function(e){return l.apply(this,arguments)}),O=n("192458");var L=(s=(0,d._)(function*(e){var t,n,o,r,a,{workflowId:i,spaceId:l}=e,{data:s}=yield m.OHc.QueryWorkflowNodeTypes({workflow_id:i,space_id:l}),d=null!==(n=null==s?void 0:s.node_types)&&void 0!==n?n:[],u=null!==(o=null==s?void 0:s.sub_workflow_node_types)&&void 0!==o?o:[],c=[...d,...u],p=[...null!==(r=null==s?void 0:s.nodes_properties)&&void 0!==r?r:[],...null!==(a=null==s?void 0:s.sub_workflow_nodes_properties)&&void 0!==a?a:[]],v=c.includes(m.nyy.Variable),f=c.includes(m.nyy.VariableAssign),g=c.includes(m.nyy.Intent),h=c.includes(m.nyy.LLM),_=c.includes(m.nyy.LTM);var y=(t=c,(0,O.Z)(t,m.XmD).length>0),x=p.some(e=>e.is_enable_chat_history),w=!!p.find(e=>e.is_ref_global_variable),b=(h||g)&&x,j=u.some(e=>[m.nyy.SubWorkflow].includes(e));return{isNeedBot:w||f||v||_||b||j||y,isNeedConversation:b,hasVariableNode:v,hasVariableAssignNode:f,hasNodeUseGlobalVariable:w,hasLTMNode:_,hasChatHistoryEnabledLLM:b,hasConversationNode:y,disableBot:y,disableBotTooltip:y?N.o.t("wf_chatflow_141"):"",disableProject:_,disableProjectTooltip:_?N.o.t("wf_chatflow_142"):""}}),function(e){return s.apply(this,arguments)}),M=()=>{var e,t=(0,u.Jf)(),n=(0,c.j1)(),o=(0,c.IW)();return{getDefaultValues:(e=(0,d._)(function*(e){if(!!e){var r=e["x-node-id"]||"",a=e["x-node-type"]||"",i=t.getCacheValues(r);if(i)return o.formGenDataOrigin({gen_data_origin:"cache"}),i;var l=yield E({workflowId:n.workflowId,spaceId:n.spaceId,nodeId:r,nodeType:a});if(l)return o.formGenDataOrigin({gen_data_origin:"history"}),l}}),function(t){return e.apply(this,arguments)})}},F=()=>{var{projectId:e,getProjectApi:t}=(0,c.j1)();return{open:n=>{var{workflowId:o,executeId:r,subExecuteId:a}=n,i=t();if(e&&i)i.sendMsgOpenWidget("/workflow/".concat(o),{name:"debug",data:{executeId:r,subExecuteId:a}});else{var l=new URL(window.location.href),s=new URLSearchParams;s.append("space_id",l.searchParams.get("space_id")||"0"),s.append("workflow_id",o),s.append("execute_id",r),s.append("sub_execute_id",a),l.search=s.toString(),window.open(l.toString(),"_blank")}}}}},973922:function(e,t,n){n.d(t,{A:function(){return a},e:function(){return r.e}});var o,r=n(668434);var a=((o={}).Atom="atom",o.SubWorkflow="sub_workflow",o.Plugin="plugin",o)},882617:function(e,t,n){n.d(t,{Z:function(){return c}});var o=n(473980),r=n(151064);n(455069);var a=n(252237),i=n.n(a),l=n(915757),s=n(674343),d=n(44172),u=n(398795);function c(e){var{readonly:t,onClick:n,className:a,style:c,disabled:p,subitem:v=!1,size:m,color:f}=e,g=(0,o._)(e,["readonly","onClick","className","style","disabled","subitem","size","color"]);return t?null:(0,r.jsx)(s.hU,{"data-testid":g["data-testid"],onClick:n,className:i()(u.Z.container,p?u.Z.disabled:null,a),style:c,icon:v?(0,r.jsx)(l.aCu,{}):(0,r.jsx)(d.N_R,{className:u.Z.icon}),disabled:p,size:m,color:f})}},275546:function(e,t,n){n.d(t,{Z:function(){return p}});var o=n(808549),r=n(120454),a=n(473980),i=n(151064),l=n(455069),s=n(252237),d=n.n(s),u=n(674343),c=n(764519);function p(e){var{children:t,className:n,style:s,tooltipClassName:p,tooltipStyle:v,containerClassName:m,containerStyle:f}=e,g=(0,a._)(e,["children","className","style","tooltipClassName","tooltipStyle","containerClassName","containerStyle"]),h=(0,l.useRef)(null);return(0,i.jsx)("div",{className:d()(c.Z.popup_container,n),style:s,children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{ref:h,className:d()(c.Z.nano,m),style:f}),(0,i.jsx)(u.u,(0,r._)((0,o._)({},g),{className:d()(c.Z.tooltip,c.Z["top-level"],p),style:(0,o._)({left:0},v),children:t}))]})})}},287797:function(e,t,n){n.d(t,{Z:function(){return m}});var o=n(808549),r=n(120454),a=n(151064),i=n(455069),l=n(550655),s=n(252237),d=n.n(s),u=n(626862),c=n(674343),p=n(275546),v=n(977494);function m(e){var t,n,s,m,{ellipsis:f=!0,maxCount:g}=e,h=(0,l.Z)(g)&&g>0;(0,i.useImperativeHandle)(e.onRef,()=>({triggerFocus:x}));var _=(0,u.Z)({value:e.value,inputOnFocus:!1,inputEle:!1}),y=(0,i.useRef)(null),x=()=>{var e;_.inputEle=!0,null==y||null===(e=y.current)||void 0===e||e.focus()},w=(0,i.useMemo)(()=>{var e,t;return((null===(e=y.current)||void 0===e?void 0:e.clientWidth)||0)<((null===(t=y.current)||void 0===t?void 0:t.scrollWidth)||0)-1},[f,_.inputOnFocus,_.value,null===(t=y.current)||void 0===t?void 0:t.clientWidth,null===(n=y.current)||void 0===n?void 0:n.scrollWidth,_.inputEle]);(0,i.useEffect)(()=>{_.value=e.value},[e.value]);var b=(0,a.jsxs)("span",{className:v.Z["limit-count"],children:[(null===(s=_.value)||void 0===s?void 0:s.length)||0,"/",g]});return(0,a.jsxs)("div",{className:d()(v.Z["input-wrapper"],e.className),style:e.style,children:[!_.inputEle&&w?(0,a.jsx)(p.Z,(0,r._)((0,o._)({content:_.value,position:"top",showArrow:!0,mouseEnterDelay:300},e.tooltipProps),{children:(0,a.jsx)("div",{className:d()((null==e?void 0:e.errorMsg)?v.Z["error-wrapper"]:null),onClick:()=>{!_.inputEle&&setTimeout(()=>{var e;null==y||null===(e=y.current)||void 0===e||e.focus()},10),_.inputEle=!0},children:(0,a.jsx)(c.II,(0,r._)((0,o._)({},e.inputProps),{validateStatus:e.validateStatus,ref:y,value:_.value,className:f?v.Z.input:"",suffix:h?b:void 0}))})})):(0,a.jsx)("div",{className:d()((null==e?void 0:e.errorMsg)?v.Z["error-wrapper"]:null),children:(0,a.jsx)(p.Z,(0,r._)((0,o._)({},e.onFocusTooltipProps),{trigger:"custom",visible:!!(null===(m=e.onFocusTooltipProps)||void 0===m?void 0:m.content)&&_.inputOnFocus,showArrow:!0,children:(0,a.jsx)(c.II,(0,r._)((0,o._)({},e.inputProps),{validateStatus:e.validateStatus,ref:y,value:_.value,className:f?v.Z.input:"",onChange:t=>{var n;_.value=t,null==e||null===(n=e.handleChange)||void 0===n||n.call(e,t)},onFocus:()=>{var t;_.inputOnFocus=!0,_.inputEle=!0,null==e||null===(t=e.handleFocus)||void 0===t||t.call(e,_.value||"")},onBlur:t=>{var n,o;_.inputOnFocus=!1,null==e||null===(n=e.handleBlur)||void 0===n||n.call(e,_.value||""),null==e||null===(o=e.onBlur)||void 0===o||o.call(e,t),_.inputEle=!1},suffix:h?b:void 0}))}))}),(null==e?void 0:e.errorMsg)?(0,a.jsx)("div",{className:d()(v.Z["error-content"],(null==e?void 0:e.errorMsgFloat)?v.Z["error-float"]:null),children:(0,a.jsx)("div",{className:v.Z["error-text"],children:null==e?void 0:e.errorMsg})}):null]})}},81644:function(e,t,n){n.d(t,{L:function(){return m}});var o=n(825955),r=n(151064),a=n(455069),i=n(156133),l=n(267334),s=n(408487),d=n(297158),u=n(336205),c=n(298203),p=n(674343),v=n(985467);function m(e){var t=(0,a.useRef)(null),n=(0,a.useRef)(e),[m,f]=(0,a.useState)(),[g,h]=(0,a.useState)(!1),[_,y]=(0,a.useState)([]),[x,w]=(0,a.useState)(0),b=(0,a.useRef)(),[j,k]=(0,a.useState)(!1);(0,a.useEffect)(()=>{n.current=e},[e]);var N=(0,a.useMemo)(()=>{if(!(null==m?void 0:m.workflowId))return null;var e,{spaceId:a,workflowId:u,commitId:p,onTestRunSucceed:f}=m;return(0,r.jsx)(v.L,{ref:t,from:null===(e=n.current)||void 0===e?void 0:e.from,readonly:!0,spaceId:a,workflowId:u,commitId:p,commitOptType:s.lcl.PublishOperate,defaultResultCollapseMode:"all",disabledSingleNodeTest:m.disabledSingleNodeTest,disableGetTestCase:m.disableGetTestCase,renderHeader:()=>null,onTestRunStart:(e,t)=>{(0,i.Z)(t)&&!t&&(b.current=void 0),h(!0)},onTestRunEnd:()=>{h(!1),w(e=>e+1)},onTestRunResultVisibleChange:k,testFormDefaultValues:_,onTestRunSucceed:f,onInit:(0,o._)(function*(){if(!m.executeId)return;var e,n,r=(e=(0,o._)(function*(){if(!!(null==m?void 0:m.workflowId)&&!!(null==m?void 0:m.executeId))try{var e;if("store"===m.executeId.type)e=(yield s.OHc.GetStoreTestRunHistory({source_workflow_id:m.executeId.sourceWfId,execute_id:m.executeId.value},{__disableErrorToast:!0})).data;else{var t={workflow_id:m.workflowId,space_id:m.spaceId||l.RV,execute_id:m.executeId.value};t.need_async=!0,e=(yield s.OHc.GetWorkFlowProcess(t,{__disableErrorToast:!0})).data}return e}catch(e){d.E7.error({message:e.message,error:e})}}),function(){return e.apply(this,arguments)}),a=yield r();if(!!(null==a?void 0:a.executeId)&&"0"!==a.executeId){if(w(e=>e+1),m.enableInitTestRunInput){var i=(a.nodeResults||[]).find(e=>"Start"===e.NodeType);i&&y([{input:(0,c.f5)(i.input||"{}")}])}m.showExecuteResult&&(null===(n=t.current)||void 0===n||n.showTestRunResult(a),b.current=a)}}),disableTraceAndTestRun:null==m?void 0:m.disableTraceAndTestRun})},[m,_,n,!0]),S=(0,a.useMemo)(()=>N?(0,r.jsxs)(p.T,{children:[x>0?(0,r.jsx)(p.zx,{color:"highlight",disabled:g,onClick:()=>{var e,n;j?null===(e=t.current)||void 0===e||e.hideTestRunResult():null===(n=t.current)||void 0===n||n.showTestRunResult(b.current)},children:j?u.o.t("workflow_detail_title_lastrun_hide"):u.o.t("workflow_detail_title_lastrun_display")}):null,g?(0,r.jsx)(p.zx,{color:"highlight",onClick:()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.cancelTestRun()},children:u.o.t("workflow_detail_title_testrun_cancel")}):null,(0,r.jsx)(p.zx,{color:"highlight",loading:g,onClick:()=>{var e,o,r;null===(o=n.current)||void 0===o||null===(e=o.onTriggerTestRun)||void 0===e||e.call(o),null===(r=t.current)||void 0===r||r.triggerTestRun()},children:u.o.t("workflow_detail_title_testrun")})]}):null,[N,x,g,j]);return{init:(e,t)=>{f(n=>t||(null==n?void 0:n.workflowId)!==(null==e?void 0:e.workflowId)?e:n)},workflowRef:t,isRunning:g,testResultVisible:j,triggerTestRun:()=>{var e;null===(e=t.current)||void 0===e||e.triggerTestRun()},cancelTestRun:()=>{var e;null===(e=t.current)||void 0===e||e.cancelTestRun()},showTestRunResult:()=>{var e;null===(e=t.current)||void 0===e||e.showTestRunResult(b.current)},hideTestRunResult:()=>{var e;null===(e=t.current)||void 0===e||e.hideTestRunResult()},workflowComp:N,testRunBtnsComp:S}}},667724:function(e,t,n){n.d(t,{Z:()=>i});var o=n("151064"),r=n("455069"),a=()=>{var[,e]=r.useState({});return r.useCallback(()=>e({}),[])},i=e=>{var t=r.createContext({registerSlot:()=>null,unregisterSlot:()=>null,context:{}}),n=Object.freeze({});return{Slots:i=>{var{context:l=n,children:s}=i,d={};e.map(e=>d[e]=null);var u=r.useRef(d),c=a(),[p,v]=r.useState(!1);(0,r.useLayoutEffect)(()=>{c(),v(!0)},[c]);var m=r.useCallback((e,t)=>{u.current[e]=t,p&&c()},[p,c]),f=r.useCallback(e=>{u.current[e]=null,c()},[c]),g=u.current;return(0,o.jsx)(t.Provider,{value:{registerSlot:m,unregisterSlot:f,context:l},children:s(g)})},Slot:e=>{var{name:n,children:o}=e,{registerSlot:a,unregisterSlot:i,context:l}=r.useContext(t);return(0,r.useLayoutEffect)(()=>(a(n,"function"==typeof o?o(l):o),()=>i(n)),[n,o,a,i,l]),null}}}},865682:function(e,t,n){n.d(t,{O:function(){return r}});var o=n(450562),r=(e,t)=>{if(!e)return!1;if((null===(n=e.nodes)||void 0===n?void 0:n.length)!==2||(null===(r=e.edges)||void 0===r?void 0:r.length))return!1;var n,r,a,i,l,s,d,u,c,p,v,m,f,g,h,_,y,x,w,b=e.nodes[0],j=e.nodes[1];var k=(s=b,(d=t)===o.wz8.Workflow?(null==s?void 0:null===(c=s.data)||void 0===c?void 0:null===(u=c.outputs)||void 0===u?void 0:u.length)===1||(null==s?void 0:null===(v=s.data)||void 0===v?void 0:null===(p=v.outputs)||void 0===p?void 0:p.length)===2&&!(null===(m=s.data.outputs[1])||void 0===m?void 0:m.name)&&(null===(f=s.data.outputs[1])||void 0===f?void 0:f.required)&&"string"===s.data.outputs[1].type&&!(null===(g=s.data.outputs[1])||void 0===g?void 0:g.assistType)&&!(null===(h=s.data.outputs[1])||void 0===h?void 0:h.description):d===o.wz8.ChatFlow?(null==s?void 0:null===(y=s.data)||void 0===y?void 0:null===(_=y.outputs)||void 0===_?void 0:_.length)===2&&(null===(x=s.data.outputs[0])||void 0===x?void 0:x.name)==="USER_INPUT"&&(null===(w=s.data.outputs[1])||void 0===w?void 0:w.name)==="CONVERSATION_NAME":void 0),N=!(null==b?void 0:b.edges)&&k,S=!(null==j?void 0:j.edges)&&(null==j?void 0:null===(l=j.data)||void 0===l?void 0:null===(i=l.inputs)||void 0===i?void 0:null===(a=i.inputParameters)||void 0===a?void 0:a.length)===1;return N&&S}},710938:function(e,t,n){n.d(t,{o:function(){return r}});var o=n(189914),r=()=>{var e=document.querySelector("#".concat(o.AB));return e?e:document.body}},143263:function(e,t,n){n.d(t,{i:function(){return o}});var o=e=>{var t=new URLSearchParams(e);return"/".concat("work_flow","?").concat(t.toString())}},327703:function(e,t,n){n.d(t,{_L:()=>m,ZJ:()=>_,em:()=>l,gF:()=>d,qc:()=>s,Z0:()=>v,a1:()=>i});var o,r=n("962289"),a=n("450562"),i=e=>!!(0,r.Z)(e,"nodeJSON")&&(0,r.Z)(e,"type")===a.nyy.Api,l=e=>!!(0,r.Z)(e,"categoryInfo"),s=e=>!!(0,r.Z)(e,"nodeJSON")&&(0,r.Z)(e,"type")===a.nyy.SubWorkflow,d=e=>!i(e)&&!l(e)&&!s(e),u=n("831000"),c=n("59074"),p=n("335740");class v{pretreatment(e){if(!e.startsWith("curl"))throw Error("curl syntax error");return/\r|\n/.exec(e)&&(e=e.replace(/\\\r|\\\n/g,"")),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/ -XPOST/," -X POST")).replace(/ -XGET/," -X GET")).replace(/ -XPUT/," -X PUT")).replace(/ -XPATCH/," -X PATCH")).replace(/ -XDELETE/," -X DELETE")).replace(/ --header/g," -H")).replace(/ --user-agent/g," -A")).replace(/ --request/g," -X")).replace(/ --(data-binary|data-raw|data|data-urlencode)/g," -d")).replace(/ --form/g," -f")).trim()).replace(/^curl/,"")}getFirstItem(e){var t=this.yargObj[e];return Array.isArray(t)?t[t.length-1]||"":t}transKeyValueArrayToObj(e){var t={},n=(0,p.Z)(e);return!Array.isArray(n)&&(n=[n]),n.forEach(e=>{var n=e.split("=");try{t[n[0]]=JSON.parse(n[1])}catch(e){t[n[0]]=n[1]}}),t}getUrl(){var{yargObj:e}=this,t="";return t=e._[0],e.url&&(t=e.url),!t&&Object.values(e).forEach(e=>{if("string"==typeof e)(e.startsWith("http")||e.startsWith("www."))&&(t=e)}),t.replace(/['"]+/g,"")}getQuery(e){var t={};try{var n=new URL(e);if(!(null==n?void 0:n.searchParams))return t;for(var[o,r]of n.searchParams)t[o]=r;return t}catch(e){return{}}}getHeaders(){var{yargObj:e}=this,t={};if(!Reflect.has(e,"H"))return t;var n=e.H;return!Array.isArray(n)&&(n=[n]),n.forEach(e=>{var n=e.indexOf(":"),o=e.substring(0,n).trim(),r=e.substring(n+1).trim();t[o]=r}),Reflect.has(e,"A")&&(t["user-agent"]=this.getFirstItem("A")),t}getMethods(){var{yargObj:e}=this,t=this.getFirstItem("X");if(t)return t.toUpperCase();if(Reflect.has(e,"F")){if(!e.F)throw Error("curl -F params syntax error");return"POST"}if(Reflect.has(e,"f")){if(!e.f)throw Error("curl --form params syntax error");return"POST"}return Reflect.has(e,"d")&&(t=(null==e?void 0:e.d)?"POST":"GET"),(null!=t?t:"GET").toUpperCase()}getBody(e){var t,n,o=e["content-type"]||e["Content-Type"],r="Empty",a=null===(s=this.yargObj)||void 0===s?void 0:s.d;if(o){if(o.indexOf("json")>-1)r="application/json";else if(o.indexOf("urlencoded")>-1)r="application/x-www-form-urlencoded";else if(this.cURLStr.indexOf("--data-urlencoded")>-1)r="application/x-www-form-urlencoded";else if(Array.isArray(a)&&"application/x-www-form-urlencoded"!==r)r="application/x-www-form-urlencoded",a=a.join("&");else if(o.indexOf("form-data")>-1){r="multipart/form-data";var i="",l=o.match(/boundary=.+/);if(l){i=l[0].slice(9);try{var s,d,u,p,v,m=c.Parse(null!==(v=null!=a?a:this.yargObj.F)&&void 0!==v?v:"",i);(null==m?void 0:m.length)&&(this.yargObj.F=m.map(e=>"".concat(e.filename,"=").concat(e.data)))}catch(e){r="text/plain"}}else r="text/plain"}else o.indexOf("application/octet-stream")>-1&&(r="application/octet-stream");this.yargObj.F&&(r="multipart/form-data")}else{var f,g,h,_,y=null===(f=this.yargObj)||void 0===f?void 0:f.d,x=null!==(_=null===(g=this.yargObj)||void 0===g?void 0:g.F)&&void 0!==_?_:null===(h=this.yargObj)||void 0===h?void 0:h.f;if("string"==typeof x&&x)r="multipart/form-data";else if("string"==typeof y&&y)try{JSON.parse(y),r="application/json"}catch(e){r="application/x-www-form-urlencoded"}}var w=null!==(n=null===(d=this.yargObj)||void 0===d?void 0:d.f)&&void 0!==n?n:null===(u=this.yargObj)||void 0===u?void 0:u.F,b=null===(p=this.yargObj)||void 0===p?void 0:p.f;switch(r){case"application/json":try{t=JSON.parse(a)}catch(e){t=a}break;case"application/x-www-form-urlencoded":if(a)try{var j=new URLSearchParams(a),k={};for(var[N,S]of j)k[N]=S;t=k}catch(e){t=a}else b&&(t=this.transKeyValueArrayToObj(b));break;case"multipart/form-data":w&&(t=this.transKeyValueArrayToObj(w));break;case"application/octet-stream":t=a;break;default:t=void 0}return{type:r,data:t}}parse(){var e=this.getUrl(),t=this.getHeaders(),n=this.getMethods(),o=new URL(e);return{url:e,originPath:(null==o?void 0:o.origin)+(null==o?void 0:o.pathname),params:{},method:n,headers:t,query:this.getQuery(e),body:this.getBody(t)}}constructor(e){this.cURLStr=e;var t=(0,u.Z)(this.pretreatment(e));this.yargObj=t}}function m(){var e,t,n=document.querySelector(".gedit-flow-background-layer"),o=null==n?void 0:n.getBoundingClientRect();return{x:null!==(e=null==o?void 0:o.x)&&void 0!==e?e:0,y:null!==(t=null==o?void 0:o.y)&&void 0!==t?t:0}}var f=n("825955"),g=n("458949"),h=n("382534");var _=(o=(0,f._)(function*(e){var t,n,o,{spaceId:r,pluginId:a}=e;if(!!a&&"0"!==a)return null===(o=(yield h.Js.GetPlaygroundPluginList({space_id:r,page:1,size:1,plugin_ids:[a],plugin_types:[g.zV.WORKFLOW,g.zV.IMAGEFLOW]},{__disableErrorToast:!0})).data)||void 0===o?void 0:null===(n=o.plugin_list)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.version_name}),function(e){return o.apply(this,arguments)})},945941:function(e,t,n){n.d(t,{j:function(){return w}});var o=n(825955),r=n(808549),a=n(120454),i=n(130001),l=n(771531),s=n(435946),d=n(686436),u=n(471583),c=n(244829),p=n(767179),v=n(360903),m=n(569502),f=n(408487),g=n(458620),h=n(727914);n(117140),n(382534);var _=n(522776),y=n(497744),x=n(357143);class w{get models(){return this.modelList}set models(e){this.modelList=e}get document(){return this.documentProvider()}loadNodeInfos(e){var t=this;return(0,o._)(function*(){var n,o,i,l,s,d,u,c,p,v,g=Object.values(m.ny),h=yield Promise.allSettled([f.OHc.NodeTemplateList({node_types:g},{headers:{"x-locale":e}}),t.fetchFavoritePlugins({pageNum:1})]);"fulfilled"===h[0].status&&(d=h[0].value),"fulfilled"===h[1].status&&(u=h[1].value);var _="node_type";t.favoritePlugins=u,t.nodeCategoryList=null!==(c=null==d?void 0:null===(n=d.data)||void 0===n?void 0:n.cate_list)&&void 0!==c?c:[],t.pluginApiMap=(null!==(p=null==d?void 0:null===(o=d.data)||void 0===o?void 0:o.plugin_api_list)&&void 0!==p?p:[]).reduce((e,t)=>(t.api_id&&(e[t.api_id]=t),e),{}),t.pluginCategoryMap=(null!==(v=null==d?void 0:null===(i=d.data)||void 0===i?void 0:i.plugin_category_list)&&void 0!==v?v:[]).reduce((e,t)=>(t.plugin_category_id&&(e[t.plugin_category_id]=t),e),{}),null==d||null===(s=d.data)||void 0===s||null===(l=s.template_list)||void 0===l||l.forEach(e=>{e[_]&&t.nodeTemplateMap.set("".concat(e[_]),(0,a._)((0,r._)({},e),{type:"".concat(e[_])}))})})()}getImageFlowNode(e,t){return this.imageflowNodes.find(n=>n.pluginID===e&&n.apiName===t)}get disabled(){var e;return!!(null===(e=this.globalState)||void 0===e?void 0:e.readonly)}get spaceId(){var e;return null===(e=this.globalState)||void 0===e?void 0:e.spaceId}get flowMode(){var e,t;return null!==(t=null===(e=this.globalState)||void 0===e?void 0:e.flowMode)&&void 0!==t?t:f.wz8.Workflow}getTemplateList(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.sort((e,t)=>Number(m._C[e])-Number(m._C[t])).map(e=>this.nodeTemplateMap.get(e)).filter(Boolean)}fetchFavoritePlugins(e){var{pageNum:t,pageSize:n=x.IV}=e;return(0,o._)(function*(){return{favorite_products:[],has_more:!1}})()}getTemplateCategoryList(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=!!(null===(e=this.globalState)||void 0===e?void 0:e.isBindDouyin);return(0!==this.nodeCategoryList.length?this.nodeCategoryList:[{name:"",node_type_list:t}]).map(e=>{var i,l,s,d,u,c,p,v=null!==(u=null===(s=e.node_type_list)||void 0===s?void 0:null===(l=s.filter(e=>t.includes(e)))||void 0===l?void 0:null===(i=l.map(e=>this.nodeTemplateMap.get(e)))||void 0===i?void 0:i.filter(e=>!!e))&&void 0!==u?u:[],f=null===(d=null!==(c=e.plugin_api_id_list)&&void 0!==c?c:[])||void 0===d?void 0:d.map(e=>{var t=this.pluginApiMap[e],n=(0,_.k)({name:t.api_name,plugin_name:t.name,api_id:t.api_id,plugin_id:t.plugin_id,desc:t.desc},t.icon_url);return(0,a._)((0,r._)({type:m.ny.Api},t),{nodeJSON:n})}),g=(null!==(p=e.plugin_category_id_list)&&void 0!==p?p:[]).map(e=>{var t=this.pluginCategoryMap[e];return(0,a._)((0,r._)({type:m.ny.Api},t),{categoryInfo:{categoryId:e,onlyOfficial:t.only_official}})});return{categoryName:e.name,nodeList:n?[...v,...o?[]:f,...o?[]:g]:v}}).filter(e=>e.nodeList.length>0)}get globalState(){return this.entityManager.getEntity(y.eI)}get schemaGray(){return{isBatchV2:!1}}constructor(){this.nodeTemplateMap=new Map,this.pluginApiMap={},this.pluginCategoryMap={},this.nodeCategoryList=[],this.getNodeTemplateInfoByType=e=>{var t=this.document.getNodeRegister(e);if(!t||!t.meta||void 0===t.meta.nodeDTOType)throw new h.sH(g.b.parmasValidation,"Unknown NodeMeta by type ".concat(e));var n=this.nodeTemplateMap.get(t.meta.nodeDTOType);if(!!n)return{title:n.name,icon:n.icon_url,description:n.desc,mainColor:n.color||"",subTitle:e!==m.ny.Start&&e!==m.ny.End?n.name:""}}}}(0,i.gn)([(0,l.f)(d.OO),(0,i.w6)("design:type",void 0===d.OO?Object:d.OO)],w.prototype,"documentProvider",void 0),(0,i.gn)([(0,l.f)(u.b),(0,i.w6)("design:type",void 0===u.b?Object:u.b)],w.prototype,"variableService",void 0),(0,i.gn)([(0,l.f)(c.I),(0,i.w6)("design:type",void 0===c.I?Object:c.I)],w.prototype,"batchService",void 0),(0,i.gn)([(0,l.f)(p.t),(0,i.w6)("design:type",void 0===p.t?Object:p.t)],w.prototype,"variableValidationService",void 0),(0,i.gn)([(0,l.f)(v.t),(0,i.w6)("design:type",void 0===v.t?Object:v.t)],w.prototype,"nodesService",void 0),(0,i.gn)([(0,l.f)(d.v2),(0,i.w6)("design:type",void 0===d.v2?Object:d.v2)],w.prototype,"entityManager",void 0),w=(0,i.gn)([(0,s.b)()],w)},985467:function(e,t,n){n.d(t,{L:()=>Q});var o,r,a=n("825955"),i=n("808549"),l=n("120454"),s=n("473980"),d=n("151064");n("327212");var u=n("573242"),c=n("879179"),p=n("455069"),v=n("664319"),m=n("527116"),f=n("212270"),g=n("686436"),h=n("702570"),_=n("816697"),y=n("942193"),x=n("130001"),w=n("771531"),b=n("435946"),j=n("129614");function k(e,t){var n=e.selection.filter(e=>e instanceof g.CT);return n.length>(t?1:0)?_.Ae.enlarge(n.map(e=>e.getData(g.eG).bounds)).pad(2):_.Ae.EMPTY}var N=n("126505");(o||(o={})).DEFAULT={canHovered:()=>!0};class S extends g.mh{autorun(){var{activatedNode:e}=this.selectionService;this.nodeTransformsWithSort=this.nodeTransforms.filter(e=>"root"!==e.entity.id).reverse().sort(t=>t.entity===e?-1:0)}get isDrawing(){return this.linesManager.isDrawing}onReady(){this.options=(0,i._)({},o.DEFAULT,this.options),this.toDispose.pushAll([this.listenPlaygroundEvent("mousemove",e=>{if(this.hoverService.hoveredPos=this.config.getPosFromMouseEvent(e),!!this.isEnabled()&&!!this.options.canHovered(e,this.hoverService)){var t=this.config.getPosFromMouseEvent(e);this.updateHoveredState(t,null==e?void 0:e.target)}}),this.selectionService.onSelectionChanged(()=>this.autorun()),this.listenPlaygroundEvent("mousedown",e=>{if(!!this.isEnabled()&&!this.isDrawing){var{hoveredNode:t}=this.hoverService;if(t&&t instanceof g.e2)return this.dragService.resetLine(t,e),!0;if(t&&t instanceof g.FD&&"input"!==t.portType&&!t.disabled&&1!==e.button)return e.stopPropagation(),e.preventDefault(),this.selectionService.clear(),this.dragService.startDrawingLine(t,e),!0;var n=this.config.getPosFromMouseEvent(e),o=k(this.selectionService,!0);if(o.width>0&&o.contains(n.x,n.y))return this.dragService.startDragSelectedNodes(e).then(n=>{!n&&(t&&t instanceof g.CT?e.metaKey||e.shiftKey||e.ctrlKey?this.selectionService.toggleSelect(t):this.selectionService.selectNode(t):this.selectionService.clear())}),!0;!t&&this.selectionService.clear()}})])}updateHoveredState(e,t){var n,o,r,a=this.nodeTransformsWithSort,i=this.linesManager.getPortFromMousePos(e),l=[...this.playgroundNode.querySelectorAll(".gedit-flow-activity-line")].some(e=>e.contains(t));if(i){if("output"===i.portType)this.updateHoveredKey(i.id);else if(l||(null==t?void 0:null===(r=t.className)||void 0===r?void 0:null===(o=r.includes)||void 0===o?void 0:o.call(r,N.c2))){var s=this.linesManager.getCloseInLineFromMousePos(e);s&&this.updateHoveredKey(s.id)}return}if(!this.isDrawing){var d=null===(n=a.find(t=>t.bounds.contains(e.x,e.y)))||void 0===n?void 0:n.entity,u=[...this.playgroundNode.querySelectorAll(".gedit-flow-activity-node")].some(e=>e.contains(t));(d||u)&&(null==d?void 0:d.id)&&this.updateHoveredKey(d.id);var c=!!((null==d?void 0:d.parent)&&"root"!==d.parent.flowNodeType),p=l?this.linesManager.getCloseInLineFromMousePos(e):void 0,v=!!(null==p?void 0:p.inContainer);if(d&&c){this.updateHoveredKey(d.id);return}if(p&&v){this.updateHoveredKey(p.id);return}if(d){this.updateHoveredKey(d.id);return}if(p){this.hoverService.updateHoveredKey(p.id);return}this.hoverService.clearHovered(),this.editorStateConfig.getCurrentState()===g.yy.STATE_MOUSE_FRIENDLY_SELECT&&!this.editorStateConfig.isPressingShift&&this.configEntity.updateCursor("grab")}}updateHoveredKey(e){this.configEntity.updateCursor("default"),this.hoverService.updateHoveredKey(e)}isEnabled(){var e=this.editorStateConfig.getCurrentState();return(e===g.yy.STATE_SELECT||e===g.yy.STATE_MOUSE_FRIENDLY_SELECT)&&!this.selectorBoxConfigEntity.isStart&&!this.dragService.isDragging}constructor(...e){super(...e),this.nodeTransformsWithSort=[]}}S.type="HoverLayer",(0,x.gn)([(0,w.f)(g.L4),(0,x.w6)("design:type",void 0===g.L4?Object:g.L4)],S.prototype,"document",void 0),(0,x.gn)([(0,w.f)(g.oJ),(0,x.w6)("design:type",void 0===g.oJ?Object:g.oJ)],S.prototype,"selectionService",void 0),(0,x.gn)([(0,w.f)(g.iw),(0,x.w6)("design:type",void 0===g.iw?Object:g.iw)],S.prototype,"dragService",void 0),(0,x.gn)([(0,w.f)(g.XH),(0,x.w6)("design:type",void 0===g.XH?Object:g.XH)],S.prototype,"hoverService",void 0),(0,x.gn)([(0,w.f)(g.dm),(0,x.w6)("design:type",void 0===g.dm?Object:g.dm)],S.prototype,"linesManager",void 0),(0,x.gn)([(0,g.O0)(g.Zs),(0,x.w6)("design:type",void 0===g.Zs?Object:g.Zs)],S.prototype,"editorStateConfig",void 0),(0,x.gn)([(0,g.O0)(g.NQ),(0,x.w6)("design:type",void 0===g.NQ?Object:g.NQ)],S.prototype,"selectorBoxConfigEntity",void 0),(0,x.gn)([(0,w.f)(g.ER),(0,x.w6)("design:type",void 0===g.ER?Object:g.ER)],S.prototype,"configEntity",void 0),(0,x.gn)([(0,g.aI)(g.CT,g.eG),(0,x.w6)("design:type",Array)],S.prototype,"nodeTransforms",void 0),(0,x.gn)([(0,g.RX)(g.e2),(0,x.w6)("design:type",Array)],S.prototype,"lines",void 0),S=(0,x.gn)([(0,b.b)()],S);var C={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pausebreak:19,capslock:20,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,insert:45,delete:46,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftwindowkey:91,rightwindowkey:92,meta:/(mac|iphone|ipod|ipad)/i.test("undefined"!=typeof navigator?null===(r=navigator)||void 0===r?void 0:r.platform:"")?[91,93]:[91,92],selectkey:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,equalsign:187,"=":187,comma:188,dash:189,"-":189,period:190,forwardslash:191,graveaccent:192,openbracket:219,backslash:220,closebracket:221,singlequote:222},I={ctrl:e=>e.ctrlKey,shift:e=>e.shiftKey,alt:e=>e.altKey,meta:e=>"keyup"===e.type?C.meta.includes(e.keyCode):e.metaKey};class T extends g.mh{onReady(){this.shortcuts.addHandlersIfNotFound({commandId:g.uB.DELETE_NODES,shortcuts:["backspace","delete"],isEnabled:()=>this.selection.selection.length>0&&!this.config.disabled&&!this.config.readonly,execute:()=>{this.selection.selection.forEach(e=>{if(e instanceof g.CT){if(!this.document.canRemove(e))return;var t,n=e.getNodeMeta(),o=null===(t=n.subCanvas)||void 0===t?void 0:t.call(n,e);if(null==o?void 0:o.isCanvas){o.parentNode.dispose();return}}else if(e instanceof g.e2&&!this.linesManager.canRemove(e))return;e.dispose()}),this.selection.selection=this.selection.selection.filter(e=>!e.disposed)}},{commandId:g.uB.ZOOM_IN,shortcuts:["meta =","ctrl ="],execute:()=>{this.config.zoomin()}},{commandId:g.uB.ZOOM_OUT,shortcuts:["meta -","ctrl -"],execute:()=>{this.config.zoomout()}}),this.toDispose.pushAll([this.listenPlaygroundEvent("keydown",e=>{if(!!this.isFocused&&e.target===this.playgroundNode)this.shortcuts.shortcutsHandlers.some(t=>{var n;if(n=e,t.shortcuts.some(e=>(function(e,t){var n,o,r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(!e.key||!t)return!1;var a=t.split(/\s+/),i=0;for(var l of a){var s=I[l],d=C[l.toLowerCase()];(s&&s(e)||d&&d===e.keyCode)&&i++}if(r){;return i===a.length&&(n=e,o=Object.keys(I).reduce((e,t)=>I[t](n)?e+1:e,0),([16,17,18,91,92].includes(n.keyCode)?o:o+1)===a.length)}return i===a.length})(n,e))&&(!t.isEnabled||t.isEnabled(e)))return t.execute(e),e.preventDefault(),!0})})])}}T.type="ShortcutsLayer",(0,x.gn)([(0,w.f)(y.k),(0,x.w6)("design:type",void 0===y.k?Object:y.k)],T.prototype,"shortcuts",void 0),(0,x.gn)([(0,w.f)(g.z2),(0,x.w6)("design:type",void 0===g.z2?Object:g.z2)],T.prototype,"selection",void 0),(0,x.gn)([(0,w.f)(g.XH),(0,x.w6)("design:type",void 0===g.XH?Object:g.XH)],T.prototype,"hoverService",void 0),(0,x.gn)([(0,w.f)(g.L4),(0,x.w6)("design:type",void 0===g.L4?Object:g.L4)],T.prototype,"document",void 0),(0,x.gn)([(0,w.f)(g.dm),(0,x.w6)("design:type",void 0===g.dm?Object:g.dm)],T.prototype,"linesManager",void 0),T=(0,x.gn)([(0,b.b)()],T);var P=n("801815");class D extends g.mh{get zoom(){return this.config.finalScale}onReady(){var{firstChild:e}=this.pipelineNode;this.pipelineNode.insertBefore(this.node,e),this.playgroundConfigEntity.updateConfig({minZoom:.1,maxZoom:2}),this.grid.style.zIndex="-1",this.grid.style.position="relative",this.node.appendChild(this.grid),this.grid.className="gedit-grid-svg"}getScaleUnit(){var{zoom:e}=this;return{realSize:20,renderSize:Math.round(20*e*100)/100,zoom:e}}autorun(){var e=this.playgroundConfigEntity.config,t=this.getScaleUnit(),n=10*t.renderSize,o=e.width+2*n,r=e.height+2*n,{scrollX:a}=e,{scrollY:i}=e,l=this.getScrollDelta(a,n),s=this.getScrollDelta(i,n);_.xF.setStyle(this.node,{left:a-g.JW,top:i-g.JW}),this.drawGrid(t),this.setSVGStyle(this.grid,{width:o,height:r,left:g.JW-l-n,top:g.JW-s-n})}drawGrid(e){var t=e.renderSize;if(!!this.grid){var n=1*this.zoom,o='\n    <svg width="100%" height="100%">\n      <pattern id="'.concat(this.patternId,'" width="').concat(t,'" height="').concat(t,'" patternUnits="userSpaceOnUse">\n        <circle\n          cx="').concat(n,'"\n          cy="').concat(n,'"\n          r="').concat(n,'"\n          stroke="#eceeef"\n          fill-opacity="0.5"\n        />\n      </pattern>\n      <rect width="100%" height="100%" fill="url(#').concat(this.patternId,')"/>\n    </svg>');this.grid.innerHTML=o}}setSVGStyle(e,t){if(!!e)e.style.width="".concat(t.width,"px"),e.style.height="".concat(t.height,"px"),e.style.left="".concat(t.left,"px"),e.style.top="".concat(t.top,"px")}getScrollDelta(e,t){return e>=0?e%t:t-Math.abs(e)%t}constructor(...e){super(...e),this.patternId="".concat("grid-dot-pattern").concat((0,P.x0)()),this.node=_.xF.createDivWithClass("gedit-flow-background-layer"),this.grid=document.createElement("div")}}D.type="WorkflowBackgroundLayer",(0,x.gn)([(0,g.O0)(g.ER),(0,x.w6)("design:type",void 0===g.ER?Object:g.ER)],D.prototype,"playgroundConfigEntity",void 0);var E=n("827294"),O=e=>{var t=k((0,g.G2)(g.z2),!0);if(0===t.width||0===t.height)return(0,d.jsx)(d.Fragment,{});var n={display:"block",left:t.left,top:t.top,width:t.width,height:t.height};return(0,d.jsx)("div",{className:E.Z.selectorBoundsForground,style:n})};class L{registerRenderer(e){e.registerLayer(g.wY,{hoverService:this.hoverService}),e.registerLayers(g.Em,g.lV,S,T),e.registerLayer(g.F7,{renderElement:()=>this.stackingContext.node}),e.registerLayer(g.V7,{renderElement:()=>this.stackingContext.node}),e.registerLayer(g.aK,{disableBackground:!0,CustomBoundsRenderer:O}),e.registerLayer(g.Kz,{canSelect:(e,t)=>{if(0!==e.button)return!1;var n=e.target;if(!n)return!1;if(n){if(n.closest('[data-flow-editor-selectable="true"]'))return!0;if(n.closest('[data-flow-editor-selectable="false"]'))return!1}return!!(!this.hoverService.isSomeHovered()&&(n.classList.contains("gedit-playground-layer")||n.classList.contains("gedit-flow-background-layer")||n.closest(".gedit-flow-activity-edge")))||!1}}),location.search.match("playground_debug")&&e.registerLayers(g.kB),e.registerLayer(D)}onReady(){document.documentElement&&(document.documentElement.style.overscrollBehavior="none"),document.body.style.overscrollBehavior="none",this.linesManager.registerContribution(g.nd).registerContribution(g.Z4)}onDispose(){this._gestureForStopDefault.destroy()}constructor(){this._gestureForStopDefault=new j.Gesture(document.body,{onPinch:()=>{}})}}(0,x.gn)([(0,w.f)(g.XH),(0,x.w6)("design:type",void 0===g.XH?Object:g.XH)],L.prototype,"hoverService",void 0),(0,x.gn)([(0,w.f)(g.XN),(0,x.w6)("design:type",void 0===g.XN?Object:g.XN)],L.prototype,"stackingContext",void 0),(0,x.gn)([(0,w.f)(g.dm),(0,x.w6)("design:type",void 0===g.dm?Object:g.dm)],L.prototype,"linesManager",void 0),L=(0,x.gn)([(0,b.b)()],L);var M=new h.n(e=>{(0,_.KV)(e,L,[g.qY,g.OK]),e(y.k).toSelf().inSingletonScope()}),F=n("579367"),Z=n("773794"),R=()=>{var e=(0,g.G2)(g.L4),t=(0,g.G2)(g.Rf),n=(0,g.G2)(g.mQ);return(0,p.useMemo)(()=>t.init(),[t]),(0,p.useLayoutEffect)(()=>(e.load(),()=>e.dispose()),[e]),(0,p.useEffect)(()=>{var e=n.onLogger(e=>{var{event:t}=e;t===g.Lp.CANVAS_TTI&&(0,F.WQ)()});return()=>{null==e||e.dispose()}},[]),(0,d.jsx)("div",{className:Z.Z.playgroundLoad})},V=e=>{var t=(0,p.useMemo)(()=>[g.d1,g.qf,g._s,M,...e.containerModules||[]],[]),n=(0,p.useCallback)(()=>{var t;return[(0,g.vK)({}),(0,g.XD)({}),(0,g.eX)({}),...(null===(t=e.preset)||void 0===t?void 0:t.call(e))||[]]},[]);return(0,d.jsxs)(g.W6,{containerModules:t,plugins:n,parentContainer:e.parentContainer,children:[(0,d.jsx)(R,{}),e.children]})},A=n("464632"),z=n("163572"),B=n("267334"),U=n("408487"),q=n("297158"),W=n("214942"),G=n("184449"),H=n("578182"),$=n("873329"),J=q.kg.createLoggerWith({ctx:{namespace:"workflow-error"}}),Y=e=>(0,d.jsx)(q.SV,{FallbackComponent:()=>(0,d.jsx)(f.gk,{}),errorBoundaryName:"workflow-error-boundary",logger:J,children:e.children}),Q=(0,p.forwardRef)((e,t)=>{var{spaceId:n=B.RV,parentContainer:o}=e,r=(0,s._)(e,["spaceId","parentContainer"]);console.log("debugger workflow playground");var{spaceList:f,setSpace:g,fetchSpaces:h,checkSpaceID:_,inited:y}=(0,W.rY)((0,v.N)(e=>({spaceList:e.spaceList,setSpace:e.setSpace,fetchSpaces:e.fetchSpaces,checkSpaceID:e.checkSpaceID,inited:e.inited})));(0,p.useEffect)(()=>{var e,t=!0;return(e=(0,a._)(function*(){if(!y&&(yield h(!0)),!!t)_(n),n!==B.RV&&g(n)}),function(){return e.apply(this,arguments)})(),()=>{t=!1}},[n,h,g,_]);var x=(0,G.hZ)(r);return y?(0,d.jsx)(c.W,{backend:u.PD,context:window,children:(0,d.jsx)(m.aH,{client:U.fB_,children:(0,d.jsx)(V,{parentContainer:o,containerModules:[A.p,H.F,z.P],preset:x,children:(0,d.jsx)(Y,{children:(0,d.jsx)($.Z,(0,l._)((0,i._)({ref:t},r),{spaceId:n,spaceList:f}))})})})}):null})},197360:function(e,t,n){n.d(t,{J:()=>m});var o=n("151064"),r=n("921463"),a=n("455069"),i=n("252237"),l=n.n(i),s=n("686436"),d=n("674343"),u=n("126505"),c=n("655144"),p=()=>(0,o.jsx)("div",{className:l()(c.Z.symbol,c.Z.warning),children:(0,o.jsxs)("svg",{style:{width:10,height:10},width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[(0,o.jsx)("path",{id:"path1",fill:"#ffffff",stroke:"none",d:"M 12 0 C 10.674479 0 9.6 1.074528 9.6 2.4 L 9.6 14.4 C 9.6 15.725521 10.674479 16.799999 12 16.799999 C 13.325521 16.799999 14.4 15.725521 14.4 14.4 L 14.4 2.4 C 14.4 1.074528 13.325521 0 12 0 Z"}),(0,o.jsx)("path",{id:"path2",fill:"#ffffff",stroke:"none",d:"M 12 19.200001 C 10.674479 19.200001 9.6 20.274479 9.6 21.6 C 9.6 22.925518 10.674479 24 12 24 C 13.325521 24 14.4 22.925518 14.4 21.6 C 14.4 20.274479 13.325521 19.200001 12 19.200001 Z"})]})});function v(){return(0,o.jsx)("div",{className:c.Z.symbol,children:(0,o.jsx)("div",{className:c.Z.crossHair})})}var m=a.memo(e=>{var t,n=(0,s.G2)(s.iw),i=(0,s.G2)(s.XH),m=(0,s.G2)(s.dm),{entity:f,onClick:g}=e,{portType:h,portID:_,relativePosition:y,disabled:x,errorMessage:w}=f,[b,j]=(0,a.useState)(f.targetElement),[k,N]=(0,a.useState)(y.x),[S,C]=(0,a.useState)(y.y),[I,T]=(0,a.useState)(!1),[P,D]=(0,a.useState)(!!(null==f?void 0:null===(t=f.lines)||void 0===t?void 0:t.length)),[E,O]=(0,a.useState)(e.entity.hasError),L=(0,s.gO)(),M=(0,a.useCallback)(e=>{var t=1===e.button;if("input"!==h&&!x&&!t)e.stopPropagation(),e.preventDefault(),n.startDrawingLine(f,e)},[n,h,_]);(0,a.useEffect)(()=>{e.entity.validate(),O(e.entity.hasError);var t=e.entity.onEntityChange(()=>{if(f.targetElement){f.targetElement!==b&&j(f.targetElement);return}var t=e.entity.relativePosition;N(Math.round(t.x)),C(Math.round(t.y))}),n=i.onHoveredChange(e=>{T(i.isHovered(f.id))}),o=e.entity.onErrorChanged(()=>{O(e.entity.hasError)}),r=m.onAvailableLinesChange(()=>{setTimeout(()=>{var e;D(!!(null==f?void 0:null===(e=f.lines)||void 0===e?void 0:e.length))},0)});return()=>{t.dispose(),n.dispose(),o.dispose(),r.dispose()}},[e.entity,i,f,b,m]);var F=l()(c.Z.workflowPoint,{[c.Z.hovered]:!L&&I&&!x&&"input"!==h,[c.Z.linked]:P}),Z=(0,a.useMemo)(()=>{var e=(0,o.jsx)("div",{className:l()({[c.Z.bg]:!0,[u.c2]:!0,"workflow-point-bg":!0,[c.Z.hasError]:E}),children:E?(0,o.jsx)(p,{}):(0,o.jsx)(v,{})});return E&&w?(0,o.jsx)(d.u,{className:c.Z.tooltip,content:w,trigger:"hover",position:"top",children:e}):e},[E,w]),R=(0,o.jsxs)("div",{className:F,style:b?void 0:{left:k,top:S},onClick:e=>null==g?void 0:g(e,f),onMouseDown:M,"data-port-entity-id":f.id,"data-testid":"bot-edit-multi-agent-flow-node-add-button",children:[(0,o.jsx)("div",{className:l()(c.Z.bgCircle,"workflow-bg-circle")}),Z,(0,o.jsx)("div",{className:c.Z["focus-circle"]})]});return b?r.createPortal(R,b):R})},126505:function(e,t,n){n.d(t,{c2:function(){return o}});var o="workflow-port-bg"},942193:function(e,t,n){n.d(t,{G:function(){return u},k:function(){return c}});var o=n(130001),r=n(523158),a=n(686346),i=n(771531),l=n(259674),s=n(435946),d=n(686436),u=Symbol("WorkflowShortcutsContribution");class c{addHandlers(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(e=>{this.commandRegistry.registerCommand({id:e.commandId},{execute:e.execute,isEnabled:e.isEnabled})}),this.shortcutsHandlers.push(...t)}addHandlersIfNotFound(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(e=>{!this.has(e.commandId)&&this.addHandlers(e)})}has(e){return this.shortcutsHandlers.some(t=>t.commandId===e)}init(){var e;null===(e=this.contribs)||void 0===e||e.forEach(e=>e.registerShortcuts(this))}constructor(){this.shortcutsHandlers=[]}}(0,o.gn)([(0,r.n)(u),(0,a.j)(),(0,o.w6)("design:type",Array)],c.prototype,"contribs",void 0),(0,o.gn)([(0,i.f)(d.Ho),(0,o.w6)("design:type",void 0===d.Ho?Object:d.Ho)],c.prototype,"commandRegistry",void 0),(0,o.gn)([(0,l.z)(),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[]),(0,o.w6)("design:returntype",void 0)],c.prototype,"init",null),c=(0,o.gn)([(0,s.b)()],c)},473753:function(e,t,n){n.d(t,{Mr:()=>p,Ld:()=>d,AJ:()=>y,ge:()=>v,xs:()=>f});var o=n("151064"),r=n("455069"),a=n("252237"),i=n.n(a),l=n("674343"),s=n("44781"),d=e=>{var{value:t,onChange:n,readonly:r=!1,width:a="auto",placeholder:d,maxCount:u,textMode:c=!1,testId:p}=e;return c?(0,o.jsx)("div",{style:{width:a},className:s.Z["text-mode"],children:t}):(0,o.jsx)(l.II,{size:"small","data-testid":p,className:i()({[s.Z.readonly]:r}),style:{width:a},value:t,onChange:e=>{null==n||n(e)},readonly:r,placeholder:d,maxLength:u,suffix:void 0===u?null:(0,o.jsx)("span",{className:s.Z.suffix,children:"".concat((null==t?void 0:t.length)||0,"/").concat(u)})})},u=n("808549"),c=n("585220"),p=e=>{var{value:t,onChange:n,width:r="100%",readonly:a=!1,mode:s="input",max:d,min:p,step:v,placeholder:m,size:f="default",style:g={}}=e;return"slider"===s?(0,o.jsx)("div",{className:c.Z.slider,style:(0,u._)({width:r},g),children:(0,o.jsx)(l.iR,{className:i()({[c.Z.readonly]:a}),value:t,min:p,max:d,step:v,onChange:e=>{"number"==typeof e&&!a&&(null==n||n(e))}})}):(0,o.jsx)(l.k7,{value:t,onChange:e=>{"number"==typeof e&&!a&&(null==n||n(e))},className:i()({[c.Z.readonly]:a}),style:(0,u._)({width:r},g),max:d,min:p,step:v,placeholder:m,size:f})};n("514568");var v=e=>{var{value:t,onChange:n,readonly:r}=e;return(0,o.jsx)(l.rs,{checked:t,onChange:n,disabled:r})},m=n("384810"),f=e=>{var{value:t,onChange:n,readonly:r,options:a=[],placeholder:s,width:d="100%"}=e;return(0,o.jsx)(l.Ph,{placeholder:s,className:i()({[m.Z.readonly]:r}),optionList:a,style:{width:d},value:t,onChange:e=>null==n?void 0:n(e)})};n("821652"),(0,r.createContext)({}).Provider,n("700520");var g=n("909508");function h(e){var{thumbnail:t,label:n,tooltip:r,disabled:a=!1,disabledTooltip:s}=e,d=(0,o.jsxs)("div",{className:g.Z.label,children:[(0,o.jsx)(l.qE,{className:i()(g.Z.thumbnail,"wf-enum-image-model-thumbnail"),style:{width:16,height:16},shape:"square",src:t}),(0,o.jsx)("span",{className:g.Z.content,children:n})]});return a&&s&&(r=s),r&&(d=(0,o.jsx)(l.u,{content:r,position:"left",spacing:40,children:d})),d}var _=n("758784"),y=e=>{var{value:t,onChange:n,readonly:r=!1,width:a="100%",showClear:s=!1,placeholder:d="",options:u,validateStatus:c}=e;return(0,o.jsx)(l.Ph,{size:"small",className:i()("flex",{[_.Z.select]:!0,[_.Z.readonly]:r}),optionList:u.map(e=>{var{label:t,value:n,thumbnail:r,disabled:a,tooltip:i}=e;return{label:(0,o.jsx)(h,{thumbnail:r,label:t,tooltip:i,disabled:a}),value:n,disabled:a}}),style:{width:a},value:t,onChange:e=>null==n?void 0:n(e),renderSelectedItem:e=>{var{value:t}=e,n=u.find(e=>e.value===t);if(n){var{thumbnail:r,label:a}=n;return(0,o.jsx)(h,{thumbnail:r,label:a})}return null},showClear:s,onClear:()=>{null==n||n(void 0)},placeholder:d,validateStatus:c})}},786048:function(e,t,n){n.d(t,{zK:()=>N,NC:()=>eS,t4:()=>eV,cS:()=>eq,Sx:()=>e_,cI:()=>y.cI,_i:()=>nF,D6:()=>eu,Ob:()=>nq,Zn:()=>eL,Ws:()=>y.Ws,Au:()=>eN,e:()=>ez,Bf:()=>eB,cO:()=>eO,Tz:()=>eb,jd:()=>eI});var o,r,a,i,l,s,d,u=n("808549"),c=n("473980"),p=n("151064"),v=n("455069"),m=(0,v.createContext)({}),f=n("816697");class g{get componentType(){return this["x-component"]}get componentProps(){return this["x-component-props"]}get decoratorType(){return this["x-decorator"]}get decoratorProps(){return this["x-decorator-props"]}fromJSON(e){var t;Object.entries(e).forEach(e=>{var[t,n]=e;this[t]=n}),this.uiState.value.disabled=null!==(t=e["x-disabled"])&&void 0!==t&&t}static getProperties(e){var t=[],n=[];return Object.entries(e.properties||{}).forEach(e=>{var[o,r]=e,a=r["x-index"];void 0===a||isNaN(a)?n.push({schema:r,key:o}):t[a]={schema:r,key:o}}),t.concat(n).filter(e=>!!e)}constructor(e,t=[]){this.uiState=new f.BP({disabled:!1}),this.path=[],this.fromJSON(e),this.path=t}}var h=(0,v.createContext)({}),_=(0,v.createContext)({}),y=n("686436"),x=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(e=>e).join(".")},w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{validate:n}=t,o=(0,v.useMemo)(()=>{var t;return(0,u._)({},(t={},function e(n,o){o&&n["x-validator"]&&(t[o]=n["x-validator"]),"object"===n.type&&n.properties&&Object.entries(n.properties).forEach(t=>{var[n,r]=t;e(r,x(o,n))})}(e),t),n)},[e]),{form:r,control:a}=(0,v.useMemo)(()=>(0,y.Np)((0,u._)({validate:o,validateTrigger:y.C$.onBlur},t)),[e,o]),i=(0,v.useMemo)(()=>new g((0,u._)({type:"object"},e)),[e]);return(0,v.useEffect)(()=>{t.onMounted&&t.onMounted(a._formModel,i);var e=a._formModel.onFormValuesUpdated(e=>{(null==t?void 0:t.onFormValuesChange)&&t.onFormValuesChange(e)});return()=>e.dispose()},[a]),{form:r,control:a,model:a._formModel,formSchema:i}},b=()=>(0,v.useContext)(h),j=()=>{var e,t=b();return(0,f.Re)(null==t?void 0:null===(e=t.uiState)||void 0===e?void 0:e.value)},k=()=>(0,v.useContext)(m),N=()=>(0,v.useContext)(_),S=()=>{var e,t=N();return(0,f.Re)(null==t?void 0:null===(e=t.uiState)||void 0===e?void 0:e.value)},C=e=>{var{schema:t,children:n}=e,o=k();return(0,p.jsx)(h.Provider,{value:t,children:t.decoratorType&&o[t.decoratorType]?v.createElement(o[t.decoratorType],t.decoratorProps,n):(0,p.jsx)(p.Fragment,{children:n})})},I=n("120454"),T=e=>{var t,n,{parentUIState:o}=e,r=k(),a=b(),i=(0,y.p3)(),l=j(),s=S(),d=(0,y.Ws)(),c=(null==o?void 0:o.disabled)||l.disabled||s.disabled,m=(null===(n=d.errors)||void 0===n?void 0:n.length)?"error":void 0;return t=a.componentType&&r[a.componentType]?v.createElement(r[a.componentType],(0,u._)({disabled:c,validateStatus:m,value:i.value,onChange:i.onChange,onFocus:i.onFocus,onBlur:i.onBlur,"data-testid":["workflow","testrun","form","component"].concat(a.path).join(".")},a.componentProps)):null,a.decoratorType&&r[a.decoratorType]?v.createElement(r[a.decoratorType],(0,I._)((0,u._)({},a.decoratorProps),{"data-testid":["workflow","testrun","form","decorator"].concat(a.path).join(".")}),t):(0,p.jsx)(p.Fragment,{children:t})},P=e=>{var{schema:t}=e,n=j();return(0,p.jsx)(h.Provider,{value:t,children:(0,p.jsx)(y.gN,{name:t.path.join("."),defaultValue:t.defaultValue,children:(0,p.jsx)(T,{parentUIState:n})})})},D=(e,t)=>[...e||[],t].filter(e=>!!e),E=e=>{var{name:t,schema:n}=e,o=()=>{var e=g.getProperties(n);if(!e.length)return null;var{path:t}=n;return(0,p.jsx)(C,{schema:n,children:e.map((e,n)=>(0,p.jsx)(E,{name:e.key,schema:new g(e.schema,D(t,e.key))},"".concat(n,"-").concat(e.key)))})};return t&&"object"!==n.type?(0,p.jsx)(P,{name:t,schema:n}):o()},O=e=>(0,p.jsx)(m.Provider,{value:e.components,children:(0,p.jsx)(_.Provider,{value:e.schema,children:(0,p.jsx)(E,{schema:e.schema})})}),L=n("171505"),M=n("227997"),F=n.n(M),Z=n("915757"),R=n("674343"),V=n("580120");function A(e){if(!!e&&!!function(e){try{return!new(F())(e).isNaN()}catch(e){return!1}}(e))return new(F())(e)}var z=e=>{var{int:t,onChange:n,onBlur:o}=e,r=(0,c._)(e,["int","onChange","onBlur"]),a=(0,v.useRef)(A(r.value)),i=(e,t)=>t?e.toFixed(0,F().ROUND_DOWN):e.toFixed();return(0,v.useEffect)(()=>{(""===r.value||void 0===r.value)&&(a.current=void 0),A(r.value)&&(a.current=A(r.value))},[r.value]),(0,p.jsx)(R.II,(0,u._)({onChange:n,onBlur:()=>{if(""===r.value||void 0===r.value)a.current=void 0,""===r.value&&n(void 0);else{var e,l=A(r.value)||a.current;l&&(e=i(l,t)),e!==r.value&&n(e)}o()},size:"small",suffix:r.disabled?null:(0,p.jsxs)("div",{className:V.Z.buttons,children:[(0,p.jsx)("div",{className:(0,L.default)(V.Z.button,V.Z.up),onClick:()=>{var e="1";a.current&&(e=i(a.current.plus("1"),t)),n(e)},children:(0,p.jsx)(Z.eM,{})}),(0,p.jsx)("div",{className:(0,L.default)(V.Z.button,V.Z.down),onClick:()=>{var e="0";a.current&&(e=i(a.current.minus("1"),t)),n(e)},children:(0,p.jsx)(Z.C_O,{})})]})},r))},B=n("312980"),U=n("28961"),q=n("178388"),W=n("717497"),G=n("887874"),H=n("526900"),$=n("888855"),J=n("249294"),Y="#F7F7FC",Q="#000A298A",X="#00818C",K="#D1009D",ee="#C74200",et="#2B57D9",en="#2B57D9",eo="#0F1529D1";H.Mj.register("json",W.AV);var er=(0,G.Us)(H.ZP,[J.tk.theme({"&":{borderRadius:"8px"},".cm-scroller":{transition:"height .3s ease"},".cm-content":{paddingTop:"6px",paddingBottom:"6px"},".cm-completionIcon-property":{backgroundImage:'url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xMi4zNTc2IDguMTAzNTVDMTIuMTYyMyA3LjkwODI5IDExLjg0NTcgNy45MDgyOSAxMS42NTA1IDguMTAzNTVMOC4xMDM1NSAxMS42NTA1QzcuOTA4MjkgMTEuODQ1NyA3LjkwODI5IDEyLjE2MjMgOC4xMDM1NSAxMi4zNTc2TDExLjY1MDUgMTUuOTA0NUMxMS44NDU3IDE2LjA5OTggMTIuMTYyMyAxNi4wOTk4IDEyLjM1NzYgMTUuOTA0NUwxNS45MDQ1IDEyLjM1NzZDMTYuMDk5OCAxMi4xNjIzIDE2LjA5OTggMTEuODQ1NyAxNS45MDQ1IDExLjY1MDVMMTIuMzU3NiA4LjEwMzU1WiIgZmlsbD0iIzA2MDcwOUNDIi8+PHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMS4wMDI2IDEuNDU1NDVDMTEuNjIxNCAxLjA5ODE4IDEyLjM4MzggMS4wOTgxOCAxMy4wMDI2IDEuNDU1NDVMMjAuNjM4IDUuODYzNzRDMjEuMjU2OCA2LjIyMSAyMS42MzggNi44ODEyNiAyMS42MzggNy41OTU3OVYxNi40MTI0QzIxLjYzOCAxNy4xMjY5IDIxLjI1NjggMTcuNzg3MiAyMC42MzggMTguMTQ0NEwxMy4wMDI2IDIyLjU1MjdDMTIuMzgzOCAyMi45MSAxMS42MjE0IDIyLjkxIDExLjAwMjYgMjIuNTUyN0wzLjM2NzE5IDE4LjE0NDRDMi43NDgzOSAxNy43ODcyIDIuMzY3MTkgMTcuMTI2OSAyLjM2NzE5IDE2LjQxMjRWNy41OTU3OUMyLjM2NzE5IDYuODgxMjYgMi43NDgzOSA2LjIyMTAxIDMuMzY3MTkgNS44NjM3NEwxMS4wMDI2IDEuNDU1NDVaTTEyLjAwMjYgMy4xODc1TDE5LjYzOCA3LjU5NTc5VjE2LjQxMjRMMTIuMDAyNiAyMC44MjA3TDQuMzY3MTkgMTYuNDEyNEw0LjM2NzE5IDcuNTk1NzlMMTIuMDAyNiAzLjE4NzVaIiBmaWxsPSIjMDYwNzA5Q0MiLz48L3N2Zz4=")',backgroundSize:"11px 11px",backgroundRepeat:"no-repeat",width:"11px",height:"11px"},".cm-completionIcon-property::after":{content:'""'},".cm-selectionBackground":{borderRadius:"4px"},".cm-activeLineGutter":{borderRadius:"4px 0 0 4px"},".cm-activeLine":{borderRadius:"0 4px 4px 0"},"&.cm-focused":{outline:"none"},"& *":{fontFamily:'Menlo, Monaco, "Courier New", monospace'},".cm-tooltip":{wordBreak:"break-all"},".cm-lineNumbers .cm-gutterElement":{transform:"translate(0, 1px)"},".cm-foldGutter .cm-gutterElement > div":{display:"flex",alignItems:"center"},".cm-completionIcon":{fontSize:"11px"}}),(0,H.jG)({variant:"light",settings:{background:Y,foreground:"#4D4D4C",caret:"#AEAFAD",selection:"#52649A21",gutterBackground:Y,gutterForeground:"#000A298A",gutterBorderColor:"transparent",gutterBorderWidth:0,lineHighlight:"#efefef78",bracketColors:["#E4D129","#AC05FF","#2B57D9"],tooltip:{backgroundColor:"var(--coz-bg-max)",color:"var(--coz-fg-primary)",border:"solid 1px var(--coz-stroke-plus)",boxShadow:"var(--coz-shadow-default)",borderRadius:"8px"},tooltipCompletion:{backgroundColor:"#FFFFFF",color:"#060709CC"},completionItemHover:{backgroundColor:"#5768A114"},completionItemSelected:{backgroundColor:"#52649A21"},completionItemIcon:{color:"#060709CC"},completionItemLabel:{color:"#060709CC"},completionItemDetail:{color:"#2029459E"}},styles:[{tag:$.pJ.comment,color:Q},{tag:[$.pJ.propertyName],color:X},{tag:[$.pJ.string],color:K},{tag:[$.pJ.number],color:ee},{tag:[$.pJ.bool],color:et},{tag:[$.pJ.null],color:en},{tag:[$.pJ.separator],color:eo}]}),(0,J.jH)({parent:document.body,tooltipSpace:()=>({left:16,top:16,right:window.innerWidth-16,bottom:window.innerHeight-16})})]),ea=e=>{var{value:t,height:n,disabled:o,extensions:r,jsonSchema:a,onChange:i,onBlur:l,onFocus:s,didMount:d}=e,[u,c]=(0,v.useState)(!1),[m]=(0,v.useState)(()=>"file:///".concat((0,q.Z)(),".json")),f=(0,v.useRef)(null),g=e=>{null==i||i(e||void 0)},h=(0,v.useCallback)(()=>{c(!1),null==l||l()},[l]),_=(0,v.useCallback)(()=>{c(!0),null==s||s()},[s]);return(0,v.useEffect)(()=>{var e,t="file:///".concat((0,q.Z)());return W.AV.languageService.configureSchemas({uri:t,fileMatch:[m],schema:a||{}}),null===(e=f.current)||void 0===e||e.validate(),()=>{W.AV.languageService.deleteSchemas(t)}},[m,a]),(0,v.useEffect)(()=>{if(!!f.current)t!==f.current.getValue()&&f.current.setValue(t||"")},[t]),(0,p.jsx)(G.KU,{children:(0,p.jsx)(er,{defaultValue:null!=t?t:"",options:{uri:m,languageId:"json",fontSize:12,height:n||(u?"264px":"120px"),readOnly:o,editable:!o},extensions:r,onFocus:_,onBlur:h,onChange:e=>g(e.value),didMount:e=>{f.current=e,null==d||d(e)}})})},ei=e=>{var{spaceId:t,workflowId:n,executeId:o,subExecuteId:r,nodeId:a}=e,i=new URLSearchParams({space_id:t,workflow_id:n,execute_id:o,node_id:a||"",sub_execute_id:r||""});return"/work_flow?".concat(i.toString())},el=(e,t)=>{if(t){var{workflowId:n,executeId:o,subExecuteId:r,nodeId:a}=e,i=new URLSearchParams({workflow_id:n,execute_id:o,node_id:a||"",sub_execute_id:r||""});window.open("".concat(window.location.pathname,"?").concat(i.toString()))}var l=ei(e);window.open(l)},es=n("896335"),ed=e=>{if(!(0,es.Z)(e))return e;try{return JSON.stringify(JSON.parse(e),null,2)}catch(t){return e}},eu=(e,t)=>{if("object"==typeof e)return e;try{return JSON.parse(String(e))}catch(e){return null==t?void 0:t.emptyValue}},ec=n("64605"),ep=n("537845"),ev=e=>{var[t,n]=(0,v.useState)(!1),[o,r]=(0,v.useState)(e.default),a=(0,v.useRef)(null),i=(0,v.useRef)(!1),l=(0,v.useRef)(0),s=(0,v.useRef)(0),d=(0,ep.Z)(t=>{if(i.current){var n=s.current-(t.clientY-l.current);e.max&&n>e.max?r(e.max):e.min&&n<e.min?r(e.min):r(n)}}),u=(0,v.useCallback)(()=>{i.current=!1,n(!1),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",u)},[d]);return{height:o,bind:(0,ep.Z)(e=>{var t;i.current=!0,n(!0),l.current=e.clientY,s.current=(null===(t=a.current)||void 0===t?void 0:t.offsetHeight)||0,document.addEventListener("mousemove",d),document.addEventListener("mouseup",u)}),ref:a,dragging:t}},em=n("92728"),ef=e=>{var{className:t,header:n,footer:o,height:r,resizable:a,onClose:i,children:l}=e,{height:s,bind:d,ref:c,dragging:v}=ev((0,u._)({default:r},(0,ec.Z)(a)?a:{}));return(0,p.jsxs)("div",{className:(0,L.clsx)(em.Z["base-panel"],t,v&&em.Z.dragging),style:{height:s},ref:c,children:[a?(0,p.jsx)("div",{className:em.Z["resize-bar"],onMouseDown:d}):null,n?(0,p.jsxs)("div",{className:em.Z["panel-header"],children:[n,(0,p.jsx)(R.hU,{icon:(0,p.jsx)(Z.rmE,{className:"text-[18px]"}),color:"secondary",onClick:i})]}):null,(0,p.jsx)("div",{className:em.Z["panel-content"],children:l}),o?(0,p.jsx)("div",{className:em.Z["panel-footer"],children:o}):null]})},eg=n("336205"),eh=n("269207"),e_=e=>{var{value:t,disabled:n,validateStatus:o,onChange:r}=e,a=(0,c._)(e,["value","disabled","validateStatus","onChange"]);return(0,p.jsxs)("div",{className:(0,L.clsx)(eh.Z["input-json-wrap"],n&&eh.Z.disabled,"error"===o&&eh.Z.error),"data-testid":a["data-testid"],children:[(0,p.jsxs)("div",{className:eh.Z["json-header"],children:[(0,p.jsx)("div",{className:eh.Z["json-label"],children:"JSON"}),(0,p.jsx)("div",{children:(0,p.jsx)(R.u,{content:eg.o.t("workflow_exception_ignore_format"),children:(0,p.jsx)(R.hU,{icon:(0,p.jsx)(Z.bGR,{}),disabled:n,size:"small",color:"secondary",onMouseDown:e=>e.preventDefault(),onClick:()=>{var e=ed(t);e!==t&&(null==r||r(e))}})})})]}),(0,p.jsx)("div",{className:eh.Z["json-editor"],children:(0,p.jsx)(ea,(0,u._)({value:t,disabled:n,onChange:r},a))})]})},ey=n("45949"),ex=n("614904"),ew=n("327891"),eb=e=>{var{title:t,required:n,tooltip:o,tag:r,description:a,children:i,feedback:l}=e,s=(0,c._)(e,["title","required","tooltip","tag","description","children","feedback"]);return(0,p.jsxs)("div",{className:ew.Z["field-item"],"data-testid":s["data-testid"],children:[(0,p.jsxs)("div",{className:ew.Z["item-title"],children:[(0,p.jsxs)("div",{className:ew.Z["item-label"],children:[(0,p.jsx)(R.ZT.Text,{className:ew.Z["title-text"],strong:!0,size:"small",children:t}),n?(0,p.jsx)(R.ZT.Text,{className:ew.Z["title-required"],children:"*"}):null,o?(0,p.jsx)(R.u,{content:o,children:(0,p.jsx)(Z.L03,{className:ew.Z["tooltip-icon"]})}):null,r?(0,p.jsx)(R.Vp,{className:ew.Z["item-tag"],size:"mini",color:"primary",children:r}):null]}),a?(0,p.jsx)(R.ZT.Text,{ellipsis:{showTooltip:{opts:{position:"left",style:{maxWidth:500}}}},className:ew.Z["item-description"],size:"small",children:a}):null]}),(0,p.jsx)("div",{children:i}),l?(0,p.jsx)("div",{className:ew.Z["item-feedback"],children:l}):null]})},ej=n("584466"),ek=n("309858"),eN=e=>{var{label:t,tooltip:n,extra:o,children:r}=e,[a,i]=(0,v.useState)(!0),l=(0,v.useRef)(null),[s]=(0,ej.Z)(l);return(0,p.jsxs)("div",{children:[(0,p.jsx)("div",{ref:l}),(0,p.jsxs)("div",{onClick:()=>i(!a),className:(0,L.clsx)(ek.Z["collapse-title"],(!s||!a)&&ek.Z["is-sticky"]),children:[(0,p.jsx)(Z.C_O,{className:(0,L.clsx)(ek.Z["collapse-icon"],!a&&ek.Z["is-close"])}),(0,p.jsx)("span",{className:ek.Z["collapse-label"],children:t}),n?(0,p.jsx)(R.u,{content:n,children:(0,p.jsx)(Z.L03,{className:ek.Z["collapse-label-tooltip"]})}):null,o?(0,p.jsx)("div",{className:ek.Z["collapse-extra"],onClick:e=>e.stopPropagation(),children:o}):null]}),(0,p.jsx)(R.zF,{isOpen:a,keepDOM:!0,fade:!0,duration:300,children:(0,p.jsx)("div",{className:ek.Z["collapse-content"],children:r})})]})};var eS=((o={}).Node="_node",o.Batch="_batch",o.Input="_input",o.Setting="_setting",o.JSON="_json",o.Related="_related",o.Bot="_bot",o.Conversation="_conversation",o.TestsetSelect="_testset_select",o.TestsetSave="_testset_save",o);var eC=(r={components:{InputString:e=>(0,p.jsx)(R.Kx,(0,u._)({className:(0,L.default)(B.Z["input-string"],B.Z.small),autosize:{minRows:1,maxRows:5},rows:1,showClear:!0},e)),InputNumber:e=>(0,p.jsx)(z,(0,u._)({},e)),InputInteger:e=>(0,p.jsx)(z,(0,u._)({int:!0},e)),InputTime:e=>{var{className:t,value:n,onChange:o}=e,r=(0,c._)(e,["className","value","onChange"]);return(0,p.jsx)(R.Mt,(0,u._)({className:(0,L.clsx)(U.Z["input-time"],t),type:"dateTime",size:"small",showClear:!1,showSuffix:!1,value:n,onChange:(e,t)=>{("string"==typeof t||void 0===t)&&(null==o||o(t))}},r))},InputJson:e_,SelectBoolean:e=>{var{className:t,value:n,onChange:o}=e,r=(0,c._)(e,["className","value","onChange"]),a=(0,v.useMemo)(()=>void 0===n?void 0:Number(n),[n]),i=(0,v.useCallback)(e=>{null==o||o(void 0===e?e:!!e)},[o]);return(0,p.jsxs)(R.Ph,(0,I._)((0,u._)({className:(0,L.clsx)(ey.Z["select-boolean"],t),size:"small",value:a,onChange:i},r),{children:[(0,p.jsx)(R.Ph.Option,{value:1,children:"True"}),(0,p.jsx)(R.Ph.Option,{value:0,children:"False"})]}))},SelectVoice:e=>{var{onChange:t,onBlur:n}=e,o=(0,c._)(e,["onChange","onBlur"]);return(0,p.jsx)(ex.tk,(0,u._)({onChange:e=>{null==t||t(e),null==n||n()}},o))},FieldItem:e=>{var{tag:t}=e,n=(0,c._)(e,["tag"]),o=b(),r=o.path.includes(eS.Batch),a=t&&r?"".concat(t," - ").concat(eg.o.t("workflow_detail_node_batch")):t;return(0,p.jsx)(eb,(0,u._)({title:o.title,description:o.description,required:o.required,tag:a},n))}}},e=>{var{components:t}=e,n=(0,c._)(e,["components"]);return(0,p.jsx)(O,(0,u._)({components:(0,u._)({},r.components,t)},n))}),eI=e=>{var{schema:t,components:n,onFormValuesChange:o,onMounted:r}=e,{control:a,formSchema:i}=w(t,{onFormValuesChange:o,onMounted:r});return(0,p.jsx)(y.l0,{control:a,children:(0,p.jsx)(eC,{schema:i,components:n})})},eT=n("716894"),eP=n("992499"),eD=()=>(0,eT.F)((e,t)=>({schema:null,mode:"form",patch:t=>e(()=>t),getSchema:()=>t().schema}),eP.X),eE=(0,v.createContext)({}),eO=e=>{var{children:t}=e,n=(0,v.useRef)(eD());return(0,p.jsx)(eE.Provider,{value:n.current,children:t})},eL=e=>(0,v.useContext)(eE)(e),eM=n("450562"),eF=n("687015"),eZ=n.n(eF),eR=e=>null==e||""===e,eV=e=>{var{required:t,title:n,name:o,validateJsonSchema:r}=e;return{"x-validator":e=>{var{value:a}=e;if(t&&eR(a))return eg.o.t("workflow_testset_required_tip",{param_name:n||o});if(r&&void 0!==a){!d&&(d=new(eZ()));try{var i=JSON.parse(a);return d.compile(r)(i)?void 0:eg.o.t("workflow_debug_wrong_json")}catch(e){return eg.o.t("workflow_debug_wrong_json")}}}}},eA=e=>{var{type:t,validateJsonSchema:n}=e;if(eM.owu.Voice===t)return{"x-component":"SelectVoice"};if(eM.owu.isFileType(t)){var o=[eM.owu.Image,eM.owu.ArrayImage].includes(t)?"image":"object";return{"x-component":"TypedFileInput","x-component-props":{multiple:eM.owu.isArrayType(t),accept:(0,eM.Huc)(t),fileType:o}}}return eM.owu.isArrayType(t)||eM.owu.Object===t?{"x-component":"InputJson","x-component-props":{jsonSchema:n},defaultValue:eM.owu.Object===t?"{}":"[]"}:t===eM.owu.Integer?{"x-component":"InputInteger"}:t===eM.owu.Number?{"x-component":"InputNumber"}:t===eM.owu.Boolean?{"x-component":"SelectBoolean",defaultValue:!0}:t===eM.owu.Time?{"x-component":"InputTime"}:{"x-component":"InputString"}},ez=e=>{var{type:t,name:n,title:o,required:r=!0,description:a,defaultValue:i,validateJsonSchema:l,extra:s}=e;return(0,u._)((0,I._)((0,u._)({name:n,title:o,description:a,required:r,"x-decorator":"FieldItem","x-decorator-props":{tag:eM.owu.LabelMap[t]},"x-origin-type":t},eV(e),eA({type:t,validateJsonSchema:l})),{defaultValue:i}),s)},eB=e=>!(0,ec.Z)(e)||!Object.keys(e).length,eU=n("156133"),eq=e=>{if(!!e)return Object.keys(e).reduce((t,n)=>{var o=e[n];return null==o?t[n]=void 0:"string"==typeof o||(0,eU.Z)(o)?t[n]=o:t[n]=JSON.stringify(e[n]),t},{})},eW=n("633697"),eG=n("479886"),eH=n.n(eG),e$=e=>(0,eW.Z)(e,e=>e.span_id).sort((e,t)=>(e.start_time?Number(e.start_time):1/0)-(t.start_time?Number(t.start_time):1/0)),eJ=e=>e.start_time?eH()(e.start_time).format("YYYY-MM-DD HH:mm:ss"):"-",eY=e=>{var t;return null===(t=e.tags)||void 0===t?void 0:t.find(e=>"is_trigger"===e.key)},eQ=(e,t)=>{var n,{tags:o}=e;if(!Array.isArray(o)||!o.length)return"";var r=o.find(e=>e.key===t);return(null==r?void 0:null===(n=r.value)||void 0===n?void 0:n.v_str)||""},eX=(e,t)=>{var n,{tags:o}=e;if(!Array.isArray(o)||!o.length)return"";var r=o.find(e=>e.key===t);return null==r?void 0:null===(n=r.value)||void 0===n?void 0:n.v_long},eK=e=>eX(e,"tokens"),e0=6e4,e1=36e5,e2=216e6;function e4(e){if(e<1e3)return"".concat(e,"ms");if(e<e0)return"".concat((e/1e3).toFixed(2),"s");if(e<e1)return"".concat((e/e0).toFixed(2),"min");else if(e<e2)return"".concat((e/e1).toFixed(2),"h");else return"".concat((e/e2).toFixed(2),"d")}var e6=e=>{var t=eQ(e,"workflow_id"),n=eQ(e,"workflow_node_id"),o=eQ(e,"execute_id");return{workflowId:t,nodeId:n,executeId:o,subExecuteId:eQ(e,"sub_execute_id")}},e5=e=>{var{span:t,onClick:n}=e;return(0,v.useMemo)(()=>eQ(t,"workflow_node_id"),[t])?(0,p.jsx)(R.hU,{icon:(0,p.jsx)(Z.Ph$,{}),size:"mini",onClick:()=>n(t)}):null},e3=6e4,e8=36e5,e9=216e6;var e7=((a={})[a.STRING=0]="STRING",a[a.DOUBLE=1]="DOUBLE",a[a.BOOL=2]="BOOL",a[a.LONG=3]="LONG",a[a.BYTES=4]="BYTES",a);var te=((i={})[i.SUCCESS=0]="SUCCESS",i[i.ERROR=1]="ERROR",i);e7.STRING,e7.DOUBLE,e7.BOOL,e7.LONG,e7.BYTES;var tt=e=>e===te.SUCCESS?te.SUCCESS:te.ERROR,tn=e=>e===te.SUCCESS,to=n("123709"),tr=n("982905"),ta=n("343552"),ti=n("500697"),tl=n("49708"),ts=n("471894"),td=n("956114"),tu=n("775878"),tc=n("140334"),tp=n("281403"),tv=n("567823"),tm=n("878155"),tf={normal:{stroke:"#C6C6CD",strokeWidth:1},hover:{stroke:"#B4BAF6",strokeWidth:2},select:{stroke:"#B4BAF6",strokeWidth:2}},tg={nodeBoxHeight:20,verticalInterval:12,offsetX:10},th={[te.SUCCESS]:{},[te.ERROR]:{lineStyle:{normal:{stroke:"#FF441E"},hover:{stroke:"#FF441E"},select:{stroke:"#FF441E"}}}},t_={UserInput:{icon:(0,p.jsx)(tv.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(254, 242, 237)"},hover:{fill:"rgb(254, 221, 210)"},select:{fill:"rgb(253, 183, 165)"}}}},ThirdParty:{flamethread:{rectStyle:{normal:{fill:"rgb(253, 236, 239)"},hover:{fill:"rgb(251, 207, 216)"},select:{fill:"rgb(246, 160, 181)"}}}},ScheduledTasks:{flamethread:{rectStyle:{normal:{fill:"rgb(247, 233, 247)"},hover:{fill:"rgb(239, 202, 240)"},select:{fill:"rgb(221, 155, 224)"}}}},OpenDialog:{flamethread:{rectStyle:{normal:{fill:"rgb(243, 237, 249)"},hover:{fill:"rgb(226, 209, 244)"},select:{fill:"rgb(196, 167, 233)"}}}},InvokeAgent:{icon:(0,p.jsx)(tm.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(236, 239, 248)"},hover:{fill:"rgb(209, 216, 240)"},select:{fill:"rgb(167, 179, 225)"}}}},RestartAgent:{icon:(0,p.jsx)(tm.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(234, 245, 255)"},hover:{fill:"rgb(203, 231, 254)"},select:{fill:"rgb(152, 205, 253)"}}}},SwitchAgent:{icon:(0,p.jsx)(tm.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(233, 247, 253)"},hover:{fill:"rgb(201, 236, 252)"},select:{fill:"rgb(149, 216, 248)"}}}},LLMCall:{icon:(0,p.jsx)(ts.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(229, 247, 248)"},hover:{fill:"rgb(194, 239, 240)"},select:{fill:"rgb(138, 221, 226)"}}}},LLMBatchCall:{icon:(0,p.jsx)(ts.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(228, 247, 244)"},hover:{fill:"rgb(192, 240, 232)"},select:{fill:"rgb(135, 224, 211)"}}}},Workflow:{icon:(0,p.jsx)(to.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(236, 247, 236)"},hover:{fill:"rgb(208, 240, 209)"},select:{fill:"rgb(164, 224, 167)"}}}},WorkflowStart:{icon:(0,p.jsx)(tr.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(243, 248, 236)"},hover:{fill:"rgb(227, 240, 208)"},select:{fill:"rgb(200, 226, 165)"}}}},WorkflowEnd:{icon:(0,p.jsx)(ta.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(242, 250, 230)"},hover:{fill:"rgb(227, 246, 197)"},select:{fill:"rgb(203, 237, 142)"}}}},PluginTool:{icon:(0,p.jsx)(ti.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(255, 253, 234)"},hover:{fill:"rgb(254, 251, 203)"},select:{fill:"rgb(253, 243, 152)"}}}},PluginToolBatch:{icon:(0,p.jsx)(ti.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(254, 251, 235)"},hover:{fill:"rgb(252, 245, 206)"},select:{fill:"rgb(249, 232, 158)"}}}},Knowledge:{icon:(0,p.jsx)(td.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(255, 248, 234)"},hover:{fill:"rgb(254, 238, 204)"},select:{fill:"rgb(254, 217, 152)"}}}},Code:{icon:(0,p.jsx)(tc.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(254, 242, 237)"},hover:{fill:"rgb(254, 221, 210)"},select:{fill:"rgb(253, 183, 165)"}}}},CodeBatch:{icon:(0,p.jsx)(tc.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(253, 236, 239)"},hover:{fill:"rgb(251, 207, 216)"},select:{fill:"rgb(246, 160, 181)"}}}},Condition:{icon:(0,p.jsx)(tu.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(247, 233, 247)"},hover:{fill:"rgb(239, 202, 240)"},select:{fill:"rgb(221, 155, 224)"}}}},Chain:{flamethread:{rectStyle:{normal:{fill:"rgb(243, 237, 249)"},hover:{fill:"rgb(226, 209, 244)"},select:{fill:"rgb(196, 167, 233)"}}}},Card:{icon:(0,p.jsx)(tp.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(236, 239, 248)"},hover:{fill:"rgb(209, 216, 240)"},select:{fill:"rgb(167, 179, 225)"}}}},WorkflowMessage:{icon:(0,p.jsx)(tl.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(234, 245, 255)"},hover:{fill:"rgb(203, 231, 254)"},select:{fill:"rgb(152, 205, 253)"}}}},WorkflowLLMCall:{icon:(0,p.jsx)(ts.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(233, 247, 253)"},hover:{fill:"rgb(201, 236, 252)"},select:{fill:"rgb(149, 216, 248)"}}}},WorkflowLLMBatchCall:{icon:(0,p.jsx)(ts.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(229, 247, 248)"},hover:{fill:"rgb(194, 239, 240)"},select:{fill:"rgb(138, 221, 226)"}}}},WorkflowCode:{icon:(0,p.jsx)(tc.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(228, 247, 244)"},hover:{fill:"rgb(192, 240, 232)"},select:{fill:"rgb(135, 224, 211)"}}}},WorkflowCodeBatch:{icon:(0,p.jsx)(tc.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(236, 247, 236)"},hover:{fill:"rgb(208, 240, 209)"},select:{fill:"rgb(164, 224, 167)"}}}},WorkflowCondition:{icon:(0,p.jsx)(tu.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(243, 248, 236)"},hover:{fill:"rgb(227, 240, 208)"},select:{fill:"rgb(200, 226, 165)"}}}},WorkflowPluginTool:{icon:(0,p.jsx)(ti.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(242, 250, 230)"},hover:{fill:"rgb(227, 246, 197)"},select:{fill:"rgb(203, 237, 142)"}}}},WorkflowPluginToolBatch:{icon:(0,p.jsx)(ti.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(255, 253, 234)"},hover:{fill:"rgb(254, 251, 203)"},select:{fill:"rgb(253, 243, 152)"}}}},WorkflowKnowledge:{icon:(0,p.jsx)(td.r,{}),flamethread:{rectStyle:{normal:{fill:"rgb(254, 251, 235)"},hover:{fill:"rgb(252, 245, 206)"},select:{fill:"rgb(249, 232, 158)"}}}}},ty={labelStyle:{position:"inside-left",fontSize:12,fill:"#1D1C23CC"},rowHeight:50,globalStyle:{},datazoomDecimals:1},tx={normal:{fill:"#F7F7FA"},hover:{fill:"#F0F0F5"},select:{fill:"#C6C6CD"}},tw={fill:"#212629",shape:{symbolType:"square",fill:"#212629",size:5}},tb=n("883159"),tj=(0,v.createContext)({treeMap:{},onCollapse:(e,t)=>""}),tk=()=>(0,v.useContext)(tj),tN=n("354712"),tS=e=>{var t,n,{renderGraphNodeConfig:o,nodeData:r}=e,{treeMap:a,onCollapse:i}=tk(),{selected:l,hover:s,key:d}=r,{spanNode:c}=null==r?void 0:r.extra,{type:m,name:f,status_code:g,isBroken:h,span_id:_,duration:y}=c,{isCollapsed:x}=a[d]||{},w=!c.children||0===c.children.length,{customTypeConfigMap:b,traceTreeCustomRenderer:j}=o||{},{icon:k,character:N,color:S}=function(e){var{name:t,type:n,customTypeConfigMap:o}=e,r={character:null==t?void 0:t.charAt(0),color:"#b4baf6"};if(!n)return r;var a,i=null!==(a=null==o?void 0:o[n])&&void 0!==a?a:t_[n];return(0,u._)({},r,i)}({type:m,name:f,customTypeConfigMap:b}),C=(0,v.useMemo)(()=>(0,p.jsx)("div",{className:(0,L.clsx)(tN.Z["tree-custom-node-content"],{[tN.Z.selected]:l,[tN.Z.hover]:s,[tN.Z.error]:!tn(g)}),children:(0,p.jsx)("span",{className:tN.Z.title,children:f})}),[l,s,g,f]);return(0,p.jsxs)("div",{className:tN.Z["tree-custom-node"],children:[(0,p.jsxs)("div",{className:tN.Z["tree-custom-node-icon"],children:[h?(0,p.jsx)(tb.r,{}):null,null!=k?k:(0,p.jsx)("span",{className:tN.Z["tree-custom-node-icon-default"],style:{backgroundColor:S},children:N})]}),(null==j?void 0:j.renderTooltip)?(0,p.jsx)(R.u,(0,I._)((0,u._)({position:"right"},null===(t=j.renderTooltip)||void 0===t?void 0:t.call(j,c)),{children:C})):C,(0,p.jsx)(R.Vp,{color:Number(y)>6e4?"red":Number(y)>1e4?"yellow":"green",type:"light",className:tN.Z["node-tag"],size:"mini",prefixIcon:(0,p.jsx)(Z.gO2,{}),children:function(e){if(e<1e3)return"".concat(e,"ms");if(e<e3)return"".concat((e/1e3).toFixed(2),"s");if(e<e8)return"".concat((e/e3).toFixed(2),"min");else if(e<e9)return"".concat((e/e8).toFixed(2),"h");else return"".concat((e/e9).toFixed(2),"d")}(Number(y))}),null==j?void 0:null===(n=j.renderExtra)||void 0===n?void 0:n.call(j,c),!w&&(0,p.jsx)(R.u,{content:x?"展开":"收起",position:"right",children:(0,p.jsx)(R.hU,{color:"secondary",size:"mini",icon:(0,p.jsx)(Z.tWI,{className:(0,L.clsx)(!x&&tN.Z["is-open"])}),onClick:e=>{e.stopPropagation(),null==i||i(_||"",!x)}})})]})},tC=e=>{var{renderGraphNodeConfig:t}=e;return e=>(0,p.jsx)(tS,{nodeData:e,renderGraphNodeConfig:t})},tI=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{isKeyNode:o,keyNodeParentId:r}=n[e.parent_id||""]||{};e.span_id&&(n[e.span_id]={isCollapsed:!1,isKeyNode:e.is_key_span,keyNodeParentId:o?e.parent_id:r}),null===(t=e.children)||void 0===t||t.forEach(e=>tI(e,n))},tT=e=>{var t={};return e.map(e=>tI(e,t)),t},tP=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{showKeyNodeOnly:o}=n;return e.map(e=>{var r,a,i,{status_code:l=te.SUCCESS}=e,s=null===(r=th[tt(l)])||void 0===r?void 0:r.lineStyle,d={key:e.span_id||"",title:tC(n),lineStyle:s,zIndex:e.status_code===te.ERROR?1:0,extra:{spanNode:e}},{isCollapsed:u,isKeyNode:c}=t[d.key]||{};return o&&!c?null!==(a=tP(e.children||[],t,n).flat())&&void 0!==a?a:[]:(!u&&(d.children=null!==(i=tP(e.children||[],t,n).flat())&&void 0!==i?i:[]),d)}).flat()||[]},tD=(e,t)=>{var n,o,r,a,i,l,{type:s=""}=e,d=null!==(l=null!==(i=null==t?void 0:null===(o=t[s])||void 0===o?void 0:null===(n=o.flamethread)||void 0===n?void 0:n.rectStyle)&&void 0!==i?i:null===(a=t_[s])||void 0===a?void 0:null===(r=a.flamethread)||void 0===r?void 0:r.rectStyle)&&void 0!==l?l:tx;return{normal:null==d?void 0:d.normal,hover:null==d?void 0:d.hover,select:null==d?void 0:d.select}},tE=e=>{var t,{span:n,startSpan:o,rowNo:r,customTypeConfigMap:a}=e,i=n.start_time-(o?o.start_time:0),l=i+n.duration;return{key:null!==(t=n.span_id)&&void 0!==t?t:"",rowNo:r,start:i,end:l,rectStyle:tD(n,a),extra:{span:n}}},tO=(e,t)=>{var n=null==e?void 0:e[0];return e.map((e,o)=>tE({span:e,startSpan:n,rowNo:o,customTypeConfigMap:t}))},tL=n("371066"),tM=n("345420"),tF=n("529801"),tZ=(e,t)=>{var n=[],o=[],r=(e,a,i)=>{var l=(0,I._)((0,u._)({},(0,tF.Z)(e,["children"])),{colNo:a,rowNo:n.length,unindented:(null==i?void 0:i.colNo)===a});if(n.push(l),void 0!==i&&o.push({startNode:i,endNode:l}),e.children){var s=e.children;s.forEach((e,n)=>{var o;(null!==(o=e.indentDisabled)&&void 0!==o?o:t.indentDisabled)&&s.length-1===n?r(e,a,l):r(e,a+1,l)})}};return r(e,0),{nodes:n,lines:o}},tR={indent:24,verticalInterval:16,nodeBoxHeight:16,offsetX:8},tV={normal:{stroke:"#ccc",strokeDasharray:"[]",strokeWidth:2,lineRadius:6,lineGap:0},select:{stroke:"#333"},hover:{stroke:"#d25e5a"}},tA=n("740537"),tz=e=>{var{treeData:t,selectedKey:n,indentDisabled:o=!1,lineStyle:r,globalStyle:a,className:i,onMouseMove:l,onMouseEnter:s,onMouseLeave:d,onClick:c,onSelect:m}=e,[f,g]=(0,v.useState)(""),{indent:h,verticalInterval:_,nodeBoxHeight:y,offsetX:x}=(0,v.useMemo)(()=>Object.assign({},tR,a),[a]),w=(0,v.useCallback)(e=>{for(var t,o,r=0;r<e.length;){var a=e[r];a.endNode.key===n?t=e.splice(r,1)[0]:a.endNode.key===f?o=e.splice(r,1)[0]:r++}return e.sort((e,t)=>{var n,o,r=null!==(n=e.endNode.zIndex)&&void 0!==n?n:-1,a=null!==(o=t.endNode.zIndex)&&void 0!==o?o:-1;return r>a?1:r<a?-1:0}),t&&e.push(t),o&&e.push(o),e},[n,f]),b=(0,v.useCallback)(e=>({normal:Object.assign({},null==tV?void 0:tV.normal,null==r?void 0:r.normal,null==e?void 0:e.normal),select:Object.assign({},null==tV?void 0:tV.select,null==r?void 0:r.select,null==e?void 0:e.select),hover:Object.assign({},null==tV?void 0:tV.hover,null==r?void 0:r.hover,null==e?void 0:e.hover)}),[r]),j=(0,v.useCallback)(e=>{var{startNode:{colNo:t,rowNo:n},endNode:{colNo:o,rowNo:r,lineStyle:a}}=e,{normal:i={}}=b(a),{lineRadius:l=0,lineGap:s=0}=i,d=y+_,u=t*h+x,c=n*d+(y+_/2);if(t===o){var p=(r-n-1)*d+_,v="M ".concat(u," ").concat(c+s),m="L ".concat(u," ").concat(c+p);return"".concat(v," ").concat(m)}var f=(r-n-1)*d+_/2+d/2-l,g=(o-t)*h-x-l,w=c+f+l,j="M ".concat(u," ").concat(c+s),k="L ".concat(u," ").concat(c+f),N="Q ".concat(u," ").concat(w," ").concat(u+l," ").concat(w),S="L ".concat(u+g+l-s," ").concat(w);return"".concat(j," ").concat(k," ").concat(N," ").concat(S)},[b,h,y,x,_]),k=(0,v.useCallback)((e,t)=>{if(f!==n)return e===f?(0,tL.Z)({},t.normal,t.hover):e===n?(0,tL.Z)({},t.normal,t.select):t.normal;return e===f?(0,tL.Z)({},t.normal,t.select,t.hover):t.normal},[f,n]),{nodes:N,lines:S}=tZ(t,{indentDisabled:o}),C=w(S);return(0,p.jsx)("div",{className:"".concat(tA.Z.tree," ").concat(null!=i?i:""),children:(0,p.jsxs)("div",{className:tA.Z["tree-container"],style:{marginTop:-_/2},children:[(0,p.jsx)("div",{className:tA.Z["tree-path-list"],children:(0,p.jsx)("svg",{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg",children:C.map((e,t)=>{var n=j(e),{lineStyle:o}=e.endNode,r=b(o),a=k(e.endNode.key,r);return(0,p.jsx)("path",{d:n,stroke:null==a?void 0:a.stroke,strokeWidth:null==a?void 0:a.strokeWidth,strokeDasharray:null==a?void 0:a.strokeDasharray,fill:"none"},e.endNode.key)})})}),(0,p.jsx)("div",{className:tA.Z["tree-node-list"],children:N.map(e=>{var{key:t,title:o,selectEnabled:r=!0,colNo:a}=e,i=(0,I._)((0,u._)({},e),{selected:n===t,hover:f===t});return(0,p.jsx)("div",{className:tA.Z["tree-node"],style:{paddingTop:_/2,paddingBottom:_/2},children:(0,p.jsx)("div",{className:tA.Z["tree-node-box"],style:{marginLeft:a*h,height:y},onClick:e=>{r&&(null==m||m({node:i})),null==c||c({event:e,node:i})},onMouseMove:e=>{null==l||l({event:e,node:i})},onMouseEnter:e=>{r&&g(t),null==s||s({event:e,node:(0,I._)((0,u._)({},i),{hover:!0})})},onMouseLeave:e=>{r&&g(""),null==d||d({event:e,node:(0,I._)((0,u._)({},i),{hover:!1})})},children:(0,tM.Z)(o)?o(i):o})},e.key)})})]})})},tB=e=>{var{spans:t,selectedSpanId:n,indentDisabled:o,lineStyle:r,globalStyle:a,className:i,onCollapseChange:l,renderGraphNodeConfig:s,defaultDisplayMode:d,hostUser:m}=e,f=(0,c._)(e,["spans","selectedSpanId","indentDisabled","lineStyle","globalStyle","className","onCollapseChange","renderGraphNodeConfig","defaultDisplayMode","hostUser"]),[g,h]=(0,v.useState)(),[_,y]=(0,v.useState)(()=>tT(t)),x=(0,v.useMemo)(()=>{var e,t,n;return{normal:Object.assign({},null===(e=tf)||void 0===e?void 0:e.normal,null==r?void 0:r.normal),select:Object.assign({},null===(t=tf)||void 0===t?void 0:t.select,null==r?void 0:r.select),hover:Object.assign({},null===(n=tf)||void 0===n?void 0:n.hover,null==r?void 0:r.hover)}},[r]),w=(0,v.useMemo)(()=>Object.assign({},tg,a),[a]);return(0,v.useEffect)(()=>{y(tT(t))},[t]),(0,v.useEffect)(()=>{t&&h(tP(t,_,{renderGraphNodeConfig:s,showKeyNodeOnly:!1}))},[_]),(0,p.jsx)(tj.Provider,{value:{treeMap:_,onCollapse:(e,t)=>{y((0,I._)((0,u._)({},_),{[e]:(0,I._)((0,u._)({},_[e]),{isCollapsed:t})})),null==l||l(e)}},children:(0,p.jsx)("div",{className:tN.Z["trace-tree-layout"],children:(0,p.jsx)("div",{className:(0,L.clsx)(tN.Z["trace-trees-wrapper"],"trace-trees-scroll-ref"),children:null==g?void 0:g.map(e=>(0,p.jsx)(tz,(0,u._)({className:(0,L.clsx)(tN.Z["trace-tree"],tN.Z["trace-graph-panel-content-trace-tree"]),treeData:e,selectedKey:n,indentDisabled:o,lineStyle:x,globalStyle:w},f),e.key))})})})},tU=n("765429"),tq=n("997516"),tW=n("261164"),tG={fill:"#F7F7FA",stroke:"#1D1C2314",lineWidth:1,lineDash:[]},tH={lineWidth:1,lineDash:[]},t$={lineWidth:1,lineDash:[]},tJ={height:"100%",width:"100%",padding:{top:0,right:24,bottom:24,left:0}},tY={position:"inside-left",fontSize:12,fill:"#212629"},tQ=(e,t,n)=>"".concat(e.start,"-").concat(e.end),tX=n("529871"),tK=e=>{var t=(0,v.useRef)(null),n=(0,v.useRef)(null),[o,r]=(0,v.useState)({width:0,height:0}),{flamethreadData:a,rowHeight:i=42,visibleColumnCount:l=6,tooltip:s,rectStyle:d,labelStyle:c,globalStyle:m,axisLabelSuffix:f,labelText:g,selectedKey:h,disableViewScroll:_=!1,enableAutoFit:y=!1,onClick:x}=e,w=(0,v.useCallback)(e=>({normal:Object.assign({},tG,null==d?void 0:d.normal,null==e?void 0:e.normal),hover:Object.assign({},tH,null==d?void 0:d.hover,null==e?void 0:e.hover),select:Object.assign({},t$,null==d?void 0:d.select,null==e?void 0:e.select)}),[d]),b=(0,v.useCallback)(e=>Object.assign({},tY,c,e),[c]),j=(0,v.useMemo)(()=>Object.assign({},tY,c),[c]),k=46,N=(0,v.useMemo)(()=>Object.assign({},tJ,m),[m]),S=(0,v.useMemo)(()=>(0,tU.Z)(a,(e,t)=>e.rowNo===t.rowNo).length*i,[a]),C=(0,v.useMemo)(()=>{var e,t=(0,tU.Z)(a,(e,t)=>e.rowNo===t.rowNo).length;return 0!==t?(((null===(e=n.current)||void 0===e?void 0:e.getViewBox().height())||300)-k)/(t*i):1},[a,o.height]),T=(0,v.useMemo)(()=>{var e=a.map(e=>{var t=w(e.rectStyle),n=b(e.labelStyle);return(0,I._)((0,u._)({},e),{rectStyle:t,labelStyle:n})}),t=[{type:tW.Cmj.component,componentType:tW.zHd.axis,id:"xAxis",scale:"xScale",axisType:"line",tickCount:l,dependency:["viewBox"],encode:{update:(e,t,n)=>{var o=n.xScale,r=o.range(),a=o.tickData(l),i=a.length>1?(r[1]-r[0])/(a.length-1)/2:0;return{verticalFactor:-1,x:n.viewBox.x1,y:n.viewBox.y1+k,start:{x:0,y:0},end:{x:n.viewBox.width(),y:0},tick:{visible:!1},label:{style:{dx:-i},formatMethod:e=>{var t=Number(e);return i>0&&0===t?"":0!==t&&void 0!==f?"".concat(t).concat(f):t}}}}}},{type:tW.Cmj.component,componentType:tW.zHd.grid,tickCount:l,scale:"xScale",gridType:"line",gridShape:"line",dependency:["viewBox"],encode:{update:(e,t,n)=>({verticalFactor:-1,length:n.viewBox.height()-k,x:n.viewBox.x1,x1:n.viewBox.x2,y:n.viewBox.y1+k,start:{x:0,y:0},end:{x:n.viewBox.width(),y:0},style:{stroke:"#ccc",lineWidth:1,lineDash:[]}})}},{type:tW.Cmj.group,dependency:["viewBox"],encode:{update:(e,t,n)=>({x:n.viewBox.x1,y:n.viewBox.y1+k,width:n.viewBox.width(),height:n.viewBox.height()-k,clip:!0})},marks:[{type:tW.Cmj.rect,id:"rect",from:{data:"orgData"},groupBy:"start",key:"rowNo",encode:{update:{x:{scale:"xScale",field:"start"},x1:{scale:"xScale",field:"end"},y:{scale:"yScale",field:"rowNo",band:.07},height:i-4,fill:(e,t,n)=>{var o,r;return null==e?void 0:null===(r=e.rectStyle)||void 0===r?void 0:null===(o=r.normal)||void 0===o?void 0:o.fill},innerBorder:(e,t,n)=>{var{stroke:o,lineWidth:r,lineDash:a}=e.rectStyle.normal;return{stroke:0!==r?o:null,lineWidth:r,lineDash:a,visible:!0,distance:r/2}}},hover2:{fill:(e,t,n)=>{var o,r,a,i,l;return null!==(l=null==e?void 0:null===(r=e.rectStyle)||void 0===r?void 0:null===(o=r.hover)||void 0===o?void 0:o.fill)&&void 0!==l?l:null==e?void 0:null===(i=e.rectStyle)||void 0===i?void 0:null===(a=i.normal)||void 0===a?void 0:a.fill},innerBorder:(e,t,n)=>{var o,r,{stroke:a,lineWidth:i,lineDash:l}=Object.assign({},null==e?void 0:null===(o=e.rectStyle)||void 0===o?void 0:o.normal,null==e?void 0:null===(r=e.rectStyle)||void 0===r?void 0:r.hover);return{stroke:0!==i?a:null,lineWidth:i,lineDash:l,visible:!0,distance:i/2}},zIndex:2},select2:{fill:(e,t,n)=>{var o,r,a,i,l;return null!==(l=null==e?void 0:null===(r=e.rectStyle)||void 0===r?void 0:null===(o=r.select)||void 0===o?void 0:o.fill)&&void 0!==l?l:null==e?void 0:null===(i=e.rectStyle)||void 0===i?void 0:null===(a=i.normal)||void 0===a?void 0:a.fill},innerBorder:(e,t,n)=>{var o,r,{stroke:a,lineWidth:i,lineDash:l}=Object.assign({},null==e?void 0:null===(o=e.rectStyle)||void 0===o?void 0:o.normal,null==e?void 0:null===(r=e.rectStyle)||void 0===r?void 0:r.select);return{stroke:0!==i?a:null,lineWidth:i,lineDash:l,visible:!0,distance:i/2}},zIndex:1}}},{type:tW.Cmj.component,componentType:tW.zHd.label,target:"rect",labelStyle:{position:j.position,textStyle:{fontSize:j.fontSize},animation:!1,overlap:{hideOnHit:!1,clampForce:!1,strategy:[{type:"position",position:["top-left"]}]}},encode:{update:{pickable:!1,text:null!=g?g:tQ,fill:(e,t,n)=>null==e?void 0:e.labelStyle.fill}}}]},{type:tW.Cmj.component,componentType:tW.zHd.datazoom,id:"dataZoom",dependency:["viewBox"],preview:{data:"table",x:{scale:"dataZoomXScale",field:["start","end"]},y:{scale:"dataZoomYScale",field:"rowNo"}},encode:{update:(e,t,n)=>({showDetail:!1,x:n.viewBox.x1,y:n.viewBox.y1,size:{width:n.viewBox.width(),height:20},minSpan:.01,selectedBackgroundStyle:{fill:"#B4BAF6"},brushSelect:!1,startHandlerStyle:{symbolType:"M-0.5-2.4h0.9c0.4,0,0.7,0.3,0.7,0.7v3.3c0,0.4-0.3,0.7-0.7,0.7h-0.9c-0.4,0-0.7-0.3-0.7-0.7v-3.3\nC-1.2-2-0.9-2.4-0.5-2.4z M-0.4-1.4L-0.4-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6\nC-0.4-1.4-0.4-1.4-0.4-1.4z M0.3-1.4L0.3-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6\nC0.3-1.4,0.3-1.4,0.3-1.4z;",fill:"#ffffff",scaleX:1.2,scaleY:1.2,stroke:"#aeb5be",lineWidth:1,size:20},middleHandlerStyle:{visible:!1},endHandlerStyle:{symbolType:"M-0.5-2.4h0.9c0.4,0,0.7,0.3,0.7,0.7v3.3c0,0.4-0.3,0.7-0.7,0.7h-0.9c-0.4,0-0.7-0.3-0.7-0.7v-3.3\nC-1.2-2-0.9-2.4-0.5-2.4z M-0.4-1.4L-0.4-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6\nC-0.4-1.4-0.4-1.4-0.4-1.4z M0.3-1.4L0.3-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6\nC0.3-1.4,0.3-1.4,0.3-1.4z;",fill:"#ffffff",scaleX:1.2,scaleY:1.2,stroke:"#aeb5be",lineWidth:1,size:20},startTextStyle:{padding:8,textStyle:{fontSize:12,lineHeight:"130%",fill:"#606773"},formatMethod:e=>e.toFixed(0)},endTextStyle:{padding:8,textStyle:{fontSize:12,lineHeight:"130%",fill:"#606773"},formatMethod:e=>e.toFixed(0)}})}}],n={top:3,right:0,bottom:0,left:0};return C<1&&(t.unshift({type:tW.Cmj.component,componentType:tW.zHd.scrollbar,direction:"vertical",id:"verticalScrollbar",dependency:["viewBox","yScale"],encode:{update:(e,t,n)=>{var o,r,{yScale:a}=n,i=null!==(r=null==a?void 0:null===(o=a.rangeFactor)||void 0===o?void 0:o.call(a))&&void 0!==r?r:[0,C];return{x:n.viewBox.x2+10,y:n.viewBox.y1+k,height:n.viewBox.height()-k,range:[i[1],i[0]]}}}}),n.right=22),{padding:n,background:N.background,data:[{id:"orgData",values:e},{id:"markData",source:"orgData"}],scales:[{id:"xScale",type:"linear",domain:{data:"markData",field:["start","end"]},dependency:["viewBox"],range:(e,t)=>[0,t.viewBox.width()],nice:!0},{id:"yScale",type:"band",domain:{data:"markData",field:"rowNo"},dependency:["viewBox"],range:(e,t)=>{var n=t.viewBox.height()-k;return[0,C<=1?n:S]},padding:0,round:!1},{id:"dataZoomXScale",type:"linear",domain:{data:"orgData",field:["start","end"]},dependency:["viewBox"],range:(e,t)=>[0,t.viewBox.width()]},{id:"dataZoomYScale",type:"band",domain:{data:"orgData",field:"rowNo"},dependency:["viewBox"],range:(e,t)=>[t.viewBox.height(),0],padding:.05,round:!0}],marks:t}},[a,l,j.position,j.fontSize,g,C,S,N.padding,N.background,w,b,f]),P=(0,v.useCallback)(e=>{var t,n=null==e?void 0:e.getMarkById("rect"),o=null==n?void 0:n.elements;null==o||o.forEach(e=>{null==e||e.removeState("select2")}),null==o||null===(t=o.filter(e=>e.getDatum().key===h)[0])||void 0===t||t.addState("select2")},[h]);return(0,v.useLayoutEffect)(()=>{var e=e=>{var t=null==e?void 0:e.getScaleById("yScale");null==t||t.setRangeFactor([0,C]),null==t||t.commit()},o=t=>{e(t)},r=e=>{var t=null==e?void 0:e.getMarkById("rect");null==t||t.addEventListener("click",(e,t)=>{null==x||x(e,t)}),null==t||t.addEventListener("touchstart",(e,t)=>{null==x||x(e,t)}),null==e||e.interaction("element-highlight",{selector:"rect",highlightState:"hover2"}),null==e||e.interaction("element-highlight",{trigger:"click",triggerOff:"swipe",selector:"rect",highlightState:"select2"}),!_&&e.interaction("view-scroll",{scaleY:"yScale"}),s&&(null==e||e.interaction("tooltip",(0,u._)({selector:"rect"},s)))};if(t.current&&!n.current){var a=new tW.G7x({autoFit:y,container:t.current});null==a||a.on("change",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var{start:o,end:r}=t[0].detail,i=a.getScaleById("xScale");null==i||i.setRangeFactor([o,r]),null==i||i.commit(),null==a||a.run()}),null==a||a.on("scrollDrag",e=>{var t,n;if("vertical"===(null==e?void 0:null===(n=e.target)||void 0===n?void 0:null===(t=n.attribute)||void 0===t?void 0:t.direction)){var o=e.detail.value,r=a.getScaleById("yScale");null==r||r.setRangeFactor(o),null==r||r.commit(),a.run()}}),a.parseSpec(T),o(a),r(a),a.run(),P(a),a.run(),n.current=a}else if(n.current){var i=n.current;i.updateSpec(T),o(i),r(i),i.run({reuse:!1}),P(i),i.run()}},[T,s,C,l,a]),(0,v.useEffect)(()=>{n.current&&P(n.current)},[h]),(0,v.useEffect)(()=>()=>{n.current&&n.current.release(),n.current=null},[]),(0,v.useEffect)(()=>{var e=new ResizeObserver(e=>{var t=e[0].target.clientWidth,o=e[0].target.clientHeight;void 0!==t&&void 0!==o&&n.current&&(n.current.resize(t,o),r({width:t,height:o}))});t.current&&e.observe(t.current)},[]),(0,p.jsx)("div",{className:tX.Z["flame-thread-canvas-wrapper"],style:(0,I._)((0,u._)({},(0,tq.Z)(N,["width","height"])),{overflow:"hidden"}),ref:t})},t0=e=>{var[t,n]=(0,v.useState)([]),{spans:o,selectedSpanId:r,rectStyle:a,labelStyle:i,globalStyle:l,visibleColumnCount:s,datazoomDecimals:d=ty.datazoomDecimals,axisLabelSuffix:u,disableViewScroll:c,enableAutoFit:m,onClick:f,renderGraphNodeConfig:g}=e,{traceFlamethreadCustomRenderer:h,customTypeConfigMap:_}=g||{};(0,v.useEffect)(()=>{n(tO(o,_))},[o]);var y=(0,v.useMemo)(()=>{var e=ty.rectStyle;return{normal:Object.assign({},null==e?void 0:e.normal,null==a?void 0:a.normal),hover:Object.assign({},null==e?void 0:e.hover,null==a?void 0:a.hover),select:Object.assign({},null==e?void 0:e.select,null==a?void 0:a.select)}},[a]),x=(0,v.useMemo)(()=>Object.assign({},i,ty.labelStyle),[i]),w=(0,v.useMemo)(()=>Object.assign({},l,ty.globalStyle),[l]),b=(0,v.useMemo)(()=>({title:{value:()=>({})},content:e=>{var t,n,o,{span:r}=null!==(n=e.extra)&&void 0!==n?n:{};return r?(null!==(o=null==h?void 0:null===(t=h.renderTooltip)||void 0===t?void 0:t.call(h,r))&&void 0!==o?o:[]).map(e=>{var{key:t,value:n,fill:o}=e;return{key:{text:t,fill:null!=o?o:tw.fill},value:{text:null!=n?n:"",fill:null!=o?o:tw.fill},shape:tw.shape}}):[]}}),[h]),j=(0,ep.Z)(e=>{var t,n,{span:o}=null!==(t=e.extra)&&void 0!==t?t:{};return null!==(n=o.name)&&void 0!==n?n:""});return t?(0,p.jsx)(tK,{flamethreadData:t,tooltip:b,rectStyle:y,labelStyle:x,globalStyle:w,labelText:j,datazoomDecimals:d,visibleColumnCount:s,axisLabelSuffix:u,selectedKey:r,disableViewScroll:c,enableAutoFit:m,onClick:f}):null},t1=n("331870"),t2=n.n(t1)()({storeAsString:!0}),t4=e=>e&&""!==e?e.toString():"-",t6=e=>{try{var t=JSON.parse(e);if("[object Object]"!==Object.prototype.toString.call(t)&&"[object Array]"!==Object.prototype.toString.call(t))return!1}catch(e){return!1}return!0},t5=e=>JSON.parse(JSON.stringify(t2.parse(e))),t3=e=>t6(e)?t5(e):e,t8=n("465228"),t9=e=>{if((0,es.Z)(e))return e;try{return JSON.stringify(e,null,4)}catch(t){return String(e)}},t7=e=>{var{onCopy:t}=e;return(0,p.jsx)(t8.he,(0,I._)((0,u._)({style:{whiteSpace:"pre-wrap",fontSize:"12px"},rootName:!1},e),{onCopy:(e,n,o)=>{o(t9(n)),null==t||t(e,t9(n),o)}}))},ne=n("685044"),{Text:nt}=R.ZT,nn=e=>{var{text:t,copyContent:n,description:o,onCopyClick:r}=e;return(0,p.jsxs)("div",{className:ne.Z["message-title"],children:[(0,p.jsx)(nt,{className:ne.Z["message-title-text"],copyable:!!n&&{content:n,icon:(0,p.jsx)(Z.UtC,{className:ne.Z["copy-icon"]}),successTip:(0,p.jsx)(Z.Y77,{}),onCopy:()=>null==r?void 0:r(n)},children:t}),o?(0,p.jsx)("div",{className:ne.Z["node-detail-title-description"],children:o}):null]})},no=n("663049"),nr=e=>{var t,{content:n,category:o,i18nMapping:r,isError:a,onCopyClick:i,panelStyle:l,encrypted:s,jsonViewerProps:d={}}=e,c=r[o],v=t3(t4(n));return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(nn,{text:null!==(t=null==c?void 0:c.title)&&void 0!==t?t:"",copyContent:s?"":"string"==typeof v?v:JSON.stringify(v),onCopyClick:i}),s?(0,p.jsxs)("div",{className:no.Z.encryption,children:[(0,p.jsx)("span",{children:"安全提示"}),(0,p.jsx)("span",{className:no.Z["encryption-tip"],children:"当前数据已被加密，无法查看"})]}):(0,p.jsx)("div",{className:(0,L.clsx)(no.Z["message-panel-content"],a&&no.Z["message-panel-content_error"]),style:l,children:"string"==typeof v?(0,p.jsx)("div",{className:no.Z["message-panel-content-detail-text"],children:v}):(0,p.jsx)("div",{className:no.Z["message-panel-content-json-container"],children:(0,p.jsx)(t7,(0,I._)((0,u._)({},d),{className:no.Z.content,value:v,defaultInspectDepth:5,onCopy:(e,t)=>null==i?void 0:i(t)}))})})]})};var na=((l={}).RUN_TREE="run_tree",l.FLAME_THREAD="flame_thread",l.INPUT="input",l.OUTPUT="output",l.META_TAGS="meta_tags",l.SPAN_DETAIL="span_detail",l),ni=e=>(0,eT.F)(t=>(0,I._)((0,u._)({},e),{ready:!1,span:null,patch:e=>t(()=>e)}),eP.X),nl=(0,v.createContext)({}),ns=e=>{var{spaceId:t,workflowId:n,isInOp:o,children:r}=e,a=(0,v.useMemo)(()=>ni({spaceId:t,workflowId:n,isInOp:o}),[t,n,o]);return(0,p.jsx)(nl.Provider,{value:a,children:r})},nd=e=>(0,v.useContext)(nl)(e);var nu=((s={})[s.Table=0]="Table",s[s.FlameThread=1]="FlameThread",s),nc=n("825955"),np=()=>{var e,[t,n]=(0,v.useState)(!1),[o,r]=(0,v.useState)(null),{span:a}=nd(e=>({span:e.span}));var i=(0,ep.Z)((e=(0,nc._)(function*(e){n(!0);var t=eH()().endOf("day").valueOf(),o=eH()().subtract(7,"day").startOf("day").valueOf();try{var{data:a}=yield eM.OHc.GetTraceSDK({log_id:e,start_at:o,end_at:t});if(!a||!a.spans)return;var i=e$(a.spans);r(i)}finally{n(!1)}}),function(t){return e.apply(this,arguments)}));return(0,v.useEffect)(()=>{(null==a?void 0:a.log_id)&&i(a.log_id)},[a,i]),{spans:o,loading:t}},nv=n("58197"),nm=n("553201"),nf=()=>(0,p.jsx)("div",{className:nm.Z["full-template"],children:(0,p.jsx)(nv.TL,{width:"100px",height:"100px"})}),ng=()=>(0,p.jsx)("div",{className:nm.Z["full-template"],children:(0,p.jsx)(R.yC,{})}),nh=n("346707"),n_=n("598227"),ny=e=>{var{spans:t}=e,n=[{title:eg.o.t("platfrom_trigger_creat_name"),dataIndex:"name"},{title:eg.o.t("debug_asyn_task_task_status"),dataIndex:"status_code",render:e=>0===e?eg.o.t("debug_asyn_task_task_status_success"):eg.o.t("debug_asyn_task_task_status_failed"),width:78},{title:eg.o.t("analytic_query_table_title_tokens"),render:(e,t)=>{var n=eK(t);return(0,nh.Z)(n)?"-":n},width:78},{title:eg.o.t("db_add_table_field_type_time"),dataIndex:"duration",render:e4,width:78}];return(0,p.jsx)("div",{className:n_.Z["trace-table"],children:(0,p.jsx)(R.iA,{tableProps:{dataSource:t,rowKey:"span_id",columns:n,size:"small"}})})},nx=n("534928"),nw=[{label:eg.o.t("analytic_query_detail_left_panel_flamethread"),value:nu.FlameThread},{label:eg.o.t("Starling_filebox_api_list"),value:nu.Table}],nb=e=>{var{onOpenDetail:t,onGotoNode:n}=e,[o,r]=(0,v.useState)(nu.FlameThread),{ready:a,spaceId:i,isInOp:l}=nd(e=>({ready:e.ready,spaceId:e.spaceId,isInOp:e.isInOp})),{spans:s,loading:d}=np(),c=(0,v.useMemo)(()=>(function(e){if(0===e.length)return{roots:[],spans:[]};var t=[],n={},o=(0,eW.Z)(e,e=>e.span_id).sort((e,t)=>(e.start_time?Number(e.start_time):1/0)-(t.start_time?Number(t.start_time):1/0));return o.forEach(e=>{var t=(0,I._)((0,u._)({},e),{children:[]}),{span_id:o}=e;o&&(n[o]=t)}),o.forEach(e=>{var{span_id:o,parent_id:r}=e;if(o){var a,i=n[o],l=r?n[r]:void 0;void 0===l?t.push((0,I._)((0,u._)({},i),{isBroken:"0"!==r})):(l.children=null!==(a=l.children)&&void 0!==a?a:[],l.children.push(i))}}),{roots:t,spans:o}})(s||[]),[s]),m=e=>{n(e6(e))},f=e=>{var t=e6(e);el((0,I._)((0,u._)({},t),{spaceId:i}),l)};return!a||d?(0,p.jsx)(ng,{}):s?(0,p.jsxs)("div",{className:nx.Z["trace-graph"],children:[(0,p.jsx)("div",{className:(0,L.clsx)(nx.Z["graph-part"],nx.Z["part-tree"]),children:(0,p.jsx)(tB,{spans:c.roots,renderGraphNodeConfig:{traceTreeCustomRenderer:{renderExtra:e=>e.parent_id&&"0"!==e.parent_id?(0,p.jsx)(e5,{span:e,onClick:m}):(0,p.jsx)(R.hU,{size:"mini",icon:(0,p.jsx)(Z.sGJ,{}),onClick:t=>{t.stopPropagation(),f(e)}})}},onSelect:e=>{var n,o=null===(n=e.node.extra)||void 0===n?void 0:n.spanNode;o&&t(o)}})}),(0,p.jsx)("div",{className:(0,L.clsx)(nx.Z["graph-part"],nx.Z["part-chart"]),children:(0,p.jsxs)("div",{className:nx.Z["trace-charts"],children:[(0,p.jsxs)("div",{className:nx.Z["chart-header"],children:[(0,p.jsx)(R.ZT.Text,{strong:!0,fontSize:"16px",children:eg.o.t("store_bot_detail_title_mobile")}),(0,p.jsx)(R.Ph,{size:"small",className:nx.Z["mode-select"],optionList:nw,value:o,onChange:e=>r(e)})]}),(0,p.jsxs)("div",{className:nx.Z["chart-content"],children:[o===nu.Table&&(0,p.jsx)(ny,{spans:s}),o===nu.FlameThread&&(0,p.jsx)(t0,{spans:s})]})]})})]}):(0,p.jsx)(nf,{})},nj=n("609214"),nk=()=>{var e=eH()().endOf("day").toDate();return[eH()().subtract(6,"day").startOf("day").toDate(),e]},nN=e=>{var[t,n]=(0,v.useState)(nk()),[o,r]=(0,v.useState)(nj.pN.Unknown),[a,i]=(0,v.useState)([]),l=(0,v.useRef)(new Map),{ready:s,span:d,patch:u}=nd(e=>({span:e.span,ready:e.ready,patch:e.patch})),c=(0,ep.Z)((0,nc._)(function*(){var n=new URLSearchParams(location.search),r=n.get("execute_mode"),a=n.get("execute_id"),{spans:c}=yield eM.OHc.ListRootSpans({workflow_id:e,limit:50,offset:0,start_at:t[0].getTime(),end_at:t[1].getTime(),status:o===nj.pN.Unknown?void 0:o,execute_mode:r?Number(r):void 0}),p=c||[],v=p[0];if(a&&!s&&!d)try{var m,{data:f}=yield eM.OHc.GetTraceSDK({execute_id:a,workflow_id:e,start_at:t[0].getTime(),end_at:t[1].getTime()}),g=null==f?void 0:null===(m=f.spans)||void 0===m?void 0:m[0];(null==g?void 0:g.log_id)&&(v=g,!p.find(e=>e.log_id===g.log_id)&&p.unshift(g))}catch(e){}p.forEach(e=>{e.log_id&&l.current.set(e.log_id,e)}),i(p),!s&&!d&&v&&u({span:v}),!s&&u({ready:!0})})),p=(0,v.useCallback)(e=>{var[t,o]=e;n([t,eH()(o).endOf("day").toDate()])},[n]);return(0,v.useEffect)(()=>{c()},[t,o,c]),{date:t,status:o,setStatus:r,options:a,optionsCacheRef:l,fetch:c,onDateChange:p}},nS=e=>{var{value:t,onChange:n}=e,o=(0,v.useCallback)(()=>(0,p.jsx)(R.hU,{icon:(0,p.jsx)(Z.vlS,{}),color:"secondary",size:"small"}),[]);return(0,p.jsx)(R.Ph,{value:t,triggerRender:o,optionList:[{value:nj.pN.Unknown,label:eg.o.t("query_status_all")},{value:nj.pN.Fail,label:eg.o.t("query_status_failed")},{value:nj.pN.Success,label:eg.o.t("query_status_completed")}],onChange:n})},nC=e=>{var{status:t,className:n}=e;return 0===t?(0,p.jsx)(Z.Lz_,{className:(0,L.clsx)(n,"coz-fg-hglt-green")}):(0,p.jsx)(Z.cO9,{className:(0,L.clsx)(n,"coz-fg-hglt-red")})},nI=e=>{var{status:t,className:n,type:o="normal"}=e,r=(0,v.useMemo)(()=>"icon"===o?null:0===t?eg.o.t("debug_asyn_task_task_status_success"):eg.o.t("debug_asyn_task_task_status_failed"),[t,o]);return(0,p.jsx)(R.Vp,{prefixIcon:0===t?(0,p.jsx)(Z.Lz_,{}):(0,p.jsx)(Z.cO9,{}),color:0===t?"green":"red",className:n,size:"mini",children:r})},nT=n("816997"),nP=e=>{var{span:t}=e,n=(0,v.useMemo)(()=>eJ(t),[t]),o=(0,v.useMemo)(()=>eY(t),[t]),{spaceId:r,isInOp:a}=nd(e=>({spaceId:e.spaceId,isInOp:e.isInOp}));return(0,p.jsxs)("div",{className:nT.Z["select-option"],children:[(0,p.jsxs)("div",{className:nT.Z.title,children:[(0,p.jsx)(nC,{status:t.status_code,className:nT.Z.icon}),(0,p.jsx)(R.ZT.Text,{ellipsis:{showTooltip:!0},children:n})]}),o?(0,p.jsx)(R.Vp,{style:{color:"var(--coz-fg-hglt)",backgroundColor:"var(--coz-mg-hglt)"},size:"mini",children:eg.o.t("workflow_start_trigger_triggername")}):null,(0,p.jsx)(R.hU,{size:"mini",icon:(0,p.jsx)(Z.sGJ,{}),onClick:e=>{e.stopPropagation();var n=e6(t);el((0,I._)((0,u._)({},n),{spaceId:r}),a)}})]})},nD=e=>{var{onChange:t}=e,n=(0,c._)(e,["onChange"]),o=(0,v.useCallback)(()=>(0,p.jsx)(R.hU,{icon:(0,p.jsx)(Z.rtX,{}),color:"secondary",size:"small"}),[]);return(0,p.jsx)(R.Mt,(0,u._)({type:"dateRange",triggerRender:o,disabledDate:e=>{if(!e)return!1;var t=e.getTime(),n=eH()().endOf("day").valueOf();return t<eH()().subtract(6,"day").startOf("day").valueOf()||t>n},onChange:e=>{t(e)}},n))},nE=n("945328"),nO=()=>{var{span:e,workflowId:t,patch:n}=nd(e=>({span:e.span,workflowId:e.workflowId,patch:e.patch})),{date:o,status:r,setStatus:a,options:i,optionsCacheRef:l,fetch:s,onDateChange:d}=nN(t),c=(0,v.useMemo)(()=>i.map(e=>(0,I._)((0,u._)({},e),{value:e.log_id,label:(0,p.jsx)(nP,{span:e})})),[i]),m=(0,v.useCallback)(e=>{n({span:e&&l.current.has(e)?l.current.get(e):null})},[l,n]),f=(0,ep.Z)(e=>{e&&s()});return(0,p.jsxs)("div",{className:nE.Z["trace-select"],children:[(0,p.jsxs)("div",{className:nE.Z["trace-filter"],children:[(0,p.jsx)(nD,{value:o,onChange:d}),(0,p.jsx)(nS,{value:r,onChange:a})]}),(0,p.jsx)(R.Ph,{className:nE.Z["main-select"],optionList:c,value:null==e?void 0:e.log_id,onChange:m,renderSelectedItem:e=>{var t=l.current.get(e.value);return t?eJ(t):"-"},onDropdownVisibleChange:f})]})},nL=n("605357"),nM=()=>(0,p.jsxs)("div",{className:nL.Z["trace-panel-header"],children:[(0,p.jsx)("div",{className:nL.Z["header-tabs"],children:(0,p.jsx)("div",{className:nL.Z["trace-title"],children:eg.o.t("debug_btn")})}),(0,p.jsx)(nO,{})]}),nF=e=>{var{spaceId:t,workflowId:n,isInOp:o,maxHeight:r,onOpenDetail:a,onGotoNode:i,onClose:l}=e;return(0,p.jsx)(ns,{spaceId:t,workflowId:n,isInOp:o,children:(0,p.jsx)(ef,{header:(0,p.jsx)(nM,{}),height:300,resizable:{min:300,max:r},onClose:l,children:(0,p.jsx)(nb,{onOpenDetail:a,onGotoNode:i})})})},nZ=n("626389"),nR=n.n(nZ),nV=n("682088"),nA=e=>{var{label:t,value:n}=e;return(0,p.jsxs)("div",{className:nV.Z["pay-block"],children:[(0,p.jsxs)(R.ZT.Text,{type:"secondary",size:"small",children:[t,":"]}),(0,p.jsx)(R.ZT.Text,{strong:!0,size:"small",children:n})]})},nz=e=>{var{options:t}=e;return(0,p.jsx)("div",{className:nV.Z["pay-blocks"],children:t.flatMap((e,n)=>n<t.length-1?[(0,p.jsx)(nA,(0,u._)({},e),e.label),(0,p.jsx)(R.iz,{layout:"vertical",margin:4,style:{height:"10px"}})]:[(0,p.jsx)(nA,(0,u._)({},e),e.label)])})},nB=n("509892"),nU=e=>(0,p.jsx)(nr,(0,I._)((0,u._)({},e),{className:nB.Z["json-viewer"],i18nMapping:{[na.INPUT]:{title:eg.o.t("workflow_detail_node_input")},[na.OUTPUT]:{title:eg.o.t("workflow_detail_node_output")}}})),nq=e=>{var t,n,o,r,{span:a,onClose:i,onGotoNode:l}=e,s=(0,v.useMemo)(()=>{var e=[{label:eg.o.t("analytic_query_detail_key_latency"),value:a.duration?e4(a.duration):"0ms"}],t=eK(a);return!(0,nh.Z)(t)&&e.push({label:eg.o.t("analytic_query_table_title_tokens"),value:"".concat(t)}),e},[a]);return(0,p.jsx)(ef,{header:eg.o.t("workflow_running_results"),onClose:i,className:nB.Z["trace-detail-panel"],children:(0,p.jsxs)("div",{className:nB.Z["trace-detail"],children:[(0,p.jsxs)("div",{className:nB.Z["detail-title"],children:[(0,p.jsx)(R.ZT.Text,{strong:!0,children:a.alias_name}),(0,p.jsx)(nI,{status:a.status_code}),(0,p.jsx)(e5,{span:a,onClick:()=>{l(e6(a))}})]}),(0,p.jsx)(nz,{options:s}),a.log_id?(0,p.jsxs)("div",{className:nB.Z["log-id"],children:[(0,p.jsxs)(R.ZT.Text,{type:"secondary",size:"small",children:["LogId: ",a.log_id]}),(0,p.jsx)(R.hU,{icon:(0,p.jsx)(Z.UtC,{}),size:"mini",onClick:()=>{try{nR()(a.log_id||""),R.FN.success({content:eg.o.t("copy_success"),showClose:!1})}catch(e){R.FN.error(eg.o.t("copy_failed"))}},color:"secondary"})]}):null,(0,p.jsx)(R.iz,{margin:16}),(null===(t=a.input)||void 0===t?void 0:t.content)?(0,p.jsx)(nU,{content:null===(n=a.input)||void 0===n?void 0:n.content,category:na.INPUT,jsonViewerProps:{displayDataTypes:!1}}):null,(null===(o=a.output)||void 0===o?void 0:o.content)?(0,p.jsx)(nU,{content:null===(r=a.output)||void 0===r?void 0:r.content,category:na.OUTPUT,jsonViewerProps:{displayDataTypes:!1}}):null]})})}},815288:function(e,t,n){n.d(t,{CO:()=>m,aA:()=>g,w_:()=>s,mD:()=>v});var o,r=n("151064"),a=n("674343"),i=n("175399"),l=n("58197");var s=((o={}).Success="success",o.UploadFail="uploadFail",o.ValidateFail="validateFail",o.Validating="validating",o.Uploading="uploading",o.Wait="wait",o),d=["jpg","jpeg","png","webp","svg"],u=["js","jsx","ts","tsx","html","htm","css","scss","sass","less","py","java","c","cpp","h","hpp","cs","go","rb","php","swift","kt","kts","sql","pl","sh","bash","rs","dart","scala","yaml","yml","json"],c={ppt:l.pr,pptx:l.pr,doc:l.LG,docx:l.LG,pdf:l.n4,txt:l.GH,zip:l.qI,rar:l.qI,xls:l.hz,xlsx:l.hz,csv:l.vY,code:l.Ck,video:l.Qk,audio:l.BV},p=e=>{var t,n,o,r,a,s,d=null!==(s=c[e])&&void 0!==s?s:l.IG;if(t=e,(n=i.lookup(t))&&n.startsWith("audio/"))d=c.audio;else{;if(o=e,(r=i.lookup(o))&&r.startsWith("video/"))d=c.video;else{;if(a=e,u.includes(a))d=c.code}}return d};function v(e){if(!e)return"";var t=e.lastIndexOf(".");return e.slice(t+1).toLowerCase()}var m=e=>{var t=v(e);return d.includes(t)},f=n("99248"),g=e=>{var{size:t=20,file:n}=e,{url:o,name:i,status:l}=n,u=v(i);if(l===s.Uploading)return(0,r.jsx)(a.yC,{wrapperClassName:f.Z["file-icon-loading"],style:{width:t,height:t,lineHeight:"".concat(t,"px")},spinning:!0});if(d.includes(u))return(0,r.jsx)(a.Ee,{preview:!1,className:"object-contain object-center rounded-sm border-0",style:{width:t,height:t},imgStyle:{width:t,height:t},src:o,alt:""});var c=p(u);return(0,r.jsx)(c,{style:{width:t,height:t,fontSize:t}})}},248399:function(e,t,n){n.r(t),n.d(t,{FormCore:function(){return u},SchemaField:function(){return d}});var o=n(151064),r=n(455069),a=n(537845),i=n(817480),l=n(949926),s=n(43569),d=(0,i.createSchemaField)({components:{Input:s.II,InputInteger:s.zs,InputNumber:s.Rn,FormItem:s.xJ,FormSection:s.hj,FileUpload:s.p0,Switch:s.rs,VoiceSelect:s.tk,TextArea:s.Kx,FullInput:s.oq,InputTime:s.lJ}}),u=(0,r.forwardRef)((e,t)=>{var{schema:n,components:s,initialValues:u,disabled:c,onFormValuesChange:p}=e,v=(0,a.Z)(e=>{null==p||p(e)}),m=(0,r.useMemo)(()=>(0,l.createForm)({initialValues:u,disabled:c,effects(){(0,l.onFormValuesChange)(v)}}),[]);return(0,r.useImperativeHandle)(t,()=>m,[m]),(0,o.jsx)(i.FormProvider,{form:m,children:(0,o.jsx)(d,{components:s,schema:n})})});t.default=u},886754:function(e,t,n){n.d(t,{s:function(){return o.FormCore}});var o=n(248399)},213354:function(e,t,n){n.d(t,{R:function(){return s}});var o=n(825955),r=n(808549),a=n(151064),i=n(455069),l=(0,i.lazy)((0,o._)(function*(){return yield Promise.resolve().then(n.bind(n,248399))})),s=(0,i.forwardRef)((e,t)=>(0,a.jsx)(i.Suspense,{fallback:null,children:(0,a.jsx)(l,(0,r._)({ref:t},e))}))},43569:function(e,t,n){n.d(t,{xJ:()=>er,lJ:()=>es,hj:()=>ei,rs:()=>B,zs:()=>q,Kx:()=>J,tk:()=>H,Rn:()=>W,oq:()=>ee,II:()=>d,p0:()=>V});var o,r,a=n("808549"),i=n("151064"),l=n("817480"),s=n("674343"),d=(0,l.connect)(e=>(0,i.jsx)(s.II,(0,a._)({size:"small"},e)),(0,l.mapProps)({validateStatus:!0})),u=n("825955"),c=n("538059"),p=n("455069"),v=n("801815"),m=n("252237"),f=n.n(m),g=n("537845"),h=n("136515"),_=n("336205"),y=n("815288"),x=n("204558"),w=n("824946"),b=n("175399"),j=n("155440");function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";var n=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,n)).toFixed(t))).concat(["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][n])}var N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0x1400000;if(t&&e>t)return _.o.t("imageflow_upload_exceed",{size:k(t)})};function S(){return(S=(0,u._)(function*(e){var t=URL.createObjectURL(e);return new Promise((e,n)=>{var o=new window.Image;o.onload=()=>{e({width:o.naturalWidth,height:o.naturalHeight})},o.onerror=e=>{n(e)},o.src=t})})).apply(this,arguments)}var C=(o=(0,u._)(function*(e,t){var{maxWidth:n,minWidth:o,maxHeight:r,minHeight:a,aspectRatio:i}=t||{};if(!(0,j.Z)(n||o||r||a||i)){var{width:l,height:s}=yield function(e){return S.apply(this,arguments)}(e);return n&&l>n?_.o.t("imageflow_upload_error5",{value:"".concat(n,"px")}):o&&l<o?_.o.t("imageflow_upload_error3",{value:"".concat(o,"px")}):r&&s>r?_.o.t("imageflow_upload_error4",{value:"".concat(r,"px")}):a&&s<a?_.o.t("imageflow_upload_error2",{value:"".concat(a,"px")}):i&&l/s>i?_.o.t("imageflow_upload_error1"):void 0}}),function(e,t){return o.apply(this,arguments)}),I=(e,t)=>{if(!t)return;var n,o=t.split(","),r=(0,y.mD)(e),a=b.lookup(r);if(!(o.includes("image/*")&&(null==a?void 0:null===(n=a.startsWith)||void 0===n?void 0:n.call(a,"image/")))){if(!o.includes(".".concat(r)))return _.o.t("imageflow_upload_error_type",{type:"".concat(o.filter(Boolean).join("/"))})}};var T=(r=(0,u._)(function*(e,t){var{size:n,name:o}=e,{maxSize:r,imageSize:a,accept:i,customValidate:l}=t||{},s=[(0,u._)(function*(){return yield null==l?void 0:l(e)}),()=>N(n,r),(0,u._)(function*(){return yield C(e,a)}),()=>I(o,i)],d,c=!1,p=!1;try{for(var v,m=(0,w._)(s);c=!(v=yield m.next()).done;c=!1){var f=v.value,g=yield f();if(g)return g}}catch(e){p=!0,d=e}finally{try{c&&null!=m.return&&(yield m.return())}finally{if(p)throw d}}}),function(e,t){return r.apply(this,arguments)}),P=n("450562"),D=n("298203"),E=n("727914"),O=e=>{var t,n,o,{initialValue:r=[],customValidate:a,timeout:i,fileType:l,multiple:d=!0,maxSize:c,accept:m,maxFileCount:f=20}=e||{},[g,h]=(0,p.useState)(r),x=g.some(e=>e.status===y.w_.Uploading),w=(e,t)=>{h(n=>{var o=[...n],r=o.findIndex(t=>t.uid===e);return -1!==r&&Object.keys(t).forEach(e=>{o[r][e]=t[e]}),o})};var b=(t=(0,u._)(function*(e){var t;try{var n,o=(n=(0,u._)(function*(){return yield(0,D.fr)({biz:"workflow",fileType:l,file:e,getProgress:t=>{w(e.uid,{percent:t})}})}),function(){return n.apply(this,arguments)});i&&(t=setTimeout(()=>{throw Error("Upload timed out")},i));var r=yield o();if(!r)throw new E.sH("normal_error","no uri");clearTimeout(t);var{url:a}=yield P.OHc.SignImageURL({uri:r},{__disableErrorToast:!0});if(!a)throw Error(_.o.t("imageflow_upload_error"));return w(e.uid,{url:a,status:y.w_.Success}),a}catch(n){w(e.uid,{validateMessage:n.message||"upload failed",status:y.w_.ValidateFail}),clearTimeout(t)}}),function(e){return t.apply(this,arguments)});var j=(n=(0,u._)(function*(e){var t=yield T(e,{customValidate:a,maxSize:(null!=c?c:"image"===l)?5242880:0x1400000,accept:m});if(t)return t}),function(e){return n.apply(this,arguments)});var k=(o=(0,u._)(function*(e){e.status=y.w_.Uploading,!e.uid&&(e.uid=(0,v.x0)());var t=yield j(e);if(t){s.FN.error(t);return}!d&&g[0]&&h([]);var n=!0;h(t=>t.length>=f?(s.FN.warning(_.o.t("plugin_file_max")),n=!1,t):[...t,e]),n&&(yield b(e))}),function(e){return o.apply(this,arguments)});return{fileList:g,upload:k,isUploading:x,deleteFile:e=>{var t=g.findIndex(t=>e===t.uid);-1!==t&&e&&h(e=>{var n=[...e];return n.splice(t,1),n})},setFileList:e=>h(e)}},L=n("373231"),M="x-wf-file_name",F=e=>{var t,n,o=null!==(t=null==e?void 0:e.url)&&void 0!==t?t:"",r=null!==(n=null==e?void 0:e.name)&&void 0!==n?n:"";try{var a=new URL(o),i=new URLSearchParams(a.search);return i.has(M)?i.set(M,r):i.append(M,r),a.search=i.toString(),a.toString()}catch(e){return o}},Z=e=>{var t,n=null!==(t=new URLSearchParams(new URL(e).search).get(M))&&void 0!==t?t:_.o.t("plugin_file_unknown");return{url:e,uid:(0,v.x0)(),name:n}},R=(e,t)=>{if(t){var n=(0,x.f5)(e);if(Array.isArray(n))return n.map(e=>Z(e))}return e?[Z(e)]:[]},V=(0,l.connect)(e=>{var t,{validateStatus:n,value:o,onChange:r,onBlur:a,onFocus:l,accept:d,multiple:m,disabled:x,fileType:w}=e,b=(0,p.useRef)(!1),j=m?20:1,{upload:N,fileList:S,isUploading:C,deleteFile:I,setFileList:T}=O({multiple:m,fileType:w,accept:d,maxFileCount:j}),P=()=>{!b.current&&(b.current=!0,null==l||l())},D=()=>{b.current&&(b.current=!1,null==a||a())};var E=(t=(0,u._)(function*(e){var{fileInstance:t}=e;yield N(t)}),function(e){return t.apply(this,arguments)}),M=(0,g.Z)(()=>{var e;if(m){var t=S.filter(e=>e.url).map(e=>F(e));e=t.length?JSON.stringify(t):void 0}else{var n=null==S?void 0:S[0];e=n?F(n):void 0}return e}),Z=(0,g.Z)(e=>null==r?void 0:r(e));(0,h.Z)(()=>{var e=M();null==Z||Z(e)},[S]),(0,p.useEffect)(()=>{M()!==o&&T(R(o,m))},[o]);var V=S.map(e=>({name:e.name,size:void 0!==e.size?k(e.size):"",uid:e.uid||(0,v.x0)(),status:e.status||y.w_.Success,url:e.uil,validateMessage:e.validateMessage,percent:e.percent,preview:!0}));return(0,i.jsx)(c.Z,{onClickAway:()=>{!C&&D()},children:(0,i.jsx)("div",{className:f()(L.Z.container,{[L.Z["hide-upload-area"]]:S.length>=j}),children:(0,i.jsx)(s.gq,{disabled:x,action:"",limit:j,fileList:V,"data-testid":e["data-testid"],className:"error"===n?"has-error":"",customRequest:E,draggable:!0,dragMainText:_.o.t("imageflow_upload_action_common"),dragSubText:_.o.t("imageflow_upload_type",{type:d}),multiple:m,accept:d,onDrop:P,onOpenFileDialog:P,onAcceptInvalid:()=>{s.FN.error(_.o.t("imageflow_upload_error_type",{type:d}))},previewFile:e=>{var{uid:t}=e,n=S.find(e=>e.uid===t);if(n)return(0,i.jsx)(y.aA,{file:n,size:36})},onRemove:(e,t,n)=>{I(n.uid)},onClear:()=>T([])})})})},(0,l.mapProps)({validateStatus:!0})),A=n("120454"),z=n("473980"),B=(0,l.connect)(e=>{var{value:t}=e,n=(0,z._)(e,["value"]);return(0,i.jsx)(s.rs,(0,A._)((0,a._)({checked:t},n),{size:"small"}))}),U=e=>{var{onChange:t}=e,n=(0,z._)(e,["onChange"]),o=(0,p.useCallback)(e=>{null==t||t(""===e?void 0:e)},[t]);return(0,i.jsx)(s.k7,(0,A._)((0,a._)({onChange:o},n),{size:"small",style:{width:"100%"}}))},q=(0,l.connect)(e=>(0,i.jsx)(U,(0,A._)((0,a._)({},e),{precision:.1}))),W=(0,l.connect)(U),G=n("614904"),H=(0,l.connect)(e=>(0,i.jsx)(G.tk,(0,a._)({},e)),(0,l.mapProps)({validateStatus:!0})),$=n("945984"),J=(0,l.connect)(e=>{var{size:t,className:n}=e,o=(0,z._)(e,["size","className"]);return(0,i.jsx)(s.Kx,(0,a._)({className:f()({[$.Z["text-area-small"]]:"small"===t},n)},o))},(0,l.mapProps)({validateStatus:!0})),Y=n("311807"),Q=n("178626"),X=n("734957"),K=e=>{var{className:t,disabled:n,expand:o=!0,value:r,onChange:l}=e,s=(0,z._)(e,["className","disabled","expand","value","onChange"]),d=(0,p.useRef)(null),u=(0,p.useRef)((0,v.x0)()),c=(0,p.useRef)(),m=(0,p.useRef)((0,Y.Z)(e=>{if(!!d.current){var t=d.current.getContent(),{markdown:n}=(0,Q.delta2md)(t.deltas[0],t.deltas);n!==c.current&&(c.current=n,l(n))}},500)).current;return(0,p.useEffect)(()=>{if(r!==c.current){var e;c.current=r||"",null===(e=d.current)||void 0===e||e.setHTML((0,Q.md2html)(r||""))}},[r]),(0,p.useEffect)(()=>()=>{m.cancel()},[m]),(0,i.jsx)(p.Suspense,{fallback:null,children:(0,i.jsx)(Q.LazyEditorFullInputInner,(0,a._)({field:"full-input",className:f()(X.Z["full-input"],t),businessKey:u.current,noToolbar:n,noExpand:!o,getEditor:e=>{d.current=e},disabled:n,onChange:m,registerToolItem:e=>e.filter(e=>(null==e?void 0:e.type)!==Q.ToolbarItemEnum.Image).map(e=>((null==e?void 0:e.type)&&e.extraPropsToBuiltinComp&&(e.extraPropsToBuiltinComp=(0,A._)((0,a._)({},e.extraPropsToBuiltinComp),{size:"extra-small"})),e))},s))})},ee=(0,l.connect)(e=>{var{expand:t,modalTitle:n}=e,o=(0,z._)(e,["expand","modalTitle"]),[r,l]=(0,p.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.u_,{visible:r,centered:!0,title:n,onCancel:()=>l(!1),children:(0,i.jsx)(K,(0,a._)({expand:!1,className:X.Z["modal-full-input"]},o))}),(0,i.jsx)(K,(0,a._)({expand:t,onExpand:()=>l(!0)},o))]})},(0,l.mapProps)({validateStatus:!0})),et=n("949926"),en=n("915757"),eo=n("7121"),er=(0,l.connect)(e=>{var{required:t,label:n,feedbackText:o,description:r,tooltip:a,tag:l,action:d,children:u}=e;return(0,i.jsxs)("div",{className:eo.Z["form-item"],children:[(0,i.jsxs)("div",{className:eo.Z["form-item-label"],children:[(0,i.jsxs)("div",{className:eo.Z["form-item-label-top"],children:[(0,i.jsxs)("div",{className:eo.Z["top-left"],children:[(0,i.jsx)("span",{className:eo.Z["form-item-label-text"],children:n}),t?(0,i.jsx)("span",{className:eo.Z["form-item-label-asterisk"],children:"*"}):null,a?(0,i.jsx)(s.u,{content:a,children:(0,i.jsx)(en.L03,{className:eo.Z["label-tooltip"]})}):null,l?(0,i.jsx)(s.Vp,{className:eo.Z.tag,size:"mini",color:"primary",children:l}):null]}),d]}),r?(0,i.jsx)(s.ZT.Text,{size:"small",type:"secondary",ellipsis:{showTooltip:!0},children:r}):null]}),(0,i.jsx)("div",{children:u}),o?(0,i.jsx)("div",{className:eo.Z["form-item-feedback-wrap"],children:(0,i.jsx)(s.ZT.Text,{size:"small",className:eo.Z["form-item-feedback-text"],children:o})}):null]})},(0,l.mapProps)({title:"label",required:!0,tag:!0,description:!0},(e,t)=>{var n;return(0,A._)((0,a._)({},e),{feedbackText:(0,et.isDataField)(t)&&(null===(n=t.selfErrors)||void 0===n?void 0:n.length)?t.selfErrors:void 0})})),ea=n("315159"),ei=e=>{var{title:t,tooltip:n,action:o,collapsible:r,children:a}=e,[l,d]=(0,p.useState)(!0);return(0,i.jsxs)("div",{className:ea.Z["form-section"],children:[(0,i.jsxs)("div",{className:ea.Z["section-header"],children:[(0,i.jsxs)("div",{className:ea.Z["section-title"],onClick:r?()=>{d(!l)}:void 0,children:[r?(0,i.jsx)(en.C_O,{className:f()(ea.Z["title-collapsible"],{[ea.Z["is-close"]]:!l})}):null,(0,i.jsx)(s.ZT.Text,{strong:!0,children:t}),n?(0,i.jsx)(s.u,{content:n,children:(0,i.jsx)(en.L03,{className:ea.Z["title-tooltip"]})}):null]}),o?(0,i.jsx)("div",{className:ea.Z["section-action"],onClick:e=>{e.stopPropagation()},children:o}):null]}),(0,i.jsx)(s.zF,{keepDOM:!0,fade:!0,isOpen:l,children:(0,i.jsx)("div",{className:ea.Z["section-context"],children:a})})]})},el=n("633259"),es=e=>{var{className:t,value:n,onChange:o}=e,r=(0,z._)(e,["className","value","onChange"]);return(0,i.jsx)(s.Mt,(0,a._)({className:f()(el.Z["input-time"],t),type:"dateTime",size:"small",showClear:!1,showSuffix:!1,value:n,onChange:(e,t)=>{("string"==typeof t||void 0===t)&&(null==o||o(t))}},r))}},153677:function(e,t,n){n(151064),n(455069),n(252237),n(227997),n(360632)},162096:function(e,t,n){n.d(t,{PY:()=>j,oR:()=>$.U,qS:()=>H,aA:()=>eN.aA,Nc:()=>J.N,CO:()=>eN.CO,fv:()=>w,ux:()=>s,ee:()=>g,ao:()=>p,dv:()=>Y.d,UI:()=>eb,w_:()=>eN.w_,O6:()=>ek});var o=n("151064"),r=n("455069"),a=n("252237"),i=n.n(a);n("845803");var l=n("779940"),s=e=>{var{className:t,children:n}=e;return(0,o.jsx)("div",{className:i()(l.Z["form-panel-layout"],t),children:n})},d=n("808549"),u=n("915757"),c=n("674343"),p=e=>(0,o.jsx)(c.zx,(0,d._)({color:"green",icon:(0,o.jsx)(u.NvC,{})},e)),v=n("336205"),m=n("550655"),f=n("241785"),g=(0,r.forwardRef)((e,t)=>{var{className:n,hideClose:a,header:l,footer:s,onClose:d,onCloseWithoutAnimation:p,children:v,animation:g,translateYHeight:h="calc(100% - 52px)",innerScrollRef:_,draggable:y=!0,headerExtra:x}=e,[w,b]=(0,r.useState)(0),[j,k]=(0,r.useState)(null),N=(0,r.useRef)(null),S=(0,r.useRef)(null),C=_||S,I=(0,r.useRef)(!1),T=(0,r.useRef)(0),P=(0,r.useRef)(0),[D,E]=(0,r.useState)(!0),O=(0,r.useCallback)(e=>{if(I.current){var t=P.current-(e.clientY-T.current);b(t>156?t:156)}},[b]),L=(0,r.useCallback)(()=>{I.current=!1,document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",L)},[O]),M=(0,r.useCallback)(e=>{var t;I.current=!0,T.current=e.clientY,P.current=(null===(t=N.current)||void 0===t?void 0:t.offsetHeight)||0,document.addEventListener("mousemove",O),document.addEventListener("mouseup",L)},[O,L]),F=()=>{E(!0),null==p||p(),g?k(!1):b(0),setTimeout(()=>{d()},250)};(0,r.useImperativeHandle)(t,()=>({minimize:()=>{E(!0),b(156),setTimeout(()=>E(!1),250)},maximize:()=>{E(!0),b(null),setTimeout(()=>E(!1),250)},close:()=>{F()},scrollTo:e=>{var t;return null===(t=C.current)||void 0===t?void 0:t.scrollTo(e)}})),(0,r.useEffect)(()=>{k(!0),setTimeout(()=>{b(null),setTimeout(()=>{E(!1)},250)},100)},[]);var Z=(0,r.useMemo)(()=>"slide"===g?{height:"100%"}:"translateY"===g?{height:(0,m.Z)(w)?"".concat(w,"px"):h,maxHeight:h}:{height:(0,m.Z)(w)?"".concat(w,"px"):"90%"},[w,g,h]);return(0,o.jsxs)("div",{ref:N,style:Z,className:i()(f.Z.container,{[f.Z["resizable-panel"]]:!g,[f.Z["need-transition"]]:!g&&D,[f.Z["resizable-panel-translateY"]]:"translateY"===g,[f.Z.show]:"translateY"===g&&j,[f.Z.hide]:"translateY"===g&&!j,[f.Z["resizable-panel-slide"]]:"slide"===g,[f.Z["slide-in"]]:"slide"===g&&j,[f.Z["slide-out"]]:"slide"===g&&!j},n),children:[y?(0,o.jsx)("div",{onMouseDown:M,className:f.Z["panel-dragging"]}):null,l?(0,o.jsxs)("div",{className:f.Z["panel-header"],children:[l,a?null:(0,o.jsx)(c.hU,{icon:(0,o.jsx)(u.rmE,{className:"text-[18px]"}),color:"secondary",onClick:F})]}):null,x||null,(0,o.jsx)("div",{ref:C,className:f.Z["panel-content"],children:v}),s?(0,o.jsx)("div",{className:f.Z["panel-footer"],children:s}):null]})}),h=n("64605"),_=n("537845"),y=e=>{var[t,n]=(0,r.useState)(!1),[o,a]=(0,r.useState)(e.default),i=(0,r.useRef)(null),l=(0,r.useRef)(!1),s=(0,r.useRef)(0),d=(0,r.useRef)(0),u=(0,_.Z)(t=>{if(l.current){var n=d.current-(t.clientY-s.current);e.max&&n>e.max?a(e.max):e.min&&n<e.min?a(e.min):a(n)}}),c=(0,r.useCallback)(()=>{l.current=!1,n(!1),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c)},[u]);return{height:o,bind:(0,_.Z)(e=>{var t;l.current=!0,n(!0),s.current=e.clientY,d.current=(null===(t=i.current)||void 0===t?void 0:t.offsetHeight)||0,document.addEventListener("mousemove",u),document.addEventListener("mouseup",c)}),ref:i,dragging:t}},x=n("713818"),w=e=>{var{className:t,header:n,footer:r,height:a,resizable:l,onClose:s,children:p}=e,{height:v,bind:m,ref:f,dragging:g}=y((0,d._)({default:a},(0,h.Z)(l)?l:{}));return(0,o.jsxs)("div",{className:i()(x.Z["base-panel"],t,g&&x.Z.dragging),style:{height:v},ref:f,children:[l?(0,o.jsx)("div",{className:x.Z["resize-bar"],onMouseDown:m}):null,n?(0,o.jsxs)("div",{className:x.Z["panel-header"],children:[n,(0,o.jsx)(c.hU,{icon:(0,o.jsx)(u.rmE,{className:"text-[18px]"}),color:"secondary",onClick:s})]}):null,(0,o.jsx)("div",{className:x.Z["panel-content"],children:p}),r?(0,o.jsx)("div",{className:x.Z["panel-footer"],children:r}):null]})},b=n("840055"),j=e=>{var{event:t}=e;return t?(0,o.jsxs)("div",{className:b.Z["node-event-info"],children:[(0,o.jsx)(c.qE,{src:t.node_icon,shape:"square",size:"extra-extra-small"}),(0,o.jsx)(c.ZT.Text,{children:t.node_title})]}):null},k=n("282975"),N=n("559170");function S(e){return!!(null==e?void 0:e.errorInfo)&&(null==e?void 0:e.errorLevel)==="Error"}function C(e){return!!(null==e?void 0:e.errorInfo)&&(null==e?void 0:e.errorLevel)!=="Error"}var I=e=>{var{children:t}=e;return(0,o.jsx)(c.u,{content:v.o.t("workflow_detail_testrun_panel_batch_naviagte_empty"),children:(0,o.jsx)("div",{className:i()(N.Z["page-item"],N.Z["page-item-empty"]),children:t})})},T=e=>{var{data:t,idx:n,paging:a,onChange:l}=e,s=(0,r.useMemo)(()=>S(t),[t]),d=(0,r.useMemo)(()=>C(t),[t]),c=(0,r.useMemo)(()=>{var e=null==t?void 0:t.index;return(0,m.Z)(e)?e:n},[t,n]),p=(0,r.useMemo)(()=>c+1,[c]),v=(0,r.useCallback)(()=>{l(c)},[c,l]);return t?(0,o.jsxs)("div",{className:i()(N.Z["page-item"],{[N.Z.error]:s,[N.Z.warning]:d,[N.Z.active]:c===a}),onClick:v,children:[p,s||d?(0,o.jsx)(u.wR2,{className:N.Z.icon}):null]},p):(0,o.jsx)(I,{children:p},p)},P=n("346707"),D=n("853273"),E=e=>{var{placeholder:t,paging:n,fixedCount:a,data:l,onChange:s}=e,[d,p]=(0,r.useState)(!1),v=(0,r.useRef)(null),m=(0,r.useRef)(null),f=(0,r.useMemo)(()=>l.find(e=>(null==e?void 0:e.index)===n),[n,l]),g=(0,r.useMemo)(()=>S(f),[f]),h=(0,r.useMemo)(()=>C(f),[f]),_=(0,r.useCallback)(e=>{s(e),p(!1)},[s,p]);return(0,r.useEffect)(()=>{var e=e=>{var t,n;if(null===(t=m.current)||void 0===t?!void 0:!t.contains(e.target))!(null===(n=v.current)||void 0===n?void 0:n.contains(e.target))&&p(!1)};return window.addEventListener("click",e),()=>window.removeEventListener("click",e)},[]),(0,o.jsx)(c.J2,{keepDOM:!0,trigger:"custom",position:"bottomRight",visible:d,content:(0,o.jsx)("div",{className:D.Z["more-selector-content"],ref:v,children:l.map((e,t)=>(0,o.jsx)(T,{data:e,idx:t+a,paging:n,onChange:_}))}),getPopupContainer:()=>(null==m?void 0:m.current)||document.body,children:(0,o.jsxs)("div",{ref:m,className:i()({[D.Z["ui-selector"]]:!0,[D.Z["has-value"]]:!(0,P.Z)(f)||d,[D.Z["has-error"]]:g,[D.Z["has-warning"]]:h}),onClick:()=>p(e=>!e),children:[t&&(0,P.Z)(f)?(0,o.jsx)("div",{className:D.Z["ui-selector-placeholder"],children:t}):null,!(0,P.Z)(f)&&(0,o.jsx)("div",{className:D.Z["ui-selector-content"],children:(0,o.jsx)(c.ZT.Text,{children:n+1})}),(0,o.jsx)("div",{className:i()({[D.Z["ui-selector-icon"]]:!0,[D.Z.selected]:d}),children:(0,o.jsx)(u.C_O,{})}),g||h?(0,o.jsx)("div",{className:i()({[D.Z["ui-selector-error-icon"]]:g,[D.Z["ui-selector-warning-icon"]]:h}),children:(0,o.jsx)(u.wR2,{})}):null]})})},O=n("768691"),L=e=>{var{paging:t,fixedCount:n=10,data:a,onChange:i}=e,l=(0,r.useMemo)(()=>a.slice(0,n),[n,a]),s=(0,r.useMemo)(()=>a.slice(n),[a]),d=(0,r.useMemo)(()=>a.length>n,[a,n]);return(0,o.jsxs)("div",{style:{display:"flex"},className:O.Z["page-selector"],children:[l.map((e,n)=>(0,o.jsx)(T,{data:e,idx:n,paging:t,onChange:i})),d?(0,o.jsx)(E,{paging:t,fixedCount:n,data:s,placeholder:v.o.t("drill_down_placeholer_select"),onChange:e=>{i(e)}}):null]})},M=n("987499"),F=e=>{var{paging:t,data:n,onlyShowError:a,disabled:i,fixedCount:l,onChange:s,onShowErrorChange:d}=e,u=(0,r.useMemo)(()=>a?n.filter(e=>!!(null==e?void 0:e.errorInfo)):n,[n,a]),p=(0,r.useMemo)(()=>a?"".concat(v.o.t("workflow_batch_error_items"),": ").concat(u.length,"/").concat(n.length):"".concat(v.o.t("workflow_batch_total_items"),": ").concat(n.length),[n,u,a]);return(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:M.Z["pagination-header"],children:[(0,o.jsx)(c.ZT.Text,{className:"font-semibold",children:p}),(0,o.jsx)(c.XZ,{checked:a,disabled:i,onChange:e=>{d(!!e.target.checked)},"aria-label":v.o.t("workflow_batch_error_only"),children:v.o.t("workflow_batch_error_only")})]}),(0,o.jsx)(L,{data:u,paging:t,onChange:s,fixedCount:l})]})},Z=e=>{var{log:t,node:n,nodeStatus:r,onPreview:a,onOpenWorkflowLink:i}=e;return(0,k.ow)(t)?(0,o.jsx)(k.xP,{log:t}):(0,k.$B)(t)?(0,o.jsx)(k.Aj,{log:t}):(0,k.Ss)(t)?(0,o.jsx)(k.W_,{log:t,node:n,nodeStatus:r,onPreview:a}):(0,k.kv)(t)?(0,o.jsx)(k.ux,{log:t,onOpenWorkflowLink:i}):(0,o.jsx)(k.kk,{log:t})},R=n("58197"),V=n("76681"),A=()=>(0,o.jsxs)("div",{className:V.Z["log-filed-empty"],children:[(0,o.jsx)(R.Yf,{width:"120",height:"120"}),(0,o.jsx)("p",{children:v.o.t("workflow_batch_no_failed_entries")})]}),z=e=>{var{data:t,node:n,onPreview:a,onOpenWorkflowLink:i}=e,{nodeStatus:l}=t||{},{logs:s}=(0,r.useMemo)(()=>(0,k.rG)(t,n),[t,n]);return t?(0,o.jsx)(o.Fragment,{children:s.map((e,t)=>(0,o.jsx)(Z,{log:e,node:n,nodeStatus:l,onPreview:a,onOpenWorkflowLink:i},t))}):(0,o.jsx)(A,{})},B=n("120454"),U=n("672496"),q=n("408487"),W=n("204558"),G=n("960631"),H=e=>{var{result:t,node:n,paginationFixedCount:a,LogImages:i,spaceId:l,workflowId:s,onOpenWorkflowLink:u}=e,{isBatch:c,nodeId:p}=t,[v,m]=(0,r.useState)(0),[f,g]=(0,r.useState)(!1),{current:h,batchData:_}=function(e){var{result:t,paging:n,spaceId:o,workflowId:a}=e,{batch:i,isBatch:l}=t||{},s=(0,r.useMemo)(()=>{if(!l)return[];var e=(0,W.f5)(i);return(Array.isArray(e)?e:[]).map(e=>e?(0,B._)((0,d._)({},e),{isBatch:!0}):e)},[l,i]),u=(0,r.useMemo)(()=>l?s.find(e=>(null==e?void 0:e.index)===n):t,[n,l,s,t]),c=()=>!!u&&!!u.needAsync||!1,{data:p}=(0,U.a)({retry:1,queryKey:["WorkflowApiGetNodeExecuteHistory",a,o,null==u?void 0:u.executeId,null==u?void 0:u.nodeId,null==u?void 0:u.NodeType,l,n],queryFn:()=>q.OHc.GetNodeExecuteHistory({workflow_id:a,space_id:o,execute_id:(null==u?void 0:u.executeId)||"",node_id:(null==u?void 0:u.nodeId)||"",node_type:(null==u?void 0:u.NodeType)||"",is_batch:l,batch_index:l?n:void 0}).then(e=>e.data).catch(()=>u),enabled:c()});return{current:c()?p:u,batchData:s}}({result:t,paging:v,spaceId:l,workflowId:s}),y=(0,r.useMemo)(()=>c&&f?(null==h?void 0:h.errorInfo)?h:void 0:h,[c,f,h]),{modal:x,open:w}=(0,k.f)();return(0,r.useLayoutEffect)(()=>{m(0)},[_]),(0,o.jsxs)("div",{className:G.Z["log-detail"],children:[c?(0,o.jsx)(F,{paging:v,data:_,fixedCount:a,onlyShowError:f,onChange:m,onShowErrorChange:g}):null,y?(0,o.jsx)(i,{testRunResult:y,nodeId:p}):null,(0,o.jsx)(z,{data:y,node:n,onPreview:w,onOpenWorkflowLink:u}),x]})},$=n("641380"),J=n("795705"),Y=n("569780"),Q=n("825955"),X=n("335740"),K=n("155440"),ee=n("382534");n("290735");var et=n("423043"),en=n("735114"),eo=e=>{var{bizCtx:t,bizComponentSubject:n}=(0,Y.d)(e=>({bizCtx:e.bizCtx,bizComponentSubject:e.bizComponentSubject})),{data:o,loading:r}=(0,en.Z)((0,Q._)(function*(){var o,r=(0,W.f5)(null==e?void 0:null===(o=e.caseBase)||void 0===o?void 0:o.input)||[],a=yield ee.xd.GetSchemaByID({bizComponentSubject:n,bizCtx:t}),i=(0,W.f5)(a.schemaJson)||[];if(r.length){var l={};(0,W.zr)(r,(e,t)=>l[(0,W.$j)(e,t)]=t),(0,W.zr)(i,(e,t)=>{var n=l[(0,W.$j)(e,t)];(0,W.bN)(t.type,null==n?void 0:n.type)&&!(0,K.Z)(null==n?void 0:n.value)&&(t.value=null==n?void 0:n.value)})}else(0,W.zr)(i,(e,t)=>{(0,W.Kr)(t)});return i}),{refreshDeps:[e]});return{schemas:o,schemasLoading:r}},er=n("586964"),ea=(0,c.Q2)(function(e){var t,n,r;return(0,o.jsx)(c.II,(0,B._)((0,d._)({},e),{maxLength:null!==(t=e.maxLength)&&void 0!==t?t:50,autoComplete:"off",onBlur:t=>{var n,o,r;null===(n=e.onChange)||void 0===n||n.call(e,"".concat(null!==(r=e.value)&&void 0!==r?r:"").trim(),{}),null===(o=e.onBlur)||void 0===o||o.call(e,t)},suffix:(0,o.jsxs)("div",{className:er.Z.suffix,children:[(r=e.value)?"".concat(r).length:0,"/",null!==(n=e.maxLength)&&void 0!==n?n:50]})}))},{}),ei=n("28260"),el=n("824833"),es=n("846368"),ed="".concat(et.o8,"_").concat(el.re.CozeVariableBot),eu=e=>{var{schema:t}=e,n=(0,r.useMemo)(()=>{switch(t.component_type){case el.re.CozeStartNode:return v.o.t("workflow_testset_start_node");case el.re.CozeVariableBot:return v.o.t("workflow_testset_vardatabase_node");case el.re.CozeVariableChat:return v.o.t("wf_chatflow_72");default:return t.component_name}},[t]);return(0,o.jsxs)("div",{className:es.Z["form-section-title"],children:[t.component_icon?(0,o.jsx)(c.qE,{src:t.component_icon,shape:"square",size:"extra-small"}):null,n]})},ec=e=>{var{schema:t}=e,n=(0,r.useMemo)(()=>t.type===et.QD.BOT?v.o.t("workflow_testset_vardatabase_tip"):t.type===et.QD.CHAT?v.o.t("wf_chatflow_74"):t.name,[t]),a=(0,r.useMemo)(()=>{switch(t.type){case et.QD.STRING:case et.QD.FLOAT:case et.QD.NUMBER:case et.QD.OBJECT:case et.QD.BOOLEAN:case et.QD.INTEGER:case et.QD.TIME:return(0,W.zp)(t.type);case et.QD.LIST:var e=t.schema.type;return e?"Array<".concat((0,W.zp)(e),">"):"Array";case et.QD.BOT:case et.QD.CHAT:return"";default:return t.type}},[t]);return(0,o.jsxs)("div",{className:es.Z["form-item-label"],children:[(0,o.jsx)("div",{className:i()(es.Z["label-text"],{[es.Z.required]:t.required}),children:n}),a?(0,o.jsx)("div",{className:es.Z["label-type"],children:a}):null]})},ep=e=>{var{schema:t,formSchema:n,disabled:r,projectId:a}=e,{type:i,name:l,required:s}=t,{formRenders:u}=(0,Y.d)(e=>({formRenders:e.formRenders})),p=null==u?void 0:u[i],m=(0,W.$j)(n,t),f=(0,W.JM)(t),g=v.o.t("workflow_testset_required_tip",{param_name:t.type===et.QD.BOT||t.type===et.QD.CHAT?"":l});if(void 0!==p)return(0,o.jsx)(p,(0,d._)({field:m,disabled:r,rules:[{required:s,message:g}],noLabel:!0,placeholder:f},(0,W.Q)(t,a)));switch(i){case et.QD.BOOLEAN:return(0,o.jsx)(c.ih,{className:es.Z["form-item-select"],field:m,disabled:r,rules:[{required:s,message:g}],optionList:et.Ck,noLabel:!0,placeholder:f,showClear:!s});case et.QD.INTEGER:case et.QD.FLOAT:case et.QD.NUMBER:return(0,o.jsx)(c.l0.InputNumber,{field:m,trigger:["change","blur"],precision:i===et.QD.INTEGER?.1:void 0,rules:[{required:s,message:g}],disabled:r,noLabel:!0,style:{width:"100%"},placeholder:f});case et.QD.OBJECT:case et.QD.LIST:return(0,o.jsx)(c.ld,{field:m,trigger:["change","blur"],rules:[{required:s,message:g}],disabled:r,noLabel:!0,placeholder:f});case et.QD.TIME:return(0,o.jsx)(c.l0.DatePicker,{type:"dateTime",field:m});case et.QD.STRING:default:return(0,o.jsx)(c.ld,{field:m,autosize:{minRows:2,maxRows:5},trigger:["change","blur"],rules:[{required:s,message:g}],disabled:r,noLabel:!0,placeholder:f})}},ev=e=>{var t,n,{schema:a,disabled:i}=e,{projectId:l}=(0,Y.d)(e=>({projectId:e.projectId})),s=(0,c.tL)(ed),d=(null==s?void 0:null===(t=s.value)||void 0===t?void 0:t.id)&&(null==s?void 0:null===(n=s.value)||void 0===n?void 0:n.type)===ei.jH.Project||l;return(0,o.jsx)(c.l0.Section,{text:(0,o.jsx)(eu,{schema:a}),className:es.Z["edit-form-section"],children:a.inputs.filter(e=>(!l||e.type!==et.QD.BOT)&&(!!d||e.type!==et.QD.CHAT)&&!0).map((e,t)=>(0,o.jsxs)(r.Fragment,{children:[(0,o.jsx)(ec,{schema:e}),(0,o.jsx)(ep,{schema:e,formSchema:a,disabled:i,projectId:null==s?void 0:s.value})]},t))})},em=n("601351"),ef="__TESTSET_NAME__",eg="__TESTSET_DESC__",eh=e=>{var t,n,a,{data:i}=e,{bizComponentSubject:l,bizCtx:s,editMode:d,generating:p,closeEditPanel:m,updateEditPanelCloseState:f}=(0,Y.d)(e=>({bizCtx:e.bizCtx,bizComponentSubject:e.bizComponentSubject,editMode:e.editMode,closeEditPanel:e.closeEditPanel,generating:e.generating,updateEditPanelCloseState:e.updateEditPanelCloseState})),{schemas:h,schemasLoading:_}=eo(i),[y,x]=(0,r.useState)(!1),[w,b]=(0,r.useState)(!1),j=(0,r.useRef)(),k=(0,r.useRef)(null),N=(0,r.useMemo)(()=>(0,o.jsxs)("span",{className:"flex items-center",children:[(0,o.jsx)(u.$1i,{className:"mr-[7px] cursor-pointer",onClick:()=>{var e,t;return null===(t=k.current)||void 0===t?void 0:null===(e=t.close)||void 0===e?void 0:e.call(t)}}),(0,o.jsx)("span",{className:"font-medium",children:"edit"===d?v.o.t("workflow_testset_edit_title"):v.o.t("workflow_testset_create_title")})]}),[d]),S=(0,r.useCallback)(()=>{m()},[m]),C=(0,r.useCallback)(()=>{f(!1)},[f]);var I=(t=(0,Q._)(function*(){x(!0);try{yield null===(e=j.current)||void 0===e?void 0:e.validate();var e,t,n=null===(t=j.current)||void 0===t?void 0:t.getFormState().errors;if(Object.keys(null!=n?n:{}).length)return;T()}finally{x(!1)}}),function(){return t.apply(this,arguments)});var T=(n=(0,Q._)(function*(){b(!0);try{var e,t,n=null===(e=j.current)||void 0===e?void 0:e.getValues();if(!n)return;var o=(0,X.Z)(null!=h?h:[]);(0,W.zr)(o,(e,t)=>{var o=n[(0,W.$j)(e,t)];!(0,K.Z)(o)&&(t.value=o),!o&&(t.type===et.QD.LIST||t.type===et.QD.OBJECT)&&(t.value=void 0),t.type===et.QD.BOOLEAN&&(t.value=(0,W.UC)(t.value))});var r={name:n[ef],caseID:null==i?void 0:null===(t=i.caseBase)||void 0===t?void 0:t.caseID,description:n[eg],input:JSON.stringify(o)};yield ee.xd.SaveCaseData({bizComponentSubject:l,bizCtx:s,caseBase:r}),c.FN.success(v.o.t("Save_success")),S()}finally{b(!1)}}),function(){return n.apply(this,arguments)});return(0,r.useCallback)(e=>{var t,n,o,r=(null===(t=j.current)||void 0===t?void 0:t.getValues())||{},a=[];(0,W.zr)(e,(e,t)=>{var n,o=(0,W.$j)(e,t),i=null===(n=(0,W.Rf)(t))||void 0===n?void 0:n.value;!(0,K.Z)(i)&&(r[o]=i,a.push(o))}),null===(n=j.current)||void 0===n||n.setValues(r),null===(o=j.current)||void 0===o||o.validate(a)},[j]),(0,r.useEffect)(()=>{var e,t,n,o;null===(n=j.current)||void 0===n||n.setValues({[ef]:null!==(o=null==i?void 0:null===(e=i.caseBase)||void 0===e?void 0:e.name)&&void 0!==o?o:"",[eg]:null==i?void 0:null===(t=i.caseBase)||void 0===t?void 0:t.description})},[i]),(0,r.useEffect)(()=>{if(void 0!==h){var e,t,n,o=null!==(n=null===(e=j.current)||void 0===e?void 0:e.getValues())&&void 0!==n?n:{};(0,W.zr)(h,(e,t)=>{var n;return o[(0,W.$j)(e,t)]=null===(n=(0,W.Rf)(t))||void 0===n?void 0:n.value}),null===(t=j.current)||void 0===t||t.setValues(o)}},[h]),(0,o.jsx)(g,{className:em.Z["edit-form-resizeable-panel"],draggable:!1,animation:"slide",ref:k,header:N,onClose:S,onCloseWithoutAnimation:C,footer:(0,o.jsx)(c.u,{content:v.o.t("workflow_testset_submit_tooltip_for_expert_mode"),children:(0,o.jsx)(c.zx,{color:"hgltplus",style:{width:"100%"},disabled:p,loading:y||w,onClick:I,children:v.o.t("workflow_testset_edit_confirm")})}),children:(0,o.jsx)("div",{className:em.Z["edit-form"],children:(0,o.jsxs)(c.l0,{showValidateIcon:!1,getFormApi:e=>j.current=e,children:[(0,o.jsx)(ea,{field:ef,trigger:"blur",stopValidateWithError:!0,label:v.o.t("workflow_testset_name"),placeholder:v.o.t("workflow_testset_name_placeholder"),rules:(0,W.w1)({bizCtx:s,bizComponentSubject:l,originVal:null==i?void 0:null===(a=i.caseBase)||void 0===a?void 0:a.name,isOversea:!1})}),(0,o.jsx)("div",{className:em.Z["edit-form-desc-input"]}),(0,o.jsx)(c.ld,{field:eg,label:v.o.t("workflow_testset_desc"),placeholder:v.o.t("workflow_testset_desc_placeholder"),autosize:!0,maxCount:200,maxLength:200,rows:2}),(0,o.jsxs)("div",{className:em.Z["edit-form-title"],children:[(0,o.jsx)("span",{className:em.Z["title-text"],children:v.o.t("workflow_testset_node_data")}),null]}),_?(0,o.jsx)(c.yC,{}):null,!_&&(null==h?void 0:h.length)?h.map(e=>(0,o.jsx)(ev,{schema:e,disabled:p},e.component_id)):null]})})})},e_=n("380054"),ey="__TESTSET_NAME__",ex="__TESTSET_DESC__",ew=e=>{var t,n,a,{data:i,onParentClose:l}=e,{bizComponentSubject:s,bizCtx:d,editMode:p,generating:m,closeEditPanel:f}=(0,Y.d)(e=>({bizCtx:e.bizCtx,bizComponentSubject:e.bizComponentSubject,editMode:e.editMode,closeEditPanel:e.closeEditPanel,generating:e.generating})),{schemas:g,schemasLoading:h}=eo(i),[_,y]=(0,r.useState)(!1),[x,w]=(0,r.useState)(!1),b=(0,r.useRef)(),j=(0,r.useMemo)(()=>"edit"===p?v.o.t("workflow_testset_edit_title"):v.o.t("workflow_testset_create_title"),[p]),k=(0,r.useCallback)(()=>{f()},[f]);var N=(t=(0,Q._)(function*(){y(!0);try{yield null===(e=b.current)||void 0===e?void 0:e.validate();var e,t,n=null===(t=b.current)||void 0===t?void 0:t.getFormState().errors;if(Object.keys(null!=n?n:{}).length)return;S()}finally{y(!1)}}),function(){return t.apply(this,arguments)});var S=(n=(0,Q._)(function*(){w(!0);try{var e,t,n=null===(e=b.current)||void 0===e?void 0:e.getValues();if(!n)return;var o=(0,X.Z)(null!=g?g:[]);(0,W.zr)(o,(e,t)=>{var o=n[(0,W.$j)(e,t)];!(0,K.Z)(o)&&(t.value=o),!o&&(t.type===et.QD.LIST||t.type===et.QD.OBJECT)&&(t.value=void 0),t.type===et.QD.BOOLEAN&&(t.value=(0,W.UC)(t.value))});var r={name:n[ey],caseID:null==i?void 0:null===(t=i.caseBase)||void 0===t?void 0:t.caseID,description:n[ex],input:JSON.stringify(o)};yield ee.xd.SaveCaseData({bizComponentSubject:s,bizCtx:d,caseBase:r}),c.FN.success(v.o.t("Save_success")),k()}finally{w(!1)}}),function(){return n.apply(this,arguments)});return(0,r.useEffect)(()=>{var e,t,n,o;null===(n=b.current)||void 0===n||n.setValues({[ey]:null!==(o=null==i?void 0:null===(e=i.caseBase)||void 0===e?void 0:e.name)&&void 0!==o?o:"",[ex]:null==i?void 0:null===(t=i.caseBase)||void 0===t?void 0:t.description})},[i]),(0,r.useEffect)(()=>{if(void 0!==g){var e,t,n,o=null!==(n=null===(e=b.current)||void 0===e?void 0:e.getValues())&&void 0!==n?n:{};(0,W.zr)(g,(e,t)=>{var n;return o[(0,W.$j)(e,t)]=null===(n=(0,W.Rf)(t))||void 0===n?void 0:n.value}),null===(t=b.current)||void 0===t||t.setValues(o)}},[g]),(0,o.jsxs)("div",{className:e_.Z["edit-form"],children:[(0,o.jsxs)("div",{className:e_.Z["panel-header"],children:[(0,o.jsxs)("div",{className:e_.Z["header-title"],children:[(0,o.jsx)(c.hU,{icon:(0,o.jsx)(u.$1i,{}),color:"secondary",onClick:k}),(0,o.jsx)(c.ZT.Text,{strong:!0,fontSize:"16px",children:j})]}),(0,o.jsx)(c.hU,{icon:(0,o.jsx)(u.rmE,{}),color:"secondary",onClick:l})]}),(0,o.jsx)("div",{className:e_.Z["panel-content"],children:(0,o.jsxs)(c.l0,{showValidateIcon:!1,getFormApi:e=>b.current=e,children:[(0,o.jsx)(ea,{field:ey,trigger:"blur",stopValidateWithError:!0,label:v.o.t("workflow_testset_name"),placeholder:v.o.t("workflow_testset_name_placeholder"),rules:(0,W.w1)({bizCtx:d,bizComponentSubject:s,originVal:null==i?void 0:null===(a=i.caseBase)||void 0===a?void 0:a.name,isOversea:!1})}),(0,o.jsx)("div",{className:e_.Z["edit-form-desc-input"]}),(0,o.jsx)(c.ld,{field:ex,label:v.o.t("workflow_testset_desc"),placeholder:v.o.t("workflow_testset_desc_placeholder"),autosize:!0,maxCount:200,maxLength:200,rows:2}),(0,o.jsx)("div",{className:e_.Z["edit-form-title"],children:(0,o.jsx)("span",{className:e_.Z["title-text"],children:v.o.t("workflow_testset_node_data")})}),h?(0,o.jsx)(c.yC,{}):null,!h&&(null==g?void 0:g.length)?g.map(e=>(0,o.jsx)(ev,{schema:e,disabled:m},e.component_id)):null]})}),(0,o.jsx)("div",{className:e_.Z["panel-footer"],children:(0,o.jsx)(c.u,{content:v.o.t("workflow_testset_submit_tooltip_for_expert_mode"),children:(0,o.jsx)(c.zx,{color:"hgltplus",style:{width:"100%"},disabled:m,loading:_||x,onClick:N,children:v.o.t("workflow_testset_edit_confirm")})})})]})},eb=e=>{var{isChatFlow:t,onParentClose:n}=e,{editPanelVisible:r,editData:a}=(0,Y.d)(e=>({editPanelVisible:e.editPanelVisible,editData:e.editData}));return r?t?(0,o.jsx)(ew,{data:a,onParentClose:n}):(0,o.jsx)(eh,{data:a}):null},ej=n("915219"),ek=()=>(0,o.jsx)("div",{className:ej.Z["input-form-empty"],children:(0,o.jsx)(c.ZT.Text,{className:"text-[12px] coz-fg-dim",children:v.o.t("workflow_testrun_input_form_empty")})}),eN=n("815288")}}]);
//# sourceMappingURL=5752.36406c39.js.map