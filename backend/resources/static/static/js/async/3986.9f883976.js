/*
 * Copyright 2025 coze-dev Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";(self.webpackChunk_coze_studio_app=self.webpackChunk_coze_studio_app||[]).push([["3986"],{649213:function(e,t,n){n.d(t,{u:function(){return j}});var o=n(825955),r=n(151064),l=n(157728),a=n(455069),i=n(156133),s=n(724847),d=n(408487),u=n(336205),c=n(727914),v=n(117140),p=n(178385),f=n(382534),m=n(674343),h=n(242505),g=n(398420),x=n(518175),_=n(104313),y=["788664021","788664024"],{Text:w}=m.ZT;function j(e){var t,n,j,b,{data:N,workFlowList:k,copyProductHandle:C,onWorkFlowListChange:S,onAdd:I,onRemove:T,onItemClick:E,onDupSuccess:D,onDelete:Z,handleDeleteWorkflow:M,isProfessionalTemplate:P}=e,L=(0,a.useContext)(h.Z),{bot_id:z}=(0,l.useParams)(),O=(0,l.useNavigate)(),A=(0,s.WC)(e=>(0,s.nz)(null==e?void 0:e.rightsInfo));(0,a.useEffect)(()=>{s.WC.getState().getRights()},[]);function F(){return(F=(0,o._)(function*(e){return(0,g.D)(null==L?void 0:L.modalState)?function(e){return R.apply(this,arguments)}(e):V(e)})).apply(this,arguments)}function R(){return(R=(0,o._)(function*(e){if(!e.spaceId||!e.workflowId)throw new c.sH("normal_error","getProjectWorkflow: empty id");var t,n=null!==(t=(yield d.OHc.GetWorkflowDetail({space_id:e.spaceId,workflow_ids:[e.workflowId]},{__disableErrorToast:!0})).data)&&void 0!==t?t:[];if(!(null==n?void 0:n.length))throw m.FN.error(u.o.t("workflow_add_list_added_id_empty")),new c.sH("normal_error","project workflow list no item");return n.at(0)})).apply(this,arguments)}function V(e){return B.apply(this,arguments)}function B(){return(B=(0,o._)(function*(e){if(!e.spaceId||!e.workflowId||!e.pluginId)throw new c.sH("normal_error","getWorkflowItemByPluginId: empty id");var t,n,o,r,l,a,i=null!==(r=null===(t=(yield f.Js.GetPlaygroundPluginList({space_id:e.spaceId,page:1,size:1,plugin_ids:[e.pluginId||""],plugin_types:[e.isImageflow?p.zV.IMAGEFLOW:p.zV.WORKFLOW]},{__disableErrorToast:!0})).data)||void 0===t?void 0:t.plugin_list)&&void 0!==r?r:[];if(!(null==i?void 0:i.length))throw m.FN.error(u.o.t(e.isImageflow?"imageflow_add_toast_error":"workflow_add_list_added_id_empty")),new c.sH("normal_error","plugin_list no item");var s=i.at(0);return{workflow_id:e.workflowId||"",plugin_id:e.pluginId||"",name:(null==s?void 0:s.name)||"",desc:(null==s?void 0:s.desc_for_human)||"",parameters:null!==(l=null==s?void 0:null===(o=s.plugin_apis)||void 0===o?void 0:null===(n=o.at(0))||void 0===n?void 0:n.parameters)&&void 0!==l?l:[],plugin_icon:(null==s?void 0:s.plugin_icon)||"",version_name:null==s?void 0:s.version_name,flow_mode:(null==s?void 0:s.plugin_type)===p.zV.IMAGEFLOW?d.wz8.Imageflow:null!==(a=e.flowMode)&&void 0!==a?a:d.wz8.Workflow}})).apply(this,arguments)}function G(e){return(null==L?void 0:L.modalState.dataSourceType)===x.ye.Workflow}var W=(t=(0,o._)(function*(){if(!(!L||G(N))){if(P&&!A){O("/sign/oauth?redirect=".concat(encodeURIComponent("/store/bot"),"&platform=volcano&page_from=coze_pro_sign_in"));return}_.E7.info({message:"workflow_modal: dupProduct"});var e="",t="";try{var n=yield C(N,L.spaceId);e=n.pluginId,t=n.workflowId}catch(e){y.includes(null==e?void 0:e.code)?m.FN.error(e.message):(m.FN.error(u.o.t("copy_failed")),_.E7.error({message:"dupProduct: copyProductHandle error",error:e}));return}yield(0,_.Dc)(100);try{var o,l=yield V({spaceId:L.spaceId,workflowId:t,pluginId:e,isImageflow:(null==N?void 0:null===(o=N.meta_info)||void 0===o?void 0:o.entity_type)===v._J.ImageflowTemplateV2});null==S||S([...null!=k?k:[],l]),null==I||I(l,{isDup:!0,spaceId:L.spaceId}),D?D(l):m.FN.success({content:(0,r.jsxs)(m.T,{spacing:6,children:[(0,r.jsx)(w,{children:u.o.t("workflowstore_workflow_copy_successful")}),(0,r.jsx)(m.zx,{color:"primary",onClick:()=>{window.open("/work_flow?space_id=".concat(L.spaceId,"&workflow_id=").concat(l.workflow_id,"&from=dupSuccess"))},children:u.o.t("workflowstore_continue_editing")})]})})}catch(e){m.FN.error(u.o.t("workflow_add_list_added_fail")),_.E7.error({message:"dupProduct: getWorkflowItemByPluginId error",error:e})}}}),function(){return t.apply(this,arguments)});var U=(n=(0,o._)(function*(){if(!!L&&!!G(N)){_.E7.info({message:"workflow_modal: dupWorkflowTpl"});var e="",t="";try{var n,o,l,a,i=yield d.OHc.CopyWkTemplateApi({workflow_ids:[N.workflow_id||""],target_space_id:L.spaceId},{__disableErrorToast:!0});t=(null===(n=i.data[null!==(l=N.workflow_id)&&void 0!==l?l:""])||void 0===n?void 0:n.workflow_id)||"",e=(null===(o=i.data[null!==(a=N.workflow_id)&&void 0!==a?a:""])||void 0===o?void 0:o.plugin_id)||"0"}catch(e){m.FN.error(u.o.t("copy_failed")),_.E7.error({message:"dupWorkflowTpl: CopyWkTemplateApi error",error:e});return}if(!t||"0"===e){m.FN.error(u.o.t("copy_failed")),_.E7.error({message:"dupWorkflowTpl: CopyWkTemplateApi error",error:new c.sH("normal_error","CopyWkTemplateApi: plugin_id is ".concat(e,", workflow_id is ").concat(t))});return}yield(0,_.Dc)(100);try{var s,v=yield V({spaceId:L.spaceId,workflowId:t,pluginId:e,isImageflow:L.flowMode===d.wz8.Imageflow,flowMode:N.flow_mode}),p=null!==(s=null==N?void 0:N.flow_mode)&&void 0!==s?s:null==L?void 0:L.flowMode;void 0!==p&&(v.flow_mode=p),null==S||S([...null!=k?k:[],v]),null==I||I(v,{isDup:!0,spaceId:L.spaceId}),D?D(v):m.FN.success({content:(0,r.jsxs)(m.T,{spacing:6,children:[(0,r.jsx)(w,{children:u.o.t("workflowstore_workflow_copy_successful")}),(0,r.jsx)(m.zx,{color:"primary",onClick:()=>{window.open("/work_flow?space_id=".concat(L.spaceId,"&workflow_id=").concat(v.workflow_id))},children:u.o.t("workflowstore_continue_editing")})]})})}catch(e){m.FN.error(e.message||u.o.t("workflow_add_list_added_fail")),_.E7.error({message:"dupWorkflowTpl: getWorkflowItemByPluginId error",error:e})}}}),function(){return n.apply(this,arguments)});var H=(j=(0,o._)(function*(){if(!L||!G(N))return!1;_.E7.info({message:"workflow_modal: addWorkflow"});try{var e=yield function(e){return F.apply(this,arguments)}({spaceId:L.spaceId,workflowId:N.workflow_id,pluginId:N.plugin_id,isImageflow:(null==N?void 0:N.flow_mode)===d.wz8.Imageflow,flowMode:null==N?void 0:N.flow_mode});void 0!==(null==N?void 0:N.flow_mode)&&(e.flow_mode=null==N?void 0:N.flow_mode),null==S||S([...null!=k?k:[],e]);var t=yield null==I?void 0:I(e,{isDup:!1,spaceId:L.spaceId});if((0,i.Z)(t))return t;return!0}catch(e){return m.FN.error(e.message||u.o.t("workflow_add_list_added_fail")),_.E7.error({message:"addWorkflow: getWorkflowItemByPluginId error",error:e}),!1}}),function(){return j.apply(this,arguments)});var J=(b=(0,o._)(function*(){if(!G(N)||!M)return;_.E7.info({message:"workflow_modal: deleteWorkflow"});var e,t=yield null==M?void 0:M(N);if((null==t?void 0:t.canDelete)&&(yield null==t?void 0:null===(e=t.handleDelete)||void 0===e?void 0:e.call(t)),!k)return;var n=k.find(e=>e.workflow_id===N.workflow_id);if(!!n)null==Z||Z(n),null==S||S(k.filter(e=>e.workflow_id!==N.workflow_id))}),function(){return b.apply(this,arguments)});return{dupWorkflowTpl:U,dupProduct:W,addWorkflow:H,removeWorkflow:()=>{if(!k||!G(N))return;_.E7.info({message:"workflow_modal: removeWorkflow"});var e=k.find(e=>e.workflow_id===N.workflow_id);if(!!e)null==T||T(e),null==S||S(k.filter(e=>e.workflow_id!==N.workflow_id))},deleteWorkflow:J,itemClick:()=>{if(!!L){if(_.E7.info({message:"workflow_modal: itemClick"}),E){var e,t,n,o,r,l=E({item:N,type:L.modalState.dataSourceType},L.getModalState(L));if(!l||l.handled)return}if(G(N)){;o=null!==(t=(e=N).workflow_id)&&void 0!==t?t:"",r=new URLSearchParams,z&&r.append("bot_id",z),r.append("space_id",null!==(n=null==L?void 0:L.spaceId)&&void 0!==n?n:""),r.append("workflow_id",o),window.open("/work_flow?".concat(r.toString()),"_blank")}else window.open("/template/workflow/".concat(N.meta_info.id,"?entity_id=").concat(v._J.WorkflowTemplateV2),"_blank")}}}}},184827:function(e,t,n){n.d(t,{e:function(){return v}});var o=n(825955),r=n(808549),l=n(120454),a=n(455069),i=n(268935),s=n(707107),d=n(727914),u=n(117140),c=n(382534);function v(){var e,t,{pageSize:n=12,enabled:v=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[p,f]=(0,a.useState)(),[m,h]=(0,a.useState)(u.ER.Heat),[g,x]=(0,a.useState)(),[_,y]=(0,a.useState)(),w=(0,a.useMemo)(()=>({entity_types:[u._J.WorkflowTemplateV2,u._J.ImageflowTemplateV2],page_num:1,page_size:n,category_id:g,sort_type:m,source:_,keyword:p}),[p,m,g,_]),j=(0,a.useMemo)(()=>["workflow_product",JSON.stringify(w)],[w]);var b=(e=(0,o._)(function*(e){return(yield c.yF.PublicGetProductList(e)).data}),function(t){return e.apply(this,arguments)}),{data:N,error:k,fetchNextPage:C,hasNextPage:S,isFetching:I,isFetchingNextPage:T,status:E,refetch:D}=(0,i.N)({enabled:v,queryKey:j,queryFn:e=>{var{pageParam:t}=e;return b(t)},initialPageParam:w,getNextPageParam:(e,t,n)=>{var o;return(null==e?void 0:e.has_more)?(0,l._)((0,r._)({},n),{page_num:(null!==(o=n.page_num)&&void 0!==o?o:1)+1}):null}}),Z=(0,a.useMemo)(()=>{var e=[],t={};return null==N||N.pages.forEach(n=>{var o;null==n||null===(o=n.products)||void 0===o||o.forEach(n=>{if(!!n.meta_info.id)!t[n.meta_info.id]&&e.push(n),t[n.meta_info.id]=!0})}),e},[N]);return{updatePageParam:e=>{if("category_id"in e&&x(e.category_id),"sort_type"in e){var t;h(null!==(t=e.sort_type)&&void 0!==t?t:u.ER.Newest)}"keyword"in e&&f(e.keyword),"source"in e&&y(e.source)},workflowProductList:Z,queryError:k,loadingStatus:E,refetch:D,fetchNextPage:C,isFetching:I,isFetchingNextPage:T,hasNextPage:S,copyProduct:(t=(0,o._)(function*(e,t){if(!(null==e?void 0:null===(n=e.meta_info)||void 0===n?void 0:n.id))throw new d.sH("normal_error","no productId");var n,o,a,i,v,p,f,m,h,g,x=yield c.yF.PublicDuplicateProduct({product_id:null==e?void 0:null===(o=e.meta_info)||void 0===o?void 0:o.id,space_id:t,entity_type:e.meta_info.entity_type},{__disableErrorToast:!0}),_=null===(a=x.data)||void 0===a?void 0:a.new_entity_id,y=null===(i=x.data)||void 0===i?void 0:i.new_plugin_id;if(!_||!y)throw new d.sH("normal_error","copyProduct fail, no new_entity_id");return(0,s.Gg)(s.Kg.template_action_front,(0,l._)((0,r._)({template_id:null!==(m=e.meta_info.id)&&void 0!==m?m:"",template_name:null!==(h=e.meta_info.name)&&void 0!==h?h:"",template_type:e.meta_info.entity_type===u._J.WorkflowTemplateV2?"workflow":"imageflow",template_tag_professional:e.meta_info.is_professional?"professional":"basic",entity_id:null!==(g=e.meta_info.entity_id)&&void 0!==g?g:""},(null==e?void 0:null===(v=e.meta_info)||void 0===v?void 0:v.is_free)?{template_tag_prize:"free"}:{template_tag_prize:"paid",template_prize_detail:Number(null==e?void 0:null===(f=e.meta_info)||void 0===f?void 0:null===(p=f.price)||void 0===p?void 0:p.amount)||0}),{action:"duplicate",after_id:_})),{workflowId:_,pluginId:y}}),function(e,n){return t.apply(this,arguments)})}}},561326:function(e,t,n){n.d(t,{d:function(){return c}});var o=n(151064),r=n(455069),l=n(998600),a=n(474872),i=n(117140),s=n(336205),d=n(242505),u=n(518175);function c(){var e=(0,r.useContext)(d.Z),{run:t,cancel:n}=(0,l.Z)(e=>{e.length>100?m(e.substring(0,100)):m(e)},{wait:300});if(!e)return null;var{dataSourceType:c,query:v,isSpaceWorkflow:p,sortType:f}=e.modalState,m=t=>{var n={query:null!=t?t:""};c===u.ye.Workflow&&(n.workflowTag=p?0:1,n.sortType=void 0),c===u.ye.Product&&(!t&&f===i.ER.Relative&&(n.sortType=i.ER.Heat),t&&!e.modalState.query&&(n.sortType=n.sortType=i.ER.Relative)),e.updateModalState(n)};return(0,o.jsx)(a.yO,{tabIndex:-1,value:v,placeholder:s.o.t("workflow_add_search_placeholder"),"data-testid":"workflow.modal.search",onSearch:e=>{e?t(e):(n(),m(""))}})}},39823:function(e,t,n){n.d(t,{BD:()=>c.BD,ZP:()=>R,Do:()=>F.D,md:()=>A,ye:()=>c.ye,sD:()=>O.sD,wL:()=>v.w});var o=n("473980"),r=n("151064"),l=n("455069"),a=n("252237"),i=n.n(a),s=n("408487"),d=n("336205"),u=n("775699"),c=n("518175"),v=n("891052"),p=n("808549"),f=n("120454"),m=n("550540"),h=n("527116"),g=n("450562"),x=n("707107"),_=n("214942"),y=n("727914"),w=n("286518"),j=n("242505"),b=n("561326"),N=n("825955"),k=n("672496"),C=n("915757"),S=n("189284");n("117140"),n("382534");var I=n("592476"),T=(0,l.forwardRef)((e,t)=>{var n,{from:o,hiddenSpaceList:a,hiddenExplore:u,hiddenLibrary:p,hiddenWorkflowCategories:f=[]}=e,m=(0,l.useContext)(j.Z),[h]=(0,S.V)();var x=(n=(0,N._)(function*(){var e,t;if(u)return{type:"WorkFlowTemplateTag",data:[]};if(h["bot.community.store_imageflow"]||(0,g.ikd)((null==m?void 0:m.flowMode)||s.wz8.Workflow))return{type:"PublicGetProductCategoryList",data:[]};return{type:"WorkFlowTemplateTag",data:null!==(t=null===(e=(yield g.OHc.WorkFlowTemplateTag({flow_mode:null==m?void 0:m.flowMode})).data)||void 0===e?void 0:e.tags)&&void 0!==t?t:[]}}),function(){return n.apply(this,arguments)}),_=(0,l.useMemo)(()=>(null==m?void 0:m.modalState)?m.modalState.dataSourceType===c.ye.Product?m.modalState.productCategory:m.modalState.workflowTag:"",[null==m?void 0:m.modalState]),y=(0,l.useMemo)(()=>{var e=["workflow-modal-side"];return e.push("flowMode-".concat(null==m?void 0:m.flowMode)),e},[m]),{data:w}=(0,k.a)({enabled:!!m,queryKey:y,queryFn:x});(0,l.useImperativeHandle)(t,()=>({getCurrent:()=>null==w?void 0:w.data.find(e=>e.type===_)}));var b=e=>{null==m||m.updateModalState({isSpaceWorkflow:e!==c.BD.Example,workflowCategory:e,workflowTag:0,query:"",dataSourceType:c.ye.Workflow,productCategory:e,sortType:void 0})},T=(0,l.useMemo)(()=>{var e=p?[]:[{title:d.o.t("project_resource_modal_library_resources",{resource:d.o.t("library_resource_type_workflow")}),icon:(0,r.jsx)(C.Iqn,{className:I.Z["tool-tag-list-cell-icon"]}),testId:"workflow.modal.search.option.library",category:c.BD.Library}];return o===v.w.ProjectWorkflowAddNode&&e.push({title:d.o.t("project_resource_modal_project_resources",{resource:d.o.t("library_resource_type_workflow")}),icon:(0,r.jsx)(C.Iqn,{className:I.Z["tool-tag-list-cell-icon"]}),testId:"workflow.modal.search.option.project",category:c.BD.Project}),e.push({title:d.o.t("workflow_add_example"),icon:(0,r.jsx)(C.Iqn,{className:I.Z["tool-tag-list-cell-icon"]}),testId:"workflow.modal.search.option.example",category:c.BD.Example}),e.filter(e=>!f.includes(e.category))},[o,p,f,h]);return m?(0,r.jsx)("div",{className:"tool-tag-list ".concat(I.Z["tool-tag-list"]),children:!a&&(0,r.jsx)("div",{children:T.map(e=>{var t=(null==m?void 0:m.modalState.workflowCategory)===e.category;return(0,r.jsxs)("div",{"data-testid":e.testId,className:i()(I.Z["tool-tag-list-cell"],{[I.Z.active]:t}),onClick:()=>b(e.category),children:[e.icon,e.title]},e.testId)})})}):null});T.displayName="WorkflowFilter";var E=n("187724"),D=(0,l.forwardRef)((e,t)=>{var n=(0,l.useContext)(j.Z),{hiddenCreate:o,hiddenExplore:a,from:i}=e,s=(0,b.d)();return n?(0,r.jsxs)(u.yh,{style:{paddingTop:16},children:[(0,r.jsxs)(u.yh.Header,{children:[s,!o&&(0,r.jsx)(E.y,{className:"!mt-6 w-full",onCreateSuccess:e.onCreateSuccess,nameValidators:e.nameValidators,from:i})]}),(0,r.jsx)(u.yh.Content,{children:(0,r.jsx)(T,{ref:t,from:e.from,hiddenExplore:a,hiddenSpaceList:e.hiddenSpaceList,hiddenLibrary:e.hiddenLibrary,hiddenWorkflowCategories:e.hiddenWorkflowCategories})})]}):null});D.displayName="WorkflowModalSider";var Z=n("442078"),M=n("647045"),P=n("361408"),L=n("706188"),z=n("104313"),O=n("101094"),A=e=>{var{flowMode:t=s.wz8.Workflow,initState:n,hideSider:o=!1,bindBizId:a,bindBizType:i,projectId:u,i18nMap:b,from:N}=e,{space_type:k,id:C}=(0,_.rY)(e=>e.space),S=(0,l.useRef)(null),[I,T]=(0,l.useState)({status:null!==(q=null==n?void 0:n.status)&&void 0!==q?q:s.VBX.HadPublished,dataSourceType:null!==(K=null==n?void 0:n.dataSourceType)&&void 0!==K?K:c.ye.Workflow,creator:null!==(X=null==n?void 0:n.creator)&&void 0!==X?X:c.gp.All,workflowTag:null!==(Y=null==n?void 0:n.workflowTag)&&void 0!==Y?Y:0,productCategory:null!==(Q=null==n?void 0:n.productCategory)&&void 0!==Q?Q:"",query:null!==($=null==n?void 0:n.query)&&void 0!==$?$:"",isSpaceWorkflow:null===(ee=null==n?void 0:n.isSpaceWorkflow)||void 0===ee||ee,workflowCategory:N===v.w.ProjectWorkflowAddNode?c.BD.Project:c.BD.Library,listFlowMode:null!==(et=null==n?void 0:n.listFlowMode)&&void 0!==et?et:s.wz8.All}),E=(0,l.useCallback)(e=>{T((0,p._)({},I,e))},[I]),[A,F]=(0,l.useState)(s.d$J.UpdateTime),[R,V]=(0,l.useState)(!1);(0,m.Z)(()=>{var t,o,r,l,a,i,d,u;T({status:null!==(t=null==n?void 0:n.status)&&void 0!==t?t:s.VBX.HadPublished,dataSourceType:null!==(o=null==n?void 0:n.dataSourceType)&&void 0!==o?o:c.ye.Workflow,creator:null!==(r=null==n?void 0:n.creator)&&void 0!==r?r:c.gp.All,workflowTag:null!==(l=null==n?void 0:n.workflowTag)&&void 0!==l?l:0,productCategory:null!==(a=null==n?void 0:n.productCategory)&&void 0!==a?a:"",query:null!==(i=null==n?void 0:n.query)&&void 0!==i?i:"",isSpaceWorkflow:null===(d=null==n?void 0:n.isSpaceWorkflow)||void 0===d||d,workflowCategory:N===v.w.ProjectWorkflowAddNode?c.BD.Project:c.BD.Library,listFlowMode:null!==(u=null==n?void 0:n.listFlowMode)&&void 0!==u?u:s.wz8.All}),z.E7.info({message:"useWorkflowModalParts mounted",meta:{from:e.from}})});var B={spaceId:null!=C?C:"",spaceType:null!=k?k:w.Sn.Team,bindBizId:a,bindBizType:i,projectId:u,flowMode:t,modalState:I,updateModalState:E,orderBy:A,setOrderBy:F,createModalVisible:R,setCreateModalVisible:V,getModalState:e=>(0,p._)({},e.modalState),i18nMap:b};if(!k||!C)return z.E7.errorEvent({eventName:"workflow_modal_in_bot_no_spaceId",error:new y.sH("normal_error","no spaceId")}),{sider:null,content:null,filter:null};var G=i===s.k5N.DouYinBot,W=o||G,U=W?null:(0,r.jsx)(h.aH,{client:s.fB_,children:(0,r.jsx)(j.Z.Provider,{value:B,children:(0,r.jsx)(D,(0,p._)({ref:S},e))})}),H=(0,r.jsx)(h.aH,{client:s.fB_,children:(0,r.jsx)(j.Z.Provider,{value:B,children:(0,r.jsx)(L.h,(0,f._)((0,p._)({},e),{onDupSuccess:n=>{if(!!e.onDupSuccess){if(I.dataSourceType===c.ye.Product){var o,r,l,a=null!==(l=({[v.w.SpaceWorkflowList]:x.JN.template,[v.w.WorkflowAddNode]:x.JN.flowIde,[v.w.BotSkills]:x.JN.botIde,[v.w.BotMultiSkills]:x.JN.botIde,[v.w.BotTrigger]:x.JN.botIde,[v.w.BotShortcut]:x.JN.botIde,[v.w.WorkflowAgent]:x.JN.botIde})[e.from||""])&&void 0!==l?l:x.JN.botIde;(0,x.Gg)(x.Kg.flow_duplicate_click,{store_type:(0,g.ikd)(t)?x.Pv.workflow:x.Pv.imageflow,resource:a,category_name:(null===(r=S.current)||void 0===r?void 0:null===(o=r.getCurrent())||void 0===o?void 0:o.name)||"",duplicate_type:e.from===v.w.BotSkills?x.OX.toBot:x.OX.toWorkspace})}e.onDupSuccess(n)}}}))})}),J=(0,r.jsx)(h.aH,{client:s.fB_,children:(0,r.jsx)(j.Z.Provider,{value:B,children:G?(0,r.jsx)(M.M,(0,p._)({},e)):(0,r.jsx)(P.A,(0,p._)({},e))})});if(W&&!G){var q,K,X,Y,Q,$,ee,et,en,eo=d.o.t(null===(en=O.fw[t])||void 0===en?void 0:en[O.sD.Title]);J=(0,r.jsxs)("div",{className:"flex flex-col items-start flex-grow flex-shrink-0",children:[(0,r.jsx)("div",{className:Z.Z.title,children:eo}),J]})}return{sider:U,filter:J,content:H}},F=n("398420"),R=e=>{var t,n,{className:l,visible:a,onClose:c}=e,v=(0,o._)(e,["className","visible","onClose"]),{sider:p,filter:f,content:m}=A(v),h=null!==(n=v.flowMode)&&void 0!==n?n:s.wz8.Workflow,g=v.bindBizType===s.k5N.DouYinBot;return(0,r.jsx)(u.FS,{visible:a,onCancel:c,siderWrapperClassName:v.hideSider||g?"hidden":"",header:d.o.t(null===(t=O.fw[h])||void 0===t?void 0:t[O.sD.Title]),className:i()(Z.Z["workflow-modal"],l,"new-workflow-modal",g?Z.Z["douyin-workflow-modal"]:""),sider:p,filter:f,content:m})}},187724:function(e,t,n){n.d(t,{y:function(){return g}});var o=n(825955),r=n(151064),l=n(455069),a=n(567282),i=n(336205),s=n(915757),d=n(674343),u=n(727914),c=n(242505),v=n(891052),p=n(101094),f=n(419034),m=n(104313),h=n(527021),g=e=>{var t,n,{className:g,onCreateSuccess:x,nameValidators:_,from:y}=e,w=(0,l.useContext)(c.Z),{i18nText:j,ModalI18nKey:b}=(0,p.v0)(),N=(0,h.d)(),[k,C]=(0,l.useState)(null!==(n=null==w?void 0:w.flowMode)&&void 0!==n?n:a.wz.Workflow);if(!w)return null;var{createModalVisible:S,setCreateModalVisible:I,bindBizType:T}=w,E=T===a.k5.DouYinBot||y===v.w.WorkflowAgent,D=[{label:i.o.t("workflow_add_navigation_create"),handler:()=>{C(a.wz.Workflow),I(!0)},icon:(0,r.jsx)(s.eTH,{})},{label:i.o.t("wf_chatflow_81"),handler:()=>{C(a.wz.ChatFlow),I(!0)},icon:(0,r.jsx)(s.TLD,{})}];return(0,r.jsxs)(r.Fragment,{children:[E?(0,r.jsx)(d.zx,{className:g,color:"hgltplus",onClick:()=>{y===v.w.WorkflowAgent?C(a.wz.ChatFlow):C(a.wz.Workflow),I(!0)},children:y===v.w.WorkflowAgent?i.o.t("wf_chatflow_81"):i.o.t("workflow_add_navigation_create")}):(0,r.jsx)(d.v2,{trigger:"click",position:"bottom",render:(0,r.jsx)(d.v2.SubMenu,{className:"w-[198px]",mode:"menu",children:D.map(e=>(0,r.jsx)(d.v2.Item,{onClick:(t,n)=>{n.stopPropagation(),e.handler()},icon:e.icon,children:e.label},e.label))}),children:(0,r.jsx)(d.zx,{className:g,color:"hgltplus",icon:(0,r.jsx)(s.Wdl,{}),iconPosition:"right",children:w.projectId?i.o.t("wf_chatflow_03"):j(b.NavigationCreate)})}),(0,r.jsx)(f.d,{initConfirmDisabled:!0,mode:"add",flowMode:k,bindBizType:w.bindBizType,bindBizId:w.bindBizId,projectId:w.projectId,visible:S,onCancel:()=>I(!1),onSuccess:(t=(0,o._)(function*(e){var t,{workflowId:n,flowMode:o}=e;if(I(!1),!n)throw new u.sH("[Workflow] create failed","create workflow failed, no workflow id");yield(0,m.Dc)(500),x?null==x||x({spaceId:w.spaceId,workflowId:n,flowMode:o||a.wz.Workflow}):N({workflowId:n,spaceId:null!==(t=w.spaceId)&&void 0!==t?t:""})}),function(e){return t.apply(this,arguments)}),nameValidators:_})]})}},518175:function(e,t,n){n.d(t,{BD:function(){return d},aJ:function(){return s},gp:function(){return a},ye:function(){return i}});var o,r,l,a=((o={}).All="1",o.Mine="2",o);var i=((r={}).Workflow="workflow",r.Product="product",r),s="all";var d=((l={}).Project="project",l.Library="library",l.Example="example",l)},398420:function(e,t,n){n.d(t,{D:function(){return r}});var o=n(518175),r=e=>(null==e?void 0:e.workflowCategory)===o.BD.Project},242505:function(e,t,n){var o=n(455069).createContext(null);t.Z=o},847167:function(e,t,n){n.d(t,{Pi:()=>ef,BV:()=>e1,mO:()=>eY,$2:()=>e2});var o,r,l=n("686436"),a=n("702570"),i=n("130001"),s=n("523158"),d=n("686346"),u=n("435946");var c=((o={}).NO_START_END="1001",o.INVALID_PORTS="1002",o.ENCAPSULATE_LINES="1003",o.AT_LEAST_TWO_NODES="1005",o.INVALID_FORM="1006",o.VALIDATE_ERROR="1007",o.INVALID_SCHEMA="1008",o.INVALID_LOOP_NODES="1009",o.INVALID_SUB_CANVAS="1010",o),v=Symbol("EncapsulateValidateResult"),p=Symbol("EncapsulateValidateResultFactory"),f=Symbol("EncapsulateNodeValidator"),m=Symbol("EncapsulateNodesValidator"),h=Symbol("EncapsulateWorkflowJSONValidator"),g=Symbol("EncapsulateValidateManager"),x=Symbol("EncapsulateValidateService");class _{getNodeValidators(){return this.nodeValidators||[]}getNodesValidators(){return this.nodesValidators||[]}getWorkflowJSONValidators(){return this.workflowJSONValidators||[]}getNodeValidatorsByType(e){return(this.nodeValidators||[]).filter(t=>t.canHandle(e))}dispose(){this.nodeValidators=[],this.nodesValidators=[],this.workflowJSONValidators=[]}constructor(){this.nodesValidators=[],this.nodeValidators=[],this.workflowJSONValidators=[]}}(0,i.gn)([(0,s.n)(m),(0,d.j)(),(0,i.w6)("design:type",Array)],_.prototype,"nodesValidators",void 0),(0,i.gn)([(0,s.n)(f),(0,d.j)(),(0,i.w6)("design:type",Array)],_.prototype,"nodeValidators",void 0),(0,i.gn)([(0,s.n)(h),(0,d.j)(),(0,i.w6)("design:type",Array)],_.prototype,"workflowJSONValidators",void 0),_=(0,i.gn)([(0,u.b)()],_);var y=n("825955"),w=n("771531"),j=n("450562");function b(e){return e.filter(e=>![j.nyy.Start,j.nyy.End].includes(e.flowNodeType))}var N=Symbol("EncapsulateGenerateService"),k=n("633697"),C=n("569502"),S=e=>{var t,n;return(null===(n=e[0])||void 0===n?void 0:null===(t=n.parent)||void 0===t?void 0:t.id)||"root"},I=n("839974");function T(e){var t;if(e instanceof l.CT){var n=e.getData(l.WV);return{x:n.x,y:n.y}}return(null==e?void 0:null===(t=e.meta)||void 0===t?void 0:t.position)||{x:0,y:0}}function E(e,t){var n,o;n=e,o={x:t.x+t.width/2,y:t.y},n.meta||(n.meta={}),n.meta.position=o}var D=n("408487");class Z{setGetGlobalState(e){this.getGlobalStateOption=e}setGetNodeTemplate(e){this.getNodeMetaTemplateOption=e}getNodeTemplate(e){return this.getNodeMetaTemplateOption(this.pluginContext)(e)}setPluginContext(e){this.pluginContext=e}get globalState(){return this.getGlobalStateOption(this.pluginContext)}get spaceId(){var e;return null===(e=this.globalState)||void 0===e?void 0:e.spaceId}get flowName(){var e,t;return null===(t=this.globalState)||void 0===t?void 0:null===(e=t.info)||void 0===e?void 0:e.name}get flowMode(){var e;return null===(e=this.globalState)||void 0===e?void 0:e.flowMode}get isChatFlow(){var e;return(null===(e=this.globalState)||void 0===e?void 0:e.flowMode)===D.wz8.ChatFlow}get enabled(){return!!(0,I.L)()["bot.automation.encapsulate"]&&!this.playgroundConfigEntity.readonly}get projectId(){var e;return null===(e=this.globalState)||void 0===e?void 0:e.projectId}constructor(){this.getGlobalStateOption=()=>({spaceId:"",flowMode:D.wz8.Workflow,info:{name:""}}),this.getNodeMetaTemplateOption=()=>()=>void 0}}(0,i.gn)([(0,w.f)(l.v2),(0,i.w6)("design:type",void 0===l.v2?Object:l.v2)],Z.prototype,"entityManager",void 0),(0,i.gn)([(0,w.f)(l.ER),(0,i.w6)("design:type",void 0===l.ER?Object:l.ER)],Z.prototype,"playgroundConfigEntity",void 0),Z=(0,i.gn)([(0,u.b)()],Z);var M=n("778043"),P=n("998262"),L=e=>z(null==e?void 0:e[0]),z=e=>{var t;return(null==e?void 0:null===(t=e.parent)||void 0===t?void 0:t.id)!=="root"},O=e=>(null==e?void 0:e.flowNodeType)===l.Sy.SUB_CANVAS,A=e=>{var t=null==e?void 0:e.getNodeMeta(),n=null==t?void 0:t.subCanvas(e);return null==n?void 0:n.parentNode};class F{getValidEncapsulateConnectPorts(e){var t=this.getEncapsulateNodesInputLines(e),n=this.getEncapsulateNodesOutputLines(e);if(!this.validateEncapsulateLines(t))throw Error("输入线不符合封装规则");if(!this.validateEncapsulateLines(n))throw Error("输出线不符合封装规则");return{inputLines:t,outputLines:n,fromPorts:(0,M.Z)(t.map(e=>e.fromPort)),toPorts:(0,M.Z)(n.map(e=>e.toPort).filter(Boolean))}}connectPortsToNode(e,t){var{fromPorts:n,toPorts:o}=e;n.forEach(e=>{this.linesManager.createLine({from:e.node.id,fromPort:e.portID,to:t.id})}),o.forEach(e=>{this.linesManager.createLine({from:t.id,to:e.node.id,toPort:e.portID})})}getEncapsulateNodesInputLines(e){return(0,M.Z)(e.map(e=>e.getData(l.Z1).inputLines).flat()).filter(t=>t.from&&!e.includes(t.from)&&(L(e)||!this.isSubCanvasLinkLine(t)))}getEncapsulateNodesOutputLines(e){return(0,M.Z)(e.map(e=>e.getData(l.Z1).outputLines).flat()).filter(t=>t.to&&!e.includes(t.to)&&(L(e)||!this.isSubCanvasLinkLine(t)))}validateEncapsulateLines(e){var t=1===(0,M.Z)(e.map(e=>e.fromPort)).length,n=1===(0,M.Z)(e.map(e=>e.toPort)).length;return t||n}createEncapsulateLines(e,t){var n=[],o=[];return e.inputLines.forEach(e=>{var o=this.linesManager.createLine({from:e.from.id,fromPort:e.fromPort.portID,to:t.id});if(!o)throw Error("create input line failed");n.push(o)}),e.outputLines.forEach(e=>{if(!!e.to){var n,r=this.linesManager.createLine({from:t.id,to:e.to.id,toPort:null===(n=e.toPort)||void 0===n?void 0:n.portID});if(!r)throw Error("create output line failed");o.push(r)}}),{inputLines:n,outputLines:o}}createDecapsulateLines(e){var{node:t,startNodeId:n,endNodeId:o,idsMap:r,workflowJSON:l}=e,a=[...l.edges,...l.nodes.map(e=>e.edges).filter(Boolean).flat()],i=(0,P.Z)(a,e=>e.sourceNodeID===n?"input":e.targetNodeID===o?"output":"internal"),s=this.createDecapsulateInternalLines(i.internal||[],r),d=this.createDecapsulateInputLines(i.input||[],t,r);return{inputLines:d,outputLines:this.createDecapsulateOutputLines(i.output||[],t,r),internalLines:s}}createDecapsulateInternalLines(e,t){var n=[];return e.forEach(e=>{if(!!t.has(e.sourceNodeID)&&!!t.has(e.targetNodeID)){var o={from:t.get(e.sourceNodeID),to:t.get(e.targetNodeID),fromPort:e.sourcePortID,toPort:e.targetPortID};"loop-function-inline-output"===o.fromPort&&(o.from="LoopFunction_".concat(o.from)),"loop-function-inline-input"===o.toPort&&(o.to="LoopFunction_".concat(o.to)),"batch-function-inline-output"===o.fromPort&&(o.from="BatchFunction_".concat(o.from)),"batch-function-inline-input"===o.toPort&&(o.to="BatchFunction_".concat(o.to)),this.createLine(o,n)}}),n}createDecapsulateInputLines(e,t,n){var o=[],{inputLines:r}=t.getData(l.Z1);return r.length>1&&e.length>1?o:(r.forEach(t=>{e.forEach(e=>{if(!!n.has(e.targetNodeID))this.createLine({from:t.from.id,fromPort:t.fromPort.portID,to:n.get(e.targetNodeID),toPort:e.targetPortID},o)})}),o)}createDecapsulateOutputLines(e,t,n){var o=[],{outputLines:r}=t.getData(l.Z1);return r.length>1&&e.length>1?o:(r.forEach(t=>{e.forEach(e=>{var r,l;if(!!n.has(e.sourceNodeID))this.createLine({from:n.get(e.sourceNodeID),fromPort:e.sourcePortID,to:null===(r=t.to)||void 0===r?void 0:r.id,toPort:null===(l=t.toPort)||void 0===l?void 0:l.portID},o)})}),o)}createLine(e,t){var n=this.linesManager.createLine(e);n&&t&&t.push(n)}isSubCanvasLinkLine(e){var t,n,o,r;return(null===(t=e.toPort)||void 0===t?void 0:t.portID)==="loop-function-inline-input"||"loop-function-inline-output"===e.fromPort.portID||(null===(n=e.toPort)||void 0===n?void 0:n.portID)==="batch-function-inline-input"||"batch-function-inline-output"===e.fromPort.portID||"loop-output-to-function"===e.fromPort.portID&&(null===(o=e.toPort)||void 0===o?void 0:o.portID)==="loop-function-input"||"batch-output-to-function"===e.fromPort.portID&&(null===(r=e.toPort)||void 0===r?void 0:r.portID)==="batch-function-input"||!1}}(0,i.gn)([(0,w.f)(l.dm),(0,i.w6)("design:type",void 0===l.dm?Object:l.dm)],F.prototype,"linesManager",void 0),F=(0,i.gn)([(0,u.b)()],F);var R=n("336205"),V=n("674343"),B=n("816697"),G=n("801815"),W=()=>(0,G.kP)("0123456789",6)(),U=(e,t)=>!!t.find(t=>{var n,o=e.getNodeRegister(t.type);return!!(null==o?void 0:null===(n=o.meta)||void 0===n?void 0:n.subCanvas)}),H=Symbol("EncapsulateApiService"),J=n("962289"),q={[D.wz8.Workflow]:"plugin_icon/workflow.png",[D.wz8.ChatFlow]:"plugin_icon/chatflow-icon.png"};class K{encapsulateWorkflow(e){var{name:t,desc:n,json:o,flowMode:r}=e,l=this;return(0,y._)(function*(){try{var e,a=yield D.OHc.EncapsulateWorkflow({space_id:l.encapsulateContext.spaceId,name:t,flow_mode:r,desc:n,schema:JSON.stringify(o),icon_uri:q[r],project_id:l.encapsulateContext.projectId}),i=null===(e=a.data)||void 0===e?void 0:e.workflow_id;if(!i)return null;return{workflowId:i}}catch(e){return null}})()}validateWorkflow(e){var t=this;return(0,y._)(function*(){try{var n,o=yield D.OHc.EncapsulateWorkflow({space_id:t.encapsulateContext.spaceId,name:"",desc:"",icon_uri:"",schema:JSON.stringify(e),only_validate:!0});return(null==o?void 0:null===(n=o.data)||void 0===n?void 0:n.validate_data)||[]}catch(e){return[{message:"call validate api failed"}]}})()}getWorkflow(e,t,n){return(0,y._)(function*(){var o;if(n){var r=yield D.OHc.GetHistorySchema({space_id:e,workflow_id:t,workflow_version:n,commit_id:"",type:D.lcl.DraftOperate});o=(0,J.Z)(r,"data.schema")}else{var l=yield D.OHc.GetCanvasInfo({space_id:e,workflow_id:t});o=(0,J.Z)(l,"data.workflow.schema_json")}return o?JSON.parse(o):null})()}}(0,i.gn)([(0,w.f)(Z),(0,i.w6)("design:type",void 0===Z?Object:Z)],K.prototype,"encapsulateContext",void 0),K=(0,i.gn)([(0,u.b)()],K);var X=n("808549"),Y=n("120454"),Q=n("671261"),$=n("61111"),ee=n("860766"),et=n("664278"),en=n("306215"),eo=n("471583"),er=n("64605"),el=n("278796"),ea=n("222363"),ei=e=>({USER_INPUT:2,CONVERSATION_NAME:1})[null!=e?e:""]||0,es=e=>e?e.sort((e,t)=>{var n,o;return ei(null==t?void 0:null===(n=t.viewMeta)||void 0===n?void 0:n.name)-ei(null==e?void 0:null===(o=e.viewMeta)||void 0===o?void 0:o.name)}):e,ed=e=>(0,M.Z)(e.map(e=>{var t,n,o,r=e.getNodeRegistry(),l=null==r?void 0:null===(t=r.meta)||void 0===t?void 0:t.subCanvas;return[e,...(null==l?void 0:null===(o=l(e))||void 0===o?void 0:null===(n=o.canvasNode)||void 0===n?void 0:n.allCollapsedChildren)||[]]}).flat());class eu{getEncapsulateVars(e){var t=ed(e);return{startVars:this.getEncapsulateStartVars(t),endVars:this.getEncapsulateEndVars(t)}}updateVarsInEncapsulateJSON(e,t){var n,o=(null===(n=e.nodes.find(e=>e.type===j.nyy.Start))||void 0===n?void 0:n.id)||"100001";return(0,$.Uy)(e,e=>{this.updateVarsInEncapsulateNodesJSON(e.nodes,t,o)})}updateVarsInEncapsulateNodesJSON(e,t,n){var{startVars:o,endVars:r}=t;e.forEach(e=>{if(!e.data&&(e.data={}),e.type===j.nyy.Start){e.data.outputs=Object.entries(o).map(e=>{var[t,n]=e;return(0,Y._)((0,X._)({},n.dtoMeta),{name:t})});return}if(e.type===j.nyy.End){e.data.inputs={terminatePlan:"returnVariables",inputParameters:Object.entries(r).map(e=>{var[t,n]=e;return{name:t,input:n.refExpressionDTO}})};return}!function e(t,n){if((0,er.Z)(t)){"ref"===(0,J.Z)(t,"type")&&"block-output"===(0,J.Z)(t,"content.source")&&(0,el.Z)(t,"content.blockID")&&(0,el.Z)(t,"content.name")&&n(t),Object.entries(t).forEach(t=>{var[o,r]=t;e(r,n)},{});return}(0,ea.Z)(t)&&t.forEach(t=>{e(t,n)})}(e.data,e=>{if(!!e.content){var t,r,l,a=[null===(t=e.content)||void 0===t?void 0:t.blockID,...(null===(l=e.content)||void 0===l?void 0:null===(r=l.name)||void 0===r?void 0:r.split("."))||[]],i=Object.entries(o).find(e=>{var[,t]=e;return t.keyPath[0]===a[0]&&t.keyPath[1]===a[1]});i&&(e.content.blockID=n,e.content.name=[i[0],...a.slice(2)].join("."))}}),e.blocks&&this.updateVarsInEncapsulateNodesJSON(e.blocks,t,n)})}updateVarsAfterEncapsulate(e,t,n){var{startVars:o,endVars:r}=n;this.setSubFlowNodeInputs(e,o);var l=Object.entries(r).map(t=>{var[n,o]=t;return{beforeKeyPath:o.keyPath,afterKeyPath:[e.id,n,...o.keyPath.slice(2)]}});this.getBeyondNodes([...t,e]).forEach(e=>{e.getData(ee._).batchUpdateRefs(l)})}updateVarsAfterDecapsulate(e,t){var{startNode:n,endNode:o,middleNodes:r,idsMap:a}=t,i=this.flatNodeJSONs(r).map(e=>this.document.getNode(e.id||"")).filter(Boolean),s=e.getData(l.Ps).formModel.getFormItemValueByPath("/inputs/inputParameters"),d=[...a.entries().map(e=>({beforeKeyPath:[e[0]],afterKeyPath:[e[1]]})),...Object.entries(s||{}).map(e=>{var[t,o]=e;return{beforeKeyPath:[(null==n?void 0:n.id)||"100001",t],afterKeyPath:(0,J.Z)(o,"content.keyPath"),afterExpression:o}})];i.forEach(e=>{e.getData(ee._).batchUpdateRefs(d)});var u=((0,J.Z)((null==o?void 0:o.data)||{},"inputs.inputParameters")||[]).map(t=>{var{name:n,input:o}=t||{},r=[e.id,n||""],l=et.N.valueExpressionToVO(o,this.variableService);if(l.type===j.YX3.REF){var[i,...s]=(0,J.Z)(l,"content.keyPath")||[];return{beforeKeyPath:r,afterKeyPath:[a.get(i)||i,...s]}}return{beforeKeyPath:r,afterExpression:l}});this.getBeyondNodes([e,...i]).forEach(e=>{e.getData(ee._).batchUpdateRefs(u)})}setSubFlowNodeInputs(e,t){var n=e.getData(l.Ps),o=Object.entries(t).sort((e,t)=>ei(t[0])-ei(e[0])).reduce((e,t)=>{var[n,o]=t;return(0,Y._)((0,X._)({},e),{[n]:{type:j.YX3.REF,content:{keyPath:o.keyPath}}})},{});if((0,l.vo)(e))n.formModel.setValueIn("inputs.inputParameters",o);else{var r=n.formModel.getFormItemValueByPath("/");(0,Q.Z)(r,"inputs.inputParameters",o),n.fireChange()}}getEncapsulateStartVars(e){return this.generateVariableMap(this.getEncapsulateNodesVars(e))}getEncapsulateNodesVars(e){var t=e.map(e=>e.id);return es((0,M.Z)(e.map(e=>Object.values(e.getData(ee._).refs).filter(e=>!t.includes(e[0])&&!(0,en.mN)(e[0])).map(t=>this.variableService.getWorkflowVariableByKeyPath(t.slice(0,2),{node:e})).filter(Boolean)).flat()))}getEncapsulateEndVars(e){var t=e.map(e=>e.id),n=(0,M.Z)(this.getBeyondNodes(e).map(e=>Object.values(e.getData(ee._).refs).filter(e=>t.includes(e[0])).map(t=>this.variableService.getWorkflowVariableByKeyPath(t.slice(0,2),{node:e})).filter(Boolean)).flat());return this.generateVariableMap(n)}getBeyondNodes(e){var t=e.map(e=>e.id);return this.document.getAllNodes().filter(e=>!t.includes(e.id))}generateVariableMap(e){var t=e.reduce((e,t)=>{for(var n=t.keyPath||[],o=n[1],r=1;e[o]||["BOT_USER_INPUT"].includes(o);)o="".concat(n[1],"_").concat(r),r++;return(0,Y._)((0,X._)({},e),{[o]:t})},{});return this.encapsulateContext.isChatFlow?this.generateChatVariableMap(t):t}generateChatVariableMap(e){return e.USER_INPUT&&!e.CONVERSATION_NAME&&(e.USER_INPUT_1=e.USER_INPUT,delete e.USER_INPUT),e.CONVERSATION_NAME&&!e.USER_INPUT&&(e.CONVERSATION_NAME_1=e.CONVERSATION_NAME,delete e.CONVERSATION_NAME),e}flatNodeJSONs(e){for(var t=[],n=[...e];n.length>0;){var o=n.shift();o&&t.push(o),(null==o?void 0:o.blocks)&&n.push(...o.blocks)}return t}}(0,i.gn)([(0,w.f)(l.L4),(0,i.w6)("design:type",void 0===l.L4?Object:l.L4)],eu.prototype,"document",void 0),(0,i.gn)([(0,w.f)(eo.b),(0,i.w6)("design:type",void 0===eo.b?Object:eo.b)],eu.prototype,"variableService",void 0),(0,i.gn)([(0,w.f)(Z),(0,i.w6)("design:type",void 0===Z?Object:Z)],eu.prototype,"encapsulateContext",void 0),eu=(0,i.gn)([(0,u.b)()],eu);var ec=n("360903");class ev{getNodesMiddlePoint(e){if(0===e.length)throw Error("选中节点不能为空");var t=this.getNodesRect(e);return{x:t.x+t.width/2,y:t.y+t.height/2}}createDecapsulateNodes(e,t,n){var o=this;return(0,y._)(function*(){var{startNode:r,endNode:l,middleNodes:a}=o.groupNodes(t);if(!r||!l)throw Error("start or end node not found");var i=T(e),s=o.getNodesMiddlePoint(a),d={x:i.x-s.x,y:i.y-s.y},u=new Map;for(var c of a)yield o.createDecapsulateNode(c,d,u,n);return{idsMap:u,startNode:r,endNode:l,middleNodes:a}})()}createEncapsulateNode(e,t,n){var o=this;return(0,y._)(function*(){var r=o.getNodesMiddlePoint(n),l=C.ny.SubWorkflow,a=o.encapsulateGenerateService.generateSubWorkflowNode({spaceId:o.encapsulateContext.spaceId,workflowId:e,name:t,desc:t});return yield o.beforeCreate(l,a),yield o.workflowDocument.createWorkflowNodeByType(l,r,a,S(n))})()}createDecapsulateNode(e,t,n,o){var r=this;return(0,y._)(function*(){var l=r.getDecapsulateNodeJSON(e,t,n);return yield r.beforeCreate(l.type,l),yield r.workflowDocument.createWorkflowNode(l,!0,o||"root")})()}decapsulateLayout(e,t){var n=T(e),{width:o,height:r}=this.getNodesRect(t.filter(e=>![C.ny.Start,C.ny.End].includes(e.type))),a={ids:[],value:[],oldValue:[]};this.workflowDocument.getAllNodes().reduce((e,t)=>{var a=T(t);a.x>n.x&&(a.x+=o/2),a.y>n.y&&(a.y+=r/2),a.x<n.x&&(a.x-=o/2),a.y<n.y&&(a.y-=r/2);var i=t.getData(l.VO);return e.ids.push(t.id),e.value.push(a),e.oldValue.push({x:i.position.x,y:i.position.y}),e},a),this.historyService.pushOperation({type:l.Nj.dragNodes,value:a})}getDecapsulateNodeJSON(e,t,n){var o=this.workflowNodesService.createUniqID();n&&n.set(e.id,o),e.id=o;var r=(0,J.Z)(e,"data.nodeMeta.title")||e.type,l=this.workflowNodesService.createUniqTitle(r);return(0,Q.Z)(e,"data.nodeMeta.title",l),!e.meta&&(e.meta={}),e.meta.position=this.getDecapsulatePosition(e,t),e.blocks&&(e.blocks=e.blocks.map(e=>this.getDecapsulateNodeJSON(e,t,n))),e}getDecapsulatePosition(e,t){var n,o=(null===(n=e.meta)||void 0===n?void 0:n.position)||{x:0,y:0};return{x:o.x+t.x,y:o.y+t.y}}groupNodes(e){var t,n,o=[];return e.forEach(e=>{e.type===C.ny.Start?t=e:e.type===C.ny.End?n=e:o.push(e)}),{startNode:t,endNode:n,middleNodes:o}}getNodesRect(e){var t=Math.min(...e.map(e=>T(e).x)),n=Math.max(...e.map(e=>T(e).x)),o=Math.min(...e.map(e=>T(e).y)),r=Math.max(...e.map(e=>T(e).y));return{width:n-t,height:r-o,x:t,y:o}}getEncapsulateStartEndRects(e){var t=this.getBoundaryNodes(e);if(!t.left||!t.right)throw Error("boundaryNodes left or right node not found");return{start:this.getEncapsulateStartEndRect(C.ny.Start,t.left),end:this.getEncapsulateStartEndRect(C.ny.End,t.right)}}deleteNodes(e){return(0,y._)(function*(){e.forEach(e=>{e.dispose()}),yield(0,B.gw)(10)})()}beforeCreate(e,t){var n=this;return(0,y._)(function*(){if(!!e){var o,r=n.workflowDocument.getNodeRegister(e);yield null==r?void 0:null===(o=r.onInit)||void 0===o?void 0:o.call(r,t,n.playgroundContext)}})()}getEncapsulateStartEndRect(e,t){var n=this.workflowDocument.getAllNodes().find(t=>t.flowNodeType===e);if(!n)throw Error("getEncapsulateStartEndPoint node not found");var o=this.getNodeRect(n),r=this.getNodeRect(t),l=e===C.ny.Start?-60-o.width:60+r.width,a=(r.height-o.height)/2;return{x:r.x+l,y:r.y+a,width:o.width,height:o.height}}getNodeRect(e){var t=e.getData(l.VO);return{x:t.bounds.left,y:t.bounds.top,width:t.bounds.width,height:t.bounds.height}}getBoundaryNodes(e){var t={};return e.reduce((e,t)=>(!e.left&&(e.left=t),!e.right&&(e.right=t),T(t).x<T(e.left).x&&(e.left=t),T(t).x>T(e.right).x&&(e.right=t),e),t),t}}(0,i.gn)([(0,w.f)(l.L4),(0,i.w6)("design:type",void 0===l.L4?Object:l.L4)],ev.prototype,"workflowDocument",void 0),(0,i.gn)([(0,w.f)(ec.t),(0,i.w6)("design:type",void 0===ec.t?Object:ec.t)],ev.prototype,"workflowNodesService",void 0),(0,i.gn)([(0,w.f)(Z),(0,i.w6)("design:type",void 0===Z?Object:Z)],ev.prototype,"encapsulateContext",void 0),(0,i.gn)([(0,w.f)(N),(0,i.w6)("design:type",void 0===N?Object:N)],ev.prototype,"encapsulateGenerateService",void 0),(0,i.gn)([(0,w.f)(l.qp),(0,i.w6)("design:type",void 0===l.qp?Object:l.qp)],ev.prototype,"historyService",void 0),(0,i.gn)([(0,w.f)(l.xm),(0,i.w6)("design:type",void 0===l.xm?Object:l.xm)],ev.prototype,"playgroundContext",void 0),ev=(0,i.gn)([(0,u.b)()],ev);class ep{validate(){var{selectedNodes:e}=this.workflowSelectService;return this.encapsulateValidateService.validate(e)}canEncapsulate(){return this.encapsulateContext.enabled}encapsulate(){var e=this;return(0,y._)(function*(){if(!e.canEncapsulate())return e.encapsulateError("encapsulate is not enabled");if(e.encapsulating)return e.encapsulateError("encapsulating");var t,n="".concat(e.encapsulateContext.flowName||"","_sub_").concat(W()),{selectedNodes:o}=e.workflowSelectService;if(o.length<2)return e.encapsulateError("at least 2 nodes");j.E7u.event({eventName:"workflow_encapsulate"}),e.encapsulating=!0;try{(t=yield e.encapsulateNodes(n,o)).success&&e.workflowSelectService.selectNode(t.subFlowNode),e.onEncapsulateEmitter.fire(t)}finally{e.encapsulating=!1}return t})()}canDecapsulate(e){return this.encapsulateContext.enabled&&e.flowNodeType===j.nyy.SubWorkflow}decapsulate(e){var t=this;return(0,y._)(function*(){if(!!e&&!!t.canDecapsulate(e)&&!t.decapsulating){j.E7u.event({eventName:"workflow_decapsulate"}),t.decapsulating=!0;try{yield t.decapsulateNode(e)}finally{t.decapsulating=!1}}})()}decapsulateNode(e){var t=this;return(0,y._)(function*(){var n,o=function(e){var t=e.getData(l.Ps),n=null==t?void 0:t.formModel.getFormItemValueByPath("/inputs");if(!!n)return{spaceId:n.spaceId,workflowId:n.workflowId,workflowVersion:n.workflowVersion}}(e);if(!o)return;var r=yield t.encapsulateApiService.getWorkflow(o.spaceId&&"0"!==o.spaceId?o.spaceId:t.encapsulateContext.spaceId,o.workflowId,o.workflowVersion);if(!!r&&!(r.nodes.length<=2)){if(z(e)&&U(t.workflowDocument,r.nodes)){V.FN.warning(R.o.t("workflow_encapsulate_toast_batch_or_loop",void 0,"在循环/批处理中解散的工作流不能包含循环或批处理节点"));return}t.historyService.startTransaction(),t.encapsulateNodesService.decapsulateLayout(e,r.nodes);var{idsMap:a,startNode:i,endNode:s,middleNodes:d}=yield t.encapsulateNodesService.createDecapsulateNodes(e,r.nodes,null===(n=e.parent)||void 0===n?void 0:n.id);t.encapsulateVariableService.updateVarsAfterDecapsulate(e,{idsMap:a,startNode:i,endNode:s,middleNodes:d}),t.encapsulateLinesService.createDecapsulateLines({node:e,workflowJSON:r,startNodeId:i.id,endNodeId:s.id,idsMap:a}),yield(0,B.gw)(30),yield t.encapsulateNodesService.deleteNodes([e]),t.historyService.endTransaction()}})()}dispose(){this.onEncapsulateEmitter.dispose()}encapsulateNodes(e,t){var n=this;return(0,y._)(function*(){var o,r=n.encapsulateLinesService.getValidEncapsulateConnectPorts(t),l=n.encapsulateVariableService.getEncapsulateVars(t),a=n.encapsulateNodesService.getEncapsulateStartEndRects(t),i=yield n.encapsulateGenerateService.generateWorkflowJSON(t,{startEndRects:a}),s=D.wz8.Workflow;n.encapsulateContext.isChatFlow&&l.startVars.USER_INPUT&&l.startVars.CONVERSATION_NAME&&(s=D.wz8.ChatFlow);try{var d=yield n.encapsulateApiService.encapsulateWorkflow({name:e,desc:e,json:i,flowMode:s});o=null==d?void 0:d.workflowId}catch(e){return B.kg.error(e),n.encapsulateError("encapsulate workflow failed")}if(!o)return n.encapsulateError("encapsulate workflow failed no workflowId returned");n.historyService.startTransaction();var u=yield n.encapsulateNodesService.createEncapsulateNode(o,e,t);n.encapsulateVariableService.updateVarsAfterEncapsulate(u,t,l),yield n.encapsulateNodesService.deleteNodes(t);var{inputLines:c,outputLines:v}=n.encapsulateLinesService.createEncapsulateLines(r,u);return yield(0,B.gw)(30),n.historyService.endTransaction(),{success:!0,subFlowNode:u,inputLines:c,outputLines:v,workflowId:o,projectId:n.encapsulateContext.projectId}})()}encapsulateError(e){return{success:!1,message:e}}constructor(){this.onEncapsulateEmitter=new B.Q5,this.onEncapsulate=this.onEncapsulateEmitter.event,this.encapsulating=!1,this.decapsulating=!1}}(0,i.gn)([(0,w.f)(x),(0,i.w6)("design:type",void 0===x?Object:x)],ep.prototype,"encapsulateValidateService",void 0),(0,i.gn)([(0,w.f)(N),(0,i.w6)("design:type",void 0===N?Object:N)],ep.prototype,"encapsulateGenerateService",void 0),(0,i.gn)([(0,w.f)(l.oJ),(0,i.w6)("design:type",void 0===l.oJ?Object:l.oJ)],ep.prototype,"workflowSelectService",void 0),(0,i.gn)([(0,w.f)(ev),(0,i.w6)("design:type",void 0===ev?Object:ev)],ep.prototype,"encapsulateNodesService",void 0),(0,i.gn)([(0,w.f)(H),(0,i.w6)("design:type",void 0===H?Object:H)],ep.prototype,"encapsulateApiService",void 0),(0,i.gn)([(0,w.f)(Z),(0,i.w6)("design:type",void 0===Z?Object:Z)],ep.prototype,"encapsulateContext",void 0),(0,i.gn)([(0,w.f)(F),(0,i.w6)("design:type",void 0===F?Object:F)],ep.prototype,"encapsulateLinesService",void 0),(0,i.gn)([(0,w.f)(eu),(0,i.w6)("design:type",void 0===eu?Object:eu)],ep.prototype,"encapsulateVariableService",void 0),(0,i.gn)([(0,w.f)(l.qp),(0,i.w6)("design:type",void 0===l.qp?Object:l.qp)],ep.prototype,"historyService",void 0),(0,i.gn)([(0,w.f)(l.L4),(0,i.w6)("design:type",void 0===l.L4?Object:l.L4)],ep.prototype,"workflowDocument",void 0),ep=(0,i.gn)([(0,u.b)()],ep);var ef=Symbol("EncapsulateService"),em=Symbol("EncapsulateManager");class eh{init(){this.toDispose.pushAll([])}dispose(){this.toDispose.dispose()}constructor(){this.toDispose=new B.K4}}eh=(0,i.gn)([(0,u.b)()],eh);class eg{generateWorkflowJSON(e,t){var n=this;return(0,y._)(function*(){var o,r,l=n.encapsulateLinesService.getValidEncapsulateConnectPorts(e),a=yield n.workflowDocument.toJSON(),i=e.map(e=>e.id),s=n.defaultJSON(),d=s.nodes.find(e=>e.type===C.ny.Start),u=s.nodes.find(e=>e.type===C.ny.End);if(!d||!u)throw Error("start or end node not found");var c=S(e),v=("root"===c?a.nodes:(null===(o=n.findSubCanvasNodeJSON(a.nodes,c))||void 0===o?void 0:o.blocks)||[]).filter(e=>i.includes(e.id)),p=("root"===c?a.edges:(null===(r=n.findSubCanvasNodeJSON(a.nodes,c))||void 0===r?void 0:r.edges)||[]).filter(e=>i.includes(e.sourceNodeID)&&i.includes(e.targetNodeID)),{startEdges:f,endEdges:m}=n.generateStartEndEdges(d,u,l);(null==t?void 0:t.startEndRects)&&(E(d,t.startEndRects.start),E(u,t.startEndRects.end));var h={nodes:[...s.nodes,...v],edges:[...s.edges,...p,...f,...m]},g=n.encapsulateVariableService.getEncapsulateVars(e);return h=n.encapsulateVariableService.updateVarsInEncapsulateJSON(h,g)})()}generateStartEndEdges(e,t,n){var o=(0,k.Z)(n.inputLines.map(t=>{var n=t.toJSON();return n.sourceNodeID=e.id,delete n.sourcePortID,n}),this.getCompareEdgeId);return{startEdges:o,endEdges:(0,k.Z)(n.outputLines.map(e=>{var n=e.toJSON();return n.targetNodeID=t.id,delete n.targetPortID,n}),this.getCompareEdgeId)}}getCompareEdgeId(e){return"".concat(e.sourceNodeID||"",":").concat(e.sourcePortID||"","-").concat(e.targetNodeID||"",":").concat(e.targetPortID||"")}defaultJSON(){return{nodes:[this.generateStartNode(),this.generateEndNode()],edges:[],versions:{loop:"v2"}}}generateStartNode(){return{id:"100001",type:C.ny.Start,meta:{position:{x:0,y:0}},data:{nodeMeta:this.getTemplateNodeMeta(C.ny.Start),outputs:[]}}}generateEndNode(){return{id:"900001",type:C.ny.End,meta:{position:{x:1e3,y:0}},data:{nodeMeta:this.getTemplateNodeMeta(C.ny.End),inputs:{terminatePlan:"returnVariables",inputParameters:[]}}}}getTemplateNodeMeta(e){var t=this.encapsulateContext.getNodeTemplate(e);return t?{title:t.title,subTitle:t.subTitle,description:t.description,icon:t.icon}:{}}findSubCanvasNodeJSON(e,t){var n=this.findSubCanvasSourceNode(t);return e.find(e=>e.id===(null==n?void 0:n.id))}findSubCanvasSourceNode(e){return this.workflowDocument.getAllNodes().find(t=>{var n,o,r,l=t.getNodeRegistry(),a=null==l?void 0:null===(n=l.meta)||void 0===n?void 0:n.subCanvas;return(null==a?void 0:null===(r=a(t))||void 0===r?void 0:null===(o=r.canvasNode)||void 0===o?void 0:o.id)===e})}constructor(){this.generateSubWorkflowNode=e=>{var{name:t,desc:n,workflowId:o,spaceId:r}=e;return{data:{nodeMeta:{title:t,description:n,icon:this.getTemplateNodeMeta(C.ny.SubWorkflow).icon,isImageflow:!1},inputs:{workflowId:o,spaceId:r,workflowVersion:this.encapsulateContext.projectId?"":"v0.0.1"}}}}}}(0,i.gn)([(0,w.f)(F),(0,i.w6)("design:type",void 0===F?Object:F)],eg.prototype,"encapsulateLinesService",void 0),(0,i.gn)([(0,w.f)(eu),(0,i.w6)("design:type",void 0===eu?Object:eu)],eg.prototype,"encapsulateVariableService",void 0),(0,i.gn)([(0,w.f)(l.L4),(0,i.w6)("design:type",void 0===l.L4?Object:l.L4)],eg.prototype,"workflowDocument",void 0),(0,i.gn)([(0,w.f)(Z),(0,i.w6)("design:type",void 0===Z?Object:Z)],eg.prototype,"encapsulateContext",void 0),eg=(0,i.gn)([(0,u.b)()],eg);class ex{validate(e){var t=this;return(0,y._)(function*(){var n=t.encapsulateValidateResultFactory();for(var o of(t.validateNodes(e,n),e))yield t.validateNode(o,n);if(n.hasError())return n;var r=yield t.encapsulateGenerateService.generateWorkflowJSON(b(e));return yield t.validateWorkflowJSON(r,n),n})()}validateWorkflowJSON(e,t){var n=this;return(0,y._)(function*(){var o=n.encapsulateValidateManager.getWorkflowJSONValidators();yield Promise.all(o.map(n=>n.validate(e,t)))})()}validateNodes(e,t){for(var n of this.encapsulateValidateManager.getNodesValidators())n.validate(n.includeStartEnd?e:b(e),t)}validateNode(e,t){var n=this;return(0,y._)(function*(){for(var o of n.encapsulateValidateManager.getNodeValidatorsByType(e.flowNodeType))yield o.validate(e,t)})()}}(0,i.gn)([(0,w.f)(g),(0,i.w6)("design:type",void 0===g?Object:g)],ex.prototype,"encapsulateValidateManager",void 0),(0,i.gn)([(0,w.f)(p),(0,i.w6)("design:type",void 0===p?Object:p)],ex.prototype,"encapsulateValidateResultFactory",void 0),(0,i.gn)([(0,w.f)(N),(0,i.w6)("design:type",void 0===N?Object:N)],ex.prototype,"encapsulateGenerateService",void 0),ex=(0,i.gn)([(0,u.b)()],ex);class e_{addError(e){!this.errors.has(e.code)&&this.errors.set(e.code,[]);var t=this.errors.get(e.code);t&&!t.some(t=>t.source===e.source)&&t.push(e)}getErrors(){return[...this.errors.values()].flat()}hasError(){return this.errors.size>0}hasErrorCode(e){return this.errors.has(e)}constructor(){this.errors=new Map}}e_=(0,i.gn)([(0,u.b)()],e_);var ey=new a.n(e=>{e(ef).to(ep).inSingletonScope(),e(em).to(eh).inSingletonScope(),e(ev).toSelf().inSingletonScope(),e(F).toSelf().inSingletonScope(),e(eu).toSelf().inSingletonScope(),e(x).to(ex).inSingletonScope(),e(g).to(_).inSingletonScope(),e(v).to(e_).inTransientScope(),e(p).toFactory(e=>()=>e.container.get(v)),e(N).to(eg).inSingletonScope(),e(H).to(K).inSingletonScope(),e(Z).toSelf().inSingletonScope()});class ew{getLineName(e,t){return"".concat(this.getNodeNameById(e)," -> ").concat(this.getNodeNameById(t))}getLineSource(e,t){return"".concat(e,"_").concat(t)}getNodeName(e){return e?O(e)?this.getSubCanvasName(e):new j.m_1(e).title||this.defaultNodeName(e.id):void 0}getSubCanvasName(e){var t,n,o=e.getNodeMeta(),{title:r=""}=null!==(n=null==o?void 0:null===(t=o.renderSubCanvas)||void 0===t?void 0:t.call(o))&&void 0!==n?n:{};return r||this.defaultNodeName(e.id)}getSubCanvasIcon(e){var t=A(e);return this.getNodeIcon(t)}getNodeIcon(e){return e?O(e)?this.getSubCanvasIcon(e):new j.m_1(e).icon:void 0}getNodeNameById(e){var t=this.workflowDocument.getNode(e);return t?this.getNodeName(t):this.defaultNodeName(e)}defaultNodeName(e){return"Node".concat(e)}}(0,i.gn)([(0,w.f)(l.L4),(0,i.w6)("design:type",void 0===l.L4?Object:l.L4)],ew.prototype,"workflowDocument",void 0),ew=(0,i.gn)([(0,u.b)()],ew);class ej extends ew{validate(e,t){e.filter(e=>O(e)).forEach(n=>{var o=A(n);if(!!o){var r=this.getNodeName(n),l=this.getNodeIcon(n);!e.includes(o)&&t.addError({code:c.INVALID_SUB_CANVAS,message:R.o.t("workflow_encapsulate_button_unable_loop_or_batch"),source:n.id,sourceName:r,sourceIcon:l})}})}}ej=(0,i.gn)([(0,u.b)()],ej);class eb{validate(e,t){e.filter(e=>[C.ny.Start,C.ny.End].includes(e.flowNodeType)).length&&t.addError({code:c.NO_START_END,message:R.o.t("workflow_encapsulate_button_unable_start_or_end",void 0,"框选范围内包含开始/结束")})}constructor(){this.includeStartEnd=!0}}eb=(0,i.gn)([(0,u.b)()],eb);class eN{validate(e,t){e.filter(e=>[C.ny.Break,C.ny.Continue].includes(e.flowNodeType)).length&&t.addError({code:c.INVALID_LOOP_NODES,message:R.o.t("workflow_encapsulate_button_unable_continue_or_teiminate",void 0,"框选范围内包含继续循环/终止循环")})}}eN=(0,i.gn)([(0,u.b)()],eN);class ek extends ew{validate(e,t){var n=this;return(0,y._)(function*(){var o=yield n.encapsulateApiService.validateWorkflow(e);if(!!(null==o?void 0:o.length))(o||[]).forEach(e=>{var o,r,l=(null===(o=e.node_error)||void 0===o?void 0:o.node_id)||(null===(r=e.path_error)||void 0===r?void 0:r.start)||"",a=n.workflowDocument.getNode(l),i=void 0,s=void 0,d=void 0;a&&(i=n.getNodeName(a),s=n.getNodeIcon(a),d=a.id),t.addError({code:c.INVALID_SCHEMA,message:e.message||"",source:d,sourceName:i,sourceIcon:s})})})()}}(0,i.gn)([(0,w.f)(H),(0,i.w6)("design:type",void 0===H?Object:H)],ek.prototype,"encapsulateApiService",void 0),ek=(0,i.gn)([(0,u.b)()],ek);class eC extends ew{validate(e,t){ed(e).forEach(e=>{if(![j.nyy.Comment,l.Sy.SUB_CANVAS].includes(e.flowNodeType)){if(e.getData(l.QW).allPorts.some(e=>0===e.lines.length)){var n=this.getNodeName(e),o=this.getNodeIcon(e);t.addError({code:c.INVALID_PORTS,message:R.o.t("workflow_encapsulate_button_unable_uncomplete",void 0,"封装不应该包含没有输入输出的节点"),source:e.id,sourceName:n,sourceIcon:o})}}})}}eC=(0,i.gn)([(0,u.b)()],eC);class eS{validate(e,t){var n=this.encapsulateLinesService.getEncapsulateNodesOutputLines(e);if(0!==n.length)!this.encapsulateLinesService.validateEncapsulateLines(n)&&t.addError({code:c.ENCAPSULATE_LINES,message:R.o.t("workflow_encapsulate_button_unable_connected",void 0,"框选范围内有中间节点连到框选范围外的节点")})}}(0,i.gn)([(0,w.f)(F),(0,i.w6)("design:type",void 0===F?Object:F)],eS.prototype,"encapsulateLinesService",void 0),eS=(0,i.gn)([(0,u.b)()],eS);class eI{validate(e,t){var n=this.encapsulateLinesService.getEncapsulateNodesInputLines(e);if(0!==n.length)!this.encapsulateLinesService.validateEncapsulateLines(n)&&t.addError({code:c.ENCAPSULATE_LINES,message:R.o.t("workflow_encapsulate_button_unable_connected",void 0,"框选范围内有中间节点连到框选范围外的节点")})}}(0,i.gn)([(0,w.f)(F),(0,i.w6)("design:type",void 0===F?Object:F)],eI.prototype,"encapsulateLinesService",void 0),eI=(0,i.gn)([(0,u.b)()],eI);var eT=n("220192");class eE extends ew{canHandle(e){return!0}validate(e,t){var n=this;return(0,y._)(function*(){if([j.nyy.Comment].includes(e.flowNodeType))return;var o=yield n.validationService.validateNode(e);if(!!o.hasError){var r=n.getNodeName(e),l=n.getNodeIcon(e);(o.nodeErrorMap[e.id]||[]).forEach(n=>{if(!!n.errorInfo&&"error"===n.errorLevel)t.addError({code:c.INVALID_FORM,message:n.errorInfo,source:e.id,sourceName:r,sourceIcon:l})})}})()}}(0,i.gn)([(0,w.f)(eT.RJ),(0,i.w6)("design:type",void 0===eT.RJ?Object:eT.RJ)],eE.prototype,"validationService",void 0),eE=(0,i.gn)([(0,u.b)()],eE);var eD=new a.n(e=>{(0,l.KV)(e,ek,[h]),[eC,eI,eS,eb,eN,ej].forEach(t=>{(0,l.KV)(e,t,[m])}),[eE].forEach(t=>{(0,l.KV)(e,t,[f])})}),eZ=n("942193");var eM=((r={}).ENCAPSULATE="ENCAPSULATE",r.DECAPSULATE="DECAPSULATE",r);class eP{get modalVisible(){return this.isModalVisible}get tooltipVisible(){return this.isTooltipVisible}get loading(){return this.isLoading}setLoading(e){this.isLoading=e,this.onLoadingChangeEmitter.fire(e)}openModal(){this.setModalVisible(!0)}closeModal(){this.setModalVisible(!1)}showTooltip(){this.setTooltipVisible(!0)}hideTooltip(){this.setTooltipVisible(!1)}setTooltipVisible(e){this.isTooltipVisible=e,this.onTooltipVisibleChangeEmitter.fire(e)}setModalVisible(e){this.isModalVisible=e,this.onModalVisibleChangeEmitter.fire(e)}constructor(){this.isModalVisible=!1,this.onModalVisibleChangeEmitter=new B.Q5,this.onModalVisibleChange=this.onModalVisibleChangeEmitter.event,this.isTooltipVisible=!1,this.onTooltipVisibleChangeEmitter=new B.Q5,this.onTooltipVisibleChange=this.onTooltipVisibleChangeEmitter.event,this.isLoading=!1,this.onLoadingChangeEmitter=new B.Q5,this.onLoadingChange=this.onLoadingChangeEmitter.event}}eP=(0,i.gn)([(0,u.b)()],eP);class eL{registerShortcuts(e){var t=this;e.addHandlers({commandId:eM.ENCAPSULATE,shortcuts:["meta g","ctrl g"],isEnabled:()=>!this.playgroundConfigEntity.readonly,execute:(0,y._)(function*(){if(!!t.encapsulateService.canEncapsulate()){if((yield t.encapsulateService.validate()).hasError()){t.encapsulateRenderService.showTooltip();return}t.encapsulateRenderService.setLoading(!0);try{yield t.encapsulateService.encapsulate(),t.encapsulateRenderService.closeModal()}catch(e){console.error(e)}t.encapsulateRenderService.setLoading(!1)}})},{commandId:eM.DECAPSULATE,shortcuts:["meta shift g","ctrl shift g"],isEnabled:()=>!this.playgroundConfigEntity.readonly,execute:()=>{var{selectedNodes:e}=this.workflowSelectService;if(1!==e.length)return;var t=e[0];if(!!this.encapsulateService.canDecapsulate(t))this.encapsulateService.decapsulate(t)}})}}(0,i.gn)([(0,w.f)(l.ER),(0,i.w6)("design:type",void 0===l.ER?Object:l.ER)],eL.prototype,"playgroundConfigEntity",void 0),(0,i.gn)([(0,w.f)(ef),(0,i.w6)("design:type",void 0===ef?Object:ef)],eL.prototype,"encapsulateService",void 0),(0,i.gn)([(0,w.f)(eP),(0,i.w6)("design:type",void 0===eP?Object:eP)],eL.prototype,"encapsulateRenderService",void 0),(0,i.gn)([(0,w.f)(l.oJ),(0,i.w6)("design:type",void 0===l.oJ?Object:l.oJ)],eL.prototype,"workflowSelectService",void 0),eL=(0,i.gn)([(0,u.b)()],eL);var ez=new a.n(e=>{(0,l.KV)(e,eL,[eZ.G]),e(eP).toSelf().inSingletonScope()}),eO=n("151064"),eA=n("455069"),eF=n("252237"),eR=n.n(eF);function eV(){var e=(0,l.G2)(l.oJ),[t,n]=(0,eA.useState)(e.selectedNodes);return(0,eA.useEffect)(()=>{var t=e.onSelectionChanged(()=>{n(e.selectedNodes)});return()=>{t.dispose()}}),{selectedNodes:t}}var eB=n("523830"),eG=e=>{var[t,n]=(0,eA.useState)(0);return(0,eA.useEffect)(()=>{var o=e.filter(e=>{var t,n;return null===(n=e.getData(l._J))||void 0===n?void 0:null===(t=n.public)||void 0===t?void 0:t.available}).map(e=>e.getData(l._J).public.available.onDataChange(()=>{n(t+1)}));return()=>{o.forEach(e=>null==e?void 0:e.dispose())}},[e,t]),{version:t}},eW=()=>{var e,t=(0,l.G2)(ef),n=(0,l.G2)(eP),[o,r]=(0,eA.useState)(n.loading);return(0,eA.useEffect)(()=>{var e=n.onLoadingChange(r);return()=>{e.dispose()}},[]),{handleEncapsulate:(e=(0,y._)(function*(){n.setLoading(!0);try{yield t.encapsulate(),n.closeModal()}catch(e){console.error(e)}n.setLoading(!1)}),function(){return e.apply(this,arguments)}),loading:o}},eU=n("44101"),eH=e=>{var t,{error:n}=e,o=(0,l.G2)(l.oJ),r=(0,l.Dc)();if(!(null==n?void 0:n.sourceName)&&!n.sourceIcon)return(0,eO.jsx)("div",{});var a=(t=(0,y._)(function*(e){var t=!1,n=r.entityManager.getEntityById(e);return n&&(yield o.selectNodeAndScrollToView(n,!0),t=!0),t}),function(e){return t.apply(this,arguments)});return(0,eO.jsxs)("div",{className:"flex items-center gap-1 cursor-pointer max-w-[120px]",onClick:()=>{n.source&&a(n.source)},children:[n.sourceIcon?(0,eO.jsx)("img",{width:18,height:18,src:n.sourceIcon,className:"w-4.5 h-4.5 rounded-[4px]"}):null,n.sourceName?(0,eO.jsx)(V.ZT.Paragraph,{className:eR()("font-medium coz-fg-primary",eU.Z["error-name"]),ellipsis:{rows:1,showTooltip:{type:"tooltip",opts:{style:{width:"100%",wordBreak:"break-word"}}}},children:n.sourceName}):null]})},eJ=e=>{var{error:t}=e;return(0,eO.jsx)("div",{className:"flex-1 coz-fg-primary font-normal",children:t.message})},eq=e=>{var{errors:t=[],onMouseEnter:n,onMouseLeave:o,children:r}=e,a=(0,l.G2)(eP),[i,s]=(0,eA.useState)(a.tooltipVisible);(0,eA.useEffect)(()=>{var e=a.onTooltipVisibleChange(s);return()=>{e.dispose()}},[]);var d=t.length,u=(0,eA.useMemo)(()=>(0,P.Z)(t.filter(e=>e.message),e=>(null==e?void 0:e.sourceName)||(null==e?void 0:e.sourceIcon)?"withSource":"withoutSource"),[t]);return(0,eO.jsx)(V.u,{trigger:"custom",position:"bottom",visible:i&&(null==t?void 0:t.length)>0,showArrow:!1,onClickOutSide:()=>{s(!1)},className:"p-0 max-w-[460px] overflow-hidden",content:d?(0,eO.jsxs)("div",{onMouseEnter:n,onMouseLeave:o,className:eU.Z.tooltip,children:[(0,eO.jsx)("div",{className:"coz-fg-plus font-medium text-[16px]",children:R.o.t("workflow_encapsulate_button_unable",void 0,"无法封装工作流")}),(u.withoutSource||[]).map((e,t)=>(0,eO.jsx)("div",{className:"flex mt-3 gap-4 items-start",children:(0,eO.jsx)(eJ,{error:e})},t)),(u.withSource||[]).length?(0,eO.jsx)("div",{className:eU.Z.errors,children:(u.withSource||[]).map(e=>(0,eO.jsxs)(eO.Fragment,{children:[(0,eO.jsx)(eH,{error:e}),(0,eO.jsx)(eJ,{error:e})]}))}):null]}):null,children:r})},eK=/(Macintosh|MacIntel|MacPPC|Mac68K|iPad)/.test(navigator.userAgent),eX=eK?"⌘":"Ctrl",eY={encapsulate:"".concat(eX," G"),decapsulate:"".concat(eX," ").concat(eK?"⇧":"Shift"," G")},eQ=n("132498");function e$(){var e=(0,l.G2)(eP),{handleEncapsulate:t,loading:n}=eW(),{validating:o,errors:r}=function(){var e,{selectedNodes:t}=eV(),n=(0,l.G2)(ef),[o,r]=(0,eA.useState)(!1),[a,i]=(0,eA.useState)([]),s=(0,eA.useRef)(0);var d=(e=(0,y._)(function*(){if(!(t.length<=1)){r(!0);var e=++s.current;try{var o=yield n.validate();e===s.current&&(i(o.getErrors()),r(!1))}catch(e){i([{code:c.VALIDATE_ERROR,message:e.message}]),r(!1)}}}),function(){return e.apply(this,arguments)}),{version:u}=eG(t);return(0,eB.Z)(()=>{d()},[t,u],{wait:100}),{validating:o,errors:a}}(),a=r&&r.length>0,i=!!(!r||a),s=(0,eA.useRef)(),d=(0,eA.useRef)(null),u=()=>{!s.current&&(s.current=window.setTimeout(()=>{e.hideTooltip(),s.current=void 0},200))},v=()=>{s.current&&(clearTimeout(s.current),s.current=void 0),e.showTooltip()};return(0,eO.jsx)(eq,{errors:r,onMouseEnter:v,onMouseLeave:u,children:(0,eO.jsx)("div",{className:"pointer-events-auto",onMouseEnter:v,onMouseLeave:u,ref:d,children:(0,eO.jsxs)(V.zx,{loading:n,disabled:i,className:eQ.Z.button,color:"highlight",onMouseDown:e=>{if(e.stopPropagation(),!o)t()},children:[(0,eO.jsx)("span",{children:R.o.t("workflow_encapsulate_button",void 0,"封装工作流")}),(0,eO.jsx)("span",{className:eQ.Z.shortcut,children:eY.encapsulate})]})})})}var e0=n("594975"),e1=()=>{var{selectedNodes:e}=eV(),{length:t}=e||[],[n,o]=(0,eA.useState)(!1),r=(0,l.G2)(ef),a=(0,l.G2)(eP);return(0,eA.useEffect)(()=>{var e=r.canEncapsulate()&&t>1;!e&&a.hideTooltip(),o(e)},[t]),(0,eO.jsx)("div",{className:eR()(e0.Z["encapsulate-panel"],{[e0.Z["encapsulate-panel-show"]]:n}),children:(0,eO.jsxs)("div",{className:e0.Z["encapsulate-panel-content"],children:[R.o.t("workflow_encapsulate_selecet",{length:t},"已选中 ".concat(t," 个节点"))," ",(0,eO.jsx)(e$,{})]})})},e2=(0,l.M1)({onInit(e,t){e.get(em).init(),e.get(Z).setPluginContext(e),t.getNodeTemplate&&e.get(Z).setGetNodeTemplate(t.getNodeTemplate),t.getGlobalState&&e.get(Z).setGetGlobalState(t.getGlobalState),t.onEncapsulate&&e.get(ef).onEncapsulate(n=>{var o;null==t||null===(o=t.onEncapsulate)||void 0===o||o.call(t,n,e)})},onDispose(e){e.get(g).dispose(),e.get(ef).dispose(),e.get(em).dispose()},containerModules:[ey,ez,eD]})},356873:function(e,t,n){n.d(t,{h:()=>c});var o=n("686436"),r=n("130001"),l=n("100015"),a=n("771531"),i=n("435946"),s=n("816697"),d=n("450562");class u{init(){this.toDispose.pushAll([this.operationService.onApply(e=>{if(!!e.type){try{if(!this.shouldReport(e))return;var t=this.getMessageByOperation(e);d.E7u.info({message:t})}catch(e){d.E7u.error({error:e,message:"workflow operation report error"})}this.lastOperation=e}})])}dispose(){this.toDispose.dispose()}getMessageByOperation(e){var{type:t,value:n}=e,r=this.getEventName(t);if(t===o.Nj.addLine||t===o.Nj.deleteLine){var{from:l,to:a="",fromPort:i="",toPort:s=""}=n;return"".concat(r," from ").concat(l).concat(this.portToString(i)," to ").concat(a).concat(this.portToString(s))}if(t===o.Nj.addNode||t===o.Nj.deleteNode){var{node:{id:d}}=n;return"".concat(r," ").concat(d)}if(this.isChangeDataType(t)){var{id:u,path:c}=n;return"".concat(r," node:").concat(u," path:").concat(c)}return r}getEventName(e){return"workflow_".concat((0,l.Z)(e))}isChangeDataType(e){return e===o.Nj.changeNodeData||"changeFormValues"===e}shouldReport(e){var{value:t,type:n}=e;if(this.isChangeDataType(n)&&this.lastOperation&&n===this.lastOperation.type){var{path:o,id:r}=t,{path:l,id:a}=this.lastOperation.value;if(o===l&&r===a)return!1}return!0}portToString(e){return e?":".concat(e):""}constructor(){this.toDispose=new s.K4,this.lastOperation=null}}(0,r.gn)([(0,a.f)(s.f9),(0,r.w6)("design:type",void 0===s.f9?Object:s.f9)],u.prototype,"operationService",void 0),u=(0,r.gn)([(0,i.b)()],u);var c=(0,o.M1)({onBind:e=>{var{bind:t}=e;t(u).toSelf().inSingletonScope()},onInit(e){e.get(u).init()},onDispose(e){e.get(u).dispose()}})},943194:function(e,t,n){n.d(t,{O:function(){return l}});var o=n(130001),r=n(435946);class l{constructor(){this.disabled=!1}}l=(0,o.gn)([(0,r.b)()],l)},163572:function(e,t,n){n.d(t,{P:()=>_});var o=n("702570"),r=n("686436"),l=n("816697"),a=n("942193"),i=n("130001"),s=n("771531"),d=n("435946"),u=n("450562"),c=n("943194");class v{registerShortcuts(e){e.addHandlers({commandId:r.uB.UNDO,shortcuts:["meta z","ctrl z"],isEnabled:()=>!this._playgroundConfig.readonly,execute:()=>{if(!this._config.disabled)this._historyService.undo(),u.E7u.info({message:"workflow_undo"})}},{commandId:r.uB.REDO,shortcuts:["meta shift z","ctrl shift z"],isEnabled:()=>!this._playgroundConfig.readonly,execute:()=>{if(!this._config.disabled)this._historyService.redo(),u.E7u.info({message:"workflow_redo"})}})}}(0,i.gn)([(0,s.f)(l.qp),(0,i.w6)("design:type",void 0===l.qp?Object:l.qp)],v.prototype,"_historyService",void 0),(0,i.gn)([(0,s.f)(c.O),(0,i.w6)("design:type",void 0===c.O?Object:c.O)],v.prototype,"_config",void 0),(0,i.gn)([(0,s.f)(r.ER),(0,i.w6)("design:type",void 0===r.ER?Object:r.ER)],v.prototype,"_playgroundConfig",void 0),v=(0,i.gn)([(0,d.b)()],v);var p=n("808549"),f=n("120454"),m=n("335740"),h=(e,t,n)=>!!(t&&Date.now()-n.getTimestamp()<500),g=[{type:r.Nj.addNode,inverse:e=>(0,f._)((0,p._)({},e),{type:r.Nj.deleteNode}),apply:(e,t)=>{t.get(r.L4).createWorkflowNode((0,m.Z)(e.value.node),!0,e.value.parentID)},shouldMerge:h},{type:r.Nj.addLine,inverse:e=>(0,f._)((0,p._)({},e),{type:r.Nj.deleteLine}),apply:(e,t)=>{var n=t.get(r.dm),o=t.get(r.L4);if(!!e.value.to&&!!o.getNode(e.value.to))n.createLine((0,f._)((0,p._)({},e.value),{key:e.value.id}))},shouldMerge:h}];class x{registerOperationMeta(e){g.forEach(t=>{e.registerOperationMeta(t)})}}x=(0,i.gn)([(0,d.b)()],x);var _=new o.n(e=>{(0,l.KV)(e,v,[a.G]),(0,l.KV)(e,x,[r.FU]),e(c.O).toSelf().inSingletonScope()})},736892:function(e,t,n){n.d(t,{Dj:function(){return r},E4:function(){return g},F1:function(){return f},G0:function(){return s},R2:function(){return y},Sk:function(){return p},XE:function(){return v},b2:function(){return i},bQ:function(){return c},bZ:function(){return h},bd:function(){return _},cH:function(){return l},fs:function(){return d},gu:function(){return w},je:function(){return a},p1:function(){return x},pd:function(){return u},yp:function(){return m}});var o=n(336205),r=0x65b0ae82,l=/^(?!.*\b(true|false|and|AND|or|OR|not|NOT|null|nil|If|Switch)\b)[a-zA-Z_][a-zA-Z_$0-9]*$/,a="/nodeMeta",i="/inputs/batch",s="/outputs",d=1,u=10,c=1,v=200,p=10,f=100,m={MINIMAL:"top_speed",STANDARD:"all"},h=10,g=50,x={lineBreak:"\n",tab:"	",period:"。",comma:"，",semicolon:"；",space:" "},_=[{label:o.o.t("workflow_stringprocess_concat_symbol_lineBreak"),value:x.lineBreak,isDefault:!0},{label:o.o.t("workflow_stringprocess_concat_symbol_tab"),value:x.tab,isDefault:!0},{label:o.o.t("workflow_stringprocess_concat_symbol_period"),value:x.period,isDefault:!0},{label:o.o.t("workflow_stringprocess_concat_symbol_comma"),value:x.comma,isDefault:!0},{label:o.o.t("workflow_stringprocess_concat_symbol_semicolon"),value:x.semicolon,isDefault:!0},{label:o.o.t("workflow_stringprocess_concat_symbol_space"),value:x.space,isDefault:!0}],y="role_information",w={width:360,height:104.7}},246200:function(e,t,n){n.d(t,{n:function(){return r}});var o,r=((o={})[o.Plugin=1]="Plugin",o[o.Workflow=4]="Workflow",o[o.Dataset=3]="Dataset",o)},886829:function(e,t,n){n.d(t,{m:function(){return l}});var o=n(808549),r=n(686436);class l extends r.RD{init(){this.hasSetNodeData=!1,this.nodeData=void 0}getDefaultData(){}setNodeData(e){if(this.hasSetNodeData){console.warn("node ".concat(this.entity.id," has already set WorkflowNodeData"));return}this.nodeData=(0,o._)({},e),this.hasSetNodeData=!0}updateNodeData(e){this.nodeData=(0,o._)({},this.nodeData,e)}getNodeData(){return this.nodeData}constructor(...e){super(...e),this.hasSetNodeData=!1}}},360903:function(e,t,n){n.d(t,{t:function(){return u}});var o=n(130001),r=n(801815),l=n(771531),a=n(435946),i=n(686436),s=n(816697),d=n(736892);class u{getNodeTitle(e){var t=e.getData(i.Ps).formModel.getFormItemValueByPath(d.je);return(null==t?void 0:t.title)||""}getAllNodes(e){return this.entityManager.getEntities(i.CT).filter(t=>"root"!==t.id&&t!==e)}getAllTitles(e){return this.getAllNodes(e).map(e=>this.getNodeTitle(e))}getStartNode(){return this.entityManager.getEntities(i.CT).find(e=>e.isStart)}fireNodesTitleChange(){this.onNodesTitleChangeEmitter.fire()}createUniqTitle(e,t,n){var o=this.getAllTitles(t);n&&o.push(...n);var r=new Set(o),l=0,a="".concat(e),i=e.match(/_([0-9]+)$/);for(i&&(l=Number(i[1]),e=e.slice(0,i.index));r.has(a);)l+=1,a="".concat(e,"_").concat(l);return a}createUniqID(){var e;do e="1".concat(this.nanoid());while(this.entityManager.getEntityById(e));return e}constructor(){this.onNodesTitleChangeEmitter=new s.Q5,this.nanoid=(0,r.kP)("1234567890",5),this.onNodesTitleChange=this.onNodesTitleChangeEmitter.event}}(0,o.gn)([(0,l.f)(i.v2),(0,o.w6)("design:type",void 0===i.v2?Object:i.v2)],u.prototype,"entityManager",void 0),u=(0,o.gn)([(0,a.b)()],u)},364498:function(e,t,n){n.d(t,{AD:function(){return u},HK:function(){return d},Ki:function(){return r},Wh:function(){return a},Xg:function(){return s},b0:function(){return v},km:function(){return c},le:function(){return i},n5:function(){return p}});var o=n(450562),r=[o.nyy.Code,o.nyy.LLM,o.nyy.Api,o.nyy.Database,o.nyy.ImageGenerate,o.nyy.DatabaseCreate,o.nyy.DatabaseUpdate,o.nyy.DatabaseQuery,o.nyy.DatabaseDelete,o.nyy.ImageCanvas,o.nyy.Intent],l=[o.nyy.Http],a=[o.nyy.Intent],i=[...l,...r],s="branch_error",d=100,u={default:6e4,max:6e4},c={[o.nyy.LLM]:{timeout:{default:18e4,max:6e5,init:6e5},enableBackupModel:!0},[o.nyy.Api]:{timeout:{default:18e4,max:18e4}}},v="errorBody",p="isSuccess"},422133:function(e,t,n){n.d(t,{Yf:function(){return _},kI:function(){return x}});var o=n(808549),r=n(4450),l=n(830873),a=n(210602),i=n(385647),s=n(564803),d=e=>{if(!e)return e;var t=null==e?void 0:e.backupLLmParam;return{backupLLmParam:t?JSON.parse(t):void 0}},u=e=>(null==e?void 0:e.processType)||((null==e?void 0:e.switch)?s.A.RETURN:s.A.BREAK),c=(e,t,n)=>{if(!f(t))return{};var o,r=null==e?void 0:e.timeoutMs,l=(0,a.M)(null==t?void 0:t.node);return!r&&(r=n&&(null==l?void 0:l.init)?l.init:null==l?void 0:l.default),{processType:u(e),timeoutMs:r,retryTimes:null!==(o=null==e?void 0:e.retryTimes)&&void 0!==o?o:0,ext:d(null==e?void 0:e.ext)}},v=(e,t)=>{if(!e)return e;var n=(null==t?void 0:t.models)||[],o=e.backupLLmParam,l=n.find(e=>e.model_type===(null==o?void 0:o.modelType));return{backupLLmParam:o?JSON.stringify((0,r.PB)(o,l)):void 0}},p=(e,t)=>{var n=null==t?void 0:t.playgroundContext,o={processType:(null==e?void 0:e.processType)||((null==e?void 0:e.settingOnErrorIsOpen)?s.A.RETURN:void 0),timeoutMs:null==e?void 0:e.timeoutMs,retryTimes:null==e?void 0:e.retryTimes};return(null==e?void 0:e.retryTimes)&&(o.ext=v(null==e?void 0:e.ext,n)),o},f=e=>{var t;return(0,i.Hz)(null==e?void 0:null===(t=e.node)||void 0===t?void 0:t.flowNodeType)},m=(e,t,n)=>(0,o._)({settingOnErrorIsOpen:null==e?void 0:e.switch,settingOnErrorJSON:null==e?void 0:e.dataOnErr},c(e,t,n)),h=(e,t)=>e?(0,o._)({switch:null==e?void 0:e.settingOnErrorIsOpen,dataOnErr:null==e?void 0:e.settingOnErrorJSON},f(t)?p(e,t):{}):e,g=(e,t)=>{var n,o,r,a,s=null==e?void 0:e.outputs,d=f(t),u=!!(null==e?void 0:null===(o=e.inputs)||void 0===o?void 0:null===(n=o.settingOnError)||void 0===n?void 0:n.switch);if(!!s&&!!i.Hz&&!!u){var c=!!(null==e?void 0:null===(a=e.inputs)||void 0===a?void 0:null===(r=a.batch)||void 0===r?void 0:r.batchEnable);return(0,l.Rb)({value:s,isBatch:c,isOpen:u,isSettingOnErrorV2:d})}},x=(e,t)=>{var n,r=g(e,t);return(0,o._)({settingOnError:m(null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.settingOnError,t,e)},r?{outputs:r}:{})},_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=null==e?void 0:e.settingOnError;return(null==e?void 0:e.settingOnError)&&delete e.settingOnError,{settingOnError:h(n,t)}}},455543:function(e,t,n){n.d(t,{Od:function(){return l},im:function(){return a}});var o=n(686436),r=n(385647),l=()=>{var e=(0,o.PF)();return(0,r.Hz)(e.flowNodeType)},a=()=>{var e=(0,o.PF)();return(0,r.lt)(e.flowNodeType)}},564803:function(e,t,n){n.d(t,{A:function(){return r}});var o,r=((o={})[o.BREAK=1]="BREAK",o[o.RETURN=2]="RETURN",o[o.EXCEPTION=3]="EXCEPTION",o)},385647:function(e,t,n){n.d(t,{Hz:function(){return r},QY:function(){return a},lt:function(){return l}});var o=n(364498),r=e=>e&&o.Ki.includes(e),l=e=>e&&o.le.includes(e),a=e=>e&&o.Wh.includes(e)},718830:function(e,t,n){n.d(t,{A:function(){return i},b:function(){return a}});var o=n(801815),r=n(450562),l=n(364498),a=()=>({key:(0,o.x0)(),name:l.b0,type:r.owu.Object,readonly:!0,children:[{key:(0,o.x0)(),name:"errorMessage",type:r.owu.String,readonly:!0},{key:(0,o.x0)(),name:"errorCode",type:r.owu.String,readonly:!0}]}),i=()=>({key:(0,o.x0)(),name:l.n5,type:r.owu.Boolean,readonly:!0})},210602:function(e,t,n){n.d(t,{M:function(){return u}});var o=n(808549),r=n(120454),l=n(962289),a=n(450562),i=n(364498),s=n(886829),d=e=>{if(!e)return!1;var t=e.getData(s.m),n=null==t?void 0:t.getNodeData();return!!((null==e?void 0:e.flowNodeType)===a.nyy.Api&&(0,l.Z)(n,"pluginType")===a.zV6.LOCAL)},u=e=>{var t,n=i.AD;return(null==e?void 0:e.flowNodeType)&&(null===(t=i.km[e.flowNodeType])||void 0===t?void 0:t.timeout)&&(n=i.km[e.flowNodeType].timeout),(0,r._)((0,o._)({},n),{min:i.HK,disabled:d(e)})}},830873:function(e,t,n){n.d(t,{Eb:function(){return c},K2:function(){return v},Rb:function(){return u}});var o=n(808549),r=n(120454),l=n(364498),a=n(718830),i=e=>[l.b0,...e?[l.n5]:[]],s=e=>t=>!i(e).includes(t.name),d=e=>t=>i(e).includes(t.name),u=e=>{var{value:t,isBatch:n,isOpen:l,isSettingOnErrorV2:i}=e;if(!t)return t;if(l)return n?[(0,r._)((0,o._)({},t[0]),{children:[...(null!==(u=null===(d=t[0])||void 0===d?void 0:d.children)&&void 0!==u?u:[]).filter(s(i)),(0,a.b)(),...i?[(0,a.A)()]:[]]})]:[...(null!=t?t:[]).filter(s(i)),(0,a.b)(),...i?[(0,a.A)()]:[]];if(!n)return[...(null!=t?t:[]).filter(s(i))];var d,u,c,[v,...p]=t;return[(0,r._)((0,o._)({},v),{children:[...(null!==(c=null==v?void 0:v.children)&&void 0!==c?c:[]).filter(s(i))]}),...p]},c=e=>{var{value:t,isBatch:n,isSettingOnErrorV2:l}=e;if(!t)return t;if(n){var a,i,[u,...c]=t;return[(0,r._)((0,o._)({},u),{children:[...(null!==(a=null==u?void 0:u.children)&&void 0!==a?a:[]).filter(s(l)),...(null!==(i=null==u?void 0:u.children)&&void 0!==i?i:[]).filter(d(l))]}),...c]}return[...t.filter(s(l)),...t.filter(d(l))]},v=e=>{var{value:t,isBatch:n,isSettingOnErrorV2:o}=e;return u({value:t,isBatch:n,isOpen:!1,isSettingOnErrorV2:o})}},438111:function(e,t,n){n.d(t,{T:function(){return s},e:function(){return i}}),(o=i||(i={})).TabName="tab",(r=o.Tab||(o.Tab={})).Basic="basic",r.Trigger="trigger",o.TriggerFormName="trigger",o.TriggerFormIsOpenName="isOpen",o.TriggerFormEventTypeName="event",o.TriggerFormEventIdName="eventID",o.TriggerFormAppIdName="appID",o.TriggerFormParametersName="parameters",o.TriggerFormCronjobName="crontab",o.TriggerFormCronjobTypeName="crontabType",o.TriggerFormBindWorkflowName="workflowId",(l=o.TriggerFormEventType||(o.TriggerFormEventType={})).Time="time",l.Event="event",o.getVariableName=e=>{var t;return"".concat(null==e?void 0:e.type,",").concat(null!==(t=null==e?void 0:e.key)&&void 0!==t?t:null==e?void 0:e.name)};var o,r,l,a,i,s=((a={}).Cronjob="cronjob",a.Selecting="selecting",a)},6319:function(e,t,n){n.d(t,{k:function(){return a}});var o=n(664278),r=n(450562),l=e=>{var t=r.owu.getLabel(e);return{inputType:e,viewType:t,disabledTypes:void 0}},a=e=>{var{type:t}=o.N.dtoMetaToViewMeta(e);return l(t)}},503655:function(e,t,n){n.d(t,{G:()=>f});var o,r=n("825955"),l=n("178621"),a=n("450562"),i=n("297158"),s=n("336205"),d=n("286518"),u=n("382534"),c=()=>({name:a.SMH,label:s.o.t("model_config_response_format"),desc:s.o.t("model_config_response_format_explain"),type:2,min:"",max:"",precision:0,default_val:{default_val:"0"},options:[{label:s.o.t("model_config_history_text"),value:"0"},{label:s.o.t("model_config_history_markdown"),value:"1"}],param_class:{class_id:2}}),v=new l.S({defaultOptions:{queries:{staleTime:1/0}}}),p=e=>{var t,n,o=null===(n=e.find(e=>{var t;return null===(t=e.model_params)||void 0===t?void 0:t.find(e=>e.name===a.SMH)}))||void 0===n?void 0:null===(t=n.model_params)||void 0===t?void 0:t.find(e=>e.name===a.SMH);return e.map(e=>{!(null===(t=e.model_params)||void 0===t?void 0:t.find(e=>(null==e?void 0:e.name)===a.SMH))&&(o?null===(r=e.model_params)||void 0===r||r.push(o):null===(l=e.model_params)||void 0===l||l.push(c()));var t,n,r,l,i,d=null===(n=e.model_params)||void 0===n?void 0:n.find(e=>(null==e?void 0:e.name)===a.SMH);return Object.keys(null!==(i=null==d?void 0:d.default_val)&&void 0!==i?i:{}).forEach(e=>{d.default_val[e]=a.B5l.JSON}),d&&(d.options=[{label:s.o.t("model_config_history_text"),value:a.B5l.Text},{label:s.o.t("model_config_history_markdown"),value:a.B5l.Markdown},{label:s.o.t("model_config_history_json"),value:a.B5l.JSON}]),e})};var f=(o=(0,r._)(function*(e){var{info:t,spaceId:n,document:o,isBindDouyin:l}=e;try{return yield v.fetchQuery({queryKey:["llm-model"],queryFn:(0,r._)(function*(){var e,r,a,i,s,c=(a=JSON.parse((null==t?void 0:t.schema_json)||"{}"),i=o,s=[],i?(a.nodes.forEach(e=>{!function e(t,n,o){var r,l,a=o.getNodeRegistry(t.type),i=null==a?void 0:null===(l=a.meta)||void 0===l?void 0:null===(r=l.getLLMModelIdsByNodeJSON)||void 0===r?void 0:r.call(l,t);i&&(Array.isArray(i)?i:[i]).filter(Boolean).forEach(e=>{var t="".concat(e);!n.includes(t)&&n.push(t)}),t.blocks&&t.blocks.forEach(t=>e(t,n,o))}(e,s,i)}),s):s),v={space_id:n,model:!0,cur_model_ids:c};l&&(v.model_scene=d.Ws.Douyin);var f=yield u.nA.GetTypeList(v),m=null!==(r=null==f?void 0:null===(e=f.data)||void 0===e?void 0:e.model_list)&&void 0!==r?r:[];return p(m)}),staleTime:3e3})}catch(e){return i.kg.error({error:e,eventName:"api/bot/get_type_list fetch error"}),(0,a.Tbq)(Error(s.o.t("workflow_detail_error_message",{msg:"fetch error"}))),[]}}),function(e){return o.apply(this,arguments)})},316896:function(e,t,n){n.d(t,{x:function(){return i}});var o=n(808549),r=n(120454),l=n(998262),a=n(322512),i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"required",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"name",i=(e||[]).map(e=>(0,r._)((0,o._)({},e),{required:void 0!==e.required&&e.required})),s=(0,l.Z)(i,t);return[...(0,a.Z)(s.true,n)||[],...(0,a.Z)(s.false,n)||[]]}},4450:function(e,t,n){n.d(t,{PB:function(){return p},Vm:function(){return f}});var o=n(808549),r=n(941847),l=n(953687),a=n(25733),i=n(100015),s=n(896335),d=n(450562),u=n(178385),c=n(736892),v=e=>{var t,n={};return null==e||null===(t=e.model_params)||void 0===t||t.forEach(e=>{var t,o=(0,r.Z)(e.name),{type:l}=e,a=null!==(t=e.default_val[d.Gu0.Balance])&&void 0!==t?t:e.default_val[d.Gu0.Customize];void 0!==a&&([u.c4.Float,u.c4.Int].includes(l)||["modelType"].includes(o))&&(n[o]=Number(a))}),n},p=(e,t)=>{var n,o=(0,l.Z)(null!==(n=null==t?void 0:t.model_params)&&void 0!==n?n:[],"name");return(0,a.Z)(e,(e,t)=>{var n=o[(0,i.Z)(t)];if(!n||!(0,s.Z)(e))return e;var{type:r}=n;return[u.c4.Float,u.c4.Int].includes(r)||["modelType"].includes(t)?Number(e):e})},f=e=>{var t,n=null!==(t=e.find(e=>e.model_type===c.Dj))&&void 0!==t?t:e[0];return(0,o._)({modelType:null==n?void 0:n.model_type,modelName:null==n?void 0:n.name,generationDiversity:d.Gu0.Balance},v(n))}},793003:function(e,t,n){n.d(t,{t:function(){return a}});var o,r,l,a,i=n(808549),s=n(155440),d=n(344879),u=n(550655),c=n(156133),v=n(962289),p=n(671261),f=n(686436),m=n(664278),h=n(450562),g=n(336205),x=n(422133),_=n(736892);(o=a||(a={})).INPUT_PARAMS_PATH="inputs.inputParameters",r="inputs.batchMode",l="inputs.batch",o.mapToArray=function(e,t){return Object.keys(e).map(n=>t(n,e[n]))},o.arrayToMap=function(e,t,n){var o={};return e.forEach(e=>{o[e[t]]=n(e)}),o},o.batchToDTO=function(e,t){if(!!e){var{playgroundContext:{variableService:n}}=t,{batchSize:o=_.F1,concurrentSize:r=_.Sk,inputLists:l}=e;return{batchSize:o,concurrentSize:r,inputLists:l.map(e=>({name:e.name,input:m.N.valueExpressionToDTO(e.input,n,{node:null==t?void 0:t.node})}))}}},o.batchToVO=function(e,t){if(!!e){var{playgroundContext:{variableService:n}}=t,{batchSize:o,concurrentSize:r,inputLists:l}=e;return{batchSize:o,concurrentSize:r,inputLists:(l||[]).map(e=>({name:e.name,id:e.id,input:m.N.valueExpressionToVO(e.input,n)}))}}},o.refExpressionToValueDTO=function(e,t){if(!!e){var{playgroundContext:{variableService:n}}=t;return{input:m.N.valueExpressionToDTO(e,n,{node:null==t?void 0:t.node})}}},o.literalExpressionToValueDTO=function(e){if(!(0,s.Z)(e))return{type:m.N.getLiteralExpressionValueDTOType(e.content),value:{type:"literal",content:(0,s.Z)(e.content)?"":String(e.content)}}},o.getLiteralExpressionViewVariableType=function(e){if((0,s.Z)(e))return h.owu.String;if((0,d.Z)(e))return h.owu.Integer;if((0,u.Z)(e))return h.owu.Number;if((0,c.Z)(e))return h.owu.Boolean;else return h.owu.String},o.refExpressionDTOToVO=function(e,t){if(!(0,s.Z)(e)){var{playgroundContext:{variableService:n}}=t;return m.N.valueExpressionToVO(e.input,n)}},o.literalExpressionDTOToVO=function(e){if(!(0,s.Z)(e)){var{type:t,value:n}=e;return{type:"literal",content:m.N.getLiteralValueWithType(t,null==n?void 0:n.content)}}},o.getBatchInputListFormDefaultValue=function(e){return{name:"item".concat(e),id:(0,f.x0)(),input:{type:h.YX3.REF}}},o.getBatchModeFormMeta=function(e){return{name:"batchMode",type:"string",default:"single",abilities:[{type:"setter",options:{key:"Radio",type:"button",options:[{value:"single",label:g.o.t("workflow_batch_tab_single_radio")},{value:"batch",label:g.o.t("workflow_batch_tab_batch_radio"),disabled:e=>{var t,{node:n}=e;if((null===(t=n.parent)||void 0===t?void 0:t.flowNodeType)===f.Sy.SUB_CANVAS)return!0}}]}},{type:"decorator",options:{key:"FormCard",collapsible:!1}},{type:"visibility",options:{hidden:e}}]}},o.formValueToDto=function(e,t){var n=(0,v.Z)(e,o.INPUT_PARAMS_PATH),a=n?o.mapToArray(n,(e,t)=>({name:e,input:t})):[],s=(0,v.Z)(e,r),d=(0,v.Z)(e,l),u=s===h.Psf.Batch?(0,i._)({batchEnable:!0},o.batchToDTO(d,t)):void 0;return(0,p.Z)(e,o.INPUT_PARAMS_PATH,a),(0,p.Z)(e,l,u),(0,p.Z)(e,r,void 0),(0,p.Z)(e,"inputs.settingOnError",(0,x.Yf)(e).settingOnError),e},o.dtoToformValue=function(e,t){var n=(0,v.Z)(e,o.INPUT_PARAMS_PATH);if(!n||!Array.isArray(n))return e;var a=o.arrayToMap(n,"name",e=>e.input),i=(0,v.Z)(e,l),s=(null==i?void 0:i.batchEnable)?h.Psf.Batch:h.Psf.Single,d=(null==i?void 0:i.batchEnable)?o.batchToVO(i,t):void 0;return(0,p.Z)(e,o.INPUT_PARAMS_PATH,a),(0,p.Z)(e,r,s),(0,p.Z)(e,l,d),(0,p.Z)(e,"settingOnError",(0,x.kI)(e).settingOnError),e}},470248:function(e,t,n){n.d(t,{g:function(){return s}});var o=n(670324),r=n(569502),l=n(336205),a=n(736892);class i{validate(e){return this.issues=[],this.validateInputValues(e),this.issues}validateInputValues(e){var t,n=function(n){var r,l=e[n]||{},a={name:t.validateName,input:t.validateInput};Object.keys(a).forEach(r=>{var i=a[r].bind(t)({value:l[r],values:e});i&&t.issues.push({message:i,path:o.concat(n,r)})});var i=(null===(r=e[n])||void 0===r?void 0:r.children)||[];t.validateInputValues(i,o.concat(n,"children"))},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!!e)for(var r=0;r<e.length;r++)t=this,n(r)}validateName(e){var{value:t,values:n}=e;if(!t)return l.o.t("workflow_detail_node_error_name_empty");var o=n.map(e=>e.name).filter(Boolean);return a.cH.test(t)?o.filter(e=>e===t).length>1?l.o.t("workflow_detail_node_input_duplicated"):void 0:l.o.t("workflow_detail_node_error_format")}validateInput(e){var{value:t}=e,{variableValidationService:n}=this.playgroundContext;return r.nZ.isEmpty(t)?l.o.t("workflow_detail_node_error_empty"):(null==t?void 0:t.type)===r.YX.REF?n.isRefVariableEligible(t,this.node):void 0}constructor(e,t){this.issues=[],this.node=e,this.playgroundContext=t}}function s(e){var{value:t,context:{playgroundContext:n,node:r}}=e,l=new i(r,n),a=o.z.lazy(()=>o.z.object({name:o.z.string().optional(),input:o.z.any(),children:o.z.array(a).optional()}).passthrough()),s=o.z.array(a).superRefine((e,t)=>{l.validate(e).forEach(e=>{t.addIssue({path:e.path,message:e.message,validation:"regex",code:"invalid_string"})})}).safeParse(t);return!!s.success||JSON.stringify(s.error)}},24269:function(e,t,n){n.d(t,{d:function(){return a}});var o=n(670324),r=n(336205),l=o.z.object({title:o.z.string({required_error:r.o.t("workflow_detail_node_name_error_empty")}).min(1,r.o.t("workflow_detail_node_name_error_empty")).regex(/^.{0,63}$/,r.o.t("workflow_derail_node_detail_title_max",{max:"63"})),icon:o.z.string().optional(),subtitle:o.z.string().optional(),description:o.z.string().optional()}),a=e=>{var{value:t,context:n}=e,{playgroundContext:o}=n,a=l.refine(e=>{var{title:t}=e;return!function(e){if(!e)return!1;var{nodesService:t}=o,n=t.getAllNodes().filter(n=>t.getNodeTitle(n)===e);return(null==n?void 0:n.length)>1}(t)},{message:r.o.t("workflow_node_title_duplicated"),path:["title"]}).safeParse(t);return!!a.success||JSON.stringify(a.error)}},629600:function(e,t,n){n.d(t,{a:()=>g});var o,r=n("670324"),l=n("450562"),a=n("336205"),i=n("687015"),s=n.n(i),d=n("664278"),u=n("1704"),c=(e,t)=>{if(!t||!e)return!0;var n=d.N.viewMetaToDTOMeta(t),r=(0,u.v)(n);if(!r)return!0;!o&&(o=new(s()));try{return o.compile(r)(JSON.parse(e))}catch(e){return!1}},v=r.z.lazy(()=>r.z.object({name:r.z.string({required_error:a.o.t("workflow_detail_node_error_name_empty")}).min(1,a.o.t("workflow_detail_node_error_name_empty")).regex(/^(?!.*\b(true|false|and|AND|or|OR|not|NOT|null|nil|If|Switch)\b)[a-zA-Z_][a-zA-Z_$0-9]*$/,a.o.t("workflow_detail_node_error_format")),type:r.z.number(),children:r.z.array(v).optional(),defaultValue:r.z.any().optional()}).passthrough()),p=r.z.array(v),f=function(e){for(var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=new Set,r=0;r<e.length;r++){var{name:l}=e[r];if(o.has(l)){t={path:n.concat(r,"name"),message:a.o.t("workflow_detail_node_error_variablename_duplicated")};break}if(o.add(l),e[r].children){var i=f(e[r].children,n.concat(r,"children"));if(i){t=i;break}}}return t},m=r.z.array(v).refine(e=>!f(e),e=>{var t=f(e);return{path:t.path,message:t.message,validation:"regex",code:"invalid_string"}}).superRefine((e,t)=>{h(e).forEach(e=>{t.addIssue({path:e.path,message:e.message,validation:"regex",code:"invalid_string"})})}),h=e=>{for(var t=[],n=0;n<e.length;n++){var{defaultValue:o,type:r}=e[n];if("string"==typeof o&&!!o&&!!l.owu.isJSONInputType(r))!c(o,e[n])&&t.push({path:[n,"defaultValue"],message:a.o.t("workflow_debug_wrong_json")})}return t};function g(e){var{value:t,options:n}=e,{uniqueName:o=!1}=n,r=o?m.safeParse(t):p.safeParse(t);return!!r.success||JSON.stringify(r.error)}},294166:function(e,t,n){n.d(t,{y:function(){return i}});var o=n(670324),r=n(336205),l=n(564803),a=o.z.object({settingOnErrorIsOpen:o.z.boolean().optional(),settingOnErrorJSON:o.z.string().optional(),processType:o.z.number().optional()}),i=e=>{var{value:t}=e;if(!t)return!0;var n=a.refine(e=>(function(e){if(null==e?void 0:e.settingOnErrorIsOpen){if((null==e?void 0:e.processType)&&(null==e?void 0:e.processType)!==l.A.RETURN)return!0;try{JSON.parse(null==e?void 0:e.settingOnErrorJSON)}catch(e){return!1}}return!0})(e),{message:r.o.t("workflow_exception_ignore_json_error")}).safeParse(t);return!!n.success||JSON.stringify(n.error)}},464632:function(e,t,n){n.d(t,{p:()=>b});var o=n("702570"),r=n("686436"),l=n("816697"),a=n("808549"),i=n("130001"),s=n("962289"),d=n("671261"),u=n("788637"),c=n("997516"),v=n("345420"),p=n("435946"),f=n("664278"),m=n("471583"),h=n("244829"),g=n("450562");class x{getVariablesMeta(e,t){var{variablesMeta:n=g.VKi.DEFAULT}=t.getNodeRegister(e);return n||g.VKi.DEFAULT}formatOutputVariables(e,t){var n=this.getVariablesMeta(e.type,t);e.data&&n.outputsPathList.forEach(t=>{var n=(0,s.Z)(e.data,t);n&&Array.isArray(n)&&n.forEach((e,t)=>{if(!!e.type){var o=f.N.dtoMetaToViewMeta(e);(0,d.Z)(n,t,o)}})})}transformBatchVariable(e,t){if(!e.data)return;var n=(0,s.Z)(e.data,"inputs.batch.inputList");if(!(!n||(0,u.Z)(n)))e.data.inputs.batch.inputLists=[{name:"item",input:n}],delete e.data.inputs.batch.inputList}formatInputVariables(e,t){var n=this.getVariablesMeta(e.type,t);e.data&&n.inputsPathList.forEach(t=>{var n=(0,s.Z)(e.data,t);n&&Array.isArray(n)&&n.map((e,t)=>{(0,d.Z)(n,t,f.N.inputValueToVO(e,this.variableService))})})}formatNodeMeta(e,t){if(!((null==e?void 0:e.type)&&[g.nyy.Api,g.nyy.SubWorkflow].includes(e.type))){var n=(0,s.Z)(e,"data.nodeMeta"),o=this.playgroundContext.getNodeTemplateInfoByType(e.type);if(n&&"object"==typeof n&&o&&"object"==typeof o){var r=(0,c.Z)(o,["icon","subTitle"]);(0,d.Z)(e,"data.nodeMeta",(0,a._)({},n,r))}}}formatNodeOnInit(e,t,n){return n?(this.formatOutputVariables(e,t),this.formatInputVariables(e,t),e):e}formatNodeOnSubmit(e,t,n){var{nodeDTOType:o}=t.getNodeRegister(e.type).meta,r=this.getVariablesMeta(e.type,t);return e.data&&(r.outputsPathList.forEach(t=>{var n=(0,s.Z)(e.data,t);n&&Array.isArray(n)&&n.forEach((e,t)=>{if(!!e.type){var o=f.N.viewMetaToDTOMeta(e);(0,d.Z)(n,t,o)}})}),r.inputsPathList.forEach(t=>{var o=(0,s.Z)(e.data,t);o&&Array.isArray(o)&&(o.map((e,t)=>{if(!!e)(0,d.Z)(o,t,f.N.inputValueToDTO(e,this.variableService,{node:n}))}),(0,d.Z)(e.data,t,o.filter(Boolean)))})),e.type=String(o||e.type),e}formatOnInit(e,t){return e.nodes.forEach(e=>this.transformBatchVariable(e,t)),e.nodes.forEach(e=>this.formatOutputVariables(e,t)),e.nodes.forEach(e=>this.formatInputVariables(e,t)),e.nodes.forEach(e=>this.formatNodeMeta(e,t)),e}formatOnSubmit(e,t){return e.nodes=(e.nodes||[]).map(e=>{var n=t.getNodeRegister(e.type);return(0,v.Z)(null==n?void 0:n.beforeNodeSubmit)?n.beforeNodeSubmit(e):e}),console.log("------------------ save ----------------------",e),e}}(0,i.gn)([(0,r.yT)(m.b),(0,i.w6)("design:type",void 0===m.b?Object:m.b)],x.prototype,"variableService",void 0),(0,i.gn)([(0,r.yT)(r.xm),(0,i.w6)("design:type",void 0===r.xm?Object:r.xm)],x.prototype,"playgroundContext",void 0),(0,i.gn)([(0,r.yT)(h.I),(0,i.w6)("design:type",void 0===h.I?Object:h.I)],x.prototype,"batchService",void 0),x=(0,i.gn)([(0,p.b)()],x);var _=n("523158"),y=n("686346");class w extends r.L4{fromJSON(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{flattenJSON:n,nodeBlocks:o,nodeEdges:r}=this.flatJSON(e),l=this.formatWorkflowJSON(n,"formatOnInit",this),a=this.nestJSON(l,o,r);super.fromJSON(a,t)}formatWorkflowJSON(e,t){for(var n=arguments.length,o=Array(n>2?n-2:0),r=2;r<n;r++)o[r-2]=arguments[r];if(this._formatCache.has(t))return this._formatCache.get(t)(e,...o);var a=this.jsonFormats.map(e=>e[t]?e[t].bind(e):void 0).filter(e=>!!e),i=(0,l.qC)(...a);return this._formatCache.set(t,i),i(e,...o)}createWorkflowNode(e,t,n){return e=this.formatWorkflowJSON(e,"formatNodeOnInit",this,t),super.createWorkflowNode(e,t,n)}toNodeJSON(e){var t=super.toNodeJSON(e);return this.formatWorkflowJSON(t,"formatNodeOnSubmit",this,e)}toJSON(){var e,t,n=this.toNodeJSON(this.root);return this.formatWorkflowJSON({nodes:null!==(e=n.blocks)&&void 0!==e?e:[],edges:null!==(t=n.edges)&&void 0!==t?t:[]},"formatOnSubmit",this)}getEdgeID(e){return r.e2.portInfoToLineId({from:e.sourceNodeID,to:e.targetNodeID,fromPort:e.sourcePortID,toPort:e.targetPortID})}flatJSON(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{nodes:[],edges:[]},o=new Map,l=new Map,a=null!==(e=n.nodes)&&void 0!==e?e:[],i=null!==(t=n.edges)&&void 0!==t?t:[],s=[...a],d=[...i],u=a.map(e=>e.id),c=i.map(e=>this.getEdgeID(e));return o.set(r.Sy.ROOT,u),l.set(r.Sy.ROOT,c),a.forEach(e=>{var{blocks:t,edges:n}=e;if(t){s.push(...t);var r=[];t.forEach(e=>{r.push(e.id)}),o.set(e.id,r),delete e.blocks}if(n){d.push(...n);var a=[];n.forEach(e=>{var t=this.getEdgeID(e);a.push(t)}),l.set(e.id,a),delete e.edges}}),{flattenJSON:{nodes:s,edges:d},nodeBlocks:o,nodeEdges:l}}nestJSON(e,t,n){var o,l,a={nodes:[],edges:[]},i=new Map,s=new Map,d=new Set(null!==(o=t.get(r.Sy.ROOT))&&void 0!==o?o:[]),u=new Set(null!==(l=n.get(r.Sy.ROOT))&&void 0!==l?l:[]);return e.nodes.forEach(e=>{i.set(e.id,e)}),e.edges.forEach(e=>{var t=this.getEdgeID(e);s.set(t,e)}),e.nodes.forEach(e=>{if(d.has(e.id)&&a.nodes.push(e),t.has(e.id)){var o=t.get(e.id).map(e=>i.get(e)).filter(Boolean);e.blocks=o}if(n.has(e.id)){var r=n.get(e.id).map(e=>s.get(e)).filter(Boolean);e.edges=r}}),e.edges.forEach(e=>{var t=this.getEdgeID(e);u.has(t)&&a.edges.push(e)}),a}constructor(...e){super(...e),this.jsonFormats=[],this._formatCache=new Map}}(0,i.gn)([(0,_.n)(r.t$),(0,y.j)(),(0,i.w6)("design:type",Array)],w.prototype,"jsonFormats",void 0),w=(0,i.gn)([(0,p.b)()],w);var j=n("360903"),b=new o.n((e,t,n,o)=>{e(j.t).toSelf().inSingletonScope(),(0,l.KV)(e,x,[r.t$]),e(w).toSelf().inSingletonScope(),o(r.L4).toService(w)})},140219:function(e,t,n){n.d(t,{V:function(){return S},e:function(){return I}});var o=n(825955),r=n(808549),l=n(120454),a=n(473980),i=n(151064),s=n(455069),d=n(311807),u=n(252237),c=n.n(u),v=n(686436),p=n(293332),f=n(267334),m=n(450562),h=n(28260),g=n(336205),x=n(775699),_=n(382534),y=n(674343),w=n(994983),j=n(184449),b=n(610308),N=n(822698),k=n(45587),C=(e,t)=>{if(!e)return null;var{disableBot:n,disableProject:o,disableBotTooltip:r,disableProjectTooltip:l}=t,a=e.type===h.jH.Bot,s=(0,b.P)({disableBot:n,disableProject:o},e.type),d=a&&n?r:l,u=e=>(0,i.jsxs)("div",{className:"flex",style:{width:"100%",alignItems:"center"},children:[(0,i.jsx)(x.qE,{size:"extra-extra-small",style:{flexShrink:0,marginRight:8},shape:"square",src:e.avatar}),(0,i.jsx)("div",{className:"flex",style:{flexGrow:1,flexShrink:1,width:0},children:(0,i.jsx)(x.ZT.Text,{ellipsis:{showTooltip:!0},style:{fontSize:12,color:"#1D1C23",fontWeight:400},children:e.name})}),e.type===h.jH.Project?(0,i.jsx)(y.Vp,{size:"mini",color:"primary",children:g.o.t("wf_chatflow_106")}):(0,i.jsx)(y.Vp,{size:"mini",color:"primary",children:g.o.t("wf_chatflow_107")})]});return(0,i.jsx)(x.Ph.Option,{"data-testid":(0,m.xtp)("workflow","playground","testrun","bot-select","option",e.value),value:e.value,showTick:!0,disabled:s,className:c()(k.Z["bot-option"],s?k.Z["bot-option-disabled"]:""),children:s?(0,i.jsx)(y.u,{content:d,position:"left",children:u(e)}):u(e)},e.value)},S=e=>{var{onObserver:t}=e,n=(0,s.useRef)(null);return(0,s.useEffect)(()=>{var e=new IntersectionObserver(e=>{e[0].isIntersecting&&(null==t||t())});return n.current&&e.observe(n.current),()=>e.disconnect()},[]),(0,i.jsxs)("div",{className:k.Z["loading-tag"],ref:n,children:[(0,i.jsx)(x.yC,{style:{marginRight:10},size:"small"}),(0,i.jsx)("span",{children:g.o.t("workflow_add_common_loading")})]})},I=e=>{var t,n,{isBot:u,value:c,onChange:y,disableBot:I=!1,disableProject:T=!1,disableBotTooltip:E="",disableProjectTooltip:D=""}=e,Z=(0,a._)(e,["isBot","value","onChange","disableBot","disableProject","disableBotTooltip","disableProjectTooltip"]),M=null==c?void 0:c.id,P=(0,j.j1)(),L=(0,v.G2)(w.w3),z=(0,j.jN)(),O=(0,s.useRef)(!1),[A=[],F]=(0,s.useState)([]),[R,V]=(0,s.useState)(!1),[B,G]=(0,s.useState)(!1),[W,U]=(0,s.useState)(""),[H,J]=(0,s.useState)(0),q=(0,s.useRef)(null),K=(0,s.useRef)(),X=!P.isInIDE,Y=(e,t)=>{L.setSelectItem(e),null==y||y(t)},Q=(0,N.$)(A,M,u,Y),$=(0,s.useMemo)(()=>{var e=Q?H+1:H;return e<7?32*e:208},[H,Q]);(0,s.useEffect)(()=>{ee()},[]),(0,s.useEffect)(()=>{var e,t=null==A?void 0:A.find(e=>e.value===(null==c?void 0:c.id)),n=(0,b.P)({disableBot:I,disableProject:T},null==t?void 0:t.type);if(c&&(null==t?void 0:t.type)&&n&&(null==y||y(void 0)),(null==c?void 0:c.id)!==(null===(e=L.selectItem)||void 0===e?void 0:e.value)){if(!c){L.setSelectItem(void 0);return}t&&L.setSelectItem(t)}},[c,A]);var ee=(t=(0,o._)(function*(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&V(!0),n&&(K.current=void 0);var o=yield _.sD.GetDraftIntelligenceList({space_id:P.spaceId===f.RV?P.personalSpaceId:P.spaceId,name:null!=e?e:W,types:[h.jH.Bot,h.jH.Project],size:30,order_by:0,cursor_id:K.current,status:[h.Gr.Using,h.Gr.Banned,h.Gr.MoveFailed]}),{intelligences:r,total:l=0,next_cursor_id:a}=null!==(t=null==o?void 0:o.data)&&void 0!==t?t:{},i=(null!=r?r:[]).map(e=>{var t,n,o,r,l,a;return{name:null!==(r=null===(t=e.basic_info)||void 0===t?void 0:t.name)&&void 0!==r?r:"",value:null!==(l=null===(n=e.basic_info)||void 0===n?void 0:n.id)&&void 0!==l?l:"",avatar:null!==(a=null===(o=e.basic_info)||void 0===o?void 0:o.icon_url)&&void 0!==a?a:"",type:e.type||h.jH.Bot}}),s=n?i:[...A,...i];J(l),K.current=a,F(s),G(s.length<l),V(!1)}),function(e){return t.apply(this,arguments)});var et=(n=(0,o._)(function*(){if(!O.current)O.current=!0,yield ee(),O.current=!1}),function(){return n.apply(this,arguments)});return(0,i.jsx)("div",{className:k.Z["select-wrapper"],ref:q,children:(0,i.jsxs)(x.Ph,(0,l._)((0,r._)({value:M,"data-testid":(0,m.xtp)("workflow","playground","testerun","bot-select"),dropdownClassName:k.Z.dropdown,filter:!0,remote:!0,placeholder:g.o.t("wf_chatflow_73"),emptyContent:g.o.t("agentflow_addbot_select_empty_no_bot"),onSearch:(0,d.Z)(e=>{U(e),ee(e,!0)},500),prefix:(0,i.jsx)(p.Z,{}),loading:R,style:{width:"100%"},virtualize:{height:$,width:"100%",itemSize:32},onChange:e=>{var t=A.find(t=>t.value===e);X&&(null==t?void 0:t.type)&&z.updateRelatedBot({id:e,type:(null==t?void 0:t.type)===h.jH.Bot?"bot":"project"}),Y(t,t?{id:e,type:t.type}:void 0)}},Z),{children:[[Q,...A].filter(e=>e).map(e=>C(e,{disableBot:I,disableProject:T,disableBotTooltip:E,disableProjectTooltip:D})),B?(0,i.jsx)(x.Ph.Option,{value:new Date().getTime(),className:k.Z["bot-foot-loading"],disabled:!0,children:(0,i.jsx)(S,{onObserver:et})},new Date().getTime()):null]}))})}},339640:function(e,t,n){n.d(t,{L:function(){return s},W:function(){return i}});var o=n(825955),r=n(672496),l=n(28260),a=n(382534),i=e=>{var{isLoading:t,data:n}=(0,r.a)({queryKey:["bot_info",e||""],queryFn:(0,o._)(function*(){if(!!e){var{data:t}=yield a.pr.GetDraftBotInfoAgw({bot_id:e});return t}})});return{isLoading:t,botInfo:n}},s={model:e=>{var t,n;return null!==(n=null==e?void 0:null===(t=e.bot_info)||void 0===t?void 0:t.model_info)&&void 0!==n?n:{}},basicInfo:e=>{var t,n,o,r,a,i;if(!!e)return{name:null!==(r=null==e?void 0:null===(t=e.bot_info)||void 0===t?void 0:t.name)&&void 0!==r?r:"",avatar:null!==(a=null==e?void 0:null===(n=e.bot_info)||void 0===n?void 0:n.icon_url)&&void 0!==a?a:"",value:null!==(i=null==e?void 0:null===(o=e.bot_info)||void 0===o?void 0:o.bot_id)&&void 0!==i?i:"",type:l.jH.Bot}},database:e=>{var t;return null==e?void 0:null===(t=e.bot_info)||void 0===t?void 0:t.database_list},variable:e=>{var t;return null==e?void 0:null===(t=e.bot_info)||void 0===t?void 0:t.variable_list}}},822698:function(e,t,n){n.d(t,{$:function(){return i}});var o=n(455069),r=n(28260),l=n(713505),a=n(339640),i=(e,t,n,i)=>{var{botInfo:s}=(0,a.W)(n?t:void 0),{projectItemInfo:d}=(0,l.p)(n?void 0:t),u=(0,o.useMemo)(()=>{if(!e.find(e=>{var{value:n}=e;return n===t})){var n=a.L.basicInfo(s);return n&&(null==i||i(n,{id:n.value,type:n.type})),n}},[e,s,t]),c=(0,o.useMemo)(()=>{var n,o,l,a;if(!e.find(e=>{var{value:n}=e;return n===t}))return d&&(n={name:(null==d?void 0:null===(o=d.basic_info)||void 0===o?void 0:o.name)||"",value:(null==d?void 0:null===(l=d.basic_info)||void 0===l?void 0:l.id)||"",avatar:(null==d?void 0:null===(a=d.basic_info)||void 0===a?void 0:a.icon_url)||"",type:r.jH.Project},null==i||i(n,{id:n.value,type:n.type})),n},[d,e,t]);return n?u:c}},713505:function(e,t,n){n.d(t,{D:function(){return i},p:function(){return s}});var o=n(825955),r=n(672496),l=n(28260),a=n(382534),i=e=>{var{isLoading:t,data:n}=(0,r.a)({queryKey:["project_info",e||""],queryFn:(0,o._)(function*(){if(!!e){var t,n,{VariableList:o}=yield a.v6.GetProjectVariableList({ProjectID:e});return(null==o?void 0:null===(n=o.filter)||void 0===n?void 0:null===(t=n.call(o,e=>e.Enable))||void 0===t?void 0:t.map(e=>({key:e.Keyword})))||[]}})});return{isLoading:t,variableList:n}},s=e=>{var{isLoading:t,data:n}=(0,r.a)({queryKey:["project_item_info",e||""],queryFn:(0,o._)(function*(){if(!!e){var{data:t}=yield a.sD.GetDraftIntelligenceInfo({intelligence_id:e,intelligence_type:l.jH.Project});return t}})});return{isLoading:t,projectItemInfo:n}}},610308:function(e,t,n){n.d(t,{P:function(){return r}});var o=n(28260),r=(e,t)=>{var{disableBot:n,disableProject:r}=e,l=t===o.jH.Bot,a=t===o.jH.Project;return l&&n||a&&r||!t}},208394:function(e,t,n){n.d(t,{r:function(){return i}});var o=n(151064);n(455069);var r=n(336205),l=n(915757),a=n(674343),i=e=>{var{value:t,onChange:n,readonly:i}=e;return(0,o.jsxs)("div",{className:"absolute right-[0] top-[9px] flex items-center gap-[4px]",children:[(0,o.jsx)("span",{className:"text-xs",children:r.o.t("wf_history_rounds")}),(0,o.jsx)(a.u,{content:r.o.t("model_config_history_round_explain"),children:(0,o.jsx)(l.L03,{className:"coz-fg-dim text-xs"})}),(0,o.jsx)(a.k7,{className:"w-[60px]",size:"small",min:1,max:30,disabled:i,value:t,onChange:e=>{if(!isNaN(e))null==n||n(e)}})]})}},547014:function(e,t,n){n.d(t,{pq:()=>_,KU:()=>o.KU,H4:()=>N});var o=n("887874"),r=n("554011"),l=n("526900"),a=n("138420"),i=n("717497"),s=n("642199"),d=n("249294"),u=n("86270"),c=n("227985");l.Mj.register("json",{language:(0,s.ut)({outerLanguage:i.AV.language}),languageService:i.AV.languageService}),l.Mj.register("shell",a.IZ),l.np.register("coze-light",u.G),l.np.register("coze-dark",c.E);var v=e=>d.tk.theme({".cm-content, .cm-gutter, .cm-right-gutter":{minHeight:"number"==typeof e?"".concat(e,"px"):"string"==typeof e?e:"unset"},"&.cm-editor":{minHeight:"number"==typeof e?"".concat(e,"px"):"string"==typeof e?e:"unset"}}),p=e=>d.tk.theme({"&.cm-editor":{maxHeight:"number"==typeof e?"".concat(e,"px"):"string"==typeof e?e:"unset"}}),f=e=>d.tk.theme({"&.cm-editor":{height:"number"==typeof e?"".concat(e,"px"):"string"==typeof e?e:"unset"}}),m=e=>d.tk.theme({"&.cm-editor":{padding:"number"==typeof e?"".concat(e,"px"):"string"==typeof e?e:"unset"}}),h=e=>d.tk.theme({"&.cm-editor, .cm-gutters":{borderRadius:"number"==typeof e?"".concat(e,"px"):"string"==typeof e?e:"unset"}}),g=e=>d.tk.theme({".cm-content, .cm-gutter, .cm-right-gutter":{lineHeight:"number"==typeof e?"".concat(e,"px"):"string"==typeof e?e:"unset"}}),x=[d.tk.theme({"&.cm-focused":{outline:"none"},"& *":{fontFamily:'Menlo, Monaco, "Courier New", monospace'}}),d.tk.theme({"&.cm-content":{wordBreak:"break-all"}})],_=(0,o.Us)([...l.ZP,(0,r.Kw)("minHeight",v),(0,r.Kw)("maxHeight",p),(0,r.Kw)("editerHeight",f),(0,r.Kw)("borderRadius",h),(0,r.Kw)("padding",m),(0,r.Kw)("lineHeight",g)],x),y=n("116005"),w=n("992814"),j=d.tk.theme({"&.cm-editor":{outline:"none"},"&.cm-content":{wordBreak:"break-all"}}),b=[(0,s.ut)({}),j,(0,w.m8)(),d.$f.of([...w.wQ,...w.f$])],N=(0,o.Us)([...y.Z,(0,r.Kw)("minHeight",e=>d.tk.theme({".cm-content, .cm-gutter, .cm-right-gutter":{minHeight:"number"==typeof e?"".concat(e,"px"):"string"==typeof e?e:"unset"}})),(0,r.Kw)("lineHeight",e=>d.tk.theme({".cm-content, .cm-gutter, .cm-right-gutter":{lineHeight:"number"==typeof e?"".concat(e,"px"):"string"==typeof e?e:"unset"}}))],b)},227985:function(e,t,n){n.d(t,{E:function(){return f}});var o=n(526900),r=n(888855),l=n(249294),a="#151B27",i="#FFFFFF63",s="#39E5D7",d="#FF94D2",u="#FF9933",c="#78B0FF",v="#78B0FF",p="#FFFFFFC9",f=[l.tk.theme({".cm-completionIcon-property":{backgroundImage:'url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xMi4zNTc2IDguMTAzNTVDMTIuMTYyMyA3LjkwODI5IDExLjg0NTcgNy45MDgyOSAxMS42NTA1IDguMTAzNTVMOC4xMDM1NSAxMS42NTA1QzcuOTA4MjkgMTEuODQ1NyA3LjkwODI5IDEyLjE2MjMgOC4xMDM1NSAxMi4zNTc2TDExLjY1MDUgMTUuOTA0NUMxMS44NDU3IDE2LjA5OTggMTIuMTYyMyAxNi4wOTk4IDEyLjM1NzYgMTUuOTA0NUwxNS45MDQ1IDEyLjM1NzZDMTYuMDk5OCAxMi4xNjIzIDE2LjA5OTggMTEuODQ1NyAxNS45MDQ1IDExLjY1MDVMMTIuMzU3NiA4LjEwMzU1WiIgZmlsbD0iI0ZGRkZGRkM5Ii8+PHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMS4wMDI2IDEuNDU1NDVDMTEuNjIxNCAxLjA5ODE4IDEyLjM4MzggMS4wOTgxOCAxMy4wMDI2IDEuNDU1NDVMMjAuNjM4IDUuODYzNzRDMjEuMjU2OCA2LjIyMSAyMS42MzggNi44ODEyNiAyMS42MzggNy41OTU3OVYxNi40MTI0QzIxLjYzOCAxNy4xMjY5IDIxLjI1NjggMTcuNzg3MiAyMC42MzggMTguMTQ0NEwxMy4wMDI2IDIyLjU1MjdDMTIuMzgzOCAyMi45MSAxMS42MjE0IDIyLjkxIDExLjAwMjYgMjIuNTUyN0wzLjM2NzE5IDE4LjE0NDRDMi43NDgzOSAxNy43ODcyIDIuMzY3MTkgMTcuMTI2OSAyLjM2NzE5IDE2LjQxMjRWNy41OTU3OUMyLjM2NzE5IDYuODgxMjYgMi43NDgzOSA2LjIyMTAxIDMuMzY3MTkgNS44NjM3NEwxMS4wMDI2IDEuNDU1NDVaTTEyLjAwMjYgMy4xODc1TDE5LjYzOCA3LjU5NTc5VjE2LjQxMjRMMTIuMDAyNiAyMC44MjA3TDQuMzY3MTkgMTYuNDEyNEw0LjM2NzE5IDcuNTk1NzlMMTIuMDAyNiAzLjE4NzVaIiBmaWxsPSIjRkZGRkZGQzkiLz48L3N2Zz4=")',backgroundSize:"11px 11px",backgroundRepeat:"no-repeat",width:"11px",height:"11px"},".cm-completionIcon-property::after":{content:'""'}}),(0,o.jG)({variant:"dark",settings:{background:a,foreground:"#fff",caret:"#AEAFAD",selection:"#d9d9d942",gutterBackground:a,gutterForeground:"#FFFFFF63",gutterBorderColor:"transparent",gutterBorderWidth:0,lineHighlight:"#272e3d36",bracketColors:["#FFEF61","#DD99FF","#78B0FF"],tooltip:{backgroundColor:"#363D4D",color:"#fff",border:"none"},completionItemHover:{backgroundColor:"#FFFFFF0F"},completionItemSelected:{backgroundColor:"#FFFFFF17"},completionItemIcon:{color:"#FFFFFFC9"},completionItemLabel:{color:"#FFFFFFC9"},completionItemDetail:{color:"#FFFFFF63"}},styles:[{tag:r.pJ.comment,color:i},{tag:[r.pJ.propertyName],color:s},{tag:[r.pJ.string],color:d},{tag:[r.pJ.number],color:u},{tag:[r.pJ.bool],color:c},{tag:[r.pJ.null],color:v},{tag:[r.pJ.separator],color:p},{tag:[r.pJ.standard(r.pJ.variableName)],color:"#3BEB84"},{tag:[r.pJ.attributeName],color:"#FF9933"},{tag:[r.pJ.special(r.pJ.string)],color:"#78B0FF"}]})]},86270:function(e,t,n){n.d(t,{G:function(){return f}});var o=n(526900),r=n(888855),l=n(249294),a="#F7F7FC",i="#000A298A",s="#00818C",d="#D1009D",u="#C74200",c="#2B57D9",v="#2B57D9",p="#0F1529D1",f=[l.tk.theme({".cm-completionIcon-property":{backgroundImage:'url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xMi4zNTc2IDguMTAzNTVDMTIuMTYyMyA3LjkwODI5IDExLjg0NTcgNy45MDgyOSAxMS42NTA1IDguMTAzNTVMOC4xMDM1NSAxMS42NTA1QzcuOTA4MjkgMTEuODQ1NyA3LjkwODI5IDEyLjE2MjMgOC4xMDM1NSAxMi4zNTc2TDExLjY1MDUgMTUuOTA0NUMxMS44NDU3IDE2LjA5OTggMTIuMTYyMyAxNi4wOTk4IDEyLjM1NzYgMTUuOTA0NUwxNS45MDQ1IDEyLjM1NzZDMTYuMDk5OCAxMi4xNjIzIDE2LjA5OTggMTEuODQ1NyAxNS45MDQ1IDExLjY1MDVMMTIuMzU3NiA4LjEwMzU1WiIgZmlsbD0iIzA2MDcwOUNDIi8+PHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMS4wMDI2IDEuNDU1NDVDMTEuNjIxNCAxLjA5ODE4IDEyLjM4MzggMS4wOTgxOCAxMy4wMDI2IDEuNDU1NDVMMjAuNjM4IDUuODYzNzRDMjEuMjU2OCA2LjIyMSAyMS42MzggNi44ODEyNiAyMS42MzggNy41OTU3OVYxNi40MTI0QzIxLjYzOCAxNy4xMjY5IDIxLjI1NjggMTcuNzg3MiAyMC42MzggMTguMTQ0NEwxMy4wMDI2IDIyLjU1MjdDMTIuMzgzOCAyMi45MSAxMS42MjE0IDIyLjkxIDExLjAwMjYgMjIuNTUyN0wzLjM2NzE5IDE4LjE0NDRDMi43NDgzOSAxNy43ODcyIDIuMzY3MTkgMTcuMTI2OSAyLjM2NzE5IDE2LjQxMjRWNy41OTU3OUMyLjM2NzE5IDYuODgxMjYgMi43NDgzOSA2LjIyMTAxIDMuMzY3MTkgNS44NjM3NEwxMS4wMDI2IDEuNDU1NDVaTTEyLjAwMjYgMy4xODc1TDE5LjYzOCA3LjU5NTc5VjE2LjQxMjRMMTIuMDAyNiAyMC44MjA3TDQuMzY3MTkgMTYuNDEyNEw0LjM2NzE5IDcuNTk1NzlMMTIuMDAyNiAzLjE4NzVaIiBmaWxsPSIjMDYwNzA5Q0MiLz48L3N2Zz4=")',backgroundSize:"11px 11px",backgroundRepeat:"no-repeat",width:"11px",height:"11px"},".cm-completionIcon-property::after":{content:'""'}}),(0,o.jG)({variant:"light",settings:{background:a,foreground:"#4D4D4C",caret:"#AEAFAD",selection:"#52649A21",gutterBackground:a,gutterForeground:"#000A298A",gutterBorderColor:"transparent",gutterBorderWidth:0,lineHighlight:"#efefef78",bracketColors:["#E4D129","#AC05FF","#2B57D9"],tooltip:{backgroundColor:"var(--coz-bg-max)",color:"var(--coz-fg-primary)",border:"solid 1px var(--coz-stroke-plus)",boxShadow:"var(--coz-shadow-default)",borderRadius:"8px"},tooltipCompletion:{backgroundColor:"#FFFFFF",color:"#060709CC"},completionItemHover:{backgroundColor:"#5768A114"},completionItemSelected:{backgroundColor:"#52649A21"},completionItemIcon:{color:"#060709CC"},completionItemLabel:{color:"#060709CC"},completionItemDetail:{color:"#2029459E"}},styles:[{tag:r.pJ.comment,color:i},{tag:[r.pJ.propertyName],color:s},{tag:[r.pJ.string],color:d},{tag:[r.pJ.number],color:u},{tag:[r.pJ.bool],color:c},{tag:[r.pJ.null],color:v},{tag:[r.pJ.separator],color:p},{tag:[r.pJ.standard(r.pJ.variableName)],color:"#00804A"},{tag:[r.pJ.attributeName],color:"#C74200"},{tag:[r.pJ.special(r.pJ.string)],color:"#2B57D9"}]})]},917500:function(e,t,n){n.d(t,{n:()=>d});var o=n("151064"),r=n("450562"),l=n("336205"),a=n("674343"),i=new Map([[r.sSN.OR,l.o.t("workflow_detail_condition_or")],[r.sSN.AND,l.o.t("workflow_detail_condition_and")]]),s=n("931262"),d=e=>{var{logic:t,onChange:n,showStroke:d=!1,readonly:u=!1,testId:c}=e;return(0,o.jsxs)("div",{className:"flex flex-col pt-[16px] pb-[16px] w-[50px]",children:[(0,o.jsx)("div",{className:"flex-1 relative",children:d?(0,o.jsx)("div",{className:"absolute left-1/2 right-0 top-2.5 bottom-0 rounded-tl-lg border-solid border-0 border-t border-l coz-stroke-plus"}):null}),(0,o.jsx)(a.Ph,{className:s.Z["condition-logic-select"],placeholder:l.o.t("workflow_detail_condition_pleaseselect"),style:{marginRight:4},value:t,disabled:u,size:"small",optionList:[{label:i.get(r.sSN.AND),value:r.sSN.AND},{label:i.get(r.sSN.OR),value:r.sSN.OR}],onChange:e=>n(e),"data-testid":c}),(0,o.jsx)("div",{className:"flex-1 relative",children:d?(0,o.jsx)("div",{className:"absolute left-1/2 right-0 top-0 bottom-2.5 rounded-bl-lg border-solid border-0 border-b border-l coz-stroke-plus"}):null})]})}},67613:function(e,t,n){n.d(t,{q:function(){return d}});var o=n(151064),r=n(455069),l=n(336205),a=n(915757),i=n(674343),s=n(775699),d=e=>{var{value:t="",delayTime:n}=e,[d,u]=(0,r.useState)(!1);return d?(0,o.jsx)(i.u,{content:l.o.t("Duplicate_success"),children:(0,o.jsx)(s._3,{icon:(0,o.jsx)(a.maW,{color:"rgba(107, 109, 117, 1)"})})}):(0,o.jsx)(i.u,{content:l.o.t("Copy"),children:(0,o.jsx)(s._3,{onClick:e=>{e.stopPropagation(),navigator.clipboard.writeText(t),u(!0),setTimeout(()=>{u(!1)},null!=n?n:4e3)},icon:(0,o.jsx)(a.UtC,{color:"rgba(107, 109, 117, 1)"})})})}},644113:function(e,t,n){n.d(t,{T:()=>h,F:()=>c});var o=n("151064"),r=n("336205"),l=n("775699"),a=n("299464"),i=n("184449"),s=n("479910"),d=(0,n("598208").Ue)()((0,s.mW)(e=>({isVisible:!1,databaseID:"",isAddedInWorkflow:!1,tab:"structure",onChangeDatabaseToWorkflow:()=>{},open:t=>{var{databaseID:n,isAddedInWorkflow:o=!1,onChangeDatabaseToWorkflow:r,tab:l}=t;e({isVisible:!0,databaseID:n,isAddedInWorkflow:o,onChangeDatabaseToWorkflow:r,tab:l})},close:()=>{e({isVisible:!1})}}))),u=n("977631");function c(){var{databaseID:e,isVisible:t,close:n,isAddedInWorkflow:s,onChangeDatabaseToWorkflow:c,tab:v="structure"}=d(),{projectCommitVersion:p}=(0,i.j1)();if(!e)return null;var f=s?r.o.t("workflow_remove_to_workflow"):r.o.t("workflow_add_to_workflow");return(0,o.jsx)(l.u_,{fullScreen:!0,visible:t,footer:null,closable:!1,className:u.Z.editDatabaseModal,modalContentClass:"p-0",children:(0,o.jsx)(a.q9,{version:p,databaseId:e,enterFrom:"workflow",initialTab:v,onClose:()=>n(),addRemoveButtonText:f,onClickAddRemoveButton:()=>{s?c():c(e),n()}})})}var v=n("808549"),p=n("671261"),f=n("962289"),m=n("450562");function h(){var{open:e}=d(),{setData:t,data:n,type:o}=(0,m.rsR)();function r(e){var r=e?[{databaseInfoID:e}]:[],l=(0,v._)({},n);o===m.nyy.Database?(0,p.Z)(l,"databaseInfoList",r):(0,p.Z)(l,"inputs.databaseInfoList",r),t(l)}return{openDatabaseDetail:function(){var t,{databaseID:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,f.Z)(n,"databaseInfoList")||(0,f.Z)(n,"inputs.databaseInfoList"),a=null==l?void 0:null===(t=l[0])||void 0===t?void 0:t.databaseInfoID;void 0===o&&(o=a),e({databaseID:o,isAddedInWorkflow:o===a,onChangeDatabaseToWorkflow:r,tab:"draft"})}}}},93027:function(e,t,n){n.d(t,{LN:()=>h,WQ:()=>x,oP:()=>c});var o=n("151064"),r=n("252237"),l=n.n(r),a=n("336205"),i=n("915757"),s=n("674343"),d=n("44172"),u=n("621917"),c=e=>{var{id:t,onClose:n,closeButton:r,editorTitle:c,editorTooltip:v,actions:p,editorContent:f,containerClassName:m,headerClassName:h,contentClassName:g,closeIconClassName:x}=e;return(0,o.jsxs)("div",{className:l()(u.Z.container,m),children:[(0,o.jsxs)("div",{className:l()(h,u.Z.header),children:[(0,o.jsxs)("span",{className:u.Z.leftSide,children:[c,v?(0,o.jsx)("span",{children:(0,o.jsx)(s.u,{className:u.Z.tip,position:"bottom",content:v,children:(0,o.jsx)(d.aUG,{className:u.Z.info})})}):null]}),(0,o.jsxs)("span",{className:u.Z.rightSide,children:[null==p?void 0:p.map((e,t)=>(0,o.jsx)("span",{children:e},t)),null!=r?r:(0,o.jsx)(s.u,{content:a.o.t("node_http_json_collapse"),children:(0,o.jsx)("span",{children:(0,o.jsx)(s.hU,{icon:(0,o.jsx)(i.R$P,{fontSize:18,className:l()(x,u.Z.iconLight)}),size:"small",color:"secondary","aria-label":"close",onClick:()=>null==n?void 0:n()})})})]})]}),(0,o.jsx)("div",{className:l()(g,u.Z.content),children:f})]},t)},v=n("455069"),p=n("311807"),f=n("450562"),m=n("576693"),h=e=>{var t=(0,v.useRef)(null),{name:n,onBlur:r,onFocus:a,isError:i,className:s,onMouseEnter:d,onMouseLeave:u,children:c}=e,[h,g]=(0,v.useState)(!1),{getNodeSetterId:x}=(0,f.FCD)(),_=x(n),y=(0,v.useCallback)((0,p.Z)(e=>{g(e)},50),[]);return(0,o.jsx)("div",{"data-testid":_,className:l()(s,"w-full",{[m.Z["editor-normal"]]:!h&&!i,[m.Z["editor-focused"]]:h&&!i,[m.Z["editor-error"]]:i}),onFocus:()=>{y(!0),null==a||a()},onMouseEnter:()=>null==d?void 0:d(),onMouseLeave:()=>null==u?void 0:u(),onBlur:()=>{y(!1),null==r||r()},ref:t,children:c},_)},g=n("980483"),x=e=>{var{children:t}=e,[n,r]=(0,v.useState)(g.bY.Light),l=(0,v.useMemo)(()=>n===g.bY.Dark,[n]);return(0,o.jsx)(g.dd.Provider,{value:{editorTheme:n,setEditorTheme:r,isDarkTheme:l},children:t})}},689896:function(e,t,n){n.d(t,{a:()=>p});var o=n("808549"),r=n("151064"),l=n("58197"),a=n("775699"),i=n("206616"),s=n("175399"),d=["js","jsx","ts","tsx","html","htm","css","scss","sass","less","py","java","c","cpp","h","hpp","cs","go","rb","php","swift","kt","kts","sql","pl","sh","bash","rs","dart","scala","yaml","yml","json"],u={ppt:l.pr,pptx:l.pr,doc:l.LG,docx:l.LG,pdf:l.n4,txt:l.GH,zip:l.qI,rar:l.qI,xls:l.hz,xlsx:l.hz,csv:l.hz,code:l.Ck,video:l.Qk,audio:l.BV},c=e=>{var t,n,o,r,a,i,c=null!==(i=u[e])&&void 0!==i?i:l.IG;if(t=e,(n=s.lookup(t))&&n.startsWith("audio/"))c=u.audio;else{;if(o=e,(r=s.lookup(o))&&r.startsWith("video/"))c=u.video;else{;if(a=e,d.includes(a))c=u.code}}return c},v=n("128577"),p=e=>{var{size:t=20,file:n,iconStyle:s,loadingStyle:d,hideLoadingIcon:u}=e,{url:p,name:f,status:m}=n,h=(0,i.mD)(f);if(m===i.w_.Uploading&&!u)return(0,r.jsx)(a.yC,{wrapperClassName:v.Z["file-icon-loading"],style:(0,o._)({width:t,height:t,lineHeight:"".concat(t,"px")},d),spinning:!0});if(i.XF.includes(h))return p?(0,r.jsx)(a.Ee,{preview:!1,className:"object-contain object-center rounded-sm border-0",style:(0,o._)({width:t,height:t},s),imgStyle:{width:t,height:t},src:p,alt:""}):(0,r.jsx)(l.PG,{style:(0,o._)({width:t,height:t,fontSize:t},s)});var g=c(h);return(0,r.jsx)(g,{style:(0,o._)({width:t,height:t,fontSize:t},s)})}},612735:function(e,t,n){n.d(t,{j:()=>u});var o=n("825955"),r=n("151064"),l=n("674343"),a=n("686436"),i=n("994983"),s=()=>(0,r.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsxs)("g",{id:"add",children:[(0,r.jsx)("path",{id:"background",fill:"#ffffff",fillRule:"evenodd",stroke:"none",d:"M 24 12 C 24 5.372583 18.627417 0 12 0 C 5.372583 0 -0 5.372583 -0 12 C -0 18.627417 5.372583 24 12 24 C 18.627417 24 24 18.627417 24 12 Z"}),(0,r.jsx)("path",{id:"content",fill:"currentColor",fillRule:"evenodd",stroke:"none",d:"M 22 12.005 C 22 6.482153 17.522848 2.004999 12 2.004999 C 6.477152 2.004999 2 6.482153 2 12.005 C 2 17.527847 6.477152 22.004999 12 22.004999 C 17.522848 22.004999 22 17.527847 22 12.005 Z"}),(0,r.jsx)("path",{id:"cross",fill:"#ffffff",stroke:"none",d:"M 11.411996 16.411797 C 11.411996 16.736704 11.675362 17 12.00023 17 C 12.325109 17 12.588474 16.736704 12.588474 16.411797 L 12.588474 12.58826 L 16.41201 12.58826 C 16.736919 12.58826 17.000216 12.324894 17.000216 12.000015 C 17.000216 11.675147 16.736919 11.411781 16.41201 11.411781 L 12.588474 11.411781 L 12.588474 7.588234 C 12.588474 7.263367 12.325109 7 12.00023 7 C 11.675362 7 11.411996 7.263367 11.411996 7.588234 L 11.411996 11.411781 L 7.588449 11.411781 C 7.263581 11.411781 7.000215 11.675147 7.000215 12.000015 C 7.000215 12.324894 7.263581 12.58826 7.588449 12.58826 L 11.411996 12.58826 L 11.411996 16.411797 Z"})]})}),d=e=>{var t,n,o=(0,a.Dc)(),{line:r,selected:l=!1,color:i}=e;return!r.disposed&&!o.config.readonly&&(!!l||i===a.St.HOVER)&&("loop-output-to-function"!==r.fromPort.portID||(null===(t=r.toPort)||void 0===t?void 0:t.portID)!=="loop-function-input")&&("batch-output-to-function"!==r.fromPort.portID||(null===(n=r.toPort)||void 0===n?void 0:n.portID)!=="batch-function-input")&&!0},u=e=>{var{line:t,selected:n,color:u,lineType:c}=e,v=d({line:t,selected:n,color:u}),p=(0,a.G2)(a.sS),f=(0,a.G2)(i.qq);if(!v)return(0,r.jsx)(r.Fragment,{});var{fromPort:m,toPort:h}=t,{to:g,from:x}=t.position,_=c===a.SP.BEZIER,y={x:(g.x+x.x)/2,y:(g.y+x.y)/2};return(0,r.jsx)("div",{className:"workflow-line-add-button absolute translate-x-[-50%] translate-y-[-60%] w-[24px] h-[24px] cursor-pointer",style:{left:_?"50%":y.x,top:_?"50%":y.y,color:u},"data-testid":"sdk.workflow.canvas.line.add","data-line-id":t.id,onClick:(0,o._)(function*(){if(!!(yield p.call({panelPosition:{x:(t.position.from.x+t.position.to.x)/2,y:(t.position.from.y+t.position.to.y)/2},fromPort:m,toPort:h,enableBuildLine:!0,enableAutoOffset:!0,panelProps:{enableScrollClose:!0},canAddNode:e=>{var{nodeType:t,containerNode:n}=e,o=f.canDropToNode({dragNodeType:t,dropNode:n});return o.allowDrop?o.allowDrop:(l.FN.warning({content:o.message}),!1)}})))t.dispose()}),children:(0,r.jsx)(s,{})})}},392646:function(e,t,n){n.d(t,{q:()=>M});var o=n("808549"),r=n("120454"),l=n("151064"),a=n("455069"),i=n("252237"),s=n.n(i),d=n("686436"),u=n("450562");n("715363");var c=n("915757"),v=n("674343"),p=n("775699"),f=n("994983"),m=n("428622"),h=n("178385"),g=e=>e.split("_").map((e,t)=>0===t?e:e.slice(0,1).toUpperCase()+e.slice(1)).join(""),x=(e,t)=>t&&[h.c4.Float,h.c4.Int].includes(t)&&e?Number(e):e,_={expand:void 0},y=e=>{var{modelParams:t,value:n}=e,o={[u.Gu0.Creative]:{},[u.Gu0.Balance]:{},[u.Gu0.Precise]:{},[u.Gu0.Customize]:{}};return Object.keys(o).forEach(e=>{o[e]={},null==t||t.forEach(t=>{var r,l,a,i,s,d=g(null!==(a=t.name)&&void 0!==a?a:""),c=null!==(s=null!==(i=null==n?void 0:n[d])&&void 0!==i?i:null===(r=t.default_val)||void 0===r?void 0:r[e])&&void 0!==s?s:null===(l=t.default_val)||void 0===l?void 0:l[u.Gu0.Customize];if(t.type&&[h.c4.Float,h.c4.Int].includes(t.type)){var{min:v,max:p}=t;["",void 0].includes(c)&&(c=0),""!==v&&Number(c)<Number(v)&&(c=Number(v)),""!==p&&Number(c)>Number(p)&&(c=Number(p))}o[e][d]=c})}),o},w=n("517609"),j=e=>{var{className:t,value:n,onChange:o,models:r,readonly:a,triggerRender:i,popoverPosition:s}=e;return(0,l.jsx)(w.f,{className:t,value:n,onChange:o,models:r,readonly:a,popoverPosition:s,triggerRender:i})},b=n("336205"),N=n("44172"),k=n("160457"),C=n("825955"),S=(0,a.lazy)((0,C._)(function*(){var{MdBoxLazy:e}=yield n.e("8779").then(n.bind(n,985808));return{default:e}})),I=()=>(0,l.jsx)("div",{className:"border-0 border-t border-solid coz-stroke-primary"}),T=e=>{var{title:t,description:n,center:o,right:r,bolder:i,leftClassName:s=""}=e;return(0,l.jsxs)("div",{className:"flex gap-[4px]",children:[(0,l.jsxs)("div",{className:"".concat(o?"w-[162px]":"flex-1"," ").concat(i?"font-semibold":"font-normal"," flex items-center ").concat(s),children:[t,n?(0,l.jsx)(v.u,{content:(0,l.jsx)(a.Suspense,{fallback:null,children:(0,l.jsx)(S,{markDown:n,autoFixSyntax:{autoFixEnding:!1}})}),children:(0,l.jsx)(N.aUG,{className:"pl-[8px] cursor-pointer coz-fg-dim"})}):void 0]}),o?(0,l.jsx)("div",{className:"flex-1",children:o}):void 0,r?(0,l.jsx)("div",{className:"w-[110px]",children:r}):void 0]})},E=e=>{var{title:t,description:n,onChange:o,min:r=0,max:a=100,value:i=0,precision:s=0,readonly:d}=e,u=1/Math.pow(10,s);return(0,l.jsx)(T,{title:t,description:n,center:(0,l.jsx)("div",{className:"relative ".concat(k.Z.slider),children:(0,l.jsx)(p.iR,{disabled:d,value:i,min:r,max:a,step:u,marks:{[r]:"".concat(r),[a]:"".concat(a)},onChange:e=>{o(e)}},t)}),right:(0,l.jsx)(v.Rn,{disabled:d,precision:s,value:i,min:r,max:a,step:u,onChange:e=>{e!==i&&o(e)}})})},D=e=>{var t,{value:n,onChange:i,model:s,defaultValue:d,readonly:c,id:v}=e,[f,m]=(0,a.useState)(void 0===_.expand&&(null==n?void 0:n.generationDiversity)===u.Gu0.Customize&&!c||_.expand),h=(0,r._)((0,o._)({},d),{[u.Gu0.Customize]:null!==(t=_[v])&&void 0!==t?t:null==d?void 0:d[u.Gu0.Customize]});(0,a.useEffect)(()=>{_.expand=f},[f]);var{doms:y,generationDiversityGroupTitle:w}=(0,a.useMemo)(()=>{var e,t,a=null!==(t=null==s?void 0:null===(e=s.model_params)||void 0===e?void 0:e.filter(e=>e.name!==u.SMH))&&void 0!==t?t:[],d=[];a.forEach(e=>{var t;(null===(t=e.param_class)||void 0===t?void 0:t.class_id)&&!d.map(e=>e.class_id).includes(e.param_class.class_id)&&d.push(e.param_class)});var m=d.find(e=>1===e.class_id),h=(null==m?void 0:m.label)||"";m&&(d=[m,...d.filter(e=>e.class_id!==m.class_id)]);var y=[],w=e=>{e.generationDiversity===u.Gu0.Customize&&(_[v]=e)};return d.forEach((e,t)=>{if(0!==t&&y.push((0,l.jsx)(I,{})),!!f||(null==m?void 0:m.class_id)!==e.class_id){if((null==m?void 0:m.class_id)!==e.class_id){var s;y.push((0,l.jsx)(T,{title:null!==(s=e.label)&&void 0!==s?s:"",bolder:!0}))}var d=null==a?void 0:a.filter(t=>{var n;return(null===(n=t.param_class)||void 0===n?void 0:n.class_id)===e.class_id});null==d||d.forEach(e=>{var{label:t="",name:a,desc:s,min:d,max:v,options:f,precision:m,type:h}=e,_=g(null!=a?a:""),j=x(null==n?void 0:n[_],h);if(null==f?void 0:f.length){var b=f.map(e=>(0,r._)((0,o._)({},e),{label:e.label||e.value,value:x(e.value,h)}));y.push((0,l.jsx)(T,{title:t,description:s,center:(0,l.jsx)(p.Ph,{disabled:c,className:"w-full",value:j,onChange:e=>{var t=(0,r._)((0,o._)({},n),{[_]:e});i(t),w(t)},optionList:b})}))}else y.push((0,l.jsx)(E,{readonly:c,title:t,description:s,value:j,min:x(d,h),max:x(v,h),precision:x(m,h),onChange:e=>{var t=(0,r._)((0,o._)({},n),{[_]:e,generationDiversity:u.Gu0.Customize});i(t),w(t)}}))})}}),{doms:y,generationDiversityGroupTitle:h}},[f,n,s,c]);return(0,l.jsxs)("div",{className:"p-[24px] flex flex-col gap-[16px]",onMouseDown:e=>{e.stopPropagation()},children:[(0,l.jsx)("div",{className:"flex items-center",children:(0,l.jsx)("div",{className:"flex-1 text-[18px] font-semibold",children:b.o.t("workflow_detail_llm_model")})}),(0,l.jsx)(I,{}),(0,l.jsx)(T,{title:w,description:b.o.t("model_config_generate_explain"),bolder:!0,leftClassName:"!w-[165px]",center:(0,l.jsx)("div",{className:"w-full pr-[8px]",children:(0,l.jsx)(p.FX,{type:"button",disabled:c,value:null==n?void 0:n.generationDiversity,className:"".concat(k.Z.radioGroup," w-full !flex"),onChange:e=>{var t,l,a;i((0,r._)((0,o._)({},n,null==h?void 0:h[null===(t=e.target)||void 0===t?void 0:t.value]),{generationDiversity:null===(l=e.target)||void 0===l?void 0:l.value})),(null===(a=e.target)||void 0===a?void 0:a.value)===u.Gu0.Customize&&m(!0)},children:[{value:u.Gu0.Precise,label:b.o.t("model_config_generate_precise")},{value:u.Gu0.Balance,label:b.o.t("model_config_generate_balance")},{value:u.Gu0.Creative,label:b.o.t("model_config_generate_creative")},{value:u.Gu0.Customize,label:b.o.t("model_config_generate_customize")}].map(e=>(0,l.jsx)(p.Y8,{value:e.value,children:e.label},e.value))})}),right:(0,l.jsxs)("div",{className:"cursor-pointe h-full flex items-center gap-[4px]",onClick:e=>{e.stopPropagation(),m(!f)},children:[(0,l.jsx)("span",{children:b.o.t("model_config_generate_advance")}),f?(0,l.jsx)(N.f5h,{}):(0,l.jsx)(N.f5h,{className:"rotate-180"})]})}),y]})},Z=u.Gu0.Balance,M=e=>{var t,n,{value:i,onChange:h,readonly:g,popoverPosition:x,popoverAutoAdjustOverflow:w,testName:b,triggerRender:N,className:k}=e,C=null!==(n=null===(t=(0,d.G2)(f.we))||void 0===t?void 0:t.getModels())&&void 0!==n?n:[],S=(0,a.useMemo)(()=>C.find(e=>e.model_type===(null==i?void 0:i.modelType)),[C,null==i?void 0:i.modelType]),I=(0,a.useCallback)(e=>{var{modelType:t,value:n}=e,o=C.find(e=>e.model_type===t);return y({modelParams:null==o?void 0:o.model_params,value:n})},[C]),T=(0,a.useMemo)(()=>I({modelType:null==S?void 0:S.model_type}),[I,null==S?void 0:S.model_type]),E=(0,a.useMemo)(()=>(0,o._)({generationDiversity:u.Gu0.Customize},T[(null==E?void 0:E.generationDiversity)||Z],i),[i,T]),M=(0,a.useMemo)(()=>C.map(e=>({label:e.name,value:e.model_type})),[C]),P=(0,d.km)(),{getNodeSetterId:L,concatTestId:z}=(0,u.FCD)(),O=L(b||"llm-select");return(0,l.jsx)(m.Z,{children:(0,l.jsxs)("div",{className:s()("flex gap-[4px] items-center relative",k),"data-testid":O,children:[(0,l.jsx)(j,{readonly:g,value:null==E?void 0:E.modelType,onChange:e=>{var t=M.find(t=>t.value===e);if(t){var n,l,a,i,s,d,c,v=null!==(n=E.generationDiversity)&&void 0!==n?n:Z;l=v===u.Gu0.Customize?null!==(i=null===(a=I({modelType:t.value,value:_[P.id]}))||void 0===a?void 0:a[v])&&void 0!==i?i:{}:null!==(d=null===(s=I({modelType:t.value}))||void 0===s?void 0:s[v])&&void 0!==d?d:{},null==h||h((0,r._)((0,o._)({},l),{modelName:t.label,modelType:t.value,generationDiversity:v,responseFormat:null!==(c=null==E?void 0:E.responseFormat)&&void 0!==c?c:null==l?void 0:l.responseFormat}))}},models:C,popoverPosition:x,triggerRender:N}),(0,l.jsx)(p.J2,{autoAdjustOverflow:w||!1,className:"rounded-md w-[660px]",trigger:"click",position:x||"bottomRight",content:(0,l.jsx)(D,{id:P.id,defaultValue:T,value:E,onChange:e=>{null==h||h((0,r._)((0,o._)({},e),{modelName:E.modelName,modelType:E.modelType}))},model:S,readonly:!!g}),spacing:30,children:(0,l.jsx)(v.hU,{"data-testid":"e2e-ui-button-action-".concat(z(O,"model-setting-btn")),wrapperClass:"leading-none",color:"secondary",size:"small",icon:(0,l.jsx)(c.qBd,{})})})]})})}},612286:function(e,t,n){n.d(t,{g:function(){return s}});var o=n(151064),r=n(455069),l=n(450562),a=n(686436),i=n(374499);function s(e){var{node:t,scene:n,children:s}=e,d=function(e){var[t,n]=(0,r.useState)(new l.m_1(e));return(0,r.useEffect)(()=>{var t=()=>{(0,r.startTransition)(()=>{n(new l.m_1(e))})},o=e.getData(a.Ps).onDataChange(()=>t()),i=e.getData(a.Ps).formModel.onInitialized(()=>t()),s=e.getData(a.fu).onDataChange(()=>t());return()=>{null==o||o.dispose(),null==i||i.dispose(),null==s||s.dispose()}},[e]),t}(t),[u,c]=(0,r.useState)();return(0,r.useEffect)(()=>{if(!!d.data){var e,n,o=null===(n=d.registry)||void 0===n?void 0:null===(e=n.checkError)||void 0===e?void 0:e.call(n,d.data,t.context);o!==u&&(o&&d.setError({name:"CustomNodeError",message:o}),c(o))}},[d]),(0,o.jsx)(i.u.Provider,{value:n,children:(0,o.jsx)(l.iBO.Provider,{value:d,children:(0,o.jsx)(a.rQ.Provider,{value:t,children:s})})})}},213635:function(e,t,n){n.d(t,{q:()=>p,f:()=>v});var o=n("151064"),r=n("686436"),l=n("886829"),a=n("727914"),i=n("808549"),s=n("252237"),d=n.n(s),u=n("674343"),c=n("70090"),v=e=>{var{icon:t,size:n=18,hideOutline:r,borderRadius:l="var(--coze-3)",outlineColor:a="var(--coz-stroke-primary)",className:s,style:v}=e;return(0,o.jsxs)("div",{className:d()(s,c.Z["node-icon-wrapper"]),style:(0,i._)({borderRadius:l,width:n,height:n},v),children:[(0,o.jsx)(u.Ee,{className:c.Z["node-icon"],style:{borderRadius:l},width:n,height:n,src:t,preview:!1}),r?null:(0,o.jsx)("div",{className:c.Z["node-icon-border"],style:{borderRadius:l,boxShadow:"inset 0 0 0 1px ".concat(a)}})]})},p=e=>{var t,{nodeId:n,className:i,size:s,alt:d}=e,u=(0,r.Dc)();try{t=u.entityManager.getEntityById(n)}catch(e){throw new a.sH("[NodeIcon] get node entity error, id: ".concat(n),e.message)}if(!t)return null;var c=t.getData(l.m).getNodeData();return(null==c?void 0:c.icon)?(0,o.jsx)("div",{className:i,children:(0,o.jsx)("img",{className:"object-cover",src:c.icon,alt:d,style:{width:s||"auto",height:s||"auto"}})}):null}},357143:function(e,t,n){n.d(t,{IV:function(){return l},TQ:function(){return i},ak:function(){return o},m4:function(){return r},wh:function(){return a}});var o=440,r=300,l=9,a=8,i="loadMore"},616357:function(e,t,n){n.d(t,{K:()=>eN});var o=n("825955"),r=n("808549"),l=n("120454"),a=n("151064"),i=n("455069"),s=n("962289"),d=n("671261"),u=n("686436"),c=n("360903"),v=n("450562"),p=n("297158"),f=n("737368"),m=n("674343"),h=n("945941"),g=n("327703"),x=n("699123"),_=n("338626"),y=n("848759"),w=n("184449"),j=n("325599"),b=n("64451"),N=n("793002"),k=()=>(0,a.jsx)("div",{className:N.Z["node-placeholder"],"data-testid":"workflow.detail.node-panel.placeholder",children:(0,a.jsx)(b.V,{})}),C=n("643095"),S=n("252237"),I=n.n(S),T=n("72173"),E=n("336205"),D=n("915757"),Z=(0,i.createContext)({}),M=Z.Provider,P=()=>(0,i.useContext)(Z),L=n("474523"),z=e=>{if(!e)return!1;var t,n,o=null===(t=(n=e.getNodeMeta()).subCanvas)||void 0===t?void 0:t.call(n,e);return(null==o?!!void 0:!!o.isCanvas)&&o.parentNode.flowNodeType===v.nyy.Loop||!1},O=e=>{var t=z(e),n=(0,u.G2)(h.j),{isSceneFlow:o}=(0,w.oS)(),{projectId:r,isBindDouyin:l}=(0,w.j1)(),{isSupportImageflowNodes:a}=(0,L.Hz)();return n.getTemplateCategoryList((0,L.OW)({loopSelected:t,isSceneFlow:o,isProject:!!r,isSupportImageflowNodes:a,isBindDouyin:!!l}),a)},A=n("633697"),F=n("522776"),R=n("357143"),V=e=>{var t;return null!==(t=null==e?void 0:e.map(e=>{var t,n,o,r,l,a,i,s,d,u,c,p,f,{product:m}=e,h=null!==(s=null===(t=m.meta_info)||void 0===t?void 0:t.entity_id)&&void 0!==s?s:"",g=null!==(d=null===(n=m.meta_info)||void 0===n?void 0:n.name)&&void 0!==d?d:"",x=null!==(u=null===(o=m.meta_info)||void 0===o?void 0:o.icon_url)&&void 0!==u?u:"";return{plugin_id:h,name:g,desc:null!==(c=null===(r=m.meta_info)||void 0===r?void 0:r.description)&&void 0!==c?c:"",icon_url:null!==(p=null===(l=m.meta_info)||void 0===l?void 0:l.icon_url)&&void 0!==p?p:"",tools:null!==(f=null===(i=m.plugin_extra)||void 0===i?void 0:null===(a=i.tools)||void 0===a?void 0:a.map(e=>{var t=(0,F.k)({name:e.name,plugin_name:g,api_id:e.id,plugin_id:h,desc:e.description},x);return{type:v.nyy.Api,name:e.name,desc:e.description,plugin_id:h,api_id:e.id,icon_url:x,nodeJSON:t,version:""}}))&&void 0!==f?f:[]}}))&&void 0!==t?t:[]},B=()=>{var e,t,n,r,l,a=(0,u.G2)(h.j),[s,d]=(0,i.useState)(null!==(l=null===(n=a.favoritePlugins)||void 0===n?void 0:n.has_more)&&void 0!==l&&l),[c,v]=(0,i.useState)(V(null===(r=a.favoritePlugins)||void 0===r?void 0:r.favorite_products));var p=(e=(0,o._)(function*(){if(!!s){var e,t,n,o,r=R.IV,l=Math.floor(c.length/r+1),i=yield a.fetchFavoritePlugins({pageNum:l,pageSize:r});d(null!==(n=null==i?void 0:i.has_more)&&void 0!==n&&n),v(e=>{var t=V(null==i?void 0:i.favorite_products);return(0,A.Z)(e.concat(t),"plugin_id")}),a.favoritePlugins={favorite_products:null===(t=a.favoritePlugins)||void 0===t?void 0:null===(e=t.favorite_products)||void 0===e?void 0:e.concat(null!==(o=null==i?void 0:i.favorite_products)&&void 0!==o?o:[]),has_more:null==i?void 0:i.has_more}}}),function(){return e.apply(this,arguments)});return{pluginNodeList:c,hasMore:s,loadMore:p,refetch:(t=(0,o._)(function*(){try{var e,t,n,o,r=Math.max(null!==(n=null===(t=a.favoritePlugins)||void 0===t?void 0:null===(e=t.favorite_products)||void 0===e?void 0:e.length)&&void 0!==n?n:R.IV,R.IV),l=yield a.fetchFavoritePlugins({pageNum:1,pageSize:r});d(null!==(o=null==l?void 0:l.has_more)&&void 0!==o&&o),v(V(null==l?void 0:l.favorite_products)),a.favoritePlugins=l}catch(e){console.error("refetchFavoritePlugins error",e)}}),function(){return t.apply(this,arguments)})}},G=n("311807"),W=n("567282"),U=n("973922"),H=n("335740"),J=(e,t)=>{var{name:n,desc:o,url:r,workflow_id:l,plugin_id:a}=t;return{type:v.nyy.SubWorkflow,name:n,desc:o,icon_url:r,plugin_id:a,workflow_id:null!=l?l:"",nodeJSON:(0,F.n)({workflowItem:{name:n,workflow_id:l,desc:o},spaceId:e,isImageflow:!1,templateIcon:r})}},q=e=>{var{name:t="",desc:n="",icon:o="",plugin_id:r,tool_list:l=[],version:a}=e;return{plugin_id:null!=r?r:"",name:t,desc:n,icon_url:o,tools:l.map(e=>{var{api_name:l,api_desc:i,api_id:s}=e;return{type:v.nyy.Api,name:l,desc:i,plugin_id:r,version:a,nodeJSON:(0,F.k)({name:l,plugin_name:t,api_id:s,plugin_id:r,desc:n,version_ts:a},o)}})}},K=(e,t)=>{if(!t.data)return[];var n,o,r,l,a,i,s,d,u,c,v,p,f=t.data,m=[];if(null==f?void 0:null===(o=f.project_workflow)||void 0===o?void 0:null===(n=o.workflow_list)||void 0===n?void 0:n.length){var{workflow_list:h,has_more:g=!1,next_page_or_cursor:x}=f.project_workflow;m.push({id:W.EP.ProjectWorkflow,categoryName:E.o.t("workflow_0224_02",{source:E.o.t("wf_chatflow_106")}),nodeList:h.map(t=>J(e,t)),hasMore:g,cursor:x})}if(null==f?void 0:null===(l=f.resource_workflow)||void 0===l?void 0:null===(r=l.workflow_list)||void 0===r?void 0:r.length){var{workflow_list:_,has_more:y=!1,next_page_or_cursor:w}=f.resource_workflow;m.push({id:W.EP.ResourceWorkflow,categoryName:E.o.t("workflow_0224_02",{source:E.o.t("navigation_workspace_library")}),nodeList:_.map(t=>J(e,t)),hasMore:y,cursor:w})}var j=[];if(null==f?void 0:null===(i=f.favorite_plugin)||void 0===i?void 0:null===(a=i.plugin_list)||void 0===a?void 0:a.length){var{plugin_list:b,has_more:N=!1,next_page_or_cursor:k}=f.favorite_plugin;j.push({id:W.EP.FavoritePlugin,categoryName:E.o.t("workflow_0224_03"),nodeList:b.map(q),hasMore:N,cursor:k})}if(null==f?void 0:null===(d=f.project_plugin)||void 0===d?void 0:null===(s=d.plugin_list)||void 0===s?void 0:s.length){var{plugin_list:C,has_more:S=!1,next_page_or_cursor:I}=f.project_plugin;j.push({id:W.EP.ProjectPlugin,categoryName:E.o.t("workflow_0224_02",{source:E.o.t("wf_chatflow_106")}),nodeList:C.map(q),hasMore:S,cursor:I})}if(null==f?void 0:null===(c=f.resource_plugin)||void 0===c?void 0:null===(u=c.plugin_list)||void 0===u?void 0:u.length){var{plugin_list:T,has_more:D=!1,next_page_or_cursor:Z}=f.resource_plugin;j.push({id:W.EP.ResourcePlugin,categoryName:E.o.t("workflow_0224_02",{source:E.o.t("navigation_workspace_library")}),nodeList:T.map(q),hasMore:D,cursor:Z})}if(null==f?void 0:null===(p=f.store_plugin)||void 0===p?void 0:null===(v=p.plugin_list)||void 0===v?void 0:v.length){var{plugin_list:M,has_more:P=!1,next_page_or_cursor:L}=f.store_plugin;j.push({id:W.EP.StorePlugin,categoryName:E.o.t("workflow_0224_06"),nodeList:M.map(q),hasMore:P,cursor:L})}return[{name:E.o.t("Workflow"),data:m,dataType:U.A.SubWorkflow},{name:E.o.t("project_ide_frame_plugin"),data:j,dataType:U.A.Plugin}].filter(e=>e.data.length>0)},X=(e,t,n)=>{var o=(0,H.Z)(t);for(var r of o)!function(t){var{dataType:o}=t;for(var r of t.data)!function(t){var{id:r}=t;if(r===e||e===W.EP.All){var l,a,i=null===(a=n.find(e=>e.dataType===o))||void 0===a?void 0:null===(l=a.data)||void 0===l?void 0:l.find(e=>e.id===r);(null==i?void 0:i.nodeList.length)?(t.hasMore=i.hasMore,t.cursor=i.cursor,t.nodeList=[...t.nodeList,...i.nodeList]):t.hasMore=!1}}(r)}(r);return o},Y=e=>{var t,n,{atomNodeCategoryList:r}=e,[l,a]=(0,i.useState)(""),{spaceId:s,projectId:d,workflowId:u}=(0,w.j1)(),c=(0,i.useMemo)(()=>!!l,[l]),p=(0,i.useMemo)(()=>{if(!l)return[];var e=r.map(e=>{var{categoryName:t,nodeList:n}=e;return{categoryName:t,nodeList:n.filter(e=>{var t=[];return(0,g.a1)(e)?t.push(e.name,e.api_name,e.desc,e.api_id,e.plugin_id):(0,g.em)(e)?t.push(e.name,e.categoryInfo.categoryId):(0,g.gF)(e)&&t.push(e.name,e.desc),t.filter(e=>!!e).some(e=>e.toLowerCase().includes(l.toLowerCase()))})}}).filter(e=>{var{nodeList:t}=e;return t.length});return 0===e.length?[]:[{name:E.o.t("workflow_0224_01"),data:e,dataType:U.A.Atom}]},[l,r]),[f,m]=(0,i.useState)(!1),[h,x]=(0,i.useState)([]);var _=(0,i.useCallback)((0,G.Z)((t=(0,o._)(function*(e){try{var t=yield v.OHc.NodePanelSearch({search_type:W.EP.All,space_id:s,project_id:d,search_key:e,page_size:R.IV,page_or_cursor:"",exclude_workflow_id:u});x(K(s,t))}catch(e){console.error(e)}finally{m(!1)}}),function(e){return t.apply(this,arguments)}),300),[]);var y=(n=(0,o._)(function*(e,t){var n=yield v.OHc.NodePanelSearch({search_type:null!=e?e:W.EP.All,space_id:s,project_id:d,search_key:l,page_size:R.IV,page_or_cursor:null!=t?t:""});x(t=>X(null!=e?e:W.EP.All,t,K(s,n)))}),function(e,t){return n.apply(this,arguments)}),j=(0,i.useMemo)(()=>[...p,...h],[p,h]),b=(0,i.useMemo)(()=>c&&!f&&0===j.reduce((e,t)=>e+=t.data.flatMap(e=>e.nodeList).length,0),[c,j,f]);return{keyword:l,handleKeywordChange:e=>{if(a(e),!e){x([]);return}m(!0),_(e)},showSearchResult:c,isSearching:f,noSearchResult:b,searchResult:j,loadMore:y}},Q=n("851954"),$=n.n(Q),ee=n("293469"),et=function(e){var{categoryName:t,children:n}=e;return(0,a.jsxs)("div",{className:"node-category-panel",children:[t?(0,a.jsx)(m.ZT.Text,{className:"block coz-fg-secondary leading-5 mb-1 pl-1 font-['PICO_Sans_VFE_SC']",weight:500,size:"normal","data-testid":(0,v.xtp)("workflow.detail.node-panel.list.category.name",t),children:t}):null,(0,a.jsx)("div",{className:ee.Z["node-category-list"],"data-testid":"workflow.detail.node-panel.list.category.list",children:n})]})},en=e=>{var{onLoadMore:t}=e,[n,r]=(0,i.useState)(!1);return(0,a.jsxs)("div",{className:N.Z["load-more"],onClick:(0,o._)(function*(){try{r(!0),yield null==t?void 0:t()}finally{r(!1)}}),children:[(0,a.jsx)("div",{className:N.Z["load-more-icon"],children:n?(0,a.jsx)(D.j2n,{className:I()(N.Z.icon,"semi-spin-animate")}):(0,a.jsx)(D.Wdl,{className:N.Z.icon})}),(0,a.jsx)(m.ZT.Text,{className:N.Z["load-more-text"],children:E.o.t("workflow_0224_05")})]})},eo=n("473980"),er=n("990828"),el=n("994983"),ea=n("189914");function ei(e){var{className:t,style:n,children:o,nodeType:i,nodeJson:s,disabled:d,nodeDesc:c,tooltipPosition:p,nodeTemplate:f}=e,h=(0,eo._)(e,["className","style","children","nodeType","nodeJson","disabled","nodeDesc","tooltipPosition","nodeTemplate"]),x=(0,u.X2)(U.e),_=(0,u.G2)(el.qq),y=(0,v.xtp)("workflow.detail.node-panel.card",i),[{isDragging:w},j,b]=(0,er.c)(()=>({type:ea.iB,item:{nodeType:i,nodeJson:s,modalProps:(0,g.em)(f)?{initQuery:{type:f.categoryInfo.categoryId,isOfficial:!!f.categoryInfo.onlyOfficial||void 0}}:void 0,nodeVersionInfo:(0,g.a1)(f)?{pluginId:f.plugin_id,version:f.version}:(0,g.qc)(f)?{workflowId:f.workflow_id,pluginId:f.plugin_id}:{}},collect:e=>{var t=e.getItemType(),n=e.getItem();return n&&t===ea.iB?_.startDrag({type:n.nodeType,json:n.nodeJson}):_.endDrag(),{isDragging:e.isDragging()}}})),k=I()({[N.Z.card]:!0,[N.Z["not-allowed"]]:x.isExecuting,[N.Z.grabbing]:w,[t||""]:!!t}),C=(0,a.jsxs)("div",{className:N.Z.cardMargin,style:{position:"relative"},"data-testid":y,"data-node-type":i,children:[(0,a.jsx)("div",(0,l._)((0,r._)({ref:b,className:I()(k,N.Z["preview-card"]),style:n},h),{children:o})),(0,a.jsx)("div",(0,l._)((0,r._)({ref:d?null:j,className:I()(k,N.Z["drag-card"])},h),{children:o}))]});return c&&!w?(0,a.jsx)(m.u,{content:c,position:p,mouseEnterDelay:500,children:C}):C}var es=n("213635"),ed=e=>{var{name:t,icon:n,hideOutline:o=!1,onClick:r,keyword:l,className:i}=e;return(0,a.jsxs)("div",{className:I()(N.Z["node-card"],i),onClick:r,children:[(0,a.jsx)(es.f,{size:20,icon:n,hideOutline:o,borderRadius:"var(--coze-4)",outlineColor:"var(--coz-stroke-plus)"}),(0,a.jsx)(m.ZT.Text,{className:I()(N.Z["node-title"],"font-['PICO_Sans_VFE_SC']"),ellipsis:!0,children:(0,a.jsx)(m.y$,{sourceString:t||"",searchWords:l?[l]:[],highlightStyle:{backgroundColor:"transparent",color:"var(--coz-fg-color-orange)",fontWeight:400}})})]},t)},eu=e=>{var t,{data:n}=e,{keyword:r,enableDrag:l,onSelect:i,onLoadMore:u,onAddingNode:c}=P(),{spaceId:v}=(0,w.j1)(),p=(0,w.oO)();var f=(t=(0,o._)(function*(e){var{event:t,nodeTemplate:n}=e;if(!n.plugin_id||"0"===n.plugin_id){null==i||i({event:t,nodeTemplate:n});return}try{null==c||c(!0);var o=yield(0,g.ZJ)({spaceId:v,pluginId:n.plugin_id});if(o&&$().valid(o)){if(!(yield p.addSubWorkflowCheck(n.workflow_id,o)))return;var r=(0,H.Z)(n);(0,d.Z)(r,"nodeJSON.data.inputs.workflowVersion",o),null==i||i({event:t,nodeTemplate:r})}}finally{null==c||c(!1)}}),function(e){return t.apply(this,arguments)});return(0,a.jsx)(a.Fragment,{children:n.map(e=>{var{id:t,categoryName:n,nodeList:i,hasMore:d,cursor:c}=e;return(0,a.jsxs)(et,{categoryName:n,children:[i.map((e,t)=>{var n,o;return(0,a.jsx)(ei,{tooltipPosition:t%2==0?"left":"right",nodeType:null==e?void 0:e.type,nodeDesc:(0,s.Z)(e,"desc"),nodeJson:(0,s.Z)(e,"nodeJSON"),nodeTemplate:e,disabled:!l,children:(0,a.jsx)(ed,{name:null!==(n=e.name)&&void 0!==n?n:"",icon:null!==(o=e.icon_url)&&void 0!==o?o:"",keyword:r,onClick:t=>f({event:t,nodeTemplate:e})})},"".concat(null==e?void 0:e.type,"_").concat(e.name))}),d?(0,a.jsx)(en,{onLoadMore:(0,o._)(function*(){yield null==u?void 0:u(t,c)})}):null]},t)})})},ec=n("550655"),ev=n("956384"),ep=e=>{var{name:t,onClick:n,keyword:o}=e;return(0,a.jsxs)("div",{className:ev.Z["plugin-tool-card"],onClick:n,children:[(0,a.jsx)(D.z6M,{className:"text-[16px] coz-fg-dim"}),(0,a.jsx)(m.ZT.Text,{size:"normal",className:"coz-fg-secondary leading-5",ellipsis:{showTooltip:{opts:{content:t,style:{wordBreak:"break-word"}}}},children:(0,a.jsx)(m.y$,{sourceString:t||"",searchWords:o?[o]:[],highlightStyle:{backgroundColor:"transparent",color:"var(--coz-fg-color-orange)",fontWeight:400}})})]},t)},ef=e=>{var{name:t,icon:n,onClick:o,keyword:r,expand:l}=e;return(0,a.jsxs)("div",{className:I()(ev.Z["plugin-node-card"],{[ev.Z.expand]:l}),onClick:o,children:[(0,a.jsx)(es.f,{size:20,icon:n,borderRadius:"var(--coze-4)",outlineColor:"var(--coz-stroke-plus)"}),(0,a.jsx)(m.ZT.Text,{className:I()(ev.Z["node-title"],"font-['PICO_Sans_VFE_SC']"),ellipsis:!0,children:(0,a.jsx)(m.y$,{sourceString:t||"",searchWords:r?[r]:[],highlightStyle:{backgroundColor:"transparent",color:"var(--coz-fg-color-orange)",fontWeight:400}})}),(0,a.jsx)("div",{className:ev.Z["expand-btn"],children:(0,a.jsx)(m.hU,{size:"small",style:{width:20,height:20,minWidth:20},color:"secondary",icon:l?(0,a.jsx)(D.rmE,{className:"coz-fg-secondary text-[16px]"}):(0,a.jsx)(D.ltt,{className:"coz-fg-secondary text-[16px]"})})})]},t)},em=e=>{var{index:t,nodeTemplate:n,enableDrag:o,onSelect:r,keyword:l,expand:i,onExpandChange:s}=e,{name:d,plugin_id:u,icon_url:c,desc:v,tools:p}=n;return(()=>{var e=t%2==0?"left":"right";if((null==p?void 0:p.length)!==1)return(0,a.jsxs)("div",{className:ev.Z["plugin-card-wrapper"],children:[i?(0,a.jsx)("div",{className:I()(ev.Z["plugin-card-cutcorner"],ev.Z["left-corner"])}):null,(0,a.jsx)(m.u,{content:v,position:e,mouseEnterDelay:500,children:(0,a.jsx)("div",{children:(0,a.jsx)(ef,{name:null!=d?d:"",icon:null!=c?c:"",keyword:l,expand:null!=i&&i,onClick:()=>null==s?void 0:s(!i)})})}),i?(0,a.jsx)("div",{className:I()(ev.Z["plugin-card-cutcorner"],ev.Z["right-corner"])}):null]});var n=p[0];return(0,a.jsx)(ei,{tooltipPosition:e,nodeType:null==n?void 0:n.type,nodeDesc:v,nodeJson:n.nodeJSON,nodeTemplate:n,disabled:!o,children:(0,a.jsx)(ed,{name:null!=d?d:"",icon:c,keyword:l,onClick:e=>null==r?void 0:r({event:e,nodeTemplate:n})})},u)})()},eh=e=>{var t,{pluginNodeList:n,hasMore:r,onLoadMore:l,showExploreMore:s,categoryName:d}=e,{keyword:u,enableDrag:c,onSelect:p,onAddingNode:f}=P(),h=(0,i.useMemo)(()=>{if(!n)return n;var e=n.length;if(!r||e<R.IV)return n;var t=(e-R.IV)/R.wh;if(t%1>0){var o=Math.floor(t)*R.wh+R.IV;return n.slice(0,o).concat(R.TQ)}return n.concat(R.TQ)},[n,r]),[g,x]=(0,i.useState)(),_=(0,i.useMemo)(()=>{if(!!(0,ec.Z)(g)){if(g%2==0){var e;return Math.min(g+1,(null!==(e=null==h?void 0:h.length)&&void 0!==e?e:0)-1)}return g}},[g,h]),y=(0,i.useMemo)(()=>{var e,t,n,o;return(0,ec.Z)(g)&&(null!==(o=null==h?void 0:null===(t=h[g])||void 0===t?void 0:null===(e=t.tools)||void 0===e?void 0:e.length)&&void 0!==o?o:0)>1?null==h?void 0:null===(n=h[g])||void 0===n?void 0:n.tools:void 0},[g,h]),j=(0,w.oO)();var b=(t=(0,o._)(function*(e,t){try{null==f||f(!0);var{plugin_id:n,version:o}=t;if(!(yield j.addApiCheck(n,o)))return!1;null==p||p({event:e,nodeTemplate:t})}finally{null==f||f(!1)}}),function(e,n){return t.apply(this,arguments)});return(null==h?void 0:h.length)?(0,a.jsxs)("div",{className:ev.Z["plugin-node-list-container"],children:[(0,a.jsxs)("div",{className:I()("flex flex-row pl-1 mb-1 items-center leading-5",ev.Z["plugin-node-list-header"]),children:[(0,a.jsx)(m.ZT.Text,{className:"coz-fg-secondary leading-5",weight:500,size:"normal","data-testid":(0,v.xtp)("workflow.detail.node-panel.list.category.name","favorite-plugin"),children:d}),s?(0,a.jsxs)("div",{className:I()("flex-row items-center cursor-pointer",ev.Z["explore-more"]),onClick:e=>{var t={type:v.nyy.Api};null==p||p({event:e,nodeTemplate:t})},children:[(0,a.jsx)("div",{className:"w-[1px] h-3 mx-2 coz-stroke-primary border-l-[1px] border-r-0 border-solid"}),(0,a.jsx)(m.ZT.Text,{className:"coz-fg-secondary leading-5",size:"normal",weight:500,children:E.o.t("workflow_0224_04")}),(0,a.jsx)(D.x5d,{className:"coz-fg-secondary text-[16px]"})]}):null]}),(0,a.jsx)("div",{className:ev.Z["plugin-node-list"],"data-testid":"workflow.detail.node-panel.list.category.list",children:h.map((e,t)=>{var n=e===R.TQ?(0,a.jsx)(en,{onLoadMore:l}):(0,a.jsx)(em,{nodeTemplate:e,enableDrag:c,onSelect:e=>{var{event:t,nodeTemplate:n}=e;return b(t,n)},expand:g===t,onExpandChange:e=>{e?x(t):x(void 0)},keyword:u,index:t},e.plugin_id);return(0,a.jsxs)(a.Fragment,{children:[n,_===t&&(null==y?void 0:y.length)?(0,a.jsx)("div",{className:ev.Z["plugin-tool-list"],children:y.map((e,t)=>{var n;return(0,a.jsx)(ei,{tooltipPosition:t%2==0?"left":"right",nodeType:null==e?void 0:e.type,nodeDesc:e.desc,nodeJson:e.nodeJSON,nodeTemplate:e,disabled:!c,children:(0,a.jsx)(ep,{name:null!==(n=e.name)&&void 0!==n?n:"",keyword:u,onClick:t=>b(t,e)})},null==e?void 0:e.api_id)})}):null]})})})]}):null},eg=e=>{var{data:t}=e,{onLoadMore:n}=P();return(0,a.jsx)(a.Fragment,{children:t.map(e=>{var{id:t,categoryName:r,nodeList:l,hasMore:i,cursor:s}=e;return(0,a.jsx)(eh,{categoryName:null!=r?r:"",pluginNodeList:l,hasMore:i,onLoadMore:(0,o._)(function*(){yield null==n?void 0:n(t,null!=s?s:"")})},t)})})},ex=e=>{var{data:t}=e,{keyword:n,enableDrag:o,onSelect:r}=P();return(0,a.jsx)(a.Fragment,{children:t.map(e=>{var{categoryName:t,nodeList:l}=e;return(0,a.jsx)(et,{categoryName:t,children:l.map((e,t)=>{var l,i;return(0,a.jsx)(ei,{tooltipPosition:t%2==0?"left":"right",nodeType:null==e?void 0:e.type,nodeDesc:(0,s.Z)(e,"desc"),nodeJson:(0,s.Z)(e,"nodeJSON"),nodeTemplate:e,disabled:!o,children:(0,a.jsx)(ed,{name:null!==(l=e.name)&&void 0!==l?l:"",icon:null!==(i=e.icon_url)&&void 0!==i?i:"",hideOutline:(0,g.em)(e),keyword:n,onClick:t=>null==r?void 0:r({event:t,nodeTemplate:e})})},"".concat(null==e?void 0:e.type,"_").concat(e.name))})},t)})})},e_=n("825788"),ey=e=>{var{sectionData:t}=e,{getScrollContainer:n}=P(),o=(0,i.useRef)(null),[r,l]=(0,i.useState)(!1);return(0,i.useLayoutEffect)(()=>{var e=null==n?void 0:n();if(!!o.current&&!!e){var t=e.getBoundingClientRect().top,r=()=>{var n=o.current;if(!!n)l(0===Math.round(t-n.getBoundingClientRect().top)&&0!==e.scrollTop)},a=(0,C.Z)(()=>r(),200);return e.addEventListener("scroll",a),()=>e.removeEventListener("scroll",a)}},[]),(0,a.jsxs)("div",{className:e_.Z["search-result-section"],children:[(0,a.jsx)("div",{className:I()(e_.Z["search-result-section-title"],{[e_.Z.sticky]:r}),ref:o,children:t.name}),(0,a.jsx)("div",{className:e_.Z["search-result-section-content"],children:(e=>{var{dataType:t,data:n}=e;if(t===U.A.Atom)return(0,a.jsx)(ex,{data:n});if(t===U.A.Plugin)return(0,a.jsx)(eg,{data:n});if(t===U.A.SubWorkflow)return(0,a.jsx)(eu,{data:n})})(t)})]})},ew=e=>{var{searchResult:t,loading:n}=e,o=(0,i.useMemo)(()=>n&&1===t.length&&t[0].dataType===U.A.Atom,[t,n]),r=(0,i.useMemo)(()=>n&&(0===t.length||t.some(e=>e.dataType!==U.A.Atom)),[t,n]);return(0,a.jsxs)("div",{className:"flex flex-col pb-4","data-testid":"workflow.detail.node-panel.list",children:[t.map(e=>{var t="".concat(e.dataType,"_").concat(e.name);return(0,a.jsx)(ey,{sectionData:e},t)}),o?(0,a.jsxs)("div",{className:"w-full flex items-center justify-center gap-[4px]",children:[(0,a.jsx)(m.gb,{className:"coz-fg-secondary",loading:!0,size:"mini"}),(0,a.jsx)(m.ZT.Text,{className:"coz-fg-secondary relative top-[-2px]",weight:500,children:E.o.t("loading")})]}):null,r?(0,a.jsx)("div",{className:e_.Z["mask-loading"],children:(0,a.jsx)(m.gb,{className:"coz-fg-secondary",label:(0,a.jsx)(m.ZT.Text,{className:"coz-fg-secondary relative top-[-4px]",weight:500,children:E.o.t("loading")}),loading:!0,size:"large",children:(0,a.jsx)("div",{})})}):null]})},ej=(0,i.forwardRef)((e,t)=>{var{pluginNodeList:n,hasMore:o,loadMore:r,refetch:l}=B();return((0,i.useImperativeHandle)(t,()=>({refetch:l})),(0,i.useEffect)(()=>{l()},[]),null==n?void 0:n.length)?(0,a.jsx)(eh,{categoryName:E.o.t("workflow_0224_03"),pluginNodeList:n,hasMore:o,onLoadMore:r,showExploreMore:!0}):null}),eb=(0,i.forwardRef)((e,t)=>{var{onSelect:n,enableDrag:r=!1,containerNode:l,adaptiveHeight:s,onAddingNode:d}=e,u=O(l),c=(0,i.useRef)(),[v,p]=(0,i.useState)(!1),[f,h]=(0,i.useState)(""),{showSearchResult:g,searchResult:x,isSearching:_,noSearchResult:y,loadMore:w,keyword:j,handleKeywordChange:b}=Y({atomNodeCategoryList:u});(0,i.useEffect)(()=>{if(!c.current||g){p(!1);return}var e,t,n=c.current,o=(0,C.Z)(()=>{var e;(null!==(e=n.scrollTop)&&void 0!==e?e:0)>0?p(!0):p(!1)},R.m4);return p((null!==(t=null===(e=c.current)||void 0===e?void 0:e.scrollTop)&&void 0!==t?t:0)>0),n.addEventListener("scroll",o),()=>n.removeEventListener("scroll",o)},[g]);var k=(0,i.useRef)();return(0,i.useImperativeHandle)(t,()=>({refetch:(0,o._)(function*(){var e;yield null===(e=k.current)||void 0===e?void 0:e.refetch()})})),(0,i.useEffect)(()=>{b(f.replaceAll(" ",""))},[f]),(0,a.jsxs)("div",{className:N.Z["node-panel"],style:{height:s,width:R.ak},"data-flow-editor-selectable":"false","data-testid":"workflow.detail.node-panel",children:[(0,a.jsx)("svg",{style:{width:0,height:0,display:"block"},children:(0,a.jsx)("clipPath",{id:"favorite-plugin-clip-path",clipPathUnits:"objectBoundingBox",children:(0,a.jsx)("path",{d:"M0,1 H1 V0 C1,0.552,0.552,1,0,1"})})}),(0,a.jsx)("div",{className:I()(N.Z["node-search"],v?N.Z["node-search-shadow"]:""),"data-testid":"workflow.detail.node-panel.search",children:(0,a.jsx)(m.II,{className:N.Z["node-search-input"],showClear:!0,placeholder:E.o.t("workflow_250306_01"),value:f,onClear:()=>h(""),onChange:h,prefix:(0,a.jsx)(D.SHo,{style:{fontSize:"16px"}})})}),y?(0,a.jsx)(m.ub,{className:"mx-auto mt-[128px] max-w-[270px]",icon:(0,a.jsx)(D.nL$,{}),size:"large",title:E.o.t("workflow_250305_001"),description:E.o.t("workflow_250305_002")}):null,(0,a.jsxs)(T.fC,{className:I()("node-panel-render",N.Z["node-list"]),children:[(0,a.jsx)(T.ap,{ref:c,className:N.Z.viewport,children:(0,a.jsx)(M,{value:{onSelect:n,enableDrag:r,keyword:j,getScrollContainer:()=>c.current,onLoadMore:w,onAddingNode:d},children:g?(0,a.jsx)(ew,{searchResult:x,loading:_}):(0,a.jsxs)("div",{className:N.Z["list-wrapper"],"data-testid":"workflow.detail.node-panel.list",children:[(0,a.jsx)(ex,{data:[u[0]]}),(0,a.jsx)(ej,{ref:k}),(0,a.jsx)(ex,{data:u.slice(1)})]})})}),(0,a.jsxs)(T.gb,{className:N.Z.scrollbar,orientation:"vertical",children:[(0,a.jsx)(T.q4,{className:N.Z["scrollbar-thumb"]}),(0,a.jsx)(T.lj,{className:N.Z["scrollbar-corner"]})]})]})]})}),eN=e=>{var t,n,{onSelect:b,position:N,onClose:C,containerNode:S}=e,I=(0,u.G2)(h.j);var T=(t=(0,o._)(function*(e){var t,{nodeType:n,selectEvent:o,nodeJSON:r}=e,l=(0,x.pC)(n);try{yield null==l?void 0:null===(t=l.onInit)||void 0===t?void 0:t.call(l,r,I)}catch(e){p.E7.errorEvent({eventName:"workflow_registry_v2_on_init_error",namespace:"workflow",error:e})}b({nodeType:n,selectEvent:o,nodeJSON:r})}),function(e){return t.apply(this,arguments)}),E=e.panelProps,D=(0,u.Dc)(),Z=(0,i.useRef)(!1),{openPlugin:M,openWorkflow:P,openImageflow:L,updateAddNodePosition:z}=(0,j.U)(),O=(0,_.O)(),A=(0,w.xs)(),F=(0,i.useMemo)(()=>{var e,t=document.body.clientHeight;if(E.fromAddNodeBtn)e=Math.min(580,t-64);else{var n=D.config.toFixedPos(N).y,o=document.body.clientHeight-n;e=Math.min(580,Math.max(n,o))}return 580===e?580:e},[N,D,E.fromAddNodeBtn]),R=(0,i.useRef)(),V=(0,u.G2)(c.t);var B=(n=(0,o._)(function*(e){var{event:t,nodeTemplate:n}=e,{type:a}=n;if((0,g.a1)(n)||(0,g.qc)(n)){a===v.nyy.Api&&(0,f.E)();var{nodeJSON:i}=n,u=(0,s.Z)(i,"data.nodeMeta.title");u&&(0,d.Z)(i,"data.nodeMeta.title",V.createUniqTitle(u)),yield T({nodeType:a,selectEvent:t,nodeJSON:i});return}if(a&&[v.nyy.Api,v.nyy.SubWorkflow,v.nyy.Imageflow].includes(a)){null==z||z((0,l._)((0,r._)({},N),{isDrag:!1}));var c,p,m,h,x=(c=(0,o._)(function*(e){var{nodeJSON:n}=e;yield T({nodeType:a,selectEvent:t,nodeJSON:n}),Z.current=!1}),function(e){return c.apply(this,arguments)}),_=e=>{if(Z.current=!1,e===y.U.OpenNewTab)G();else if(a===v.nyy.Api){var t;null===(t=R.current)||void 0===t||t.refetch()}};Z.current=!0,a===v.nyy.Api?((0,f.E)(),(0,g.em)(n)&&(p=n.categoryInfo),null==M||M({onAdd:x,onClose:_,closeOnAdd:!(null==E?void 0:E.enableModalMultiAdd),modalProps:{initQuery:{type:null==p?void 0:p.categoryId,isOfficial:null!=p&&!!p.onlyOfficial||void 0}}})):null===(m=(h={[v.nyy.Imageflow]:L,[v.nyy.SubWorkflow]:P})[a])||void 0===m||m.call(h,{onAdd:x,onClose:_,closeOnAdd:!(null==E?void 0:E.enableModalMultiAdd)})}else yield T({nodeType:a,selectEvent:t})}),function(e){return n.apply(this,arguments)}),G=()=>{if(!Z.current)C()};return(0,i.useEffect)(()=>{if(!!E.enableScrollClose){var e=D.onScroll(()=>{G()});return()=>e.dispose()}},[E,D]),(0,i.useEffect)(()=>{var e=O.onPreviewUpdated(e=>{var{previewVisible:t}=e;t&&G()});return()=>{var t;null==e||null===(t=e.dispose)||void 0===t||t.call(e)}},[O]),(0,i.useEffect)(()=>{(null==A?void 0:A.refreshModalVisible)&&G()},[null==A?void 0:A.refreshModalVisible]),(0,a.jsx)(m.J2,{visible:!0,showArrow:!1,trigger:"custom",position:"bottomLeft",motion:!1,onClickOutSide:e=>{!(E.anchorElement&&e.target.closest(E.anchorElement))&&G()},onEscKeyDown:G,style:{borderRadius:"var(--coze-12)",boxShadow:"0 2px 6px 0 rgba(var(--coze-shadow-0),.04),0 4px 12px 0 rgba(var(--coze-shadow-0),.02)",border:"1px solid var(--coz-stroke-primary)",padding:0,background:"var(--coz-bg-plus)"},zIndex:999,content:(0,a.jsx)(eb,{ref:R,adaptiveHeight:F,enableDrag:null==E?void 0:E.enableDrag,onSelect:B,containerNode:S,onAddingNode:e=>Z.current=e}),children:(0,a.jsx)("div",{style:{position:"absolute",top:N.y,left:N.x,transform:E.enableNodePlaceholder?"translateY(-50%)":void 0,zIndex:999},children:E.enableNodePlaceholder?(0,a.jsx)(k,{}):null})})}},286986:function(e,t,n){n.d(t,{q:()=>s,hB:()=>g,Uj:()=>x,JM:()=>y});var o=n("151064"),r=n("252237"),l=n.n(r),a=n("674343"),i=n("739347"),s=e=>{var t=e.invalid?"yellow":"primary";return e.tooltip&&!e.invalid?(0,o.jsx)(a.u,{content:e.tooltip,children:(0,o.jsx)(a.Vp,{color:t,className:l()(i.Z["condition-tag"],"font-medium truncate w-full"),children:e.children})}):(0,o.jsx)(a.Vp,{color:t,className:l()(i.Z["condition-tag"],"font-medium truncate w-full"),children:e.children})},d=n("450562"),u=n("336205"),c=e=>{var{logic:t}=e;return(0,o.jsxs)("div",{className:"relative text-center py-1",children:[(0,o.jsx)("div",{className:"absolute top-[50%] -mt-[1px] coz-stroke-primary w-full border-0 border-b border-solid"}),(0,o.jsx)("span",{className:"min-w-[28px] relative inline-block coz-bg-max",children:t===d.sSN.AND?u.o.t("workflow_detail_condition_and"):u.o.t("workflow_detail_condition_or")})]})},v=n("686436"),p=n("306215"),f=n("886829"),m=n("795250"),h=n("218353"),g=e=>{var t,n,r,l,a,i,{keyPath:d}=e;var{variable:u,valid:c}=(t=null!=d?d:[],n=(0,v.PF)(),{valid:!!(r=(0,v.G2)(h.a)).getVariableFacadeByKeyPath(t,{node:n,checkScope:!0}),variable:r.getVariableFacadeByKeyPath(t,{node:n})}),g=(0,v.PF)();if((0,m.w)(g),!d||!d.length)return null;var x=null==u?void 0:null===(l=u.node)||void 0===l?void 0:l.getData(f.m),_=null==x?void 0:x.getNodeData(),y=(null==u?void 0:u.globalVariableKey)?(0,p.hw)(null==u?void 0:u.globalVariableKey):void 0,w=(null==_?void 0:_.title)||y;return(0,o.jsxs)(s,{invalid:!c,tooltip:(0,o.jsxs)("span",{children:[(0,o.jsxs)("span",{children:[w,(0,o.jsx)("span",{className:"mx-2",children:"-"})]}),null==u?void 0:null===(a=u.viewMeta)||void 0===a?void 0:a.name]}),children:[(0,o.jsxs)("span",{children:[w,(0,o.jsx)("span",{className:"mx-2",children:"-"})]}),null==u?void 0:null===(i=u.viewMeta)||void 0===i?void 0:i.name]})},x=e=>{var{conditions:t=[],logic:n=d.sSN.AND}=e;return(0,o.jsx)("div",{className:"coz-stroke-plus coz-bg-max border border-solid py-1 rounded-mini text-xs coz-fg-primary min-h-[32px]",children:t.map((e,r)=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex items-center px-1",children:[(0,o.jsx)("div",{className:"flex-1 min-w-0 overflow-hidden",children:e.left}),(0,o.jsx)("div",{className:"flex items-center flex-grow-0 flex-shrink-0 basis-[0] px-2 ",children:e.operator}),(0,o.jsx)("div",{className:"flex-1 min-w-0 overflow-hidden",children:e.right})]}),r<t.length-1?(0,o.jsx)(c,{logic:n}):null]}))})},_={[d.CPf.Null]:"Empty",[d.CPf.NotNull]:"Empty",[d.CPf.True]:"true",[d.CPf.False]:"false"},y=e=>{var t,{value:n,operator:r}=e;return[d.CPf.Null,d.CPf.NotNull,d.CPf.True,d.CPf.False].includes(r)?(0,o.jsx)(s,{children:_[r]}):n&&(null==n?void 0:n.type)!==d.YX3.OBJECT_REF?(null==n?void 0:n.type)!==d.YX3.LITERAL?(0,o.jsx)(g,{keyPath:null==n?void 0:null===(t=n.content)||void 0===t?void 0:t.keyPath}):Array.isArray(n.content)?(0,o.jsx)(s,{tooltip:n.content.join(", "),children:n.content.join(", ")}):(0,o.jsx)(s,{tooltip:String(n.content),children:String(n.content)}):null}},769834:function(e,t,n){n.d(t,{E:function(){return a}});var o=n(151064),r=n(336205),l=n(399226);function a(){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(l.EU,{label:r.o.t("workflow_detail_node_output")}),(0,o.jsx)(l.uZ,{})]})}},883150:function(e,t,n){n.d(t,{z:function(){return s}});var o=n(151064),r=n(450562),l=n(915757),a=(0,o.jsx)(l.Nxk,{}),i=(0,o.jsx)(l.ew7,{}),s={[r.owu.String]:(0,o.jsx)(l.ls7,{}),[r.owu.Integer]:(0,o.jsx)(l.jLw,{}),[r.owu.Number]:(0,o.jsx)(l.j$I,{}),[r.owu.Boolean]:(0,o.jsx)(l.WbN,{}),[r.owu.Object]:(0,o.jsx)(l.nCh,{}),[r.owu.Image]:(0,o.jsx)(l.Q2$,{}),[r.owu.Time]:(0,o.jsx)(l.kSS,{}),[r.owu.File]:a,[r.owu.Doc]:a,[r.owu.Code]:a,[r.owu.Ppt]:a,[r.owu.Txt]:a,[r.owu.Excel]:a,[r.owu.Audio]:a,[r.owu.Zip]:a,[r.owu.Video]:a,[r.owu.Svg]:a,[r.owu.Voice]:(0,o.jsx)(l.e17,{}),[r.owu.ArrayString]:(0,o.jsx)(l.mcR,{}),[r.owu.ArrayInteger]:(0,o.jsx)(l.TeG,{}),[r.owu.ArrayNumber]:(0,o.jsx)(l.VNw,{}),[r.owu.ArrayBoolean]:(0,o.jsx)(l.m5O,{}),[r.owu.ArrayObject]:(0,o.jsx)(l.yRc,{}),[r.owu.ArrayImage]:(0,o.jsx)(l.quZ,{}),[r.owu.ArrayFile]:i,[r.owu.ArrayDoc]:i,[r.owu.ArrayCode]:i,[r.owu.ArrayPpt]:i,[r.owu.ArrayTxt]:i,[r.owu.ArrayExcel]:i,[r.owu.ArrayAudio]:i,[r.owu.ArrayZip]:i,[r.owu.ArrayVideo]:i,[r.owu.ArraySvg]:i,[r.owu.ArrayVoice]:i,[r.owu.ArrayTime]:(0,o.jsx)(l.rYO,{})}},109870:function(e,t,n){n.d(t,{h:()=>v});var o=n("151064"),r=n("286986"),l=n("399226"),a=n("962289"),i=n("450562");function s(e){var{value:t,operator:n}=e,l={IS_NULL:"Empty",IS_NOT_NULL:"Empty",BE_TRUE:"true",BE_FALSE:"false"};return n&&l[n]?(0,o.jsx)(r.q,{children:l[n]}):t?(0,o.jsx)(r.JM,{value:t}):null}var d=n("348785");function u(e){var{value:t}=e;return t?d.X[t].operationIcon:null}function c(e){var{value:t}=e;return t?(0,o.jsx)(r.q,{children:t}):null}function v(e){var{label:t,name:n}=e,{conditionList:d=[],logic:v}=function(e){var{data:t}=(0,i.rsR)();return(0,a.Z)(t,e,[])}(n);return(0,o.jsx)(l.gN,{label:t,isEmpty:0===d.length,children:(0,o.jsx)(r.Uj,{conditions:d.map(e=>({left:(0,o.jsx)(c,{value:e.left}),operator:(0,o.jsx)(u,{value:e.operator}),right:(0,o.jsx)(s,{value:e.right,operator:e.operator})})),logic:v})})}},252807:function(e,t,n){n.d(t,{t:function(){return i}});var o=n(151064),r=n(336205),l=n(896335),a=n(744839);function i(e){var{fieldName:t}=e;return(0,o.jsx)("div",{className:a.Z["field-empty"],children:(0,o.jsxs)("span",{className:"flex-1 overflow-hidden truncate nowrap",children:[(0,l.Z)(t)?"".concat(r.o.t("workflow_240919_01")).concat(t):r.o.t("workflow_240919_01"),!(0,l.Z)(t)&&t]})})}},280911:function(e,t,n){n.d(t,{g:function(){return s}});var o=n(151064),r=n(252237),l=n.n(r),a=n(252807),i=n(482053);function s(e){var{label:t,isEmpty:n=!1,children:r,labelClassName:s,contentClassName:d,customEmptyLabel:u}=e;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:l()(i.Z.label,s),children:t}),(0,o.jsx)("div",{className:"".concat(i.Z.content," ").concat(d),children:n?(0,o.jsx)(a.t,{fieldName:null!=u?u:t}):r})]})}},399226:function(e,t,n){n.d(t,{G3:()=>v,v3:()=>ee,uZ:()=>M.u,gN:()=>i.g,WA:()=>j,EU:()=>p.E,N8:()=>N,An:()=>Z,hK:()=>Q.h,Hn:()=>g,yC:()=>x.y,uL:()=>b.u,yJ:()=>Y});var o=n("151064"),r=n("450562"),l=n("336205"),a=n("109207"),i=n("280911"),s=n("915757"),d=n("286986"),u=e=>{var{operator:t}=e,n={1:(0,o.jsx)(s.Gb9,{}),2:(0,o.jsx)(s.kJo,{}),3:(0,o.jsx)(s.v7X,{}),4:(0,o.jsx)(s.rsJ,{}),5:(0,o.jsx)(s.lYK,{}),6:(0,o.jsx)(s.rPl,{}),7:(0,o.jsx)(s.rZz,{}),8:(0,o.jsx)(s.ujf,{}),9:(0,o.jsx)(s.Gb9,{}),10:(0,o.jsx)(s.kJo,{}),11:(0,o.jsx)(s.Gb9,{}),12:(0,o.jsx)(s.Gb9,{}),13:(0,o.jsx)(s.v7X,{}),14:(0,o.jsx)(s.rsJ,{}),15:(0,o.jsx)(s.lYK,{}),16:(0,o.jsx)(s.rPl,{})};return t?(0,o.jsx)("div",{className:"text-center flex",children:n[t]}):null},c=e=>{var{branch:t}=e,{conditions:n=[],logic:r}=t;return(0,o.jsx)(d.Uj,{conditions:n.map(e=>{var t,n;return{left:(0,o.jsx)(d.hB,{keyPath:null===(n=e.left)||void 0===n?void 0:null===(t=n.content)||void 0===t?void 0:t.keyPath}),operator:(0,o.jsx)(u,{operator:e.operator}),right:(0,o.jsx)(d.JM,{value:e.right,operator:e.operator})}}),logic:r})};function v(){var{data:e}=(0,r.rsR)(),t=null==e?void 0:e.condition;return(0,o.jsxs)(o.Fragment,{children:[null==t?void 0:t.map((e,t)=>{var n=l.o.t("worklfow_condition_if",{},"If");return t>0&&(n=l.o.t("worklfow_condition_else_if",{},"Else if")),(0,o.jsxs)(i.g,{label:n,children:[(0,o.jsx)(c,{branch:e.condition}),(0,o.jsx)(a.G,{id:function(e){return 0===e?"true":"true_".concat(e)}(t),type:"output"})]})}),(0,o.jsxs)(i.g,{label:l.o.t("workflow_detail_condition_else"),children:[(0,o.jsx)("div",{className:"h-8 coz-stroke-plus coz-bg-max border border-solid p-1 rounded-mini"}),(0,o.jsx)(a.G,{id:"false",type:"output"})]})]})}var p=n("808248"),f=n("455069"),m=n("674343"),h=n("184449");function g(){var e,t,{data:n}=(0,r.rsR)(),[a,s]=(0,f.useState)(null==n?void 0:null===(e=n.model)||void 0===e?void 0:e.modelName),{models:d}=(0,h.C5)();return(0,f.useEffect)(()=>{var e;if(null==n?void 0:null===(e=n.model)||void 0===e?void 0:e.modelType){var t=d.find(e=>{var t;return e.model_type===(null==n?void 0:null===(t=n.model)||void 0===t?void 0:t.modelType)});t&&s(t.name)}},[d,n,null==n?void 0:n.model]),(0,o.jsx)(i.g,{label:l.o.t("workflow_detail_llm_model"),isEmpty:!a,children:(0,o.jsxs)("div",{className:"flex items-center leading-[20px]",children:[(0,o.jsx)(m.EZ,{size:"mini",shape:"square",src:null===(t=d.find(e=>{var t;return e.model_type===(null==n?void 0:null===(t=n.model)||void 0===t?void 0:t.modelType)}))||void 0===t?void 0:t.model_icon,className:"shrink-0 h-4 w-4 mr-1","data-testid":"bot-detail.model-config-modal.model-avatar"}),a]})})}var x=n("333882"),_=n("736892"),y=n("58946"),w=n("80597");function j(){var{data:e}=(0,r.rsR)(),t=(null==e?void 0:e.intentMode)===_.yp.MINIMAL?null==e?void 0:e.quickIntents:null==e?void 0:e.intents;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"mt-[20px]"}),(0,o.jsx)("div",{className:"mt-[20px]"}),null==t?void 0:t.map((e,t)=>(0,o.jsxs)(i.g,{label:l.o.t("workflow_ques_ans_type_option_title"),children:[(0,o.jsx)(w.R,{showLabel:!1,label:"",content:null==e?void 0:e.name,maxWidth:260},(null==e?void 0:e.name)+t),(0,o.jsx)(a.G,{id:(0,y.n)(t),type:"output"})]},t)),(0,o.jsx)(i.g,{label:l.o.t("workflow_ques_ans_type_option_other"),children:(0,o.jsx)(a.G,{id:"default",type:"output"})})]})}var b=n("465554");function N(){var e,t,n,{data:a}=(0,r.rsR)(),s=null!==(n=null==a?void 0:null===(t=a.inputs)||void 0===t?void 0:null===(e=t.datasetParameters)||void 0===e?void 0:e.datasetParam)&&void 0!==n?n:[],{dataSets:d}=(0,h.Z3)({ids:s});return(0,o.jsx)(i.g,{label:l.o.t("workflow_detail_knowledge_knowledge"),isEmpty:0===s.length,children:(0,o.jsx)(b.u,{value:d.map(e=>({label:e.name,icon:(0,o.jsx)("img",{className:"w-[16px] h-[16px] rounded-mini",src:e.icon_url})}))})})}var k=n("686436"),C=n("537916"),S=n("339328"),I=n("255481"),T=n("610517"),E=n("292528"),D=e=>{for(var t="";e>=0;)t=String.fromCharCode(e%26+65)+t,e=Math.floor(e/26)-1;return t};function Z(){var e,t,{data:n}=(0,r.rsR)(),s=(0,k.PF)(),d=null==n?void 0:n.questionParams,u=(0,f.useMemo)(()=>(null==d?void 0:d.answer_type)===C.o.Option,[null==d?void 0:d.answer_type]),c=(0,f.useMemo)(()=>(null==d?void 0:d.option_type)===C.G.Dynamic,[null==d?void 0:d.option_type]),v=(0,f.useMemo)(()=>null==d?void 0:d.dynamic_option,[null==d?void 0:d.dynamic_option]),p=(0,I.l)([{name:l.o.t("workflow_question_dynamic",{},"dynamicOption"),input:v}]);return(0,f.useEffect)(()=>{s.getData(k.QW).updateDynamicPorts()},[c]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.g,{label:l.o.t("workflow_ques_content",{},"提问内容"),isEmpty:!(null==d?void 0:d.question),children:(0,o.jsx)(T.n,{customClassName:E.Z.question_pairs_content,maxWidth:230,content:null!==(t=null==d?void 0:d.question)&&void 0!==t?t:""})}),(0,o.jsx)(i.g,{label:l.o.t("workflow_240919_02",{},"问答类型"),children:(0,o.jsx)("div",{className:E.Z.question_pairs_content,children:u?l.o.t("workflow_ques_ans_type_option",{},"选项回答"):l.o.t("workflow_ques_ans_type_direct",{},"直接回答")})}),u?(0,o.jsxs)(o.Fragment,{children:[c?(0,o.jsxs)(i.g,{label:"",children:[(0,o.jsx)(w.R,{label:l.o.t("workflow_question_az",{},"A~Z"),content:(0,o.jsx)(S._,{value:p})}),(0,o.jsx)(a.G,{id:"branch_0",type:"output"})]}):null==d?void 0:null===(e=d.options)||void 0===e?void 0:e.map((e,t)=>(0,o.jsxs)(i.g,{label:"",children:[(0,o.jsx)(w.R,{label:D(t),content:null==e?void 0:e.name}),(0,o.jsx)(a.G,{id:"branch_".concat(t),type:"output"})]})),(0,o.jsxs)(i.g,{label:"",children:[(0,o.jsx)(w.R,{label:l.o.t("workflow_ques_ans_type_option_other",{},"其他"),content:l.o.t("workflow_240919_03",{},"用户不可见")}),(0,o.jsx)(a.G,{id:"default",type:"output"})]})]}):null]})}var M=n("965076");n("850624");var P=n("25232"),L=n("252237"),z=n.n(L),O=n("306215"),A=n("533733"),F=n("469541"),R=n("161607"),V=n("295197"),B=n("808549"),G=n("120454"),W=n("615655"),U=n("335740"),H=n("130989"),J=n("496608"),q={[O.fK.App]:(0,o.jsx)(s.Nxk,{}),[O.fK.User]:(0,o.jsx)(s.U5H,{}),[O.fK.System]:(0,o.jsx)(s.qBd,{})},K=(e,t)=>{var{apiUrl:n,isTooltips:r=!1,setTipsVisible:a}=e,i=(0,A.Z)(),d=(0,f.useRef)(null),u=(0,f.useRef)(null),[c,v]=(0,f.useState)(!1),p=(0,F.l)(),{getNodeInfoInVariableMeta:h}=(0,V.U)(),{urlVariables:g=[],splitedUrl:x=[]}=function(e){var{urlExpressionString:t,availableVariables:n,getVariableByKeyPath:o}=e,[r,l]=(0,f.useState)([]),[a,i]=(0,f.useState)([]),s=/{{([^}]+)}}/g,d=(0,f.useRef)(""),u=(0,f.useRef)([]);return(0,f.useEffect)(()=>{if(!t)return;var e,r=d.current!==t;r&&(d.current=t);var a=!(0,W.Z)(u.current,n);if(a&&(u.current=(0,U.Z)(n)),!!r||!!a){for(var c=[],v=[],p=0;e=s.exec(t);){;var f=e[0],{globalVariableKey:m,nodeName:h,fieldPart:g,fieldKeyPath:x,parsedKeyPath:_}=(0,H.oW)(e[1]),y=o(null!=x?x:[]),w=(0,H.W3)(n,{globalVariableKey:m,nodePart:h,fieldPart:g,parsedKeyPath:_},y),j=e.index,b=e.index+f.length;v.push({content:t.slice(p,e.index),isVariable:!1}),v.push({content:f,isVariable:!0}),p=e.index+f.length,c.push((0,G._)((0,B._)({},w),{content:f,startIndex:j,endIndex:b}))}p<t.length&&v.push({content:t.slice(p),isVariable:!1}),l(c),i(v)}},[t,n]),{urlVariables:r,splitedUrl:a}}({urlExpressionString:n,availableVariables:(0,R.p)(i,h),getVariableByKeyPath:p});return(0,f.useEffect)(()=>{var e=new ResizeObserver(e=>{var t,n;v(e[0].contentRect.height>(null!==(n=null===(t=u.current)||void 0===t?void 0:t.clientHeight)&&void 0!==n?n:0))});return d.current&&e.observe(d.current),()=>{d.current&&e.unobserve(d.current)}},[n]),(0,f.useEffect)(()=>{if(!r)null==a||a(c)},[c,r]),(0,o.jsxs)("div",{className:"relative overflow-hidden",children:[(0,o.jsx)("div",{ref:u,style:{maxHeight:r?"auto":"87px"},children:(0,o.jsx)("div",{ref:d,className:J.Z.container,children:null==x?void 0:x.map(e=>{if(!e.isVariable)return(0,o.jsx)("span",{className:"inline",children:e.content});var t=g.find(t=>e.content===t.content);return(null==t?void 0:t.isVariableExist)?(0,o.jsx)("span",{className:z()({[J.Z["wrapper-error"]]:!(null==t?void 0:t.isValid),[J.Z.nodeGlobal]:null==t?void 0:t.globalVariableKey}),children:(0,o.jsxs)(m.Vp,{color:"primary",className:z()(J.Z.node,{[J.Z.nodeError]:!(null==t?void 0:t.isValid)}),prefixIcon:(null==t?void 0:t.globalVariableKey)?q[null==t?void 0:t.globalVariableKey]:null,children:[!!(null==t?void 0:t.iconUrl)&&(0,o.jsx)("img",{src:t.iconUrl,className:"w-[14px] mr-[4px]"}),(0,o.jsx)("span",{className:J.Z["node-title"],children:t.nodeTitle}),(0,o.jsx)("span",{className:J.Z.split,children:"-"}),(0,o.jsx)("span",{className:z()(J.Z.content,"max-w-[160px]",{"!text-[#E53241]":!(null==t?void 0:t.isValid)}),children:t.parsedKeyPath})]})}):(0,o.jsx)("span",{className:J.Z["deleted-variable"],children:(0,o.jsx)(m.Vp,{prefixIcon:(0,o.jsx)(s.U6C,{}),children:l.o.t("node_http_var_infer_delete",{},"变量失效")})})})})}),c?(0,o.jsx)("div",{className:J.Z["text-subfix"]}):null]})};function X(e){var{apiUrl:t}=e,[n,r]=(0,f.useState)(!1),[l,a]=(0,f.useState)(!1),i="http-url-tips-".concat(Math.random());return(0,o.jsx)("div",{id:i,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:(0,o.jsx)(m.u,{trigger:"custom",visible:l&&n,motion:!1,style:{transform:"translateX(60%)",backgroundColor:"rgba(var(--coze-bg-3), 1)"},content:(0,o.jsx)(K,{apiUrl:t,isTooltips:!0}),getPopupContainer:()=>{var e;return null!==(e=document.getElementById(i))&&void 0!==e?e:document.body},children:(0,o.jsx)(K,{apiUrl:t,setTipsVisible:r})},"http-url-tips")})}function Y(){var e,t,n,{data:l}=(0,r.rsR)(),a=null==l?void 0:null===(e=l.inputs)||void 0===e?void 0:e.apiInfo,s=null==l?void 0:null===(n=l.inputs)||void 0===n?void 0:null===(t=n.apiInfo)||void 0===t?void 0:t.url;return(0,o.jsx)(i.g,{labelClassName:"h-full",label:(0,o.jsx)("div",{className:"leading-[22px]",children:null==a?void 0:a.method}),isEmpty:!s,customEmptyLabel:"URL",children:(0,o.jsx)(P.n,{children:(0,o.jsx)(X,{apiUrl:s})})})}var Q=n("109870"),$=n("962289");function ee(e){var{label:t,name:n}=e,{data:l,isLoading:a,error:s}=(0,h.ui)(),d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return null==e?void 0:e.map(e=>{var n=t.find(t=>t.id===e.fieldID);return function(e,t){var n,o=null===(n=e.fieldValue)||void 0===n?void 0:n.content;return{key:e.fieldID.toString(),label:null==t?void 0:t.name,type:null==t?void 0:t.type,status:o||!1===o?S.a.Default:S.a.Warning}}(e,n)})}(function(e){var{data:t}=(0,r.rsR)();return(0,$.Z)(t,e)}(n),s?[]:null==l?void 0:l.fields),u=0===d.length;return(0,o.jsx)(i.g,{label:t,isEmpty:u,children:a?null:(0,o.jsx)(S._,{value:d})})}},808248:function(e,t,n){n.d(t,{E:function(){return d}});var o=n(151064),r=n(450562),l=n(336205),a=n(339328),i=n(255481),s=n(280911);function d(e){var{label:t=l.o.t("workflow_detail_node_parameter_input")}=e,{inputParameters:n}=(0,r.rsR)(),d=(0,i.l)(n),u=!d||0===d.length;return(0,o.jsx)(s.g,{label:t,isEmpty:u,children:(0,o.jsx)(a._,{value:d})})}},610517:function(e,t,n){n.d(t,{n:function(){return a}});var o=n(151064),r=n(455069),l=n(674343),a=e=>{var{customClassName:t,maxWidth:n,content:a}=e,i=(0,r.useRef)(null),[s,d]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(i.current){var e;d((null===(e=i.current)||void 0===e?void 0:e.offsetWidth)>=n)}},[a,n]),(0,o.jsx)(l.u,{content:(0,o.jsx)("span",{className:"coz-fg-primary text-lg",children:null!=a?a:""}),style:{backgroundColor:"rgba(var(--coze-bg-3), 1)",display:s?"block":"none"},children:(0,o.jsx)("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap leading-[20px]",style:{maxWidth:s?"".concat(n,"px"):"auto"},children:(0,o.jsx)("span",{ref:i,className:t,children:null!=a?a:""})})})}},965076:function(e,t,n){n.d(t,{u:function(){return s}});var o=n(151064),r=n(450562),l=n(336205),a=n(80597),i=n(280911);function s(){var e,{data:t}=(0,r.rsR)(),n=null==t?void 0:null===(e=t.inputs)||void 0===e?void 0:e.content;return(0,o.jsx)(i.g,{label:l.o.t("workflow_241111_01"),children:(0,o.jsx)(a.R,{showLabel:!1,label:"",content:n,maxWidth:260})})}},333882:function(e,t,n){n.d(t,{y:()=>c});var o=n("151064"),r=n("450562"),l=n("336205"),a=n("339328"),i=n("455069"),s=n("686436"),d=n("37507"),u=n("280911");function c(e){var{label:t=l.o.t("workflow_detail_node_output")}=e,{outputs:n}=(0,r.rsR)(),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(0,s.PF)(),n=(0,s.JA)(),o=t.getData(d.z),r=e.map(e=>{var t;return{label:e.name,type:e.type||(null===(t=o.getVariableByKey(e.name))||void 0===t?void 0:t.viewType)}});return(0,i.useEffect)(()=>{var e=o.onAnyVariablesChange(()=>{n()});return()=>null==e?void 0:e.dispose()},[o,n]),r}(n),v=!c||0===c.length;return(0,o.jsx)(u.g,{label:t,isEmpty:v,children:(0,o.jsx)(a._,{value:c})})}},465554:function(e,t,n){n.d(t,{u:function(){return p}});var o=n(151064),r=n(455069),l=n(252237),a=n.n(l),i=n(915757),s=n(674343),d=n(775699),u=n(306495),c="tag-item-wrapper",v=e=>{var{icon:t,label:n=""}=e;return(0,o.jsxs)("div",{className:a()(u.Z.tagItem,u.Z.limitWidth,"gap-[4px]"),children:[t?(0,o.jsx)("span",{className:a()(u.Z.tagItemIcon,"text-lg","coz-fg-dim"),children:t}):null,(0,o.jsx)("span",{className:u.Z.tagItemLabel,children:n})]})};function p(e){var{value:t=[],enableTooltip:n,tagItemRenderer:l,dropdownClassName:p,disableMore:f}=e,m=e=>e.map(e=>{var{tooltip:t,key:r}=e,i=(null==l?void 0:l(e))||v(e),d=(0,o.jsx)("div",{className:a()(c,"max-w-full"),children:i},r);return t&&n?(0,o.jsx)(s.u,{content:(0,o.jsx)("span",{className:"coz-fg-primary text-lg",children:t}),style:{backgroundColor:"rgba(var(--coze-bg-3), 1)"},children:d},r?"tooltip-".concat(r):void 0):d}),h=(0,r.useRef)(null),[g,x]=(0,r.useState)(!1);return(0,r.useLayoutEffect)(()=>{if(!!h.current){var e,t,n=null!==(t=null===(e=h.current)||void 0===e?void 0:e.clientWidth)&&void 0!==t?t:0,o=Array.from(h.current.getElementsByClassName(c));if(null==o?void 0:o.length){var r=o[o.length-1];x(r.offsetWidth+r.offsetLeft>n)}else x(!1)}},[t]),(0,o.jsxs)("div",{ref:h,className:a()(u.Z.overflowTagList,"flex gap-1.5 items-center"),children:[m(t),g?(0,o.jsxs)("div",{className:u.Z.overlay,children:[(0,o.jsx)("div",{className:u.Z.overlayMask}),!f&&(0,o.jsx)(d.Lt,{position:"bottomRight",render:(0,o.jsx)("div",{className:a()("w-[230px] p-1.5 gap-1.5 flex flex-row flex-wrap",{[p]:p}),children:m(t)}),children:(0,o.jsx)(s.hU,{className:a()("w-full","h-full"),wrapperClass:a()("pointer-events-auto","text-[0px]","coz-bg-plus","w-[22px]","h-[20px]"),style:{height:"100%"},size:"mini",iconSize:"small",icon:(0,o.jsx)(i.NsR,{})})})]},"overlay"):null]})}},109207:function(e,t,n){n.d(t,{G:function(){return l}});var o=n(151064),r=n(636513);function l(e){var{id:t,type:n,style:l}=e;return(0,o.jsx)("div",{className:r.Z.port,"data-port-id":t,"data-port-type":n,style:l})}},80597:function(e,t,n){n.d(t,{R:function(){return u}});var o=n(151064),r=n(252237),l=n.n(r),a=n(336205),i=n(610517),s=n(252807),d=n(292528),u=e=>{var{label:t,content:n,showLabel:r=!0,maxWidth:u=148}=e;return(0,o.jsxs)("div",{className:"flex items-center w-full h-[20px]",children:[r?(0,o.jsx)("div",{className:l()(d.Z.tagItem,"px-1 py-0.5 gap-0.5 w-[50px] mr-[6px] flex items-center justify-center"),style:{flex:"0 0 50px"},children:(0,o.jsx)("span",{className:d.Z.tagItemLabel,children:null!=t?t:""})}):null,n?(0,o.jsx)(i.n,{customClassName:d.Z.question_pairs_content,maxWidth:u,content:null!=n?n:""}):(0,o.jsx)(s.t,{fieldName:a.o.t("workflow_ques_ans_type_option_content",{},"内容")})]})}},850624:function(e,t,n){n.d(t,{u:function(){return d}});var o=n(151064),r=n(450562),l=n(336205),a=n(674343),i=n(646909),s=n(280911),d=()=>{var e,{data:t}=(0,r.rsR)(),n=null===(e=i.wC.find(e=>{var n;return e.value===(null==t?void 0:null===(n=t.inputs)||void 0===n?void 0:n.terminatePlan)}))||void 0===e?void 0:e.label;return n?(0,o.jsx)(s.g,{label:l.o.t("wf_chatflow_131"),children:(0,o.jsx)("div",{className:"flex",children:(0,o.jsx)(a.ZT.Text,{className:"leading-[20px]",children:n})})}):null}},255481:function(e,t,n){n.d(t,{l:function(){return c}});var o=n(345420),r=n(155440),l=n(686436),a=n(664278),i=n(886829),s=n(450562),d=n(795250),u=(e,t)=>{var n,o,l=!1;return(null==e?void 0:e.required)&&((null==t?void 0:t.type)===s.YX3.REF?l=!(null==t?void 0:null===(o=t.content)||void 0===o?void 0:null===(n=o.keyPath)||void 0===n?void 0:n.length):(null==t?void 0:t.type)===s.YX3.LITERAL&&(l=(null==t?void 0:t.content)===""||(0,r.Z)(null==t?void 0:t.content))),l};function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(0,l.PF)(),n=(0,d.w)(t),{registry:c}=(0,s.rsR)();return e?(!Array.isArray(e)&&(e=Object.entries(e).map(e=>{var[t,n]=e;return{name:t,input:n}})),e.map(e=>{var{name:l,input:d}=e;if((0,o.Z)(null==c?void 0:null===(p=c.meta)||void 0===p?void 0:p.getInputVariableTag))return null==c?void 0:null===(m=c.meta)||void 0===m?void 0:m.getInputVariableTag(l,d,{variableService:n,node:t});var v=!1;if(null==d?void 0:null===(f=d.rawMeta)||void 0===f?void 0:f.type){if(h=null==d?void 0:null===(g=d.rawMeta)||void 0===g?void 0:g.type,d&&s.nZF.isRef(d)){;v=!n.getWorkflowVariableByKeyPath(null==d?void 0:null===(x=d.content)||void 0===x?void 0:x.keyPath,{node:t,checkScope:!0})}else d&&s.nZF.isLiteral(d)&&(v=(null==d?void 0:d.content)===""||(0,r.Z)(null==d?void 0:d.content))}else if((null==d?void 0:d.type)===s.YX3.LITERAL)h=(null==d?void 0:null===(_=d.rawMeta)||void 0===_?void 0:_.type)||s.owu.String;else if((null==d?void 0:d.type)===s.YX3.REF){var p,f,m,h,g,x,_,y,w=n.getWorkflowVariableByKeyPath(null==d?void 0:null===(y=d.content)||void 0===y?void 0:y.keyPath,{node:t,checkScope:!0});h=null==w?void 0:w.viewType}if(t.flowNodeType===s.nyy.SubWorkflow){var j,b,N,k=t.getData(i.m),C=null==k?void 0:k.getNodeData(),S=null==C?void 0:null===(j=C.inputsDefinition)||void 0===j?void 0:j.find(e=>e.name===l);v=u(S,d),S&&(h=a.N.DTOTypeToViewType(S.type,{arrayItemType:null==S?void 0:null===(b=S.schema)||void 0===b?void 0:b.type,assistType:null==S?void 0:null===(N=S.schema)||void 0===N?void 0:N.assistType}))}if(t.flowNodeType===s.nyy.Api){var I,T,E,D=t.getData(i.m),Z=null==D?void 0:D.getNodeData(),M=null==Z?void 0:null===(I=Z.inputs)||void 0===I?void 0:I.find(e=>e.name===l);M&&(h=a.N.DTOTypeToViewType(M.type,{arrayItemType:null==M?void 0:null===(T=M.schema)||void 0===T?void 0:T.type,assistType:null==M?void 0:null===(E=M.schema)||void 0===E?void 0:E.assistType})),v=u(M,d)}return(0,s.QJG)(l)&&!h&&(h=s.owu.String),{label:l,type:h,invalid:v}})):[]}},339328:function(e,t,n){n.d(t,{_:function(){return m},a:function(){return f}});var o,r=n(151064),l=n(455069),a=n(252237),i=n.n(a),s=n(450562),d=n(336205),u=n(915757),c=n(465554),v=n(883150),p=n(598280);var f=((o={}).Success="success",o.Warning="warning",o.Default="default",o),m=e=>{var{value:t=[],maxTagWidth:n}=e,o=(0,l.useMemo)(()=>t.map(e=>{var t=e.label||d.o.t("workflow_variable_undefined"),n=e.type&&v.z[e.type]||(0,r.jsx)(u.UoC,{}),o=e.invalid||!e.label||!e.type;return{key:e.key,label:t,icon:n,invalid:o,tooltip:e.type?s.IuB[e.type]:void 0,status:e.status}}),[t]);return(0,r.jsx)(c.u,{value:o,enableTooltip:!0,tagItemRenderer:e=>{var{icon:t,label:o,invalid:l,status:a}=e;return!a&&l&&(a="warning"),(0,r.jsxs)("div",{className:i()(p.Z.variableTag,"px-1 py-0.5 gap-0.5",p.Z["variable-tag_".concat(a||"default")]),children:[(0,r.jsx)("span",{className:i()(p.Z.variableTagIcon,"text-lg","coz-fg-dim"),children:t}),(0,r.jsx)("span",{className:p.Z.variableTagLabel,style:{maxWidth:n},children:o})]})}})}},795250:function(e,t,n){n.d(t,{w:function(){return a}});var o=n(455069),r=n(686436),l=n(184449);function a(e){var t=(0,r.JA)(),n=(0,l.M9)();return(0,o.useEffect)(()=>{var n=e.getData(r._J).public.available.onDataChange(()=>(0,o.startTransition)(()=>t()));return()=>{null==n||n.dispose()}},[]),n}},64451:function(e,t,n){n.d(t,{V:function(){return a}});var o=n(151064),r=n(775699),l=n(675710);function a(){return(0,o.jsx)(r.Od,{className:l.Z.skeleton,loading:!0,active:!0,placeholder:(0,o.jsxs)("div",{className:l.Z.placeholder,children:[(0,o.jsxs)("div",{className:l.Z.hd,children:[(0,o.jsx)(r.Od.Avatar,{shape:"square",className:l.Z.avatar}),(0,o.jsx)(r.Od.Title,{style:{width:141}})]}),(0,o.jsxs)("div",{className:"flex flex-col items-start gap-3",children:[(0,o.jsxs)("div",{className:"flex flex-row items-center gap-2.5",children:[(0,o.jsx)(r.Od.Title,{style:{width:85}}),(0,o.jsx)(r.Od.Title,{style:{width:241}})]}),(0,o.jsx)(r.Od.Title,{style:{width:220}})]})]})})}},428622:function(e,t,n){var o=n(151064),r=n(455069),l=n(801815),a=n(252237),i=n.n(a),s=n(244502);t.Z=e=>{var{className:t,children:n,containerName:a,containerClassName:d,containerStyle:u}=e,c=(0,r.useMemo)(()=>"".concat(a||"popup_container","_").concat((0,l.x0)()),[a]),v=r.cloneElement(n,{getPopupContainer:()=>document.getElementById(c)});return(0,o.jsxs)("div",{className:i()(s.Z["popup-container"],t),children:[v,(0,o.jsx)("div",{id:c,style:u,className:i()(["nowheel","popup-container-id",d])})]})}},182733:function(e,t,n){n.d(t,{Sf:()=>v,Wy:()=>S,To:()=>k,kl:()=>I});var o=n("151064"),r=n("336205"),l=n("915757"),a=n("674343"),i=n("455069"),s=n("886829"),d=n("730274"),u=n("769510"),c=e=>{var t=e.getData(s.m),n=(0,i.useMemo)(()=>(0,u.RO)(e),[e]),o=(0,i.useMemo)(()=>n||(0,u.EW)(e),[n,e]),r=o&&!!t.getNodeData().projectId,l=t.getNodeData(),a=n&&!r&&!!l.pluginProductStatus,c=n&&!r&&l.plugin_from===d.Xh.FromSaas;return{isApi:n,isFromStore:a,isFromLibrary:o&&!r&&!a,isFromCozeCnStore:c}},v=e=>{var{node:t}=e,{isFromStore:n,isFromLibrary:i,isFromCozeCnStore:s}=c(t);return s?(0,o.jsx)(a.u,{content:r.o.t("workflow_node_from_cn_store")||"From coze.cn store",children:(0,o.jsx)(a.hU,{icon:(0,o.jsx)(l.W1z,{}),size:"mini",color:"secondary"})}):n?(0,o.jsx)(a.u,{content:r.o.t("workflow_node_from_store"),children:(0,o.jsx)(a.hU,{icon:(0,o.jsx)(l.W1z,{}),size:"mini",color:"secondary"})}):i?(0,o.jsx)(a.u,{content:r.o.t("workflow_version_origin_tooltips"),children:(0,o.jsx)(a.hU,{icon:(0,o.jsx)(l.Zgk,{}),size:"mini",color:"secondary"})}):null},p=n("825955"),f=n("851954"),m=n.n(f),h=n("462124"),g=n("184449"),x=e=>new Promise(t=>{a.u_.confirm({title:r.o.t("workflow_version_update_model_title"),content:e,okText:r.o.t("confirm"),cancelText:r.o.t("cancel"),onOk:()=>{t(!0)},onCancel:()=>t(!1)})}),_=n("613266"),y=e=>{var{versionName:t}=e;return(0,o.jsx)(a.u,{content:t,children:(0,o.jsx)(a.hU,{icon:(0,o.jsx)(l.L03,{}),size:"mini",color:"secondary",wrapperClass:_.Z["base-version-icon"]})})},w=e=>{var{versionName:t,onUpdate:n}=e;return(0,o.jsx)(a.u,{content:(0,o.jsxs)(o.Fragment,{children:[t,(0,o.jsx)("br",{}),r.o.t("workflow_version_update_tag_tooltips")]}),children:(0,o.jsx)(a.hU,{icon:(0,o.jsx)(l.wR2,{className:"coz-fg-hglt-yellow"}),onClick:n,size:"mini",color:"secondary",wrapperClass:_.Z["base-version-icon"]})})},j=e=>{var t,{node:n,versionName:l,latestVersionName:a,latestVersionTs:i,isOutdated:s}=e,d=(0,h.o)(),u=(0,g.j1)();var c=(t=(0,p._)(function*(){(yield x(r.o.t("workflow_version_update_model_content",{myVersion:l,latestVersion:a||i})))&&i&&(yield d.updateNodesVersion(n,i))}),function(){return t.apply(this,arguments)});return s&&!u.readonly?(0,o.jsx)(w,{versionName:l,onUpdate:c}):(0,o.jsx)(y,{versionName:l})},b=e=>{var t,{node:n}=e,r=(0,u.Bj)(n),l=(0,u.AG)(n),[a,s]=(0,i.useState)(null!==(t=null==l?void 0:l.latestVersion)&&void 0!==t?t:""),d=(0,g.Zp)();(0,i.useEffect)(()=>{var e=d.onSubWrokflowVersionChange(e=>{if((null==e?void 0:e.subWorkflowId)===(null==l?void 0:l.workflow_id)){var t,o=(0,u.AG)(n);s(null!==(t=null==o?void 0:o.latestVersion)&&void 0!==t?t:"")}});return()=>{var t;null==e||null===(t=e.dispose)||void 0===t||t.call(e)}},[n]);var c=!!(a&&r&&m().valid(a)&&m().valid(r)),v=(0,i.useMemo)(()=>c&&m().lt(r,a),[a,r,c]);return c?(0,o.jsx)(j,{node:n,versionName:r,latestVersionTs:a,latestVersionName:a,isOutdated:v}):null},N=e=>{var{node:t}=e,n=(0,u.SQ)(t),{versionName:r,latestVersionTs:l,latestVersionName:a}=(0,u.Iz)(t),s=!!(l&&n&&"0"!==n&&"0"!==l),d=(0,i.useMemo)(()=>s&&l!==n,[s,l,n]);return s?(0,o.jsx)(j,{node:t,versionName:r||n,latestVersionTs:l,latestVersionName:a,isOutdated:d}):null},k=e=>{var{node:t}=e,{isFromLibrary:n,isApi:r}=c(t);return n?r?(0,o.jsx)(N,{node:t}):(0,o.jsx)(b,{node:t}):null},C=n("192180"),S=e=>{var t,{versionName:n,latestVersionName:l,versionTs:a,latestVersionTs:s,pluginId:d}=e,u=(0,h.o)(),c=(0,g.j1)(),v=(0,C.Z)(s),f=!!(d&&a&&v&&"0"!==a&&"0"!==v),m=(0,i.useMemo)(()=>f&&v!==a,[a,v,f]);var _=(t=(0,p._)(function*(){(yield x(r.o.t("workflow_version_update_model_content",{myVersion:n,latestVersion:l})))&&d&&v&&(yield u.updateApiNodesVersion(d,v))}),function(){return t.apply(this,arguments)});return f?m&&!c.readonly?(0,o.jsx)(w,{versionName:n,onUpdate:_}):(0,o.jsx)(y,{versionName:n}):null},I=e=>{var t,{versionName:n,latestVersionName:l,workflowId:a}=e,s=(0,h.o)(),d=(0,g.j1)(),u=!!(a&&n&&l&&m().valid(l)&&m().valid(n)),c=(0,i.useMemo)(()=>u&&m().lt(n,l),[n,l,u]);var v=(t=(0,p._)(function*(){(yield x(r.o.t("workflow_version_update_model_content",{myVersion:n,latestVersion:l})))&&a&&l&&(yield s.updateSubWorkflowNodesVersion(a,l))}),function(){return t.apply(this,arguments)});return u?c&&!d.readonly?(0,o.jsx)(w,{versionName:n,onUpdate:v}):(0,o.jsx)(y,{versionName:n}):null}},66483:function(e,t,n){n.d(t,{D:()=>w,c:()=>_});var o=n("151064"),r=n("455069"),l=n("801815"),a=n("405816"),i=n.n(a),s=n("136515"),d=e=>{var{value:t=[],onChange:n,onDragStart:o,onDragMove:a,onDragEnd:d}=e,[u,c]=(0,r.useState)(t.map(e=>({value:e,dragItemId:(0,l.x0)()})));(0,s.Z)(()=>{c(t.map((e,t)=>{var n;return{value:e,dragItemId:(null===(n=u[t])||void 0===n?void 0:n.dragItemId)||(0,l.x0)()}}))},[t]);var[v,p]=(0,r.useState)(""),[f]=(0,r.useState)((0,l.x0)());return{data:u,isDragging:!!v,draggingId:v,onDragStart:e=>{p(u[e].dragItemId),null==o||o(e)},onDragMove:(e,t)=>{c(n=>i()(n,{$splice:[[e,1],[t,0,n[e]]]})),null==a||a(e,t)},onDragEnd:(e,t)=>{p(void 0),e!==t&&(null==n||n(u.map(e=>e.value))),null==d||d(e,t)},dragItemType:f}},u=n("935954"),c=n("990828"),v=n("221478"),p=n("252237"),f=n.n(p),m=e=>{var{children:t,type:n,onDragStart:l,onDragMove:a,onDragEnd:i,value:s,index:d}=e,p=(0,r.useRef)(null),[{isDragging:m},h,g]=(0,c.c)(()=>({type:n,item:()=>(null==l||l(d),{type:n,startIndex:d,index:d,value:s}),end:e=>{null==i||i(e.startIndex,d)},collect:e=>({isDragging:e.isDragging()})}),[d,s,l,i]),[,x]=(0,v.L)(()=>({accept:n,hover(e,t){if(!p.current)return;var n=e.index;if(n!==d)null==a||a(n,d),e.index=d}}),[d,a]);return h(p),(0,r.useEffect)(()=>{g((0,u.r)(),{captureDraggingState:!0})},[g]),(0,o.jsx)("div",{ref:x,className:f()({"opacity-0":m,"opacity-100":!m}),children:t({dragRef:p,isDragging:m})})},h=n("191304"),g=n("686436"),x=e=>{var{type:t,previewRender:n}=e,l=(0,r.useRef)(null),a=(0,g.Dc)().config.finalScale,{item:i,itemType:s,isDragging:d,initialOffset:u,currentOffset:c}=(0,h.f)(e=>({item:e.getItem(),itemType:e.getItemType(),isDragging:e.isDragging(),initialOffset:e.getInitialSourceClientOffset(),currentOffset:e.getSourceClientOffset()}));return d?(0,o.jsx)("div",{style:{position:"absolute",pointerEvents:"none",scale:a,zIndex:100,left:0,top:0,width:"100%",height:"100%"},ref:l,children:(0,o.jsx)("div",{style:function(){if(!u||!c||!l.current)return{display:"none"};var e=l.current.getBoundingClientRect(),{x:t,y:n}=c;t-=e.x,n-=e.y;var o="translate(".concat(t/1,"px, ").concat(n/1,"px)");return{transform:o,WebkitTransform:o}}(),children:s===t?n(i.value,i.index):null})}):null},_=e=>{var{renderItem:t,className:n="flex flex-col space-y-2 mt-2"}=e,{onDragEnd:r,onDragMove:l,onDragStart:a,data:i,dragItemType:s}=d(e);return(0,o.jsxs)("div",{className:n,children:[i.map((e,n)=>(0,o.jsx)(m,{value:e.value,index:n,type:s,onDragStart:a,onDragMove:l,onDragEnd:r,children:o=>t(e.value,n,o)},e.dragItemId)),(0,o.jsx)(x,{type:s,previewRender:(e,n)=>t(e,n,{isPreview:!0})})]})},y=n("646201"),w=(0,r.forwardRef)((e,t)=>{var{className:n,style:r,testId:l}=e;return(0,o.jsx)(y.Z,{ref:t,"data-disable-node-drag":!0,className:f()("cursor-move text-[var(--semi-color-text-3)]",n),style:r,"data-testid":l})})},735297:function(e,t,n){n.d(t,{P:function(){return v}});var o=n(151064),r=n(455069),l=n(626389),a=n.n(l),i=n(336205),s=n(674343),d=n(775699),u=n(44172),c=n(625646),v=e=>{var{className:t="",tags:n,max:l}=e,[v,p]=(0,r.useState)(!1),f=n.length>l&&!v,m=v?n:n.slice(0,l),h=n.length-l;return(0,o.jsxs)("div",{className:"".concat(c.Z.container," ").concat(t),children:[m.map((e,t)=>(0,o.jsx)(s.u,{content:i.o.t("database_240522_01"),children:(0,o.jsx)(d.fS,{onClick:()=>{a()(e),s.FN.success(i.o.t("database_240522_02"))},children:e},t)})),f?(0,o.jsxs)(d.fS,{onClick:()=>p(!0),children:["+",h]}):null,v?(0,o.jsx)(d.fS,{onClick:()=>p(!1),children:(0,o.jsx)(u.C26,{rotate:180})}):null]})}},608406:function(e,t,n){n.d(t,{O:()=>x,o:()=>V});var o=n("808549"),r=n("120454"),l=n("151064"),a=n("455069"),i=n("252237"),s=n.n(i),d=n("647938"),u=n("450562"),c=n("336205"),v=n("915757"),p=n("674343"),f=n("516802"),m=n("306215"),h=n("1334"),g=e=>(0,l.jsx)(p.Ph.Option,{selected:e.checked,value:e.value,disabled:e.disabled,className:f.Z["variable-panel-option"],onSelect:t=>{var n;return null===(n=e.onSelect)||void 0===n?void 0:n.call(e,null==t?void 0:t.value)},children:(0,l.jsxs)("div",{style:{maxWidth:"100%"},className:"flex items-center justify-between pl-32px pr-8px pt-2px pb-2px",children:[(0,l.jsx)(p.ZT.Text,{className:s()("flex-1 leading-20px",{[f.Z["variable-option-checked"]]:e.checked}),disabled:e.disabled,ellipsis:{showTooltip:!0},style:{fontSize:12,marginRight:4},children:e.name}),(0,l.jsx)(p.Vp,{disabled:e.disabled,size:"mini",color:"primary",children:u.IuB[e.type]})]})},"".concat(e.value,"-").concat(e.disabled)),x=e=>{var{className:t}=e,{type:n}=(0,d.j)(),o=!!n;return(0,a.useMemo)(()=>(0,l.jsxs)("div",{className:s()(t,f.Z["empty-block"]),children:[(0,l.jsx)(v.nL$,{style:{fontSize:"32px",color:"rgba(52, 60, 87, 0.72)"}}),(0,l.jsx)("span",{className:f.Z.text,children:o?c.o.t("variable_binding_there_are_no_variables_in_this_project"):c.o.t("variable_select_empty_library_tips")})]}),[o])};function _(e){var{onVariableSelect:t,variableValue:n,variablePanelStyle:i,variablesFormatter:s}=e,{globalVariables:d}=function(e){var{variablesFormatter:t=e=>e}=e,n=(0,h.X_)();return{globalVariables:(0,a.useMemo)(()=>t(n.filter(e=>e.nodeId&&(0,m.mN)(e.nodeId))),[n,t])}}({variablesFormatter:s});return(0,l.jsxs)(l.Fragment,{children:[d.length>0&&(0,l.jsx)("div",{className:"coz-fg-secondary mt-8px mb-4px pl-28px text-[12px] font-medium leading-16px",children:c.o.t("variable_binding_please_select_a_variable",{},"请先选择变量")}),(0,l.jsxs)("div",{className:"h-[292px] overflow-y-auto",style:i,children:[d.map(e=>(0,l.jsx)(g,(0,r._)((0,o._)({},e),{onSelect:t,checked:n===e.value}))),d.length<=0&&(0,l.jsx)(x,{})]})]})}var y=n("28260"),w=n("184449"),j=n("825955"),b=n("311807"),N=n("382534"),k=n("822698"),C=n("672496"),S=n("686436"),I=n("172637"),T=n("610308"),E=n("140219"),D=n("749615");function Z(e){var{disabled:t,checked:n,avatar:o,name:r,type:a}=e,[i,d]=(0,D.Z)();return(0,l.jsxs)("div",{ref:i,className:s()("flex w-full items-center pl-8px pr-8px pt-2px pb-2px"),children:[n?(0,l.jsx)(v.P03,{className:"text-[16px] mr-8px coz-fg-hglt flex-shrink-0"}):(0,l.jsx)("div",{className:"w-16px h-16px mr-8px flex-shrink-0"}),(0,l.jsx)(p.qE,{style:{flexShrink:0,marginRight:8,width:16,height:16},shape:"square",src:o}),(0,l.jsx)("div",{className:"flex",style:{flexGrow:1,flexShrink:1,overflow:"hidden"},children:(0,l.jsx)(p.ZT.Text,{ellipsis:{showTooltip:!0},style:{fontSize:12,color:"#1D1C23",fontWeight:400},children:r})}),d&&!t?(0,l.jsxs)("div",{className:"flex items-center coz-fg-secondary flex-shrink-0",children:[(0,l.jsx)("span",{className:"text-[12px]",children:c.o.t("variable_binding_continue",{},"继续")}),(0,l.jsx)(v.x5d,{className:"text-[12px] ml-2px"})]}):a===y.jH.Project?(0,l.jsx)(p.Vp,{size:"mini",color:"primary",className:"flex-shrink-0",children:c.o.t("wf_chatflow_106")}):(0,l.jsx)(p.Vp,{size:"mini",color:"primary",className:"flex-shrink-0",children:c.o.t("wf_chatflow_107")})]})}function M(){return(0,l.jsxs)("div",{className:f.Z["empty-block"],children:[(0,l.jsx)(v.nL$,{style:{fontSize:"32px",color:"rgba(52, 60, 87, 0.72)"}}),(0,l.jsx)("span",{className:f.Z.text,children:c.o.t("variable_binding_there_are_no_variables_in_this_project",{},"该智能体下暂时没有定义变量")})]})}var P=(e,t)=>{if(!e)return null;var{disableBot:n,disableProject:a,disableBotTooltip:i,disableProjectTooltip:d,onClick:u,checkedValue:c}=t,v=e.type===y.jH.Bot,m=(0,T.P)({disableBot:n,disableProject:a},e.type),h=v&&n?i:d;return(0,l.jsx)("div",{onClick:()=>{if(!m)null==u||u()},className:s()(f.Z["related-entities-option"],{[f.Z["related-entities-option-disabled"]]:m,[f.Z["related-entities-option-selected"]]:c===e.value}),children:m?(0,l.jsx)(p.u,{keepDOM:!0,content:h,position:"left",className:"w-full",children:(0,l.jsx)("div",{className:"w-full",children:(0,l.jsx)(Z,(0,r._)((0,o._)({},e),{disabled:m,checked:c===e.value}))})}):(0,l.jsx)(Z,(0,r._)((0,o._)({},e),{disabled:m,checked:c===e.value}))})};function L(e){var{relatedEntities:t=[],relatedEntityValue:n,disableProjectTooltip:o,disableProject:r,disableBotTooltip:a,disableBot:i,isLoadMore:s,onLoadMore:d,onRelatedSelect:u,relatedBotPanelStyle:v}=e,p=(0,w.jN)(),m=(0,S.G2)(I.f);return(0,l.jsxs)(l.Fragment,{children:[t&&(null==t?void 0:t.length)>0?(0,l.jsx)("div",{className:"coz-fg-secondary mt-8px mb-4px pl-28px text-[12px] font-medium leading-16px",children:c.o.t("variable_binding_please_bind_an_agent_or_app_first",{},"请先绑定智能体或应用")}):null,(0,l.jsxs)("div",{className:"h-[292px] overflow-y-auto",style:v,children:[null==t?void 0:t.map(e=>P(e,{disableProjectTooltip:o,disableProject:r,disableBotTooltip:a,disableBot:i,onClick:()=>{p.updateRelatedBot({id:e.value,type:e.type===y.jH.Bot?"bot":"project"}),m.loadGlobalVariables(1===e.type?"bot":"project",e.value),null==u||u(e)},checkedValue:null==n?void 0:n.id})),s?(0,l.jsx)("div",{className:f.Z["bot-foot-loading"],children:(0,l.jsx)(E.V,{onObserver:d})}):null,!t||(null==t?void 0:t.length)<=0?(0,l.jsx)(M,{}):null]})]})}var z=e=>e?{id:e.id,type:"bot"===e.type?y.jH.Bot:y.jH.Project}:e;function O(e){var{className:t,variablesFormatter:n,relatedEntityValue:o,disableBot:r,disableProject:i,disableBotTooltip:d,disableProjectTooltip:f,onVariableSelect:m,variableValue:h,variablePanelStyle:g,relatedBotPanelStyle:x,customVariablePanel:S}=e,I=(0,a.useRef)(null),T=(0,w.jN)(),E=()=>o||z(T.getRelatedBotValue()),D=E(),Z=(0,a.useRef)(null),[M,P]=(0,a.useState)(!(null==D?void 0:D.id)),{relatedEntities:O,onRelatedEntitiesSearch:A,isLoadMore:F,loadMoreRelatedEntities:R}=function(e){var t,n,{relatedEntityValue:o}=e,[r,l]=(0,a.useState)([]),[i,s]=(0,a.useState)(),[d,c]=(0,a.useState)(""),[v,p]=(0,a.useState)(!1),f=(0,a.useRef)(!1),{spaceId:m,personalSpaceId:h}=(0,w.j1)(),g=m===u.RV6?h:m,x=function(e){var{spaceId:t}=e,{data:n}=(0,C.a)({queryKey:["related-bot-panel","GetDraftIntelligenceList",t],queryFn:(0,j._)(function*(){var e,n=yield N.sD.GetDraftIntelligenceList({space_id:t,name:"",types:[y.jH.Bot,y.jH.Project],size:30,order_by:0,cursor_id:void 0,status:[y.Gr.Using,y.Gr.Banned,y.Gr.MoveFailed]});return null!==(e=null==n?void 0:n.data)&&void 0!==e?e:{}}),retry:!1});return n}({spaceId:g}),_=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{intelligences:n,total:o=0,next_cursor_id:a}=null!=e?e:{},i=(null!=n?n:[]).map(e=>{var t,n,o,r,l,a;return{name:null!==(r=null===(t=e.basic_info)||void 0===t?void 0:t.name)&&void 0!==r?r:"",value:null!==(l=null===(n=e.basic_info)||void 0===n?void 0:n.id)&&void 0!==l?l:"",avatar:null!==(a=null===(o=e.basic_info)||void 0===o?void 0:o.icon_url)&&void 0!==a?a:"",type:e.type||y.jH.Bot}}),d=t?i:[...r,...i];s(a),l(d),p(d.length<o)};var S=(t=(0,j._)(function*(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=yield N.sD.GetDraftIntelligenceList({space_id:g,name:null!=e?e:d,types:[y.jH.Bot,y.jH.Project],size:30,order_by:0,cursor_id:i,status:[y.Gr.Using,y.Gr.Banned,y.Gr.MoveFailed]});_(null==n?void 0:n.data,t)}),function(e){return t.apply(this,arguments)}),I=(0,a.useCallback)(e=>{c(e),s(void 0),S(e,!0)},[]);var T=(n=(0,j._)(function*(){if(!f.current)f.current=!0,yield S(),f.current=!1}),function(){return n.apply(this,arguments)});(0,a.useEffect)(()=>{_(x,!0)},[x]);var E=(null==o?void 0:o.type)===y.jH.Bot,D=(0,k.$)(r,null==o?void 0:o.id,E);return{relatedEntities:(0,a.useMemo)(()=>[D,...r].filter(e=>!!e),[D,r]),onRelatedEntitiesSearch:(0,b.Z)(I,300),loadMoreRelatedEntities:T,isLoadMore:v}}({relatedEntityValue:D}),V=(0,a.useCallback)(()=>{setTimeout(()=>{P(!0)},100)},[]),B=(0,a.useCallback)(()=>{var e,t,n,o;null===(t=I.current)||void 0===t||null===(e=t.clearInput)||void 0===e||e.call(t),null===(o=I.current)||void 0===o||null===(n=o.close)||void 0===n||n.call(o),Z.current&&clearTimeout(Z.current),Z.current=setTimeout(()=>{var e;P(!(null===(e=E())||void 0===e?void 0:e.id))},300)},[]);return(0,l.jsxs)("div",{className:s()(t,"w-full flex flex-col p-4px"),children:[(0,l.jsx)(p.Ph,{autoClearSearchValue:!0,ref:I,filter:!0,inputProps:{onBlur:B,onFocusCapture:V},value:null==D?void 0:D.id,className:"w-full",size:"small",placeholder:c.o.t("variable_binding_search_project",{},"搜索智能体/应用"),optionList:[],onSearch:A,emptyContent:null,prefix:(0,l.jsx)(v.SHo,{className:"text-[16px] ml-8px coz-fg-secondary"}),showArrow:!1,renderSelectedItem:()=>{var e=O.find(e=>e.value===(null==D?void 0:D.id));return e?(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(p.qE,{className:"w-16px h-16px mr-8px",shape:"square",src:e.avatar}),(0,l.jsx)("span",{className:"text-[12px]",children:e.name})]}):null}}),(0,l.jsx)("div",{className:"w-full coz-fg-primary",children:M?(0,l.jsx)(L,{relatedBotPanelStyle:x,relatedEntityValue:D,relatedEntities:O,onLoadMore:R,isLoadMore:F,disableBot:r,disableProject:i,disableBotTooltip:d,disableProjectTooltip:f,onRelatedSelect:()=>{P(!1)}}):S||(0,l.jsx)(_,{variablePanelStyle:g,variableValue:h,onVariableSelect:m,variablesFormatter:n})})]})}var A=n("692857"),F=n("921396"),R=n("115597");function V(e){var[t,n]=(0,a.useState)({}),{queryNeedBot:r}=(0,A.t)(),{getNode:i}=(0,F.J)(),s=i(),d=R.Gf.Default;return(0,a.useEffect)(()=>{var e;(e=(0,j._)(function*(){if(s){var{hasLTMNode:e,hasConversationNode:t}=yield r(d,s);n({disableBot:t,disableBotTooltip:t?c.o.t("wf_chatflow_141"):"",disableProject:e,disableProjectTooltip:e?c.o.t("wf_chatflow_142"):""})}}),function(){return e.apply(this,arguments)})()},[]),(0,l.jsx)(O,(0,o._)({},e,t))}},115597:function(e,t,n){n.d(t,{nr:()=>D,Fk:()=>w,Gf:()=>x,H5:()=>k,o8:()=>g.o8,_s:()=>j,Lp:()=>y,kM:()=>N,hs:()=>b,A$:()=>I,Dn:()=>S,TJ:()=>M,KY:()=>_,Vz:()=>C,D0:()=>Z});var o,r,l,a=n("825955"),i=n("808549"),s=n("120454"),d=n("962289"),u=n("450562"),c=n("730274"),v=n("28260"),p=n("336205"),f=n("382534"),m=n("206616"),h=n("880954"),g=n("423043");var x=((o={})[o.Default=0]="Default",o[o.Single=1]="Single",o);var _=((r={}).Aigc="aigc",r.Testset="testset",r.User="user",r);var y=((l={}).Node="_node",l.Batch="_batch",l.Input="_input",l.Bot="_bot",l.Chat="_chat",l.Datasets="_datasets",l.DatasetsIs="_datasets_is",l.DatasetsName="_datasets_name",l.DatasetsDescription="_datasets_description",l.Setting="_setting",l.JSON="_json",l),w={type:"FormObject",name:"_node",component:{type:"FieldGroup"}},j={type:"FormObject",name:"_setting",component:{type:"div"}},b={type:"FormObject",name:"_batch",component:{type:"div"}},N={type:"FormObject",name:"_input",component:{type:"div"}},k=e=>{var t,n=(null==e?void 0:null===(t=e.selectItem)||void 0===t?void 0:t.type)===v.jH.Project;return{type:"FormString",name:"_chat",required:!0,title:p.o.t("wf_chatflow_74"),component:{type:"ConversationSelect",props:{projectId:'{{$parent.children?.find(item => item.type?.name === "_bot")?.value}}'}},decorator:{type:"FormItem",props:{tooltip:p.o.t("wf_chatflow_154")}},visible:n,validator:[{triggerType:"onBlur",required:!0,message:p.o.t("workflow_testset_required_tip",{param_name:"Conversation"})},{triggerType:"onBlur",validator:e=>!!e||!1}]}},C=(e,t,n)=>{var o,{hasLTMNode:r=!1}=e||{};return{type:"FormVoid",title:p.o.t("wf_chatflow_72"),name:"_bot",component:{type:"FieldGroup"},children:t?[{type:"FormObject",name:"_bot",required:!0,title:p.o.t("wf_chatflow_72"),component:{type:"BotProjectSelect"},decorator:{type:"FormItem"},validator:[{triggerType:"onBlur",required:!0,message:p.o.t("workflow_testset_required_tip",{param_name:"Bot"})},{triggerType:"onBlur",validator:(o=(0,a._)(function*(e){var t,o=null==e?void 0:e.id;if((null==n?void 0:null===(t=n.selectItem)||void 0===t?void 0:t.type)===v.jH.Project||(null==e?void 0:e.type)===v.jH.Project||!o)return!0;var l=yield f.pr.GetDraftBotInfoAgw({bot_id:o}),a=(0,d.Z)(l,["data","bot_info","bot_tag_info","time_capsule_info","time_capsule_mode"],c.o_.Off)===c.o_.On;return!r||!!a||"This Bot does not have LTM enabled."}),function(e){return o.apply(this,arguments)})}]}]:[]}},S={type:"FormObject",name:"_datasets",component:{type:"div"},children:[{type:"FormString",name:"_datasets_is",component:{type:"Checkbox",props:{title:p.o.t("workflow_debug_data_save")}},decorator:{type:"FormItem"}}]},I={required:!0,decorator:{type:"FormItem"},validator:[{required:!0,triggerType:"onBlur",message:p.o.t("workflow_testset_required_tip",{param_name:"{{$self.title}}"})}]},T=u.vHX.reduce((e,t)=>{var n=u.owu.isArrayType(t);return(0,s._)((0,i._)({},e),{[t]:{type:"FormString",component:{type:"File",props:{multiple:n,accept:(0,m.Df)(t),inputType:t,fileType:(0,h._)(t),enableInputURL:!0}}}})},{}),E={[u.owu.String]:{type:"FormString",component:{type:"Input"}},[u.owu.Integer]:{type:"FormNumber",component:{type:"InputInteger"}},[u.owu.Boolean]:{type:"FormBoolean",initialValue:!0,component:{type:"Switch"}},[u.owu.Number]:{type:"FormNumber",component:{type:"InputNumber"}},[u.owu.Time]:{type:"FormString",component:{type:"InputTime"}},[u.owu.Object]:{type:"FormString",component:{type:"JsonEditor"},initialValue:"{}"},[u.owu.ArrayString]:{type:"FormString",component:{type:"JsonEditor"},initialValue:"[]"},[u.owu.ArrayInteger]:{type:"FormString",component:{type:"JsonEditor"},initialValue:"[]"},[u.owu.ArrayBoolean]:{type:"FormString",component:{type:"JsonEditor"},initialValue:"[]"},[u.owu.ArrayNumber]:{type:"FormString",component:{type:"JsonEditor"},initialValue:"[]"},[u.owu.ArrayObject]:{type:"FormString",component:{type:"JsonEditor"},initialValue:"[]"},[u.owu.ArrayTime]:{type:"FormString",component:{type:"JsonEditor"},initialValue:"[]"}},D=(0,i._)({},E,T),Z="10000",M="100001"},556305:function(e,t,n){n.d(t,{E:()=>p});var o=n("151064"),r=n("808549"),l=n("120454"),a=n("455069"),i=n("252237"),s=n.n(i),d=n("336205"),u=n("775699"),c=n("782261"),v=e=>{var{data:t,popoverProps:n,className:i,children:v}=e,p=(0,a.useRef)(null);return(0,o.jsx)("div",{ref:p,className:s()(c.Z.container,i),children:(0,o.jsx)(u.J2,(0,l._)((0,r._)({showArrow:!0,getPopupContainer:()=>{var e;return null!==(e=p.current)&&void 0!==e?e:document.body},content:(0,o.jsxs)("div",{className:c.Z.content,children:[(0,o.jsxs)(u.X2,{className:c.Z.header,children:[(0,o.jsx)(u.JX,{span:8,children:d.o.t("workflow_detail_title_source")}),(0,o.jsx)(u.JX,{span:10,children:d.o.t("workflow_detail_title_token")})]}),(0,o.jsxs)(u.X2,{className:c.Z.text,style:{paddingBottom:0},children:[(0,o.jsx)(u.JX,{span:8,className:c.Z.title,children:d.o.t("workflow_detail_node_output")}),(0,o.jsx)(u.u,{content:t.output.token,children:(0,o.jsx)(u.JX,{span:10,className:c.Z.value,children:t.output.token})})]}),(0,o.jsxs)(u.X2,{className:c.Z.text,style:{paddingTop:0},children:[(0,o.jsx)(u.JX,{span:8,className:c.Z.title,children:d.o.t("workflow_detail_node_parameter_input")}),(0,o.jsx)(u.u,{content:t.input.token,children:(0,o.jsx)(u.JX,{span:10,className:c.Z.value,children:t.input.token})})]}),(0,o.jsxs)(u.X2,{className:c.Z.footer,children:[(0,o.jsx)(u.JX,{span:8,className:c.Z.title,children:d.o.t("workflow_detail_title_total")}),(0,o.jsx)(u.u,{content:t.total.token,children:(0,o.jsx)(u.JX,{span:10,className:c.Z.value,children:t.total.token})})]})]})},n),{children:v}))})},p=e=>{var{tokenAndCost:t,children:n,popoverProps:r,className:l}=e,a={output:{token:t.outputTokens||"-",cost:t.outputCost||"-"},input:{token:t.inputTokens||"-",cost:t.inputCost||"-"},total:{token:t.totalTokens||"-",cost:t.totalCost||"-"}};return(0,o.jsx)(v,{popoverProps:r,data:a,className:l,children:n})}},14651:function(e,t,n){n.d(t,{x:function(){return i}});var o=n(825955),r=n(280990),l=n(686436),a=n(994983),i=()=>{var e,t=(0,l.G2)(a.GH),{mutate:n,isPending:i}=(0,r.D)({mutationFn:(0,o._)(function*(){return yield t.cancelTestRun()})});return{cancelTestRun:(e=(0,o._)(function*(){return yield n()}),function(){return e.apply(this,arguments)}),canceling:i}}},921396:function(e,t,n){n.d(t,{J:function(){return a},L:function(){return i}});var o=n(455069),r=n(450562),l=n(686436),a=()=>{var e=(0,l.G2)(l.L4);return{getNode:(0,o.useCallback)(()=>e.getAllNodes().find(e=>e.flowNodeType===r.nyy.Start),[e])}},i=()=>{var{getNode:e}=a();return{getStartNodeOutputs:()=>{var t,n,o,r=e();if(!r)return[];var a=null!==(n=null===(t=r.getNodeMeta())||void 0===t?void 0:t.outputsPath)&&void 0!==n?n:"/outputs",i=r.getData(l.Ps).getFormModel();return null!==(o=null==i?void 0:i.getValueIn(a))&&void 0!==o?o:[]}}}},692857:function(e,t,n){n.d(t,{t:function(){return p}});var o=n(825955),r=n(192458),l=n(962289),a=n(686436),i=n(860766),s=n(886829),d=n(450562),u=n(115597),c=n(184449);function v(e){var t=(0,l.Z)(e,"data.inputs.llmParam");return!!(e.type===d.nyy.Intent?null==t?void 0:t.enableChatHistory:(0,l.Z)((t||[]).find(e=>"enableChatHistory"===e.name),"input.value.content")||!1)}var p=()=>{var e,t,n=(0,c.HX)(),p=(0,a.G2)(a.L4),{isSceneFlow:f,isChatflow:m}=(0,c.oS)(),h=(0,c.j1)();var g=(e=(0,o._)(function*(){var e,t,o,l,a,i,s,u=yield n.queryNodeType(),c=null!==(l=null==u?void 0:u.node_types)&&void 0!==l?l:[],v=null!==(a=null==u?void 0:u.sub_workflow_node_types)&&void 0!==a?a:[],p=[...c,...v],m=[...null!==(i=null==u?void 0:u.nodes_properties)&&void 0!==i?i:[],...null!==(s=null==u?void 0:u.sub_workflow_nodes_properties)&&void 0!==s?s:[]],g=p.includes(d.nyy.Variable),x=p.includes(d.nyy.VariableAssign),_=p.includes(d.nyy.Database),y=p.includes(d.nyy.Intent),w=p.includes(d.nyy.LLM),j=p.includes(d.nyy.LTM);var b=(e=p,(0,r.Z)(e,d.XmD).length>0);var N=(t=p,(0,r.Z)(t,d.kOP).length>0);var k=(o=p,(0,r.Z)(o,d.lZh).length>0),C=m.some(e=>e.is_enable_chat_history),S=!!m.find(e=>e.is_ref_global_variable),I=(w||y)&&C,T=v.some(e=>[d.nyy.SubWorkflow].includes(e));return f?{needBot:!1,needConversation:!1,hasVariableNode:g,hasVariableAssignNode:x,hasNodeUseGlobalVariable:S,hasDatabaseNode:_,hasLTMNode:j,hasChatHistoryEnabledLLM:I,isChatflow:h.isChatflow,hasConversationNode:b}:{needBot:S||x||g||j||I||T||b||N||k,needConversation:I,hasVariableNode:g,hasVariableAssignNode:x,hasNodeUseGlobalVariable:S,hasDatabaseNode:_,hasLTMNode:j,hasChatHistoryEnabledLLM:I,isChatflow:h.isChatflow,hasConversationNode:b}}),function(){return e.apply(this,arguments)});return{queryNeedBot:(t=(0,o._)(function*(e,t){var n={needBot:!1,needConversation:!1,hasVariableNode:!1,hasVariableAssignNode:!1,hasDatabaseNode:!1,hasLTMNode:!1,hasChatHistoryEnabledLLM:!1,isChatflow:h.isChatflow,hasConversationNode:!1};if(f)return n;var o=t.flowNodeType,r=yield p.toNodeJSON(t);var a=(null==(_=null==(x=t.getData(s.m))?void 0:x.getNodeData())?void 0:_.flow_mode)===d.wz8.ChatFlow;var c=(y=r,!!(j=((0,l.Z)(y,"data.inputs.inputParameters")||[]).find(e=>(null==e?void 0:e.name)===d.d9h))&&d.nZF.isRef(null==j?void 0:null===(w=j.input)||void 0===w?void 0:w.value));if(h.projectId){var x,_,y,w,j,b,N,k=o===d.nyy.SubWorkflow;return n.needConversation=(b=t,N=r,[d.nyy.LLM,d.nyy.Intent].includes(b.flowNodeType)&&v(N)||k&&a&&c),n}return e===u.Gf.Single?o===d.nyy.Variable?(n.needBot=!0,n.hasVariableNode=!0):o===d.nyy.VariableAssign?(n.needBot=!0,n.hasVariableAssignNode=!0):o===d.nyy.Database?n.hasDatabaseNode=!0:o===d.nyy.LTM?(n.needBot=!0,n.hasLTMNode=!0):[d.nyy.LLM,d.nyy.Intent].includes(o)&&m?v(r)&&(n.needBot=!0,n.needConversation=!0,n.hasChatHistoryEnabledLLM=!0):o===d.nyy.SubWorkflow?(n=yield g(),a&&(n.needBot=!h.projectId,n.needConversation=c)):[d.nyy.Loop,d.nyy.Batch].includes(o)?n=yield g():d.XmD.includes(o)?(n.needBot=!0,n.hasConversationNode=!0):[...d.kOP,...d.lZh].includes(o)?n.needBot=!0:t.getData(i._).hasGlobalRef&&(n.needBot=!0):h.isChatflow?((n=yield g()).needBot=!0,n.needConversation=!1):(n=yield g()).needConversation=!1,n}),function(e,n){return t.apply(this,arguments)})}}},335759:function(e,t,n){n.d(t,{D:()=>eT});var o,r=n("825955"),l=n("808549"),a=n("120454"),i=n("151064"),s=n("455069"),d=n("962289"),u=n("686436"),c=n("172637"),v=n("886829"),p=n("450562"),f=n("297158"),m=n("336205"),h=n("824833"),g=n("382534"),x=n("674343"),_=n("115597"),y=n("994983"),w=n("184449"),j=n("997363"),b=n("376604"),N=n("206058"),k=n("567282"),C=n("156133"),S=n("346707"),I=n("896335"),T=n("28260"),E=n("298203"),D=n("873037"),Z=e=>(0,I.Z)(e)?e.match(/\{\{.*\}\}/)?void 0:e:e,M=(e,t,n)=>{if(!!e&&!!Array.isArray(e)&&!!e.length&&!!t)e.forEach(e=>{var{name:o,visible:r,type:l,children:a,originType:i}=e;if(!(0,C.Z)(r)||!!r){if(!o||"FormVoid"===l){M(a,t,n);return}var s=(0,d.Z)(t,o);if(a){M(a,s,n);return}var u=Z(null==s?void 0:s.value);((null==s?void 0:s.type)===i&&!(0,S.Z)(u)||n)&&(e.initialValue=u)}})},P=(e,t)=>{if(!e.originType||!(0,I.Z)(t)||p.owu.isFileType(e.originType))return t;if(p.owu.isArrayType(e.originType)||p.owu.Object===e.originType)try{return JSON.stringify(JSON.parse(t),void 0,2)}catch(e){}return t},L=(e,t)=>{if(!t)return;var n,o,r=(0,D.V)((0,E.f5)(t||"{}"));if(!r)return;var l=e.find(e=>e.name===_.Lp.Node);if(!l||!(null===(n=l.children)||void 0===n?void 0:n.length))return;var a=l.children.find(e=>e.name===_.Lp.Input);if(!!a&&!!(null===(o=a.children)||void 0===o?void 0:o.length))a.children.forEach(e=>{var{name:t}=e,n=Z(r[t]);!(0,S.Z)(n)&&(e.initialValue=P(e,n))})},z=(e,t)=>{if(!t)return;var n,o,r=e.find(e=>e.name===_.Lp.Node);if(!r||!(null===(n=r.children)||void 0===n?void 0:n.length))return;var l=r.children.find(e=>e.name===_.Lp.Input);if(!!l&&!!(null===(o=l.children)||void 0===o?void 0:o.length))l.children.forEach(e=>{var{name:n}=e,o=t[n];!(0,S.Z)(o)&&(e.initialValue=P(e,o))})},O=(e,t)=>{if(!(null==t?void 0:t.id)||!(null==t?void 0:t.type))return;var n,o=e.find(e=>e.name===_.Lp.Bot);if(!o||!(null===(n=o.children)||void 0===n?void 0:n.length))return;var r=o.children.find(e=>e.name===_.Lp.Bot);if(!!r)r.initialValue={id:t.id,type:"project"===t.type?T.jH.Project:T.jH.Bot}},A=()=>{var e,t=(0,N.Jf)(),n=(0,w.j1)(),o=(0,w.IW)(),l=(0,u.G2)(u.L4),a=(0,u.G2)(y.mh),i=e=>!n.isInIDE&&e.type===_.Gf.Default;return{generateInitialValues:(e=(0,r._)(function*(e){if(!(null==e?void 0:e.id)||!(null==e?void 0:null===(v=e.fields)||void 0===v?void 0:v.length))return;var r=t.getCacheValues(e.id);if(r){M(e.fields,r),o.formGenDataOrigin({gen_data_origin:"cache"});return}var s=l.getAllNodes().find(t=>t.id===e.id),d=(0,b.Z)(p.nyy);if(!!s&&!!d[s.flowNodeType])try{if(i(e)){var u=a.getRelatedBotValue();O(e.fields,u)}var c=yield p.OHc.GetNodeExecuteHistory({workflow_id:n.workflowId,space_id:n.spaceId,node_id:e.id,node_type:d[s.flowNodeType],execute_id:"",node_history_scene:k.IJ.TestRunInput});if(null===(f=c.data)||void 0===f?void 0:f.input){L(e.fields,c.data.input),o.formGenDataOrigin({gen_data_origin:"history"});return}if(i(e)){var v,f,m,h=a.getDefaultCaseCaches();h&&z(e.fields,null==h?void 0:null===(m=h[N.Lp.Node])||void 0===m?void 0:m[N.Lp.Input])}}catch(e){}}),function(t){return e.apply(this,arguments)})}},F=n("114648"),R=e=>{var{isSceneFlow:t}=(0,w.oS)(),n=(0,F.A)();return{needSceneBot:t,sceneBotSchema:{type:"FormString",name:_.Lp.Bot,initialValue:null==n?void 0:n.participantId,title:m.o.t("workflow_detail_testrun_bot",{},"关联 Bot"),disabled:!0,hidden:!e,decorator:{type:"FormItem"},component:{type:"Select",props:{optionList:[{label:null==n?void 0:n.name,value:null==n?void 0:n.participantId}],disabled:!0}}}}},V=n("692857"),B=n("921396"),G=n("966534"),W=n.n(G),U=n("997516"),H=n("360903"),J=n("316896"),q=n("736892"),K=n("569502"),X=n("703188"),Y=n("537916"),Q=n("473980"),$=n("64605"),ee=n("687015"),et=n.n(ee),en=n("306215"),eo=n("664278"),er=n("130989"),el=n("880792"),ea=n("1704"),ei=function(e){var t,n=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3?arguments[3]:void 0,{validator:s}=_.A$,d=(0,Q._)(_.A$,["validator"]),u=(0,a._)((0,l._)({},d.decorator),{props:(0,a._)((0,l._)({},null===(t=d.decorator)||void 0===t?void 0:t.props),{tag:p.owu.LabelMap[e],type:e})}),c=_.nr[e],{validator:v,component:f}=c,h=(0,Q._)(c,["validator","component"]),g={triggerType:"onBlur",message:m.o.t("workflow_debug_wrong_json"),validator:e=>{if(!i||!e)return!0;!o&&(o=new(et()));try{return o.compile(i)(JSON.parse(e))}catch(e){return!1}}};return(0,a._)((0,l._)((0,a._)((0,l._)({},d),{decorator:u}),h),{required:n,validator:[...n?s:[],...v||[],g],description:r,originType:e,component:(0,a._)((0,l._)({},f),{props:(0,a._)((0,l._)({},(null==f?void 0:f.props)||{}),{jsonSchema:i})})})},es=e=>{switch(e){case"boolean":return p.owu.Boolean;case"number":return p.owu.Number;case"integer":return p.owu.Integer;case"string":return p.owu.String;default:return e}},ed=(e,t)=>e&&(0,$.Z)(e)?ec(Object.keys(e).map(t=>({name:t,input:e[t]})),t):[],eu=(e,t,n)=>e&&(0,$.Z)(e)?ec(Object.keys(e).map(t=>{var o;return{name:t,input:e[t],required:null!==(o=n(t))&&void 0!==o&&o}}),t):[],ec=(e,t)=>{var{node:n}=t;if(!e||!Array.isArray(e))return[];var o=e.filter(e=>{if((null===(t=e.input)||void 0===t?void 0:t.type)===p.YX3.OBJECT_REF)return!(0,el.K)(e);if((null===(o=e.input)||void 0===o?void 0:o.type)!=="ref"||!(null===(r=e.input)||void 0===r?void 0:r.content))return!1;var t,o,r,[l]=e.input.content.keyPath||[];return!(l&&l===n.id||(0,en.mN)(l))&&!0});return(0,J.x)(o).map(e=>{if(e.input.type===p.YX3.OBJECT_REF){var t=eo.N.inputValueToDTO(e,n.context.variableService,{node:n}),o=(0,ea.v)(t||{},e=>(0,l._)({name:null==e?void 0:e.name},(null==e?void 0:e.input)||{}));return(0,l._)({title:e.label||e.name,name:e.name},ei(p.owu.Object,null==e?void 0:e.required,e.description,o))}var r=n.context.variableService.getWorkflowVariableByKeyPath(e.input.content.keyPath,{node:n}),a=null==r?void 0:r.viewMeta,i=eo.N.getValueExpressionViewType(e.input,n.context.variableService,{node:n})||p.owu.String,s=eo.N.getValueExpressionDTOMeta(e.input,n.context.variableService,{node:n}),d=(0,ea.v)(s||{}),u=ei(i,null==e?void 0:e.required,e.description,d),c=Z(null==a?void 0:a.defaultValue);return void 0!==c&&(u.initialValue=c),(0,l._)({title:e.label||e.name,name:e.name,dtoMeta:s},u)})},ev=(e,t,n)=>{var{node:o,labelPrefix:r="",namePrefix:a=""}=t;if(!e)return[];var i=e.match(/{{([^}]+)}}/g),s=null==i?void 0:i.map(e=>e.replace(/^{{|}}$/g,"")),d=[],u=[];return null==s||s.forEach(e=>{var{nodeNameWithDot:t,fieldPart:n,fieldKeyPath:o}=(0,er.oW)(e),r=a+W()(t+n);!d.find(e=>e.name===r)&&d.push({label:n,name:r,type:"1",input:{type:"ref",content:{keyPath:o}}})}),d.forEach(e=>{var t=o.context.variableService.getWorkflowVariableByKeyPath(null===(a=e.input.content)||void 0===a?void 0:a.keyPath,{node:o});if(t&&!t.globalVariableKey){var a,i,s=n.getNodeTitle(null==t?void 0:t.node),d=null!==(i=t.viewType)&&void 0!==i?i:p.owu.String,c=(0,ea.v)(null==t?void 0:t.dtoMeta);u.push((0,l._)({title:"".concat(r,"-").concat(s,"-").concat(e.label)||e.name,name:e.name},ei(d,null==e?void 0:e.required,e.description,c)))}}),u},ep=(e,t)=>{var n,o,r,i,s={triggerName:m.o.t("workflow_trigger_user_create_name"),triggerId:m.o.t("workflow_trigger_user_create_id"),userId:m.o.t("workflow_trigger_user_create_userid")},d=ed(null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.fixedInputs,t).map(e=>(0,a._)((0,l._)({},e),{name:"__trigger_config_".concat(e.name),title:e.name&&s[e.name]||e.name})),u=[],c=null==e?void 0:null===(r=e.inputs)||void 0===r?void 0:null===(o=r.dynamicInputs)||void 0===o?void 0:o.crontab;return(null==c?void 0:c.type)==="cronjob"&&(u=ed({crontab:null==c?void 0:c.content},t).map(e=>(0,a._)((0,l._)({},e),{name:"__trigger_config_crontab",title:m.o.t("workflow_trigger_user_create_schedula")}))),[...d,...u,...ed(null==e?void 0:null===(i=e.inputs)||void 0===i?void 0:i.payload,t).map(e=>{var t,n=(null===(t=e.name)||void 0===t?void 0:t.split(",")[1])||e.name;return(0,a._)((0,l._)({},e),{name:"__trigger_payload_".concat(n),title:n})})]};function ef(e,t){var n=(0,d.Z)(e,"references")||(0,d.Z)(e,"inputs.references");return ec([...(0,d.Z)(e,"inputParameters")||(0,d.Z)(e,"inputs.inputParameters")||[],...function(e){var t;return null==e?void 0:null===(t=e.filter(e=>{var{preprocessor:t}=e;return t}))||void 0===t?void 0:t.map(e=>{var{preprocessor:t,url:n}=e;return{name:"__image_references_".concat(t),label:m.o.t("Imageflow_reference".concat(t)),input:n}})}(n)||[]],t)}function em(e,t){return eh.apply(this,arguments)}function eh(){return(eh=(0,r._)(function*(e,t){var n=ew(e);if(!n)return[];var o=yield ej(n);return ec(eb(e.inputs.insertParam.fieldInfo,o),t)})).apply(this,arguments)}function eg(e,t){return ex.apply(this,arguments)}function ex(){return(ex=(0,r._)(function*(e,t){var n,o,r,l,a,i,s,d=ew(e);if(!d)return[];var u=yield ej(d);return ec([...eb(null!==(i=null==e?void 0:null===(o=e.inputs)||void 0===o?void 0:null===(n=o.updateParam)||void 0===n?void 0:n.fieldInfo)&&void 0!==i?i:[],u),...eN(null!==(s=null==e?void 0:null===(a=e.inputs)||void 0===a?void 0:null===(l=a.updateParam)||void 0===l?void 0:null===(r=l.condition)||void 0===r?void 0:r.conditionList)&&void 0!==s?s:[])],t)})).apply(this,arguments)}function e_(e,t){var n,o,r,l;return ec(eN(null!==(l=null==e?void 0:null===(r=e.inputs)||void 0===r?void 0:null===(o=r.deleteParam)||void 0===o?void 0:null===(n=o.condition)||void 0===n?void 0:n.conditionList)&&void 0!==l?l:[]),t)}function ey(e,t){var n,o,r,l;return ec(eN(null!==(l=null==e?void 0:null===(r=e.inputs)||void 0===r?void 0:null===(o=r.selectParam)||void 0===o?void 0:null===(n=o.condition)||void 0===n?void 0:n.conditionList)&&void 0!==l?l:[]),t)}function ew(e){var t,n;return null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:null===(t=n.databaseInfoList[0])||void 0===t?void 0:t.databaseInfoID}function ej(e){return g.v6.GetDatabaseByID({id:e,need_sys_fields:!0})}function eb(e,t){return e.map(e=>{var n,o,r=null==t?void 0:null===(o=t.database_info)||void 0===o?void 0:null===(n=o.field_list)||void 0===n?void 0:n.find(t=>t.alterId===e.fieldID);return{name:"__setting_field_".concat(null==e?void 0:e.fieldID),label:null==r?void 0:r.name,input:null==e?void 0:e.fieldValue}})}function eN(e){return e.map((e,t)=>{var{left:n,right:o}=e;return{name:"__condition_right_".concat(t),label:"".concat(n),input:o}})}var ek=()=>{var{isLoading:e,data:t}=(0,F.t)();return e?()=>null:()=>({title:(0,i.jsx)("span",{className:"text-sm",children:m.o.t("scene_workflow_testrun_title",{},"关联场景信息")}),name:"role_information",type:"FormArray",originType:K.ow.ArrayObject,initialValue:null==t?void 0:t.map(e=>({role:e.role,nickname:e.nickname,origin_nickname:e.nickname,player_description:e.description})),component:{type:"Array"},decorator:{type:"FormItem",props:{tooltip:m.o.t("scene_workflow_testrun_title_tooltip",{},"场景角色中存在空位，请先为这些角色预设一个Nickname。Nickname仅支持英文、数字、下划线，且不能重复")}},items:{title:"{{$record.role}} "+"({{$record.origin_nickname || '".concat(m.o.t("scene_edit_roles_list_nickname_empty_seat",{},"空位"),"'}}")+")".concat(m.o.t("scene_workflow_testrun_nickname_nickname",{},"Nickname")),type:"FormString",name:"nickname",required:!0,disabled:"{{!!$record.origin_nickname}}",validator:[{validator:e=>!!/^[a-zA-Z0-9_-]{1,64}$/.test(e)||m.o.t("scene_workflow_testrun_nickname_error",{},"Nickname 仅支持英文、数字、下划线"),triggerType:"onBlur"},{validator:(e,t,n)=>{try{var o,r=n.graph.parent.value,l=null===(o=n.indexes)||void 0===o?void 0:o[0];if(!l)return!0;if(r.filter((e,t)=>t!==l).find(t=>t.nickname===e))return m.o.t("scene_workflow_testrun_nickname_error",{},"昵称仅支持英文、数字、下划线，且不能重复");return!0}catch(e){return f.E7.errorEvent({eventName:"workflow_testrun_nickname_repeat_validate_err",namespace:"workflow",error:e}),!0}},triggerType:"onBlur"}],decorator:{type:"FormItem"},component:{type:"Input",props:{placeholder:m.o.t("scene_workflow_testrun_nickname_placeholder",{},"请输入昵称")}}}})},eC=()=>{var{isSceneFlow:e}=(0,w.oS)(),{isChatflow:t}=(0,w.j1)(),n=(0,u.G2)(H.t),o=ek();return{[K.ny.Start]:(n,r)=>{var a=(null==n?void 0:n.outputs)||[];t&&(a=a.filter(e=>!(0,p.GQ8)(e.name)));var{node:i}=r,s=a.filter(e=>(!e.isPreset||!!e.enabled)&&!0);return(0,J.x)(s).map(t=>{if(t.name===q.R2&&e)return o();var n=i.context.variableService.getWorkflowVariableByKeyPath([i.id,t.name],r);if(!n)return null;var a=(0,ea.v)(n.dtoMeta);return(0,l._)({name:t.name,title:t.name,initialValue:t.defaultValue},ei(es(t.type),t.required,t.description,a))}).filter(Boolean).sort((t,n)=>t.name===q.R2&&e?1:n.name===q.R2&&e?-1:0)},[K.ny.Variable]:(e,t)=>{var n=null==e?void 0:e.inputParameters;return n?ec(n,t):[]},[K.ny.VariableAssign]:(e,t)=>{var n,o;return ec(null==e?void 0:null===(o=e.$$input_decorator$$)||void 0===o?void 0:null===(n=o.inputParameters)||void 0===n?void 0:n.map(e=>{var t,n,o;return{input:null==e?void 0:e.right,name:null==e?void 0:null===(o=e.left)||void 0===o?void 0:null===(n=o.content)||void 0===n?void 0:null===(t=n.keyPath)||void 0===t?void 0:t[1]}}),t)},[K.ny.SubWorkflow]:(e,t)=>{var n,o,r=null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.inputDefs;if(!r||!Array.isArray(r))return[];var l=t.node.getData(v.m).getNodeData(),a=(null==l?void 0:l.flow_mode)===p.wz8.ChatFlow,i=(null==e?void 0:null===(o=e.inputs)||void 0===o?void 0:o.inputParameters)||{};return ec(r.filter(e=>!a||e.name!==p.d9h).map(e=>({input:i[e.name],name:e.name,required:e.required})),t)},[K.ny.Api]:(e,t)=>{var n,{node:o}=t,r=o.getData(v.m).getNodeData(),l=null==r?void 0:r.inputs;if(!l||!Array.isArray(l))return[];var a=(null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.inputParameters)||{};return ec(l.map(e=>({input:a[e.name],name:e.name,required:e.required})),t)},[K.ny.Dataset]:(e,t)=>{var n;return eu(null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.inputParameters,t,()=>!0)},[K.ny.DatasetWrite]:(e,t)=>{var n;return eu(null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.inputParameters,t,()=>!0)},[K.ny.Question]:(e,t)=>{var n=ec(null==e?void 0:e.inputParameters,t),o=(0,d.Z)(e,"questionParams.answer_type"),r=(0,d.Z)(e,"questionParams.option_type");return"option"!==o||r!==Y.G.Dynamic?n:[...n,...ed({dynamic_option:(0,d.Z)(e,"questionParams.dynamic_option")},t)]},[K.ny.Http]:(e,t)=>{var o=ev(null===(c=e.inputs)||void 0===c?void 0:null===(u=c.apiInfo)||void 0===u?void 0:u.url,(0,a._)((0,l._)({},t),{labelPrefix:m.o.t("node_http_api"),namePrefix:"__apiInfo_url_"}),n),r=ec(null==e?void 0:null===(v=e.inputs)||void 0===v?void 0:v.params,t).map(e=>(0,a._)((0,l._)({},e),{name:"__params_".concat(W()(e.name)),title:"".concat(m.o.t("node_http_request_params"),"-").concat(e.name)})),i=ec(null==e?void 0:null===(p=e.inputs)||void 0===p?void 0:p.headers,t).map(e=>(0,a._)((0,l._)({},e),{name:"__headers_".concat(W()(e.name)),title:"".concat(m.o.t("node_http_headers"),"-").concat(e.name)})),s=[];if(null===(f=e.inputs.auth)||void 0===f?void 0:f.authOpen){var u,c,v,p,f,h,g,x=null===(g=e.inputs.auth)||void 0===g?void 0:g.authType,_={[X.Gr.BasicAuth]:"auth.authData.basicAuthData",[X.Gr.Bearer]:"auth.authData.bearerTokenData",[X.Gr.Custom]:"auth.authData.customData.data"};if((s=ec((0,d.Z)(e.inputs,_[x]),t)).length){var y=_[x].split(".").join("_");s=s.map(e=>(0,a._)((0,l._)({},e),{name:"__".concat(y,"_").concat(e.name),title:"".concat(m.o.t("node_http_auth"),"-").concat(e.name)}))}}var w=[],j=null===(h=e.inputs.body)||void 0===h?void 0:h.bodyType,b={[X.eA.Binary]:"body.bodyData.binary",[X.eA.FormData]:"body.bodyData.formData",[X.eA.FormUrlEncoded]:"body.bodyData.formURLEncoded",[X.eA.Json]:"body.bodyData.json",[X.eA.RawText]:"body.bodyData.rawText"},N=null==b?void 0:b[j];return j===X.eA.FormUrlEncoded||j===X.eA.FormData?w=ec((0,d.Z)(e.inputs,N),t).map(e=>{var t=j===X.eA.FormUrlEncoded?"formUrlEncoded":"formData",n=N.split(".").join("_");return(0,a._)((0,l._)({},e),{name:"__".concat(n,"_").concat(W()(e.name)),title:"".concat(t,"-").concat(e.name)})}):j===X.eA.Json||j===X.eA.RawText?w=ev((0,d.Z)(e.inputs,N),(0,a._)((0,l._)({},t),{labelPrefix:m.o.t("node_http_body"),namePrefix:"__".concat(N.replaceAll(".","_"),"_")}),n):j===X.eA.Binary&&(w=ed((0,d.Z)(e.inputs,N),t).map(e=>(0,a._)((0,l._)({},e),{name:"__".concat(N.replaceAll(".","_"),"_fileURL"),title:"".concat(m.o.t("node_http_body"),"-").concat(m.o.t("node_http_body_binary"))}))),[...o,...r,...i,...s,...w]},[K.ny.Loop]:(e,t)=>{var n,o;return[...ec(null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.inputParameters,t),...ec(null==e?void 0:null===(o=e.inputs)||void 0===o?void 0:o.variableParameters,t)]},[K.ny.Batch]:(e,t)=>{var n;return[...ec(null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.inputParameters,t)]},[K.ny.LLM]:(e,t)=>{var n;return ec(null==e?void 0:null===(n=e.$$input_decorator$$)||void 0===n?void 0:n.inputParameters,t)},[K.ny.LTM]:(e,t)=>ec(null==e?void 0:e.inputs.inputParameters,t),[K.ny.Intent]:(e,t)=>ec(null==e?void 0:e.inputs.inputParameters,t),[K.ny.SceneChat]:(t,n)=>{var r=ec(null==t?void 0:t.inputParameters.filter(t=>t.name!==q.R2&&e),n),l=o();return l&&r.push(l),r},[K.ny.SceneVariable]:(e,t)=>{var n,o,r=(null==e?void 0:e.mode)==="set"?null==e?void 0:null===(n=e.set)||void 0===n?void 0:n.input:null==e?void 0:null===(o=e.get)||void 0===o?void 0:o.input;return r?ec([r],t):[]},[K.ny.ImageCanvas]:(e,t)=>{var n;return[...ec(null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.inputParameters,t)]},[K.ny.ImageGenerate]:ef,[K.ny.Database]:(e,t)=>ec(null==e?void 0:e.inputParameters,t),[K.ny.TriggerDelete]:(e,t)=>{var n;return eu(null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.inputParameters,t,e=>"userId"===e)},[K.ny.TriggerRead]:(e,t)=>{var n;return eu(null==e?void 0:null===(n=e.inputs)||void 0===n?void 0:n.inputParameters,t,e=>"userId"===e)},[K.ny.TriggerUpsert]:ep,[K.ny.DatabaseCreate]:em,[K.ny.DatabaseDelete]:e_,[K.ny.DatabaseQuery]:ey,[K.ny.DatabaseUpdate]:eg,default:(e,t)=>ec(null==e?void 0:e.inputParameters,t),batch:(e,t)=>{var n,{node:o}=t,r=null===(n=o.getNodeMeta())||void 0===n?void 0:n.batchPath;if(!r)return[];var i=[K.ny.SubWorkflow,K.ny.Api].includes(o.flowNodeType)?"/inputs/batchMode":"/batchMode";if("batch"!==o.getData(u.Ps).formModel.getFormItemValueByPath(i))return[];var s=o.getData(u.Ps).formModel.getFormItemValueByPath(r);return ec(null==s?void 0:s.inputLists,t).map(e=>{if("FormItem"===e.decorator.type){var t,n,o,r=(0,a._)((0,l._)({},null==e?void 0:e.decorator,_.A$.decorator),{props:(0,a._)((0,l._)({},null==e?void 0:null===(t=e.decorator)||void 0===t?void 0:t.props),{tag:[null==e?void 0:null===(o=e.decorator)||void 0===o?void 0:null===(n=o.props)||void 0===n?void 0:n.tag,m.o.t("workflow_detail_node_batch")].filter(Boolean).join(" - ")})});return(0,a._)((0,l._)({},e),{decorator:r})}return e})},setting:(e,t)=>{var{node:n}=t;if(n.flowNodeType===K.ny.Batch){var o=n.getData(u.Ps).formModel.getFormItemValueByPath("/inputs");return ed((0,U.Z)(o,["batchSize","concurrentSize"]),t)}if(n.flowNodeType===K.ny.Loop){var r=n.getData(u.Ps).formModel.getFormItemValueByPath("/inputs");if("count"===r.loopType)return ed((0,U.Z)(r,"loopCount"),t)}return[]}}},eS=(e,t)=>{var{startNodeId:n,workflowId:o,testSetIsTitle:i}=t,s=(0,a._)((0,l._)({},_.Dn),{children:_.Dn.children.map(e=>{if(e.name===_.Lp.DatasetsIs&&i)return(0,a._)((0,l._)({},e),{component:(0,a._)((0,l._)({},e.component),{props:(0,a._)((0,l._)({},e.component.props),{title:i})})});if(e.name===_.Lp.DatasetsName){var s;return(0,a._)((0,l._)({},e),{validator:[...e.validator||[],{triggerType:"onBlur",validator:(s=(0,r._)(function*(e){if(!e)return!0;if(!RegExp("^[\\w\\s\\u4e00-\\u9fa5]+$","u").test(e))return m.o.t("create_plugin_modal_nameerror_cn");try{var{isPass:r}=yield g.xd.CheckCaseDuplicate({bizCtx:t.bizCtx,bizComponentSubject:{componentID:n,componentType:h.re.CozeStartNode,parentComponentID:o,parentComponentType:h.re.CozeWorkflow},caseName:e});return!!r||m.o.t("workflow_testset_name_duplicated")}catch(e){return f.kg.error({error:e,eventName:"testset_name_validate"}),!0}}),function(e){return s.apply(this,arguments)})}]})}return e})});e.push(s)},eI=e=>{var{onCreate:t}=e,{Text:n}=x.ZT;return(0,i.jsxs)("span",{children:[m.o.t("workflow_testset_save"),(0,i.jsx)(n,{link:!0,style:{lineHeight:"20px"},onClick:e=>{e.stopPropagation(),null==t||t()},children:m.o.t("workflow_testset_create")})]})},eT=(e,t)=>{var n,o=(0,u.G2)(y.GH),f=(0,u.G2)(c.f),{generateInitialValues:h}=A(),g=(0,u.G2)(y.w3),x=(0,w.IW)(),{canTestset:b}=(0,w.j1)(),{getNode:N}=(0,B.J)(),k=eC(),C=(0,j.n)(),S=(0,s.useMemo)(()=>e&&e.flowNodeType!==p.nyy.Start?_.Gf.Single:_.Gf.Default,[e,null==e?void 0:e.flowNodeType]),{queryNeedBot:I}=(0,V.t)(),{needSceneBot:T,sceneBotSchema:E}=R(null==e?void 0:e.flowNodeType);return{generate:(n=(0,r._)(function*(){var n=e;if(!n){var r=N();if(!r)return null;n=r}var s=x.formSchemaGen.start(),c=n.getData(v.m).getNodeData(),y=n.getData(u.Ps).formModel.getFormItemValueByPath("/"),w=null==y?void 0:null===(K=y.nodeMeta)||void 0===K?void 0:K.title,j=(0,a._)((0,l._)({},_.Fk),{title:m.o.t("workflow_debug_testonenode_group",{nodeTitle:w}),component:(0,a._)((0,l._)({},_.Fk.component),{props:{icon:(null==c?void 0:c.icon)||(null==y?void 0:null===(X=y.nodeMeta)||void 0===X?void 0:X.icon),hideGroupLabel:null==t?void 0:t.hideGroupLabel}}),children:[]}),D=k.batch(y,{node:n});D.length&&j.children.push((0,a._)((0,l._)({},_.hs),{children:D}));var Z=k.setting(y,{node:n});Z.length&&j.children.push((0,a._)((0,l._)({},_._s),{children:Z}));var M=k[n.flowNodeType]||k.default,P=yield M(y,{node:n});P.length&&j.children.push((0,a._)((0,l._)({},_.kM),{children:P}));var L=[],z=yield I(S,n),{needBot:O,needConversation:A,hasVariableNode:F,hasVariableAssignNode:R,hasDatabaseNode:V,hasLTMNode:B,hasChatHistoryEnabledLLM:G,hasConversationNode:W}=z,U=n.flowNodeType===p.nyy.SubWorkflow,H=(0,d.Z)(c,"flow_mode")===p.wz8.ChatFlow,J=W||U&&H,q={disableBot:J,disableBotTooltip:J?m.o.t("wf_chatflow_141"):"",disableProject:B,disableProjectTooltip:B?m.o.t("wf_chatflow_142"):""};if(O){var K,X,Y,Q=(0,_.Vz)(z,!0,g);(null===(Y=Q.children)||void 0===Y?void 0:Y[0])&&(Object.assign(Q.children[0].component,{props:(0,l._)({hasVariableNode:F,hasVariableAssignNode:R,hasDatabaseNode:V,hasLTMNode:B,hasChatHistoryEnabledLLM:G},q)}),Object.assign(Q.children[0],{events:{onFormValueChange:e=>{var t,n=(null===(t=e.currentTarget)||void 0===t?void 0:t.value)||{};f.loadGlobalVariables(1===n.type?"bot":"project",n.id)}}})),L.push(Q)}if(A){var $,ee=(0,_.H5)(g);O?(null===($=L[0])||void 0===$?void 0:$.children)&&L[0].children.push(ee):(Object.assign(ee,{visible:!0}),L.push(ee))}j.children.length&&L.push(j),T&&L.push(E),b&&L.length&&S===_.Gf.Default&&!o.globalState.config.preview&&eS(L,{bizCtx:C,startNodeId:n.id,workflowId:o.globalState.config.workflowId,testSetIsTitle:(null==t?void 0:t.onCreateTestSet)?(0,i.jsx)(eI,{onCreate:null==t?void 0:t.onCreateTestSet}):void 0});var et={id:n.id,type:S,fields:L};return yield h(et),x.formSchemaGen.end(s,{node_type:n.flowNodeType}),et}),function(){return n.apply(this,arguments)})}}},398038:function(e,t,n){n.d(t,{W:function(){return p}});var o=n(825955),r=n(455069),l=n(408487),a=n(686436),i=n(994983),s=n(586421),d=n(184449),u=n(189914),c=n(335759),v=n(921396),p=()=>{var e=(0,a.G2)(i.GH),t=(0,d.X6)(),n=(0,d.LK)(),{getNode:p}=(0,v.J)(),{validate:f}=(0,s.Q)(),{generate:m}=(0,c.D)(),h=(0,r.useCallback)((0,o._)(function*(){var e=yield f();return e&&t.open("problemPanel","bottom"),e}),[f,t]);return{testRunFlow:(0,r.useCallback)((0,o._)(function*(){var o=p();if(!o)return;if(yield n.waitSaving(),yield n.save(),e.clearTestRun(),e.globalState.flowMode===l.wz8.ChatFlow){if(yield h())return;t.open(u.Gd.TestChatFlowForm,"right",{node:o});return}if(t.open(u.Gd.TestFlowForm,"right",{node:o}),yield h())return;var r=yield m();if(null==r?!void 0:!r.fields.length)e.testRun()}),[h,e,t])}}},990359:function(e,t,n){n.d(t,{s:function(){return g}});var o=n(825955),r=n(686436),l=n(647938),a=n(408487),i=n(707107),s=n(181907),d=n(189914),u=n(864431),c=n(115597),v=n(994983),p=n(680634),f=n(184449),m=n(676358),h=n(335759),g=()=>{var e,t,n=(0,f.j1)(),{type:g,id:x}=(0,l.j)(),{closeBizIDE:_}=(0,p.V)(),y=(0,f.XW)(),{generate:w}=(0,h.D)(),j=(0,f.zz)(),b=(0,f.HX)(),N=(0,s.X)(),k=(0,r.G2)(v.Yy),C=(0,r.G2)(v.GH),S=(0,r.G2)(r.L4),{setLoading:I}=(0,m.v)(c.TJ);var T=(e=(0,o._)(function*(){var e=yield S.toJSON(),t=yield b.validateSchema(e,"project"===g?{projectId:x}:{botId:x}),n=!!(null==t?void 0:t.length);return{isError:n,nodeErrorMap:null==t?void 0:t.reduce((e,t)=>{var n,o,r,l,i,s=(null===(n=t.node_error)||void 0===n?void 0:n.node_id)||"";t.type===a.GdW.BotConcurrentPathErr||t.type===a.GdW.BotValidatePathErr?(s=(null===(r=t.path_error)||void 0===r?void 0:r.start)||"",o={nodeId:(null===(l=t.path_error)||void 0===l?void 0:l.start)||"",targetNodeId:null===(i=t.path_error)||void 0===i?void 0:i.end,errorInfo:t.message||"",errorType:"line",errorLevel:"error"}):o={nodeId:s,errorInfo:t.message||"",errorType:"node",errorLevel:"error"};var d=e[s]||[];return d.push(o),e[s]=d,e},{})}}),function(){return e.apply(this,arguments)}),E=e=>{e&&Object.keys(e).forEach(t=>{var n=e[t];j.setNodeError(t,n)})},{activeId:D,closeSideSheet:Z}=(0,u.dI)();var M=(t=(0,o._)(function*(){Z(D),(0,i.Gg)(i.Kg.workflow_testrun_result_front,{space_id:n.spaceId,workflow_id:n.workflowId,action:"testrun_start"}),I(!0);try{if(!(yield _())){(0,i.Gg)(i.Kg.workflow_testrun_result_front,{space_id:n.spaceId,workflow_id:n.workflowId,action:"manual_end"});return}C.clearTestRun();var e,{hasError:t,nodeErrorMap:o}=yield k.validateWorkflow();if(t){(0,i.Gg)(i.Kg.workflow_testrun_result_front,{space_id:n.spaceId,workflow_id:n.workflowId,action:"testrun_end",results:"fail",fail_end:"front_end",errtype:"flow_validate"}),j.openSideSheet(),E(o),y.validateAllLine();return}var{isError:r,nodeErrorMap:l}=yield T();if(r){(0,i.Gg)(i.Kg.workflow_testrun_result_front,{space_id:n.spaceId,workflow_id:n.workflowId,action:"testrun_end",results:"fail",fail_end:"server_end",errtype:"flow_validate"}),j.openSideSheet(),E(l),y.validateAllLine();return}y.validateAllLine();var a=yield w();if(!a)return;if(j.closeSideSheet(),!(null===(e=a.fields)||void 0===e?void 0:e.length)){C.testRun();return}C.testFormState.openTestForm(a)}finally{I(!1)}}),function(){return t.apply(this,arguments)});return{testRunFlow:M,testRunFlowV2:()=>{C.clearTestRun(),N.open(d.Gd.TestFlowForm)}}}},676358:function(e,t,n){n.d(t,{v:function(){return i}});var o=n(455069),r=n(450562),l=n(686436),a=n(497744),i=e=>{var t=(0,l.X2)(a.eI),n=(0,l.X2)(a.JM),[i,s]=(0,o.useState)(!1),{config:{saving:d,saveLoading:u,viewStatus:c}}=t,{config:{frozen:v}}=n,p=(0,o.useMemo)(()=>!i&&(!!v||d),[i,v,d]),f=(0,o.useMemo)(()=>v&&v===e,[v,e]);return{loading:i,setLoading:s,saving:d,saveLoading:u,frozen:v,disabled:p,isMineRunning:f,running:(0,o.useMemo)(()=>c===r.tnn.EXECUTING,[c])}}},997363:function(e,t,n){n.d(t,{n:function(){return i}});var o=n(455069),r=n(287487),l=n(115597),a=n(184449),i=()=>{var e=(0,a.j1)().spaceId,t=r.Z.useUserInfo(),n=null==t?void 0:t.user_id_str;return(0,o.useMemo)(()=>({bizSpaceID:e,connectorUID:n,connectorID:l.D0}),[e,n])}},511743:function(e,t,n){n.d(t,{d:()=>v});var o=n("151064"),r=n("455069"),l=n("206058"),a=n("825955"),i=n("615655"),s=n("450562"),d=n("298203"),u=n("686436"),c=n("992683"),v=e=>{var{testRunResult:t,nodeId:n}=e,{images:v,downloadImages:p}=function(e,t){var n=(0,u.Dc)(),o=(0,u.G2)(u.L4),[l,v]=(0,r.useState)([]),p=(0,c.E)(l);return(0,r.useEffect)(()=>{function r(){return(r=(0,a._)(function*(){if(!t)return;if((null==e?void 0:e.nodeStatus)===s.nBi.Success){var r,a=(null==e?void 0:e.NodeType)==="End"||(null==e?void 0:e.NodeType)==="Message"?null==e?void 0:e.input:(null==e?void 0:e.output)||"";r=(0,d.f5)(a)}var u=n.entityManager.getEntityById(t);if(!!u){var c=yield o.toNodeJSON(u),p=(0,s.Iyz)({outputData:r,nodeSchema:c});!(0,i.Z)(null==p?void 0:p.sort(),null==l?void 0:l.sort())&&v(p)}})).apply(this,arguments)}!function(){r.apply(this,arguments)}()},[t,o,e,l,n]),{images:l,downloadImages:p}}(t,n);return(0,o.jsx)(l.tF,{images:v,onDownload:p})}},862339:function(e,t,n){n.d(t,{W:function(){return r}});var o=n(686436);function r(){return(0,o.PF)()}},992683:function(e,t,n){n.d(t,{E:function(){return l}});var o=n(825955),r=n(184449);function l(e){var{info:{name:t}}=(0,r.j1)();return()=>{e.forEach(e=>{(function(e,t){a.apply(this,arguments)})(e,t)})}}function a(){return(a=(0,o._)(function*(e,t){var n=yield fetch(e),o=yield n.blob(),r=URL.createObjectURL(o),l=document.createElement("a");l.href=r,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l)})).apply(this,arguments)}},56695:function(e,t,n){n.d(t,{_:function(){return l}});var o=n(184449),r=n(862339);function l(){var e=(0,r.W)().id;return(0,o.zz)().getNodeExecResult(e)}},561229:function(e,t,n){n.d(t,{P:()=>z});var o=n("825955"),r=n("808549"),l=n("151064"),a=n("538059"),i=n("455069"),s=n("801815"),d=n("252237"),u=n.n(d),c=n("416290"),v=n("136515"),p=n("336205"),f=n("674343"),m=n("298203"),h=n("775699"),g=n("9734"),x=n("206616"),_=n("570374"),y=()=>{var[e,t]=(0,i.useState)(!1),n=(0,i.useRef)(null);return(0,_.Z)(e=>{for(var n of e){var o,r,l,a;"attributes"===n.type&&"class"===n.attributeName&&(null===(r=n.target)||void 0===r?void 0:null===(o=r.className)||void 0===o?void 0:o.includes("semi-upload-drag-area"))&&t(null===(a=n.target)||void 0===a?void 0:null===(l=a.className)||void 0===l?void 0:l.includes("semi-upload-drag-area-legal"))}},n,{attributes:!0,subtree:!0,attributeFilter:["class"]}),{ref:n,fileDragging:e}},w=n("915757"),j=n("740106"),b=n("893461"),N=e=>e.replace("image/*","image").replaceAll(",.",", ");function k(e){var{accept:t,fileDragging:n,disabled:o,fileType:r,fileList:a,setFileList:i}=e;return(0,l.jsxs)("div",{className:"w-full h-full relative",children:[(0,l.jsx)(h.u,{position:"bottom",content:p.o.t("imageflow_upload_type",{type:N(t)}),children:(0,l.jsx)("div",{className:b.Z["custom-upload-drag"],children:(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)(w.Isu,{style:{visibility:n?"hidden":"visible"},className:"text-[20px] coz-fg-hglt"}),(0,l.jsx)("span",{className:"mt-[6px] text-[12px]",children:n?p.o.t("workflow_testset_upload_release"):p.o.t("workflow_testset_upload_title")}),(0,l.jsx)("span",{style:{visibility:n?"hidden":"visible"},className:"mt-[4px] text-[12px] coz-fg-dim",children:p.o.t("workflow_testset_upload_content",{xx:("image"===r?j.n0:j.Tb)/1048576})})]})})}),a&&(null==a?void 0:a.length)>0?(0,l.jsxs)("div",{onClick:e=>e.stopPropagation(),className:u()("w-full flex items-center justify-between text-[12px] cursor-default",b.Z["custom-upload-drag-actions"]),children:[(0,l.jsx)("span",{className:"coz-fg-primary font-medium  cursor-text",children:p.o.t("workflow_testset_upload_uploaded")}),(0,l.jsx)(h.zx,{disabled:o,onClick:()=>{if(!o)null==i||i([])},theme:"light",style:{borderColor:"rgba(var(--coze-bg-1), var(--coze-bg-1-alpha))"},className:"text-[12px] pl-[3px] pr-[3px] !min-w-0 font-medium !coz-fg-primary bg-background-1",size:"small",children:p.o.t("workflow_testset_upload_clean")})]}):null]})}var C=n("689896"),S=n("120454"),I=n("966140"),T=n("508162"),E=e=>{if("uploading"===e.status)return e.percent?(0,l.jsxs)("span",{className:"text-[12px] coz-fg-secondary",children:[e.percent,"%"]}):(0,l.jsx)(f.yC,{wrapperClassName:T.Z["file-icon-loading"],style:{width:14,height:14,lineHeight:"".concat(14,"px")},spinning:!0});return"success"!==e.status||e.hover?(0,l.jsx)(f.hU,{color:"secondary",size:"small",icon:(0,l.jsx)(w.dVD,{}),onClick:e.onRemove}):(0,l.jsx)("span",{className:"text-[12px] coz-fg-secondary",children:e.size})};function D(e){var t,n=(0,i.useRef)(null),o=(0,I.Z)(n);return(0,l.jsxs)("div",{className:"w-full custom-upload-file-item",children:[(0,l.jsxs)("div",{ref:n,className:u()("w-full h-full flex items-center relative",T.Z.container),children:[null===(t=e.previewFile)||void 0===t?void 0:t.call(e,e),(0,l.jsx)(f.ZT.Text,{ellipsis:{showTooltip:{opts:{content:e.name}}},className:T.Z.name,children:e.name}),(0,l.jsx)("span",{className:"text-[12px] flex items-center",children:(0,l.jsx)(E,(0,S._)((0,r._)({},e),{hover:o}))}),"uploading"===e.status&&(0,l.jsx)("div",{className:T.Z.progress,children:(0,l.jsx)("div",{className:T.Z["progress-inner"],style:{width:"".concat(e.percent||0,"%")}})})]}),e.validateMessage?(0,l.jsx)("div",{className:"coz-fg-hglt-red text-[12px]",children:e.validateMessage}):null]})}var Z="x-wf-file_name",M=e=>{var t,n=null==e?void 0:e.url,o=null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"";try{var r=new URL(n),l=new URLSearchParams(r.search);return l.has(Z)?l.set(Z,o):l.append(Z,o),r.search=l.toString(),r.toString()}catch(e){return n}},P=e=>{try{var t,n=new URL(e),o=new URLSearchParams(n.search),r=null!==(t=o.get(Z))&&void 0!==t?t:p.o.t("plugin_file_unknown");return{url:e,uid:(0,s.x0)(),name:r}}catch(t){return console.error("parse file url error: ".concat(e),t),{url:"",uid:(0,s.x0)(),name:p.o.t("plugin_file_unknown")}}},L=(e,t)=>{if(t){var n=(0,m.f5)(e);if(Array.isArray(n))return n.map(e=>P(e))}return e?[P(e)]:[]},z=e=>{var t,{validateStatus:n,value:d,onChange:m,onBlur:_,onFocus:w,accept:j,multiple:N,disabled:S,fileType:I}=e,T=(0,i.useRef)(!1),{ref:E,fileDragging:Z}=y(),P=(0,c.Z)(E),z=N?20:1,{upload:O,fileList:A,isUploading:F,deleteFile:R,setFileList:V}=(0,x.Vn)({multiple:N,fileType:I,accept:j,maxFileCount:z}),B=()=>{!T.current&&(T.current=!0,null==w||w())},G=()=>{T.current&&(T.current=!1,null==_||_())};var W=(t=(0,o._)(function*(e){var{fileInstance:t}=e;yield O(t)}),function(e){return t.apply(this,arguments)}),U=(0,g.Z)(()=>{var e;if(N){var t=A.filter(e=>e.url).map(e=>M(e));e=(null==t?void 0:t.length)>0?JSON.stringify(t):void 0}else e=M(null==A?void 0:A[0]);return e}),H=(0,g.Z)(e=>null==m?void 0:m(e));(0,v.Z)(()=>{var e=U();null==H||H(e)},[A]),(0,i.useEffect)(()=>{U()!==d&&V(L(d,N))},[d]);var J=A.map(e=>({name:e.name,size:void 0!==e.size?(0,x.td)(e.size):"",uid:e.uid||(0,s.x0)(),status:e.status||x.w_.Success,url:e.uil,validateMessage:e.validateMessage,percent:e.percent,preview:!0}));return(0,l.jsx)(a.Z,{onClickAway:()=>{!F&&G()},children:(0,l.jsx)("div",{ref:E,className:u()(b.Z.container,{[b.Z["hide-upload-area"]]:A.length>=z,[b.Z["list-item-wrap"]]:P&&P.width>388}),children:(0,l.jsx)(h.gq,{disabled:S,action:"",limit:z,fileList:J,"data-testid":e["data-testid"],className:"error"===n?"has-error":"",customRequest:W,draggable:!0,dragMainText:p.o.t("imageflow_upload_action_common"),dragSubText:p.o.t("imageflow_upload_type",{type:j}),multiple:N,accept:j,onDrop:B,onOpenFileDialog:B,onAcceptInvalid:()=>{f.FN.error(p.o.t("imageflow_upload_error_type",{type:j}))},previewFile:e=>{var{uid:t}=e,n=A.find(e=>e.uid===t);if(n)return(0,l.jsx)(C.a,{file:n,size:16,hideLoadingIcon:!0})},onRemove:(e,t,n)=>{R(n.uid)},showClear:!1,renderFileItem:e=>(0,l.jsx)(D,(0,r._)({},e)),children:(0,l.jsx)(k,{accept:j,fileType:I,disabled:S,fileDragging:Z,fileList:A,setFileList:V})})})})}},693963:function(e,t,n){n.d(t,{J:()=>x});var o,r=n("808549"),l=n("473980"),a=n("151064"),i=n("455069"),s=n("252237"),d=n.n(s);var u=((o={}).UPLOAD="upload",o.INPUT="input",o),c=n("561229"),v=n("674343"),p=n("674145"),f=e=>{var{onChange:t,disabled:n,multiple:o,value:r,onBlur:l,inputURLClassName:s}=e,d=(0,i.useRef)(r);return o?(0,a.jsx)(p.L,{value:r,onChange:e=>{d.current=e,null==t||t(e)},disabled:n,onBlur:()=>{!d.current&&(null==t||t("[]")),null==l||l()}}):(0,a.jsx)("div",{className:s,children:(0,a.jsx)(v.II,{value:r,onChange:e=>{null==t||t(""===e?void 0:e)},onBlur:l,disabled:n,size:"small"})})},m=n("336205"),h=e=>{var{disabled:t,value:n,onChange:o,onBlur:l}=e,i=[{label:m.o.t("workflow_250310_09",void 0,"通过上传"),value:u.UPLOAD},{label:m.o.t("workflow_250310_10",void 0,"输入URL"),value:u.INPUT}];return(0,a.jsx)(v.Ph,{size:"small",className:"w-full",disabled:t,value:n,onChange:e=>{o(e)},onBlur:l,children:i.map(e=>(0,a.jsx)(v.Ph.Option,(0,r._)({},e)))})},g=n("79401"),x=e=>{var{fileInputType:t,onInputTypeChange:n}=e,o=(0,l._)(e,["fileInputType","onInputTypeChange"]),[s,v]=(0,i.useState)(t||u.UPLOAD);return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:d()(g.Z["file-input-type-select"],"overflow-hidden absolute top-[-32px] right-0 w-[95px]",o.inputTypeSelectClassName),children:(0,a.jsx)(h,{value:s,onChange:e=>{v(e),null==n||n(e)},disabled:o.disabled})}),s===u.UPLOAD?(0,a.jsx)(c.P,(0,r._)({},o)):(0,a.jsx)(f,(0,r._)({},o))]})}},674145:function(e,t,n){n.d(t,{Y:()=>y,L:()=>_});var o=n("808549"),r=n("473980"),l=n("151064"),a=n("455069"),i=n("252237"),s=n.n(i),d=n("336205"),u=n("775699"),c=n("966219"),v=n("915757"),p=n("674343"),f=e=>e.languages.json.jsonDefaults.diagnosticsOptions.schemas||[],m=(e,t,n)=>{e.languages.json.jsonDefaults.diagnosticsOptions;var o=f(e);e.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,schemaValidation:"error",schemas:[...o,{uri:n,fileMatch:[n],schema:t}]})},h=(e,t)=>{var n=f(e).filter(e=>e.uri!==t);e.languages.json.jsonDefaults.setDiagnosticsOptions({schemas:n})},g=n("409823"),x=n("63903"),_=e=>{var{validateStatus:t,onBlur:n,onFocus:i,jsonSchema:f,options:_={},disabled:y,value:w,onChange:j,className:b,height:N,defaultValue:k}=e,C=(0,r._)(e,["validateStatus","onBlur","onFocus","jsonSchema","options","disabled","value","onChange","className","height","defaultValue"]),[S,I]=(0,a.useState)(!1),T=(0,a.useRef)(),E=(0,a.useRef)(w),D=()=>{var e;null===(e=T.current)||void 0===e||e.trigger("editor","editor.action.formatDocument",{})};(0,a.useEffect)(()=>{w!==E.current&&D()},[w]);var Z=(0,a.useRef)([]),M=(0,a.useCallback)(()=>{Z.current.forEach(e=>e.dispose()),Z.current=[]},[Z]),P=(0,a.useCallback)(()=>{I(!1),null==n||n()},[n]),L=(0,a.useCallback)(()=>{I(!0),null==i||i()},[i]),z=(0,a.useCallback)((e,t)=>{T.current=e;var n,o=null===(n=e.getModel())||void 0===n?void 0:n.uri.toString();M();var r=e.onDidBlurEditorWidget(P),l=e.onDidFocusEditorWidget(L);Z.current=[r,l],f&&o&&(m(t,f,o),e.onDidDispose(()=>h(t,o))),D()},[P,L]);(0,a.useEffect)(()=>()=>{M()},[M]);var O=(0,a.useMemo)(()=>{try{var e=JSON.parse(w);return"object"==typeof e}catch(e){return!1}},[w]);return(0,l.jsxs)("div",{"data-testid":C["data-testid"],className:s()(x.Z["json-editor"],b),children:[(0,l.jsxs)("div",{className:"w-full h-[36px] px-[8px] rounded-t-[8px] coz-bg-primary flex items-center justify-between",children:[(0,l.jsx)("div",{children:"json"}),(0,l.jsxs)("div",{children:[void 0!==k?(0,l.jsx)(p.u,{content:d.o.t("Reset"),children:(0,l.jsx)(u.y3,{className:"bg-transparent",disabled:y,onClick:()=>{null==j||j(k)},icon:(0,l.jsx)(v.mxP,{})})}):null,(0,l.jsx)(p.u,{content:d.o.t("workflow_exception_ignore_format"),children:(0,l.jsx)(u.y3,{className:"bg-transparent",disabled:y||!O,onClick:()=>{try{var e=JSON.parse(w),t=JSON.stringify(e,null,4);E.current=t,null==j||j(t)}catch(e){console.error(e)}},icon:(0,l.jsx)(v.bGR,{})})})]})]}),(0,l.jsx)("div",{className:s()("p-[12px] h-[120px] transition-height duration-200 ease-in",{[x.Z.error]:"error"===t,[x.Z.focus]:S&&!N,[x.Z.disabled]:y}),style:N?{height:"".concat(N,"px")}:{},children:(0,l.jsx)(c.Editor,(0,o._)({value:w||"",onChange:e=>{if(!!S)e?(E.current=e,null==j||j(e)):(E.current=void 0,null==j||j(void 0))},theme:"icube-dark",defaultLanguage:"json",className:g.Z.light,options:(0,o._)({fontSize:13,minimap:{enabled:!1},contextmenu:!1,scrollbar:{verticalScrollbarSize:10,alwaysConsumeMouseWheel:!1},lineNumbers:"on",lineNumbersMinChars:3,folding:!1,lineDecorationsWidth:2,renderLineHighlight:"none",glyphMargin:!1,scrollBeyondLastLine:!1,overviewRulerBorder:!1,wordWrap:"on",fixedOverflowWidgets:!0,readOnly:y},_),onMount:z},C))})]})},y=(0,u.Q2)(_,{valueKey:"value",onKeyChangeFnName:"onChange"})},279892:function(e,t,n){n.d(t,{BV:()=>f}),n("462694"),n("849293"),n("336067");var o=n("825955"),r=n("808549"),l=n("151064"),a=n("455069"),i={},s=e=>i[e],d=n("336205"),u=n("915757"),c=n("674343"),v=n("586421"),p=n("184449"),f=e=>{var t,n,i,f=(0,p.j1)(),m=(0,p.IE)(),h=(0,p.xv)(),g=(0,p.zz)(),{validate:x}=(0,v.Q)(),_=(0,p.IW)(),y=(0,p.X6)(),{config:{saving:w},workflowId:j}=f,{config:{frozen:b}}=m,{config:{executeId:N}}=g,[k,C]=(0,a.useState)(!1),[S,I]=(0,a.useState)(null!==(i=e.triggerId)&&void 0!==i?i:s(j)),T=(0,a.useMemo)(()=>w||!!b,[w,b]),E=(0,a.useMemo)(()=>!!b&&b===S&&!!N,[b,S,N]);var D=(t=(0,o._)(function*(){if(_.tryStart({scene:"trigger"}),yield x()){y.open("problemPanel","bottom");return}var e=S||s(j);S!==e&&e&&I(e),e&&h.testRunTrigger(e)}),function(){return t.apply(this,arguments)});var Z=(n=(0,o._)(function*(){try{C(!0),yield h.cancelTestRun()}finally{C(!1)}}),function(){return n.apply(this,arguments)});return E?(0,l.jsx)(c.u,{content:d.o.t("workflow_testrun_one_node_cancel_run_tooltips"),children:(0,l.jsx)(c.hU,{color:"secondary",disabled:k,onClick:Z,icon:(0,l.jsx)(u.noE,{})})}):(0,l.jsx)(c.hU,(0,r._)({color:"secondary",disabled:T,onClick:D,icon:(0,l.jsx)(u.Y6z,{})},e))}},336067:function(e,t,n){n(151064),n(455069),n(206058),n(184449)},849293:function(e,t,n){n.d(t,{o:function(){return x}});var o=n(825955),r=n(151064),l=n(455069),a=n(686436),i=n(220192),s=n(450562),d=n(336205),u=n(915757),c=n(674343),v=n(994983),p=n(189914),f=n(676358),m=n(335759),h=n(14651),g=n(184449),x=()=>{var e,t,n,x=(0,a.km)(),{getNodeSetterId:_}=(0,s.FCD)(),y=(0,g.X6)(),w=(0,i.c2)(),j=(0,g.IW)(),{isNodeSideSheet:b}=(0,g.$v)(),N=(0,a.G2)(v.GH),{playgroundProps:k}=(0,g.j1)(),{loading:C,disabled:S,isMineRunning:I}=(0,f.v)(x.id),T=(0,g.IE)(),{cancelTestRun:E,canceling:D}=(0,h.x)(),{generate:Z}=(0,m.D)(x);var M=(0,l.useCallback)((e=(0,o._)(function*(e){e.stopPropagation(),j.tryStart({scene:"node"});var{hasError:t}=yield w.validateNode(x);if(t&&c.FN.error({content:d.o.t("workflow_detail_toast_validation_failed"),showClose:!1}),b){if(t)return;T.showTestNodeForm()}else{if(y.open(p.Gd.NodeForm,"right",{node:x,showTestNodeForm:!t}),t)return;T.showTestNodeForm()}var n=yield Z();if(null==n?!void 0:!n.fields.length)N.clearTestRun(),N.testRunOneNode({nodeId:x.id})}),function(t){return e.apply(this,arguments)}),[T]);return![s.nyy.Start,s.nyy.End,s.nyy.If].includes(x.flowNodeType)&&!k.disabledSingleNodeTest&&(null===(n=x.getNodeRegistry())||void 0===n?void 0:null===(t=n.meta)||void 0===t?void 0:t.test)?I?(0,r.jsx)(c.u,{content:d.o.t("workflow_testrun_one_node_cancel_run_tooltips"),children:(0,r.jsx)(c.hU,{color:"secondary",size:b?"default":"small",icon:(0,r.jsx)(u.noE,{}),onClick:E,disabled:D,"data-testid":_("testonenode_cancel")})},"".concat(x.id,"-cancel-test-run")):(0,r.jsx)(c.u,{content:d.o.t("workflow_debug_testonenode"),children:(0,r.jsx)(c.hU,{color:"secondary",size:b?"default":"small",disabled:S,icon:(0,r.jsx)(u.NvC,{}),onClick:M,loading:C,"data-testid":_("testonenode")})},"".concat(x.id,"-test-run")):null}},462694:function(e,t,n){n.d(t,{P:function(){return f}});var o=n(825955),r=n(808549),l=n(120454),a=n(151064),i=n(455069),s=n(686436),d=n(206058),u=n(336205),c=n(184449),v=n(398038),p=n(497744),f=e=>{var[t,n]=(0,i.useState)(!1),{config:{frozen:f}}=(0,s.X2)(p.JM),{projectId:m,projectCommitVersion:h}=(0,c.j1)(),g=(0,c.IW)(),{testRunFlow:x}=(0,v.W)();return(0,a.jsx)(d.ao,(0,l._)((0,r._)({disabled:!!f||t||!!(m&&h),onClick:(0,o._)(function*(){g.tryStart({scene:"toolbar"});try{n(!0),yield x()}finally{n(!1)}})},e),{children:u.o.t("workflow_detail_title_testrun")}))}},880954:function(e,t,n){n.d(t,{_:function(){return r}});var o=n(450562),r=e=>[o.owu.Voice].includes(e)?"voice":[o.owu.Image,o.owu.ArrayImage].includes(e)?"image":"object"},880792:function(e,t,n){n.d(t,{K:function(){return r}});var o=n(450562);function r(e){var t=null==e?void 0:e.input;return(null==t?void 0:t.type)===o.YX3.OBJECT_REF&&!function e(t){return(null==t?!!void 0:!!t.length)&&t.some(t=>{var n;return(null===(n=t.input)||void 0===n?void 0:n.type)===o.YX3.REF||e(t.children)})}(e.children)}},873037:function(e,t,n){n.d(t,{V:function(){return a},_:function(){return l}});var o=n(156133),r=n(550655),l=(e,t)=>{if(!!e)return Object.entries(e).reduce((e,n)=>{var[l,a]=n;return(0,o.Z)(a)||(0,r.Z)(a)?e[l]=String(a):(null==t?void 0:t.includes(l))?e[l]=JSON.stringify(a):e[l]=a,e},{})},a=e=>{if(!!e)return Object.keys(e).reduce((t,n)=>{var r=e[n];return"string"==typeof r||(0,o.Z)(r)?t[n]=r:t[n]=JSON.stringify(e[n]),t},{})}},873329:function(e,t,n){n.d(t,{Z:()=>aC});var o,r,l,a,i,s=n("825955"),d=n("473980"),u=n("151064"),c=n("59955"),v=n("221478"),p=n("455069"),f=n("252237"),m=n.n(f),h=n("527116"),g=n("686436"),x=n("847167"),_=n("450562"),y=n("336205"),w=n("775699"),j=n("839974"),b=n("727914"),N=n("325599"),k=n("674343"),C=n("184449"),S=n("137810"),I=()=>{var e=(0,p.useRef)(null),[t,n]=(0,p.useState)(!1),o=(0,C.j1)(),r=(0,C.xs)();return(0,u.jsx)("div",{ref:e,children:(0,u.jsx)(k.u_,{icon:null,title:y.o.t("pop_up_title_data_conflict",{},"刷新重试"),okText:y.o.t("pop_up_button_refresh",{},"刷新"),width:320,visible:r.refreshModalVisible,hasCancel:!1,closable:!1,onOk:()=>{var e,t;n(!0),null===(e=r.refreshFunc)||void 0===e||e.call(r),o.updateConfig({savingError:!1}),null===(t=o.getProjectApi())||void 0===t||t.setWidgetUIState("normal"),r.setRefreshModalVisible(!1),n(!1)},className:S.Z["refresh-modal-content"],closeOnEsc:!1,confirmLoading:t,getPopupContainer:()=>(null==e?void 0:e.current)||document.body,children:y.o.t("pop_up_description_data_conflict",{},"很抱歉，你所编辑的内容已经被其他用户修改过了。请刷新页面获取最新内容后再进行操作。")})})},T=n("189914"),E=n("237452"),D=()=>(0,u.jsx)("div",{id:T.Bf,className:E.Z.workflowOuterSideSheetHolder}),Z=n("864431"),M=n("83195"),P=n("915757"),L=n("155440"),z=n("808549"),O=n("120454"),A=n("788637"),F=n("979838"),R=n("180380"),V=n("593554"),B=n("143263"),G=n("971183"),W=n("872993"),U=e=>{var t,{workflowList:n,onClose:o}=e;return(0,u.jsxs)("div",{className:W.Z.workflowReferencingListWrapper,children:[(0,u.jsx)(F.Z,{onClick:o,className:W.Z.close,"data-testid":(0,V.w)("referencing","close")}),(0,u.jsx)("div",{className:W.Z.workflowReferencingListTitle,children:y.o.t("workflow_detail_node_workflows_referencing",{number:null==n?void 0:n.length})}),(0,u.jsx)("div",{className:W.Z.workflowReferencingListDesc,children:y.o.t("workflow_detail_node_workflows_referencing_tip",{number:null==n?void 0:n.length})}),(0,u.jsx)(w.aV,{className:W.Z.workflowReferencingList,children:null==n?void 0:null===(t=n.slice(0,30))||void 0===t?void 0:t.map(e=>{var t,n;return(0,u.jsxs)(w.aV.Item,{className:W.Z.workflowReferencingListItem,"data-testid":(0,V.w)("referencing","subworkflow",null!==(t=e.workflow_id)&&void 0!==t?t:""),children:[(0,u.jsx)("img",{className:W.Z.icon,src:e.url,height:32}),(0,u.jsx)("div",{className:W.Z.name,children:e.name}),(0,u.jsx)(w.y3,{className:W.Z.btn,type:"secondary","data-testid":(0,V.w)("referencing","subworkflow",null!==(n=e.workflow_id)&&void 0!==n?n:"","viewdetail"),onClick:()=>{var t,n,o=(0,B.i)({space_id:null!==(t=e.space_id)&&void 0!==t?t:"",workflow_id:null!==(n=e.workflow_id)&&void 0!==n?n:""});window.open(o,"_blank")},children:y.o.t("binding_view_card")})]},e.workflow_id)})}),!!n&&n.length>=30&&(0,u.jsx)("div",{className:W.Z.footer,children:y.o.t("workflow_detail_node_workflows_max",{number:30})})]})},H=()=>{var e,[t,n]=(0,p.useState)(!1),{references:o}=(0,G.c)(),r=()=>n(!t),l=()=>n(!1);return(0,A.Z)(null==o?void 0:o.workflowList)?null:(0,u.jsx)(w.J2,{position:"bottomLeft",trigger:"custom",content:(0,u.jsx)(U,(0,O._)((0,z._)({},o),{onClose:()=>l()})),visible:t,onClickOutSide:()=>l(),children:(0,u.jsx)(k.Vp,{onClick:()=>r(),"data-testid":(0,V.w)("reference","tag"),suffixIcon:(0,u.jsx)(R.Z,{}),size:"mini",color:"primary",children:y.o.t("workflow_detail_node_workflows_referencing",{number:null==o?void 0:null===(e=o.workflowList)||void 0===e?void 0:e.length})})})},J=n("408487"),q=n("44172"),K=()=>{var{nodeErrors:e}=(0,C.zz)(),t=Object.keys(e).reduce((t,n)=>{var o=e[n].filter(e=>"node"===e.errorType),r=o.filter(e=>"error"===e.errorLevel),l=o.filter(e=>"warning"===e.errorLevel),a=r.length>0?r:l;return a.length>0?[...t,{nodeId:n,errorInfo:a.map(e=>e.errorInfo).join(";"),errorLevel:a[0].errorLevel,errorType:"node"}]:t},[]);return{nodeErrorList:t,hasNodeError:t.length>0}},X=()=>{var{nodeErrors:e}=(0,C.zz)(),t=Object.keys(e).reduce((t,n)=>[...t,...e[n].filter(e=>"line"===e.errorType)],[]);return{lineErrorList:t,hasLineError:t.length>0}},Y=e=>{var{withWarning:t=!0}=null!=e?e:{},{hasLineError:n}=X(),{nodeErrorList:o}=K(),r=o.length>0;!t&&(r=o.filter(e=>"warning"!==e.errorLevel).length>0);var{config:{systemError:l}}=(0,C.zz)();return n||r||!!l},Q=n("556305"),$=n("866769"),ee=n("88304"),et=n("594764"),en={backgroundColor:"var(--light-color-cyan-cyan-1,#c5f3f6)",color:"#0195ad"},eo=m()("flex items-center","h-5","w-fit","rounded-medium","px-2 py-[2px]","font-medium","text-[12px]"),er=e=>{var{hiddenStateText:t,extra:n,onClick:o}=e,{viewStatus:r}=(0,C.j1)(),l=(0,C.zz)(),{executeStatus:a,tokenAndCost:i={},workflowExeCost:s}=l.config,{hasNodeResult:d}=l,{isCanceled:c}=(0,ee.Q)(),v=Y({withWarning:!1}),p=r===_.tnn.EXECUTING||a===J.MZx.Running;if(!d&&!v&&!p)return n?(0,u.jsx)("span",{className:"flex items-center text-[14px] pl-8px pr-8px",onClick:o,children:n}):null;var f=a===J.MZx.Success&&!v,h=p?en:c?$.ms.Tertiary:f?$.ms.Success:$.ms.Danger,g=()=>{var e=(()=>{if(p)return t?s:"".concat(y.o.t("workflow_detail_title_testrun_running")," ").concat(s);if(c)return t?"0.000s":y.o.t("workflow_node_stoprun");if(!d)return t?"0.000s":y.o.t("worklfow_without_run");if(f)return t?s:"".concat(y.o.t("workflow_detail_title_testrun_finished")," ").concat(s);return y.o.t("workflow_running_results_run_failed")})();return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(()=>p?(0,u.jsx)(P.j2n,{className:"animate-spin mr-1  text-[#0195AD]"}):c?(0,u.jsx)(P.wR2,{}):f?(0,u.jsx)(q.w_1,{className:et.Z["success-icon"]}):(0,u.jsx)(q.i07,{}),{}),(0,u.jsx)("span",{className:"ml-2",children:e})]})};return d?(0,u.jsx)(Q.E,{tokenAndCost:i,children:(0,u.jsx)("div",{className:"w-full",onClick:o,children:(0,u.jsxs)("div",{className:eo,style:h,children:[(0,u.jsx)(g,{}),(0,u.jsx)("div",{className:m()("h-3 w-[1px]","mx-1"),style:{backgroundColor:h.color}}),(0,u.jsx)(()=>{var e;return(0,u.jsx)("div",{className:"cursor-pointer max-w-[200px] overflow-hidden text-ellipsis whitespace-nowrap",children:null!==(e=i.totalTokens)&&void 0!==e?e:"-"})},{}),n?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(k.iz,{layout:"vertical",margin:"4px"}),(0,u.jsx)("span",{className:"flex items-center text-[12px]",children:n})]}):null]})})}):(0,u.jsx)("div",{className:eo,style:h,onClick:o,children:(0,u.jsx)(g,{})})},el=()=>{var{info:e,config:t}=(0,C.j1)(),{vcsData:n}=e,{autoSaveTime:o}=t,{type:r}=n||{},{operator:l}=e.operationInfo||{};return(0,u.jsx)(k.Vp,{size:"mini",color:"primary",prefixIcon:r===J.MZY.Submit?(0,u.jsx)(P.Lz_,{className:"coz-fg-color-blue"}):r===J.MZY.Publish?(0,u.jsx)(P.Lz_,{className:"coz-fg-hglt-green"}):null,children:r===J.MZY.Draft?y.o.t("workflow_publish_multibranch_auto_saved",{time:o}):r===J.MZY.Submit?y.o.t("workflow_publish_multibranch_submitted",{name:(null==l?void 0:l.name)||"",time:o}):r===J.MZY.Publish?y.o.t("workflow_publish_multibranch_published",{name:(null==l?void 0:l.name)||"",time:o}):void 0})},ea=n("689951"),ei=n("614904"),es=()=>{var e=(0,C.j1)(),{info:t,flowMode:n}=e,[o,{setTrue:r,setFalse:l}]=(0,ea.Z)(!1),{getLatestWorkflowJson:a}=(0,C.zM)();return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(k.u,{content:y.o.t("Edit"),children:(0,u.jsx)(k.hU,{"data-testid":"workflow.detail.title.edit",icon:(0,u.jsx)(P.JAz,{}),color:"secondary",size:"mini",onClick:()=>r()})}),(0,u.jsx)(ei.dn,{mode:"update",flowMode:n,visible:o,workFlow:t,onCancel:l,getLatestWorkflowJson:a,onSuccess:()=>{l(),e.reload()}})]})},ed=n("931875"),{Text:eu}=k.ZT,ec=()=>{var{info:e,config:t,readonly:n,isCollaboratorMode:o,hasChanged:r,isViewHistory:l}=(0,C.j1)(),{autoSaveTime:a,savingError:i,preview:s}=t,d="0"!==e.plugin_id;return(0,u.jsxs)("div",{className:ed.Z["workflow-info"],children:[(0,u.jsxs)("div",{className:ed.Z["workflow-title"],children:[(0,u.jsx)(eu,{style:{maxWidth:300},strong:!0,ellipsis:{showTooltip:{opts:{content:(null==e?void 0:e.name)||"-",style:{wordBreak:"break-word"}}}},children:(null==e?void 0:e.name)||"-"}),(0,u.jsx)(k.u,{content:(null==e?void 0:e.desc)||"-",style:{wordBreak:"break-word",maxWidth:"300px"},children:(0,u.jsx)(k.hU,{icon:(0,u.jsx)(P.L03,{}),color:"secondary",size:"mini"})}),d&&!l?(0,u.jsx)(k.u,{content:y.o.t("workflow_detail_title_published"),children:(0,u.jsx)(k.hU,{icon:(0,u.jsx)(P.Lz_,{className:"coz-fg-hglt-green"}),color:"secondary",size:"mini"})}):null,!n&&(0,u.jsx)(es,{})]}),(0,u.jsxs)("div",{className:ed.Z["workflow-status"],children:[((0,L.Z)(e)||!s)&&o?(0,u.jsx)(el,{}):null,!n&&!o&&(0,u.jsx)(k.Vp,{size:"mini",color:"primary",children:y.o.t("workflow_detail_title_saved_2",{time:a})}),!n&&!!i&&(0,u.jsx)(k.Vp,{size:"mini",color:"red",children:y.o.t("workflow_detail_node_save_error")}),!(0,L.Z)(e)&&s?(0,u.jsx)(k.Vp,{size:"mini",color:"blue",children:y.o.t("workflow_detail_title_previewing")}):null,!n&&(0,u.jsx)(H,{}),r&&!n?(0,u.jsx)(k.Vp,{size:"mini",color:"primary",children:y.o.t("workflow_unpublish_change")}):null,(0,u.jsx)(er,{})]})]})},ev=n("567282"),ep=()=>{var{isCollaboratorMode:e,isExecuting:t,isVcsMode:n,config:o,info:r}=(0,C.j1)(),{vcsData:l}=r,{saving:a}=o,i=(0,p.useMemo)(()=>!!t||!!a||(e?(null==l?void 0:l.type)!==ev.MZ.Submit:!!n&&(null==l?void 0:l.type)===ev.MZ.Publish||!1),[t,a,n,e,l]);return{disabled:i,tooltip:(0,p.useMemo)(()=>e?y.o.t("workflow_publish_multibranch_publish_disabled_tooltip"):n&&(null==l?void 0:l.type)===ev.MZ.Publish?y.o.t("workflow_no_change_tooltip"):void 0,[l,e,n])}},ef=e=>{var{children:t,disabled:n}=e,o=(0,d._)(e,["children","disabled"]);return n?(0,u.jsx)(u.Fragment,{children:t}):(0,u.jsx)(k.u,(0,O._)((0,z._)({},o),{children:t}))},em=n("157728"),eh=n("537845"),eg=n("630553"),ex=n("851954"),e_=n.n(ex),ey=n("382534"),ew=e=>{var{disabled:t,className:n,setStep:o,onPublish:r}=e,{publishing:l}=(0,C.j1)();return(0,u.jsx)(k.zx,{disabled:t,className:n,loading:l,onClick:()=>{o("none"),r()},"data-testid":"workflow-base-publish-button",children:y.o.t("workflow_detail_title_publish")})},ej=n("519027");n("423043");var eb=n("206058"),eN=n("287487"),ek=n("921396");n("836999");var eC=n("391640"),eS=e=>{var t,{onSubmit:n,onCancel:o,forcePushVisible:r,onTestRun:l,onForcePublish:a,onForceCancel:i}=e,d=(0,p.useRef)(null),c=(0,p.useRef)(void 0),{info:v}=(0,C.j1)(),{workflow_version:f}=v,m=()=>{try{c.current&&ey.xd.SetDefaultTestCase(c.current)}catch(e){console.error("SetDefaultTestCase Error",e)}};var h=(t=(0,s._)(function*(e){if(!!d.current)try{yield d.current.validate();var t=d.current.getValues(),o={workflow_version:t.version,version_description:t.description};n(o),null==e||e(),m()}catch(e){}}),function(e){return t.apply(this,arguments)}),g=()=>{h(a)};return(0,u.jsxs)("div",{className:eC.Z["version-form-v2"],children:[r?(0,u.jsxs)("div",{className:eC.Z["force-push-tips"],children:[(0,u.jsx)("div",{className:eC.Z["force-push-tips-label"],children:y.o.t("workflow_publish_not_testrun_title",{},"发布前未试运行")}),(0,u.jsx)("div",{className:eC.Z["force-push-tips-content"],children:y.o.t("workflow_publish_not_testrun_content",{},"未进行试运行,建议确保工作流程正常运行后再发布")})]}):null,(0,u.jsxs)(k.l0,{getFormApi:e=>d.current=e,children:[(0,u.jsx)(k.l0.Input,{label:y.o.t("ocean_deploy_list_pkg_version"),required:!0,field:"version",initValue:f?"v".concat(e_().inc(f,"patch")):"v0.0.1","data-testid":"workflow-publish-version-name",rules:[{required:!0,message:y.o.t("mockset_field_is_required",{field:y.o.t("ocean_deploy_list_pkg_version")})},{validator:(e,t)=>!t||!!/^v\d+\.\d+\.\d+$/.test(t),message:y.o.t("workflow_version_number_error1")},{validator:(e,t)=>!(t&&e_().valid(t))||!f||e_().lt(f,t),message:y.o.t("workflow_version_number_error2")}]}),(0,u.jsx)(k.l0.TextArea,{autosize:{minRows:1,maxRows:10},label:y.o.t("card_builder_builder_publish_changelog_label"),placeholder:y.o.t("workflow_version_update_placeholder",{},"请描述本次版本更新内容"),field:"description","data-testid":"workflow-publish-version-description",rules:[{required:!0,message:y.o.t("mockset_field_is_required",{field:y.o.t("card_builder_builder_publish_changelog_label")})},{max:800,message:y.o.t("project_resource_sidebar_warning_length_exceeds")}]}),!1,r?(0,u.jsxs)("div",{className:"flex flex-row-reverse mt-12px",children:[(0,u.jsx)(k.zx,{color:"highlight",onClick:l,"data-testid":"workflow-testrun-button",children:y.o.t("workflow_detail_title_testrun")}),(0,u.jsx)(k.zx,{color:"primary",onClick:g,className:"mr-[8px]","data-testid":"workflow-force-publish-button",children:y.o.t("workflow_publish_not_testrun_ insist")}),(0,u.jsx)(k.zx,{color:"primary",onClick:i,className:"mr-[8px]","data-testid":"workflow-publish-cancel-button",children:y.o.t("workflow_list_create_modal_footer_cancel")})]}):(0,u.jsxs)("div",{className:"flex flex-row-reverse mt-12px",children:[(0,u.jsx)(k.zx,{onClick:()=>h(),"data-testid":"workflow-publish-button",children:y.o.t("workflow_detail_title_publish")}),(0,u.jsx)(k.zx,{color:"primary",onClick:o,className:"mr-[8px]","data-testid":"workflow-publish-cancel-button",children:y.o.t("workflow_list_create_modal_footer_cancel")})]})]})]})},eI=e=>{var t,{onPublish:n}=e,o=(0,d._)(e,["onPublish"]),{step:r,setStep:l}=o,[a,i]=(0,p.useState)(!1),{visible:c,tryPushCheck:v,onCancel:f,onTestRun:m}=(0,ej.o)();var h=(t=(0,s._)(function*(){if(l("force"),!!(yield v()))l("version"),i(!0)}),function(){return t.apply(this,arguments)});return(0,p.useEffect)(()=>{"version"!==r&&i(!1)},[r]),(0,u.jsx)(k.J2,{position:"bottomRight",trigger:"custom",onClickOutSide:()=>i(!1),visible:a||c,content:(0,u.jsx)(eS,{forcePushVisible:c,onSubmit:e=>{n(e)},onCancel:()=>i(!1),onTestRun:()=>{m(),i(!1)},onForcePublish:f,onForceCancel:()=>{f(),i(!1)}}),children:(0,u.jsx)("div",{children:(0,u.jsx)(ew,(0,z._)({onPublish:h},o))})})},eT=e=>{var t,{onPublish:n}=e,o=(0,d._)(e,["onPublish"]),{step:r,setStep:l}=o,{visible:a,tryPushCheck:i,onCancel:c,onTestRun:v}=(0,ej.o)();var f=(t=(0,s._)(function*(){if(l("force"),!!(yield i()))n()}),function(){return t.apply(this,arguments)});return(0,p.useEffect)(()=>{"none"===r&&c()},[r]),(0,u.jsx)(ej.m,{visible:a,title:y.o.t("workflow_publish_not_testrun_title"),description:y.o.t("workflow_publish_not_testrun_content"),mainButtonText:y.o.t("workflow_publish_not_testrun_ insist"),onCancel:c,onOpenTestRun:v,onForcePush:()=>{c(),n()},children:(0,u.jsx)("div",{children:(0,u.jsx)(ew,(0,z._)({onPublish:f},o))})})},eE=e=>{var t,{onSubmit:n}=e,o=(0,p.useRef)(null),{info:r}=(0,C.j1)(),{workflow_version:l}=r;var a=(t=(0,s._)(function*(){if(!!o.current)try{yield o.current.validate();var e=o.current.getValues(),t={workflow_version:e.version,version_description:e.description};n(t)}catch(e){}}),function(){return t.apply(this,arguments)});return(0,u.jsx)("div",{className:eC.Z["version-form"],children:(0,u.jsxs)(k.l0,{getFormApi:e=>o.current=e,children:[(0,u.jsx)(k.l0.Input,{label:y.o.t("ocean_deploy_list_pkg_version"),required:!0,field:"version",initValue:l?"v".concat(e_().inc(l,"patch")):"v0.0.1",rules:[{required:!0,message:y.o.t("mockset_field_is_required",{field:y.o.t("ocean_deploy_list_pkg_version")})},{validator:(e,t)=>!t||!!/^v\d+\.\d+\.\d+$/.test(t),message:y.o.t("workflow_version_number_error1")},{validator:(e,t)=>!(t&&e_().valid(t))||!l||e_().lt(l,t),message:y.o.t("workflow_version_number_error2")}]}),(0,u.jsx)(k.l0.TextArea,{label:y.o.t("card_builder_builder_publish_changelog_label"),field:"description",maxCount:800,rules:[{required:!0,message:y.o.t("mockset_field_is_required",{field:y.o.t("card_builder_builder_publish_changelog_label")})},{max:800,message:y.o.t("project_resource_sidebar_warning_length_exceeds")}]}),(0,u.jsx)(k.zx,{className:eC.Z.submit,onClick:a,children:y.o.t("workflow_detail_title_publish")})]})})},eD=e=>{var{onPublish:t}=e,n=(0,d._)(e,["onPublish"]),{step:o,setStep:r}=n,[l,a]=(0,p.useState)(!1);return(0,p.useEffect)(()=>{"version"!==o&&a(!1)},[o]),(0,u.jsx)(k.J2,{position:"bottomRight",trigger:"custom",onClickOutSide:()=>a(!1),visible:l,content:(0,u.jsx)(eE,{onSubmit:e=>{t(e)}}),children:(0,u.jsx)("div",{children:(0,u.jsx)(eT,(0,z._)({onPublish:()=>{r("version"),a(!0)}},n))})})},eZ=e=>{var t,{onPublish:n}=e,o=(0,d._)(e,["onPublish"]),{setStep:r}=o,{isCollaboratorMode:l,isInIDE:a}=(0,C.j1)(),{publishUpdateReferencedConfirm:i}=(0,eg.Bx)(),c=(0,p.useRef)({}),v=(0,eh.Z)((0,s._)(function*(){var e=yield n(c.current);return c.current={},e})),{diffConfirm:f,modal:m}=(0,eg._i)({submitHandle:v,operateType:ev.lc.PublishOperate});var h=(t=(0,s._)(function*(e){r("diff"),c.current=e||{},l?yield f():(yield i())&&(yield n(e)),c.current={}}),function(e){return t.apply(this,arguments)});return(0,u.jsxs)(u.Fragment,{children:[a?(0,u.jsx)(eD,(0,z._)({onPublish:h},o)):(0,u.jsx)(eI,(0,z._)({onPublish:h},o)),m]})},eM=n("160538"),eP=()=>{var e=(0,em.useNavigate)(),{workflowId:t,spaceId:n,isCollaboratorMode:o,info:r,isDevSpace:l}=(0,C.j1)(),{vcsData:a,plugin_id:i}=r,s=(0,p.useMemo)(()=>o&&(null==a?void 0:a.can_edit)&&l,[l,o,a]),d=(0,p.useMemo)(()=>!i||"0"===i,[i]);return{canPublishEnv:s,neverPublished:d,onPublishEnv:()=>{e("/space/".concat(n,"/workflow/").concat(t,"/publish?")+"commit_id=".concat(null==a?void 0:a.submit_commit_id,"&type=").concat(ev.lc.SubmitOperate),{replace:!0})}}},eL=e=>{var{disabled:t}=e,{canPublishEnv:n,neverPublished:o,onPublishEnv:r}=eP(),l=o||t;return n?(0,u.jsxs)(k.ES,{className:eM.Z["publish-env"],children:[(0,u.jsx)(eZ,(0,z._)({},e)),(0,u.jsx)(k.v2,{trigger:"click",render:(0,u.jsx)(k.v2.Menu,{mode:"menu",children:(0,u.jsx)(k.v2.Item,{disabled:l,onClick:r,children:(0,u.jsx)(ef,{disabled:!l,position:"left",content:y.o.t("bmv_please_release_the_official_version_before_releasing_it_"),children:y.o.t("bmv_pre_release_to_lane")})})}),children:(0,u.jsx)(k.hU,{icon:(0,u.jsx)(P.Wdl,{}),className:eM.Z["last-btn"],disabled:t,color:"hgltplus"})})]}):(0,u.jsx)(eZ,(0,z._)({},e))},ez=()=>{var e,t=(0,C.j1)(),{playgroundProps:n}=t,o=(0,C.HX)(),{disabled:r,tooltip:l}=ep(),[a,i]=(0,p.useState)("none");var d=(e=(0,s._)(function*(e){var r,l=yield o.publish(e);return l?(k.FN.success({content:y.o.t("workflow_detail_title_publish_toast"),duration:1.5}),null===(r=n.onPublish)||void 0===r||r.call(n,t),l):l}),function(t){return e.apply(this,arguments)});return t.readonly?null:(0,u.jsx)(ef,{content:l,disabled:!r||!l,children:(0,u.jsx)("div",{children:(0,u.jsx)(eL,{step:a,setStep:i,disabled:r,onPublish:d})})})},eO=n("960238"),eA=n("325723"),eF=p.memo(()=>{var e=(0,C.j1)(),{readonly:t,info:n,playgroundProps:o,workflowId:r}=e;return(0,u.jsxs)("div",{className:eA.Z.container,children:[(0,u.jsxs)("div",{className:eA.Z.left,"data-testid":(0,V.w)("info"),children:[(0,u.jsx)(k.hU,{icon:(0,u.jsx)(P.$1i,{}),color:"secondary","data-testid":(0,V.w)("back"),onClick:()=>{var t;null===(t=o.onBackClick)||void 0===t||t.call(o,e)}}),(0,u.jsx)(k.EZ,{src:n.url||"",type:"platform",alt:"Avatar"}),(0,u.jsx)(ec,{})]}),(0,u.jsxs)("div",{className:eA.Z.right,children:[null,null,(0,u.jsx)(ez,{}),(0,u.jsx)(eO.cw,{mode:t?"button":"icon"})]})]})}),eR=n("816697"),eV=n("994983"),eB=n("357143"),eG="workflow-toolbar-add-node",eW=()=>{var e=(0,g.Dc)();return(0,p.useCallback)(t=>e.config.getPosFromMouseEvent({clientX:t.left+(t.width-eB.ak)/2,clientY:t.top-5}),[e])},eU=e=>{var t=e.map(e=>e.getData(g.eG).bounds),{center:n}=eR.Ae.enlarge(t);return n},eH=()=>{var e=(0,g.G2)(eV.Re);return(0,p.useCallback)(t=>{e.focusNode(t)},[e])},eJ=()=>{var e,t=(0,g.G2)(g.L4),n=(0,g.G2)(eV.qq),o=(0,g.G2)(g.sS),r=eW(),l=eH();return(0,p.useCallback)((e=(0,s._)(function*(e,a){var i=r(e);yield o.call({panelPosition:i,containerNode:a,panelProps:{enableDrag:!0,enableModalMultiAdd:!0,fromAddNodeBtn:!0,anchorElement:"#".concat(eG)},canAddNode:e=>{var t=n.canDropToNode({dragNodeType:e.nodeType,dropNode:a});return!t.allowDrop&&k.FN.warning({content:t.message}),t.allowDrop},customPosition:e=>{var o,{nodeType:r}=e,l=a.collapsedChildren.length,i=eU(a.collapsedChildren),s=t.getNodeRegister(r),d=null==s?void 0:null===(o=s.meta)||void 0===o?void 0:o.size,u={x:i.x,y:d?i.y-d.height/2:i.y},c=n.adjustSubNodePosition(r,a,u);return{x:c.x+30*l,y:c.y+30*l}},afterAddNode:l,enableMultiAdd:!0})}),function(t,n){return e.apply(this,arguments)}),[n,l,r,o,t])},eq=()=>{var e,t=(0,g.G2)(g.L4),n=(0,g.G2)(g.sS),o=(0,g.Dc)(),r=eW(),l=eH();return(0,p.useCallback)((e=(0,s._)(function*(e){var a=r(e);yield n.call({panelPosition:a,panelProps:{enableDrag:!0,enableModalMultiAdd:!0,fromAddNodeBtn:!0,anchorElement:"#".concat(eG)},customPosition:e=>{var{selectPosition:n}=e,r=450/o.config.zoom,l=a.x+180+r,i=(0,g.n2)(t,{x:l,y:n.y});return{x:i.x,y:i.y}},enableSelectPosition:!0,enableMultiAdd:!0,afterAddNode:l})}),function(t){return e.apply(this,arguments)}),[r,n,o.config.zoom,t,l])},eK=e=>{for(var t=[e],n=e;n.parent;)t.unshift(n.parent),n=n.parent;return t},eX=e=>{var t=e.activatedNode;if(!t)return;if(t.getNodeMeta().isContainer)return t;var n=t.flowNodeType;if([_.nyy.Loop,_.nyy.Batch].includes(n)){var o,r=t.getNodeMeta(),l=null===(o=r.subCanvas)||void 0===o?void 0:o.call(r,t);if(!l)return;return l.canvasNode}var a=eK(t).map(e=>{var t,n=e.getNodeMeta();return null===(t=n.subCanvas)||void 0===t?void 0:t.call(n,e)}).filter(Boolean).find(e=>null==e?void 0:e.isCanvas);if(!!a)return a.canvasNode},eY=()=>{var e,t=(0,g.G2)(g.oJ),n=eJ(),o=eq();return(0,p.useCallback)((e=(0,s._)(function*(e){var r=eX(t);r?yield n(e,r):yield o(e)}),function(t){return e.apply(this,arguments)}),[t,n,o])},eQ="workflow-minimap-visible",e$=()=>{var e;return"true"===(null!==(e=localStorage.getItem(eQ))&&void 0!==e?e:"false")},e0=e=>{localStorage.setItem(eQ,e?"true":"false")},e1=()=>{var[e,t]=(0,p.useState)(e$());return{minimapVisible:e,setMinimapVisible:(0,p.useCallback)(e=>{t(e),e0(e)},[])}},e2=()=>{var e=(0,g.er)(),t=eY(),{minimapVisible:n,setMinimapVisible:o}=e1();return(0,O._)((0,z._)({},e),{addNode:t,minimapVisible:n,setMinimapVisible:o})},e4=n("786629"),e5=()=>{var e=(0,g.er)(),t=(0,g.G2)(e4.WorkflowLayoutShortcutsContribution);return(0,p.useCallback)((0,s._)(function*(){e.fitView(),yield t.autoLayout(),e.fitView()}),[e,t])},e6=n("338626"),e3=n("462694");n("336067");var e8=n("453928"),e9=e=>{var{width:t}=e,n=(0,d._)(e,["width"]);return(0,u.jsx)(k.EZ,(0,z._)({src:e8,style:{width:t,height:t}},n))},e7=n("180795"),te=e=>{var{url:t}=e;return t?(0,u.jsx)(k.EZ,{src:t,className:e7.Z["role-avatar"],size:"small"}):(0,u.jsx)(e9,{size:"small",className:e7.Z["role-avatar"]})},tt=n("581997"),tn=n("16192"),to=n("309163"),tr="workflow-toolbar-role-onboarding-hidden",tl=e=>{var{onOk:t}=e;return(0,u.jsxs)("div",{className:to.Z["popover-content"],children:[(0,u.jsx)("img",{src:tn}),(0,u.jsx)("br",{}),(0,u.jsx)(k.ZT.Text,{children:y.o.t("workflow_role_config_onboarding")}),(0,u.jsx)("div",{className:to.Z.btn,children:(0,u.jsx)(k.zx,{color:"highlight",onClick:t,children:y.o.t("upgrade_guide_got_it")})})]})},ta=e=>{var{visible:t,children:n}=e,o=(0,d._)(e,["visible","children"]),[r,l]=(0,p.useState)(!tt.D.getValue(tr));return t?(0,u.jsx)(k.u,(0,O._)((0,z._)({position:"top",visible:t&&r,showArrow:!0,trigger:"custom",spacing:16,content:(0,u.jsx)(tl,{onOk:()=>{l(!1),tt.D.setValue(tr,"true")}})},o),{children:n})):n},ti=n("535962"),ts=()=>{var e,t=(0,C.X6)(),n=(0,C.zr)(),{isInitWorkflow:o}=(0,C.j1)(),{isReady:r,loading:l,data:a}=(0,C.$)(e=>({isReady:e.isReady,loading:e.loading,data:e.data})),[i,s]=(0,p.useState)(!1),d=(0,p.useRef)(null),c=(0,p.useRef)(!1),v=(null==a?void 0:a.name)||y.o.t("team_column_role"),f=null==a?void 0:null===(e=a.avatar)||void 0===e?void 0:e.image_url,m=(0,eh.Z)(e=>{var{key:t}=e;t===T.Gd.RoleConfig&&c.current&&s(!0)});return(0,p.useEffect)(()=>{n.load()},[n]),(0,p.useEffect)(()=>{o&&r&&null===a&&(t.open(T.Gd.RoleConfig),c.current=!0)},[r,o,a,t]),(0,p.useEffect)(()=>{var e=t.onUnmount(m);return()=>e.dispose()},[t,m]),(0,u.jsx)("div",{ref:d,className:ti.Z["role-button"],children:(0,u.jsx)(ta,{visible:i,getPopupContainer:()=>d.current||document.body,children:(0,u.jsx)(k.zx,{color:"secondary",onClick:()=>{t.open(T.Gd.RoleConfig)},loading:l,children:(0,u.jsxs)("div",{className:ti.Z["role-info"],children:[(0,u.jsx)(te,{url:f}),(0,u.jsx)(k.ZT.Text,{style:{maxWidth:100},ellipsis:{showTooltip:!0},strong:!0,children:v})]})})})})},td=n("64605"),tu=n("156133"),tc=n("454221"),tv=e=>{var t,n,o=e||{},r={name:o.name,description:o.description,onboarding_info:{display_all_suggestions:null!==(t=e.display_all_suggestions)&&void 0!==t&&t},suggest_reply_info:{suggest_reply_mode:tc.O.Disable},audio_config:{},user_input_config:{default_input_mode:ev.gj.text}};if(Array.isArray(o.avatar)&&o.avatar.length){var l=o.avatar[0];r.avatar={image_uri:l.uid,image_url:l.url}}if(o.prologue&&(r.onboarding_info.prologue=o.prologue.replace(/[\r\n]+$/g,"")),o.questions&&(r.onboarding_info.suggested_questions=o.questions),o.suggest&&(0,td.Z)(o.suggest)&&(r.suggest_reply_info=o.suggest),o.background&&(0,td.Z)(o.background)&&(r.background_image_info=o.background),o.voices&&(0,td.Z)(o.voices)){o.voices.config&&(0,td.Z)(o.voices.config)&&(r.audio_config.voice_config_map=o.voices.config);r.audio_config.is_text_to_voice_enable=null!==(n=o.voices.textToVoice)&&void 0!==n&&n}return o.default&&(r.user_input_config.default_input_mode=o.default),r},tp=function(){var e,t,n,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r={name:o.name,description:o.description,voices:{},background:{},suggest_reply_info:{suggest_reply_mode:tc.O.System},display_all_suggestions:null!==(n=null===(e=o.onboarding_info)||void 0===e?void 0:e.display_all_suggestions)&&void 0!==n&&n};(null===(t=o.avatar)||void 0===t?void 0:t.image_url)&&(r.avatar=[{uid:o.avatar.image_uri,url:o.avatar.image_url}]),o.onboarding_info&&(o.onboarding_info.prologue&&(r.prologue=o.onboarding_info.prologue),o.onboarding_info.suggested_questions&&(r.questions=o.onboarding_info.suggested_questions)),o.suggest_reply_info&&(r.suggest=o.suggest_reply_info);var l=o.background_image_info;if(l&&(0,td.Z)(l)&&Object.keys(l).forEach(e=>{var t=l[e];r.background[e]=(0,O._)((0,z._)({},t),{origin_image_url:(null==t?void 0:t.image_url)||(null==t?void 0:t.origin_image_url)})}),o.audio_config){var a=o.audio_config;a.voice_config_map&&(r.voices.config=a.voice_config_map),(0,tu.Z)(a.is_text_to_voice_enable)&&(r.voices.textToVoice=a.is_text_to_voice_enable)}return o.user_input_config&&o.user_input_config.default_input_mode&&(r.default=o.user_input_config.default_input_mode),r},tf=e=>{var t=Object.keys(e).map(t=>({language:t,data:e[t]}));return t.length?t:[{}]},tm=e=>{var t,{value:n}=e,[o,r]=(0,p.useState)([]);var l=(t=(0,s._)(function*(e){var{data:t}=yield ey.lv.APIMGetVoice({voice_ids:e});r((null==t?void 0:t.voices)||[])}),function(e){return t.apply(this,arguments)});return(0,p.useEffect)(()=>{var e=tf(n||{}).map(e=>{var t;return null===(t=e.data)||void 0===t?void 0:t.voice_id}).filter(e=>!!e);e.length?l(e):r([])},[n]),(0,u.jsx)("div",{className:"flex flex-wrap gap-[4px] mb-[8px]",children:o.map(e=>(0,u.jsxs)(k.Vp,{size:"small",color:"primary",children:[e.voice_name,"(",e.language_name,")"]},e.voice_id))})},th=n("385663"),tg=n("584466"),tx=n("286518"),t_=n("724847"),ty=e=>{var{preview:t}=e,{isPlaying:n,togglePlayPause:o}=(0,t_.xm)(t);return(0,u.jsx)(k.hU,{disabled:!t,onClick:e=>{e.stopPropagation(),o()},icon:n?(0,u.jsx)(P.T0r,{}):(0,u.jsx)(P.JE7,{}),size:"small",color:"secondary"})},tw=n("974235"),tj=e=>{var t,n,o,{language:r,voiceType:l}=e,{space_id:a}=(0,em.useParams)(),[i]=(0,em.useSearchParams)(),d=null!==(n=null!=a?a:i.get("space_id"))&&void 0!==n?n:"";var{data:u,loading:c,loadMore:v,loadingMore:p}=(0,tw.Z)((t=(0,s._)(function*(e){if(!r)return{list:[],hasMore:!1};var t,n,o,a,i=yield ey.pr.GetVoiceListV2({page_size:20,language_code:r,voice_type:null!=l?l:tx.Rg.Preset,space_id:l===tx.Rg.Library?d:void 0,next_cursor:null==e?void 0:e.nextCursor});return{list:null!==(a=null===(t=i.data)||void 0===t?void 0:t.voice_list)&&void 0!==a?a:[],hasMore:null===(n=i.data)||void 0===n?void 0:n.has_more,nextCursor:null===(o=i.data)||void 0===o?void 0:o.next_cursor}}),function(e){return t.apply(this,arguments)}),{reloadDeps:[r,l],isNoMore:e=>!(null==e?void 0:e.hasMore)});return{options:null!==(o=null==u?void 0:u.list)&&void 0!==o?o:[],loading:c,loadMore:v,loadingMore:p}};function tb(e){var{onLoadMore:t}=e,n=(0,p.useRef)(null),[o]=(0,tg.Z)(n);return(0,p.useEffect)(()=>{if(!!o)null==t||t()},[o]),(0,u.jsx)("div",{ref:n,style:{height:1}})}var tN=[{label:y.o.t("workflow_select_voice_official"),value:tx.Rg.Preset},{label:y.o.t("workflow_select_voice_library"),value:tx.Rg.Library}],tk=e=>{var{value:t,language:n,onChange:o}=e,[r,l]=(0,p.useState)(tx.Rg.Preset),{loading:a,options:i,loadMore:s,loadingMore:d}=tj({language:n,voiceType:r}),c=i.find(e=>e.id===(null==t?void 0:t.voice_id));return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(k.Ph,{loading:a,value:null==t?void 0:t.voice_id,disabled:!n,className:"grow mr-[8px]",renderSelectedItem:()=>{var e;return null!==(e=null==c?void 0:c.name)&&void 0!==e?e:null==t?void 0:t.voice_name},onChange:e=>{var t=i.find(t=>t.id===e);t&&o({voice_id:e,voice_name:t.name})},dropdownClassName:"w-[308px] min-h-[152px] [&_.semi-select-loading-wrapper]:text-center",outerTopSlot:(0,u.jsx)(k.Ti,{size:"small",className:"mb-[2px]",value:r,options:tN,onChange:e=>l(e.target.value)}),innerBottomSlot:(0,u.jsx)(tb,{onLoadMore:()=>{!a&&!d&&s()}}),emptyContent:(0,u.jsxs)("div",{className:"h-[92px] flex flex-col justify-center   items-center gap-[4px]",children:[(0,u.jsx)(P.nL$,{className:"text-[32px] coz-fg-dim"}),(0,u.jsx)(k.ZT.Text,{fontSize:"14px",weight:500,children:y.o.t("voice_select_library_null")})]}),children:i.map(e=>(0,u.jsx)(k.Ph.Option,{className:"[&_.option-text-wrapper]:overflow-hidden",value:e.id,children:(0,u.jsxs)("div",{className:"h-[40px] w-full flex items-center gap-[8px] px-[8px] py-[6px]",children:[(0,u.jsx)(k.EZ,{type:"platform",size:"default",src:e.icon_url,className:"shrink-0"}),(0,u.jsxs)("div",{className:"grow flex flex-col items-start overflow-hidden",children:[(0,u.jsx)(k.ZT.Text,{fontSize:"14px",children:e.name}),e.create_user_info?(0,u.jsxs)("div",{className:"flex gap-[4px] items-center",children:[(0,u.jsx)(k.EZ,{size:"micro",src:e.create_user_info.icon_url}),(0,u.jsx)(k.ZT.Text,{fontSize:"12px",children:e.create_user_info.nick_name}),(0,u.jsxs)(k.ZT.Text,{fontSize:"12px",type:"secondary",children:["@",e.create_user_info.name]})]}):e.scene?(0,u.jsx)(k.Vp,{size:"mini",color:"grey",children:e.scene}):null]}),(0,u.jsx)("div",{className:"shrink-0",children:(0,u.jsx)(ty,{preview:e.preview_audio})})]})},e.id))}),(0,u.jsx)(ty,{preview:null==c?void 0:c.preview_audio},null==c?void 0:c.id)]})},tC=e=>{var{value:t,onChange:n,languageOptions:o,disabledLanguages:r=[]}=e,l=(0,p.useMemo)(()=>o.map(e=>({label:e.languageName,value:e.languageCode,disabled:r.includes(e.languageCode)})),[o,r]);return(0,u.jsx)(k.Ph,{placeholder:y.o.t("bot_edit_voices_modal_language"),optionList:l,value:t,onChange:n,className:"w-[140px] shrink-0"})},tS=e=>{var{value:t,languageOptions:n,disabledLanguages:o,onChange:r,onDelete:l}=e;return(0,u.jsxs)("div",{className:"flex items-center gap-[8px] px-[8px] py-[12px]",children:[(0,u.jsx)(tC,{value:t.language,languageOptions:n,disabledLanguages:o,onChange:e=>r({language:e})}),(0,u.jsx)(tk,{language:t.language,value:t.data,onChange:e=>r({language:t.language,data:e})}),(0,u.jsx)(k.hU,{color:"secondary",size:"small",icon:(0,u.jsx)(P.dVD,{}),onClick:l})]})},tI=n("735114"),tT=()=>{var[e,t]=(0,p.useState)([]),{loading:n}=(0,tI.Z)(()=>ey.pr.GetSupportLanguage(),{onSuccess:e=>{var n,o;return t(null!==(o=null===(n=e.language_list)||void 0===n?void 0:n.map(e=>{var t,n;return{languageCode:null!==(t=e.language_code)&&void 0!==t?t:"",languageName:null!==(n=e.language_name)&&void 0!==n?n:""}}))&&void 0!==o?o:[])},onError:()=>t([])});return{loading:n,options:e}},tE=e=>e.map(e=>e.language).filter(e=>!!e),tD=e=>{var{initialValue:t,languageOptions:n,onChange:o,onCancel:r}=e,[l,a]=(0,p.useState)(tf(t)),i=(e,t)=>{a(l.map((n,o)=>o===e?t:n))},s=e=>{a(l.filter((t,n)=>n!==e))},d=l.length<n.length;return(0,u.jsxs)("div",{className:"flex flex-col",children:[l.map((e,t)=>(0,u.jsx)(tS,{value:e,onChange:e=>i(t,e),onDelete:()=>s(t),languageOptions:n,disabledLanguages:tE(l)},t)),d?(0,u.jsx)("div",{className:"px-[8px] py-[12px]",children:(0,u.jsx)(k.zx,{color:"primary",className:"flex w-[140px]",icon:(0,u.jsx)(P.PwN,{}),onClick:()=>{a([...l,{}])},children:y.o.t("bot_edit_voices_modal_add_language")})}):null,(0,u.jsxs)("div",{className:"flex justify-end gap-[12px] mt-[24px]",children:[(0,u.jsx)(k.zx,{onClick:r,color:"primary",children:y.o.t("cancel")}),(0,u.jsx)(k.zx,{onClick:()=>{o(l.reduce((e,t)=>(t.data&&t.language&&(e[t.language]=t.data),e),{}))},children:y.o.t("background_confirm")})]})]})},tZ=(0,th.Pi)(()=>{var[e,t]=(0,p.useState)(!1),n=(0,th.U$)(),{value:o,disabled:r}=n,l=(null==o?void 0:o.config)||{},a=Object.values(l).length>0,{options:i}=tT();return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(k.hU,{color:"secondary",size:"small",disabled:r,icon:a?(0,u.jsx)(P.JAz,{}):(0,u.jsx)(P.PwN,{}),onClick:()=>t(!0)}),(0,u.jsxs)(k.u_,{visible:e,title:y.o.t("bot_edit_voices_modal_title"),onCancel:()=>t(!1),footer:null,className:"[&_.semi-modal-footer]:hidden",children:[(0,u.jsx)(k.ZT.Text,{fontSize:"14px",className:"mb-[16px]",children:y.o.t("bot_edit_voices_modal_description",{platform:"豆包"})}),(0,u.jsx)(tD,{initialValue:l,languageOptions:i,onCancel:()=>t(!1),onChange:e=>{n.setValue((0,O._)((0,z._)({},o),{config:e})),t(!1)}})]})]})}),tM=e=>{var{value:t,disabled:n,onChange:o}=e;return(0,u.jsxs)("div",{className:"flex items-center justify-between mb-[8px]",children:[(0,u.jsx)("div",{className:"flex items-center gap-[4px]",children:(0,u.jsx)(k.ZT.Text,{size:"small",children:y.o.t("workflow_role_config_text_2_voice")})}),(0,u.jsx)(k.rs,{size:"mini",checked:t,disabled:n,onChange:o})]})},tP=n("87377"),tL=e=>{var t,{value:n,disabled:o,onChange:r}=e,l=null!==(t=null==n?void 0:n.suggest_reply_mode)&&void 0!==t?t:tc.O.Disable,a=null==n?void 0:n.customized_suggest_prompt,i=(0,p.useMemo)(()=>l===tc.O.Custom?y.o.t("bot_edit_auto_suggestion_customize_description"):l===tc.O.System?y.o.t("bot_edit_auto_suggestion_default_description"):y.o.t("bot_edit_auto_suggestion_off_description"),[l]),s=l!==tc.O.Disable,d=l===tc.O.Custom;return(0,u.jsxs)("div",{children:[(0,u.jsx)(k.ZT.Text,{size:"small",type:"secondary",children:i}),s?(0,u.jsxs)("div",{className:tP.Z["custom-block"],children:[(0,u.jsx)(k.XZ,{checked:d,disabled:o,onChange:e=>{r({suggest_reply_mode:e.target.checked?tc.O.Custom:tc.O.System})},children:(0,u.jsx)(k.ZT.Text,{size:"small",style:{lineHeight:"20px"},strong:!0,children:y.o.t("bot_edit_auto_suggestion_customize_user_checkbox")})}),d?(0,u.jsx)(k.Kx,{disabled:o,placeholder:y.o.t("bot_edit_auto_suggestion_customize_modal_prompt_placeholder"),value:a,onChange:e=>{r({suggest_reply_mode:tc.O.Custom,customized_suggest_prompt:e})}}):null]}):null]})},tz=(0,th.Pi)(()=>{var e=(0,th.U$)(),{value:t,disabled:n}=e,o=null==t?void 0:t.suggest_reply_mode;return(0,u.jsx)(k.rs,{size:"mini",checked:o===tc.O.System||o===tc.O.Custom,disabled:n,onChange:t=>{var n=t?tc.O.System:tc.O.Disable;e.setValue({suggest_reply_mode:n})}})}),tO=n("66483"),tA=n("795642"),tF=e=>{var{value:t,dragRef:n,isLast:o,disabled:r,onChange:l,onDelete:a}=e,i=!(o&&!t)&&!r,s=!(o&&!t)&&!r;return(0,u.jsxs)("div",{className:tA.Z["suggestion-list"],children:[(0,u.jsx)("div",{className:m()(tA.Z["drag-btn"],{[tA.Z.disabled]:!i}),ref:i?n:null,children:(0,u.jsx)(P.TF9,{})}),(0,u.jsx)(k.Kx,{value:t,className:tA.Z["text-area"],autosize:!0,rows:1,onChange:l,disabled:r,placeholder:y.o.t("opening_question_placeholder")}),(0,u.jsx)("div",{className:tA.Z["delete-btn"],children:(0,u.jsx)(k.hU,{color:"secondary",size:"small",disabled:!s,icon:(0,u.jsx)(P.ruq,{}),onClick:a})})]})},tR=e=>{var{value:t,disabled:n,onChange:o}=e,r=(0,p.useMemo)(()=>n?t||[]:!t||t.length<100&&t.every(Boolean)?(t||[]).concat(""):t||[],[t,n]),l=e=>{o(e.filter(e=>!!e))},a=e=>{l(r.filter((t,n)=>n!==e))},i=(e,t)=>{var n=[...r];n.splice(e,1,t),l(n)};return r.length?(0,u.jsx)(tO.c,{value:r,onChange:l,renderItem:(e,t,o)=>(0,u.jsx)(tF,{dragRef:null==o?void 0:o.dragRef,value:r[t],isLast:t===r.length-1,disabled:n,onChange:e=>i(t,e),onDelete:()=>a(t)})}):(0,u.jsx)(k.ZT.Text,{size:"small",children:y.o.t("bot_element_unset")})},tV=n("782347"),tB=n("58808"),tG=n("8118"),tW=(0,th.Pi)(()=>{var e,t=(0,th.cI)(),n=null!==(e=t.getValuesIn("display_all_suggestions"))&&void 0!==e&&e,{disabled:o}=t;return(0,u.jsxs)("div",{className:tG.Z["display-all"],children:[(0,u.jsx)(k.J2,{content:(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{className:"coz-fg-plus text-base font-medium",children:y.o.t("opening_showall")}),(0,u.jsx)("div",{className:"coz-fg-secondary text-xs pb-3",children:y.o.t("opening_showall_explain")}),(0,u.jsx)("div",{className:"coz-fg-secondary text-xs pb-[6px]",children:y.o.t("opening_showall_explain_demo_on")}),(0,u.jsx)("img",{height:"112px",width:"288px",src:tV}),(0,u.jsx)("div",{className:"coz-fg-secondary text-xs pb-[6px]",children:y.o.t("opening_showall_explain_demo_off")}),(0,u.jsx)("img",{height:"112px",width:"288px",src:tB})]}),children:(0,u.jsx)(P.L03,{})}),(0,u.jsx)(k.ZT.Text,{size:"small",children:y.o.t("opening_showall")}),(0,u.jsx)(k.rs,{size:"mini",checked:n,onChange:e=>{t.setValuesIn("display_all_suggestions",e)},disabled:o})]})}),tU=n("496465"),tH="开场白:",tJ="建议问题:",tq=e=>{var t=e.split("\n\n"),n="",o=[];for(var r of t)r.startsWith(tH)?n=r.replace("".concat(tH,"\n"),"").trim():r.startsWith(tJ)&&(o=r.replace("".concat(tJ,"\n"),"").trim().split("\n").map(e=>e.trim()));return{prologue:n,questions:o}};(0,th.Pi)(()=>{var e,t=(0,th.cI)(),[n,o]=(0,p.useState)(!1),{spaceId:r,workflowId:l}=(0,C.j1)();var a=(e=(0,s._)(function*(){var e=t.getValuesIn("name");try{o(!0);var{data:n}=yield _.OHc.CopilotGenerate({space_id:r,project_id:"",copilot_type:tU.BS.OnboardingMessage,query:e,workflow_id:l}),{prologue:a,questions:i}=tq((null==n?void 0:n.content)||"");a&&t.setValuesIn("prologue",a),Array.isArray(i)&&i.length&&t.setValuesIn("questions",i)}finally{o(!1)}}),function(){return e.apply(this,arguments)});return(0,u.jsx)(k.mw,{size:"small",color:"aihglt",onlyIcon:!0,loading:n,disabled:t.disabled,onClick:a})});var tK=e=>{var{value:t,onChange:n,onBlur:o}=e,r=(0,d._)(e,["value","onChange","onBlur"]),[l,a]=(0,p.useState)(t),{info:i}=(0,C.j1)();return(0,p.useEffect)(()=>{t!==l&&a(t)},[t]),(0,u.jsx)(th.II,(0,z._)({value:l,placeholder:null==i?void 0:i.name,onChange:e=>{a(e)},onBlur:()=>{var e=l;!e&&t&&(e=t),n(e),a(e),o()}},r))},tX=n("3320"),tY=n("614973"),tQ=[{label:y.o.t("agent_ide_default_input_option_text"),value:ev.gj.text},{label:y.o.t("agent_ide_default_input_option_voice"),value:ev.gj.audio}],t$=e=>{var{value:t,disabled:n,onChange:o}=e,r=null!=t?t:ev.gj.text;return(0,u.jsxs)("div",{className:tY.Z["default-input"],children:[(0,u.jsxs)("div",{className:tY.Z["input-label"],children:[(0,u.jsx)(k.ZT.Text,{size:"small",children:y.o.t("agent_ide_default_input_option")}),(0,u.jsx)(k.u,{className:tY.Z["tooltip-wrap"],theme:"dark",content:(0,u.jsxs)("div",{className:tY.Z["input-tooltip"],children:[(0,u.jsx)("img",{src:tX}),(0,u.jsx)(k.ZT.Text,{className:"coz-fg-hglt-plus",children:y.o.t("workflow_role_config_default_input_tooltip")})]}),children:(0,u.jsx)(P.L03,{className:tY.Z["tooltip-icon"]})})]}),(0,u.jsx)(k.Ph,{value:r,optionList:tQ,size:"small",disabled:n,style:{width:130},onChange:e=>{o(e)}})]})},t0=n("492570"),t1=n("997516"),t2=n("478641"),t4=n("552995"),t5=e=>new Promise((t,n)=>{var o=new FileReader;o.onload=e=>{var o,r=null===(o=e.target)||void 0===o?void 0:o.result;if(!r||"string"!=typeof r){n(new b.sH("checkImageWidthAndHeight","file read invalid"));return}var l=new Image;l.src=r,l.onload=function(){l.height<640?(k.FN.error(y.o.t("bgi_upload_image_format_requirement")),t(!1)):l.complete&&t(!0)}},o.onerror=()=>{n(new b.sH("checkImageWidthAndHeight","file read fail"))},o.onabort=()=>{n(new b.sH("checkImageWidthAndHeight","file read abort"))},o.readAsDataURL(e)}),t6=e=>{var t,n,o,r;return e?{url:null!==(o=null==e?void 0:null===(t=e.web_background_image)||void 0===t?void 0:t.origin_image_url)&&void 0!==o?o:"",uri:null!==(r=null==e?void 0:null===(n=e.web_background_image)||void 0===n?void 0:n.origin_image_uri)&&void 0!==r?r:""}:{}},t3=e=>t4.DE[e],t8=(e,t)=>{var n,o=null==t?void 0:null===(n=t.current)||void 0===n?void 0:n.cropper;if(!o)return{left:0,right:0};var{size:r}=t3(e),l=r.width,a=null==o?void 0:o.getCanvasData(),i=null==o?void 0:o.getImageData(),s=i.left+(null==a?void 0:a.left),d=l-i.width-s;return{left:(0,t0.Z)(s/l,2),right:(0,t0.Z)(d/l,2)}},t9=e=>{var t;return(0,t1.Z)(null===(t=e.current)||void 0===t?void 0:t.cropper.getCanvasData(),["left","top","width","height"])};function t7(e){return new Promise((t,n)=>{var o=new t2.Z,r=new Image;r.src=e,r.onload=()=>{var e=o.getColor(r);if(e){var[l,a,i]=e;t("rgba(".concat(l,", ").concat(a,", ").concat(i,")"))}else n(new b.sH("getImageThemeColor","not get theme color"))}})}var ne=e=>new Promise((t,n)=>{var o=[];e.forEach(e=>{o.push(new Promise((t,n)=>{var o,r,l=null===(o=e.current)||void 0===o?void 0:o.cropper,a=null==l?void 0:null===(r=l.getCroppedCanvas())||void 0===r?void 0:r.toDataURL("image/webp",.7);a?t7(a).then(e=>{t(e)}):n(new b.sH("computeThemeColor","cropper not exist"))}))}),Promise.all(o).then(e=>t(e)).catch(e=>n(e))}),nt=n("297158"),nn=n("298203"),no=e=>{var t,{onUploadError:n,onUploadSuccess:o}=e,r=()=>{n(),w.FN.error({content:y.o.t("Upload_failed"),showClose:!1})};return{upload:(t=(0,s._)(function*(e){var t,l;try{t=yield(0,nn.fr)({biz:"workflow",fileType:"image",file:e})}catch(e){r();return}if(!t){r();return}try{if(!(l=(yield _.OHc.SignImageURL({uri:t,Scene:"AUDIT"})).url)){r();return}}catch(e){n();return}o({uri:t,url:l})}),function(e){return t.apply(this,arguments)})}},nr=e=>{var t,{cropperWebRef:n,cropperMobileRef:o,setLoading:r,onSuccess:l,currentOriginImage:a,handleCancel:i}=e,d=e=>{var{mode:t,originImageInfo:r,themeColorList:l}=e,a="pc"===t?n:o;return(0,O._)((0,z._)({},r),{theme_color:"pc"===t?l[0]:l[1],gradient_position:t8(t,a),canvas_position:t9(a)})};var u=(t=(0,s._)(function*(e){r(!1);var t=yield ne([n,o]);if(!!(null==a?void 0:a.url)){var s={themeColorList:t,originImageInfo:{origin_image_uri:(null==e?void 0:e.uri)||a.uri,origin_image_url:(null==e?void 0:e.url)||a.url}};l({web_background_image:d((0,z._)({mode:"pc"},s)),mobile_background_image:d((0,z._)({mode:"mobile"},s))}),i()}}),function(e){return t.apply(this,arguments)}),{upload:c}=no({onUploadSuccess:u,onUploadError:()=>{r(!1)}});return{handleSubmit:()=>{r(!0);try{(null==a?void 0:a.fileInstance)&&(null==a?void 0:a.fileInstance)instanceof File?c(a.fileInstance):u()}catch(e){e instanceof Error&&nt.kg.error({error:e})}}}},nl=e=>{var t;return!!(null===(t=e.dataTransfer)||void 0===t?void 0:t.types.includes("Files"))},na=()=>{var e=(0,p.useRef)(null),[t,n]=(0,p.useState)(!1),o=()=>{if(!!e.current)clearTimeout(e.current),e.current=null};return{isDragIn:t,setIsDragIn:n,onDragEnter:e=>{if(o(),!!nl(e))n(!0)},onDragEnd:()=>{o(),e.current=setTimeout(()=>{n(!1)},100)},onDragOver:e=>{if(e.preventDefault(),o(),!!nl(e))n(!0)}}},ni=n("290114"),ns=e=>{var{onReUpload:t,onSubmit:n,onCancel:o}=e;return(0,u.jsxs)("div",{className:ni.Z["modal-footer"],children:[(0,u.jsxs)("div",{className:ni.Z["modal-left"],children:[(0,u.jsx)(k.zx,{color:"primary",onClick:t,children:y.o.t("bgi_reupload")}),(0,u.jsx)(k.ZT.Text,{type:"secondary",size:"small",children:y.o.t("bgi_adjust_tooltip_content")})]}),(0,u.jsxs)("div",{className:ni.Z["modal-right"],children:[(0,u.jsx)(k.zx,{color:"highlight",onClick:o,children:y.o.t("Cancel")}),(0,u.jsx)(k.zx,{onClick:n,children:y.o.t("Confirm")})]})]})},nd=n("684073"),nu=n("250290"),nc=e=>{var{onUpload:t}=e;return(0,u.jsxs)("div",{className:nu.Z["base-upload-content"],children:[(0,u.jsx)(P.Isu,{className:nu.Z["upload-icon"]}),(0,u.jsxs)("div",{className:nu.Z["upload-title"],children:[y.o.t("upload_image_guide"),(0,u.jsx)(k.u,{content:(0,u.jsxs)("div",{className:nu.Z["upload-tooltip"],children:[(0,u.jsx)(k.ZT.Text,{children:y.o.t("bgi_upload_image_format_requirement_title")}),(0,u.jsx)("br",{}),(0,u.jsx)(k.ZT.Text,{size:"small",type:"secondary",children:y.o.t("bgi_upload_image_format_requirement")}),(0,u.jsx)("br",{}),(0,u.jsx)("img",{src:nd})]}),children:(0,u.jsx)(P.L03,{className:nu.Z["tooltip-icon"]})})]}),(0,u.jsx)(k.ZT.Text,{size:"small",type:"secondary",className:nu.Z["upload-desc"],children:y.o.t("upload_image_format_requirement")}),(0,u.jsx)(k.zx,{onClick:t,color:"primary",children:y.o.t("upload_image")})]})},nv=()=>(0,u.jsx)("div",{className:nu.Z["full-upload-content"],children:(0,u.jsx)(nc,{})}),np=e=>{var{onUpload:t}=e,[n,o]=(0,p.useState)(!1);return(0,u.jsx)("div",{className:m()(nu.Z["normal-upload-content"],{[nu.Z.dragging]:n}),onClick:e=>e.stopPropagation(),onDragEnter:()=>{o(!0)},onDragLeave:()=>{o(!1)},children:(0,u.jsx)(nc,{onUpload:t})})},nf=n("668096"),nm=n("311807"),nh=n("442595"),ng=e=>{var t,n,o,r,{cropperRef:l,url:a,mode:i,setLoading:d,backgroundInfo:u}=e,[c,v]=(0,p.useState)({left:0,right:0}),[f,m]=(0,p.useState)(null!==(r=null==u?void 0:u.theme_color)&&void 0!==r?r:"#fff"),h=(0,p.useRef)(a),{size:g,centerWidth:x}=t4.DE[i];(0,p.useEffect)(()=>{h.current=a,!a&&m("#fff"),_()},[a]);var _=()=>{v(t8(i,l))},y=e=>{var t,n,o,r,a=null==l?void 0:null===(t=l.current)||void 0===t?void 0:t.cropper;if(!!a){var i=null==a?void 0:a.getCanvasData(),s=null==a?void 0:a.getImageData(),d=s.height+i.top-g.height,u=(0,nh.Z)(s.left+(null==i?void 0:i.left),2);e<0&&(null===(n=l.current)||void 0===n||n.cropper.setCanvasData({top:0})),d<0&&(null===(o=l.current)||void 0===o||o.cropper.setCanvasData({top:g.height-s.height}));var c=(0,t0.Z)((g.width-x)/2+.4*x,2),v=(0,t0.Z)(g.width-s.width-c,2);(u>c||u<v)&&(null===(r=l.current)||void 0===r||r.cropper.setCanvasData({left:u>c?c:v}))}};var w=(t=(0,s._)(function*(){yield j(),_()}),function(){return t.apply(this,arguments)});var j=(n=(0,s._)(function*(){var e,t,n=null===(e=l.current)||void 0===e?void 0:e.cropper;null==n||n.disable();var o=null==n?void 0:null===(t=n.getCroppedCanvas())||void 0===t?void 0:t.toDataURL("image/webp",.7);o&&(m((yield t7(o))),null==n||n.enable())}),function(){return n.apply(this,arguments)});return{gradientPosition:c,handleReady:(o=(0,s._)(function*(){var e,t=null===(e=l.current)||void 0===e?void 0:e.cropper;(null==u?void 0:u.canvas_position)&&h.current===u.origin_image_url&&(null==t||t.setCanvasData(null==u?void 0:u.canvas_position)),yield j(),d(!1)}),function(){return o.apply(this,arguments)}),handleThemeColor:j,handleCrop:e=>{_(),y(e.detail.y)},cropEnd:w,onZoom:()=>{var e,t,n,o,r,{width:a=0,height:i=0,naturalWidth:s=0,naturalHeight:d=0}=null!==(n=null===(t=l.current)||void 0===t?void 0:null===(e=t.cropper)||void 0===e?void 0:e.getCanvasData())&&void 0!==n?n:{};s>d?i>=2*g.height&&(null===(o=l.current)||void 0===o||o.cropper.setCanvasData({height:2*g.width})):a>2*g.width&&(null===(r=l.current)||void 0===r||r.cropper.setCanvasData({width:2*g.width}))},themeColor:f,size:g}},nx=n("382174"),n_=n("309888"),ny={pc:[{width:300,height:45},{width:300,height:34},{width:73,height:24}],mobile:[{width:186,height:63},{width:185,height:28},{width:60,height:20}]},nw=e=>{var{bg:t,width:n,height:o,rounded:r,className:l}=e;return(0,u.jsx)("div",{className:"rounded-".concat(r," ").concat(l),style:{background:t,width:n,height:o,backdropFilter:"blur(6px)"}})},nj=e=>{var{bg:t,size:n}=e;return(0,u.jsx)("div",{className:"bg-[".concat(t,"] rounded-full"),style:{background:t,width:n,height:n}})},nb=e=>{var{mode:t,loading:n=!1,hasUrl:o=!1}=e;return(0,p.useMemo)(()=>(0,u.jsxs)("div",{className:"w-full h-full p-2 absolute z-[200] pointer-events-none ",children:[(0,u.jsxs)("div",{className:"flex gap-2 mb-6",children:[(0,u.jsx)(k.Vp,{color:"primary",prefixIcon:null,className:"!text-white !bg-[rgba(0,0,0,0.28)]",children:"pc"===t?y.o.t("display_on_widescreen"):y.o.t("display_on_vertical_screen")}),n?(0,u.jsx)(k.Vp,{color:"primary",prefixIcon:(0,u.jsx)(nx.Z,{spin:!0}),className:"!text-white !bg-[rgba(0,0,0,0.28)]",children:y.o.t("knowledge_insert_img_009")}):null]}),(0,u.jsx)("div",{className:"flex justify-center",children:(0,u.jsx)("div",{className:"pc"===t?"w-[326px]":"w-[205px]",children:ny[t].map((e,r)=>{var l=n||!o,a=l?1===r?"#4E40E5":"#F4F4F6":1===r?"rgba(6, 7, 9, 0.24)":"rgba(255, 255, 255, 0.60)";return(0,u.jsxs)("div",{className:"flex gap-1 mb-2",children:[(0,u.jsx)(nj,{size:"pc"===t?18:16,bg:a}),(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{className:m()(n_.Z.text,{[n_.Z.shadow]:!l,"coz-fg-dim":l,"text-white":!l}),children:1===r?"Glory":"Coze"}),(0,u.jsx)(nw,{width:e.width,height:e.height,bg:a,rounded:"lg",className:m()({[n_.Z["background-border"]]:!l,[n_.Z.default]:l})})]})]},r)})})})]}),[t,n,o])},nN=n("864104");n("84094");var nk=e=>{var{url:t="",mode:n="pc",cropperRef:o,loading:r,setLoading:l,backgroundInfo:a}=e,{handleCrop:i,handleReady:s,themeColor:d,gradientPosition:c,size:v,onZoom:p,cropEnd:f}=ng({url:t,mode:n,cropperRef:o,setLoading:l,backgroundInfo:a}),h={image_url:t,gradient_position:c,theme_color:d},g=(0,nm.Z)(p,100);return(0,u.jsxs)("div",{className:"".concat(m()(nN.Z["cropper-container"])," outline outline-1 outline-[#0607091A] hover:outline-[#4E40E5]"),style:{background:d,height:v.height,width:v.width},children:[(0,u.jsx)(nb,{mode:n,loading:r,hasUrl:!!t}),(0,u.jsx)(t4.Uh,{backgroundInfo:{web_background_image:"pc"===n?h:{},mobile_background_image:"mobile"===n?h:{}},preview:!0},n),t?(0,u.jsx)(nf.Z,{ready:s,initialAspectRatio:v.width/v.height,src:t,style:{height:v.height,width:v.width},background:!1,guides:!1,zoom:g,ref:o,dragMode:"move",viewMode:0,modal:!1,center:!1,cropBoxMovable:!1,cropBoxResizable:!1,highlight:!1,autoCropArea:1,minCanvasHeight:v.height,minCropBoxHeight:v.height,minCropBoxWidth:v.width,minContainerWidth:v.width,crop:i,cropend:f,checkCrossOrigin:!1,checkOrientation:!1,crossOrigin:"anonymous"}):null]})},nC=n("558105"),nS=e=>{var t,{visible:n,value:o,onChange:r,onCancel:l}=e,[a,i]=(0,p.useState)(!1),{onDragEnter:d,onDragEnd:c,isDragIn:v,onDragOver:f}=na(),[m,h]=(0,p.useState)(t6(o)),g=(0,p.useRef)(null),x=(0,p.createRef)(),_=(0,p.createRef)(),w=!m.url;var j=(t=(0,s._)(function*(e){i(!0);var{onSuccess:t,onError:n,file:o}=e;if("string"!=typeof o)try{var{fileInstance:r}=o;r?(yield t5(r))?(t(o),h(o)):i(!1):n({status:0})}finally{i(!1)}}),function(e){return t.apply(this,arguments)}),b=()=>{[x,_].forEach(e=>{var t,n;null===(n=e.current)||void 0===n||null===(t=n.cropper)||void 0===t||t.destroy()})},{handleSubmit:N}=nr({onSuccess:r,handleCancel:()=>{l(),b()},cropperWebRef:x,cropperMobileRef:_,currentOriginImage:null!=m?m:{},setLoading:i,onAuditCheck:()=>{k.FN.error({content:y.o.t("audit_unsuccess_general_type",{link:(0,u.jsx)("a",{rel:"noreferrer noopener",href:"/docs/guides/content_principles",target:"_blank",children:y.o.t("audit_unsuccess_general_type_url")})})})}});return(0,u.jsxs)(k.u_,{visible:n,width:800,title:y.o.t("bgi_title"),centered:!0,maskClosable:!1,onCancel:l,children:[(0,u.jsx)(k.gq,{ref:g,action:"",limit:1,draggable:!0,customRequest:j,accept:".jpeg,.jpg,.png,.webp,.gif",showReplace:!1,showUploadList:!1,maxSize:10240,onSizeError:()=>{k.FN.error({content:y.o.t("upload_image_size_limit",{max_size:"10M"}),showClose:!1})},children:w?(0,u.jsx)(np,{onUpload:()=>{var e;null==g||null===(e=g.current)||void 0===e||e.openFileDialog()}}):(0,u.jsxs)("div",{className:nC.Z.preview,onClick:e=>{e.stopPropagation()},onDragEnter:d,onDragOver:f,onDragLeave:c,children:[(0,u.jsx)(nk,{cropperRef:x,mode:"pc",url:m.url,backgroundInfo:null==o?void 0:o.web_background_image,loading:a,setLoading:i}),(0,u.jsx)(nk,{cropperRef:_,mode:"mobile",url:m.url,backgroundInfo:null==o?void 0:o.mobile_background_image,loading:a,setLoading:i}),v?(0,u.jsx)(nv,{}):null]})}),!w&&(0,u.jsx)(ns,{onReUpload:()=>{var e;null==g||null===(e=g.current)||void 0===e||e.openFileDialog()},onCancel:()=>h({}),onSubmit:N})]})},nI=n("371451"),nT=e=>{var t,{value:n,disabled:o,onChange:r}=e,[l,a]=(0,p.useState)(!1),i=null==n?void 0:null===(t=n.web_background_image)||void 0===t?void 0:t.origin_image_url;return(0,u.jsxs)("div",{children:[(0,u.jsx)(k.ZT.Text,{size:"small",type:"secondary",children:y.o.t("bgi_desc")}),i?(0,u.jsxs)("div",{className:nI.Z["bg-block"],children:[(0,u.jsx)(k.EZ,{src:i,type:"platform"}),(0,u.jsxs)("div",{className:nI.Z["op-btns"],children:[(0,u.jsx)(k.hU,{icon:(0,u.jsx)(P.JAz,{}),color:"secondary",size:"small",disabled:o,onClick:()=>a(!0)}),(0,u.jsx)(k.hU,{icon:(0,u.jsx)(P.dVD,{}),color:"secondary",size:"small",disabled:o,onClick:()=>r({})})]}),(0,u.jsx)(nS,{visible:l,value:n,onCancel:()=>a(!1),onChange:r})]}):null]})},nE=(0,th.Pi)(()=>{var e,[t,n]=(0,p.useState)(!1),o=(0,th.U$)(),{value:r,disabled:l}=o;return(null==r?void 0:null===(e=r.web_background_image)||void 0===e?void 0:e.origin_image_url)?null:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(k.hU,{color:"secondary",size:"small",disabled:l,icon:(0,u.jsx)(P.PwN,{}),onClick:()=>n(!0)}),(0,u.jsx)(nS,{visible:t,value:r,onCancel:()=>n(!1),onChange:e=>{o.setValue(e)}})]})}),nD=n("178385"),nZ=n("458620"),nM=function(e){var{onSuccess:t,onError:n,file:o,beforeUploadCustom:r,afterUploadCustom:l,fileBizType:a}=e;if("string"!=typeof o){null==r||r();try{var{fileInstance:i}=o;if(i){var d,u,c=(u=(d=o.name).lastIndexOf("."),d.slice(u+1));(0,s._)(function*(){try{var e,n=yield(e=i,new Promise((t,n)=>{var o=new FileReader;o.onload=e=>{var o,r=null===(o=e.target)||void 0===o?void 0:o.result;if(!r||"string"!=typeof r){n(new b.sH(nZ.b.parmasValidation,"file read fail"));return}t(r.replace(/^.*?,/,""))},o.readAsDataURL(e)})),o=yield ey.nA.UploadFile({file_head:{file_type:c,biz_type:a},data:n});null==t||t(o.data),null==l||l()}catch(e){null==l||l()}})()}else throw null==l||l(),new b.sH(nZ.b.parmasValidation,y.o.t("error"))}catch(e){null==l||l(),null==n||n({status:0})}}};n("737352");var nP=n("611140"),nL=e=>{var{onChange:t,value:n,disabled:o=!1,generateInfo:r,generateTooltip:l,beforeUploadCustom:a,afterUploadCustom:i,accept:s="image/*",maxCandidateCount:d}=e,c=(0,p.useRef)(null),v=null==n?void 0:n.at(0),[f,m]=(0,p.useState)(!0);return(0,u.jsxs)("div",{className:nP.Z["upload-with-auto-generate"],children:[(0,u.jsx)(k.gq,{action:"",className:nP.Z.upload,limit:1,customRequest:e=>{nM((0,O._)((0,z._)({},e),{fileBizType:nD.ym.BIZ_BOT_WORKFLOW,onSuccess:n=>{m(!1),e.onSuccess(n),null==t||t([{uid:(null==n?void 0:n.upload_uri)||"",url:(null==n?void 0:n.upload_url)||""}])},beforeUploadCustom:a,afterUploadCustom:i}))},fileList:n,accept:s,showReplace:!1,showUploadList:!1,ref:c,disabled:o,maxSize:2048,onSizeError:()=>{k.FN.error({content:y.o.t("dataset_upload_image_warning",{},"Please upload an image less than 2MB"),showClose:!1})},children:(0,u.jsxs)("div",{className:nP.Z["avatar-wrap"],children:[v?(0,u.jsx)(k.EZ,{src:null==v?void 0:v.url,className:nP.Z.avatar,type:"platform"}):(0,u.jsx)(e9,{width:36,type:"platform"}),!o&&(0,u.jsx)("div",{className:nP.Z.mask,children:(0,u.jsx)("div",{className:"relative inline-flex",children:(0,u.jsx)(P.JAz,{className:"text-[24px]"})})})]})}),null]})},nz={type:"object",properties:{info:{type:"void","x-component":"FormSection","x-component-props":{title:y.o.t("skill_role_information"),tooltip:y.o.t("workflow_role_config_title_tooltip"),collapsible:!0},properties:{name:{title:y.o.t("scene_edit_roles_create_name"),type:"string",required:!0,"x-component":"RoleNameInput","x-decorator":"FormItem","x-decorator-props":{tooltip:y.o.t("workflow_role_config_name_tooltip")},"x-validator":{required:!0,message:y.o.t("workflow_testset_required_tip",{param_name:y.o.t("scene_edit_roles_create_name")})}},description:{title:y.o.t("role_info.description"),type:"string","x-component":"TextArea","x-component-props":{placeholder:y.o.t("workflow_role_config_description_placeheader"),size:"small"},"x-decorator":"FormItem"},avatar:{title:y.o.t("workflow_role_config_avatar"),type:"string","x-component":"RoleAvatarUpload","x-reactions":[{dependencies:["name","description"],fulfill:{schema:{"x-component-props.generateInfo":{name:"{{$deps[0]}}",desc:"{{$deps[1]}}"}}}}],"x-decorator":"FormItem"}}},onboarding:{type:"void","x-component":"FormSection","x-component-props":{title:y.o.t("devops_publish_multibranch_BotInfo.OnboardingInfo"),collapsible:!0,action:null},properties:{prologue:{title:y.o.t("bot_edit_opening_text_title"),type:"string","x-component":"FullInput","x-component-props":{placeholder:y.o.t("community_Please_enter_please_enter_your_post"),modalTitle:y.o.t("bot_edit_opening_text_title")},"x-decorator":"FormItem"},questions:{title:y.o.t("review_bot_Onboarding_suggested_questions"),type:"string","x-component":"SuggestionList","x-decorator":"FormItem","x-decorator-props":{action:(0,u.jsx)(tW,{})}}}},suggest:{type:"object","x-component":"RoleSuggestion","x-component-props":{},"x-decorator":"FormSection","x-decorator-props":{title:y.o.t("review_agent_suggestreplyinfo"),collapsible:!0,action:(0,u.jsx)(tz,{})}},background:{type:"object","x-component":"RoleBackground","x-decorator":"FormSection","x-decorator-props":{title:y.o.t("devops_publish_multibranch_BotInfo.BackgroundImageInfoList"),collapsible:!0,action:(0,u.jsx)(nE,{})}},voices:{type:"object","x-visible":!1,"x-decorator":"FormSection","x-decorator-props":{title:y.o.t("workflow_role_config_voices_title"),collapsible:!0,action:(0,u.jsx)(tZ,{})},properties:{config:{type:"object","x-component":"RoleVoices"},textToVoice:{type:"boolean","x-component":"TextToVoice"}}},input:{type:"void","x-visible":!1,"x-component":"FormSection","x-component-props":{title:y.o.t("workflow_role_config_input_title"),collapsible:!0},properties:{default:{type:"string","x-component":"RoleDefaultInput"}}}}},nO=e=>{var{disabled:t}=e,n=(0,C.zr)(),o=(0,p.useMemo)(()=>tp(n.role||{}),[n]);return(0,u.jsx)("div",{children:(0,u.jsx)(eb.Rq,{schema:nz,components:{SuggestionList:tR,RoleSuggestion:tL,RoleVoices:tm,RoleDefaultInput:t$,TextToVoice:tM,RoleBackground:nT,RoleNameInput:tK,RoleAvatarUpload:nL},disabled:t,initialValues:o,onFormValuesChange:e=>{if(!t){var o=e.values;n.debounceSave(tv(o))}}})})},nA=n("416290"),nF=n("181907"),nR=e=>{var t,{spaceId:n,flowMode:o,isInitWorkflow:r}=e,[l,a]=(0,p.useState)([]);var i=(t=(0,s._)(function*(){var e,t,n=yield J.OHc.GetExampleWorkFlowList({page:1,size:20,name:"",flow_mode:o});a(null!==(t=null==n?void 0:null===(e=n.data)||void 0===e?void 0:e.workflow_list)&&void 0!==t?t:[])}),function(){return t.apply(this,arguments)});return(0,p.useEffect)(()=>{if(!!r)i()},[n,r]),{workflowTemplateList:l}},nV=e=>{var{panel:t}=e,n=(0,p.useRef)(t.render()),[,o]=(0,p.useState)(0);return(0,p.useEffect)(()=>{var e=t.onUpdate(e=>{(0,p.startTransition)(()=>{n.current=e,o(e=>e+1)})});return()=>e.dispose()},[t]),(0,u.jsx)(u.Fragment,{children:n.current})},nB=n("313319"),nG=e=>{var{components:t,children:n}=e,o=(0,p.useRef)(null),{isInitWorkflow:r,spaceId:l,flowMode:a}=(0,C.j1)(),i=(0,nF.X)(),s=(0,e6.O)(),d=(0,nA.Z)(o);(0,p.useLayoutEffect)(()=>{i.register(t)},[]),(0,p.useEffect)(()=>{d&&i.setLayoutSize(d)},[d,i]);var{workflowTemplateList:c}=nR({spaceId:l,flowMode:a,isInitWorkflow:r});return(0,p.useEffect)(()=>{if(r){if(!!(null==c?void 0:c.length))s.setTemplateList(c),i.open("templatePanel","bottom"),s.openTemplate()}else s.closeTemplate(),setTimeout(()=>{i.close("bottom")},300)},[r,c,i,s]),(0,u.jsxs)("div",{className:nB.Z["float-layout"],ref:o,children:[(0,u.jsxs)("div",{className:nB.Z["left-panel"],children:[(0,u.jsx)("div",{className:nB.Z["left-main-panel"],children:n}),(0,u.jsx)("div",{className:nB.Z["left-bottom-panel"],children:(0,u.jsx)(nV,{panel:i.bottom})})]}),(0,u.jsx)("div",{className:nB.Z["right-panel"],children:(0,u.jsx)(nV,{panel:i.right})})]})},nW=n("433185"),nU=e=>{var{layout:t="horizontal",children:n,className:o}=e,r=(0,d._)(e,["layout","children","className"]),{isInIDE:l}=(0,C.j1)();return(0,u.jsx)("div",(0,O._)((0,z._)({className:m()(nW.Z["panel-wrap"],o,{[nW.Z.vertical]:"vertical"===t&&!l,[nW.Z.horizontal]:"horizontal"===t&&!l,[nW.Z.vertical_project]:"vertical"===t&&l,[nW.Z.horizontal_project]:"horizontal"===t&&l})},r),{children:n}))},nH=n("719484"),nJ=()=>{var e=(0,C.X6)();return(0,u.jsxs)("div",{className:nH.Z["panel-header"],children:[(0,u.jsx)(k.ZT.Text,{fontSize:"16px",strong:!0,children:y.o.t("workflow_role_config_title")}),(0,u.jsx)(k.hU,{icon:(0,u.jsx)(P.rmE,{}),color:"secondary",onClick:()=>{e.close("right")}})]})},nq=()=>{var{readonly:e}=(0,C.j1)();return(0,u.jsx)(nU,{layout:"vertical",children:(0,u.jsxs)("div",{className:nH.Z["config-panel"],children:[(0,u.jsx)(nJ,{}),(0,u.jsx)("div",{className:nH.Z["panel-content"],children:(0,u.jsx)(nO,{disabled:e})})]})})},nK=()=>{var e=(0,g.er)(),t=(0,g.Dc)(),[n,o]=(0,p.useState)(!1),r=(0,p.useMemo)(()=>(100*e.zoom).toFixed(0),[e.zoom]),l={padding:"8px",lineHeight:"16px"};return(0,u.jsx)(k.Lt,{clickToHide:!0,position:"top",trigger:"custom",visible:n,onClickOutSide:()=>o(!1),onVisibleChange:o,render:(0,u.jsxs)(k.Lt.Menu,{children:[(0,u.jsx)(k.Lt.Item,{"data-testid":"workflow.detail.toolbar.zoom.out",style:l,onClick:()=>e.zoomout(),children:y.o.t("workflow_toolbar_zoom_out")}),(0,u.jsx)(k.Lt.Item,{"data-testid":"workflow.detail.toolbar.zoom.in",style:l,onClick:()=>e.zoomin(),children:y.o.t("workflow_toolbar_zoom_in")}),(0,u.jsx)(k.Lt.Item,{"data-testid":"workflow.detail.toolbar.zoom.fit",style:l,onClick:()=>e.fitView(),children:y.o.t("workflow_toolbar_zoom_fit")}),(0,u.jsx)(k.iz,{className:"m-[4px] w-[108px]"}),(0,u.jsxs)(k.Lt.Item,{"data-testid":"workflow.detail.toolbar.zoom.50",style:l,onClick:()=>{t.config.updateZoom(.5)},children:[y.o.t("workflow_toolbar_zoom_to")," 50%"]}),(0,u.jsxs)(k.Lt.Item,{"data-testid":"workflow.detail.toolbar.zoom.100",style:l,onClick:()=>{t.config.updateZoom(1)},children:[y.o.t("workflow_toolbar_zoom_to")," 100%"]}),(0,u.jsxs)(k.Lt.Item,{"data-testid":"workflow.detail.toolbar.zoom.150",style:l,onClick:()=>{t.config.updateZoom(1.5)},children:[y.o.t("workflow_toolbar_zoom_to")," 150%"]}),(0,u.jsxs)(k.Lt.Item,{"data-testid":"workflow.detail.toolbar.zoom.200",style:l,onClick:()=>{t.config.updateZoom(2)},children:[y.o.t("workflow_toolbar_zoom_to")," 200%"]})]}),children:(0,u.jsxs)("div",{className:"workflow-toolbar-zoom flex justify-start items-center w-[70px] h-[24px] p-[2px] rounded-small border border-solid border-[var(--coz-stroke-plus)] cursor-pointer select-none","data-testid":"workflow.detail.toolbar.zoom",onClick:()=>o(!n),style:{borderColor:n?"var(--coz-stroke-hglt)":"var(--coz-stroke-plus)"},children:[(0,u.jsxs)("p",{className:"text-[12px] flex items-center mx-[4px] w-[40px] h-[20px]",children:[r,"%"]}),(0,u.jsx)("div",{className:"flex items-center justify-center pr-[2px] color-[var(--coz-fg-secondary)]",style:{color:"var(--coz-fg-secondary)"},children:(0,u.jsx)(P.Wdl,{})})]})})},nX=e=>{var{handlers:t}=e,{minimapVisible:n,setMinimapVisible:o}=t;return(0,u.jsx)(k.u,{content:y.o.t("workflow_toolbar_minimap_tooltips"),children:(0,u.jsx)(k.hU,{icon:(0,u.jsx)(P.Kky,{className:n?void 0:"coz-fg-primary"}),color:n?"highlight":"secondary","data-testid":"workflow.detail.toolbar.minimap-switch",onClick:()=>o(!n)})})},nY=n("569603"),nQ=()=>{var e=(0,g.er)(),[t,n]=(0,p.useState)(()=>(0,nY.c$)()),[o,r]=(0,p.useState)(!1),l=y.o.t(t===nY.v6.Mouse?"workflow_mouse_friendly":"workflow_pad_friendly");return(0,p.useEffect)(()=>{e.setMouseScrollDelta(e=>e/20);var t=(0,nY.c$)();e.setInteractiveType(t)},[]),(0,u.jsx)(nY.CJ,{children:(0,u.jsx)(k.u,{content:l,style:{display:o?"none":"block"},children:(0,u.jsx)("div",{className:"workflow-toolbar-interactive","data-testid":"workflow.detail.toolbar.interactive",children:(0,u.jsx)(nY.vL,{value:t,onChange:t=>{n(t),(0,nY.ir)(t),e.setInteractiveType(t)},onPopupVisibleChange:r,containerStyle:{border:"none",height:"24px",width:"38px",justifyContent:"center",alignItems:"center",gap:"2px",padding:"4px",paddingTop:"1px",borderRadius:"var(--small, 6px)"},iconStyle:{margin:"0",width:"16px",height:"16px"},arrowStyle:{width:"12px",height:"12px"}})})})})},n$=()=>{var e,t=(0,g.Dc)(),n=(0,g.G2)(g.L4),o=(0,g.G2)(g.oJ),r=(0,g.G2)(eV.qq),[l,a]=(0,p.useState)(!1),i=(0,p.useCallback)((e,n)=>{var o=t.config.getPosFromMouseEvent(e);if(!n)return{x:o.x,y:o.y-75};var r=n.getData(g.eG),l=n.collapsedChildren.length;return{x:r.padding.left-r.padding.left+30*l,y:r.padding.top+30*l}},[t]);var d=(0,p.useCallback)((e=(0,s._)(function*(e){a(!1),(null===(t=o.activatedNode)||void 0===t?void 0:t.getNodeMeta().isContainer)&&(l=o.activatedNode);var t,l,s=i(e,l),d=yield n.createWorkflowNodeByType(_.nyy.Comment,s,{},null==l?void 0:l.id);setTimeout(()=>{if(!l)o.selectNode(d),r.startDragSelectedNodes(e)},50)}),function(t){return e.apply(this,arguments)}),[o,i,n,r]);return t.config.readonly?(0,u.jsx)(u.Fragment,{}):(0,u.jsx)(k.u,{trigger:"custom",visible:l,onVisibleChange:a,content:y.o.t("workflow_toolbar_comment_tooltips"),children:(0,u.jsx)(k.hU,{icon:(0,u.jsx)(P.vq0,{className:"coz-fg-primary"}),color:"secondary","data-testid":"workflow.detail.controls.comment",onClick:d,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1)})})},n0=n("497744"),n1=()=>{var e=e5(),t=(0,g.Dc)(),{workflowId:n}=(0,g.X2)(n0.eI),o=(0,p.useCallback)((0,s._)(function*(){yield e(),nt.E7.event({eventName:"workflow_control_auto_layout",namespace:"workflow",scope:"control",meta:{workflowId:n}})}),[e,n]);return t.config.readonly?(0,u.jsx)(u.Fragment,{}):(0,u.jsx)(k.u,{content:y.o.t("workflow_detail_layout_optimization_tooltip"),children:(0,u.jsx)(k.hU,{onClick:o,icon:(0,u.jsx)(P.trj,{className:"coz-fg-primary"}),color:"secondary","data-testid":"workflow.detail.toolbar.auto-layout"})})},n2=e=>{var{handlers:t,toolbarRef:n}=e,{addNode:o}=t,r=(0,p.useRef)(!1),l=e=>{if(!r.current){r.current=!0;var t,l=null==n?void 0:null===(t=n.current)||void 0===t?void 0:t.getBoundingClientRect();return l&&(e=l),o(e).finally(()=>r.current=!1)}},a=(0,nm.Z)(l,100);return(0,u.jsx)(k.zx,{icon:(0,u.jsx)(P.PwN,{}),color:"highlight",id:eG,onClick:e=>{a.cancel(),l(e.currentTarget.getBoundingClientRect())},onMouseEnter:e=>{a(e.currentTarget.getBoundingClientRect())},onMouseLeave:()=>{a.cancel()},"data-testid":"workflow.detail.toolbar.add-node",children:y.o.t("workflow_toolbar_add_node")})},n4=n("947329"),n5=e=>{var t=(0,e6.O)(),n=(0,g.Dc)(),{isChatflow:o}=(0,C.j1)(),r=!n.config.readonly,l=(0,p.useRef)();return(0,u.jsxs)("div",{className:m()(n4.Z["tools-wrap"],t.templateVisible?"bottom-[2px]":"bottom-[16px]"),ref:l,children:[(0,u.jsxs)("div",{className:n4.Z["tools-section"],children:[(0,u.jsx)(nQ,{}),(0,u.jsx)(nK,{}),(0,u.jsx)(n$,{}),(0,u.jsx)(n1,{}),(0,u.jsx)(nX,(0,z._)({},e)),r?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(k.iz,{layout:"vertical",style:{height:"16px"},margin:3}),(0,u.jsx)(n2,(0,O._)((0,z._)({},e),{toolbarRef:l}))]}):null]}),(0,u.jsxs)("div",{className:m()(n4.Z["tools-section"],n4.Z["test-run"]),children:[o?(0,u.jsx)(ts,{}):null,(0,u.jsxs)(u.Fragment,{children:[o?(0,u.jsx)(k.iz,{layout:"vertical",style:{height:"16px"},margin:3}):null,!1,(0,u.jsx)(e3.P,{})]})]})]})},n6=e=>{var{handlers:t}=e,{minimapVisible:n}=t,o=(0,g.G2)(g.I5);return n?(0,u.jsx)("div",{className:"workflow-toolbar-minimap flex mb-2","data-testid":"workflow.detail.toolbar.minimap",children:(0,u.jsx)(g.Zd,{service:o,panelStyles:{},containerStyles:{pointerEvents:"auto",position:"relative",top:"unset",right:"unset",bottom:"unset",left:"unset"},inactiveStyle:{opacity:1,scale:1,translateX:0,translateY:0}})}):(0,u.jsx)(u.Fragment,{})},n3=e=>{var{disableTraceAndTestRun:t}=e,n=e2();return t?(0,u.jsx)(u.Fragment,{}):(0,u.jsx)("div",{className:n4.Z.tools,children:(0,u.jsxs)("div",{children:[(0,u.jsx)(n6,{handlers:n}),(0,u.jsx)(n5,{handlers:n})]})})},n8=n("136515"),n9=()=>{var e,t,n,o=(0,g.G2)(eV.GH),r=(0,C.zz)(),l=(0,C.XW)(),{resultSideSheetVisible:a,resultSideSheetLoading:i,hasNodeResult:d}=r,{viewStatus:u,playgroundProps:c,canTestRunHistory:v}=(0,C.j1)(),{visible:f,handleOpen:m,handleClose:h}=(0,Z.mx)("execute-result"),x=(0,p.useMemo)(()=>d||f,[d,f]);(0,p.useEffect)(()=>{var e;null===(e=c.onTestRunResultVisibleChange)||void 0===e||e.call(c,x)},[x,c.onTestRunResultVisibleChange]);var{exeHistoryStatus:y}=r.config,w=Y();var j=(e=(0,s._)(function*(){return!!(yield m())&&(r.openSideSheet(),!0)}),function(){return e.apply(this,arguments)});var b=(t=(0,s._)(function*(){if(!!(yield j()))!w&&!d&&u!==_.tnn.EXECUTING&&v&&(r.updateConfig({resultSideSheetLoading:!0}),yield o.getProcessResult({showNodeResults:!0}),r.updateConfig({resultSideSheetLoading:!1})),l.validateAllLine()}),function(){return t.apply(this,arguments)}),N=()=>{h(),r.closeSideSheet()};var k=(n=(0,s._)(function*(e){var{executeId:t,processResp:n,subExecuteId:r}=null!=e?e:{};if(w&&!t&&!n){j();return}var{executeStatus:l}=yield o.getProcessResult({executeId:t,processResp:n,showNodeResults:!0,subExecuteId:r});l===J.MZx.Fail&&j()}),function(e){return n.apply(this,arguments)}),S=y===J.eLL.HasHistory;return(0,n8.Z)(()=>{a?m().then(e=>{!e&&r.openSideSheet()}):h().then(e=>{!e&&r.closeSideSheet()}),l.validateAllLine()},[a]),{openSideSheet:j,openSideSheetAndShowResult:b,closeSideSheet:N,closeSideSheetAndHideResult:()=>{N(),o.clearTestRun(),l.validateAllLine()},getProcess:e=>o.getProcessResult({showNodeResults:e}),hasLastResult:S,resultSideSheetVisible:f,loading:i,showResult:k,resultVisible:x}};var n7=((o={})[o.TemplateSildeButton=1]="TemplateSildeButton",o[o.TemplatePreview=9999]="TemplatePreview",o),oe=n("150352"),ot=e=>{var{onTemplateScorll:t,templateVisible:n,slidable:o,direction:r}=e,l="right"===r?P.x5d:P.$1i;return o?(0,u.jsx)("div",{className:m()("absolute","right"===r?"right-[8px]":"left-[8px]",oe.Z["slide-button"],{[oe.Z["slide-button-visible"]]:n}),style:{zIndex:n7.TemplateSildeButton},children:(0,u.jsx)(k.hU,{icon:(0,u.jsx)(l,{className:"text-xxl coz-fg-hglt-white"}),style:{maxWidth:"24px",minWidth:"24px",height:"24px",cursor:o?"pointer":"not-allowed",background:"white",boxShadow:"0px 4px 24px 0px rgba(0, 0, 0, 0.25), 0px 12px 48px 0px rgba(0, 0, 0, 0.20)"},onClick:()=>t(r)})}):null},on=n("81644"),oo=e=>{var{spaceId:t,workflowId:n}=e,{workflowComp:o,init:r}=(0,on.L)({from:"workflowTemplate"});return(0,p.useEffect)(()=>{r({spaceId:t,workflowId:n,showExecuteResult:!1,enableInitTestRunInput:!1,disabledSingleNodeTest:!0,disableTraceAndTestRun:!0,disableGetTestCase:!0})},[n,t]),(0,u.jsx)(u.Fragment,{children:o})},or=()=>{var e=(0,e6.O)().templatePreviewInfo;return(0,A.Z)(e)?(0,u.jsx)(u.Fragment,{}):(0,u.jsx)("div",{className:"absolute w-full px-[8px] pt-[8px] pointer-events-auto",style:{height:"calc(100% - 10px)",zIndex:n7.TemplatePreview},children:(0,u.jsx)("div",{className:"w-full h-full p-[12px] bg-[#F9F9F9] rounded-lg",style:{border:"0.548px solid var(--Stroke-COZ-stroke-primary, rgba(6, 7, 9, 0.10))"},children:(0,u.jsx)("div",{className:"relative w-full h-full flex justify-center items-center",children:(0,u.jsx)(oo,{spaceId:null==e?void 0:e.space_id,workflowId:null==e?void 0:e.workflow_id},null==e?void 0:e.workflow_id)})})})},ol=n("532267"),oa=n("205641"),oi=e=>{var t,n,o,r,{workflowTemplate:l,cardIndex:a,onBlur:i,onFocus:d,isDragActive:c,isMove:v}=e,f=(0,p.useRef)(null),[h,x]=(0,p.useState)(!1),j=(0,e6.O)(),b=(0,nF.X)(),N=(0,g.G2)(eV.PR),C=(0,g.G2)(eV.GH);(0,p.useEffect)(()=>{setTimeout(()=>{x(!0)},100*a)},[a,x]);var S=(t=(0,s._)(function*(){if(!c&&!v)try{var e=null==l?void 0:l.schema_json;if(!e){var t,n,o,r=yield _.OHc.GetCanvasInfo({space_id:null!==(o=l.space_id)&&void 0!==o?o:_.RV6,workflow_id:l.workflow_id});e=null==r?void 0:null===(n=r.data)||void 0===n?void 0:null===(t=n.workflow)||void 0===t?void 0:t.schema_json}yield N.reloadDocument({customWorkflowJson:JSON.parse(null!=e?e:"{}")}),N.highPrioritySave(),k.FN.success(y.o.t("workflow_example_succeed")),C.clearTestRun(),j.closeTemplate(),setTimeout(()=>{b.close("bottom")},300)}catch(e){k.FN.error(y.o.t("copy_failed"))}finally{j.closePreview()}}),function(){return t.apply(this,arguments)});return(0,u.jsxs)("div",{ref:f,className:m()("flex flex-col gap-[4px] min-w-[240px] max-w-[240px] max-h-[108px] bg-white p-[8px]",oe.Z["template-card"],"select-none",c?"cursor-grabbing":"cursor-pointer",{[oe.Z["slide-up"]]:h}),onMouseEnter:()=>d(l),onMouseLeave:i,tabIndex:a,onClick:S,children:[(0,u.jsxs)("div",{className:"flex gap-[4px] h-[24px]",children:[(0,u.jsx)("div",{children:(0,u.jsx)(w.Ee,{height:"24px",width:"24px",preview:!1,src:null!==(n=null==l?void 0:l.url)&&void 0!==n?n:"",className:oe.Z["card-header"]})}),(0,u.jsx)(oa.x,{className:"text-[16px] font-medium leading-[22px]",text:null!==(o=null==l?void 0:l.name)&&void 0!==o?o:""})]}),(0,u.jsx)(oa.x,{className:"text-[#0607094D] text-[12px] leading-[16px] font-normal",text:null!==(r=null==l?void 0:l.desc)&&void 0!==r?r:"",rows:3})]})},os=p.forwardRef((e,t)=>{var{workflowTemplateList:n,isCardsOver:o}=e,[r,l]=(0,p.useState)(!1),[a,i]=(0,p.useState)(0),[s,d]=(0,p.useState)(!1),c=(0,e6.O)(),v=(0,nY.c$)()===nY.v6.Mouse,f=e=>{if(!!v)r&&e.preventDefault(),i(0),l(!1)},h=()=>{c.closePreview()},g=e=>{if(!r)c.openPreview(e)};return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"w-[16px]"}),(0,u.jsx)("div",{ref:t,className:m()("flex flex-1  gap-[13px] overflow-x-scroll overflow-y-hidden","w-0 h-[124px] pt-[8px]",oe.Z["list-container"],o?"justify-start":"justify-center",{"cursor-grabbing":v&&r}),onMouseDown:e=>{if(!!(null==t?void 0:t.current)&&!!v)l(!0),i(e.clientX)},onMouseUp:f,onMouseLeave:f,onMouseMove:e=>{e.preventDefault();var n=null==t?void 0:t.current,o=(e.clientX-a)*.1;if(d(r&&!!o),!!r&&!!n&&!!v)n.scrollLeft=(null==n?void 0:n.scrollLeft)-o},children:null==n?void 0:n.map((e,t)=>(0,u.jsx)(oi,{workflowTemplate:e,cardIndex:t,onBlur:h,onFocus:g,isDragActive:r,isMove:s},e.workflow_id))}),(0,u.jsx)("div",{className:"w-[16px]"})]})}),od=()=>{var e,t,n,o,{spaceId:r,readonly:l}=(0,C.j1)(),a=(0,e6.O)(),[i,s]=(0,p.useState)(!0),[d,c]=(0,p.useState)(!0),v=(0,p.useRef)(null),f=(0,p.useRef)(null),h=(null==v?void 0:null===(e=v.current)||void 0===e?void 0:e.scrollWidth)>(null==f?void 0:null===(t=f.current)||void 0===t?void 0:t.scrollWidth),g=(0,p.useRef)(""),x=(0,p.useCallback)(e=>{var t,n=v.current;if(!!n){var o=null!==(t=null==n?void 0:n.scrollLeft)&&void 0!==t?t:0,r=0;"left"===e?r=Math.max(o-400,0):"right"===e&&(r=Math.min(o+400,n.scrollWidth-n.clientWidth)),g.current="click",n.scrollTo({left:r,behavior:"smooth"})}},[s,c]),_=()=>{var e=v.current;if(!!e)s(e.scrollLeft>0),c(e.scrollWidth>e.clientWidth&&Math.ceil(e.scrollLeft)<e.scrollWidth-e.clientWidth)};(0,p.useEffect)(()=>{var e=v.current;if(!!e){var t=new ResizeObserver(()=>{_()});return t.observe(e),e.addEventListener("scroll",_),()=>{e&&(t.unobserve(e),e.removeEventListener("scroll",_))}}},[]);var y={spaceId:null!=r?r:"",flowMode:ol.wz.Workflow,modalState:ei.ye.Workflow};if(!l)return(0,u.jsxs)(nU,{className:m()(oe.Z["template-panel-container"],{[oe.Z["template-slide-down"]]:!a.templateVisible}),style:{paddingTop:"0px"},children:[(0,u.jsx)(ei.Mz.Provider,{value:y,children:(0,u.jsx)("div",{ref:f,className:"relative flex overflow-hidden",children:(0,u.jsx)(os,{ref:v,workflowTemplateList:a.templateList,isCardsOver:h})})}),(0,u.jsx)(ot,{onTemplateScorll:x,templateVisible:(null===(n=a.templateList)||void 0===n?void 0:n.length)>0,slidable:i,direction:"left"}),(0,u.jsx)(ot,{onTemplateScorll:x,templateVisible:(null===(o=a.templateList)||void 0===o?void 0:o.length)>0,slidable:d,direction:"right"})]})},ou=n("165882"),oc=n("672496"),ov=n("34817"),op=()=>{var e,{workflowId:t,spaceId:n,info:o,loading:r,isViewHistory:l,isCollaboratorMode:a}=(0,C.j1)(),{vcsData:i}=o,{draft_commit_id:d,submit_commit_id:u}=i||{},[c,v]=(0,p.useState)(!1),f=(0,p.useRef)(),{data:m}=(0,oc.a)({queryKey:["workflow_retrieve",n,t],queryFn:(0,s._)(function*(){var{data:e}=yield J.OHc.CheckLatestSubmitVersion({workflow_id:t,space_id:n},{cancelToken:new ou.Z.CancelToken(e=>{f.current=e})}),{need_merge:o,latest_submit_author:r}=e;return v(!!o),r}),refetchInterval:1e4,enabled:!r&&!!d&&a&&!c});(0,ov.Z)(()=>{var e;v(!1),null===(e=f.current)||void 0===e||e.call(f)},[u]);var{mergeConfirm:h}=(0,eg.E8)();return{showRetrieve:c&&a&&!l,author:m,handleRetrieve:(e=(0,s._)(function*(){yield h()}),function(){return e.apply(this,arguments)})}},{Text:of}=w.ZT,om=()=>{var{showRetrieve:e,author:t,handleRetrieve:n}=op();return e?(0,u.jsx)(k.jL,{type:"info",icon:null,closeIcon:null,description:(0,u.jsxs)(of,{children:[y.o.t("workflow_publish_multibranch_merge_comfirm_desc",{user_name:t}),(0,u.jsx)(of,{link:!0,onClick:n,style:{marginLeft:8},children:y.o.t("workflow_publish_multibranch_merge_retrieve")})]})}):null},oh=n("586421"),og=()=>{var e=(0,C.tF)(),t=(0,C.nN)();return n=>{var{nodeId:o,errorType:r,targetNodeId:l}=n;return"line"===r?t(o,l||""):e(o)}},ox=()=>{var e,t=(0,C.X6)(),n=(0,C.j1)(),o=(0,e6.O)(),{height:r}=(0,C.EK)(),l=og(),a=(0,g.Dc)();var i=(0,p.useCallback)((e=(0,s._)(function*(e){if(!(yield l(e))){k.FN.error(y.o.t("workflow_node_has_delete"));return}if("node"===e.errorType&&e.nodeId){var n=a.entityManager.getEntityById(e.nodeId);n&&t.open(T.Gd.NodeForm,"right",{node:n})}}),function(t){return e.apply(this,arguments)}),[l]),d=(0,eh.Z)((e,t)=>{var o=!!n.projectId,r=n.getProjectApi();if(o&&r){r.sendMsgOpenWidget("/workflow/".concat(t),{name:"debug",data:{nodeId:e.nodeId}});return}var l="/work_flow?space_id=".concat(n.spaceId,"&workflow_id=").concat(n.workflowId)+"&node_id=".concat(e.nodeId);window.open(l)}),c=(0,p.useCallback)(()=>{t.close("bottom"),o.templateVisible&&t.open("templatePanel","bottom")},[t]);return(0,oh.z)(),(0,u.jsx)(nU,{children:(0,u.jsx)(eb.Vf,{workflowId:n.workflowId,maxHeight:r-16,onScroll:i,onJump:d,onClose:c})})},o_=n("643035"),oy=()=>{var{readonly:e}=(0,C.j1)(),{references:t}=(0,G.c)();return!e&&!(0,A.Z)(null==t?void 0:t.workflowList)?(0,u.jsx)(k.jL,{type:"info",icon:null,className:o_.Z["modify-banner"],closeIcon:(0,u.jsxs)("div",{className:m()("flex items-center","cursor-pointer space-x-2","text-[#06070980]"),children:[(0,u.jsx)("div",{children:y.o.t("workflow_detail_edit_prompt_button")}),(0,u.jsx)(P.rmE,{})]}),description:(0,u.jsx)("div",{children:y.o.t("workflow_detail_sub_workflow_change_banner")})}):null},ow=n("191304"),oj=n("681651"),ob=()=>{var e=(0,g.G2)(eV.qq),t=(0,C.j1)(),{item:n,itemType:o,currentOffset:r,allowDrop:l,message:a}=(0,ow.f)(t=>{var o,l=e.computeCanDrop({coord:null!=r?r:{x:0,y:0},dragNode:{type:null==n?void 0:n.nodeType,json:null==n?void 0:n.nodeJson}});return{allowDrop:l.allowDrop,message:l.message,item:t.getItem(),itemType:t.getItemType(),currentOffset:null!==(o=t.getSourceClientOffset())&&void 0!==o?o:{x:0,y:0}}}),i=(0,p.useMemo)(()=>o===T.iB&&!!a||!1,[o,a]),s=(0,p.useRef)(null),d=(0,p.useMemo)(()=>{var e,n,o,l,a=!!t.projectId,i=r.x-(a?276:0)-((null!==(o=null===(e=s.current)||void 0===e?void 0:e.clientWidth)&&void 0!==o?o:0)-204)/2;return{left:i,top:r.y-(a?100:73)-(null!==(l=null===(n=s.current)||void 0===n?void 0:n.clientHeight)&&void 0!==l?l:0)-10}},[r,t.projectId]);return(0,u.jsxs)("div",{className:oj.Z["drag-tooltip-container"],ref:s,style:(0,z._)({display:i?"block":"none"},d),children:[(0,u.jsxs)("div",{className:oj.Z["drag-tooltip-main"],children:[(0,u.jsx)("div",{className:oj.Z["drag-tooltip-icon"],children:l?(0,u.jsx)(P.Lz_,{className:oj.Z["success-icon"]}):(0,u.jsx)(P.sp3,{className:oj.Z["warning-icon"]})}),(0,u.jsx)("div",{className:oj.Z["drag-tooltip-content"],children:a})]}),(0,u.jsxs)("svg",{className:oj.Z["drag-tooltip-arrow"],width:"24",height:"8",xmlns:"http://www.w3.org/2000/svg",children:[(0,u.jsx)("path",{d:"M0 0.5L0 1.5C4 1.5, 5.5 3, 7.5 5S10,8 12,8S14.5 7, 16.5 5S20,1.5 24,1.5L24 0.5L0 0.5z",fill:"var(--semi-color-border)",opacity:"1"}),(0,u.jsx)("path",{d:"M0 0L0 1C4 1, 5.5 2, 7.5 4S10,7 12,7S14.5  6, 16.5 4S20,1 24,1L24 0L0 0z",fill:"var(--semi-color-bg-3)"})]})]})},oN=n("644113"),ok=n("14651"),oC=e=>{var{icon:t}=e;return(0,u.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,u.jsx)("img",{src:t,width:16,height:16}),(0,u.jsx)(k.ZT.Title,{heading:6,children:y.o.t("scene_workflow_chat_node_name",{},"Role scheduling")}),(0,u.jsx)(k.Vp,{color:"cyan",loading:!0,children:y.o.t("scene_workflow_chat_node_test_run_running",{},"Running")})]})},oS=n("871729"),{Input:oI}=w.l0,oT=e=>{var{initValues:t,onSubmit:n}=e,o=(0,p.useRef)(null),r=(e,t)=>(0,u.jsxs)(u.Fragment,{children:["".concat(e)," ",(0,u.jsx)(k.Vp,{children:t||e})]});return(0,u.jsxs)(w.l0,{ref:o,onSubmit:n,className:"relative h-full flex flex-col",children:[(0,u.jsx)("div",{className:"p-6 rounded-lg coz-bg-max coz-stroke-primary flex-1 mb-6 border border-solid",children:(0,u.jsx)(w.OF,{field:"Messages",initValue:t.Messages,children:e=>{var{arrayFields:n}=e;return(0,u.jsx)(u.Fragment,{children:n.map((e,n)=>{var{field:o,key:l,remove:a}=e;return t.Messages[n].content?(0,u.jsxs)("div",{className:"py-3",children:[(0,u.jsx)(w.l0.Label,{children:r(t.Messages[n].nickname,t.Messages[n].role)}),(0,u.jsx)("div",{children:(0,u.jsx)(w.ZT.Text,{children:t.Messages[n].content})})]}):(0,u.jsx)(oI,{label:r(t.Messages[n].nickname,t.Messages[n].role),field:"".concat(o,"[content]"),rules:[{required:!0,message:"Required"}]})})})}})}),(0,u.jsx)("div",{className:"mb-6 text-right",children:(0,u.jsx)(w.y3,{icon:(0,u.jsx)(oS.Z,{}),type:"primary",theme:"solid",htmlType:"submit",className:"btn-margin-right ",children:y.o.t("scene_workflow_chat_node_test_run_button",{},"Continue running")})})]})},oE=()=>{var e,t,n,[o,r]=(0,p.useState)(!1),{workflowId:l,spaceId:a}=(0,C.j1)(),{cancelTestRun:i}=(0,ok.x)(),d=(0,C.zz)(),c=(0,g.G2)(eV.GH),v=d.getNodeEvent(J.twY.SceneChat);(0,p.useEffect)(()=>{v?(c.pauseTestRun(),r(!0)):r(!1)},[v]);var f=(e=(0,s._)(function*(e){var t;yield J.OHc.WorkFlowTestResume({workflow_id:l,execute_id:d.config.executeId,event_id:null!==(t=null==v?void 0:v.id)&&void 0!==t?t:"",space_id:a,data:JSON.stringify(e)}),c.continueTestRun(),r(!1)}),function(t){return e.apply(this,arguments)});return o?(0,u.jsx)(k.Uu,{visible:o,closable:!1,width:600,title:(0,u.jsxs)("div",{className:"flex items-center",children:[(0,u.jsx)(w._3,{type:"secondary",icon:(0,u.jsx)(F.Z,{style:{color:"#1C1D23"}}),iconSize:"large",onClick:()=>{r(!1),i()}}),y.o.t("scene_workflow_chat_node_test_run_title",{},"Test Q&A nodes")]}),style:{background:"#F7F7FA"},children:(0,u.jsxs)("div",{className:"h-full flex flex-col",children:[(0,u.jsx)(oC,{icon:null!==(n=null==v?void 0:v.node_icon)&&void 0!==n?n:""}),(0,u.jsx)("div",{className:"flex-1",children:(0,u.jsx)(oT,{initValues:{Messages:null===(t=(0,nn.f5)(null==v?void 0:v.data))||void 0===t?void 0:t.messages},onSubmit:f})})]})}):null},oD=n("113051"),oZ=n("786048"),oM=()=>{var e,t,n=(0,C.tF)(),o=(0,C.j1)(),r=!!o.projectId;var l=(e=(0,s._)(function*(e){try{var t,n=yield _.OHc.GetWorkflowDetail({space_id:o.spaceId,workflow_ids:[e]},{__disableErrorToast:!0});return!!(null==n?void 0:null===(t=n.data)||void 0===t?void 0:t[0]).project_id}catch(e){return!1}}),function(t){return e.apply(this,arguments)}),a=e=>{var{nodeId:t,workflowId:n,executeId:r,subExecuteId:l}=e,{spaceId:a}=o,i="/work_flow?space_id=".concat(a,"&workflow_id=").concat(n)+"&node_id=".concat(t,"&execute_id=").concat(r,"&sub_execute_id=").concat(l);window.open(i)};return{goto:(t=(0,s._)(function*(e){var{nodeId:t,workflowId:i,executeId:s,subExecuteId:d}=e;if(i===o.workflowId&&t){!(yield n(t))&&k.FN.error(y.o.t("workflow_node_has_delete"));return}if(!r){a(e);return}var u=yield l(i),c=o.getProjectApi();if(!u||!c){a(e);return}c.sendMsgOpenWidget("/workflow/".concat(i),{name:"debug",data:{nodeId:t,executeId:s,subExecuteId:d}})}),function(e){return t.apply(this,arguments)})}},oP=()=>{var e=(0,nF.X)(),t=(0,e6.O)(),n=(0,C.j1)(),{height:o}=(0,C.EK)(),{goto:r}=oM(),l=(0,C.IW)();return(0,p.useEffect)(()=>{l.traceOpen({panel_type:"list"})},[l]),(0,u.jsx)(nU,{children:(0,u.jsx)(oZ._i,{spaceId:n.spaceId,workflowId:n.workflowId,maxHeight:o-16,onOpenDetail:t=>{e.open("traceDetail","right",{span:t})},onClose:()=>{e.close("bottom"),t.templateVisible&&e.open("templatePanel","bottom")},isInOp:!1,onGotoNode:r})})},oL=e=>{var{span:t}=e,n=(0,C.X6)(),o=(0,C.IW)(),{goto:r}=oM();return(0,p.useEffect)(()=>{o.traceOpen({panel_type:"detail",log_id:t.log_id})},[o,t.log_id]),(0,u.jsx)(nU,{layout:"vertical",children:(0,u.jsx)(oZ.Ob,{span:t,onClose:()=>{n.close("right")},onGotoNode:r})})},oz=n("177001"),oO=n("28260"),oA=()=>{var e=(0,g.G2)(eV.w3),[t,n]=(0,p.useState)(e.selectItem),[o,r]=(0,p.useState)(e.selectConversationItem);return(0,p.useEffect)(()=>{var t=e.onSelectItemChange(e=>n(e)),o=e.onSelectConversationItemChange(e=>{r(e)});return()=>{var e,n;null==t||null===(e=t.dispose)||void 0===e||e.call(t),null==o||null===(n=o.dispose)||void 0===n||n.call(o)}},[]),{sessionInfo:t,conversationInfo:o}},oF=n("58205"),oR=n("822229");function oV(e,t){return Math.max(360,Math.min(t,e))}function oB(){var e=(0,oR.n)(e=>e.width),{width:t}=(0,C.EK)(),n=t?t-16:0,o=n?Math.min(n,546):546,r=oV(e,o);return{max:o,width:r}}var oG=n("624401"),oW=e=>{var{children:t,bypass:n}=e,o=(0,d._)(e,["children","bypass"]),r=function(){var e=(0,oR.n)(e=>e.setWidth),{width:t,max:n}=oB(),o=(0,p.useRef)(t),r=(0,p.useCallback)((e,n,r)=>{o.current=t},[t]),l=(0,p.useCallback)((t,r,l,a)=>{if(!!o.current)e(oV(o.current+a.width,n))},[n,e]),a=(0,p.useCallback)((t,r,l,a)=>{if(!!o.current)e(oV(o.current+a.width,n))},[n,e]);return{enable:{left:!0},minWidth:360,maxWidth:n,size:{width:t,height:"100%"},handleWrapperClass:oG.Z["resizable-handle-wrapper"],onResizeStart:r,onResize:l,onResizeStop:a}}();return n?(0,u.jsx)(u.Fragment,{children:t}):(0,u.jsx)(oF.e,(0,O._)((0,z._)({},r,o),{children:t}))},oU=n("873037"),oH=(e,t)=>{Object.entries(e||{}).forEach(e=>{var[n,o]=e;Object.entries((null==o?void 0:o.properties)||{}).forEach(e=>{var[o,r]=e;t(n,o,r)})})},oJ=n("412656"),oq=n("346707"),oK=e=>e?"<#file:".concat(e,"#>"):e,oX=e=>e?"<#voice:".concat(e,"#>"):e,oY=(e,t)=>{var n=t;return((e===_.owu.Object||e>=_.owu.ArrayString)&&(n=(0,oZ.D6)(n)),_.owu.isVoiceType(e)?n=oX(n):_.owu.isFileType(e)&&(n=_.owu.isArrayType(e)?null==n?void 0:n.map(oK):oK(n)),(e===_.owu.Integer||e===_.owu.Number)&&(n=(0,oJ.Z)(n)||0),(0,oq.Z)(n))?e===_.owu.Integer||e===_.owu.Number?0:e===_.owu.Boolean||(e===_.owu.Object?{}:e>=_.owu.ArrayString?[]:""):n},oQ=e=>{var t={};return oH(e,(e,n,o)=>{t[e]=(0,O._)((0,z._)({},t[e]),{[n]:oY(o["x-origin-type"],o.defaultValue)})}),JSON.stringify(t,void 0,2)},o$=e=>{var t,n=e["x-origin-type"];return n===_.owu.Integer?{type:"integer"}:n===_.owu.Number?{type:"number"}:n===_.owu.Boolean?{type:"boolean"}:_.owu.isArrayType(n)&&_.owu.isFileType(n)?{type:"array",items:{type:"string"}}:_.owu.isArrayType(n)||n===_.owu.Object?null===(t=e["x-component-props"])||void 0===t?void 0:t.jsonSchema:{type:"string"}},o0=e=>{var t={type:"object",properties:{},required:[]};return oH(e,(e,n,o)=>{var r=t.properties[e]||{type:"object",properties:{},required:[]};r.properties[n]=o$(o),o.required&&(r.required.push(n),!t.required.includes(e)&&t.required.push(e)),t.properties[e]=r}),t},o1=e=>{var t,n=null===(t=e.properties)||void 0===t?void 0:t[oZ.NC.Node],o=null==n?void 0:n.properties;if(!!o){var r=o0(o);n.properties={[oZ.NC.JSON]:(0,z._)({"x-component":"JsonModeInput","x-component-props":{properties:o,validateJsonSchema:r},defaultValue:oQ(o)},(0,oZ.t4)({name:oZ.NC.JSON,validateJsonSchema:r}))}}},o2=e=>{var{properties:t,defaultValues:n,force:o}=e;if(!!t)Object.keys(t).forEach(e=>{var r=t[e],l=null==n?void 0:n[e];if("object"===r.type){o2({properties:r.properties,defaultValues:l,force:o});return}(!(0,oq.Z)(l)||o)&&(r.defaultValue=l)})},o4=e=>{var t,n=new URLSearchParams(new URL(e).search);return{url:e,name:null!==(t=n.get("x-wf-file_name"))&&void 0!==t?t:"",uploading:n.get("x-wf-file_uploading")}},o5=e=>{if(!e)return;var t=e.match(/<#file:(https?:.+?)#>/);if(!t)return e;if(!o4(t[1]).uploading)return t[1]},o6=e=>{if(!!e){var t=e.match(/<#voice:(\d+)#>/);return t?t[1]:e}},o3=(e,t)=>{if((0,oq.Z)(t))return t;var n=t;return _.owu.isVoiceType(e)?n=o6(n):_.owu.isFileType(e)&&(_.owu.isArrayType(e)?!(null==(n=null==n?void 0:n.map(o5))?void 0:n.length)&&(n=void 0):n=o5(n)),(e===_.owu.Object||e>=_.owu.ArrayString)&&(n=JSON.stringify(n,void 0,2)),n},o8=e=>{var t,n,{mode:o,originFormSchema:r,formValues:l}=e;if("form"===o||!l)return l;var a=(0,oZ.D6)(null==l?void 0:null===(t=l[oZ.NC.Node])||void 0===t?void 0:t[oZ.NC.JSON]),i=null===(n=r.properties)||void 0===n?void 0:n[oZ.NC.Node],s=null==i?void 0:i.properties;if(!a||!s)return l;var d={};return oH(s,(e,t,n)=>{var o,r=d[e]||{};r[t]=o3(n["x-origin-type"]||"",null==a?void 0:null===(o=a[e])||void 0===o?void 0:o[t]),d[e]=r}),l[oZ.NC.Node]=d,l},o9=n("896335"),o7=n("962289"),re=n("671261"),rt=e=>!!((0,oq.Z)(e)||(0,o9.Z)(e)&&(""===e||"[]"===e||"{}"===e))||!1,rn=e=>{var{mode:t,originFormSchema:n,prevValues:o,nextValues:r,ai:l,cover:a}=e,i=o8({originFormSchema:n,formValues:o,mode:t}),s={},d=(e,t)=>{var n=(0,o7.Z)(i,e),o=(0,o7.Z)(r,e);return((0,td.Z)(o)&&(o=JSON.stringify(o,void 0,2)),l&&_.owu.isFileType(t))?n:rt(n)||a?o:n};return Object.entries(n.properties||{}).forEach(e=>{var[t,n]=e;if(t!==oZ.NC.Node){s[t]=(null==r?void 0:r[t])||(null==o?void 0:o[t]);return}oH(n.properties,(e,n,o)=>{var r=d([t,e,n],o["x-origin-type"]);(0,re.Z)(s,[t,e,n],r)})}),s},ro=(e,t)=>{if(!t)return t;var n,o,r=(0,o7.Z)(t,oZ.NC.Node);if(!r)return t;var l={};return oH(null===(o=e.properties)||void 0===o?void 0:null===(n=o[oZ.NC.Node])||void 0===n?void 0:n.properties,(e,t,n)=>{var o=l[e]||{};o[t]=oY(n["x-origin-type"],(0,o7.Z)(r,[e,t])),l[e]=o}),(0,re.Z)(t,oZ.NC.Node,{[oZ.NC.JSON]:JSON.stringify(l,void 0,2)}),t},rr=n("479886"),rl=n.n(rr),ra=n("824833"),ri=n("115597"),rs=e=>{if(_.owu.isArrayType(e))return eb.QD.LIST;switch(e){case _.owu.String:return eb.QD.STRING;case _.owu.Boolean:return eb.QD.BOOLEAN;case _.owu.Integer:return eb.QD.INTEGER;case _.owu.Number:return eb.QD.NUMBER;default:return eb.QD.OBJECT}},rd=()=>y.o.t("workflow_testset_creation_time",{xxx:rl()().format("YYYY_MM_DD HH_mm_ss")});var ru=(r=(0,s._)(function*(e){var t,n=0,o=rd();var r=(t=(0,s._)(function*(){var t=yield ey.xd.CheckCaseDuplicate((0,O._)((0,z._)({},e),{caseName:o}));return 0x23c7e664===t.failCode&&n<1?(n++,o="".concat(o,"_1"),yield r()):t}),function(){return t.apply(this,arguments)});try{var l=yield r();return(0,O._)((0,z._)({},l),{caseName:o})}catch(e){return{isPass:!1,caseName:o}}}),function(e){return r.apply(this,arguments)});var rc=(l=(0,s._)(function*(e){var t,n,o,r,{schema:l,node:a,workflowId:i,bizCtx:s,values:d,bot:u}=e,c=null===(r=l.properties)||void 0===r?void 0:null===(o=r[oZ.NC.Node])||void 0===o?void 0:null===(n=o.properties)||void 0===n?void 0:null===(t=n[oZ.NC.Input])||void 0===t?void 0:t.properties;if(!!c){var v=Object.entries(c||{}).map(e=>{var[t,n]=e;return{name:t,required:n.required,value:d[t],type:rs(n["x-origin-type"])}}),p=[{component_id:null==a?void 0:a.id,component_type:ra.re.CozeStartNode,inputs:v}];u&&p.push({component_id:"".concat(ra.re.CozeVariableBot),component_type:ra.re.CozeVariableBot,inputs:[{name:ri.o8,required:!0,type:eb.QD.BOT,value:u}]});try{var{caseName:f,isPass:m,failReason:h,failCode:g}=yield ru({bizCtx:s,bizComponentSubject:{componentID:null==a?void 0:a.id,componentType:ra.re.CozeStartNode,parentComponentID:i,parentComponentType:ra.re.CozeWorkflow}});if(!m)return k.FN.error({content:0x23c7e664===g?y.o.t("workflow_testset_name_duplicated"):h,duration:2}),{checkError:!0};ey.xd.SaveCaseData({bizCtx:s,bizComponentSubject:{componentID:null==a?void 0:a.id,componentType:ra.re.CozeStartNode,parentComponentID:i,parentComponentType:ra.re.CozeWorkflow},caseBase:{name:f,input:JSON.stringify(p)}})}catch(e){}}}),function(e){return l.apply(this,arguments)}),rv=n("891524"),rp=n("510741"),rf=n("550655"),rm=n("275993"),rh=n("540656"),rg=n("150723"),rx=n("505646"),r_=n("249294"),ry=n("913693"),rw=n("131325"),rj=(e,t)=>{var n=document.createElement("span"),o=(0,rw.createRoot)(n);return o.render((0,u.jsx)(e,(0,z._)({},t))),{dom:n,root:o,destroy(){o.unmount()}}},rb=n("747517"),rN=e=>{var[t,n]=(0,p.useState)(null),{loading:o}=(0,tI.Z)(()=>e?ey.lv.APIMGetVoice({voice_ids:[e]}).then(e=>{var t,o,r,l,a=null==e?void 0:null===(o=e.data)||void 0===o?void 0:null===(t=o.voices)||void 0===t?void 0:t[0];return n(null==e?void 0:null===(l=e.data)||void 0===l?void 0:null===(r=l.voices)||void 0===r?void 0:r[0]),a}).catch(()=>(n(null),null)):Promise.resolve(null).then(()=>(n(null),null)),{refreshDeps:[e]});return{voice:t,setVoice:n,loading:o}},rk=e=>{var{voiceId:t,onClick:n}=e,{voice:o,loading:r}=rN(t),{isPlaying:l,togglePlayPause:a}=(0,t_.xm)(null==o?void 0:o.preview_audio);return(0,u.jsx)("div",{className:rb.Z["voice-widget"],onClick:n,children:r?(0,u.jsx)(k.yC,{size:"small"}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(k.qE,{shape:"square",size:"12px",src:null==o?void 0:o.icon_url}),(0,u.jsx)("span",{className:rb.Z.name,children:null==o?void 0:o.voice_name}),l?(0,u.jsx)(P.T0r,{className:rb.Z.icon,onClick:a}):(0,u.jsx)(P.JE7,{className:rb.Z.icon,onClick:a})]})})};class rC extends r_.l9{toDOM(e){var{root:t,dom:n}=rj(rk,{voiceId:this.options.voiceId,onClick:()=>{var{from:t,to:n}=this.options;e.dispatch({selection:ry.jT.range(t,n)})}});return this.root=t,n}getEqKey(){return[this.options.voiceId].join("")}eq(e){return e.getEqKey()===this.getEqKey()}destroy(){var e;null===(e=this.root)||void 0===e||e.unmount()}constructor(e){super(),this.options=e}}var rS="x-wf-file_name",rI="x-wf-file_uploading",rT=e=>{var t,n=new URLSearchParams(new URL(e).search);return{url:e,name:null!==(t=n.get(rS))&&void 0!==t?t:"",uploading:n.get(rI)}},rE=(e,t)=>{if(!t||!e)return e;try{var n=new URL(e),o=new URLSearchParams(n.search);return o.has(rS)?o.set(rS,t):o.append(rS,t),n.search=o.toString(),n.toString()}catch(t){return e}},rD=n("263725"),rZ=e=>{var t,{url:n,onClick:o}=e,r=(0,p.useMemo)(()=>rT(n),[n]),l=(0,eb.CO)(r.name),a=(0,u.jsxs)("div",{className:rD.Z["file-widget"],onClick:o,children:[(0,u.jsx)(eb.aA,{size:12,file:(0,O._)((0,z._)({},r),{status:r.uploading?eb.w_.Uploading:void 0})}),r.uploading?(0,u.jsx)(k.ZT.Text,{strong:!0,className:rD.Z["file-name"],ellipsis:!0,children:y.o.t("plugin_file_uploading")}):null,!r.uploading&&(0,u.jsx)(k.ZT.Text,{strong:!0,className:rD.Z["file-name"],ellipsis:!0,children:null!==(t=r.name)&&void 0!==t?t:y.o.t("plugin_file_unknown")})]});return l?(0,u.jsx)(k.J2,{content:(0,u.jsx)(k.Ee,{src:r.url,width:126}),children:a}):a};class rM extends r_.l9{toDOM(e){var{root:t,dom:n}=rj(rZ,{url:this.options.url,onClick:()=>{var{from:t,to:n}=this.options;e.dispatch({selection:ry.jT.range(t,n)})}});return this.root=t,n}eq(e){return e.options.url===this.options.url}destroy(){var e;null===(e=this.root)||void 0===e||e.unmount()}constructor(e){super(),this.options=e}}var rP=n("801815"),rL=n("192180"),rz=n("766009"),rO=n("740106"),rA=n("717914");var rF=(a=(0,s._)(function*(e,t){var n=yield(0,nn.fr)({biz:"workflow",fileType:t,file:e});if(!n)throw Error("no uri");var{url:o}=yield _.OHc.SignImageURL({uri:n},{__disableErrorToast:!0});if(!o)throw Error(y.o.t("imageflow_upload_error"));return o}),function(e,t){return a.apply(this,arguments)}),rR=e=>{var t,{editorRef:n,position:o,fileType:r,accept:l}=e,a=(0,p.useRef)(null),i=(e,t,r)=>{var l;if(!!(null===(l=n.current)||void 0===l?void 0:l.$view))n.current.$view.dispatch({changes:{from:t,to:r,insert:e},selection:ry.jT.range(o+e.length,o+e.length),effects:[]})},d=e=>{var t;if(!(null===(t=n.current)||void 0===t?void 0:t.$view))return -1;return n.current.$view.state.doc.toString().indexOf(e)};var c=(t=(0,s._)(function*(e){var t="<#file:https:loading?".concat(rI,"=").concat((0,rP.x0)(),"#>");i(t,o,o);var{fileInstance:n}=e,a=yield(0,rz.G)(n,{maxSize:"image"===r?rO.n0:rO.Tb,accept:l});if(a){k.FN.error(a);var s=d(t);s>-1&&i("",s,s+t.length);return}try{var u=yield rF(n,r),c="<#file:".concat(rE(u,n.name),"#>"),v=d(t);v>-1&&i(c,v,v+t.length)}catch(e){k.FN.error((0,rL.Z)(e));var p=d(t);p>-1&&i("",p,p+t.length)}}),function(e){return t.apply(this,arguments)});return(0,p.useEffect)(()=>{setTimeout(()=>{var e;null===(e=n.current)||void 0===e||e.disableKeybindings(["Enter"])});var e=e=>{if("Enter"===e.key){var t;null===(t=a.current)||void 0===t||t.openFileDialog()}};return document.addEventListener("keydown",e),()=>{setTimeout(()=>{var t;null===(t=n.current)||void 0===t||t.disableKeybindings([]),document.removeEventListener("keydown",e)})}},[]),(0,u.jsx)(k.gq,{action:"",accept:l,customRequest:c,ref:a,children:(0,u.jsxs)("div",{className:rA.Z["completion-item"],children:[(0,u.jsx)(P.Isu,{}),(0,u.jsx)("span",{children:y.o.t("plugin_file_upload")})]})})},rV=e=>{var{editorRef:t,position:n,spaceId:o}=e,r=e=>{if(!!(null===(o=t.current)||void 0===o?void 0:o.$view)){var o,r="<#voice:".concat(e,"#>");t.current.$view.dispatch({changes:{from:n,to:n,insert:r},selection:ry.jT.range(n+r.length,n+r.length),effects:[]})}},{open:l,modal:a}=(0,t_.PF)({spaceId:o,onSelectVoice:e=>{r(e.voice_id)}});return(0,p.useEffect)(()=>{setTimeout(()=>{var e;null===(e=t.current)||void 0===e||e.disableKeybindings(["Enter"])});var e=e=>{"Enter"===e.key&&l()};return document.addEventListener("keydown",e),()=>{setTimeout(()=>{var n;null===(n=t.current)||void 0===n||n.disableKeybindings([]),document.removeEventListener("keydown",e)})}},[]),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:rA.Z["completion-item"],onClick:l,children:[(0,u.jsx)(P.PwN,{}),(0,u.jsx)("span",{children:y.o.t("workflow_variable_select_voice")})]}),a]})},rB=n("952156"),rG=e=>{var t={},n={[oZ.NC.Input]:{title:y.o.t("wf_testrun_form_json_group_input"),description:y.o.t("wf_testrun_form_json_group_input_extra")},[oZ.NC.Batch]:{title:y.o.t("wf_testrun_form_json_group_batch"),description:y.o.t("wf_testrun_form_json_group_batch_extra")},[oZ.NC.Setting]:{title:y.o.t("wf_testrun_form_json_group_settings"),description:y.o.t("wf_testrun_form_json_group_settings_extra")}};return Object.entries(e||{}).forEach(e=>{var[o,r]=e;t[o]=n[o],Object.entries(r.properties||{}).forEach(e=>{var n,[r,l]=e;t["".concat(o,".").concat(r)]={title:l.title||r,description:l.description,required:l.required,tag:null===(n=l["x-decorator-props"])||void 0===n?void 0:n.tag,type:l["x-origin-type"],props:l["x-component-props"]}})}),t},rW=e=>{var{title:t,required:n,tag:o,description:r}=e;return(0,u.jsxs)("div",{className:rB.Z["key-hover"],children:[t?(0,u.jsxs)("div",{className:rB.Z.label,children:[(0,u.jsx)(k.ZT.Text,{size:"small",strong:!0,children:t}),n?(0,u.jsx)("span",{className:rB.Z.asterisk,children:"*"}):null,o?(0,u.jsx)(k.Vp,{size:"mini",color:"primary",children:o}):null]}):null,r?(0,u.jsx)(k.ZT.Text,{size:"small",type:"secondary",style:{maxWidth:200},children:r}):null]})},rU=e=>{var{properties:t,spaceId:n,editorRef:o}=e,r=rG(t);return[(0,rg.Z)({key(e){var{paths:t}=e,n=r[t.join(".")];if(!!n||!(t.length>2))return rj(rW,null!=n?n:{description:y.o.t("wf_testrun_form_json_key_hover_no")})}}),(0,rh.Z)(e=>{var{paths:t}=e;return!(t.length>2)&&!r[t.join(".")]}),(0,rm.Z)({regexp:/<#file:(https?:.+)#>/g,decorate(e,t,n,o){e(t,n,r_.p.replace({widget:new rM({url:o[1],from:t,to:n}),atomicRange:!0,selectable:!0}))}}),(0,rm.Z)({regexp:/<#voice:(\d+)#>/g,decorate(e,t,n,o){e(t,n,r_.p.replace({widget:new rC({voiceId:o[1],from:t,to:n}),atomicRange:!0,selectable:!0}))}}),(0,rx.Z)(e=>{var{paths:t,position:l}=e,a=r[(0,rf.Z)(t[t.length-1])?t.slice(0,-1).join("."):t.join(".")];return(null==a?void 0:a.type)&&_.owu.isVoiceType(a.type)?rj(rV,{editorRef:o,position:l,spaceId:n}):(null==a?void 0:a.type)&&_.owu.isFileType(a.type)?rj(rR,(0,z._)({editorRef:o,position:l},a.props)):void 0})]},rH=n("693963"),rJ=n("290994"),rq=e=>{var{disabled:t}=e,{mode:n,patch:o}=(0,oZ.Zn)(e=>({mode:e.mode,patch:e.patch}));return(0,u.jsxs)("div",{className:rJ.Z["mode-switch"],children:[y.o.t("wf_testrun_form_mode_text"),(0,u.jsx)(k.rs,{size:"mini",disabled:t,checked:"json"===n,onChange:e=>{o({mode:e?"json":"form"})}})]})};n("579461"),n("942763");var rK=n("461158"),rX=n("172637"),rY=n("769419"),rQ=e=>e?(0,u.jsx)(k.Ph.Option,{value:e.value,showTick:!0,className:rY.Z["bot-option"],children:(0,u.jsx)("div",{className:"flex",style:{width:"100%"},children:(0,u.jsx)("div",{className:"flex",style:{flexGrow:1,flexShrink:1,width:0},children:(0,u.jsx)(k.ZT.Text,{ellipsis:{showTooltip:!0},style:{fontSize:12,color:"#1D1C23",fontWeight:400},children:e.label})})})},e.value):null,r$=e=>{var t,n,{enableTypes:o=["static","dynamic"],value:r,onChange:l,projectId:a}=e,i=(0,d._)(e,["enableTypes","value","onChange","projectId"]),c=(0,C.j1)(),{getNode:v}=(0,ek.J)(),f=v(),m=(0,g.G2)(eV.w3),[h,x]=(0,p.useState)(!1),[w,j]=(0,p.useState)(""),[b,N]=(0,p.useState)(),[S,I]=(0,p.useState)(),[T,E]=(0,p.useState)(""),D=(null==a?void 0:a.id)||a||c.projectId||"",Z=(0,p.useMemo)(()=>{var e=((null==b?void 0:b.length)||0)+((null==S?void 0:S.length)||0);return e<7?32*e:208},[b,S]),M=(e,t)=>{t&&m.setSelectConversationItem(t),null==l||l(e)},{getStartNodeOutputs:P}=(0,ek.L)();var L=(t=(0,s._)(function*(){var e=yield A();if(f&&!r){var t,n,o=(null===(t=P().find(e=>e.name===_.d9h))||void 0===t?void 0:t.defaultValue)||"",l=e.find(e=>e.label===o);M((null==l?void 0:l.value)||(null===(n=e[0])||void 0===n?void 0:n.value),l||e[0])}}),function(){return t.apply(this,arguments)});(0,p.useEffect)(()=>{D&&L()},[D]),(0,p.useEffect)(()=>{if(T===D&&!!b&&!!S){var e,t=[...b,...S].find(e=>e.value===r);r&&(null==t?void 0:t.value)!==(null===(e=m.selectConversationItem)||void 0===e?void 0:e.value)&&m.setSelectConversationItem(t)}},[r,b,S]);var A=(n=(0,s._)(function*(e){x(!0);var t,n,r=[],l=[];if(E(D),o.includes("static")){;N(r=(null===(t=(yield _.OHc.ListProjectConversationDef({space_id:c.spaceId,project_id:D,project_version:c.projectCommitVersion,create_method:ev.nS.ManualCreate,create_env:ev.Af.Draft,nameLike:null!=e?e:w,limit:1e3})).data)||void 0===t?void 0:t.map(e=>({value:e.unique_id||"",label:e.conversation_name||"",conversationId:e.conversation_id||""})))||[])}if(o.includes("dynamic")){;I(l=(null===(n=(yield _.OHc.ListProjectConversationDef({space_id:c.spaceId||"",project_id:D,project_version:c.projectCommitVersion,create_method:ev.nS.NodeCreate,create_env:ev.Af.Draft,nameLike:null!=e?e:w,limit:1e3})).data)||void 0===n?void 0:n.map(e=>({value:e.unique_id||"",label:e.conversation_name||"",conversationId:e.conversation_id||""})))||[])}return x(!1),[...r,...l]}),function(e){return n.apply(this,arguments)});return(0,u.jsxs)(k.Ph,(0,O._)((0,z._)({value:r,dropdownClassName:rY.Z.dropdown,filter:!0,remote:!0,placeholder:y.o.t("wf_chatflow_114"),emptyContent:y.o.t("wf_chatflow_115"),onSearch:(0,nm.Z)(e=>{j(e),A(e)},500),loading:h,style:{width:"100%"},virtualize:{height:Z,width:"100%",itemSize:32},onChange:e=>{var t=[...b||[],...S||[]].find(t=>t.value===e);M(e,t)}},i),{children:[(0,u.jsx)(k.Ph.OptGroup,{label:y.o.t("wf_chatflow_103"),children:(b||[]).map(e=>rQ(e))},Number(new Date)),(0,u.jsx)(k.Ph.OptGroup,{label:y.o.t("wf_chatflow_43"),children:(S||[]).map(e=>rQ(e))},Number(new Date))]}))},r0=e=>{var{value:t,onChange:n}=e,o=(0,d._)(e,["value","onChange"]);return(0,u.jsx)(r$,(0,z._)({value:t,onChange:n},o))},r1=(0,w.Q2)(r0,{valueKey:"value",onKeyChangeFnName:"onChange"});r1.defaultProps={fieldStyle:{overflow:"visible"}};var r2=n("550540"),r4=n("735297"),r5=e=>{var{variables:t}=e,n=t.map(e=>{var{key:t}=e;return null!=t?t:""});return(0,u.jsx)(r4.P,{tags:n,max:5})},r6=n("339640"),r3=e=>{var{botInfo:t,isLoading:n}=(0,r6.W)(e);return{variables:r6.L.variable(t),isLoading:n}},r8=n("33630"),r9=e=>{var t,n,{isLoading:o,botInfo:r}=(0,r6.W)(e);if(n=r6.L.database(r)){;(t=n).forEach(e=>{var t;e.rw_mode===r8.mx.UnlimitedReadWrite&&(null==e?void 0:null===(t=e.field_list)||void 0===t?void 0:t.length)>0&&["id","uuid"].forEach(t=>{var n,o;!(null===(n=e.field_list)||void 0===n?void 0:n.find(e=>e.name===t))&&(null===(o=e.field_list)||void 0===o||o.unshift({name:t}))})}),n=t}return{tableInfo:n,isLoading:o}},r7=n("713505"),le=e=>{var{variableList:t,isLoading:n}=(0,r7.D)(e);return{variables:t,isLoading:n}},lt=n("730274"),ln=e=>{var{isLoading:t,botInfo:n}=(0,r6.W)(e);return{ltmEnabled:(0,o7.Z)(n,["bot_info","bot_tag_info","time_capsule_info","time_capsule_mode"],lt.o_.Off)===lt.o_.On,isLoading:t}};var lo=(i=(0,s._)(function*(e){for(var{botId:t,botCount:n}=e,o=Math.ceil(n/20),r="0",l=0,a="",i="",s=[];l<o;){var d=yield ey.nA.GetMessageList({bot_id:t,draft_mode:!0,scene:ol.xs.Playground,cursor:r,count:Math.min(n-20*l,20)});if(s=[...s,...d.message_list.filter(e=>"question"===e.type||"answer"===e.type).map(e=>({role:null==e?void 0:e.role,content:null==e?void 0:e.content}))],a=(null==d?void 0:d.connector_conversation_id)||"",i=(null==d?void 0:d.last_section_id)||"",r=null==d?void 0:d.cursor,l+=1,!d.hasmore)break}return{messageList:s,conversationId:a,sectionId:i}}),function(e){return i.apply(this,arguments)}),lr=e=>{var t,n,o,{botInfo:r,isLoading:l}=(0,r6.W)(e),a=null!==(o=null===(n=r6.L.model(r))||void 0===n?void 0:null===(t=n.short_memory_policy)||void 0===t?void 0:t.history_round)&&void 0!==o?o:0,{isLoading:i,data:s}=(0,oc.a)({queryKey:["bot_info",e,a],queryFn:()=>lo({botId:e,botCount:a}),enabled:void 0!==a}),{messageList:d,conversationId:u,sectionId:c}=s||{};return{chatHistory:(null==d?void 0:d.length)?{chatHistory:d}:null,isLoading:l||i,conversationId:u,sectionId:c}},ll=n("331834"),la=e=>{var{data:t=[{table_name:"none"}]}=e,n=[{title:y.o.t("db_add_table_name"),dataIndex:"table_name",render:e=>(0,u.jsx)("span",{children:e})},{title:y.o.t("db_add_table_field_name"),dataIndex:"field_list",render:e=>e&&e.length>0?(0,u.jsx)(r4.P,{tags:(null!=e?e:[]).map(e=>{var{name:t}=e;return t||""}),max:3}):"none"}];return(0,u.jsx)(w.iA,{className:ll.Z.table,columns:n,dataSource:t,pagination:!1})},li=n("112369"),ls=e=>{var{children:t,label:n,defaultText:o,hideLabel:r=!1}=e,l=!t&&!!o;return(0,u.jsxs)("div",{className:li.Z.container,children:[r||l?null:(0,u.jsx)("div",{className:li.Z.label,children:n}),l?(0,u.jsx)("div",{className:li.Z["default-text"],children:o}):null,t]})},ld=n("715363"),lu=n("203259"),lc=e=>{var{data:t}=e;return(0,u.jsx)(ld.he,{data:t,className:lu.Z["json-viewer"]})},lv=n("140219"),lp=n("604177"),lf=e=>{var{value:t,onChange:n,hideLabel:o=!1,hideVariblesForce:r=!1,hasVariableNode:l=!1,hasVariableAssignNode:a=!1,hasDatabaseNode:i=!1,hasChatHistoryEnabledLLM:s=!1,hasLTMNode:c=!1}=e,v=(0,d._)(e,["value","onChange","hideLabel","hideVariblesForce","hasVariableNode","hasVariableAssignNode","hasDatabaseNode","hasChatHistoryEnabledLLM","hasLTMNode"]),p=t;"string"==typeof t&&(p={id:t,type:oO.jH.Bot});var f=null==p?void 0:p.id,m=(null==p?void 0:p.type)===oO.jH.Bot,{tableInfo:h,isLoading:g}=r9(m?f:void 0),{variables:x,isLoading:_}=r3(m?f:void 0),{variables:w,isLoading:j}=le(m?void 0:f),{chatHistory:b}=lr(m?f:void 0),{ltmEnabled:N,isLoading:k}=ln(m?f:void 0),C=!!f,S=x&&x.length>0,I=h&&h.length>0,T=w&&(null==w?void 0:w.length)>0,E=!!b,D=C&&!g&&i,Z=C&&!_&&(l||a)&&!r,M=C&&c&&!k,P=C&&(l||a)&&!j&&!m;return(0,r2.Z)(()=>{var e=new URLSearchParams(window.location.search).get("bot_id");!f&&e&&(null==n||n({id:e,type:oO.jH.Bot}))}),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(ls,{hideLabel:o,label:y.o.t("workflow_240218_02"),children:(0,u.jsx)(lv.e,(0,z._)({isBot:m,value:p,onChange:n},v))}),P?(0,u.jsx)("div",{className:lp.Z.container,children:(0,u.jsx)(ls,{label:y.o.t("wf_chatflow_126"),defaultText:y.o.t("wf_chatflow_127"),children:T?(0,u.jsx)(r5,{variables:w}):null})}):null,m?(0,u.jsxs)("div",{className:lp.Z.container,style:{display:Z||D||M?"block":"none"},children:[Z?(0,u.jsx)(ls,{label:y.o.t("workflow_detail_testrun_variable_node_field"),defaultText:y.o.t("workflow_detail_testrun_variable_node_nofield"),children:S?(0,u.jsx)(r5,{variables:x}):null}):null,D?(0,u.jsx)(ls,{label:y.o.t("workflow_240218_05"),defaultText:y.o.t("workflow_240218_04"),children:I?(0,u.jsx)(la,{data:h}):null}):null,null,M?(0,u.jsx)(ls,{label:y.o.t("ltm_240617_02"),children:(0,u.jsxs)("div",{className:"text-[12px]",children:[y.o.t("timecapsule_1228_001"),":"," ",N?y.o.t("timecapsule_0124_001"):y.o.t("timecapsule_0124_002")]})}):null]}):null]})},lm=(0,w.Q2)(lf,{valueKey:"value",onKeyChangeFnName:"onChange"});lm.defaultProps={fieldStyle:{overflow:"visible"}};var lh=n("335740"),lg=n("370354"),lx=e=>{var{formApiRef:t}=e,[n,o]=(0,p.useState)(null),{mode:r,patch:l,getSchema:a}=(0,oZ.Zn)(e=>({mode:e.mode,patch:e.patch,getSchema:e.getSchema})),i=(0,C.j1)(),d=(0,g.G2)(g.L4),u=(0,eb.Jf)(),{getDefaultValues:c}=(0,lg.cd)(),v=(0,eh.Z)((0,s._)(function*(){var n=yield(0,lg.wN)({node:e.node,isChatflow:i.isChatflow,isInProject:i.isInIDE,workflowId:i.workflowId,spaceId:i.spaceId,isPreview:i.config.preview}),o=yield c(n);o&&o2({properties:n.properties,defaultValues:o}),l({schema:n}),t.current.originSchema=n,f(n)})),f=(0,eh.Z)((e,n)=>{var l=(0,lh.Z)(e);l["x-form-mode"]=r;var a=l["x-node-id"],i=u.getCacheValues(a||"");n&&i&&o2({properties:l.properties,defaultValues:i,force:!0}),"json"===r&&o1(l),o(l),t.current.modeSchema=l});return(0,p.useEffect)(()=>{v();var e=d.onContentChange(e=>{e.type===g.fT.NODE_DATA_CHANGE&&v()});return()=>e.dispose()},[e.node,d,v]),(0,p.useEffect)(()=>{var e=a();e&&f(e,!0)},[r,f]),{schemaWithMode:n}},l_=e=>{var{schemaWithMode:t,formApiRef:n}=e,o=(0,eb.Jf)(),r=(0,oZ.Zn)(e=>e.getSchema),l=(0,eh.Z)(e=>{n.current.mounted(e)});return{onFormValuesChange:(0,eh.Z)(e=>{var{values:n}=e,l=(0,lh.Z)(n),a=null==t?void 0:t["x-node-id"],i=r();i&&t&&o8({mode:t["x-form-mode"]||"form",originFormSchema:i,formValues:l}),a&&o.setCacheValues(a,l)}),onMounted:l}};class ly{mounted(e){this.innerForm=e}getUIMode(){var e;return(null===(e=this.modeSchema)||void 0===e?void 0:e["x-form-mode"])||"form"}submit(){var e=this;return(0,s._)(function*(){return e.modeSchema&&e.innerForm?(yield e.innerForm.validate()).length?{validate:!1}:{validate:!0,values:o8({mode:e.modeSchema["x-form-mode"]||"form",originFormSchema:e.originSchema||{},formValues:(0,lh.Z)(e.innerForm.values)})}:{empty:!0,validate:!0}})()}constructor(){this.innerForm=null,this.originSchema=null,this.modeSchema=null}}var lw={NodeFieldCollapse:e=>{var{children:t}=e;return(0,oZ.zK)(),(0,oZ.cI)(),(0,oZ.Zn)(e=>e.getSchema),(0,u.jsx)(oZ.Au,{label:y.o.t("wf_test_run_form_input_collapse_label"),extra:(0,u.jsxs)("div",{className:rK.Z.extra,children:[(0,u.jsx)(rq,{}),null]}),children:t})},RelatedFieldCollapse:e=>{var{value:t,isNeedBot:n,isNeedConversation:o,onChange:r,onBlur:l}=e,a=(0,d._)(e,["value","isNeedBot","isNeedConversation","onChange","onBlur"]),{errors:i}=(0,oZ.Ws)(),s=(i||[]).filter(e=>(null==e?void 0:e.type)==="bot").map(e=>e.message),c=(i||[]).filter(e=>(null==e?void 0:e.type)==="conversation").map(e=>e.message),v=(0,C.j1)(),f=(0,g.G2)(rX.f),m=v.projectId,h=null==t?void 0:t[oZ.NC.Bot],x=null==t?void 0:t[oZ.NC.Conversation],_=(0,p.useMemo)(()=>m?m:(null==h?void 0:h.type)===oO.jH.Project?null==h?void 0:h.id:void 0,[m,h]),w=o&&!!_;return(0,u.jsxs)(oZ.Au,{label:y.o.t("wf_testrun_form_related_title"),children:[n?(0,u.jsx)(oZ.Tz,{title:y.o.t("wf_chatflow_72"),required:!0,feedback:s.join(","),children:(0,u.jsx)(lf,(0,O._)((0,z._)({size:"small",hideLabel:!0,value:h,onChange:e=>{r({[oZ.NC.Bot]:e}),l(),f.loadGlobalVariables(e.type===oO.jH.Bot?"bot":"project",e.id)}},a),{validateStatus:s.length?"error":void 0}))}):null,w?(0,u.jsx)(oZ.Tz,{title:y.o.t("wf_chatflow_74"),required:!0,tooltip:y.o.t("wf_chatflow_154"),feedback:c.join(","),children:(0,u.jsx)(r0,(0,O._)((0,z._)({size:"small",value:x,projectId:_,onChange:e=>{r((0,O._)((0,z._)({},t),{[oZ.NC.Conversation]:e})),l()}},a),{validateStatus:c.length?"error":void 0}))}):null]})},TypedFileInput:e=>(0,u.jsx)("div",{style:{marginTop:"15px"},children:(0,u.jsx)(rH.J,(0,z._)({},e))}),JsonModeInput:e=>{var{properties:t,validateJsonSchema:n}=e,o=(0,d._)(e,["properties","validateJsonSchema"]),r=(0,C.j1)(),l=(0,p.useRef)(),a=(0,p.useRef)(rU({properties:t,spaceId:r.spaceId,editorRef:l}));return(0,u.jsx)(oZ.Sx,(0,z._)({jsonSchema:n,extensions:a.current,height:"364px",didMount:e=>{l.current=e}},o))},TestsetSave:e=>{var{value:t,onChange:n,onBlur:o}=e,r=(0,d._)(e,["value","onChange","onBlur"]),{openEditPanel:l}=(0,eb.dv)(e=>({openEditPanel:e.openEditPanel}));return(0,u.jsx)("div",{className:rv.Z["testset-save"],children:(0,u.jsxs)(k.XZ,(0,O._)((0,z._)({checked:t,onChange:e=>{null==n||n(e.target.checked),null==o||o()}},r),{children:[(0,u.jsx)(k.ZT.Text,{size:"small",children:y.o.t("workflow_testset_save")}),(0,u.jsx)(k.ZT.Text,{link:!0,size:"small",style:{lineHeight:"20px"},onClick:e=>{e.stopPropagation(),l()},children:y.o.t("workflow_testset_create")})]}))})},TestsetSelect:e=>{var{disabled:t}=e,n=(0,oZ.zK)(),o=(0,oZ.cI)(),r=(0,oZ.Zn)(e=>e.getSchema);return(0,u.jsx)(oZ.Au,{label:y.o.t("workflow_testset_available"),tooltip:y.o.t("workflow_testset_hover_tips"),children:(0,u.jsx)(eb.Nc,{className:rp.Z["testset-select"],disabled:t,onSelect:e=>{var t=r();if(!!e&&!!t){var l=n["x-form-mode"]||"form",a=rn({mode:l,originFormSchema:t,prevValues:o.values,nextValues:e,cover:!0});(null==a?void 0:a[oZ.NC.TestsetSave])===!0&&(a[oZ.NC.TestsetSave]=!1),"json"===l&&(a=ro(t,a)),o.values=a}},size:"small"})})}},lj=e=>{var{node:t,onMounted:n}=e,o=(0,p.useRef)(new ly),{schemaWithMode:r}=lx({node:t,formApiRef:o}),l=l_({schemaWithMode:r,formApiRef:o});return((0,p.useEffect)(()=>{n(o.current)},[o]),r)?r&&(0,oZ.Bf)(r.properties)?(0,u.jsx)(eb.O6,{}):(0,u.jsx)(oZ.jd,(0,z._)({schema:r,components:lw},l)):null},lb=e=>(0,u.jsx)(oZ.cO,{children:(0,u.jsx)(lj,(0,z._)({},e))}),lN=n("674145"),lk=()=>{var{workflowId:e,spaceId:t}=(0,C.j1)(),n=(0,C.zz)(),o=n.getNodeEvent(ev.tw.Question);return(0,u.jsx)(eb.pk,{spaceId:t,workflowId:e,executeId:n.config.executeId,questionEvent:o})},lC=n("679928"),lS=()=>{var{workflowId:e,spaceId:t}=(0,C.j1)(),n=(0,C.zz)(),o=n.getNodeEvent(ev.tw.InputNode);return(0,u.jsx)(lC.M,{spaceId:t,workflowId:e,executeId:n.config.executeId,inputEvent:o})},lI=n("997363"),lT=n("676358"),lE=n("251096"),lD=e=>{var{onMount:t}=e,n=(0,p.useRef)(null);return(0,r2.Z)(()=>{var e;null==t||t(null===(e=n.current)||void 0===e?void 0:e.getBoundingClientRect())}),(0,u.jsx)("div",{ref:n})};function lZ(){var e=(0,p.useRef)(null),t=(0,p.useRef)(null),n=(0,p.useRef)(void 0),[o]=(0,tg.Z)(t),r=(0,lE.Z)(e);return{showInputBorder:!!((null==r?void 0:r.top)&&(null==r?void 0:r.top)>0&&o),showOutputBorder:!!((null==r?void 0:r.top)&&(null==r?void 0:r.top)>0&&!o),updateRunStatus:e=>{n.current=e},logNodeRef:e,inputRef:t,logView:(0,u.jsx)(lD,{onMount:o=>{if(!(n.current&&[ev.nB.Success,ev.nB.Fail].includes(n.current)))return;var r,l,a,i,s,d=null===(r=e.current)||void 0===r?void 0:r.getBoundingClientRect();if(!o||!d||!((null==o?void 0:o.bottom)<=(null==d?void 0:d.bottom))){var u=null===(a=t.current)||void 0===a?void 0:null===(l=a.getBoundingClientRect)||void 0===l?void 0:l.call(a),c=null==u?void 0:u.height;c&&e.current&&(null===(s=e.current)||void 0===s||null===(i=s.scrollTo)||void 0===i||i.call(s,{top:c,behavior:"smooth"})),n.current=void 0}}})}}var lM=e=>{var{value:t}=e,n=(0,d._)(e,["value"]);return(0,u.jsx)(lm,(0,z._)({field:ri.Lp.Bot,hideLabel:!0},n))},lP=n("692857"),lL=e=>{var[t,n]=(0,p.useState)({}),{queryNeedBot:o}=(0,lP.t)(),{getNode:r}=(0,ek.J)(),l=r(),a=ri.Gf.Default;return(0,p.useEffect)(()=>{var e;(e=(0,s._)(function*(){if(l){var{hasLTMNode:e,hasConversationNode:t}=yield o(a,l);n({disableBot:t,disableBotTooltip:t?y.o.t("wf_chatflow_141"):"",disableProject:e,disableProjectTooltip:e?y.o.t("wf_chatflow_142"):""})}}),function(){return e.apply(this,arguments)})()},[]),(0,u.jsx)(lM,(0,z._)({},e,t))},lz=n("854908");function lO(){return(0,u.jsxs)("div",{className:m()("w-full h-full absolute flex flex-col items-center justify-center bg-white",lz.Z["content-bg-color"]),children:[(0,u.jsx)(P.j2n,{className:"animate-spin coz-fg-dim mb-[4px] text-[32px]"}),(0,u.jsx)("span",{className:"text-[14px]",children:y.o.t("workflow_testset_testruning")})]})}var lA=n("511743"),lF=e=>{var{result:t,node:n,extra:o}=e,r=(0,C.j1)(),{open:l}=(0,lg.UF)();return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(oZ.Au,{label:y.o.t("workflow_running_results"),children:[(0,u.jsx)(eb.qS,{spaceId:r.spaceId,workflowId:r.workflowId,result:t,paginationFixedCount:5,LogImages:lA.d,node:n,onOpenWorkflowLink:l}),o]}),(0,u.jsx)("div",{className:"pb-2"})]})},lR=()=>{var{running:e}=(0,lT.v)(ri.TJ),t=(0,nF.X)(),{open:n}=(0,C.XD)(),o=(0,p.useCallback)(()=>{},[n]),r=(0,p.useCallback)(()=>{t.close("right")},[t]);return(0,u.jsxs)("div",{className:lz.Z["test-form-sheet-header-v2"],children:[(0,u.jsx)("div",{className:m()(lz.Z["header-title-v2"]),children:y.o.t("workflow_detail_title_testrun")}),(0,u.jsxs)("div",{className:"flex items-center",children:[!e&&(0,u.jsx)(er,{onClick:o,hiddenStateText:!0,extra:!1}),(0,u.jsx)(k.hU,{className:"ml-[4px]",icon:(0,u.jsx)(P.rmE,{className:"text-[18px]"}),color:"secondary",onClick:r})]})]})},lV=e=>{var{onClick:t}=e,{loading:n,disabled:o,saveLoading:r,running:l}=(0,lT.v)(ri.TJ),{cancelTestRun:a,canceling:i}=(0,ok.x)(),{config:{executeId:s}}=(0,C.zz)(),d=(0,p.useMemo)(()=>r?y.o.t("bot_autosave_saving"):y.o.t("workflow_detail_title_testrun"),[r]);return l?(0,u.jsx)(k.zx,{icon:(0,u.jsx)(P.noE,{}),onClick:a,disabled:i||!s&&o,color:"primary",children:y.o.t("devops_publish_changelog_generate_stop")}):(0,u.jsx)(k.zx,{disabled:o,loading:n,icon:(0,u.jsx)(P.NvC,{}),color:"green",onClick:t,children:d})},lB=e=>{var{node:t,onClick:n}=e,{loading:o,disabled:r,isMineRunning:l}=(0,lT.v)(t.id),{cancelTestRun:a,canceling:i}=(0,ok.x)(),{config:{executeId:s}}=(0,C.zz)();return l?(0,u.jsx)(k.zx,{icon:(0,u.jsx)(P.noE,{}),onClick:a,disabled:i||!s&&r,color:"primary",style:{width:"100%"},children:y.o.t("devops_publish_changelog_generate_stop")}):(0,u.jsx)(k.zx,{icon:(0,u.jsx)(P.NvC,{}),disabled:r,loading:o,onClick:n,color:"green",style:{width:"100%"},children:y.o.t("workflow_debug_run")})},lG=e=>{var{node:t,onClick:n}=e;return(0,u.jsx)("div",{className:lz.Z["test-form-sheet-footer-v2"],children:t?(0,u.jsx)(lB,{node:t,onClick:n}):(0,u.jsx)(lV,{onClick:n})})},lW=e=>{var t,n,o,{node:r}=e,l=(0,p.useRef)(null),a=(0,C.zz)(),i=(0,g.G2)(eV.GH),d=(0,C.IW)(),c=(0,lI.n)(),{validate:v}=(0,oh.Q)(),f=(0,C.X6)(),h=(0,C.j1)(),x=eN.Z.useUserInfo(),_=a.getEndNodeResult(),{getNode:w}=(0,ek.J)(),{sessionInfo:j}=oA(),{running:b}=(0,lT.v)(ri.TJ),{updateRunStatus:N,logNodeRef:S,logView:I}=lZ(),T=!!(null==_?void 0:_.nodeStatus)&&[J.nBi.Success,J.nBi.Fail].includes(_.nodeStatus);var E=(t=(0,s._)(function*(){if(yield v()){f.open("problemPanel","bottom");return}if(!!l.current){var e,t,n,o,s,u,p,{empty:m,validate:g,values:x}=yield l.current.submit();if(!g){k.FN.error(y.o.t("workflow_testrun_form_vailate_error_toast"));return}if(!m&&(t=null==x?void 0:null===(p=x[oZ.NC.Node])||void 0===p?void 0:p[oZ.NC.Input],n=(0,oU._)(t),s=null==(o=null==x?void 0:x[oZ.NC.Related])?void 0:o[oZ.NC.Bot],u=null==x?void 0:x[oZ.NC.TestsetSave]),u){var _=yield rc({values:t,bot:s,schema:l.current.originSchema,bizCtx:c,node:r,workflowId:h.workflowId});if(null==_?void 0:_.checkError)return}d.formRunUIMode({form_ui_mode:l.current.getUIMode()});var w=(null==j?void 0:j.type)===oO.jH.Project;yield i.testRun(n,(null==s?void 0:s.id)||s,w);var b=null===(e=a.getEndNodeResult())||void 0===e?void 0:e.nodeStatus;N(b),b===J.nBi.Success&&u&&l.current.innerForm&&l.current.innerForm.setValueIn(oZ.NC.TestsetSave,!1)}}),function(){return t.apply(this,arguments)});var D=(n=(0,s._)(function*(){i.clearTestRun(),yield E()}),function(){return n.apply(this,arguments)});return(0,u.jsx)("div",{className:lz.Z["test-form-v2"],children:(0,u.jsxs)(eb.oR,{spaceId:h.spaceId,workflowId:h.workflowId,userId:null==x?void 0:x.user_id_str,nodeId:null===(o=w())||void 0===o?void 0:o.id,projectId:h.projectId,formRenders:{[eb.QD.BOT]:lL,[eb.QD.LIST]:lN.Y,[eb.QD.OBJECT]:lN.Y},children:[(0,u.jsx)(lR,{}),(0,u.jsx)(oz.oK,{scene:oz.Qv.Token}),(0,u.jsxs)("div",{ref:S,className:lz.Z["test-form-content"],children:[(0,u.jsxs)("div",{className:m()("w-full h-full",{[lz.Z["test-form-content-absolute"]]:b}),children:[(0,u.jsx)(lb,{node:r,onMounted:e=>l.current=e}),T?(0,u.jsx)(lF,{result:_,extra:I}):null]}),b?(0,u.jsx)(lO,{}):null]}),(0,u.jsx)(lG,{onClick:()=>D()}),(0,u.jsx)(eb.UI,{}),(0,u.jsx)(lk,{}),(0,u.jsx)(lS,{})]})})},lU=e=>(0,u.jsx)(nU,{layout:"vertical",children:(0,u.jsx)(oW,{children:(0,u.jsx)(eb.ux,{children:(0,u.jsx)(lW,(0,z._)({},e))})})}),lH=n("688887"),lJ=()=>{var e=(0,nF.X)(),{open:t}=(0,C.XD)(),n=(0,p.useCallback)(()=>{},[t]),o=(0,p.useCallback)(()=>{e.close("right")},[e]);return(0,u.jsxs)("div",{className:lH.Z["test-form-sheet-header-v2"],children:[(0,u.jsx)("div",{className:lH.Z["header-title-v2"],children:y.o.t("workflow_detail_title_testrun")}),(0,u.jsxs)("div",{className:"flex gap-x-1 items-center",children:[(0,u.jsx)(er,{hiddenStateText:!0,onClick:n,extra:!1}),(0,u.jsx)(k.hU,{icon:(0,u.jsx)(P.rmE,{className:"text-[18px]"}),color:"secondary",onClick:o})]})]})},lq=n("335759"),lK=n("58197"),lX=n("828440"),lY=()=>(0,p.useCallback)(()=>(0,u.jsx)(k.Od,{style:{width:"100%",height:"100%"},placeholder:(0,u.jsxs)("div",{className:lX.Z["skeleton-container"],children:[(0,u.jsxs)("div",{className:lX.Z["skeleton-item"],children:[(0,u.jsx)(k.Od.Avatar,{className:lX.Z["skeleton-avatar"]}),(0,u.jsxs)("div",{className:lX.Z["skeleton-column"],children:[(0,u.jsx)(k.Od.Title,{className:lX.Z["skeleton-name"]}),(0,u.jsx)(k.Od.Image,{className:lX.Z["skeleton-content"]})]})]}),(0,u.jsxs)("div",{className:lX.Z["skeleton-item"],children:[(0,u.jsx)(k.Od.Avatar,{className:lX.Z["skeleton-avatar"]}),(0,u.jsx)(k.Od.Image,{className:lX.Z["skeleton-content-mini"]})]}),(0,u.jsxs)("div",{className:lX.Z["skeleton-item"],children:[(0,u.jsx)(k.Od.Avatar,{className:lX.Z["skeleton-avatar"]}),(0,u.jsxs)("div",{className:lX.Z["skeleton-column"],children:[(0,u.jsx)(k.Od.Title,{className:lX.Z["skeleton-name"]}),(0,u.jsx)(k.Od.Image,{className:lX.Z["skeleton-content"]})]})]})]}),active:!0,loading:!0}),[]),lQ=(0,p.lazy)((0,s._)(function*(){var{BuilderChat:e}=yield n.e("7992").then(n.bind(n,967146));return{default:e}})),l$=e=>{var{workflowInfo:t={},projectOrBotInfo:n,activateChat:o,type:r,showInputArea:l=!1,onGetChatFlowExecuteId:a,defaultText:i="",topSlot:s}=e,d=eN.Z.getUserInfo(),c=lY(),v={id:(null==d?void 0:d.user_id_str)||"",nickname:(null==d?void 0:d.name)||"",url:(null==d?void 0:d.avatar_url)||""};if(!(null==n?void 0:n.id)||!(null==o?void 0:o.conversation_name)||(null==o?void 0:o.conversation_id)==="0"&&(0,A.Z)(t))return(0,A.Z)(t)?(0,u.jsx)(k.ub,{size:"full_screen",icon:(0,u.jsx)(lK.YC,{}),title:y.o.t("wf_chatflow_61"),description:y.o.t("wf_chatflow_62")}):null;var f=r===ev.Af.Draft?(null==o?void 0:o.conversation_name)||"":(null==o?void 0:o.release_conversation_name)||(null==o?void 0:o.conversation_name)||"",m={id:null==n?void 0:n.id,conversationName:f,defaultName:(null==o?void 0:o.conversation_name)||(null==n?void 0:n.name),defaultIconUrl:null==n?void 0:n.iconUrl,connectorId:r===ev.Af.Draft?"10000010":"1024",type:(null==n?void 0:n.type)===oO.jH.Project?"app":"bot",mode:r===ev.Af.Draft?"draft":"release",conversationId:null==o?void 0:o.conversation_id,caller:r===ev.Af.Draft?"CANVAS":void 0};return(0,u.jsx)(p.Suspense,{fallback:null,children:(0,u.jsx)(lQ,{workflow:t,project:m,eventCallbacks:{onGetChatFlowExecuteId:a},areaUi:{isNeedClearContext:!1,isNeedClearMessage:!0,input:{isShow:l,defaultText:i,renderChatInputTopSlot:s,isNeedAudio:!1},renderLoading:c,uiTheme:"chatFlow"},userInfo:v,auth:{type:"internal"}})})},l0=n("716894"),l1=n("992499"),l2=()=>(0,l0.F)((e,t)=>({visible:!1,hasForm:!1,formData:null,patch:t=>e(()=>t),getFormData:()=>t().formData}),l1.X),l4=(0,p.createContext)({}),l5=e=>(0,p.useContext)(l4)(e),l6=e=>{var{children:t}=e,n=(0,p.useMemo)(()=>l2(),[]);return(0,u.jsx)(l4.Provider,{value:n,children:t})},l3=n("75097"),l8=e=>{var{isChatError:t}=e,{hasForm:n,patch:o}=l5(e=>({hasForm:e.hasForm,patch:e.patch}));return n?(0,u.jsx)("div",{className:l3.Z["float-button-container"],children:(0,u.jsxs)("div",{className:l3.Z["float-button"],onClick:()=>{o({visible:!0})},style:!0===t?{position:"absolute",left:69,bottom:123}:{},children:[(0,u.jsx)(k.ZT.Text,{className:"coz-fg-primary",children:y.o.t("wf_chatflow_71")}),(0,u.jsx)(P.CW,{className:"coz-fg-dim"})]})}):null},l9=e=>{var{value:t}=e,n=(0,d._)(e,["value"]);return(0,u.jsx)(r1,(0,z._)({field:ri.Lp.Chat},n))},l7=n("253949"),ae=e=>{var t,n,{node:o}=e,r=(0,p.useRef)(null),l=(0,C.j1)(),{patch:a,formData:i}=l5(e=>({patch:e.patch,formData:e.formData})),d=eN.Z.useUserInfo(),{getNode:c}=(0,ek.J)(),v=(0,C.IW)(),{validate:f}=(0,oh.Q)(),m=(0,C.X6)(),h=(0,p.useRef)(null),g=(0,lI.n)();var x=(t=(0,s._)(function*(){if(yield f()){m.open("problemPanel","bottom");return}if(!!r.current){var{empty:e,validate:t,values:n}=yield r.current.submit();if(!t){k.FN.error(y.o.t("workflow_testrun_form_vailate_error_toast"));return}if(!e&&(v.formRunUIMode({form_ui_mode:r.current.getUIMode()}),null==n?void 0:n[oZ.NC.TestsetSave])){var i,s,d=null==n?void 0:n[ri.Lp.Bot],u=null==n?void 0:null===(s=n[ri.Lp.Node])||void 0===s?void 0:s[ri.Lp.Input],c=yield rc({values:u,bot:d,schema:r.current.originSchema,bizCtx:g,node:o,workflowId:l.workflowId});if(null==c?void 0:c.checkError)return}a({formData:n}),null===(i=h.current)||void 0===i||i.close()}}),function(){return t.apply(this,arguments)});return(0,u.jsx)(eb.oR,{spaceId:l.spaceId,workflowId:l.workflowId,userId:null==d?void 0:d.user_id_str,nodeId:null===(n=c())||void 0===n?void 0:n.id,projectId:l.projectId,formRenders:{[eb.QD.CHAT]:l9,[eb.QD.BOT]:lL,[eb.QD.LIST]:lN.Y,[eb.QD.OBJECT]:lN.Y},children:(0,u.jsxs)(eb.ee,{animation:"translateY",header:(0,u.jsx)("div",{className:l7.Z["test-form-header"],children:(0,u.jsx)(k.ZT.Text,{strong:!0,fontSize:"16px",children:y.o.t("wf_chatflow_71")})}),headerExtra:(0,u.jsx)(oz.oK,{scene:oz.Qv.Token}),className:l7.Z["resizable-panel"],footer:(0,u.jsx)(k.zx,{color:"green",className:"w-full",icon:(0,u.jsx)(P.NvC,{}),onClick:()=>{x()},children:y.o.t("wf_chatflow_75")}),ref:h,hideClose:!i,onClose:()=>{a({visible:!1})},children:[(0,u.jsx)(lb,{node:o,onMounted:e=>r.current=e}),(0,u.jsx)(eb.UI,{isChatFlow:!0,onParentClose:()=>{h.current.close()}})]})})},at=n("503624"),an=()=>{var{projectId:e}=(0,C.j1)(),{sessionInfo:t}=oA(),[n,o]=(0,p.useState)(),r=(0,p.useMemo)(()=>e?e:(null==t?void 0:t.type)===oO.jH.Project?t.value:null,[e,t]);return r?(0,u.jsxs)("div",{className:at.Z["conversation-select"],children:[(0,u.jsx)(k.ZT.Text,{fontSize:"14px",children:y.o.t("wf_chatflow_74")}),(0,u.jsx)(r$,{projectId:r,value:n,onChange:o})]}):null},ao=n("50295"),ar=e=>{var t,n,{formData:o}=l5(e=>({formData:e.formData})),{projectInfo:r}=e,l=(0,d._)(e,["projectInfo"]),{config:a}=(0,C.j1)(),{getNode:i}=(0,ek.J)(),{getStartNodeOutputs:s}=(0,ek.L)(),c=i(),v="";if(c){;v=(null===(n=s().find(e=>e.name===_.pju))||void 0===n?void 0:n.defaultValue)||""}var p=(0,C.xv)(),{sessionInfo:f,conversationInfo:m}=oA(),h=null==o?void 0:null===(t=o[ri.Lp.Node])||void 0===t?void 0:t[ri.Lp.Input],g=f?{id:f.value,name:f.name,iconUrl:f.avatar,type:f.type}:{id:(null==r?void 0:r.id)||"",name:(null==r?void 0:r.name)||"",iconUrl:(null==r?void 0:r.icon_url)||"",type:oO.jH.Project};return(0,u.jsx)(l$,(0,z._)({type:ev.Af.Draft,projectOrBotInfo:g,workflowInfo:{id:a.workflowId,parameters:h,header:{"rpc-persist-mock-traffic-enable":"1"}},activateChat:{unique_id:null==m?void 0:m.value,conversation_name:(null==g?void 0:g.type)===oO.jH.Bot?null==g?void 0:g.name:null==m?void 0:m.label,conversation_id:null==m?void 0:m.conversationId},onGetChatFlowExecuteId:e=>{if(p.globalState.viewStatus!==n0.tn.EXECUTING)p.clearTestRun(),p.getRTProcessResult({executeId:e})},topSlot:e=>(0,u.jsx)(l8,{isChatError:e}),defaultText:v},l))},al=e=>{var{node:t}=e,{visible:n,patch:o}=l5(e=>({visible:e.visible,patch:e.patch})),{generate:r}=(0,lq.D)(),l=(0,eh.Z)((0,s._)(function*(){var e=yield r();(null==e?void 0:e.fields.length)&&o({visible:!0,hasForm:!0})}));return(0,p.useEffect)(()=>{l()},[]),n?(0,u.jsx)(ae,{node:t}):null},aa=e=>{var t,{node:n}=e,{getProjectApi:o}=(0,C.j1)(),r=null===(t=o())||void 0===t?void 0:t.ideGlobalStore(e=>{var t;return null===(t=e.projectInfo)||void 0===t?void 0:t.projectInfo});return(0,u.jsx)(nU,{layout:"vertical",children:(0,u.jsx)(l6,{children:(0,u.jsx)(oW,{children:(0,u.jsxs)(eb.ux,{className:ao.Z["test-form"],children:[(0,u.jsx)(lJ,{}),(0,u.jsx)(an,{}),(0,u.jsx)(ar,{projectInfo:r,showInputArea:!0}),(0,u.jsx)(al,{node:n})]})})})})},ai=n("340291"),as=n("220192"),ad=n("10827"),au=e=>{var t=(0,C.zz)(),n=t.getNodeExecResult(e.id),{config:{testNodeFormVisible:o}}=(0,C.IE)();return!!(null==n?void 0:n.nodeStatus)&&[J.nBi.Success,J.nBi.Fail].includes(n.nodeStatus)&&t.config.isSingleMode&&!o},ac=e=>{var{node:t}=e,n=(0,C.IE)(),o=(0,C.zz)(),[r,l]=(0,p.useState)(!1);return(0,p.useEffect)(()=>{setTimeout(()=>l(!0))},[]),(0,u.jsx)("div",{className:m()(ad.Z["test-node-result-notice"],{[ad.Z["transition-show"]]:r}),onClick:()=>{n.showTestNodeForm()},children:(0,u.jsxs)("div",{className:ad.Z["result-notice-bg"],children:[(0,u.jsx)(k.ZT.Text,{className:"coz-fg-hglt",size:"small",children:y.o.t("workflow_running_results_banner")}),(0,u.jsx)(k.hU,{icon:(0,u.jsx)(P.rmE,{}),color:"secondary",onClick:e=>{e.stopPropagation(),o.clearNodeResult()}})]})})},av=e=>{var t,n,{node:o,onClose:r}=e,l=(0,p.useRef)(null),a=(0,as.c2)(),i=(0,C.zz)(),d=(0,g.G2)(eV.GH),c=(0,p.useRef)(null),v=i.getNodeExecResult(o.id),{sessionInfo:f,conversationInfo:h}=oA(),{running:x}=(0,lT.v)(o.id),{logNodeRef:w,logView:j}=lZ(),b=!!(null==v?void 0:v.nodeStatus)&&i.config.isSingleMode&&[J.nBi.Success,J.nBi.Fail].includes(v.nodeStatus);var N=(t=(0,s._)(function*(){var e,t,n,r,i,s,u,v,p,m,g,{hasError:x}=yield a.validateNode(o);if(x){k.FN.error({content:y.o.t("workflow_detail_toast_validation_failed"),showClose:!1}),null===(t=c.current)||void 0===t||t.minimize();return}if(!!l.current){null===(e=c.current)||void 0===e||e.maximize();var{empty:w,validate:j,values:b}=yield l.current.submit();if(!j){k.FN.error(y.o.t("workflow_testrun_form_vailate_error_toast"));return}if(!w){;n=(0,oU._)(null==b?void 0:null===(v=b[ri.Lp.Node])||void 0===v?void 0:v[ri.Lp.Input],["role_information"]),i=(0,oU._)(null==b?void 0:null===(p=b[ri.Lp.Node])||void 0===p?void 0:p[ri.Lp.Batch]),r=(0,oU._)(null==b?void 0:null===(m=b[ri.Lp.Node])||void 0===m?void 0:m[ri.Lp.Setting]),u=(null==(s=null==b?void 0:b[oZ.NC.Related])?void 0:null===(g=s[ri.Lp.Bot])||void 0===g?void 0:g.id)||(null==s?void 0:s[ri.Lp.Bot]),(null==s?void 0:s[oZ.NC.Conversation])&&(null==h?void 0:h.label)&&(n=(0,O._)((0,z._)({},n),{[_.d9h]:null==h?void 0:h.label}))}yield d.testRunOneNode({input:n,batch:i,setting:r,botId:u,nodeId:o.id,useProject:(null==f?void 0:f.type)===oO.jH.Project})}}),function(){return t.apply(this,arguments)});var S=(n=(0,s._)(function*(){d.clearTestRun(),yield N()}),function(){return n.apply(this,arguments)}),{open:I}=(0,C.XD)(),T=(0,p.useCallback)(()=>{},[I]);return(0,u.jsxs)(eb.ee,{animation:"translateY",className:m()("test-node-form-panel",ad.Z["test-node-form-panel"]),ref:c,innerScrollRef:w,header:(0,u.jsxs)("div",{className:"w-full flex items-center justify-between mr-[4px]",children:[(0,u.jsx)("span",{className:"font-medium",children:y.o.t("workflow_detail_title_testrun")}),!x&&(0,u.jsx)(er,{onClick:T,hiddenStateText:!0,extra:!1})]}),headerExtra:(0,u.jsx)(oz.oK,{scene:oz.Qv.Token}),footer:(0,u.jsx)(lB,{node:o,onClick:()=>S()}),onClose:r,children:[(0,u.jsxs)("div",{className:ad.Z["test-node-form-content"],children:[(0,u.jsxs)("div",{className:m()("w-full h-full",{[ad.Z["test-form-content-absolute"]]:x}),children:[(0,u.jsx)(lb,{node:o,onMounted:e=>l.current=e}),b?(0,u.jsx)(lF,{result:v,node:o,extra:j}):null]}),x?(0,u.jsx)(lO,{}):null]}),(0,u.jsx)(lk,{}),(0,u.jsx)(lS,{})]})},ap=e=>{var{node:t}=e,n=(0,C.IE)(),o=(0,g.G2)(eV.GH),{config:{testNodeFormVisible:r}}=n,l=(0,p.useCallback)(()=>{n.closeTestNodeForm(),(o.testRunState===oD.x.Executing||o.testRunState===oD.x.Paused)&&o.cancelTestRun()},[n,o]);return r?(0,u.jsx)(av,{node:t,onClose:l}):null},af=n("612286"),am=n("93027"),ah=n("370980"),ag=e=>{var{children:t}=e,[n,o]=(0,p.useState)(null);return(0,u.jsx)(ai.U0.Provider,{value:{fullscreenPanel:n,setFullscreenPanel:o},children:t})},ax=e=>{var{width:t,children:n,className:o}=e;return(0,u.jsx)("div",{className:m()(o,"h-full flex-none overflow-auto"),style:{width:t},children:n})},a_=e=>{var t,{node:n,showTestNodeForm:o}=e,r=(0,C.IE)(),l=(0,C.X6)(),a=au(n),{config:{testNodeFormVisible:i}}=r,{width:s}=(0,C.EK)(),{fullscreenPanel:d}=(0,ai.Tk)(),{width:c}=oB(),v=(0,p.useMemo)(()=>s-c-16,[s,c]);if((0,p.useEffect)(()=>{o?r.showTestNodeForm():r.closeTestNodeForm()},[o,n]),(0,p.useEffect)(()=>{var e=n.onDispose(()=>{l.close()});return()=>e.dispose()},[n,l]),!n||n.getNodeMeta().disableSideSheet)return null;var{formModel:f}=n.getData(g.Ps),{initialized:h}=f;return h?(0,u.jsx)(nU,{layout:"vertical",children:(0,u.jsx)(af.g,{node:n,scene:"node-side-sheet",children:(0,u.jsx)(am.WQ,{children:(0,u.jsx)(oW,{bypass:!!d,children:(0,u.jsxs)("div",{className:m()(ah.Z["node-side-sheet"],"rounded-lg coz-bg-plus flex h-full overflow-hidden"),children:[d?(0,u.jsx)(ax,{className:"coz-stroke-primary border-0 border-r border-solid !flex-1",width:v,children:d}):null,(0,u.jsx)(oW,{className:"relative h-full flex-none",bypass:!d,children:(0,u.jsxs)(ax,{width:c,children:[(0,u.jsx)("div",{className:m()("px-3 pb-4",ah.Z["node-side-sheet-form"],{[ah.Z["has-result-notice"]]:a||i}),"data-testid":(0,_.agJ)(n,"node-side-sheet-form"),children:(0,u.jsx)(g.o,{node:n})}),(0,u.jsx)(ap,{node:n}),a?(0,u.jsx)(ac,{node:n}):null]})})]})})})},null==n?void 0:null===(t=n.id)||void 0===t?void 0:t.toString())}):null},ay=e=>(0,u.jsx)(ag,{children:(0,u.jsx)(a_,(0,z._)({},e))}),aw=()=>{var e=(0,g.G2)(g.oJ),t=(0,C.X6)(),n=(0,g.G2)(oD.G);(0,p.useEffect)(()=>{var o=e.onSelectionChanged(()=>{var o=[oD.x.Executing,oD.x.Paused].includes(n.testRunState);!e.activatedNode&&t.right.key===T.Gd.NodeForm&&!o&&t.close()});return()=>o.dispose()},[e,t,n])},aj=()=>{var e=(0,C.X6)(),t=(0,g.G2)(oD.G),n=(0,eh.Z)(e=>{var{key:n}=e;[oD.x.Executing,oD.x.Paused].includes(t.testRunState)&&[T.Gd.NodeForm,T.Gd.TestFlowForm,T.Gd.TestChatFlowForm].includes(n)&&t.cancelTestRun()});(0,p.useEffect)(()=>{var t=e.onUnmount(n);return()=>t.dispose()},[e,n])},ab=e=>{var{components:t,children:n}=e,o=(0,p.useMemo)(()=>(0,O._)((0,z._)({},t),{[T.Gd.NodeForm]:e=>(0,u.jsx)(ay,(0,z._)({},e)),[T.Gd.TestFlowForm]:e=>(0,u.jsx)(lU,(0,z._)({},e)),[T.Gd.TraceList]:e=>(0,u.jsx)(oP,(0,z._)({},e)),[T.Gd.TestChatFlowForm]:e=>(0,u.jsx)(aa,(0,z._)({},e)),[T.Gd.RoleConfig]:()=>(0,u.jsx)(nq,{}),traceDetail:e=>(0,u.jsx)(oL,(0,z._)({},e))}),[t]);return aj(),aw(),(0,u.jsx)(nG,{components:o,children:n})},aN=n("15021"),ak=n("234146"),aC=(0,p.forwardRef)((e,t)=>{var n,o,r,l,a,i=(0,C.j1)(),f=(0,g.G2)(eV.PR),k=(0,C.Zp)(),S=(0,C.X6)(),E=(0,C.xv)(),{handleTestRun:P,cancelTestRun:L}=(0,ee.Q)({callbacks:e}),{resetToCommitById:z}=(0,M.L)(),{closeSideSheetAndHideResult:O,showResult:A}=n9(),{loading:F,loadingError:R,readonly:V,isBindDouyin:B}=i,G=(0,p.useRef)(null),W=(0,p.useRef)(!1),U=function(){var[e,t]=(0,p.useState)(!1),n=(0,g.G2)(g.mQ);return(0,p.useLayoutEffect)(()=>{var e=n.onLogger(e=>{var{event:n}=e;n===g.Lp.CANVAS_TTI&&t(!0)});return()=>{null==e||e.dispose()}},[]),e}();(0,p.useMemo)(()=>{var{spaceList:t}=e,n=(0,d._)(e,["spaceList"]);i.updateConfig({playgroundProps:n,spaceList:t})},[e]),(0,p.useEffect)(()=>{if(!F&&!R&&U){var t;null===(t=e.onInit)||void 0===t||t.call(e,i)}},[F,U,R,i]),n=i,o=(0,g.G2)(aN.P),r=(0,g.G2)(g.mQ),(0,p.useEffect)(()=>{var e=r.onLogger(e=>{var{event:t}=e;if(t===g.Lp.CANVAS_TTI){var r,{inPluginUpdated:l}=n||{},a=function(e){if(!e)return!1;var t,n,o=JSON.parse(e||""),r=null==o?void 0:null===(t=o.nodes)||void 0===t?void 0:t.find(e=>e.type===_.nyy.Start),l=((null==r?void 0:null===(n=r.data)||void 0===n?void 0:n.outputs)||[]).find(e=>(0,_.QJG)(e.name));return!!(null==l?void 0:l.required)}(null==n?void 0:null===(r=n.info)||void 0===r?void 0:r.schema_json);(l||a)&&(_.E7u.event({eventName:"workflow_data_compensation_save"}),o.highPrioritySave())}});return()=>{null==e||e.dispose()}},[]);var H=(0,p.useCallback)(e=>{e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move")},[]),J=(0,g.G2)(eV.qq),[,q]=(0,v.L)(()=>({accept:T.iB,canDrop:(e,t)=>{var n;return J.canDrop({coord:null!==(n=t.getSourceClientOffset())&&void 0!==n?n:{x:0,y:0},dragNode:{type:e.nodeType,json:e.nodeJson}})},drop:(e,t)=>{var n,o,r,l=null!==(r=t.getClientOffset())&&void 0!==r?r:{x:0,y:0};null===(o=G.current)||void 0===o||null===(n=o.handleAddNode)||void 0===n||n.call(o,e,l,!0)}})),K=(0,C.tF)();if((0,p.useImperativeHandle)(t,()=>{var t;return{triggerTestRun:(0,s._)(function*(){return yield P(),!0}),getProcess:(t=(0,s._)(function*(e){yield E.getRTProcessResult(e)}),function(e){return t.apply(this,arguments)}),reload:(0,s._)(function*(){var t;S.closeAll(),yield f.reloadDocument(),null===(t=e.onInit)||void 0===t||t.call(e,i)}),cancelTestRun:()=>L(),showTestRunResult:(e,t)=>{e?"string"==typeof e?A({executeId:e,subExecuteId:t}):A({processResp:e}):A()},hideTestRunResult:()=>{O()},resetToHistory:e=>{var{commitId:t,optType:n}=e;z(t,n)},scrollToNode:e=>{e&&K(e)},triggerFitView:(0,s._)(function*(){!W.current&&(yield f.fitView(),W.current=!0)}),loadGlobalVariables:(0,s._)(function*(){yield f.loadGlobalVariables()}),onResourceChange:(e,t)=>k.updateDependencySources(e,t)}}),F)a=(0,u.jsx)(w.yC,{spinning:!0,style:{height:"100%",width:"100%"}});else if(R)throw new b.sH("normal_error",R);else{var X=e.sidebar,Y=!B;a=(0,u.jsxs)(h.aH,{client:_.fB_,children:[(0,u.jsxs)("div",{className:"flex flex-1 h-full",children:[(0,u.jsxs)("div",{className:"flex flex-1 flex-col",children:[e.renderHeader?e.renderHeader({handleTestRun:P}):(0,u.jsx)(eF,{}),(0,u.jsx)(om,{}),!i.projectId&&(0,u.jsx)(oy,{}),(0,u.jsxs)("div",{className:"".concat(ak.Z.workflowContent," clean-code"),children:[!V&&X?(0,u.jsx)(X,{ref:G}):null,(0,u.jsx)(N.f,{ref:G,readonly:V,children:(0,u.jsx)("div",{id:T.I7,className:ak.Z.workflowPlayground,children:(0,u.jsxs)("div",{ref:q,className:ak.Z.workflowPlaygroundRender,onDragOver:H,children:[(0,u.jsx)(g.iX,{}),(0,u.jsx)(ob,{}),(0,u.jsxs)(ab,{components:{problemPanel:()=>(0,u.jsx)(ox,{}),templatePanel:()=>Y?(0,u.jsx)(od,{}):null},children:[(0,u.jsx)(n3,{disableTraceAndTestRun:null==e?void 0:e.disableTraceAndTestRun}),Y?(0,u.jsx)(or,{}):null,(0,j.L)()["bot.automation.encapsulate"]?(0,u.jsx)(x.BV,{}):null]}),(0,u.jsx)(I,{})]})})}),(0,u.jsx)(Z.AL,{})]})]}),(0,u.jsx)(D,{})]}),(0,u.jsx)(oE,{})]})}return(0,u.jsxs)(u.Fragment,{children:[!i.projectId&&(0,u.jsx)(c.q,{children:(0,u.jsx)("title",{children:y.o.t("workflow_tab_title",{name:null===(l=i.info)||void 0===l?void 0:l.name})})}),(0,u.jsxs)("div",{className:m()({[ak.Z.workflowContainer]:!0,[ak.Z.workflowContainerOp]:!1,[e.className||""]:e.className}),style:e.style,children:[a,(0,u.jsx)(oN.F,{})]})]})})},519027:function(e,t,n){n.d(t,{m:()=>c,o:()=>g});var o=n("808549"),r=n("473980"),l=n("151064"),a=n("455069"),i=n("336205"),s=n("674343"),d=n("903715"),u=e=>{var{title:t,description:n,mainButtonText:o,onOpenTestRun:r,onForcePush:a,onCancel:u}=e;return(0,l.jsxs)("div",{className:d.Z["popover-content"],children:[(0,l.jsx)(s.ZT.Text,{strong:!0,children:t}),(0,l.jsx)("br",{}),(0,l.jsx)(s.ZT.Text,{type:"secondary",size:"small",children:n}),(0,l.jsxs)("div",{className:d.Z["popover-btns"],children:[(0,l.jsx)(s.zx,{size:"small",color:"hgltplus",onClick:r,children:i.o.t("workflow_detail_title_testrun")}),(0,l.jsx)(s.zx,{size:"small",color:"primary",onClick:a,children:o}),(0,l.jsx)(s.zx,{size:"small",color:"primary",onClick:u,children:i.o.t("workflow_list_create_modal_footer_cancel")})]})]})},c=e=>{var{visible:t,children:n}=e,a=(0,r._)(e,["visible","children"]);return(0,l.jsx)(s.J2,{visible:t,trigger:"custom",position:"bottomRight",content:(0,l.jsx)(u,(0,o._)({},a)),children:n})},v=n("825955"),p=n("408487"),f=n("586421"),m=n("184449"),h=n("398038"),g=()=>{var e,[t,n]=(0,a.useState)(!1),o=(0,m.IW)(),{isCollaboratorMode:r,info:l,inPluginUpdated:i}=(0,m.j1)(),{validate:s}=(0,f.Q)(),{testRunFlow:d}=(0,h.W)(),u=(0,m.X6)(),{status:c,vcsData:g}=l,{type:x}=g||{},_=(0,a.useMemo)(()=>{var e;if(i)return!0;if(!r)return l.status!==p.x5o.CanPublish&&l.status!==p.x5o.HadPublished;return(null===(e=l.vcsData)||void 0===e?void 0:e.type)===p.MZY.Draft&&l.status!==p.Xpx.CanSubmit&&l.status!==p.Xpx.HadSubmit},[r,c,x,i]);var y=(e=(0,v._)(function*(){return(yield s())?(u.open("problemPanel","bottom"),!1):!_||(n(!0),!1)}),function(){return e.apply(this,arguments)});return{visible:t,tryPushCheck:y,onCancel:()=>n(!1),onTestRun:()=>{n(!1),o.tryStart({scene:"publish"}),d()}}}},83195:function(e,t,n){n.d(t,{L:function(){return f}});var o=n(825955),r=n(408487),l=n(297158),a=n(336205),i=n(674343),s=n(707107),d=n(686436),u=n(157728),c=n(994983),v=n(184449),p=()=>new Promise(e=>{i.u_.warning({title:a.o.t("workflow_publish_multibranch_revert_confirm_title"),content:a.o.t("workflow_publish_multibranch_revert_confirm_content"),okText:a.o.t("confirm"),cancelText:a.o.t("cancel"),onOk:()=>e(!0),onCancel:()=>e(!1)})});function f(){var e,t,n,f,m=(0,u.useNavigate)(),h=(0,v.j1)(),g=(0,d.G2)(c.PR),x=(0,d.G2)(c.GH);var _=(e=(0,o._)(function*(){yield g.reloadDocument({})}),function(){return e.apply(this,arguments)});var y=(t=(0,o._)(function*(e){var t;if(!!(yield p())){(0,s.Gg)(s.Kg.workflow_submit_version_revert,{workflow_id:h.workflowId,workspace_id:h.spaceId,version_id:e.submit_commit_id||e.commit_id||""});try{yield r.OHc.RevertDraft({workflow_id:h.workflowId,space_id:h.spaceId,commit_id:e.submit_commit_id||e.commit_id||"",type:null!==(t=e.submit_commit_id?r.lcl.SubmitOperate:e.type)&&void 0!==t?t:r.lcl.SubmitOperate,env:e.submit_commit_id?"":e.env}),l.E7.successEvent({eventName:"workflow_revert_success",namespace:"workflow"}),i.FN.success({content:a.o.t("workflow_publish_multibranch_revert_success"),showClose:!1})}catch(e){l.E7.errorEvent({eventName:"workflow_revert_fail",namespace:"workflow",error:e})}return yield _(),!0}}),function(e){return t.apply(this,arguments)});var w=(n=(0,o._)(function*(e,t){var n,o,l=yield r.OHc.VersionHistoryList({workflow_id:h.workflowId,space_id:h.spaceId,type:null!=t?t:r.lcl.SubmitOperate,commit_ids:[e],limit:1}),a=null==l?void 0:null===(o=l.data)||void 0===o?void 0:null===(n=o.version_list)||void 0===n?void 0:n[0];if(!!a)yield y(a)}),function(e,t){return n.apply(this,arguments)});var j=(f=(0,o._)(function*(e){if(!!e.commit_id&&!!e.type)(0,s.Gg)(s.Kg.workflow_submit_version_view,{workflow_id:h.workflowId,workspace_id:h.spaceId,version_id:e.commit_id}),e.submit_commit_id?yield g.reloadDocument({commitId:e.submit_commit_id,type:r.lcl.SubmitOperate}):yield g.reloadDocument({commitId:e.commit_id,type:e.type,env:e.env}),x.clearTestRun()}),function(e){return f.apply(this,arguments)});return{resetToCommit:y,viewCommit:j,publishPPE:e=>{m("/space/".concat(e.space_id,"/workflow/").concat(e.workflow_id,"/publish?commit_id=").concat(e.commit_id,"&type=").concat(e.type),{replace:!0})},showCurrent:_,resetToCommitById:w,viewCommitNewPage:e=>{var t=new URLSearchParams;t.append("space_id",e.space_id||""),t.append("workflow_id",e.workflow_id||""),e.submit_commit_id?t.append("version",e.submit_commit_id||""):(e.type&&t.append("opt_type",e.type.toString()),t.append("version",e.commit_id||""));var n="/work_flow?".concat(t.toString());window.open(n,"_blank")}}}},960238:function(e,t,n){n.d(t,{GR:()=>I,cw:()=>y});var o=n("151064"),r=n("455069");n("569502");var l=n("408487");n("297158");var a=n("336205");n("707107");var i=n("775699");n("593554"),n("630553");var s=n("184449");n("519027"),n("44172"),n("614904");var d=n("674343");n("83195"),l.lcl.SubmitPublishPPEOperate,a.o.t("query_status_all"),l.lcl.SubmitOperate,a.o.t("workflow_publish_multibranch_submitted_title"),l.lcl.PubPPEOperate,a.o.t("bmv_ppe_lane"),l.lcl.PublishOperate,a.o.t("workflow_publish_multibranch_published_title");var{Title:u}=d.ZT,c=n("825955"),v=n("664319"),p=n("450562"),f=n("474872"),m=n("298203"),h=n("214942"),g=n("62088"),x=n("325723"),_=n("143263"),y=e=>{var t,{mode:n}=e,{isFromExplore:l,isSceneFlow:u,spaceId:y,viewStatus:w,isViewHistory:j,isBindDouyin:b,readonly:N}=(0,s.j1)(),k=(0,s.HX)(),C=w===p.tnn.EXECUTING,S=!(u&&N)&&w!==p.tnn.EXECUTING&&!j&&!b,[I,T]=(0,r.useState)(!1),[E,D]=(0,r.useState)(!1),{spaceList:Z}=(0,h.rY)((0,v.N)(e=>({spaceList:e.spaces.bot_space_list})));var M=(t=(0,c._)(function*(e){T(!0);var t=yield k.copy();return(null==t?void 0:t.workflow_id)?(d.FN.success({content:a.o.t("workflow_detail_toast_createcopy_succeed"),showClose:!1}),T(!1),(0,_.i)({space_id:e||"",workflow_id:t.workflow_id})):d.FN.error(a.o.t("workflow_detail_toast_createcopy_failed"))}),function(e){return t.apply(this,arguments)}),P=e=>{(0,m.xg)(()=>M(e))},L=(0,r.useCallback)(()=>{Z.length>1&&l?D(!0):P(y)},[Z,l,y]);return S?(0,o.jsxs)(o.Fragment,{children:["button"===n?(0,o.jsx)(i.y3,{disabled:C,theme:"solid",type:"primary",loading:I,onClick:L,children:a.o.t("workflow_detail_title_copy")}):null,"icon"===n?(0,o.jsx)(d.u,{content:a.o.t("workflow_detail_title_copy"),position:"bottom",children:(0,o.jsx)(i.y3,{className:x.Z["icon-copy"],disabled:C,loading:I,onClick:L,icon:(0,o.jsx)(g.Z,{}),"data-testid":"workflow.detail.title.duplicate"})}):null,E?(0,o.jsx)(f.g7,{visible:!0,onCancel:()=>{D(!1)},onConfirm:e=>{P(e),D(!1)}}):null]}):null};n("724847"),n("86246"),n("686436");var w=n("962622");n("994983"),n("771879"),n("954206");var j=n("808549"),b=n("120454"),N=n("915757"),k=n("189400"),C=n("155440"),S=e=>{var{info:t,spaceId:n,projectId:o}=e;if(!!n&&!!(t.id&&!(0,C.Z)(t.type))){if(t.from===w.C6.APP&&o)switch(t.type){case w.Jq.PLUGIN:window.open("/space/".concat(n,"/project-ide/").concat(o,"/plugin/").concat(t.id));break;case w.Jq.WORKFLOW:case w.Jq.CHAT_FLOW:window.open("/space/".concat(n,"/project-ide/").concat(o,"/workflow/").concat(t.id));break;case w.Jq.KNOWLEDGE:window.open("/space/".concat(n,"/project-ide/").concat(o,"/knowledge/").concat(t.id));break;case w.Jq.DATABASE:window.open("/space/".concat(n,"/project-ide/").concat(o,"/database/").concat(t.id));break;default:return}if(t.from===w.C6.LIBRARY)switch(t.type){case w.Jq.PLUGIN:window.open("/space/".concat(n,"/plugin/").concat(t.id));break;case w.Jq.WORKFLOW:case w.Jq.CHAT_FLOW:window.open("/work_flow?space_id=".concat(n,"&workflow_id=").concat(t.id));break;case w.Jq.KNOWLEDGE:window.open("/space/".concat(n,"/knowledge/").concat(t.id));break;case w.Jq.DATABASE:window.open("/space/".concat(n,"/database/").concat(t.id));break;default:return}t.type===w.Jq.PLUGIN&&t.from===w.C6.SHOP&&window.open("/store/plugin/".concat(t.id))}},I=e=>{var{extraInfo:t,spaceId:n,projectId:r}=e,l=t.type===w.Jq.PLUGIN&&t.from===w.C6.SHOP,{isLoading:i,storePluginId:s}=(0,k.Pv)({pluginId:t.id,needQuery:l});return(0,o.jsx)(d.u,{content:a.o.t("reference_graph_node_open_in_new_tab"),theme:"dark",children:(0,o.jsx)(d.hU,{loading:i,size:"small",icon:(0,o.jsx)(N.taB,{}),onClick:e=>{e.stopPropagation(),S({info:(0,b._)((0,j._)({},t),{id:s}),spaceId:n,projectId:r})}})})};n("920896")},954206:function(e,t,n){n.d(t,{_:function(){return a}});var o=n(151064);n(455069);var r=n(336205),l=n(870252),a=()=>(0,o.jsxs)("div",{className:l.Z["tooltip-container"],children:[(0,o.jsx)("div",{children:r.o.t("reference_graph_modal_title_info_hover_tip")}),(0,o.jsxs)("div",{className:l.Z["canvas-container"],children:[(0,o.jsxs)("div",{className:l.Z.cards,children:[(0,o.jsx)("div",{className:l.Z.a,children:"A"}),(0,o.jsxs)("div",{className:l.Z["arrow-wrapper"],children:[(0,o.jsx)("div",{className:l.Z["arrow-line"]}),(0,o.jsx)("div",{className:l.Z["arrow-head"]})]}),(0,o.jsx)("div",{className:l.Z.b,children:"B"})]}),(0,o.jsx)("div",{className:l.Z["text-container"],children:(0,o.jsx)("div",{children:r.o.t("reference_graph_modal_title_info_hover_tip_explain")})})]})]})},866769:function(e,t,n){n.d(t,{CP:function(){return v},Gj:function(){return u},P2:function(){return f},Qo:function(){return c},_r:function(){return d},iU:function(){return p},ms:function(){return s},u4:function(){return i}});var o,r,l,a=n(336205);var i=((o={}).Add="Add",o.Modify="Modify",o.Delete="Delete",o),s={Info:{backgroundColor:"var(--semi-color-info-light-hover)",color:"var(--semi-color-info)"},Success:{backgroundColor:"var(--semi-color-success-light-hover)",color:"var(--semi-color-success)"},Danger:{backgroundColor:"var(--semi-color-danger-light-hover)",color:"var(--semi-color-danger)"},Warning:{backgroundColor:"var(--semi-color-warning-light-hover)",color:"var(--semi-color-warning)"},Tertiary:{backgroundColor:"var(--semi-color-tertiary-light-hover)",color:"var(--semi-color-tertiary-active)"}},d={Add:s.Success,Modify:s.Warning,Delete:s.Danger};var u=((r={}).Name="name_dif",r.Describe="describe_dif",r.IconUrl="icon_url_dif",r.Schema="schema_dif",r),c={name_dif:"name",describe_dif:"desc",icon_url_dif:"icon_uri",schema_dif:"schema"},v={name_dif:a.o.t("workflow_publish_multibranch_workflow_name"),describe_dif:a.o.t("workflow_publish_multibranch_workflow_describe"),icon_url_dif:a.o.t("workflow_publish_multibranch_workflow_picture"),schema_dif:a.o.t("workflow_publish_multibranch_workflow_flow")},p={icon_url_dif:a.o.t("workflow_publish_multibranch_change_picture"),schema_dif:a.o.t("workflow_publish_multibranch_modity_flow")};var f=((l={}).Submit="submit",l.Draft="draft",l)},630553:function(e,t,n){n.d(t,{_i:()=>Z,E8:()=>H,Bx:()=>q});var o=n("825955"),r=n("151064"),l=n("455069"),a=n("606947"),i=n("408487"),s=n("674343"),d=n("775699"),u=n("336205"),c=n("971183"),v=n("184449"),p=n("252237"),f=n.n(p),m=n("450562"),h=n("707107"),g=n("802398"),x=e=>{var{num:t}=e;return(0,r.jsx)("div",{className:g.Z.referenceTable,children:(0,r.jsx)(d.iA,{pagination:!1,dataSource:[{relationship:u.o.t("workflow_detail_node_workflows_referencing",{number:t}),impact:u.o.t("workflow_detail_node_workflows_referencing_invalid")}],columns:[{title:u.o.t("workflow_detail_node_workflows_referencing_relationship"),dataIndex:"relationship"},{title:u.o.t("workflow_detail_node_workflows_referencing_impact"),dataIndex:"impact"}]})})},_=e=>{var{workflowList:t}=e;return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{margin:"24px 0 16px 0",color:"var(--semi-color-text-2)"},children:u.o.t("workflow_detail_node_workflows_referencing_update")}),(0,r.jsx)(x,{num:t.length})]})},y=n("808549"),w=n("120454"),j=n("672496"),b=n("44172"),N=n("866769"),{Text:k}=d.ZT,C=e=>{if(!!e)return Object.keys(e).filter(t=>e[t].modify).map(t=>{var n=N.iU[t]||'"'.concat(e[t].before||u.o.t("workflow_publish_multibranch_default_value"),'" -> "').concat(e[t].after,'"');return{property:N.CP[t]||t,changeType:N.u4.Modify,changes:n}})},S=e=>{var{spaceId:t,workflowId:n,operateType:l}=e,{isLoading:a,data:s}=(0,j.a)({queryKey:["workflow_diff"],queryFn:(0,o._)(function*(){var{data:e}=yield i.OHc.ShowDifferences({space_id:t,workflow_id:n,type:l});return C(e)})}),c=[{title:u.o.t("workflow_publish_multibranch_property"),dataIndex:"property",width:280},{title:u.o.t("workflow_publish_multibranch_changetype"),dataIndex:"changeType",width:120,render:e=>(0,r.jsx)(d.fS,{style:(0,w._)((0,y._)({},N._r[e]),{flexShrink:0}),children:u.o.t("workflow_publish_multibranch_modify")})},{title:u.o.t("workflow_publish_multibranch_changes"),dataIndex:"changes",width:512}],v=!a&&(null==s?void 0:s.length)===0;return(0,r.jsx)("div",{children:v?(0,r.jsx)(d.YZ,{empty:{icon:(0,r.jsx)(b.PRD,{}),title:u.o.t("workflow_publish_multibranch_nodiff")}}):(0,r.jsxs)("div",{className:"mt-8 max-w-[912px]",children:[a?null:(0,r.jsx)(k,{strong:!0,children:u.o.t("workflow_publish_multibranch_workflow_btn")}),(0,r.jsx)(d.$,{tableProps:{columns:c,dataSource:s,pagination:!1,loading:a}})]})})},{Text:I}=d.ZT,T=(0,m._Uw)(e=>{var{spaceId:t,workflowId:n,operateType:o,referenceNum:a,onDescChange:d,needDesc:c}=e,[v,p]=(0,l.useState)(!1),m=o===i.lcl.SubmitOperate?u.o.t("workflow_publish_multibranch_submit_comfirm_desc"):u.o.t("workflow_publish_multibranch_publish_confirm_content");return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:f()("min-w-[512px]","text-sm","text-[var(--semi-color-text-2)]","mb-4","font-[SF Pro Display]",{"w-[512px]":!v&&!a}),children:m}),c&&o===i.lcl.SubmitOperate?(0,r.jsx)("div",{className:"mb-2",children:(0,r.jsx)(s.Kx,{placeholder:u.o.t("bmv_enter_version_description"),maxCount:500,onChange:e=>{d(e)}})}):null,a?(0,r.jsx)(x,{num:a}):null,(0,r.jsx)(I,{link:!0,onClick:()=>{(0,h.Gg)(o===i.lcl.SubmitOperate?h.Kg.workflow_submit_difference:h.Kg.workflow_publish_difference,{workflow_id:n,workspace_id:t}),p(!v)},children:v?u.o.t("workflow_publish_multibranch_hidediff"):u.o.t("workflow_publish_multibranch_diff_btn")}),v?(0,r.jsx)(S,{spaceId:t,workflowId:n,operateType:o}):null]})}),E=n("988128"),D=e=>{var{visible:t,operateType:n,submitHandle:a,onOk:p,onCancel:f}=e,{spaceId:m,workflowId:h,isDevSpace:g}=(0,v.j1)(),{refetchReferences:x}=(0,c.c)(),_=(0,l.useRef)({desc:""}),[y,w]=(0,l.useState)(""),[j,b]=(0,l.useState)(0),N=n===i.lcl.SubmitOperate?u.o.t("workflow_publish_multibranch_submit_btn"):u.o.t("workflow_publish_multibranch_publish_btn"),k=n===i.lcl.SubmitOperate?u.o.t("workflow_publish_multibranch_submit_comfirm"):u.o.t("workflow_publish_multibranch_publish_comfirm_title");return(0,l.useEffect)(()=>{(0,o._)(function*(){if(n===i.lcl.PublishOperate){var{data:e}=yield x();b((null==e?void 0:e.workflowList.length)||0)}})()},[n]),(0,r.jsx)(d.M5,{visible:t,onOk:(0,o._)(function*(){if(_.current.desc.length>500){s.FN.error(u.o.t("bwc_version_description_exceeds_word_limit"));return}(yield a({desc:y}))&&(null==p||p())}),title:k,okText:N,maskClosable:!1,onCancel:()=>{null==f||f()},className:E.Z["diff-modal"],icon:null,okButtonProps:{disabled:!1},children:(0,r.jsx)(T,{spaceId:m,workflowId:h,operateType:n,referenceNum:j,onDescChange:e=>{_.current.desc=e,w(e)},needDesc:g})})},Z=e=>{var{submitHandle:t,operateType:n}=e,[o,i]=(0,l.useState)(!1),s=(0,l.useRef)(),d=(0,l.useMemo)(()=>(0,r.jsx)(D,{visible:!0,operateType:n,submitHandle:t,onCancel:()=>{var e;i(!1),null===(e=s.current)||void 0===e||e.call(s,!1)},onOk:()=>{var e;i(!1),null===(e=s.current)||void 0===e||e.call(s,!0)}}),[n,t,s]);return(0,l.useEffect)(()=>{!o&&(s.current=void 0)},[o]),(0,a.Z)(()=>{s.current=void 0}),{modal:o&&d,diffConfirm:()=>(i(!0),new Promise(e=>{s.current=e}))}},M=n("686436"),P=n("143263"),L=n("994983"),z=n("297158"),O=(e,t)=>Object.values(N.Gj).map(n=>{var o,r,l,a;return{key:n,property:N.CP[n],lastVersion:null==e?void 0:e[n],myDraft:null==t?void 0:t[n],isConflict:!!((null==e?void 0:null===(o=e[n])||void 0===o?void 0:o.modify)&&(null==t?void 0:null===(r=t[n])||void 0===r?void 0:r.modify)),hasDiff:!!((null==e?void 0:null===(l=e[n])||void 0===l?void 0:l.modify)||(null==t?void 0:null===(a=t[n])||void 0===a?void 0:a.modify))}}).filter(e=>e.hasDiff),A=(0,l.createContext)({workflowId:"",spaceId:"",loading:!1,mergeable:!1,hasConflict:!1,data:[],retainedResult:{},handleRetained:e=>null}),F=(0,m._Uw)(e=>{var{children:t,spaceId:n,workflowId:a}=e,[s,d]=(0,l.useState)({[N.Gj.Schema]:N.P2.Draft}),{isLoading:u,data:c}=(0,j.a)({queryKey:["workflow_merge",n,a],queryFn:(0,o._)(function*(){var{data:e}=yield i.OHc.GetConflictFromContent({space_id:n,workflow_id:a});return e})}),{submit_diff:v,draft_diff:p}=c||{},f=O(v,p),m=!!f.some(e=>e.isConflict);return(0,r.jsx)(A.Provider,{value:{workflowId:a,spaceId:n,loading:u,submitDiff:v,draftDiff:p,data:f,hasConflict:m,mergeable:!0,retainedResult:s,handleRetained:e=>{d((0,y._)({},s,e))}},children:t})}),R=()=>{var e,t=(0,l.useContext)(A);var n=(e=(0,o._)(function*(){try{var e,{workflowId:n,spaceId:o,retainedResult:r,submitDiff:l,draftDiff:a}=t;(0,h.Gg)(h.Kg.workflow_merge,{workflow_id:n,workspace_id:o,merge_type:r[N.Gj.Schema]||""});var i=Object.values(N.Gj).reduce((e,t)=>{var n,o,i,s,d,u;return n=r[t]?"submit"===r[t]?null==l?void 0:null===(d=l[t])||void 0===d?void 0:d.after:null==a?void 0:null===(u=a[t])||void 0===u?void 0:u.after:(null==l?void 0:null===(o=l[t])||void 0===o?void 0:o.modify)?null==l?void 0:null===(i=l[t])||void 0===i?void 0:i.after:null==a?void 0:null===(s=a[t])||void 0===s?void 0:s.after,(0,w._)((0,y._)({},e),{[N.Qo[t]]:n})},{});return yield m.OHc.MergeWorkflow((0,y._)({workflow_id:n,space_id:o,submit_commit_id:(null==l?void 0:null===(e=l.name_dif)||void 0===e?void 0:e.after_commit_id)||""},i)),z.E7.successEvent({eventName:"workflow_merge_success",namespace:"workflow"}),!0}catch(e){return z.E7.errorEvent({eventName:"workflow_merge_fail",namespace:"workflow",error:e}),!1}}),function(){return e.apply(this,arguments)});return(0,w._)((0,y._)({},t),{handleMerge:n})};n("303781"),n("426981");var{Text:V}=d.ZT;u.o.t("workflow_publish_multibranch_my_draft"),N.P2.Draft,u.o.t("workflow_publish_multibranch_latest_version"),N.P2.Submit;var{Text:B}=d.ZT,G=e=>{var{onCancel:t,onOk:n}=e,{handleMerge:l}=R();return(0,r.jsxs)("div",{className:"flex justify-end my-6 space-x-3",children:[(0,r.jsx)(d.y3,{onClick:t,type:"tertiary",children:u.o.t("Cancel")}),(0,r.jsx)(d.y3,{theme:"solid",onClick:(0,o._)(function*(){(yield l())&&(yield n())}),children:u.o.t("Confirm")})]})},{Text:W}=s.ZT,U=e=>{var{onCancel:t,onOk:n}=e,{spaceId:o,workflowId:l,submitDiff:a,handleRetained:i}=R();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("div",{className:"pb-3",children:[u.o.t("wmv_diff_latest_draft"),(0,r.jsx)(W,{link:!0,onClick:()=>{var e,t=(0,P.i)({space_id:o,workflow_id:l,version:null==a?void 0:null===(e=a.schema_dif)||void 0===e?void 0:e.after_commit_id});window.open(t,"_blank")},className:"ml-[1px]",children:u.o.t("wmv_view_latest_version")})]}),(0,r.jsxs)(d.FX,{direction:"vertical",defaultValue:"draft",onChange:e=>{i({[N.Gj.Schema]:e.target.value})},children:[(0,r.jsx)(d.Y8,{value:"draft",children:u.o.t("wmv_draft_version")}),(0,r.jsx)(d.Y8,{value:"submit",children:u.o.t("wmv_latest_version")})]})]}),(0,r.jsx)(G,{onOk:n,onCancel:t})]})},H=()=>{var e,{workflowId:t,spaceId:n}=(0,v.j1)(),l=(0,M.G2)(L.PR);return{mergeConfirm:(e=(0,o._)(function*(e){return(0,h.Gg)(h.Kg.workflow_merge_page,{workflow_id:t,workspace_id:n}),(!e||!!(yield new Promise(e=>{d.M5.warning({title:u.o.t("workflow_publish_multibranch_merge_comfirm"),content:u.o.t("workflow_publish_multibranch_merge_comfirm_desc"),onOk:()=>e(!0),onCancel:()=>e(!1)})})))&&new Promise(e=>{var a=d.M5.confirm({icon:null,content:(0,r.jsx)(F,{workflowId:t,spaceId:n,children:(0,r.jsx)(U,{onCancel:()=>{a.destroy(),e(!1)},onOk:(0,o._)(function*(){yield l.reloadDocument({}),s.FN.success(u.o.t("workflow_publish_multibranch_merge_success")),a.destroy(),e(!0)})})}),title:u.o.t("wmv_merge_versions"),footer:null})})}),function(t){return e.apply(this,arguments)})}},J=n("788637"),q=()=>{var e,{refetchReferences:t}=(0,c.c)();return{publishUpdateReferencedConfirm:(e=(0,o._)(function*(){var{data:e}=yield t();return!!(!e||(0,J.Z)(e.workflowList))||new Promise(t=>{d.u_.confirm({width:560,icon:null,title:u.o.t("card_builder_builtinLogic_confirm_message"),content:(0,r.jsx)(_,(0,y._)({},e)),onOk:()=>t(!0),onCancel:()=>t(!1),okText:u.o.t("Confirm"),cancelText:u.o.t("Cancel")})})}),function(){return e.apply(this,arguments)})}};n("474872"),n("382534")},593554:function(e,t,n){n.d(t,{w:function(){return r}});var o=n(450562),r=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,o.xtp)("workflow","playground","header",...t)}},864431:function(e,t,n){n.d(t,{dI:()=>c,AL:()=>g,mx:()=>f,iP:()=>p});var o=n("808549"),r=n("120454"),l=n("151064"),a=n("455069"),i=n("775699"),s=n("825955"),d=n("664319"),u=(0,n("598208").Ue)((e,t)=>{var n,o;return{activeId:void 0,forceUpdateActiveId:t=>{e({activeId:t})},sideSheetMap:{},registerSideSheet:(n,o)=>{var{sideSheetMap:r}=t();r[n]=o,e({sideSheetMap:r})},unRegisterSideSheet:n=>{var{sideSheetMap:o}=t();o[n]&&(delete o[n],e({sideSheetMap:o}))},openSideSheet:(n=(0,s._)(function*(n){var{sideSheetMap:o}=t(),r=Object.keys(o).reduce((e,t)=>{var r=o[t].closeConfirm;return t!==n&&r?[...e,r]:e},[]),l=!(yield Promise.all(r.map(e=>e()))).some(e=>!1===e);return l&&e({activeId:n}),l}),function(e){return n.apply(this,arguments)}),closeSideSheet:(o=(0,s._)(function*(n){var{sideSheetMap:o,activeId:r}=t();if(r!==n)return!0;var{closeConfirm:l}=o[n]||{},a=yield null==l?void 0:l();return(!l||!!a)&&(e({activeId:void 0}),!0)}),function(e){return o.apply(this,arguments)})}}),c=()=>u((0,d.N)(e=>({activeId:e.activeId,forceUpdateActiveId:e.forceUpdateActiveId,sideSheetMap:e.sideSheetMap,registerSideSheet:e.registerSideSheet,unRegisterSideSheet:e.unRegisterSideSheet,openSideSheet:e.openSideSheet,closeSideSheet:e.closeSideSheet}))),v=n("710938"),p=e=>{var{sideSheetId:t,closeConfirm:n,mutexWithLeftSideSheet:s,sideSheetProps:d,children:u}=e,{registerSideSheet:p,unRegisterSideSheet:f,activeId:m}=c();return((0,a.useEffect)(()=>(p(t,{sideSheetId:t,closeConfirm:n,mutexWithLeftSideSheet:s}),()=>f(t)),[t,n,s]),m!==t)?null:(0,l.jsx)(i.Uu,(0,r._)((0,o._)({closable:!1,mask:!1,maskClosable:!1},d),{visible:!!m,getPopupContainer:v.o,children:u}))},f=e=>{var t,n,{activeId:o,openSideSheet:r,closeSideSheet:l,forceUpdateActiveId:a}=c(),i=o===e;var d=(t=(0,s._)(function*(t){return yield r(t||e)}),function(e){return t.apply(this,arguments)});var u=(n=(0,s._)(function*(t){return yield l(t||e)}),function(e){return n.apply(this,arguments)});return{visible:i,handleOpen:d,handleClose:u,forceClose:()=>{a()}}},m=n("189914"),h=n("144030"),g=()=>{var{forceClose:e}=f("");return(0,a.useEffect)(()=>()=>e(),[]),(0,l.jsx)("div",{id:m.AB,className:h.Z.workflowInnerSideSheetHolder})}},348785:function(e,t,n){n.d(t,{X:function(){return a}});var o=n(151064),r=n(336205),l=n(915757),a={EQUAL:{label:r.o.t("workflow_condition_operation_equal",{},"等于"),operationIcon:(0,o.jsx)(l.Gb9,{})},NOT_EQUAL:{label:r.o.t("workflow_condition_operation_not_equal",{},"不等于"),operationIcon:(0,o.jsx)(l.kJo,{})},GREATER_THAN:{label:r.o.t("workflow_condition_operation_greater_than",{},"大于"),operationIcon:(0,o.jsx)(l.v7X,{})},LESS_THAN:{label:r.o.t("workflow_condition_operation_less_than",{},"小于"),operationIcon:(0,o.jsx)(l.lYK,{})},GREATER_EQUAL:{label:r.o.t("workflow_condition_operation_greater_equal",{},"大于等于"),operationIcon:(0,o.jsx)(l.rsJ,{})},LESS_EQUAL:{label:r.o.t("workflow_condition_operation_less_equal",{},"小于等于"),operationIcon:(0,o.jsx)(l.rPl,{})},IN:{label:r.o.t("workflow_condition_operation_in",{},"属于"),operationIcon:(0,o.jsx)(l.RVB,{})},NOT_IN:{label:r.o.t("workflow_condition_operation_not_in",{},"不属于"),operationIcon:(0,o.jsx)(l.WpB,{})},IS_NULL:{label:r.o.t("workflow_condition_operation_is_null",{},"为空"),operationIcon:(0,o.jsx)(l.Gb9,{})},IS_NOT_NULL:{label:r.o.t("workflow_condition_operation_is_not_null",{},"不为空"),operationIcon:(0,o.jsx)(l.kJo,{})},LIKE:{label:r.o.t("workflow_condition_operation_like",{},"模糊匹配"),operationIcon:(0,o.jsx)(l.Ixd,{})},NOT_LIKE:{label:r.o.t("workflow_condition_operation_not_like",{},"不模糊匹配"),operationIcon:(0,o.jsx)(l.YcE,{})},BE_TRUE:{label:r.o.t("workflow_condition_operation_be_true",{},"为真"),operationIcon:(0,o.jsx)(l.Gb9,{})},BE_FALSE:{label:r.o.t("workflow_condition_operation_be_false",{},"为假"),operationIcon:(0,o.jsx)(l.Gb9,{})}}},75524:function(e,t,n){n.d(t,{Bf:function(){return v},Gd:function(){return f},H5:function(){return g},PM:function(){return c},UZ:function(){return l},W:function(){return m},X5:function(){return d},Yv:function(){return r},ZD:function(){return h},_m:function(){return i},_r:function(){return s},f_:function(){return o},iT:function(){return u},rz:function(){return p},uw:function(){return a}});var o="inputs.insertParam.fieldInfo",r="inputs.databaseInfoList",l="inputs.selectParam.orderByList",a="inputs.selectParam.fieldList",i="inputs.selectParam.limit",s="inputs.selectParam.condition",d="".concat(s,".conditionList"),u="".concat(s,".logic"),c="inputs.updateParam.fieldInfo",v="inputs.updateParam.condition",p="".concat(v,".conditionList"),f="".concat(v,".logic"),m="inputs.deleteParam.condition",h="".concat(m,".conditionList"),g="".concat(m,".logic")},189914:function(e,t,n){n.d(t,{AB:function(){return l},Bf:function(){return a},Gd:function(){return d},I7:function(){return s},Uv:function(){return u},iB:function(){return i}});var o,r,l="workflow-inner-side-sheet-holder",a="workflow-outer-side-sheet-holder",i="flow-workflow-canvas-dnd",s="workflow-playground-content";var d=((o={}).NodeForm="node-form",o.TestFlowForm="test-flow-form",o.TestChatFlowForm="test-chat-flow-form",o.TraceList="trace-list",o.TraceDetail="trace-detail",o.RoleConfig="role-config",o);var u=((r={}).DataBase="database",r.DataSet="dataset",r.LLM="llm",r.Plugin="plugin",r.Workflow="workflow",r)},537916:function(e,t,n){n.d(t,{G:function(){return a},o:function(){return l}});var o,r,l=((o={}).Option="option",o.Text="text",o);var a=((r={}).Static="static",r.Dynamic="dynamic",r)},578182:function(e,t,n){n.d(t,{F:()=>aD});var o,r,l,a,i,s,d,u,c,v,p,f,m,h,g,x,_,y,w,j,b,N,k,C,S,I,T,E,D,Z,M,P,L,z,O,A=n("702570"),F=n("686436"),R=n("816697"),V=n("563418"),B=n("942193"),G=n("220192"),W=n("786629"),U=n("130001"),H=n("435946");class J extends F.RD{get result(){return this.data}set result(e){this.update(e)}getDefaultData(){return null}}J.type="WorkflowNodeTestRunData";var q=n("886829"),K=(e,t)=>{var n=e.getData(q.m),o=t.getNodeTemplateInfoByType(e.flowNodeType);!n.getNodeData()&&o&&n.setNodeData({icon:o.icon,description:o.description,title:o.title,mainColor:o.mainColor})},X=n("699123"),Y=n("165395");class Q{registerDocument(e){e.registerFlowNodes(...X.b6.map(e=>Y.v.processNodeRegistry(e))),e.registerNodeDatas(J,q.m),e.onNodeCreate(e=>{var{node:t}=e;if((0,X.zC)(t)){var n=t.getService(F.xm);K(t,n)}})}}Q=(0,U.gn)([(0,H.b)()],Q);var $=n("945941"),ee=n("706738"),et=n("734658"),en=n("994983"),eo=n("70630"),er=n("808549"),el=n("120454"),ea=n("473753"),ei=n("614904"),es=n("512731"),ed=n("353040"),eu=n("139655"),ec=n("717012"),ev=n("547424"),ep=n("379098"),ef=n("756088"),em=n("522801"),eh=n("970767"),eg=n("245795"),ex=n("973725"),e_=n("852135"),ey=n("668918"),ew=n("748494"),ej=n("69450"),eb=n("441211"),eN=n("505036"),ek=n("541292"),eC=n("287314"),eS=n("508197"),eI=n("473980"),eT=n("151064"),eE=n("455069"),eD=n("244829"),eZ=n("830873"),eM=n("450562"),eP=n("577060"),eL=n("873538"),ez={key:"OutputTree",component:(0,eP.Sj)(e=>{var{value:t,onChange:n,options:o,readonly:r,context:l}=e,a=o||{},{id:i,disabled:s=!1,batchMode:d,withDescription:u=!1,withRequired:c=!1,readonly:v=!1,topLevelReadonly:p=!1,allowDeleteLast:f=!1,emptyPlaceholder:m,hiddenTypes:h,showResponseFormat:g=!1,responseFormat:x,needErrorBody:_=!1,hide:y=!1,defaultCollapse:w,needAppendChildWhenNodeIsPreset:j,withDefaultValue:b=!1,isSettingOnErrorV2:N}=a,k=(0,eI._)(a,["id","disabled","batchMode","withDescription","withRequired","readonly","topLevelReadonly","allowDeleteLast","emptyPlaceholder","hiddenTypes","showResponseFormat","responseFormat","needErrorBody","hide","defaultCollapse","needAppendChildWhenNodeIsPreset","withDefaultValue","isSettingOnErrorV2"]),C=d===eM.Psf.Batch,S=(0,F.G2)(F.qp),I=(0,eE.useRef)(),T=e=>{S.stop(),n(e),S.start()};(0,eE.useEffect)(()=>{if(!I.current){I.current=d;return}if(d!==I.current){if(I.current=d,d===eM.Psf.Batch){T(eD.I.singleOutputMetasToList(t));return}if(d===eM.Psf.Single){T(eD.I.listOutputMetasToSingle(t));return}}},[d,n]);var{getNodeSetterId:E}=(0,eM.FCD)(),D=(0,eE.useMemo)(()=>_?(0,eZ.Eb)({value:t,isBatch:C,isSettingOnErrorV2:N}):t,[t,_,C,N]);return y?null:(0,eT.jsx)(eL.G,(0,el._)((0,er._)({},k),{id:i,testId:E(l.path),responseFormat:{visible:g,value:x,readonly:_,onChange:e=>{var t=l.form.getFormItemByPath("/model");(null==t?void 0:t.value)&&(t.value=(0,el._)((0,er._)({},t.value),{responseFormat:e}))}},readonly:v||r,disabled:s,value:D,onChange:n,isBatch:C,withDescription:u,withDefaultValue:b,withRequired:c,topLevelReadonly:p,allowDeleteLast:f,emptyPlaceholder:m,hiddenTypes:h,defaultCollapse:w,needAppendChildWhenNodeIsPreset:j}))})},eO=n("375525"),eA=n("674343"),eF=n("453267"),eR=n("336205"),eV=/^(?!.*\b(true|false|and|AND|or|OR|not|NOT|null|nil|If|Switch)\b)[a-zA-Z_][a-zA-Z_$0-9]*$/,eB=n("693539"),eG=n("680438"),eW=n("862868"),eU=n("218353"),eH=n("915757"),eJ=n("369815"),eq=n("184449"),eK=n("936382"),eX=(0,eP.Sj)(e=>{var{value:t,onChange:n,options:o,readonly:r}=e,{title:l,icon:a,subTitle:i,description:s}=t,{projectId:d,projectCommitVersion:u}=(0,eq.j1)(),{readonly:c=!1,hideTest:v=!1,extraOperation:p,showTrigger:f,triggerIsOpen:m,nodeDisabled:h=!1}=o,{isNodeSideSheet:g}=(0,eq.$v)();return(0,eT.jsx)(eK.l,{title:l,subTitle:i,description:s,logo:a,onTitleChange:e=>{n((0,el._)((0,er._)({},t),{title:e}))},onDescriptionChange:e=>n((0,el._)((0,er._)({},t),{description:e})),readonly:c||r,hideTest:v||!!(d&&u),extraOperation:p,showCloseButton:g,showTrigger:f,triggerIsOpen:m,nodeDisabled:h})}),eY=n("98888"),eQ=n("524705");n("715363");var e$=n("428622"),e0=n("178385"),e1=e=>e.split("_").map((e,t)=>0===t?e:e.slice(0,1).toUpperCase()+e.slice(1)).join(""),e2=(e,t)=>t&&[e0.c4.Float,e0.c4.Int].includes(t)&&e?Number(e):e,e4={expand:void 0},e5=e=>{var{modelParams:t,value:n}=e,o={[eM.Gu0.Creative]:{},[eM.Gu0.Balance]:{},[eM.Gu0.Precise]:{},[eM.Gu0.Customize]:{}};return Object.keys(o).forEach(e=>{o[e]={},null==t||t.forEach(t=>{var r,l,a,i,s,d=e1(null!==(a=t.name)&&void 0!==a?a:""),u=null!==(s=null!==(i=null==n?void 0:n[d])&&void 0!==i?i:null===(r=t.default_val)||void 0===r?void 0:r[e])&&void 0!==s?s:null===(l=t.default_val)||void 0===l?void 0:l[eM.Gu0.Customize];if(t.type&&[e0.c4.Float,e0.c4.Int].includes(t.type)){var{min:c,max:v}=t;["",void 0].includes(u)&&(u=0),""!==c&&Number(u)<Number(c)&&(u=Number(c)),""!==v&&Number(u)>Number(v)&&(u=Number(v))}o[e][d]=u})}),o},e6=n("517609"),e3=e=>{var{className:t,value:n,onChange:o,models:r,readonly:l}=e;return(0,eT.jsx)(e6.f,{className:t,value:n,onChange:o,models:r,readonly:l})},e8=n("44172"),e9=n("942767"),e7=n("825955"),te=(0,eE.lazy)((0,e7._)(function*(){var{MdBoxLazy:e}=yield n.e("8779").then(n.bind(n,985808));return{default:e}})),tt=()=>(0,eT.jsx)("div",{className:"border-0 border-t border-solid coz-stroke-primary"}),tn=e=>{var{title:t,description:n,center:o,right:r,bolder:l,leftClassName:a=""}=e;return(0,eT.jsxs)("div",{className:"flex gap-[4px]",children:[(0,eT.jsxs)("div",{className:"".concat(o?"w-[162px]":"flex-1"," ").concat(l?"font-semibold":"font-normal"," flex items-center ").concat(a),children:[t,n?(0,eT.jsx)(eA.u,{content:(0,eT.jsx)(eE.Suspense,{fallback:null,children:(0,eT.jsx)(te,{markDown:n,autoFixSyntax:{autoFixEnding:!1}})}),children:(0,eT.jsx)(e8.aUG,{className:"pl-[8px] cursor-pointer coz-fg-dim"})}):void 0]}),o?(0,eT.jsx)("div",{className:"flex-1",children:o}):void 0,r?(0,eT.jsx)("div",{className:"w-[110px]",children:r}):void 0]})},to=e=>{var{title:t,description:n,onChange:o,min:r=0,max:l=100,value:a=0,precision:i=0,readonly:s}=e,d=1/Math.pow(10,i);return(0,eT.jsx)(tn,{title:t,description:n,center:(0,eT.jsx)("div",{className:"relative ".concat(e9.Z.slider),children:(0,eT.jsx)(eA.iR,{disabled:s,value:a,min:r,max:l,step:d,marks:{[r]:"".concat(r),[l]:"".concat(l)},onChange:e=>{o(e)}},t)}),right:(0,eT.jsx)(eA.Rn,{disabled:s,precision:i,value:a,min:r,max:l,step:d,onChange:e=>{e!==a&&o(e)}})})},tr=e=>{var t,{value:n,onChange:o,model:r,defaultValue:l,readonly:a,id:i}=e,[s,d]=(0,eE.useState)(void 0===e4.expand&&(null==n?void 0:n.generationDiversity)===eM.Gu0.Customize&&!a||e4.expand),u=(0,el._)((0,er._)({},l),{[eM.Gu0.Customize]:null!==(t=e4[i])&&void 0!==t?t:null==l?void 0:l[eM.Gu0.Customize]});(0,eE.useEffect)(()=>{e4.expand=s},[s]);var{doms:c,generationDiversityGroupTitle:v}=(0,eE.useMemo)(()=>{var e,t,l=null!==(t=null==r?void 0:null===(e=r.model_params)||void 0===e?void 0:e.filter(e=>e.name!==eM.SMH))&&void 0!==t?t:[],d=[];l.forEach(e=>{var t;(null===(t=e.param_class)||void 0===t?void 0:t.class_id)&&!d.map(e=>e.class_id).includes(e.param_class.class_id)&&d.push(e.param_class)});var u=d.find(e=>1===e.class_id),c=(null==u?void 0:u.label)||"";u&&(d=[u,...d.filter(e=>e.class_id!==u.class_id)]);var v=[],p=e=>{e.generationDiversity===eM.Gu0.Customize&&(e4[i]=e)};return d.forEach((e,t)=>{if(0!==t&&v.push((0,eT.jsx)(tt,{})),!!s||(null==u?void 0:u.class_id)!==e.class_id){if((null==u?void 0:u.class_id)!==e.class_id){var r;v.push((0,eT.jsx)(tn,{title:null!==(r=e.label)&&void 0!==r?r:"",bolder:!0}))}var i=null==l?void 0:l.filter(t=>{var n;return(null===(n=t.param_class)||void 0===n?void 0:n.class_id)===e.class_id});null==i||i.forEach(e=>{var{label:t="",name:r,desc:l,min:i,max:s,options:d,precision:u,type:c}=e,f=e1(null!=r?r:""),m=e2(null==n?void 0:n[f],c);if(null==d?void 0:d.length){var h=d.map(e=>(0,el._)((0,er._)({},e),{label:e.label||e.value,value:e2(e.value,c)}));v.push((0,eT.jsx)(tn,{title:t,description:l,center:(0,eT.jsx)(eA.Ph,{disabled:a,className:"w-full",value:m,onChange:e=>{var t=(0,el._)((0,er._)({},n),{[f]:e});o(t),p(t)},optionList:h})}))}else v.push((0,eT.jsx)(to,{readonly:a,title:t,description:l,value:m,min:e2(i,c),max:e2(s,c),precision:e2(u,c),onChange:e=>{var t=(0,el._)((0,er._)({},n),{[f]:e,generationDiversity:eM.Gu0.Customize});o(t),p(t)}}))})}}),{doms:v,generationDiversityGroupTitle:c}},[s,n,r,a]);return(0,eT.jsxs)("div",{className:"p-[24px] flex flex-col gap-[16px]",onMouseDown:e=>{e.stopPropagation()},children:[(0,eT.jsx)("div",{className:"flex items-center",children:(0,eT.jsx)("div",{className:"flex-1 text-[18px] font-semibold",children:eR.o.t("workflow_detail_llm_model")})}),(0,eT.jsx)(tt,{}),(0,eT.jsx)(tn,{title:v,description:eR.o.t("model_config_generate_explain"),bolder:!0,leftClassName:"!w-[165px]",center:(0,eT.jsx)("div",{className:"w-full pr-[8px]",children:(0,eT.jsx)(eA.FX,{type:"button",disabled:a,value:null==n?void 0:n.generationDiversity,className:"".concat(e9.Z.radioGroup," w-full !flex"),onChange:e=>{var t,r,l;o((0,el._)((0,er._)({},n,null==u?void 0:u[null===(t=e.target)||void 0===t?void 0:t.value]),{generationDiversity:null===(r=e.target)||void 0===r?void 0:r.value})),(null===(l=e.target)||void 0===l?void 0:l.value)===eM.Gu0.Customize&&d(!0)},children:[{value:eM.Gu0.Precise,label:eR.o.t("model_config_generate_precise")},{value:eM.Gu0.Balance,label:eR.o.t("model_config_generate_balance")},{value:eM.Gu0.Creative,label:eR.o.t("model_config_generate_creative")},{value:eM.Gu0.Customize,label:eR.o.t("model_config_generate_customize")}].map(e=>(0,eT.jsx)(eA.Y8,{value:e.value,children:e.label},e.value))})}),right:(0,eT.jsxs)("div",{className:"cursor-pointe h-full flex items-center gap-[4px]",onClick:e=>{e.stopPropagation(),d(!s)},children:[(0,eT.jsx)("span",{children:eR.o.t("model_config_generate_advance")}),s?(0,eT.jsx)(e8.f5h,{}):(0,eT.jsx)(e8.f5h,{className:"rotate-180"})]})}),c]})},tl=eM.Gu0.Balance,ta=n("252237"),ti=n.n(ta),ts=n("660545"),td=n("902272"),tu=n("551386"),tc=n("114648"),tv=n("207524"),tp=n("921207"),tf=n("740573"),tm=(0,eE.createContext)({testId:""}),th=tm.Provider,tg=()=>(0,eE.useContext)(tm),tx=e=>{var{value:t,onChange:n}=e,{testId:o}=tg(),{data:r=[]}=(0,tc.t)();(0,eE.useEffect)(()=>{var e=null==t?void 0:t.filter(e=>e.biz_role_id);if(!(null==e?void 0:e.length)){var o=r.find(e=>e.role_type===td.GD.Host);o&&(null==n||n([o]))}},[]);var l=1;return(0,eT.jsx)(eA.cO,{value:(t||[]).map(e=>e.biz_role_id),className:"mt-4",style:{width:"100%"},onChange:e=>{var t=(0,tp.Z)(r,e,(e,t)=>!!t&&e.biz_role_id===t);null==n||n(t)},children:null==r?void 0:r.map(e=>(0,eT.jsxs)(eA.XZ,{value:e.biz_role_id,disabled:e.role_type===td.GD.Host,"data-testid":(0,eM.xtp)(o,"role",e.biz_role_id),children:[e.role,(0,eT.jsx)(tf.p,{children:e.nickname||"".concat(eR.o.t("scene_edit_roles_list_nickname_empty_seat",{},"空位")).concat(l++)})]}))})},t_=n("857916"),ty=n("569502"),tw=n("640454"),tj=e=>{var{nicknameVariables:t=[],testId:n}=tg(),{value:o,onChange:r}=e;return(0,eT.jsx)(eA.cO,{className:ti()('"mt-4"',tw.Z["nickname-checkbox-group"]),value:null==o?void 0:o.map(e=>e.nickname),onChange:e=>{var n=(0,tp.Z)(t,e,(e,t)=>e.name===t).map(e=>({biz_role_id:"",role:"",nickname:e.name}));null==r||r(n)},children:null==t?void 0:t.map(e=>(0,eT.jsx)(eA.XZ,{value:e.name,"data-testid":(0,eM.xtp)(n,"nickname",e.name),children:(0,eT.jsx)(tb,{data:e})}))})},tb=e=>{var{data:t}=e,{input:n}=t;return(null==n?void 0:n.type)===eM.YX3.LITERAL?(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(eA.u,{content:t.name,children:(0,eT.jsx)("div",{className:"whitespace-nowrap truncate",children:t.name})}),(0,eT.jsx)(tf.p,{children:ty.Iu[eM.owu.String]})]}):(0,eT.jsx)(tN,{name:t.name,input:t.input})},tN=e=>{var t,n,{name:o,input:r}=e,l=(0,t_.h)(null!==(n=null==r?void 0:null===(t=r.content)||void 0===t?void 0:t.keyPath)&&void 0!==n?n:[]);return(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(eA.u,{content:o,children:(0,eT.jsx)("div",{className:"whitespace-nowrap truncate",children:o})}),l?(0,eT.jsx)(tf.p,{children:ty.Iu[l]}):null]})},tk=n("520993"),tC=eA.Y8.Group,tS=e=>e&&e.length?(null==e?void 0:e.every(e=>!!e.biz_role_id))?"1":"2":"1",tI=e=>{var{value:t,testId:n}=tg(),{onSelect:o}=e,[r,l]=(0,eE.useState)(tS(null==t?void 0:t.user_settings)),[a,i]=(0,eE.useState)({1:"1"===tS(null==t?void 0:t.user_settings)?null==t?void 0:t.user_settings:[],2:"2"===tS(null==t?void 0:t.user_settings)?null==t?void 0:t.user_settings:[]}),s=e=>t=>{i((0,el._)((0,er._)({},a),{[e]:t})),null==o||o(t)};return(0,eT.jsxs)("div",{className:"w-[320px] p-4",children:[(0,eT.jsxs)(tC,{className:"w-full ".concat(tk.Z["role-type-radio-group"]),onChange:e=>{e.stopPropagation(),e.preventDefault(),null==o||o(a[e.target.value]),l(e.target.value)},type:"button",value:r,children:[(0,eT.jsx)(eA.Y8,{value:"1",className:"w-[50%]","data-testid":(0,eM.xtp)(n,"roleType","player"),children:eR.o.t("scene_workflow_chat_node_conversation_visibility_custom_roles",{},"Player")}),(0,eT.jsx)(eA.Y8,{value:"2",className:"w-[50%]","data-testid":(0,eM.xtp)(n,"roleType","nickname"),children:eR.o.t("scene_workflow_chat_node_conversation_visibility_custom_variable",{},"Nickname Variables")})]}),(0,eT.jsx)("div",{className:"h-max-[280px] overflow-auto",children:"1"===r?(0,eT.jsx)(tx,{value:a["1"],onChange:s("1")},"player"):(0,eT.jsx)(tj,{value:a["2"],onChange:s("2")},"nickname")})]})},tT=e=>{var{label:t,value:n,focused:o,selected:r}=e,l=(0,eE.useRef)(null),{handleValueChange:a,testId:i}=tg(),[s,d]=(0,eE.useState)(o||r);return(0,eE.useEffect)(()=>{o||r?d(!0):d(!1)},[o,r]),(0,eT.jsx)("div",{ref:l,className:"relative",onMouseOver:()=>d(!0),children:(0,eT.jsx)(eA.J2,{visible:s,onVisibleChange:e=>{d(e)},trigger:"custom",getPopupContainer:()=>l.current||document.body,content:(0,eT.jsx)(tI,{onSelect:e=>{null==a||a({visibility:n,user_settings:e})}}),position:"rightTop",children:(0,eT.jsxs)(eA.Lt.Item,{className:"w-full flex justify-between","data-testid":(0,eM.xtp)(i,n),children:[(0,eT.jsxs)(eA.T,{children:[(0,eT.jsx)(ts.Z,{className:ti()({"text-[var(--semi-color-text-2)]":r,"text-transparent	":!r})}),(0,eT.jsx)("div",{children:t})]}),(0,eT.jsx)(tv.Z,{})]})})})},tE=n("538486"),tD=[{label:eR.o.t("scene_workflow_chat_node_conversation_visibility_speaker",{},"本轮消息的所有发言人可见"),value:"2"},{label:eR.o.t("scene_workflow_chat_node_conversation_visibility_all",{},"全员可见"),value:"4"},{label:eR.o.t("scene_workflow_chat_node_conversation_visibility_custom",{},"自定义"),value:"3"}],tZ={key:"MessageVisibility",component:(0,ef.p)(e=>{var{value:t,onChange:n,readonly:o,testId:r=""}=e,l=(0,tu.w)(),{data:a}=(0,tc.t)(),[i,s]=(0,eE.useState)(t),d=e=>{s(e),null==n||n(e)},u=e=>()=>{if(!!(null==i?void 0:i.user_settings)){var t=i.user_settings;if(t.some(e=>""!==e.biz_role_id))d((0,el._)((0,er._)({},i),{user_settings:t.filter(t=>t.biz_role_id!==e.biz_role_id)}));else d((0,el._)((0,er._)({},i),{user_settings:t.filter(t=>t.nickname!==e.nickname)}))}};return(0,eT.jsx)(th,{value:{value:i,handleValueChange:d,nicknameVariables:l.filter(e=>e.name&&(e.type===eM.owu.String||e.type===eM.owu.ArrayString)),testId:r},children:(0,eT.jsx)(e$.Z,{children:(0,eT.jsx)(eA.Ph,{placeholder:eR.o.t("workflow_testset_please_select"),value:null==i?void 0:i.visibility,dropdownMatchSelectWidth:!0,className:ti()("w-full",{"pointer-events-none":o}),optionList:tD,renderOptionItem:e=>{var{label:t,value:n,onClick:o,selected:l}=e;return"3"===n?(0,eT.jsx)(tT,(0,er._)({},e)):(0,eT.jsx)(eA.Lt.Item,{className:ti()("w-full justify-start",{"font-semibold":l}),onClick:()=>{d({visibility:n,user_settings:void 0}),o()},"data-testid":(0,eM.xtp)(r,n),children:(0,eT.jsxs)(eA.T,{children:[(0,eT.jsx)(ts.Z,{className:ti()({"text-[var(--semi-color-text-2)]":l,"text-transparent	":!l})}),(0,eT.jsx)("div",{children:t})]})})},dropdownClassName:tE.Z["message-visibility-select-dropdown"],renderSelectedItem:e=>{var t,n;if((null==i?void 0:i.visibility)!=="3")return e.label;return(null==i?void 0:null===(t=i.user_settings)||void 0===t?void 0:t.length)?null==i?void 0:null===(n=i.user_settings)||void 0===n?void 0:n.map(e=>{var t;return(0,eT.jsx)(eA.Vp,{color:"primary",closable:(null==a?void 0:null===(t=a.find(t=>t.biz_role_id===e.biz_role_id))||void 0===t?void 0:t.role_type)!==td.GD.Host,onClose:u(e),children:e.biz_role_id?e.nickname?"".concat(e.role,"(").concat(e.nickname,")"):e.role:e.nickname},e.biz_role_id||e.nickname)}):null},"data-testid":r})})})}),validator:e=>{var t,{value:n}=e;return"3"!==n.visibility||(null===(t=n.user_settings)||void 0===t?!!void 0:!!t.length)||eR.o.t("required",{},"Required")}},tM=n("301541"),tP=n("898658"),tL=n("674145"),tz=n("113006"),tO=(0,eP.Sj)(e=>{var{value:t,onChange:n,options:o,readonly:r,context:l}=e,a=o||{},{disabled:i=!1,readonly:s=!1,emptyPlaceholder:d}=a,u=(0,eI._)(a,["disabled","readonly","emptyPlaceholder"]),{getNodeSetterId:c}=(0,eM.FCD)();return(0,eT.jsx)(tz.a,(0,el._)((0,er._)({},u),{testId:c(l.path),readonly:s||r,disabled:i,value:t,onChange:n,emptyPlaceholder:d}))}),tA=n("567282"),tF=n("706489"),tR=n("56695"),tV=n("775699"),tB=n("942466"),tG=n("298203"),tW=n("615655"),tU=n("862339"),tH=n("992683"),tJ=n("4818"),tq=e=>{var{images:t=[]}=e,{width:n,ref:o}=function(){var e=(0,eE.useRef)(null),[t,n]=(0,eE.useState)(0);return(0,eE.useLayoutEffect)(()=>{var t=()=>{n(e.current?e.current.offsetWidth:0)},o=new ResizeObserver(t);return e.current&&o.observe(e.current),t(),()=>{o.disconnect()}},[e.current]),{ref:e,width:t}}(),r=1===t.length,l=r?n:(n-12)/2,a=Math.min(3/4*l,280);return(0,eT.jsx)("div",{ref:o,children:(0,eT.jsx)(tV.eT,{className:tJ.Z.content,style:{maxHeight:r?"auto":2.5*a+32},getPopupContainer:()=>document.body,children:t.map((e,t)=>(0,eT.jsx)(tV.Ee,{className:tJ.Z.item,style:{width:l,height:a},src:e},t))})})},tK=()=>{var e,t,{images:n,downloadImages:o}=(e=function(e){var t=(0,tU.W)(),n=(0,F.G2)(F.L4),[o,r]=(0,eE.useState)([]);return(0,eE.useEffect)(()=>{function l(){return(l=(0,e7._)(function*(){var l=yield n.toNodeJSON(t),a=(0,eM.Iyz)({outputData:e,nodeSchema:l});!(0,tW.Z)(null==a?void 0:a.sort(),null==o?void 0:o.sort())&&r(a)})).apply(this,arguments)}!function(){l.apply(this,arguments)}()},[t,n,e]),o}(function(){var e,t=(0,tR._)();if((null==t?void 0:t.nodeStatus)===tA.nB.Success){if(null==t?void 0:t.batch)e={outputList:(0,tG.f5)(t.batch).map(e=>(0,tG.f5)(e.output))};else{var n=(null==t?void 0:t.NodeType)==="End"||(null==t?void 0:t.NodeType)==="Message"?null==t?void 0:t.input:(null==t?void 0:t.output)||"";e=(0,tG.f5)(n)}return e}}()),t=(0,tH.E)(e),{images:e,downloadImages:t});return(0,eT.jsx)("div",{className:tJ.Z.container,children:n.length>0&&(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(tV.y3,{className:tJ.Z.downloadImages,type:"primary",theme:"borderless",onClick:o,icon:(0,eT.jsx)(tB.Z,{}),children:eR.o.t("imageflow_output_display_save")}),(0,eT.jsx)(tq,{images:n})]})})},tX=n("548603"),tY=n("479716"),tQ=n("73896"),t$=n("258156");function t0(){var e=(0,tR._)(),t="imageflow_output_display_desc1",n=tX.Z,o=(null==e?void 0:e.nodeStatus)===tA.nB.Running,r=(null==e?void 0:e.nodeStatus)===tA.nB.Fail;o&&(t="imageflow_output_display_desc2",n=tY.Z),r&&(t="imageflow_output_display_desc3",n=tQ.Z);var l=(0,eT.jsx)("img",{className:t$.Z.img,src:n});return(0,eT.jsxs)("div",{className:t$.Z.container,children:[o?(0,eT.jsx)(tV.yC,{wrapperClassName:t$.Z.spin,indicator:l}):l,(0,eT.jsx)("span",{className:t$.Z.text,children:eR.o.t(t)})]})}var t1=()=>{var e=(0,tR._)(),t=!!e;return(0,eT.jsx)(tF.E,{header:eR.o.t("imageflow_output_display"),expand:t,children:(null==e?void 0:e.nodeStatus)===tA.nB.Success?(0,eT.jsx)(tK,{}):(0,eT.jsx)(t0,{})})},t2=[eM.nyy.End,eM.nyy.Output],t4=e=>t2.includes(e),t5=()=>{var e=(0,eM.rsR)(),[t,n]=(0,eE.useState)([]),o=(0,F.PF)();if(!t4(null==o?void 0:o.flowNodeType))return[];var{inputParameters:r}=e||{},l=(r||[]).reduce((e,t)=>{var n;if((null===(n=t.input)||void 0===n?void 0:n.type)==="ref"){var o,r=null===(o=t.input.content)||void 0===o?void 0:o.keyPath;if(r)return[...e,r]}return e},[]);return!(0,tW.Z)(t,l)&&n(l),t},t6=e=>{var{variablePathList:t,callback:n}=e,o=(0,F.G2)(eU.a);(0,eE.useEffect)(()=>{n();var e=new R.K4;return t.forEach(t=>{e.push(o.listenKeyPathTypeChange(t,()=>{n()}))}),()=>e.dispose()},[t,o,n])},t3=e=>{var[t,n]=(0,eE.useState)(!1),o=t5(),r=(0,eE.useCallback)(()=>o.some(t=>{var n=e.context.variableService.getViewVariableByKeyPath(t,{node:e});return[eM.owu.Image,eM.owu.ArrayImage,eM.owu.Svg,eM.owu.ArraySvg].includes(null==n?void 0:n.type)}),[e,o]);return t6({variablePathList:o,callback:()=>n(r())}),t},t8=()=>{var e,t,n,o=(0,F.PF)(),{flowNodeType:r}=o,l=t3(o);if(r===eM.nyy.Start)return!1;if(t4(r))return l;return function(e){if(!e)return!1;var t=e=>{var n,o;return!![eM.owu.Image,eM.owu.ArrayImage,eM.owu.Svg,eM.owu.ArraySvg].includes((null==e?void 0:e.type)||"")||null!==(o=null==e?void 0:null===(n=e.children)||void 0===n?void 0:n.some(t))&&void 0!==o&&o};return Array.isArray(e)?e.some(t):t(e)}(null==(n=null==(e=o)?void 0:e.getData(F.Ps).formModel)?void 0:null===(t=n.getFormItemValueByPath)||void 0===t?void 0:t.call(n,"/outputs"))},t9=n("801815"),t7=n("136515"),ne=n("206616"),nt=n("689896"),nn=n("709386"),no=(e,t)=>{if(t){var n=(0,tG.f5)(e);if(Array.isArray(n))return n.map(e=>({url:e,uid:(0,t9.x0)(),name:eR.o.t("plugin_file_unknown")}))}return e?[{url:e,uid:(0,t9.x0)(),name:eR.o.t("plugin_file_unknown")}]:[]},nr=e=>e?{accept:(0,ne.Df)(e),fileType:[ty.ow.Image,ty.ow.ArrayImage].includes(e)?"image":"object",multiple:ty.ow.isArrayType(e)}:{},nl=n("666919"),na=n("466105"),ni=n("54475"),ns=n("1334"),nd=n("634102"),nu=n("666638"),nc=n("522667"),nv=n("104401"),np=n("914173"),nf=n("503291"),nm=n("921463"),nh=e=>{var{portId:t,portType:n,className:o,style:r,collapsedClassName:l,collapsedStyle:a,testId:i}=e,{expanded:s,node:d}=(0,eq.d1)();return s?(0,eT.jsx)("div",{className:o,"data-port-id":t,"data-port-type":n,"data-testid":i,style:r}):(0,nm.createPortal)((0,eT.jsx)("div",{"data-port-id":t,"data-port-type":n,"data-testid":i,className:"".concat(l," absolute top-[50%] ").concat("output"===n?"right-0":"left-0"),style:a}),d)},ng=n("438111"),nx=n("205641"),n_=n("346707"),ny=n("47273"),nw=n.n(ny),nj=n("458620"),nb=n("727914"),nN=Array.from(Array(24).keys()).map(e=>({label:e.toString().padStart(2,"0").concat(":00"),value:e,isLeaf:!0})),nk=()=>Array.from({length:7}).map((e,t)=>({label:eR.o.t("bot_task_preset_day_of_week",{day:t}),value:t,children:nN})),nC=()=>Array.from({length:31}).map((e,t)=>({label:eR.o.t("bot_task_preset_day_of_month",{day:t+1}),value:t+1,children:nN})),nS=()=>Array.from({length:5}).map((e,t)=>({label:eR.o.t("bot_task_preset_day_of_month",{day:t+2}),value:t+2,children:nN})),nI=()=>eR.o.t("bot_task_preset_triggered_everyday"),nT=()=>eR.o.t("bot_task_preset_triggered_everyweek"),nE=()=>eR.o.t("bot_task_preset_triggered_monthly"),nD=()=>eR.o.t("bot_task_preset_triggered_interval"),nZ=()=>[{label:nI(),value:"daily",children:nN},{label:nT(),value:"weekly",children:nk()},{label:nE(),value:"monthly",children:nC()},{label:nD(),value:"intervalDaily",children:nS()}],nM=e=>{var t=e[0],n=new(nw());if("daily"===t){var o=e[1];return n.every(1).days().atHour(o).atMinute(0).toString()}var r=e[1],l=e[2];if((0,n_.Z)(l))throw new nb.sH(nj.b.parmasValidation,"invalid schedule");return"weekly"===t?n.atHour(l).atMinute(0).onDaysOfWeek(r).toString():"monthly"===t?n.atHour(l).atMinute(0).onDaysOfMonth(r).toString():n.every(r).days().atHour(l).atMinute(0).toString()},nP=e=>{var t,n,o,r=null==e?void 0:null===(n=e.split)||void 0===n?void 0:null===(t=(o=n.call(e," ")).slice)||void 0===t?void 0:t.call(o,1),l=null==r?void 0:r.at(1),a=null==r?void 0:r.at(2),i=null==e?void 0:e.at(-1),s=Number(l);if("*"!==i)return["weekly",Number(i),s];if("*"!==a)return(null==a?void 0:a.startsWith("*"))?["intervalDaily",Number(a.split("/").at(1)),s]:["monthly",Number(a),s];return["daily",s]},nL=e=>{var t,n,o=e.at(0),r=e=>{var t,n;return(null==e?void 0:null===(t=e.startsWith)||void 0===t?void 0:t.call(e,"0"))?null===(n=e.slice)||void 0===n?void 0:n.call(e,1):e};if(o===nI()){var l=e.at(1);return eR.o.t("bot_task_preset_everyday_task",{time:r(l)})}var a=e.at(1),i=Number(null==a?void 0:null===(n=a.match)||void 0===n?void 0:null===(t=n.call(a,/[0-9]+/))||void 0===t?void 0:t[0]),s=r(e.at(2));return o===nT()?eR.o.t("bot_task_preset_everyweek_task",{day:a,time:s}):o===nE()?eR.o.t("bot_task_preset_monthly_task",{day:i,time:s}):o===nD()?eR.o.t("bot_task_preset_interval_task",{day:i,time:s}):""},nz=e=>{var{value:t,onChange:n,readonly:o,hasError:r}=e,l=(0,eE.useRef)(""),a=null==t?void 0:t.content,i=(0,eE.useCallback)(e=>{null==n||n({type:ty.YX.LITERAL,content:e})},[n]);return(0,eT.jsx)(eT.Fragment,{children:(0,eT.jsx)(eA.vT,{hasError:r,size:"small",className:"w-full",disabled:o,showClear:!1,placeholder:eR.o.t("task_preset_trigger_time"),value:a?nP(a):void 0,onChange:e=>{if(Array.isArray(e)&&e.length){var t="0 ".concat(nM(e));null==i||i(t);return}null==i||i("")},treeData:nZ(),displayRender:e=>{if(Array.isArray(e))return l.current=nL(e),l.current}})})},nO=n("561232"),nA=n("438682"),nF=e=>{var{onChange:t}=e,[n,o]=(0,eE.useState)(!1),[r,l]=(0,eE.useState)(""),[a,i]=(0,eE.useState)(""),[s,d]=(0,eE.useState)(!1),u=(0,eE.useRef)(),{spaceId:c,projectId:v,workflowId:p}=(0,eq.j1)();return(0,eT.jsx)(eT.Fragment,{children:(0,eT.jsx)(eA.gn,{className:"w-[330px]",title:eR.o.t("workflow_start_trigger_cron_ai",{},"使用 AI 生成"),trigger:"custom",stopPropagation:!0,onClickOutSide:()=>{o(!1)},content:(0,eT.jsxs)("div",{className:"mt-[12px] flex flex-col gap-[12px] text-[12px]",children:[(0,eT.jsx)("div",{className:"flex flex-col gap-[4px] p-[8px] rounded-mini coz-mg-hglt",children:(0,eT.jsx)("div",{className:"coz-fg-primary",children:eR.o.t("workflow_trigger_cron_gen_sample_placeholder",{},"您可以在提示词中用自然语言如“每天18点”，将会生成对应的Cron表达式 0 18 * * * 表示每天 18 点执行。")})}),(0,eT.jsxs)("div",{className:"flex flex-col gap-[4px]",children:[(0,eT.jsxs)("div",{className:"flex justify-between",children:[(0,eT.jsx)("div",{className:"text-[14px] font-medium coz-fg-plus",children:eR.o.t("Imageflow_prompt",{},"Prompt")}),s?(0,eT.jsx)(eA.hU,{size:"small",onClick:()=>{try{var e;null===(e=u.current)||void 0===e||e.call(u,"cancel")}finally{d(!1)}},icon:(0,eT.jsx)(eH.noE,{}),color:"aihglt",children:eR.o.t("workflow_start_trigger_cron_gen_stop",{},"停止")}):(0,eT.jsx)(eA.mw,{size:"small",disabled:!r,onClick:(0,e7._)(function*(){try{d(!0);var e,t,n=yield eM.OHc.CopilotGenerate({space_id:c,project_id:null!=v?v:"",copilot_type:eM.BSe.CRONTAB,workflow_id:p,query:r});i(null!==(t=null==n?void 0:null===(e=n.data)||void 0===e?void 0:e.content)&&void 0!==t?t:"")}finally{d(!1)}}),color:"aihglt",children:eR.o.t("workflow_start_trigger_cron_gen",{},"生成")})]}),(0,eT.jsx)(eA.II,{size:"small",value:r,placeholder:eR.o.t("workflow_trigger_cron_gen_prompt_placeholder",{},"示例：每天18点"),onChange:l})]}),(0,eT.jsxs)("div",{className:"flex flex-col gap-[4px]",children:[(0,eT.jsx)("div",{className:"text-[14px] font-medium coz-fg-plus",children:eR.o.t("workflow_start_trigger_cron_generated",{},"生成的 Cron 表达式")}),(0,eT.jsxs)("div",{className:"flex flex-row gap-[8px]",children:[(0,eT.jsx)(eA.II,{loading:s,size:"small",disabled:!0,value:a,onChange:i}),(0,eT.jsx)(eA.zx,{size:"small",loading:s,disabled:!a,onClick:()=>{a&&(t(a),o(!1))},children:eR.o.t("workflow_start_trigger_cron_fillin",{},"填入")})]})]})]}),visible:n,onVisibleChange:e=>{o(e)},onCancel:()=>{o(!1)},okText:"",cancelText:eR.o.t("workflow_start_trigger_cron_cancel",{},"取消"),children:(0,eT.jsx)("div",{children:(0,eT.jsx)(eA.mw,{size:"mini",onClick:()=>o(!0),color:"aihglt",onlyIcon:!0})})})})},nR=e=>{var{value:t,onChange:n,readonly:o,node:r,needRefInput:l=!1,hasError:a}=e,i=(0,eE.useCallback)(e=>{n({type:eM.YX3.LITERAL,content:e})},[n]),s=(null==t?void 0:t.type)&&eM.nZF.isRef(t),{renderVariableSelect:d,renderVariableDisplay:u}=(0,nO.LM)({value:t,onChange:n,readonly:o,node:r,style:{width:"100%"},disabledTypes:eM.owu.getComplement([eM.owu.String])});return(0,eT.jsx)("div",{className:"w-full flex flex-row gap-[4px]",children:s?u({needWrapper:!0}):(0,eT.jsx)(eA.II,{error:a,size:"small",disabled:o,className:ti()(["w-full flex-1",nA.Z.input]),value:null==t?void 0:t.content,placeholder:eR.o.t("workflow_start_trigger_cron_ai_sample",{},"示例：您可以填写 cron 表达式。例如：0 18 * * * 表示每天 18 点执行。"),onChange:i,suffix:(0,eT.jsxs)("div",{className:"flex flex-row gap-[4px]",children:[(0,eT.jsx)(nF,{onChange:i}),l?(0,eT.jsx)("div",{children:d((0,eT.jsx)(eA.hU,{size:"mini",color:"secondary",icon:(0,eT.jsx)(eH.nwG,{className:"text-[16px]"})}))}):void 0]})})})},nV=n("737805"),nB=n("405816"),nG=n.n(nB),nW=n("788377"),nU=n("482023"),nH=n("855062"),nJ=e=>{var{value:t,onChange:n}=e,o=(e,o)=>r=>{var l=t[e].condition.conditions.map((e,t)=>t===o?(0,er._)({},r):e);null==n||n(t.map((t,n)=>n===e?{condition:(0,el._)((0,er._)({},t.condition),{conditions:l})}:t))};return(0,eT.jsx)(eT.Fragment,{children:null==t?void 0:t.map((e,t)=>e.condition.conditions.map((e,n)=>(0,eT.jsx)(nH._,{data:e,onDataChange:o(t,n)})))})},nq=n("300108"),nK=n("172107"),nX=n("447303"),nY=n("857689"),nQ=n("253826"),n$=n("513537"),n0=n("297727"),n1=n("830208"),n2="true";function n4(e){var{context:t,value:n,onChange:o,readonly:r}=e,{getNodeTestId:l,concatTestId:a}=(0,eM.FCD)(),[i,s]=(0,eE.useState)((null!=n?n:[]).map((e,t)=>(0,el._)((0,er._)({},e),{uid:t}))),{node:d}=t,[u,c]=(0,eE.useState)(),{expanded:v}=(0,eq.d1)(),p=e=>0===e?n2:"".concat(n2,"_").concat(e),f=(0,eq.M_)(p),{validateResults:m,initValidateResultsWithBranches:h,validateAllBranches:g}=(0,nq.L)();(0,eE.useEffect)(()=>{h(n||[])},[]),(0,eE.useEffect)(()=>{var e=t.onFormValidate(()=>{g(i)});return()=>{e.dispose()}},[i]),(0,eE.useEffect)(()=>{void 0===u?(g(i),null==o||o(i.map(e=>({condition:e.condition})))):g(i)},[i,u]),(0,eE.useEffect)(()=>{!(0,tW.Z)(n,i.map(e=>({condition:e.condition})))&&s((null!=n?n:[]).map((e,t)=>(0,el._)((0,er._)({},e),{uid:t})))},[n]),(0,nW.n)(i,{onDataRenamed:e=>{s(e)}});var x=e=>t=>{s(i.map((n,o)=>o===e?t:n))},_=()=>{var e=(null!=i?i:[]).reduce((e,t)=>{var{uid:n}=t;return n&&e.push(n),e},[]);return e.length?Math.max(...e)+1:1},y=e=>()=>{f(e,n.length),s(i.filter((t,n)=>n!==e))},w=(0,eE.useCallback)((e,t)=>{s(n=>nG()(n,{$splice:[[e,1],[t,0,n[e]]]}))},[]),j=(e,t)=>{c(void 0),setTimeout(()=>{f(e,t)},0)},b=(null!=i?i:[]).find(e=>e.uid===u),N=(null!=i?i:[]).findIndex(e=>e.uid===u);return(0,eT.jsx)("div",{className:"mt-3",style:{borderBottomWidth:0,paddingBottom:0},children:(0,eT.jsxs)(n0.W,{value:{flowNodeEntity:d,readonly:r,expanded:v,setterPath:a(l(),t.path)},children:[v?(0,eT.jsx)(n1.i,{onAdd:()=>{s(i.concat([{uid:_(),condition:{logic:nK.L.AND,conditions:[{left:void 0,operator:void 0,right:void 0}]}}]))}}):null,(0,eT.jsxs)(nY.C,{children:[null==i?void 0:i.map((e,t)=>(0,eT.jsx)(n$.H,{index:t,isFirstBranch:0===t,showDraggable:i.length>1,priority:i.length>1?t+1:void 0,prefixName:0===t?eR.o.t("worklfow_condition_if",{},"If"):eR.o.t("worklfow_condition_else_if",{},"Else if"),portId:p(t),branch:e,onChange:x(t),onDelete:y(t),deletable:i.length>1,branchValidateResult:m[t],onDragStart:c,onDragEnd:j,onMoveBranch:w},e.uid)),(0,eT.jsx)(nX.B,{preview:void 0!==u&&b?(0,eT.jsx)(nQ.T,{index:N,priority:N+1,prefixName:0===N?eR.o.t("worklfow_condition_if",{},"If"):eR.o.t("worklfow_condition_else_if",{},"Else if"),portId:p(N),branch:b}):null})]})]})})}var n5=n("766337"),n6=n("175317"),n3=n("77167"),n8=n("208394"),n9=n("223700"),n7=[{key:(0,t9.x0)(),name:"chatHistory",type:eM.owu.ArrayObject,children:[{key:(0,t9.x0)(),name:"role",type:eM.owu.String},{key:(0,t9.x0)(),name:"content",type:eM.owu.String}]}],oe=(0,eE.lazy)((0,e7._)(function*(){var{Canvas:e}=yield n.e("2161").then(n.bind(n,913983));return{default:e}})),ot=n("66483"),on=n("58946"),oo=n("646201"),or=n("462977"),ol=n("610499"),oa=(0,eE.forwardRef)((e,t)=>{var{content:n,canDrag:o,portId:r,readonly:l=!1,className:a,index:i,optionName:s,disableDelete:d,onChange:u,onDelete:c,setterContext:v,showOptionName:p,optionPlaceholder:f,optionEnableInterpolation:m}=e,{getNodeSetterId:h,concatTestId:g}=(0,eM.FCD)();return(0,eT.jsxs)("div",{className:ti()("flex items-start space-x-1 text-xs",a),children:[(0,eT.jsx)("div",{className:"flex w-4 min-w-4 shrink-0 mt-[4px]",children:o?(0,eT.jsx)(oo.Z,{"data-testid":g(h("answer-option-item-handle"),r||""),"data-disable-node-drag":"true",className:ti()({"cursor-move":!l,"pointer-events-none":l}),ref:t,style:{color:"#aaa"}}):null}),p?(0,eT.jsx)("div",{className:"break-keep min-w-[75px] mt-[5px]",children:s}):null,(0,eT.jsx)(eP.Ce,{path:"".concat(i),className:"w-full",children:e=>(0,eT.jsxs)("div",{className:"flex items-center space-x-1 w-full min-h-[24px]",children:[l?(0,eT.jsx)("div",{className:"w-full",children:n}):(0,eT.jsx)(or.M,{value:n,onChange:t=>{null==u||u(t),e.onChange()},onFocus:()=>e.onFocus(),onBlur:()=>e.onBlur(),isError:e.showError,context:v,readonly:l,minRows:1,placeholder:f,disableSuggestion:!m,customClassName:ti()("!rounded-[6px]",m?"":ol.Z["expression-editor-no-interpolation"])}),(0,eT.jsx)("div",{children:c&&!l?(0,eT.jsx)(eA.hU,{size:"small",color:"secondary","data-testid":g(h("answer-option-item-delete"),r||""),className:ti()("flex",{"cursor-pointer":!d,"cursor-not-allowed":d,"text-[--semi-color-tertiary-active]":d}),onClick:()=>{if(!d)c()},icon:(0,eT.jsx)(eH.ozt,{className:"text-sm"})}):null})]})})]})}),oi=(0,eP.Sj)(e=>{var{value:t,onChange:n,context:o,readonly:r,options:l}=e,{showTitleRow:a=!0,showOptionName:i=!0,optionPlaceholder:s="",defaultOptionText:d,optionEnableInterpolation:u,maxItems:c=Number.MAX_SAFE_INTEGER,addButtonClassName:v="",showDisableAddTooltip:p=!0,customDisabledAddTooltip:f}=l,{getNodeSetterId:m}=(0,eM.FCD)(),h=e=>{n(e)},g=(0,nU.M)(on.n),x=e=>{g(e,t.length),h(nG()(t,{$splice:[[e,1]]}))},_=(e,n)=>{h(nG()(t,{[n]:{name:{$set:e}}}))},y=(0,eT.jsx)(eA.hU,{className:ti()("absolute right-3 top-3",{[v]:v}),color:"highlight",size:"small",disabled:r||t.length>=c,"data-testid":m("answer-option-add-btn"),onMouseDown:()=>{h([...t,{name:""}])},icon:(0,eT.jsx)(eH.PwN,{className:"text-sm"})});return(0,eT.jsxs)("div",{className:ti()({[null==l?void 0:l.customClassName]:null==l?void 0:l.customClassName}),children:[a?(0,eT.jsxs)("div",{className:"flex items-center text-xs text-[#1D1C23] opacity-60 h-7",children:[(0,eT.jsx)("div",{className:"ml-1 w-[71px]",children:eR.o.t("workflow_ques_ans_type_option_title",{},"options")}),(0,eT.jsx)("div",{className:"ml-6",children:eR.o.t("workflow_ques_ans_type_option_content",{},"content")})]}):null,(0,eT.jsx)(ot.c,{value:t,onChange:h,onDragEnd:g,renderItem:(e,n,l)=>{var{dragRef:a,isPreview:d}=l||{};return(0,eT.jsx)(oa,{ref:a,index:n,content:e.name,onChange:e=>_(e,n),portId:d?void 0:(0,on.n)(n),optionName:(0,on.J)(n),onDelete:d?void 0:()=>x(n),disableDelete:t.length<=1,canDrag:!0,readonly:r,setterContext:o,showOptionName:i,optionPlaceholder:s,optionEnableInterpolation:u})}}),(0,eT.jsx)(oa,{className:"mt-2",content:d,optionName:eR.o.t("workflow_ques_ans_type_option_other",{},"other"),portId:"default",readonly:!0,setterContext:o,showOptionName:i,optionPlaceholder:s}),(0,eT.jsx)("div",{className:"mt-2 answer-option-add-button",children:p&&t.length>=c?(0,eT.jsx)(eA.u,{content:f||eR.o.t("workflow_250117_05",{maxCount:c}),children:(0,eT.jsx)("div",{className:"absolute right-3 top-3 background w-[24px] h-[24px] coz-mg-hglt coz-fg-hglt-dim p-[5px] rounded-[5px] flex items-center cursor-not-allowed",children:(0,eT.jsx)(eH.PwN,{className:"text-sm"})})}):y})]})}),os=[ep.C,ev.v,ec.E,{key:"JSONEditor",component:e=>{var{value:t,onChange:n,options:o,readonly:r}=e,{defaultValue:l}=o;return(0,eT.jsx)(tL.L,{value:null!=t?t:"",options:{quickSuggestions:!1,suggestOnTriggerCharacters:!1},onChange:n,disabled:r,height:264,defaultValue:l})}},{key:"FileUpload",component:e=>{var t,{value:n,onChange:o,readonly:r,options:l}=e,a=Object.assign({},nr(l.viewVariableType),l),{accept:i,multiple:s,fileType:d}=a,u=(0,eI._)(a,["accept","multiple","fileType"]),c=s?20:1,{upload:v,fileList:p,deleteFile:f,setFileList:m}=(0,ne.Vn)({multiple:s,fileType:d,accept:i,maxFileCount:c});var h=(t=(0,e7._)(function*(e){var{fileInstance:t}=e;yield v(t)}),function(e){return t.apply(this,arguments)}),g=(0,eE.useCallback)(()=>{var e,t;return e=s?JSON.stringify(p.filter(e=>e.url).map(e=>e.url)):null===(t=p[0])||void 0===t?void 0:t.url},[p,s]);(0,t7.Z)(()=>{var e=g();null==o||o(e)},[g]),(0,eE.useEffect)(()=>{g()!==n&&m(no(n,s))},[n]);var x=p.map(e=>({name:e.name,size:void 0!==e.size?(0,ne.td)(e.size):"",uid:e.uid||(0,t9.x0)(),status:e.status||ne.w_.Success,url:e.uil,validateMessage:e.validateMessage,percent:e.percent,preview:!0}));return(0,eT.jsx)("div",{className:ti()(nn.Z.container,{[nn.Z["hide-upload-area"]]:(null==p?void 0:p.length)>=c}),children:(0,eT.jsx)(eA.gq,(0,er._)({disabled:r,action:"",limit:c,fileList:x,customRequest:h,draggable:!0,dragMainText:eR.o.t("imageflow_upload_action_common"),dragSubText:eR.o.t("imageflow_upload_type",{type:i}),multiple:s,accept:i,onAcceptInvalid:()=>{eA.FN.error(eR.o.t("imageflow_upload_error_type",{type:i}))},previewFile:e=>{var{uid:t}=e,n=p.find(e=>e.uid===t);if(n)return(0,eT.jsx)(nt.a,{file:n,size:36})},onRemove:(e,t,n)=>{f(n.uid)},onClear:()=>m([])},u))})}},em.D,{key:"CronJobSelect",component:e=>{var t,{value:n={type:ng.T.Selecting,content:{type:eM.YX3.LITERAL,content:""}},onChange:o,options:r,readonly:l,context:a,feedbackStatus:i}=e,s="error"===i,{needRefInput:d}=r,u=null!==(t=n.type)&&void 0!==t?t:ng.T.Selecting,c=e=>{o({type:u,content:null!=e?e:{type:eM.YX3.LITERAL}})},v=(0,eE.useMemo)(()=>{var e;return s||u===ng.T.Selecting||n.content&&eM.nZF.isRef(n.content)?"":(0,ei.pJ)(null===(e=n.content)||void 0===e?void 0:e.content)},[s,n.content,u]);return(0,eT.jsxs)("div",{children:[(0,eT.jsxs)("div",{className:"flex flex-row gap-[2px]",children:[(0,eT.jsx)(eA.Ph,{size:"small",value:u,className:"w-fit mb-[4px]",disabled:l,onChange:e=>{o({type:e,content:{type:eM.YX3.LITERAL}})},optionList:[{label:eR.o.t("workflow_start_trigger_cron_option",{},"选择预设时间"),value:ng.T.Selecting},{label:eR.o.t("workflow_start_trigger_cron_job",{},"使用Cron表达式"),value:ng.T.Cronjob}]}),(0,eT.jsx)("div",{className:"flex-1 overflow-hidden",children:u===ng.T.Selecting?(0,eT.jsx)(nz,{hasError:s,value:n.content,onChange:c,readonly:l}):(0,eT.jsx)(nR,{hasError:s,value:n.content,onChange:c,readonly:l,node:a.node,needRefInput:d})})]}),v?(0,eT.jsx)("div",{className:"coz-mg-primary w-full h-[24px] flex flex-row items-center justify-center rounded-[4px]",children:(0,eT.jsx)(nx.x,{text:v,className:"text-[12px]"})}):null]})}},{key:"Input",component:function(e){var{value:t,onChange:n,options:o}=e,{style:r}=o,{getNodeSetterId:l}=(0,eM.FCD)(),a=eE.useCallback(e=>{n(e)},[t,n]);return(0,eT.jsx)("div",{style:r,children:(0,eT.jsx)(eA.II,{value:t,onChange:a,"data-testid":l("input")})})}},{key:"Condition",component:e=>{var{isNewNodeRender:t}=(0,eq.$v)();return t?(0,eT.jsx)(nJ,(0,er._)({},e)):(0,eT.jsx)(n4,(0,er._)({},e))},validator:e=>{var{value:t,context:n}=e;return(0,nV.QC)(t,n)}},{key:"Form",component:function(e){var{children:t}=e;return(0,eT.jsx)("div",{children:t})}},{key:"NodeHeader",component:eX},ek.Y,ey.D,eg.e,nl.X,ex.B,eC.k,{key:"Number",component:e=>{var{value:t,onChange:n,options:o,readonly:r}=e,{key:l,style:a}=o,i=(0,eI._)(o,["key","style"]),{getNodeSetterId:s}=(0,eM.FCD)();return(0,eT.jsx)(eA.Rn,(0,el._)((0,er._)({},i),{value:t,onChange:n,style:(0,el._)((0,er._)({},a),{pointerEvents:r?"none":"auto"}),"data-testid":s("number-input")}))}},eF.h,{key:"Code",component:e=>{var{value:t,onChange:n,options:o,readonly:r,feedbackText:l,feedbackStatus:a}=e,i=(0,eI._)(e,["value","onChange","options","readonly","feedbackText","feedbackStatus"]),{key:s}=o,d=(0,eI._)(o,["key"]);return(0,eT.jsx)(eA.iV,{getPopupContainer:()=>document.body,children:(0,eT.jsx)(n5.I.Provider,{value:(0,el._)((0,er._)({},i),{readonly:r}),children:(0,eT.jsx)(n6.S,(0,el._)((0,er._)({},d),{value:t,onChange:n,feedbackText:l,feedbackStatus:a}))})})}},ez,{key:"InputTree",component:tO},{key:"ModelSelect",component:e=>{var{value:t,onChange:n,readonly:o}=e,{models:r}=(0,eq.C5)(),l=(0,eE.useMemo)(()=>r.find(e=>e.model_type===(null==t?void 0:t.modelType)),[r,null==t?void 0:t.modelType]),a=(0,eE.useCallback)(e=>{var{modelType:t,value:n}=e,o=r.find(e=>e.model_type===t);return e5({modelParams:null==o?void 0:o.model_params,value:n})},[r]),i=(0,eE.useMemo)(()=>a({modelType:null==l?void 0:l.model_type}),[l]),s=(0,eE.useMemo)(()=>(0,er._)({generationDiversity:eM.Gu0.Customize},i[(null==s?void 0:s.generationDiversity)||tl],t),[t,i]),d=(0,eE.useMemo)(()=>r.map(e=>({label:e.name,value:e.model_type})),[r]),u=(0,F.km)(),{getNodeSetterId:c,concatTestId:v}=(0,eM.FCD)(),p=c("llm-select");return(0,eT.jsx)(e$.Z,{children:(0,eT.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,eT.jsx)(e3,{"data-testid":p,readonly:o,value:null==s?void 0:s.modelType,onChange:e=>{var t=d.find(t=>t.value===e);if(t){var o,r,l,i,c,v,p,f=null!==(o=s.generationDiversity)&&void 0!==o?o:tl;r=f===eM.Gu0.Customize?null!==(i=null===(l=a({modelType:t.value,value:e4[u.id]}))||void 0===l?void 0:l[f])&&void 0!==i?i:{}:null!==(v=null===(c=a({modelType:t.value}))||void 0===c?void 0:c[f])&&void 0!==v?v:{},null==n||n((0,el._)((0,er._)({},r),{modelName:t.label,modelType:t.value,generationDiversity:f,responseFormat:null!==(p=null==s?void 0:s.responseFormat)&&void 0!==p?p:null==r?void 0:r.responseFormat}))}},models:r}),(0,eT.jsx)(eA.J2,{autoAdjustOverflow:!1,className:"rounded-md w-[660px]",trigger:"click",content:(0,eT.jsx)(tr,{id:u.id,defaultValue:i,value:s,onChange:e=>{null==n||n((0,el._)((0,er._)({},e),{modelName:s.modelName,modelType:s.modelType}))},model:l,readonly:o}),spacing:30,children:(0,eT.jsx)(eA.hU,{"data-testid":"e2e-ui-button-action-".concat(v(p,"model-setting-btn")),wrapperClass:"leading-none",color:"secondary",size:"small",icon:(0,eT.jsx)(eH.qBd,{})})})]})})}},ed.u,es.Q,{key:"LoopOutputSelect",component:function(e){var{value:t,onChange:n,readonly:o,context:r}=e,{getNodeSetterId:l}=(0,eM.FCD)(),a=l(null==r?void 0:r.path);return(0,eT.jsx)(tM.o,{value:t,onChange:n,readonly:o,testId:a})},validator:e=>{var{value:t,context:n}=e,{meta:o,playgroundContext:r,node:l}=n,{required:a}=o;return(0,eQ.s)({value:t,playgroundContext:r,node:l,required:a})}},{key:"MutableVariableAssign",component:function(e){var{value:t,onChange:n,readonly:o,options:r,context:l}=e,{right:a,inputParameters:i,index:s}=r,{getNodeSetterId:d}=(0,eM.FCD)(),u=d(l.path);return(0,eT.jsx)(eY.r,{value:t,onChange:n,readonly:o,node:l.node,right:a,inputParameters:i,index:s,testId:u})},validator:e=>{var{value:t,context:n}=e,{meta:o,playgroundContext:r,node:l}=n,{required:a}=o;return(0,eQ.s)({value:t,playgroundContext:r,node:l,required:a})}},{key:"DatasetSelect",component:e=>(0,eT.jsx)(np.d,(0,er._)({},e))},{key:"DatasetWriteIndex",component:e=>{var t,{value:n,onChange:o,readonly:r}=e,{vectorModellList:l}=(0,ns.EP)(),a=null==l?void 0:l.map(e=>({label:e.name,value:e.name}));return(0,eE.useEffect)(()=>{if((null==l?void 0:l.length)>0){var e,t=l[0].name;t&&(null==n?void 0:null===(e=n.vectorModel)||void 0===e?void 0:e.name)!==t&&o((0,el._)((0,er._)({},n),{vectorModel:{name:t}}))}},[n,o,l]),(0,eT.jsxs)("div",{className:"mt-[4px]",children:[(0,eT.jsx)(nd.$,{label:eR.o.t("kl_write_017"),description:eR.o.t("kl_write_018"),checked:null==n?void 0:n.vectorIndexing,onChange:e=>null==o?void 0:o((0,el._)((0,er._)({},n),{vectorIndexing:e})),readonly:r,disabled:!0,children:(0,eT.jsx)(nd.$,{needCheckBox:!1,label:eR.o.t("kl_write_019"),style:{paddingLeft:"22px"},children:(0,eT.jsx)(eA.Ph,{size:"small",className:nu.Z["model-select"],optionList:a,style:{width:"426px",height:"24px",borderColor:"#06070926"},value:null==n?void 0:null===(t=n.vectorModel)||void 0===t?void 0:t.name,onChange:e=>o((0,el._)((0,er._)({},n),{vectorModel:{name:e}})),disabled:r||!0})})}),(0,eT.jsx)(nd.$,{label:eR.o.t("kl_write_020"),description:eR.o.t("kl_write_021"),checked:null==n?void 0:n.keywordIndexing,onChange:e=>null==o?void 0:o((0,el._)((0,er._)({},n),{keywordIndexing:e})),disabled:!0})]})}},{key:"DatasetSetting",component:e=>{var t,n,o,{value:r,onChange:l,options:a,readonly:i}=e,{readonly:s=!1,disabled:d=!1,style:u={}}=a,c=(0,eI._)(a,["readonly","disabled","style"]),{data:v}=(0,eM.rsR)(),p=null!==(o=null===(n=v.inputs)||void 0===n?void 0:null===(t=n.datasetParameters)||void 0===t?void 0:t.datasetParam)&&void 0!==o?o:[],{dataSets:f,isReady:m}=(0,eq.Z3)({ids:p});return(0,eT.jsx)(nv.Y,(0,el._)((0,er._)({},c),{readonly:s||i,disabled:d,style:u,onDataSetInfoChange:l,dataSets:f,dataSetInfo:r,isReady:m}))}},eu.o,{key:"NodeInputName",component:e=>{var{options:t,feedbackStatus:n,value:o,onChange:r,readonly:l,context:a}=e,{style:i,input:s,inputParameters:d,initValidate:u=!1,isPureText:c=!1,prefix:v="",suffix:p="",format:f,tooltip:m,disabled:h}=t,[g,x]=(0,eE.useState)(!1),[_,y]=(0,eE.useState)(!1),[w,j]=(0,eE.useState)(o),[b,N]=(0,eE.useState)(o),{getNodeSetterId:k}=(0,eM.FCD)(),{isNewNodeRender:C}=(0,eJ.$)(),S=(0,F.G2)(eU.a);(0,eE.useEffect)(()=>{o!==b&&N(o)},[o]);var I=(0,eW.H)({input:s,prefix:v,suffix:p,format:f,node:a.node,variableService:S}),T=(0,eE.useCallback)(e=>{y(!0),N(e||""),j(void 0)},[r]),E=(0,eE.useMemo)(()=>(0,eB.m)(n),[n]);if((0,eE.useEffect)(()=>{u&&r(o),o&&y(!0),x(!0)},[]),g&&!l&&!_&&!C){if(I&&I!==w){var D=(0,eW.Zu)({variableName:I,inputParameters:d});r(D),j(I),N(D)}else!I&&w&&(j(void 0),N(void 0))}return(0,eT.jsx)("div",{className:"flex items-center",style:(0,el._)((0,er._)({},i),{pointerEvents:l?"none":"auto"}),children:c?(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(eA.ZT.Text,{className:"leading-8 text-xs",children:o}),m?(0,eT.jsx)(eA.u,{content:m,children:(0,eT.jsx)(eH.L03,{className:"ml-1",style:{fontSize:12}})}):null]}):(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(eA.II,{"data-testid":k(a.path),value:b,onChange:T,onBlur:()=>{r(b)},validateStatus:E,placeholder:eR.o.t("workflow_detail_node_input_entername"),size:"small",disabled:h}),m?(0,eT.jsx)(eA.u,{content:m,children:(0,eT.jsx)(eH.L03,{className:"ml-1",style:{fontSize:12}})}):null]})})},validator:e=>{var t,n,{value:o,options:r,context:l}=e,{validatorConfig:a,getNames:i=eW.qo,invalidValues:s={}}=r,d=null!==(t=null==a?void 0:a.rule)&&void 0!==t?t:eV,u=null!==(n=null==a?void 0:a.errorMessage)&&void 0!==n?n:eR.o.t("workflow_detail_node_error_format");return d.test(o)?s[o]?s[o]:i(l).filter(e=>e===o).length>1?eR.o.t("workflow_detail_node_input_duplicated"):void 0:u}},{key:"NodeOutputName",component:e=>{var{options:t,feedbackStatus:n,value:o,onChange:r,readonly:l}=e,{style:a={}}=t,i=eE.useCallback(e=>{r(e)},[r]),s=(0,eE.useMemo)(()=>(0,eB.m)(n),[n]),d=(0,eE.useMemo)(()=>(0,eT.jsxs)("span",{className:eG.Z["limit-count"],children:[(null==o?void 0:o.length)||0,"/",20]}),[o]);return(0,eT.jsx)("div",{style:(0,el._)((0,er._)({},a),{pointerEvents:l?"none":"auto"}),children:(0,eT.jsx)(eA.II,{value:o,onChange:i,maxLength:20,validateStatus:s,placeholder:eR.o.t("workflow_detail_node_input_entername"),suffix:d})})},validator:e=>{var t,{value:n,context:o}=e,{node:r}=o;if(!eV.test(n))return eR.o.t("workflow_detail_node_error_format");var l=null===(t=r.getNodeMeta())||void 0===t?void 0:t.outputsPath;if(!!l){var a=(o.getFormItemValueByPath(l)||[]).filter(e=>e.name===n);return(null==a?void 0:a.length)>1?eR.o.t("workflow_detail_node_error_name_duplicated",{name:n}):void 0}}},{key:"OutputLabelText",component:e=>(0,eT.jsx)(eO.e,(0,er._)({},e))},ew.i,{key:"CustomPort",component:e=>{var{options:t}=e,{portID:n,portType:o,className:r,style:l,collapsedClassName:a,collapsedStyle:i}=t,{getNodeSetterId:s,concatTestId:d}=(0,eM.FCD)(),u=d(s("custom-port"),n);return(0,eT.jsx)(nh,{portId:n,portType:o,className:r,style:l,collapsedClassName:a,collapsedStyle:i,testId:u})}},{key:"ChatHistory",component:e=>{var{value:t,onChange:n,readonly:o,context:r}=e,{getNodeSetterId:l}=(0,eM.FCD)();return(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(tF.E.Action,{children:(0,eT.jsx)(eA.u,{content:eR.o.t("wf_chatflow_125"),position:"right",children:(0,eT.jsxs)("div",{className:"flex items-center gap-1",children:[(0,eT.jsx)("div",{className:n9.Z["chat-history-text"],children:eR.o.t("wf_chatflow_124")}),(0,eT.jsx)(eA.rs,{size:"mini",checked:null==t?void 0:t.enableChatHistory,"data-testid":l(r.meta.name),onChange:e=>{if(t.enableChatHistory!==e)null==n||n((0,el._)((0,er._)({},t),{enableChatHistory:e}))},disabled:o})]})})}),(null==t?void 0:t.enableChatHistory)?(0,eT.jsxs)("div",{className:"relative",children:[(0,eT.jsx)(eL.G,{id:"chat-history",readonly:!0,value:n7,defaultCollapse:!0,onChange:()=>{},withDescription:!1,withRequired:!1,noCard:!0}),(0,eT.jsx)("div",{className:n9.Z.line}),(0,eT.jsx)(n8.r,{value:t.chatHistoryRound,readonly:o,onChange:e=>{n((0,el._)((0,er._)({},t),{chatHistoryRound:Number(e)}))}})]}):null]})}},e_.U,na.or,eb.$,{key:"canvas",component:e=>{var t=(0,eq.u6)({needNullType:!0,needNullName:!0});return(0,eT.jsx)(eE.Suspense,{fallback:(0,eT.jsx)("div",{children:"canvas loading..."}),children:(0,eT.jsx)(oe,(0,el._)((0,er._)({},e),{variables:t}))})}},{key:"string",component:(0,ef.p)(ea.Ld)},{key:"boolean",component:(0,ef.p)(ea.ge)},{key:"enum",component:(0,ef.p)(ea.xs)},{key:"database-select",component:(0,ef.p)(nf.u)},{key:"enum-image-model",component:(0,ef.p)(ea.AJ)},{key:"number",component:(0,ef.p)(ea.Mr)},(0,el._)((0,er._)({},nl.X),{key:"text"}),(0,el._)((0,er._)({},ez),{key:"parameters"}),(0,el._)((0,er._)({},eu.o),{key:"expression"}),(0,el._)((0,er._)({},eC.k),{key:"radio"}),{key:"checkbox",component:e=>(0,eT.jsx)(n3.X,(0,er._)({},e))},eS.P,{key:"answer-option",component:oi},{key:"image-preview",component:function(){return t8()?(0,eT.jsx)(t1,{}):null}},tZ,eh.A,{key:"LocalInputSelect",component:e=>{var{value:t,onChange:n,options:o}=e,{disabledTypes:r,allowedTypes:l}=o,a=(0,tu.w)();return(0,eT.jsx)(eA.Ph,{className:"w-full",dropdownMatchSelectWidth:!0,placeholder:eR.o.t("scene_workflow_chat_node_conversation_content_speaker_placeholder",{},"Please choose player"),optionList:a.filter(e=>(null==l?void 0:l.length)?l.includes(e.type):(null==r?!void 0:!r.length)||(null==r?!void 0:!r.includes(e.type))&&!0).map(e=>({label:e.name,value:e.name,type:e.type})),value:t,onChange:n,onBlur:e=>{null==n||n(t)},renderOptionItem:e=>{var{selected:t}=e;return(0,eT.jsx)(eA.Lt.Item,{onClick:e.onClick,className:ti()({"font-semibold":t}),children:(0,eT.jsxs)(eA.T,{children:[(0,eT.jsx)(ts.Z,{className:ti()({"text-[var(--semi-color-text-2)]":t,"text-transparent	":!t})}),e.label," ",(0,eT.jsx)(tf.p,{children:ty.Iu[e.type]})]})})},dropdownClassName:tP.Z["local-input-select-dropdown"],emptyContent:eR.o.t("workflow_detail_node_nodata")})}},ej.$,{key:"size-select",component:(0,ef.p)(ei.CA)},{key:"DatasetWriteParser",component:e=>(0,eT.jsx)(ni.h,(0,er._)({},e))},{key:"DatasetWriteChunk",component:e=>(0,eT.jsx)(nc.$,(0,er._)({},e))},eN.h],od=n("275546"),ou=n("353242"),oc=e=>{var{children:t=[]}=e.props,[,n]=t;return null!=n?n:[]},ov=n("698707"),op=n("776274"),of=n("21621"),om=n("136704"),oh={key:"FormCardAction",component:tF.E.Action},og=n("700802"),ox=[{title:eR.o.t("workflow_detail_node_parameter_name"),style:{width:160}},{title:eR.o.t("workflow_detail_node_parameter_value"),style:{width:160}}],o_=[{key:"Style",component:function(e){var{children:t,options:n}=e,{style:o}=n;return(0,eE.useCallback)(()=>(0,eT.jsx)("div",{style:o,children:t}),[])()}},{key:"FormLayout",component:e=>{var{children:t,options:n}=e,{cols:o=2,gutter:r=24,direction:l="horizontal",gridColumns:a,isSplit:i=!0,tooltip:s,title:d}=n,[u,c]=(0,eE.useState)(!0);if("horizontal"===l){var v,p,f=(v=oc(t),p=o,v.reduce((e,t,n)=>(n%p==0?e.push([t]):e[e.length-1].push(t),e),[]));return(0,eT.jsx)("div",{className:i?ou.Z["form-layout"]:"",children:(0,eT.jsxs)(tF.E,{collapsible:!1,noPadding:!0,children:["string"==typeof d?(0,eT.jsx)("div",{className:"mb-2",onClick:()=>c(!u),children:(0,eT.jsxs)(eA.X2,{type:"flex",align:"middle",children:[(0,eT.jsx)(eH.C_O,{className:ti()("coz-fg-secondary font-bold mr-[3px]",{[ou.Z["icon-arrow-row"]]:u,[ou.Z["icon-arrow-column"]]:!0})}),(0,eT.jsx)("span",{className:"".concat(ou.Z["form-layout-title"]," ml-1"),children:d}),s?(0,eT.jsx)(od.Z,{showArrow:!0,position:"top",className:ou.Z.tooltip,content:s,children:(0,eT.jsx)(eH.L03,{className:"text-lg coz-fg-secondary ml-1"})}):null]})}):"",(0,eT.jsx)(eA.zF,{keepDOM:!0,isOpen:u,children:f.map(e=>(0,eT.jsx)(eA.X2,{type:"flex",gutter:r,children:e.map((e,t)=>{var n,l=null==a?void 0:a[t];return(0,eT.jsxs)(eA.JX,{style:(0,er._)({display:u?"unset":"none"},null==l?void 0:l.style),span:null!==(n=null==l?void 0:l.ratio)&&void 0!==n?n:r/o,children:[l?(0,eT.jsx)("span",{className:ou.Z["form-layout-item"],children:null==l?void 0:l.title}):"",e]})})}))})]})})}return(0,eT.jsx)("div",{children:t})}},{key:"FormCard",component:e=>{var{context:t,children:n,options:o,feedbackText:r,feedbackStatus:l}=e,{title:a}=t.meta,{key:i,columns:s}=o,d=(0,eI._)(o,["key","columns"]);return(0,eT.jsxs)(tF.E,(0,el._)((0,er._)({header:a},d),{feedbackText:r,feedbackStatus:l,children:[s?(0,eT.jsx)("div",{className:om.Z.formCardColumns,children:(0,eT.jsx)(of.Z,{columns:s})}):null,n]}))}},oh,{key:"FormItem",component:e=>{var{children:t,feedbackText:n,feedbackStatus:o,formItemMeta:r,options:l}=e,{title:a,required:i,description:s}=r,{key:d}=l,u=(0,eI._)(l,["key"]);return(0,eT.jsx)(op.x,(0,el._)((0,er._)({label:a,required:i,tooltip:s,feedbackText:n,feedbackStatus:o},u),{children:t}))}},{key:"FormItemFeedback",component:e=>{var{children:t,feedbackText:n,feedbackStatus:o,options:r}=e,{className:l,style:a}=r;return(0,eT.jsxs)("div",{className:l,style:a,children:[t,(0,eT.jsx)(ov.P,{feedbackText:n,feedbackStatus:o})]})}},{key:"ColumnsTitle",component:e=>{var{options:t,children:n}=e,{columns:o}=t;return(0,eT.jsxs)("div",{className:og.Z["column-title-dec-wrapper"],children:[(0,eT.jsx)(of.Z,{columns:o||ox}),n]})}}];class oy{onRegister(e){os.forEach(t=>{e.registerAbilityExtension(F.Bw.type,t)}),o_.forEach(t=>{e.registerAbilityExtension(F.GH.type,t)})}}oy=(0,U.gn)([(0,H.b)()],oy);var ow=n("497744");var oj=((o={}).EXECUTE_STATUS_BAR="execute_status_bar",o),ob=n("938943"),oN=()=>{var{node:e}=(0,F.PV)(),t=e.getNodeMeta();return(0,eE.useMemo)(()=>t.subCanvas(e).parentNode,[e,t])},ok=()=>{var e,t,{node:n}=(0,F.PV)(),o=n.getNodeMeta(),{title:r="",tooltip:l,renderPorts:a=[],style:i={}}=null!==(t=null==o?void 0:null===(e=o.renderSubCanvas)||void 0===e?void 0:e.call(o))&&void 0!==t?t:{};return{title:r,tooltip:l,renderPorts:a,style:i}},oC=n("213635"),oS=n("395996"),oI=()=>{var{startDrag:e,onFocus:t,onBlur:n}=(0,F.PV)(),{getNodeTestId:o,concatTestId:r}=(0,eM.FCD)(),{title:l,tooltip:a}=ok(),i=oN(),s=(0,eE.useMemo)(()=>{var e=i.getData(q.m).getNodeData();return(null==e?void 0:e.mainColor)?"linear-gradient(".concat((0,ob.W)(e.mainColor,.08)," 0%, var(--coz-bg-plus) 100%)"):"var(--coz-bg-plus)"},[i]);return(0,eT.jsxs)("div",{className:oS.Z["sub-canvas-header"],draggable:!0,onMouseDown:t=>{e(t)},onFocus:t,onBlur:n,style:{background:s},children:[(0,eT.jsx)(oC.q,{className:oS.Z["sub-canvas-logo"],nodeId:i.id,size:24,alt:"logo"}),(0,eT.jsx)("p",{className:oS.Z["sub-canvas-title"],"data-testid":r(o(),"title"),children:l}),a?(0,eT.jsx)(od.Z,{showArrow:!0,position:"top",content:(0,eT.jsx)("span",{children:a}),className:oS.Z["sub-canvas-tooltip"],children:(0,eT.jsx)(e8.aUG,{className:oS.Z["sub-canvas-tooltip-icon"],"data-testid":r(o(),"tips")})}):null]})},oT=n("564751"),oE=()=>{var{node:e}=(0,F.PV)();return(0,eT.jsx)("div",{className:oT.Z["sub-canvas-background"],"data-flow-editor-selectable":"true",children:(0,eT.jsxs)("svg",{width:"100%",height:"100%",children:[(0,eT.jsx)("pattern",{id:"sub-canvas-dot-pattern",width:"20",height:"20",patternUnits:"userSpaceOnUse",children:(0,eT.jsx)("circle",{cx:"1",cy:"1",r:"1",stroke:"#eceeef",fillOpacity:"0.5"})}),(0,eT.jsx)("rect",{width:"100%",height:"100%",fill:"url(#sub-canvas-dot-pattern)","data-node-panel-container":e.id})]})})},oD=n("184447"),oZ=e=>{var{children:t}=e,{node:n,selected:o,selectNode:r,nodeRef:l}=(0,F.PV)(),a=(0,F.G2)(en.Re),{size:i={width:300,height:200}}=n.getNodeMeta(),{style:s={}}=ok(),d=n.getData(F.eG),[u,c]=(0,eE.useState)(i.width),[v,p]=(0,eE.useState)(i.height),f=oN();return(0,eE.useEffect)(()=>{var e=()=>{if(0===n.collapsedChildren.length){var e,t,o=f.getData(F.eG);c(null!==(e=o.bounds.width)&&void 0!==e?e:i.width),p(null!==(t=o.bounds.height)&&void 0!==t?t:i.height);return}u!==d.bounds.width&&c(d.bounds.width),v!==d.bounds.height&&p(d.bounds.height)};e();var t=d.onDataChange(()=>{e()});return()=>t.dispose()},[f,d]),(0,eT.jsx)("div",{className:ti()(oD.Z["sub-canvas-container"],{selected:o}),style:(0,er._)({width:u,height:v},s),ref:l,"data-node-selected":String(o),onMouseDown:r,onClick:e=>{r(e),a.focusNode()},children:t})},oM=n("683595"),oP=()=>(0,eT.jsx)("div",{className:oM.Z["sub-canvas-border"]}),oL=n("197360"),oz=()=>{var{node:e,ports:t}=(0,F.PV)(),{renderPorts:n}=ok(),{getNodeTestId:o,concatTestId:r}=(0,eM.FCD)(),l=o();return(0,eE.useEffect)(()=>{e.getData(F.QW).updateDynamicPorts()},[e]),(0,eT.jsxs)(eT.Fragment,{children:[n.map(e=>(0,eT.jsx)("div",{className:"sub-canvas-port","data-port-id":e.id,"data-port-type":e.type,style:e.style,"data-testid":r(l,"port",e.id)},"canvas-port".concat(e.id))),t.map(e=>(0,eT.jsx)(oL.J,{entity:e},e.id))]})},oO="workflow-move-into-sub-canvas-tip-visible",oA="false";class oF{static get instance(){return!this._instance&&(this._instance=new oF),this._instance}isClosed(){return this.isCloseForever()||this.closed}close(){this.closed=!0}isCloseForever(){return localStorage.getItem(oO)===oA}closeForever(){localStorage.setItem(oO,oA)}constructor(){this.closed=!1}}var oR=()=>{var{node:e}=(0,F.PV)(),[t,n]=(0,eE.useState)(!1),o=oF.instance,r=(0,F.G2)(F.uf),l=(0,eE.useCallback)(()=>{if(!o.isClosed())n(!0)},[o]),a=(0,eE.useCallback)(()=>{o.close(),n(!1)},[o]),i=(0,eE.useCallback)(()=>{o.closeForever(),a()},[a,o]);return(0,eE.useEffect)(()=>{var t=r.on(t=>{if(t.type===F.DL.In)t.targetContainer===e&&l()}),o=r.on(t=>{if(t.type===F.DL.Out)t.sourceContainer===e&&!e.blocks.length&&n(!1)});return()=>{t.dispose(),o.dispose()}},[r,e,l,a,t]),{visible:t,close:a,closeForever:i}},oV=/(Macintosh|MacIntel|MacPPC|Mac68K|iPad)/.test(navigator.userAgent),oB=n("497811"),oG=()=>{var{visible:e,close:t,closeForever:n}=oR();return e?(0,eT.jsx)("div",{className:oB.Z["sub-canvas-tips"],children:(0,eT.jsxs)("div",{className:oB.Z.container,children:[(0,eT.jsxs)("div",{className:oB.Z.content,children:[(0,eT.jsx)("p",{className:oB.Z.text,children:eR.o.t("workflow_subcanvas_pull_out",{ctrl:oV?"Cmd ⌘":"Ctrl"})}),(0,eT.jsx)("div",{className:oB.Z.space,style:{width:"zh-CN"===eR.o.language?0:128}})]}),(0,eT.jsxs)("div",{className:oB.Z.actions,children:[(0,eT.jsx)("p",{className:oB.Z.closeForever,onClick:n,children:eR.o.t("workflow_subcanvas_never_remind")}),(0,eT.jsx)("div",{className:oB.Z.close,onClick:t,children:(0,eT.jsx)(e8.Uj_,{color:"coz-fg-plus"})})]})]})}):null},oW=e=>(0,eT.jsxs)(oZ,{children:[(0,eT.jsx)(oP,{}),(0,eT.jsx)(oE,{}),(0,eT.jsx)(oG,{}),(0,eT.jsx)(oI,{}),(0,eT.jsx)(oz,{})]}),oU=n("612286"),oH=n("297158"),oJ=n("340291"),oq=n("181907"),oK=n("189914"),oX=n("282975"),oY=n("408487"),oQ=n("556305"),o$=n("206058"),o0=n("626389"),o1=n.n(o0),{Text:o2}=eA.ZT,o4=()=>{var{executeLogId:e="",logID:t=""}=(0,eq.zz)(),n=e=>{o1()(e)?eA.FN.success({content:eR.o.t("copy_success"),showClose:!1}):eA.FN.warning({content:eR.o.t("copy_failed"),showClose:!1})};return e?(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)("div",{children:(0,eT.jsxs)(o2,{className:"inline break-words",size:"small",type:"quaternary",children:["".concat(eR.o.t("workflow_running_results_error_executeid"),": ").concat(e),(0,eT.jsx)(tV._3,{wrapperClass:"inline",iconSize:"small",icon:(0,eT.jsx)(eH.UtC,{color:"#1D1C2359"}),onClick:()=>n(e)})]})}),(0,eT.jsx)("div",{children:(0,eT.jsxs)(o2,{className:"inline break-words",size:"small",type:"quaternary",children:["logID: ".concat(t),(0,eT.jsx)(tV._3,{wrapperClass:"inline",iconSize:"small",icon:(0,eT.jsx)(eH.UtC,{color:"#1D1C2359"}),onClick:()=>n(t)})]})})]}):null},o5=n("511743"),o6=n("43380"),o3=e=>{var{node:t,className:n,onOpenWorkflowLink:o}=e,r=(0,eI._)(e,["node","className","onOpenWorkflowLink"]),l=(0,eq.zz)(),a=(0,eE.useMemo)(()=>t.id,[t]),i=l.getNodeExecResult(a),s=(0,eq.j1)(),d=(0,eE.useCallback)(e=>{e.stopPropagation()},[]),u=(null==i?void 0:i.errorLevel)==="Error";return(0,eT.jsxs)("div",(0,el._)((0,er._)({className:ti()(o6.Z["flow-test-run-result-panel"],n),onMouseDown:d,onMouseMove:d},r),{children:[i?(0,eT.jsx)(o$.qS,{spaceId:s.spaceId,workflowId:s.workflowId,result:i,paginationFixedCount:5,LogImages:o5.d,onOpenWorkflowLink:o,node:t}):null,u?(0,eT.jsx)("div",{className:"mt-4",children:(0,eT.jsx)(o4,{})}):null]}))},o8=n("644113");function o9(){var{openDatabaseDetail:e}=(0,o8.T)();return(0,eT.jsx)(eA.zx,{onClick:t=>{t.stopPropagation(),e()},size:"small",color:"secondary",className:"!coz-fg-hglt",children:eR.o.t("workflow_view_data",{},"查看数据")})}var o7=e=>{if(!(null==e?void 0:e.extra))return{needAuth:!1,authLink:""};var t=(0,tG.dj)(null==e?void 0:e.extra,{}),{auth_info:n,need_auth:o}=(null==t?void 0:t.auth)||{};return{needAuth:o,authLink:n}},re=e=>{if(!!e){var t=e.find(e=>"error"===e.errorLevel),n=e.find(e=>"warning"===e.errorLevel),o=e.find(e=>"pending"===e.errorLevel);return t||n||o}},rt=e=>{var t=(0,eq.zz)(),{projectId:n}=t.config,o=t.getNodeExecResult(e),{nodeStatus:r,nodeExeCost:l,tokenAndCost:a}=o||{},{needAuth:i,authLink:s}=o7(o),{errorLevel:d,errorInfo:u}=re(t.getNodeError(e))||{};return{nodeStatus:r,hasExecuteResult:!!o,nodeExeCost:l,tokenAndCost:a,errorLevel:d,errorInfo:u,needAuth:i,handleAuth:()=>{window.open(s,"targetWindow","toolbar=no, location=no, status=no, menubar=no, scrollbars=yes, resizable=yes, width=480, height=630")},runProjectId:n,isSingleMode:t.config.isSingleMode}},rn=n("64605"),ro=n("564803"),rr=e=>{if(!e)return!1;var t,n=(0,tG.f5)(e);return n&&(0,rn.Z)(n)&&!1===n.isSuccess&&(null===(t=n.errorBody)||void 0===t?void 0:t.errorCode)},rl=e=>{var t,{nodeStatus:n,output:o}=(0,eq.zz)().getNodeExecResult(e)||{},r=null===(t=(0,eM.rsR)().data)||void 0===t?void 0:t.settingOnError;if(!!(null==r?void 0:r.settingOnErrorIsOpen)&&n===eM.nBi.Success&&!!rr(o))return((null==r?void 0:r.processType)||ro.A.RETURN)===ro.A.EXCEPTION?eR.o.t("workflow_250421_01",void 0,"异常，执行异常流程"):eR.o.t("workflow_250421_02",void 0,"异常，返回设定内容")},ra=n("575607"),{Text:ri}=tV.ZT,rs=e=>{var t,{node:n}=e,{id:o,flowNodeType:r}=n,{playgroundProps:l,projectId:a,spaceId:i,getProjectApi:s}=(0,eq.j1)(),d=r===eM.nyy.LLM,{hasExecuteResult:u,nodeStatus:c,nodeExeCost:v,tokenAndCost:p,needAuth:f,handleAuth:m,runProjectId:h,errorLevel:g}=rt(o),x=rl(o),{selectNode:_}=(0,F.PV)(),y=c===oY.nBi.Success,w=c===oY.nBi.Running,j="warning"===g,b="error"===g,N="pending"===g,k=l.defaultResultCollapseMode?"all":"end",C=!!h&&eM.XmD.includes(r),S=(0,eE.useMemo)(()=>y?"green":b?"red":w?"blue":j?"yellow":void 0,[y,b,w,j]);return(0,eT.jsx)(oX.Dd,{defaultShowDetail:"all"===k,hasExecuteResult:u,needAuth:f,onAuth:m,hasConversation:C,onJumpToProjectConversation:()=>{var e=s();a&&e?e.sendMsgOpenWidget("/session",{name:"tab",data:{value:"testrun"}}):window.open("/space/".concat(i,"/project-ide/").concat(h,"/session"))},header:(0,eT.jsxs)(eT.Fragment,{children:[w?(0,eT.jsx)(tV.yC,{size:"small",wrapperClassName:ra.Z["spin-container"],indicator:(0,eT.jsx)(e8.zwE,{className:ti()(ra.Z["status-icon"])})}):y&&!j?(0,eT.jsx)(e8.w_1,{className:ra.Z["status-icon"]}):(0,eT.jsx)(eH.wR2,{className:ti()(ra.Z["status-icon"],"text-[20px]",{"text-[--semi-color-danger]":b,"text-[--semi-color-warning]":j,"text-[--semi-color-secondary]":N})}),(t=(()=>{if(w)return eR.o.t("workflow_detail_title_testrun_running",{},"Running");if(N)return eR.o.t("workflow_node_stoprun",{},"Run terminated");if(y)return x||eR.o.t("workflow_detail_title_testrun_succeed_node",{},"Succeed");else if(b)return eR.o.t("workflow_detail_title_testrun_failed_node",{},"Failed")})())?(0,eT.jsx)(ri,{className:ra.Z["font-normal"],ellipsis:{showTooltip:!0},"data-testid":"workflow.detail.node.testrun.status",children:t}):null,v?(0,eT.jsx)(eA.Vp,{size:"mini",color:S,className:"shrink-0",children:v}):null,d&&u?(0,eT.jsx)(oQ.E,{tokenAndCost:p||{},popoverProps:{position:"top"},className:"leading-none",children:(0,eT.jsx)(eA.Vp,{suffixIcon:(0,eT.jsx)(eH.L03,{}),size:"mini",color:S,children:eR.o.t("analytic_query_table_title_tokens")})}):null]}),extraBtns:[eM.nyy.Database,eM.nyy.DatabaseQuery,eM.nyy.DatabaseUpdate,eM.nyy.DatabaseDelete,eM.nyy.DatabaseCreate].includes("".concat(r))?[(0,eT.jsx)(o9,{})]:[],children:(0,eT.jsx)(o3,{id:o,node:n,onClick:e=>{e.stopPropagation(),_(e)},onOpenWorkflowLink:e=>{var{workflowId:t,executeId:n,subExecuteId:o}=e,r=s();if(a&&r)r.sendMsgOpenWidget("/workflow/".concat(t),{name:"debug",data:{executeId:n,subExecuteId:o}});else{var l=new URL(window.location.href),i=new URLSearchParams;i.append("space_id",l.searchParams.get("space_id")||"0"),i.append("workflow_id",t),i.append("execute_id",n),i.append("sub_execute_id",o),l.search=i.toString(),window.open(l.toString(),"_blank")}}})})},rd=e=>{var{node:t}=e,n=(0,eq.zz)(),{viewStatus:o}=(0,eq.j1)(),r=n.getNodeExecResult(t.id),{nodeStatus:l}=r||{},a=l===eM.nBi.Waiting,i=(o===eM.tnn.EXECUTING||o===eM.tnn.DONE)&&!!r&&!a;return(0,F.k9)(t)||!i?null:(0,eT.jsx)(rs,(0,er._)({},e))};function ru(e){var{children:t,className:n="",onClick:o}=e,[r,l]=(0,eE.useState)(!1),{startDrag:a,nodeRef:i,onFocus:s,onBlur:d}=(0,F.PV)(),u=(0,eE.useCallback)(()=>i.current||document.body,[i]);return(0,eT.jsx)(tV.iV,{getPopupContainer:u,children:(0,eT.jsx)("div",{className:n,onClick:e=>{!r&&(null==o||o(e))},ref:i,onFocus:s,onBlur:d,onDragStart:e=>{l(!0),a(e)},onMouseUp:()=>{l(!1)},draggable:!0,children:t})})}var rc=()=>{var e,t=(0,F.G2)(F.L4),n=(0,F.G2)(F.sS),o=(0,F.G2)(en.qq),r=(0,F.G2)(en.Re),l=(0,F.Dc)(),a=e=>{var t=null==e?void 0:e.parent;if((null==e?void 0:e.flowNodeType)===F.Sy.SUB_CANVAS)return e;if((null==t?void 0:t.flowNodeType)!==F.Sy.ROOT)return t};return(0,eE.useCallback)((e=(0,e7._)(function*(e,i){if(!l.config.readonly){var s=i.node,d=a(s),u=l.config.getPosFromMouseEvent(e),c=yield n.call({panelPosition:u,enableBuildLine:!0,fromPort:i,panelProps:{enableScrollClose:!0},canAddNode:e=>{var{nodeType:t}=e,n=o.canDropToNode({dragNodeType:t,dropNode:d});return!n.allowDrop&&eA.FN.warning({content:n.message}),n.allowDrop},customPosition(e){var{nodeType:n}=e,r=s.getData(F.eG).bounds,l={x:r.right+300,y:r.y},a=o.adjustSubNodePosition(n,d,l);return(0,F.n2)(t,a,d)}});return r.focusNode(c),c}}),function(t,n){return e.apply(this,arguments)}),[t,o,r,n,l])};function rv(){var{ports:e}=(0,F.PV)(),t=rc();return(0,eT.jsx)(eT.Fragment,{children:e.map(e=>(0,eT.jsx)(oL.J,{entity:e,onClick:t},e.id))})}var rp=n("64451"),rf=n("936344");function rm(){var e=(0,F.PF)(),t=(0,X.r8)(),{projectId:n}=(0,eq.j1)(),o=(0,eE.useCallback)(()=>{var o=e.getData(F.Ps).getFormModel(),r=o.getValueIn("trigger.isOpen"),l=null==o?void 0:o.formControl,a=new eM.m_1(e);return(0,eT.jsx)(F.l0,{control:l,children:(0,eT.jsx)(F.gN,{name:"nodeMeta",deps:["outputs","batchMode"],defaultValue:t,children:t=>{var l,i,s,d,u,c,v,p,f,m,h,{field:g,fieldState:x}=t;return(0,eT.jsx)(X.l7,(0,el._)((0,er._)({},g),{readonly:!!(null==a?void 0:null===(i=a.registry)||void 0===i?void 0:null===(l=i.meta)||void 0===l?void 0:l.headerReadonly),hideTest:!!(null==a?void 0:null===(d=a.registry)||void 0===d?void 0:null===(s=d.meta)||void 0===s?void 0:s.hideTest),readonlyAllowDeleteOperation:!!(null==a?void 0:null===(c=a.registry)||void 0===c?void 0:null===(u=c.meta)||void 0===u?void 0:u.headerReadonlyAllowDeleteOperation),showTrigger:!!(null===(f=a.registry)||void 0===f?void 0:null===(p=f.meta)||void 0===p?void 0:null===(v=p.showTrigger)||void 0===v?void 0:v.call(p,{projectId:n})),triggerIsOpen:r,outputsPath:"outputs",batchModePath:"batchMode",extraOperation:null==a?void 0:null===(h=a.registry)||void 0===h?void 0:null===(m=h.getHeaderExtraOperation)||void 0===m?void 0:m.call(h,o.getValues(),e),errors:(null==x?void 0:x.errors)||[]}))}})})},[t,e]);return(0,eT.jsx)("div",{className:rf.Z["node-render-new-header"],children:o()})}var{Text:rh,Title:rg}=tV.ZT,rx=e=>{var{node:t}=e,n=(0,eq.j1)(),{isNewNodeRender:o}=(0,eq.$v)(),r=t.getData(q.m).getNodeData(),l=t.getData(F.fu).getError(),{title:a,description:i}=r||{},s=(0,F.G2)(en.Re),d=![eM.nyy.Start,eM.nyy.End].includes(t.flowNodeType);return(0,eT.jsxs)("div",{className:o?"w-full p-12px":"h-[242px] w-[482px]",children:[(0,eT.jsxs)("div",{className:ti()("flex items-center space-x-2","absolute top-0 left-0","w-full h-[46px]","rounded-t-[7px]","px-4 py-3","bg-[--semi-color-danger-light-default]"),children:[(0,eT.jsx)(e8.crV,{size:"extra-large",className:"text-[#ff441e]"}),(0,eT.jsx)("span",{className:"text-[14px]",children:null==l?void 0:l.message})]}),(0,eT.jsxs)("div",{className:ti()("flex flex-col justify-center items-center space-y-[10px]","h-full","mt-[46px]"),children:[(0,eT.jsx)(oC.q,{nodeId:t.id,size:72}),(0,eT.jsx)(rg,{heading:6,children:a}),(0,eT.jsx)("div",{className:"max-w-[400px] max-h-[44px]",children:(0,eT.jsx)(rh,{type:"quaternary",ellipsis:{showTooltip:!0,rows:2},children:i})}),(0,eT.jsx)("div",{children:!n.readonly&&d?(0,eT.jsx)(tV.y3,{type:"tertiary",icon:(0,eT.jsx)(eH.dVD,{}),onClick:()=>{s.deleteNode(t)},children:eR.o.t("Delete")}):null})]})]})},r_=e=>{var{context:t}=e;return(0,eT.jsx)(rx,{node:t.node})};function ry(){var e=(0,F.PF)();return(0,eT.jsx)(rx,{node:e})}var rw=n("256659"),rj=n("931188"),rb=n("727508"),rN=n("765878"),rk=n("685091"),rC=n("108080"),rS=n("692883"),rI=n("490838"),rT=n("455262"),rE=n("253313"),rD=n("399163"),rZ=n("32448"),rM=n("813026"),rP=n("986999"),rL=n("43519"),rz=n("709253"),rO=n("510149"),rA=n("66856"),rF=n("198252"),rR=n("625802"),rV=n("711835"),rB=n("455543"),rG=n("280911"),rW=n("385647"),rU=n("364498"),rH=n("109207");function rJ(){var e=(0,F.PF)(),t=e.getData(F.QW);return(0,eE.useEffect)(()=>{if((0,rW.QY)(e.flowNodeType)){t.updateDynamicPorts();return}t.updateStaticPorts([{type:"input"},{type:"output",portID:"default"}])},[e,t]),(0,eT.jsx)(rH.G,{id:rU.Xg,type:"output"})}function rq(){var e,t=null===(e=(0,eM.rsR)().data)||void 0===e?void 0:e.settingOnError,n=(null==t?void 0:t.settingOnErrorIsOpen)&&(null==t?void 0:t.processType)===ro.A.EXCEPTION,o=(0,rB.Od)();return n&&o?(0,eT.jsxs)(rG.g,{label:eR.o.t("workflow_250407_201",void 0,"异常处理"),children:[(0,eT.jsx)("div",{className:"coz-fg-primary font-medium leading-4 text-md",children:eR.o.t("workflow_250407_202",void 0,"执行异常流程")}),(0,eT.jsx)(rJ,{})]}):null}var rK=n("339328"),rX=e=>{var{mergeGroup:t,index:n}=e,o=0!==n?"mt-[6px]":"";return(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)("div",{className:ti()("w-[69px] h-5 leading-5 truncate coz-fg-dim font-medium text-xs pr-0.5",o),children:t.name}),(0,eT.jsxs)("div",{className:ti()("space-y-2",o),children:[t.type?(0,eT.jsx)(rK._,{value:[t]}):null,(0,eT.jsx)(rK._,{value:t.variableTags,maxTagWidth:120})]})]})},rY=n("782000"),rQ=n("795250"),r$=n("883150"),r0=n("25232"),r1=n("399226"),r2=n("155440");function r4(){var{inputParameters:e}=(0,eM.rsR)(),t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(0,F.PF)(),n=(0,rQ.w)(t);return Array.isArray(e)?e.map(e=>{var o,r,l,a,i,s,d,u,{left:c,right:v}=e,p=n.getWorkflowVariableByKeyPath(null==c?void 0:null===(o=c.content)||void 0===o?void 0:o.keyPath,{node:t,checkScope:!0});if(!p)return{label:void 0,invalid:!0,type:void 0};var f=null==c?void 0:null===(l=c.content)||void 0===l?void 0:null===(r=l.keyPath)||void 0===r?void 0:r[1],m=null!==(s=null==c?void 0:null===(a=c.rawMeta)||void 0===a?void 0:a.type)&&void 0!==s?s:p.viewType;if((null==v?void 0:v.type)===eM.YX3.LITERAL&&(0,r2.Z)(null==v?void 0:v.content))return{label:f,invalid:!0,type:m};if((null==v?void 0:v.type)===eM.YX3.REF){;if(!n.getWorkflowVariableByKeyPath(null==v?void 0:null===(d=v.content)||void 0===d?void 0:d.keyPath,{node:t,checkScope:!0}))return{label:f,invalid:!0,type:m}}return{label:null!==(u=null===(i=p.viewMeta)||void 0===i?void 0:i.name)&&void 0!==u?u:p.keyPath[1],type:m}}).filter(Boolean):[]}(e),n=!t||0===t.length;return(0,eT.jsx)(r1.gN,{label:eR.o.t("workflow_detail_node_parameter_input"),isEmpty:n,children:(0,eT.jsx)(rK._,{value:t})})}var r5=n("633697"),r6=n("566785"),r3=n("531566"),r8=n("246200");function r9(e){var t;return{label:null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"",icon:null==e?void 0:e.icon_url}}var r7=n("465554"),le=e=>{var{skillTags:t=[]}=e;return(0,eT.jsx)(r7.u,{value:t,enableTooltip:!0,tagItemRenderer:e=>{var{icon:t,label:n}=e;return(0,eT.jsxs)("div",{className:"flex items-center leading-[20px]",children:[t?(0,eT.jsx)(eA.EZ,{size:"mini",shape:"square",src:t,className:"shrink-0 h-4 w-4 mr-1"}):null,(0,eT.jsx)("span",{className:"truncate",children:n})]})}})};function lt(e){var{label:t=eR.o.t("debug_skills")}=e,n=function(){var e,t,n,o,r,{data:l}=(0,eM.rsR)(),a=(null==l?void 0:l.fcParam)||{},i=(0,eq.j1)(),s=(0,F.PF)(),d=(0,eq.Zp)(),{data:u,refetch:c}=(0,r3.b)((0,er._)({workflowId:i.workflowId,spaceId:i.spaceId,nodeId:s.id,enabled:!(0,r6.ae)(a)},(0,r6.Vq)(a)));(0,eE.useEffect)(()=>{var e=d.onDependencyChange(e=>{var t,n;if(!!(null==e?void 0:null===(n=e.extra)||void 0===n?void 0:null===(t=n.nodeIds)||void 0===t?void 0:t.includes(s.id)))c()});return()=>{var t;null==e||null===(t=e.dispose)||void 0===t||t.call(e)}},[]);var v=[(0,r5.Z)((null===(e=a.pluginFCParam)||void 0===e?void 0:e.pluginList)||[],e=>e.plugin_id).map(e=>{var t;return r9(null==u?void 0:null===(t=u.plugin_detail_map)||void 0===t?void 0:t[e.plugin_id])}),null===(t=(null===(n=a.workflowFCParam)||void 0===n?void 0:n.workflowList)||[])||void 0===t?void 0:t.map(e=>{var t;return r9(null==u?void 0:null===(t=u.workflow_detail_map)||void 0===t?void 0:t[e.workflow_id])}),null===(o=(null===(r=a.knowledgeFCParam)||void 0===r?void 0:r.knowledgeList)||[])||void 0===o?void 0:o.map(e=>{var t;return r9(null==u?void 0:null===(t=u.dataset_detail_map)||void 0===t?void 0:t[e.id])})].flat();return!function(e,t,n){if(!!n){var o,r,l,a=[((null===(o=t.pluginFCParam)||void 0===o?void 0:o.pluginList)||[]).map(e=>{var t,o,r=null==n?void 0:null===(t=n.plugin_detail_map)||void 0===t?void 0:t[e.plugin_id],l=null==n?void 0:null===(o=n.plugin_api_detail_map)||void 0===o?void 0:o[e.api_id];return{type:r8.n.Plugin,pluginId:e.plugin_id,apiId:e.api_id,apiName:null==l?void 0:l.name,pluginName:null==r?void 0:r.name,icon:null==r?void 0:r.icon_url}}),((null===(r=t.workflowFCParam)||void 0===r?void 0:r.workflowList)||[]).map(e=>{var t,o=null==n?void 0:null===(t=n.workflow_detail_map)||void 0===t?void 0:t[e.workflow_id];return{type:r8.n.Workflow,pluginId:e.plugin_id,workflowId:e.workflow_id,name:null==o?void 0:o.name,icon:null==o?void 0:o.icon_url}}),((null===(l=t.knowledgeFCParam)||void 0===l?void 0:l.knowledgeList)||[]).map(e=>{var t,o=null==n?void 0:null===(t=n.dataset_detail_map)||void 0===t?void 0:t[e.id];return{id:e.id,type:r8.n.Dataset,name:null==o?void 0:o.name,icon:null==o?void 0:o.icon_url}})].flat();e.getData(q.m).updateNodeData({skills:a})}}(s,a,u),v}(),o=!n||0===n.length;return(0,eT.jsx)(rG.g,{label:t,isEmpty:o,children:(0,eT.jsx)(le,{skillTags:n})})}function ln(){return(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(r1.EU,{}),(0,eT.jsx)(r1.yC,{}),(0,eT.jsx)(r1.N8,{})]})}var lo=n("962289");function lr(e){var{src:t}=e;return(0,eT.jsx)(eA.qE,{className:"w-[16px] h-[16px]",shape:"square",src:t})}var ll=n("73238"),la=n("83928"),li=n("684595"),ls=n("648159"),ld=n("303052"),lu=n("228984"),lc=[n("647772"),lu,ld,ls,li,la,ll];function lv(){var e,{data:t}=(0,eM.rsR)(),n=null===(e=(0,lo.Z)(t,"references")||(0,lo.Z)(t,"inputs.references"))||void 0===e?void 0:e.filter(e=>{var{preprocessor:t}=e;return void 0!==t});return(0,eT.jsx)(r1.gN,{contentClassName:"flex gap-[6px]",label:eR.o.t("Imageflow_reference_image"),isEmpty:!n||0===n.length,children:(0,eT.jsx)(r1.uL,{value:null==n?void 0:n.map(e=>{var{preprocessor:t}=e;return{label:eR.o.t("Imageflow_reference".concat(t)),icon:(0,eT.jsx)(lr,{src:lc[t-1]})}})})})}var lp=n("545119"),lf=n("39546"),lm=n("332438"),lh=n("615805"),lg=n("791226"),lx=n("763820"),l_=n("127466"),ly=[n("746507"),l_,lx,lg,lh,lm,lf,lp];function lw(){var{data:e}=(0,eM.rsR)(),t=(0,lo.Z)(e,"modelSetting.model")||(0,lo.Z)(e,"inputs.modelSetting.model");return(0,eT.jsx)(r1.gN,{label:eR.o.t("Imageflow_model"),isEmpty:!t,children:(0,eT.jsx)(r1.uL,{value:[{label:eR.o.t("Imageflow_model".concat(t)),icon:(0,eT.jsx)(lr,{src:ly[t-1]})}]})})}var lj=n("75524");function lb(){(0,eq.s5)();var{data:e}=(0,eq.ui)(),{openDatabaseDetail:t}=(0,o8.T)(),n=e?[{icon:(0,eT.jsx)("img",{src:e.iconUrl,className:"w-[16px] h-[16px] rounded-mini"}),label:e.tableName}]:[];return(0,eT.jsx)(r1.gN,{label:eR.o.t("workflow_database_node_database_table_title"),isEmpty:!e,children:(0,eT.jsx)("div",{className:"inline-flex cursor-pointer",onClick:()=>t(),children:(0,eT.jsx)(r1.uL,{value:n})})})}var lN=n("109870");function lk(){return(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(r1.EU,{}),(0,eT.jsx)(r1.yC,{})]})}var lC=n("82402"),lS={[eM.nyy.Start]:rC.m,[eM.nyy.End]:rO.z,[eM.nyy.If]:rz.X,[eM.nyy.Intent]:rM.U,[eM.nyy.SubWorkflow]:rk.g,[eM.nyy.Dataset]:ln,[eM.nyy.DatasetWrite]:ln,[eM.nyy.Question]:function(){return(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(r1.EU,{}),(0,eT.jsx)(r1.yC,{}),(0,eT.jsx)(r1.An,{})]})},[eM.nyy.Output]:rT.y,[eM.nyy.LLM]:function(){return(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(r1.EU,{}),(0,eT.jsx)(r1.yC,{}),(0,eT.jsx)(r1.Hn,{}),(0,eT.jsx)(lt,{})]})},[eM.nyy.Loop]:rD.a,[eM.nyy.Break]:rR.L,[eM.nyy.Continue]:rA.c,[eM.nyy.SetVariable]:rS.M,[eM.nyy.Batch]:rV.n,[eM.nyy.ImageGenerate]:function(){return(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(r1.EU,{}),(0,eT.jsx)(r1.yC,{}),(0,eT.jsx)(lw,{}),(0,eT.jsx)(lv,{})]})},[eM.nyy.Input]:rP.o,[eM.nyy.Database]:function(){return(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(r1.EU,{}),(0,eT.jsx)(r1.yC,{}),(0,eT.jsx)(lb,{})]})},[eM.nyy.VariableMerge]:function(){var e=function(){var e,t=(0,F.PF)(),n=(0,rQ.w)(t),{data:o}=(0,eM.rsR)(),r=(0,eq.zz)().getNodeExecResult(t.id);return((null==o?void 0:null===(e=o.inputs)||void 0===e?void 0:e.mergeGroups)||[]).map((e,o)=>{var l,a=((null==e?void 0:e.variables)||[]).map((e,l)=>{var a,i,s,d,u,c,v,p=n.getWorkflowVariableByKeyPath(null==e?void 0:null===(a=e.content)||void 0===a?void 0:a.keyPath,{node:t}),f=eM.nZF.isLiteral(e),m=!f&&!n.getWorkflowVariableByKeyPath(null==e?void 0:null===(i=e.content)||void 0===i?void 0:i.keyPath,{node:t,checkScope:!0}),h=(0,rY.B)(o,l,r),g="";return g=f?String(null!==(d=null==e?void 0:e.content)&&void 0!==d?d:""):null!==(c=null==p?void 0:null===(u=p.viewMeta)||void 0===u?void 0:u.name)&&void 0!==c?c:"",{type:null!==(v=null==e?void 0:null===(s=e.rawMeta)||void 0===s?void 0:s.type)&&void 0!==v?v:null==p?void 0:p.viewType,label:g,invalid:m,status:h?rK.a.Success:void 0}}).filter(e=>e.type&&r$.z[e.type]),i=null===(l=a[0])||void 0===l?void 0:l.type,s=i?eM.IuB[i]:"";return{name:e.name,label:s||"-",type:i,variableTags:a}})}();return(0,eT.jsx)(eT.Fragment,{children:e.map((e,t)=>(0,eT.jsx)(rX,{mergeGroup:e,index:t},e.name))})},[eM.nyy.VariableAssign]:function(){return(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(r0.n,{children:(0,eT.jsx)(r4,{})}),(0,eT.jsx)(r1.yC,{})]})},[eM.nyy.Http]:function(){return(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(r1.yJ,{}),(0,eT.jsx)(r1.yC,{})]})},[eM.nyy.DatabaseCreate]:function(){return(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(r1.yC,{}),(0,eT.jsx)(lb,{}),(0,eT.jsx)(r1.v3,{label:eR.o.t("workflow_setting_fields"),name:lj.f_})]})},[eM.nyy.DatabaseDelete]:function(){return(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(r1.yC,{}),(0,eT.jsx)(lb,{}),(0,eT.jsx)(r1.hK,{label:eR.o.t("workflow_delete_conditon_title"),name:lj.W})]})},[eM.nyy.DatabaseUpdate]:function(){return(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(r1.yC,{}),(0,eT.jsx)(lb,{}),(0,eT.jsx)(lN.h,{label:eR.o.t("workflow_update_condition_title"),name:lj.Bf}),(0,eT.jsx)(r1.v3,{label:eR.o.t("workflow_update_fields"),name:lj.PM})]})},[eM.nyy.DatabaseQuery]:function(){return(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(r1.yC,{}),(0,eT.jsx)(lb,{}),(0,eT.jsx)(r1.hK,{label:eR.o.t("workflow_query_condition_title"),name:lj._r})]})},[eM.nyy.LTM]:rE.o,[eM.nyy.Code]:rF.K,[eM.nyy.TriggerUpsert]:rj.H,[eM.nyy.ImageCanvas]:rL.j,[eM.nyy.TriggerDelete]:rN.h,[eM.nyy.TriggerRead]:rb.D,[eM.nyy.Api]:rI.Bk,[eM.nyy.Variable]:rw.S,[eM.nyy.JsonStringify]:rZ.s};function lI(){var{type:e}=(0,eM.rsR)(),t=lS[e]||lk;return(0,eT.jsxs)("div",{className:lC.Z.wrapper,children:[(0,eT.jsx)(t,{}),(0,eT.jsx)(rq,{})]})}var lT=n("995530");function lE(e){var{node:t}=e,n=(0,eq.j1)(!1),o=(0,eq.IE)(),{selected:r,selectNode:l}=(0,F.PV)(),{isError:a,isInitialized:i}=(0,eM.rsR)(),s=(0,oJ.j0)(e=>e.openNodeSideSheet),d=(0,oq.X)();return(0,eT.jsx)(oH.SV,{FallbackComponent:()=>(0,eT.jsx)(ry,{}),errorBoundaryName:"workflow-node-render",logger:oH.kg,children:(0,eT.jsxs)(ru,{className:ti()(lT.Z["node-render"],{[lT.Z.selected]:r}),onClick:e=>{l(e),n.viewStatus!==ow.tn.EXECUTING&&!a&&(o.closeCommonSheet(),s(),d.open(oK.Gd.NodeForm,"right",{node:t}))},children:[a?(0,eT.jsx)(ry,{}):null,a||i?null:(0,eT.jsx)(rp.V,{}),!a&&i?(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(rd,{node:t}),(0,eT.jsx)(rm,{}),(0,eT.jsx)(lI,{})]}):null,(0,eT.jsx)(rv,{})]})})}function lD(e){var{node:t}=e;return(0,eT.jsx)(oU.g,{node:t,scene:"new-node-render",children:(0,eT.jsx)(lE,(0,er._)({},e))})}var lZ=n("308079"),lM=n("151102"),lP=n("47611"),lL=n("24201"),lz=(0,lZ.G)((0,eT.jsx)(lP.r,{})),lO=(0,lZ.G)((0,eT.jsx)(lL.r,{}));(0,lZ.G)((0,eT.jsx)(lM.r,{}));var{Title:lA}=tV.ZT,lF=()=>{var e=eR.o.getLanguages()[0];return(0,eT.jsxs)("div",{className:"w-[420px]",children:[(0,eT.jsx)(lA,{heading:6,children:eR.o.t("workflow_running_results_line_error")}),(0,eT.jsx)("div",{className:"flex mt-2",children:"zh-CN"===e||"zh"===e?(0,eT.jsx)(lO,{}):(0,eT.jsx)(lz,{})})]})},lR=e=>{var{className:t,line:n,isHovered:o}=e,r=(0,eI._)(e,["className","line","isHovered"]),{hasError:l,bezier:a,position:i}=n,{bbox:s}=a,d=e=>({x:e.x-s.x+12,y:e.y-s.y+12}),u=d(i.from),c=d(i.to),v=s.x+Math.abs((c.x-u.x)/2),p=s.y+Math.abs((c.y-u.y)/2);return(0,eT.jsx)(tV.J2,(0,el._)((0,er._)({className:ti()("p-4",t),showArrow:!0,content:()=>(0,eT.jsx)(lF,{}),visible:o&&l},r),{children:(0,eT.jsx)("div",{style:{left:v,top:p,position:"absolute"}})}))},lV=n("9430"),lB=n("566906"),lG=n("62257"),lW=n("878011"),lU=n("732562");var lH=((r={}).Size="size",r.Note="note",r);var lJ=((l={}).Change="change",l.MultiSelect="multiSelect",l.Select="select",l.Blur="blur",l);var lq=((a={}).Paragraph="paragraph",a.HeadingOne="heading-one",a.HeadingTwo="heading-two",a.HeadingThree="heading-three",a.Blockquote="block-quote",a.BulletedList="bulleted-list",a.NumberedList="numbered-list",a.ListItem="list-item",a),lK=["bulleted-list","numbered-list"];var lX=((i={}).Bold="bold",i.Italic="italic",i.Underline="underline",i.Strikethrough="strikethrough",i.Link="link",i),lY=[{type:"paragraph",children:[{text:""}]}],lQ=JSON.stringify(lY),l$="about:blank";s=M||(M={}),d=e=>e.text,u=e=>{var t=e.children.map(e=>"text"in e?d(e):f(e)).join("");return"".concat(t,"\n")},c=e=>{var t=e.children.map(e=>"text"in e?d(e):"").join("");return"".concat(t,"\n")},v=e=>{var t=e.children.map(e=>"text"in e?e.text:f(e)).join("").trim();return"".concat(t,"\n")},p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.children.map(e=>{if("type"in e&&e.type===lq.ListItem){var n=e.children.map(e=>"text"in e?d(e):e.type===lq.BulletedList||e.type===lq.NumberedList?p(e,"".concat(t,"  ")):"").join("");return"".concat(t).concat(n,"\n")}return""}).join("")},f=e=>{switch(e.type){case lq.Paragraph:return u(e);case lq.HeadingOne:case lq.HeadingTwo:case lq.HeadingThree:return c(e);case lq.Blockquote:return v(e);case lq.BulletedList:case lq.NumberedList:return p(e);default:return""}},s.to=e=>e.map(e=>f(e)).join("").trim(),m=P||(P={}),h=e=>{var t=e.text;return e[lX.Bold]&&(t="**".concat(t,"**")),e[lX.Italic]&&(t="*".concat(t,"*")),e[lX.Underline]&&(t="__".concat(t,"__")),e[lX.Strikethrough]&&(t="~~".concat(t,"~~")),e[lX.Link]&&(t="[".concat(t,"](").concat(e[lX.Link],")")),t},g=e=>{var t=e.children.map(e=>"text"in e?h(e):w(e)).join("");return"".concat(t,"\n\n")},x=e=>{var t=e.children.map(e=>"text"in e?h(e):"").join(""),n=e.type===lq.HeadingOne?1:e.type===lq.HeadingTwo?2:3;return"".concat("#".repeat(n)," ").concat(t,"\n\n")},_=e=>{var t=e.children.map(e=>"text"in e?h(e):e.type===lq.Paragraph?g(e).trimEnd():w(e)).join("\n").trim();return"".concat(t.split("\n").map(e=>"> ".concat(e)).join("\n"),"\n\n")},y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.type===lq.NumberedList,o=1,r=e.children.map(e=>{if("type"in e&&e.type===lq.ListItem){var r=e.children.map(e=>"text"in e?h(e):e.type===lq.BulletedList||e.type===lq.NumberedList?y(e,"".concat(t,"  ")):"").join(""),l=n?"".concat(o,". "):"- ";return o++,"".concat(t).concat(l).concat(r,"\n")}return""}).join("");return"".concat(r,"\n")},w=e=>{switch(e.type){case lq.Paragraph:return g(e);case lq.HeadingOne:case lq.HeadingTwo:case lq.HeadingThree:return x(e);case lq.Blockquote:return _(e);case lq.BulletedList:case lq.NumberedList:return y(e);default:return""}},m.to=e=>e.map(e=>w(e)).join("").trim(),j=L||(L={}),b=e=>"text"in e&&!e.type?(0,el._)((0,er._)({},e),{type:"text"}):"type"in e&&"children"in e?(0,el._)((0,er._)({},e),{children:e.children.map(b)}):e,N=e=>e.map(b),j.from=e=>{if(!e||""===e)return lY;try{return JSON.parse(e)}catch(e){return}},j.to=e=>{try{return JSON.stringify(N(e))}catch(e){return}},k=z||(z={}),C=e=>{var t=e.text;return e[lX.Bold]&&(t="<strong>".concat(t,"</strong>")),e[lX.Italic]&&(t="<em>".concat(t,"</em>")),e[lX.Underline]&&(t="<u>".concat(t,"</u>")),e[lX.Strikethrough]&&(t="<del>".concat(t,"</del>")),e[lX.Link]&&(t='<a href="'.concat(e[lX.Link],'">').concat(t,"</a>")),t},S=e=>{var t=e.children.map(e=>"text"in e?C(e):D(e)).join("");return"<p>".concat(t,"</p>")},I=e=>{var t=e.children.map(e=>"text"in e?C(e):"").join(""),n=e.type===lq.HeadingOne?1:e.type===lq.HeadingTwo?2:3;return"<h".concat(n,">").concat(t,"</h").concat(n,">")},T=e=>{var t=e.children.map(e=>"text"in e?C(e):D(e)).join("");return"<blockquote><p>".concat(t,"</p></blockquote>")},E=e=>{var t=e.type===lq.NumberedList?"ol":"ul",n=e.children.map(e=>{if("type"in e&&e.type===lq.ListItem){var t=e.children.map(e=>"text"in e?C(e):e.type===lq.BulletedList||e.type===lq.NumberedList?E(e):"").join("");return"<li>".concat(t,"</li>")}return""}).join("");return"<".concat(t,">").concat(n,"</").concat(t,">")},D=e=>{switch(e.type){case lq.Paragraph:return S(e);case lq.HeadingOne:case lq.HeadingTwo:case lq.HeadingThree:return I(e);case lq.Blockquote:return T(e);case lq.BulletedList:case lq.NumberedList:return E(e);default:return""}},k.to=e=>e.map(e=>D(e)).join(""),(Z=O||(O={})).fromJSON=L.from,Z.toJSON=L.to,Z.toText=M.to,Z.toMarkdown=P.to,Z.toHTML=z.to;class l0{get value(){return this.innerValue}setValue(e){var t=null!=e?e:lQ;if(t===this.innerValue)return;var n=this.deserialize(t);if(!!n)this.innerValue=t,this.innerBlocks=n,this.syncEditorValue(),this.emitter.emit(lJ.Change,{blocks:this.innerBlocks,value:this.innerValue})}get blocks(){return this.innerBlocks}get element(){try{return lB.F3.toDOMNode(this.editor,this.editor)}catch(e){return null}}registerCommand(e){return this.commands.push(e),this}keydown(e){var{ctrlKey:t,metaKey:n,shiftKey:o,key:r}=e,l=t||n;this.commands.filter(e=>e.key===r).filter(e=>void 0===e.modifier||e.modifier===l).filter(e=>void 0===e.shift||e.shift===o).forEach(t=>{t.exec({model:this,event:e})})}paste(e){var t=e.clipboardData.getData("application/x-slate-fragment"),n=decodeURIComponent(window.atob(t));if(!n)return;var o=JSON.parse(n);if(!!o&&!!Array.isArray(o)&&0!==o.length)this.isBlockMarked(lq.ListItem)&&this.markBlock(lq.Paragraph)}on(e,t){return this.emitter.on(e,t),()=>{this.emitter.off(e,t)}}setFocus(e){e&&!this.focused?lB.F3.focus(this.editor):!e&&this.focused&&(lB.F3.blur(this.editor),lB.F3.deselect(this.editor),this.emitter.emit(lJ.Blur,{}))}selectEnd(){var e=Array.from(lW.ML.nodes(this.editor,{at:[],match:e=>lW.ML.isBlock(this.editor,e)}));if(0!==e.length){var t=e[e.length-1][1],n=lW.ML.end(this.editor,t);lW.YR.select(this.editor,{anchor:n,focus:n})}}get focused(){return lB.F3.isFocused(this.editor)}fireChange(){var e=this;return(0,e7._)(function*(){e.editor.operations.some(e=>"set_selection"!==e.type)&&e.change();var{selection:t}=e.editor;t&&(lW.e6.isCollapsed(t)?e.select():e.multiSelect())})()}markBlock(e){var t=this.isBlockMarked(e),n=lK.includes(e);lW.YR.unwrapNodes(this.editor,{match:e=>!lW.ML.isEditor(e)&&lW.W_.isElement(e)&&lK.includes(e.type),split:!0});var o={type:t?lq.Paragraph:n?lq.ListItem:e};if(lW.YR.setNodes(this.editor,o),!t){if(n){lW.YR.wrapNodes(this.editor,{type:e,children:[]});return}}}isBlockMarked(e){var{selection:t}=this.editor;if(!t)return!1;var[n]=Array.from(lW.ML.nodes(this.editor,{at:lW.ML.unhangRange(this.editor,t),match:t=>!lW.ML.isEditor(t)&&lW.W_.isElement(t)&&t.type===e}));return!!n}markLeaf(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.isLeafMarked(e)?lW.ML.removeMark(this.editor,e):lW.ML.addMark(this.editor,e,t)}isLeafMarked(e){var t=lW.ML.marks(this.editor);return!!t&&!!t[e]}getLeafValue(e){var t=lW.ML.marks(this.editor);return null==t?void 0:t[e]}setLeafValue(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];lW.ML.addMark(this.editor,e,t)}clearFormat(){Object.values(lX).forEach(e=>{lW.ML.removeMark(this.editor,e)}),this.markBlock(lq.Paragraph)}getBlockText(){var{selection:e}=this.editor,t={text:"",before:"",after:""};if(!(null==e?void 0:e.anchor))return t;var n=lW.ML.above(this.editor,{match:e=>lW.W_.isElement(e)&&lW.ML.isBlock(this.editor,e)});if(!n)return t;var[o,r]=n;if(!lW.W_.isElement(o))return t;var l=lW.NB.string(o),a={anchor:lW.ML.start(this.editor,r),focus:e.anchor},i=lW.ML.string(this.editor,a),s=l.slice(i.length);return{text:l,before:i,after:s}}createEditor(){return this.withInsertBreak((0,lB.BU)((0,lG.VC)((0,lW.Jh)())))}get initialized(){return Array.isArray(this.editor.children)&&this.editor.children.length>0}syncEditorValue(){if(!!this.initialized)try{lW.ML.withoutNormalizing(this.editor,()=>{lW.YR.delete(this.editor,{at:{anchor:lW.ML.start(this.editor,[]),focus:lW.ML.end(this.editor,[])}}),lW.YR.select(this.editor,lW.ML.start(this.editor,[])),this.editor.children=this.blocks})}catch(e){console.error("@CommentEditorModel::SyncEditorValue::Error",e)}}withInsertBreak(e){var{insertBreak:t}=e;return e.insertBreak=()=>{var{selection:n}=e;if(!n||!lW.e6.isCollapsed(n)){t();return}var o=lW.ML.above(e,{match:t=>lW.W_.isElement(t)&&lW.ML.isBlock(e,t)}),{after:r}=this.getBlockText();if(!o||""!==r){t();return}var[l,a]=o,i=l.type;t();var s=lW.y$.next(a);![lq.NumberedList,lq.BulletedList,lq.ListItem,lq.Blockquote].includes(i)&&this.clearFormatAtPath(s),lW.YR.select(e,lW.ML.start(e,s))},e}clearFormatAtPath(e){lW.YR.select(this.editor,e),this.clearFormat()}change(){this.innerBlocks=this.editor.children;var e=this.serialize(this.innerBlocks);if(!!e)this.innerValue=e,this.emitter.emit(lJ.Change,{blocks:this.innerBlocks,value:this.innerValue})}select(){var{selection:e}=this.editor;if(!!e&&""===lW.ML.string(this.editor,e))this.emitter.emit(lJ.Select,{})}multiSelect(){var{selection:e}=this.editor;if(!!e&&""!==lW.ML.string(this.editor,e))this.emitter.emit(lJ.MultiSelect,{})}serialize(e){return O.toJSON(e)}deserialize(e){return O.fromJSON(e)}constructor(){this.commands=[],this.emitter=new lU.Z,this.editor=this.createEditor(),this.innerValue=lQ,this.innerBlocks=lY}}var l1={key:"a",modifier:!0,exec:e=>{var{model:t,event:n}=e;n.preventDefault(),lW.YR.select(t.editor,{anchor:lW.ML.start(t.editor,[]),focus:lW.ML.end(t.editor,[])})}},l2={key:"b",modifier:!0,exec:e=>{var{model:t,event:n}=e;n.preventDefault(),t.markLeaf(lX.Bold)}},l4={key:"i",modifier:!0,exec:e=>{var{model:t,event:n}=e;n.preventDefault(),t.markLeaf(lX.Italic)}},l5={key:"u",modifier:!0,exec:e=>{var{model:t,event:n}=e;n.preventDefault(),t.markLeaf(lX.Underline)}},l6={key:"s",modifier:!0,exec:e=>{var{model:t,event:n}=e;n.preventDefault(),t.markLeaf(lX.Strikethrough)}},l3={key:"o",modifier:!0,exec:e=>{var{model:t,event:n}=e;n.preventDefault(),t.markBlock(lq.Paragraph)}},l8={key:"1",modifier:!0,exec:e=>{var{model:t,event:n}=e;n.preventDefault(),t.markBlock(lq.HeadingOne)}},l9={key:"2",modifier:!0,exec:e=>{var{model:t,event:n}=e;n.preventDefault(),t.markBlock(lq.HeadingTwo)}},l7={key:"3",modifier:!0,exec:e=>{var{model:t,event:n}=e;n.preventDefault(),t.markBlock(lq.HeadingThree)}},ae={key:"Enter",shift:!1,exec:e=>{var{model:t,event:n}=e;if(n.nativeEvent.isComposing)return;var o=!t.getBlockText().text,r=!t.isBlockMarked(lq.Paragraph);if(!!o&&!!r)n.preventDefault(),t.clearFormat()}},at={key:"Backspace",shift:!1,exec:e=>{var{model:t,event:n}=e,o=!t.getBlockText().before,r=!t.isBlockMarked(lq.Paragraph);if(!!o&&!!r)n.preventDefault(),t.clearFormat()}},an=[[/^#$/,lq.HeadingOne],[/^##$/,lq.HeadingTwo],[/^###$/,lq.HeadingThree],[/^>$/,lq.Blockquote],[/^-$/,lq.BulletedList],[/^\*$/,lq.BulletedList],[/^1\.$/,lq.NumberedList]],ao=(e,t)=>{Array.from(t).forEach(()=>{lW.ML.deleteBackward(e.editor,{unit:"character"})})},ar=(e,t)=>{var n=an.find(e=>{var[n]=e;return n.test(t)});if(n){var[,o]=n;return ao(e,t),e.markBlock(o),!0}return!1},al={key:" ",exec:e=>{var{model:t,event:n}=e;if(n.nativeEvent.isComposing)return;var{before:o}=t.getBlockText();if(!!o)ar(t,o)&&n.preventDefault()}},aa=()=>new l0().registerCommand(l2).registerCommand(l4).registerCommand(l5).registerCommand(l6).registerCommand(l3).registerCommand(l8).registerCommand(l9).registerCommand(l7).registerCommand(al).registerCommand(l1).registerCommand(ae).registerCommand(at),ai=()=>{var e=(0,F.km)(),{selected:t}=(0,F.PV)(),n=e.getData(F.Ps).getFormModel(),o=(0,eE.useMemo)(aa,[]);return(0,eE.useEffect)(()=>{if(!t)o.setFocus(t)},[t,o]),(0,eE.useEffect)(()=>{var e=n.getValueIn(lH.Note);o.setValue(e),o.selectEnd()},[n,o]),(0,eE.useEffect)(()=>{var e=n.onFormValuesChange(e=>{var{name:t}=e;if(t===lH.Note){var r=n.getValueIn(lH.Note);o.setValue(r)}});return()=>e.dispose()},[n,o]),o},as=()=>{var e,t,n=(0,F.PF)(),o=n.getNodeMeta(),r=(0,F.Dc)(),l=(0,F.G2)(F.qp),{size:a={width:240,height:150}}=o,i=n.getData(F.VO),s=n.getData(F.Ps).getFormModel(),d=s.getValueIn(lH.Size),[u,c]=(0,eE.useState)(null!==(e=null==d?void 0:d.width)&&void 0!==e?e:a.width),[v,p]=(0,eE.useState)(null!==(t=null==d?void 0:d.height)&&void 0!==t?t:a.height);(0,eE.useEffect)(()=>{!s.getValueIn(lH.Size)&&s.setValueIn(lH.Size,{width:u,height:v})},[s,u,v]),(0,eE.useEffect)(()=>{var e=s.onFormValuesChange(e=>{var{name:t}=e;if(t!==lH.Size)return;var n=s.getValueIn(lH.Size);if(!!n)c(n.width),p(n.height)});return()=>e.dispose()},[s]);var f=(0,eE.useCallback)(()=>{var e={width:u,height:v,originalWidth:u,originalHeight:v,positionX:i.position.x,positionY:i.position.y,offsetX:0,offsetY:0};return{resizing:t=>{if(!!e){var{zoom:n}=r.config,o=t.top/n,l=t.right/n,a=t.bottom/n,s=t.left/n,d=Math.max(120,e.originalWidth+l-s),u=Math.max(80,e.originalHeight+a-o),v=(s>0||l<0)&&d<=120?e.offsetX:s/2+l/2,f=(o>0||a<0)&&u<=80?e.offsetY:o,m=e.positionX+v,h=e.positionY+f;e.width=d,e.height=u,e.offsetX=v,e.offsetY=f,c(d),p(u),i.update({position:{x:m,y:h}})}},resizeEnd:()=>{l.transact(()=>{l.pushOperation({type:F.Nj.dragNodes,value:{ids:[n.id],value:[{x:e.positionX+e.offsetX,y:e.positionY+e.offsetY}],oldValue:[{x:e.positionX,y:e.positionY}]}},{noApply:!0}),s.setValueIn(lH.Size,{width:e.width,height:e.height})})}}},[n,u,v,i,r,s,l]);return{width:u,height:v,onResize:f}},ad=e=>{var{model:t,height:n}=e,o=(0,F.Dc)(),[r,l]=(0,eE.useState)(!1),a=(0,eE.useCallback)(()=>{if(!t.element)return!1;var e=n*o.config.zoom,{height:r}=t.element.getBoundingClientRect();return r>e},[t,n,o]),i=(0,eE.useCallback)(()=>{l(a())},[a]);return(0,eE.useEffect)(()=>{i()},[n,i]),(0,eE.useEffect)(()=>{var e=t.on(lJ.Change,()=>{i()});return()=>{e()}},[t,i]),{overflow:r,updateOverflow:i}},au=e=>{var{model:t,containerRef:n}=e,o=t.getLeafValue(lX.Link),r="flex items-center gap-[2px] w-auto h-[24px] p-[4px] rounded-[6px] hover:bg-[var(--coz-mg-primary)] cursor-pointer select-none",l="text-[var(--coz-fg-hglt)] bg-[var(--coz-mg-hglt)] hover:bg-[var(--coz-mg-hglt-hovered)]",a="w-[1px] h-[16px] bg-[var(--coz-stroke-primary)]",i="w-full h-[32px] p-[8px] text-[14px] flex gap-[8px] items-center rounded-[5px] cursor-pointer select-none hover:bg-[var(--coz-mg-primary)]",s="text-[var(--coz-fg-hglt)] bg-[var(--coz-mg-hglt)] hover:bg-[var(--coz-mg-hglt-hovered)]";return(0,eT.jsxs)("div",{className:ti()("workflow-comment-toolbar absolute left-[-140px]",t.isLeafMarked(lX.Link)?"top-[-48px]":"top-[-14px]"),children:[(0,eT.jsxs)("div",{className:"flex items-center gap-[3px] h-[32px] p-[4px] w-auto bg-[var(--coz-bg-max)] rounded-[8px] border-[1px] border-solid border-[var(--coz-stroke-primary)]",style:{boxShadow:"0px 4px 12px 0px rgba(0, 0, 0, 0.08), 0px 8px 24px 0px rgba(0, 0, 0, 0.04)"},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[(0,eT.jsx)(eA.Lt,{position:"bottom",trigger:"hover",clickToHide:!0,getPopupContainer:()=>n.current,render:(0,eT.jsxs)("div",{className:"flex flex-col gap-[2px] justify-start items-center w-[120px] p-[4px] rounded-[8px] border-[0.5px] border-solid border-[var(--coz-stroke-primary)] bg-[var(--coz-bg-max)]",style:{boxShadow:"0px 8px 24px 0px rgba(0, 0, 0, 0.16), 0px 16px 48px 0px rgba(0, 0, 0, 0.08)"},children:[(0,eT.jsxs)("div",{className:ti()(i,{[s]:t.isBlockMarked(lq.Paragraph)}),onClick:e=>{t.markBlock(lq.Paragraph)},children:[(0,eT.jsx)(eH.z8b,{className:"text-xxl"}),(0,eT.jsx)("p",{children:eR.o.t("workflow_note_main_text")})]}),(0,eT.jsxs)("div",{className:ti()(i,{[s]:t.isBlockMarked(lq.HeadingOne)}),onClick:e=>{t.markBlock(lq.HeadingOne)},children:[(0,eT.jsx)(eH.gVT,{className:"text-xxl"}),(0,eT.jsxs)("p",{children:[eR.o.t("workflow_note_heading")," 1"]})]}),(0,eT.jsxs)("div",{className:ti()(i,{[s]:t.isBlockMarked(lq.HeadingTwo)}),onClick:e=>{t.markBlock(lq.HeadingTwo)},children:[(0,eT.jsx)(eH.CLD,{className:"text-xxl"}),(0,eT.jsxs)("p",{children:[eR.o.t("workflow_note_heading")," 2"]})]}),(0,eT.jsxs)("div",{className:ti()(i,{[s]:t.isBlockMarked(lq.HeadingThree)}),onClick:e=>{t.markBlock(lq.HeadingThree)},children:[(0,eT.jsx)(eH.V_G,{className:"text-xxl"}),(0,eT.jsxs)("p",{children:[eR.o.t("workflow_note_heading")," 3"]})]})]}),children:(0,eT.jsxs)("span",{className:r,children:[(0,eT.jsx)(eH.z8b,{}),(0,eT.jsx)(eH.Wdl,{})]})}),(0,eT.jsx)("div",{className:a}),(0,eT.jsx)(tV.u,{content:eR.o.t("workflow_note_bold"),mouseEnterDelay:1e3,children:(0,eT.jsx)("span",{className:ti()(r,{[l]:t.isLeafMarked(lX.Bold)}),onClick:e=>{t.markLeaf(lX.Bold)},children:(0,eT.jsx)(eH.RuI,{})})}),(0,eT.jsx)(tV.u,{content:eR.o.t("workflow_note_italic"),mouseEnterDelay:1e3,children:(0,eT.jsx)("span",{className:ti()(r,{[l]:t.isLeafMarked(lX.Italic)}),onClick:e=>{t.markLeaf(lX.Italic)},children:(0,eT.jsx)(eH.LMn,{})})}),(0,eT.jsx)(tV.u,{content:eR.o.t("workflow_note_underline"),mouseEnterDelay:1e3,children:(0,eT.jsx)("span",{className:ti()(r,{[l]:t.isLeafMarked(lX.Underline)}),onClick:e=>{t.markLeaf(lX.Underline)},children:(0,eT.jsx)(eH.UDd,{})})}),(0,eT.jsx)(tV.u,{content:eR.o.t("workflow_note_strikethrough"),mouseEnterDelay:1e3,children:(0,eT.jsx)("span",{className:ti()(r,{[l]:t.isLeafMarked(lX.Strikethrough)}),onClick:e=>{t.markLeaf(lX.Strikethrough)},children:(0,eT.jsx)(eH.a4A,{})})}),(0,eT.jsx)("div",{className:a}),(0,eT.jsx)(tV.u,{content:eR.o.t("workflow_note_bulleted_list"),mouseEnterDelay:1e3,children:(0,eT.jsx)("span",{className:ti()(r,{[l]:t.isBlockMarked(lq.BulletedList)}),onClick:e=>{t.markBlock(lq.BulletedList)},children:(0,eT.jsx)(eH.UWM,{})})}),(0,eT.jsx)(tV.u,{content:eR.o.t("workflow_note_numbered_list"),mouseEnterDelay:1e3,children:(0,eT.jsx)("span",{className:ti()(r,{[l]:t.isBlockMarked(lq.NumberedList)}),onClick:e=>{t.markBlock(lq.NumberedList)},children:(0,eT.jsx)(eH.V3U,{})})}),(0,eT.jsx)(tV.u,{content:eR.o.t("workflow_note_quote"),mouseEnterDelay:1e3,children:(0,eT.jsx)("span",{className:ti()(r,{[l]:t.isBlockMarked(lq.Blockquote)}),onClick:e=>{t.markBlock(lq.Blockquote)},children:(0,eT.jsx)(eH.Z57,{})})}),(0,eT.jsx)("div",{className:a}),(0,eT.jsx)(tV.u,{content:eR.o.t("workflow_note_hyperlink"),mouseEnterDelay:1e3,children:(0,eT.jsx)("span",{className:ti()(r,{[l]:t.isLeafMarked(lX.Link)}),onClick:e=>{e.preventDefault(),e.stopPropagation(),t.markLeaf(lX.Link,l$)},children:(0,eT.jsx)(eH.ijv,{})})})]}),(0,eT.jsx)("div",{className:"w-full overflow-hidden absolute top-[34px]",style:{display:t.isLeafMarked(lX.Link)?"flex":"none"},onMouseDown:e=>{e.stopPropagation()},children:(0,eT.jsx)(eA.II,{placeholder:"https://",style:{backgroundColor:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},value:o===l$?"":o,onChange:e=>{t.setLeafValue(lX.Link,e||l$)}})})]})},ac=e=>{var{model:t,containerRef:n}=e,o=(0,F.Dc)(),[r,l]=(0,eE.useState)(),a=(0,eE.useCallback)(()=>{var e,r=null==n?void 0:null===(e=n.current)||void 0===e?void 0:e.getBoundingClientRect();if(!t.editor.selection||!r){l(void 0);return}var a=lB.F3.toDOMRange(t.editor,t.editor.selection).getBoundingClientRect(),{zoom:i}=o.config,s=a.width/i,d=a.left/i,u=a.top/i,c=r.left/i,v=r.top/i;l({x:d-c+s/2,y:u-v-24})},[n,t.editor,o.config]);return(0,eE.useEffect)(()=>{a();var e=t.on(lJ.MultiSelect,()=>{a()}),n=t.on(lJ.Change,()=>{setTimeout(()=>{a()},20)});return()=>{e(),n()}},[]),r},av=n("311807"),ap=e=>{var{model:t,toolbarRef:n}=e,[o,r]=(0,eE.useState)(!1),l=(0,eE.useCallback)((0,av.Z)(e=>{r(e)},200),[]);return(0,eE.useEffect)(()=>()=>l.cancel(),[l]),(0,eE.useEffect)(()=>{var e=Object.entries({[lJ.MultiSelect]:()=>l(!0),[lJ.Select]:()=>l(!1),[lJ.Change]:()=>l(!1),[lJ.Blur]:()=>l(!1)}).map(e=>{var[n,o]=e;return t.on(n,o)});return()=>{e.forEach(e=>e())}},[t,l]),(0,eE.useEffect)(()=>{var e=e=>{if(!(!n.current||n.current.contains(e.target)))l(!1)};return window.addEventListener("mousedown",e),()=>window.removeEventListener("mousedown",e)},[n,l]),o},af=e=>{var{children:t,container:n}=e;return"object"==typeof document?nm.createPortal(t,n):null},am=e=>{var{disabled:t=!1,model:n,containerRef:o}=e,r=(0,eE.useRef)(null),l=!!(null==o?void 0:o.current),a=ap({model:n,toolbarRef:r}),i=ac({model:n,containerRef:o}),s=a&&!!i;return!l||t?(0,eT.jsx)(eT.Fragment,{}):(0,eT.jsx)(af,{container:o.current,children:(0,eT.jsx)("div",{className:"workflow-comment-toolbar-container absolute z-[1000]",ref:r,style:{display:s?"flex":"none",top:null==i?void 0:i.y,left:null==i?void 0:i.x},children:(0,eT.jsx)(au,{model:n,containerRef:o,visible:s})})})},ah=e=>{var{children:t,attributes:n}=e;return(0,eT.jsx)("div",(0,el._)((0,er._)({},n),{className:"workflow-comment-editor-placeholder text-[12px] text-[var(--coz-fg-dim)] overflow-hidden absolute pointer-events-none w-full select-none decoration-clone",style:{},children:(0,eT.jsx)("p",{children:t})}))},ag=e=>{var{attributes:t,children:n,leaf:o}=e;return o[lX.Bold]&&(n=(0,eT.jsx)("strong",{children:n})),o[lX.Strikethrough]&&(n=(0,eT.jsx)("del",{children:n})),o[lX.Italic]&&(n=(0,eT.jsx)("em",{children:n})),o[lX.Underline]&&(n=(0,eT.jsx)("u",{children:n})),o[lX.Link]&&(n=(0,eT.jsx)("a",{className:"text-[var(--semi-color-link)] cursor-pointer",href:o[lX.Link],onClick:e=>{e.preventDefault(),e.stopPropagation();var t=o[lX.Link];return t===l$?window.open(t,"_blank"):/^([a-zA-Z][a-zA-Z\d+\-.]*):\/\//.test(t)?window.open(t,"_blank"):window.open("https://".concat(t),"_blank")},children:n})),(0,eT.jsx)("span",(0,el._)((0,er._)({},t),{children:n}))},ax=e=>{var{attributes:t,children:n,element:o}=e,r={textAlign:o.align,color:"var(--coz-fg-primary, rgba(6, 7, 9, 0.80))"};switch(o.type){case lq.Paragraph:return(0,eT.jsx)("p",(0,el._)((0,er._)({className:"text-[12px] m-0 p-0",style:r},t),{children:n}));case lq.Blockquote:return(0,eT.jsx)("blockquote",(0,el._)((0,er._)({className:"border-l-[3px] border-t-0 border-b-0 border-r-0 border-solid border-[#ced0d4] m-0 p-0 pl-[8px] ml-[8px] text-[12px]",style:(0,el._)((0,er._)({},r),{color:"var(--coz-fg-secondary, rgba(32, 41, 69, 0.62))"})},t),{children:n}));case lq.HeadingOne:return(0,eT.jsx)("h1",(0,el._)((0,er._)({className:"text-[18px] mx-0 my-[6px] p-0 font-[600]",style:r},t),{children:n}));case lq.HeadingTwo:return(0,eT.jsx)("h2",(0,el._)((0,er._)({className:"text-[16px] mx-0 my-[6px] p-0 font-[600]",style:r},t),{children:n}));case lq.HeadingThree:return(0,eT.jsx)("h3",(0,el._)((0,er._)({className:"text-[14px] mx-0 my-[6px] p-0 font-[600]",style:r},t),{children:n}));case lq.BulletedList:return(0,eT.jsx)("ul",(0,el._)((0,er._)({className:"text-[12px] m-0 p-0 pl-[16px] font-[400]",style:r},t),{children:n}));case lq.NumberedList:return(0,eT.jsx)("ol",(0,el._)((0,er._)({className:"text-[12px] m-0 p-0 pl-[16px]",style:r},t),{children:n}));case lq.ListItem:return(0,eT.jsx)("li",(0,el._)((0,er._)({className:"text-[12px] m-0 p-0",style:r},t),{children:n}));default:return(0,eT.jsx)("p",(0,el._)((0,er._)({className:"text-[12px] m-0 p-0",style:r},t),{children:n}))}},a_=e=>{var{model:t,style:n,onChange:o}=e,r=(0,F.Dc)(),l=(0,eE.useCallback)(e=>(0,eT.jsx)(ax,(0,er._)({},e)),[]),a=(0,eE.useCallback)(e=>(0,eT.jsx)(ag,(0,er._)({},e)),[]);return(0,eE.useEffect)(()=>{var e=t.on(lJ.Change,()=>{null==o||o(t.value)});return()=>e()},[t,o]),(0,eT.jsx)(lB.mH,{editor:t.editor,initialValue:t.blocks,onChange:()=>t.fireChange(),children:(0,eT.jsx)(lB.CX,{className:"workflow-comment-editor w-full cursor-text",spellCheck:!0,readOnly:r.config.readonly,renderElement:l,renderLeaf:a,onKeyDown:e=>t.keydown(e),onPaste:e=>t.paste(e),style:n,placeholder:eR.o.t("workflow_note_placeholder"),renderPlaceholder:e=>(0,eT.jsx)(ah,(0,er._)({},e))})})},ay=e=>{var{className:t="",model:n,stopEvent:o=!0}=e,r=(0,F.Dc)(),{startDrag:l,onFocus:a,onBlur:i,selectNode:s}=(0,F.PV)();return(0,eT.jsx)("div",{className:ti()("workflow-comment-drag-area","absolute flex items-center justify-center cursor-move",t),"data-flow-editor-selectable":"false",draggable:!0,onMouseDown:e=>{o&&(e.preventDefault(),e.stopPropagation()),n.setFocus(!1),l(e),s(e),r.node.focus()},onFocus:a,onBlur:i})},aw=e=>{var{model:t,focused:n,overflow:o}=e,r=(0,F.Dc)(),{selectNode:l}=(0,F.PV)(),[a,i]=(0,eE.useState)(!1);return(0,eE.useEffect)(()=>{!n&&i(!1)},[n]),(0,eT.jsx)("div",{className:ti()("workflow-comment-content-drag-area absolute h-full w-[calc(100%-20px)]",{hidden:a}),onMouseDown:e=>{if(!a){e.preventDefault(),e.stopPropagation(),t.setFocus(!1),l(e),r.node.focus();var n=e.clientX,o=e.clientY,s=e=>{var t=e.clientX-n,r=e.clientY-o;5>Math.abs(t)&&5>Math.abs(r)&&i(!0),document.removeEventListener("mouseup",s),document.removeEventListener("click",s)};document.addEventListener("mouseup",s),document.addEventListener("click",s)}},onWheel:e=>{var n,r=null===(n=t.element)||void 0===n?void 0:n.parentElement;if(!a&&!!o&&!!r){e.stopPropagation();var l=r.scrollHeight-r.clientHeight,i=Math.min(Math.max(r.scrollTop+e.deltaY,0),l);r.scroll(0,i)}},children:(0,eT.jsx)(ay,{className:"relative h-full w-full",model:t,stopEvent:!1})})},aj=e=>{var{focused:t,children:n,style:o}=e;return(0,eT.jsx)("div",{className:ti()("workflow-comment-container flex flex-col items-start justify-start w-full h-full rounded-[8px] outline-solid py-[6px] px-[10px] overflow-y-auto overflow-x-hidden outline-[1px]",{"bg-[#FFF3EA] outline-[#FF811A]":t,"bg-[#FFFBED] outline-[#F2B600]":!t}),"data-flow-editor-selectable":"false",style:(0,er._)({outline:t?"1px solid #FF811A":"1px solid #F2B600"},{scrollbarWidth:"thin",scrollbarColor:"rgb(159 159 158 / 65%) transparent","&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgb(159 159 158 / 65%)",borderRadius:"20px",border:"2px solid transparent"}},o),children:n})},ab=e=>{var{className:t="",model:n,onResize:o,getDelta:r}=e,l=(0,F.Dc)(),{selectNode:a}=(0,F.PV)();return(0,eT.jsx)("div",{className:ti()(t,"workflow-comment-resize-area absolute w-[10px] h-[10px]"),"data-flow-editor-selectable":"false",onMouseDown:e=>{if(e.preventDefault(),e.stopPropagation(),!!o){var{resizing:t,resizeEnd:i}=o();n.setFocus(!1),a(e),l.node.focus();var s=e.clientX,d=e.clientY,u=e=>{var n=e.clientX-s,o=e.clientY-d,l=null==r?void 0:r({x:n,y:o});if(!!l&&!!t)t(l)},c=()=>{i(),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c),document.removeEventListener("click",c)};document.addEventListener("mousemove",u),document.addEventListener("mouseup",c),document.addEventListener("click",c)}}})},aN=e=>{var{model:t,overflow:n,onResize:o}=e;return(0,eT.jsxs)("div",{className:"workflow-comment-border-area z-[999]",children:[(0,eT.jsx)(ay,{className:"left-[-10px] top-[10px] w-[20px] h-[calc(100%-20px)]",model:t}),(0,eT.jsx)(ay,{className:ti()("right-[-10px] top-[10px] h-[calc(100%-20px)]",{"w-[10px]":n,"w-[20px]":!n}),model:t}),(0,eT.jsx)(ay,{className:"top-[-10px] left-[10px] w-[calc(100%-20px)] h-[20px]",model:t}),(0,eT.jsx)(ay,{className:"bottom-[-10px] left-[10px] w-[calc(100%-20px)] h-[20px]",model:t}),(0,eT.jsx)(ab,{className:"left-0 top-0 cursor-nwse-resize",model:t,getDelta:e=>{var{x:t,y:n}=e;return{top:n,right:0,bottom:0,left:t}},onResize:o}),(0,eT.jsx)(ab,{className:"right-0 top-0 cursor-nesw-resize",model:t,getDelta:e=>{var{x:t,y:n}=e;return{top:n,right:t,bottom:0,left:0}},onResize:o}),(0,eT.jsx)(ab,{className:"right-0 bottom-0 cursor-nwse-resize",model:t,getDelta:e=>{var{x:t,y:n}=e;return{top:0,right:t,bottom:n,left:0}},onResize:o}),(0,eT.jsx)(ab,{className:"left-0 bottom-0 cursor-nesw-resize",model:t,getDelta:e=>{var{x:t,y:n}=e;return{top:0,right:0,bottom:n,left:t}},onResize:o})]})},ak=e=>{var{model:t}=e,n=(0,F.Dc)(),{selectNode:o}=(0,F.PV)();return(0,eT.jsx)("div",{className:"workflow-comment-blank-area h-full w-full",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),t.setFocus(!1),o(e),n.node.focus()},onClick:e=>{t.setFocus(!0),t.selectEnd()},children:(0,eT.jsx)(ay,{className:"relative h-full w-full",model:t,stopEvent:!1})})},aC=e=>{var{node:t}=e,n=ai(),{selected:o,selectNode:r,nodeRef:l}=(0,F.PV)(),a=t.getData(F.Ps).getFormModel(),i=null==a?void 0:a.formControl,{width:s,height:d,onResize:u}=as(),{overflow:c,updateOverflow:v}=ad({model:n,height:d});return(0,eT.jsx)("div",{className:"workflow-comment w-auto h-auto min-w-[120px] min-h-[80px]",style:{width:s,height:d},ref:l,"data-node-selected":String(o),onMouseEnter:v,onMouseDown:e=>{setTimeout(()=>{r(e)},20)},children:(0,eT.jsx)(lV.SV,{fallback:(0,eT.jsx)("p",{className:"text-red-500",children:"ERROR: Workflow Comment Form Error"}),children:(0,eT.jsx)(F.l0,{control:i,children:(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(aj,{focused:o,style:{height:d},children:(0,eT.jsx)(lV.SV,{fallback:(0,eT.jsx)("p",{className:"text-red-500",children:"ERROR: Workflow Comment Render Failed"}),children:(0,eT.jsx)(F.gN,{name:lH.Note,children:e=>{var{field:t}=e;return(0,eT.jsxs)(eT.Fragment,{children:[(0,eT.jsx)(a_,{model:n,value:t.value,onChange:t.onChange}),(0,eT.jsx)(ak,{model:n}),(0,eT.jsx)(aw,{model:n,focused:o,overflow:c}),(0,eT.jsx)(am,{model:n,containerRef:l})]})}})})}),(0,eT.jsx)(aN,{model:n,overflow:c,onResize:u})]})})})})};class aS{loadDocument(e){var t=this;return(0,e7._)(function*(){t.document=e,yield t.saveService.loadDocument(e)})()}registerRenderer(e){e.registerReactComponent(F.kD.NODE_RENDER,lD),e.registerReactComponent(F.kD.SUB_CANVAS,oW),e.registerReactComponent(eM.nyy.Comment,aC),e.registerReactComponent("line-popover",lR),e.registerReactComponent(oj.EXECUTE_STATUS_BAR,()=>null)}}(0,U.gn)([(0,F.yT)(en.PR),(0,U.w6)("design:type",void 0===en.PR?Object:en.PR)],aS.prototype,"saveService",void 0),aS=(0,U.gn)([(0,H.b)()],aS);var aI=n("346066"),aT=()=>(0,eT.jsx)(tV.Od,{loading:!0,active:!0,placeholder:(0,eT.jsxs)("div",{className:aI.Z.placeholder,children:[(0,eT.jsxs)("div",{className:aI.Z.hd,children:[(0,eT.jsxs)("div",{className:aI.Z.line,children:[(0,eT.jsx)(tV.Od.Avatar,{shape:"square",className:aI.Z.avatar}),(0,eT.jsx)(tV.Od.Title,{className:aI.Z.title})]}),(0,eT.jsx)(tV.Od.Paragraph,{rows:2})]}),(0,eT.jsx)(tV.Od.Paragraph,{className:aI.Z.paragraph,rows:2}),(0,eT.jsx)(tV.Od.Paragraph,{className:aI.Z.paragraph,rows:2}),(0,eT.jsx)("div",{className:"".concat(aI.Z.paragraph," ").concat(aI.Z["last-paragraph"])})]})});class aE{onRegister(e){(0,F.kq)(e,r_),(0,F.FC)(e,aT)}}aE=(0,U.gn)([(0,H.b)()],aE);var aD=new A.n((e,t,n,o)=>{e(G.RJ).to(en.Yy).inSingletonScope(),e(en.Yy).toService(G.RJ),e(en.Re).toSelf().inSingletonScope(),e(V.Rq).to(en.Rq).inSingletonScope(),e(en.Rq).toService(V.Rq),e(en.GH).toSelf().inSingletonScope(),e(V.rP).toService(en.GH),e(en.PR).toSelf().inSingletonScope(),e(en.k_).toSelf().inSingletonScope(),e(en.nE).toSelf().inSingletonScope(),e(en.m3).toSelf().inSingletonScope(),e(en.Nj).toSelf().inSingletonScope(),e(en.LG).toSelf().inSingletonScope(),e(en.IB).toSelf().inSingletonScope(),e(en.mh).toSelf().inSingletonScope(),e(en.iP).toSelf().inSingletonScope(),e(en.w3).toSelf().inSingletonScope(),e(ee.E).toDynamicValue(e=>()=>e.container.get(en.k_)).inSingletonScope(),e($.j).toSelf().inSingletonScope(),e(en.we).toSelf().inSingletonScope(),e(eo.I).toSelf().inSingletonScope(),o(F.fY).toService(eo.I),e(et.O).toSelf().inSingletonScope(),e(en.qq).toSelf().inSingletonScope(),o(F.iw).toService(en.qq),e(et.e).toDynamicValue(e=>()=>e.container.get(et.O)).inSingletonScope(),o(F.xm).toService($.j),(0,F.c$)(e,ow.qZ),(0,F.c$)(e,ow.eI),(0,F.c$)(e,ow.JM),(0,F.c$)(e,ow.sv),(0,R.KV)(e,aS,[F.Lw,F.OK]),(0,W.bindShortcuts)(e,B.G,[W.WorkflowCopyShortcutsContribution,W.WorkflowPasteShortcutsContribution,W.WorkflowLayoutShortcutsContribution,W.WorkflowZoomShortcutsContribution,W.WorkflowExportShortcutsContribution,W.WorkflowLoadShortcutsContribution,W.WorkflowSelectAllShortcutsContribution]),(0,R.KV)(e,oy,[F.hU]),(0,R.KV)(e,aE,[F.v7]),(0,R.KV)(e,Q,[F.Lw]),e(en._y).to(en.G$).inSingletonScope(),e(en.Of).to(en.qD).inSingletonScope(),e(en.yM).toSelf().inSingletonScope()})},325599:function(e,t,n){n.d(t,{U:function(){return i},f:function(){return s}});var o=n(151064),r=n(455069),l=n(794211),a=(0,r.createContext)({}),i=()=>(0,r.useContext)(a),s=(0,r.forwardRef)((e,t)=>{var{readonly:n,children:i}=e,{handleAddNode:s,updateAddNodePosition:d,modals:u,openPlugin:c,openWorkflow:v,openImageflow:p}=(0,l.g)();return(0,r.useImperativeHandle)(t,()=>({handleAddNode:(e,t,o)=>{if(!n)s(e,t,o)}}),[n,s]),(0,o.jsxs)(a.Provider,{value:{openPlugin:c,openWorkflow:v,openImageflow:p,updateAddNodePosition:d},children:[i,u]})})},374499:function(e,t,n){n.d(t,{u:function(){return o}});var o=(0,n(455069).createContext)(void 0)},497744:function(e,t,n){n.d(t,{qZ:()=>o.q,eI:()=>r.e,MA:()=>d,JM:()=>i,sv:()=>u,tn:()=>r.t});var o=n("407909"),r=n("668434"),l=n("686436"),a=n("115597");class i extends l.cv{getDefaultConfig(){return{formVisible:!1,frozen:null,autoGenerating:!1,commonSheetKey:null,testNodeFormVisible:!1}}openTestForm(e){this.formSchema=e,this.updateConfig({formVisible:!0})}closeTestForm(){this.updateConfig({formVisible:!1}),this.testRunDataSource=a.KY.User}setFormData(e,t){this.formDataCacheMap.set(e,t)}setThisFormData(e){if(!!this.config.formVisible){var t,n=null===(t=this.formSchema)||void 0===t?void 0:t.id;n&&this.setFormData(n,e)}}hasFormData(e){return this.formDataCacheMap.has(e)}getFormData(e){return this.formDataCacheMap.get(e)}clearFormData(){this.formDataCacheMap.clear()}setTestFormDefaultValue(e){this.formDefaultValue=e}getTestFormDefaultValue(e){var t,n,o=this.entityManager.getEntity(r.e);return null!==(n=this.formDefaultValue.find(t=>t.node_id===e))&&void 0!==n?n:null==o?void 0:null===(t=o.config.playgroundProps.testFormDefaultValues)||void 0===t?void 0:t.find(t=>t.node_id===e)}clearTestFormDefaultValue(){this.formDefaultValue=[]}freezeTestRun(e){this.updateConfig({frozen:e})}unfreezeTestRun(){this.updateConfig({frozen:null})}get autoGenerating(){return this.config.autoGenerating}set autoGenerating(e){this.updateConfig({autoGenerating:e})}get commonSheetKey(){return this.config.commonSheetKey}openCommonSheet(e){this.updateConfig({commonSheetKey:e})}closeCommonSheet(){this.updateConfig({commonSheetKey:null})}showTestNodeForm(){this.updateConfig({testNodeFormVisible:!0})}closeTestNodeForm(){this.updateConfig({testNodeFormVisible:!1})}constructor(...e){super(...e),this.testRunDataSource=a.KY.User,this.formDataCacheMap=new Map,this.formDefaultValue=[]}}i.type="WorkflowTestFormStateEntity";var s=n("816697");class d extends l.cv{getDefaultConfig(){return{visible:!1,previewVisible:!1,previewInfo:{},dataList:[]}}setTemplateList(e){this.updateConfig({dataList:e})}openTemplate(){this.updateConfig({visible:!0})}closeTemplate(){this.updateConfig({visible:!1})}get templatePreviewInfo(){return this.config.previewInfo}get templateVisible(){return this.config.visible}get templateList(){return this.config.dataList}openPreview(e){this.updateConfig({previewVisible:!0,previewInfo:e}),this.onPreviewUpdatedEmitter.fire({previewVisible:!0})}closePreview(){this.updateConfig({previewVisible:!1,previewInfo:void 0}),this.onPreviewUpdatedEmitter.fire({previewVisible:!1})}constructor(...e){super(...e),this.onPreviewUpdatedEmitter=new s.Q5,this.onPreviewUpdated=this.onPreviewUpdatedEmitter.event}}d.type="WorkflowTemplateStateEntity";class u extends l.cv{getDefaultConfig(){return{refreshModalVisible:!1,saveVersion:BigInt(0),refreshFunc:void 0}}setRefreshModalVisible(e){this.updateConfig({refreshModalVisible:e})}get refreshModalVisible(){return this.config.refreshModalVisible}get saveVersion(){return this.config.saveVersion}setSaveVersion(e){this.updateConfig({saveVersion:e})}addSaveVersion(){var e=this.config.saveVersion+BigInt(1);this.updateConfig({saveVersion:e})}get refreshFunc(){return this.config.refreshFunc}setRefreshFunc(e){this.updateConfig({refreshFunc:e})}}u.type="WorkflowDependencyStateEntity"},407909:function(e,t,n){n.d(t,{q:function(){return l}});var o=n(408487),r=n(686436);class l extends r.cv{getDefaultConfig(){return{logID:"",executeId:"",exeHistoryStatus:o.eLL.NoHistory,workflowExeCost:"",resultSideSheetVisible:!1,resultSideSheetLoading:!1,nodeErrorMap:new Map,nodeEvents:[],projectId:""}}getNodeExecResult(e){return this.nodeResultMap.get(e)}setNodeExecResult(e,t){this.nodeResultMap.set(e,t)}get hasNodeResult(){return this.nodeResultMap.size>0}getEndNodeResult(){var e=Object.fromEntries(this.nodeResultMap),t=Object.keys(e).find(t=>"End"===e[t].NodeType);if(t)return this.getNodeExecResult(t)}clearNodeResult(){this.nodeResultMap.clear(),this.updateConfig({version:Date.now()})}setNodeError(e,t){this.config.nodeErrorMap.set(e,t),this.updateConfig({version:Date.now()})}setNodeErrors(e){Object.keys(e).forEach(t=>{var n=e[t];this.config.nodeErrorMap.set(t,n)}),this.updateConfig({version:Date.now()})}getNodeError(e){return this.config.nodeErrorMap.get(e)}clearNodeError(e){this.config.nodeErrorMap.delete(e)}clearNodeErrorMap(){this.config.nodeErrorMap.clear()}openSideSheet(){this.updateConfig({resultSideSheetVisible:!0})}closeSideSheet(){this.updateConfig({resultSideSheetVisible:!1})}get nodeErrors(){return Object.fromEntries(this.config.nodeErrorMap)}get resultSideSheetVisible(){return this.config.resultSideSheetVisible}get resultSideSheetLoading(){return this.config.resultSideSheetLoading}get executeLogId(){return this.config.executeLogId}get logID(){return this.config.logID}setNodeErrorSetting(e,t){this.nodeErrorSettingMap.set(e,t)}getNodeErrorSetting(e){return this.nodeErrorSettingMap.get(e)}clearNodeErrorSetting(){this.nodeErrorSettingMap.clear()}setNodeEvents(e){if(!!e)this.config.nodeEvents=e}getNodeEvent(e){return this.config.nodeEvents.find(t=>t.type===e)}clearNodeEvents(){this.config.nodeEvents=[]}constructor(...e){super(...e),this.nodeResultMap=new Map,this.nodeErrorSettingMap=new Map}}l.type="WorkflowExecStateEntity"},668434:function(e,t,n){n.d(t,{t:()=>C,e:()=>S});var o,r=n("825955"),l=n("808549"),a=n("120454"),i=n("345420"),s=n("479886"),d=n.n(s),u=n("686436"),c=n("267334"),v=n("408487"),p=n("450562"),f=n("458620"),m=n("297158"),h=n("336205"),g=n("727914"),x=n("286518"),_=n("178385"),y=n("382534"),w=n("865682"),j=n("311807"),b=n("674343");class N{getDataSetInfosByIdsCallback(e,t,n){var o=[],r=[];if(e.forEach(e=>{this.dataSetInfosMap[e]?o.push(e):r.push(e)}),0===r.length){n(o.map(e=>this.dataSetInfosMap[e]));return}this.listeners.push({ids:e,callback:n});var l=r.filter(e=>!this.queryQueue.includes(e));if(0!==l.length)this.queryQueue=this.queryQueue.concat(l),this.query(t)}constructor(){var e,t=this;this.dataSetInfosMap={},this.queryQueue=[],this.listeners=[],this.setDataSetInfosMap=e=>{e.forEach(e=>{!this.dataSetInfosMap[e.dataset_id]&&(this.dataSetInfosMap[e.dataset_id]=e)})},this.getDataSetInfosByIds=(e,t)=>new Promise(n=>{this.getDataSetInfosByIdsCallback(e,t,e=>{n(e)})}),this.query=(0,j.Z)((e=(0,r._)(function*(e){var{dataset_list:n=[]}=yield y.MJ.ListDataset({space_id:e,page:1,size:99,filter:{dataset_ids:t.queryQueue}}),o=t.queryQueue;t.queryQueue=[];var r=[];o.forEach(e=>{!n.find(t=>t.dataset_id===e)&&r.push(e)}),t.addDataSetInfo(n,r),r.length>0&&b.FN.error(h.o.t("workflow_knowledeg_unexit_error",{id:r.join(",")},"知识库不存在")),t.onQueried()}),function(t){return e.apply(this,arguments)}),100),this.onQueried=()=>{this.listeners.forEach(e=>{var{ids:t,callback:n}=e,o=!0;t.forEach(e=>{!this.dataSetInfosMap[e]&&(o=!1)}),o&&(n(t.map(e=>this.dataSetInfosMap[e])),this.listeners=this.listeners.filter(t=>e!==t))})},this.addDataSetInfo=(e,t)=>{e.forEach(e=>{this.dataSetInfosMap[e.dataset_id]?this.dataSetInfosMap[e.dataset_id]=(0,l._)({},this.dataSetInfosMap[e.dataset_id],e):this.dataSetInfosMap[e.dataset_id]=e}),null==t||t.forEach(e=>{!this.dataSetInfosMap[e]&&(this.dataSetInfosMap[e]={dataset_id:e,name:h.o.t("workflow_knowledeg_un_exit",{},"知识库不存在")})})},this.clearDataSetInfosMap=()=>{this.dataSetInfosMap={}}}}var k=e=>{var t=d()().format("HH:mm:ss");if(e&&"number"==typeof e&&d().unix(e).isValid()){var n=d().unix(e),o=d()();t=o.diff(n,"y")>=1?n.format("YYYY-MM-DD HH:mm:ss"):o.isSame(n,"d")?n.format("HH:mm:ss"):n.format("MM-DD HH:mm:ss")}return t};var C=((o={}).DEFAULT="default",o.EXECUTING="executing",o.DONE="done",o);class S extends u.cv{getDefaultConfig(){return{historyStatus:void 0,playgroundProps:Object.create(null),workflowId:"",loading:!0,autoSaveTime:d()().format("HH:mm:ss"),saveLoading:!1,saving:!1,preview:!1,publishing:!1,info:{},viewStatus:"default",spaceList:[],spaceMode:_._1.Normal,pluginId:"",isBindAgent:!1,inPluginUpdated:!1,nodeSideSheetVisible:!1,isInitWorkflow:!1,isBindDouyin:!1,sharedDataSet:new N}}load(e,t){var n=this;return(0,r._)(function*(){if(!e)throw new g.sH(f.b.parmasValidation,h.o.t("workflow_detail_error_missing_id"));yield Promise.all([n.setSpaceInfo()]);var o,r,l,a=yield n.queryWorkflowDetail(e,t),i=k(null==a?void 0:a.update_time),s=a.collaborator_mode===v.XG2.Open,d=n.config.playgroundProps.readonly,c=(null==a?void 0:a.type)===v.uql.GuanFang,p=!!(n.projectId&&n.config.playgroundProps.projectCommitVersion),m=(null==a?void 0:a.type)===v.uql.User,x=!s&&(null===(o=a.creator)||void 0===o?void 0:o.self),_=s&&(null===(r=a.vcsData)||void 0===r?void 0:r.can_edit),y=d||c||p||m&&!(x||_),j=null==a?void 0:a.schema_json,b=j?JSON.parse(j):void 0,N=(0,w.O)(b,(null==a?void 0:a.flow_mode)||v.wz8.Workflow);return n.updateConfig({workflowId:e,pluginId:(null==a?void 0:a.plugin_id)&&"0"!==a.plugin_id?a.plugin_id:"",info:a,autoSaveTime:i,autoSaveTimestamp:null==a?void 0:a.update_time,preview:y,isBindAgent:null==a?void 0:a.is_bind_agent,bindBizID:null==a?void 0:a.bind_biz_id,bindBizType:null==a?void 0:a.bind_biz_type,historyStatus:void 0,schemaGray:null==b?void 0:b.versions,isInitWorkflow:N}),null===(l=n.entityManager.getEntity(u.ER))||void 0===l||l.updateConfig({readonly:y}),b})()}loadHistory(e){var t=this;return(0,r._)(function*(){var n,o=t.workflowId||t.playgroundProps.workflowId,r=t.spaceId||t.playgroundProps.spaceId,i=t.projectCommitVersion||t.playgroundProps.projectCommitVersion,{projectId:s}=t,{commit_id:d,type:c,env:p,log_id:m,execute_id:x,sub_execute_id:_}=e;if(!o||!r)throw new g.sH(f.b.parmasValidation,h.o.t("loadHistory error: no workflowId or spaceId"));var{data:y}=yield v.OHc.GetHistorySchema({workflow_id:o,space_id:r,commit_id:d,log_id:m,execute_id:x,sub_execute_id:_,type:c,env:p,project_version:i,project_id:s}),{schema:w,name:j,describe:b,url:N,flow_mode:k,bind_biz_id:C,bind_biz_type:S}=y,{vcsData:I}=t.info,T={workflow_id:o,space_id:r,name:j,desc:b,flow_mode:null!=k?k:v.wz8.Workflow,url:N,status:v.Xpx.HadSubmit,type:v.uql.User,schema_json:w,collaborator_mode:v.XG2.Open,vcsData:(0,a._)((0,l._)({},I||{}),{type:c===v.lcl.PublishOperate?v.MZY.Publish:v.MZY.Submit,submit_commit_id:d})},E=w?JSON.parse(w):void 0;return t.updateConfig({workflowId:o,info:T,preview:!0,bindBizID:C,bindBizType:S,historyStatus:c,schemaGray:null==E?void 0:E.versions}),null===(n=t.entityManager.getEntity(u.ER))||void 0===n||n.updateConfig({readonly:!0}),E})()}setSpaceInfo(){var e=this;return(0,r._)(function*(){if(!e.config.spaceList.length){var{bot_space_list:t}=yield y.nA.SpaceList();e.updateConfig({spaceList:t})}var{spaceList:n}=e.config;if(e.spaceId===c.RV){e.updateConfig({spaceType:x.Sn.Team,spaceMode:_._1.Normal});return}var o=n.find(t=>t.id===e.spaceId);if(!o)throw Error("space id don't in list");var{space_type:r,space_mode:l}=o;e.updateConfig({spaceType:r,spaceMode:l})})()}get isPersonalSpace(){var e;return(null===(e=this.config)||void 0===e?void 0:e.spaceType)===x.Sn.Personal}get isTeamSpace(){var e;return(null===(e=this.config)||void 0===e?void 0:e.spaceType)===x.Sn.Team}get hasPublished(){var e;return!!(null===(e=this.config)||void 0===e?void 0:e.pluginId)}get isDevSpace(){return this.config.spaceMode===_._1.DevMode}get personalSpaceId(){var e,t=this.config.spaceList.find(e=>e.space_type===x.Sn.Personal);return null!==(e=null==t?void 0:t.id)&&void 0!==e?e:""}queryCollaborationWorkflow(e,t){return(0,r._)(function*(){var n,{data:o}=yield v.OHc.GetCanvasInfo({workflow_id:e,space_id:t},{__disableErrorToast:!0}),{workflow:r,vcs_data:i,db_data:s,operation_info:d,is_bind_agent:u,bind_biz_id:c,bind_biz_type:p,workflow_version:f}=o;return(0,a._)((0,l._)({},r),{is_bind_agent:u,space_id:t,status:null!==(n=null==s?void 0:s.status)&&void 0!==n?n:null==r?void 0:r.status,vcsData:i,operationInfo:d,bind_biz_id:c,bind_biz_type:p,workflow_version:f,workflowSourceSpaceId:null==r?void 0:r.space_id})})()}queryWorkflowDetail(e,t){var n=this;return(0,r._)(function*(){try{return yield n.queryCollaborationWorkflow(e,t)}catch(e){if(m.E7.errorEvent({eventName:"query_workflow_detail_fail",namespace:"workflow",error:e}),t!==c.RV)throw e;return{}}})()}get playgroundProps(){return this.config.playgroundProps}get workflowId(){return this.config.playgroundProps.workflowId||""}get workflowCommitId(){return this.config.playgroundProps.commitId||""}get projectCommitVersion(){return this.config.playgroundProps.projectCommitVersion||""}get logId(){return this.config.playgroundProps.logId||""}get spaceId(){return this.config.playgroundProps.spaceId||""}get projectId(){var e;return this.config.playgroundProps.projectId||(null===(e=this.config.info)||void 0===e?void 0:e.project_id)}get isInIDE(){return!!this.projectId}get info(){return this.config.info}setInfo(e){this.config.info=(0,l._)({},this.config.info,e),this.fireChange()}get readonly(){return this.config.preview||this.isExecuting}get isFromExplore(){return"explore"===this.config.playgroundProps.from}get hasChanged(){var{config:e}=this;return"0"!==e.info.plugin_id&&e.info.status!==v.x5o.HadPublished}get loadingError(){return this.config.loadingError}get loading(){return this.config.loading}get isExecuting(){return"executing"===this.config.viewStatus}get viewStatus(){return this.config.viewStatus}set viewStatus(e){var t;this.config.viewStatus=e,null===(t=this.entityManager.getEntity(u.ER))||void 0===t||t.updateConfig({readonly:"executing"===e||this.config.preview}),this.fireChange()}get isCollaboratorMode(){return this.info.collaborator_mode===v.XG2.Open}get isBindAgent(){return this.config.isBindAgent}get bindBizID(){return this.config.bindBizID}get bindBizType(){return this.config.bindBizType}get isBindDouyin(){return!!(this.config.bindBizType===v.k5N.DouYinBot&&this.config.bindBizID)}get flowMode(){return this.config.info.flow_mode||v.wz8.Workflow}get isVcsMode(){return this.config.info.persistence_model===v.TvD.VCS}get isNormalWorkflow(){return(0,p.ikd)(this.flowMode)}get isChatflow(){return this.flowMode===v.wz8.ChatFlow}get isSceneFlow(){return this.flowMode===v.wz8.SceneFlow}get inPluginUpdated(){return!!this.config.inPluginUpdated}set inPluginUpdated(e){this.updateConfig({inPluginUpdated:e})}get canTestset(){return this.spaceId!==c.RV&&this.flowMode!==v.wz8.SceneFlow}get publishing(){return this.config.publishing}get canMockset(){return this.spaceId!==c.RV&&!this.projectId&&!1}get canCollaboration(){return this.isTeamSpace&&this.spaceId!==c.RV&&!this.isSceneFlow&&!this.isBindDouyin}get canTestRunHistory(){if(this.isViewHistory)return!1;if(!this.isCollaboratorMode&&(null===(e=this.info.creator)||void 0===e?void 0:e.self))return!0;var e,t,{vcsData:n,persistence_model:o}=this.info;return o!==v.TvD.VCS||(null==n?void 0:n.type)===v.MZY.Draft&&(null===(t=this.info.vcsData)||void 0===t?!!void 0:!!t.can_edit)||!1}get isViewHistory(){return void 0!==this.config.historyStatus}get isInitWorkflow(){return this.config.isInitWorkflow}get sharedDataSetStore(){return!this.config.sharedDataSet&&(this.config.sharedDataSet=new N),this.config.sharedDataSet}constructor(...e){var t;super(...e),t=this,this.getProjectApi=()=>{var e=this.config.playgroundProps.getProjectApi;return e&&(0,i.Z)(e)?e():null},this.reload=(0,r._)(function*(){return yield t.load(t.config.playgroundProps.workflowId,t.config.playgroundProps.spaceId||"")})}}S.type="WorkflowGlobalStateEntity"},57224:function(e,t,n){n.d(t,{A:function(){return s}});var o=n(151064);n(455069);var r=n(252237),l=n.n(r),a=n(915757),i=n(674343),s=e=>{var{onClick:t,onMouseDown:n,disabled:r,disabledTooltip:s,className:d,style:u,title:c,testId:v}=e,p=(0,o.jsx)(i.hU,{color:"highlight",size:"small",icon:(0,o.jsx)(a.PwN,{className:"text-sm"}),onMouseDown:e=>null==n?void 0:n(e),onClick:e=>null==t?void 0:t(e),className:l()("!block",d),style:u,disabled:r,"data-testid":v});return s?(0,o.jsx)(i.u,{content:s,children:p}):r?null:p}},634102:function(e,t,n){n.d(t,{$:function(){return u}});var o=n(151064),r=n(252237),l=n.n(r),a=n(674343),i=n(775699),s=n(44172),d=n(599733),u=e=>{var{checked:t,label:n,description:r,tooltip:u,tipWrapperClassName:c,children:v,needCheckBox:p=!0,className:f,style:m,readonly:h,disabled:g,onChange:x,dataTestId:_}=e;return(0,o.jsxs)("div",{className:l()("flex flex-col gap-[4px] py-[4px]",f),style:m,children:[(0,o.jsxs)("div",{className:"flex items-center gap-[8px]",children:[p?(0,o.jsx)("div",{children:(0,o.jsx)(i.XZ,{className:d.Z["checkbox-small"],checked:t,disabled:h||g,onChange:e=>{var t;return null==x?void 0:x(null==e?void 0:null===(t=e.target)||void 0===t?void 0:t.checked)},"data-testid":_})}):null,(0,o.jsxs)("div",{className:"flex items-center gap-[4px] text-[12px] text-[#060709CC]",children:[n,u?(0,o.jsx)(a.u,{className:c,content:u,children:(0,o.jsx)(s.aUG,{className:d.Z["lable-wrapper"],style:{color:"rgba(167, 169, 176, 1)",cursor:"pointer"}})}):null]})]}),r?(0,o.jsx)("div",{style:{paddingLeft:"24px"},children:(0,o.jsx)("span",{className:d.Z.description,children:r})}):null,v]})}},77167:function(e,t,n){n.d(t,{X:function(){return i}});var o=n(151064);n(455069);var r=n(450562),l=n(915757),a=n(674343),i=e=>{var{value:t,onChange:n,context:i,options:s,readonly:d}=e,{text:u,itemTooltip:c}=s,{getNodeSetterId:v}=(0,r.FCD)();return(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)(a.XZ,{onChange:e=>n(e.target.checked),checked:!!t,"data-testid":v(i.meta.name),disabled:d,children:u}),!!c&&(0,o.jsx)(a.u,{content:c,children:(0,o.jsx)(l.L03,{className:"text-[#A7A9B0] text-sm ml-1"})})]})}},425212:function(e,t,n){n.d(t,{b:function(){return s}});var o=n(151064),r=n(252237),l=n.n(r),a=n(21621),i=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:24;return[...e,...t?[]:[{title:"",style:{width:n}}]]},s=e=>{var{actionWidth:t,className:n,columns:r,readonly:s,style:d}=e;return(0,o.jsx)(a.Z,{className:l()("gap-1",n),columns:i(r,s,t),style:d})}},21621:function(e,t,n){n.d(t,{Z:function(){return i}});var o=n(151064),r=n(252237),l=n.n(r),a=n(138507),i=e=>{var{columns:t,className:n,style:r}=e;return(0,o.jsx)("div",{className:l()(a.Z.columnsTitle,n),style:r,children:t.map(e=>{var{title:t,style:n}=e;return(0,o.jsx)("div",{style:n,children:t})})})}},914173:function(e,t,n){n.d(t,{d:()=>y});var o=n("151064"),r=n("455069"),l=n("408487"),a=n("450562"),i=n("695673"),s=n("328591"),d=n("153696"),u=n("336205"),c=n("775699"),v=n("402635"),p=n("674343"),f=n("184449"),m=n("261492"),h=n("808549"),g=n("120454"),x=n("724847"),_=e=>{var[t,n]=(0,r.useState)(!1);return{node:(0,o.jsx)(x.T7,(0,g._)((0,h._)({},e),{visible:t})),open:()=>{n(!0)},close:()=>{n(!1)}}},y=e=>{var{value:t,onChange:n,readonly:h}=e,{getNodeSetterId:g}=(0,a.FCD)(),x=g("dataset-select-add"),y=g("dataset-select-card"),w=(0,r.useMemo)(()=>{var e;return(null==t?void 0:null===(e=t.filter)||void 0===e?void 0:e.call(t,e=>!!e))||[]},[t]),{dataSets:j,cacheDataSetInfo:b}=(0,f.Z3)({ids:w}),{type:N}=(0,a.rsR)(),k=N===a.nyy.DatasetWrite,C=k?i.AT.TEXT:i.AT.ALL,S=!!(k&&(null==w?void 0:w.length)),I=(0,r.useCallback)(e=>{n([...w,e]),A()},[w,n]),T=(0,r.useCallback)(e=>{n(w.filter(t=>t!==e)),A()},[w,n]),[E,D]=(0,r.useState)("add"),[Z,M]=(0,r.useState)(),P=(0,r.useMemo)(()=>j.find(e=>e.dataset_id===Z),[j,Z]),L=(0,r.useMemo)(()=>(0,o.jsx)(p.zx,{disabled:h||(null==P?void 0:P.status)===v._z.DatasetForbid,onClick:()=>{"add"===E?I(Z):T(Z)},children:"add"===E?u.o.t("knowledge_add_btn_by_workflow"):u.o.t("knowledge_remove_btn_by_workflow")}),[j,E,I,T,Z,P]),{node:z,open:O,close:A}=(0,d.b6)({navBarProps:{actionButtons:L},biz:"workflow"}),{projectId:F,getProjectApi:R,playgroundProps:V,bindBizID:B,bindBizType:G}=(0,f.j1)(),W=(0,f.aQ)(),U=G===l.k5N.DouYinBot,H=(0,r.useRef)(),{node:J,open:q,close:K}=(0,s.mq)({datasetList:w.map(e=>({dataset_id:e})),onClickKnowledgeDetail:e=>{w.includes(e)?D("remove"):D("add"),M(e),O(e)},onDatasetListChange:e=>{b(e),n(e.map(e=>e.dataset_id))},defaultType:C,knowledgeTypeConfigList:k?[i.AT.TEXT]:void 0,projectID:F,beforeCreate:e=>{e&&!F&&(H.current=window.open())},onClickAddKnowledge:(e,t,n)=>{if(n){if(F){var o,r,l=null===(r=R())||void 0===r?void 0:r.navigate;null==l||l("/knowledge/".concat(e,"?module=upload&type=").concat(t))}else H.current&&(e?H.current.location="/space/".concat(W,"/knowledge/").concat(e,"/upload?type=").concat(t):H.current.close())}K(),F&&(null===(o=V.refetchProjectResourceList)||void 0===o||o.call(V))}}),{node:X,open:Y,close:Q}=_({spaceId:W,botId:B||"",datasetList:w.map(e=>({dataset_id:e})),onClickKnowledgeDetail:e=>{w.includes(e)?D("remove"):D("add"),M(e),O(e)},onDatasetListChange:e=>{b(e),n(e.map(e=>e.dataset_id))},onCancel:()=>{Q()}});return(0,r.useEffect)(()=>{k&&(null==w?void 0:w.length)&&K()},[w,K,k]),(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsxs)(c.iV,{getPopupContainer:()=>document.body,children:[z,U?X:J]}),(0,o.jsx)(m.b,{libraries:null==j?void 0:j.map(e=>{var{dataset_id:t="",name:n,description:o,icon_url:r,create_time:l="",creator_id:a=""}=e;return{id:t,name:n,description:o,iconUrl:r,isInvalid:!l&&!a}}),readonly:h,onDeleteLibrary:e=>{n(w.filter(t=>t!==e))},onAddLibrary:()=>U?Y():q(),onClickLibrary:e=>{e&&(D("remove"),M(e),O(e))},emptyText:k?u.o.t("kl_write_003"):u.o.t("workflow_knowledge_node_empty"),hideAddButton:S,addButtonTestID:x,libraryCardTestID:y})]})}},115022:function(e,t,n){n.d(t,{xs:()=>c,PD:()=>s,Ag:()=>_});var o=n("151064");n("455069");var r=n("252237"),l=n.n(r),a=n("674343"),i=n("716825"),s=e=>{var{min:t=0,max:n=100,step:r=1,value:s,marks:d,onChange:u,onMouseUp:c,onClickDefault:v,disabled:p,customStyles:f,isDataSet:m=!1}=e;return(0,o.jsxs)("div",{className:l()(i.Z["slider-area"],{[i.Z["slider-area-dataset"]]:m}),children:[(0,o.jsx)("div",{className:i.Z["slider-wrapper"],children:(0,o.jsx)("div",{className:i.Z.slider,style:null==f?void 0:f.sliderAreaStyle,children:(0,o.jsx)(a.iR,{step:r,min:t,max:n,value:s,marks:d?{[d.markKey]:""}:{},disabled:p,onChange:e=>u(e),onMouseUp:e=>{null==c||c(e)}})})}),(0,o.jsxs)("div",{className:i.Z["slider-boundary"],style:null==f?void 0:f.boundaryStyle,children:[(0,o.jsx)("div",{className:i.Z.min,children:t}),(0,o.jsx)("div",{className:i.Z.max,children:n}),d?(0,o.jsx)("div",{className:i.Z.marks,style:{left:"".concat((d.markKey-t)/(n-t)*100,"%")},onClick:()=>{null==v||v()},children:d.markText}):(0,o.jsx)(o.Fragment,{})]})]})},d=n("44172"),u=n("630443"),c=e=>{var{title:t,tip:n,titleClassName:r}=e;return(0,o.jsxs)("div",{className:u.Z["title-area"],children:[(0,o.jsx)("span",{className:r,children:t}),!!n&&(0,o.jsx)(a.u,{showArrow:!0,position:"top",style:{maxWidth:"380px",padding:"8px 12px",borderRadius:"6px"},content:n,children:(0,o.jsx)(d.aUG,{className:u.Z["title-area-icon"]})})]})},v=n("808549"),p=n("120454"),f=n("450562"),m=n("336205"),h=n("935026"),g=n("242824"),x=[{value:h._.Semantic,label:m.o.t("knowledge_semantic_search_title")},{value:h._.Hybird,label:m.o.t("knowledge_hybird_search_title")},{value:h._.FullText,label:m.o.t("knowledge_full_text_search_title")}],_=e=>{var{value:t,onChange:n,style:r,readonly:l}=e,{getNodeSetterId:i}=(0,f.FCD)();return(0,o.jsx)(a.Ph,{className:g.Z["strategy-area"],dropdownClassName:g.Z["strategy-area-dropdown"],size:"small",value:t,style:(0,p._)((0,v._)({},r),{pointerEvents:l?"none":"auto"}),onChange:n,"data-testid":i("dataset-search-strategy"),children:x.map(e=>(0,o.jsx)(a.Ph.Option,{value:e.value,"data-testid":i("dataset-search-strategy-option"),children:e.label},e.value))})}},104401:function(e,t,n){n.d(t,{Y:function(){return y}});var o=n(808549),r=n(120454),l=n(151064),a=n(455069),i=n(155440),s=n(671261),d=n(529801),u=n(450562),c=n(109915),v=n(280053),p=n(336205),f=n(44172),m=n(674343),h=n(634102),g=n(935026),x=n(115022),_=n(734126),y=e=>{var{dataSetInfo:t,onDataSetInfoChange:n,readonly:y,disabled:w,style:j,isReady:b,dataSets:N}=e,{min_score:k,top_k:C,strategy:S,use_nl2sql:I,use_rerank:T,use_rewrite:E,is_personal_only:D}=t||{},[Z,M]=(0,a.useState)(!0),P=(0,a.useMemo)(()=>null==N?void 0:N.some(e=>(null==e?void 0:e.format_type)===v.a5.Table),[N]),{getNodeSetterId:L}=(0,u.FCD)();(0,a.useEffect)(()=>{if(!Z)if((0,i.Z)(k)&&(0,i.Z)(C)&&(0,i.Z)(S)&&(0,i.Z)(T)&&(0,i.Z)(E)&&(0,i.Z)(D)){var e={min_score:.5,top_k:5,strategy:g._.Hybird};(0,s.Z)(e,"use_rerank",!0),(0,s.Z)(e,"use_rewrite",!0),(0,s.Z)(e,"is_personal_only",!0),null==n||n((0,o._)({},t,e))}else(0,i.Z)(S)?null==n||n((0,r._)((0,o._)({},t),{strategy:g._.Hybird})):(0,i.Z)(T)&&(0,i.Z)(E)&&(0,i.Z)(D)&&!0&&(null==n||n((0,r._)((0,o._)({},t),{use_rerank:!0,use_rewrite:!0,is_personal_only:!0})))},[t,!0,P,Z]),(0,a.useEffect)(()=>{if(!!b)(0,i.Z)(I)?P&&n((0,r._)((0,o._)({},t),{use_nl2sql:!0})):!P&&n((0,d.Z)(t,["use_nl2sql"]))},[P,I,b]),(0,a.useEffect)(()=>{if(!!b)M(!(null==N?void 0:N.length)),!(null==N?void 0:N.length)&&n({})},[N,b,M]);var[z,O]=(0,a.useState)(!0);(0,a.useEffect)(()=>{var e;O(!!T),T?T&&(0,i.Z)(k)&&(e=(0,r._)((0,o._)({},t),{min_score:.5}),null==n||n(e)):(e=(0,d.Z)(t,["min_score"]),null==n||n(e))},[T,O]);var[A,F]=(0,a.useState)(!1);return Z?(0,l.jsx)(l.Fragment,{}):(0,l.jsxs)("div",{className:_.Z.setting,style:(0,r._)((0,o._)({},j),{position:"relative"}),children:[(0,l.jsxs)("div",{className:_.Z["setting-item"],children:[(0,l.jsx)(x.xs,{title:p.o.t("knowledge_search_strategy_title"),tip:p.o.t("knowledge_search_strategy_tooltip")}),(0,l.jsx)(x.Ag,{readonly:y,value:S,onChange:e=>{n(e===g._.FullText?{top_k:null==t?void 0:t.top_k,strategy:e}:(0,r._)((0,o._)({},t),{min_score:(null==t?void 0:t.min_score)||.5,strategy:e}))}})]}),(0,l.jsxs)("div",{className:_.Z["setting-item"],children:[(0,l.jsx)(x.xs,{title:p.o.t("dataset_max_recall"),tip:p.o.t("bot_edit_datasetsSettings_MaxTip")}),(0,l.jsx)(m.J2,{showArrow:!1,position:"bottom",trigger:"custom",visible:A,content:()=>(0,l.jsxs)("div",{className:_.Z["tip-area"],children:[(0,l.jsx)(f.O5N,{}),(0,l.jsxs)("div",{className:_.Z["tip-area-content"],children:[(0,l.jsx)("div",{className:_.Z["tip-area-title"],children:p.o.t("workflow_detail_knowledge_proceed_with_caution")}),(0,l.jsx)("div",{className:_.Z["tip-area-text"],children:p.o.t("dataset_max_recall_desc")})]})]}),onClickOutSide:()=>{F(!1)},className:_.Z["dataset-top-k-popover"],getPopupContainer:()=>document.body,children:(0,l.jsx)("div",{style:{position:"relative"},children:(0,l.jsx)(x.PD,{min:1,max:20,step:1,value:C,customStyles:{sliderAreaStyle:{width:"160px"},boundaryStyle:{width:"158px",margin:0}},isDataSet:!0,marks:{markKey:5,markText:(0,l.jsx)("span",{className:"ml-2",children:"Default"})},onChange:e=>{n((0,r._)((0,o._)({},t),{top_k:e})),e>5?F(!0):F(!1)},onClickDefault:()=>{n((0,r._)((0,o._)({},t),{top_k:5}))},disabled:y||w})})})]}),z&&S!==g._.FullText?(0,l.jsxs)("div",{className:_.Z["setting-item"],children:[(0,l.jsx)(x.xs,{title:p.o.t("dataset_min_degree"),tip:p.o.t("bot_edit_datasetsSettings_MinTip")}),(0,l.jsx)("div",{style:{position:"relative"},children:(0,l.jsx)(x.PD,{min:.01,max:.99,step:.01,customStyles:{sliderAreaStyle:{width:"160px"},boundaryStyle:{width:"158px",margin:0}},isDataSet:!0,value:k,marks:{markKey:.5,markText:"Default"},disabled:y||w,onChange:e=>{n((0,r._)((0,o._)({},t),{min_score:e}))},onClickDefault:()=>{n((0,r._)((0,o._)({},t),{min_score:.5}))}})})]}):(0,l.jsx)(l.Fragment,{}),P?(0,l.jsx)("div",{className:_.Z["setting-item"],children:(0,l.jsx)(h.$,{checked:I,onChange:e=>{n((0,r._)((0,o._)({},t),{use_nl2sql:e}))},readonly:y,label:p.o.t("kl_write_022"),description:p.o.t("kl_write_023"),dataTestId:L("dataset_use_nl2sql")})}):null,(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(h.$,{checked:E,onChange:e=>{n((0,r._)((0,o._)({},t),{use_rewrite:e}))},readonly:y,label:p.o.t("kl_write_024"),description:p.o.t("kl_write_025"),dataTestId:L("dataset_use_rewrite"),tooltip:(0,l.jsx)(c.l,{}),tipWrapperClassName:_.Z["tips-container"]}),(0,l.jsx)(h.$,{checked:T,onChange:e=>{n((0,r._)((0,o._)({},t),{use_rerank:e}))},readonly:y,label:p.o.t("kl_write_026"),description:p.o.t("kl_write_027"),dataTestId:L("dataset_use_rerank"),tooltip:(0,l.jsx)(c.o,{}),tipWrapperClassName:_.Z["tips-container"]}),(0,l.jsx)(h.$,{checked:D,onChange:e=>{n((0,r._)((0,o._)({},t),{is_personal_only:e}))},readonly:y,label:p.o.t("kl_write_028"),description:p.o.t("kl_write_029"),dataTestId:L("dataset_is_only_personal")})]})]})}},935026:function(e,t,n){n.d(t,{_:function(){return r}});var o,r=((o={})[o.Semantic=0]="Semantic",o[o.Hybird=1]="Hybird",o[o.FullText=20]="FullText",o)},522667:function(e,t,n){n.d(t,{$:function(){return _}});var o=n(808549),r=n(120454),l=n(151064),a=n(455069),i=n(155440),s=n(671261),d=n(252237),u=n.n(d),c=n(450562),v=n(288391),p=n(528751),f=n(336205),m=n(674343),h=n(265842),g=n(115022),x=n(377113),_=e=>{var t,{value:n,onChange:d,options:_,readonly:y,feedbackStatus:w,feedbackText:j,customInputComp:b}=e,{getNodeSetterId:N}=(0,c.FCD)();(0,a.useEffect)(()=>{(0,i.Z)(null==n?void 0:n.chunkType)&&(0,i.Z)(null==n?void 0:n.maxLevel)&&(0,i.Z)(null==n?void 0:n.saveTitle)&&(0,i.Z)(null==n?void 0:n.overlap)&&(0,i.Z)(null==n?void 0:n.maxToken)&&(0,i.Z)(null==n?void 0:n.separator)&&(null==d||d({chunkType:"default"}))},[n,d]);var k=null!==(t=(0,p.Px)())&&void 0!==t?t:[],C=(null==n?void 0:n.chunkType)==="custom",S=(null==n?void 0:n.separatorType)===v.IB.CUSTOM;return(0,l.jsxs)("div",{className:u()("w-full mt-[4px]",{[null==_?void 0:_.customClassName]:null==_?void 0:_.customClassName}),children:[(0,l.jsx)(h.Y,(0,r._)((0,o._)({},e),{options:(0,r._)((0,o._)({},null==e?void 0:e.options),{direction:"vertical",customClassName:u()(x.Z["parser-radio-group"],C?"mb-[4px]":"mb-[24px]")}),value:null==n?void 0:n.chunkType,onChange:e=>{var t,n=null==e?void 0:null===(t=e.target)||void 0===t?void 0:t.value,o={chunkType:n};"layer"===n?(0,s.Z)(o,"maxLevel",3):"custom"===n&&((0,s.Z)(o,"separatorType",v.IB.LINE_BREAK),(0,s.Z)(o,"separator",v.IB.LINE_BREAK),(0,s.Z)(o,"maxToken",800),(0,s.Z)(o,"overlap",.1)),d(o)}})),C?(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:x.Z["setting-item"],style:{marginBottom:S?"8px":"16px"},children:[(0,l.jsx)("div",{style:{flex:2},children:(0,l.jsx)(g.xs,{title:f.o.t("datasets_Custom_segmentID"),tip:f.o.t("kl_write_030"),titleClassName:"text-[#060709CC] text-[12px]"})}),(0,l.jsx)("div",{style:{flex:3},children:(0,l.jsx)(m.Ph,{size:"small",placeholder:f.o.t("datasets_custom_segmentID_placeholder"),className:x.Z["separator-select"],style:{width:"100%",height:"24px",borderColor:"#06070926",borderRadius:"6px"},value:null==n?void 0:n.separatorType,onChange:e=>d((0,r._)((0,o._)({},n),{separator:e===v.IB.CUSTOM?"###":e,separatorType:e})),"data-testid":N("dataset-write-separator-select"),children:null==k?void 0:k.map(e=>(0,l.jsx)(m.Ph.Option,{value:e.value,"data-testid":N("dataset-write-separator-option"),children:e.label},e.value))})})]}),S?(0,l.jsxs)("div",{className:u()("w-full flex items-end 'flex-row' ".concat(x.Z["custom-input"])),children:[(0,l.jsx)("div",{style:{flex:2},children:(0,l.jsx)("div",{className:"w-[20px] h-[28px]"})}),(0,l.jsx)("div",{style:{flex:3},children:b||(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(m.II,{style:{fontSize:"12px",width:"100%"},value:null==n?void 0:n.separator,onChange:e=>d((0,r._)((0,o._)({},n),{separator:e})),placeholder:f.o.t("datasets_custom_segmentID_placeholder"),"data-testid":N("dataset-write-separator-input")}),"error"===w&&(0,l.jsx)("div",{className:"text-[12px] leading-[16px] text-[#ff441e]",children:j})]})})]}):null,(0,l.jsxs)("div",{className:x.Z["setting-item"],children:[(0,l.jsx)("div",{style:{flex:2},children:(0,l.jsx)(g.xs,{title:f.o.t("datasets_Custom_maxLength"),tip:f.o.t("kl_write_031"),titleClassName:"text-[#060709CC] text-[12px]"})}),(0,l.jsx)("div",{className:"relative pt-[14px]",style:{flex:3},children:(0,l.jsx)(g.PD,{min:100,max:5e3,step:1,customStyles:{sliderAreaStyle:{width:"100%"},boundaryStyle:{width:"100%",margin:0}},isDataSet:!0,value:null==n?void 0:n.maxToken,marks:{markKey:800,markText:(0,l.jsx)("span",{className:"ml-9",children:"Default"})},disabled:y,onChange:e=>{d((0,r._)((0,o._)({},n),{maxToken:e}))},onClickDefault:()=>{d((0,r._)((0,o._)({},n),{maxToken:800}))}})})]}),(0,l.jsxs)("div",{className:x.Z["setting-item"],children:[(0,l.jsx)("div",{style:{flex:2},children:(0,l.jsx)(g.xs,{title:f.o.t("kl_write_014"),tip:f.o.t("kl_write_015"),titleClassName:"text-[#060709CC] text-[12px]"})}),(0,l.jsx)("div",{className:"relative pt-[14px]",style:{flex:3},children:(0,l.jsx)(g.PD,{min:0,max:.9,step:.01,customStyles:{sliderAreaStyle:{width:"100%"},boundaryStyle:{width:"100%",margin:0}},isDataSet:!0,value:null==n?void 0:n.overlap,marks:{markKey:.1,markText:(0,l.jsx)("span",{className:"ml-8",children:"Default"})},disabled:y,onChange:e=>{d((0,r._)((0,o._)({},n),{overlap:e}))},onClickDefault:()=>{d((0,r._)((0,o._)({},n),{overlap:.1}))}})})]})]}):null]})}},54475:function(e,t,n){n.d(t,{h:function(){return f}});var o=n(808549),r=n(120454),l=n(151064),a=n(455069),i=n(155440),s=n(671261),d=n(450562),u=n(336205),c=n(265842),v=n(634102),p=n(938521),f=e=>{var t,n,f,{value:m,onChange:h,readonly:g}=e,{data:x}=(0,d.rsR)(),{getNodeSetterId:_}=(0,d.FCD)();(0,a.useEffect)(()=>{(0,i.Z)(null==m?void 0:m.parsingType)&&(0,i.Z)(null==m?void 0:m.imageExtraction)&&(0,i.Z)(null==m?void 0:m.tableExtraction)&&(0,i.Z)(null==m?void 0:m.imageOcr)&&(null==h||h({parsingType:"fast"}))},[m,h]);var y=(null==m?void 0:m.parsingType)==="accurate",w=(null===(f=x.inputs)||void 0===f?void 0:null===(n=f.datasetWriteParameters)||void 0===n?void 0:null===(t=n.chunkStrategy)||void 0===t?void 0:t.chunkType)==="custom",j=(0,a.useMemo)(()=>y&&w,[y,w]);return(0,a.useEffect)(()=>{j&&(null==h||h((0,r._)((0,o._)({},m),{imageOcr:!1})))},[j]),(0,l.jsxs)("div",{className:"mb-[12px] mt-[4px]",children:[(0,l.jsx)(c.Y,(0,r._)((0,o._)({},e),{options:(0,r._)((0,o._)({},null==e?void 0:e.options),{direction:"vertical",customClassName:p.Z["parser-radio-group"]}),value:null==m?void 0:m.parsingType,onChange:e=>{var t,n=null==e?void 0:null===(t=e.target)||void 0===t?void 0:t.value,o={parsingType:n};"accurate"===n&&((0,s.Z)(o,"imageExtraction",!0),(0,s.Z)(o,"tableExtraction",!0),(0,s.Z)(o,"imageOcr",!0)),null==h||h(o)},readonly:g})),(null==m?void 0:m.parsingType)==="accurate"?(0,l.jsxs)("div",{className:"mt-[8px]",children:[(0,l.jsx)(v.$,{label:u.o.t("kl_write_008"),checked:null==m?void 0:m.imageExtraction,onChange:e=>null==h?void 0:h((0,r._)((0,o._)({},m),{imageExtraction:e})),readonly:g,dataTestId:_("dataset-write-imageExtraction")}),(0,l.jsx)(v.$,{label:u.o.t("kl_write_009"),checked:null==m?void 0:m.imageOcr,onChange:e=>null==h?void 0:h((0,r._)((0,o._)({},m),{imageOcr:e})),disabled:j,readonly:g,dataTestId:_("dataset-write-imageOcr")}),(0,l.jsx)(v.$,{label:u.o.t("kl_write_010"),checked:null==m?void 0:m.tableExtraction,onChange:e=>null==h?void 0:h((0,r._)((0,o._)({},m),{tableExtraction:e})),readonly:g,dataTestId:_("dataset-write-tableExtraction")})]}):null]})}},706489:function(e,t,n){n.d(t,{E:function(){return _}});var o=n(808549),r=n(151064),l=n(455069),a=n(252237),i=n.n(a),s=n(267334),d=n(450562),u=n(915757),c=n(674343),v=n(698707),p=n(667724),f=n(275546),m=n(945429),h="custom-action-button",{Slots:g,Slot:x}=(0,p.Z)(["Action"]),_=e=>{var{children:t,icon:n,header:a,actionButton:p,actionButtonStyle:x,maxContentHeight:_,tooltip:y,tooltipClassName:w,className:j,contentClassName:b,headerClassName:N,style:k,collapsible:C=!0,defaultExpand:S=!0,autoExpandWhenDomChange:I,onRef:T,noPadding:E=!1,feedbackText:D,feedbackStatus:Z,disableFeedback:M=!1,expand:P,motion:L,required:z,hidden:O,headerStyle:A,testId:F}=e,[R,V]=(0,l.useState)(null!=P?P:S),B=(0,l.useRef)(null),{getNodeSetterId:G,concatTestId:W}=(0,d.FCD)(),U=W(F||G(""),"form-card"),H=(0,r.jsx)("div",{ref:B,style:{maxHeight:_||"unset"},children:t});(0,l.useEffect)(()=>{void 0!==P&&V(P)},[P]),(0,l.useEffect)(()=>{var e=B.current;if(I&&e){var t=new MutationObserver(e=>{e.length>0&&!R&&V(!R)});return t.observe(e,{attributes:!0,childList:!0,subtree:!0}),()=>{t.disconnect()}}return s.wl},[R]),(0,l.useImperativeHandle)(T,()=>({setOpen:J}));var J=e=>{V(e)};return(0,r.jsx)(g,{children:e=>(0,r.jsxs)("div",{className:i()(j,m.Z["content-block"],{[m.Z["no-padding"]]:E,hidden:O}),style:k,children:[(0,r.jsxs)("header",{className:i()(m.Z["header-content"],N,{[m.Z["header-has-content"]]:!!R&&(C||n||a||y),[m.Z["header-is-closed"]]:!R,"cursor-pointer":C}),style:A,onClick:e=>{if(!!C){for(var t=e.target,n=0;n<=8;n++){if(t.classList.contains(h))return;if(!t.parentElement)break;t=t.parentElement}V(!R)}},children:[(0,r.jsxs)("div",{className:m.Z.header,"data-testid":W(U,"title"),children:[C?(0,r.jsx)("div",{className:i()(C?"cursor-pointer":"cursor-default",{[m.Z["header-icon-arrow"]]:!0,[m.Z.open]:R}),"data-testid":W(U,"arrow"),children:(0,r.jsx)(u.C_O,{className:"coz-fg-secondary"})}):null,n?(0,r.jsx)(c.Ee,{preview:!1,className:m.Z["header-icon"],src:n}):null,a?(0,r.jsxs)("div",{className:m.Z.label,children:[a,z?(0,r.jsx)("span",{className:"ml-[2px] text-[#FF441E]",children:"*"}):null]}):null,y?(0,r.jsx)(f.Z,{showArrow:!0,position:"top",className:m.Z.popover,content:(0,r.jsx)("span",{"data-testid":W(U,"tooltip-content"),children:y}),tooltipClassName:w,children:(0,r.jsx)(u.L03,{"data-testid":W(U,"tooltip-icon-info"),className:"text-lg coz-fg-secondary"})}):null]}),(0,r.jsx)("div",{className:h,style:(0,o._)({},x||{}),children:e.Action||p})]}),(0,r.jsx)("div",{className:i()({[m.Z["overflow-content"]]:!0,[b||""]:!!b,[m.Z.open]:R}),children:(0,r.jsx)(c.zF,{keepDOM:!0,fade:!0,isOpen:R,motion:L,children:H})}),!M&&(0,r.jsx)(v.P,{feedbackText:D,feedbackStatus:Z})]})})};_.Action=e=>{var{children:t}=e;return(0,r.jsx)(x,{name:"Action",children:t})}},698707:function(e,t,n){n.d(t,{P:function(){return i}});var o=n(151064);n(455069);var r=n(252237),l=n.n(r),a=n(686117),i=e=>{var{feedbackText:t,className:n,style:r}=e;return t?(0,o.jsx)("div",{className:l()(a.Z.formItemError,n),style:r,children:t}):null}},776274:function(e,t,n){n.d(t,{x:function(){return p}});var o=n(808549),r=n(120454),l=n(151064);n(455069);var a=n(252237),i=n.n(a),s=n(915757),d=n(674343),u=n(698707),c=n(275546),v=n(132360),p=e=>{var{className:t,style:n={},required:a,hideRequiredTag:p=!1,layout:f="horizontal",label:m,tooltip:h,tag:g,labelAlign:x="left",labelCol:_={span:9},wrapperCol:y={span:15},labelBlockStyle:w={},labelStyle:j={},labelColStyle:b={},wrapperColStyle:N={},labelClassName:k,feedbackText:C,feedbackStatus:S,children:I,disableFeedback:T=!1}=e,E=()=>(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsxs)("div",{className:"flex overflow-hidden items-center",children:[(0,l.jsx)(c.Z,{content:m,showArrow:!0,position:"top",className:"flex-1 grow-1 truncate",children:(0,l.jsx)("span",{className:i()("flex-1 grow-1 truncate coz-fg-primary text-[12px] leading-[24px]",k),style:j,children:m})}),a&&!p?(0,l.jsx)("span",{className:"mt-[2px]",style:{color:"var(--light-usage-danger-color-danger,#f93920)"},children:"*"}):null,h?(0,l.jsx)(c.Z,{showArrow:!0,position:"top",className:v.Z.popover,content:h,children:(0,l.jsx)(s.L03,{className:"coz-fg-secondary text-xs"})}):null]}),g?(0,l.jsx)("div",{className:"flex-1 shrink-0 grow-1 flex items-center",children:g}):null]}),D=!!m;return"horizontal"===f?(0,l.jsx)("div",{className:i()(v.Z.formItem,t,{[v.Z.formItemHorizontal]:"horizontal"===f}),style:n,children:(0,l.jsxs)(d.X2,{type:"flex",align:"middle",children:[(0,l.jsx)(d.JX,(0,r._)((0,o._)({},_),{style:(0,o._)({},{alignSelf:"flex-start"},b),children:(0,l.jsx)("div",{className:i()(v.Z.formItemLabel,{[v.Z.formItemLabelRight]:"right"===x}),children:E()})})),(0,l.jsxs)(d.JX,(0,r._)((0,o._)({},y),{style:N,children:[I,!T&&(0,l.jsx)(u.P,{feedbackText:C,feedbackStatus:S})]}))]})}):(0,l.jsxs)("div",{className:i()(v.Z.formItem,t,{[v.Z.formItemVertical]:"vertical"===f}),style:n,children:[D?(0,l.jsx)("div",{className:i()(v.Z.formItemLabel,{[v.Z.formItemLabelRight]:"right"===x}),style:w,children:E()}):null,(0,l.jsx)("div",{children:I}),!T&&(0,l.jsx)(u.P,{feedbackText:C,feedbackStatus:S})]})}},319529:function(e,t,n){n.d(t,{L:()=>u,W:()=>c});var o=n("151064"),r=n("252237"),l=n.n(r),a=n("336205"),i=n("915757"),s=n("674343"),d=n("205641"),u=e=>{var{icon:t,tooltip:n,onClick:r,testID:l}=e;return(0,o.jsx)(s.u,{content:n,autoAdjustOverflow:!0,children:(0,o.jsx)(s.hU,{icon:t,color:"secondary",onClick:r,"data-testid":l})})},c=e=>{var{name:t,icon:n,description:r,onRemove:c,onClick:v,readonly:p,actions:f,testID:m,nameSuffix:h,isInvalid:g,showDeleteBtn:x=!0,alwaysShowActions:_=!1,className:y,descriptionTooltipPosition:w}=e;return(0,o.jsxs)("div",{className:l()("group coz-stroke-primary coz-mg-card p-2.5 rounded-lg border border-solid flex items-center gap-2.5 mb-2 last:mb-0 hover:coz-mg-secondary",{"cursor-pointer hover:cursor-pointer":v&&!g,"cursor-not-allowed":g},y),onClick:p?void 0:v,"data-testid":m,children:[(0,o.jsx)("div",{className:"h-8",style:{flex:"0 0 32px"},children:n?"string"==typeof n?(0,o.jsx)(s.qE,{src:n,size:"small",className:"coz-stroke-primary rounded-mini overflow-hidden border border-solid"}):n:null}),(0,o.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)(d.x,{className:"!coz-fg-primary !leading-mini !font-medium !text-base",text:t}),h?(0,o.jsx)("div",{className:"flex items-center ml-[4px]",children:h}):null]}),(0,o.jsx)(d.x,{className:"!coz-fg-secondary !leading-mini !font-normal !text-base",text:r,tooltipPosition:w})]}),(0,o.jsx)("div",{className:l()("flex-0",{"hidden group-hover:block":!_}),onClick:e=>{e.stopPropagation()},children:(0,o.jsx)("div",{className:"flex gap-1.5",children:p?(0,o.jsx)(o.Fragment,{}):(0,o.jsxs)(o.Fragment,{children:[null!=f?f:void 0,x?(0,o.jsx)(u,{tooltip:a.o.t("Remove"),icon:(0,o.jsx)(i.dVD,{}),onClick:c,testID:"".concat(m,".remove")}):null]})})})]})}},113006:function(e,t,n){n.d(t,{a:()=>V});var o,r=n("808549"),l=n("120454"),a=n("151064"),i=n("455069"),s=n("801815"),d=n("335740"),u=n("252237"),c=n.n(u),v=n("450562"),p=n("336205"),f=n("674343"),m=n("706489"),h=n("57224");function g(e){var t,n;return(null==e?void 0:null===(n=e.input)||void 0===n?void 0:null===(t=n.rawMeta)||void 0===t?void 0:t.type)===v.owu.Object}var x=(0,i.createContext)({}),_=()=>(0,i.useContext)(x),y=x.Provider;var w=((o={})[o.Update=0]="Update",o[o.Delete=1]="Delete",o[o.Append=2]="Append",o[o.DeleteChildren=3]="DeleteChildren",o),j=n("755887"),b=n("164634"),N=n("667141"),k=n("271810"),C=e=>{var t,{data:n,onChange:o,style:r,level:l,disabled:s,disabledTypes:d,testName:u=""}=e,c=(0,i.useMemo)(()=>n.input&&v.nZF.isObjectRef(n.input)?v.owu.getComplement([v.owu.Object]):[...new Set([...l>=3?[v.owu.Object,v.owu.ArrayObject]:[],...d||[]])],[n.input,d,l]),{getNodeSetterId:p}=(0,v.FCD)();return(0,a.jsx)(N.C,{path:"".concat(null===(t=n.field)||void 0===t?void 0:t.slice(n.field.indexOf("[")),".input"),className:k.Z.container,style:r,errorCompClassName:"output-param-name-error-text",children:e=>(0,a.jsx)(b.N,{testId:p("".concat(u,"/input")),value:null==n?void 0:n.input,onBlur:()=>{setTimeout(()=>{e.onBlur()},33)},onChange:t=>{e.onChange(),o(t)},readonly:s,disabledTypes:c,validateStatus:e.showError?"error":"default"})})},S=n("915757"),I=n("882617"),T=n("241582");function E(e){var{data:t,level:n,onDelete:o,onAppend:r,hasObject:l,needRenderAppendChild:i=!0,disableDelete:s}=e,{testId:d}=_(),{concatTestId:u}=(0,v.FCD)(),m=g(t)&&!(n>=3);return(0,a.jsxs)("div",{className:c()(T.Z.container,"gap-1"),children:[l?(0,a.jsx)("div",{className:T.Z.add,children:(0,a.jsx)(f.u,{content:p.o.t("workflow_detail_node_output_add_subitem"),children:(0,a.jsx)("div",{children:m&&i?(0,a.jsx)(I.Z,{"data-testid":u(null!=d?d:"",t.field,"add-sub-param"),size:"small",color:"secondary",className:"cursor-pointer",onClick:r,subitem:!0}):null})})}):null,(0,a.jsx)(f.hU,{className:"!block",size:"small",color:"secondary","data-testid":u(null!=d?d:"",t.field,"remove-param"),onClick:()=>{o()},disabled:s,icon:(0,a.jsx)(S.ozt,{className:"text-sm"})})]})}var D=n("508363"),Z=n("113582");function M(e){var t,{data:n,disabled:o,onChange:r,style:l,isPureText:i=!1,testName:s=""}=e;return(0,a.jsx)(N.C,{path:"".concat(null===(t=n.field)||void 0===t?void 0:t.slice(n.field.indexOf("[")),".name"),className:Z.Z.container,style:l,errorCompClassName:"output-param-name-error-text",children:e=>(0,a.jsx)(D.l,{name:"".concat(s,"/name"),value:n.name,input:n.input,inputParameters:n.inputParameters||[],onChange:t=>{null==r||r(t),e.onChange()},onBlur:()=>{setTimeout(()=>{e.onBlur()},33)},isPureText:i,disabled:o})})}function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"3:2",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,[n,o]=e.split(":").map(Number);return{name:{flex:"".concat(n," ").concat(n," 0")},value:{flex:"".concat(o," ").concat(o," ").concat(15*t*o/n,"px")}}}var L=n("702716");function z(e){var{data:t,className:n,level:o,readonly:s=!1,onChange:d,hasObject:u,couldCollapse:v=!0,collapsed:p=!0,onCollapse:f,needRenderAppendChild:m=!0,columnsRatio:h,isNamePureText:g,disabledTypes:x,disableDelete:_}=e,y=(0,i.useRef)(null),b=P(h,o),N="/inputs/inputParameters".concat((t.field||"").replaceAll(".","/").replace(/\[(\d+)\]/g,"/$1")),k=(0,i.useRef)(null==t?void 0:t.name),S=(0,i.useRef)(null==t?void 0:t.input),I=(0,a.jsxs)("div",{className:c()({[L.Z.wrapper]:!0}),children:[(0,a.jsx)(M,{data:t,onChange:e=>{if(t.name!==e)k.current=e,d(w.Update,(0,l._)((0,r._)({},t),{name:e,input:S.current}))},style:b.name,disabled:s,isPureText:g,testName:N}),(0,a.jsx)(C,{data:t,onChange:e=>{S.current=e,d(w.Update,(0,l._)((0,r._)({},t),{input:e,name:k.current}))},style:b.value,level:o,disabled:s,disabledTypes:x,testName:N}),s?null:(0,a.jsx)(E,{data:t,level:o,onDelete:()=>{d(w.Delete,t)},onAppend:()=>{d(w.Append,t)},hasObject:u,needRenderAppendChild:m,disableDelete:_})]});return(0,a.jsxs)("div",{className:c()({[n]:!!n,[L.Z["param-container"]]:!0}),ref:y,children:[(0,a.jsx)(j.G,{level:o,data:t,collapsed:p,onCollapse:f,couldCollapse:v,readonly:s,expandContentVisible:!0}),(0,a.jsx)("div",{className:"w-full",style:{paddingLeft:v?10:0},children:(0,a.jsx)("div",{className:c()({[L.Z["expand-wrapper"]]:!0,"flex-grow":!v}),children:I})})]})}var O=n("871284");function A(e){var{readonly:t,config:n,columnsRatio:o}=e,r=P(o);return t?null:(0,a.jsxs)("div",{className:O.Z.header,style:{marginLeft:n.hasCollapse?18:0},children:[(0,a.jsx)("div",{className:O.Z.name,style:r.name,children:(0,a.jsx)("span",{className:O.Z.text,children:p.o.t("workflow_detail_node_parameter_name")})}),(0,a.jsx)("div",{className:O.Z.value,style:r.value,children:(0,a.jsx)("span",{className:O.Z.text,children:p.o.t("workflow_detail_node_parameter_value")})}),t?null:(0,a.jsxs)("div",{className:"relative flex gap-1",children:[n.hasObject?(0,a.jsx)("div",{className:"w-6"}):null,(0,a.jsx)("div",{className:"w-6"})]})]})}var F=n("622510"),R=(e,t)=>(0,r._)({fieldRandomKey:(0,s.x0)()},(null==t?void 0:t(e))||{});function V(e){var t,n,o,{testId:u,readonly:x=!1,isBatch:_=!1,disabled:j,disabledTooltip:b,children:N,allowAppendRootData:k=!0,treeProps:C,title:S=p.o.t("workflow_detail_node_parameter_input"),titleTooltip:I=S,className:T,style:E,value:D,onChange:Z,topLevelReadonly:M=!1,emptyPlaceholder:P,noCard:L=!1,addItemTitle:O=p.o.t("workflow_add_input"),defaultCollapse:V=!1,formCardDefaultCollapse:B=!1,maxLimit:G,columnsRatio:W="4:6",isNamePureText:U,defaultAppendValue:H,nthCannotDeleted:J=0,disableDelete:q}=e,K=(0,i.useRef)(null),X=!D||0===D.length;var{data:Y=[],hasObject:Q,itemKeysWithChildren:$}=(t=(0,d.Z)(D),n=!1,o=[],!function e(t,r,l){var{parentData:a,level:i}=l,d=t||[],u=d.map(e=>e?{name:e.name,input:e.input}:void 0).filter(Boolean);d.forEach((l,d)=>{var c,v,p="".concat(r,"[").concat(d,"]");n=n||g(l),l.key=null!==(v=null!==(c=l.key)&&void 0!==c?c:l.fieldRandomKey)&&void 0!==v?v:(0,s.x0)(),l.field=p,l.inputParameters=u,l.isFirst=0===d,l.isLast=d===t.length-1,l.isSingle=l.isFirst&&l.isLast,l.level=i,l.helpLineShow=a&&i>=2?(a.helpLineShow||[]).concat(!a.isLast):[],l.children&&l.children.length>0&&(o.push(l.key),e(l.children,"".concat(p,".children"),{parentData:l,level:i+1}))})}(t||[],"",{level:0}),{data:t,hasObject:n,itemKeysWithChildren:o}),ee=0===Y.length,{expandedKeys:et,expandTreeNode:en,collapseTreeNode:eo}=function(e,t){var[n,o]=(0,i.useState)(t?[]:e),r=(0,i.useCallback)(e=>{o([...new Set([...n,e])])},[e]),l=(0,i.useCallback)(e=>{o([...n.filter(t=>t!==e)])},[e]);return{expandedKeys:n,expandTreeNode:r,collapseTreeNode:l}}($,V),er=(0,i.useMemo)(()=>{var e;return void 0!==G&&(null!==(e=null==D?void 0:D.length)&&void 0!==e?e:0)>=G},[D,G]),{concatTestId:el}=(0,v.FCD)(),ea=e=>{Z&&(!function e(t,n){(Array.isArray(t)?t:[t]).forEach(t=>{n(t),t.children&&t.children.length>0&&e(t.children,n)})}(e=(e||[]).concat([]),e=>{var{key:t,name:n,input:o,children:r}=e;for(var l in e)delete e[l];e.key=t||(0,s.x0)(),e.name=n,e.input=o,r&&(e.children=r)}),Z(e))},ei=(e,t)=>{var n,o,r,l,a,i;return e===w.Append&&(null===(o=t.input)||void 0===o?void 0:null===(n=o.rawMeta)||void 0===n?void 0:n.type)===v.owu.Object&&(null===(r=t.input)||void 0===r?void 0:r.type)!==v.YX3.OBJECT_REF&&0===(t.children||[]).length&&(t.input={type:v.YX3.OBJECT_REF,rawMeta:{type:v.owu.Object}}),[w.Delete,w.DeleteChildren].includes(e)&&(null===(a=t.input)||void 0===a?void 0:null===(l=a.rawMeta)||void 0===l?void 0:l.type)===v.owu.Object&&t.input.type!==v.YX3.REF&&0===(t.children||[]).length&&(t.input={type:v.YX3.LITERAL,rawMeta:null===(i=t.input)||void 0===i?void 0:i.rawMeta,content:"{}"}),t},es=(e,t)=>{var n=(0,d.Z)(Y);var o=(a=n,i=t.field,(s=a.find(e=>e.field===i))?{isRoot:!0,parentData:null,data:s}:function e(t,n){for(var o of t){var r,l,a=(r=o,l=n||o,r.field===i?{isRoot:!1,parentData:l,data:r}:r.children&&r.children.length>0?e(r.children,r):null);if(a)return a}return null}(a));if(o)switch(e){case w.Append:var a,i,s,u,{data:c}=o,v=c.children||[];ei(e,c),c.children=v.concat((0,l._)((0,r._)({},R(v,H)),{field:"".concat(c.field,".children[").concat(v.length,"]")})),ea(n),(null==o?void 0:null===(u=o.data)||void 0===u?void 0:u.key)&&en(o.data.key);break;case w.Update:var m,h=o.isRoot?n:null===(m=o.parentData)||void 0===m?void 0:m.children,g=null==h?void 0:h.findIndex(e=>e.key===t.key);void 0!==g&&(null==h||h.splice(g,1,t),ea(n));break;case w.Delete:if(o.isRoot)ea((n||[]).filter(e=>e.key!==t.key));else{var x=o.parentData;x.children=(x.children||[]).filter(e=>e.key!==t.key),ei(e,x),ea(n)}break;case w.DeleteChildren:var{data:_}=o;_.children=[],!o.isRoot&&ei(e,_),ea(n)}else f.FN.error(p.o.t("workflow_detail_node_output_parsingfailed"))};if(x&&X)return null;var ed=L?i.Fragment:m.E,eu=!x&&!M&&k&&!er,ec=Y.length;return(0,a.jsx)(y,{value:{testId:u},children:(0,a.jsx)("div",{className:c()({[F.Z.container]:!0,[F.Z["not-readonly"]]:!x,[T||""]:!!T,[F.Z["could-collapse"]]:$.length>0}),style:E,ref:K,children:(0,a.jsxs)(ed,{autoExpandWhenDomChange:!0,defaultExpand:!B,showBottomBorder:!0,header:S,tooltip:I,contentClassName:"nowheel",noPadding:!0,children:[!ee&&(0,a.jsx)(A,{readonly:x,config:{hasObject:Q,hasCollapse:$.length>0},columnsRatio:W}),(0,a.jsx)(f.mp,(0,r._)({expandAll:!x,style:x?{}:{overflow:"inherit"},motion:!1,disabled:j,className:c()({[F.Z.content]:!0,[F.Z.readonly]:x,[F.Z["content-fix-pop-container"]]:!x}),renderFullLabel:e=>{var{data:t}=e,n=(()=>{var e,n;if(q)return!0;if(0===J)return!1;return(0===t.level?ec:(null===(n=t.parent)||void 0===n?void 0:null===(e=n.children)||void 0===e?void 0:e.length)||0)<J+1})();return(0,a.jsx)(z,(0,l._)((0,r._)({},e),{readonly:x,onChange:es,hasObject:Q,disableDelete:n,couldCollapse:$.length>0,collapsed:e.expandStatus.expanded,onCollapse:e=>{var{key:n}=t;if(!!n)e?en(n):eo(n)},columnsRatio:W,isNamePureText:U}))},emptyContent:P&&(0,a.jsx)("p",{className:F.Z.emptyPlaceholder,children:P}),expandedKeys:[...et,(0,s.x0)()],treeData:Y},C)),eu?(0,a.jsx)(h.A,{className:"absolute right-0 top-0",onMouseDown:()=>{Z&&Z((Y||[]).concat((0,l._)((0,r._)({},R(Y,H)),{field:"[".concat(Y.length,"]")})))},disabled:_||j,disabledTooltip:b,testId:el(null!=u?u:"","add-output-item"),style:{marginLeft:$.length>0?10:0},title:O}):null,N]})})})}},164856:function(e,t,n){n.d(t,{n:function(){return a}});var o=n(151064),r=n(674343),l=n(44172),a=e=>{var{label:t,tooltip:n}=e;return(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)(r.ZT.Text,{className:"mr-[8px]",ellipsis:{showTooltip:{opts:{content:t}}},style:{maxWidth:160},children:t}),(0,o.jsx)(r.u,{content:n,children:(0,o.jsx)(l.aUG,{style:{color:"rgba(167, 169, 176, 1)"}})})]})}},755887:function(e,t,n){n.d(t,{G:()=>k});var o,r=n("151064"),l=n("455069"),a=n("252237"),i=n.n(a),s=n("915757");var d=((o={})[o.HalfTopRoot=0]="HalfTopRoot",o[o.HalfTopRootWithChildren=1]="HalfTopRootWithChildren",o[o.HalfBottomRoot=2]="HalfBottomRoot",o[o.HalfBottomRootWithChildren=3]="HalfBottomRootWithChildren",o[o.FullRoot=4]="FullRoot",o[o.FullRootWithChildren=5]="FullRootWithChildren",o[o.HalfTopChild=6]="HalfTopChild",o[o.HalfTopChildWithChildren=7]="HalfTopChildWithChildren",o[o.FullChild=8]="FullChild",o[o.FullChildWithChildren=9]="FullChildWithChildren",o[o.EmptyBlock=10]="EmptyBlock",o[o.HelpLineBlock=11]="HelpLineBlock",o[o.RootWithChildren=12]="RootWithChildren",o),u=n("180991");function c(e){var{className:t,style:n,collapsed:o,onCollapse:l}=e;return o?(0,r.jsx)(s.Wdl,{className:i()(u.Z.triangle,t),style:n,onClick:()=>null==l?void 0:l(!1)}):(0,r.jsx)(s.x5d,{className:i()(u.Z.triangle,t),style:n,onClick:()=>null==l?void 0:l(!0)})}function v(e){var{className:t,style:n}=e;return(0,r.jsx)("div",{className:i()(u.Z.emptyBlock,t),style:n})}function p(e){var{className:t,style:n}=e;return(0,r.jsx)("div",{className:i()(u.Z.helpLineBlock,t),style:n,children:(0,r.jsx)("div",{className:u.Z.line})})}function f(e){var{className:t,style:n,collapsed:o,onCollapse:l}=e;return(0,r.jsxs)("div",{className:i()(u.Z.halfTopRoot,t),style:n,children:[(0,r.jsx)("div",{className:u.Z.line}),(0,r.jsx)(c,{className:u.Z.triangle,collapsed:o,onCollapse:l})]})}function m(e){var{className:t,style:n,collapsed:o,onCollapse:l}=e;return(0,r.jsx)(f,{className:i()(u.Z.children,t),style:n,collapsed:o,onCollapse:l})}function h(e){var{className:t,style:n,collapsed:o,onCollapse:l}=e;return(0,r.jsxs)("div",{className:i()(u.Z.halfBottomRoot,t),style:n,children:[(0,r.jsx)("div",{className:u.Z.line}),(0,r.jsx)(c,{className:u.Z.triangle,collapsed:o,onCollapse:l})]})}function g(e){var{className:t,style:n,collapsed:o,onCollapse:l}=e;return(0,r.jsx)(h,{className:i()(u.Z.children,t),style:n,collapsed:o,onCollapse:l})}function x(e){var{className:t,style:n,collapsed:o,onCollapse:l}=e;return(0,r.jsxs)("div",{className:i()(u.Z.fullRoot,t),style:n,children:[(0,r.jsx)("div",{className:u.Z.topLine}),(0,r.jsx)("div",{className:u.Z.bottomLine}),(0,r.jsx)(c,{className:u.Z.triangle,collapsed:o,onCollapse:l})]})}function _(e){var{className:t,style:n,collapsed:o,onCollapse:l}=e;return(0,r.jsx)(x,{className:i()(u.Z.children,t),style:n,collapsed:o,onCollapse:l})}function y(e){var{className:t,style:n,collapsed:o,onCollapse:l}=e;return(0,r.jsxs)("div",{className:i()(u.Z.halfTopChild,t),style:n,children:[(0,r.jsx)("div",{className:u.Z.line}),(0,r.jsx)(c,{className:u.Z.triangle,collapsed:o,onCollapse:l})]})}function w(e){var{className:t,style:n,collapsed:o,onCollapse:l}=e;return(0,r.jsxs)("div",{className:i()(u.Z.halfTopChild,u.Z.children,t),style:n,children:[(0,r.jsx)("div",{className:u.Z.topLine}),(0,r.jsx)(c,{className:u.Z.triangle,collapsed:o,onCollapse:l})]})}function j(e){var{className:t,style:n,collapsed:o,onCollapse:l}=e;return(0,r.jsxs)("div",{className:i()(u.Z.fullChild,t),style:n,children:[(0,r.jsx)("div",{className:u.Z.line}),(0,r.jsx)("div",{className:u.Z.bottomLine}),(0,r.jsx)(c,{className:u.Z.triangle,collapsed:o,onCollapse:l})]})}function b(e){var{className:t,style:n,collapsed:o,onCollapse:l}=e;return(0,r.jsx)(j,{className:i()(u.Z.children,t),style:n,collapsed:o,onCollapse:l})}function N(e){var{className:t,style:n,collapsed:o,onCollapse:l}=e;return(0,r.jsx)("div",{className:i()(u.Z.rootWithChildren,t),style:n,children:(0,r.jsx)(c,{className:u.Z.triangle,collapsed:o,onCollapse:l})})}function k(e){var t,{level:n,data:o,className:a,style:s,collapsed:c=!0,onCollapse:k,multiInfo:C={multiline:!1},couldCollapse:S,expandContentVisible:I,readonly:T,treeIndentWidth:E=15}=e,D=function(e){var{level:t,data:n}=e,o=0===t&&(n.children||[]).length>0,r=0===t&&0===(n.children||[]).length,l=t>0&&(n.children||[]).length>0,a=t>0&&0===(n.children||[]).length,i=(n.helpLineShow||[]).map(e=>e?d.HelpLineBlock:d.EmptyBlock);return o?i.push(d.RootWithChildren):!r&&(l?n.isLast?i.push(d.HalfTopChildWithChildren):(n.isFirst,i.push(d.FullChildWithChildren)):a&&(n.isLast?i.push(d.HalfTopChild):(n.isFirst,i.push(d.FullChild)))),i}({level:n,data:o}),Z={[d.HalfTopRoot]:(0,r.jsx)(f,{className:a,style:s,collapsed:c,onCollapse:k}),[d.HalfTopRootWithChildren]:(0,r.jsx)(m,{className:a,style:s,collapsed:c,onCollapse:k}),[d.HalfBottomRoot]:(0,r.jsx)(h,{className:a,style:s,collapsed:c,onCollapse:k}),[d.HalfBottomRootWithChildren]:(0,r.jsx)(g,{className:a,style:s,collapsed:c,onCollapse:k}),[d.FullRoot]:(0,r.jsx)(x,{className:a,style:s,collapsed:c,onCollapse:k}),[d.FullRootWithChildren]:(0,r.jsx)(_,{className:a,style:s,collapsed:c,onCollapse:k}),[d.HalfTopChild]:(0,r.jsx)(y,{className:i()((null==C?void 0:C.multiline)?u.Z.multiline:null,(null==C?void 0:C.withNameError)?u.Z["with-name-error"]:null,a),style:s,collapsed:c,onCollapse:k}),[d.HalfTopChildWithChildren]:(0,r.jsx)(w,{className:i()((null==C?void 0:C.multiline)?u.Z.multiline:null,(null==C?void 0:C.withNameError)?u.Z["with-name-error"]:null,a),style:s,collapsed:c,onCollapse:k}),[d.FullChild]:(0,r.jsx)(j,{className:i()((null==C?void 0:C.multiline)?u.Z.multiline:null,(null==C?void 0:C.withNameError)?u.Z["with-name-error"]:null,a),style:s,collapsed:c,onCollapse:k}),[d.FullChildWithChildren]:(0,r.jsx)(b,{className:i()((null==C?void 0:C.multiline)?u.Z.multiline:null,(null==C?void 0:C.withNameError)?u.Z["with-name-error"]:null,a),style:s,collapsed:c,onCollapse:k}),[d.EmptyBlock]:(0,r.jsx)(v,{className:a,style:s,collapsed:c,onCollapse:k}),[d.HelpLineBlock]:(0,r.jsx)(p,{className:a,style:s,collapsed:c,onCollapse:k}),[d.RootWithChildren]:(0,r.jsx)(N,{className:a,style:s,collapsed:c,onCollapse:k})};return(0,r.jsxs)("div",{style:{width:S?n*E:0},className:i()(a,u.Z["level-line"],T?u.Z.readonly:"",S?u.Z["could-collapse"]:""),children:[D.map((e,t)=>(0,r.jsx)(l.Fragment,{children:Z[e]},t)),I&&(null==D?void 0:D.length)&&(null===(t=o.children)||void 0===t?void 0:t.length)&&c?(0,r.jsx)("div",{className:u.Z["expand-line"],style:{transform:"translateX(".concat(15*n,"px)")}}):null]})}},261492:function(e,t,n){n.d(t,{b:()=>d});var o=n("151064"),r=n("915757"),l=n("674343"),a=n("489350"),i=n("319529"),s=e=>{var{readonly:t,onDelete:n,onClick:r,library:l,testID:a="",isInvalid:s}=e;return(0,o.jsx)(i.W,{readonly:t,name:null==l?void 0:l.name,nameSuffix:null==l?void 0:l.nameExtra,description:null==l?void 0:l.description,icon:null==l?void 0:l.iconUrl,onRemove:()=>null==n?void 0:n(l.id),testID:a,onClick:()=>null==r?void 0:r(l.id),isInvalid:s})},d=e=>{var{libraries:t=[],readonly:n,onDeleteLibrary:i,onAddLibrary:d,onClickLibrary:u,renderLibrary:c,emptyText:v="",hideAddButton:p=!1,addButtonTestID:f="",libraryCardTestID:m=""}=e;return(0,o.jsxs)("div",{className:"relative",children:[n||p?(0,o.jsx)(o.Fragment,{}):(0,o.jsx)("div",{className:"absolute right-[0] top-[-32px]",children:(0,o.jsx)(l.hU,{color:"highlight",onClick:d,theme:"borderless",icon:(0,o.jsx)(r.PwN,{}),size:"small","data-testid":f})}),(0,o.jsx)("div",{className:"flex flex-col gap-[4px]",children:t.length>0?t.map(e=>{var t=null==e?void 0:e.isInvalid,r=()=>(0,o.jsx)(s,{isInvalid:t,readonly:n,library:e,onDelete:i,onClick:e=>{if(!t)null==u||u(e)},testID:m},e.id);return c?c({library:e,defaultLibraryRender:r}):r()}):(0,o.jsx)(a.tz,{text:v,isEmpty:!0})})]})}},301541:function(e,t,n){n.d(t,{o:function(){return h}});var o=n(151064),r=n(455069),l=n(962289),a=n(252237),i=n.n(a),s=n(686436),d=n(471583),u=n(664278),c=n(68331),v=n(450562),p=n(336205),f=n(164634),m=n(975197),h=e=>{var{value:t,onChange:n,readonly:a,testId:h}=e,[g,x]=(0,r.useState)({status:"default"}),_=(0,s.PF)(),{getNodeSetterId:y,concatTestId:w}=(0,v.FCD)(),j=y("loopOutputSelect"),b=(0,s.G2)(d.b),N=(0,l.Z)(t,"content.keyPath"),k=(null==N?void 0:N[0])===_.id,C=u.N.getValueExpressionViewType(t,b,{node:_}),S=C;!k&&C&&(S=v.owu.isArrayType(C)?void 0:v.owu.wrapToArrayType(C));var I=S?v.IuB[S]:void 0;return(0,c.S)({keyPath:N,onTypeChange:e=>{var{variableMeta:t}=e;if(!t||!k&&v.owu.isArrayType(null==t?void 0:t.type)){x({status:"error",message:p.o.t("card_builder_userVar_list_search_empty")}),n({type:v.YX3.REF});return}x({status:"success"})}}),(0,o.jsxs)("div",{className:m.Z["loop-output-select"],children:[(0,o.jsx)(f.N,{className:m.Z["variable-select"],value:t,hideSettingIcon:!0,hideDeleteIcon:!0,literalDisabled:!0,enableSelectNode:!0,renderDisplayVarName:e=>{var{meta:t,path:n}=e;return(null==n?void 0:n[0])===_.id?(null==t?void 0:t.name)||"":"[".concat(null==t?void 0:t.name,"] * n")},customFilterVar:e=>{var{meta:t,path:n}=e;if((null==n?void 0:n[0])===_.id)return 2!==n.length||!!(null==t?void 0:t.mutable);return!!(null==t?void 0:t.type)&&!v.owu.isArrayType(null==t?void 0:t.type)},handleDataSource:e=>e.filter(e=>{var t;return e.nodeId!==_.id||!!(null===(t=e.children)||void 0===t?void 0:t.length)}),readonly:a,onChange:e=>{if(void 0===e||e.type!==v.YX3.REF)return;var t,o,r=null!==(o=null==e?void 0:null===(t=e.content)||void 0===t?void 0:t.keyPath)&&void 0!==o?o:[];if(1!==r.length||r[0]!==_.id)null==n||n(e),x({status:"success"})},validateStatus:g.status,invalidContent:g.message,testId:h,forbidTypeCast:!0}),(0,o.jsx)("div",{className:i()(m.Z["variable-type"],{[m.Z["variable-type-bg"]]:!!I}),"data-testid":w(null!=h?h:j,"variable-type"),children:I?(0,o.jsx)("p",{className:m.Z["variable-type-content"],children:I}):(0,o.jsx)("p",{className:m.Z["variable-type-placeholder"],children:p.o.t("workflow_detail_node_nodata")})})]})}},98888:function(e,t,n){n.d(t,{r:function(){return u}});var o=n(151064),r=n(455069),l=n(686436),a=n(471583),i=n(450562),s=n(164634),d=n(107640),u=e=>{var t,n,u,c,{value:v,onChange:p,readonly:f,right:m,inputParameters:h,index:g,node:x,testId:_}=e,y=(0,l.G2)(a.b),w=null!==(u=null==v?void 0:null===(t=v.content)||void 0===t?void 0:t.keyPath)&&void 0!==u?u:[],j=y.getViewVariableByKeyPath(w,{node:x}),b=null!==(c=null==m?void 0:null===(n=m.content)||void 0===n?void 0:n.keyPath)&&void 0!==c?c:[],N=y.getViewVariableByKeyPath(b,{node:x}),k=(0,r.useMemo)(()=>Array.isArray(h)&&(null==h?void 0:h.length)?h.filter((e,t)=>t!==g).map(e=>{var t,n;return null==e?void 0:null===(n=e.left)||void 0===n?void 0:null===(t=n.content)||void 0===t?void 0:t.keyPath}).filter(Boolean).map(e=>e.join(".")):[],[h]);(0,r.useEffect)(()=>{if(!!j||!!N)null==p||p(v)},[m]);var C=(0,r.useCallback)(e=>{var t=y.getViewVariableByKeyPath(e,{node:x});return(null==N?!void 0:!N.type)||(null==t?!!void 0:!!t.type)&&t.type===N.type||!1},[y]);return(0,o.jsx)("div",{className:d.Z["mutable-variable-assign"],children:(0,o.jsx)(s.N,{className:d.Z["variable-select"],literalDisabled:!0,value:v,readonly:f,onChange:e=>{var t;if(void 0===e||e.type!==i.YX3.REF)return;if(!!y.getViewVariableByKeyPath(null===(t=e.content)||void 0===t?void 0:t.keyPath,{node:x}))null==p||p(e)},optionFilter:C,testId:_,forbidTypeCast:!0,hideDeleteIcon:!0,customFilterVar:e=>{var{meta:t,path:n}=e;if((null==n?void 0:n.length)!==2||(null==t?void 0:t.type)&&N&&t.type!==N.type||!(null==t?void 0:t.mutable))return!1;var o=n.join(".");return!k.includes(o)&&b.join(".")!==o&&!0}})})}},936382:function(e,t,n){n.d(t,{l:()=>O});var o=n("825955"),r=n("151064"),l=n("455069"),a=n("962289"),i=n("252237"),s=n.n(i),d=n("686436"),u=n("886829"),c=n("847167"),v=n("569502"),p=n("450562"),f=n("336205"),m=n("915757"),h=n("674343"),g=n("178385"),x=n("340291"),_=n("577060"),y=n("994983"),w=n("184449"),j=n("849293"),b=n("182733"),N=n("213635"),k=n("938943"),C=e=>{var t,{onHandle:n}=e,r=(0,d.km)(),a=(0,d.G2)(d.uf),i=(0,d.G2)(d.oJ),s=(0,d.G2)(d.iw),[u,c]=(0,l.useState)(a.canMoveOutContainer(r)),v=(0,l.useCallback)(()=>{c(a.canMoveOutContainer(r))},[r,a]);return{canMoveOut:u,handleMoveOut:(0,l.useCallback)((t=(0,o._)(function*(e){if(e.stopPropagation(),!!r.parent)a.moveOutContainer({node:r}),a.removeNodeLines(r),yield new Promise(e=>requestAnimationFrame(e)),yield(0,d.gw)(20),v(),i.clear(),i.selectNode(r),s.startDragSelectedNodes(e),n()}),function(e){return t.apply(this,arguments)}),[s,r,a,i,v,n]),updateCanMoveOut:v}},S=e=>{var{description:t}=e,n=(0,d.PF)();if(!t)return null;var o=n.getData(u.m).getNodeData();return(null==o?void 0:o.description)===t?null:(0,r.jsx)(h.ZT.Text,{className:"coz-fg-secondary pt-2",size:"small",ellipsis:{rows:1},children:t})},I=n("639618"),T=e=>{var{description:t,expanded:n,isLocalPlugin:o=!1,onChange:a,readonly:i=!1}=e,{concatTestId:d,getNodeTestId:u}=(0,p.FCD)(),{isNodeSideSheet:c}=(0,w.$v)(),[v,m]=(0,l.useState)(!1),g=(0,l.useRef)(null);if(!t)return null;var x=o?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.Vp,{color:"cyan",size:"mini",children:f.o.t("local_plugin_label")}),(0,r.jsx)(h.iz,{layout:"vertical",className:"coz-stroke-primary h-[10px] ml-[4px] mr-[2px]"})]}):null;return v?(0,r.jsx)("div",{className:s()("pb-[12px] w-full",I.Z["text-area-wrapper"]),children:(0,r.jsx)(h.Kx,{defaultValue:t,ref:g,rows:2,maxCount:100,readonly:i,onBlur:e=>{var t,n=null===(t=e.target)||void 0===t?void 0:t.value;n&&n.length<=100&&(null==a||a(n)),m(!1)}})}):(0,r.jsxs)("div",{className:"px-0 w-full flex items-center mb-[8px]",children:[x,(0,r.jsx)(h.ZT.Text,{size:"small","data-testid":d(u(),"node-description"),className:s()("break-words inline-block px-1 py-0.5 break-all","coz-fg-secondary hover:coz-mg-secondary-hovered active:coz-mg-secondary-pressed","rounded-lg",{"!hidden":!n,"cursor-pointer":c}),onClick:()=>{m(!0),setTimeout(()=>{var e;null===(e=g.current)||void 0===e||e.focus()},0)},ellipsis:{showTooltip:{opts:{content:t,style:{wordBreak:"break-word"}}},rows:2},children:t})]})},E=n("563026"),D=n("824833"),Z=e=>{var t,n,o,a,i,s,{node:d,readonly:c}=e,{workflowId:v,spaceId:f,isCollaboratorMode:m,info:h}=(0,w.j1)(),g=(0,l.useRef)(null),x=(0,l.useMemo)(()=>new p.m_1(d),[d]),{vcsData:_}=h;if((0,l.useEffect)(()=>{var e=d.onDispose(()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.handleParentNodeDelete()});return()=>e.dispose()},[]),(null==d?void 0:d.flowNodeType)!==p.nyy.Api||m&&!(null==_?void 0:_.can_edit)||!m&&!(null===(t=h.creator)||void 0===t?void 0:t.self))return null;var y=d.id,j=null!==(s=null===(o=x.data)||void 0===o?void 0:null===(n=o.inputs)||void 0===n?void 0:n.apiParam)&&void 0!==s?s:[],b=null===(i=d.getData(u.m))||void 0===i?void 0:null===(a=i.getNodeData())||void 0===a?void 0:a.outputs,N=p.ycG.toLiteral(j.find(e=>"pluginID"===e.name)),k=p.ycG.toLiteral(j.find(e=>"apiID"===e.name)),C=p.ycG.toLiteral(j.find(e=>"apiName"===e.name));return(0,r.jsx)(E.G6,{ref:g,readonly:c||null===b,style:{maxWidth:90},bindSubjectInfo:{componentID:y,componentType:D.re.CozeToolNode,parentComponentID:v,parentComponentType:D.re.CozeWorkflow,detail:{name:C}},bizCtx:{trafficScene:D.zE.CozeWorkflowDebug,trafficCallerID:v,bizSpaceID:f,ext:{mockSubjectInfo:JSON.stringify({componentType:D.re.CozeTool,componentID:k,parentComponentType:D.re.CozePlugin,parentComponentID:N})}}})},M=n("707107"),P=e=>{var{helpLink:t,nodeData:n,nodeType:o}=e;return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(h.hU,{onClick:()=>{(0,M.Gg)(M.Kg.workflow_test_run_click,{nodes_type:String(o),action:"click_doc"});var e="string"==typeof t?t:t({apiName:(0,a.Z)(n,"apiName")||""});window.open(e,"_blank")},icon:(0,r.jsx)(m.FRM,{}),size:"default",color:"secondary"})})},L=n("181907"),z=()=>{var e=(0,L.X)(),{isNodeSideSheet:t}=(0,w.$v)();return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(h.hU,{onClick:()=>{e.close()},icon:(0,r.jsx)(m.rmE,{}),size:t?"default":"small",color:"secondary"})})},O=e=>{var t,i,{title:E,description:D,readonly:M,readonlyAllowDeleteOperation:L,hideTest:O,onTitleChange:A,onDescriptionChange:F,extraOperation:R,showCloseButton:V=!1,className:B="",showTrigger:G,triggerIsOpen:W,nodeDisabled:U}=e,H=(0,l.useRef)(null),[J,q]=(0,l.useState)(E),[K,X]=(0,l.useState)(!1),Y=(0,d.G2)(y.Re),Q=(0,d.G2)(c.Pi),$=(0,d.km)(),[ee,et]=(0,l.useState)(!0),{canMoveOut:en,handleMoveOut:eo,updateCanMoveOut:er}=C({onHandle:()=>{et(!1),requestAnimationFrame(()=>{et(!0)})}}),el=(0,x.j0)(e=>e.closeNodeSideSheet),{expanded:ea}=(0,w.d1)(),{getNodeTestId:ei,concatTestId:es}=(0,p.FCD)(),ed=$.getNodeMeta(),{canMockset:eu}=(0,w.j1)(!1),{isNewNodeRender:ec,isNodeSideSheet:ev}=(0,w.$v)(),ep=!ec&&eu;(0,l.useEffect)(()=>{q(E)},[E]);var ef=e=>{e.stopPropagation(),setTimeout(()=>{Y.deleteNode($,!0),el()},10)},em=(0,d.KU)();var eh=(0,l.useCallback)((t=(0,o._)(function*(e,t){t.stopPropagation();var{WorkflowCopyShortcutsContribution:o,WorkflowPasteShortcutsContribution:r}=yield Promise.resolve().then(n.bind(n,786629)),l=em.get(o),a=em.get(r),i=yield l.toData([$]);a.apply(i)}),function(e,n){return t.apply(this,arguments)}),[em,$]),eg=(0,l.useCallback)(e=>{e.stopPropagation(),X(!0),setTimeout(()=>{var e;null===(e=H.current)||void 0===e||e.focus()},0)},[]),ex=(0,_.VI)("title"),e_=(0,l.useCallback)(e=>{e.target!==(null==H?void 0:H.current)&&!ex&&(X(!1),document.body.removeEventListener("click",e_))},[ex]);(0,l.useEffect)(()=>(K&&document.body.addEventListener("click",e_),()=>{document.body.removeEventListener("click",e_)}),[K,e_]);var ey=$.getData(u.m),ew=$.getNodeRegistry(),ej=ey.getNodeData(),eb=e=>{q(e),ey.updateNodeData({title:e})},eN=(!M||M&&L||!!R)&&ee,ek=$.flowNodeType===v.ny.Api&&(0,a.Z)(ej,"pluginType")===g.zV.LOCAL;return(0,r.jsxs)("div",{className:s()("node-header","coz-bg-plus !p-0",I.Z.container,{"!mb-0":!ea,[B]:!!B,"!cursor-default mx-[-12px]":ev,"cursor-move":!ev,"rounded-[7px] overflow-hidden":ec}),children:[(0,r.jsxs)("div",{className:s()("node-header-title","w-full",{"!cursor-default":ev}),children:[U&&ev?(0,r.jsxs)("div",{className:"flex items-center p-8px",style:{background:" var(--coz-mg-hglt-yellow, rgba(255, 188, 133, 0.2))"},children:[(0,r.jsx)(m.wR2,{style:{flexShrink:0,fontSize:"24px",color:"var(--coz-fg-hglt-yellow, rgba(255, 129, 26, 1))"}}),(0,r.jsx)("span",{className:"ml-8px",style:{fontSize:"14px",lineHeight:"20px",color:"var(--coz-fg-primary, rgba(15, 21, 41, 0.82))"},children:f.o.t("variable_node_offline_toast")})]}):null,(0,r.jsxs)("div",{className:s()("flex items-center w-full py-3 px-3 pb-[8px] pr-[10px]",{"cursor-move":!ev}),style:{background:(null==ej?void 0:ej.mainColor)?"linear-gradient(".concat((0,k.W)(ej.mainColor,.08)," 0%, var(--coz-bg-plus) 100%)"):"var(--coz-bg-plus)"},children:[(0,r.jsx)(N.q,{className:I.Z.logo,nodeId:$.id,size:24,alt:"logo"}),(0,r.jsx)(_.Ce,{path:"title",className:I.Z["input-wrapper"],children:e=>{var{showError:t,onBlur:n,onChange:o}=e,l=M||!K;return l?(0,r.jsxs)("div",{className:I.Z["input-readonly"],onDoubleClick:eg,"data-testid":es(ei(),"input","rename","readonly"),children:[(0,r.jsxs)(h.ZT.Paragraph,{ellipsis:{rows:1,showTooltip:{type:"tooltip",opts:{style:{width:"100%",wordBreak:"break-word"}}}},children:[J,G?(0,r.jsx)("span",{className:"h-full inline-flex flex-row items-center",children:(0,r.jsx)(h.Vp,{size:"mini",className:"ml-[4px]",prefixIcon:(0,r.jsx)(m.VGH,{}),color:W?"brand":"primary",children:f.o.t("workflow_start_trigger_triggername",{},"触发器")})}):void 0]}),(0,r.jsx)(b.Sf,{node:$}),(0,r.jsx)(b.To,{node:$})]}):(0,r.jsx)(h.II,{onBlur:()=>{A(J),n()},ref:H,readonly:l,value:J,onChange:e=>{eb(e),o()},className:"".concat(I.Z.input," ").concat(t?I.Z.inputError:""),placeholder:f.o.t("workflow_detail_node_name_default"),"data-testid":es(ei(),"input","rename")})}}),(0,r.jsxs)("div",{className:I.Z.operators,children:[ep?(0,r.jsx)(Z,{node:$,readonly:M}):null,O?null:(0,r.jsx)("div",{children:(0,r.jsx)(j.o,{})}),(null==ew?void 0:null===(i=ew.meta)||void 0===i?void 0:i.helpLink)&&ev?(0,r.jsx)(P,{nodeData:ej,nodeType:ew.type,helpLink:ew.meta.helpLink}):null,eN?(0,r.jsx)(h.Lt,{trigger:"hover",position:"bottomRight",onVisibleChange:er,render:(0,r.jsxs)(h.Lt.Menu,{className:I.Z["dropdown-menus"],children:[!M&&en?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.Lt.Item,{onClick:(e,t)=>eo(t),"data-testid":es(ei(),"opr","move_out_container"),children:f.o.t("workflow_subcanvas_remove")}),(0,r.jsx)(h.iz,{})]}):null,M?null:(0,r.jsx)(h.Lt.Item,{onClick:(e,t)=>eg(t),"data-testid":es(ei(),"opr","rename"),children:f.o.t("workflow_detail_node_rename")}),M?null:(0,r.jsx)(h.Lt.Item,{onClick:eh,"data-testid":es(ei(),"opr","copy"),children:f.o.t("workflow_detail_title_copy")}),!ed.deleteDisable&&(!M||M&&L)?(0,r.jsx)(h.Lt.Item,{onClick:(e,t)=>ef(t),"data-testid":es(ei(),"opr","delete"),children:f.o.t("workflow_detail_node_delete")}):null,Q.canDecapsulate($)&&(0,r.jsx)(h.Lt.Item,{onClick:(e,t)=>{t.stopPropagation(),Q.decapsulate($)},"data-testid":es(ei(),"opr","decapsulate"),children:(0,r.jsxs)("div",{className:"cursor-pointer flex items-center w-full justify-between absolute inset-0 px-2",children:[(0,r.jsx)("div",{children:f.o.t("workflow_encapsulate_decapsulate",void 0,"解散工作流")}),(0,r.jsx)("div",{className:"coz-fg-secondary text-xs",children:c.mO.decapsulate})]})}),R?(0,r.jsx)(h.Lt.Item,{className:"extra-operation-item","data-testid":es(ei(),"opr","extra-operation"),children:R}):null]}),children:(0,r.jsx)(h.hU,{color:"secondary",size:ev?"default":"small",icon:(0,r.jsx)(m.NsR,{}),onClick:e=>e.stopPropagation()})}):void 0,V?(0,r.jsx)(z,{}):null]})]})]}),(0,r.jsx)("div",{className:s()("node-header-description px-2 w-full",{"!cursor-default":ev,"pb-2":ec,"!mb-0":!ea}),children:ec?(0,r.jsx)(S,{description:D}):(0,r.jsx)(T,{description:D,expanded:ea,isLocalPlugin:ek,onChange:F,readonly:M||U})})]})}},938943:function(e,t,n){n.d(t,{W:function(){return o}});var o=(e,t)=>{var[n,o,r]=function(e){if(e=e.replace("#",""),!/^[0-9A-Fa-f]{3}$|^[0-9A-Fa-f]{6}$|^[0-9A-Fa-f]{8}$/.test(e))throw Error("Invalid hex color format");var t,n,o,r=1;return 3===e.length?(t=parseInt(e[0]+e[0],16),n=parseInt(e[1]+e[1],16),o=parseInt(e[2]+e[2],16)):6===e.length?(t=parseInt(e.substring(0,2),16),n=parseInt(e.substring(2,4),16),o=parseInt(e.substring(4,6),16)):(t=parseInt(e.substring(0,2),16),n=parseInt(e.substring(2,4),16),o=parseInt(e.substring(4,6),16),r=(parseInt(e.substring(6,8),16)/255).toFixed(2)),[t,n,o,r]}(e||"#5C62FF");return function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:255,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:255,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:255;e=Math.min(255,Math.max(0,Math.round(e))),t=Math.min(255,Math.max(0,Math.round(t))),n=Math.min(255,Math.max(0,Math.round(n)));var i=Math.round(e*(o=Math.min(1,Math.max(0,o)))+r*(1-o)),s=Math.round(t*o+l*(1-o)),d=Math.round(n*o+a*(1-o)),u=e=>{var t=e.toString(16);return 1===t.length?"0".concat(t):t};return"#".concat(u(i)).concat(u(s)).concat(u(d))}(n,o,r,t)}},375525:function(e,t,n){n.d(t,{e:function(){return s}});var o=n(151064);n(455069);var r=n(252237),l=n.n(r),a=n(674343),i=n(584746),s=e=>{var t,{options:n}=e,{outputInfo:r,customClassNames:s}=null!=n?n:{};return(0,o.jsx)("div",{className:l()("flex flex-col gap-[8px]",s),children:null==r?void 0:null===(t=r.map)||void 0===t?void 0:t.call(r,e=>{var{label:t,type:n,required:r,style:s}=e;return(0,o.jsxs)("div",{className:"flex items-center",style:s,children:[(0,o.jsx)("div",{className:i.Z.label,children:t}),r?(0,o.jsx)("span",{className:i.Z.required,children:"*"}):null,n?(0,o.jsx)(a.Vp,{className:l()(i.Z.tag,"!px-[3px] !py-[1px]"),color:"primary",children:n}):null]})})})}},854586:function(e,t,n){n.d(t,{Yt:function(){return l},ac:function(){return i},b_:function(){return a}});var o,r=n(450562),l=[r.owu.Object,r.owu.ArrayObject];var a=((o={})[o.Update=0]="Update",o[o.Delete=1]="Delete",o[o.Append=2]="Append",o[o.DeleteChildren=3]="DeleteChildren",o),i=20},873538:function(e,t,n){n.d(t,{G:()=>e1});var o=n("808549"),r=n("120454"),l=n("151064"),a=n("455069"),i=n("801815"),s=n("335740"),d=n("252237"),u=n.n(d),c=n("444479"),v=n("244829"),p=n("450562"),f=n("336205"),m=n("674343"),h=n("706489"),g=n("57224"),x=n("854586");function _(e,t){var n=!1,o=[];return!function e(t,r,l){var{parentData:a,level:s}=l;(t||[]).forEach((l,d)=>{var u,c,v="".concat(r,"[").concat(d,"]");n=n||x.Yt.includes(l.type),l.key=null!==(c=null!==(u=l.key)&&void 0!==u?u:l.fieldRandomKey)&&void 0!==c?c:(0,i.x0)(),l.field=v,l.isFirst=0===d,l.isLast=d===t.length-1,l.isSingle=l.isFirst&&l.isLast,l.level=s,l.helpLineShow=a&&s>=2?(a.helpLineShow||[]).concat(!a.isLast):[],l.children&&l.children.length>0&&(o.push(l.key),e(l.children,"".concat(v,".children"),{parentData:l,level:s+1}))})}(e||[],t,{level:0}),{data:e,hasObjectLike:n,itemKeysWithChildren:o}}var y=e=>{var t=window.innerWidth,n=.66*t;return t<1e3?n:e&&t-n<e?t-e:n<850?850:n},w=(0,a.createContext)({}),j=()=>(0,a.useContext)(w),b=w.Provider,N=n("825955"),k=n("44172"),C=(0,a.lazy)((0,N._)(function*(){var{MdBoxLazy:e}=yield n.e("8779").then(n.bind(n,985808));return{default:e}})),S=e=>{var{readonly:t,value:n,outputValue:s,onlyString:d,onChange:u,onResponseFormatChange:c,isBatch:h,testId:g}=e,{concatTestId:x}=(0,p.FCD)();return(0,l.jsx)(m.Ph,{className:"overflow-hidden",size:"small",disabled:t,value:n,"data-testid":g,onChange:e=>{if(d){var t,n,o,r,l=[{key:(0,i.x0)(),name:"output",type:p.owu.String}];h?(l=v.I.singleOutputMetasToList(l),(null==s?void 0:s[0])&&(l=[s[0]]),(null==s?void 0:null===(t=s[0].children)||void 0===t?void 0:t[0])&&(l[0].children=[null==s?void 0:null===(r=s[0].children)||void 0===r?void 0:r[0]]),(null==l?void 0:null===(n=l[0].children)||void 0===n?void 0:n[0].type)&&(null==l?void 0:null===(o=l[0].children)||void 0===o?void 0:o[0].type)!==p.owu.String&&(l[0].children[0].type=p.owu.String)):((null==s?void 0:s[0])&&(l=[s[0]]),l[0].type!==p.owu.String&&(l[0].type=p.owu.String)),null==u||u(l)}null==c||c(e)},prefix:(0,l.jsxs)("span",{className:"coz-fg-secondary text-base flex items-center ml-1 -mr-1.5",children:[(0,l.jsx)(m.u,{content:(0,l.jsx)(a.Suspense,{fallback:null,children:(0,l.jsx)(C,{markDown:f.o.t("model_config_response_format_explain")})}),children:(0,l.jsx)(k.aUG,{className:"cursor-pointer coz-fg-dim pl-[2px] pr-[4px]"})}),f.o.t("devops_publish_multibranch_ModelInfo.ResponseFormat")]}),children:[{label:f.o.t("devops_publish_multibranch_ModelInfo.ModelResponseFormat.Text"),value:p.B5l.Text},{label:f.o.t("devops_publish_multibranch_ModelInfo.ModelResponseFormat.Markdown"),value:p.B5l.Markdown},{label:f.o.t("devops_publish_multibranch_ModelInfo.ModelResponseFormat.JSON"),value:p.B5l.JSON}].map(e=>(0,l.jsx)(m.Ph.Option,(0,r._)((0,o._)({},e),{"data-testid":x(g,"".concat(e.value))})))})},I=n("915757"),T=n("686436"),E=n("340291"),D=n("266106"),Z=n("717497"),M=n("547014"),P=n("942071"),L="file:///json-import/data.json";Z.AV.languageService.configureSchemas({uri:"file:///import-schema.json",fileMatch:[L],schema:{type:"object",properties:{}}});var z=e=>{var t,{id:o,value:r,setValue:i,onClose:s,onChange:d}=e,[u,c]=(0,a.useState)(),v=(0,a.useRef)(null),p=(0,a.useCallback)((0,N._)(function*(){if(!!u)return new Promise(e=>{m.u_.warning({icon:(0,l.jsx)(k.O5N,{className:P.Z.warningIcon,style:{width:22,height:22}}),title:f.o.t("workflow_json_node_update_tips_title"),content:f.o.t("workflow_json_node_update_tips_content"),okType:"warning",okText:f.o.t("Confirm"),cancelText:f.o.t("Cancel"),onOk:(0,N._)(function*(){d((yield h(r))||[]),e(!0)}),onCancel:()=>e(!1)})})}),[u]);var h=(t=(0,N._)(function*(e){var{convertSchema:t}=yield Promise.resolve().then(n.bind(n,362416));if(!!e)try{var o=JSON.parse(e),r=t(o);if(!r||!Array.isArray(r)||0===r.length)return;return r}catch(e){return}}),function(e){return t.apply(this,arguments)});return(0,a.useEffect)(()=>{var e;(e=(0,N._)(function*(){c((yield h(r)))}),function(){return e.apply(this,arguments)})()},[r]),(0,l.jsxs)("div",{className:P.Z.container,children:[(0,l.jsxs)("div",{className:P.Z.header,children:[(0,l.jsxs)("span",{className:P.Z.leftSide,children:[(0,l.jsx)("span",{className:P.Z.title,children:(0,l.jsx)("p",{children:f.o.t("workflow_json_windows_title")})}),(0,l.jsx)("span",{children:(0,l.jsx)(m.u,{className:P.Z.tip,position:"bottom",getPopupContainer:()=>v.current,content:f.o.t("workflow_json_windows_title_tips"),children:(0,l.jsx)(k.aUG,{className:P.Z.info})})})]}),(0,l.jsxs)("span",{className:P.Z.rightSide,children:[(0,l.jsx)("span",{style:{display:u?"flex":"none"},children:(0,l.jsx)(m.hU,{icon:(0,l.jsx)(k.FQ,{}),size:"small",color:"primary",onClick:()=>p(),children:f.o.t("workflow_json_button_node_update")})}),(0,l.jsx)("span",{children:(0,l.jsx)(m.zx,{icon:(0,l.jsx)(D.Z,{}),size:"small",color:"secondary","aria-label":"close",onClick:()=>s()})})]}),(0,l.jsx)("span",{className:P.Z.tooltipPopContainer,ref:v})]}),(0,l.jsx)("div",{className:P.Z.content,children:(0,l.jsx)(M.KU,{children:(0,l.jsx)(M.pq,{domProps:{style:{width:"100%",height:"100%"}},defaultValue:r,options:{uri:L,languageId:"json",minHeight:"100%",maxHeight:"100%",theme:"coze-dark",fontSize:12,borderRadius:"6px"},onChange:e=>{i(e.value||"")}},o)})})]},o)},O=n("1334"),A=n("680634"),F=n("864431"),R=e=>e.getParents().filter(e=>"object"==typeof e.value&&void 0!==e.value.name&&void 0!==e.value.type).map(e=>e.value.name).join("/"),V=e=>{var{newData:t,oldData:n,withRequired:o}=e,r=new Map;return(0,p.fwJ)(n,e=>{if("object"==typeof e.node.value&&void 0!==e.node.value.key&&void 0!==e.node.value.type){var t=R(e);r.set(t,e.node.value.key)}}),o?(0,p.fwJ)(t,e=>{if("object"==typeof e.node.value&&void 0!==e.node.value.type){var t=R(e),n=r.get(t)||(0,i.x0)();e.node.value.key=n,e.node.value.required=!0}}):t},B=e=>"object"==typeof e.node.value&&void 0!==e.node.value.type&&!0,G=e=>t=>{if(!!B(t))t.node.value.name.length>e&&(t.node.value.name=t.node.value.name.slice(0,e))},W=e=>t=>{if(!!B(t)&&t.node.value.level===e&&!![p.owu.Object,p.owu.ArrayObject].includes(t.node.value.type))t.deleteSelf()},U=e=>t=>{var{disabledTypes:n,isBatch:o}=e;if(!!B(t)&&!!n.includes(t.node.value.type)&&(!o||0!==t.node.value.level))t.deleteSelf()},H=e=>{var{data:t,isBatch:n,disabledTypes:o,allowDepth:r,allowNameLength:l}=e,a=U({disabledTypes:o,isBatch:n});return(0,p.fwJ)(t,[G(l),W(r),a])},J=e=>{var{data:t,isBatch:n}=e;return n?[{name:"outputList",type:p.owu.ArrayObject,children:t}]:t},q=e=>{var{treeData:t,data:n,isBatch:l}=e;if(l){var a=null==t?void 0:null===(i=t[0].children)||void 0===i?void 0:i.filter(e=>e.readonly);if(null==a?void 0:a.length){var i,s,[d,...u]=n;return[(0,r._)((0,o._)({},d),{children:[...null!==(s=d.children)&&void 0!==s?s:[],...a]}),...u]}}else{var c=null==t?void 0:t.filter(e=>e.readonly);if(null==c?void 0:c.length)return[...n,...c]}return n},K=e=>{var{updateKey:t,uniqueId:n,onClose:o,onChange:r}=e,[i,s]=(0,a.useState)("");return(0,l.jsx)(z,{id:n,value:i,setValue:e=>{s(e)},onClose:o,onChange:r},t)},X=n("790181"),Y=e=>{var t,n,{startField:o,treeData:r,rules:i,disabledTooltip:s,disabledTypes:d,testId:c,hideAddButton:v}=e,{disabled:p,withRequired:h,isBatch:g,onlyString:x,jsonImport:w,readonly:j,topLevelReadonly:b}=i,N=(0,T.PF)(),k="".concat(N.id,".json_import"),[C,S]=(0,a.useState)(""),[D,Z]=(0,a.useState)(0),{forceCloseBizIDE:M,isBizIDEOpen:P,uniqueId:L}=(0,A.V)(),{setFullscreenPanel:R}=(0,E.Tk)(),B=t=>{var n=_(V({newData:J({data:t,isBatch:g}),oldData:r,withRequired:h}),o).data,l=H({data:n,isBatch:g,disabledTypes:d,allowDepth:g?4:3,allowNameLength:20}),a=q({isBatch:g,treeData:r,data:l});return e.onChange(a)};return((0,O.TF)({enable:P&&k===L,nodeId:N.id}),(0,a.useEffect)(()=>()=>{M()},[]),(0,a.useEffect)(()=>{Z(D+1)},[g]),(0,a.useEffect)(()=>{x&&M()},[x]),!w||j||b||x)?(0,l.jsx)(l.Fragment,{}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:X.Z.buttonContainer,style:{right:v?16:44},"data-testid":c,children:(0,l.jsx)(m.u,{content:p?s:f.o.t("workflow_json_import"),children:(0,l.jsx)(m.hU,{className:u()("!block",{[X.Z.importButton]:!0,[X.Z.importButtonDisabled]:p}),size:"small",disabled:p,icon:(0,l.jsx)(I.nBN,{className:X.Z.buttonIcon}),onClick:()=>{R((0,l.jsx)(K,{updateKey:D,uniqueId:k,onClose:()=>{R(null)},onChange:B}))}})})}),(0,l.jsx)(F.iP,{sideSheetId:k,sideSheetProps:{className:X.Z.sideSheet,width:y(null==N?void 0:null===(n=N.getNodeMeta())||void 0===n?void 0:null===(t=n.size)||void 0===t?void 0:t.width),style:{position:"relative",overflow:"auto"},bodyStyle:{padding:0},headerStyle:{display:"none"},motion:!1},mutexWithLeftSideSheet:!0,closeConfirm:()=>(M(),!0),children:(0,l.jsx)(z,{id:k,value:C,setValue:e=>{S(e)},onClose:()=>{M()},onChange:B},D)})]})},Q=e=>{var{enable:t,hideAddButton:n}=e;return(0,l.jsx)("div",{style:{width:n?32:60}})};function $(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"3:2",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,[n,o]=e.split(":").map(Number);return{name:{flex:"".concat(n," ").concat(n," 0")},type:{flex:"".concat(o," ").concat(o," ").concat(15*t*o/n,"px"),minWidth:"80px",maxWidth:"135px"}}}var ee=n("845970");function et(e){var{readonly:t,config:n,columnsRatio:o}=e,r=$(o);return t?null:(0,l.jsxs)("div",{className:ee.Z.header,style:{marginLeft:n.hasCollapse?18:0},children:[(0,l.jsx)("div",{className:ee.Z.name,style:r.name,children:(0,l.jsx)("span",{className:ee.Z.text,children:f.o.t("workflow_detail_end_output_name")})}),(0,l.jsx)("div",{className:ee.Z.type,style:r.type,children:(0,l.jsx)("span",{className:ee.Z.text,children:f.o.t("workflow_detail_start_variable_type")})}),(0,l.jsxs)("div",{className:"relative flex gap-1",children:[n.hasRequired?(0,l.jsx)("div",{className:ee.Z.required,children:(0,l.jsx)("span",{className:ee.Z.text,children:f.o.t("wf_20241206_001")})}):null,n.hasDescription?(0,l.jsx)("div",{className:ee.Z.description,style:{width:24},children:(0,l.jsx)("div",{className:ee.Z.descriptionTitle,children:(0,l.jsx)("span",{className:ee.Z.text})})}):null,n.hasObjectLike?(0,l.jsx)("div",{className:"w-6"}):null,n.hasRequired?(0,l.jsx)("div",{className:"w-6"}):null,(0,l.jsx)("div",{className:"w-6"})]})]})}var en=n("550655"),eo=n("537845"),er=n("755887"),el=n("740573"),ea=n("859725"),ei=n("667141"),es=n("569502"),ed={[es.ow.String]:(0,l.jsx)(I.ls7,{}),[es.ow.Integer]:(0,l.jsx)(I.jLw,{}),[es.ow.Boolean]:(0,l.jsx)(I.WbN,{}),[es.ow.Number]:(0,l.jsx)(I.j$I,{}),[es.ow.Object]:(0,l.jsx)(I.nCh,{}),[es.ow.Image]:(0,l.jsx)(I.Q2$,{}),[es.ow.File]:(0,l.jsx)(I.Nxk,{}),[es.ow.Doc]:(0,l.jsx)(I.Nxk,{}),[es.ow.Code]:(0,l.jsx)(I.Nxk,{}),[es.ow.Ppt]:(0,l.jsx)(I.Nxk,{}),[es.ow.Txt]:(0,l.jsx)(I.Nxk,{}),[es.ow.Excel]:(0,l.jsx)(I.Nxk,{}),[es.ow.Audio]:(0,l.jsx)(I.Nxk,{}),[es.ow.Zip]:(0,l.jsx)(I.Nxk,{}),[es.ow.Video]:(0,l.jsx)(I.Nxk,{}),[es.ow.Svg]:(0,l.jsx)(I.Q2$,{}),[es.ow.Voice]:(0,l.jsx)(I.e17,{}),[es.ow.Time]:(0,l.jsx)(I.kSS,{}),[es.ow.ArrayString]:(0,l.jsx)(I.mcR,{}),[es.ow.ArrayInteger]:(0,l.jsx)(I.TeG,{}),[es.ow.ArrayBoolean]:(0,l.jsx)(I.m5O,{}),[es.ow.ArrayNumber]:(0,l.jsx)(I.VNw,{}),[es.ow.ArrayObject]:(0,l.jsx)(I.yRc,{}),[es.ow.ArrayImage]:(0,l.jsx)(I.quZ,{}),[es.ow.ArrayFile]:(0,l.jsx)(I.ew7,{}),[es.ow.ArrayDoc]:(0,l.jsx)(I.ew7,{}),[es.ow.ArrayCode]:(0,l.jsx)(I.ew7,{}),[es.ow.ArrayPpt]:(0,l.jsx)(I.ew7,{}),[es.ow.ArrayTxt]:(0,l.jsx)(I.ew7,{}),[es.ow.ArrayExcel]:(0,l.jsx)(I.ew7,{}),[es.ow.ArrayAudio]:(0,l.jsx)(I.ew7,{}),[es.ow.ArrayZip]:(0,l.jsx)(I.ew7,{}),[es.ow.ArrayVideo]:(0,l.jsx)(I.ew7,{}),[es.ow.ArraySvg]:(0,l.jsx)(I.quZ,{}),[es.ow.ArrayVoice]:(0,l.jsx)(I.ew7,{}),[es.ow.ArrayTime]:(0,l.jsx)(I.rYO,{})},eu=n("190711"),ec=[],ev=p.vHX;function ep(e){var t,{data:n,onSelectChange:o,level:r,disabled:i,disabledTypes:s=ec,hiddenTypes:d=ev,style:c}=e,{testId:v}=j(),{concatTestId:f}=(0,p.FCD)(),[h,g]=(0,a.useState)(!1);return(0,l.jsx)(ei.C,{path:"".concat(null===(t=n.field)||void 0===t?void 0:t.slice(n.field.indexOf("[")),".type"),className:eu.Z.container,style:c,errorCompClassName:"output-param-name-error-type",children:e=>i?(0,l.jsx)("div",{className:"flex items-center w-full h-6",children:(0,l.jsx)("div",{className:"coz-fg-secondary font-medium text-xs truncate  coz-mg-plus px-1 py-0.5 rounded-[5px]",children:p.IuB[n.type]||""})}):(0,l.jsx)(ea.j,{value:n.type,level:r,disabled:i,disabledTypes:s,hiddenTypes:d,onChange:t=>{var n=t;Array.isArray(t)&&(n=t[t.length-1]),null==o||o(n),e.onChange()},onBlur:()=>{g(!1),e.onBlur()},onFocus:()=>g(!0),validateStatus:e.showError?"error":"default",children:(0,l.jsx)("div",{className:u()("w-full",{"bg-transparent":!i,"bg-[--semi-color-disabled-fill]":i}),children:(0,l.jsx)(m.u,{style:{pointerEvents:"none"},content:p.IuB[n.type],children:(0,l.jsxs)("div",{"data-testid":f(null!=v?v:"",n.field,"param-type-select"),className:u()("flex items-center justify-between gap-0.5 pl-[3px] pr-[3px] rounded-[6px] ".concat(i?"cursor-not-allowed":"cursor-pointer"),"border border-solid bg-transparent",{"semi-input-wrapper-error":e.showError,"coz-stroke-plus":!e.showError&&!i,"!bg-transparent":h,"!coz-stroke-hglt":h&&!e.showError,"border-stroke":i},"hover:coz-mg-primary-hovered","semi-input-wrapper semi-input-wrapper-small"),children:[(0,l.jsxs)("div",{className:"coz-fg-primary truncate text-xs gap-1 items-center flex",children:[(0,l.jsx)("div",{className:"h-[12px] flex-grow coz-fg-secondary text-[16px] flex items-center",children:ed[n.type]}),(0,l.jsx)("div",{className:"truncate",children:p.IuB[n.type]})]}),(0,l.jsx)(I.Wdl,{className:"coz-fg-secondary min-w-[16px] text-[16px]"})]})})})})})}var ef=n("14519");function em(e){var{data:t,disabled:n,onChange:o}=e,{concatTestId:r}=(0,p.FCD)(),{testId:a}=j();return(0,l.jsx)("div",{className:ef.Z.container,children:(0,l.jsx)("div",{className:ef.Z.switch,children:(0,l.jsx)(m.XZ,{"data-testid":r(null!=a?a:"",t.field,"required"),disabled:n,checked:t.required,onChange:e=>o(e.target.checked||!1)})})})}var eh=n("882617"),eg=n("791290");function ex(e){var{data:t,level:n,onDelete:o,onAppend:r,disableDelete:a,hasObjectLike:i,disabled:s,needRenderAppendChild:d=!0}=e,{isPreset:c}=t,{testId:v}=j(),{concatTestId:h}=(0,p.FCD)(),g=x.Yt.includes(t.type)&&!(n>=3);return(0,l.jsxs)("div",{className:u()(eg.Z.container,"gap-1"),children:[i?(0,l.jsx)("div",{className:eg.Z.add,children:(0,l.jsx)(m.u,{content:f.o.t("workflow_detail_node_output_add_subitem"),children:(0,l.jsx)("div",{children:g&&d?(0,l.jsx)(eh.Z,{"data-testid":h(null!=v?v:"",t.field,"add-sub-param"),size:"small",color:"secondary",className:"cursor-pointer",onClick:r,subitem:!0}):null})})}):null,c&&!s?(0,l.jsx)("div",{className:"w-6"}):(0,l.jsx)(m.hU,{className:"!block",size:"small",color:"secondary",disabled:a,"data-testid":h(null!=v?v:"",t.field,"remove-param"),onClick:()=>{if(!a)o()},icon:(0,l.jsx)(I.ozt,{className:"text-sm"})})]})}var e_=n("287797"),ey=n("649373");function ew(e){var t,{data:n,disabled:o,onChange:r,style:i}=e,{testId:s}=j(),{concatTestId:d}=(0,p.FCD)(),[u,c]=(0,a.useState)(!1);return(0,l.jsx)(ei.C,{path:"".concat(null===(t=n.field)||void 0===t?void 0:t.slice(n.field.indexOf("[")),".name"),className:ey.Z.container,style:i,errorCompClassName:"output-param-name-error-text",children:e=>o?(0,l.jsx)("div",{className:"w-full flex items-center h-6",children:(0,l.jsx)("div",{className:"coz-fg-primary font-medium text-xs truncate ",children:n.name})}):(0,l.jsx)(e_.Z,{className:ey.Z.name,value:n.name,disabled:o,handleBlur:t=>{r(t),setTimeout(()=>{e.onBlur()},33),c(!1)},handleFocus:()=>{c(!0)},handleChange:t=>{e.onChange()},inputProps:{placeholder:f.o.t("workflow_detail_end_output_entername"),disabled:o,maxLength:!o&&u?x.ac:void 0,"data-testid":d(null!=s?s:"",n.field,"param-name"),size:"small"},validateStatus:e.showError?"error":"default"})})}var ej=n("473980"),eb=n("206616"),eN=n("229342"),ek=n("880954"),eC=n("674145"),eS=n("614904"),eI=e=>{var{value:t,onChange:n,disabled:o,onBlur:r}=e,i=(0,a.useCallback)(e=>{null==n||n(e),null==r||r()},[r,n]);return(0,l.jsx)(eS.tk,{value:t,onChange:i,disabled:o})},eT=n("693963"),eE=n("561229"),eD=e=>"voice"===e.fileType?(0,l.jsx)(eI,(0,o._)({},e)):(null==e?void 0:e.enableInputURL)?(0,l.jsx)(eT.J,(0,o._)({},e)):(0,l.jsx)(eE.P,(0,o._)({},e)),eZ=n("311807"),eM=n("567282"),eP=n("293332"),eL=n("531918"),ez=e=>e?(0,l.jsx)(m.Ph.Option,{value:e.value,showTick:!0,className:eL.Z["bot-option"],children:(0,l.jsx)("div",{className:"flex",style:{width:"100%"},children:(0,l.jsx)("div",{className:"flex",style:{flexGrow:1,flexShrink:1,width:0},children:(0,l.jsx)(m.ZT.Text,{ellipsis:{showTooltip:!0},style:{fontSize:12,color:"#1D1C23",fontWeight:400},children:e.label})})})},e.value):null,eO=e=>{var t,{enableTypes:n=["static","dynamic"],onChange:i}=e,s=(0,ej._)(e,["enableTypes","onChange"]),d=(0,eN.j)(),[u,c]=(0,a.useState)(!1),[v,h]=(0,a.useState)(""),[g,x]=(0,a.useState)([]),[_,y]=(0,a.useState)([]),{projectId:w="",spaceId:j,projectCommitVersion:b}=d,k=(0,a.useMemo)(()=>{var e=(null==g?void 0:g.length)+(null==_?void 0:_.length);return e<7?32*e:208},[g,_]);(0,a.useEffect)(()=>{s.disabled||C()},[w,s.disabled]);var C=(t=(0,N._)(function*(e){var t,o;if(c(!0),n.includes("static")){;x((null===(t=(yield p.OHc.ListProjectConversationDef({space_id:j,project_id:w,project_version:b,create_method:eM.nS.ManualCreate,create_env:eM.Af.Draft,nameLike:null!=e?e:v,limit:1e3})).data)||void 0===t?void 0:t.map(e=>({value:e.conversation_name||"",label:e.conversation_name||"",conversationId:e.conversation_id||""})))||[])}if(n.includes("dynamic")){;y((null===(o=(yield p.OHc.ListProjectConversationDef({space_id:d.spaceId||"",project_id:w,project_version:b,create_method:eM.nS.NodeCreate,create_env:eM.Af.Draft,nameLike:null!=e?e:v,limit:1e3})).data)||void 0===o?void 0:o.map(e=>({value:e.conversation_name||"",label:e.conversation_name||"",conversationId:e.conversation_id||""})))||[])}c(!1)}),function(e){return t.apply(this,arguments)});return(0,l.jsxs)(m.Ph,(0,r._)((0,o._)({dropdownClassName:eL.Z.dropdown,filter:!0,remote:!0,placeholder:f.o.t("wf_chatflow_114"),emptyContent:f.o.t("wf_chatflow_115"),onSearch:(0,eZ.Z)(e=>{h(e),C(e)},500),prefix:(0,l.jsx)(eP.Z,{}),loading:u,style:{width:"100%"},virtualize:{height:k,width:"100%",itemSize:32},onChange:e=>{var t=[...g,..._].find(t=>t.value===e);null==i||i(null==t?void 0:t.value)}},s),{children:[(0,l.jsx)(m.Ph.OptGroup,{label:f.o.t("wf_chatflow_103"),children:g.map(e=>ez(e))},Number(new Date)),(0,l.jsx)(m.Ph.OptGroup,{label:f.o.t("wf_chatflow_43"),children:_.map(e=>ez(e))},Number(new Date))]}))};function eA(e){var{defaultValue:t,className:n,disabled:o,onBlur:r}=e;return t="string"==typeof t&&/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(t)?t:"",(0,l.jsx)(m.Mt,{className:"".concat(n," rounded-[8px]"),inputStyle:{width:"100%"},type:"dateTime",size:"small",defaultValue:t,disabled:o,format:"yyyy-MM-dd HH:mm:ss",onChange:(e,t)=>{("string"==typeof t||void 0===t)&&(null==r||r(t))},onClear:()=>{null==r||r("")},showClear:!0})}var eF=n("266246"),eR=e=>{var{data:t,onChange:n,defaultValue:r,onBlur:a}=e,i=(0,ej._)(e,["data","onChange","defaultValue","onBlur"]);return(0,l.jsx)(m.II,(0,o._)({defaultValue:r,onChange:n,size:"small",placeholder:f.o.t("wf_chatflow_99"),onBlur:e=>{null==a||a(e.target.value)}},i))},eV=e=>{var{data:t,onChange:n,onBlur:r,defaultValue:a}=e,i=(0,ej._)(e,["data","onChange","onBlur","defaultValue"]);return(0,l.jsx)(m.k7,(0,o._)({defaultValue:a,onChange:n,size:"small",placeholder:f.o.t("wf_chatflow_99"),onBlur:e=>{null==r||r(e.target.value)}},i))},eB=e=>{var{data:t,onChange:n,onBlur:r,defaultValue:a}=e,i=(0,ej._)(e,["data","onChange","onBlur","defaultValue"]);return(0,l.jsx)(m.k7,(0,o._)({defaultValue:a,onChange:n,precision:.1,size:"small",placeholder:f.o.t("wf_chatflow_99"),onBlur:e=>{setTimeout(()=>{null==r||r(e.target.value)},15)}},i))},eG=e=>{var{data:t,onChange:n,defaultValue:r,onBlur:i}=e,s=(0,ej._)(e,["data","onChange","defaultValue","onBlur"]),d=(0,a.useRef)(r);return(0,l.jsx)(m.Ph,(0,o._)({placeholder:f.o.t("wf_chatflow_99"),size:"small",optionList:[{label:"true",value:"true"},{label:"false",value:"false"}],showClear:!0,defaultValue:void 0!==r?JSON.stringify(!!r):void 0,onChange:e=>{if(e){var t=JSON.parse(e||"false");n(t),d.current=t}else n(null),d.current=null},onBlur:()=>null==i?void 0:i(d.current)},s))},eW=e=>{var{data:t,onChange:n,onBlur:r,defaultValue:i}=e,s=(0,ej._)(e,["data","onChange","onBlur","defaultValue"]),d=(0,a.useRef)(i);return(0,l.jsx)(eC.L,(0,o._)({value:i,onChange:e=>{d.current=e,n(e||null)},onBlur:()=>{null==r||r(d.current)}},s))},eU=e=>{var{defaultValue:t,data:{type:n},onChange:r,onBlur:i,inputType:s,onInputTypeChange:d}=e,u=(0,ej._)(e,["defaultValue","data","onChange","onBlur","inputType","onInputTypeChange"]),c=(0,a.useRef)(t),v=(0,eb.Df)(n),f=p.owu.isArrayType(n);return(0,l.jsx)(eD,(0,o._)({value:t,onChange:e=>{r(e||null),c.current=e||null,null==i||i(c.current)},accept:v,multiple:f,fileType:(0,ek._)(n),containerClassName:eF.Z["expand-content-file-adapter"],onBlur:()=>{null==i||i(c.current)},fileInputType:s,onInputTypeChange:d,inputTypeSelectClassName:eF.Z["file-type-select"],inputURLClassName:eF.Z["url-input"],enableInputURL:!0},u))},eH=e=>{var{defaultValue:t,onChange:n,disabled:o,className:r,onBlur:i}=e,s=(0,a.useRef)(t),{projectId:d}=(0,eN.j)();return(0,l.jsx)(eO,{className:r,size:"small",disabled:o||!d,defaultValue:t,enableTypes:["static"],onChange:e=>{n(e||null),s.current=e||null},onBlur:()=>{null==i||i(s.current)}})},eJ=e=>{if(e.name===p.d9h&&e.type===p.owu.String&&e.isPreset)return eH;switch(e.type){case p.owu.String:return eR;case p.owu.Number:return eV;case p.owu.Integer:return eB;case p.owu.Boolean:return eG;case p.owu.Time:return eA}return p.owu.isFileType(e.type)?eU:eW},eq=e=>{var{data:t}=e,n=(0,ej._)(e,["data"]),r=(0,a.useMemo)(()=>eJ(t),[t.type]);return(0,l.jsx)(r,(0,o._)({defaultValue:t.defaultValue,data:t},n))},eK=e=>{var t,{data:n,disabled:o,onDescChange:r,onDefaultValueChange:a,defaultValueInputType:i,onDefaultValueInputTypeChange:s,withDescription:d=!1,withDefaultValue:c=!1,className:v}=e,p=o||n.isPreset,h=(0,l.jsx)(m.Kx,{className:"field-input",autosize:{minRows:1,maxRows:5},disabled:p,defaultValue:n.description,maxLength:p?void 0:1e3,onBlur:e=>{r(e.target.value)},placeholder:f.o.t("wf_chatflow_98")});return(0,l.jsxs)("div",{className:u()("w-full",v),children:[c?(0,l.jsxs)("div",{className:"field",children:[(0,l.jsx)("div",{className:"mt-2 mb-1",children:(0,l.jsx)(m.ZT.Text,{className:"coz-fg-secondary text-xs leading-4 font-medium",children:f.o.t("wf_chatflow_96")})}),(0,l.jsx)("div",{className:eF.Z["field-content"],children:(0,l.jsx)(ei.C,{path:"".concat(null===(t=n.field)||void 0===t?void 0:t.slice(n.field.indexOf("[")),".defaultValue"),className:eF.Z.container,errorCompClassName:"output-default-value-error-text",children:e=>(0,l.jsx)(eq,{className:"field-input",data:n,disabled:o,onBlur:t=>{e.onBlur(),void 0!==t&&(null==a||a(t))},onChange:t=>{e.onChange()},inputType:i,onInputTypeChange:s})})})]}):null,d?(0,l.jsxs)("div",{className:"field",children:[(0,l.jsx)("div",{className:"mt-2 mb-1",children:(0,l.jsx)(m.ZT.Text,{className:"coz-fg-secondary text-xs leading-4 font-medium",children:f.o.t("wf_chatflow_97")})}),(0,l.jsx)("div",{className:eF.Z["field-content"],children:p&&n.description?(0,l.jsx)(m.u,{wrapperClassName:"w-full",content:n.description,position:"top",children:h}):h})]}):null]})},eX=e=>{var{onClick:t,expand:n}=e;return(0,l.jsx)("div",{className:"flex flex-row items-center self-stretch h-[24px]",children:(0,l.jsx)(m.hU,{className:"!block",size:"small",color:n?"highlight":"secondary",onClick:()=>null==t?void 0:t(),icon:n?(0,l.jsx)(I.qSn,{className:"text-sm"}):(0,l.jsx)(I.ltt,{className:"text-sm"})})})},eY=n("75001");function eQ(e){var{data:t,className:n,level:i,readonly:s=!1,typeReadonly:d=!1,onChange:c,hasObjectLike:v,activeMultiInfo:f,withDescription:h=!1,withRequired:g=!1,disabledTypes:_,hiddenTypes:y,disableDelete:w=!1,disabled:j=!1,couldCollapse:b=!0,collapsed:N=!0,onCollapse:k,needRenderAppendChild:C=!0,withDefaultValue:S=!1,defaultExpand:T=!1,columnsRatio:E,readonlyTooltip:D}=e,Z=(0,a.useRef)(null),M=$(E,i),P=(0,a.useCallback)(e=>{if(t.description!==e&&(""!==e||!!t.description))c(x.b_.Update,(0,r._)((0,o._)({},t),{description:e}))},[c,t]),L=(0,eo.Z)(e=>{if(t.defaultValue!==e&&(""!==e||!!t.defaultValue))c(x.b_.Update,(0,r._)((0,o._)({},t),{defaultValue:e}))}),[z,O]=(0,a.useState)(T),[A,F]=(0,a.useState)(""),R=(0,a.useCallback)(e=>{c(x.b_.Update,(0,r._)((0,o._)({},t),{required:e}))},[c,t]),V=(0,a.useCallback)(e=>{c(x.b_.Update,(0,r._)((0,o._)({},t),{enabled:e}))},[c,t]),B=null==t?void 0:t.isPreset,G=(0,a.useMemo)(()=>S&&0===t.level,[t,S]),W=(0,a.useMemo)(()=>G||h,[G,h]),U=(0,a.useMemo)(()=>z&&!s&&W,[W,z,s]),H=s?(0,l.jsxs)("div",{className:eY.Z["readonly-container"],children:[(0,l.jsx)("span",{className:eY.Z.name,children:t.name||"-"}),D?(0,l.jsx)(m.u,{content:D,children:(0,l.jsx)(I.L03,{className:"text-xs ml-1 coz-fg-secondary"})}):null,(0,l.jsx)(el.p,{size:"xs",children:p.IuB[t.type]||"-"})]}):(0,l.jsxs)("div",{className:u()({[eY.Z.wrapper]:!0,[eY.Z["preset-enabled"]]:B&&(null==t?void 0:t.enabled),[eY.Z["preset-disabled"]]:B&&!(null==t?void 0:t.enabled)}),children:[(0,l.jsx)(ew,{disabled:j||B,data:t,onChange:e=>{if(t.name!==e)c(x.b_.Update,(0,r._)((0,o._)({},t),{name:e}))},style:M.name}),(0,l.jsx)(ep,{disabled:d||j||B,data:t,onSelectChange:e=>{if(void 0!==e)(0,en.Z)(e)&&(!x.Yt.includes(e)&&t.children&&delete t.children,c(x.b_.Update,(0,r._)((0,o._)({},t),{defaultValue:void 0,type:e})))},level:i,disabledTypes:_,hiddenTypes:y,style:M.type}),g?(0,l.jsx)(em,{disabled:j||B,data:t,onChange:R}):null,S||h?(0,l.jsx)(eX,{onClick:()=>O(!z),expand:z}):null,(0,l.jsx)(ex,{data:t,level:i,onDelete:()=>{c(x.b_.Delete,t)},onAppend:()=>{c(x.b_.Append,t)},disableDelete:w,hasObjectLike:v,needRenderAppendChild:C,onEnabledChange:V,disabled:j})]});return(0,l.jsxs)("div",{className:u()({[n]:!!n,[eY.Z["param-container"]]:!0}),ref:Z,children:[(0,l.jsx)(er.G,{level:i,data:t,collapsed:N,onCollapse:k,couldCollapse:b,expandContentVisible:U,readonly:s,multiInfo:{multiline:(null==f?void 0:f.activeMultiKey)===t.field,withNameError:null==f?void 0:f.withNameError}}),(0,l.jsx)("div",{className:"w-full",style:{paddingLeft:b?10:0},children:(0,l.jsxs)("div",{className:u()({[eY.Z["expand-wrapper"]]:!0,"flex-grow":!b,"coz-mg-secondary":U}),children:[H,U?(0,l.jsx)(eK,{disabled:j,data:t,onDescChange:P,onDefaultValueChange:L,onDefaultValueInputTypeChange:F,defaultValueInputType:A,hasObjectLike:v,withDefaultValue:G,withDescription:h}):null]})})]})}var e$=n("438788"),e0=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.owu.String,n={fieldRandomKey:(0,i.x0)(),type:t};return e&&(n.required=!0),n};function e1(e){var{id:t,testId:n,readonly:d=!1,isBatch:y=!1,disabled:w,disabledTooltip:j,children:N,allowAppendRootData:k=!0,allowDeleteLast:C=!1,treeProps:I,title:T=f.o.t("workflow_detail_node_output"),titleTooltip:E=T,className:D,style:Z,value:M,onChange:P,withDescription:L=!1,withRequired:z=!1,disabledTypes:O=[],hiddenTypes:A,topLevelReadonly:F=!1,emptyPlaceholder:R,responseFormat:V={},defaultVariableType:B=p.owu.String,jsonImport:G=!0,noCard:W=!1,addItemTitle:U=f.o.t("workflow_add_output"),defaultCollapse:H=!1,formCardDefaultCollapse:J=!1,needAppendChildWhenNodeIsPreset:q=!0,maxLimit:K,withDefaultValue:X,defaultExpandParams:$=[],columnsRatio:ee}=e,en=(0,a.useRef)(null),eo=!M||0===M.length,{data:er=[],hasObjectLike:el,itemKeysWithChildren:ea}=_((0,s.Z)(M),t),ei=0===er.length,{expandedKeys:es,expandTreeNode:ed,collapseTreeNode:eu}=function(e,t){var[n,o]=(0,a.useState)(t?[]:e),r=(0,a.useCallback)(e=>{o([...new Set([...n,e])])},[e]),l=(0,a.useCallback)(e=>{o([...n.filter(t=>t!==e)])},[e]);return{expandedKeys:n,expandTreeNode:r,collapseTreeNode:l}}(ea,H),ec=(0,a.useMemo)(()=>{var e;return void 0!==K&&(null!==(e=null==M?void 0:M.length)&&void 0!==e?e:0)>=K},[M,K]),[ev,ep]=(0,a.useState)({activeMultiKey:""}),{concatTestId:ef}=(0,p.FCD)(),em=e=>{P&&(!function e(t,n){(Array.isArray(t)?t:[t]).forEach(t=>{n(t),t.children&&t.children.length>0&&e(t.children,n)})}(e=(e||[]).concat([]),e=>{var{key:t,name:n,type:o,description:r,required:l,children:a,isPreset:s,enabled:d,readonly:u,defaultValue:c}=e;for(var v in e)delete e[v];e.key=t||(0,i.x0)(),e.name=n,e.type=o,e.description=r,null!==c&&(e.defaultValue=c),s&&(e.isPreset=s,e.enabled=d||!1),z&&(e.required=l||!1),a&&(e.children=a),u&&(e.readonly=u)}),P(e))},eh=(e,t)=>{var n=(0,s.Z)(er);var l=(a=n,i=t.field,(d=a.find(e=>e.field===i))?{isRoot:!0,parentData:null,data:d}:function e(t,n){for(var o of t){var r,l,a=(r=o,l=n||o,r.field===i?{isRoot:!1,parentData:l,data:r}:r.children&&r.children.length>0?e(r.children,r):null);if(a)return a}return null}(a));if(l)switch(e){case x.b_.Append:var a,i,d,u,{data:c}=l,v=c.children||[];c.children=v.concat((0,r._)((0,o._)({},e0(!1,B)),{field:"".concat(c.field,".children[").concat(v.length,"]")})),em(n),(null==l?void 0:null===(u=l.data)||void 0===u?void 0:u.key)&&ed(l.data.key);break;case x.b_.Update:var p,h=l.isRoot?n:null===(p=l.parentData)||void 0===p?void 0:p.children,g=null==h?void 0:h.findIndex(e=>e.key===t.key);void 0!==g&&(null==h||h.splice(g,1,t),em(n));break;case x.b_.Delete:if(l.isRoot)em((n||[]).filter(e=>e.key!==t.key));else{var _=l.parentData;_.children=(_.children||[]).filter(e=>e.key!==t.key),em(n)}break;case x.b_.DeleteChildren:var{data:y}=l;y.children=[],em(n)}else m.FN.error(f.o.t("workflow_detail_node_output_parsingfailed"))},eg=(0,a.useMemo)(()=>{var e;return[p.B5l.Text,p.B5l.Markdown].includes(null!==(e=null==V?void 0:V.value)&&void 0!==e?e:p.B5l.JSON)},[V.value]),ex=(0,c.Z)(M),e_=(0,a.useRef)(-1);if((0,a.useEffect)(()=>{var e=-1!==e_.current&&e_.current!==V.value;if(void 0!==V.value&&(e_.current=V.value),eg&&e){var t,n,o,r=[{key:(0,i.x0)(),name:"output",type:p.owu.String}],l=ex.current;if(y){if(r=v.I.singleOutputMetasToList(r),(null==l?void 0:l[0])&&(r=[l[0]]),null==l?void 0:null===(t=l[0].children)||void 0===t?void 0:t[0]){var[a,...s]=l[0].children;r[0].children=[a,...s.filter(e=>null==e?void 0:e.readonly)]}(null==r?void 0:null===(n=r[0].children)||void 0===n?void 0:n[0].type)&&(null==r?void 0:null===(o=r[0].children)||void 0===o?void 0:o[0].type)!==p.owu.String&&(r[0].children[0].type=p.owu.String,r[0].children[0].children&&delete r[0].children[0].children)}else{if(null==l?void 0:l[0]){var[d,...u]=l;r=[d,...u.filter(e=>null==e?void 0:e.readonly)]}r[0].type!==p.owu.String&&(r[0].type=p.owu.String,r[0].children&&delete r[0].children)}P(r)}},[V.value]),d&&eo)return null;var ey=W?a.Fragment:h.E,ew=!d&&!F&&k&&!eg&&!ec;return(0,l.jsx)(b,{value:{testId:n},children:(0,l.jsxs)("div",{className:u()({[e$.Z.container]:!0,[e$.Z["not-readonly"]]:!d,[D||""]:!!D,[e$.Z["could-collapse"]]:ea.length>0}),style:Z,ref:en,children:[(0,l.jsxs)(ey,{autoExpandWhenDomChange:!0,defaultExpand:!J,showBottomBorder:!0,header:T,tooltip:E,contentClassName:"nowheel",noPadding:!0,testId:n,actionButton:(0,l.jsxs)("div",{className:"flex gap-[4px] items-center",children:[V.visible?(0,l.jsx)(S,{testId:ef(null!=n?n:"","json-format"),readonly:d||V.readonly,value:V.value,outputValue:M,onlyString:eg,onChange:P,onResponseFormatChange:V.onChange,isBatch:y}):void 0,d||F||!k||eg?null:(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(Q,{enable:G,hideAddButton:y||!!w})})]}),children:[!ei&&(0,l.jsx)(et,{readonly:d,config:{hasObjectLike:el,hasCollapse:ea.length>0,hasDescription:L,hasRequired:z},columnsRatio:ee}),(0,l.jsx)(m.mp,(0,o._)({expandAll:!d,style:d?{}:{overflow:"inherit"},motion:!1,disabled:w,className:u()({[e$.Z.content]:!0,[e$.Z.readonly]:d,[e$.Z["content-fix-pop-container"]]:!d}),renderFullLabel:e=>{var{level:t,data:n}=e,a=0===t,i=1===t,s=M.filter(e=>!e.readonly).length<=1,u=!!(a&&(y||F))||w,c=(()=>{if(u)return!0;if(s){var e;if(a&&!C||y&&i&&((null===(e=M.at(0))||void 0===e?void 0:e.children)||[]).filter(e=>!e.readonly).length<=1)return!0}return!1})();return(0,l.jsx)(eQ,(0,r._)((0,o._)({},e),{readonly:n.readonly||d,typeReadonly:eg,needRenderAppendChild:n.isPreset?!eg&&q:!eg,onChange:eh,hasObjectLike:el,onActiveMultiInfoChange:ep,activeMultiInfo:ev,withDescription:L,withRequired:z,withDefaultValue:X,disabledTypes:O,hiddenTypes:A,disableDelete:c,disabled:u,couldCollapse:ea.length>0,collapsed:e.expandStatus.expanded,onCollapse:t=>{var{key:n}=e.data;if(!!n)t?ed(n):eu(n)},defaultExpand:null==$?void 0:$.includes(n.name),columnsRatio:ee,readonlyTooltip:n.readonlyTooltip}))},emptyContent:R&&(0,l.jsx)("p",{className:e$.Z.emptyPlaceholder,children:R}),expandedKeys:[...es,(0,i.x0)()],treeData:er},I)),ew?(0,l.jsx)(g.A,{className:"absolute right-0 top-0",onMouseDown:()=>{P&&P((er||[]).concat((0,r._)((0,o._)({},e0(z,B)),{field:"[".concat(er.length,"]")})))},disabled:y||w,disabledTooltip:j,testId:ef(null!=n?n:"","add-output-item"),style:{marginLeft:ea.length>0?10:0},title:U}):null,N]}),ec?null:(0,l.jsx)(Y,{startField:t,testId:ef(null!=n?n:"","json-import-btn"),onChange:e=>{var t=[];M.filter(e=>e.isPreset).forEach(n=>{(e||[]).find(e=>e.name===n.name)?t.push((0,r._)((0,o._)({},n),{enabled:!0})):t.push(n)}),(e||[]).forEach(e=>{!M.find(t=>t.isPreset&&t.name===e.name)&&t.push(e)}),P(void 0===K?t:null==t?void 0:t.slice(0,K))},treeData:er,disabledTypes:O,disabledTooltip:j,hideAddButton:y||!!w,rules:{jsonImport:G,readonly:d,topLevelReadonly:F,disabled:!!w,isBatch:y,withRequired:z,onlyString:eg}})]})})}},515107:function(e,t,n){n.d(t,{e:function(){return u}});var o=n(151064);n(455069);var r=n(450562),l=n(336205),a=n(915757),i=n(674343),s=n(315703),{Title:d}=i.ZT,u=e=>{var{value:t,onChange:n,readonly:u}=e,{getNodeSetterId:c}=(0,r.FCD)(),v=l.o.t("workflow_ques_ans_type_direct_exrtact_title",{},"Extract variables from user's response.");return(0,o.jsxs)("div",{className:"flex w-full justify-between mb-2",children:[(0,o.jsx)(i.ZT.Text,{className:"mr-[6px] text-xs",ellipsis:{showTooltip:{opts:{content:v}}},style:{maxWidth:"calc(100% - 24px)",color:"#1C1F23"},children:v}),(0,o.jsx)(i.J2,{autoAdjustOverflow:!1,className:"rounded-md",trigger:"click",position:"bottomRight",content:(0,o.jsxs)("div",{className:"p-6",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)(d,{heading:5,children:l.o.t("workflow_ques_ans_type_direct_exrtact_context_setting",{},"Maximum dialogue rounds")}),(0,o.jsx)(i.u,{content:l.o.t("workflow_ques_ans_type_direct_context_setting_tooltips",{},"设置带入模型上下文的对话历史轮数。轮数越多,多轮对话的相关性越高,但消耗的Token也越多。"),children:(0,o.jsx)(a.L03,{className:"text-[#A7A9B0] text-xs ml-1"})})]}),(0,o.jsx)(s.G,{readonly:u,value:t,onChange:n,max:5,min:1})]}),children:(0,o.jsx)(i.hU,{size:"small",color:"secondary","data-testid":c("question-limit-setting"),wrapperClass:"flex justify-end",icon:(0,o.jsx)(a.qBd,{})})})]})}},265842:function(e,t,n){n.d(t,{Y:function(){return c}});var o=n(151064),r=n(455069),l=n(252237),a=n.n(l),i=n(450562),s=n(674343),d=n(44172),u=n(983871),c=e=>{var t,{value:n,onChange:l,options:c,readonly:v,context:p}=e,{options:f=[],mode:m="button",ignoreReadonly:h,disabled:g}=c,{getNodeSetterId:x,concatTestId:_}=(0,i.FCD)(),y=(0,r.useMemo)(()=>f.map(e=>{var t,r;return(0,o.jsxs)(s.Y8,{className:a()({"border-[#1C1F23]/[8%]":"card"===m&&e.value!==n,"bg-[--semi-color-bg-0]":"card"===m&&e.value!==n,[null==c?void 0:c.radioCardClassName]:null==c?void 0:c.radioCardClassName}),value:e.value,disabled:"boolean"==typeof(r=null!==(t=e.disabled)&&void 0!==t&&t)?r:"function"==typeof r&&r(p),"data-testid":_(x(p.meta.name),"".concat(e.value)),children:[e.label,(null==e?void 0:e.tooltip)?(0,o.jsx)(s.u,{content:null==e?void 0:e.tooltip,children:(0,o.jsx)(d.aUG,{className:"text-[#06070980] ml-[5px]"})}):null]},e.value)}),[f]);return(0,o.jsx)(s.FX,{disabled:!h&&v||g,className:a()({[u.Z.workflowNodeSetterRadio]:!0,[null==c?void 0:c.customClassName]:null==c?void 0:c.customClassName}),type:m,value:n,onChange:l,direction:null!==(t=null==c?void 0:c.direction)&&void 0!==t?t:"horizontal",children:y})}},420481:function(e,t,n){n.d(t,{FV:()=>eT});var o=n("808549"),r=n("120454"),l=n("473980"),a=n("151064"),i=n("455069"),s=n("523830"),d=n("686436"),u=n("455543"),c=n("830873"),v=n("450562"),p=n("336205"),f=e=>{var t;switch(e){case v.owu.String:t="";break;case v.owu.Integer:t=0;break;case v.owu.Boolean:t=!1;break;case v.owu.Number:t=0;break;case v.owu.ArrayString:case v.owu.ArrayInteger:case v.owu.ArrayBoolean:case v.owu.ArrayNumber:t=[];break;case v.owu.ArrayObject:t=[{}];break;case v.owu.Image:t="";break;case v.owu.ArrayImage:t=[];break;case v.owu.Object:t={};break;default:t=""}return t},m=(e,t)=>{var{type:n,name:o,children:r}=e;if(!t&&(t={}),n===v.owu.Object){var l={};t[o]=l,null==r||r.forEach(e=>{m(e,l)})}else if(n===v.owu.ArrayObject){var a={};t[o]=[a],null==r||r.forEach(e=>{m(e,a)})}else t[o]=f(n);return t},h=e=>e?Object.assign({},...e.map(e=>m(e))):{},g=e=>{var t=function(e,n){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,{children:a}=e,i=(0,r._)((0,o._)({},e),{parent:n,level:l});return[i,...((null==a?void 0:a.map(e=>t(e,i,l+1)))||[]).flat()]};return e&&e.length>0?e.map(e=>t(e)).flat():[]},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=g(e),o=g(t),r=[],l=[],a=[],i={};return o.forEach(e=>{i[e.key]=!0;var t=n.find(t=>t.key===e.key);t?e.name!==t.name?a.push({from:e,to:t}):e.type!==t.type&&l.push({from:e,to:t}):r.push(e)}),{removed:r,renamed:a,retyped:l,added:n.filter(e=>e.key&&!i[e.key]).filter(e=>e.name)}},_=e=>e.parent?[..._(e.parent),e]:[e],y=(e,t)=>{var n=[t];return e.forEach(e=>{n=n.map(t=>e.type===v.owu.Object?(!t[e.name]&&(t[e.name]={}),[t[e.name]]):e.type===v.owu.ArrayObject?(!t[e.name]&&(t[e.name]=[{}]),t[e.name]):void 0).flat()}),n},w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!e)return e;try{var o=JSON.parse(e),{removed:r,renamed:l,retyped:a,added:i}=x(t,n);return l.sort((e,t)=>t.from.level-e.from.level).forEach(e=>{var t=_(e.from);y(t.splice(0,t.length-1),o).forEach(t=>{var n;t[e.to.name]=null!==(n=t[e.from.name])&&void 0!==n?n:f(e.to.type)}),r.push(e.from)}),r.sort((e,t)=>t.level-e.level).forEach(e=>{var t=_(e);y(t.splice(0,t.length-1),o).forEach(t=>{t[e.name]=void 0})}),a.sort((e,t)=>t.from.level-e.from.level).forEach(e=>{var{from:t,to:n}=e;if(t.type===v.owu.ArrayObject&&n.type===v.owu.Object){var r=_(n);y(r.splice(0,r.length-1),o).forEach(e=>{var t,o;e[n.name]=null!==(o=null===(t=e[n.name])||void 0===t?void 0:t[0])&&void 0!==o?o:f(n.type)})}else if(t.type===v.owu.Object&&n.type===v.owu.ArrayObject){var l=_(n);y(l.splice(0,l.length-1),o).forEach(e=>{e[n.name]=[e[n.name]]})}else{var a=_(n);y(a.splice(0,a.length-1),o).forEach(e=>{e[n.name]=f(n.type)})}}),i.sort((e,t)=>e.level-t.level).forEach(e=>{var t=_(e);y(t.splice(0,t.length-1),o).forEach(t=>{t[e.name]=f(e.type)})}),JSON.stringify(o,null,4)}catch(t){return console.error(t),e}},j=e=>{try{return JSON.stringify(e,null,4)}catch(t){return console.error(t),e}},b=e=>{if(!e)return!1;var t=!0,n=e.map(e=>e.name),o=new Set(n);if(n.length!==o.size)t=!1;else for(var r of e)if(r.children&&!(t=b(r.children)))break;return t},N=n("37507"),k=n("155440"),C=n("615655"),S=e=>null==e?void 0:e.map(e=>(null==e?void 0:e.fieldRandomKey)?(0,r._)((0,o._)({},e),{key:e.fieldRandomKey}):e),I=e=>{var{json:t,outputs:n,isOpen:o,onJSONChange:r,isBatch:l}=e,a=S(n),s=(0,i.useRef)(a),d=(0,i.useRef)(l),u=(0,i.useRef)(o);return(0,i.useMemo)(()=>{var e;if(o&&b(a)){if(e=j(h(a)),!t&&(0,k.Z)(u.current))return r(e),u.current=o,s.current=a,{value:e,defaultValue:e};if(d.current!==l){if(s.current=a,d.current=l,!t)return{value:t,defaultValue:e};try{var n,i,c,v=JSON.parse(t);return n=l?j({outputList:[v]}):j(null!==(c=null==v?void 0:null===(i=v.outputList)||void 0===i?void 0:i[0])&&void 0!==c?c:v),r(n),{value:n,defaultValue:e}}catch(n){return console.error(n),{value:t,defaultValue:e}}}if(!(0,C.Z)(a,s.current)){var p=w(t,a,s.current);return r(p),s.current=a,{value:p,defaultValue:e}}}return{value:t,defaultValue:e}},[a,t,o,r,l])},T=n("136515"),E=n("564803"),D=e=>{var{isBatch:t,value:n,onChange:l,isSettingOnErrorV2:a}=e;(0,T.Z)(()=>{a&&t&&(null==n?void 0:n.processType)===E.A.EXCEPTION&&(null==l||l((0,r._)((0,o._)({},n),{processType:E.A.RETURN})))},[t,a,l,n])},Z=n("674343"),M=n("178388"),P=n("252237"),L=n.n(P),z=n("717497"),O=n("775699"),A=n("915757"),F=n("249294"),R=n("887874"),V=n("526900"),B=n("86270"),G=n("227985");V.Mj.register("json",z.AV),V.np.register("coze-light",B.G),V.np.register("coze-dark",G.E);var W=(0,R.Us)(V.ZP,[F.tk.theme({".cm-selectionBackground":{borderRadius:"4px"},".cm-activeLineGutter":{borderRadius:"4px 0 0 4px"},".cm-activeLine":{borderRadius:"0 4px 4px 0"},"&.cm-focused":{outline:"none"},"& *":{fontFamily:'Menlo, Monaco, "Courier New", monospace'},".cm-tooltip":{wordBreak:"break-all"},".cm-lineNumbers .cm-gutterElement":{transform:"translate(0, 1px)"},".cm-foldGutter .cm-gutterElement > div":{display:"flex",alignItems:"center"},".cm-completionIcon":{fontSize:"11px"}}),(0,F.jH)({parent:document.body,tooltipSpace:()=>({left:16,top:16,right:window.innerWidth-16,bottom:window.innerHeight-16})})]);function U(){return(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 18 18",fill:"none",children:[(0,a.jsx)("path",{d:"M8.32834 0.96886C8.32834 0.597733 8.6292 0.296875 9.00032 0.296875C9.37145 0.296875 9.67231 0.597733 9.67231 0.968861V1.81512C9.67231 2.18624 9.37145 2.4871 9.00032 2.4871C8.6292 2.4871 8.32834 2.18624 8.32834 1.81512V0.96886Z",fill:"currentColor"}),(0,a.jsx)("path",{d:"M14.2043 2.84603C14.4667 2.5836 14.8922 2.5836 15.1546 2.84603C15.417 3.10846 15.417 3.53393 15.1546 3.79636L14.5562 4.39475C14.2938 4.65718 13.8683 4.65718 13.6059 4.39475C13.3435 4.13233 13.3435 3.70685 13.6059 3.44442L14.2043 2.84603Z",fill:"currentColor"}),(0,a.jsx)("path",{d:"M17.7038 9.00032C17.7038 8.6292 17.4029 8.32834 17.0318 8.32834H16.1856C15.8144 8.32834 15.5136 8.6292 15.5136 9.00032C15.5136 9.37145 15.8144 9.67231 16.1856 9.67231H17.0318C17.4029 9.67231 17.7038 9.37145 17.7038 9.00032Z",fill:"currentColor"}),(0,a.jsx)("path",{d:"M15.1546 14.2043C15.4171 14.4667 15.4171 14.8922 15.1546 15.1546C14.8922 15.417 14.4667 15.417 14.2043 15.1546L13.6059 14.5562C13.3435 14.2938 13.3435 13.8683 13.6059 13.6059C13.8683 13.3435 14.2938 13.3435 14.5562 13.6059L15.1546 14.2043Z",fill:"currentColor"}),(0,a.jsx)("path",{d:"M9.00035 17.7038C9.37148 17.7038 9.67233 17.4029 9.67233 17.0318V16.1856C9.67233 15.8144 9.37148 15.5136 9.00035 15.5136C8.62922 15.5136 8.32836 15.8144 8.32836 16.1856V17.0318C8.32836 17.4029 8.62922 17.7038 9.00035 17.7038Z",fill:"currentColor"}),(0,a.jsx)("path",{d:"M3.79639 15.1546C3.53397 15.4171 3.10849 15.4171 2.84606 15.1546C2.58364 14.8922 2.58364 14.4667 2.84606 14.2043L3.44446 13.6059C3.70688 13.3435 4.13236 13.3435 4.39479 13.6059C4.65721 13.8683 4.65721 14.2938 4.39479 14.5562L3.79639 15.1546Z",fill:"currentColor"}),(0,a.jsx)("path",{d:"M0.296875 9.00035C0.296875 9.37148 0.597733 9.67233 0.96886 9.67233H1.81512C2.18624 9.67233 2.4871 9.37148 2.4871 9.00035C2.4871 8.62922 2.18624 8.32836 1.81512 8.32836H0.968861C0.597733 8.32836 0.296875 8.62922 0.296875 9.00035Z",fill:"currentColor"}),(0,a.jsx)("path",{d:"M2.84603 3.79639C2.5836 3.53397 2.5836 3.10849 2.84603 2.84606C3.10846 2.58364 3.53393 2.58364 3.79636 2.84606L4.39475 3.44446C4.65718 3.70688 4.65718 4.13236 4.39475 4.39479C4.13233 4.65721 3.70685 4.65721 3.44442 4.39479L2.84603 3.79639Z",fill:"currentColor"}),(0,a.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.5913 9.00033C14.5913 12.0881 12.0882 14.5913 9.00036 14.5913C5.91257 14.5913 3.40942 12.0881 3.40942 9.00033C3.40942 5.91253 5.91257 3.40937 9.00036 3.40937C12.0882 3.40937 14.5913 5.91253 14.5913 9.00033ZM13.2484 9.00034C13.2484 11.3465 11.3465 13.2484 9.00034 13.2484C6.6542 13.2484 4.75229 11.3465 4.75229 9.00034C4.75229 6.6542 6.6542 4.75229 9.00034 4.75229C11.3465 4.75229 13.2484 6.6542 13.2484 9.00034Z",fill:"currentColor"})]})}function H(){return(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 16 18",fill:"none",children:(0,a.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.4236 11.2192C8.85626 10.5313 7.33271 7.89246 8.02062 5.32516C8.27455 4.37747 8.66403 3.83272 9.25911 2.92849C10.0132 1.78265 9.83575 0.952788 8.91536 0.865985C5.47786 0.541789 1.56343 2.86076 0.490191 6.86615C-0.689079 11.2672 1.92273 15.791 6.32382 16.9703C10.9128 18.1999 14.6785 15.0743 15.6758 12.8972C16.0608 12.0567 15.332 11.2192 14.1862 11.2931C13.106 11.3627 12.3713 11.4732 11.4236 11.2192ZM13.8042 12.6547C14.0081 12.6165 14.1709 12.8367 14.0501 13.0054C12.4306 15.266 9.52439 16.4044 6.6797 15.6421C3.01212 14.6594 0.835614 10.8896 1.81834 7.22202C2.58057 4.37733 5.01954 2.42967 7.78701 2.15746C7.99355 2.13715 8.10286 2.38822 7.96776 2.54577C7.38427 3.22628 6.94014 4.04499 6.69247 4.96928C5.80802 8.2701 7.76687 11.6629 11.0677 12.5474C11.992 12.7951 12.9231 12.8198 13.8042 12.6547Z",fill:"currentColor"})})}var J=n("63903"),q=[F.tk.theme({"&":{borderRadius:"8px"},".cm-scroller":{transition:"height .3s ease"},".cm-content":{paddingTop:"16px",paddingBottom:"16px"}})],K=e=>{var{validateStatus:t,onBlur:n,onFocus:o,jsonSchema:r,options:s={},disabled:d,value:u,onChange:c,className:v,height:f,defaultValue:m,title:h}=e,g=(0,l._)(e,["validateStatus","onBlur","onFocus","jsonSchema","options","disabled","value","onChange","className","height","defaultValue","title"]),[x]=(0,i.useState)(!0),[_,y]=(0,i.useState)("light"),[w,j]=(0,i.useState)(!1),b=(0,i.useRef)(u),N=e=>{if(!!w)e?(b.current=e,null==c||c(e)):(b.current=void 0,null==c||c(void 0))},k=(0,i.useCallback)(()=>{j(!1),null==n||n()},[n]),C=(0,i.useCallback)(()=>{j(!0),null==o||o()},[o]),S=(0,i.useRef)(null),I=(0,i.useMemo)(()=>"file:///".concat((0,M.Z)(),".json"),[]);(0,i.useEffect)(()=>{u!==b.current&&!function(){if(!!S.current){var e=S.current.getValue();try{var t=JSON.parse(e),n=JSON.stringify(t,null,4);S.current.getValue()!==n&&S.current.setValue(n)}catch(e){console.error(e)}}}()},[u]),(0,i.useEffect)(()=>{var e,t="file:///".concat((0,M.Z)());return z.AV.languageService.configureSchemas({uri:t,fileMatch:[I],schema:r}),null===(e=S.current)||void 0===e||e.validate(),()=>{z.AV.languageService.deleteSchemas(t)}},[I,r]),(0,i.useEffect)(()=>{if(!!S.current)u!==S.current.getValue()&&S.current.setValue(u)},[u]);var T=(0,i.useMemo)(()=>{try{var e=JSON.parse(u);return"object"==typeof e}catch(e){return!1}},[u]);return(0,a.jsxs)("div",{"data-testid":g["data-testid"],className:L()(J.Z["json-editor"],x?J.Z["is-new-editor"]:"","dark"===_?J.Z["is-dark-theme"]:J.Z["is-light-theme"],v),children:[(0,a.jsxs)("div",{className:L()("w-full h-[28px] px-[8px] rounded-t-[8px] flex items-center justify-between",J.Z.header),children:[(0,a.jsx)("div",{className:J.Z.title,children:h||"json"}),(0,a.jsxs)("div",{className:J.Z.icons,children:[void 0!==m?(0,a.jsx)(Z.u,{content:p.o.t("Reset"),children:(0,a.jsx)(O.y3,{className:"bg-transparent",disabled:d,onClick:()=>{null==c||c(m)},onMouseDown:e=>e.preventDefault(),icon:(0,a.jsx)(A.mxP,{})})}):null,(0,a.jsx)(O.y3,{className:"bg-transparent",size:"small",onClick:()=>{y(e=>"light"===e?"dark":"light")},onMouseDown:e=>e.preventDefault(),icon:"light"===_?(0,a.jsx)(U,{}):(0,a.jsx)(H,{})}),(0,a.jsx)(Z.u,{content:p.o.t("workflow_exception_ignore_format"),children:(0,a.jsx)(O.y3,{size:"small",className:"bg-transparent",disabled:d||!T,onClick:()=>{try{var e=JSON.parse(u),t=JSON.stringify(e,null,4);b.current=t,null==c||c(t)}catch(e){console.error(e)}},onMouseDown:e=>e.preventDefault(),icon:(0,a.jsx)(A.bGR,{})})})]})]}),(0,a.jsx)("div",{className:L()("pl-[12px] transition-height duration-200 ease-in",{[J.Z.error]:"error"===t,[J.Z.disabled]:d}),children:(0,a.jsx)(R.KU,{children:(0,a.jsx)(W,{defaultValue:null!=u?u:"",options:{uri:I,languageId:"json",theme:"dark"===_?"coze-dark":"coze-light",fontSize:12,height:f||(w?"264px":"120px"),readOnly:d,editable:!d},extensions:q,onChange:e=>N(e.value),onFocus:C,onBlur:k,didMount:e=>S.current=e})})})]})};(0,O.Q2)(K,{valueKey:"value",onKeyChangeFnName:"onChange"});var X=n("698707"),Y=n("706489"),Q={[v.owu.ArrayObject]:{type:"array",items:{type:"object"}},[v.owu.ArrayImage]:{type:"array",items:{type:"string"}},[v.owu.ArrayTime]:{type:"array",items:{type:"string"}},[v.owu.ArrayBoolean]:{type:"array",items:{type:"boolean"}},[v.owu.ArrayNumber]:{type:"array",items:{type:"number"}},[v.owu.ArrayInteger]:{type:"array",items:{type:"integer"}},[v.owu.ArrayString]:{type:"array",items:{type:"string"}},[v.owu.Object]:{type:"object"},[v.owu.Image]:{type:"string"},[v.owu.Time]:{type:"string"},[v.owu.Boolean]:{type:"boolean"},[v.owu.Number]:{type:"number"},[v.owu.Integer]:{type:"integer"},[v.owu.String]:{type:"string"}},$=e=>{var{type:t,children:n=[]}=e,l=Q[t];if(t===v.owu.Object||t===v.owu.ArrayObject){var a={};for(var i of n)a[i.name]=$(i);return t===v.owu.Object?(0,r._)((0,o._)({},l),{properties:a}):(0,r._)((0,o._)({},l),{items:{type:"object",properties:a}})}return l},ee=e=>({type:"object",properties:(e||[]).filter(e=>e&&!e.readonly).reduce((e,t)=>(0,r._)((0,o._)({},e),{[t.name]:$(t)}),{})}),et=n("726293"),en=e=>{var{isOpen:t=!1,onSwitchChange:n,json:o,onJSONChange:r,readonly:l,errorMsg:i,defaultValue:s,noPadding:d,outputs:u}=e;return(0,a.jsxs)(Y.E,{header:p.o.t("workflow_exception_ignore_title"),tooltip:p.o.t("workflow_exception_ignore_icon_tips"),actionButton:(0,a.jsx)("div",{className:"flex items-center h-6",children:(0,a.jsx)(Z.rs,{size:"mini",checked:t,onChange:n,disabled:l})}),noPadding:d,children:[(0,a.jsx)("div",{className:"text-xs leading-[16px] coz-fg-secondary",children:p.o.t("workflow_exception_ignore_desc")}),t?(0,a.jsxs)("div",{className:"mt-[12px]",children:[(0,a.jsxs)("div",{className:"text-xs coz-fg-primary leading-[16px] font-medium",children:[p.o.t("workflow_exception_ignore_default_output"),(0,a.jsx)("span",{className:"coz-fg-hglt-red",children:"*"})]}),(0,a.jsx)("div",{className:"mt-[4px]",children:(0,a.jsx)(K,{className:et.Z["json-editor"],value:null!=o?o:"",jsonSchema:ee(u),options:{quickSuggestions:!1,suggestOnTriggerCharacters:!1},onChange:r,disabled:l,height:200,defaultValue:s})})]}):void 0,i?(0,a.jsx)(X.P,{feedbackText:i}):void 0]})},eo=e=>{var{isOpen:t=!1,json:n,onSwitchChange:o,onJSONChange:r,readonly:l,errorMsg:s,defaultValue:d,noPadding:u,outputs:c}=e,v=(0,i.useMemo)(()=>{if(!t)return{rs:!0};if(s)return{rs:!1,msg:s};if(void 0===n)return{rs:!0};try{var e=JSON.parse(n);if("object"!=typeof e)return{rs:!1,msg:p.o.t("workflow_exception_ignore_json_error")};return{rs:!0}}catch(e){return{rs:!1,msg:p.o.t("workflow_exception_ignore_json_error")}}},[t,n,s]);return(0,a.jsx)(en,{isOpen:t,json:n,onSwitchChange:o,onJSONChange:r,readonly:l,errorMsg:v.msg,defaultValue:d,noPadding:u,outputs:c})},er=n("210602"),el=()=>{var e=(0,d.PF)();return(0,er.M)(e)},ea=e=>{var t=el().default;return(null==e?!!void 0:!!e.settingOnErrorIsOpen)||(null==e?!!void 0:!!e.retryTimes)||(null==e?!!void 0:!!e.timeoutMs)&&(null==e?void 0:e.timeoutMs)!==t||!1},ei=n("297158"),es=e=>new Intl.NumberFormat("en-US",{maximumFractionDigits:3,minimumFractionDigits:0}).format(e/1e3),ed=e=>{var{value:t,onChange:n,readonly:o}=e,r=el(),[l,s]=(0,i.useState)("");return((0,i.useEffect)(()=>{s(es(null!=t?t:r.default))},[r.default,t]),r.disabled)?(0,a.jsx)("div",{children:"-"}):(0,a.jsx)(Z.II,{size:"small","data-testid":"setting-on-error-timeout",value:l,onChange:e=>{var t=String(e);/^\d*\.?\d{0,3}$/.test(t)&&s(t)},onBlur:()=>{try{var e=Math.round(1e3*Number(l));""===l&&(e=r.default),e<r.min&&(e=r.min),e>r.max&&(e=r.max),null==n||n(e);var t=es(e);s(t)}catch(e){ei.kg.error(e)}},disabled:o,suffix:"s"})},eu=e=>{var{value:t,onChange:n,readonly:o}=e;return(0,a.jsx)(Z.Ph,{size:"small","data-testid":"setting-on-error-retry-times",optionList:[{label:p.o.t("workflow_250416_06",void 0,"不重试"),value:0},{label:p.o.t("workflow_250416_07",void 0,"重试1次"),value:1}],value:null!=t?t:0,onChange:e=>{null==n||n(e)},disabled:o})},ec=e=>{var{label:t,tooltip:n}=e;return(0,a.jsx)(Z.u,{content:n,position:"left",spacing:40,children:(0,a.jsx)("div",{className:"pl-2",children:t})})},ev=e=>{var{value:t,onChange:n,readonly:l,isBatch:i}=e,s=[{value:E.A.BREAK,label:p.o.t("workflow_250407_208",void 0,"中断流程"),tooltip:p.o.t("workflow_250407_209",void 0,"发生异常后，中断流程执行。异常信息将会显示在节点卡片上，或者通过调用结果返回。")},{value:E.A.RETURN,label:p.o.t("workflow_250407_210",void 0,"返回设定内容"),tooltip:p.o.t("workflow_250407_211",void 0,"发生异常后，流程不会中断。异常信息会通过isSuccess、errorBody返回。开发者可设定需要返回的内容。")},...i?[]:[{value:E.A.EXCEPTION,label:p.o.t("workflow_250407_212",void 0,"执行异常流程"),tooltip:p.o.t("workflow_250407_213",void 0,"发生异常后，流程不会中断。异常信息会通过isSuccess、errorBody返回，同时会新增异常分支。开发者需要完善异常处理流程后，方可运行流程。")}]];return(0,a.jsx)(Z.Ph,{size:"small","data-testid":"setting-on-error-process-type",optionList:s.map(e=>(0,r._)((0,o._)({},e),{label:(0,a.jsx)(ec,{label:e.label,tooltip:e.tooltip})})),renderSelectedItem:e=>{var t=s.find(t=>t.value===(null==e?void 0:e.value));return t?(0,a.jsx)("div",{children:t.label}):null},value:t||E.A.BREAK,onChange:e=>{null==n||n(e)},disabled:l})},ep=e=>{var{isOpen:t,json:n,onJSONChange:o,readonly:r,defaultValue:l,processType:s,errorMsg:d,outputs:u}=e,c=(0,i.useMemo)(()=>ee(u),[u]);return t&&s===E.A.RETURN?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mt-2","data-testid":"setting-on-error-json",children:(0,a.jsx)(K,{className:et.Z["json-editor"],value:null!=n?n:"",options:{quickSuggestions:!1,suggestOnTriggerCharacters:!1},onChange:o,disabled:r,height:170,defaultValue:l,jsonSchema:c,title:p.o.t("workflow_250416_08",void 0,"自定义返回内容")})}),d?(0,a.jsx)(X.P,{feedbackText:d}):void 0]}):null},ef=()=>{var{min:e,max:t,disabled:n}=el(),o=[{title:p.o.t("workflow_250407_205",void 0,"超时时间"),tooltip:n?p.o.t("workflow_250508_01",void 0,"端插件不支持超时配置"):(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:p.o.t("workflow_250421_04",void 0,"超时区间")}),(0,a.jsxs)("p",{children:[e/1e3,"s - ",t/1e3,"s"]})]})},{title:p.o.t("workflow_250407_206",void 0,"重试次数")},{title:p.o.t("workflow_250407_207",void 0,"异常处理方式")}];return(0,a.jsx)(a.Fragment,{children:o.map(e=>(0,a.jsxs)("div",{className:L()("coz-fg-secondary text-xs font-medium leading-4 flex items-center"),children:[e.title,e.tooltip?(0,a.jsx)(Z.u,{content:e.tooltip,children:(0,a.jsx)(A.L03,{className:"ml-1 text-sm"})}):null]},e.title))})},em=n("550655"),eh=n("364498"),eg=n("392646"),ex=n("307315"),e_=n("435855"),ey=e=>{var{model:t,popoverVisible:n,placeholder:o,onClear:r,showClear:l}=e;return(0,a.jsxs)("div",{className:L()("w-full p-[4px] flex items-center justify-between rounded-[8px]","overflow-hidden cursor-pointer border border-solid","hover:coz-mg-secondary-hovered active:coz-mg-secondary-pressed",e_.Z.trigger,n?"coz-stroke-hglt":"coz-stroke-primary"),children:[t?(0,a.jsx)(ex.Zc,{model:t}):(0,a.jsx)("div",{className:"text-xs coz-fg-dim",children:o}),(0,a.jsx)(A.Wdl,{className:L()("coz-fg-secondary text-base",e_.Z["model-select-down-icon"])}),l?(0,a.jsx)("span",{className:L()(e_.Z["model-select-clear-icon"],"coze-select-clear-icon absolute right-[30px] cursor-pointer text-xs coz-fg-secondary hover:coz-mg-secondary-hovered flex items-center justify-center p-2"),onClick:e=>{e.stopPropagation(),null==r||r()},children:(0,a.jsx)(A.rmE,{})}):null]})},ew=e=>{var t,n,{value:l,onChange:i,retryTimes:s,readonly:u}=e,c=(0,d.PF)();if(!(null===(t=eh.km[null==c?void 0:c.flowNodeType])||void 0===t?void 0:t.enableBackupModel)||!s||!(0,em.Z)(s))return null;var v=!!(!u&&(null==l?void 0:null===(n=l.backupLLmParam)||void 0===n?void 0:n.modelType)),f=e=>{var t=(0,r._)((0,o._)({},l||{}),{backupLLmParam:e});null==i||i(t)};return(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"w-[92px] text-xs font-medium coz-fg-primary flex items-center",children:[p.o.t("workflow_250407_203",void 0,"备选模型"),(0,a.jsx)(Z.u,{content:p.o.t("workflow_250407_204",void 0,"重试时会使用备选模型"),children:(0,a.jsx)(A.L03,{className:"text-sm coz-fg-secondary ml-1.5"})})]}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(eg.q,{name:"backupLLmParam",className:L()(e_.Z["model-select"],{[e_.Z["model-select-clearable"]]:v}),testName:"setting-on-error.ext.backupLLmParam",value:(null==l?void 0:l.backupLLmParam)?l.backupLLmParam:void 0,onChange:f,readonly:!!u,popoverPosition:"top",popoverAutoAdjustOverflow:!0,triggerRender:(e,t)=>(0,a.jsx)(ey,{model:e,popoverVisible:t,placeholder:p.o.t("workflow_250416_04",void 0,"选择备选模型"),showClear:v,onClear:()=>{f(void 0)}})})})]})},ej=n("385647"),eb=e=>!!((null==e?void 0:e.settingOnErrorIsOpen)&&(null==e?void 0:e.processType)===E.A.EXCEPTION),eN=e=>{var t,n,o,{node:r,hasException:l}=e,a=r.getService(d.L4),i=r.getService(d.dm),{outputLines:s}=r.getData(d.Z1),u=r.getData(d.QW);if((0,ej.QY)(r.flowNodeType)){u.updateDynamicPorts();return}l?(t=s.filter(e=>!e.fromPort.portID&&"output"===e.fromPort.portType),n={type:"output",portID:"default"}):(t=s.filter(e=>"default"===e.fromPort.portID&&"output"===e.fromPort.portType),n={type:"output"}),(null==t?void 0:t.length)&&(o=t.map(e=>({from:e.info.from,to:e.info.to||"",fromPort:n.portID||"",toPort:e.info.toPort||""})),t.forEach(e=>{a.removeNode(e)})),u.updateStaticPorts([{type:"input"},n]),(null==o?void 0:o.length)&&o.forEach(e=>{i.createLine(e)})},ek=e=>{var{value:t}=e,n=(0,i.useRef)(eb(t)),o=(0,d.PF)();(0,i.useEffect)(()=>{var e=eb(t);n.current!==e&&(n.current=e,eN({node:o,hasException:e}))},[t,o])},eC=e=>{var{isOpen:t=!1,json:n,onJSONChange:l,readonly:i,errorMsg:s,defaultValue:d,value:u,onChange:c,outputs:v,isBatch:p,syncOutputs:f}=e;ek({value:u});var m=(e,t)=>{c((0,r._)((0,o._)({},u),{[e]:t}))};return(0,a.jsxs)("div",{className:"pb-40",children:[(0,a.jsxs)("div",{className:"grid grid-cols-[5fr_5fr_8fr] gap-y-2 gap-x-1",children:[(0,a.jsx)(ef,{}),(0,a.jsx)(ed,{value:null==u?void 0:u.timeoutMs,onChange:e=>{m("timeoutMs",e)},readonly:i}),(0,a.jsx)(eu,{value:null==u?void 0:u.retryTimes,onChange:e=>{var t=(0,o._)({},u);c((0,r._)((0,o._)({},t),{retryTimes:e}))},readonly:i}),(0,a.jsx)(ev,{value:null==u?void 0:u.processType,onChange:e=>{var t=!(!e||e===E.A.BREAK);c((0,r._)((0,o._)({},u),{processType:e,settingOnErrorIsOpen:t})),null==f||f(t)},readonly:i,isBatch:p})]}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(ew,{value:null==u?void 0:u.ext,onChange:e=>{m("ext",e)},readonly:i,retryTimes:null==u?void 0:u.retryTimes})}),(0,a.jsx)(ep,{isOpen:t,json:n,onJSONChange:l,readonly:i,defaultValue:d,processType:null==u?void 0:u.processType,errorMsg:s,outputs:v})]})},eS=e=>{var{isOpen:t=!1,onSwitchChange:n,json:r,onJSONChange:i,readonly:s,errorMsg:u,defaultValue:c,noPadding:f}=e,m=(0,l._)(e,["isOpen","onSwitchChange","json","onJSONChange","readonly","errorMsg","defaultValue","noPadding"]),h=p.o.t("workflow_250421_03",void 0,"可设置异常处理,包括超时、重试、异常处理方式。");(0,d.PF)().flowNodeType===v.nyy.LLM&&(h+=p.o.t("workflow_250416_03",void 0,"在开启流式输出的情况下，一旦开始接受数据即便出错，也无法重试和跳转异常分支。"));var g=ea(m.value);return(0,a.jsx)(Y.E,{header:p.o.t("workflow_250416_01"),tooltip:h,noPadding:f,defaultExpand:g,testId:"setting-on-error",children:(0,a.jsx)(eC,(0,o._)({isOpen:t,onSwitchChange:n,json:r,onJSONChange:i,readonly:s,errorMsg:u,defaultValue:c,noPadding:f},m))})},eI=e=>{var{isOpen:t=!1,json:n,onSwitchChange:r,onJSONChange:s,readonly:d,errorMsg:u,defaultValue:c,noPadding:v}=e,f=(0,l._)(e,["isOpen","json","onSwitchChange","onJSONChange","readonly","errorMsg","defaultValue","noPadding"]),m=(0,i.useMemo)(()=>{if(!t)return{rs:!0};if(u)return{rs:!1,msg:u};if(void 0===n)return{rs:!0};try{var e=JSON.parse(n);if("object"!=typeof e)return{rs:!1,msg:p.o.t("workflow_exception_ignore_json_error")};return{rs:!0}}catch(e){return{rs:!1,msg:p.o.t("workflow_exception_ignore_json_error")}}},[t,n,u]);return(0,a.jsx)(eS,(0,o._)({isOpen:t,json:n,onSwitchChange:r,onJSONChange:s,readonly:d,errorMsg:m.msg,defaultValue:c,noPadding:v},f))},eT=e=>{var{value:t,onChange:n,batchModePath:f,outputsPath:m,readonly:h,context:g,options:x,noPadding:_}=e,y=function(e){var t,n,l,a,f,{value:m,onChange:h,batchModePath:g,outputsPath:x,context:_,options:y}=e,{settingOnErrorIsOpen:w,settingOnErrorJSON:j}=m||{},k=(0,u.Od)(),C=(0,d.cI)(),S=(0,d.PF)(),T=(0,d.vo)(S);t=S,n=(0,d.JA)(),l=t.getData(N.z),(0,i.useEffect)(()=>{var e=l.onAnyVariablesChange(()=>{n()});return()=>null==e?void 0:e.dispose()},[l,n]),a=T?g?C.getValueIn(g):void 0:null==y?void 0:y.batchMode,f=T?x?C.getValueIn(x):void 0:null==y?void 0:y.outputs;var E=a===v.Psf.Batch;D({value:m,onChange:h,isBatch:E,isSettingOnErrorV2:k});var[Z,M]=(0,i.useState)({isOpen:w,json:j,isBatch:E,outputs:(0,c.K2)({value:f,isBatch:E,isSettingOnErrorV2:k})});(0,s.Z)(()=>{M({isOpen:w,json:j,isBatch:E,outputs:(0,c.K2)({value:f,isBatch:E,isSettingOnErrorV2:k})})},[w,j,E,f],{wait:100});var{value:P,defaultValue:L}=I((0,r._)((0,o._)({},Z),{onJSONChange:e=>{h((0,r._)((0,o._)({},m),{settingOnErrorJSON:e}))}})),z=e=>{if(T){var t=C.getValueIn("outputs");f&&C.setValueIn("outputs",(0,c.Rb)({value:t,isBatch:E,isOpen:e,isSettingOnErrorV2:k}))}else{var n=null==_?void 0:_.form.getFormItemByPath("/outputs");(null==n?void 0:n.value)&&(n.value=(0,c.Rb)({value:null==n?void 0:n.value,isBatch:E,isOpen:e,isSettingOnErrorV2:k}))}if(T){var l=C.getValueIn("model");e&&l&&(null==l?void 0:l.responseFormat)!==v.B5l.JSON&&C.setValueIn("model",(0,r._)((0,o._)({},l),{responseFormat:v.B5l.JSON}))}else{var a,i=null==_?void 0:_.form.getFormItemByPath("/model");e&&(null==i?void 0:i.value)&&(null==i?void 0:null===(a=i.value)||void 0===a?void 0:a.responseFormat)!==v.B5l.JSON&&(i.value=(0,r._)((0,o._)({},null==i?void 0:i.value),{responseFormat:v.B5l.JSON}))}};return{isOpen:w,defaultValue:L,json:P,onSwitchChange:e=>{h((0,r._)((0,o._)({},m),{settingOnErrorIsOpen:e})),z(e)},onJSONChange:e=>{h((0,r._)((0,o._)({},m),{settingOnErrorJSON:null!=e?e:""}))},errorMsg:b(f)?void 0:p.o.t("workflow_exception_json_error"),value:m,onChange:h,outputs:f,isSettingOnErrorV2:k,isBatch:E,syncOutputs:z}}({value:t,onChange:n,batchModePath:f,outputsPath:m,context:g,options:x}),{isSettingOnErrorV2:w}=y,j=(0,l._)(y,["isSettingOnErrorV2"]);return w?(0,a.jsx)(eI,(0,r._)((0,o._)({},j),{readonly:h,noPadding:_})):(0,a.jsx)(eo,(0,r._)((0,o._)({},j),{readonly:h,noPadding:_}))}},315703:function(e,t,n){n.d(t,{G:function(){return a}});var o=n(151064),r=n(450562),l=n(674343),a=e=>{var{value:t,onChange:n,max:a,min:i,sliderStyle:s={width:300},readonly:d,marks:u}=e,{getNodeSetterId:c}=(0,r.FCD)();return(0,o.jsx)("div",{className:"flex",children:(0,o.jsx)(l.iR,{"data-testid":c("slider-with-input-slider"),max:a,min:i,value:t,onChange:e=>{n(e)},style:s,readonly:d,disabled:d,marks:u})})}},205641:function(e,t,n){n.d(t,{x:function(){return o.xv}});var o=n(614904)},569251:function(e,t,n){n.d(t,{Z:()=>N});var o=n("151064"),r=n("455069"),l=n("252237"),a=n.n(l),i=n("674343"),s=n("336383"),d=n("306215"),u=n("450562"),c=n("336205"),v=n("915757"),p=n("184449"),f=n("608406"),m=n("479654"),h=n("808549"),g=e=>{var{onClick:t}=e;return(0,o.jsx)(v.Wdl,{className:"coz-fg-secondary text-xs semi-tree-option-expand-icon",onClick:t})},x=n("589920"),_=n("963633"),y=r.forwardRef((e,t)=>{var{value:n,query:l,forArrayItem:d,testId:c=""}=(0,x.B)(),{dataSource:v=[],onSelect:p,className:f,outerTopSlot:m,innerTreeStyle:y={},emptyContent:w}=e,{concatTestId:j}=(0,u.FCD)(),b=(0,r.useRef)(null),N=(0,r.useRef)(null);return(0,r.useImperativeHandle)(t,()=>({treeContainerRef:null==b?void 0:b.current,treeRef:null==N?void 0:N.current})),(0,r.useEffect)(()=>{var e;null===(e=N.current)||void 0===e||e.search(null!=l?l:"")},[l,N.current]),(0,o.jsxs)("div",{ref:b,className:a()(f,_.Z["node-variable-tree-wrapper"],"overflow-auto"),children:[m,(0,o.jsx)(i.mp,{ref:N,filterTreeNode:!0,showFilteredOnly:!0,blockNode:!1,searchRender:!1,className:_.Z["node-variable-tree"],defaultValue:{key:null==n?void 0:n.join("-"),value:null==n?void 0:n.join("-")},defaultExpandAll:!0,treeData:v,style:(0,h._)({minWidth:240},y),emptyContent:w,onChangeWithObject:!0,onSelect:(e,t,n)=>{null==p||p(n)},renderFullLabel:e=>{var{className:t,onExpand:n,data:r,onCheck:i,expandStatus:u}=e,v=!(r.children&&r.children.length);return(0,o.jsxs)("li",{className:a()(t,"!mb-0.5"),role:"treeitem",onClick:i,"data-key":r.key,children:[v?(0,o.jsx)("span",{className:"semi-tree-option-empty-icon"}):(0,o.jsx)(g,{onClick:n}),(0,o.jsx)("span",{className:"text-xs pr-1 variable-tree-node-label",children:(0,s.mk)(r,d,l,j(c,null==r?void 0:r.path))})]})}})]})}),w=n("716643"),j=r.forwardRef((e,t)=>{var n,{testId:r=""}=(0,x.B)(),{data:l,active:s,onMouseOver:h,onMouseLeave:g,onSelect:_,getPopupContainer:j,selected:b}=e,{isInIDE:N}=(0,p.j1)(),k=!N,C=(0,d.mN)("".concat(l.value||"")),S=C&&k||!!(null===(n=l.children)||void 0===n?void 0:n.length),{concatTestId:I}=(0,u.FCD)();return(0,o.jsx)("div",{className:"w-full relative",onMouseOver:h,onMouseLeave:g,children:(0,o.jsx)(i.J2,{getPopupContainer:j,motion:!1,autoAdjustOverflow:!0,position:"leftTop",trigger:"custom",visible:s&&S,rePosKey:Math.random(),style:{borderRadius:8,transform:"translateY(-4px)"},content:C&&k?(0,o.jsx)(f.o,{className:"!p-0",relatedBotPanelStyle:{width:"254px",height:"unset",maxHeight:"290px"},customVariablePanel:(0,o.jsx)(y,{ref:t,dataSource:l.children,onSelect:_,className:w.Z["bot-select-node-variable-tree"],innerTreeStyle:{width:"254px",minWidth:"unset"},outerTopSlot:l.children&&l.children.length>0?(0,o.jsx)("div",{className:"coz-fg-secondary mt-8px mb-4px pl-28px text-[12px] font-medium leading-16px",children:c.o.t("variable_binding_please_select_a_variable",{},"请选择变量")}):void 0,emptyContent:(0,o.jsx)(f.O,{className:"pt-32px pb-32px"})})}):(0,o.jsx)(y,{ref:t,dataSource:l.children,onSelect:_}),children:(0,o.jsxs)("div",{"data-testid":I(r,l.name),className:a()("p-1 flex items-center cursor-pointer hover:coz-mg-primary active:coz-mg-primary-pressed h-6 rounded-[4px]",{"coz-mg-primary":s}),onClick:()=>{null==_||_(l,m.Q.Option)},children:[(0,o.jsx)("div",{className:w.Z["option-icon-wrapper"],children:l.icon}),(0,o.jsx)("div",{className:a()("flex-1 ml-1 truncate text-xs",{"coz-fg-hglt font-semibold":b}),children:l.label}),S?(0,o.jsx)(v.x5d,{className:"coz-fg-secondary"}):null]})})})}),b=n("258696"),N=r.forwardRef((e,t)=>{var{treeData:n,onOptionHover:l,onSelect:d,getOptionPopupContainer:u,activeOption:c,emptyContent:v,extraOption:p,value:f,controlledActive:m=!0}=e,h=(0,r.useMemo)(()=>(0,s.oL)(n),[n]),g=(0,r.useCallback)(e=>{null==l||l(e)},[l]),[x,_]=(0,r.useState)(!1),y=(0,r.useMemo)(()=>(null==h?void 0:h.find(e=>e.groupId))?"262px":"252px",[h]),w=(null==f?void 0:f.length)===1;return(0,o.jsx)("div",{className:a()("w-full",b.Z["node-list-wrapper"]),style:{maxHeight:y},children:p?(0,o.jsxs)(o.Fragment,{children:[p,(0,o.jsx)(i.aV,{children:null==h?void 0:h.map((e,t)=>(0,o.jsxs)(o.Fragment,{children:[h[t-1]&&h[t-1].groupId!==e.groupId?(0,o.jsx)(i.iz,{style:{width:"calc(100% - 8px)"},margin:4}):null,(0,o.jsx)(i.aV.Item,{className:"!p-0 !border-none",children:(0,o.jsx)(j,{data:e,active:x?e.value===c:e.value===c&&m,selected:w&&e.value===(null==f?void 0:f[0]),onMouseOver:()=>{g(e),_(!0)},onSelect:d,getPopupContainer:u})})]}))})]}):(null==h?void 0:h.length)?(0,o.jsx)(i.aV,{children:null==h?void 0:h.map((e,n)=>(0,o.jsxs)(o.Fragment,{children:[h[n-1]&&h[n-1].groupId!==e.groupId?(0,o.jsx)(i.iz,{style:{width:"calc(100% - 8px)"},margin:4}):null,(0,o.jsx)(i.aV.Item,{className:"!p-0 !border-none",children:(0,o.jsx)(j,{ref:t,data:e,active:x?e.value===c:e.value===c&&m,onMouseOver:()=>{g(e),_(!0)},onSelect:d,getPopupContainer:u})})]}))}):(0,o.jsx)("div",{className:"px-6 py-3 coz-fg-secondary text-center",children:v})})})},589920:function(e,t,n){n.d(t,{B:function(){return l},m:function(){return r}});var o=n(455069),r=(0,o.createContext)({valueSubVariableMeta:null}),l=()=>(0,o.useContext)(r)},486264:function(e,t,n){n.d(t,{Z:function(){return i}});var o=n(151064);n(455069);var r=n(306215),l=n(915757),a={[r.fK.App]:(0,o.jsx)(l.Nxk,{}),[r.fK.User]:(0,o.jsx)(l.U5H,{}),[r.fK.System]:(0,o.jsx)(l.qBd,{})};function i(e){var{nodeId:t}=e;return(0,o.jsx)(o.Fragment,{children:a[t]})}},724375:function(e,t,n){n.d(t,{W:()=>Z});var o=n("808549"),r=n("120454"),l=n("151064"),a=n("455069"),i=n("222363"),s=n("306215"),d=n("465729"),u=n("66148"),c=n("336205"),v=n("9734"),p=n("34817"),f=n("915757"),m=n("15326"),h=n("486264"),g=n("213635"),x=n("336383"),_=n("881280"),y=n("589920"),w=n("252237"),j=n.n(w),b=n("674343"),N=n("136202"),k=n("716643"),C=(e,t)=>{var[n]=e;if(!n)return{};var o=t.find(e=>e.value===n);return null!=o?o:{}},S=e=>{var{value:t,dataSource:n,invalidContent:o,valueSubVariableMeta:r,displayVarName:a,isUnknownValue:i}=(0,y.B)(),{className:s}=e;if(!t||!(null==r?void 0:r.name))return null;if(i)return o?(0,l.jsx)("span",{className:"absolute h-full max-w-[calc(100% - 8px)] truncate",children:(0,l.jsx)("span",{className:"flex items-center h-full text-sm",style:{color:"var(--semi-color-text-0)"},children:o})}):null;var d=C(t,null!=n?n:[]),u=(0,x.vm)(null!=n?n:[],t).slice(1).join("/");return(0,l.jsx)(b.J2,{showArrow:!0,position:"top",trigger:"hover",spacing:20,className:k.Z.popoverContainer,content:(0,l.jsxs)("div",{className:j()(k.Z.popover,"cursor-pointer"),children:[(0,l.jsxs)("div",{className:k.Z.header,children:[(0,l.jsx)(g.q,{size:16,nodeId:d.value}),(0,l.jsx)("p",{className:k.Z.title,children:d.label})]}),(0,l.jsx)("div",{className:k.Z.content,children:(0,l.jsx)("p",{children:u})})]}),children:(0,l.jsx)("span",{className:j()("absolute h-full max-w-[calc(100% - 8px)]","semi-tree-select-selection-TriggerSearchItem",s),children:(0,l.jsx)("span",{className:"text-xs inline-block h-full truncate cursor-text max-w-full",children:(0,l.jsxs)(b.T,{spacing:4,className:"h-full",children:[(0,l.jsx)("span",{className:"font-semibold",style:{color:"var(--coz-fg-secondary)"},children:d.label}),(0,l.jsx)("span",{className:"font-semibold",style:{color:"var(--coz-fg-secondary)"},children:"-"}),(0,l.jsx)("span",{className:"truncate",children:a})]})})})})},I=n("569251"),T=n("258696"),E="tree-variable-selector-popover",D=e=>{var t,{value:n,treeData:r,placeholder:i,emptyContent:s,disabled:d,readonly:u,validateStatus:c,onSelect:v,onBlur:p,showClear:m,onClear:h,trigger:g,onPopoverVisibleChange:x,renderExtraOption:_,popoverStyle:w={}}=e,{query:k,setQuery:C,testId:D,valueSubVariableMeta:Z}=(0,y.B)(),[M,P]=(0,a.useState)(null==n?void 0:n[0]),[L,z]=(0,a.useState)(!1),[O,A]=(0,a.useState)(!1),F=(0,a.useRef)(null),R=(0,a.useRef)(null),V=(0,a.useCallback)(()=>document.querySelector(".".concat(E))||document.body,[]),B=(0,a.useCallback)(e=>{P(null==e?void 0:e.value)},[P]),G=(0,a.useCallback)(e=>{null==v||v(e),A(!1)},[v,A]);return(0,l.jsx)(b.J2,{className:E,motion:!1,position:"bottomLeft",trigger:"click",visible:O,onVisibleChange:e=>{!e&&(z(!1),null==C||C("")),A(e),null==x||x(e)},style:(0,o._)({minWidth:(null===(t=R.current)||void 0===t?void 0:t.clientWidth)||200,maxWidth:340,borderRadius:8},w),content:(0,l.jsx)(I.Z,{treeData:r,activeOption:M,emptyContent:s,onSelect:G,onOptionHover:B,getOptionPopupContainer:V,extraOption:(()=>{var e=null==_?void 0:_(r,{hiddenPopover:()=>A(!1)});if(!!e)return(0,l.jsx)("div",{onMouseOver:()=>P(void 0),children:e})})(),value:n}),children:g||(0,l.jsxs)("div",{ref:R,role:"combobox","data-testid":D,className:j()("semi-select semi-select-small relative !w-full flex bg-transparent rounded-[6px]",T.Z["composite-select"],{[T.Z["composite-select-focus"]]:L,"pointer-events-auto":!u,"pointer-events-none":u,[T.Z["composite-select-error"]]:"error"===c,[T.Z["has-value"]]:!!(null==n?void 0:n.length),[T.Z["show-clear"]]:m}),onFocus:()=>{var e;z(!0),null===(e=F.current)||void 0===e||e.focus()},onBlur:p,children:[(0,l.jsxs)("div",{className:j()("relative pl-1 flex-1",{"cursor-not-allowed":d||u}),onClick:e=>{(d||u)&&(e.preventDefault(),e.stopPropagation())},children:[!k&&(null==n?void 0:n.length)?(0,l.jsx)(S,{className:j()({"opacity-60":L})}):null,(0,l.jsx)("div",{className:"h-full flex items-center",children:(0,l.jsx)(b.II,{ref:F,borderless:!0,placeholder:Z?"":i,className:j()("h-full !bg-transparent !hover:border-none !p-0.5 flex items-center",T.Z["composite-select-input-wrapper"]),disabled:d,value:k,onChange:C,size:"small"})})]}),(0,l.jsxs)("div",{className:j()("semi-select-arrow w-6 h-full right-0 flex items-center justify-center",{"cursor-not-allowed":d||u}),onClick:e=>{(d||u)&&(e.preventDefault(),e.stopPropagation())},children:[!d&&!u&&(0,l.jsx)(N.Z,{className:T.Z["select-clear"],onClick:e=>{e.preventDefault(),e.stopPropagation(),null==h||h()}}),(0,l.jsx)(f.Wdl,{className:"text-base ".concat(T.Z["select-arrow-down"])})]})]})})},Z=e=>{var{dataSource:t,disabled:n,disabledTypes:w=[],forArrayItem:j,className:b,style:N={},onChange:k,onBlur:C,value:S,placeholder:I,emptyContent:T,validateStatus:E,invalidContent:Z=c.o.t("workflow_detail_unknown_variable"),readonly:M,testId:P,showClear:L,triggerChangeWhenRename:z,renderDisplayVarName:O,customFilterVar:A,trigger:F,onPopoverVisibleChange:R,renderExtraOption:V,enableSelectNode:B=!1,popoverStyle:G,handleDataSource:W}=e,[U,H]=(0,a.useState)(""),J=(0,a.useRef)(null),q=(0,_.t)({disabledTypes:w}),K=(0,m.Z)(t||q),X=(0,x.Qq)({dataSource:K,disabledTypes:w,icon:e=>(0,s.mN)(e.value)?(0,l.jsx)(h.Z,{nodeId:e.value}):(0,l.jsx)(g.q,{size:16,alt:"logo",nodeId:e.value,className:"leading-[0px]"}),renderDisplayVarName:O,customFilterVar:A,enableSelectNode:B}),Y=(0,x.xr)(X),Q=W?W(Y):Y,$=(0,a.useCallback)(e=>{var t=null==e?void 0:e.path;if(!!Array.isArray(t)&&!(t.length<=0)&&(!!B||1!==t.length))null==k||k(t)},[B,k]),ee=(0,d.h)(S),et=S&&(null==ee?void 0:ee.viewMeta)?(0,r._)((0,o._)({},ee.viewMeta),{key:S.join("-")}):null,en=(0,v.Z)(e=>{var{modifyIndex:t,modifyKey:n}=e;(0,i.Z)(S)&&(S[t]=n,z&&(null==k||k(S)))});(0,u.a)({keyPath:S,onRename:en});var eo=!et||!(null==Q?void 0:Q.find(e=>e.value===(null==S?void 0:S[0]))),er=(0,v.Z)(()=>{S&&(null==k||k(S))});(0,p.Z)(()=>{er()},[eo]),(0,a.useEffect)(()=>{setTimeout(()=>{var e,t,n,o,r,l,a,i=null===(n=J.current)||void 0===n?void 0:null===(t=n.getElementsByClassName)||void 0===t?void 0:null===(e=t.call(n,"semi-tree-select-selection-TriggerSearchItem"))||void 0===e?void 0:e[0],s=null===(l=J.current)||void 0===l?void 0:null===(r=l.getElementsByClassName)||void 0===r?void 0:null===(o=r.call(l,"semi-tree-select-triggerSingleSearch-wrapper"))||void 0===o?void 0:o[0],d=null==s?void 0:null===(a=s.getElementsByTagName("input"))||void 0===a?void 0:a[0];null==i||i.addEventListener("click",()=>{var e;null==d||null===(e=d.focus)||void 0===e||e.call(d)})},0)},[J,U]);var el=(null==O?void 0:O({meta:et,path:S}))||(null==et?void 0:et.label)||(null==et?void 0:et.name);return(0,l.jsx)(y.m.Provider,{value:{value:S,dataSource:Q,query:U,setQuery:H,forArrayItem:j,invalidContent:Z,testId:P,valueSubVariableMeta:et,displayVarName:el,isUnknownValue:eo},children:(0,l.jsx)("div",{ref:J,className:b,style:N,children:(0,l.jsx)(D,{renderExtraOption:V,treeData:Q,onChange:$,onBlur:C,onSelect:$,value:null!=S?S:void 0,invalidContent:Z,placeholder:I||c.o.t("workflow_detail_condition_pleaseselect"),emptyContent:T||(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(f.pFl,{fontSize:24}),(0,l.jsx)("div",{children:c.o.t("workflow_detail_node_nodata")})]}),disabled:n,readonly:M,validateStatus:E,showClear:L,onClear:()=>{null==k||k(void 0)},trigger:F,onPopoverVisibleChange:R,popoverStyle:G})})})}},479654:function(e,t,n){n.d(t,{Q:function(){return r}});var o,r=((o={}).Option="option",o.Tree="tree",o)},15326:function(e,t,n){n.d(t,{Z:function(){return l}});var o=n(184449),r=n(336383);function l(e){var{isInIDE:t}=(0,o.j1)();return t?e:(0,r.mb)(e)}},881280:function(e,t,n){n.d(t,{t:function(){return l}});var o=n(295197),r=n(336383),l=e=>{var{disabledTypes:t}=e,n=(0,o.X)();return(0,r.yU)(n,t)}},336383:function(e,t,n){n.d(t,{Qq:function(){return _},_E:function(){return b},mb:function(){return x},mk:function(){return g},oL:function(){return N},vm:function(){return y},xr:function(){return w},yU:function(){return h}});var o=n(808549),r=n(120454),l=n(473980),a=n(151064),i=n(998262),s=n(450562),d=n(664278),u=n(306215),c=n(336205),v=n(674343),p=n(740573),f=(e,t)=>{var n;return!!t.includes(e.type)||(null===(n=e.children)||void 0===n?!!void 0:!!n.length)&&e.children.map(e=>f(e,t)).includes(!0)},m=(e,t)=>{var n=s.owu.getComplement(t);return function e(t,n,a){return t.reduce((t,i)=>{if(!n(i))return t;var{children:s}=i,d=(0,l._)(i,["children"]),u=i.key;(null==a?void 0:a.value)?u="".concat(null==a?void 0:a.value,"-").concat(i.key):(null==i?void 0:i.nodeId)&&(u="".concat(i.nodeId,"-").concat(i.key));var c=(0,r._)((0,o._)({},d),{label:i.label||i.name,value:u,parent:a});return i.children&&(c.children=e(i.children,n,c)),t.push(c),t},[])}(e,e=>f(e,n))};function h(e,t){return Object.entries((0,i.Z)(e,"nodeId")).map(e=>{var n,o,r,l,a,[i,d]=e,u=m(d,t);return(null==u?void 0:u.length)?{label:null!==(a=null===(n=d[0])||void 0===n?void 0:n.nodeTitle)&&void 0!==a?a:i,value:i,isTop:!0,type:s.owu.Object,children:u,nodeId:null===(o=d[0])||void 0===o?void 0:o.nodeId,nodeType:null===(r=d[0])||void 0===r?void 0:r.nodeType,nodeTitle:null===(l=d[0])||void 0===l?void 0:l.nodeTitle}:null}).filter(Boolean)}var g=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(!e)return null;var{label:r,type:l}=e,i=0,u=r;if(n&&r){var f=String(r);(i=f.toLowerCase().indexOf(n.toLowerCase()))>=0&&(u=(0,a.jsxs)(a.Fragment,{children:[f.substring(0,i),(0,a.jsx)("span",{className:"coz-fg-hglt-yellow",children:f.substring(i,i+n.length)}),f.substring(i+n.length,f.length)]}))}return l?t&&d.N.ARRAY_TYPES.includes(l)?(0,a.jsx)(v.u,{content:c.o.t("workflow_detail_batch_item_tooltip",{name:r}),position:"left",style:{maxWidth:800,display:"block",wordBreak:"break-word"},spacing:16,autoAdjustOverflow:!1,children:(0,a.jsxs)(v.T,{spacing:4,children:[(0,a.jsxs)("span",{className:"tree-variable-select-label",children:[u,(0,a.jsx)(a.Fragment,{children:" [n]"})]}),(0,a.jsx)(p.p,{size:"xs",children:s.IuB[l]})]})}):(0,a.jsxs)(v.T,{spacing:4,children:[(0,a.jsx)("span",{"data-testid":o,className:"tree-variable-select-label",children:u}),(0,a.jsx)(p.p,{size:"xs",children:s.IuB[l]})]}):(0,a.jsx)("div",{"data-testid":o,children:u})},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[{label:u.tN[u.fK.User],value:u.fK.User,children:[],isTop:!0,type:s.owu.Object,nodeId:u.fK.User,nodeType:void 0,nodeTitle:u.tN[u.fK.User]},{label:u.tN[u.fK.App],value:u.fK.App,children:[],isTop:!0,type:s.owu.Object,nodeId:u.fK.App,nodeType:void 0,nodeTitle:u.tN[u.fK.App]},{label:u.tN[u.fK.System],value:u.fK.System,children:[],isTop:!0,type:s.owu.Object,nodeId:u.fK.System,nodeType:void 0,nodeTitle:u.tN[u.fK.System]}],n=[];return null==e||e.forEach(e=>{if((0,u.mN)(e.value)){var o=t.findIndex(t=>t.value===e.value);-1!==o&&(t[o]=e)}else n.push(e)}),[...t,...n]},_=e=>{var{dataSource:t,prevPath:n,prevNamePath:l,disabledTypes:a,icon:i,renderDisplayVarName:s,customFilterVar:d,enableSelectNode:c}=e;return t?t.length?t.filter(e=>e.isTop||(d?d({meta:e,path:[...n||[],e.key||e.value]}):e.name)).map(e=>{var t,u=[...n||[],e.key||e.value],c=[...l||[],null!==(t=e.name)&&void 0!==t?t:e.value],{label:v}=e;return s&&!e.isTop&&(v=s({meta:e,path:u})),(0,r._)((0,o._)({},e),{label:v,key:u.join("-"),path:u,namePath:c,disabled:(null==u?void 0:u.length)===1||a&&!!a.length&&a.includes(e.type)||e.disabled,icon:i&&i(e),children:_({dataSource:e.children,prevPath:u,prevNamePath:c,disabledTypes:a,renderDisplayVarName:s,customFilterVar:d})})}).filter(e=>!!(c||!e.isTop||(0,u.mN)(e.key))||(e.children||[]).length>0):[]:void 0},y=(e,t)=>{if(!(null==t?void 0:t.length))return[];for(var n,o=[],r=0,l=t.slice(0,r+1).join("-"),a=e.find(e=>e.value===l);a&&r<t.length;)o.push(a.label||a.name),r++,l=t.slice(0,r+1).join("-"),a=null===(n=a.children)||void 0===n?void 0:n.find(e=>e.value===l);return o},w=e=>e?e.map(e=>e.key&&(0,u.mN)(e.key)?(0,o._)({groupId:"global_variable"},e):e):[],j=(e,t)=>e.map(e=>{var{children:n=[],disabled:r}=e,a=(0,l._)(e,["children","disabled"]);return(0,o._)({disabled:r||e.type!==t,children:j(n,t)},a)}),b=(e,t)=>(null==e?void 0:e.length)&&t?e.map(e=>{var{children:n=[]}=e,r=(0,l._)(e,["children"]);return(0,o._)({children:j(n,t)},r)}):e,N=e=>{if(!e)return[];var t={},n=[];return e.forEach(e=>{if(e.groupId)return t[e.groupId]?t[e.groupId].push(e):t[e.groupId]=[e];n.push(e)}),Object.keys(t).reduce((e,n)=>e.concat(t[n]),[]).concat(n)}},693539:function(e,t,n){n.d(t,{m:function(){return o}});var o=e=>{switch(e){case"error":return"error";case"warning":return"warning";default:return}}},767716:function(e,t,n){n.d(t,{_:function(){return r},d:function(){return l}});var o=n(151064),r=(0,n(455069).createContext)(void 0),l=e=>{var{errors:t,children:n,onTestRunValidate:l}=e;return(0,o.jsx)(r.Provider,{value:{errors:t,onTestRunValidate:l},children:n})}},803364:function(e,t,n){n.d(t,{S:function(){return s},V:function(){return i}});var o=n(455069),r=n(458620),l=n(727914),a=n(767716),i=e=>{let t;var n,i=(0,o.useContext)(a._);if(!i)throw new l.sH(r.b.parmasValidation,"useError must be used within a ValidationProvider");var{errors:s}=i;if(!!s){if(Array.isArray(e))n=e;else n=e.split(/[\.\[\]]/).filter(Boolean).map(e=>isNaN(Number(e))?e:Number(e));var d=(t=n,s.find(e=>Array.isArray(e.path)?e.path.length===t.length&&e.path.every((e,n)=>e===t[n]):e.path===t[0]));return d?d.message:void 0}},s=()=>{var e=(0,o.useContext)(a._);if(!e)throw new l.sH(r.b.parmasValidation,"useError must be used within a ValidationProvider");var{onTestRunValidate:t}=e;return t}},577060:function(e,t,n){n.d(t,{d_:()=>o.d,VI:()=>r.V,Ce:()=>l.C,Sj:()=>d});var o=n("767716"),r=n("803364"),l=n("667141"),a=n("808549"),i=n("151064"),s=n("455069");function d(e){return t=>{var{value:n,onChange:r,context:l}=t;return(0,s.useEffect)(()=>{r&&r(n)},[]),(0,i.jsx)(o.d,{errors:[],onTestRunValidate:e=>{var{dispose:t}=l.onFormValidate(e);return t},children:(0,i.jsx)(e,(0,a._)({},t))})}}},667141:function(e,t,n){n.d(t,{C:function(){return d}});var o=n(151064),r=n(455069),l=n(686436),a=n(994983),i=n(698707),s=n(803364),d=e=>{var{path:t,children:n,style:d,className:u,errorCompClassName:c}=e,v=(0,l.G2)(a.Yy),p=(0,l.PF)(),[f,m]=(0,r.useState)(!1),[h,g]=(0,r.useState)(!v.validatedNodeMap[p.id]),x=(0,s.V)(t),_=(0,s.S)(),y=!!x&&!h&&!f,w=(0,r.useCallback)(()=>{m(!0)},[]),j=(0,r.useCallback)(()=>{g(!1),m(!1)},[]),b=(0,r.useCallback)(()=>{g(!0)},[]);return(0,r.useEffect)(()=>{var e=_(()=>{g(!1)});return()=>{e()}},[]),(0,o.jsxs)("div",{className:u,style:d,children:["function"==typeof n?n({showError:y,onBlur:j,onChange:b,onFocus:w}):n,y?(0,o.jsx)(i.P,{feedbackText:x,className:c}):null]})}},551380:function(e,t,n){n.d(t,{c:function(){return r},i:function(){return l}});var o=n(455069),r=(0,o.createContext)({}),l=()=>(0,o.useContext)(r)},164634:function(e,t,n){n.d(t,{N:()=>es});var o,r=n("455069"),l=n("808549"),a=n("120454"),i=n("473980"),s=n("151064"),d=n("778043"),u=n("252237"),c=n.n(u),v=n("686436"),p=n("68331"),f=n("450562"),m=n("184449"),h=n("859725"),g=n("336205"),x=n("915757"),_=n("674343"),y=n("561232"),w=n("801815"),j=n("717497"),b=n("219315"),N=e=>{var{className:t,value:n,defaultValue:o,disabled:r,testId:i,onChange:d,onBlur:u,onFocus:v,placeholder:p,validateStatus:f,style:m}=e;return(0,s.jsx)(_.II,{className:c()(t,b.Z["input-string"]),"data-testid":i,disabled:r,defaultValue:o,value:n,onChange:d,onBlur:e=>null==u?void 0:u(e.target.value),onFocus:v,placeholder:p||g.o.t("workflow_detail_node_input_selectvalue"),validateStatus:f,style:(0,a._)((0,l._)({},m),{padding:"0 6px"}),size:"small"})},k=(0,w.kP)("0123456789abcdefABCDEF",8),C={[f.owu.ArrayString]:"".concat(f.IuB[f.owu.ArrayString],"_").concat(k()),[f.owu.ArrayNumber]:"".concat(f.IuB[f.owu.ArrayNumber],"_").concat(k()),[f.owu.ArrayInteger]:"".concat(f.IuB[f.owu.ArrayInteger],"_").concat(k()),[f.owu.ArrayBoolean]:"".concat(f.IuB[f.owu.ArrayBoolean],"_").concat(k()),[f.owu.ArrayObject]:"".concat(f.IuB[f.owu.ArrayObject],"_").concat(k())},S=e=>"".concat(e,"_").concat(k(),".json"),I=e=>C[e]||"".concat(f.IuB[e],"_").concat(k()),T=(e,t,n)=>{var o,r=n.filter(n=>"function"==typeof n.canHandle?n.canHandle(e,t):n.canHandle===e),{length:l}=r;return 0===r.length?(console.error("".concat(e," has no input component!")),N):null===(o=r[l-1])||void 0===o?void 0:o.component},E=n("249294"),D=n("547014");o=[{uri:C[f.owu.ArrayString],fileMatch:["".concat(C[f.owu.ArrayString],"_*.json")],schema:{type:"array",items:{type:"string"}}},{uri:C[f.owu.ArrayNumber],fileMatch:["".concat(C[f.owu.ArrayNumber],"_*.json")],schema:{type:"array",items:{type:"number"}}},{uri:C[f.owu.ArrayInteger],fileMatch:["".concat(C[f.owu.ArrayInteger],"_*.json")],schema:{type:"array",items:{type:"integer"}}},{uri:C[f.owu.ArrayBoolean],fileMatch:["".concat(C[f.owu.ArrayBoolean],"_*.json")],schema:{type:"array",items:{type:"boolean"}}},{uri:C[f.owu.ArrayObject],fileMatch:["".concat(C[f.owu.ArrayObject],"_*.json")],schema:{type:"array",items:{type:"object"}}}],j.AV.languageService.configureSchemas(o);var Z=[{canHandle:f.owu.String,component:(0,r.memo)(N)},{canHandle:f.owu.Number,component:(0,r.memo)(e=>{var{className:t,value:n,defaultValue:o,disabled:r,testId:l,onChange:a,onBlur:i,onFocus:d,placeholder:u,validateStatus:v,config:p={},style:f}=e,{min:m,max:h}=p;return(0,s.jsx)(_.k7,{className:c()(t,b.Z["input-number"]),"data-testid":l,disabled:r,defaultValue:o,value:n,onChange:a,onBlur:e=>null==i?void 0:i(e.target.value),onFocus:d,placeholder:u||g.o.t("workflow_detail_node_input_selectvalue"),validateStatus:v,style:f,min:m,max:h,size:"small",hideButtons:!0})})},{canHandle:f.owu.Integer,component:(0,r.memo)(e=>{var{className:t,value:n,defaultValue:o,disabled:r,testId:l,onChange:a,onBlur:i,onFocus:d,placeholder:u,validateStatus:v,config:p={},style:f}=e,{min:m,max:h}=p;return(0,s.jsx)(_.k7,{className:c()(t,b.Z["input-number"]),"data-testid":l,disabled:r,defaultValue:o,value:n,onChange:a,onBlur:e=>{setTimeout(()=>{null==i||i(e.target.value)},15)},onFocus:d,placeholder:u||g.o.t("workflow_detail_node_input_selectvalue"),precision:.1,validateStatus:v,style:f,min:m,max:h,size:"small",hideButtons:!0})})},{canHandle:f.owu.Boolean,component:(0,r.memo)(e=>{var{value:t,defaultValue:n,disabled:o,testId:l,onChange:a,onBlur:i,onFocus:d,placeholder:u,validateStatus:c,style:v,className:p}=e,f=null!=n?n:t,m=(0,r.useRef)(f);return(0,s.jsx)("div",{className:b.Z["input-boolean-wrapper"],children:(0,s.jsx)(_.Ph,{className:p,"data-testid":l,placeholder:u||g.o.t("workflow_detail_node_input_entervalue"),size:"small",optionList:[{label:"true",value:"true"},{label:"false",value:"false"}],showClear:!0,defaultValue:void 0!==f?JSON.stringify(f):void 0,disabled:o,validateStatus:c,onChange:e=>{if(e){var t=JSON.parse(e||"false");null==a||a(t),m.current=t}else null==a||a(null),m.current=null},onFocus:d,onBlur:()=>null==i?void 0:i(m.current),style:v})})})},{canHandle:f.owu.Time,component:(0,r.memo)(e=>{var{value:t,defaultValue:n,disabled:o,testId:l,onChange:a,onBlur:i,onFocus:d,placeholder:u,validateStatus:v,style:p,className:f}=e,m=null!=(n="string"==typeof n&&/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(n)?n:"")?n:t,h=(0,r.useRef)(m),g=e=>{null==a||a(e),h.current=e};return(0,s.jsx)(_.Mt,{className:c()(f,b.Z["input-time"]),"data-testid":l,inputStyle:{width:"100%"},type:"dateTime",size:"small",placeholder:u,defaultValue:n,value:t,disabled:o,format:"yyyy-MM-dd HH:mm:ss",validateStatus:v,onFocus:d,onChange:(e,t)=>{("string"==typeof t||void 0===t)&&g(t)},onClear:()=>{g(""),null==i||i("")},onBlur:()=>{null==i||i(h.current)},showClear:!0,style:p})})},{canHandle:e=>f.owu.isJSONInputType(e),component:(0,r.memo)(e=>{var t,{className:n,value:o,defaultValue:l,readonly:a,disabled:i,testId:d,onChange:u,onBlur:c,onFocus:v,placeholder:p,style:f,inputType:m,config:h={}}=e,g=(0,r.useRef)(null),{jsonSchema:x,onRequestInputExpand:_}=h,y=(0,r.useMemo)(()=>{if(!!x){var e=I(m);return{uri:e,fileMatch:["".concat(e,"_*.json")],schema:x}}},[x]),w=(0,r.useMemo)(()=>{var e=(null==y?void 0:y.uri)||I(m);return e?S(e):""},[y,m]);return(0,r.useEffect)(()=>{if(y){var e;return j.AV.languageService.configureSchemas(y),null===(e=g.current)||void 0===e||e.validate(),()=>{j.AV.languageService.deleteSchemas(y.uri)}}},[y]),(0,r.useLayoutEffect)(()=>{var e,t,n;null==_||_((null!==(n=null===(t=g.current)||void 0===t?void 0:null===(e=t.$view)||void 0===e?void 0:e.contentHeight)&&void 0!==n?n:0)>27)},[o,_]),(0,s.jsx)("div",{className:n,"data-testid":d,style:f,children:(0,s.jsx)(D.KU,{children:(0,s.jsx)(D.pq,{defaultValue:null!==(t=null!=o?o:l)&&void 0!==t?t:"",onChange:e=>{null==u||u(e.value)},onFocus:v,onBlur:()=>{var e;return null==c?void 0:c(null===(e=g.current)||void 0===e?void 0:e.getValue())},options:{uri:w,placeholder:p,lineWrapping:!0,theme:"coze-light",languageId:"json",editable:!i&&!a,fontSize:12,minHeight:22,maxHeight:187},extensions:[E.tk.theme({".cm-gutters":{display:"none"},"&, .cm-activeLine":{backgroundColor:"transparent !important"},".cm-line":{padding:"0 2px 0 6px !important"},".cm-content.cm-lineWrapping":{paddingTop:"5px !important"},".cm-placeholder":{color:"var(--coz-fg-dim) !important",opacity:"1 !important"}}),(0,E.jH)({parent:document.body,tooltipSpace:()=>({left:16,top:16,right:window.innerWidth-16,bottom:window.innerHeight-16})})],didMount:e=>{g.current=e,requestAnimationFrame(()=>{var t,n;null==_||_((null!==(n=null==e?void 0:null===(t=e.$view)||void 0===t?void 0:t.contentHeight)&&void 0!==n?n:0)>27)})}})})})})},{canHandle:(e,t)=>[f.owu.String,f.owu.Integer].includes(e)&&(null!=t?t:[]).length>0,component:(0,r.memo)(e=>{var{className:t,value:n,defaultValue:o,disabled:r,testId:l,onChange:a,onFocus:i,placeholder:d,validateStatus:u,style:v,config:p}=e,{optionsList:f}=p||{};return(0,s.jsx)(_.Ph,{className:c()(t),"data-testid":l,disabled:r,defaultValue:o,onChange:e=>null==a?void 0:a(e),optionList:f,value:n,onFocus:i,placeholder:d||g.o.t("workflow_detail_node_input_entervalue"),validateStatus:u,style:v,size:"small",dropdownClassName:"text-[12px]"})})}],M=e=>{var{inputType:t,componentRegistry:n=Z,config:o}=e,r=T(t,null==o?void 0:o.optionsList,n);return(0,s.jsx)(r,(0,l._)({},e),t)},P=n("9734"),L=n("34817"),z=n("206616"),O=e=>{if(!e)return[];var t=[],{rawMeta:n,content:o}=e,{fileName:r}=n||{};return Array.isArray(o)?t=o.map((e,t)=>({url:e,name:null==r?void 0:r[t],uid:(0,w.x0)()})):o&&(t=[{url:o,name:r,uid:(0,w.x0)()}]),t},A=(0,r.createContext)(void 0),F=e=>{var{value:t,inputType:n,availableFileTypes:o,onChange:l,onBlur:a,children:i}=e,d=f.owu.isArrayType(n),u=(0,z.Df)(n,o),c=[f.owu.Image,f.owu.ArrayImage,f.owu.Svg,f.owu.ArraySvg].includes(n),{upload:v,deleteFile:p,fileList:m,isUploading:h}=(0,z.Vn)({initialValue:O(t),fileType:c?"image":"object",multiple:d,accept:u}),g=(0,r.useRef)(null),x=(0,P.Z)(()=>{if(d){var e=m.reduce((e,t)=>{var{url:n,name:o}=e;return t.url&&(n.push(t.url),o.push(t.name)),{url:n,name:o}},{url:[],name:[]});null==l||l(e)}else null==l||l(m[0]);null==a||a()});return(0,L.Z)(()=>{!h&&x()},[h,m]),(0,s.jsxs)(A.Provider,{value:{triggerUpload:()=>{var e;null===(e=g.current)||void 0===e||e.click()},fileList:m,multiple:d,handleDelete:p,isImage:c,isUploading:h},children:[i,(0,s.jsx)("input",{ref:g,className:"hidden",type:"file",multiple:d,accept:u,onChange:e=>{var{files:t}=e.target;Object.values(t||{}).forEach(e=>{v(e)})}})]})},R=()=>(0,r.useContext)(A)||{},V=e=>{var{isImage:t}=e;return(0,s.jsx)(_.zx,{className:"coz-fg-primary font-normal h-[20px]",color:"primary",size:"small",icon:(0,s.jsx)(x.Isu,{}),style:{width:"100%",height:"20px",borderRadius:"var(--coze-4)"},children:t?g.o.t("imageflow_input_upload_placeholder"):g.o.t("plugin_file_upload")})},B=n("689896"),G=e=>{var{value:t,onClose:n,style:o,testId:r}=e,{concatTestId:a}=(0,f.FCD)();return(0,s.jsx)(_.Vp,{size:"mini",closable:!0,color:"primary",onClose:(e,t)=>n(t),className:"w-full max-w-full min-w-[65%] overflow-hidden",visible:!0,style:(0,l._)({padding:"0 4px 0 1px",height:20},o),children:(0,s.jsx)("div",{className:"flex w-0 grow overflow-hidden",children:(0,s.jsxs)("div",{className:"flex min-w-0 grow gap-[2px] items-center","data-testid":a(null!=r?r:"","file-tag"),children:[(0,s.jsx)(B.a,{iconStyle:{borderRadius:"var(--coze-3)"},file:t,size:18}),(0,s.jsx)("div",{className:c()("coz-fg-primary text-[12px] flex-1 truncate font-medium"),children:t.name})]})})})},W=()=>{var{fileList:e,triggerUpload:t,isImage:n,handleDelete:o}=R(),r=!!e[0];return(0,s.jsx)("div",{className:c()("w-full h-full flex items-center",{"cursor-pointer":!r}),onClick:()=>t(),children:(0,s.jsxs)("div",{className:"flex flex-row flex-wrap gap-0.5 w-full h-full",children:[r?e.map(e=>(0,s.jsx)(G,{value:e,onClose:t=>{t.stopPropagation(),o(e.uid)}})):null,(0,s.jsx)(V,{isImage:n})]})})},U=n("44172"),H=n("171104"),J=e=>{var{file:t}=e,[n,o]=(0,r.useState)(!1);return(0,s.jsx)(s.Fragment,{children:n?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center",style:{width:225,height:125},children:[(0,s.jsx)(U.Vxy,{className:"w-8 coz-fg-dim"}),(0,s.jsx)("div",{className:"mt-1 coz-fg-primary text-sm font-medium",children:g.o.t("inifinit_list_load_fail")})]}):(0,s.jsx)("div",{className:c()("flex flex-col items-center justify-center rounded-lg overflow-hidden",n?"cursor-default":"cursor-zoom-in"),style:{minWidth:100,minHeight:75,background:"rgba(46, 46, 56, 0.08)"},children:(0,s.jsx)(_.Ee,{className:c()("object-contain object-center rounded-sm w-full h-full"),imgStyle:{maxWidth:400,maxHeight:300},src:null==t?void 0:t.url,onLoad:()=>{o(!1)},onError:()=>{o(!0)}})})})},q=e=>{var{file:t,children:n}=e,o=(0,z.mD)(null==t?void 0:t.name);return z.XF.includes(o)?(0,s.jsx)(_.J2,{position:"top",className:H.Z["img-popover-content"],showArrow:!0,content:(0,s.jsx)(J,{file:t}),children:n}):(0,s.jsx)(s.Fragment,{children:n})},{Text:K}=_.ZT,X=()=>{var{fileList:e,triggerUpload:t,handleDelete:n,isImage:o}=R(),r=e[0];return(0,s.jsx)(q,{file:r,children:(0,s.jsx)("div",{className:c()("w-full h-full flex items-center",{"cursor-pointer":!r}),onClick:()=>{!r&&t()},children:r?(0,s.jsx)(G,{value:r,onClose:e=>{n(r.uid),e.stopPropagation()}}):(0,s.jsx)(V,{isImage:o})})})},Y=e=>{var{onUploadChange:t}=e,{multiple:n,isUploading:o}=R();return(0,r.useEffect)(()=>{null==t||t(o)},[o]),(0,s.jsx)("div",{className:c()("w-full pl-0.5",n?"h-full":"h-5"),children:n?(0,s.jsx)(W,{}):(0,s.jsx)(X,{})})},Q=e=>{var{value:t,onChange:n,onBlur:o,inputType:r,availableFileTypes:l,onUploadChange:a}=e;return(0,s.jsx)(F,{inputType:r,availableFileTypes:l,value:t,onChange:n,onBlur:o,children:(0,s.jsx)(Y,{onUploadChange:a})})},$=n("864570"),ee=e=>{var{name:t,onClose:n}=e;return(0,s.jsx)(_.Vp,{size:"mini",closable:!!n,onClose:n,className:c()("max-w-full min-w-[65%] overflow-hidden w-full"),style:{height:20},color:"primary",children:(0,s.jsx)("div",{className:c()("block w-full overflow-hidden",{"text-[12px] coz-fg-primary font-medium":!0}),children:t})})},et=e=>{var{onClick:t}=e;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"w-full relative",children:(0,s.jsxs)("div",{className:c()("p-1 flex items-center cursor-pointer hover:coz-mg-primary active:coz-mg-primary-pressed h-6 rounded-[4px] coz-mg-primary"),children:[(0,s.jsx)(_.qE,{style:{width:"16px",height:"16px"},shape:"square",size:"extra-extra-small",src:$}),(0,s.jsx)("div",{className:"flex-1 ml-1 truncate text-xs",onClick:t,children:g.o.t("workflow_variable_select_voice")})]})})})},en=n("724847"),eo=e=>(0,s.jsx)(_.u,{content:g.o.t("workflow_250310_14",void 0,"使用新增节点变量配置对象结构,此时无法输入"),children:(0,s.jsx)("div",{className:"w-0 grow coz-fg-primary text-xs truncate",style:{height:"20px",lineHeight:"20px",padding:"0 4px 0 2px",margin:"0 2px 0 2px"},children:g.o.t("workflow_250310_15",void 0,"通过添加子节点进行配置")})}),er=n("551380");f.YX3.LITERAL,f.YX3.REF,f.YX3.REF,f.YX3.LITERAL;var el={width:"100%",height:"100%"},ea=n("455308"),ei=e=>{var t,n,{className:o,value:i,onChange:d,onBlur:u,disabled:v,variablesDatasource:p,inputType:h=f.owu.String,availableFileTypes:w=[],validateStatus:j,invalidContent:b,style:N,literalStyle:k,readonly:C,testId:S,disabledTypes:I,optionFilter:T,literalDisabled:E=!1,refDisabled:D=!1,showClear:Z=!1,hideDeleteIcon:P=!1,hideSettingIcon:L=!1,enableSelectNode:z=!1,renderDisplayVarName:O,customFilterVar:A,literalConfig:F={},refTagColor:R,placeholder:V,inputPlaceholder:B,variableTagStyle:G,handleDataSource:W,variableTypeConstraints:U}=e,{concatTestId:H}=(0,f.FCD)(),J=(0,r.useRef)(null),q=(0,r.useCallback)(e=>{d({type:f.YX3.LITERAL,content:null!=e?e:void 0})},[d]),K=(0,r.useCallback)(e=>{d({type:f.YX3.LITERAL,content:(null==e?void 0:e.url)||"",rawMeta:{fileName:null==e?void 0:e.name,type:h}})},[d]),[X,Y]=(0,r.useState)(!1),$=()=>Y(!0),ei=()=>{Y(!1),null==u||u()},es=!!i&&f.nZF.isRef(i)&&!!(null===(t=i.content)||void 0===t?void 0:t.keyPath),ed=(0,r.useMemo)(()=>!!i&&f.nZF.isLiteral(i)&&f.owu.isJSONInputType(h),[i,h]),[eu,ec]=(0,r.useState)(!1),ev=(i&&!f.nZF.isEmpty(i)&&f.nZF.isLiteral(i)||eu)&&f.owu.isArrayType(h)&&f.owu.isFileType(h)&&h!==f.owu.ArrayVoice,ep=ed&&(null===(n=String(null==i?void 0:i.content))||void 0===n?void 0:n.includes("\n")),[ef,em]=(0,r.useState)(!1),eh=f.owu.isVoiceType(h)&&!!i&&f.nZF.isLiteral(i)&&i.content,{renderVariableSelectorExtraOption:eg,selectVoiceModal:ex,voiceSelector:e_}=function(e){var t,{inputType:n=f.owu.String,onChange:o,disabled:r,value:l,validateStatus:a,onBlur:i}=e,{spaceId:d}=(0,m.j1)(!1),{open:u,modal:c}=(0,en.PF)({spaceId:d,onSelectVoice:e=>{null==o||o({type:f.YX3.LITERAL,content:(null==e?void 0:e.voice_id)||"",rawMeta:{fileName:null==e?void 0:e.voice_name,type:f.owu.Voice}})}});return{renderVariableSelectorExtraOption:(e,t)=>f.owu.isVoiceType(n)?(0,s.jsx)(et,{onClick:()=>{u(),null==t||t.hiddenPopover()}}):null,selectVoiceModal:c,voiceSelector:(0,s.jsx)(_.Ph,{borderless:!0,emptyContent:null,triggerRender:()=>{var e;return(0,s.jsx)("div",{className:"cursor-pointer w-full overflow-hidden flex items-center justify-between pl-[4px]",style:{fontSize:12,color:"var(--semi-color-text-2)"},onClick:()=>{r||u()},children:(null==l?void 0:l.content)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ee,{name:null==l?void 0:null===(e=l.rawMeta)||void 0===e?void 0:e.fileName}),(0,s.jsx)(_.hU,{onClick:e=>{e.stopPropagation(),null==o||o(void 0)},color:"secondary",size:"small",icon:(0,s.jsx)(x.dVD,{})})]}):g.o.t("workflow_variable_select_voice")})},disabled:r,onBlur:i,value:null==l?void 0:null===(t=l.rawMeta)||void 0===t?void 0:t.fileName,placeholder:g.o.t("workflow_variable_select_voice"),validateStatus:a,size:"small",style:{width:"100%"}})}}({inputType:h,onChange:d,onBlur:u,disabled:v,validateStatus:j,value:i}),ey=()=>f.owu.isVoiceType(h)?e_:f.owu.isFileType(h)?(0,s.jsx)(Q,{value:i,inputType:h,availableFileTypes:w,onChange:K,onUploadChange:e=>ec(e),onBlur:u}):(0,s.jsx)(M,{className:c()(ea.Z["literal-value-input"],{"pb-[24px]":ep||f.owu.isJSONInputType(h)&&ef}),testId:H(null!=S?S:"","literal-input"),readonly:C,disabled:v,value:null==i?void 0:i.content,inputType:h,onBlur:ei,onFocus:$,onChange:q,config:(0,a._)((0,l._)({},F),{onRequestInputExpand:ed?em:void 0}),style:k,placeholder:null!=B?B:g.o.t("workflow_241015_01")}),{renderVariableSelect:ew,renderVariableDisplay:ej}=(0,y.HQ)({value:i,onChange:d,onBlur:u,disabled:v,variablesDataSource:p,validateStatus:j,readonly:C,testId:S,disabledTypes:I,showClear:Z,invalidContent:b,renderDisplayVarName:O,customFilterVar:A,setFocused:Y,style:el,refTagColor:R,hideDeleteIcon:P,variableTagStyle:G,optionFilter:T,renderExtraOption:eg,enableSelectNode:z,handleDataSource:W,popoverStyle:J.current?{minWidth:Math.max(J.current.clientWidth,130)}:void 0,variableTypeConstraints:U}),eb=(0,r.useMemo)(()=>c()(o,"flex items-start border border-solid bg-transparent max-w-[100%] py-[1px]",{"semi-input-wrapper-error":"error"===j,"coz-stroke-plus":"error"!==j,"!bg-transparent":X,"!coz-stroke-hglt":X&&"error"!==j,"pointer-events-none":C},"hover:coz-mg-primary-hovered",ep||ev||ef?"h-full":"h-[24px]",ea.Z["value-expression-input-wrap-new"],"semi-input-wrapper semi-input-wrapper-small"),[o,j,X,C,ea.Z,ep,ev,ef]);return i&&f.nZF.isObjectRef(i)?(0,s.jsx)("div",{className:eb,style:N,ref:J,children:(0,s.jsx)(eo,{})}):(0,s.jsx)(er.c.Provider,{value:{testId:S},children:(0,s.jsxs)("div",{className:eb,style:N,ref:J,children:[(0,s.jsx)("div",{className:"ref-wrapper flex-1 flex w-full h-full items-center overflow-hidden",children:D||!E||es?(0,s.jsx)("div",{className:ea.Z["input-wrapper"],children:(()=>{if(eh){var e;return ew((0,s.jsx)("div",{className:c()("cursor-pointer w-full overflow-hidden flex items-center pl-0.5"),children:(0,s.jsx)(ee,{name:(null==i?void 0:null===(e=i.rawMeta)||void 0===e?void 0:e.fileName)||(null==i?void 0:i.content),onClose:()=>null==d?void 0:d(void 0)})}))}return es?ej():ey()})()}):ew((0,s.jsx)("div",{className:"cursor-pointer w-full h-full overflow-hidden flex items-center px-1",children:(0,s.jsx)("p",{className:"text-[12px] text-[var(--coz-fg-secondary)] pointer-events-none whitespace-nowrap",children:V||g.o.t("workflow_variable_ref_placeholder")})}))}),D||L?null:(0,s.jsx)("div",{className:c()(ea.Z["setting-button-wrap"],"flex-none leading-none",{[ea.Z["pos-absolute"]]:ed,[ea.Z["self-end"]]:ev}),children:ew((0,s.jsx)(_.hU,{color:"secondary",size:"small",icon:(0,s.jsx)(x.nwG,{className:"coz-fg-primary text-sm"}),"data-testid":H(null!=S?S:"","variable-trigger")}))}),ex]})})},es=(0,r.memo)(e=>{var t,n,{className:o,inputType:u,inputTypes:g=[],onChange:x,style:_,forbidTypeCast:y,defaultInputType:w}=e,j=(0,i._)(e,["className","inputType","inputTypes","onChange","style","forbidTypeCast","defaultInputType"]),b=(0,v.PF)(),N=(0,m.M9)(),{concatTestId:k}=(0,f.FCD)(),{value:C,readonly:S,disabled:I,disabledTypes:T,testId:E}=j,D=g.concat(null!=u?u:[]),[Z,M]=(0,r.useState)(),P=()=>{if(Z)return Z;var e=void 0;if((null==C?void 0:null===(t=C.rawMeta)||void 0===t?void 0:t.type)&&(e=C.rawMeta.type),!e&&C&&f.nZF.isRef(C)){var t,n,o,r=null===(n=N.getViewVariableByKeyPath(null===(o=C.content)||void 0===o?void 0:o.keyPath,{node:b,checkScope:!0}))||void 0===n?void 0:n.type;r&&!(null==T?void 0:T.includes(r))&&(e=r)}if(!e&&w&&(e=w),!e){var l=f.owu.getComplement(null!=T?T:[]);e=(null==l?void 0:l[0])||(null==D?void 0:D[0])||f.owu.String}return(null==D?void 0:D.length)?D.includes(e)?e:D[0]:e},L=(0,r.useMemo)(()=>P(),[C,D,T,Z]),z=(0,r.useMemo)(()=>(null==D?void 0:D.length)?f.owu.getComplement(D):T,[D,T]),O=e=>{if(!!e){var t,n=f.owu.isJSONInputType(e)?f.owu.isArrayType(e)?"[]":"{}":void 0;!C||"type"in C&&(null===(t=Object.keys(C))||void 0===t?void 0:t.length)===1?n?(M(void 0),x({type:f.YX3.LITERAL,content:n,rawMeta:{type:e}})):M(e):(M(void 0),f.nZF.isRef(C)&&x((0,a._)((0,l._)({},C),{rawMeta:(0,a._)((0,l._)({},null==C?void 0:C.rawMeta),{type:e})})),f.nZF.isLiteral(C)&&x({type:f.YX3.LITERAL,content:n,rawMeta:(0,a._)((0,l._)({},C.rawMeta),{type:e})}))}},[A,F]=(0,r.useState)();(0,r.useEffect)(()=>{if(!C||f.nZF.isEmpty(C)){F(void 0);return}if(f.nZF.isRef(C)){var e,t;F(null===(e=N.getViewVariableByKeyPath(null===(t=C.content)||void 0===t?void 0:t.keyPath,{node:b,checkScope:!0}))||void 0===e?void 0:e.type)}},[C]);var R=C&&f.nZF.isRef(C)&&null!==(n=null==C?void 0:null===(t=C.content)||void 0===t?void 0:t.keyPath)&&void 0!==n?n:[];(0,p.S)({keyPath:R,onTypeChange:e=>{var{variableMeta:t}=e;F(null==t?void 0:t.type),(null==t?void 0:t.type)&&t.type!==L&&O(t.type)}});var V=(0,r.useMemo)(()=>{var e=f.owu.getComplement((0,d.Z)([...null!=T?T:[],...null!=z?z:[]]));return C&&(f.nZF.isRef(C)||j.literalDisabled)&&y||e.length<=1},[T,z,y,C,j.literalDisabled]),B=V||A&&D.length&&!D.includes(A);return(0,s.jsxs)("div",{className:c()("typed-value-expression-input flex items-start w-full",o),style:_,children:[(0,s.jsx)("div",{className:ea.Z["variable-type-selector-wrapper"],children:(0,s.jsx)(h.j,{readonly:S,disabled:I,value:L,contentClassName:"h-full",onChange:O,disabledTypes:T,testId:k(null!=E?E:"","variable-type-selector"),hiddenTypes:z,disableDropdown:V,refVariableType:B?void 0:A})}),(0,s.jsx)(ei,(0,a._)((0,l._)({},j),{onChange:e=>{if(M(void 0),!e||f.nZF.isEmpty(e)){x(e?(0,a._)((0,l._)({},e),{rawMeta:(0,a._)((0,l._)({},null==e?void 0:e.rawMeta),{type:L})}):e);return}var t=L;if(f.nZF.isRef(e)){var n,o,r,i=null===(o=N.getViewVariableByKeyPath(null===(r=e.content)||void 0===r?void 0:r.keyPath,{node:b,checkScope:!0}))||void 0===o?void 0:o.type;i&&(!(null==D?void 0:D.length)||D.includes(i))&&(t=i)}x((0,a._)((0,l._)({},e),{rawMeta:(0,a._)((0,l._)({},e.rawMeta),{type:t})})),null==j||null===(n=j.onBlur)||void 0===n||n.call(j)},inputType:L,variableTypeConstraints:B?{mainType:L,subType:f.owu.isFileType(L)?j.availableFileTypes:void 0}:void 0}))]})})},591273:function(e,t,n){n.d(t,{Z:function(){return y},q:function(){return j}});var o,r=n(808549),l=n(151064),a=n(455069),i=n(252237),s=n.n(i),d=n(465729),u=n(306215),c=n(886829),v=n(450562),p=n(336205),f=n(915757),m=n(674343),h=n(486264),g=n(213635),x=n(551380),_=n(455308);var y=((o={}).Primary="primary",o.Green="green",o),w={primary:["coz-fg-dim","coz-fg-primary"],green:["coz-fg-hglt-green-dim","coz-fg-hglt-green"]},j=e=>{var t,n,o,i,y,j,b,{onClose:N,value:k,closable:C=!0,style:S,tagColor:I="primary",variableTypeConstraints:T,readonly:E}=e,D=(0,d.h)(null===(n=k.content)||void 0===n?void 0:n.keyPath),Z=(null==D?void 0:null===(o=D.keyPath)||void 0===o?void 0:o.length)===1,{testId:M}=(0,x.i)(),{concatTestId:P}=(0,v.FCD)(),L=(0,a.useMemo)(()=>{if(!!T){var e,t,n=[T.mainType,...null!==(t=T.subType)&&void 0!==t?t:[]].filter(Boolean),o=null==D?void 0:null===(e=D.viewMeta)||void 0===e?void 0:e.type;return!(null==n?void 0:n.length)||!o||n.includes(o)?"":p.o.t("workflow_var_type_same",{type:v.IuB[T.mainType]})}},[D,T]);if(!D)return(0,l.jsx)(m.Vp,{className:s()("w-full max-w-full min-w-[65%] overflow-hidden pointer-events-auto",_.Z["undefined-ref-tag"]),color:"yellow",closable:!E&&C,onClose:N,visible:!0,style:(0,r._)({height:20,padding:"0 4px 0 2px"},S),children:(0,l.jsxs)("div",{className:"flex min-w-0 grow gap-[2px] items-center text-[12px] font-medium coz-fg-hglt-yellow",children:[(0,l.jsx)(f.L03,{className:"text-[14px]"}),(0,l.jsx)("span",{children:p.o.t("workflow_variable_undefined")})]})});var z=null==D?void 0:D.node,O=null==z?void 0:z.getData(c.m),A=null==O?void 0:O.getNodeData(),[F,R]=w[I],V=z&&new v.m_1(z),B=(0,u.hw)(D.globalVariableKey);return(0,l.jsx)(m.J2,{style:{maxWidth:280,padding:"7px 8px",border:"1px solid var(--coz-stroke-plus)",background:"var(--coz-bg-max)",boxShadow:"0px 8px 24px 0px rgba(0, 0, 0, 0.04), 0px 4px 12px 0px rgba(0, 0, 0, 0.08)",borderRadius:8,pointerEvents:"none"},position:"top",content:(0,l.jsxs)("div",{className:"flex flex-col gap-[6px]  text-[12px]",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-center font-medium leading-4 overflow-hidden text-ellipsis",children:[D.globalVariableKey?(0,l.jsx)("span",{className:"flex text-[13px]",children:(0,l.jsx)(h.Z,{nodeId:D.globalVariableKey})}):(0,l.jsx)(g.f,{icon:(null==V?void 0:V.icon)||(null==A?void 0:A.icon),size:14}),(0,l.jsx)("span",{className:"coz-fg-secondary truncate ml-1",children:(null==V?void 0:V.title)||(null==A?void 0:A.title)||B}),(0,l.jsx)("span",{className:"coz-fg-secondary mx-0.5",style:{transform:"scaleX(0.6)"},children:"-"}),(0,l.jsx)("span",{className:"text-[#000000] truncate",children:null===(i=D.viewMeta)||void 0===i?void 0:i.name}),(null===(y=D.viewMeta)||void 0===y?void 0:y.required)?(0,l.jsx)("span",{style:{color:"var(--light-usage-danger-color-danger,#f93920)"},children:"*"}):null,(null===(j=D.viewMeta)||void 0===j?void 0:j.type)?(0,l.jsx)("span",{className:"coz-fg-primary coz-mg-primary text-[10px] leading-4 inline-block ml-1 px-[3px] rounded-mini",children:v.IuB[D.viewMeta.type]}):null]}),(null===(b=D.viewMeta)||void 0===b?void 0:b.description)?(0,l.jsx)("div",{className:"coz-fg-secondary font-normal leading-4 line-clamp-5",children:D.viewMeta.description}):null,L?(0,l.jsx)("div",{className:"coz-fg-hglt-yellow font-normal leading-4",children:L}):null]}),children:(0,l.jsx)(m.Vp,{size:"mini",closable:!E&&C,onClose:N,className:"w-full max-w-full min-w-[65%] overflow-hidden pointer-events-auto",color:I,visible:!0,style:(0,r._)({height:20,padding:"0 4px 0 1px"},S,L?{backgroundColor:"var(--coz-mg-hglt-secondary-yellow)"}:{}),children:(0,l.jsx)("div",{className:"flex w-0 grow overflow-hidden",children:(0,l.jsxs)("div",{className:s()("flex min-w-0 grow",{"items-center":!0}),"data-testid":P(null!=M?M:"","ref-value-tag"),children:[(0,l.jsxs)(l.Fragment,{children:[D.globalVariableKey?(0,l.jsx)("span",{className:"flex text-[15px]",children:(0,l.jsx)(h.Z,{nodeId:D.globalVariableKey})}):(0,l.jsx)(g.f,{icon:(null==V?void 0:V.icon)||(null==A?void 0:A.icon)}),(0,l.jsx)("span",{className:"coz-fg-secondary truncate ml-0.5 text-[12px] font-medium",children:(null==V?void 0:V.title)||(null==A?void 0:A.title)||B}),(0,l.jsx)("span",{className:s()("coz-fg-secondary mx-0.5 text-[12px] font-medium",{hidden:Z}),style:{transform:"scaleX(0.6)"},children:"-"})]}),(0,l.jsx)("div",{className:s()(R,"flex-1 truncate font-medium",{"text-[12px]":!0,hidden:Z}),children:null===(t=D.viewMeta)||void 0===t?void 0:t.name})]})})})})}},859725:function(e,t,n){n.d(t,{j:()=>T});var o,r,l,a,i,s=n("808549"),d=n("120454"),u=n("151064"),c=n("455069"),v=n("252237"),p=n.n(v),f=n("450562"),m=n("336205"),h=n("915757"),g=n("674343"),x=n("839974"),_=n("854586"),y=e=>{var t,{type:n,label:o,display:r,parentPath:l}=e;if(o)t=o;else if(f.owu.isArrayType(n)){var a=f.owu.getArraySubType(n);t=f.IuB[a]}else t=f.IuB[n];return{value:Number(n),label:t,display:r||o||f.IuB[n],path:[...null!=l?l:[],n]}},w="divider";var j=[y({type:f.owu.String}),y({type:f.owu.Integer}),y({type:f.owu.Number}),y({type:f.owu.Boolean}),y({type:f.owu.Time}),y({type:f.owu.Object}),{value:"$array-category",label:"Array",children:(r="$file-array-category",l=(o=["$array-category"]).concat(r),[y({type:f.owu.ArrayString,parentPath:o}),y({type:f.owu.ArrayInteger,parentPath:o}),y({type:f.owu.ArrayNumber,parentPath:o}),y({type:f.owu.ArrayBoolean,parentPath:o}),y({type:f.owu.ArrayTime,parentPath:o}),y({type:f.owu.ArrayObject,parentPath:o}),{value:r,label:"File",children:[y({type:f.owu.ArrayFile,label:"Default",display:"Array<File>",parentPath:l}),w,y({type:f.owu.ArrayImage,parentPath:l}),y({type:f.owu.ArraySvg,parentPath:l}),w,y({type:f.owu.ArrayAudio,parentPath:l}),y({type:f.owu.ArrayVideo,parentPath:l}),w,y({type:f.owu.ArrayDoc,parentPath:l}),y({type:f.owu.ArrayPpt,parentPath:l}),y({type:f.owu.ArrayExcel,parentPath:l}),y({type:f.owu.ArrayTxt,parentPath:l}),y({type:f.owu.ArrayCode,parentPath:l}),w,y({type:f.owu.ArrayZip,parentPath:l})]}])},{value:"$file-category",label:"File",children:(a=["$file-category"],i=(0,x.L)(),[y({type:f.owu.File,label:"Default",display:"File",parentPath:a}),w,y({type:f.owu.Image,parentPath:a}),y({type:f.owu.Svg,parentPath:a}),w,y({type:f.owu.Audio,parentPath:a}),y({type:f.owu.Video,parentPath:a}),i["bot.automation.start_support_voice"]&&i["bot.studio.library_voice_resource"]?y({type:f.owu.Voice}):null,w,y({type:f.owu.Doc,parentPath:a}),y({type:f.owu.Ppt,parentPath:a}),y({type:f.owu.Excel,parentPath:a}),y({type:f.owu.Txt,parentPath:a}),y({type:f.owu.Code,parentPath:a}),w,y({type:f.owu.Zip,parentPath:a})].filter(e=>!!e))}],b=(e,t)=>{for(var{disabledTypes:n=[],hiddenTypes:o=[],level:r}=t||{},l=e.reduce((e,l)=>{if(l===w)return[...e,w];var a,i=(0,s._)({},l);i.children&&(i.children=b(i.children,t));var u=o.some(e=>e===i.value)||(null===(a=i.children)||void 0===a?void 0:a.length)===0||r&&r>=1&&f.owu.isFileType(i.value),c=!!((null==n?void 0:n.includes(Number(i.value)))||r&&r>=3&&_.Yt.includes(Number(i.value)));return u?e:[...e,(0,d._)((0,s._)({},i),{disabled:c})]},[]);l[0]===w;)l.shift();for(;l[l.length-1]===w;)l.pop();return l},N=e=>b(j,e),k=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=[...n];return t.forEach(t=>{if(t!==w){if(t.children){var n=k(e,t.children,[...o,t.value]);if(n[n.length-1]===e){o=n;return}}else if(t.value===e){o.push(e);return}}}),o},C=n("569502"),S={[C.ow.String]:(0,u.jsx)(h.ls7,{}),[C.ow.Integer]:(0,u.jsx)(h.jLw,{}),[C.ow.Boolean]:(0,u.jsx)(h.WbN,{}),[C.ow.Number]:(0,u.jsx)(h.j$I,{}),[C.ow.Object]:(0,u.jsx)(h.nCh,{}),[C.ow.Image]:(0,u.jsx)(h.Q2$,{}),[C.ow.File]:(0,u.jsx)(h.Nxk,{}),[C.ow.Doc]:(0,u.jsx)(h.Nxk,{}),[C.ow.Code]:(0,u.jsx)(h.Nxk,{}),[C.ow.Ppt]:(0,u.jsx)(h.Nxk,{}),[C.ow.Txt]:(0,u.jsx)(h.Nxk,{}),[C.ow.Excel]:(0,u.jsx)(h.Nxk,{}),[C.ow.Audio]:(0,u.jsx)(h.Nxk,{}),[C.ow.Zip]:(0,u.jsx)(h.Nxk,{}),[C.ow.Video]:(0,u.jsx)(h.Nxk,{}),[C.ow.Svg]:(0,u.jsx)(h.Q2$,{}),[C.ow.Voice]:(0,u.jsx)(h.e17,{}),[C.ow.Time]:(0,u.jsx)(h.kSS,{}),[C.ow.ArrayString]:(0,u.jsx)(h.mcR,{}),[C.ow.ArrayInteger]:(0,u.jsx)(h.TeG,{}),[C.ow.ArrayBoolean]:(0,u.jsx)(h.m5O,{}),[C.ow.ArrayNumber]:(0,u.jsx)(h.VNw,{}),[C.ow.ArrayObject]:(0,u.jsx)(h.yRc,{}),[C.ow.ArrayImage]:(0,u.jsx)(h.quZ,{}),[C.ow.ArrayFile]:(0,u.jsx)(h.ew7,{}),[C.ow.ArrayDoc]:(0,u.jsx)(h.ew7,{}),[C.ow.ArrayCode]:(0,u.jsx)(h.ew7,{}),[C.ow.ArrayPpt]:(0,u.jsx)(h.ew7,{}),[C.ow.ArrayTxt]:(0,u.jsx)(h.ew7,{}),[C.ow.ArrayExcel]:(0,u.jsx)(h.ew7,{}),[C.ow.ArrayAudio]:(0,u.jsx)(h.ew7,{}),[C.ow.ArrayZip]:(0,u.jsx)(h.ew7,{}),[C.ow.ArrayVideo]:(0,u.jsx)(h.ew7,{}),[C.ow.ArraySvg]:(0,u.jsx)(h.quZ,{}),[C.ow.ArrayVoice]:(0,u.jsx)(h.ew7,{}),[C.ow.ArrayTime]:(0,u.jsx)(h.rYO,{})},I=n("784320");function T(e){var{value:t,onChange:n,onFocus:o,onBlur:r,level:l,readonly:a,disabled:i,disabledTypes:v=[],hiddenTypes:x=[],validateStatus:_,testId:y,contentClassName:b,contentStyle:C,disableDropdown:T,children:E,refVariableType:D}=e,Z=(0,c.useMemo)(()=>N({disabledTypes:v,hiddenTypes:x,level:l}),[v,x,l]),M=(0,c.useMemo)(()=>k(t,j),[t]),P=e=>{null==n||n(e)},L=(0,c.useMemo)(()=>T||!D||D===t?"":m.o.t("workflow_refer_var_type_same",{type:f.IuB[D]}),[D,t,T]),z=e=>E||(0,u.jsx)("div",{className:b,style:C,children:(0,u.jsx)(g.u,{style:{pointerEvents:"none",transform:L?"translateX(-8px)":"none"},content:(0,u.jsxs)("div",{className:"flex flex-col items-start gap-[6px]",children:[(0,u.jsx)(g.ZT.Text,{size:"small",weight:500,children:f.IuB[e[e.length-1]]}),L?(0,u.jsx)(g.ZT.Text,{size:"small",className:"coz-fg-hglt-yellow",children:L}):null]}),children:(0,u.jsxs)("div",{"data-testid":y,className:p()("flex items-center gap-0.5 p-[1px] h-full ".concat(a||i||T?"cursor-auto":"cursor-pointer"),{"hover:coz-mg-secondary-hovered active:coz-mg-secondary-pressed":!T&&!i&&!a}),children:[(0,u.jsx)("span",{className:p()("coz-fg-secondary p-[2px] flex",{"coz-mg-hglt-secondary-yellow rounded-[4px]":!!L}),children:S[e[e.length-1]]}),T?null:(0,u.jsx)(h.Wdl,{className:"coz-fg-secondary"})]})})}),O=(e,t,n)=>(0,u.jsx)(g.Lt,(0,d._)((0,s._)({},n),{className:I.Z.dropdwon,clickToHide:!0,onVisibleChange:e=>{e?null==o||o():null==r||r()},motion:!1,render:(0,u.jsx)(g.Lt.Menu,{className:"min-w-[160px]",selectedKeys:[M.join("/")],children:e.map(e=>{if(e===w)return(0,u.jsx)(g.Lt.Divider,{});var t,n,o,r=(0,u.jsx)(g.Lt.Item,{showTick:!0,icon:(0,u.jsx)(h.P03,{className:"coz-fg-hglt"}),itemKey:null===(t=e.path)||void 0===t?void 0:t.join("/"),disabled:e.disabled,onClick:()=>{var t;if(null===(t=e.children)||void 0===t?!void 0:!t.length)P(e.value)},children:(null===(n=e.children)||void 0===n?void 0:n.length)?(0,u.jsxs)("div",{className:"flex items-center justify-between w-[112px]",children:[e.label,(0,u.jsx)(h.x5d,{})]}):e.label});return(null===(o=e.children)||void 0===o?void 0:o.length)?O(e.children,r,{trigger:"hover",position:"leftTop"}):r})}),children:t}));return T||i||a?z(M):O(Z,z(M),{trigger:"click",position:"bottomLeft"})}},740573:function(e,t,n){n.d(t,{p:function(){return a}});var o=n(151064),r=n(252237),l=n.n(r),a=e=>{var{children:t,className:n,size:r="default"}=e;return(0,o.jsx)("div",{className:l()({"py-[1px] px-[3px] ml-1 rounded-[4px] h-4":"xs"===r,"py-0.5 px-2 rounded-[6px] ml-2":"default"===r},"shrink-0 flex items-center coz-mg-primary",n),children:(0,o.jsx)("span",{className:l()({"text-mini":"xs"===r,"text-xs":"default"===r},"coz-fg-primary block"),children:t})})}},1334:function(e,t,n){n.d(t,{X_:()=>o.X,TF:()=>i,Dv:()=>s,EP:()=>c});var o=n("295197"),r=n("455069"),l=n("686436"),a=n("816697"),i=e=>{var{enable:t,nodeId:n}=e,o=(0,l.X2)(l.ER),i=(0,l.Dc)();(0,r.useEffect)(()=>{if(!!t&&!!n)setTimeout(()=>{var e=i.entityManager.getEntityById(n);if(!!e){var{bounds:t}=e.getData(l.VO);t.pad(30,30);var r=o.getViewport(!1),s=a.rM.fixSize(t,r);o.scrollToView({bounds:t,zoom:s,scrollToCenter:!0})}},200)},[t])},s=(e,t)=>{var n,o,r,l,a=null==t?void 0:t.input,i=a?JSON.parse(a):{};return JSON.stringify({Human:(n=e,o=i,null!==(r=null==n?void 0:n.replace(/{{(.*?)}}/g,(e,t)=>o[t.trim()]||e))&&void 0!==r?r:""),Ai:null!==(l=null==t?void 0:t.raw_output)&&void 0!==l?l:""})},d=n("825955"),u=n("382534"),c=()=>{var[e,t]=(0,r.useState)([]);return(0,r.useEffect)(()=>{function e(){return(e=(0,d._)(function*(){var e,n=yield u.MJ.ListModel();t(null!==(e=null==n?void 0:n.models)&&void 0!==e?e:[])})).apply(this,arguments)}!function(){e.apply(this,arguments)}()},[]),{vectorModellList:e}}},551386:function(e,t,n){n.d(t,{w:function(){return d}});var o=n(808549),r=n(120454),l=n(455069),a=n(686436),i=n(471583),s=n(450562),d=()=>{var e=(0,a.PF)(),t=e.getData(a.Ps),[n,d]=(0,l.useState)(t.formModel.getFormItemValueByPath("/")),[u,c]=(0,l.useState)([]);(0,l.useEffect)(()=>{var e=t.onDataChange(e=>{var t=e.formModel.getFormItemValueByPath("/");d((0,o._)({},t))});return()=>e.dispose()},[t]),(0,l.useEffect)(()=>{Object.keys(n).forEach(e=>{e.endsWith("inputParameters")&&c(n[e])})},[n]);var v=(0,a.G2)(i.b);return u.reduce((t,n)=>{var l,a,i;return n.name&&n.input?(l=n.input.type===s.YX3.LITERAL?s.owu.String:n.input.type===s.YX3.OBJECT_REF?s.owu.Object:null===(a=v.getViewVariableByKeyPath(null===(i=n.input.content)||void 0===i?void 0:i.keyPath,{node:e}))||void 0===a?void 0:a.type,t.push((0,r._)((0,o._)({},n),{type:l})),t):t},[])}},295197:function(e,t,n){n.d(t,{U:function(){return d},X:function(){return u}});var o=n(808549),r=n(455069),l=n(686436),a=n(533733),i=n(306215),s=n(360903),d=()=>{var e=(0,l.G2)(s.t),t=(0,l.G2)(l.L4),n=(0,l.JA)();return(0,r.useEffect)(()=>{var o=e.onNodesTitleChange(()=>n()),r=t.onLoaded(()=>n());return()=>{o.dispose(),r.dispose()}},[]),{nodesService:e,getNodeInfoInVariableMeta:t=>({nodeTitle:e.getNodeTitle(t),nodeId:t.id,nodeType:t.flowNodeType?String(t.flowNodeType):void 0})}},u=()=>{var e=(0,a.Z)(),{getNodeInfoInVariableMeta:t}=d();return e.map(e=>{if(!!e.viewMeta)return(0,o._)({},e.viewMeta,e.node?t(e.node):{nodeTitle:(0,i.hw)(e.globalVariableKey),nodeId:e.globalVariableKey})}).filter(Boolean)}},58946:function(e,t,n){n.d(t,{J:function(){return o},n:function(){return r}});function o(e){for(var t="";e>=0;)t=String.fromCharCode(e%26+65)+t,e=Math.floor(e/26)-1;return t}var r=e=>"branch_".concat(e)},175317:function(e,t,n){n.d(t,{S:()=>D});var o=n("151064"),r=n("455069"),l=n("686436"),a=n("362416"),i=n("336205"),s=n("915757"),d=n("674343"),u=n("340291"),c=n("184449"),v=n("1334"),p=n("706489"),f=n("680634"),m=n("125002"),h=n("766337"),g=n("332349"),x=n("450562"),_=n("808549"),y=n("120454"),w=n("471583"),j=n("793003"),b=e=>{if(!!e)return e.map(e=>{var t={name:e.name,type:e.type};return e.children&&(t.children=b(e.children)),t})},N=e=>{var{inputParams:t,workflowVariableService:n,flowNodeEntity:o}=e,r=[];return null==t||t.forEach(t=>{if((null==t?void 0:null===(l=t.input)||void 0===l?void 0:l.type)===x.YX3.OBJECT_REF)r.push({name:t.name,type:x.owu.Object,children:N((0,y._)((0,_._)({},e),{inputParams:t.children}))});else if((null==t?void 0:null===(a=t.input)||void 0===a?void 0:a.type)===x.YX3.LITERAL)r.push({name:t.name,type:(null==t?void 0:null===(d=t.input)||void 0===d?void 0:null===(s=d.rawMeta)||void 0===s?void 0:s.type)||j.t.getLiteralExpressionViewVariableType(null==t?void 0:null===(u=t.input)||void 0===u?void 0:u.content)});else if((null==t?void 0:null===(i=t.input)||void 0===i?void 0:i.type)===x.YX3.REF){var l,a,i,s,d,u,c,v=n.getViewVariableByKeyPath(null===(c=t.input.content)||void 0===c?void 0:c.keyPath,{node:o}),p=(null==v?void 0:v.type)||x.owu.String;x.owu.isFileType(p)&&(p=x.owu.String),r.push({name:t.name,type:p,children:k(null==v?void 0:v.children)})}}),r},k=e=>{if(!!e)return e.map(e=>({name:e.name,type:e.type,children:k(e.children)}))},C=e=>{var t,{inputParams:n,outputParams:o}=e,{flowNodeEntity:r}=(0,h.l)();return{parsedInput:N({inputParams:n,workflowVariableService:(0,l.G2)(w.b),flowNodeEntity:r}),parsedOutput:null!==(t=b(o))&&void 0!==t?t:[]}},S=n("497744"),I=n("555687"),T=e=>{var t,{value:n,onChange:r,onClose:i,inputParams:d,outputParams:u,outputPath:v,languageTemplates:p=g.gE}=e,m=(0,c.IE)(),{parsedInput:_,parsedOutput:y}=C({inputParams:d,outputParams:u,outputPath:v}),{flowNodeEntity:w}=(0,h.l)(),{setIsBizIDETesting:j}=(0,f.V)(),{getNodeSetterId:b}=(0,x.FCD)(),N=b("biz-editor"),k=(0,l.X2)(S.eI),T=null==w?void 0:w.getData(l.Ps).formModel,E=null==T?void 0:T.getFormItemValueByPath("/nodeMeta");return(0,o.jsx)("div",{className:I.Z.container,"data-testid":N,children:(0,o.jsx)(a.Editor,{title:null==E?void 0:E.title,readonly:k.readonly,height:"100%",width:"100%",input:_,output:y,defaultLanguage:null!==(t=g.Jr.get(null==n?void 0:n.language))&&void 0!==t?t:"typescript",defaultContent:null==n?void 0:n.code,onTestRunStateChange:e=>{j("running"===e)},onTestRun:()=>{m.showTestNodeForm()},testRunIcon:(0,o.jsx)(s.Y6z,{}),onChange:(e,t)=>{null==r||r({code:e,language:g.FV.get(t)})},onClose:i,uuid:k.workflowId,languageTemplates:p,spaceId:k.spaceId})})},E=n("283368"),D=e=>{var t,n,x,{value:_,onChange:y,inputParams:w,outputParams:j,outputPath:b,feedbackText:N,feedbackStatus:k}=e,C=(0,h.l)(),S=(0,l.PF)(),I="".concat(S.id,".code_editor"),{readonly:D}=(0,h.l)(),{isBindDouyin:Z}=(0,c.j1)(!1),{forceCloseBizIDE:M,isBizIDEOpen:P,uniqueId:L}=(0,f.V)(),{setFullscreenPanel:z}=(0,u.Tk)();(0,v.TF)({enable:P&&I===L,nodeId:S.id}),(0,r.useEffect)(()=>()=>{M()},[]);var O=(0,m.k)({isBindDouyin:Z});return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:E.Z.container,children:[(0,o.jsx)(p.E,{defaultExpand:!0,showBottomBorder:!0,header:i.o.t("workflow_detail_code_code"),tooltip:e.tooltip,maxContentHeight:218,feedbackText:N,feedbackStatus:k,noPadding:!0,children:(0,o.jsx)("div",{className:E.Z["code-content"],style:{minHeight:178},children:(0,o.jsx)(a.Previewer,{content:null!==(t=null==_?void 0:_.code)&&void 0!==t?t:"",language:null!==(x=g.Jr.get(null!==(n=null==_?void 0:_.language)&&void 0!==n?n:g.Go.NODE_JS))&&void 0!==x?x:"javascript",height:178})})}),(0,o.jsx)("div",{style:{display:"flex",position:"absolute",top:10,right:12},children:(0,o.jsx)(d.hU,{color:"highlight",size:"small",icon:D?null:(0,o.jsx)(s.ltt,{className:E.Z.editInIDEIcon}),onClick:()=>{z((0,o.jsx)(h.I.Provider,{value:C,children:(0,o.jsx)(T,{value:_,onChange:y,inputParams:w,outputParams:j,outputPath:b,languageTemplates:O,onClose:()=>z(null)})}))},children:D?i.o.t("workflow_detail_code_view_in_ide"):i.o.t("workflow_detail_code_edit_in_ide")})})]})})}},332349:function(e,t,n){n.d(t,{FV:function(){return d},Go:function(){return l},Jr:function(){return s},cU:function(){return i},gE:function(){return u},hX:function(){return a},u1:function(){return c}});var o,r=n(336205);var l=((o={})[o.NODE_JS=1]="NODE_JS",o[o.GO_LANG=2]="GO_LANG",o[o.PYTHON=3]="PYTHON",o[o.JAVA=4]="JAVA",o[o.TYPESCRIPT=5]="TYPESCRIPT",o),a={code:"".concat(r.o.t("workflow_code_js_illustrate_all"),"\n\nasync function main({ params }: Args): Promise<Output> {\n    ").concat(r.o.t("workflow_code_js_illustrate_output"),'\n    const ret = {\n        "key0": params.input + params.input, ').concat(r.o.t("workflow_code_js_illustrate_output_param"),'\n        "key1": ["hello", "world"], ').concat(r.o.t("workflow_code_js_illustrate_output_arr"),'\n        "key2": { ').concat(r.o.t("workflow_code_js_illustrate_output_obj"),'\n            "key21": "hi"\n        },\n    };\n\n    return ret;\n}'),language:5},i={code:"".concat(r.o.t("workflow_code_py_illustrate_all"),"\n\nasync def main(args: Args) -> Output:\n    params = args.params\n    ").concat(r.o.t("workflow_code_py_illustrate_output"),"\n    ret: Output = {\n        \"key0\": params['input'] + params['input'], ").concat(r.o.t("workflow_code_py_illustrate_output_param"),'\n        "key1": ["hello", "world"],  ').concat(r.o.t("workflow_code_py_illustrate_output_arr"),'\n        "key2": { ').concat(r.o.t("workflow_code_py_illustrate_output_obj"),'\n            "key21": "hi"\n        },\n    }\n    return ret'),language:3},s=new Map([[1,"javascript"],[3,"python"],[5,"typescript"]]),d=new Map([["typescript",5],["python",3],["javascript",1]]),u=[{language:"typescript",template:a.code,displayName:"JavaScript"},{language:"python",displayName:"Python",template:i.code}];u.filter(e=>"python"===e.language);var c=u.filter(e=>"python"===e.language)},766337:function(e,t,n){n.d(t,{I:function(){return r},l:function(){return l}});var o=n(455069),r=(0,o.createContext)({}),l=()=>(0,o.useContext)(r)},125002:function(e,t,n){n.d(t,{k:function(){return r},o:function(){return l}});var o=n(332349);function r(e){return o.u1}function l(e){var t,n;return(null===(n=(t=0,o.u1)[0])||void 0===n?void 0:n.language)==="python"?o.cU:o.hX}},855062:function(e,t,n){n.d(t,{_:function(){return l}});var o=n(686436),r=n(68331),l=e=>{var t,n,{data:l,onDataChange:a}=e,i=(0,o.G2)(o.L4);return(0,r.S)({keyPath:null===(n=l.left)||void 0===n?void 0:null===(t=n.content)||void 0===t?void 0:t.keyPath,onTypeChange:e=>{var{variableMeta:t}=e;if(!i.loading){if(!t){null==a||a({});return}null==a||a({left:l.left})}}}),null}},852963:function(e,t,n){n.d(t,{h:()=>eh});var o=n("808549"),r=n("120454"),l=n("151064"),a=n("455069"),i=n("450562"),s=n("336205"),d=n("915757"),u=n("674343"),c=n("706489"),v=n("172107"),p=n("297727"),f=n("252237"),m=n.n(f),h=n("686436"),g=n("68331"),x=n("471583"),_=n("473980"),y=n("994983"),w=n("698707"),j=e=>t=>{var n,{value:i,disabled:s,onChange:d,onBlur:u,validateResult:c}=t,v=(0,_._)(t,["value","disabled","onChange","onBlur","validateResult"]),{flowNodeEntity:f}=(0,p.I)(),m=(0,h.PF)(),g=(0,h.G2)(y.Yy),[x,j]=(0,a.useState)(!!g.validatedNodeMap[m.id]);return(0,a.useEffect)(()=>{if(f){var e=f.getData(h.Ps).formModel.onValidate(()=>{j(!0)});return()=>{e.dispose()}}},[f]),(0,a.useEffect)(()=>{!0===s&&j(!1)},[s]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e,(0,r._)((0,o._)({},v),{disabled:s,value:i,onChange:e=>{j(!0),null==d||d(e)},onBlur:()=>{j(!0),null==u||u()},validateStatus:x?null==c?void 0:c.validStatus:void 0})),x&&(null==c?void 0:c.message)?(0,l.jsx)(w.P,{feedbackStatus:null==c?void 0:c.validStatus,feedbackText:null!==(n=null==c?void 0:c.message)&&void 0!==n?n:""}):null]})},b=n("724375"),N=n("567282"),k=n("164634"),C=n("942039"),S=n("569502"),I=n("871873"),T=n("408487"),E="value";"".concat(E,".").concat("isQuote"),"".concat(E,".").concat("quotedValue"),"".concat(E,".").concat("fixedValue");var D={[T.CPf.Equal]:()=>s.o.t("workflow_detail_condition_select_equal")},Z={[T.CPf.NotEqual]:()=>s.o.t("workflow_detail_condition_select_not_equal")},M={[T.CPf.LengthGt]:()=>s.o.t("workflow_detail_condition_select_longer")},P={[T.CPf.LengthGtEqual]:()=>s.o.t("workflow_detail_condition_select_longer_equal")},L={[T.CPf.LengthLt]:()=>s.o.t("workflow_detail_condition_select_shorter")},z={[T.CPf.LengthLtEqual]:()=>s.o.t("workflow_detail_condition_select_shorter_equal")},O={[T.CPf.Contains]:()=>s.o.t("workflow_detail_condition_select_contain")},A={[T.CPf.NotContains]:()=>s.o.t("workflow_detail_condition_select_not_contain")},F={[T.CPf.Contains]:()=>s.o.t("workflow_condition_obj_contain")},R={[T.CPf.NotContains]:()=>s.o.t("workflow_condition_obj_not_contain")},V={[T.CPf.Null]:()=>s.o.t("workflow_detail_condition_select_empty")},B={[T.CPf.NotNull]:()=>s.o.t("workflow_detail_condition_select_not_empty")},G={[T.CPf.Gt]:()=>s.o.t("workflow_detail_condition_select_greater")},W={[T.CPf.GtEqual]:()=>s.o.t("workflow_detail_condition_select_greater_equal")},U={[T.CPf.Lt]:()=>s.o.t("workflow_detail_condition_select_less")},H={[T.CPf.LtEqual]:()=>s.o.t("workflow_detail_condition_select_less_equal")},J={[T.CPf.True]:()=>s.o.t("workflow_detail_condition_select_true")},q={[T.CPf.False]:()=>s.o.t("workflow_detail_condition_select_false")},K=(0,I.Z)({},D,Z,M,P,L,z,O,A,V,B),X=(0,I.Z)({},D,Z,V,B,G,W,U,H),Y=(0,I.Z)({},D,Z,V,B,G,W,U,H),Q=(0,I.Z)({},D,Z,V,B,J,q),$=(0,I.Z)({},D,Z,G,W,U,H,V,B),ee=(0,I.Z)({},F,R,V,B),et=(0,I.Z)({},M,P,L,z,O,A,V,B);(0,I.Z)({},D,Z,M,P,L,z,O,A,V,B,G,W,U,H,J,q);var en=(0,I.Z)({},B,V),eo=n("787875"),er=n("345420");function el(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];for(var[o,r]of Object.entries(e)){if(!(t.passItem&&t.passItem(o))){var l=t.computedValue?t.computedValue(o):o,a=t.i18n&&(0,er.Z)(r)?r():r;n.push({label:a,value:l})}}return n}var ea=n("426164");function ei(e){var{hidden:t,remove:n,testId:o}=e;return(0,l.jsx)("div",{children:t?null:(0,l.jsx)(u.hU,{"data-testid":o,color:"secondary",size:"small",icon:(0,l.jsx)(d.ozt,{className:"text-sm"}),onClick:n})})}var es=j(b.W),ed=j(function(e){var{value:t,onChange:n,sourceType:d,onBlur:c,validateStatus:v,testId:p}=e,{concatTestId:f}=(0,i.FCD)(),m=(0,a.useMemo)(()=>{if(d&&S.ow.isFileType(d))return el(en,{computedValue:e=>Number(e),i18n:!0});switch(d){case S.ow.ArrayBoolean:case S.ow.ArrayInteger:case S.ow.ArrayNumber:case S.ow.ArrayObject:case S.ow.ArrayString:case S.ow.ArrayTime:return el(et,{computedValue:e=>Number(e),i18n:!0});case S.ow.Object:return el(ee,{computedValue:e=>Number(e),i18n:!0});case S.ow.Boolean:return el(Q,{computedValue:e=>Number(e),i18n:!0});case S.ow.Integer:return el(Y,{computedValue:e=>Number(e),i18n:!0});case S.ow.String:return el(K,{computedValue:e=>Number(e),i18n:!0});case S.ow.Number:return el($,{computedValue:e=>Number(e),i18n:!0});case S.ow.Time:return el(X,{computedValue:e=>Number(e),i18n:!0});default:return[]}},[d]);return(0,l.jsx)(u.Ph,{"data-testid":p,size:"small",value:t,onChange:n,onBlur:c,validateStatus:v,placeholder:s.o.t("workflow_detail_condition_pleaseselect"),emptyContent:s.o.t("workflow_detail_node_nodata"),className:ea.Z.container,renderSelectedItem:e=>(0,l.jsx)(u.u,{content:e.label,children:eo.Uo[e.value]}),children:m.map(e=>(0,l.jsx)(u.Ph.Option,(0,r._)((0,o._)({},e),{"data-testid":f(p,"".concat(e.value))})))})}),eu=j(e=>{var{value:t,operator:n}=e,[i,s]=(0,a.useState)(null==t?void 0:t.type);if((0,a.useEffect)(()=>{(null==t?void 0:t.type)&&s(null==t?void 0:t.type)},[null==t?void 0:t.type]),n&&[N.CP.Null,N.CP.NotNull].includes(n))return(0,l.jsx)(u.II,{disabled:!0,value:"empty",size:"small"});if(n&&[N.CP.True,N.CP.False].includes(n))return n===N.CP.True?(0,l.jsx)(u.II,{disabled:!0,value:"true",size:"small"}):(0,l.jsx)(u.II,{disabled:!0,value:"false",size:"small"});return(0,l.jsx)(k.N,(0,r._)((0,o._)({},e),{value:null!=t?t:i?{type:i}:void 0}))}),ec=e=>({type:i.YX3.REF,content:{keyPath:e}});function ev(e){var t,n,s,d,u,c,v,f,{index:_,branchIndex:y,data:w,onDataChange:j,onDelete:b,className:N,conditionValidateResult:k,style:S,readonly:I,deletable:T}=e,{concatTestId:E}=(0,i.FCD)(),{setterPath:D}=(0,p.I)(),Z=(0,h.G2)(x.b),M=(0,h.PF)(),P=null===(t=Z.getWorkflowVariableByKeyPath(null===(s=w.left)||void 0===s?void 0:null===(n=s.content)||void 0===n?void 0:n.keyPath,{node:M}))||void 0===t?void 0:t.viewType,L=e=>t=>{var n=(0,r._)((0,o._)({},w),{[e]:t});n=(0,C.sc)(w,n,Z,M),n=(0,C.M4)(P,n),n=(0,C.bj)(w,n,Z,M),null==j||j(n)};(0,g.S)({keyPath:null===(u=w.left)||void 0===u?void 0:null===(d=u.content)||void 0===d?void 0:d.keyPath,onTypeChange:e=>{var{variableMeta:t}=e;if(!t){null==j||j({});return}null==j||j({left:w.left})}});var z=(0,C.iQ)({sourceType:P,operator:w.operator,rightValue:w.right,useCompatibleType:!0}),O=(0,a.useMemo)(()=>({inputTypes:z}),[z]);return(0,l.jsxs)("div",{className:m()("flex items-center gap-1 mb-2",N),style:S,children:[(0,l.jsx)("div",{className:"overflow-hidden",style:{flex:"0 0 44px"},children:(0,l.jsx)(ed,{sourceType:P,value:w.operator,onChange:L("operator"),validateResult:null==k?void 0:k.operator,testId:E(D,"".concat(y),"".concat(_),"operator")})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)(es,{style:{width:"100%",marginBottom:4},readonly:I,value:null===(v=w.left)||void 0===v?void 0:null===(c=v.content)||void 0===c?void 0:c.keyPath,onChange:e=>L("left")(ec(e)),validateResult:null==k?void 0:k.left,testId:E(D,"".concat(y),"".concat(_),"left")}),(0,l.jsx)(eu,(0,r._)((0,o._)({readonly:I},O),{disabled:(0,C.Wp)(w.operator),value:null===(f=JSON.parse(JSON.stringify(w)))||void 0===f?void 0:f.right,onChange:L("right"),validateResult:null==k?void 0:k.right,operator:w.operator,testId:E(D,"".concat(y),"".concat(_),"right")}))]}),I?(0,l.jsx)(l.Fragment,{}):(0,l.jsx)("div",{style:{flex:"0 0 24px"},children:(0,l.jsx)(ei,{testId:E(D,"".concat(y),"".concat(_),"item","remove"),remove:b,hidden:!T})})]})}var ep=n("264158"),ef=e=>{var{logic:t,onChange:n,showStroke:o=!1}=e;return(0,l.jsxs)("div",{className:"flex flex-col h-full",children:[(0,l.jsx)("div",{className:"flex-1 relative",children:o?(0,l.jsx)("div",{className:"absolute left-1/2 right-0 top-2.5 bottom-0 rounded-tl-lg border-solid border-0 border-t border-l coz-stroke-plus"}):null}),(0,l.jsx)(u.Ph,{className:ep.Z["condition-logic-select"],placeholder:s.o.t("workflow_detail_condition_pleaseselect"),style:{marginRight:4},value:t,size:"small",optionList:[{label:eo.s5.get(eo.Ld.AND),value:eo.Ld.AND},{label:eo.s5.get(eo.Ld.OR),value:eo.Ld.OR}],onChange:e=>n(e)}),(0,l.jsx)("div",{className:"flex-1 relative",children:o?(0,l.jsx)("div",{className:"absolute left-1/2 right-0 top-0 bottom-2.5 rounded-bl-lg border-solid border-0 border-b border-l coz-stroke-plus"}):null})]})},em=n("523287"),eh=e=>{var t,{readonly:n,expanded:a}=(0,p.I)(),{concatTestId:f}=(0,i.FCD)(),{setterPath:m}=(0,p.I)(),{index:h,branch:g,onChange:x,onDelete:_,deletable:y=!0,prefixName:w,priority:j,branchValidateResult:b,titleIcon:N,isFirstBranch:k}=e,{condition:C}=g,S=e=>t=>{var n=C.conditions.map((n,r)=>r===e?(0,o._)({},t):n);null==x||x((0,r._)((0,o._)({},g),{condition:(0,r._)((0,o._)({},C),{conditions:n})}))},I=()=>{null==_||_()},T=e=>()=>{var t=C.conditions.filter((t,n)=>n!==e);t.length?null==x||x((0,r._)((0,o._)({},g),{condition:(0,r._)((0,o._)({},C),{conditions:t})})):I()};return(0,l.jsx)(c.E,{expand:a,motion:!1,className:"coz-bg-max coz-stroke-plus border border-solid rounded-lg mb-2 !px-2 pb-2",header:(0,l.jsxs)("div",{className:"flex items-center",children:[N,w,j?(0,l.jsxs)(u.Vp,{className:"ml-2",color:"primary",children:[s.o.t("worklfow_condition_priority",{},"Priority")," ",j]}):null]}),collapsible:!1,actionButton:n?(0,l.jsx)(l.Fragment,{}):(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(u.hU,{"data-testid":f(m,"".concat(h),"branch","delete"),color:"secondary",size:"small",icon:(0,l.jsx)(d.ozt,{className:"text-sm"}),disabled:!y,onClick:I})}),portInfo:void 0,children:(0,l.jsx)("div",{children:(0,l.jsx)("div",{style:n?{pointerEvents:"none"}:{},children:(0,l.jsxs)("div",{className:"flex",children:[C.conditions.length>1&&(0,l.jsx)("div",{className:"flex-none w-[50px] mt-4 mb-12",children:(0,l.jsx)(ef,{logic:C.logic,onChange:e=>{null==x||x((0,r._)((0,o._)({},g),{condition:(0,r._)((0,o._)({},C),{logic:e})}))},showStroke:(null==C?void 0:null===(t=C.conditions)||void 0===t?void 0:t.length)>1})}),(0,l.jsxs)("div",{className:"flex-1",children:[C.conditions.map((e,t)=>(0,l.jsx)(ev,{branchIndex:h,index:t,readonly:n,deletable:!k||t>0,data:e,onDataChange:S(t),onDelete:T(t),className:em.Z.item,conditionValidateResult:null==b?void 0:b[t]},t)),(0,l.jsx)(u.hU,{wrapperClass:"ml-[48px]",size:"small",color:"highlight",onClick:()=>{var e,t;null==x||x((0,r._)((0,o._)({},g),{condition:(0,r._)((0,o._)({},C),{logic:null!==(e=C.logic)&&void 0!==e?e:v.L.AND,conditions:(null!==(t=C.conditions)&&void 0!==t?t:[]).concat([{left:void 0,operator:void 0,right:void 0}])})}))},icon:(0,l.jsx)(d.PwN,{}),"data-testid":f(m,"".concat(h),"item","add"),children:s.o.t("worklfow_condition_add_condition",{},"Add condition")})]})]})})})})}},830208:function(e,t,n){n.d(t,{i:function(){return d}});var o=n(151064),r=n(450562),l=n(336205),a=n(915757),i=n(674343),s=n(297727),d=e=>{var{readonly:t,setterPath:n}=(0,s.I)(),{concatTestId:d}=(0,r.FCD)(),{onAdd:u}=e;return(0,o.jsxs)("div",{className:"flex justify-between items-center mb-2 cursor-pointer",children:[(0,o.jsx)("div",{className:"font-semibold",children:l.o.t("worklfow_condition_condition_branch",{},"Condition branch")}),(0,o.jsx)(i.hU,{size:"small",disabled:t,onClick:t?()=>null:u,color:"highlight",icon:(0,o.jsx)(a.PwN,{className:"text-sm"}),"data-testid":d(n,"branch","add")})]})}},942039:function(e,t,n){n.d(t,{M4:function(){return m},Wp:function(){return v},bj:function(){return f},iQ:function(){return h},sc:function(){return p}});var o=n(808549),r=n(120454),l=n(473980),a=n(155440),i=n(664278),s=n(450562),d=n(408487),u=[d.CPf.Null,d.CPf.NotNull,d.CPf.True,d.CPf.False],c=[d.CPf.LengthGt,d.CPf.LengthGtEqual,d.CPf.LengthLt,d.CPf.LengthLtEqual],v=e=>!!e&&u.includes(e),p=(e,t,n,r)=>{var a,i,s,d,u,c,v=null===(a=n.getWorkflowVariableByKeyPath(null===(s=e.left)||void 0===s?void 0:null===(i=s.content)||void 0===i?void 0:i.keyPath,{node:r}))||void 0===a?void 0:a.viewType,p=null===(d=n.getWorkflowVariableByKeyPath(null===(c=t.left)||void 0===c?void 0:null===(u=c.content)||void 0===u?void 0:u.keyPath,{node:r}))||void 0===d?void 0:d.viewType,{right:f,operator:m}=t,h=(0,l._)(t,["right","operator"]);return!v&&p?h:v&&v!==p?h:(0,o._)({},t)},f=(e,t,n,r)=>{if(!t.operator)return(0,o._)({},t);var{right:a}=t,s=(0,l._)(t,["right"]);if(a&&t.operator!==e.operator){var d,c,v,p=h({rightValue:a,sourceType:null===(d=n.getWorkflowVariableByKeyPath(null===(v=t.left)||void 0===v?void 0:null===(c=v.content)||void 0===c?void 0:c.keyPath,{node:r}))||void 0===d?void 0:d.viewType,operator:t.operator,useCompatibleType:!1}),f=i.N.getValueExpressionViewType(a,n,{node:r});if(f&&!(null==p?void 0:p.includes(f)))return s}return u.includes(t.operator)?s:(0,o._)({},t)},m=(e,t)=>{var{right:n}=t,i=(0,l._)(t,["right"]);if(e!==s.owu.Boolean&&e!==s.owu.ArrayBoolean)return(0,o._)({},t);if(!((null==n?void 0:n.type)===s.YX3.LITERAL&&(0,a.Z)(n.content)))return(0,o._)({},t);var d=(0,r._)((0,o._)({},n),{content:!1});return n.rawMeta={type:s.owu.Boolean},(0,r._)((0,o._)({},i),{right:d})},h=e=>{var{rightValue:t,sourceType:n,operator:o,useCompatibleType:r}=e,l=o&&c.includes(o);if(n&&s.owu.isArrayType(n)){if(l)return[s.owu.Integer];if(o&&[d.CPf.Contains,d.CPf.NotContains].includes(o))return[s.owu.getArraySubType(n),n]}if(n===s.owu.String){if(l){if(t&&r){var a,i=null===(a=t.rawMeta)||void 0===a?void 0:a.type;if(i)return[i!==s.owu.Integer?s.owu.String:s.owu.Integer];if(!s.nZF.isEmpty(t)&&s.nZF.isLiteral(t))return"string"==typeof t.content?[s.owu.String]:[s.owu.Integer]}return[s.owu.Integer]}return[s.owu.String]}return new Map([[s.owu.String,[s.owu.String]],[s.owu.Integer,[s.owu.Integer,s.owu.Number]],[s.owu.Number,[s.owu.Number,s.owu.Integer]],[s.owu.Boolean,[s.owu.Boolean]],[s.owu.Object,[s.owu.String]]]).get(n)||[s.owu.String]}},787875:function(e,t,n){n.d(t,{Ld:function(){return s},Uo:function(){return u},s5:function(){return d}});var o,r=n(151064),l=n(567282),a=n(336205),i=n(915757);var s=((o={})[o.OR=1]="OR",o[o.AND=2]="AND",o),d=new Map([[1,a.o.t("workflow_detail_condition_or")],[2,a.o.t("workflow_detail_condition_and")]]),u={[l.CP.Equal]:(0,r.jsx)(i.Gb9,{}),[l.CP.NotEqual]:(0,r.jsx)(i.kJo,{}),[l.CP.LengthGt]:(0,r.jsx)(i.v7X,{}),[l.CP.LengthGtEqual]:(0,r.jsx)(i.rsJ,{}),[l.CP.LengthLt]:(0,r.jsx)(i.lYK,{}),[l.CP.LengthLtEqual]:(0,r.jsx)(i.rPl,{}),[l.CP.Contains]:(0,r.jsx)(i.rZz,{}),[l.CP.NotContains]:(0,r.jsx)(i.ujf,{}),[l.CP.Null]:(0,r.jsx)(i.Gb9,{}),[l.CP.NotNull]:(0,r.jsx)(i.kJo,{}),[l.CP.True]:(0,r.jsx)(i.Gb9,{}),[l.CP.False]:(0,r.jsx)(i.Gb9,{}),[l.CP.Gt]:(0,r.jsx)(i.v7X,{}),[l.CP.GtEqual]:(0,r.jsx)(i.rsJ,{}),[l.CP.Lt]:(0,r.jsx)(i.lYK,{}),[l.CP.LtEqual]:(0,r.jsx)(i.rPl,{})}},297727:function(e,t,n){n.d(t,{I:function(){return l},W:function(){return a}});var o=n(455069),r=(0,o.createContext)({flowNodeEntity:null,readonly:!1,setterPath:""}),l=()=>(0,o.useContext)(r),a=r.Provider},253826:function(e,t,n){n.d(t,{T:function(){return s}});var o=n(808549),r=n(120454),l=n(151064),a=n(646201),i=n(852963),s=e=>(0,l.jsx)("div",{className:"opacity-100 z-50",children:(0,l.jsx)(i.h,(0,r._)((0,o._)({},e),{titleIcon:(0,l.jsx)(a.Z,{className:"cursor-move pr-1",style:{color:"#aaa"}})}))})},513537:function(e,t,n){n.d(t,{H:function(){return m}});var o=n(808549),r=n(120454),l=n(151064),a=n(935954),i=n(990828),s=n(221478),d=n(455069),u=n(252237),c=n.n(u),v=n(646201),p=n(852963),f=n(575009),m=e=>{var{branch:t,index:n,onDragStart:u,onDragEnd:m,onMoveBranch:h,showDraggable:g}=e,x=(0,d.useRef)(null),[{isDragging:_},y,w]=(0,i.c)(()=>({type:f.n,item:()=>(null==u||u(t.uid),{type:f.n,index:n,startIndex:n,uid:t.uid}),end:(e,t)=>{null==m||m(e.startIndex,n)},collect:e=>({isDragging:e.isDragging()})}),[t,m,n]),[,j]=(0,s.L)(()=>({accept:f.n,hover(e,t){if(!x.current||!t)return;var o,r=e.index;if(r===n)return;var l=null===(o=x.current)||void 0===o?void 0:o.getBoundingClientRect(),a=(l.bottom-l.top)/2,i=t.getClientOffset();if(!i)return;var s=i.y-l.top;if((!(r<n)||!(s<a))&&(!(r>n)||!(s>a)))h(r,n),e.index=n}}),[t,h,n]);return(0,d.useEffect)(()=>{w((0,a.r)(),{captureDraggingState:!0})},[]),y(x),(0,l.jsx)("div",{className:c()({"opacity-0":_,"opacity-100":!_}),ref:j,children:(0,l.jsx)(p.h,(0,r._)((0,o._)({},e),{titleIcon:g?(0,l.jsx)(v.Z,{ref:x,"data-disable-node-drag":"true",className:"cursor-move pr-1",style:{color:"#aaa"}}):null}))})}},857689:function(e,t,n){n.d(t,{C:function(){return r}});var o=n(151064),r=e=>(0,o.jsx)("div",{className:"relative",children:e.children})},447303:function(e,t,n){n.d(t,{B:function(){return s}});var o=n(151064),r=n(191304),l=n(455069),a=n(686436),i=n(575009),s=e=>{var{preview:t}=e,n=(0,l.useRef)(null),s=(0,l.useRef)(),d=(0,a.Dc)();(0,l.useEffect)(()=>{var e;return d&&(e=d.onZoom(e=>{s.current=e})),()=>{e&&e.dispose()}},[]);var{itemType:u,isDragging:c,initialOffset:v,currentOffset:p}=(0,r.f)(e=>({item:e.getItem(),itemType:e.getItemType(),isDragging:e.isDragging(),initialOffset:e.getInitialSourceClientOffset(),currentOffset:e.getSourceClientOffset()}));return c?(0,o.jsx)("div",{style:{position:"absolute",pointerEvents:"none",scale:1,zIndex:100,left:0,top:0,width:"100%",height:"100%"},ref:n,children:(0,o.jsx)("div",{style:function(){if(!v||!p||!n.current)return{display:"none"};var e=n.current.getBoundingClientRect(),{x:t,y:o}=p;t-=e.x,o-=e.y;var r="translate(".concat(t/1,"px, ").concat(o/1,"px)");return{transform:r,WebkitTransform:r}}(),children:function(){if(u===i.n)return t;return null}()})}):null}},575009:function(e,t,n){n.d(t,{n:function(){return o}});var o="ConditionBranch"},172107:function(e,t,n){n.d(t,{L:function(){return o.Ld}});var o=n(787875)},300108:function(e,t,n){n.d(t,{L:()=>s});var o=n("455069"),r=n("598208"),l=n("686436"),a=l.xm,i=n("737805"),s=()=>{var{validateResults:e,setValidateResults:t}=(0,o.useMemo)(()=>(0,r.Ue)(e=>({validateResults:[],setValidateResults:t=>e(e=>({validateResults:t}))})),[])(e=>({validateResults:e.validateResults,setValidateResults:e.setValidateResults})),n=(0,l.km)(),s=(0,l.G2)(a);return{validateResults:e,initValidateResultsWithBranches:e=>{t((0,i.Y6)(e,n,s))},validateAllBranches:e=>{t((0,i.Y6)(e,n,s))}}}},737805:function(e,t,n){n.d(t,{QC:function(){return f},Y6:function(){return p}});var o=n(808549),r=n(120454),l=n(155440),a=n(788637),i=n(336205),s=n(942039),d=n(524705),u={isValid:!0,validStatus:"success",message:null},c=(e,t)=>({left:function(n){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(o)return u;var r=(0,d.s)({value:n,node:e,playgroundContext:t,required:!0});return r?{isValid:!1,validStatus:"error",message:r}:u},operator:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?u:(0,l.Z)(e)?{isValid:!1,validStatus:"error",message:i.o.t("workflow_detail_condition_condition_empty")}:u},right:function(n){var l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(l)return u;var a={isValid:!1,validStatus:"error",message:i.o.t("workflow_detail_condition_error_enter_comparison")},s=(0,d.s)({value:n,node:e,playgroundContext:t,required:!0});return s?(0,r._)((0,o._)({},a),{message:s}):u}}),v=(e,t,n)=>t(e,n),p=(e,t,n)=>{if(!e)return[];var o=c(t,n),r=[];return e.forEach((e,t)=>{var n,l;null===(l=e.condition)||void 0===l||null===(n=l.conditions)||void 0===n||n.forEach((e,n)=>{var{left:l,right:a,operator:i}=e;!r[t]&&(r[t]=[]),r[t][n]={left:v(l,o.left),operator:v(i,o.operator),right:v(a,o.right,(0,s.Wp)(i))}})}),r},f=(e,t)=>{var n=p(e,t.node,t.playgroundContext);if((0,a.Z)(n))return!0;var o=n.map(e=>e.map(e=>Object.entries(e).map(e=>{var[t,n]=e;return!n.isValid&&(n.message||"invalid condition")}))).flat(2).filter(Boolean);return 0===o.length||o.join(";")}},503291:function(e,t,n){n.d(t,{u:()=>p});var o=n("151064"),r=n("336205"),l=n("674343");n("715363");var a=n("299464"),i=n("184449"),s=n("261492"),d=n("735297"),u=n("644113"),c=n("455069"),v=()=>{var[e,t]=(0,c.useState)(!1);return{isVisible:e,openModal:()=>t(!0),closeModal:()=>t(!1)}},p=e=>{var t,{value:n,onChange:c,readonly:p=!1,addButtonTestID:f,libraryCardTestID:m}=e,{spaceId:h,projectId:g,getProjectApi:x,playgroundProps:_}=(0,i.j1)(),{isVisible:y,openModal:w,closeModal:j}=v(),{openDatabaseDetail:b}=(0,u.T)(),N=null==n?void 0:null===(t=n[0])||void 0===t?void 0:t.databaseInfoID,k=function(){var{data:e,error:t}=(0,i.ui)();return e?[function(e,t){var{id:n="",tableDesc:o,tableName:r,iconUrl:l}=e;return{id:n,name:r,description:o,iconUrl:l,isInvalid:!!t}}(null!=e?e:{},t)]:[]}(),C=function(e){var t,{data:n}=(0,i.ui)();return null==n?void 0:null===(t=n.fields)||void 0===t?void 0:t.map(e=>{var{name:t}=e;return t})}(0);function S(e){b({databaseID:e})}return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.b,{readonly:p,libraries:k,onAddLibrary:w,onDeleteLibrary:function(){l.u_.confirm({title:r.o.t("workflow_database_delete_confirm_modal_title",{},"确认移除该数据表？"),content:r.o.t("workflow_database_delete_confirm_modal_content",{},"移除后，该节点配置的相关内容均会被删除且无法恢复"),onOk:()=>{null==c||c([])},okText:r.o.t("workflow_confirm_modal_ok",{},"确定"),cancelText:r.o.t("workflow_confirm_modal_cancel",{},"取消")})},onClickLibrary:function(e){S(e)},emptyText:r.o.t("workflow_database_node_database_empty"),renderLibrary:e=>{var{defaultLibraryRender:t}=e;return(0,o.jsxs)("div",{children:[t(),(null==C?void 0:C.length)&&C.length>0?(0,o.jsx)(d.P,{className:"mt-[6px]",tags:C,max:3}):null]})},hideAddButton:n&&(null==n?void 0:n.length)>0,addButtonTestID:f,libraryCardTestID:m}),(0,o.jsx)(a.hP,{spaceId:h,visible:y,onClose:j,onAddDatabase:function(e){var t;t=e,null==c||c([{databaseInfoID:t}]),j()},onClickDatabase:function(e){S(e)},onCreateDatabase:e=>{var t,n;j(),null===(t=_.refetchProjectResourceList)||void 0===t||t.call(_),null===(n=x())||void 0===n||n.navigate("/database/".concat(e))},enterFrom:"workflow",projectID:g})]})}},466105:function(e,t,n){n.d(t,{or:()=>y,fO:()=>_});var o=n("825955"),r=n("808549"),l=n("120454"),a=n("473980"),i=n("151064"),s=n("455069"),d=n("336205"),u=n("674343"),c=n("687983"),v=n("252237"),p=n.n(v),f=n("915757"),m=n("119650"),h=e=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{children:e.label}),e.isDefault?(0,i.jsxs)("span",{className:m.Z["delimiter-description"],children:["(",(0,c.Z)({"\n":"\\n","	":"\\t"}[e.value]||e.value),")"]}):null]}),g=e=>{var t,n,{options:c,multiple:v,readonly:g,value:x,inputPlaceholder:_,onChange:y,enableCustom:w,onAdd:j,onDelete:b}=e,N=(0,a._)(e,["options","multiple","readonly","value","inputPlaceholder","onChange","enableCustom","onAdd","onDelete"]),k=(0,s.useRef)(null);var C=(t=(0,o._)(function*(e){yield null==b?void 0:b(e)}),function(e){return t.apply(this,arguments)}),[S,I]=(0,s.useState)(!1);var{node:T}=function(e){var t,{onAdd:n,placeholder:r,dropdownVisible:l}=e,[a,c]=(0,s.useState)(!1),[v,p]=(0,s.useState)(""),h=(0,s.useRef)(null);var g=(t=(0,o._)(function*(e){yield null==n?void 0:n(e).then(e=>{e&&p("")})}),function(e){return t.apply(this,arguments)});return(0,s.useEffect)(()=>{!l&&c(!1)},[l]),{node:(0,i.jsx)(i.Fragment,{children:a?(0,i.jsxs)("div",{className:"flex bg-white p-[4px] items-center",children:[(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsx)(u.II,{ref:h,value:v,onEnterPress:()=>g(v),onChange:e=>p(e),className:"rounded-[8px]",placeholder:r,maxLength:20})}),(0,i.jsxs)("div",{className:"flex p-[2px]",children:[(0,i.jsx)(u.zx,{color:"secondary",className:m.Z["action-cancel-button"],onClick:()=>{c(!1)},children:d.o.t("workflow_240218_17")}),(0,i.jsx)(u.zx,{color:"brand",className:m.Z["action-main-button"],onClick:()=>g(v),children:d.o.t("workflow_240218_18")})]})]}):(0,i.jsxs)("div",{className:m.Z["customise-button"],onClick:()=>{c(!0),setTimeout(()=>{var e;null==h||null===(e=h.current)||void 0===e||e.focus()},100)},children:[(0,i.jsx)(f.PwN,{}),(0,i.jsx)(u.ZT.Text,{children:d.o.t("workflow_stringprocess_concat_symbol_custom")})]})})}}({onAdd:(n=(0,o._)(function*(e){var t,n=yield null==j?void 0:j(e);return!v&&n&&(null===(t=k.current)||void 0===t||t.close()),!!n}),function(e){return n.apply(this,arguments)}),dropdownVisible:S,placeholder:_});return(0,i.jsx)("div",{className:m.Z["selector-wrapper"],children:(0,i.jsx)(u.Ph,(0,l._)((0,r._)({},N),{ref:k,multiple:v,value:x,size:"small",dropdownMatchSelectWidth:!0,dropdownClassName:m.Z["selector-wrapper-dropdown"],showRestTagsPopover:!0,onChange:e=>null==y?void 0:y(e),outerBottomSlot:w?T:null,optionList:c,renderOptionItem:e=>{var{disabled:t,selected:n,label:o,value:r,focused:l,style:s,onMouseEnter:c,onClick:m}=e,{isDefault:x}=(0,a._)(e,["disabled","selected","label","value","focused","style","onMouseEnter","onClick"]),_=p()({"custom-option-render":!0,"custom-option-render-focused":l,"custom-option-render-disabled":t||g,"custom-option-render-selected":n});return(0,i.jsxs)("div",{style:s,className:_,onClick:()=>m(),onMouseEnter:e=>c(),children:[(0,i.jsxs)("div",{className:"w-[12px] flex items-center",children:[v?(0,i.jsx)(u.XZ,{checked:n,disabled:g}):null,!v&&n?(0,i.jsx)(f.P03,{style:{color:"rgba(78, 64, 229, 1)"}}):null]}),(0,i.jsxs)("div",{className:p()(["option-right","flex","flex-1",x?"":"justify-between"]),children:[(0,i.jsx)(h,{label:o,value:r,isDefault:x}),!x&&(0,i.jsx)(u.u,{content:d.o.t("Delete"),children:(0,i.jsx)(f.dVD,{onClick:e=>{e.stopPropagation(),C(r)},className:"text-xs"})})]})]})},renderSelectedItem:e=>v?{isRenderInTag:!0,content:(0,i.jsx)(h,(0,r._)({},e))}:(0,i.jsx)(h,(0,r._)({},e)),onDropdownVisibleChange:I,style:{pointerEvents:g?"none":"auto",maxWidth:"460px",height:"24px"}}))})},x=n("316547"),_=e=>{var t,n,{value:c,onChange:v,readonly:p,hasError:f,options:m}=e,h=m||{},{multiple:_,enableCustom:y=!0,maxCustomLength:w,inputPlaceholder:j=""}=h,b=(0,a._)(h,["multiple","enableCustom","maxCustomLength","inputPlaceholder"]),[N,k]=(0,s.useState)(c.options),[C,S]=(0,s.useState)(c.value);var I=(0,s.useCallback)((t=(0,o._)(function*(e){if(!e)return Promise.resolve(!1);if(N.find(t=>t.value===e))return u.FN.warning(d.o.t("workflow_stringprocess_dulpicate_hover")),Promise.resolve(!1);if(w&&!Number.isNaN(w)&&N.filter(e=>!e.isDefault).length>=w)return u.FN.warning(d.o.t("workflow_stringprocess_max_length_item",{maxLength:w})),Promise.resolve(!1);var t=[...N,{label:e,value:e,isDefault:!1}];k(t);var n=_?[...C,e]:e;return S(n),null==v||v({value:n,options:t}),Promise.resolve(!0)}),function(e){return t.apply(this,arguments)}),[C,w,N]),T=(0,s.useCallback)(e=>{S(e),null==v||v({value:e,options:N})},[N]);var E=(0,s.useCallback)((n=(0,o._)(function*(e){if(!e)return Promise.resolve(!1);var t,n=N.filter(t=>t.value!==e);k(n);var o=C;return _&&Array.isArray(C)?o=(C||[]).filter(t=>t!==e):!_&&(o=null==N?void 0:null===(t=N[0])||void 0===t?void 0:t.value),S(o),null==v||v({value:o,options:n}),Promise.resolve(!0)}),function(e){return n.apply(this,arguments)}),[C,N]);return(0,i.jsx)("div",{className:x.Z["delimiter-selector"],children:(0,i.jsx)(g,(0,l._)((0,r._)({},b),{value:C,options:N,onChange:T,onAdd:I,onDelete:E,readonly:p,enableCustom:y,multiple:_,maxHeight:250,hasError:!!f,inputPlaceholder:j}))})};(0,u.Q2)(_);var y={key:"DelimiterSelector",component:_}},462977:function(e,t,n){n.d(t,{M:function(){return p}});var o=n(151064),r=n(455069),l=n(311807),a=n(252237),i=n.n(a),s=n(614904),d=n(450562),u=n(686436),c=n(538597),v=n(960058),p=e=>{var t=(0,r.useRef)(null),{context:n,key:a,onChange:p,onBlur:f,onFocus:m,isError:h,readonly:g=!1,disableSuggestion:x=!1,disableCounter:_=!0,minRows:y=4}=e,w=void 0,j=(0,c.V)(),[b,N]=(0,r.useState)(!1),{getNodeSetterId:k}=(0,d.FCD)(),C=(0,u.X2)(u.NQ),[S,I]=(0,r.useState)(e.value||""),T=(0,c.I)(e.placeholder),E=k(n.path),D=e.value||"",[Z]=(0,r.useState)(()=>new s.R0(D));Z.setVariableTree(j),Z.setFocus(b);var M=(0,r.useCallback)((0,l.Z)(e=>{N(e)},50),[]),P=(0,r.useMemo)(()=>"number"==typeof w&&Z.value.length>w,[Z.value.length,w]);return(0,r.useEffect)(()=>{var e=Z.on(s.tf.Change,e=>{p&&p(e.value)});return()=>{e()}},[p]),(0,o.jsxs)("div",{className:i()(v.Z["expression-editor-container"],{[v.Z["expression-editor-focused"]]:b,[v.Z["expression-editor-error"]]:h||P,[null==e?void 0:e.customClassName]:null==e?void 0:e.customClassName}),onFocus:()=>{M(!0),null==m||m()},onBlur:()=>{null==p||p(S),M(!1),null==f||f()},ref:t,children:[(0,o.jsxs)(s.A2.EditorProvider,{children:[(0,o.jsx)(s.A2.Renderer,{value:D,variableTree:j,className:i()(v.Z["editor-render"],v.Z["editor-render-cm-content"],v.Z["editor-render-cmMinRows-".concat(y)],{[v.Z["editor-render-bottom-padding"]]:!_||P}),readonly:g,placeholder:T,dataTestID:E,onChange:I}),g||x?null:(0,o.jsx)(s.A2.Popover,{variableTree:j,getPopupContainer:()=>document.body,onVisibilityChange:function(e){e?C.disabled=!0:C.disabled=!1}})]}),(0,o.jsx)(s.UF,{model:Z,maxLength:w,disabled:_&&!P,isError:P})]},a)}},538597:function(e,t,n){n.d(t,{I:function(){return u},V:function(){return d}});var o=n(455069),r=n(614904),l=n(450562),a=n(1334),i=n(897659),s=()=>{var e,t=(0,l.rsR)(),n=null!==(e=null==t?void 0:t.inputParameters)&&void 0!==e?e:[];return(0,i.t)(n)},d=()=>{var e=(0,a.X_)(),t=s(),n=r.qz.findAvailableVariables({variables:e,inputs:t});return r.qz.createVariableTree(n)},u=e=>(0,o.useMemo)(()=>e?"string"==typeof e?e:"function"==typeof e?e():void 0:void 0,[e])},666919:function(e,t,n){n.d(t,{X:function(){return d},i:function(){return s}});var o=n(151064),r=n(64605),l=n(450562),a=n(462977),i=e=>(0,r.Z)(e)&&"value"in e&&(0,r.Z)(e.value)&&"content"in e.value?(l.E7u.event({eventName:"workflow_invalid_end_schema_format"}),e.value.content):e,s=e=>{var{value:t,onChange:n,options:r,readonly:l,context:s,feedbackStatus:d}=e,{key:u,placeholder:c,minRows:v,maxLength:p,disableSuggestion:f,disableCounter:m,customClassName:h}=r,g=i(t);return(0,o.jsx)(a.M,{context:s,value:g,readonly:l,onChange:n,placeholder:c,minRows:v,maxLength:p,disableSuggestion:f,disableCounter:m,customClassName:h,isError:"error"===d},u)},d={key:"ExpressionEditor",component:s}},897659:function(e,t,n){n.d(t,{t:function(){return function e(t){return t.map(t=>{var n,o,r,l,a={name:null!==(l=t.name)&&void 0!==l?l:"",keyPath:[...(null===(o=t.input)||void 0===o?void 0:null===(n=o.content)||void 0===n?void 0:n.keyPath)||[]]};return(null==t?void 0:null===(r=t.children)||void 0===r?void 0:r.length)&&(a.children=e(t.children)),a}).filter(e=>!!e.name)}}})},517609:function(e,t,n){n.d(t,{f:function(){return d}});var o=n(151064);n(455069);var r=n(252237),l=n.n(r),a=n(307315),i=n(184449),s=n(793601),d=e=>{var{className:t,value:n,onChange:r,models:d,readonly:u,popoverPosition:c,triggerRender:v}=e,{spaceId:p,projectId:f,isBindDouyin:m}=(0,i.j1)();return(0,o.jsx)(a.q2,{enableJumpDetail:!1,className:l()(s.Z.select,t),popoverClassName:l()(s.Z["selector-popover"],s.Z["selector-popover-".concat(f?"project":"library")]),popoverPosition:c||"bottomRight",disabled:u,selectedModelId:n?"".concat(n):"",modelList:d,clickToHide:!0,onModelChange:e=>{e.model_type&&r(Number(e.model_type))},triggerRender:v})}},862868:function(e,t,n){n.d(t,{H:function(){return l},Zu:function(){return i},qo:function(){return s}});var o=n(318293),r=n(450562),l=e=>{var t,n,l,a,i,{input:s,node:d,variableService:u,prefix:c="",suffix:v=""}=e,p=null==s?void 0:null===(l=s.content)||void 0===l?void 0:l.keyPath;if((null==s?void 0:s.type)==="ref"&&!!Array.isArray(p)&&0!==p.length){var f=(0,o.Z)(p),m=u.getVariableFacadeByKeyPath(p,{node:d});if(!m)return f;var h=1===p.length?(t=null===(a=m.node)||void 0===a?void 0:a.flowNodeType,(n=Object.entries(r.nyy).find(e=>{var[n,o]=e;return o===t}))?n[0]:void 0):null===(i=m.viewMeta)||void 0===i?void 0:i.name;return h?e.format?e.format({name:h,prefix:c,suffix:v,input:s,node:d}):"".concat(c).concat(h).concat(v):f}},a=(e,t)=>t.filter(t=>t.name===e).length,i=e=>{var{variableName:t,inputParameters:n}=e;if(!n||0===a(t,n))return t;for(var o=1;;){var r="".concat(t).concat(o);if(0===a(r,n))return r;o+=1}},s=e=>{var t,n=new r.m_1(e.node);return(null!==(t=null==n?void 0:n.inputParameters)&&void 0!==t?t:[]).map(e=>e.name).filter(Boolean)}},453267:function(e,t,n){n.d(t,{g:function(){return s},h:function(){return d}});var o=n(808549),r=n(151064),l=n(252237),a=n.n(l),i=n(205641),s=e=>{var{text:t,align:n="center",className:o="",isBreakLine:l=!1}=e;return(0,r.jsx)("div",{className:a()("w-full !px-[8px] !py-[6px] flex flex-row items-center coz-mg-hglt-secondary text-[14px]",{"justify-center":"center"===n,"justify-end":"right"===n,"justify-start":"left"===n},o),children:l?t:(0,r.jsx)(i.x,{text:t})})},d={key:"Notify",component:e=>{var t;return(0,r.jsx)(s,(0,o._)({text:null===(t=e.options)||void 0===t?void 0:t.text},e.options))}}}}]);
//# sourceMappingURL=3986.9f883976.js.map