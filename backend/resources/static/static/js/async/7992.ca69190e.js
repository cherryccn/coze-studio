/*
 * Copyright 2025 coze-dev Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*! For license information please see 7992.ca69190e.js.LICENSE.txt */
"use strict";(self.webpackChunk_coze_studio_app=self.webpackChunk_coze_studio_app||[]).push([["7992"],{534198:function(e,t,n){n.d(t,{qO:()=>b,pD:()=>W,VH:()=>K,p4:()=>$,r5:()=>j,QL:()=>F});var o,r=n("151064"),i=n("407821"),a=n.n(i),s=n("472772"),l=n.n(s),d=n("395245"),u=n.n(d),c=n("297998"),v=n.n(c),p=n("646576"),m=n.n(p),h=n("606121"),g=n.n(h),f=n("474488"),_={};_.styleTagTransform=g(),_.setAttributes=v(),_.insert=u().bind(null,"head"),_.domAPI=l(),_.insertStyleElement=m(),a()(f.Z,_);var x=f.Z&&f.Z.locals?f.Z.locals:void 0,b=e=>{var{leftContent:t,rightContent:n,children:o}=e;return(0,r.jsxs)("div",{className:x.container,children:[(0,r.jsxs)("div",{className:x["icon-container"],children:[(0,r.jsx)("div",{"data-testid":"chat-area.answer-action.left-content",className:x["left-content"],children:t}),(0,r.jsx)("div",{"data-testid":"chat-area.answer-action.right-content",className:x["right-content"],children:n})]}),o]})};b.displayName="ActionBarContainer";var y=n("455069"),w=n("252237"),C=n.n(w),I=n("410914"),N={};N.styleTagTransform=g(),N.setAttributes=v(),N.insert=u().bind(null,"head"),N.domAPI=l(),N.insertStyleElement=m(),a()(I.Z,N);var E=I.Z&&I.Z.locals?I.Z.locals:void 0,j=(0,y.forwardRef)((e,t)=>{var{children:n,style:o}=e;return(0,r.jsx)("div",{"data-testid":"chat-area.answer-action.hover-action-bar",className:C()(E.container,["coz-stroke-primary","coz-bg-max"]),style:o,ref:t,children:n})}),T=n("380835"),k=n("780601"),A=n("336205"),M=n("341665"),S=e=>(0,k.eg)(e)||(0,k.vk)(e)||(0,k.mJ)(e),z=n("765377"),O=n("808549"),L=n("473980"),R=n("915757"),D=n("674343"),P=e=>{var{meta:{isFromLatestGroup:t,sectionId:n},latestSectionId:o}=e;return t&&n===o},U=e=>{var{message:t,meta:n,latestSectionId:o}=e;return!S(t)&&P({meta:n,latestSectionId:o})},B=n("2930"),Z=e=>(0,B.wX)()===M.Ar.MOBILE?"custom":e,F=e=>{var{className:t}=e,n=(0,L._)(e,["className"]),{message:o,meta:i,regenerateMessage:a}=(0,k.dH)(),s=(0,k.WB)(),l=Z("hover");return U({message:o,meta:i,latestSectionId:s})?(0,r.jsx)(D.u,{trigger:l,content:A.o.t("message_tool_regenerate"),children:(0,r.jsx)(D.hU,(0,O._)({"data-testid":"chat-area.answer-action.regenerate-message-button",size:"small",color:"secondary",icon:(0,r.jsx)(R.mxP,{className:C()(t,"w-[14px] h-[14px]")}),onClick:()=>{a()}},n))}):null},q=n("360033"),V={};V.styleTagTransform=g(),V.setAttributes=v(),V.insert=u().bind(null,"head"),V.domAPI=l(),V.insertStyleElement=m(),a()(q.Z,V),q.Z&&q.Z.locals&&q.Z.locals;var W=e=>{var{className:t}=e,n=(0,L._)(e,["className"]),{groupId:o}=(0,k.dH)(),i=Z("hover"),a=(0,k.Nd)(o),s=(0,k.YI)();return(0,r.jsx)(D.u,{trigger:i,content:A.o.t("Delete"),children:(0,r.jsx)(D.hU,(0,O._)({"data-testid":"chat-area.answer-action.delete-message-button",disabled:a,size:"small",icon:(0,r.jsx)(R.dVD,{className:C()("coz-fg-hglt-red",t,"w-[14px] h-[14px]")}),onClick:()=>{s(o)},color:"secondary"},n))})},G=n("626389"),Q=n.n(G);var H=((o={}).TtsVoiceWs="chat_answer_action_start_TTS",o.ReportMessage="chat_answer_action_message_feedback",o.CopyTextMessage="chat_answer_action_copy_text_message",o),$=e=>{var{className:t,isMustGroupLastAnswerMessage:n=!0,isUseExternalContent:o=!1,externalContent:i}=e,a=(0,L._)(e,["className","isMustGroupLastAnswerMessage","isUseExternalContent","externalContent"]),{reporter:s}=(0,k.rj)(),{message:l,meta:d}=(0,k.dH)(),u=o?i||"":l.content,[c,v]=(0,y.useState)(!1),p=Z("hover");if(!(0,k.pZ)(l)||!d.isGroupLastAnswerMessage&&n)return null;var m=C()(t,"w-[14px] h-[14px]");return(0,r.jsx)(D.u,{content:c?A.o.t("copied"):A.o.t("copy"),trigger:p,children:(0,r.jsx)(D.hU,(0,O._)({"data-testid":"chat-area.answer-action.copy-button",size:"small",icon:c?(0,r.jsx)(R.maW,{className:m}):(0,r.jsx)(R.UtC,{className:m}),color:"secondary",onClick:()=>{Q()(u)?(v(!0),setTimeout(()=>v(!1),3e3),D.FN.success({content:A.o.t("copy_success"),showClose:!1,duration:3}),s.successEvent({eventName:H.CopyTextMessage})):(D.FN.warning({content:A.o.t("copy_failed"),showClose:!1,duration:3}),s.errorEvent((0,O._)({eventName:H.CopyTextMessage},(0,z.aH)("copy_text_message_error","copy_text_message_error"))))}},a))})},Y=n("392060"),J=()=>{try{return(0,k.FL)(k.p7.MessageGrab)}catch(e){return null}},K=e=>{var t=J(),{message:n}=(0,k.dH)();return t&&n.source!==T.mZ.Notice?(0,r.jsx)(X,(0,O._)({},e)):null},X=e=>{var{className:t}=e,n=(0,L._)(e,["className"]),o=J(),{chatAreaPluginContext:i,pluginBizContext:a}=o,{useDeleteFile:s}=o.chatAreaPluginContext.writeableHook.file,{getFileStoreInstantValues:l}=i.readonlyAPI.batchFile,{useQuoteStore:d}=a.storeSet,{onQuote:u}=a.eventCallbacks,{updateQuoteContent:c,updateQuoteVisible:v}=d.getState(),{message:p,meta:m}=(0,k.dH)(),{content:h,content_type:g}=p,f=Z("hover"),_=s(),x=()=>{var{fileIdList:e}=l();e.forEach(e=>_(e))},b=(0,k.pZ)(p),y=(0,k.hI)(p);return(b||y)&&m.isGroupLastAnswerMessage&&o?(0,r.jsx)(D.u,{content:A.o.t("quote_ask_in_chat"),trigger:f,children:(0,r.jsx)(D.hU,(0,O._)({"data-testid":"chat-area.answer-action.quote-message",size:"small",icon:(0,r.jsx)(R.Z57,{className:C()(t,"w-[14px] h-[14px]")}),onClick:()=>{if(x(),g===k.zc.Image){var e,t,n=(0,z.w8)({str:h,verifyStruct:e=>e instanceof Object&&"image_list"in e,onParseError:e=>{(0,z.Cj)(e.message)},onVerifyError:e=>{(0,z.Cj)(e.message)}});c(null!==(t=null==n?void 0:n.image_list.map(e=>({type:Y.y1.IMAGE,src:e.image_ori.url,children:[]})))&&void 0!==t?t:[])}else c((0,Y.hl)(h));null==u||u({botId:null!==(e=p.sender_id)&&void 0!==e?e:"",source:p.source}),v(!0)},color:"secondary"},n))}):null};K.displayName="QuoteMessage",n("382534");var ee=n("325325"),et={};et.styleTagTransform=g(),et.setAttributes=v(),et.insert=u().bind(null,"head"),et.domAPI=l(),et.insertStyleElement=m(),a()(ee.Z,et),ee.Z&&ee.Z.locals&&ee.Z.locals},983153:function(e,t,n){n.d(t,{n:()=>m});var o=n("780601"),r=e=>({}),i=e=>({}),a=e=>({}),s=e=>({}),l=e=>({appLifeCycleService:s(e),messageLifeCycleService:i(e),commandLifeCycleService:a(e),renderLifeCycleService:r(e)}),d=n("151064"),u=n("455069"),c=n("193893"),v=(0,u.memo)(e=>{var[t,n]=(0,u.useState)(!1),o=(0,u.useRef)(e.message.reasoning_content);return(0,u.useEffect)(()=>(n(o.current===e.message.reasoning_content),()=>{o.current=e.message.reasoning_content}),[e.message.reasoning_content,e.message.content]),"assistant"===e.message.role&&e.message.reasoning_content?(0,d.jsx)("div",{className:"my-[8px]",children:(0,d.jsx)(c.HK,{markDown:"".concat(e.message.reasoning_content.replace(/^/gm,"> ")),showIndicator:!e.message.is_finish&&!t})}):null},(e,t)=>e.message.role===t.message.role&&e.message.is_finish===t.message.is_finish&&e.message.reasoning_content===t.message.reasoning_content&&e.message.content===t.message.content);class p extends o.YN{constructor(...e){super(...e),this.pluginMode=o.tf.Readonly,this.pluginName=o.p7.Demo,this.lifeCycleServices=(0,o.y1)(this,l),this.customComponents=(0,o.S3)({TextMessageInnerTopSlot:v})}}var m={createPluginBizContext:()=>({}),Plugin:p}},19642:function(e,t,n){n.d(t,{J:()=>j,i:()=>O});var o=n("808549"),r=n("151064"),i=n("341665"),a=n("552995"),s=n("780601"),l=n("473980"),d=n("455069"),u=n("392300"),c=n("615655"),v=n("580868"),p=n("345420"),m=n("765377"),h=n("64605"),g=e=>(0,h.Z)(e)&&"content"in e&&"content_type"in e,f=e=>(0,h.Z)(e)&&"type"in e&&"name"in e,_=e=>Array.isArray(e),x=n("674343"),b=e=>{var{children:t}=e;return(0,r.jsx)("div",{className:"overflow-hidden w-full min-w-[282px] max-w-[546px]",children:t})},y=e=>{var{data:t,onCardSendMsg:n,readonly:o,isDisable:i,message:a}=e,s=o||i;return(0,r.jsx)(b,{children:(0,r.jsxs)(x.T,{className:"w-full",vertical:!0,spacing:12,align:"start",children:[(0,r.jsx)(x.ZT.Text,{ellipsis:!0,className:"text-18px",children:t.content.question}),(0,r.jsx)(x.T,{className:"w-full",vertical:!0,spacing:16,children:t.content.options.map((e,t)=>(0,r.jsx)(x.zx,{className:"w-full",color:"primary",disabled:s,onClick:()=>null==n?void 0:n({message:a,extra:{msg:e.name,mentionList:[]}}),children:e.name},e.name+t))})]})})},w=n("61111"),C=n("336205"),I=e=>{var{data:t,onCardSendMsg:n,readonly:o,isDisable:i,message:a}=e,[s,l]=(0,d.useState)({}),[c,v]=(0,d.useState)(!1),p=o||i||c,h=(0,m.WP)(t.content,u.Z);if(!_(h))return"input node content is not supported";var g=h.filter(f);return(0,r.jsx)(b,{children:(0,r.jsxs)(x.T,{spacing:12,vertical:!0,className:"w-full",children:[g.map((e,t)=>(0,r.jsxs)(x.T,{align:"start",className:"w-full",spacing:6,vertical:!0,children:[(0,r.jsx)(x.ZT.Text,{ellipsis:!0,className:"text-lg !font-medium",children:null==e?void 0:e.name}),(0,r.jsx)(x.II,{disabled:p||c,value:s[e.name],onChange:t=>{l((0,w.Uy)(n=>{n[e.name]=t}))}})]},e.name+t)),(0,r.jsx)(x.zx,{className:"w-full",disabled:p,onClick:()=>{if(!p)v(!0),null==n||n({message:a,extra:{msg:g.map(e=>"".concat(e.name,":").concat(s[e.name]||"")).join("\n")||"",mentionList:[]}})},children:C.o.t("workflow_detail_title_testrun_submit")})]})})},N=(0,d.memo)(e=>{var{message:t}=e,n=(0,l._)(e,["message"]),i=(0,m.WP)(t.content,u.Z);return g(i)?"option"===i.content_type?(0,r.jsx)(y,(0,o._)({data:i,message:t},n)):"form_schema"===i.content_type?(0,r.jsx)(I,(0,o._)({data:i,message:t},n)):"content type is not supported":"card content is not supported"},(e,t)=>(0,c.Z)((0,v.Z)(e,p.Z),(0,v.Z)(t,p.Z))),E=e=>void 0===e||e,j=e=>{var t=(0,s.Mg)("TextMessageInnerTopSlot"),n=[{rule:e=>{var t,{contentType:n,contentConfigs:o}=e,r=E(null==o?void 0:null===(t=o[i.CE.CARD])||void 0===t?void 0:t.enable);return n===a.zc.Card&&r},render:e=>{var{message:t,eventCallbacks:n,contentConfigs:o,options:i}=e,{isCardDisabled:a,readonly:s}=i,{onCardSendMsg:l}=null!=n?n:{};return(0,r.jsx)(N,{message:t,onCardSendMsg:l,readonly:s,isDisable:a})}}];return(0,r.jsx)(a.Y_,(0,o._)({enhancedContentConfigList:n,multimodalTextContentAddonTop:(0,r.jsx)(r.Fragment,{children:t.map((t,n)=>{var{pluginName:o,Component:i}=t;return(0,r.jsx)(s.Sq,{pluginName:o,children:(0,r.jsx)(i,{message:e.message},n)},o)})})},e))},T=e=>{if("card"===e.content_type){var t,n=(0,a.dj)(e.content),o=null==n?void 0:null===(t=n.x_properties)||void 0===t?void 0:t.workflow_card_info;if(o){var r=(0,a.dj)(o);if((null==r?void 0:r.card_type)==="QUESTION"&&(null==r?void 0:r.question_card_data)||(null==r?void 0:r.card_type)==="INPUT"&&(null==r?void 0:r.input_card_data))return r}}},k=e=>{var{children:t}=e;return(0,r.jsx)("div",{className:"overflow-hidden w-full min-w-[282px] max-w-[546px] p-[16px] coz-bg-primary",children:t})},A=e=>{var t,n,o,{data:i,onCardSendMsg:a,readonly:s,isDisable:l,message:d}=e,u=s||l;return(0,r.jsx)(k,{children:(0,r.jsxs)(x.T,{className:"w-full",vertical:!0,spacing:12,align:"start",children:[(0,r.jsx)(x.ZT.Text,{ellipsis:!0,className:"text-18px",children:null===(t=i.question_card_data)||void 0===t?void 0:t.Title}),(0,r.jsx)(x.T,{className:"w-full",vertical:!0,spacing:16,children:null===(o=i.question_card_data)||void 0===o?void 0:null===(n=o.Options)||void 0===n?void 0:n.map((e,t)=>(0,r.jsx)(x.zx,{className:"w-full",color:"primary",disabled:u,onClick:()=>null==a?void 0:a({message:d,extra:{msg:e.name,mentionList:[]}}),children:e.name},e.name+t))})]})})},M=e=>{var t,{data:n,onCardSendMsg:o,readonly:i,isDisable:a,message:s}=e,[l,u]=(0,d.useState)({}),[c,v]=(0,d.useState)(!1),p=i||a||c;return(0,r.jsx)(k,{children:(0,r.jsxs)(x.T,{spacing:12,vertical:!0,className:"w-full",children:[null===(t=n.input_card_data)||void 0===t?void 0:t.map((e,t)=>(0,r.jsxs)(x.T,{align:"start",className:"w-full",spacing:6,vertical:!0,children:[(0,r.jsx)(x.ZT.Text,{ellipsis:!0,className:"text-lg !font-medium",children:null==e?void 0:e.name}),(0,r.jsx)(x.II,{disabled:p||c,value:l[e.name],onChange:t=>{u((0,w.Uy)(n=>{n[e.name]=t}))}})]},(null==e?void 0:e.name)+t)),(0,r.jsx)(x.zx,{className:"w-full",disabled:p,onClick:()=>{var e;if(!p)v(!0),null==o||o({message:s,extra:{msg:(null===(e=n.input_card_data)||void 0===e?void 0:e.map(e=>"".concat(e.name,":").concat(l[e.name]||"")).join("\n"))||"",mentionList:s.sender_id?[{id:s.sender_id}]:[]}})},children:C.o.t("workflow_detail_title_testrun_submit")})]})})},S=(0,d.memo)(e=>{var{message:t}=e,n=(0,l._)(e,["message"]),i=(0,d.useMemo)(()=>T(t),[t]);return i?"INPUT"===i.card_type?(0,r.jsx)(M,(0,o._)({data:i,message:t},n)):"QUESTION"===i.card_type?(0,r.jsx)(A,(0,o._)({data:i,message:t},n)):"content type is not supported":null},(e,t)=>(0,c.Z)((0,v.Z)(e,p.Z),(0,v.Z)(t,p.Z))),z=e=>void 0===e||e,O=e=>{var t=(0,s.Mg)("TextMessageInnerTopSlot"),n=[{rule:e=>{var t,{contentType:n,contentConfigs:o}=e,r=z(null==o?void 0:null===(t=o[i.CE.CARD])||void 0===t?void 0:t.enable);return n===a.zc.Card&&r},render:e=>{var{message:t,eventCallbacks:n,options:o}=e,{isCardDisabled:i,readonly:a}=o,{onCardSendMsg:s}=null!=n?n:{};return(0,r.jsx)(S,{message:t,onCardSendMsg:s,readonly:a,isDisable:i})}}];return(0,r.jsx)(a.Y_,(0,o._)({enhancedContentConfigList:n,multimodalTextContentAddonTop:(0,r.jsx)(r.Fragment,{children:t.map((t,n)=>{var{pluginName:o,Component:i}=t;return(0,r.jsx)(s.Sq,{pluginName:o,children:(0,r.jsx)(i,{message:e.message},n)},o)})})},e))}},528318:function(e,t,n){n.d(t,{DP:()=>S,i$:()=>d,DY:()=>z});var o,r=n("917085"),i=n("479910"),a=n("598208"),s=e=>(0,a.Ue)()((0,i.mW)(e=>({backgroundImageInfo:{mobile_background_image:{},web_background_image:{}},clearBackgroundStore:()=>e({backgroundImageInfo:{mobile_background_image:{},web_background_image:{}}},!1,"clearBackgroundStore"),setBackgroundInfo:t=>{e({backgroundImageInfo:t},!1,"setBackgroundInfo")}}),{name:"botStudio.ChatBackground.".concat(e),enabled:!1})),l=n("780601");var d=((o={}).OnBackgroundChange="onBackgroundChange",o),u=e=>({onBeforeInitial:()=>{var{chatBackgroundEvent:t,storeSet:n}=e.pluginBizContext,{setBackgroundInfo:o}=n.useChatBackgroundContext.getState();t.on(d.OnBackgroundChange,e=>{o(e)})},onAfterInitial:t=>{var{setBackgroundInfo:n,clearBackgroundStore:o}=e.pluginBizContext.storeSet.useChatBackgroundContext.getState(),r=t.messageListFromService.backgroundInfo;r?n(r):o()},onBeforeDestroy:()=>{var{chatBackgroundEvent:t}=e.pluginBizContext;t.all.clear()}}),c=n("151064"),v=n("664319"),p=n("552995"),m=n("407821"),h=n.n(m),g=n("472772"),f=n.n(g),_=n("395245"),x=n.n(_),b=n("297998"),y=n.n(b),w=n("646576"),C=n.n(w),I=n("606121"),N=n.n(I),E=n("110614"),j={};j.styleTagTransform=N(),j.setAttributes=y(),j.insert=x().bind(null,"head"),j.domAPI=f(),j.insertStyleElement=C(),h()(E.Z,j);var T=E.Z&&E.Z.locals?E.Z.locals:void 0,k=e=>{var t,{headerNode:n}=e,{useChatBackgroundContext:o}=(0,l.W9)(l.p7.ChatBackground).pluginBizContext.storeSet,r=o((0,v.N)(e=>e.backgroundImageInfo));return(null==r?void 0:null===(t=r.mobile_background_image)||void 0===t?void 0:t.origin_image_url)?(0,c.jsxs)(c.Fragment,{children:[n?(0,c.jsx)("div",{className:T.mask}):null,(0,c.jsx)(p.Uh,{backgroundInfo:r})]}):null},A=e=>({appLifeCycleService:u(e)});class M extends l.YN{constructor(...e){super(...e),this.pluginMode=l.tf.Readonly,this.pluginName=l.p7.ChatBackground,this.lifeCycleServices=(0,l.y1)(this,A),this.customComponents=(0,l.S3)({MessageListFloatSlot:k})}}var S=(0,r.Z)(),z=()=>{var e=s("chatBackground");return{ChatBackgroundPlugin:{createPluginBizContext:()=>({storeSet:{useChatBackgroundContext:e},chatBackgroundEvent:S}),Plugin:M},chatBackgroundEvent:S}}},991450:function(e,t,n){n.d(t,{W:()=>g});var o=n("808549"),r=n("120454"),i=n("473980"),a=n("151064"),s=n("455069"),l=n("136515"),d=n("382174"),u=n("974235"),c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],[n,o]=(0,s.useState)(0),r=(0,s.useRef)(),i=(0,s.useRef)(()=>void 0);return i.current=e,(0,s.useLayoutEffect)(()=>{if(!!n){var e=r.current||[];return i.current(...e)}},[n,...t]),function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];r.current=t,o(e=>e+1)}},v=e=>{var{getId:t,listRef:n,getMoreListService:o,defaultList:r}=e,[i,a]=(0,s.useState)(""),{data:l,loadingMore:d,loading:v,loadMore:p}=(0,u.Z)(e=>o(e),{target:n,isNoMore:e=>!(null==e?void 0:e.hasMore)}),g=(0,s.useMemo)(()=>{var e,t;return r?{list:r.concat(null!==(e=null==l?void 0:l.list)&&void 0!==e?e:[]),hasMore:!!(null==l?void 0:l.hasMore)}:{list:null!==(t=null==l?void 0:l.list)&&void 0!==t?t:[],hasMore:!!(null==l?void 0:l.hasMore)}},[l]),{list:f}=g,_=e=>{if(!e){a("");return}if(!n.current)return;var o=f.find(n=>t(e)===t(n));if(!!o)a(t(o))},x=c(e=>{var o,r=t(e),i=null===(o=n.current)||void 0===o?void 0:o.querySelector('[data-id="'.concat(r,'"]'));if(!!i)i.scrollIntoView({behavior:"instant",block:"nearest"})});return{activeId:i,focusFirst:()=>{var e=f[0];e&&_(e)},focusTo:_,scrollToFirst:()=>{if(!!n.current)n.current.scrollTop=0},scrollIntoView:x,goNext:()=>{var e=f.find(e=>t(e)===i);if(!!e){var{item:n,reachLimit:o}=m({getId:t,list:f,curItem:e});o&&p(),!d&&(_(n),x(n))}},goPrev:()=>{var e=f.find(e=>t(e)===i);if(!!e){var{item:n,reachLimit:o}=h({getId:t,list:f,curItem:e});o&&p(),_(n),x(n)}},loadingMore:d,data:g,loading:v}},p=e=>{var{getId:t,list:n,target:o}=e,r=-1;return{targetItem:n.find((e,n)=>t(e)===t(o)&&(r=n,!0)),targetIndex:r}},m=e=>{var{curItem:t,list:n,getId:o}=e,{targetIndex:r}=p({getId:o,list:n,target:t});if(r<0)return{reachLimit:!1,item:t};var i=r>=n.length-3,a=(r+1)%n.length;return{reachLimit:i,item:n.at(a)||t}},h=e=>{var{curItem:t,list:n,getId:o}=e,{targetIndex:r}=p({getId:o,list:n,target:t});if(r<0)return{reachLimit:!1,item:t};var i=(r-1)%n.length;return{reachLimit:0===r,item:n.at(i)||t}},g=e=>{var t,{className:n,onSelect:u,getId:c,itemRender:p,onActiveId:m,getMoreListService:h,defaultId:g,listTopSlot:f,defaultList:_}=e,x=(0,i._)(e,["className","onSelect","getId","itemRender","onActiveId","getMoreListService","defaultId","listTopSlot","defaultList"]),b=(0,s.useRef)(),y=(0,s.useRef)(!1),w=(0,s.useRef)(null),C=(0,s.useRef)(null),{data:I,scrollIntoView:N,activeId:E,focusTo:j,goNext:T,goPrev:k,loadingMore:A,loading:M}=v({getMoreListService:h,getId:e=>c(e),listRef:w,defaultList:_}),S=null!==(t=null==I?void 0:I.list)&&void 0!==t?t:[];return(0,s.useEffect)(()=>{null==m||m(E)},[E]),(0,l.Z)(()=>{if(!M){var e=S.find(e=>c(e)===g);e&&(j(e),N(e),null==m||m(g||c(e)))}},[M]),(0,a.jsxs)("div",(0,r._)((0,o._)({ref:w,tabIndex:1,className:n,onMouseLeave:()=>{j(null)},onMouseMove:()=>{clearTimeout(b.current),y.current=!0,b.current=setTimeout(()=>{y.current=!1},50)},onKeyDown:e=>{if("ArrowDown"===e.key){e.preventDefault(),T();return}if("ArrowUp"===e.key){e.preventDefault(),k();return}if("Enter"===e.key){var t=S.find(e=>c(e)===E);t&&(null==u||u(t))}}},x),{children:[f,S.map(e=>(0,a.jsx)("div",{"data-id":c(e),ref:c(e)===E?C:null,onClick:()=>{null==u||u(e)},onMouseEnter:()=>{if(y.current){var t;j(e),null===(t=w.current)||void 0===t||t.focus()}},children:p(e)},c(e))),A||M?(0,a.jsx)("div",{className:"flex justify-center items-center",children:(0,a.jsx)(d.Z,{style:{color:"#4D53E8"},spin:!0})}):null]}))}},417536:function(e,t,n){n.d(t,{i9:()=>em,RV:()=>ev});var o=n("808549"),r=n("151064"),i=n("455069"),a=n("252237"),s=n.n(a),l=n("780601"),d=n("775699"),u=n("325618"),c=n("944647"),v=n("929034"),p=n("336205"),m=n("407821"),h=n.n(m),g=n("472772"),f=n.n(g),_=n("395245"),x=n.n(_),b=n("297998"),y=n.n(b),w=n("646576"),C=n.n(w),I=n("606121"),N=n.n(I),E=n("202282"),j={};j.styleTagTransform=N(),j.setAttributes=y(),j.insert=x().bind(null,"head"),j.domAPI=f(),j.insertStyleElement=C(),h()(E.Z,j);var T=E.Z&&E.Z.locals?E.Z.locals:void 0,k=n("120454"),A=n("871873"),M=n("335740"),S=n("889959"),z=n("380835"),O=n("707107"),L=(e,t)=>{var n=e;return Object.keys(t).forEach(e=>{n=n.replace(RegExp("\\{\\{".concat(e,"\\}\\}"),"g"),t[e])}),n},R=()=>{var e=(0,l.eh)();return t=>{var n,{queryTemplate:r,onBeforeSend:i,options:a,shortcut:s}=t,{tool_type:l}=s,d=void 0!==l&&[u.qK.ToolTypeWorkFlow,u.qK.ToolTypePlugin].includes(l),v={payload:{text:r,mention_list:[]}},p=d?U(s):{},m=(0,A.Z)({extendFiled:(0,k._)((0,o._)({},p),{device_id:String(S.ZP.deviceId)})},a),{message:h,options:g}=(null==i?void 0:i({message:v,options:m}))||{message:v,options:m};e({text:h.payload.text,mentionList:h.payload.mention_list},"shortcut",g),(0,O.Gg)(O.Kg.shortcut_use,{tool_type:l,use_components:!!(null===(n=s.components_list)||void 0===n?void 0:n.length),show_panel:(0,c.Q$)(s)})}},D=()=>{var e=(0,l.to)();return t=>{var n,r,{shortcut:i,options:a,componentsFormValues:s,onBeforeSendTemplateShortcut:d,withoutComponentsList:v=!1}=t,{tool_type:p}=i,m=B(i,s,v),h=void 0!==p&&[u.qK.ToolTypeWorkFlow,u.qK.ToolTypePlugin].includes(p)?P(i,s):{},g=F(s),f={payload:{mixList:[{type:l.zc.Text,text:m||" "},...g],mention_list:[]}},_=(0,A.Z)({extendFiled:(0,k._)((0,o._)({},h),{device_id:String(S.ZP.deviceId)})},a),x=(null==d?void 0:d({message:(0,M.Z)(f),options:(0,M.Z)(_),shortcut:i}))||{message:f,options:_};e(null!==(r=x.message)&&void 0!==r?r:f,"shortcut",x.options),(0,O.Gg)(O.Kg.shortcut_use,{tool_type:p,use_components:!!(null===(n=i.components_list)||void 0===n?void 0:n.length),show_panel:!(0,c.Q$)(i)})}},P=(e,t)=>{var{plugin_id:n,plugin_api_name:o,components_list:r,tool_info:{tool_params_list:i}={}}=e,a=Z(t,e=>{var{fileInstance:t,url:n}=e;return{value:n,resource_type:t?"uri":""}},e=>({value:e,resource_type:""})),s=(null!=i?i:[]).reduce((e,t)=>{var n,{default_value:o,name:i,refer_component:s}=t;if(!i)return e;if(!s)return e[i]={value:null!=o?o:"",resource_type:""},e;var l=null==r?void 0:null===(n=r.find(e=>e.parameter===i))||void 0===n?void 0:n.name,d=l&&a[l];return d&&(e[i]=d),e},{});return Object.keys(s).length?{shortcut_cmd_id:e.command_id,toolList:[{plugin_id:n,api_name:null!=o?o:"",parameters:s}]}:{shortcut_cmd_id:e.command_id,toolList:[]}},U=e=>{var{plugin_id:t,plugin_api_name:n,tool_info:{tool_params_list:o}={}}=e,r=(null!=o?o:[]).reduce((e,t)=>{var{default_value:n,name:o}=t;return o?(e[o]={value:null!=n?n:"",resource_type:""},e):e},{});return{shortcut_cmd_id:e.command_id,toolList:[{plugin_id:t,api_name:null!=n?n:"",parameters:r}]}},B=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{template_query:o,components_list:r}=e;if(!o)throw Error("template_query is not defined");var i=W(r,t);return n?L(o,null!=t?t:{}):L(o,i)},Z=(e,t,n)=>Object.keys(e).reduce((o,r)=>{var i=e[r];return"object"==typeof i&&i.fileInstance?(o[r]=t(i),o):(o[r]=n(i),o)},{}),F=e=>Object.keys(e).reduce((t,n)=>{var o=e[n];return q(o)?(t.push({type:l.zc.File,file:o.fileInstance,uri:o.url}),t):(V(o)&&t.push({type:l.zc.Image,file:o.fileInstance,uri:o.url,width:o.width||0,height:o.height||0}),t)},[]),q=e=>{var t;return!!("object"==typeof e&&e.fileInstance&&(null===(t=(0,z.hr)(e.fileInstance))||void 0===t?void 0:t.fileType)!=="image")},V=e=>{var t;return!!("object"==typeof e&&e.fileInstance&&(null===(t=(0,z.hr)(e.fileInstance))||void 0===t?void 0:t.fileType)==="image")},W=(e,t)=>{var n=Z(t,e=>{var t;return null==e?void 0:null===(t=e.fileInstance)||void 0===t?void 0:t.name},e=>e);return(null!=e?e:[]).reduce((e,t)=>{var o,{default_value:r,name:i,hide:a}=t;if(!i)return e;if(a)return e[i]=null!==(o=null==r?void 0:r.value)&&void 0!==o?o:"",e;var s=n[i];return s&&(e[i]=s),e},{})},G=n("991450"),Q=n("193909"),H=e=>{var{bot_info:t}=e,n=!!(null==t?void 0:t.icon_url),o=!!(null==t?void 0:t.name);return{iconVisible:n,nameVisible:o,splitLineVisible:n||o}},{Text:$}=d.ZT,Y=e=>{var{shortcuts:t,onSelect:n,onBeforeSendTextMessage:o,defaultId:a}=e,l=R(),[d,c]=(0,i.useState)("");return(0,r.jsxs)("div",{className:"p-2",children:[(0,r.jsx)("div",{className:"text-xs coz-fg-secondary mb-2 pl-2 pt-1",children:p.o.t("bot_ide_shortcut")}),(0,r.jsx)(G.W,{className:s()("w-full max-h-[312px] overflow-y-auto cursor-pointer",T["load-more-list"]),defaultId:a,getId:e=>e.command_id,onActiveId:e=>c(e),getMoreListService:()=>Promise.resolve({list:t,hasMore:!1}),onSelect:e=>{if(null==n||n(e),e.send_type===u.nu.SendTypeQuery){(null==e?void 0:e.template_query)&&l({queryTemplate:e.template_query,onBeforeSend:o,shortcut:e});return}},itemRender:e=>{var t,n,o,i,{splitLineVisible:a,iconVisible:l,nameVisible:u}=H(e);return(0,r.jsxs)("div",{className:s()("flex justify-start items-center max-w-full overflow-hidden h-[52px] px-2 py-[6px]",{"coz-mg-primary-hovered":d===e.command_id,"rounded-md":d===e.command_id}),children:[(0,r.jsx)("img",{src:(null===(t=e.shortcut_icon)||void 0===t?void 0:t.url)||Q.Z,alt:"icon",className:"w-9 h-9 p-[10px] rounded bg-white border-[0.5px] border-solid coz-stroke-primary mr-2"}),(0,r.jsx)("div",{className:"grow-0 shrink max-w-[37%] overflow-hidden box-border mr-3 flex items-center",children:(0,r.jsx)($,{className:"text-sm coz-fg-plus font-medium",ellipsis:{showTooltip:{opts:{content:e.command_name,position:"top",style:{wordBreak:"break-word"}}}},children:e.command_name})}),e.description?(0,r.jsx)("div",{className:"flex-0 max-w-[60%] overflow-hidden box-border mr-3 flex items-center",children:(0,r.jsx)($,{className:"coz-fg-secondary text-xs",ellipsis:{showTooltip:{opts:{content:e.description,position:"top",style:{wordBreak:"break-word"}}}},children:e.description})}):null,(0,r.jsxs)("div",{className:"flex items-center max-w-full flex-0 overflow-hidden box-border min-w-[100px]",children:[a?(0,r.jsx)("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMiIgaGVpZ2h0PSIxMiIgdmlld0JveD0iMCAwIDIgMTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGlkPSJWZWN0b3IgMjU5NCIgZD0iTTEgMFYxMiIgc3Ryb2tlPSIjMUQxQzIzIiBzdHJva2Utb3BhY2l0eT0iMC4xMiIvPgo8L3N2Zz4K",alt:""}):null,l?(0,r.jsx)("img",{alt:"bot icon",className:"w-[14px] h-[14px] rounded-full mr-1 ml-3",src:null===(n=e.bot_info)||void 0===n?void 0:n.icon_url}):null,u?(0,r.jsx)($,{className:"coz-fg-secondary text-xs",ellipsis:{showTooltip:{opts:{content:null===(o=e.bot_info)||void 0===o?void 0:o.name,position:"top",style:{wordBreak:"break-word"}}}},children:null===(i=e.bot_info)||void 0===i?void 0:i.name}):null]})]})}})]})},J=n("674343"),K=n("316828"),X=(0,K.j)(["mr-8px","rounded-[99px]","border-[1px]","border-solid","overflow-hidden"],{variants:{color:{grey:["coz-stroke-primary","coz-mg-secondary","backdrop-blur-[3.45px]"],white:["coz-stroke-primary","coz-bg-max","backdrop-blur-[3.45px]"],blur:["coz-stroke-image-bots","coz-bg-image-bots","backdrop-blur-[20px]"]}}}),ee=(0,K.j)(["text-lg","font-medium"],{variants:{color:{grey:["coz-fg-primary"],white:["coz-fg-primary"],blur:["coz-fg-images-bots"]}}}),et=n("341665"),{Paragraph:en,Text:eo}=d.ZT,er=e=>{var{children:t,shortcut:n,toolTipFooterSlot:o,showBotInfo:a=!1}=e,s=(0,l.wX)()!==et.Ar.MOBILE,[d,u]=(0,i.useState)(!1),{description:c,command_name:v}=n,{icon_url:p,name:m}=n.bot_info||{},h=a&&!!(m||p),g=()=>(0,r.jsxs)("div",{className:"flex flex-col items-start justify-center min-w-9",children:[v?(0,r.jsx)("div",{className:"max-w-[250px] mb-1",children:(0,r.jsx)(en,{ellipsis:!0,className:"coz-fg-plus font-bold text-sm",children:v})}):null,c?(0,r.jsx)("div",{className:"max-w-[250px]",children:(0,r.jsx)("div",{className:"coz-fg-secondary text-xs",children:c})}):null,h?(0,r.jsxs)("div",{className:"flex mt-3 gap-1 items-center",children:[p?(0,r.jsx)("img",{className:"rounded-full w-[14px] h-[14px]",src:p,alt:"bot_icon"}):null,m?(0,r.jsx)(eo,{className:"coz-fg-secondary text-xs",children:m}):null]}):null,o]});return(0,r.jsx)(J.u,{trigger:"custom",visible:d,style:{maxWidth:"283px",padding:"16px"},content:()=>g(),children:(0,r.jsx)("div",{onMouseEnter:()=>u(s),onMouseLeave:()=>u(!1),children:t})})},ei=e=>{var t,{shortcut:n,onClick:o,onBeforeSend:a,toolTipFooterSlot:s,popoverTipShowBotInfo:d=!1}=e,c=R(),v=(0,i.useRef)(null),p=(0,l.Br)(),m=()=>{var{template_query:e,agent_id:t,object_id:r}=n;if(!!e)null==o||o(),c({queryTemplate:e,options:{extendFiled:{extra:{bot_state:JSON.stringify({agent_id:t,bot_id:r})}}},onBeforeSend:a,shortcut:n})};return n.send_type!==u.nu.SendTypeQuery?null:(0,r.jsx)("div",{className:X({color:e.uiMode}),children:(0,r.jsx)(er,{shortcut:n,toolTipFooterSlot:s,showBotInfo:d,children:(0,r.jsx)(J.zx,{disabled:p,"data-testid":"chat-area.chat-input-shortcut.shortcut-button-".concat(n.command_name),contentClassName:ee({color:e.uiMode}),onClick:()=>m(),color:"secondary",icon:(null===(t=n.shortcut_icon)||void 0===t?void 0:t.url)?(0,r.jsx)("img",{alt:"icon",src:n.shortcut_icon.url,className:"h-[14px]"}):null,children:(0,r.jsx)("div",{ref:v,className:"max-w-[198px] overflow-hidden text-ellipsis",children:n.command_name})})})})},ea=n("44172"),es=e=>{var t,{shortcut:n,onClick:o,uiMode:a,toolTipFooterSlot:s,popoverTipShowBotInfo:l=!1}=e,d=(0,i.useRef)(null),v=()=>{null==o||o()};if(n.send_type!==u.nu.SendTypePanel)return null;var p=(0,c.Q$)(n);return(0,r.jsx)("div",{className:X({color:a}),children:(0,r.jsx)(er,{shortcut:n,toolTipFooterSlot:s,showBotInfo:l,children:(0,r.jsx)(J.zx,{"data-testid":"chat-area.chat-input-shortcut.shortcut-button-".concat(n.command_name),contentClassName:ee({color:a}),color:"secondary",icon:(null===(t=n.shortcut_icon)||void 0===t?void 0:t.url)?(0,r.jsx)("img",{alt:"icon",src:n.shortcut_icon.url,className:"h-[14px]"}):null,iconPosition:"left",onClick:()=>v(),children:(0,r.jsxs)("div",{className:"inline-flex items-center",children:[(0,r.jsx)("div",{ref:d,className:"max-w-[176px] overflow-hidden text-ellipsis",children:n.command_name}),!p&&(0,r.jsx)(ea.QHI,{className:"ml-[10px]"})]})})})})},el=e=>{var{onOpen:t,uiMode:n,onClose:o,isLoadMoreActive:i}=e;return(0,r.jsx)("div",{className:s()(T["load-more-shortcut-wrapper"],{[T["shortcut-white"]||""]:"white"===n,[T["shortcut-blur"]||""]:"blur"===n}),children:(0,r.jsxs)(d.y3,{"data-testid":"chat-area.shortcut.load-more-button",className:s()(T["load-more-button"],T["shortcut-button"],{"!coz-mg-primary-pressed":i&&"white"===n}),onClick:()=>{i?null==o||o():null==t||t()},children:[(0,r.jsx)("span",{className:"mr-1",children:p.o.t("More")}),i?(0,r.jsx)("img",{className:"arraw-icon",src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHZpZXdCb3g9IjAgMCAxMiAxMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgaWQ9ImNvel9hcnJvd19kb3duX2ZpbGwiPgo8cGF0aCBpZD0iVW5pb24iIGQ9Ik02LjAwMjQxIDQuODI1MzRMOS41Mzc5NCA4LjM2MDg4QzkuNzMzMiA4LjU1NjE0IDEwLjA0OTggOC41NTYxNCAxMC4yNDUgOC4zNjA4OEwxMC41OTg2IDguMDA3MzJDMTAuNzkzOSA3LjgxMjA2IDEwLjc5MzkgNy40OTU0OCAxMC41OTg2IDcuMzAwMjJMNi43MDk1MSAzLjQxMTEzQzYuMzE4OTkgMy4wMjA2MSA1LjY4NTgyIDMuMDIwNjEgNS4yOTUzIDMuNDExMTNMMS40MDYyMSA3LjMwMDIyQzEuMjEwOTUgNy40OTU0OCAxLjIxMDk1IDcuODEyMDYgMS40MDYyMSA4LjAwNzMyTDEuNzU5NzcgOC4zNjA4OEMxLjk1NTAzIDguNTU2MTQgMi4yNzE2MSA4LjU1NjE0IDIuNDY2ODcgOC4zNjA4OEw2LjAwMjQxIDQuODI1MzRaIiBmaWxsPSJjdXJyZW50Q29sb3IiIGZpbGwtb3BhY2l0eT0iMC41Ii8+CjwvZz4KPC9zdmc+Cg==",alt:"up"}):(0,r.jsx)("img",{className:"arraw-icon",src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHZpZXdCb3g9IjAgMCAxMiAxMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgaWQ9ImNvel9hcnJvd19kb3duX2ZpbGwiPgo8cGF0aCBpZD0iVW5pb24iIGQ9Ik02LjAwMjQxIDcuMTc0NjZMOS41Mzc5NCAzLjYzOTEyQzkuNzMzMiAzLjQ0Mzg2IDEwLjA0OTggMy40NDM4NiAxMC4yNDUgMy42MzkxMkwxMC41OTg2IDMuOTkyNjhDMTAuNzkzOSA0LjE4Nzk0IDEwLjc5MzkgNC41MDQ1MiAxMC41OTg2IDQuNjk5NzhMNi43MDk1MSA4LjU4ODg3QzYuMzE4OTkgOC45NzkzOSA1LjY4NTgyIDguOTc5MzkgNS4yOTUzIDguNTg4ODdMMS40MDYyMSA0LjY5OTc4QzEuMjEwOTUgNC41MDQ1MiAxLjIxMDk1IDQuMTg3OTQgMS40MDYyMSAzLjk5MjY4TDEuNzU5NzcgMy42MzkxMkMxLjk1NTAzIDMuNDQzODYgMi4yNzE2MSAzLjQ0Mzg2IDIuNDY2ODcgMy42MzkxMkw2LjAwMjQxIDcuMTc0NjZaIiBmaWxsPSJjdXJyZW50Q29sb3IiIGZpbGwtb3BhY2l0eT0iMC41Ii8+CjwvZz4KPC9zdmc+Cg==",alt:"down"})]})})},ed=n("186118"),eu={};eu.styleTagTransform=N(),eu.setAttributes=y(),eu.insert=x().bind(null,"head"),eu.domAPI=f(),eu.insertStyleElement=C(),h()(ed.Z,eu);var ec=ed.Z&&ed.Z.locals?ed.Z.locals:void 0,ev=e=>{var{shortcuts:t,onActiveShortcutChange:n,className:a,wrapperClassName:p,defaultId:m,uiMode:h="white",wrapperStyle:g,toolTipFooterSlot:f,onBeforeSendTemplateShortcut:_,onBeforeSendTextMessage:x,popoverTipShowBotInfo:b=!1}=e,y=(0,i.useRef)(null),[w,C]=(0,i.useState)(!1),[I,N]=(0,i.useState)(void 0),[E,j]=(0,i.useState)(!1),T=D(),k=(0,l.Lx)(),A=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];N(e);var o=(null==e?void 0:e.send_type)===u.nu.SendTypePanel&&!t;null==n||n(e,o),j(o)},M=e=>{var t=(0,c.Q$)(e);t&&z((0,c.Rw)(e),e),A(e,t),C(!1)},S=()=>{j(!1),A(void 0)},z=(e,t)=>{if(!!t){var{agent_id:n,object_id:o,components_list:r,tool_info:i}=t,a=!!(null==i?void 0:i.tool_name)&&!(null==r?void 0:r.length);T({shortcut:t,options:{extendFiled:{extra:{bot_state:JSON.stringify({agent_id:n,bot_id:o})}}},componentsFormValues:e,onBeforeSendTemplateShortcut:_,withoutComponentsList:a}),S()}};return(null==t?void 0:t.length)?E&&I?(0,r.jsx)(v.n,{shortcut:I,onSubmit:e=>{if(!!I){var{agent_id:t,object_id:n}=I;T({shortcut:I,options:{extendFiled:{extra:{bot_state:JSON.stringify({agent_id:t,bot_id:n})}}},componentsFormValues:e,onBeforeSendTemplateShortcut:_}),S()}},visible:E,onClose:()=>{A(void 0)}}):(0,r.jsx)("div",{className:s()(ec["shortcut-bar"],a,"flex justify-center items-center w-full"),children:(0,r.jsx)(d.J2,{content:(0,r.jsx)(Y,{defaultId:m,shortcuts:t,onBeforeSendTextMessage:x,onSelect:M}),onVisibleChange:C,position:"topLeft",trigger:"custom",visible:w,spacing:{x:0,y:9},getPopupContainer:()=>y.current||document.body,onClickOutSide:()=>C(!1),onEscKeyDown:()=>C(!1),children:(0,r.jsx)("div",{ref:y,className:s()(p,"relative flex justify-start pb-4"),style:(0,o._)({maxWidth:k},g),children:(0,r.jsx)(d.Dj,{style:{width:"100%"},minVisibleItems:1,items:t,visibleItemRenderer:e=>(0,r.jsxs)(r.Fragment,{children:[e.send_type===u.nu.SendTypeQuery&&(0,r.jsx)(ei,{uiMode:h,shortcut:e,onBeforeSend:x,toolTipFooterSlot:f,popoverTipShowBotInfo:b,onClick:()=>M(e)},e.command_id),e.send_type===u.nu.SendTypePanel&&(0,r.jsx)(es,{uiMode:h,shortcut:e,toolTipFooterSlot:f,popoverTipShowBotInfo:b,onClick:()=>M(e)},e.command_id)]}),overflowRenderer:e=>e.length?(0,r.jsx)(el,{uiMode:h,isLoadMoreActive:w,shortcuts:t,onOpen:()=>C(!0),onClose:()=>C(!1),getPopupContainer:()=>y.current}):null})})})}):null};n("184362"),n("723527");var ep=n("765377"),em=e=>{var{bizScene:t,showBackground:n}=e;if("agentApp"===t)return"grey";if("home"===t)return n?"blur":"white";if("store"===t||"debug"===t||"websdk"===t)return n?"blur":"grey";return(0,ep.Sn)(t),"white"}},929034:function(e,t,n){n.d(t,{n:()=>et});var o=n("151064"),r=n("455069"),i=n("780601"),a=n("775699"),s=n("44172"),l=n("875025"),d=n("380835"),u=()=>{var e=(0,i.CJ)();return t=>{var n,o,{file:r,onProgress:i,onError:a,onSuccess:s}=t,l=e("upload-plugin");if(!!l){var u=new l({file:r,type:(null===(n=(0,d.hr)(r))||void 0===n?void 0:n.fileType)==="image"?"image":"object"}),c=!1,v=50,p=()=>{v<85&&(v+=5,null==i||i(v))},m=setTimeout(()=>{c=!0,o=window.setInterval(p,100)},1500);u.on("progress",e=>{var{percent:t}=e;if(!c)m&&h(),null==i||i(t)}),u.on("error",e=>{null==a||a({status:e.extra.errorCode}),h()}),u.on("complete",e=>{var{uploadResult:{Url:t,Uri:n,ImageHeight:o=0,ImageWidth:r=0}}=e;null==s||s(t||n||"",r,o),h()})}function h(){clearTimeout(m),clearInterval(o),o=void 0,o=void 0,c=!1}}},c=n("808549"),v=n("473980"),p=(0,r.createContext)({isSendMessageLock:!1}),m=n("120454"),h=n("252237"),g=n.n(h),f=n("336205"),_=n("407821"),x=n.n(_),b=n("472772"),y=n.n(b),w=n("395245"),C=n.n(w),I=n("297998"),N=n.n(I),E=n("646576"),j=n.n(E),T=n("606121"),k=n.n(T),A=n("323946"),M={};M.styleTagTransform=k(),M.setAttributes=N(),M.insert=C().bind(null,"head"),M.domAPI=y(),M.insertStyleElement=j(),x()(A.Z,M);var S=A.Z&&A.Z.locals?A.Z.locals:void 0,z=e=>{var{name:t,description:n,required:r=!0}=e;return(0,o.jsxs)("div",{className:"w-full flex items-center px-2 mb-[2px]",children:[(0,o.jsx)(a.l0.Label,{text:(0,o.jsx)(a.ZT.Text,{ellipsis:{showTooltip:!0},className:S.text,children:t}),required:r,className:S.label}),!!n&&(0,o.jsx)(a.u,{content:n,children:(0,o.jsx)(s.aUG,{className:S.icon})})]})},O=n("470064"),L=n("790021"),R={};R.styleTagTransform=k(),R.setAttributes=N(),R.insert=C().bind(null,"head"),R.domAPI=y(),R.insertStyleElement=j(),x()(L.Z,R);var D=L.Z&&L.Z.locals?L.Z.locals:void 0,P=e=>{var t,n,{file:r,disabled:i,inputType:l,onRemove:u,onRetry:c}=e,v="uploadFail"===r.status,p="uploading"===r.status,m=r.fileInstance&&(null===(t=(0,d.hr)(r.fileInstance))||void 0===t?void 0:t.fileType),h=m&&(null===(n=(0,O.Td)(m))||void 0===n?void 0:n.icon);return(0,o.jsxs)("div",{className:g()(D.file,"flex border border-solid rounded-lg items-center w-full coz-stroke-primary",{[D["file-uploading"]||""]:p}),style:{"--var-percent":"".concat(r.percent,"%")},children:[(0,o.jsx)("img",{src:null!=h?h:r.url,className:g()("w-6 h-6","image"===m&&"rounded border border-solid coz-stroke-primary")}),(0,o.jsx)(a.ZT.Text,{ellipsis:!0,className:"mx-2 flex-1 text-sm",children:r.name}),v?(0,o.jsxs)("div",{onClick:e=>{e.stopPropagation(),!i&&c()},className:D.retry,children:[(0,o.jsx)(s.bMz,{className:"coz-fg-hglt-red"}),(0,o.jsx)("div",{children:f.o.t("Retry")})]}):null,(0,o.jsx)(a.hU,{className:g()("close-btn w-5 h-5",D["delete-btn"]),disabled:i,onClick:e=>{e.stopPropagation(),u()},theme:"borderless",size:"small",icon:(0,o.jsx)(s.s3j,{className:D["delete-icon"]})})]})},U=e=>{var{value:t,name:n,uploadFile:i,onChange:l,inputType:d,disabled:u,toggle:p}=e,h=(0,v._)(e,["value","name","uploadFile","onChange","inputType","disabled","toggle"]),[_,x]=(0,r.useState)(),b=(0,a.CP)(n),y=(0,r.useRef)(null==_?void 0:_.uid),w=e=>{e.fileInstance&&(x((0,m._)((0,c._)({},e),{percent:0,status:"uploading"})),b.setError(!0),y.current=null==e?void 0:e.uid,null==i||i({file:e.fileInstance,onProgress:t=>{if(y.current===e.uid)x((0,m._)((0,c._)({},e),{percent:t,status:"uploading"}))},onSuccess:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(y.current===e.uid)null==l||l({fileInstance:e.fileInstance,url:t,width:n,height:o}),x((0,m._)((0,c._)({},e),{response:t,percent:100,status:"success"}))},onError:()=>{if(y.current===e.uid)b.setError(!1),x((0,m._)((0,c._)({},e),{status:"uploadFail"}))}}))};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a.gq,(0,m._)((0,c._)({action:"",className:"w-full",draggable:!0,limit:1},h),{disabled:u,onAcceptInvalid:()=>{a.FN.error(f.o.t("shortcut_Illegal_file_format"))},onSizeError:()=>{h.maxSize&&a.FN.error(f.o.t("file_too_large",{max_size:"".concat(h.maxSize/1024,"MB")}))},customRequest:e=>{var{onSuccess:t}=e;t("")},showUploadList:!1,onChange:e=>{var t,{currentFile:n}=e;y.current!==n.uid&&(!h.maxSize||(null===(t=n.fileInstance)||void 0===t?void 0:t.size)&&n.fileInstance.size<=1024*h.maxSize)&&w(n)},children:_?(0,o.jsx)(P,{file:_,inputType:d,onRemove:()=>{y.current=void 0,x(void 0),null==l||l(""),setTimeout(()=>{b.setError(!0)})},onRetry:()=>{_&&w(_)}}):(0,o.jsx)(a.y3,{icon:(0,o.jsx)(s.N_R,{}),disabled:u,className:g()(D["upload-button"],"w-full"),children:(0,o.jsx)("span",{className:D["upload-button-text-short"],children:f.o.t("shortcut_component_upload_component_placeholder")})})})),!_&&(0,o.jsx)(a.hU,{disabled:u,icon:(0,o.jsx)(s.xu0,{}),onClick:p})]})},B=e=>{var{disabled:t,onChange:n,toggle:r}=e;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a.u3,{disabled:t,onChange:n,className:D.input}),(0,o.jsx)(a.hU,{disabled:t,icon:(0,o.jsx)(s.s3j,{}),onClick:r})]})},Z=(0,a.Q2)(e=>{var[t,n]=(0,r.useState)(!1),i="error"===e.validateStatus,s=(0,a.CP)(e.name);return(0,r.useEffect)(()=>{setTimeout(()=>{var t;null===(t=e.onChange)||void 0===t||t.call(e,""),setTimeout(()=>{s.setError(!0)})})},[t]),(0,o.jsx)("div",{className:g()("flex items-center justify-start gap-2",D.container,i&&D["container-error"]),children:t?(0,o.jsx)(B,(0,c._)({toggle:()=>{n(!1)}},e)):(0,o.jsx)(U,(0,c._)({toggle:()=>{n(!0)}},e))})}),F=e=>e.map(e=>e.required?(0,m._)((0,c._)({},e),{validator:(e,t)=>!!(null==t?void 0:t.trim())}):e),q=()=>(0,r.useContext)(p),V=n("843309"),W={};W.styleTagTransform=k(),W.setAttributes=N(),W.insert=C().bind(null,"head"),W.domAPI=y(),W.insertStyleElement=j(),x()(V.Z,W);var G=V.Z&&V.Z.locals?V.Z.locals:void 0,Q=e=>{var{context:{readonly:t,dsl:n},props:{formFields:o=[]}}=e,r=(0,a.cl)(),i=o.some(e=>{var t,o,i,a=!r.values[e],s=!!(null===(t=r.errors)||void 0===t?void 0:t[e]),d=null===(i=(0,l.y3)(n,e))||void 0===i?void 0:null===(o=i.props)||void 0===o?void 0:o.defaultValue;return(null==d?void 0:d.value)?s:s||a}),{isSendMessageLock:s}=q();return t||i||s},H={"@flowpd/cici-components/Input":e=>{var{context:{readonly:t},props:{name:n,description:r,rules:i,defaultValue:s}}=e,l=(0,v._)(e.props,["name","description","rules","defaultValue"]),d=!(null==s?void 0:s.value);return(0,o.jsxs)("div",{children:[(0,o.jsx)(z,{required:d,name:n,description:r}),(0,o.jsx)(a.l0.Input,(0,c._)({disabled:t,fieldStyle:{padding:0},placeholder:null==s?void 0:s.value,className:"w-full",field:n,noLabel:!0,rules:F(i)},l))]})},"@flowpd/cici-components/Select":e=>{var{context:{readonly:t},props:{name:n,description:r,defaultValue:i}}=e,s=(0,v._)(e.props,["name","description","defaultValue"]),l=!(null==i?void 0:i.value);return(0,o.jsxs)("div",{children:[(0,o.jsx)(z,{name:n,description:r,required:l}),(0,o.jsx)(a.N5,(0,c._)({disabled:t,fieldStyle:{padding:0},className:"w-full",field:n,initValue:null==i?void 0:i.value,noLabel:!0},s))]})},"@flowpd/cici-components/Upload":e=>{var{context:{uploadFile:t,readonly:n},props:{name:r,description:i,rules:a}}=e,s=(0,v._)(e.props,["name","description","rules"]);return(0,o.jsxs)("div",{children:[(0,o.jsx)(z,{name:r,description:i}),(0,o.jsx)(Z,(0,c._)({field:r,noLabel:!0,name:r,fieldStyle:{padding:0},uploadFile:t,disabled:n,rules:n?void 0:a},s))]})},"@flowpd/cici-components/Placeholder":()=>(0,o.jsx)("div",{className:"flex items-center justify-center rounded-lg coz-bg-plus text-center text-xs font-medium coz-fg-secondary ",style:{height:58},children:f.o.t("shortcut_modal_components")}),"@flowpd/cici-components/ColumnLayout":e=>{var{children:t}=e;return(0,o.jsx)("div",{className:"flex items-center justify-between w-full mb-3 gap-2",children:t})},"@flowpd/cici-components/Form":e=>{var{context:{onChange:t,onSubmit:n,dsl:i},children:s}=e,d=(0,r.useRef)();return(0,o.jsx)(a.l0,{className:"w-full",autoComplete:"off",getFormApi:e=>d.current=e,onChange:e=>null==t?void 0:t(e.values),onSubmit:e=>{if(!!n){var t=(0,l.lD)(i),o=Object.entries(e).reduce((e,n)=>{var[o,r]=n,i=t.find(e=>e.id===o);return i&&!r?e[o]=i.defaultValue:e[o]=r,e},{});t.forEach(e=>{var{id:t,defaultValue:n}=e;t&&!(t in o)&&(o[t]=n)}),n(o)}},children:s})},"@flowpd/cici-components/PageContainer":e=>{var{children:t}=e;return(0,o.jsx)(o.Fragment,{children:t})},"@flowpd/cici-components/Button":e=>{var{context:t,props:n}=e,r=Q({context:t,props:n});return(0,o.jsx)("div",{className:"flex justify-end",children:(0,o.jsx)(a.hU,{theme:"borderless",className:G.button,htmlType:"submit",size:"small",disabled:r,icon:(0,o.jsx)(s.h9l,{})})})}},$=e=>{var t,n,o,r;return null!==(r=e.children)&&void 0!==r?r:null===(t=null!==(o=null===(n=e.props)||void 0===n?void 0:n.Columns)&&void 0!==o?o:[])||void 0===t?void 0:t.reduce((e,t)=>(t.children&&e.push(...t.children),e),[])},Y=e=>{var{elementId:t}=e,n=(0,v._)(e,["elementId"]),{dsl:r}=n,i=null==r?void 0:r.elements[t],a=(null==i?void 0:i.type)||"",s=a in H?H[a]:null,l=i&&$(i);return s?(0,o.jsx)(s,{context:n,props:null==i?void 0:i.props,children:null==l?void 0:l.map(e=>(0,o.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,o.jsx)(Y,(0,c._)({elementId:e},n),e)}))}):null},J=e=>{var{dsl:t}=e,n=(0,v._)(e,["dsl"]),r=(0,i.Br)();return(0,o.jsx)(p.Provider,{value:{isSendMessageLock:r},children:(0,o.jsx)(Y,(0,c._)({elementId:t.rootID,dsl:t},n))})},K=n("394727"),X={};X.styleTagTransform=k(),X.setAttributes=N(),X.insert=C().bind(null,"head"),X.domAPI=y(),X.insertStyleElement=j(),x()(K.Z,X);var ee=K.Z&&K.Z.locals?K.Z.locals:void 0,et=e=>{var t,{shortcut:n,onClose:d,visible:c,readonly:v,onSubmit:p}=e,m=(0,r.useRef)(null),h=u(),g=(0,i.Lx)(),f=(0,r.useMemo)(()=>{var e,t,o=null!==(t=null===(e=n.components_list)||void 0===e?void 0:e.filter(e=>!e.hide))&&void 0!==t?t:[];return(0,l.Wo)(o)},[n.components_list]);return c?(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{ref:m,className:ee["shortcut-template"],style:{width:"calc(".concat(g," - 48px)")},children:[(0,o.jsxs)("div",{className:"flex items-center text-sm coz-fg-primary px-4 py-[6px] coz-bg-primary rounded-t-3xl h-8",children:[(null===(t=n.shortcut_icon)||void 0===t?void 0:t.url)?(0,o.jsx)("img",{src:n.shortcut_icon.url,alt:"icon",className:"mr-1 h-[14px]"}):null,(0,o.jsx)("div",{children:n.command_name}),(0,o.jsx)(a._3,{icon:(0,o.jsx)(s.ses,{}),onClick:d,wrapperClass:"ml-auto"})]}),(0,o.jsx)("div",{className:"p-3",children:(0,o.jsx)(J,{uploadFile:e=>{var{file:t,onError:n,onProgress:o,onSuccess:r}=e;null==h||h({file:t,onProgress:o,onError:n,onSuccess:r})},readonly:v,onSubmit:e=>{null==p||p(e)},dsl:f})})]})}):null}},184362:function(e,t,n){n.d(t,{D:()=>eA});var o=n("825955"),r=n("151064"),i=n("455069"),a=n("497082"),s=n("336205"),l=n("775699"),d=n("44172"),u=n("325618"),c=n("271855"),v=n("19863"),p=n("698585"),m=n("234463"),h=n("808549"),g=n("120454"),f=n("473980"),_=n("252237"),x=n.n(_),b=n("960394"),y=n("674343"),w=e=>e.map(e=>(0,g._)((0,h._)({},e),{id:(0,m.h1)()})),C=e=>e.map(e=>{var{id:t,options:n}=e,o=(0,f._)(e,["id","options"]);return(0,g._)((0,h._)({},o),{options:o.input_type===u.n$.Select?n:[]})}),I=(e,t)=>{var n={};return e.forEach((e,t)=>{if(e.name){if(n[e.name]){var o;null===(o=n[e.name])||void 0===o||o.push(t)}else n[e.name]=[t]}}),setTimeout(()=>{Object.entries(n).forEach(e=>{var[n,o]=e,r=o.length>1;o.forEach(e=>{t.setError("values.".concat(e,".name"),!r)})})}),Object.entries(n).some(e=>{var[t,n]=e;return n.length>1})},N=()=>({type:"text"}),E={text:()=>({input_type:u.n$.TextInput}),select:e=>{var{type:t}=e;if("select"===t)return{input_type:u.n$.Select,options:e.options}},upload:e=>{if("upload"===e.type){var{uploadTypes:t}=e;return t.length>1?{input_type:u.n$.MixUpload,upload_options:t}:{input_type:t.at(0),upload_options:void 0}}}},j=e=>{var{type:t}=e,n=E[t],o=n&&n(e);return o?o:{input_type:u.n$.TextInput}},T=e=>[u.n$.UploadImage,u.n$.UploadDoc,u.n$.UploadTable,u.n$.UploadAudio,u.n$.CODE,u.n$.ARCHIVE,u.n$.PPT,u.n$.VIDEO,u.n$.TXT,u.n$.MixUpload].includes(e),k={[u.n$.TextInput]:()=>({type:"text"}),[u.n$.Select]:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{type:"select",options:e}},upload:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{type:"upload",uploadTypes:e}}},A=e=>{var{input_type:t,options:n,upload_options:o}=e;if(!t)return N();if(T(t))return(0,k.upload)(o);var r=k[t];return r?r(n):N()},M=e=>{var{components:t,record:n,checked:o}=e;return t.map(e=>e.id===n.id?(0,g._)((0,h._)({},e),{hide:!o}):e)},S=e=>{var t,n,{components:o,record:r,toolInfo:i}=e,{default_value:a}=null!=r?r:{},s=!!(null==a?void 0:a.value);var l=(null==i?!void 0:!i.tool_name)||!!(null==i?void 0:null===(n=i.tool_params_list)||void 0===n?void 0:null===(t=n.find(e=>e.name===r.parameter))||void 0===t?void 0:t.required),d=r.hide&&o.filter(e=>!e.hide).length>=10;return l&&!s||d},z=n("381357"),O=n("470064"),L=n("407821"),R=n.n(L),D=n("472772"),P=n.n(D),U=n("395245"),B=n.n(U),Z=n("297998"),F=n.n(Z),q=n("646576"),V=n.n(q),W=n("606121"),G=n.n(W),Q=n("840955"),H={};H.styleTagTransform=G(),H.setAttributes=F(),H.insert=B().bind(null,"head"),H.domAPI=P(),H.insertStyleElement=V(),R()(Q.Z,H);var $=Q.Z&&Q.Z.locals?Q.Z.locals:void 0,{Checkbox:Y,CheckboxGroup:J}=l.l0,K=[u.n$.UploadImage,u.n$.UploadAudio,u.n$.UploadDoc,u.n$.UploadTable,u.n$.CODE,u.n$.ARCHIVE,u.n$.PPT,u.n$.VIDEO,u.n$.TXT],X=e=>{var{value:t=K,onChange:n}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"coz-fg-plus text-[16px] font-medium",children:s.o.t("shortcut_modal_upload_component_supported_file_formats")}),(0,r.jsx)(J,{field:"values.uploadTypes",onChange:e=>{null==n||n(e)},initValue:t,className:x()("flex flex-wrap flex-row",$["upload-content"]),noLabel:!0,noErrorMessage:!0,rules:[{validator:(e,t)=>!!(null==t?void 0:t.length),message:s.o.t("shortcut_modal_please_select_file_formats_for_upload_component_tip")}],children:O.W_.map(e=>{var{type:n,label:o,icon:i}=e;return(0,r.jsx)("div",{className:"flex-1 basis-1/2",children:(0,r.jsx)(Y,{className:"flex-row-reverse justify-end",noLabel:!0,defaultChecked:null==t?void 0:t.includes(n),value:n,children:(0,r.jsxs)("div",{className:"flex gap-1",children:[(0,r.jsx)("img",{src:i,alt:o,className:"w-5 h-[25px] mr-2"}),o]})})},n)})})]})},ee=n("33575"),et=Symbol.for("chat-area-plugins-chat-shortcuts-component-options-dnd-list"),en=e=>{var{options:t,onChange:n}=e,o=t.length>1,a=(0,i.useMemo)(()=>e=>{var{data:a,connect:u}=e,c=(0,i.useRef)(null),v=(0,i.useRef)(null);return u(c,v),(0,r.jsxs)("div",{ref:c,className:"flex items-center mb-6 last:mb-0",children:[(0,r.jsx)(l.u3,{className:"flex-1",value:a.value,maxLength:20,onChange:e=>{n(t=>{var n=t.findIndex(e=>e.id===a.id);return t.splice(n,1,{value:e,id:a.id}),[...t]})}}),(0,r.jsx)("div",{className:"ml-2",ref:v,children:(0,r.jsx)(l.hU,{size:"small",className:o?"cursor-grab":"",icon:(0,r.jsx)(d.SdY,{}),disabled:!o,theme:"borderless",type:"tertiary"})}),(0,r.jsx)("div",{className:"ml-2",children:(0,r.jsx)(l.u,{content:s.o.t("Remove"),children:(0,r.jsx)(l.hU,{size:"small",icon:(0,r.jsx)(d.bQR,{}),type:"tertiary",theme:"borderless",disabled:t.length<=1,onClick:()=>{n(e=>e.filter(e=>e.id!==a.id))}})})})]})},[o]);return(0,r.jsx)(ee.c,{type:et,list:t,itemRender:a,onChange:n,enabled:o})},eo=(0,l.Q2)(e=>{var{value:t,onChange:n,hasError:o}=e,[a,u]=(0,i.useState)([]);return(0,i.useEffect)(()=>{u(((null==t?void 0:t.length)?t:[""]).map(e=>({value:e,id:(0,m.h1)()})))},[]),(0,i.useEffect)(()=>{var e=a.map(e=>{var t;return null===(t=e.value)||void 0===t?void 0:t.trim()}).filter(e=>!!e);null==n||n(e)},[a]),(0,r.jsxs)("div",{className:"flex flex-col items-start",children:[(0,r.jsx)("div",{className:"coz-fg-plus mb-[14px] font-medium",children:s.o.t("shortcut_modal_selector_component_options")}),(0,r.jsx)("div",{className:"flex justify-between",children:(0,r.jsx)(l.y3,{size:"small",type:"tertiary",theme:"borderless",disabled:a.length>=20,icon:(0,r.jsx)(d.N_R,{}),className:"!coz-fg-hglt text-sm font-medium",onClick:()=>{u([...a,{value:"",id:(0,m.h1)()}])},children:s.o.t("shortcut_modal_selector_component_options")})}),(0,r.jsx)("div",{className:"max-h-40 my-6 overflow-y-auto",children:(0,r.jsx)(en,{options:a,onChange:u})})]})}),er=e=>{var t,n=(0,l.tL)(e.field),o=(0,l.CP)(e.field);return(0,r.jsx)("div",{onMouseEnter:()=>o.setError(""),children:(0,r.jsx)(eo,(0,g._)((0,h._)({},e),{pure:!0,hasError:!!(null===(t=n.error)||void 0===t?void 0:t.length),trigger:"custom",rules:[{validator:(e,t)=>!!(null==t?void 0:t.length),message:s.o.t("shortcut_modal_selector_component_no_options_error")}]}))})},ei=e=>{var{type:t}=e;return"text"===t?{type:t}:"select"===t?{type:t,options:e.options}:"upload"===t?{type:t,uploadTypes:e.uploadTypes}:e},{RadioGroup:ea,Radio:es}=l.l0,el={text:s.o.t("shortcut_component_type_text"),select:s.o.t("shortcut_component_type_selector"),upload:s.o.t("shortcut_modal_components_modal_upload_component")},ed=e=>{var t,{value:n,onSubmit:a,disabled:d=!1}=e,[u,c]=(0,i.useState)(n),[v,p]=(0,i.useState)(n),[m,h]=(0,i.useState)(!1),g=(0,i.useRef)(null);var f=(t=(0,o._)(function*(){var e;if(yield null===(e=g.current)||void 0===e?void 0:e.formApi.validate()){if(!v)return;null==a||a(v),c(v),h(!1)}}),function(){return t.apply(this,arguments)});return(0,i.useEffect)(()=>{c(n)},[n]),(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(l.J2,{trigger:"custom",footer:null,visible:m,position:"topRight",onClickOutSide:()=>h(!1),content:()=>(0,r.jsxs)("div",{className:"p-6 w-[288px]",children:[(0,r.jsx)(eu,{ref:g,value:u,onChange:p}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)(y.zx,{color:"highlight",onClick:()=>h(!1),children:s.o.t("cancel")}),(0,r.jsx)(y.zx,{onClick:f,children:s.o.t("Confirm")})]})]}),children:(0,r.jsx)(l.u3,{className:x()("w-full",d&&"!pointer-events-auto"),suffix:(0,r.jsx)(z.Z,{onClick:()=>h(!m)}),placeholder:s.o.t("shortcut_modal_selector_component_default_text"),value:el[null==u?void 0:u.type],onClick:()=>h(!m),disabled:d,readonly:!0})})})})})},eu=(0,i.forwardRef)((e,t)=>{var{value:n,onChange:a}=e,[d,u]=(0,i.useState)(n.type),c=ec(n),v=(0,i.useRef)(null);return(0,i.useImperativeHandle)(t,()=>({formApi:{validate:(0,o._)(function*(){try{var e,t;if("select"===d)return!!(yield null===(e=v.current)||void 0===e?void 0:e.formApi.validate(["values.options"]));if("upload"===d)return!!(yield null===(t=v.current)||void 0===t?void 0:t.formApi.validate(["values.uploadTypes"]));return!0}catch(e){if("select"===d){var n,o=null==e?void 0:null===(n=e.values)||void 0===n?void 0:n.options;o&&l.FN.error(o)}if("upload"===d){var r,i=null==e?void 0:null===(r=e.values)||void 0===r?void 0:r.uploadTypes;i&&l.FN.error(i)}return!1}})}})),(0,r.jsxs)(l.l0,{autoComplete:"off",ref:v,initValues:{values:n},className:"flex flex-col gap-6",onValueChange:e=>{var{values:t}=e;null==a||a(ei(t))},children:[(0,r.jsx)("div",{className:"coz-fg-plus text-[16px] font-medium",children:s.o.t("shortcut_modal_components_modal_component_type")}),(0,r.jsx)(ea,{fieldStyle:{padding:0},className:"flex flex-col !p-0 gap-3",defaultValue:d,field:"values.type",noLabel:!0,onChange:e=>{u(e.target.value)},children:Object.entries(c).map(e=>{var[t,{label:n}]=e;return(0,r.jsx)(es,{value:t,children:n})})}),Object.entries(c).map(e=>{var[t,{render:n}]=e;return(0,r.jsx)("div",{className:x()({hidden:t!==d}),children:null==n?void 0:n()},t)})]})}),ec=e=>({text:{label:s.o.t("shortcut_component_type_text")},select:{label:s.o.t("shortcut_component_type_selector"),render:()=>(0,r.jsx)(er,{field:"values.options",value:null==e?void 0:e.options})},upload:{label:s.o.t("shortcut_modal_components_modal_upload_component"),render:()=>(0,r.jsx)(X,{value:null==e?void 0:e.uploadTypes})}}),{Text:ev}=l.ZT,ep=e=>{var{toolInfo:t,parameter:n}=e,{tool_params_list:o=[]}=t,{name:i,type:a,required:l,desc:u}=o.find(e=>e.name===n)||{};return(0,r.jsxs)("div",{className:"px-2 flex items-center justify-center coz-fg-secondary max-w-[86px]",children:[(0,r.jsx)(ev,{className:"mr-1",ellipsis:!0,children:i}),(0,r.jsx)(y.u,{className:"max-w-[226px]",content:(0,r.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(ev,{ellipsis:{showTooltip:{opts:{content:i||"",position:"top"}}},children:(0,r.jsx)("span",{className:"text-sm font-medium mr-[9px]",children:i||"-"})}),(0,r.jsx)("span",{className:"rounded coz-mg-primary px-[6px] py-[1px] mr-[3px]",children:a}),!!l&&(0,r.jsx)("span",{className:"rounded coz-mg-primary px-[6px] py-[1px]",children:s.o.t("workflow_add_parameter_required")})]}),(0,r.jsx)("span",{className:"mt-[3px] coze-fg-primary text-sm",children:u||"-"})]},i),children:(0,r.jsx)(d.aUG,{})})]})},em=()=>(0,r.jsx)(l.u3,{disabled:!0}),eh=(0,l.Q2)(e=>{var{value:t,onSelect:n}=e,o=(0,f._)(e,["value","onSelect"]);return(0,r.jsx)(l.Ph,(0,g._)((0,h._)({},o),{showClear:!!(null==t?void 0:t.value),onClear:()=>{null==n||n({type:u.n$.TextInput,value:""})},value:null==t?void 0:t.value,onSelect:e=>{var o={type:(null==t?void 0:t.type)||u.n$.TextInput,value:e};return null==n||n(o),o}}))},{valueKey:"value",onKeyChangeFnName:"onSelect"}),eg=(0,l.Q2)(e=>{var{value:t,onChange:n}=e,o=(0,f._)(e,["value","onChange"]);return(0,r.jsx)(l.u3,(0,g._)((0,h._)({value:null==t?void 0:t.value},o),{maxLength:100,onChange:e=>{var o={type:(null==t?void 0:t.type)||u.n$.TextInput,value:e};return null==n||n(o),o}}))},{valueKey:"value",onKeyChangeFnName:"onChange"}),ef=e=>{var{componentType:t,field:n,disabled:o=!1}=e,{type:i}=t;return"text"===i?(0,r.jsx)(eg,{noLabel:!0,value:{type:u.n$.TextInput,value:""},field:n,noErrorMessage:!0,placeholder:s.o.t("shortcut_modal_use_tool_parameter_default_value_placeholder"),disabled:o}):"select"===i?(0,r.jsx)(eh,{value:{type:u.n$.TextInput,value:""},noLabel:!0,style:{width:"100%"},field:n,noErrorMessage:!0,optionList:t.options.map(e=>({label:e,value:e})),disabled:o}):"upload"===i?(0,r.jsx)(em,{}):(0,r.jsx)(r.Fragment,{})},e_=e=>{var{disabled:t,children:n}=e,o=(0,f._)(e,["disabled","children"]);return t?(0,r.jsx)(r.Fragment,{children:n}):(0,r.jsx)(l.u,(0,g._)((0,h._)({},o),{children:n}))},ex=e=>{var{components:t,onChange:n,toolType:o,disabled:i,toolInfo:a}=e,u=!i,c=void 0===o;return{key:"operation",title:null,width:c?"80px":"40px",render:(e,o)=>(0,r.jsxs)("div",{className:"flex items-center pl-[12px]",children:[(0,r.jsx)(y.rs,{checked:!o.hide,disabled:S({components:t,record:o,toolInfo:a}),size:"mini",onChange:e=>null==n?void 0:n(M({components:t,record:o,checked:e}))}),c?(0,r.jsx)("div",{className:"px-2",children:(0,r.jsx)(e_,{content:s.o.t("Remove"),disabled:!u,children:(0,r.jsx)(l.hU,{size:"small",theme:"borderless",type:"tertiary",disabled:!u,icon:(0,r.jsx)(d.bQR,{}),onClick:()=>{null==n||n(t.filter(e=>e.id!==o.id))}})})}):null]})}},eb=e=>{var{components:t,disabled:n}=e,o=t.length>1&&!n;return{name:{key:"name",title:(0,r.jsx)(l.l0.Label,{className:"leading-5 p-0 m-0",text:s.o.t("shortcut_modal_component_name"),required:!0}),width:1,render:(e,t,i)=>(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{id:eI,className:x()("px-[2px]",o?"cursor-grab":"cursor-not-allowed"),children:(0,r.jsx)(d.IsH,{})}),(0,r.jsx)(l.l0.Input,{noLabel:!0,maxLength:20,field:"values.[".concat(i,"].name"),noErrorMessage:!0,placeholder:s.o.t("shortcut_modal_component_name"),rules:[{required:!0}],disabled:n||t.hide})]})},description:{key:"description",title:(0,r.jsx)(l.l0.Label,{className:"leading-5 p-0 m-0",text:s.o.t("Description")}),width:"190px",render:(e,t,o)=>(0,r.jsx)("div",{className:"pl-[2px]",children:(0,r.jsx)(l.l0.Input,{noLabel:!0,maxLength:100,field:"values.[".concat(o,"].description"),noErrorMessage:!0,placeholder:s.o.t("Description"),disabled:n||t.hide})})},inputType:{key:"input_type",title:(0,r.jsx)(l.l0.Label,{className:"leading-5 p-0 m-0",text:s.o.t("shortcut_modal_component_type"),required:!0}),render:(t,o,i)=>(0,r.jsx)("div",{className:"pl-[2px]",children:(0,r.jsx)(ed,{value:A({input_type:o.input_type,options:o.options,upload_options:o.upload_options}),disabled:n||o.hide,onSubmit:t=>{var n,{input_type:o,options:r,upload_options:a}=j(t);null==e||null===(n=e.onChange)||void 0===n||n.call(e,e.components.map((e,t)=>t===i?(0,g._)((0,h._)({},e),{input_type:o,options:r,default_value:{value:""},upload_options:a}):e))}})})},defaultValue:{key:"default_value",title:(0,r.jsx)(l.l0.Label,{className:"leading-5 p-0 m-0",text:s.o.t("shortcut_modal_use_tool_parameter_default_value")}),render:(e,t,o)=>(0,r.jsx)("div",{className:"pl-[2px] max-w-[136px]",children:(0,r.jsx)(ef,{componentType:A({input_type:t.input_type,options:t.options,upload_options:t.upload_options}),field:"values.[".concat(o,"].default_value"),disabled:n||t.hide})})},parameter:{key:"parameter",title:(0,r.jsx)(l.l0.Label,{className:"leading-5 p-0 m-0",text:s.o.t("shortcut_modal_component_plugin_wf_parameter")}),dataIndex:"parameter",render:t=>(0,r.jsx)(ep,{toolInfo:e.toolInfo,parameter:t})},operations:ex(e)}},ey=(e,t)=>Object.assign({},e,{width:t}),ew=e=>{var{toolType:t}=e,n=eb(e);return t===u.qK.ToolTypePlugin||t===u.qK.ToolTypeWorkFlow?[ey(n.name,"103px"),ey(n.description,"103px"),ey(n.inputType,"103px"),ey(n.defaultValue,"126px"),ey(n.parameter,"86px"),n.operations]:[ey(n.name,"125px"),ey(n.description,"125px"),ey(n.inputType,"125px"),ey(n.defaultValue,"136px"),n.operations]},eC=Symbol.for("chat-area-plugins-chat-shortcuts-components-table-item"),eI="chat-area-plugins-chat-shortcuts-components-drag-handle",eN={body:{row:e=>{var{id:t,onMove:n,children:o,sortable:a}=e,s=(0,i.useRef)(null),{connect:l}=(0,b.a)({type:eC,id:t,onMove:n,enabled:a});return(0,i.useEffect)(()=>{var e,t,n={current:null!==(t=null===(e=s.current)||void 0===e?void 0:e.querySelector("#".concat(eI)))&&void 0!==t?t:null};l(s,n)},[]),(0,r.jsx)("tr",{ref:s,children:o})}}},eE=n("324334"),ej={};ej.styleTagTransform=G(),ej.setAttributes=F(),ej.insert=B().bind(null,"head"),ej.domAPI=P(),ej.insertStyleElement=V(),R()(eE.Z,ej);var eT=eE.Z&&eE.Z.locals?eE.Z.locals:void 0,ek=(e,t)=>(0,r.jsx)("div",{className:eT.empty,children:e?t?s.o.t("shortcut_modal_skill_has_no_param_tip"):s.o.t("shortcut_modal_skill_select_button"):s.o.t("shortcut_modal_form_to_be_filled_up_tip")}),eA=(0,i.forwardRef)((e,t)=>{var{components:n,onChange:h,toolType:g,disabled:f,toolInfo:_}=e,[x,b]=(0,i.useState)(w(n)),y=(0,i.useRef)(),N=e=>{var t;b(e),null===(t=y.current)||void 0===t||t.setValues({values:e},{isOverride:!0}),null==h||h(C(e))};(0,i.useImperativeHandle)(t,()=>({formApi:y.current?{validate:(0,o._)(function*(){for(var e,t,n=arguments.length,o=Array(n),r=0;r<n;r++)o[r]=arguments[r];if(x.some(e=>{var t;return e.input_type===u.n$.Select&&!(null===(t=e.options)||void 0===t?void 0:t.length)}))throw l.FN.error(s.o.t("shortcut_modal_selector_component_no_options_error")),Error("shortcut_modal_selector_component_no_options_error");if(y.current&&I(x,y.current))throw Error("duplicated names");var i=yield null===(e=y.current)||void 0===e?void 0:e.validate(...o);return C(null!==(t=null==i?void 0:i.values)&&void 0!==t?t:[])}),setValues:e=>{var t,n,o,r=w(e);b(r),null===(t=y.current)||void 0===t||t.setValues({values:r},{isOverride:!0}),null===(n=y.current)||void 0===n||n.setTouched("values",!1),null===(o=y.current)||void 0===o||o.setError("values","")}}:void 0}));var E=(e,t,n)=>{var o,r,i,a=[...x],s=a.findIndex(t=>t.id===e),l=(null===(o=y.current)||void 0===o?void 0:o.getError("values"))||[],d=l.splice(s,1)[0],u=a.splice(s,1)[0],c=a.findIndex(e=>e.id===t)+(n?0:1);u&&a.splice(c,0,u),l.splice(c,0,d),s!==c&&(N(a),null===(r=y.current)||void 0===r||r.setValues({values:a},{isOverride:!0}),null===(i=y.current)||void 0===i||i.setError("values",l))},j=void 0===g||![u.qK.ToolTypeWorkFlow,u.qK.ToolTypePlugin].includes(g),T=!!(null==_?void 0:_.tool_name),k=x.length>=10,A=(0,r.jsx)(p.Z,{icon:(0,r.jsx)(d.N_R,{}),disabled:k||f,onClick:()=>{N([...x,{id:(0,m.h1)(),input_type:u.n$.TextInput}])},children:s.o.t("add")}),M=k?(0,r.jsx)(l.u,{content:s.o.t("shortcut_modal_max_component_tip",{maxCount:10}),children:A}):A;return(0,r.jsxs)("div",{className:"pb-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between pb-1.5",children:[(0,r.jsx)(v.Z,{tip:(0,c.B)(),children:s.o.t("shortcut_modal_components")}),j?M:null]}),(0,r.jsx)(a.W,{children:(0,r.jsx)(l.l0,{initValues:{values:x},trigger:"custom",autoComplete:"off",disabled:f,getFormApi:e=>y.current=e,onValueChange:(e,t)=>{var n,o=Object.keys(t);1===o.length&&(null===(n=o[0])||void 0===n?void 0:n.startsWith("values.["))&&(N([...e.values]),setTimeout(()=>{var t;y.current&&I(e.values,y.current),null===(t=y.current)||void 0===t||t.validate([o[0]])}))},children:(0,r.jsx)("div",{className:eT.table,children:(0,r.jsx)(l.iA,{dataSource:x,size:"small",columns:ew({components:x,onChange:N,toolInfo:_,toolType:g,disabled:f}),components:eN,pagination:!1,onRow:e=>{var t,n;return{id:null!==(t=null==e?void 0:e.id)&&void 0!==t?t:"",sortable:(null!==(n=null==x?void 0:x.length)&&void 0!==n?n:0)>1&&!f,onMove:E}},empty:ek(!j,T)})})})})]})})},698585:function(e,t,n){var o=n(151064),r=n(775699),i=n(903643);t.Z=e=>{var{onClick:t,icon:n,children:a,disabled:s}=e;return(0,o.jsx)(r._3,{icon:n,wrapperClass:i.Z.btn,onClick:t,disabled:s,children:a})}},19863:function(e,t,n){n.d(t,{Q:function(){return c}});var o=n(808549),r=n(120454),i=n(151064);n(455069);var a=n(252237),s=n.n(a),l=n(674343),d=n(775699),u=n(44172),c=e=>{var{children:t,className:n,tooltip:a,tip:c,required:v=!1}=e;return(0,i.jsxs)("div",{className:"flex items-center mb-[6px]",children:[(0,i.jsx)(d.l0.Label,{text:t,className:"!coz-fg-primary !text-[14px] !leading-[20px] !m-0",required:v}),!!c&&(0,i.jsx)(l.u,(0,r._)((0,o._)({content:c},a),{children:(0,i.jsx)(u.aUG,{className:s()("coz-fg-secondary ml-[-12px]",n)})}))]})};t.Z=c},271855:function(e,t,n){n.d(t,{B:function(){return u},G:function(){return d}});var o=n(151064),r=n(336205),i={color:"var(--semi-color-primary-hover)"},a=e=>(0,o.jsxs)("span",{style:i,children:["{{",e,"}}"]}),s=a(r.o.t("shortcut_modal_query_message_hover_tip_component_mode_var1")),l=a(r.o.t("shortcut_modal_query_message_hover_tip_component_mode_var2")),d=()=>(0,o.jsxs)("div",{className:"p[16px] leading-[16px] text-[12px] font-normal coz-fg-secondary",children:[(0,o.jsx)("h2",{className:"m-0 mb-[12px] text-[14px] font-medium leading-[20px] coz-fg-plus",children:r.o.t("shortcut_modal_query_message_hover_tip_title")}),(0,o.jsxs)("ul",{className:"pl-[12px]",children:[(0,o.jsx)("li",{children:r.o.t("shortcut_modal_query_message_hover_tip_send_query_mode")}),(0,o.jsx)("li",{children:r.o.t("shortcut_modal_query_message_hover_tip_component_mode",{var1:s,var2:l})})]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("span",{className:"coz-fg-hglt-red w-[12px] inline-block",children:"*"}),r.o.t("shortcut_modal_query_message_hover_tip_how_to_insert_components")]})]}),u=()=>r.o.t("shortcut_modal_components_hover_tip",{var1:s,var2:l})},944647:function(e,t,n){n.d(t,{Hs:function(){return _},Q$:function(){return x},Rw:function(){return b},mj:function(){return l}});var o=n(808549),r=n(120454),i=n(325618),a=n(604999),s=n(875025),l=e=>{var t=(0,o._)({},e);d(t);var{send_type:n,use_tool:r=!1}=t;return h(t),m(t),n!==i.nu.SendTypeQuery||r?u(t):v(t),!r&&p(t),t},d=e=>{var t;(null==e?void 0:null===(t=e.components_list)||void 0===t?void 0:t.length)?e.send_type=i.nu.SendTypePanel:e.send_type=i.nu.SendTypeQuery},u=e=>{var{components_list:t,tool_info:{tool_params_list:n}={}}=e;if(!!t&&!!n)t.forEach(e=>{var{default_value:t,hide:o}=e,r=c(n,e);if(!!r)r.refer_component=!o,r.default_value=o?null==t?void 0:t.value:""})},c=(e,t)=>null==e?void 0:e.find(e=>e.name===t.parameter),v=e=>{e.tool_type=void 0,e.plugin_id="",e.work_flow_id="",e.plugin_api_name="",e.plugin_from=void 0,e.tool_info={tool_name:"",tool_params_list:[]},e.components_list=[],e.card_schema=""},p=e=>{var t;e.tool_type=void 0,e.plugin_id="",e.work_flow_id="",e.plugin_api_name="",e.plugin_from=void 0,e.tool_info={tool_name:"",tool_params_list:[]},null===(t=e.components_list)||void 0===t||t.forEach(e=>{e.parameter=""})},m=e=>{var{components_list:t}=e,n=t?(0,s.Wo)(t):"";e.card_schema=JSON.stringify(n)},h=e=>{var{shortcut_command:t}=e;t&&(e.shortcut_command="/".concat(t.trim()))},g=(e,t)=>{var n=e.slice();return t.forEach(t=>{var{name:o,default_value:r,desc:a,refer_component:s}=t;!e.find(e=>e.parameter===o)&&n.push({name:o,description:a,parameter:o,input_type:i.n$.TextInput,hide:!s,default_value:{type:i.n$.TextInput,value:r}})}),n},f=e=>e.map(e=>{var{input_type:t,upload_options:n}=e;return!(null==n?void 0:n.length)&&t&&[i.n$.UploadImage,i.n$.UploadDoc,i.n$.UploadTable,i.n$.UploadAudio].includes(t)?(0,r._)((0,o._)({},e),{upload_options:[t]}):e}),_=e=>{if(!e)return{send_type:i.nu.SendTypeQuery,use_tool:!1};var{shortcut_command:t,tool_type:n,components_list:s,tool_info:{tool_params_list:l=[]}={}}=e,d=f(g(null!=s?s:[],l));return(0,r._)((0,o._)({},e),{shortcut_command:null==t?void 0:t.replace(/^\//,""),use_tool:(0,a.GK)(n),components_list:d})},x=e=>{if((null==e?void 0:e.send_type)!==i.nu.SendTypePanel)return!1;var t,n,{tool_params_list:o,tool_name:r}=null!==(n=null==e?void 0:e.tool_info)&&void 0!==n?n:{};return r?!!(null==o?void 0:o.length)&&o.every(e=>!e.refer_component):!!(null==e?void 0:null===(t=e.components_list)||void 0===t?void 0:t.length)&&e.components_list.every(e=>e.hide)},b=e=>{var t,n,{tool_params_list:o,tool_name:r}=null!==(n=null==e?void 0:e.tool_info)&&void 0!==n?n:{};if(r)return(null==o?void 0:o.length)?o.reduce((e,t)=>{var n=t.name,o=null==t?void 0:t.default_value;return n&&o?(e[n]=o,e):e},{}):{};return(null==e?void 0:null===(t=e.components_list)||void 0===t?void 0:t.length)?e.components_list.reduce((e,t)=>{var n,o=t.name,{value:r}=null!==(n=null==t?void 0:t.default_value)&&void 0!==n?n:{};return o&&r?(e[o]=r,e):e},{}):{}}},875025:function(e,t,n){n.d(t,{y3:()=>b,Wo:()=>g,lD:()=>x});var o,r,i=n("325618"),a=n("234463"),s=n("470064");var l=((o={}).SLOT="slot",o.WORKSPACE_SLOT="workspaceSlot",o.EXPRESSION="expression",o.ACTION="action",o);var d=((r={}).EXPRESSION="expression",r),u=()=>({elements:{root:{id:"root",name:"Root",type:"@flowpd/cici-components/PageContainer",children:["form"],directives:{}},form:{id:"form",name:"FlowpdCiciComponentsForm",type:"@flowpd/cici-components/Form",props:{value:{type:l.EXPRESSION,value:"{{formValue}}"},onChange:{type:l.ACTION,value:"{{onChange}}"},ruls:{}},children:["submitButton"]},submitButton:{id:"submitButton",name:"FlowpdCiciComponentsButton",type:"@flowpd/cici-components/Button",props:{onClick:{type:l.ACTION,value:"{{onSubmit}}"}}}},rootID:"root",variables:{formValue:{id:"formValue",defaultValue:{}}},actions:{onSubmit:{id:"onSubmit",type:"submit",data:{type:d.EXPRESSION,value:"{{formValue}}"}},onChange:{id:"onChange",type:"updateVar",target:"formValue"}}}),c=e=>{var t=[],{input_type:n,upload_options:o}=e;return t=n===i.n$.MixUpload?null!=o?o:[]:n?[n]:[],(0,s.wT)(t)},v=e=>{var t;return{id:null!==(t=e.name)&&void 0!==t?t:(0,a.h1)(),name:"FlowpdCiciComponentsUpload",type:"@flowpd/cici-components/Upload",props:{name:e.name,description:e.description,maxSize:(e.input_type,i.n$.UploadImage,512e3),inputType:e.input_type,accept:c(e),rules:[{required:!0}],noErrorMessage:!0}}},p=()=>({id:(0,a.h1)(),name:"FlowpdCiciComponentsFormItemPlaceholder",type:"@flowpd/cici-components/Placeholder"}),m=e=>({id:(0,a.h1)(),name:"FlowpdCiciComponentsColumnLayout",type:"@flowpd/cici-components/ColumnLayout",props:{Columns:e.map(e=>({children:[e.id],config:{vertical:"top",weight:1,width:"weighted"},type:"slot"})),action:"enableUrl",backgroundColor:"transparent",enableClickEvent:!1}}),h={[i.n$.TextInput]:e=>{var t;return{id:null!==(t=e.name)&&void 0!==t?t:(0,a.h1)(),name:"FlowpdCiciComponentsInput",type:"@flowpd/cici-components/Input",props:{name:e.name,description:e.description,defaultValue:e.default_value,rules:[],noErrorMessage:!0}}},[i.n$.Select]:e=>{var t,n;return{id:null!==(n=e.name)&&void 0!==n?n:(0,a.h1)(),name:"FlowpdCiciComponentsSelect",type:"@flowpd/cici-components/Select",props:{name:e.name,description:e.description,defaultValue:e.default_value,optionList:null===(t=e.options)||void 0===t?void 0:t.map(e=>({label:e,value:e})),rules:[{required:!0}],noErrorMessage:!0}}},[i.n$.UploadImage]:v,[i.n$.UploadDoc]:v,[i.n$.UploadTable]:v,[i.n$.UploadAudio]:v,[i.n$.MixUpload]:v,[i.n$.PPT]:v,[i.n$.ARCHIVE]:v,[i.n$.CODE]:v,[i.n$.TXT]:v,[i.n$.VIDEO]:v},g=e=>{var t,n,o=e.map(f),r=_(o),i=u();return null===(n=i.elements.form)||void 0===n||null===(t=n.children)||void 0===t||t.unshift(...r.map(e=>e.id)),[...o,...r].forEach(e=>i.elements[e.id]=e),i.elements.submitButton.props.formFields=o.map(e=>e.id),i},f=e=>void 0!==e.input_type?h[e.input_type](e):p(),_=e=>{for(var t=[],n=[...e];n.length;)t.push(m(n.splice(0,2)));return t},x=e=>(null==e?void 0:e.elements)?Object.values(e.elements).map(e=>{var t,n=null==e?void 0:null===(t=e.props)||void 0===t?void 0:t.defaultValue;return{defaultValue:null==n?void 0:n.value,type:e.type,id:e.id}}).filter(e=>"@flowpd/cici-components/Input"===e.type&&!!e.defaultValue):[],b=(e,t)=>{var n;return(null==e?void 0:e.elements)?null!==(n=Object.values(e.elements).filter(e=>"@flowpd/cici-components/Input"===e.type).find(e=>e.id===t))&&void 0!==n?n:null:null}},470064:function(e,t,n){n.d(t,{Td:function(){return c},W_:function(){return s},wT:function(){return u}});var o=n(552995),r=n(380835),i=n(336205),a=n(325618),s=[{type:a.n$.UploadImage,label:i.o.t("shortcut_modal_upload_component_file_format_img"),icon:o.XB},{type:a.n$.UploadTable,label:i.o.t("shortcut_modal_upload_component_file_format_table"),icon:o.P8},{type:a.n$.UploadDoc,label:i.o.t("shortcut_modal_upload_component_file_format_doc"),icon:o.ti},{type:a.n$.UploadAudio,label:i.o.t("shortcut_modal_upload_component_file_format_audio"),icon:o.f4},{type:a.n$.CODE,label:i.o.t("shortcut_modal_upload_component_file_format_code"),icon:o.dN},{type:a.n$.ARCHIVE,label:i.o.t("shortcut_modal_upload_component_file_format_zip"),icon:o.eO},{type:a.n$.PPT,label:i.o.t("shortcut_modal_upload_component_file_format_ppt"),icon:o.Nl},{type:a.n$.VIDEO,label:i.o.t("shortcut_modal_upload_component_file_format_video"),icon:o.Od},{type:a.n$.TXT,label:i.o.t("shortcut_modal_upload_component_file_format_txt"),icon:o.VL}],l={[r.Wz.IMAGE]:a.n$.UploadImage,[r.Wz.AUDIO]:a.n$.UploadAudio,[r.Wz.PDF]:a.n$.UploadDoc,[r.Wz.DOCX]:a.n$.UploadDoc,[r.Wz.EXCEL]:a.n$.UploadTable,[r.Wz.CSV]:a.n$.UploadTable,[r.Wz.VIDEO]:a.n$.VIDEO,[r.Wz.PPT]:a.n$.PPT,[r.Wz.TXT]:a.n$.TXT,[r.Wz.ARCHIVE]:a.n$.ARCHIVE,[r.Wz.CODE]:a.n$.CODE,[r.Wz.DEFAULT_UNKNOWN]:a.n$.UploadDoc},d=r.Co.reduce((e,t)=>{var n=l[t.fileType];if(n){var o=e[n];o?e[n]="".concat(o,",").concat(t.accept.join(",")):e[n]=t.accept.join(",")}return e},{}),u=e=>{var t=[];for(var n of e){if(!n)continue;var o=d[n];if(!!o)t.push(...o.split(","))}return t.join(",")},c=e=>{var t=l[e];return t?s.find(e=>e.type===t):null}},604999:function(e,t,n){n.d(t,{GK:function(){return a},QU:function(){return s},bA:function(){return l},d$:function(){return d},ho:function(){return r},xc:function(){return i}});var o=n(325618),r=e=>{if(!e)return{tool_type:"",tool_name:"",plugin_id:"",plugin_api_name:"",plugin_from:void 0,tool_params_list:[]};var{tool_info:{tool_params_list:t=[],tool_name:n=""}={},tool_type:o,plugin_id:r,plugin_api_name:i,plugin_from:a,work_flow_id:s}=e;return{tool_type:o,tool_name:n,plugin_id:r,plugin_api_name:i,plugin_from:a,tool_params_list:t,work_flow_id:s}},i=e=>/^[a-zA-Z0-9_]+$/.test(e)&&!/^[0-9]+$/.test(e),a=e=>void 0!==e&&[o.qK.ToolTypeWorkFlow,o.qK.ToolTypePlugin].includes(e),s=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.length)return{isSuccess:t,inValidType:"empty"};var n=e.every(e=>{var{type:t}=e;return void 0!==t&&!["array","object"].includes(t)});return{isSuccess:n,inValidType:n?"":"complex"}},l=(e,t)=>{var{shortcut_command:n,command_id:o}=e;return!t.some(e=>o!==e.command_id&&e.shortcut_command===n)},d=(e,t)=>{var{command_name:n,command_id:o}=e;return!t.some(e=>o!==e.command_id&&e.command_name===n)}},234463:function(e,t,n){n.d(t,{h1:function(){return r}});var o=n(801815),r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,{alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",length:r=10}=t||{},i=(0,o.kP)(n,r);return"".concat(e).concat(i())}},828950:function(e,t,n){n.d(t,{vy:()=>eN});var o,r,i=n("392060"),a=n("455069"),s=n("801815"),l=n("917085"),d=n("479910"),u=n("598208"),c=e=>(0,u.Ue)()((0,d.mW)((e,t)=>({humanizedContentText:"",originContentText:"",normalizeSelectionNodeList:[],selectionData:null,isFloatMenuVisible:!1,floatMenuPosition:null,updateHumanizedContentText:t=>{e({humanizedContentText:t})},updateOriginContentText:t=>{e({originContentText:t})},updateNormalizeSelectionNodeList:t=>{e({normalizeSelectionNodeList:t})},updateIsFloatMenuVisible:t=>{e({isFloatMenuVisible:t})},updateSelectionData:t=>{e({selectionData:t})},updateFloatMenuPosition:t=>{e({floatMenuPosition:t})},clearStore:()=>{e({humanizedContentText:"",originContentText:"",normalizeSelectionNodeList:[],selectionData:null})}}),{name:"botStudio.ChatAreaGrabPlugin.SelectionStore.".concat(e),enabled:!1})),v=n("61111"),p=e=>(0,u.Ue)()((0,d.mW)((0,d.XR)(e=>({quoteContent:null,quoteVisible:!1,quoteContentMap:{},updateQuoteContent:t=>{e({quoteContent:t})},updateQuoteContentMapByImmer:t=>{e((0,v.Uy)(e=>t(e.quoteContentMap)))},updateQuoteVisible:t=>{e({quoteVisible:t})},clearStore:()=>{e({quoteContent:null,quoteVisible:!1})}})),{name:"botStudio.ChatAreaGrabPlugin.Quote.".concat(e),enabled:!1})),m=(e,t)=>{var{useQuoteStore:n}=e;return n.subscribe(e=>e.quoteContent,e=>{var{onQuoteChange:n}=t;null==n||n({isEmpty:!e})})},h=e=>(0,u.Ue)()((0,d.mW)((0,d.XR)(e=>({enableGrab:!1,updateEnableGrab:t=>{e({enableGrab:t})}})),{name:"botStudio.ChatAreaGrabPlugin.Preference.".concat(e),enabled:!1})),g=n("780601"),f=n("808549"),_=n("120454");var x=((o={}).OnViewScroll="onViewScroll",o.OnMessageUpdate="onMessageUpdate",o.OnLinkElementMouseEnter="onCardLinkElementMouseEnter",o.OnLinkElementMouseLeave="onCardLinkElementMouseLeave",o);var b=((r={}).UpdateQuote="updateQuote",r);class y extends g.i4{onBeforeAppendSenderMessageIntoStore(e){var{quoteContent:t,updateQuoteContentMapByImmer:n}=this.pluginInstance.pluginBizContext.storeSet.useQuoteStore.getState();if(!t||"shortcut"===e.from)return e;var o=e.message,r={item_list:[{type:"text",text:o.content}],refer_items:[]};r.refer_items.push({type:g.zc.Text,text:(0,i.jU)(t)});var a=(0,_._)((0,f._)({},o),{content_type:g.zc.Mix,content:JSON.stringify(r),content_obj:r});return n(e=>{var n=a.extra_info.local_message_id;!e[n]&&(e[n]=t)}),(0,_._)((0,f._)({},e),{message:a})}onAfterAppendSenderMessageIntoStore(e){if("shortcut"!==e.from){var{storeSet:t}=this.pluginInstance.pluginBizContext,{updateQuoteVisible:n,updateQuoteContent:o}=t.useQuoteStore.getState();n(!1),o(null)}}onAfterProcessReceiveMessage(){var{emit:e}=this.pluginInstance.pluginBizContext.eventCenter;e(x.OnMessageUpdate)}}class w extends g.Bw{onViewScroll(){var{emit:e}=this.pluginInstance.pluginBizContext.eventCenter;e(x.OnViewScroll)}onCardLinkElementMouseEnter(e){var{emit:t}=this.pluginInstance.pluginBizContext.eventCenter;t(x.OnLinkElementMouseEnter,(0,_._)((0,f._)({},e),{type:"image"}))}onCardLinkElementMouseLeave(e){var{emit:t}=this.pluginInstance.pluginBizContext.eventCenter;t(x.OnLinkElementMouseLeave,(0,_._)((0,f._)({},e),{type:"image"}))}onMdBoxImageElementMouseEnter(e){var{emit:t}=this.pluginInstance.pluginBizContext.eventCenter;t(x.OnLinkElementMouseEnter,(0,_._)((0,f._)({},e),{type:"image"}))}onMdBoxImageElementMouseLeave(e){var{emit:t}=this.pluginInstance.pluginBizContext.eventCenter;t(x.OnLinkElementMouseLeave,(0,_._)((0,f._)({},e),{type:"image"}))}onMdBoxLinkElementMouseEnter(e){var{emit:t}=this.pluginInstance.pluginBizContext.eventCenter;t(x.OnLinkElementMouseEnter,(0,_._)((0,f._)({},e),{type:"link"}))}onMdBoxLinkElementMouseLeave(e){var{emit:t}=this.pluginInstance.pluginBizContext.eventCenter;t(x.OnLinkElementMouseLeave,(0,_._)((0,f._)({},e),{type:"link"}))}}class C extends g.r1{onBeforeDestroy(){var{unsubscribe:e,eventCenter:t,publicEventCenter:n,scene:o}=this.pluginInstance.pluginBizContext;if("store"!==o)e(),t.all.clear(),n.all.clear()}onBeforeInitial(){var{publicEventCenter:e,grabPluginId:t,storeSet:n}=this.pluginInstance.pluginBizContext,{useQuoteStore:o}=n,{updateQuoteContent:r,updateQuoteVisible:i}=o.getState();e.on(b.UpdateQuote,e=>{var{grabPluginId:n,quote:o}=e;if(t===n)r(o),i(!0)})}}var I=n("151064"),N=n("664319"),E=n("747514"),j=n("252237"),T=n.n(j),k=n("552995"),A=n("336205"),M=n("915757"),S=n("674343"),z=e=>{var{messageId:t,chatAreaPluginContext:n}=e;if(!!t)return n.readonlyAPI.message.findMessage(t)},O=e=>{var{onClose:t,onClick:n}=e,{pluginBizContext:o,chatAreaPluginContext:r}=(0,g.FL)(g.p7.MessageGrab),{onQuote:i}=o.eventCallbacks,{useQuoteStore:a,useSelectionStore:s,usePreferenceStore:l}=o.storeSet,{updateQuoteContent:d,updateQuoteVisible:u}=a((0,N.N)(e=>({updateQuoteVisible:e.updateQuoteVisible,updateQuoteContent:e.updateQuoteContent}))),c=l(e=>e.enableGrab),{useDeleteFile:v}=r.writeableHook.file,{getFileStoreInstantValues:p}=r.readonlyAPI.batchFile,m=v(),h=()=>{var{fileIdList:e}=p();e.forEach(e=>m(e))},f=()=>{var{selectionData:e}=s.getState(),t=null==e?void 0:e.ancestorAttributeValue;if(!!t)return z({messageId:t,chatAreaPluginContext:r})};return c?(0,I.jsx)(S.u,{content:A.o.t("quote_ask_in_chat"),clickToHide:!0,children:(0,I.jsx)(S.hU,{icon:(0,I.jsx)(M.Z57,{className:"text-lg coz-fg-secondary"}),color:"secondary",onClick:()=>{if(h(),n){n(),null==t||t();return}var e,{normalizeSelectionNodeList:o}=s.getState();d(o),u(!0);var r=f();null==i||i({botId:null!==(e=null==r?void 0:r.sender_id)&&void 0!==e?e:"",source:null==r?void 0:r.source}),null==t||t()},size:"small",wrapperClass:"flex justify-center items-center"})}):null},L=n("871482"),R=n("407821"),D=n.n(R),P=n("472772"),U=n.n(P),B=n("395245"),Z=n.n(B),F=n("297998"),q=n.n(F),V=n("646576"),W=n.n(V),G=n("606121"),Q=n.n(G),H=n("386575"),$={};$.styleTagTransform=Q(),$.setAttributes=q(),$.insert=Z().bind(null,"head"),$.domAPI=U(),$.insertStyleElement=W(),D()(H.Z,$);var Y=H.Z&&H.Z.locals?H.Z.locals:void 0,J=(0,a.forwardRef)((e,t)=>{var n=(0,g.FL)(g.p7.MessageGrab),{useGetScrollView:o}=n.chatAreaPluginContext.readonlyHook.scrollView,{on:r,off:i}=n.pluginBizContext.eventCenter,{style:s,children:l,onScroll:d,onMouseEnter:u,onMouseLeave:c,className:v}=e,p=o(),m=(0,a.useRef)(null),[h,b]=(0,a.useState)(1);(0,a.useImperativeHandle)(t,()=>({getRef:()=>m,refreshOpacity:y}));var y=(0,L.$0)(()=>{null==d||d();var e,t=null===(e=m.current)||void 0===e?void 0:e.getBoundingClientRect(),{rect:n}=p().getOriginScrollInfo();if(!!n&&!!t)if(t.y-100<=n.top){var o=(t.y-n.top)/100;b(o<0?0:o)}else if(t.y+100>=n.bottom){var r=(n.bottom-t.y)/100;b(r<0?0:r)}else b(1)});return(0,a.useEffect)(()=>(r(x.OnMessageUpdate,y),()=>{i(x.OnMessageUpdate,y)}),[]),(0,I.jsx)("div",{className:T()("fixed p-[2px] coz-bg-max coz-stroke-primary border-[0.5px] rounded-[8px] overflow-hidden grid grid-flow-col gap-[2px] h-[28px]",Y["container-box-shadow"],v),style:(0,_._)((0,f._)({},s),{opacity:h}),ref:m,onMouseEnter:u,onMouseLeave:c,children:l})}),K=[g.mZ.Notice],X=e=>{var t,{contentRef:n}=e,o=(0,g.FL)(g.p7.MessageGrab),{pluginBizContext:r}=o,{eventCenter:s,storeSet:l}=r,{usePreferenceStore:d,useSelectionStore:u}=l,{on:c,off:v}=s,p=(0,a.useRef)(null),{isFloatMenuVisible:m,position:h,updateFloatMenuPosition:f}=u((0,N.N)(e=>({isFloatMenuVisible:e.isFloatMenuVisible,position:e.floatMenuPosition,updateFloatMenuPosition:e.updateFloatMenuPosition}))),_=d(e=>e.enableGrab),{clearSelection:b,isScrolling:y,computePosition:w}=(0,i.GC)({contentRef:n,floatMenuRef:null===(t=p.current)||void 0===t?void 0:t.getRef(),onSelectChange:e=>{var t,n,r,i,{updateHumanizedContentText:a,updateNormalizeSelectionNodeList:s,updateOriginContentText:l,updateSelectionData:d,updateIsFloatMenuVisible:u}=o.pluginBizContext.storeSet.useSelectionStore.getState();if(e&&K.includes(e.messageSource))return;d(e),u(!!e);var c=null==e?void 0:e.ancestorAttributeValue,v=c===k.K8;if(!!c){var{is_finish:p}=null!==(t=o.chatAreaPluginContext.readonlyAPI.message.findMessage(c))&&void 0!==t?t:{};if(!p&&!v){u(!1);return}a(null!==(n=null==e?void 0:e.humanizedContentText)&&void 0!==n?n:""),s(null!==(r=null==e?void 0:e.normalizeSelectionNodeList)&&void 0!==r?r:[]),l(null!==(i=null==e?void 0:e.originContentText)&&void 0!==i?i:"")}},onPositionChange:e=>{f(e),(0,E.Z)(()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.refreshOpacity()})}}),C=!!h&&m;return((0,a.useEffect)(()=>(c(x.OnMessageUpdate,w),c(x.OnViewScroll,w),()=>{v(x.OnMessageUpdate,w),v(x.OnViewScroll,w)}),[]),_)?(0,I.jsx)(J,{ref:p,style:{top:null==h?void 0:h.y,left:null==h?void 0:h.x},className:T()({hidden:!C||y}),children:(0,I.jsx)(O,{onClose:b})}):null},ee=e=>{var t,n=(0,a.useRef)(null),o=(0,a.useRef)(null),r=(null==e?void 0:null===(t=e.containerRef)||void 0===t?void 0:t.current)?e.containerRef:n,[s,l]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{var e,t=(0,i.Ry)(r.current,i.lp),n=null==t?void 0:null===(e=t.attributes.getNamedItem(i.y8))||void 0===e?void 0:e.value;return K.includes(Number(n))&&l(!0),o.current=t,()=>{l(!1),o.current=null}},[r.current]),{targetRef:o,containerRef:r,forceHidden:s}},et=n("796659"),en=n("61910"),eo=n("412656"),er=(0,en.Z)(function(e,t,n){return(0,et.Z)(e,(0,eo.Z)(t)||0,n)}),ei=(e,t)=>{var n=e.at(0);for(var o of e)t.x>=o.left-5&&t.x<=o.right+5&&t.y>=o.top-5&&t.y<=o.bottom+5&&(n=o);return n},ea=e=>{var{plugin:t}=e,n=(0,a.useRef)(null),[o,r]=(0,a.useState)(!1),s=(0,a.useRef)(null),l=(0,a.useRef)(null),[d,u]=(0,a.useState)(!1),c=(0,a.useRef)(null),{pluginBizContext:v}=t,{eventCenter:p}=v,{on:m,off:h}=p,g=(0,a.useRef)(!1),[f,_]=(0,a.useState)(null),b=(0,a.useRef)(null),y=(0,a.useRef)({x:0,y:0}),w=(0,L.$0)(()=>{g.current=!0,b.current&&clearTimeout(b.current)}),C=(0,L.$0)(()=>{g.current=!1,j()}),I=()=>{var e,n,o=(0,i.Ry)(s.current,i.lp),r=null==o?void 0:null===(e=o.attributes.getNamedItem(i.lp))||void 0===e?void 0:e.value;if(r===k.K8)return!0;if(!r)return!1;var{is_finish:a}=null!==(n=t.chatAreaPluginContext.readonlyAPI.message.findMessage(r))&&void 0!==n?n:{};return a},N=(0,L.$0)(e=>{var t;if(b.current&&(clearTimeout(b.current),b.current=null),s.current=e.element,l.current={source:e.link,type:e.type,text:null!==(t=e.element.textContent)&&void 0!==t?t:""},!!I())r(!0),T(),(0,E.Z)(()=>{var e;null===(e=n.current)||void 0===e||e.refreshOpacity()})}),j=(0,L.$0)(()=>{b.current=er(()=>{if(!g.current)s.current=null,r(!1)},100)}),T=(0,L.$0)(()=>{var e=null===(d=n.current)||void 0===d?void 0:d.getRef();if(!!s.current&&!!e&&!!e.current&&!!l.current){var t=s.current,o=t.getBoundingClientRect(),r=e.current.getBoundingClientRect(),i=0,a=0;if("image"===l.current.type)i=o.right,a=o.bottom-o.height/2-r.height/2;else{var d,u,c=null!==(u=ei(Array.from(t.getClientRects()),y.current))&&void 0!==u?u:o;i=y.current.x,a=c.bottom}_({x:i,y:a})}}),A=(0,L.$0)(e=>{var[t,n]=[e.clientX,e.clientY];y.current={x:t,y:n}}),M=(0,L.$0)(()=>{c.current&&clearTimeout(c.current),u(!0),c.current=setTimeout(()=>{T(),u(!1)},100)});return(0,a.useEffect)(()=>(m(x.OnLinkElementMouseEnter,N),m(x.OnLinkElementMouseLeave,j),m(x.OnViewScroll,M),m(x.OnMessageUpdate,M),window.addEventListener("mousemove",A),window.addEventListener("resize",M),window.addEventListener("wheel",M),window.addEventListener("scroll",M),()=>{h(x.OnLinkElementMouseEnter,N),h(x.OnLinkElementMouseLeave,j),h(x.OnViewScroll,M),h(x.OnMessageUpdate,M),window.removeEventListener("mousemove",A),window.removeEventListener("resize",M),window.removeEventListener("wheel",M),window.removeEventListener("scroll",M)}),[]),{handleMenuMouseEnter:w,handleMenuMouseLeave:C,targetElement:s,targetInfo:l,position:f,floatMenuRef:n,visible:o,setVisible:r,computePosition:M,isScrolling:d}},es=e=>{var{position:t,messageRef:n,floatMenuRef:o}=e,[r,i]=(0,a.useState)(0);return(0,a.useEffect)(()=>{var e,t;i(null!==(t=null===(e=n.current)||void 0===e?void 0:e.getBoundingClientRect().right)&&void 0!==t?t:0),(0,E.Z)(()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.refreshOpacity()})},[t,n.current,o.current]),{maxPositionX:r}},el=()=>{var e,t=(0,g.FL)(g.p7.MessageGrab),{chatAreaPluginContext:n,pluginBizContext:o}=t,{eventCenter:r}=o,{usePreferenceStore:s}=o.storeSet,l=s(e=>e.enableGrab),{on:d,off:u}=r,{useQuoteStore:c}=o.storeSet,{updateQuoteContent:v,updateQuoteVisible:p}=c((0,N.N)(e=>({updateQuoteVisible:e.updateQuoteVisible,updateQuoteContent:e.updateQuoteContent}))),{handleMenuMouseEnter:m,handleMenuMouseLeave:h,targetElement:f,targetInfo:_,position:b,floatMenuRef:y,visible:w,setVisible:C,computePosition:j,isScrolling:k}=ea({plugin:t}),{targetRef:A,forceHidden:M}=ee({containerRef:f}),{maxPositionX:S}=es({messageRef:A,position:b,floatMenuRef:y}),L=t.pluginBizContext.storeSet.useSelectionStore(e=>e.isFloatMenuVisible&&!!e.floatMenuPosition);if((0,a.useEffect)(()=>(d(x.OnMessageUpdate,j),d(x.OnViewScroll,j),()=>{u(x.OnMessageUpdate,j),u(x.OnViewScroll,j)}),[]),!l||(0,i.b1)())return null;var R=null==b?void 0:b.y,D=(null!==(e=null==b?void 0:b.x)&&void 0!==e?e:0)>(null!=S?S:0)?S:null==b?void 0:b.x;return(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(J,{ref:y,className:T()({hidden:!w||M||L||k}),style:{top:R,left:D},onMouseEnter:m,onMouseLeave:h,children:(0,I.jsx)(O,{onClick:()=>{var e,t,r,a,s,{source:l="",type:d="link",text:u=""}=null!==(a=_.current)&&void 0!==a?a:{},c=A.current,m=null==c?void 0:null===(e=c.attributes.getNamedItem(i.lp))||void 0===e?void 0:e.value;if(!!m){var h=z({messageId:m,chatAreaPluginContext:n});v(["image"===d?{type:i.y1.IMAGE,src:l,children:[{text:l}]}:{type:i.y1.LINK,url:l,children:[{text:u}]}]),p(!0),null===(t=(r=o.eventCallbacks).onQuote)||void 0===t||t.call(r,{botId:null!==(s=null==h?void 0:h.sender_id)&&void 0!==s?s:"",source:null==h?void 0:h.source})}},onClose:()=>{(0,E.Z)(()=>C(!1))}})})})},ed=e=>(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(X,(0,f._)({},e)),(0,I.jsx)(el,(0,f._)({},e))]}),eu=(0,n("316828").j)([],{variants:{showBackground:{true:["text-[#FFFFFF/60]"],false:["coz-fg-secondary"]}}}),ec=n("115806"),ev={};ev.styleTagTransform=Q(),ev.setAttributes=q(),ev.insert=Z().bind(null,"head"),ev.domAPI=U(),ev.insertStyleElement=W(),D()(ec.Z,ev);var ep=ec.Z&&ec.Z.locals?ec.Z.locals:void 0,em=e=>{var{nodeList:t,theme:n,handleClickImage:o,showBackground:r}=e;return t.map((e,t)=>(0,i.mC)(e)?(0,I.jsx)("span",{className:T()("text-[14px] align-middle","leading-[16px]",{"coz-fg-secondary":"black"===n,[eu({showBackground:r})]:"white"===n}),children:e.text},t):(0,i.KC)(e)?(0,I.jsx)(S.Ee,{className:T()(ep.image,"w-[24px] h-[24px] leading-[24px] align-middle rounded-[4px] cursor-zoom-in",{"mx-[4px]":0!==t,"mr-[4px]":0===t}),src:e.src,onClick:()=>o(e.src),fallback:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAAB4CAYAAADMtn8nAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAO7SURBVHgB7dy9bhRXGMfhc8ZeQmEku4hkOt8BXEAg0IUqqVBK0wfwHaDcARbpSU+KFBGk4ysXQK4gLunWEoSv9e5kjiVHFkmFEfg/fh5ptbOz0/70ntmZnVreM30xuzS8fdvV/lKt/Wrpy2qtZbUAn1Tfl91Sh1dfd+Z9fVb2lrfX1urO4WPqwcZ0OsQ62bt1qltsLXXDF7UAx8jefHgt6u3FbPLjEPJu27ef6X68y7OHpyf9+U64cGwt+lLezNo0nlxuEXdtZzdMXvHC8dcaba2WyexW+1yn09cbp77o/lpeKkCItpx+9ba73C26pS3xQpalodnl5f67brJUzhUgSjvbHa4Ufd31pd8oQJx2ebcbToo3CpCnr6tdASK1G60EDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMGWC5EePPi93LnzU3n58mU5ivX19XLt2ma5cuWbQp764u+3/SkZx7l69fvy/Pnz8jGsrKyU+/d/K2R5t2cCxzqI98mTR+UoLl68dOQpzufjHBiCmcAj0SbpgaNOZXKYwBBMwBDMEnokLJtPJhP4hGm/Xt+8uVUYBxP4BGnx3rix9dGuH/P5mcAnhHjHScAjdO/eL+Xu3Z///Sze8bKEHpkW7uF42z3O4h0vAY/I+/G27TaN3So5XpbQI/F+vAfEO24CHoGnT//433gZP0voEbhw4Ss3cpxQJjAEM4FDtT/ht/Pbw/9C+lBnz64XMpnAoa5f/+GjhHfmzErZ3NwsZPJIHQjVHqljAkMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUOwru/LbgEidX0RMCQa2t0ZAq4ChkR93enm8/K4AHHmffmzWyzqr3vzAgTZb3Zvcrv7cm3y6M2sbi/6AgRorb6b1+21tbpT247ptF8ty7OHpyf9+a4W4Jhq8Q4D99kwfS8PAe/uXwduG23Hm7d123IajqfW5quh0YN4277/zNvp9PXGolvamiyVc6X2G8MBGwX45Pp+qK/2O8P77hDv4/Z7VTvlPXzMP0hBAZYIUs8OAAAAAElFTkSuQmCC",preview:!1},t):(0,i.__)(e)?(0,I.jsxs)("span",{className:T()("text-[14px] align-middle","leading-[16px]",{"coz-fg-secondary":"black"===n,[eu({showBackground:r})]:"white"===n}),children:["[",em({nodeList:e.children,theme:n,handleClickImage:o,showBackground:r}),"]"]},t):null)},eh=e=>{var{nodeList:t,theme:n}=e,[o,r]=(0,a.useState)(""),i=(0,g.rz)();return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(S.eT,{src:o,visible:!!o,onVisibleChange:()=>r("")}),em({nodeList:t,theme:n,handleClickImage:e=>{r(e)},showBackground:i})]})},eg=e=>{if(e.content_type===g.zc.Mix){var{refer_items:t}=null!==(n=JSON.parse(e.content))&&void 0!==n?n:{};if(t){var n,o,r,i,a=null==t?void 0:t[0];if((null==a?void 0:a.type)==="text")return{type:g.zc.Text,text:null==a?void 0:a.text};if((null==a?void 0:a.type)==="image")return{type:g.zc.Image,uri:null==a?void 0:null===(o=a.image)||void 0===o?void 0:o.key,url:null==a?void 0:null===(i=a.image)||void 0===i?void 0:null===(r=i.image_thumb)||void 0===r?void 0:r.url}}}},ef=e=>{var{children:t}=e,n=(0,g.rz)();return(0,I.jsxs)("div",{className:T()(["h-auto","py-4px"],"flex flex-row items-center select-none w-m-0"),children:[(0,I.jsx)(M.Z57,{className:T()(eu({showBackground:n}),"mr-[8px] shrink-0 w-[12px] h-[12px]")}),(0,I.jsx)("div",{className:T()("flex-1 min-w-0 truncate text-[12px]",["leading-[16px]",eu({showBackground:n})]),children:t})]})},e_=e=>{var{message:t}=e,n=eg(t);if(!n)return null;if(n.type===g.zc.Image)return(0,I.jsx)(ef,{children:(0,I.jsx)("img",{className:"w-[24px] h-[24px] rounded-[4px]",src:n.url})});var o=(0,i.hl)(n.text);return(0,I.jsx)(ef,{children:(0,I.jsx)(eh,{nodeList:o,theme:"white"})})},ex=e=>{var{message:t}=e,n=t.extra_info.local_message_id,{useQuoteStore:o}=(0,g.FL)(g.p7.MessageGrab).pluginBizContext.storeSet,r=o((0,N.N)(e=>e.quoteContentMap[n]));return r?(0,I.jsx)(ef,{children:(0,I.jsx)(eh,{nodeList:r,theme:"white"})}):null},eb=e=>{var{message:t}=e,n=t.extra_info.local_message_id,{useQuoteStore:o}=(0,g.FL)(g.p7.MessageGrab).pluginBizContext.storeSet;return o((0,N.N)(e=>!!e.quoteContentMap[n]))?(0,I.jsx)(ex,{message:t}):(0,I.jsx)(e_,{message:t})},ey=()=>{var{pluginBizContext:e,chatAreaPluginContext:t}=(0,g.FL)(g.p7.MessageGrab),{useChatInputLayout:n}=t.readonlyHook.input,{useQuoteStore:o}=e.storeSet,{quoteVisible:r,quoteContent:i,updateQuoteVisible:s,updateQuoteContent:l}=o((0,N.N)(e=>({quoteVisible:e.quoteVisible,quoteContent:e.quoteContent,updateQuoteVisible:e.updateQuoteVisible,updateQuoteContent:e.updateQuoteContent}))),{layoutContainerRef:d}=n();return((0,a.useEffect)(()=>{if(!!(null==d?void 0:d.current)){var e=e=>e.stopPropagation();return d.current.addEventListener("pointerup",e),()=>{var t;null===(t=d.current)||void 0===t||t.removeEventListener("pointerup",e)}}},[null==d?void 0:d.current]),i&&r)?(0,I.jsxs)("div",{className:"w-full h-[32px] flex items-center px-[16px] coz-mg-primary",children:[(0,I.jsx)(M.Z57,{className:"coz-fg-secondary mr-[8px] w-[12px] h-[12px]"}),(0,I.jsxs)("div",{className:"flex flex-row items-center flex-1",children:[(0,I.jsx)("div",{className:"coz-fg-secondary flex-1 min-w-0 w-0 truncate text-[12px] leading-[16px]",children:(0,I.jsx)(eh,{nodeList:i,theme:"black"})}),(0,I.jsx)(S.hU,{icon:(0,I.jsx)(M.rmE,{className:"w-[14px] h-[14px]"}),onClick:()=>{l(null),s(!1)},color:"secondary",size:"small",className:"!rounded-[4px]",wrapperClass:"flex item-center justify-center"})]})]}):null};class ew extends g.x1{constructor(...e){super(...e),this.pluginMode=g.tf.Writeable,this.pluginName=g.p7.MessageGrab,this.customComponents=(0,g.S3)({MessageListFloatSlot:ed,TextMessageInnerTopSlot:eb,InputAddonTop:ey}),this.lifeCycleServices={appLifeCycleService:new C(this),messageLifeCycleService:new y(this),commandLifeCycleService:new w(this)},this.publicMethods={updateEnableGrab:e=>{if(!!this.pluginBizContext){var{updateEnableGrab:t}=this.pluginBizContext.storeSet.usePreferenceStore.getState();t(e)}}}}}var eC=(0,l.Z)(),eI=e=>{var{preference:t,onQuote:n,onQuoteChange:o,scene:r}=e,i=(0,s.x0)();return{grabPlugin:{createPluginBizContext:()=>{var e={onQuote:n,onQuoteChange:o},a={useSelectionStore:c("plugin"),useQuoteStore:p("plugin"),usePreferenceStore:h("plugin")},s=(0,l.Z)();a.usePreferenceStore.getState().updateEnableGrab(t.enableGrab);var d=m({useQuoteStore:a.useQuoteStore},e);return{grabPluginId:i,storeSet:a,eventCallbacks:e,unsubscribe:()=>{d()},eventCenter:s,publicEventCenter:eC,scene:r}},Plugin:ew},grabPluginId:i}},eN=e=>{var{onQuote:t,scene:n="other"}=null!=e?e:{},[o,r]=(0,a.useState)(!0),{grabPlugin:i,grabPluginId:s}=(0,a.useMemo)(()=>eI({preference:{enableGrab:!0},onQuote:t,onQuoteChange:e=>{var{isEmpty:t}=e;r(t)},scene:n}),[]);return{grabEnableUpload:o,GrabPlugin:i,grabPluginId:s}}},392060:function(e,t,n){n.d(t,{GC:()=>W,jU:()=>A,b1:()=>l,y1:()=>j,hl:()=>K,KC:()=>k,y8:()=>u,mC:()=>E,Ry:()=>F,lp:()=>d,__:()=>T});var o,r,i=n("455069"),a=n("747514"),s=n("871482");function l(){return"ontouchend"in document}var d="data-grab-mark",u="data-grab-source",c=e=>{for(var t=[],n=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_ALL,{acceptNode:t=>e.intersectsNode(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}),o=n.currentNode;o;)t.push(o),o=n.nextNode();return t},v=(e,t)=>{for(var n=t.toUpperCase();e;){if(e.nodeType===Node.ELEMENT_NODE&&e.tagName===n)return e;e=e.parentNode}return null},p=(e,t)=>{for(;e&&e!==document;){var n,o=null;if(e instanceof Element&&(o=null===(n=e.attributes.getNamedItem(t))||void 0===n?void 0:n.value),e.nodeType===Node.ELEMENT_NODE&&o)return o;e=e.parentNode}return null},m=e=>{var t=c(e),n=0,o=!1;for(var r of t){var i=p(r,d);!o&&(o=!!v(r,"A")),i&&n++}var{endOffset:a}=e;return n!==t.length||o||0===a},h=e=>{for(var{node:t,scopeAncestorAttributeName:n,targetAttributeValue:o}=e,r=null;t;)n&&p(t,n)===o&&(r=t),t=t.nextSibling;return r},g=e=>{for(;e.lastChild;)e=e.lastChild;return e},f=(e,t)=>{var n=e.compareDocumentPosition(t);if(n&Node.DOCUMENT_POSITION_CONTAINED_BY)return"contains";if(n&Node.DOCUMENT_POSITION_CONTAINS)return"containedBy";if(n&Node.DOCUMENT_POSITION_FOLLOWING)return"before";else if(n&Node.DOCUMENT_POSITION_PRECEDING)return"after";return"none"},_=e=>{for(var{range:t,targetAttributeName:n,targetAttributeValue:o}=e,r=t.startContainer,{startOffset:i}=t;r&&p(r,n)!==o;)if(r.previousSibling)r=r.previousSibling,i=0;else if(r.parentNode&&r.parentNode!==document)r=r.parentNode,i=0;else{r=null;break}return{startNode:r,startOffset:i}},x=e=>{for(;e;){if(e.nodeType===Node.ELEMENT_NODE&&"A"===e.nodeName)return e;e=e.parentNode}return null},b=(e,t,n)=>{var o=x(t),r=x(n),i=!1;return o&&(e.setStartBefore(o),i=!0),r&&(e.setEndAfter(r),i=!0),i},y=e=>{for(var t,n,{range:o,targetAttributeName:r,targetAttributeValue:i}=e,a=o.endContainer,{endOffset:s}=o;a&&p(a,r)!==i;)if(a.nextSibling)a=a.nextSibling,s=0;else if(a.parentNode&&a.parentNode!==document)s=(a=a.parentNode)&&null!==(n=null===(t=g(a).textContent)||void 0===t?void 0:t.length)&&void 0!==n?n:0;else{a=null;break}return{endNode:a,endOffset:s}},w=e=>{for(var t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ALL,{acceptNode:t=>e.contains(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}),o=n.currentNode;o;)t.push(o),o=n.nextNode();return t},C=e=>{if(!e||e===document)return null;for(var t,n=null!==(t=e.previousSibling)&&void 0!==t?t:e.parentNode;n&&n!==document;){;if(!["containedBy","contains"].includes(f(n,e)))return n;n=n.previousSibling?n.previousSibling:n.parentNode}return null},I=e=>{var{range:t,startNode:n,endNode:o,endOffset:r}=e;if(n===o||0!==r)return!1;for(var i=C(o);i;){if(i.nodeType===Node.TEXT_NODE){;if((null===(a=i.textContent)||void 0===a?void 0:a.trim())&&(null===(s=i.textContent)||void 0===s?void 0:s.length))return t.setEnd(i,i.textContent.length),!0}else if(i.nodeType===Node.ELEMENT_NODE&&(null===(l=i.textContent)||void 0===l?void 0:l.trim())){var a,s,l,d,u=null;for(var c of w(i))c.nodeType===Node.TEXT_NODE&&(null===(d=c.textContent)||void 0===d?void 0:d.trim())&&(u=c);if(u&&u.textContent)return t.setEnd(u,u.textContent.length),!0}i=C(i)}return!1},N=e=>{var{range:t}=e,n=p(t.startContainer,d);if(!n)return!1;var{startNode:o,startOffset:r}=_({range:t,targetAttributeName:d,targetAttributeValue:n}),{endNode:i,endOffset:a}=y({range:t,targetAttributeName:d,targetAttributeValue:n});if(o&&!i){var s,l,{parentNode:u}=o,c=null,m=v(u,"LI"),x=m?v(m,"A"):v(u,"A"),w=v(u,"DIV");c=x?h({node:x,scopeAncestorAttributeName:d,targetAttributeValue:n}):m?h({node:m,scopeAncestorAttributeName:d,targetAttributeValue:n}):w?h({node:w,scopeAncestorAttributeName:d,targetAttributeValue:n}):h({node:o,scopeAncestorAttributeName:d,targetAttributeValue:n}),o===c&&(c=h({node:u,scopeAncestorAttributeName:d,targetAttributeValue:n})),c&&(a=(i=c).nodeType===Node.TEXT_NODE?i.length:null!==(l=null===(s=g(i).textContent)||void 0===s?void 0:s.length)&&void 0!==l?l:0)}if(o&&i){var C=f(o,i),N=!1;["before","none"].includes(C)&&(t.setStart(o,r),t.setEnd(i,a),N=!0);var E=b(t,o,i),j=I({range:t,startNode:o,endNode:i,endOffset:a});return N||E||j}return t.collapse(!1),!1},E=e=>e&&"text"in e;var j=((o={}).IMAGE="image",o.LINK="link",o),T=e=>e&&"url"in e&&"type"in e&&e.type===j.LINK,k=e=>e&&"src"in e&&"type"in e&&e.type===j.IMAGE,A=e=>{var t="";for(var n of e)E(n)?t+=n.text:T(n)?t+="[".concat(A(n.children),"](").concat(n.url,")"):k(n)?t+="![".concat(A(n.children),"](").concat(n.src,")"):t+=A(n.children);return t},M=e=>{if("src"in e&&"string"==typeof e.src)return e.src},S=e=>Array.from(e).filter(e=>M(e)).at(0),z=e=>{if("PICTURE"===e.nodeName.toUpperCase()){var t=S(e.childNodes);if(t)return t}if("A"===e.nodeName.toUpperCase()||["TH","TD"].includes(e.nodeName.toUpperCase()))return e},O=e=>{var t=[];if(!e.length)return t;for(var n of e){var o=z(n);if(o){var r=L(o);r&&t.push(r);continue}var i=L(n);i&&t.push(i);var a=O(n.childNodes);t.push(...a)}return t},L=e=>{if(!e)return null;var t=["TH","TD"].includes(e.nodeName.toUpperCase());return e.nodeType===e.TEXT_NODE||t?R(e,t):e.nodeType===e.ELEMENT_NODE&&e instanceof Element?D(e):void 0},R=(e,t)=>{if(!!e){var n,o=null!==(n=e.textContent)&&void 0!==n?n:"";return{text:t?" ".concat(o," "):o}}},D=e=>{if(!!e){if(["IMG","SOURCE"].includes(e.tagName.toUpperCase())){var t=R(e);return{type:j.IMAGE,src:"src"in e&&"string"==typeof e.src?e.src:"",children:t?[t]:[]}}if("A"===e.tagName.toUpperCase()){var n=R(e);return{type:j.LINK,url:"href"in e&&"string"==typeof e.href?e.href:"",children:n?[n]:[]}}}},P=e=>{var t="";for(var n of e)E(n)?t+=n.text:T(n)?t+="[".concat(P(n.children),"]"):k(n)?t+="![".concat(P(n.children),"]"):t+=P(n.children);return t},U=e=>{var t=e.cloneContents(),n=[];return!function e(t){t.nodeType===Node.TEXT_NODE?n.push(t):t.childNodes.forEach(e)}(t),n.some(e=>/\S/.test(e.textContent||""))};var B=((r={}).Forward="forward",r.Backward="backward",r.Unknown="unknown",r),Z=e=>{if(!e||e.isCollapsed)return B.Unknown;var{anchorNode:t}=e,{focusNode:n}=e;if(!t||!n)return B.Unknown;var{anchorOffset:o}=e,{focusOffset:r}=e;if(t===n)return o<=r?B.Forward:B.Backward;var i=f(t,n);if("before"===i)return B.Forward;if("after"===i)return B.Backward;return B.Unknown},F=(e,t)=>{for(;e&&e!==document;){var n,o=null;if(e instanceof Element&&(o=null===(n=e.attributes.getNamedItem(t))||void 0===n?void 0:n.value))return e;e=e.parentNode}return null},q=e=>{var t,n,o,{selection:r,hasFix:i}=e;if(!r.rangeCount)return;var a=r.getRangeAt(0);if(!a)return;var s=a.cloneContents(),l=Z(r),c=F(a.commonAncestorContainer.parentNode,d),v=null!==(o=null==c?void 0:null===(t=c.attributes.getNamedItem(d))||void 0===t?void 0:t.value)&&void 0!==o?o:null,p=null==c?void 0:null===(n=c.attributes.getNamedItem(u))||void 0===n?void 0:n.value;if(!i&&m(a)){if(!N({range:a}))return;return q({selection:r,hasFix:!0})}if(!U(a))return;var h=O(s.childNodes);if(!!h.length){var g=P(h);return{humanizedContentText:g,originContentText:A(h),normalizeSelectionNodeList:h,nodesAncestorIsMessageBox:!!v,ancestorAttributeValue:v,messageSource:Number(p),direction:l}}},V=e=>{var{selection:t}=e;if(!t.rangeCount)return;var n=t.getRangeAt(0);if(!!n)return{rangeRects:n.getClientRects()}},W=e=>{var{contentRef:t,floatMenuRef:n,onSelectChange:o,onPositionChange:r}=e,d=(0,i.useRef)(),u=(0,i.useRef)(null),c=(0,i.useRef)(null),[v,p]=(0,i.useState)(!1),m=(0,i.useRef)(null),h=(0,i.useRef)(!1),g=()=>{var e;o(null),r(null),null===(e=u.current)||void 0===e||e.removeAllRanges(),u.current=null,p(!1),h.current=!1,m.current&&clearTimeout(m.current)},f=()=>{var e,t=window.getSelection(),{direction:n=B.Unknown}=null!==(e=c.current)&&void 0!==e?e:{};if(!t){o(null);return}var i=V({selection:t});if(!i){r(null);return}var a=Array.from(i.rangeRects).at(n===B.Backward?0:-1);if(!a){r(null);return}var[s,l]=[0,0];n===B.Backward?(s=a.left,l=a.top+a.height):(s=a.x+a.width,l=a.y+a.height),r({x:s>screen.width-40?s-40:s,y:l>screen.height-40?l-40:a.y+a.height})},_=(0,s.$0)(()=>{m.current&&clearTimeout(m.current),p(!0),m.current=setTimeout(()=>{f(),p(!1)},100)}),x=()=>{if(!t.current){o(null);return}var e=window.getSelection();if(!e){o(null);return}u.current=e;var n=q({selection:e});if(!n||!n.nodesAncestorIsMessageBox){o(null);return}c.current=n,h.current=!!n,f(),o(n)},b=(0,s.$0)(()=>{clearTimeout(d.current),d.current=(0,a.Z)(x)}),y=(0,s.$0)(e=>{c.current&&((e.ctrlKey||e.metaKey)&&"a"===e.key&&o(null),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&x())}),w=(0,s.$0)(e=>{if(!t.current||!n||!(null==n?void 0:n.current))return;var{clientX:o,clientY:r}=e,i=n.current.getBoundingClientRect();if(!(r>=i.top)||!(r<=i.bottom)||!(o>=i.left)||!(o<=i.right))g()});return(0,i.useEffect)(()=>{if(!!h.current)return window.addEventListener("mousedown",w),()=>{window.removeEventListener("mousedown",w)}},[h.current]),(0,i.useEffect)(()=>{if(!!h.current)return window.addEventListener("resize",_),window.addEventListener("wheel",_),window.addEventListener("scroll",_),window.addEventListener("keydown",y),l()&&window.addEventListener("selectionchange",_),()=>{window.removeEventListener("resize",_),window.removeEventListener("wheel",_),window.removeEventListener("scroll",_),window.removeEventListener("keydown",y),window.removeEventListener("selectionchange",_)}},[h.current]),(0,i.useEffect)(()=>{var e=t.current;if(!!e)return e.addEventListener("pointerup",b),l()&&e.addEventListener("selectionchange",b),()=>{e.removeEventListener("pointerup",b),e.removeEventListener("selectionchange",b)}},[t.current]),{clearSelection:g,isScrolling:v,computePosition:_}},G=n("765377"),Q=n("193893"),{isImage:H,isLink:$,isParent:Y,isText:J}=G.zV,K=e=>X((0,Q.eL)(e)),X=e=>{var t=[],n=e=>{if(J(e))t.push({text:e.value});else if($(e)){var o,r=e.children.map(X).flat(1);t.push({type:j.LINK,url:e.url,children:r})}else H(e)?t.push({type:j.IMAGE,src:e.url,children:[{text:null!==(o=e.alt)&&void 0!==o?o:""}]}):Y(e)&&e.children.forEach(n)};return n(e),t}},497082:function(e,t,n){n.d(t,{W:function(){return l}});var o=n(151064),r=n(573242),i=n(879179),a=n(455069),s=(0,a.createContext)({isInProvider:!1}),l=e=>{var{children:t}=e,n=(0,a.useContext)(s);return(0,o.jsx)(s.Provider,{value:{isInProvider:!0},children:n.isInProvider?t:(0,o.jsx)(i.W,{backend:r.PD,context:window,children:t})})}},960394:function(e,t,n){n.d(t,{a:function(){return a}});var o=n(221478),r=n(990828),i=n(455069),a=e=>{var{id:t,type:n,direction:a="verticle",enabled:s=!0,onMove:l}=e,d=(0,i.useRef)(),u=(0,i.useRef)(s);u.current=s;var[{isHovered:c},v]=(0,o.L)({accept:n,collect:e=>({isHovered:e.isOver()}),canDrop:()=>u.current,hover:(e,n)=>{if(!!d.current&&e.id!==t){var o,r=n.getClientOffset(),i=null===(o=d.current)||void 0===o?void 0:o.getBoundingClientRect(),s=!1;if("verticle"===a){if((null==r?void 0:r.y)===void 0)return;var u=(i.top+i.bottom)/2;s=(null==r?void 0:r.y)<u,l(e.id,t,s)}if("horizontal"===a){if((null==r?void 0:r.x)===void 0)return;var c=(i.left+i.right)/2;s=(null==r?void 0:r.x)<c,l(e.id,t,s)}}}}),[{isDragging:p},m,h]=(0,r.c)({type:n,item:()=>({id:t}),canDrag:()=>u.current,collect:e=>({isDragging:e.isDragging()})});return{isHovered:c,isDragging:p,connect:(0,i.useMemo)(()=>(e,t)=>{v(e),m(null!=t?t:e),h(e),d.current=e.current},[v,m])}}},33575:function(e,t,n){n.d(t,{c:function(){return u}});var o=n(808549),r=n(120454),i=n(151064),a=n(497082),s=n(960394),l=e=>{var{id:t,type:n,data:a,itemRender:l,enabled:d,onMove:u,direction:c}=e,v=(0,s.a)({id:t,type:n,onMove:u,enabled:d,direction:c});return(0,i.jsx)(l,(0,r._)((0,o._)({},v),{data:a}))},d=e=>e.id,u=e=>{var{list:t,type:n,getId:o=d,onChange:r,enabled:s,itemRender:u,direction:c}=e;return(0,i.jsx)(a.W,{children:t.map(e=>{var a=o(e);return(0,i.jsx)(l,{type:n,id:a,data:e,itemRender:u,enabled:s,direction:c,onMove:(e,n,i)=>{var a=[...t],s=a.findIndex(t=>o(t)===e),l=a.splice(s,1)[0],d=a.findIndex(e=>o(e)===n)+(i?0:1);if(s!==d)l&&a.splice(d,0,l),r(a)}},a)})})}},967146:function(e,t,n){n.r(t),n.d(t,{isAuthError:()=>Y,BuilderChat:()=>ip,ChatSdkErrorType:()=>J,OpenApiError:()=>$,WebSdkChat:()=>i_,postErrorMessage:()=>K});var o,r,i,a,s,l,d,u,c,v,p,m,h,g,f,_,x,b,y,w,C=n("808549"),I=n("120454"),N=n("473980"),E=n("151064"),j=n("455069"),T=n("252237"),k=n.n(T),A=n("873352"),M=n("233708"),S=n("794322"),z=n("237464"),O=n("336205");var L=((o={}).PC="pc",o.MOBILE="mobile",o);var R=((r={}).BOT="bot",r.APP="app",r);var D=((i={}).UNAUTH="unauth",i.TOKEN="token",i),P=n("825955"),U=n("716894"),B=n("992499"),Z=n("801815"),F=n("871873"),q=n("136515");var V=((a={})[a.Base=1e3]="Base",a[a.OpenApiUpload=1001]="OpenApiUpload",a[a.NoClearAPI=1002]="NoClearAPI",a[a.StoreProvider=1003]="StoreProvider",a[a.Iframe=2e3]="Iframe",a[a.IframeParams=2001]="IframeParams",a[a.Core=3e3]="Core",a[a.NotError=4e3]="NotError",a);class W extends Error{static wrap(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=new W({sdkCode:t});return n.message=e.message,n.name=e.name,n.cause=e.cause,n.stack=e.stack,n}static create(e){return new W({sdkCode:e})}constructor(e){super(),"number"==typeof e?this.sdkCode=e:this.sdkCode=e.sdkCode}}var G=((s={})[s.BotUnbind=0x29db5cd3]="BotUnbind",s),Q=[0x29db5cd3],H=e=>{var t=null==e?void 0:e.code;if(0x29db5cd3===t)return{code:t,msg:O.o.t("unbind_notification")}};var $=((l={})[l.ERROR_FORBIDDEN=401]="ERROR_FORBIDDEN",l[l.ERROR_INVALID_TOKEN=4100]="ERROR_INVALID_TOKEN",l[l.ERROR_TOKEN_FORBIDDEN=4101]="ERROR_TOKEN_FORBIDDEN",l[l.ERROR_TOKEN_FAILED=0x29b955e6]="ERROR_TOKEN_FAILED",l[l.BOT_NOT_PUBLISH=4015]="BOT_NOT_PUBLISH",l),Y=e=>[401,4100,4101,0x29b955e6].includes(e);var J=((d={}).INVALID_BOT_ID="INVALID_BOT_ID",d.OPEN_API_ERROR="OPEN_API_ERROR",d),K=e=>{window.parent.postMessage({type:"chat-sdk-error",data:e},"*")};var X=((u={}).WebSdk="web_sdk",u.ChatFlow="chat_flow",u.MiniProgram="mini_program",u.MiniProgramV2="mini_program_v2",u),ee=n("664319"),et=n("915757"),en=n("674343"),eo=n("479886"),er=n.n(eo);var ei=((c={})[c.Today=0]="Today",c[c.In30days=1]="In30days",c[c.Others=999]="Others",c),ea=new Map([[0,O.o.t("profile_history_today",{},"")],[1,O.o.t("log_pay_wall_date_filter_30_days",{},"30")],[999,O.o.t("web_sdk_past",{},"")]]),es=()=>{var e=e2(e=>e.userInfo);return(0,j.useMemo)(()=>e?(0,I._)((0,C._)({},e),{userUniqueName:"",userLabel:null}):{id:(0,Z.x0)(),nickname:"",url:"",userUniqueName:"",userLabel:null},[e])},el=n("735114"),ed=e=>{var t,n,{requestFn:o,requestParams:r,pageSize:i=20,initialPageNum:a=1,autoLoad:s=!0}=e,[l,d]=(0,j.useState)(a),[u,c]=(0,j.useState)([]),[v,p]=(0,j.useState)(!0);var{loading:m,error:h,run:g}=(0,el.Z)((t=(0,P._)(function*(e){var t=(0,I._)((0,C._)({},r),{page_size:i,page_num:null!=e?e:l});return yield o(t)}),function(e){return t.apply(this,arguments)}),{manual:!0,onSuccess:(e,t)=>{var[n]=t,o=null!=n?n:l,r=e.data,i=!!e.has_more;1===o?c(r):c(e=>[...e,...r]),p(i),d(o)},onError:e=>{console.error(":",e)}}),f=(0,j.useCallback)((0,P._)(function*(){!m&&v&&(yield g(l+1))}),[m,v,l,g]),_=(0,j.useCallback)((0,P._)(function*(){c([]),d(1),yield g(1)}),[g]);var x=(0,j.useCallback)((n=(0,P._)(function*(e){e>=1&&(yield g(e))}),function(e){return n.apply(this,arguments)}),[g]),b=(0,j.useCallback)((0,P._)(function*(){c([]),d(a),yield p(!1)}),[a]);return(0,j.useEffect)(()=>{s&&g(a)},[s,a,g]),{data:u,loading:m,error:h,hasMore:v,currentPage:l,loadMore:f,refresh:_,setPageNum:x,reset:b}},eu=e=>{var t,{pageSize:n=20,initialPageNum:o=1,order:r="updated_at"}=null!=e?e:{},{chatConfig:{bot_id:i,auth:{connectorId:a}={}}}=e4(),{cozeApiSdk:s,currentConversationInfo:l,updateCurrentConversationInfo:d,conversations:u,updateConversations:c}=e2((0,ee.N)(e=>({cozeApiSdk:e.cozeApi,conversations:e.conversations,updateCurrentConversationInfo:e.updateCurrentConversationInfo,currentConversationInfo:e.currentConversationInfo,updateConversations:e.updateConversations}))),v=es();var{data:p,hasMore:m,loadMore:h,loading:g}=ed({requestFn:(t=(0,P._)(function*(e){if(!s||!i)return{data:[],has_more:!1};try{var t=yield s.conversations.list(e);return{data:t.conversations,has_more:t.has_more}}catch(e){return console.error(e),{data:[],has_more:!1}}}),function(e){return t.apply(this,arguments)}),requestParams:{bot_id:i,connector_id:a,sort_field:r,user_id:null==v?void 0:v.id},pageSize:n,initialPageNum:o,autoLoad:!!s&&!!i});return(0,j.useEffect)(()=>{p&&c(p,"replace")},[p]),(0,j.useEffect)(()=>{if(!l&&p.length>0){var e=document.querySelector(".coze-chat-sdk"),t=(0,I._)((0,C._)({},p[0]),{conversationListVisible:!1,isLargeWidth:!1});e&&e.offsetWidth>=780&&(t=(0,I._)((0,C._)({},t),{conversationListVisible:!0,isLargeWidth:!0})),d(t)}},[l,p]),{conversations:u,loading:g,hasMore:m,loadMore:h}},ec=e=>{var t=(0,j.useMemo)(()=>{var t=new Date,n=2592e6;return e.map(e=>{var o=e.updated_at||e.created_at||0,r=er().unix(Number(o)).toDate(),i=t.getTime()-r.getTime();return t.toLocaleDateString()===r.toLocaleDateString()?(0,I._)((0,C._)({},e),{sort:ei.Today}):i<n?(0,I._)((0,C._)({},e),{sort:ei.In30days}):(0,I._)((0,C._)({},e),{sort:ei.Others})}).sort((e,t)=>e.sort!==t.sort?e.sort-t.sort:er().unix(Number(t.updated_at||t.created_at||0)).valueOf()-er().unix(Number(e.updated_at||e.created_at||0)).valueOf())},[e]);return(0,j.useMemo)(()=>{var e=new Map;return t.forEach(t=>{var n;!e.has(t.sort)&&e.set(t.sort,[]),null===(n=e.get(t.sort))||void 0===n||n.push(t)}),e},[t])},ev=e=>{var{onRename:t,onDelete:n,visible:o,children:r}=e;return(0,E.jsx)(E.Fragment,{children:(0,E.jsx)(en.v2,{trigger:"custom",position:"bottom",visible:o,render:(0,E.jsxs)(en.v2.SubMenu,{mode:"menu",children:[(0,E.jsx)(en.v2.Item,{onClick:(e,n)=>{n.stopPropagation(),n.preventDefault(),t()},icon:(0,E.jsx)(et.JAz,{}),children:O.o.t("workflow_detail_node_rename",{},"")}),(0,E.jsx)(en.v2.Item,{onClick:(e,t)=>{t.stopPropagation(),t.preventDefault(),n()},icon:(0,E.jsx)(et.dVD,{color:"var(--coz-fg-hglt-red)"}),children:(0,E.jsx)("span",{style:{color:"var(--coz-fg-hglt-red)"},children:O.o.t("web_sdk_delete",{},"")})})]}),children:r})})},ep=n("407821"),em=n.n(ep),eh=n("472772"),eg=n.n(eh),ef=n("395245"),e_=n.n(ef),ex=n("297998"),eb=n.n(ex),ey=n("646576"),ew=n.n(ey),eC=n("606121"),eI=n.n(eC),eN=n("114096"),eE={};eE.styleTagTransform=eI(),eE.setAttributes=eb(),eE.insert=e_().bind(null,"head"),eE.domAPI=eg(),eE.insertStyleElement=ew(),em()(eN.Z,eE);var ej=eN.Z&&eN.Z.locals?eN.Z.locals:void 0,eT=e=>{var{isActive:t,item:n,shouldDisplayTime:o,onConversationChange:r,onRename:i,onDelete:a}=e,[s,l]=(0,j.useState)(!1),[d,u]=(0,j.useState)(!1),c=(0,j.useRef)(null),v=(0,j.useRef)(null),p=()=>{l(!1),u(!1)},m=(0,j.useCallback)(e=>{c.current=setTimeout(()=>{l(!0)},500),v.current=setTimeout(()=>{u(!0)},300)},[]),h=(0,j.useCallback)(e=>{v.current&&(clearTimeout(v.current),v.current=null),c.current&&(clearTimeout(c.current),c.current=null)},[]),g=(0,j.useCallback)(()=>{v.current&&(clearTimeout(v.current),v.current=null),c.current&&(clearTimeout(c.current),p(),c.current=null)},[]);return(0,E.jsxs)("div",{className:ej["conversation-item"],children:[o?(0,E.jsx)("div",{className:ej["conversation-item-time"],children:ea.get(n.sort)}):null,(0,E.jsx)(ev,{onRename:()=>{i(n),p()},onDelete:()=>{a(n),p()},visible:s,children:(0,E.jsx)("div",{className:k()(ej["conversation-item-content"],{[ej["conversation-item-content-active"]]:t,[ej["conversation-item-content-touched"]]:d,[ej["conversation-item-content-operate-visible"]]:s}),onClick:()=>{if(!s)r(n)},onTouchStart:m,onTouchEnd:h,onTouchMove:g,onContextMenu:e=>{e.preventDefault()},children:(0,E.jsx)(en.ZT.Text,{style:{flex:1},ellipsis:{showTooltip:{opts:{content:n.name,style:{wordBreak:"break-all"},position:"top",spacing:4}}},children:n.name||O.o.t("web_sdk_conversation_default_name",{},"")})})}),s?(0,E.jsx)("div",{onClick:e=>{e.stopPropagation(),e.preventDefault(),p()},className:ej["conversation-item-mask"]}):null]})},ek=e=>{var{children:t,onRename:n,onDelete:o,visible:r,setVisible:i}=e;return(0,E.jsx)(en.v2,{trigger:"custom",position:"bottomLeft",visible:r,onClickOutSide:()=>i(!1),render:(0,E.jsxs)(en.v2.SubMenu,{mode:"menu",children:[(0,E.jsx)(en.v2.Item,{onClick:(e,t)=>{t.stopPropagation(),t.preventDefault(),n()},icon:(0,E.jsx)(et.JAz,{}),children:O.o.t("workflow_detail_node_rename",{},"")}),(0,E.jsx)(en.v2.Item,{onClick:(e,t)=>{t.stopPropagation(),t.preventDefault(),o()},icon:(0,E.jsx)(et.dVD,{color:"var(--coz-fg-hglt-red)"}),children:(0,E.jsx)("span",{style:{color:"var(--coz-fg-hglt-red)"},children:O.o.t("web_sdk_delete",{},"")})})]}),children:t})},eA=n("294025"),eM={};eM.styleTagTransform=eI(),eM.setAttributes=eb(),eM.insert=e_().bind(null,"head"),eM.domAPI=eg(),eM.insertStyleElement=ew(),em()(eA.Z,eM);var eS=eA.Z&&eA.Z.locals?eA.Z.locals:void 0,ez=e=>{var{isActive:t,item:n,shouldDisplayTime:o,onConversationChange:r,onRename:i,onDelete:a}=e,[s,l]=(0,j.useState)(!1);return(0,E.jsxs)("div",{className:eS["conversation-item"],children:[o?(0,E.jsx)("div",{className:eS["conversation-item-time"],children:ea.get(n.sort)}):null,(0,E.jsxs)("div",{className:k()(eS["conversation-item-content"],{[eS["conversation-item-content-active"]]:t}),onClick:()=>r(n),children:[(0,E.jsx)(en.ZT.Text,{style:{flex:1},ellipsis:{showTooltip:{opts:{content:n.name,style:{wordBreak:"break-all"},position:"top",spacing:4}}},children:n.name||O.o.t("web_sdk_conversation_default_name",{},"")}),(0,E.jsx)(ek,{onRename:()=>{i(n),l(!1)},onDelete:()=>{a(n),l(!1)},visible:s,setVisible:l,children:(0,E.jsx)(en.hU,{className:eS["conversation-operate"],onClick:e=>{e.stopPropagation(),e.preventDefault(),l(!0)},size:"small",icon:(0,E.jsx)(et.NsR,{}),color:"secondary"})})]})]})},eO=n("410017"),eL={};eL.styleTagTransform=eI(),eL.setAttributes=eb(),eL.insert=e_().bind(null,"head"),eL.domAPI=eg(),eL.insertStyleElement=ew(),em()(eO.Z,eL);var eR=eO.Z&&eO.Z.locals?eO.Z.locals:void 0,eD=(0,j.forwardRef)((e,t)=>{var n,o,{onRename:r,onDelete:i,loading:a,groupedConversations:s,conversations:l,hasMore:d,loadMore:u}=e,{currentConversationInfo:c,updateCurrentConversationInfo:v,cozeApi:p,updateConversations:m}=e2((0,ee.N)(e=>({currentConversationInfo:e.currentConversationInfo,updateCurrentConversationInfo:e.updateCurrentConversationInfo,cozeApi:e.cozeApi,updateConversations:e.updateConversations}))),h=es(),g=(0,j.useRef)(),[f,_]=(0,j.useState)(!1),{layout:x,chatConfig:{bot_id:b,auth:{connectorId:y}={}}}=e4(),w=(0,j.useMemo)(()=>x===L.MOBILE,[x]),N=(0,j.useRef)(null),T=(0,j.useRef)(null);var k=(n=(0,P._)(function*(){if(!!c)try{var e=yield null==p?void 0:p.conversations.create({bot_id:b,connector_id:y,user_id:null==h?void 0:h.id});(null==e?void 0:e.id)&&(g.current=(0,I._)((0,C._)({},c),{id:e.id,last_section_id:e.last_section_id}),m([e],"add"),v((0,I._)((0,C._)({},c,e),{name:""})),en.FN.info({content:O.o.t("web_sdk_create_conversation",{},""),showClose:!1}))}catch(e){console.error(e)}}),function(){return n.apply(this,arguments)}),A=e=>{if(!!c&&e.id!==(null==c?void 0:c.id)){var t=(0,I._)((0,C._)({},c,e),{id:e.id,sectionId:e.last_section_id});g.current=t,v(t)}};var M=(o=(0,P._)(function*(e){try{var t=yield null==p?void 0:p.delete("/v1/conversations/".concat(e.id));if(0!==t.code)return!1;return yield m([e],"remove"),!0}catch(e){return console.error(e),!1}}),function(e){return o.apply(this,arguments)});return(0,j.useImperativeHandle)(t,()=>({getConversationInfo:()=>g.current?{conversationId:g.current.id,sectionId:g.current.last_section_id}:l.length>0?{conversationId:l[0].id,sectionId:l[0].last_section_id}:void 0,handleCreateConversation:k,handleDeleteConversation:M})),(0,j.useEffect)(()=>{var e=new IntersectionObserver(e=>{var[t]=e;t.isIntersecting&&d&&!a&&u()},{root:N.current,rootMargin:"100px",threshold:.01});return T.current&&e.observe(T.current),()=>{T.current&&e.unobserve(T.current)}},[d,a,u]),(0,E.jsxs)("div",{className:eR.conversations,children:[(0,E.jsxs)("div",{className:eR["conversations-header"],children:[(0,E.jsx)("span",{className:eR["conversations-header-title"],children:O.o.t("web_sdk_conversation_history",{},"")}),(0,E.jsx)(en.hU,{color:"secondary",onClick:()=>{c&&v((0,I._)((0,C._)({},c),{conversationListVisible:!1}))},icon:(0,E.jsx)(et.Ib0,{width:"18px",height:"18px"})})]}),(0,E.jsx)(en.zx,{size:"large",icon:(0,E.jsx)(et.PwN,{}),iconPosition:"left",color:"highlight",className:eR["conversations-create-button"],onClick:(0,P._)(function*(){_(!0),yield k(),_(!1)}),loading:f,children:O.o.t("web_sdk_add_new_conversation",{},"")}),(0,E.jsxs)("div",{ref:N,className:eR["conversations-list"],children:[Array.from(s.entries()).map(e=>{var[t,n]=e;return(0,E.jsx)("div",{className:eR["conversations-list-group"],children:n.map((e,t)=>w?(0,E.jsx)(eT,{isActive:e.id===(null==c?void 0:c.id),item:e,shouldDisplayTime:0===t,onConversationChange:A,onRename:r,onDelete:i},e.id):(0,E.jsx)(ez,{isActive:e.id===(null==c?void 0:c.id),item:e,shouldDisplayTime:0===t,onConversationChange:A,onRename:r,onDelete:i},e.id))},t)}),(0,E.jsx)("div",{ref:T,style:{height:"10px",flexShrink:0}}),a?(0,E.jsx)(en.yC,{style:{width:"100%"}}):null]})]})}),eP=n("72113"),eU={};eU.styleTagTransform=eI(),eU.setAttributes=eb(),eU.insert=e_().bind(null,"head"),eU.domAPI=eg(),eU.insertStyleElement=ew(),em()(eP.Z,eU);var eB=eP.Z&&eP.Z.locals?eP.Z.locals:void 0,eZ=(0,j.forwardRef)((e,t)=>{var n,o,{children:r}=e,i=(0,j.useRef)(null),{currentConversationInfo:a,updateConversations:s,cozeApi:l}=e2((0,ee.N)(e=>({currentConversationInfo:e.currentConversationInfo,updateConversations:e.updateConversations,cozeApi:e.cozeApi}))),{loading:d,conversations:u,hasMore:c,loadMore:v}=eu(),p=ec(u),[m,h]=(0,j.useState)(!1),[g,f]=(0,j.useState)(null),_=e=>{f({visible:!0,type:"rename",conversation:e})},x=e=>{f({visible:!0,type:"delete",conversation:e})};var b=(n=(0,P._)(function*(e){try{var t=yield null==l?void 0:l.put("/v1/conversations/".concat(e.id),{name:e.name});if(0!==t.code)return;yield s([t.data],"update")}catch(e){console.error(e)}}),function(e){return n.apply(this,arguments)});(0,j.useImperativeHandle)(t,()=>({getConversationInfo:()=>{if(i.current)return i.current.getConversationInfo()}}));var y=(o=(0,P._)(function*(){if(!!g){h(!0);try{if((null==g?void 0:g.type)==="rename")yield b(g.conversation);else{var e,t,n;g.conversation.id===(null==a?void 0:a.id)?(yield null===(e=i.current)||void 0===e?void 0:e.handleDeleteConversation(g.conversation))&&(yield null===(t=i.current)||void 0===t?void 0:t.handleCreateConversation()):yield null===(n=i.current)||void 0===n?void 0:n.handleDeleteConversation(g.conversation)}h(!1),f(null)}catch(e){console.error(e),h(!1)}}}),function(){return o.apply(this,arguments)});return(0,E.jsxs)("div",{className:eB["conversations-container"],children:[(null==a?void 0:a.conversationListVisible)&&(null==a?void 0:a.isLargeWidth)?(0,E.jsx)(eD,{ref:i,onRename:_,onDelete:x,loading:d,groupedConversations:p,conversations:u,hasMore:c,loadMore:v}):null,(0,E.jsx)(j.Fragment,{children:r},null==a?void 0:a.id),(0,E.jsx)(en.Uu,{visible:(null==a?void 0:a.conversationListVisible)&&!(null==a?void 0:a.isLargeWidth),closeIcon:(0,E.jsx)(et.Ib0,{}),closable:!1,closeOnEsc:!1,maskClosable:!1,getPopupContainer:()=>document.querySelector(".coze-chat-sdk"),placement:"left",width:320,className:eB["conversations-side-sheet"],headerStyle:{display:"none"},bodyStyle:{padding:0,height:"100%"},children:(0,E.jsx)(eD,{ref:i,onRename:_,onDelete:x,loading:d,groupedConversations:p,conversations:u,hasMore:c,loadMore:v})}),(0,E.jsx)(en.u_,{getPopupContainer:()=>document.querySelector(".coze-chat-sdk"),okButtonProps:{loading:m},visible:null==g?void 0:g.visible,onCancel:()=>f(null),title:(null==g?void 0:g.type)==="delete"?O.o.t("web_sdk_delete_conversation",{},""):O.o.t("web_sdk_rename_conversation",{},""),onOk:y,okText:(null==g?void 0:g.type)==="delete"?O.o.t("web_sdk_delete",{},""):O.o.t("web_sdk_confirm",{},""),cancelText:O.o.t("web_sdk_cancel",{},""),okButtonColor:(null==g?void 0:g.type)==="delete"?"red":"brand",closable:!1,maskClosable:!1,style:{maxWidth:"80%"},children:(null==g?void 0:g.type)==="rename"?(0,E.jsx)(en.II,{placeholder:O.o.t("web_sdk_conversation_placeholder",{},""),value:g.conversation.name,maxLength:100,onChange:e=>f((0,I._)((0,C._)({},g),{conversation:(0,I._)((0,C._)({},g.conversation),{name:e})}))}):(0,E.jsx)("span",{className:eB["conversations-list-delete-modal-text"],children:O.o.t("web_sdk_conversation_delete_content",{},"")})})]})}),eF=n("479910"),eq=n("598208"),eV=n("61111"),eW=Symbol(),eG=e=>{try{return JSON.stringify(e)}catch(e){return console.log("catchStringify error",e),eW}},eQ=(e,t)=>{try{return JSON.parse(e)}catch(e){console.log("catchParse error",e)}return t};var eH=((v={}).ChatHistory="ChatHistory",v.UID="OpenSDKUID",v),e$=(e,t)=>"coze__".concat(e,"__").concat(null!=t?t:""),eY=(e,t)=>{var n=localStorage.getItem(e);return n?eQ(n,t):t};var eJ=((p={}).Text="text",p.Voice="voice",p.VoiceCall="call",p),eK=e=>{if(null==e?void 0:e.id)return e;var t=e$(eH.UID);return{id:eY(t,"")||(0,Z.x0)(),nickname:"",url:""}},eX=(e,t)=>{var n,o,r=(null==e?void 0:null===(n=e.auth)||void 0===n?void 0:n.type)===D.TOKEN,i=r?null==e?void 0:null===(o=e.auth)||void 0===o?void 0:o.token:"";return(0,eq.Ue)()((0,eF.mW)((0,eF.XR)((n,o)=>{var a;return{userInfo:eK(t),token:i,isNeedToken:r,voiceCallClose:!0,isStartBotVoiceCall:!1,isNeedStopRespond:!0,initError:!1,voiceInfoList:[],lastGroupFeedbackInfo:{cozeApiMessageId:"",isShowCustomPanel:!1},backgroundInfo:{},shortcuts:[],defaultInputMode:eJ.Text,feedbackInfo:{},currentConversationInfo:void 0,conversations:[],cozeApi:void 0,hasRefusedCallByUser:!1,setHasRefusedCallByUser:e=>{n((0,eV.Uy)(t=>{t.hasRefusedCallByUser=e}))},refreshToken:(0,P._)(function*(){var t,r,i=o().token||"",a=yield null==e?void 0:null===(r=e.auth)||void 0===r?void 0:null===(t=r.onRefreshToken)||void 0===t?void 0:t.call(r,i);return a&&n((0,eV.Uy)(e=>{e.token=a})),a||""}),setUserInfo:e=>{n((0,eV.Uy)(t=>{t.userInfo=eK(e)}))},setUserId:e=>{n((0,eV.Uy)(t=>{t.userInfo={id:e,nickname:"",url:""}}))},setToken:e=>{n((0,eV.Uy)(t=>{t.token=e}))},setInitError:e=>{var{initError:t}=o();if(!e||!t||"boolean"==typeof t)n((0,eV.Uy)(t=>{t.initError=e}))},setDefaultInputMode:e=>{n((0,eV.Uy)(t=>{t.defaultInputMode=e}))},updateLastGroupFeedbackInfo:(e,t)=>{n((0,eV.Uy)(n=>{n.lastGroupFeedbackInfo={messageId:e,isShowCustomPanel:t}}))},updateFeedbackInfo:(e,t)=>{n((0,eV.Uy)(n=>{n.feedbackInfo[e]=t}))},updateShortcuts(e){n((0,eV.Uy)(t=>{t.shortcuts=e}))},updateBackgroundInfo(e){n((0,eV.Uy)(t=>{t.backgroundInfo=e}))},setVoiceCallClose(e){n((0,eV.Uy)(t=>{t.voiceCallClose=e}))},setIsStartBotVoiceCall(e){n((0,eV.Uy)(t=>{t.isStartBotVoiceCall=e}))},updateCurrentConversationInfo:e=>{n((0,eV.Uy)(t=>{e?t.currentConversationInfo=(0,C._)({},t.currentConversationInfo,e):t.currentConversationInfo=e}))},updateCurrentConversationNameByMessage:(a=(0,P._)(function*(e){var{currentConversationInfo:t,updateCurrentConversationInfo:n,updateConversations:r,cozeApi:i}=o();if(!t||t.name)return Promise.resolve(!1);try{var a=yield null==i?void 0:i.put("/v1/conversations/".concat(t.id),{name:e});if(0!==a.code)return Promise.resolve(!1);return n((0,I._)((0,C._)({},t),{name:e})),yield r([a.data],"update"),!0}catch(e){return console.error(e),Promise.resolve(!1)}}),function(e){return a.apply(this,arguments)}),updateConversations:(e,t)=>{n((0,eV.Uy)(n=>{"replace"===t?n.conversations=e:"add"===t?n.conversations=[...n.conversations,...e]:"remove"===t?e.forEach(e=>{var t=n.conversations.findIndex(t=>t.id===e.id);-1!==t&&n.conversations.splice(t,1)}):"update"===t&&e.forEach(e=>{var t=n.conversations.findIndex(t=>t.id===e.id);-1!==t&&(n.conversations[t]=(0,C._)({},n.conversations[t],e))})}))},setCozeApi:e=>{n((0,eV.Uy)(t=>{t.cozeApi=e}))}}}),{enabled:!1,name:"CozeChatApp.global"}))},e0=(0,j.createContext)({}),e1=e=>{var t,n,{children:o,appProps:r}=e,i=(0,j.useMemo)(()=>({conversation_id:(0,Z.x0)(),source:X.WebSdk}),[]),a=(0,j.useRef)({getConversationInfo:()=>void 0}),s=(null===(n=r.chatConfig.ui)||void 0===n?void 0:null===(t=n.conversations)||void 0===t?void 0:t.isNeed)&&r.chatConfig.type!==R.APP,l=(0,j.useMemo)(()=>{var e,t=(e=(0,P._)(function*(e){var t,n;return"function"==typeof r.openRequestInit?n=yield r.openRequestInit(e):r.openRequestInit&&(n=r.openRequestInit),(0,C._)({},n,null===(t=a.current)||void 0===t?void 0:t.getConversationInfo())}),function(t){return e.apply(this,arguments)}),n=(0,I._)((0,C._)({},r),{openRequestInit:t,chatConfig:(0,F.Z)({},i,r.chatConfig)});return n.chatConfig.conversation_id=n.chatConfig.conversation_id||i.conversation_id,n},[r]),[d]=(0,j.useState)(()=>eX(r.chatConfig,r.userInfo));return(0,q.Z)(()=>{r.userInfo&&d.getState().setUserInfo(r.userInfo)},[r.userInfo]),(0,E.jsx)(e0.Provider,{value:{appProps:l,store:d},children:s?(0,E.jsx)(eZ,{ref:a,children:o}):o})},e4=()=>{var{appProps:e}=(0,j.useContext)(e0),{chatConfig:t={conversation_id:(0,Z.x0)(),source:X.WebSdk,bot_id:""},layout:n=L.PC,enableReplacePrologueNicknameWithVar:o=!1}=null!=e?e:{};return(0,I._)((0,C._)({},e),{chatConfig:t,layout:n,enableReplacePrologueNicknameWithVar:o})},e2=e=>{var{store:t}=(0,j.useContext)(e0);if(!t)throw W.create(V.StoreProvider);return(0,U.s)(t,e,B.X)},e5=()=>{var e,t=e2(e=>e.backgroundInfo),{isCustomBackground:n}=e4();return n||!!(null==t?void 0:null===(e=t.mobile_background_image)||void 0===e?void 0:e.origin_image_url)||!1},e3=()=>e5()?"bg-theme":"light",e9=n("19642"),e8=n("780601"),e6=n("417373"),e7=n("417536"),te=n("325618"),tt=e=>{var t,{controller:n,onShortcutActive:o}=e,r=(0,j.useRef)(void 0),i=e5(),a=e2(e=>e.shortcuts),s=null===(t=a.at(0))||void 0===t?void 0:t.command_id;return(null==a?void 0:a.length)?(0,E.jsx)(e7.RV,{shortcuts:a,wrapperClassName:k()("w-full pl-[68px] pr-[24px] pb-[10px]"),uiMode:(0,e7.i9)({bizScene:"websdk",showBackground:i}),defaultId:s,onActiveShortcutChange:(e,t)=>{r.current=e;n.setChatInputSlotVisible(!t),null==o||o(e)},onBeforeSendTemplateShortcut:e=>{var t,n,o,{message:r,options:i,shortcut:a}=e,s={};Object.entries((null==i?void 0:null===(o=i.extendFiled)||void 0===o?void 0:null===(n=o.toolList)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.parameters)||{}).map(e=>{var[t,n]=e;s[t]=n.value});var l=i||{};return!l.extendFiled&&(l.extendFiled={}),(a.tool_type===te.qK.ToolTypePlugin||a.tool_type===te.qK.ToolTypeWorkFlow)&&(l.extendFiled.shortcut_command={command_id:a.command_id,parameters:s}),{message:r,options:i}}}):null},tn=n("552995"),to=n("771588"),tr=e=>{var{width:t,height:n,className:o}=e;return(0,E.jsx)(to.ZPm,{svg:(0,E.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18",fill:"currentColor",children:(0,E.jsx)("path",{d:"M13.4997 16.5H4.49881C2.84338 16.5 1.5 15.1574 1.5 13.5013V4.50088C1.5 2.84333 2.84338 1.5 4.49881 1.5H13.4997C15.158 1.5 16.5 2.84331 16.5 4.50088V13.5013C16.5 15.1574 15.158 16.5 13.4997 16.5ZM15.0013 5.25092C15.0013 4.00792 13.9919 3.00008 12.7496 3.00008H5.24889C4.00657 3.00008 2.99864 4.00792 2.99864 5.25092V12.7498C2.99864 13.9943 4.00657 15.0007 5.24889 15.0007H12.7496C13.9919 15.0007 15.0013 13.9943 15.0013 12.7498V5.25092ZM9.74933 11.9997C9.74933 12.414 9.41351 12.7498 8.99925 12.7498C8.585 12.7498 8.24918 12.414 8.24918 11.9997V9.75115H5.99967C5.58503 9.75115 5.24889 9.41502 5.24889 9.00037C5.24889 8.58572 5.58503 8.24958 5.99967 8.24958H8.24918V6.00099C8.24918 5.58674 8.585 5.25092 8.99925 5.25092C9.41351 5.25092 9.74933 5.58674 9.74933 6.001V8.24958H11.9988C12.4135 8.24958 12.7496 8.58572 12.7496 9.00037C12.7496 9.41502 12.4135 9.75115 11.9988 9.75115H9.74933V11.9997Z",fill:"currentColor"})}),className:o,style:{width:t,height:n}})},ti=()=>{var e,t,n,o,r,i,a,s,l,d,u,c,v,p,m,h,g,f,{chatConfig:_}=e4(),x=[],b=[];return console.log("useChatOpInfo:",_),(null==_?void 0:null===(t=_.ui)||void 0===t?void 0:null===(e=t.header)||void 0===e?void 0:e.isShow)?(null==_?void 0:null===(o=_.ui)||void 0===o?void 0:null===(n=o.chatBot)||void 0===n?void 0:n.isNeedClearContext)?(x.push("clearContext"),(null==_?void 0:null===(i=_.ui)||void 0===i?void 0:null===(r=i.chatBot)||void 0===r?void 0:r.isNeedClearMessage)?b.push("clearMessage"):(null==_?void 0:null===(s=_.ui)||void 0===s?void 0:null===(a=s.chatBot)||void 0===a?void 0:a.isNeedAddNewConversation)&&b.push("addNewConversation")):(null==_?void 0:null===(d=_.ui)||void 0===d?void 0:null===(l=d.chatBot)||void 0===l?void 0:l.isNeedClearMessage)?x.push("clearMessage"):(null==_?void 0:null===(c=_.ui)||void 0===c?void 0:null===(u=c.chatBot)||void 0===u?void 0:u.isNeedAddNewConversation)&&x.push("addNewConversation"):((null==_?void 0:null===(p=_.ui)||void 0===p?void 0:null===(v=p.chatBot)||void 0===v?void 0:v.isNeedClearContext)&&x.push("clearContext"),(null==_?void 0:null===(h=_.ui)||void 0===h?void 0:null===(m=h.chatBot)||void 0===m?void 0:m.isNeedClearMessage)?x.push("clearMessage"):(null==_?void 0:null===(f=_.ui)||void 0===f?void 0:null===(g=f.chatBot)||void 0===g?void 0:g.isNeedAddNewConversation)&&x.push("addNewConversation")),{chatInputLeftOps:x,headerTopLeftOps:b}},ta=e=>{var{isClearHistoryButtonDisabled:t,isClearContextButtonDisabled:n}=(0,e8.$V)({}),{readonly:o}=e4(),{clearHistory:r}=(0,e8.bU)(),i=(0,e8.rw)();return(0,j.useMemo)(()=>e.map(e=>"addNewConversation"===e?{icon:(0,E.jsx)(tr,{width:"18px",height:"18px"}),text:O.o.t("web_sdk_add_new_conversation"),disabled:t||o,onClick:()=>{null==r||r()}}:"clearContext"===e?{icon:(0,E.jsx)(et.zd$,{width:"18px",height:"18px"}),text:O.o.t("store_start_new_chat"),disabled:n||o,onClick:()=>{i()}}:{icon:(0,E.jsx)(et.bGR,{width:"18px",height:"18px"}),text:O.o.t("coze_home_delete_btn"),disabled:t||o,onClick:()=>{null==r||r()}}),[e,n,t,o,r,i])},ts=n("394917"),tl={};tl.styleTagTransform=eI(),tl.setAttributes=eb(),tl.insert=e_().bind(null,"head"),tl.domAPI=eg(),tl.insertStyleElement=ew(),em()(ts.Z,tl);var td=ts.Z&&ts.Z.locals?ts.Z.locals:void 0,tu=e=>{var{buttonList:t}=e,n=e5(),[o,r]=(0,j.useState)(!1),{readonly:i}=e4();return(0,j.useEffect)(()=>(document.addEventListener("click",()=>{r(!1)}),()=>{r(!1)}),[]),(0,E.jsx)(en.J2,{content:(0,E.jsx)(en.T,{className:td.container,vertical:!0,spacing:0,children:null==t?void 0:t.map((e,t)=>(0,E.jsx)(en.zx,{color:"secondary",className:td.button,icon:null==e?void 0:e.icon,iconPosition:"left",onClick:null==e?void 0:e.onClick,disabled:null==e?void 0:e.disabled,children:null==e?void 0:e.text},t))}),trigger:"custom",visible:o,position:"topLeft",style:{borderRadius:"4px"},children:(0,E.jsx)(tn.Hg,{"data-testid":"bot-edit-debug-chat-clear-button",showBackground:n,disabled:i,icon:(0,E.jsx)(et.NsR,{className:"text-18px"}),size:"default",onClick:e=>{e.stopPropagation(),r(e=>!e)},className:k()("mr-12px","!rounded-full")})})},tc=()=>{var e,t,{chatInputLeftOps:n}=ti(),o=e5(),{chatConfig:r}=e4(),i=(null===(t=r.ui)||void 0===t?void 0:null===(e=t.base)||void 0===e?void 0:e.layout)===L.MOBILE,a=ta(n);return 0===n.length?null:(0,E.jsxs)("div",{className:td["chat-input-left-slot"],children:[a.length>1?(0,E.jsx)(tu,{buttonList:a}):null,1===a.length?(0,E.jsx)(tn.t5,{content:a[0].text,hideToolTip:i,children:(0,E.jsx)(tn.Hg,{"data-testid":"bot-edit-debug-chat-clear-button",showBackground:o,disabled:a[0].disabled,icon:a[0].icon,onClick:e=>{var t,n;null===(t=(n=a[0]).onClick)||void 0===t||t.call(n)},className:k()("mr-12px","!rounded-full",o?"!coz-fg-images-white":"",{[td.disabled]:a[0].disabled})})}):null]})},tv=n("357110"),tp={};tp.styleTagTransform=eI(),tp.setAttributes=eb(),tp.insert=e_().bind(null,"head"),tp.domAPI=eg(),tp.insertStyleElement=ew(),em()(tv.Z,tp);var tm=tv.Z&&tv.Z.locals?tv.Z.locals:void 0,th=e=>{var t,n,o,r,i,a,s,{coreAreaClassName:l,className:d,showInputArea:u=!0,inputPlaceholder:c,inputNativeCallbacks:v,messageGroupListClassName:p,renderChatInputTopSlot:m,isShowClearContextDivider:h,headerNode:g,messageMaxWidth:f,isMiniScreen:_,enableMultimodalUpload:x=!1}=e,b=(0,e8.w5)(),{layout:y,onInitStateChange:w,chatConfig:C}=e4(),I=(0,j.useRef)(null),{readonly:N}=e4(),{source:T}=C,A=(0,j.useMemo)(()=>T===X.ChatFlow?e9.i:e9.J,[T]),M=(0,j.useMemo)(()=>({chatInputIntegration:{renderChatInputTopSlot:e=>(0,E.jsxs)(E.Fragment,{children:[null==m?void 0:m(),(0,E.jsx)(tt,{controller:e})]})},contentBox:A}),[m,A]);if((0,j.useEffect)(()=>{switch(b){case"initSuccess":case"initFail":null==w||w(b)}},[b,w]),"initSuccess"!==b)return null;var S=null===(s=null==C?void 0:null===(n=C.ui)||void 0===n?void 0:null===(t=n.chatBot)||void 0===t?void 0:t.uploadable)||void 0===s||s,z=!x&&S,O=x&&S;return(0,E.jsx)("div",{className:k()(tm.area,d,{[tm.disabled]:N}),tabIndex:1e3,ref:I,children:(0,E.jsx)(e8.hU,{classname:l,layout:y===L.PC?void 0:y,showInputArea:u,newMessageInterruptScenario:"never",messageGroupListClassName:p,showClearContextDivider:h||(null==C?void 0:null===(r=C.ui)||void 0===r?void 0:null===(o=r.chatBot)||void 0===o?void 0:o.isNeedClearContext),messageMaxWidth:f,showStopRespond:!0,enableLegacyUpload:z,enableMultimodalUpload:O,fileLimit:O?6:void 0,textareaPlaceholder:c||e6.oc.t("chatInputPlaceholder"),enableMessageBoxActionBar:!0,chatInputProps:{wrapperClassName:tm.chatInput,inputNativeCallbacks:v,safeAreaClassName:(null==C?void 0:null===(a=C.ui)||void 0===a?void 0:null===(i=a.footer)||void 0===i?void 0:i.isShow)!==!1?tm["safe-area"]:"",leftActions:(0,E.jsx)(tc,{})},componentTypes:M,readonly:N,uiKitChatInputButtonConfig:{isClearContextButtonVisible:!1,isClearHistoryButtonVisible:!1},isMiniScreen:_,headerNode:g})})},tg=e=>({}),tf=n("775699"),t_=e=>({onSendMessageError:e=>{var{error:t}=e;if(t instanceof Error){var n=eQ(t.message,{});(null==n?void 0:n.code)&&(null==n?void 0:n.msg)&&tf.FN.error(n.msg)}},onBeforeSendMessage:t=>{var n,{options:o={}}=t,r=Object.assign({},o,{extendFiled:(0,I._)((0,C._)({},null==o?void 0:o.extendFiled),{extra:(0,C._)({},(null==o?void 0:null===(n=o.extendFiled)||void 0===n?void 0:n.extra)||{},e.pluginBizContext.extraBody||{})})});return(0,I._)((0,C._)({},t),{options:r})}}),tx=e=>({}),tb=e=>({onInitialError:()=>{e.pluginBizContext.onInitialError()}}),ty=e=>({appLifeCycleService:tb(e),messageLifeCycleService:t_(e),commandLifeCycleService:tx(e),renderLifeCycleService:tg(e)});class tw extends e8.x1{constructor(...e){super(...e),this.pluginMode=e8.tf.Writeable,this.pluginName=e8.p7.WebsdkChatCommonPlugin,this.lifeCycleServices=(0,e8.BO)(this,ty)}}var tC=e=>({createPluginBizContext:()=>(0,C._)({},e),Plugin:tw}),tI=n("626389"),tN=n.n(tI),tE=n("537845"),tj=n("380835"),tT=n("983153"),tk=n("828950"),tA=n("732562"),tM=e=>{var{botId:t,source:n,token:o,uploadFile:r}=e;return class e{start(){}on(e,t){this.eventBus.on(e,t)}pause(){}cancel(){}upload(){var e=this;return(0,P._)(function*(){return e.eventBus.emit("ready",{percent:0,status:e8.KF.Uploading}),yield r({source:n,botId:t,file:e.file,token:o,onProgress:t=>{e.eventBus.emit("progress",{percent:t,status:e8.KF.Uploading})}})})()}constructor(e){this.eventBus=new tA.v,this.file=e.file,this.fileType=e.type,this.upload().then(e=>{this.eventBus.emit("complete",{percent:100,status:e8.KF.Success,uploadResult:{Uri:e.uri,Url:e.url},type:"success"})}).catch(e=>{this.eventBus.emit("error")})}}},tS=n("168607"),tz=n("297158"),tO=n("319276"),tL=(0,tS.rY)();tL.init({bid:"bot_studio_sdk",env:(0,tj.MN)({env:"thirdPart",deployVersion:"release"})}),tL.start();var tR="open_sdk_custom_error_";class tD extends tz.bR{openSdkEvent(e,t){this.event({eventName:"open_sdk_custom_event_"+e,meta:(0,C._)({},null!=t?t:{},tO.VG)})}openSdkError(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V.Base;if(!(e instanceof Error)){this.errorEvent({eventName:tR+V.NotError,error:W.create(V.NotError),meta:{error:e}});return}this.errorEvent({eventName:tR+t,error:e,meta:tO.VG})}}var tP=new tD;tP.init(tL);var tU=n("615655"),tB=()=>{var e=(0,j.useRef)(),{updateCurrentConversationNameByMessage:t,currentConversationInfo:n}=e2((0,ee.N)(e=>({updateCurrentConversationNameByMessage:e.updateCurrentConversationNameByMessage,currentConversationInfo:e.currentConversationInfo}))),{useMessagesStore:o}=(0,e8.NN)(),r=o(e=>e.messages,tU.Z);(0,j.useEffect)(()=>{e.current=null==n?void 0:n.name},[n]),(0,j.useEffect)(()=>{var n=r[r.length-1],o=null==n?void 0:n.content.slice(0,100);n&&!e.current&&(t(o),e.current=o)},[r])},tZ=n("165882"),tF=n("902845"),tq=n("574621"),tV=function(e,t){return(tV=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function tW(e,t){function n(){this.constructor=e}tV(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var tG=function(e,t){this.target=t,this.type=e},tQ=function(e){function t(t,n){var o=e.call(this,"error",n)||this;return o.message=t.message,o.error=t,o}return tW(t,e),t}(tG),tH=function(e){function t(t,n,o){void 0===t&&(t=1e3),void 0===n&&(n="");var r=e.call(this,"close",o)||this;return r.wasClean=!0,r.code=t,r.reason=n,r}return tW(t,e),t}(tG),t$=function(){if("undefined"!=typeof WebSocket)return WebSocket},tY={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+4e3*Math.random(),minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0},tJ=function(){function e(e,t,n){var o=this;void 0===n&&(n={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(e){o._debug("open event");var t=o._options.minUptime,n=void 0===t?tY.minUptime:t;clearTimeout(o._connectTimeout),o._uptimeTimeout=setTimeout(function(){return o._acceptOpen()},n),o._ws.binaryType=o._binaryType,o._messageQueue.forEach(function(e){return o._ws.send(e)}),o._messageQueue=[],o.onopen&&o.onopen(e),o._listeners.open.forEach(function(t){return o._callEventListener(e,t)})},this._handleMessage=function(e){o._debug("message event"),o.onmessage&&o.onmessage(e),o._listeners.message.forEach(function(t){return o._callEventListener(e,t)})},this._handleError=function(e){o._debug("error event",e.message),o._disconnect(void 0,"TIMEOUT"===e.message?"timeout":void 0),o.onerror&&o.onerror(e),o._debug("exec error listeners"),o._listeners.error.forEach(function(t){return o._callEventListener(e,t)}),o._connect()},this._handleClose=function(e){o._debug("close event"),o._clearTimeouts(),o._shouldReconnect&&o._connect(),o.onclose&&o.onclose(e),o._listeners.close.forEach(function(t){return o._callEventListener(e,t)})},this._url=e,this._protocols=t,this._options=n,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(e,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CONNECTING",{get:function(){return e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"OPEN",{get:function(){return e.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSING",{get:function(){return e.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSED",{get:function(){return e.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferedAmount",{get:function(){return this._messageQueue.reduce(function(e,t){return"string"==typeof t?e+=t.length:t instanceof Blob?e+=t.size:e+=t.byteLength,e},0)+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?e.CLOSED:e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),e.prototype.close=function(e,t){if(void 0===e&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(e,t)},e.prototype.reconnect=function(e,t){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,this._ws&&this._ws.readyState!==this.CLOSED&&this._disconnect(e,t),this._connect()},e.prototype.send=function(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{var t=this._options.maxEnqueuedMessages,n=void 0===t?tY.maxEnqueuedMessages:t;this._messageQueue.length<n&&(this._debug("enqueue",e),this._messageQueue.push(e))}},e.prototype.addEventListener=function(e,t){this._listeners[e]&&this._listeners[e].push(t)},e.prototype.dispatchEvent=function(e){var t,n,o=this._listeners[e.type];if(o)try{for(var r,i,a,s=(r=o,i="function"==typeof Symbol&&r[Symbol.iterator],a=0,i?i.call(r):{next:function(){return r&&a>=r.length&&(r=void 0),{value:r&&r[a++],done:!r}}}),l=s.next();!l.done;l=s.next()){var d=l.value;this._callEventListener(e,d)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return!0},e.prototype.removeEventListener=function(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(function(e){return e!==t}))},e.prototype._debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._options.debug&&console.log.apply(console,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}(arguments[t]));return e}(["RWS>"],e))},e.prototype._getNextDelay=function(){var e=this._options,t=e.reconnectionDelayGrowFactor,n=void 0===t?tY.reconnectionDelayGrowFactor:t,o=e.minReconnectionDelay,r=void 0===o?tY.minReconnectionDelay:o,i=e.maxReconnectionDelay,a=void 0===i?tY.maxReconnectionDelay:i,s=0;return this._retryCount>0&&(s=r*Math.pow(n,this._retryCount-1))>a&&(s=a),this._debug("next delay",s),s},e.prototype._wait=function(){var e=this;return new Promise(function(t){setTimeout(t,e._getNextDelay())})},e.prototype._getNextUrl=function(e){if("string"==typeof e)return Promise.resolve(e);if("function"==typeof e){var t=e();if("string"==typeof t)return Promise.resolve(t);if(t.then)return t}throw Error("Invalid URL")},e.prototype._connect=function(){var e,t=this;if(!this._connectLock&&!!this._shouldReconnect){this._connectLock=!0;var n=this._options,o=n.maxRetries,r=void 0===o?tY.maxRetries:o,i=n.connectionTimeout,a=void 0===i?tY.connectionTimeout:i,s=n.WebSocket,l=void 0===s?t$():s;if(this._retryCount>=r){this._debug("max retries reached",this._retryCount,">=",r);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!(void 0!==(e=l)&&e&&2===e.CLOSING))throw Error("No valid WebSocket class provided");this._wait().then(function(){return t._getNextUrl(t._url)}).then(function(e){if(!t._closeCalled)t._debug("connect",{url:e,protocols:t._protocols}),t._ws=t._protocols?new l(e,t._protocols):new l(e),t._ws.binaryType=t._binaryType,t._connectLock=!1,t._addListeners(),t._connectTimeout=setTimeout(function(){return t._handleTimeout()},a)})}},e.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new tQ(Error("TIMEOUT"),this))},e.prototype._disconnect=function(e,t){if(void 0===e&&(e=1e3),this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(e,t),this._handleClose(new tH(e,t,this))}catch(e){}}},e.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},e.prototype._callEventListener=function(e,t){"handleEvent"in t?t.handleEvent(e):t(e)},e.prototype._removeListeners=function(){if(!!this._ws)this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError)},e.prototype._addListeners=function(){if(!!this._ws)this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError)},e.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},e}(),tK=n("767821"),tX=n("206995");n("952745"),n("383003");class t0{constructor(e){this._client=e}}class t1 extends t0{async create(e,t){return(await this._client.post("/v1/bot/create",e,!1,t)).data}async update(e,t){return(await this._client.post("/v1/bot/update",e,!1,t)).data}async list(e,t){return(await this._client.get("/v1/space/published_bots_list",e,!1,t)).data}async listNew(e,t){return(await this._client.get("/v1/bots",e,!1,t)).data}async publish(e,t){return(await this._client.post("/v1/bot/publish",e,!1,t)).data}async retrieve(e,t){return(await this._client.get("/v1/bot/get_online_info",e,!1,t)).data}async retrieveNew(e,t,n){let o=`/v1/bots/${e}`;return(await this._client.get(o,t,!1,n)).data}}function t4(){return"undefined"!=typeof uni}function t2(){return"undefined"!=typeof window}function t5(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((e,t)=>{if(void 0===t)return e||{};for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(function(e){if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);if(null===t)return!0;let n=t;for(;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n}(t[n])&&!Array.isArray(t[n])?e[n]=t5(e[n]||{},t[n]):e[n]=t[n]);return e},{})}function t3(e,t){let n=Object.entries(t||{}).filter(e=>{let[t,n]=e;return null!=n&&""!==n}).map(e=>{let[t,n]=e;return`${t}=${n}`}).join("&");return`${e}${n?`?${n}`:""}`}let t9=()=>"undefined"!=typeof chrome&&!!chrome.runtime&&!!chrome.runtime.id;class t8 extends Error{}class t6 extends t8{static makeMessage(e,t,n,o){if(!t&&n)return n;if(t){let e=[],{code:n,msg:r,error:i}=t;n&&e.push(`code: ${n}`),r&&e.push(`msg: ${r}`),(null==i?void 0:i.detail)&&r!==i.detail&&e.push(`detail: ${i.detail}`);let a=(null==i?void 0:i.logid)||(null==o?void 0:o["x-tt-logid"]);return a&&e.push(`logid: ${a}`),e.join(", ")}return e?`http status code: ${e} (no body)`:"(no status code or body)"}static generate(e,t,n,o){return e?400===e||(null==t?void 0:t.code)===4e3?new nt(e,t,n,o):401===e||(null==t?void 0:t.code)===4100?new nn(e,t,n,o):403===e||(null==t?void 0:t.code)===4101?new no(e,t,n,o):404===e||(null==t?void 0:t.code)===4200?new nr(e,t,n,o):429===e||(null==t?void 0:t.code)===4013?new na(e,t,n,o):408===e?new ni(e,t,n,o):502===e?new nl(e,t,n,o):e>=500?new ns(e,t,n,o):new t6(e,t,n,o):new t7({cause:nd(t)})}constructor(e,t,n,o){var r,i;super(`${t6.makeMessage(e,t,n,o)}`),this.status=e,this.headers=o,this.logid=(null==t?void 0:null===(r=t.detail)||void 0===r?void 0:r.logid)||(null==o?void 0:o["x-tt-logid"]),this.code=null==t?void 0:t.code,this.msg=null==t?void 0:t.msg,this.detail=null==t?void 0:null===(i=t.error)||void 0===i?void 0:i.detail,this.rawError=t}}class t7 extends t6{constructor({message:e}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0}}class ne extends t6{constructor(e){super(void 0,void 0,e||"Request was aborted.",void 0),this.name="UserAbortError",this.status=void 0}}class nt extends t6{constructor(...e){super(...e),this.name="BadRequestError",this.status=400}}class nn extends t6{constructor(...e){super(...e),this.name="AuthenticationError",this.status=401}}class no extends t6{constructor(...e){super(...e),this.name="PermissionDeniedError",this.status=403}}class nr extends t6{constructor(...e){super(...e),this.name="NotFoundError",this.status=404}}class ni extends t6{constructor(...e){super(...e),this.name="TimeoutError",this.status=408}}class na extends t6{constructor(...e){super(...e),this.name="RateLimitError",this.status=429}}class ns extends t6{constructor(...e){super(...e),this.name="InternalServerError",this.status=500}}class nl extends t6{constructor(...e){super(...e),this.name="GatewayError",this.status=502}}let nd=e=>e instanceof Error?e:Error(e);class nu extends t0{async list(e,t,n){let o=`/v3/chat/message/list?conversation_id=${e}&chat_id=${t}`;return(await this._client.get(o,void 0,!1,n)).data}}let nc=()=>(Math.random()*new Date().getTime()).toString(),nv=e=>null==e?void 0:e.map(e=>({...e,content:"object"==typeof e.content?JSON.stringify(e.content):e.content})),np=e=>{if(e)for(let[t,n]of Object.entries(e))"object"==typeof n&&(e[t]=JSON.stringify(n));return e};class nm extends t0{async create(e,t){!e.user_id&&(e.user_id=nc());let{conversation_id:n,...o}=e,r=`/v3/chat${n?`?conversation_id=${n}`:""}`,i={...o,additional_messages:nv(e.additional_messages),shortcut_command:e.shortcut_command?{...e.shortcut_command,parameters:np(e.shortcut_command.parameters)}:void 0,stream:!1};return(await this._client.post(r,i,!1,t)).data}async createAndPoll(e,t){let n;!e.user_id&&(e.user_id=nc());let{conversation_id:o,...r}=e,i=`/v3/chat${o?`?conversation_id=${o}`:""}`,a={...r,additional_messages:nv(e.additional_messages),shortcut_command:e.shortcut_command?{...e.shortcut_command,parameters:np(e.shortcut_command.parameters)}:void 0,stream:!1},s=await this._client.post(i,a,!1,t),l=s.data.id,d=s.data.conversation_id;for(;await new Promise(e=>{setTimeout(e,100)}),"completed"!==(n=await this.retrieve(d,l)).status&&"failed"!==n.status&&"requires_action"!==n.status;);return{chat:n,messages:await this.messages.list(d,l)}}async *stream(e,t){!e.user_id&&(e.user_id=nc());let{conversation_id:n,...o}=e,r=`/v3/chat${n?`?conversation_id=${n}`:""}`,i={...o,additional_messages:nv(e.additional_messages),shortcut_command:e.shortcut_command?{...e.shortcut_command,parameters:np(e.shortcut_command.parameters)}:void 0,stream:!0};for await(let e of(await this._client.post(r,i,!0,t)))if("done"===e.event){let t={event:e.event,data:"[DONE]"};yield t}else try{let t={event:e.event,data:JSON.parse(e.data)};yield t}catch(t){throw new t8(`Could not parse message into JSON:${e.data}`)}}async retrieve(e,t,n){let o=`/v3/chat/retrieve?conversation_id=${e}&chat_id=${t}`;return(await this._client.post(o,void 0,!1,n)).data}async cancel(e,t,n){return(await this._client.post("/v3/chat/cancel",{conversation_id:e,chat_id:t},!1,n)).data}async *submitToolOutputs(e,t){let{conversation_id:n,chat_id:o,...r}=e,i=`/v3/chat/submit_tool_outputs?conversation_id=${e.conversation_id}&chat_id=${e.chat_id}`,a={...r};if(!1===e.stream)return(await this._client.post(i,a,!1,t)).data;for await(let e of(await this._client.post(i,a,!0,t)))if("done"===e.event){let t={event:e.event,data:"[DONE]"};yield t}else try{let t={event:e.event,data:JSON.parse(e.data)};yield t}catch(t){throw new t8(`Could not parse message into JSON:${e.data}`)}}constructor(...e){super(...e),this.messages=new nu(this._client)}}var nh=((m={}).CONVERSATION_CHAT_CREATED="conversation.chat.created",m.CONVERSATION_CHAT_IN_PROGRESS="conversation.chat.in_progress",m.CONVERSATION_CHAT_COMPLETED="conversation.chat.completed",m.CONVERSATION_CHAT_FAILED="conversation.chat.failed",m.CONVERSATION_CHAT_REQUIRES_ACTION="conversation.chat.requires_action",m.CONVERSATION_MESSAGE_DELTA="conversation.message.delta",m.CONVERSATION_MESSAGE_COMPLETED="conversation.message.completed",m.CONVERSATION_AUDIO_DELTA="conversation.audio.delta",m.DONE="done",m.ERROR="error",m);class ng extends t0{async create(e,t,n){let o=`/v1/conversation/message/create?conversation_id=${e}`;return(await this._client.post(o,t,!1,n)).data}async update(e,t,n,o){let r=`/v1/conversation/message/modify?conversation_id=${e}&message_id=${t}`;return(await this._client.post(r,n,!1,o)).message}async retrieve(e,t,n){let o=`/v1/conversation/message/retrieve?conversation_id=${e}&message_id=${t}`;return(await this._client.get(o,null,!1,n)).data}async list(e,t,n){let o=`/v1/conversation/message/list?conversation_id=${e}`;return await this._client.post(o,t,!1,n)}async delete(e,t,n){let o=`/v1/conversation/message/delete?conversation_id=${e}&message_id=${t}`;return(await this._client.post(o,void 0,!1,n)).data}}class nf extends t0{async create(e,t){return(await this._client.post("/v1/conversation/create",e,!1,t)).data}async retrieve(e,t){let n=`/v1/conversation/retrieve?conversation_id=${e}`;return(await this._client.get(n,null,!1,t)).data}async list(e,t){return(await this._client.get("/v1/conversations",e,!1,t)).data}async clear(e,t){let n=`/v1/conversations/${e}/clear`;return(await this._client.post(n,null,!1,t)).data}constructor(...e){super(...e),this.messages=new ng(this._client)}}class n_ extends t0{async upload(e,t){return(await this._client.post("/v1/files/upload",(0,tF.k5)(e),!1,t)).data}async retrieve(e,t){let n=`/v1/files/retrieve?file_id=${e}`;return(await this._client.get(n,null,!1,t)).data}}class nx extends t0{async create(e,t){return await this._client.post("/v1/workflow/run",e,!1,t)}async *stream(e,t){for await(let n of(await this._client.post("/v1/workflow/stream_run",e,!0,t)))try{"Done"===n.event?yield new nb(Number(n.id),"Done"):yield new nb(Number(n.id),n.event,JSON.parse(n.data))}catch(e){throw new t8(`Could not parse message into JSON:${n.data}`)}}async *resume(e,t){for await(let n of(await this._client.post("/v1/workflow/stream_resume",e,!0,t)))try{"Done"===n.event?yield new nb(Number(n.id),"Done"):yield new nb(Number(n.id),n.event,JSON.parse(n.data))}catch(e){throw new t8(`Could not parse message into JSON:${n.data}`)}}async history(e,t,n){let o=`/v1/workflows/${e}/run_histories/${t}`;return(await this._client.get(o,void 0,!1,n)).data}}class nb{constructor(e,t,n){this.id=e,this.event=t,this.data=n}}class ny extends t0{async *stream(e,t){let n={...e,additional_messages:nv(e.additional_messages)};for await(let e of(await this._client.post("/v1/workflows/chat",n,!0,t)))if(e.event===nh.DONE){let t={event:e.event,data:"[DONE]"};yield t}else try{let t={event:e.event,data:JSON.parse(e.data)};yield t}catch(t){throw new t8(`Could not parse message into JSON:${e.data}`)}}}class nw extends t0{constructor(...e){super(...e),this.runs=new nx(this._client),this.chat=new ny(this._client)}}class nC extends t0{async list(e,t){let n=await this._client.get("/v1/workspaces",e,!1,t);return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{return JSON.parse(e)}catch(e){return t}}(n,n).data}}let nI={"agw-js-conv":"str"};class nN extends t0{list(e,t){return this._client.get("/open_api/knowledge/document/list",e,!1,t5(t,{headers:nI}))}async create(e,t){return(await this._client.post("/open_api/knowledge/document/create",e,!1,t5(t,{headers:nI}))).document_infos}async delete(e,t){await this._client.post("/open_api/knowledge/document/delete",e,!1,t5(t,{headers:nI}))}async update(e,t){await this._client.post("/open_api/knowledge/document/update",e,!1,t5(t,{headers:nI}))}}class nE extends t0{constructor(...e){super(...e),this.documents=new nN(this._client)}}let nj={"agw-js-conv":"str"};class nT extends t0{async list(e,t){return await this._client.post("/open_api/knowledge/document/list",e,!1,t5(t,{headers:nj}))}async create(e,t){return(await this._client.post("/open_api/knowledge/document/create",e,!1,t5(t,{headers:nj}))).document_infos}async delete(e,t){await this._client.post("/open_api/knowledge/document/delete",e,!1,t5(t,{headers:nj}))}async update(e,t){await this._client.post("/open_api/knowledge/document/update",e,!1,t5(t,{headers:nj}))}}class nk extends t0{async update(e,t,n,o){let r=`/v1/datasets/${e}/images/${t}`;await this._client.put(r,n,!1,o)}async list(e,t,n){let o=`/v1/datasets/${e}/images`;return(await this._client.get(o,t,!1,n)).data}}class nA extends t0{async create(e,t){return(await this._client.post("/v1/datasets",e,!1,t)).data}async list(e,t){return(await this._client.get("/v1/datasets",e,!1,t)).data}async update(e,t,n){let o=`/v1/datasets/${e}`;await this._client.put(o,t,!1,n)}async delete(e,t){let n=`/v1/datasets/${e}`;await this._client.delete(n,!1,t)}async process(e,t,n){let o=`/v1/datasets/${e}/process`;return(await this._client.post(o,t,!1,n)).data}constructor(...e){super(...e),this.documents=new nT(this._client),this.images=new nk(this._client)}}class nM extends t0{async clone(e,t){return(await this._client.post("/v1/audio/voices/clone",(0,tF.k5)(e),!1,t)).data}async list(e,t){return(await this._client.get("/v1/audio/voices",e,!1,t)).data}}class nS extends t0{async create(e,t){return(await this._client.post("/v1/audio/transcriptions",(0,tF.k5)(e),!1,t)).data}}class nz extends t0{async create(e,t){return await this._client.post("/v1/audio/speech",{...e,sample_rate:e.sample_rate||24e3},!1,t5(t,{responseType:"arraybuffer"}))}}class nO extends t0{async create(e,t){return(await this._client.post("/v1/audio/rooms",e,!1,t)).data}}class nL extends t0{async create(e,t,n){let o=`/v1/audio/voiceprint_groups/${e}/features`;return(await this._client.post(o,(0,tF.k5)(t),!1,n)).data}async update(e,t,n,o){let r=`/v1/audio/voiceprint_groups/${e}/features/${t}`;return(await this._client.put(r,(0,tF.k5)(n),!1,o)).data}async delete(e,t,n){let o=`/v1/audio/voiceprint_groups/${e}/features/${t}`;return(await this._client.delete(o,!1,n)).data}async list(e,t,n){let o=`/v1/audio/voiceprint_groups/${e}/features`;return(await this._client.get(o,t,!1,n)).data}async speakerIdentify(e,t,n){let o=`/v1/audio/voiceprint_groups/${e}/speaker_identify`;return(await this._client.post(o,(0,tF.k5)(t),!1,n)).data}}class nR extends t0{async create(e,t){return(await this._client.post("/v1/audio/voiceprint_groups",e,!1,t)).data}async list(e,t){return(await this._client.get("/v1/audio/voiceprint_groups",e,!1,t)).data}async update(e,t,n){let o=`/v1/audio/voiceprint_groups/${e}`;return(await this._client.put(o,t,!1,n)).data}async delete(e,t){let n=`/v1/audio/voiceprint_groups/${e}`;return(await this._client.delete(n,!1,t)).data}constructor(...e){super(...e),this.features=new nL(this._client)}}class nD extends t0{async retrieve(e,t){let n=`/v1/audio/live/${e}`;return(await this._client.get(n,void 0,!1,t)).data}}class nP extends t0{constructor(...e){super(...e),this.rooms=new nO(this._client),this.live=new nD(this._client),this.voices=new nM(this._client),this.speech=new nz(this._client),this.transcriptions=new nS(this._client),this.voiceprintGroups=new nR(this._client)}}class nU extends t0{async duplicate(e,t,n){let o=`/v1/templates/${e}/duplicate`;return(await this._client.post(o,t,!1,n)).data}}class nB extends t0{async create(e,t){let n=t3("/v1/chat",e);return await this._client.makeWebsocket(n,t)}}class nZ extends t0{async create(e,t){let n=t3("/v1/audio/transcriptions",e);return await this._client.makeWebsocket(n,t)}}class nF extends t0{async create(e,t){let n=t3("/v1/audio/speech",e);return await this._client.makeWebsocket(n,t)}}class nq extends t0{async create(e){return await this._client.makeWebsocket("/v1/audio/simult_interpretation",e)}}class nV extends t0{constructor(...e){super(...e),this.speech=new nF(this._client),this.transcriptions=new nZ(this._client),this.simultInterpretation=new nq(this._client)}}var nW=((h={}).CLIENT_ERROR="client_error",h.CLOSED="closed",h.ALL="all",h.ERROR="error",h.INPUT_TEXT_BUFFER_APPEND="input_text_buffer.append",h.INPUT_TEXT_BUFFER_COMPLETE="input_text_buffer.complete",h.SPEECH_UPDATE="speech.update",h.SPEECH_UPDATED="speech.updated",h.SPEECH_CREATED="speech.created",h.INPUT_TEXT_BUFFER_COMPLETED="input_text_buffer.completed",h.SPEECH_AUDIO_UPDATE="speech.audio.update",h.SPEECH_AUDIO_COMPLETED="speech.audio.completed",h.INPUT_AUDIO_BUFFER_APPEND="input_audio_buffer.append",h.INPUT_AUDIO_BUFFER_COMPLETE="input_audio_buffer.complete",h.TRANSCRIPTIONS_UPDATE="transcriptions.update",h.INPUT_AUDIO_BUFFER_CLEAR="input_audio_buffer.clear",h.TRANSCRIPTIONS_CREATED="transcriptions.created",h.INPUT_AUDIO_BUFFER_COMPLETED="input_audio_buffer.completed",h.TRANSCRIPTIONS_MESSAGE_UPDATE="transcriptions.message.update",h.TRANSCRIPTIONS_MESSAGE_COMPLETED="transcriptions.message.completed",h.INPUT_AUDIO_BUFFER_CLEARED="input_audio_buffer.cleared",h.TRANSCRIPTIONS_UPDATED="transcriptions.updated",h.CHAT_UPDATE="chat.update",h.CONVERSATION_CHAT_SUBMIT_TOOL_OUTPUTS="conversation.chat.submit_tool_outputs",h.CHAT_CREATED="chat.created",h.CHAT_UPDATED="chat.updated",h.CONVERSATION_CHAT_CREATED="conversation.chat.created",h.CONVERSATION_MESSAGE_CREATE="conversation.message.create",h.CONVERSATION_CLEAR="conversation.clear",h.CONVERSATION_CHAT_IN_PROGRESS="conversation.chat.in_progress",h.CONVERSATION_MESSAGE_DELTA="conversation.message.delta",h.CONVERSATION_CHAT_REQUIRES_ACTION="conversation.chat.requires_action",h.CONVERSATION_MESSAGE_COMPLETED="conversation.message.completed",h.CONVERSATION_AUDIO_DELTA="conversation.audio.delta",h.CONVERSATION_AUDIO_COMPLETED="conversation.audio.completed",h.CONVERSATION_CHAT_COMPLETED="conversation.chat.completed",h.CONVERSATION_CHAT_FAILED="conversation.chat.failed",h.CONVERSATION_CLEARED="conversation.cleared",h.INPUT_AUDIO_BUFFER_SPEECH_STARTED="input_audio_buffer.speech_started",h.INPUT_AUDIO_BUFFER_SPEECH_STOPPED="input_audio_buffer.speech_stopped",h.CONVERSATION_CHAT_CANCEL="conversation.chat.cancel",h.CONVERSATION_CHAT_CANCELED="conversation.chat.canceled",h.CONVERSATION_AUDIO_TRANSCRIPT_UPDATE="conversation.audio_transcript.update",h.CONVERSATION_AUDIO_TRANSCRIPT_COMPLETED="conversation.audio_transcript.completed",h.CONVERSATION_AUDIO_SENTENCE_START="conversation.audio.sentence_start",h.DUMP_AUDIO="dump.audio",h.SIMULT_INTERPRETATION_UPDATE="simult_interpretation.update",h.SIMULT_INTERPRETATION_CREATED="simult_interpretation.created",h.SIMULT_INTERPRETATION_UPDATED="simult_interpretation.updated",h.SIMULT_INTERPRETATION_AUDIO_DELTA="simult_interpretation.audio.delta",h.SIMULT_INTERPRETATION_TRANSCRIPTION_DELTA="simult_interpretation.transcription.delta",h.SIMULT_INTERPRETATION_TRANSLATION_DELTA="simult_interpretation.translation.delta",h.SIMULT_INTERPRETATION_MESSAGE_COMPLETED="simult_interpretation.message.completed",h);class nG extends t0{constructor(...e){super(...e),this.audio=new nV(this._client),this.chat=new nB(this._client)}}class nQ extends t0{async update(e,t){await this._client.put("/v1/variables",e,!1,t)}async retrieve(e,t){return(await this._client.get("/v1/variables",e,!1,t)).data}}class nH extends t0{async me(e){return(await this._client.get("/v1/users/me",void 0,!1,e)).data}}class n${get readyState(){return this.rws.readyState}send(e){return this.rws.send(JSON.stringify(e))}close(e,t){return this.rws.close(e,t)}reconnect(e,t){return this.rws.reconnect(e,t)}addEventListener(e,t){this.rws.addEventListener(e,t)}removeEventListener(e,t){this.rws.removeEventListener(e,t)}constructor(e,t={}){let n;this.onmessage=null,this.onopen=null,this.onclose=null,this.onerror=null;let o=e.includes("?")?"&":"?",{authorization:r}=t.headers||{};if(t4()){let e="function"==typeof getMiniAppWebSocketFactory?getMiniAppWebSocketFactory():null;n=e?e.getWebSocketImplementation():window.WebSocket}else n=t2()?window.WebSocket:class extends tq{constructor(e,n){super(e,n,{headers:t.headers})}};this.rws=new tJ(`${e}${o}authorization=${r}`,[],{WebSocket:n,...t}),this.rws.addEventListener("message",e=>{try{var t;let n=JSON.parse(e.data);null===(t=this.onmessage)||void 0===t||t.call(this,n,e)}catch(e){console.error("WebSocketAPI onmessage error",e)}}),this.rws.addEventListener("open",e=>{var t;null===(t=this.onopen)||void 0===t||t.call(this,e)}),this.rws.addEventListener("close",e=>{var t;null===(t=this.onclose)||void 0===t||t.call(this,e)}),this.rws.addEventListener("error",e=>{var t,n,o,r,i,a,s,l;let{readyState:d}=this.rws;if(3===d)return;let u=null===(o=e.target)||void 0===o?void 0:null===(n=o._req)||void 0===n?void 0:null===(t=n.res)||void 0===t?void 0:t.statusCode,c=(null===(a=e.target)||void 0===a?void 0:null===(i=a._req)||void 0===i?void 0:null===(r=i.res)||void 0===r?void 0:r.rawHeaders)||[],v=c.findIndex(e=>"X-Tt-Logid"===e),p=-1!==v?c[v+1]:void 0,m={id:"0",event_type:nW.ERROR,data:{code:-1,msg:"WebSocket error"},detail:{logid:p}};401===u?(m.data.code=401,m.data.msg="Unauthorized"):403===u?(m.data.code=403,m.data.msg="Forbidden"):(m.data.code=500,m.data.msg=String(null!==(l=null==e?void 0:e.error)&&void 0!==l?l:"")||"WebSocket error"),null===(s=this.onerror)||void 0===s||s.call(this,m,e)})}}let{version:nY}=JSON.parse('{"name":"@coze/api","version":"1.3.5","description":"Official Coze Node.js SDK for seamless AI integration into your applications |  Node.js SDK AI ","keywords":["coze","ai","nodejs","sdk","chatbot","typescript"],"homepage":"https://github.com/coze-dev/coze-js/tree/main/packages/coze-js","bugs":{"url":"https://github.com/coze-dev/coze-js/issues"},"repository":{"type":"git","url":"https://github.com/coze-dev/coze-js.git","directory":"packages/coze-js"},"license":"MIT","author":"Leeight <leeight@gmail.com>","exports":{".":"./src/index.ts","./ws-tools":"./src/ws-tools/index.ts"},"main":"src/index.ts","unpkg":"dist/umd/index.js","module":"src/index.ts","browser":{"crypto":false,"os":false,"jsonwebtoken":false,"node-fetch":false,"ws":false},"typesVersions":{"*":{".":["dist/types/index.d.ts"],"ws-tools":["dist/types/ws-tools/ws-tools/index.d.ts"]}},"files":["dist","LICENSE","README.md","README.zh-CN.md"],"scripts":{"build":"rslib build","format":"prettier --write .","lint":"eslint ./ --cache --quiet","start":"rslib build -w","test":"vitest","test:cov":"vitest --coverage --run"},"dependencies":{"agora-extension-ai-denoiser":"^1.0.0","agora-rtc-sdk-ng":"4.23.2-1","agora-rte-extension":"^1.2.4","jsonwebtoken":"^9.0.2","node-fetch":"^2.x","opus-encdec":"^0.1.1","reconnecting-websocket":"^4.4.0","uuid":"^10.0.0","ws":"^8.11.0"},"devDependencies":{"@coze-infra/eslint-config":"workspace:*","@coze-infra/ts-config":"workspace:*","@coze-infra/vitest-config":"workspace:*","@rslib/core":"0.0.18","@swc/core":"^1.3.14","@types/jsonwebtoken":"^9.0.0","@types/node":"^20","@types/node-fetch":"^2.x","@types/uuid":"^9.0.1","@types/whatwg-fetch":"^0.0.33","@types/ws":"^8.5.1","@vitest/coverage-v8":"~2.1.9","axios":"^1.7.7","typescript":"^5.5.3","vitest":"~2.1.9"},"peerDependencies":{"axios":"^1.7.1"},"publishConfig":{"access":"public","registry":"https://registry.npmjs.org"},"cozePublishConfig":{"exports":{".":{"require":"./dist/cjs/index.js","import":"./dist/esm/index.mjs","types":"./dist/types/index.d.ts"},"./ws-tools":{"require":"./dist/cjs/ws-tools/index.js","import":"./dist/esm/ws-tools/index.mjs","types":"./dist/types/ws-tools/ws-tools/index.d.ts"}},"main":"dist/cjs/index.js","module":"dist/esm/index.mjs","types":"dist/types/index.d.ts"},"overrides":{"agora-extension-ai-denoiser":{"agora-rtc-sdk-ng":"$agora-rtc-sdk-ng"}}}'),nJ=()=>{let e=process.version.slice(1),{platform:t}=process,n=t.toLowerCase(),o=tK.release();if("darwin"===t){n="macos";try{let e=tK.release().split(".");if(e.length>=2){let t=parseInt(e[0],10);!isNaN(t)&&t>=9&&(o=`10.${t-9}.${e[1]}`)}}catch(e){}}else"win32"===t?(n="windows",o=tK.release()):"linux"===t&&(n="linux",o=tK.release());return{osName:n,osVersion:o,nodeVersion:e}},nK=()=>{let{nodeVersion:e,osName:t,osVersion:n}=nJ();return`coze-js/${nY} node/${e} ${t}/${n}`.toLowerCase()},nX=()=>{let{osVersion:e,nodeVersion:t,osName:n}=nJ();return JSON.stringify({version:nY,lang:"node",lang_version:t,os_name:n,os_version:e})},n0=()=>{let e={name:"unknown",version:"unknown"},t={name:"unknown",version:"unknown"},{userAgent:n}=navigator;if(n){var o,r,i,a,s,l;if(n.indexOf("Windows")>-1){t.name="windows";let e=(null===(o=n.match(/Windows NT ([0-9.]+)/))||void 0===o?void 0:o[1])||"unknown";t.version=e}else n.indexOf("Mac OS X")>-1?(t.name="macos",t.version=((null===(r=n.match(/Mac OS X ([0-9_]+)/))||void 0===r?void 0:r[1])||"unknown").replace(/_/g,".")):n.indexOf("Linux")>-1&&(t.name="linux",t.version=(null===(i=n.match(/Linux ([0-9.]+)/))||void 0===i?void 0:i[1])||"unknown");n.indexOf("Chrome")>-1?(e.name="chrome",e.version=(null===(a=n.match(/Chrome\/([0-9.]+)/))||void 0===a?void 0:a[1])||"unknown"):n.indexOf("Firefox")>-1?(e.name="firefox",e.version=(null===(s=n.match(/Firefox\/([0-9.]+)/))||void 0===s?void 0:s[1])||"unknown"):n.indexOf("Safari")>-1&&(e.name="safari",e.version=(null===(l=n.match(/Version\/([0-9.]+)/))||void 0===l?void 0:l[1])||"unknown")}return JSON.stringify({version:nY,browser:e.name,browser_version:e.version,os_name:t.name,os_version:t.version})},n1=()=>{if(!(null==uni?void 0:uni.getSystemInfoSync))return JSON.stringify({});let e=uni.getSystemInfoSync(),t={name:"unknown",version:"unknown"},n={name:"unknown",version:"unknown"};if("android"===e.platform?n.name="android":"ios"===e.platform?n.name="ios":"windows"===e.platform?n.name="windows":"mac"===e.platform?n.name="macos":n.name=e.platform,n.version=e.system||"unknown",e.AppPlatform)t.name=e.AppPlatform.toLowerCase(),t.version=e.appVersion||"unknown";else if(e.uniPlatform)t.name=e.uniPlatform,t.version=e.SDKVersion||"unknown";else{let{appName:n,appVersion:o}=e;n&&(t.name=n.toLowerCase(),t.version=o||"unknown")}return JSON.stringify({version:nY,framework:"uniapp",platform:t.name,platform_version:t.version,os_name:n.name,os_version:n.version,screen_width:e.screenWidth,screen_height:e.screenHeight,device_model:e.model,device_brand:e.brand})},n4="https://api.coze.com",n2=e=>{var t,n,o,r;return e.isAxiosError||e.code&&e.message?"ECONNABORTED"===e.code&&e.message.includes("timeout")||"ETIMEDOUT"===e.code?new ni(408,void 0,`Request timed out: ${e.message}`,null===(t=e.response)||void 0===t?void 0:t.headers):"ERR_CANCELED"===e.code?new ne(e.message):t6.generate((null===(n=e.response)||void 0===n?void 0:n.status)||500,null===(o=e.response)||void 0===o?void 0:o.data,e.message,null===(r=e.response)||void 0===r?void 0:r.headers):t6.generate(500,void 0,`Unexpected error: ${e.message}`,void 0)},n5=async e=>{let t=await tX(e.url,{body:e.data,...e});return{data:t.body,...t}},n3=()=>!!(t2()||t9()||t4())||n8(process.version.slice(1),"18.0.0")>=0;async function n9(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.axiosInstance||tZ.Z;if(t.isStreaming&&function(e){return!!(null==e?void 0:e.Axios)}(n)){let e=n.VERSION||tZ.Z.VERSION;if(!e||0>n8(e,"1.7.1"))throw new t8("Streaming requests require axios version 1.7.1 or higher. Please upgrade your axios version.")}let o=()=>{e.startsWith(n4)&&console.warn(`
 baseURL  https://api.coze.cn 
new CozeAPI({
  // ...
  baseURL: COZE_CN_BASE_URL
})`)},r=await n({url:e,responseType:t.isStreaming?"stream":"json",adapter:t.isStreaming?n3()?"fetch":n5:void 0,...t}).catch(e=>{throw(null==e?void 0:e.status)===401&&o(),n2(e)});return{async *stream(){try{let e=r.data,t=e[Symbol.asyncIterator]?e[Symbol.asyncIterator]():e.getReader(),n=new TextDecoder,i={},a="";for(;;){let{done:e,value:r}=await (t.next?t.next():t.read());if(e){if(a){i.event="error",i.data=a;try{let e=JSON.parse(a);(null==e?void 0:e.code)===4101&&o()}catch(e){}yield i}break}let s=(a+=n.decode(r,{stream:!0})).split("\n");for(let e=0;e<s.length-1;e++){let t=s[e],n=t.indexOf(":");if(-1!==n){let e=t.substring(0,n).trim(),o=t.substring(n+1).trim();i[e]=o,"data"===e&&(yield i)}}a=s[s.length-1]}}catch(e){n2(e)}},json:()=>r.data,response:r}}function n8(e,t){let n=e.split(".").map(Number),o=t.split(".").map(Number);for(let e=0;e<3;e++){let t=n[e]||0,r=o[e]||0;if(t>r)return 1;if(t<r)return -1}return 0}class n6{async getToken(){return"function"==typeof this.token?await this.token():this.token}async buildOptions(e,t,n){let o=await this.getToken(),r={authorization:`Bearer ${o}`};t4()?r["X-Coze-Client-User-Agent"]=n1():t2()||t9()?r["X-Coze-Client-User-Agent"]=n0():(r["User-Agent"]=nK(),r["X-Coze-Client-User-Agent"]=nX());let i=t5(this.axiosOptions,n,{headers:r},{headers:this.headers||{}});return i.method=e,i.data=t,i}async buildWebsocketOptions(e){var t;let n=await this.getToken(),o={authorization:`Bearer ${n}`};return t4()?o["X-Coze-Client-User-Agent"]=n1():t2()?o["X-Coze-Client-User-Agent"]=n0():(o["User-Agent"]=nK(),o["X-Coze-Client-User-Agent"]=nX()),t5({debug:null!==(t=this._config.debug)&&void 0!==t&&t},this._config.websocketOptions,e,{headers:o},{headers:this.headers||{}})}async makeRequest(e,t,n,o,r){var i,a;let s=`${this.baseURL}${e}`;try{let e=await this.buildOptions(t,n,r);e.isStreaming=o,e.axiosInstance=this.axiosInstance,this.debugLog(null==r?void 0:r.debug,`--- request url: ${s}`),this.debugLog(null==r?void 0:r.debug,"--- request options:",e);let{response:a,stream:l,json:d}=await n9(s,e);this.debugLog(null==r?void 0:r.debug,`--- response status: ${a.status}`),this.debugLog(null==r?void 0:r.debug,"--- response headers: ",a.headers);let u=(null!==(i=a.headers)&&void 0!==i?i:a.header)["content-type"];if(o){if(u&&u.includes("application/json")){let e=await d(),{code:t,msg:n}=e;if(0!==t&&void 0!==t)throw t6.generate(a.status,e,n,a.headers)}return l()}if(!(u&&u.includes("application/json")))return await a.data;{let e=await d(),{code:t,msg:n}=e;if(0!==t&&void 0!==t)throw t6.generate(a.status,e,n,a.headers);return e}}catch(t){let e=(null==r?void 0:r.onApiError)||(null===(a=this._config)||void 0===a?void 0:a.onApiError);throw e&&e(t),t}}async post(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0;return this.makeRequest(e,"POST",t,n,o)}async get(e,t,n,o){let r=Object.entries(t||{}).filter(e=>{let[t,n]=e;return null!=n}).map(e=>{let[t,n]=e;return`${t}=${n}`}).join("&");return this.makeRequest(r?`${e}${e.includes("?")?"&":"?"}${r}`:e,"GET",void 0,n,o)}async put(e,t,n,o){return this.makeRequest(e,"PUT",t,n,o)}async delete(e,t,n){return this.makeRequest(e,"DELETE",void 0,t,n)}async makeWebsocket(e,t){let n=`${this.baseWsURL}${e}`,o=await this.buildWebsocketOptions(t);return this.debugLog(null==t?void 0:t.debug,`--- websocket url: ${n}`),this.debugLog(null==t?void 0:t.debug,"--- websocket options:",o),new n$(n,o)}getConfig(){return this._config}debugLog(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];(this.debug||e)&&console.debug(...n)}constructor(e){var t;if(this._config=e,this.baseURL=e.baseURL||n4,this.baseWsURL=e.baseWsURL||"wss://ws.coze.cn",this.token=e.token,this.axiosOptions=e.axiosOptions||{},this.axiosInstance=e.axiosInstance,this.debug=e.debug||!1,this.allowPersonalAccessTokenInBrowser=e.allowPersonalAccessTokenInBrowser||!1,this.headers=e.headers,t2()&&"function"!=typeof this.token&&(null==(t=this.token)?void 0:t.startsWith("pat_"))&&!this.allowPersonalAccessTokenInBrowser)throw new t8("Browser environments do not support authentication using Personal Access Token (PAT) by default.\nas it may expose secret API keys. \n\nPlease use OAuth2.0 authentication mechanism. see:\nhttps://www.coze.com/docs/developer_guides/oauth_apps?_lang=en \n\nIf you need to force use, please set the `allowPersonalAccessTokenInBrowser` option to `true`. \n\ne.g new CozeAPI({ token, allowPersonalAccessTokenInBrowser: true });\n\n")}}n6.APIError=t6,n6.BadRequestError=nt,n6.AuthenticationError=nn,n6.PermissionDeniedError=no,n6.NotFoundError=nr,n6.RateLimitError=na,n6.InternalServerError=ns,n6.GatewayError=nl,n6.TimeoutError=ni,n6.UserAbortError=ne;class n7 extends n6{constructor(...e){super(...e),this.bots=new t1(this),this.chat=new nm(this),this.conversations=new nf(this),this.files=new n_(this),this.knowledge=new nE(this),this.datasets=new nA(this),this.workflows=new nw(this),this.workspaces=new nC(this),this.audio=new nP(this),this.templates=new nU(this),this.websockets=new nG(this),this.variables=new nQ(this),this.users=new nH(this)}}class oe extends n7{setRefreshToken(e){this.onRefreshToken=e}useAuthError(){var e,t=this;var n=(e=(0,P._)(function*(e){var{code:n}=(null==e?void 0:e.data)||{};if(Y(n||e.status)){var o=t.getTokenFromHeaderAuth(String(e.config.headers.getAuthorization()||"")),r=yield t.refreshToken(o);if(r)return(0,C._)({},e.config).headers=(0,C._)({},e.config.headers),e.config.headers.Authorization="Bearer ".concat(r),yield tZ.Z.request(e.config)}return e}),function(t){return e.apply(this,arguments)});this.useResponseInterceptors(n,n)}getTokenFromHeaderAuth(e){return e.replace(/^\s*Bearer\s*/,"").replace(/\s+$/,"")}refreshToken(e){var t=this;return(0,P._)(function*(){if(t.refreshTokenPromise)return t.refreshTokenPromise;if(e!==t.token)return t.token;t.refreshTokenPromise=null===(n=t.onRefreshToken)||void 0===n?void 0:n.call(t,t.token);var n,o=yield t.refreshTokenPromise;return t.refreshTokenPromise=void 0,t.token=o||"",t.token})()}useResponseInterceptors(e,t){this.getAxiosInstance().interceptors.response.use(e,t)}getAxiosInstance(){return this.axiosInstance}constructor(e){var{onRefreshToken:t,axiosOptions:n}=e;super((0,I._)((0,C._)({},(0,N._)(e,["onRefreshToken","axiosOptions"])),{axiosOptions:(0,I._)((0,C._)({},n||{}),{timeout:6e5,validateStatus:()=>!0})})),this.onRefreshToken=t,this.axiosInstance=tZ.Z.create(),this.useAuthError()}}var ot=()=>{var{debug:e}=e4(),{token:t="",refreshToken:n,setToken:o,setCozeApi:r}=e2((0,ee.N)(e=>({token:e.token,setToken:e.setToken,refreshToken:e.refreshToken,setCozeApi:e.setCozeApi}))),i=(0,j.useMemo)(()=>new tj.Md({apiKey:t}),[]),a=(0,j.useMemo)(()=>new oe({token:t,allowPersonalAccessTokenInBrowser:!0,baseURL:tO.a2,axiosOptions:{headers:(0,C._)({},(null==e?void 0:e.cozeApiRequestHeader)||{})}}),[]),s=(0,tE.Z)(e=>{null==i||i.updateApiKey(e),a.token=e}),l=(0,tE.Z)((0,P._)(function*(){var e=yield null==n?void 0:n();return e&&(s(e),o(e)),e}));return a.setRefreshToken(l),(0,j.useEffect)(()=>{s(t)},[t]),(0,j.useEffect)(()=>{r(a)},[a]),{tokenManagerClient:i,cozeApiClient:a,refreshToken:l}},on=(0,j.createContext)({}),oo=e=>{var{children:t}=e,n=(0,j.useRef)({}),{tokenManagerClient:o,cozeApiClient:r,refreshToken:i}=ot();return(0,E.jsx)(on.Provider,{value:{cozeApiSdk:r,tokenManager:o,refMessageListLeft:n,refreshToken:i},children:t})},or=()=>{var{cozeApiSdk:e,tokenManager:t,refMessageListLeft:n,refreshToken:o}=(0,j.useContext)(on);return{cozeApiSdk:e,tokenManager:t,refMessageListLeft:n,refreshToken:o}},oi=()=>{var e,{cozeApiSdk:t}=or();return(0,j.useCallback)((e=(0,P._)(function*(e){var{file:n}=e,o=yield null==t?void 0:t.files.upload({file:n});return{uri:(null==o?void 0:o.id)||"",url:""}}),function(t){return e.apply(this,arguments)}),[t])},oa={text:te.n$.TextInput,select:te.n$.Select,file:te.n$.MixUpload,image:te.n$.UploadImage,audio:te.n$.UploadAudio,doc:te.n$.UploadDoc,table:te.n$.UploadTable,code:te.n$.CODE,zip:te.n$.ARCHIVE,ppt:te.n$.PPT,video:te.n$.VIDEO,txt:te.n$.TXT},os=(e,t)=>(null==e?void 0:e.map(e=>{var n,o,r,i,a,s,l,d,u,c,v=e.send_type&&("panel"===e.send_type?te.nu.SendTypePanel:te.nu.SendTypeQuery);return v!==te.nu.SendTypeQuery&&(l=(null===(u=e.components)||void 0===u?void 0:u.map(e=>{var t;return{name:e.name,description:e.description,parameter:e.tool_parameter,hide:e.is_hide,options:"select"===e.type&&e.options||[],input_type:oa[e.type],upload_options:"file"===e.type&&(null===(t=e.options)||void 0===t?void 0:t.map(e=>oa[e]))||[],default_value:{value:e.default_value||"",type:0}}}))||[],(null==e?void 0:null===(c=e.tool)||void 0===c?void 0:c.type)&&["plugin","workflow"].includes(e.tool.type)&&(d="plugin"===e.tool.type?te.qK.ToolTypePlugin:te.qK.ToolTypeWorkFlow)),{object_id:(null==t?void 0:t.id)||"",command_name:e.name,shortcut_command:e.command,description:e.description,send_type:v,tool_type:d,work_flow_id:(null==e?void 0:null===(n=e.tool)||void 0===n?void 0:n.workflow_id)||"",plugin_id:(null==e?void 0:null===(o=e.tool)||void 0===o?void 0:o.plugin_id)||"",plugin_api_name:(null==e?void 0:null===(r=e.tool)||void 0===r?void 0:r.name)||"",template_query:e.query_template,components_list:l,card_schema:e.card_schema,command_id:e.id,tool_info:{tool_name:null===(i=e.tool)||void 0===i?void 0:i.name,tool_params_list:(null===(s=e.tool)||void 0===s?void 0:null===(a=s.params)||void 0===a?void 0:a.map(e=>({name:e.name,required:e.is_required,desc:e.description,type:e.type,default_value:e.default_value,refer_component:e.is_refer_component})))||[]},shortcut_icon:{url:e.icon_url},bot_info:{icon_url:(null==t?void 0:t.iconUrl)||"",name:(null==t?void 0:t.name)||""}}}))||[],ol=new class e{convertRequestBody(e){var{body:t,userInfo:n,connectorId:o,parameters:r,shortcuts:i}=e,a=eQ(t)||{},s=a.content_type,l=a.query,d=a.shortcut_command;return JSON.stringify({bot_id:a.bot_id,user_id:null==n?void 0:n.id,stream:!0,connector_id:o,additional_messages:[this.convertRequestMessage(s,l)],parameters:r,shortcut_command:this.convertShortcuts(i||[],d),enable_card:!0})}convertRequestMessage(e,t){return(0,C._)({role:"user"},this.convertContent(e,t))}convertContent(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(e){case tj.zc.Text:return{content_type:"text",content:t};case tj.zc.Card:return{content_type:"card",content:t};case tj.zc.Image:case tj.zc.File:case tj.zc.Mix:return this.convertMixContent(t,n);default:throw Error("Error: unknown content Type")}}convertMixContent(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=eQ(e);if(!!n){var o=[...(null==n?void 0:n.item_list)||[]],r=[...(null==n?void 0:n.refer_items)||[]];return{content_type:"object_string",content:JSON.stringify((o=(o=(o=o.concat(((null==n?void 0:n.image_list)||[]).map(e=>({type:tj.zc.Image,image:e})))).concat(((null==n?void 0:n.file_list)||[]).map(e=>({type:tj.zc.File,file:e})))).concat((r||[]).map(e=>(0,I._)((0,C._)({},e),{is_refer:!0})))).map(e=>{var n,o;switch(e.type){case tj.zc.Text:return{type:"text",text:e.text,is_refer:e.is_refer||void 0};case tj.zc.Image:return{type:"image",file_id:e.image.key,file_url:t||!e.image.key?null===(n=e.image.image_ori)||void 0===n?void 0:n.url:void 0,is_refer:e.is_refer||void 0};case tj.zc.File:return{type:"file",file_id:e.file.file_key||!e.file.file_key,file_url:t?null===(o=e.file)||void 0===o?void 0:o.file_url:void 0,is_refer:e.is_refer||void 0};default:return null}}).filter(e=>!!e))}}}convertMessageListResponse(e){return null==e?void 0:e.reverse().map(e=>{var t=this.convertMessage(e);if((null==t?void 0:t.content_type)==="object_string"){var n,o=eQ(t.content),r=null==o?void 0:o.map(e=>"image"===e.type||"file"===e.type?{type:"text",text:e.file_url}:e);if((null==r?void 0:r.length)===1&&(null===(n=r[0])||void 0===n?void 0:n.type)==="text")t.content_type="text",t.content=r[0].text;else{if(!((null==r?void 0:r.length)>0))return null;t.content=JSON.stringify(r)}}return t}).filter(e=>!!e)}convertMessage(e){return e.type&&["ack","answer","question"].includes(e.type)&&e.role&&["user","assistant"].includes(e.role)&&e.content_type&&["card","image","text","object_string","file"].includes(e.content_type)&&e.content?(0,C._)({role:e.role},this.convertContent(e.content_type,e.content||"",!0)):null}convertShortcuts(e,t){if("string"==typeof t)n=eQ(t);else{if("object"!=typeof t)return t;n=t}var n,o=e.find(e=>e.command_id===n.command_id);if(null==o?void 0:o.components_list){var r=new Map(o.components_list.filter(e=>e.parameter&&e.name).map(e=>[e.parameter,e.name]));Object.keys(n.parameters).forEach(e=>{var t=r.get(e),o=n.parameters[e];t&&(delete n.parameters[e],n.parameters[t]=o)})}return n}},od=n("187151"),ou=new class e{convertMessageListResponse(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",{data:n=[],has_more:o,first_id:r,last_id:i}=e,a=n.map(e=>this.convertMessage(e,t)).filter(e=>!!e.message_id)||[];return console.log("messageListForCoze",a),{code:0,message_list:a,hasmore:o,cursor:i,next_cursor:r}}convertMessage(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",{content_type:n,content:o}=this.convertContent(e.content_type,e.content)||{},r="question"===e.type,i=e.chat_id||"--custom-replyId--".concat((0,Z.x0)()),a=r?i:e.id||"--custom-messageId-".concat((0,Z.x0)()),s=r?"":e.bot_id||t;if(!n||!a||!i)return{};var l="";if("function_call"===e.type){var d=eQ(e.content);l=(null==d?void 0:d.plugin)||""}return{reasoning_content:e.reasoning_content,content:o,content_time:1e3*(e.created_at||0),content_type:n,message_id:a,reply_id:i,role:e.role,section_id:e.section_id,sender_id:s,source:0,status:"",extra_info:{local_message_id:"",plugin:l,coze_api_message_id:e.id,coze_api_chat_id:e.chat_id},type:e.type}}convertContent(e,t){switch(e){case"object_string":return{content_type:tj.zc.Mix,content:this.convertMixContent(t)};case"card":return{content_type:tj.zc.Card,content:t};case"text":return{content_type:tj.zc.Text,content:t};default:return}}convertMixContent(e){var t=eQ(e);if(!!t){var n=null==t?void 0:t.map(e=>{switch(e.type){case"text":return{type:tj.zc.Text,text:e.text||"",is_refer:e.is_refer||void 0};case"image":return{type:tj.zc.Image,image:{key:(null==e?void 0:e.file_id)||"",image_ori:{height:void 0,width:void 0,url:null==e?void 0:e.file_url},image_thumb:{height:void 0,width:void 0,url:null==e?void 0:e.file_url}},is_refer:e.is_refer||void 0};case"file":var{fileType:t=od.Wz.DEFAULT_UNKNOWN}=(0,od.hr)(new File([],null==e?void 0:e.name))||{};return{type:tj.zc.File,file:{file_key:e.file_id||"",file_name:null==e?void 0:e.name,file_size:null==e?void 0:e.size,file_type:t,file_url:null==e?void 0:e.file_url},is_refer:e.is_refer||void 0};default:return}}).filter(e=>!!e);return JSON.stringify({item_list:n.filter(e=>!e.is_refer),refer_items:n.filter(e=>e.is_refer)})}}},oc=()=>{var e=ov(),{chatConfig:t}=e4(),{bot_id:n}=t||{},{refMessageListLeft:o}=or();return(0,j.useMemo)(()=>{var t=[t=>{var r,i,a,s,l,d,{data:u}=t,c=null===(i=t.config)||void 0===i?void 0:null===(r=i.params)||void 0===r?void 0:r.conversation_id,v=(null==o?void 0:null===(a=o.current)||void 0===a?void 0:a[c])||[],p=null===(s=v[v.length-1])||void 0===s?void 0:s.reply_id;p&&(null===(l=u.data)||void 0===l?void 0:l[0].type)==="question"&&!(null===(d=u.message_list)||void 0===d?void 0:d[0].chatId)&&(u.data[0].chat_id=p);var m=ou.convertMessageListResponse(u,n);return(0,I._)((0,C._)({},t),{data:(0,I._)((0,C._)({},m),{message_list:e(c,m.message_list)})})}];return{url:"/v1/conversation/message/list",hooks:{onBeforeRequest:[e=>{var t=e.data.conversation_id,n={after_id:e.data.cursor,limit:e.data.count};return(0,I._)((0,C._)({},e),{data:n,params:{conversation_id:t}})}],onErrorResponse:t,onAfterResponse:t}}},[n])},ov=()=>{var{refMessageListLeft:e}=or();return(0,j.useCallback)(function(t){for(var n,o,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=[],s=[],l=0;l<i.length;l++)"question"!==i[l].type?a.push(i[l]):(s.push(...a),a.splice(0,a.length),s.push(i[l]));var d=(null==e?void 0:null===(n=e.current)||void 0===n?void 0:n[t])||[];return d.length&&(null===(o=d[0])||void 0===o?void 0:o.reply_id)===(null===(r=s[0])||void 0===r?void 0:r.reply_id)&&s.unshift(...d),(null==e?void 0:e.current)&&(e.current[t]=a),s},[])};var op=(g=(0,P._)(function*(e){var t,n,o,r,i,a,{botId:s,cozeApiSdk:l}=e,d=yield l.get("/v1/bots/".concat(s),void 0,!1,{headers:{"Accept-Language":"zh-CN"===e6.ZP.language?"zh":"en"}}),u=null==d?void 0:d.data,c=u.background_image_info||{};return(null==c?void 0:null===(t=c.web_background_image)||void 0===t?void 0:t.image_url)&&(c.web_background_image.origin_image_url=c.web_background_image.origin_image_url||c.web_background_image.image_url),(null==c?void 0:null===(n=c.mobile_background_image)||void 0===n?void 0:n.image_url)&&(c.mobile_background_image.origin_image_url=c.mobile_background_image.origin_image_url||c.mobile_background_image.image_url),{prologue:u.onboarding_info.prologue,onboardingSuggestions:(null===(r=u.onboarding_info)||void 0===r?void 0:null===(o=r.suggested_questions)||void 0===o?void 0:o.map((e,t)=>({id:"".concat(t),content:e})))||[],botVersion:u.version,botInfoMap:{[u.bot_id]:{url:u.icon_url,nickname:u.name,id:u.bot_id,allowMention:!1}},backgroundInfo:c,defaultInputMode:"voice"===u.default_user_input_type?eJ.Voice:"call"===u.default_user_input_type?eJ.VoiceCall:eJ.Text,shortcuts:os(u.shortcut_commands,{id:s,name:u.name,iconUrl:u.icon_url})||[],voiceCallClose:null===(a=null===(i=u.media_config)||void 0===i?void 0:i.is_voice_call_closed)||void 0===a||a}}),function(e){return g.apply(this,arguments)});var om=(f=(0,P._)(function*(e){var{botId:t,cozeApiSdk:n,conversationId:o,sectionId:r,connectorId:i,defaultHistoryMessage:a,onDefaultHistoryClear:s,userInfo:l}=e,d=o||"",u=r||"";if(!d){var c,{data:v}=yield n.get("/v1/conversations",{bot_id:t,connector_id:i,page_num:1,page_size:1,user_id:null==l?void 0:l.id}),{id:p,last_section_id:m}=(null==v?void 0:null===(c=v.conversations)||void 0===c?void 0:c[0])||{};if(!p){var h=ol.convertMessageListResponse(a);try{var{id:g,last_section_id:f}=yield n.conversations.create({bot_id:t,messages:h,connector_id:i,user_id:null==l?void 0:l.id},{headers:{"Accept-Language":"zh-CN"===e6.ZP.language?"zh":"en"}});p=g,m=f||"",null==s||s()}catch(e){var{id:_,last_section_id:x}=yield n.conversations.create({bot_id:t,connector_id:i,user_id:null==l?void 0:l.id},{headers:{"Accept-Language":"zh-CN"===e6.ZP.language?"zh":"en"}});p=_,m=x||""}}d=p,u=m}var b=yield n.conversations.messages.list(d,{limit:10}),{message_list:y,hasmore:w,cursor:C,next_cursor:I}=ou.convertMessageListResponse(b,t);return{lastSectionId:u,conversationId:d,messageList:y,hasMore:w,cursor:C,next_cursor:I}}),function(e){return f.apply(this,arguments)});var oh=(_=(0,P._)(function*(e){var t,{cozeApiSdk:n,openRequestInit:o}=e;if(o)return(t="function"==typeof o?yield o(n):o).isBuilderChat?{botOnlineInfo:{prologue:t.prologue,onboardingSuggestions:t.onboardingSuggestions,botInfoMap:{[t.botInfo.id]:t.botInfo},backgroundInfo:t.backgroundInfo,defaultInputMode:t.defaultInputMode,shortcuts:[],isCustomBackground:t.isCustomBackground},conversationId:t.conversationId,sectionId:t.sectionId}:{conversationId:t.conversationId,sectionId:t.sectionId};return null}),function(e){return _.apply(this,arguments)}),og=()=>{var e,{chatConfig:t,openRequestInit:n,defaultHistoryMessage:o=[],onDefaultHistoryClear:r}=e4(),{cozeApiSdk:i}=or(),a=e2(e=>e.setInitError),s=e2(e=>e.setDefaultInputMode),l=e2(e=>e.updateShortcuts),d=e2(e=>e.setIsStartBotVoiceCall),u=e2(e=>e.updateBackgroundInfo),c=ov(),v=(null==t?void 0:null===(e=t.auth)||void 0===e?void 0:e.connectorId)||"",{bot_id:p=""}=t,m=es();return(0,j.useCallback)((0,P._)(function*(){if(!i)return{};try{var{conversationId:e,sectionId:t,botOnlineInfo:h}=(yield oh({cozeApiSdk:i,openRequestInit:n}))||{},[g,f]=yield Promise.all([h||op({botId:p,cozeApiSdk:i,connectorId:v}),om({botId:p,cozeApiSdk:i,conversationId:e,sectionId:t,connectorId:v,onDefaultHistoryClear:r,defaultHistoryMessage:o,userInfo:m})]),_=(g.prologue||"").replaceAll("{{user_name}}",(null==m?void 0:m.nickname)||"");return d(g.defaultInputMode===eJ.VoiceCall),s(g.defaultInputMode||eJ.Text),l(g.shortcuts||[]),console.log("requestDataBotInfo.shortcuts:",g.shortcuts),u(g.backgroundInfo),g.isCustomBackground&&(g.backgroundInfo=void 0),console.log("[result]2:",g),(0,I._)((0,C._)({},g,f),{prologue:_,messageList:c(f.conversationId||"",f.messageList),userInfoMap:(null==m?void 0:m.id)?{[null==m?void 0:m.id]:m}:void 0})}catch(e){console.error("useRequestInit error",e);var{code:x}=e||{};x?a({code:x,msg:""}):a({code:-1,msg:""})}}),[p,i,o,r])},of=n("371066"),o_=n("222363"),ox=()=>(0,j.useMemo)(()=>{var e=[e=>{var{data:t}=e,{code:n,data:o}=t;return(0,I._)((0,C._)({},e),{data:{code:n,new_section_id:o.id}})}];return{url:"/v1/conversations/:conversation_id/clear",hooks:{onBeforeRequest:[e=>{var t=e.data.conversation_id,n="/v1/conversations/".concat(t,"/clear");return(0,I._)((0,C._)({},e),{url:n,data:{conversation_id:t}})}],onErrorResponse:e,onAfterResponse:e}}},[]),ob=n("298203");class oy{parse(e,t){var{terminate:n}=t,{data:o,event:r}=e;switch(r){case"conversation.chat.created":return this.createAckMessage(o);case"conversation.message.delta":var i=this.createMessage(o);if(!i)return;return i;case"conversation.message.completed":return this.createMessage(o,!0);case"conversation.chat.completed":case"done":n();return;case"conversation.chat.failed":var a,s=(null===(a=(0,ob.dj)(o).last_error)||void 0===a?void 0:a.msg)||O.o.t("sendFailed");throw en.FN.error(s),Error("Chat stream error");case"error":var l=(0,ob.dj)(o),d=(null==l?void 0:l.msg)||O.o.t("sendFailed");throw en.FN.error(d),Error("Chat stream error");default:return}}createMessage(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=eQ(e);if(!n)return;var o=(null==n?void 0:n.type)||"";n.chat_id=n.chat_id&&"0"!==n.chat_id?n.chat_id:"",n.id=n.id&&"0"!==n.id?n.id:"";var r=ou.convertMessage(n,this.botId);if(!!r)return t&&r.content_type===tj.zc.Text&&"answer"===r.type&&(r.content=""),r.section_id=r.section_id||this.sectionId,{event:"message",data:{conversation_id:this.conversationId,index:this.getIndexNo(o),is_finish:t,seq_id:this.getSeqNo(),message:(0,I._)((0,C._)({},r),{sender:this.botId})}}}createAckMessage(e){var t,n,o,r=eQ(e);if(!!r){var i=(null==r?void 0:r.id)!=="0"&&(null==r?void 0:r.id)?null==r?void 0:r.id:"",a=i||"--custom-replyId--".concat((0,Z.x0)()),s=null===(n=r.inserted_additional_messages)||void 0===n?void 0:null===(t=n.lastItem)||void 0===t?void 0:t.id;return{event:"message",data:{conversation_id:this.conversationId,index:this.getIndexNo("ack"),is_finish:!0,message:{content:this.sendMessageContent,content_time:1e3*((null==r?void 0:r.created_at)||0),content_type:this.sendMessageContentType,extra_info:{local_message_id:this.localMessageId,chatflow_execute_id:null==r?void 0:r.execute_id,coze_api_message_id:s,coze_api_chat_id:i},message_id:a,reply_id:a,role:"user",section_id:(null==r?void 0:r.section_id)||this.sectionId,sender_id:null===(o=this.userInfo)||void 0===o?void 0:o.id,source:0,status:"",type:"ack"},seq_id:this.getSeqNo()}}}}getSeqNo(){return this.seqNo++}getIndexNo(e){return!this.indexNoMap[e]&&(this.indexNoMap[e]=this.indexNo++),this.indexNoMap[e]}static getMessageParser(e){var{requestMessageRawBody:t,userInfo:n,sectionId:o}=e,r=new oy({requestMessageRawBody:t,userInfo:n,sectionId:o}),i=()=>{r=void 0};return(e,t)=>{var{terminate:n}=t,{type:o,event:a}=e;if("event"===o){var s=null==r?void 0:r.parse(e,{terminate:n});return["done","error","conversation.chat.failed"].includes(a)&&i(),s}}}constructor({requestMessageRawBody:e,userInfo:t,sectionId:n}){this.seqNo=0,this.indexNo=0,this.indexNoMap={},this.conversationId="",this.localMessageId="",this.sendMessageContent="",this.sendMessageContentType="",this.botId="",this.sectionId="",this.botVersion="",this.conversationId=e.conversation_id,this.localMessageId=e.local_message_id,this.sendMessageContent=e.query,this.sendMessageContentType=e.content_type,this.botId=e.bot_id,this.botVersion=e.bot_version,this.userInfo=t,this.sectionId=n||""}}var ow=(e,t)=>{var n,{debug:o,chatConfig:r}=e4(),{shortcuts:i}=e2((0,ee.N)(e=>({shortcuts:e.shortcuts}))),a=(0,j.useRef)(r),s=(0,j.useRef)(""),l=(0,j.useRef)(i);return l.current=i,s.current=(null==r?void 0:null===(n=r.auth)||void 0===n?void 0:n.connectorId)||"",a.current=r,{url:"/v3/chat",hooks:{onBeforeSendMessage:[t=>{var n,r=eQ(t.body)||{},i="".concat(tO.a2,"/v3/chat?conversation_id=").concat(r.conversation_id),d=ol.convertRequestBody({body:t.body,userInfo:e,connectorId:s.current,parameters:null===(n=a.current.botInfo)||void 0===n?void 0:n.parameters,shortcuts:l.current});return Object.keys((null==o?void 0:o.cozeApiRequestHeader)||{}).forEach(e=>{var n;t.headers.push([e,(null==o?void 0:null===(n=o.cozeApiRequestHeader)||void 0===n?void 0:n[e])||""])}),t.headers.push(["Accept-Language","zh-CN"===e6.ZP.language?"zh":"en"]),(0,I._)((0,C._)({},t),{body:d,url:i})}],onGetMessageStreamParser:n=>{var o;return oy.getMessageParser({requestMessageRawBody:n,userInfo:e,sectionId:null==t?void 0:null===(o=t.current)||void 0===o?void 0:o.getSectionId()})}}}},oC=e=>{var t,{refChatFunc:n}=e,{chatConfig:o}=e4(),r=(0,j.useRef)(""),i=es();return r.current=(null==o?void 0:null===(t=o.auth)||void 0===t?void 0:t.connectorId)||"",(0,j.useMemo)(()=>{var e=[e=>{var t,{data:o}=e,{code:r,data:i}=o,{id:a,last_section_id:s}=i||{};return null==n||null===(t=n.current)||void 0===t||t.setConversationId(a,s),(0,I._)((0,C._)({},e),{data:{code:r,new_section_id:s}})}];return{url:o.source===X.ChatFlow?"/v1/workflow/conversation/create":"/v1/conversation/create",method:"POST",hooks:{onBeforeRequest:[e=>{var t=e.data.bot_id;return(0,I._)((0,C._)({},e),{data:{bot_id:t,connector_id:r.current,user_id:null==i?void 0:i.id}})}],onErrorResponse:e,onAfterResponse:e}}},[])},oI=()=>{var{debug:e}=e4();return[t=>(t.headers.delete("x-requested-with"),Object.keys((null==e?void 0:e.cozeApiRequestHeader)||{}).forEach(n=>{var o;t.headers.set(n,(null==e?void 0:null===(o=e.cozeApiRequestHeader)||void 0===o?void 0:o[n])||"")}),t)]};var oN=(x=(0,P._)(function*(e,t){var n,{code:o}=(null==e?void 0:null===(n=e.response)||void 0===n?void 0:n.data)||{},r=e;if(Y(o)){var i=yield null==t?void 0:t();if(i){var a=(0,C._)({},e.config);a.headers=(0,C._)({},a.headers),a.headers.Authorization="Bearer ".concat(i),r=yield tZ.Z.request(a)}}return r}),function(e,t){return x.apply(this,arguments)}),oE=e=>(0,j.useMemo)(()=>{var t;return[(t=(0,P._)(function*(t){return oN(t,e)}),function(e){return t.apply(this,arguments)})]},[e]),oj=e=>(0,j.useMemo)(()=>{var t;return[(t=(0,P._)(function*(t){return oN(t,e)}),function(e){return t.apply(this,arguments)}),e=>e.config.url&&/^\/v1\/conversations\/[^\\]+\/clear$/.test(e.config.url)?(0,I._)((0,C._)({},e),{config:(0,I._)((0,C._)({},e.config),{url:"/v1/conversations/:conversation_id/clear"})}):e]},[e]),oT=()=>(0,j.useMemo)(()=>({url:"/v3/chat/cancel",method:"POST",hooks:{onBeforeRequest:[e=>{var t=e.data.conversation_id,n=e.data.query_message_id;return(0,I._)((0,C._)({},e),{data:{conversation_id:t,chat_id:n}})}]}}),[]),ok=e=>{var{refChatFunc:t}=e,n=es(),{refreshToken:o}=or(),r=ox(),i=ow(n||void 0,t),a=oC({refChatFunc:t}),s=oI(),l=oj(o),d=oE(o),u=oc(),{requestManagerOptions:c}=e4(),v=oT();return(0,j.useMemo)(()=>(0,of.Z)({baseURL:tO.a2,scenes:{[tj.NX.SendMessage]:i,[tj.NX.ClearMessageContext]:r,[tj.NX.ClearHistory]:a,[tj.NX.GetMessage]:u,[tj.NX.BreakMessage]:v},hooks:{onBeforeRequest:s,onAfterResponse:l,onErrorResponse:d}},c,(e,t)=>{if((0,o_.Z)(e))return e.concat(t)}),[i,r,a,s,l])},oA=e=>{var{refChatFunc:t}=e,{chatConfig:n}=e4(),{tokenManager:o}=or(),r=ok({refChatFunc:t});return(0,j.useMemo)(()=>({env:"thirdPart",biz:"third_part",deployVersion:"inhouse",requestManagerOptions:r,tokenManager:o}),[n])},oM=e=>({}),oS=e=>{var t,n="";return{onSendMessageError:(t=(0,P._)(function*(t){var o=t.error;if(Y((null==o?void 0:null===(r=o.ext)||void 0===r?void 0:r.code)||0)||(null==o?void 0:null===(i=o.stack)||void 0===i?void 0:i.includes("401"))){yield null===(s=e.pluginBizContext)||void 0===s?void 0:null===(a=s.refreshToken)||void 0===a?void 0:a.call(s);var r,i,a,s,l,d,u,c=t.message.message_id||(null===(d=t.message)||void 0===d?void 0:null===(l=d.extra_info)||void 0===l?void 0:l.local_message_id);c!==n&&(n=c,null===(u=e.pluginBizContext)||void 0===u||u.regenerateMessageByUserMessageId(c))}}),function(e){return t.apply(this,arguments)})}},oz=e=>({}),oO=e=>({}),oL=e=>({appLifeCycleService:oO(e),messageLifeCycleService:oS(e),commandLifeCycleService:oz(e),renderLifeCycleService:oM(e)}),oR=e=>{var t,n=e2(e=>e.feedbackInfo),{useMessagesStore:o}=(0,e8.NN)(),{findMessage:r}=o.getState(),i=e2(e=>e.lastGroupFeedbackInfo),{messageId:a}=i,s=r(a||""),l=null==s?void 0:null===(t=s.extra_info)||void 0===t?void 0:t.coze_api_message_id;return{isShowFeedbackInLastGroup:(0,j.useMemo)(()=>!!i.isShowCustomPanel&&!!a&&"thumbDown"===n[l]&&e.memberSet.llmAnswerMessageIdList.includes(a),[n,i,e]),cozeApiMessageId:l}},oD=e=>{var{messageGroup:t}=e,{isLatest:n}=t,{isShowFeedbackInLastGroup:o,cozeApiMessageId:r}=oR(t);return n&&o&&r?(0,E.jsx)("div",{className:"ml-[24px] mr-[24px]"}):null},oP=n("416290"),oU=n("534198"),oB=()=>{var e,t,n,{message:o}=(0,e8.dH)(),{chatConfig:r}=e4(),i=o.extra_info.coze_api_message_id,a=o.extra_info.coze_api_chatId_id;return{messageId:o.message_id,cozeApiMessageId:i,cozeApiChatId:a,isShowDelete:!1,isNeedQuote:null!==(n=null===(t=r.ui)||void 0===t?void 0:null===(e=t.chatBot)||void 0===e?void 0:e.isNeedQuote)&&void 0!==n&&n}},oZ=n("113001"),oF=()=>{var e,t=(0,e8.NN)(),n=(0,oZ.O)(),{cozeApiSdk:o}=or();return e=(0,P._)(function*(e,r){if(!r||!e)return;var i,{useMessagesStore:a,useSuggestionsStore:s}=t,{findMessage:l,isLastMessageGroup:d}=a.getState(),{clearSuggestions:u}=s.getState(),c=l(r),v=null==c?void 0:c.reply_id,p=null==c?void 0:null===(i=c.extra_info)||void 0===i?void 0:i.coze_api_message_id;if(!c||!v)throw Error("message not found, id: ".concat(r));if(!n.answerAction.getIsLock(v,"deleteMessageGroup")){n.answerAction.lock(v,"deleteMessageGroup");var m=d(v),{deleteMessageById:h}=a.getState();try{yield null==o?void 0:o.conversations.messages.delete(e,p),h(r),m&&u()}catch(e){console.error(e),en.FN.error(O.o.t("Delete_failed"))}finally{n.answerAction.unlock(v,"deleteMessageGroup")}}}),function(t,n){return e.apply(this,arguments)}},oq=e=>{var t,n,{className:o}=e,r=(0,N._)(e,["className"]),{useGlobalInitStore:i}=(0,e8.NN)(),{groupId:a}=(0,e8.dH)(),s=(0,e8.Nd)(a),{chatConfig:l}=e4(),d=oF(),u=i(e=>e.conversationId),{messageId:c,cozeApiMessageId:v,isShowDelete:p}=oB(),m=(null===(n=l.ui)||void 0===n?void 0:null===(t=n.base)||void 0===t?void 0:t.layout)===L.MOBILE?"custom":"hover";return v&&p&&c?(0,E.jsx)(en.u,{trigger:m,content:O.o.t("Delete"),children:(0,E.jsx)(en.hU,(0,C._)({"data-testid":"chat-area.answer-action.delete-message-button",disabled:s,size:"small",icon:(0,E.jsx)(et.dVD,{className:k()("coz-fg-hglt-red",o,"w-[14px] h-[14px]")}),onClick:()=>{d(u||"",c)},color:"secondary"},r))}):null},oV=()=>{var{meta:e,message:t}=(0,e8.dH)(),n="answer"===t.type&&(!e.isFromLatestGroup||!e.isGroupLastAnswerMessage),o=!1;if("question"===t.type||"ack"===t.type){if((0,e8.pZ)(t))r=t.content;else if((null==t?void 0:t.content_type)===e8.zc.Mix){var r,i,a=eQ(t.content);r=null==a?void 0:a.item_list.map(e=>"text"===e.type&&e.text||"").filter(e=>!!e).join("\n"),o=((null==a?void 0:null===(i=a.item_list)||void 0===i?void 0:i.length)||0)>1}}else n&&(0,e8.pZ)(t)&&(r=t.content);return{showHoverText:r,isMultiMessage:o}},oW=()=>{var{meta:e}=(0,e8.dH)(),{message:t}=(0,e8.dH)(),{readonly:n}=e4();return e.isGroupLastMessage&&e.isFromLatestGroup&&(null==t?void 0:t.type)==="answer"||n?null:(0,E.jsx)(oG,{})},oG=()=>{var e=(0,j.useRef)(null),t=(0,j.useRef)(null),{message:n}=(0,e8.dH)(),{showHoverText:o,isMultiMessage:r}=oV(),{isShowDelete:i,isNeedQuote:a}=oB(),s=i||!!o,l="answer"===n.type&&!!o&&a,{width:d}=(0,oP.Z)(t)||{},u=(0,j.useMemo)(()=>{var e,n,o=null===(n=t.current)||void 0===n?void 0:null===(e=n.closest(".coze-chat-hover-message-wrapper"))||void 0===e?void 0:e.clientWidth;return o&&r?(o+=44,d&&o&&d>o?d-o:0):0},[d]);return s?(console.log("actionBarSize:",{actionBarSize:d,actionBarLeft:u}),(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{className:k()("w-full flex",r?"justify-start":"justify-end"),style:{},children:(0,E.jsxs)(oU.r5,{style:{width:"fit-content",zIndex:2,position:"relative",left:u},ref:t,children:[o?(0,E.jsx)(oU.p4,{wrapperClass:"flex justify-center items-center",isUseExternalContent:!0,externalContent:o,isMustGroupLastAnswerMessage:!1}):null,i?(0,E.jsx)(oq,{}):null,l?(0,E.jsx)(oU.VH,{}):null]})}),(0,E.jsx)("div",{ref:e,style:{width:0,height:0,position:"relative"}})]})):null},oQ=()=>{var{groupId:e}=(0,e8.dH)(),{useMessagesStore:t}=(0,e8.NN)(),n=t(e=>e.messageGroupList,tU.Z),o=t(e=>e.messages,tU.Z),r=t(e=>e.findMessage,tU.Z);return{lastMessageText:(0,j.useMemo)(()=>{var t=n.find(t=>t.groupId===e);return null==t?void 0:t.memberSet.llmAnswerMessageIdList.map(e=>{var t=r(e);return(0,e8.pZ)(t)?t.content:""}).filter(e=>!!e).reverse().join("\n")},[n,o,r,e])}},oH=()=>{var{lastMessageText:e}=oQ(),t=e5(),{isShowDelete:n,isNeedQuote:o}=oB(),r=t?"!coz-fg-images-white":"";return e||n?(0,E.jsx)(oU.qO,{leftContent:[!!e&&(0,E.jsx)(oU.p4,{className:r,isUseExternalContent:!0,externalContent:e},"copy"),n&&(0,E.jsx)(oq,{className:k()(r)},"delete"),!!e&&o&&(0,E.jsx)(oU.VH,{className:k()(r)})],rightContent:[]}):null},o$=e=>{var{refreshContainerWidth:t}=e,{meta:n}=(0,e8.dH)(),{message:o}=(0,e8.dH)(),{useWaitingStore:r}=(0,e8.NN)(),{readonly:i}=e4(),a=r(e=>!!e.waiting),s="answer"===o.type,l=n.isGroupLastMessage&&n.isFromLatestGroup;return((0,j.useEffect)(()=>{t()},[]),!l||!s||a||i)?null:(0,E.jsx)(oH,{})},oY=n("904375"),oJ={};oJ.styleTagTransform=eI(),oJ.setAttributes=eb(),oJ.insert=e_().bind(null,"head"),oJ.domAPI=eg(),oJ.insertStyleElement=ew(),em()(oY.Z,oJ);var oK=oY.Z&&oY.Z.locals?oY.Z.locals:void 0,oX=e=>{var{messageType:t,classname:n}=e,o=(0,N._)(e,["messageType","classname"]);return(0,E.jsx)(tn._p,(0,I._)((0,C._)({},o),{classname:k()(n,"w-full"),isHoverShowUserInfo:!1,messageBoxWrapperClassname:k()("coze-chat-message-wrapper",oK["message-box-wrapper"]),messageHoverWrapperClassName:"w-full flex justify-end right-[0px] coze-chat-hover-message-wrapper"}))};class o0 extends e8.x1{constructor(...e){super(...e),this.pluginMode=e8.tf.Writeable,this.pluginName=e8.p7.WebsdkChatCozeSdkPlugin,this.lifeCycleServices=(0,e8.BO)(this,oL),this.customComponents=(0,e8.S3)({UIKitMessageBoxPlugin:oX,MessageGroupFooter:oD,MessageBoxFooter:o$,MessageBoxHoverSlot:oW})}}var o1=e=>({createPluginBizContext:()=>(0,C._)({},e),Plugin:o0}),o4=n("528318"),o2=()=>{var{ChatBackgroundPlugin:e,chatBackgroundEvent:t}=(0,j.useMemo)(()=>(0,o4.DY)(),[]),{isCustomBackground:n}=e4(),o=e2(e=>e.backgroundInfo),r=n?void 0:o;return(0,j.useEffect)(()=>{t.emit(o4.i$.OnBackgroundChange,r||{mobile_background_image:{},web_background_image:{}})},[r]),{ChatBackgroundPlugin:e}},o5=(0,j.forwardRef)((e,t)=>{var{children:n}=e,{chatConfig:o}=e4(),{updateCurrentConversationInfo:r,currentConversationInfo:i,updateConversations:a}=e2((0,ee.N)(e=>({updateCurrentConversationInfo:e.updateCurrentConversationInfo,currentConversationInfo:e.currentConversationInfo,updateConversations:e.updateConversations}))),{useGlobalInitStore:s,useSectionIdStore:l}=(0,e8.NN)(),d=s(e=>e.setConversationId),u=s(e=>e.conversationId),c=l(e=>e.latestSectionId),v=s(e=>e.chatCore),p=(0,tE.Z)((e,t)=>{var n,s;if((null===(s=o.ui)||void 0===s?void 0:null===(n=s.conversations)||void 0===n?void 0:n.isNeed)&&o.type!==R.APP&&i){var l=Math.floor(Date.now()/1e3),u={id:e,last_section_id:t,updated_at:l,created_at:l,meta_data:{}};r((0,C._)({},i,u)),a([u],"add")}else d(e),null==v||v.updateConversationId(e)}),m=(0,tE.Z)(()=>u||""),h=(0,tE.Z)(()=>c||"");tB();var g=(0,e8.EL)();(0,j.useImperativeHandle)(t,()=>({regenerateMessageByUserMessageId:g,setConversationId:p,getConversationId:m,getSectionId:h}),[g,p,m,h]);var f=(0,e8.e6)(e8.p7.MessageGrab);return(0,j.useEffect)(()=>{if(!!f)f.updateEnableGrab(!0)},[]),(0,E.jsx)(E.Fragment,{children:n})}),o3=e=>{var t,n,o,{children:r,plugins:i}=e,a=(0,j.useRef)(!1),{refreshToken:s}=or(),{initError:l,setInitError:d}=e2((0,ee.N)(e=>({initError:e.initError,setInitError:e.setInitError}))),u=(0,j.useRef)(),{chatConfig:c,onImageClick:v,initErrorFallbackFC:p}=e4(),m=es(),h=og(),g=oA({refChatFunc:u}),{GrabPlugin:f}=(0,tk.vy)({scene:"store"}),_=oi(),x=e5(),{ChatBackgroundPlugin:b}=o2(),y=o1({refreshToken:s,regenerateMessageByUserMessageId:e=>{var t,n;null===(n=u.current)||void 0===n||null===(t=n.regenerateMessageByUserMessageId)||void 0===t||t.call(n,e)}}),w=(0,j.useMemo)(()=>tM({botId:c.bot_id||"",source:c.source,uploadFile:_}),[c,_]);if((0,j.useEffect)(()=>{if(!!l&&!a.current)(0,P._)(function*(){try{Y(l.code)&&(yield null==s?void 0:s(),d(!1))}catch(e){console.error(e)}a.current=!0})()},[l]),l)return p?(0,E.jsx)(p,{error:!0===l?null:l,refresh:(0,P._)(function*(){Y(l.code)?(yield null==s?void 0:s(),d(!1)):location.reload()})}):null;return(0,E.jsx)(e8.jD,{botId:c.bot_id,userInfo:m,scene:tj.xs.OpenAipSdk,reporter:tP,requestToInit:h,enableChatActionLock:!0,createChatCoreOverrideConfig:g,eventCallback:{onImageClick:v,onInitSuccess:()=>{a.current=!1},onCopyUpload:e=>{var t,n,o,{message:r,extra:{fileIndex:i}}=e;(0,tn.zE)(r.content_obj)&&(tN()(null!==(n=null===(t=r.content_obj.file_list[null!=i?i:0])||void 0===t?void 0:t.file_key)&&void 0!==n?n:""),tf.O$.success({content:null!==(o=O.o.t("copy_success"))&&void 0!==o?o:"Copy Successfully"}))}},configs:{showFunctionCallDetail:!1,uploadPlugin:w,ignoreMessageConfigList:e8.fM,isShowFunctionCallBox:null===(o=null==c?void 0:null===(n=c.ui)||void 0===n?void 0:null===(t=n.chatBot)||void 0===t?void 0:t.isNeedFunctionCallMessage)||void 0===o||o},pluginRegistryList:[y,tT.n,b,f,...i||[]],showBackground:x,enableDragUpload:!1,children:(0,E.jsx)(o5,{ref:u,children:r})})},o9=e=>{var{children:t,plugins:n}=e;return(0,E.jsx)(oo,{children:(0,E.jsx)(o3,{plugins:n,children:t})})},o8=e=>{var t,{children:n,plugins:o}=e,{chatConfig:r,onImageClick:i,onThemeChange:a}=e4(),s=e2(e=>e.setInitError),l=tC({onImageClick:i,onInitialError:()=>{s(!0)},extraBody:null===(t=r.extra)||void 0===t?void 0:t.webChat}),d=e3();return(0,j.useEffect)(()=>{null==a||a(d)},[d]),(0,E.jsx)(o9,{plugins:[l,...o||[]],children:n})},o6=e=>{var{children:t,plugins:n}=e,o=(0,N._)(e,["children","plugins"]);return(0,E.jsx)(e1,{appProps:o,children:(0,E.jsx)(o8,{plugins:n,children:t})})},o7=n("21402"),re={};re.styleTagTransform=eI(),re.setAttributes=eb(),re.insert=e_().bind(null,"head"),re.domAPI=eg(),re.insertStyleElement=ew(),em()(o7.Z,re);var rt=o7.Z&&o7.Z.locals?o7.Z.locals:void 0,rn=()=>(0,E.jsx)("div",{className:rt.loading,children:(0,E.jsx)(en.yC,{size:"large"})}),ro=n.p+"static/image/coze-logo.e054c463.png",rr=n("954826"),ri={};ri.styleTagTransform=eI(),ri.setAttributes=eb(),ri.insert=e_().bind(null,"head"),ri.domAPI=eg(),ri.insertStyleElement=ew(),em()(rr.Z,ri);var ra=rr.Z&&rr.Z.locals?rr.Z.locals:void 0,rs=e=>{var{iconUrl:t=ro,title:n="Coze Bot",extra:o,theme:r,isShowConversations:i}=e,{headerTopLeftOps:a}=ti(),s=ta(a),{updateCurrentConversationInfo:l,currentConversationInfo:d}=e2((0,ee.N)(e=>({updateCurrentConversationInfo:e.updateCurrentConversationInfo,currentConversationInfo:e.currentConversationInfo})));return(0,E.jsxs)("header",{className:k()(ra.header,{[ra["bg-theme"]]:"bg-theme"===r}),children:[(null==d?void 0:d.conversationListVisible)||!i?null:(0,E.jsx)(en.hU,{color:"secondary",icon:(0,E.jsx)(et.Ib0,{width:"18px",height:"18px"}),className:ra["conversation-list-btn"],onClick:()=>{if(!!d)l((0,I._)((0,C._)({},d),{conversationListVisible:!0}))}}),(0,E.jsx)("img",{className:ra.avatar,src:t,alt:"avatar"}),(0,E.jsx)(tf.ZT.Text,{className:ra.title,ellipsis:{showTooltip:{opts:{style:{wordBreak:"break-word"},position:"bottom"},type:"tooltip"},rows:1},children:n}),null==s?void 0:s.map(e=>(0,E.jsx)(en.zx,{color:"secondary",icon:e.icon,className:ra["icon-btn"],disabled:e.disabled,onClick:()=>{var t;null===(t=e.onClick)||void 0===t||t.call(e)}})),!!o&&o]})},rl=n("92563"),rd={};rd.styleTagTransform=eI(),rd.setAttributes=eb(),rd.insert=e_().bind(null,"head"),rd.domAPI=eg(),rd.insertStyleElement=ew(),em()(rl.Z,rd);var ru=rl.Z&&rl.Z.locals?rl.Z.locals:void 0,rc=e=>{var{iconUrl:t=ro,title:n="Coze Bot",extra:o,theme:r,isShowConversations:i}=e,{headerTopLeftOps:a}=ti(),s=ta(a),{updateCurrentConversationInfo:l,currentConversationInfo:d}=e2((0,ee.N)(e=>({updateCurrentConversationInfo:e.updateCurrentConversationInfo,currentConversationInfo:e.currentConversationInfo})));return(0,E.jsxs)("header",{className:k()(ru.header,{[ru["bg-theme"]]:"bg-theme"===r}),children:[(null==d?void 0:d.conversationListVisible)||!i?null:(0,E.jsx)(en.hU,{color:"secondary",icon:(0,E.jsx)(et.Ib0,{width:"18px",height:"18px"}),className:ru["conversation-list-btn"],onClick:()=>{if(!!d)l((0,I._)((0,C._)({},d),{conversationListVisible:!0}))}}),(0,E.jsx)("img",{className:ru.avatar,src:t,alt:"avatar"}),(0,E.jsx)(tf.ZT.Text,{className:ru.title,ellipsis:{rows:1},children:n}),null==s?void 0:s.map(e=>(0,E.jsx)(en.zx,{color:"secondary",icon:e.icon,className:ru["icon-btn"],disabled:e.disabled,onClick:()=>{var t;null===(t=e.onClick)||void 0===t||t.call(e)}})),!!o&&o]})},rv=n("93693"),rp={};rp.styleTagTransform=eI(),rp.setAttributes=eb(),rp.insert=e_().bind(null,"head"),rp.domAPI=eg(),rp.insertStyleElement=ew(),em()(rv.Z,rp);var rm=rv.Z&&rv.Z.locals?rv.Z.locals:void 0,rh=()=>{var{updateCurrentConversationInfo:e,currentConversationInfo:t}=e2((0,ee.N)(e=>({updateCurrentConversationInfo:e.updateCurrentConversationInfo,currentConversationInfo:e.currentConversationInfo})));return(null==t?void 0:t.conversationListVisible)?null:(0,E.jsx)(en.u,{content:O.o.t("web_sdk_open_conversations"),children:(0,E.jsx)(en.hU,{className:rm["float-open-conversations-btn"],size:"small",style:{height:"32px",borderTopLeftRadius:"unset",borderBottomLeftRadius:"unset"},icon:(0,E.jsx)(et.wMM,{}),onClick:()=>{if(!!t)e((0,I._)((0,C._)({},t),{conversationListVisible:!0}))}})})},rg=e=>{var{isMobile:t}=e,n=(0,N._)(e,["isMobile"]),{isShowConversations:o,isShowHeader:r}=n;return r?t?(0,E.jsx)(rc,(0,C._)({},n)):(0,E.jsx)(rs,(0,C._)({},n)):o?(0,E.jsx)(rh,{}):null},rf=n("425765"),r_={};r_.styleTagTransform=eI(),r_.setAttributes=eb(),r_.insert=e_().bind(null,"head"),r_.domAPI=eg(),r_.insertStyleElement=ew(),em()(rf.Z,r_);var rx=rf.Z&&rf.Z.locals?rf.Z.locals:void 0,rb=()=>O.o.t("web_sdk_official_banner",{docs_link:(0,E.jsx)("a",{className:rx.link,href:tO.zi,target:"_blank",children:O.o.t("web_sdk_official_banner_link")},"web_sdk_official_banner")}),ry=(e,t)=>{var n=[],o="{{{link}}}";return e.replace(/\{\{\s*(\w+)\s*\}\}/g,(e,r)=>{var{link:i,text:a}=(null==t?void 0:t[r])||{};return i&&a?n.push((0,E.jsx)("a",{className:rx.link,href:i,target:"_blank",children:a})):n.push(a||""),o}).split(o).map((e,t)=>(0,E.jsxs)(j.Fragment,{children:[e,n[t]]},"text_link_".concat(t)))},rw=e=>{var{isShow:t=!0,expressionText:n,linkvars:o,footerClassName:r,textClassName:i,theme:a}=e;return t?(0,E.jsx)("footer",{className:k()(rx.footer,r,{[rx["bg-theme"]]:"bg-theme"===a}),children:(0,E.jsx)("span",{className:k()(rx.text,i),children:n?ry(n,o):rb()})}):null},rC=n.p+"static/image/error-unbind.c95b427c.png",rI=n.p+"static/image/error-default.c280688e.png",rN=n("519852"),rE={};rE.styleTagTransform=eI(),rE.setAttributes=eb(),rE.insert=e_().bind(null,"head"),rE.domAPI=eg(),rE.insertStyleElement=ew(),em()(rN.Z,rE);var rj=rN.Z&&rN.Z.locals?rN.Z.locals:void 0,rT=e=>{var{error:t,onBeforeRetry:n,refresh:o}=e,r=O.o.t("overview_bi_assistant_system_error");if(t){r=t.msg;var i=H(t);i&&(r=i.msg)}var a=O.o.t("web_sdk_retry_notification"),s=!!(null==t?void 0:t.code)&&Q.includes(t.code);return(0,E.jsxs)("div",{className:rj.wrapper,children:[(0,E.jsx)("img",{className:rj.icon,src:rk(t)}),(0,E.jsx)("div",{className:rj.message,children:r}),!s&&(0,E.jsx)("div",{className:rj.extra,children:O.o.t("web_sdk_api_error_".concat(null==t?void 0:t.code),{},a)}),(0,E.jsx)(en.zx,{className:rj.btn,onClick:()=>{null==n||n(),o?null==o||o():location.reload()},children:O.o.t("retry")})]})},rk=e=>{if((null==e?void 0:e.code)===G.BotUnbind)return rC;return rI},{Title:rA,Text:rM}=tf.ZT,rS=()=>(0,E.jsxs)("div",{children:[(0,E.jsx)(rA,{children:O.o.t("404_title")}),(0,E.jsx)(rM,{children:O.o.t("404_content")})]}),rz=e=>{var{children:t}=e;return(0,E.jsx)(tz.SV,{errorBoundaryName:"ErrorBoundary",logger:tP.getLogger(),FallbackComponent:rS,children:t})},rO=e=>({}),rL=e=>{var t=!1,n="",o="";return{onBeforeMessageGroupListUpdate:o=>{var r,i,a,s,l,{messages:d}=e.chatAreaPluginContext.readonlyAPI.message.getMessagesStoreInstantValues(),u=null==d?void 0:d[0];return t&&n!==(null==u?void 0:u.message_id)?(null===(i=e.pluginBizContext.eventCallbacks)||void 0===i||null===(r=i.onMessageChanged)||void 0===r||r.call(i),n=null==u?void 0:u.message_id,((null==u?void 0:u.type)==="answer"&&(null==u?void 0:u.is_finish)===!0||!n)&&(null===(l=e.pluginBizContext)||void 0===l||null===(s=l.eventCallbacks)||void 0===s||null===(a=s.onMessageReceivedFinish)||void 0===a||a.call(s)),o):(t=!0,o)},onAfterSendMessage:t=>{var n,o,r,i,a,s,l,d,u=(null==t?void 0:null===(o=t.message)||void 0===o?void 0:null===(n=o.extra_info)||void 0===n?void 0:n.chatflow_execute_id)||"";u&&(null===(d=e.pluginBizContext)||void 0===d||null===(l=d.eventCallbacks)||void 0===l||null===(s=l.onGetChatFlowExecuteId)||void 0===s||s.call(l,u)),null===(a=e.pluginBizContext)||void 0===a||null===(i=a.eventCallbacks)||void 0===i||null===(r=i.onMessageSended)||void 0===r||r.call(i)},onBeforeReceiveMessage:t=>{var n,r,i;if(o!==t.message.reply_id)o=t.message.reply_id,null===(i=e.pluginBizContext)||void 0===i||null===(r=i.eventCallbacks)||void 0===r||null===(n=r.onMessageReceivedStart)||void 0===n||n.call(r)}}},rR=e=>({}),rD=e=>({}),rP=e=>({appLifeCycleService:rD(e),messageLifeCycleService:rL(e),commandLifeCycleService:rR(e),renderLifeCycleService:rO(e)});class rU extends e8.x1{constructor(...e){super(...e),this.pluginMode=e8.tf.Writeable,this.pluginName=e8.p7.UIBuilderEventcallbackPlugin,this.lifeCycleServices=(0,e8.BO)(this,rP)}}var rB=e=>({createPluginBizContext:()=>(0,C._)({},e),Plugin:rU}),rZ=n("335740"),rF=e=>{var{project:t}=e,{mode:n,connectorId:o}=t||{};if(!o){if("websdk"===n)return"999";if("draft"===n)return"10000010"}return o},rq=(e,t,n)=>{var o,r,i,a,s,l,d,u,c,v,p,m={prologue:(null==t?void 0:null===(o=t.onboarding_info)||void 0===o?void 0:o.prologue)||"",onboardingSuggestions:(null==t?void 0:null===(i=t.onboarding_info)||void 0===i?void 0:null===(r=i.suggested_questions)||void 0===r?void 0:r.map((e,t)=>({id:t.toString(),content:e})))||[],displayAllSuggest:null==t?void 0:null===(a=t.onboarding_info)||void 0===a?void 0:a.display_all_suggestions,botInfo:{url:(null==t?void 0:null===(s=t.avatar)||void 0===s?void 0:s.image_url)||(null==e?void 0:e.icon_url)||"",nickname:(null==t?void 0:t.name)||(null==e?void 0:e.name)||(null==n?void 0:n.project.defaultName)||"",id:(null==n?void 0:null===(l=n.project)||void 0===l?void 0:l.id)||""},suggestPromoteInfo:{suggestReplyMode:null==t?void 0:null===(d=t.suggest_reply_info)||void 0===d?void 0:d.suggest_reply_mode,customizedSuggestPrompt:null==t?void 0:null===(u=t.suggest_reply_info)||void 0===u?void 0:u.customized_suggest_prompt},backgroundInfo:null==t?void 0:t.background_image_info,defaultInputMode:(null==t?void 0:null===(c=t.user_input_config)||void 0===c?void 0:c.default_input_mode)===2?eJ.Voice:eJ.Text};return(null===(v=m.backgroundInfo)||void 0===v?void 0:v.web_background_image)&&(m.backgroundInfo.web_background_image.origin_image_url=m.backgroundInfo.web_background_image.image_url),(null===(p=m.backgroundInfo)||void 0===p?void 0:p.mobile_background_image)&&(m.backgroundInfo.mobile_background_image.origin_image_url=m.backgroundInfo.mobile_background_image.image_url),m},rV=(e,t)=>{var n,o,r,i,a,s,l,d,u,c,v,p,m,h,g,f,_,x,b,y,w,C,I,N,E,j,T,k,A=(0,rZ.Z)(e);return(null==t?void 0:null===(n=t.project)||void 0===n?void 0:n.id)&&(A.botInfo.id=null==t?void 0:null===(g=t.project)||void 0===g?void 0:g.id),(null==t?void 0:null===(o=t.project)||void 0===o?void 0:o.name)&&(A.botInfo.nickname=null==t?void 0:null===(f=t.project)||void 0===f?void 0:f.name),(null==t?void 0:null===(r=t.project)||void 0===r?void 0:r.iconUrl)&&(A.botInfo.url=null==t?void 0:null===(_=t.project)||void 0===_?void 0:_.iconUrl),(null==t?void 0:null===(a=t.project)||void 0===a?void 0:null===(i=a.onBoarding)||void 0===i?void 0:i.prologue)&&(A.prologue=null==t?void 0:null===(b=t.project)||void 0===b?void 0:null===(x=b.onBoarding)||void 0===x?void 0:x.prologue),(null==t?void 0:null===(d=t.project)||void 0===d?void 0:null===(l=d.onBoarding)||void 0===l?void 0:null===(s=l.suggestions)||void 0===s?void 0:s.length)&&(A.onboardingSuggestions=(null==t?void 0:null===(w=t.project)||void 0===w?void 0:null===(y=w.onBoarding)||void 0===y?void 0:y.suggestions.map((e,t)=>({id:t.toString(),content:e})))||[]),(null==t?void 0:null===(c=t.project)||void 0===c?void 0:null===(u=c.onBoarding)||void 0===u?void 0:u.displayAllSuggest)&&(A.displayAllSuggest=null==t?void 0:null===(I=t.project)||void 0===I?void 0:null===(C=I.onBoarding)||void 0===C?void 0:C.displayAllSuggest),!A.displayAllSuggest&&(A.onboardingSuggestions=A.onboardingSuggestions.slice(0,3)),(null==t?void 0:null===(p=t.project)||void 0===p?void 0:null===(v=p.suggestPromoteInfo)||void 0===v?void 0:v.suggestReplyMode)&&(A.suggestPromoteInfo={suggestReplyMode:null==t?void 0:null===(E=t.project)||void 0===E?void 0:null===(N=E.suggestPromoteInfo)||void 0===N?void 0:N.suggestReplyMode,customizedSuggestPrompt:null==t?void 0:null===(T=t.project)||void 0===T?void 0:null===(j=T.suggestPromoteInfo)||void 0===j?void 0:j.customizedSuggestPrompt}),(null==t?void 0:null===(h=t.areaUi)||void 0===h?void 0:null===(m=h.bgInfo)||void 0===m?void 0:m.imgUrl)?A.customBgInfo=null==t?void 0:null===(k=t.areaUi)||void 0===k?void 0:k.bgInfo:A.customBgInfo=void 0,A};var rW=(b=(0,P._)(function*(e,t){var n,o,r,i,a,s,l,d,u,c,v,p=rF(t),m=(null==t?void 0:null===(n=t.project)||void 0===n?void 0:n.mode)==="websdk",h=null==t?void 0:null===(o=t.workflow)||void 0===o?void 0:o.id,g=(null==t?void 0:null===(r=t.project)||void 0===r?void 0:r.mode)==="draft"?"true":"",f=(null==t?void 0:null===(i=t.project)||void 0===i?void 0:i.caller)||"";console.log("i18n.language",e6.ZP.language);var[_,x]=yield Promise.allSettled([m?null==e?void 0:e.get("/v1/apps/".concat(null==t?void 0:null===(a=t.project)||void 0===a?void 0:a.id,"?version=").concat((null==t?void 0:null===(s=t.project)||void 0===s?void 0:s.version)||"","&connector_id=").concat(p),{},!1,{headers:{"Accept-Language":"zh-CN"===e6.ZP.language?"zh":"en"}}):null,h?null==e?void 0:e.get("/v1/workflows/".concat(h,"?").concat(["connector_id=".concat(p),"is_debug=".concat(g),"caller=".concat(f)].join("&")),{},!1,{headers:{"Accept-Language":"zh-CN"===e6.ZP.language?"zh":"en"}}):null]),b=(null==_?void 0:_.status)==="fulfilled"?null==_?void 0:null===(l=_.value)||void 0===l?void 0:l.data:void 0,y=(null==x?void 0:x.status)==="fulfilled"?null==x?void 0:null===(u=x.value)||void 0===u?void 0:null===(d=u.data)||void 0===d?void 0:d.role:void 0;if(m&&!b)throw{code:null==_?void 0:null===(v=_.reason)||void 0===v?void 0:v.code,message:""};var w=rq(b,y,t);return(null==t?void 0:null===(c=t.workflow)||void 0===c?void 0:c.id)&&!w.botInfo.url&&(w.botInfo.url="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAYAAAB5fY51AAAACXBIWXMAACE4AAAhOAFFljFgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAwkSURBVHgB7d2xblRXGsDxwyrQGGkxhaHACmsatgEiUQSKYCRoSBHnCYAngDxBnCcIPAEgP0BIkTRBwk4RUiCF0EADSwQFuABWwg0p2PkGhiUBxL0zd+z57v39pNGwu83OzJ2/zzn33DubytLSiwKQwD8KQBKCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWk8VGBEe2emirbtmz5yyPce/as//z0+fNyb22t/wyjECwqixAdmJ7uP/b3HvM7d5Ztmze/DlQVN5486Yds5dGj/r+Xe89Q1aaytPSiwHtEjE7NzZUvZmf7oaoTp6oiWpfu3CnLq6uvR2XwLoLFW96M1PyOHWU9DeJ18e7dAn8nWLwWoTqzd28523uMYyRVR4y0YsT1zc2bRl28JlhMVKjeJUZbwkUQrI6LUC3u2zeRoXpTxOr87dvlXO9BdwlWRx3Yvr1c+PTT/nMmEa6jV64YbXWUjaMdFKOq306cSBersHvr1vKfhYXydW9USPcYYXVIfNkvHDq07mf+xiXOKJ6+ds1oq0OMsDoiYnX12LHWxCrEa4nXFK+NbhCsDogvdkwB2/jFjtfUn95OTxfaT7Ba7uTcXLl6/PjEnwUcRby23z7/vP9aaTfBarH4Al88fLh0RbxW0Wo3wWqpOAPYpVgNnDt40PSwxQSrhQYL7F0U08OYAluIbyfBaplBrNq8ZvUh/Wh1/D1oK8FqmW97UyKji//vOaNdBKtFYvf3wq5dhZcWZmf7F3TTHoLVEjGiWHS5ylsi4kac7SFYLfHdkSOFt8U6lqlhewhWC8TdQZ3Kf7/Y6X/K/qxWEKwWcOeCD4uTEc4a5idYyVmjqSZiZQE+P8FKLEJlqlPdmQm9BTTVCVZi8zMzRlc1GGXlJ1iJWbuq74xgpSZYScWmSKOr+mKU1aabGHaNYCUVP3LKcIyy8hKshAa/zMxwYoRl8T0nwUrIlGY0/Wlh74QF+QhWQqaDo/Me5iRYCRkdjM4oNSfBSibODDo7OLr++zg1VchFsJJxkXNzjLLyEaxkfMmaEz/UQS6ClczHpoONMSXMR7CS8SVrzn7T63QEKxnBao7No/kIVjK+ZM3xXuYjWInYztA8I9ZcBAtIQ7CANAQLSEOwgDQEi057+uefhTwEK5F7z54VmvX0+fNCHoKVzL21tUIz/AHIR7CSMSJojvjnI1jJ/P7kSaEZ/xX/dAQrmRuPHxeasfzoUSEXwUrmhhFWY7yX+QhWMr5kzfFe5iNYycSiuy/a6GJq7QRGPoKV0Iq1l5GtrK4W8hGshC7fv18YjfcwJ8FKKM5umc4MLzaMOkOYk2Aldf727cJwlk0H0xKspC4/eFAYzjc3bxZyEqyk4iyXaU198Z65hjAvwUrMSKG+87duFfISrMRitGCUVV2MrEylcxOs5IyyqvNe5SdYyRllVRPv0cW7dwu5CVYLGDl82Olr1wr5CVYLxOjBvqz3i6A7M9gOgtUSi76U7xTvyTkxbw3Baom4VMe0521Hr1xxGVOLCFaLxNTwq+vXCy+ZCraPYLVMTH8uORvWX9NbdDKidQSrhc72RlldvslfXLYkVu0kWC0UazZfrqx0cjoUr/nLn3+2btVSgtVS8cWNBecuRauLr7lrBKvFuvQFFqtuEKyWG3yR27ymFWtWn/z4o1h1gGB1QHyRP/nhh1buho/XFLGyZtUNgtUhcfawLfu0IlDxWs7ad9Ypm8rS0otCp+zeurVcPXas/5xRTAFP//pr/5luMcLqoJgi/uvy5XR3eYhRVfx/jimgWHWTEVbHxShrcd++cnJurkyyuOworpW0sN5tgkXf/I4d5eteuOJ5kkSoYlTlJoUEweIvDkxPl7P//veGjrhi6je4x5dQ8SbB4p1iqjg/M1PO9OIVEVsPEafv79/v38rYNgXeRbD4oEG8vpid7U8Zt23ZUpowGEmtvLrfukjxIYJFbTHiiojF8/7eIwIW/3nb5s1vxeze2trL595ieTz+6P3n+O+WHz58/b9BVYIFpGEfFpCGYAFpCBaQhmABaQgWkIZgAWkIFpDGR4XW6W/knJp6uZnz1b8HPn7j323wxxubT2MjamxOjR3z8W8759tHsJKLIMXlMkd6j9h5fuDVznNeXvoT97KPR1z+E89uT5Obne4JRaDiur6F3mN3y0ZM4xbRGlxk7U4Q+QhWEoNInZqbM4JqSIy2lldXy/lbtzr9S9mZCNYEizAt7NpVTu7ZM3E31mubCFaEK+4aweQSrAkUoTqzd28523sYTa2vGHXFHU6FazIJ1oSJUMU91oVqYwnXZBKsCRFTvguHDqX96a22inDF7x9efvCgsPFsHN1gMZK6cPhwuXr8uFhNoPhMvpuf739GPp+NZ4S1gWJU9d2RI6Z/SZgmbjwjrA3y7cGD/VGVWOURI6wYacXPobExjLDWWX+K8dln5cD27YW8YhvElysrds6vMyOsdRSRunrsmFi1QFwCFZ+lda31JVjrJNarHODtEp/lbydO2NS7jgRrHcSvKFuvaqf4TOOz3chfyu4SwRqzOJAv9hZqabf4jEVr/ARrjMSqW0Rr/ARrTGJh/dzBg4Vuic88FuQZD8Eag8HWBWtW3ROfeWwGdnJlPASrYf1FWGcDOy0++zgG/MFqnmA1LHawixVxDHxrSaBxgtWguDXMKYuuvBLHQtzTjOYIVkPiL+qia8z4m7ju0Ii7OYLVkLiXlTUL/q5/+6DesUEzBKsBMfR3eQbvE8eGqWEzBGtEMdx3uxE+5Gu3vW6EYI3IGgVVRKyMskYnWCOIUDkrSFVxFtkft9EI1ghMBakjRlmOmdEI1pCMrhiGX+4ejWANyV9KhmUta3iCNYT4Czk/M1NgGGf8ovfQBGsIC7t2WTxlaBErywnDEawhnNyzp8AovpidLdQnWDXFyMqudkYVx9DuqalCPYJVU0wHoQkLRlm1CVZNhvI0xbFUn2DVYDpIk+JYcrawHsGqwY8L0DTbY+oRrBqMrmja/M6dheoEq4YjgkXDjhhh1SJYNZgS0jQbkOsRrIrih1GhabHobj9WdYJVkYOKcbE2Wp1gVWQ6yLjY2lCdYFVkrYFx2e+PYWWCVdHHpoSMybQRVmWCBRvsn4JVmWBVZErIuDihU51gAWkIFpCGYAFpCBaQhmABaQgWkIZgAWkIFpCGYAFpCBaQhmABaQgWkIZgVfT0+fMC43Bvba1QjWBV9PuTJwXGQbCqE6yKbjx+XGAcVh4+LFQjWBVdfvCgwDgsr64WqhGsiu49e1aWHz0q0KQ4puLYohrBquHSnTsFmuSYqkewarh4966/hjQmjqU4pqhOsGo6fe1agSY4luoTrJpizeH87dsFRvHNzZvWRIcgWEM4e/16uWFfFkOKLTKLvWBRn2AN6ehPP4kWtUWsjl65UhiOYA0pLtWJaF2yaEpFcaxErFzmNTzBGkEceKd++aV81ZsiOnvI+8RxEsdIHCtiNZpNZWnpRWFk8cvQi/v2lZNzcwVCxClO0JzrPYSqGYLVsAjX/MxMOblnTzkwPV22bdlS6I4IU6xtfn//fn+PlVA1S7DGbBCtwYN2iiWB/sOdF8bqo8JYOZMIzbHoDqQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGoIFpCFYQBqCBaQhWEAaggWkIVhAGv8DJbWhlGwbFtYAAAAASUVORK5CYII="),w}),function(e,t){return b.apply(this,arguments)});var rG=(y=(0,P._)(function*(e,t){var n="",o="";try{if((null==t?void 0:null===(i=t.project)||void 0===i?void 0:i.type)==="bot"){var r=yield null==e?void 0:e.conversations.create({connector_id:rF(t)},{headers:{"Accept-Language":"zh-CN"===e6.ZP.language?"zh":"en"}});n=(null==r?void 0:r.id)||"",o=r.last_section_id}else{var i,a,s,l,d,u,c,v=yield null==e?void 0:e.post("/v1/workflow/conversation/create",{app_id:null===(a=t.project)||void 0===a?void 0:a.id,conversation_name:null==t?void 0:null===(s=t.project)||void 0===s?void 0:s.conversationName,get_or_create:!0,draft_mode:(null==t?void 0:null===(l=t.project)||void 0===l?void 0:l.mode)==="draft",workflow_id:null==t?void 0:null===(d=t.workflow)||void 0===d?void 0:d.id,connector_id:rF(t)},!1,{headers:{"Accept-Language":"zh-CN"===e6.ZP.language?"zh":"en"}});n=(null==v?void 0:null===(u=v.data)||void 0===u?void 0:u.id)||"",o=(null==v?void 0:null===(c=v.data)||void 0===c?void 0:c.last_section_id)||""}return{conversationId:n,sectionId:o}}catch(e){throw{code:-1002,message:""}}}),function(e,t){return y.apply(this,arguments)}),rQ=(0,j.createContext)({appDataFromOnLine:null,appDataCombineWithProps:null}),rH=e=>{var{children:t}=e,n=(0,N._)(e,["children"]);return(0,E.jsx)(rQ.Provider,{value:n,children:t})},r$=()=>{var{appDataCombineWithProps:e}=(0,j.useContext)(rQ);return e},rY=()=>{var{setAppDataFromOnLine:e}=(0,j.useContext)(rQ);return e},rJ=e=>{var{appDataFromOnLine:t,setAppDataCombineWithProps:n}=(0,j.useContext)(rQ);(0,q.Z)(()=>{if(t){var o=rV(t,e);null==n||n(o)}},[t,e])},rK=e=>{var t,n=(0,j.useRef)(e);n.current=e;var o=rY();return(0,j.useCallback)((t=(0,P._)(function*(e){var t,r=rW(e||void 0,n.current),i=rG(e||void 0,n.current),a=yield r,s=yield i;null==o||o(a||null);var l=rV(a,n.current);return(0,I._)((0,C._)({},l,s),{isCustomBackground:!!(null===(t=l.customBgInfo)||void 0===t?void 0:t.imgUrl),isBuilderChat:!0})}),function(e){return t.apply(this,arguments)}),[])},rX=()=>{var{partialUpdateOnboardingData:e}=(0,e8.rj)(),t=r$();(0,q.Z)(()=>{e(null==t?void 0:t.prologue,null==t?void 0:t.onboardingSuggestions)},[null==t?void 0:t.prologue,null==t?void 0:t.onboardingSuggestions])},r0=n("382534");var r1=(w=(0,P._)(function*(){try{var e,t,n=yield r0.f_.ImpersonateCozeUser({});return null!==(t=null===(e=n.data)||void 0===e?void 0:e.access_token)&&void 0!==t?t:""}catch(e){return""}}),function(){return w.apply(this,arguments)}),r4=e=>{var t,n,o,r,i;return(null==e?void 0:null===(t=e.project)||void 0===t?void 0:t.type)==="bot"?(null==e?void 0:null===(o=e.project)||void 0===o?void 0:o.mode)!=="draft"&&(n=Error("mode must be draft when project type is bot")):(null==e?void 0:null===(r=e.auth)||void 0===r?void 0:r.type)!=="internal"&&!(null==e?void 0:null===(i=e.auth)||void 0===i?void 0:i.token)&&(n=Error("token is required when auth type is not internal")),n},r2=e=>{var t,n,o,r,[i,a]=(0,j.useState)(!1),[s,l]=(0,j.useState)(null),[d,u]=(0,j.useState)(),{project:c,userInfo:v}=e;return(0,j.useEffect)(()=>{if(!s&&!i){var t=r4(e);if(t){l(t);return}(0,P._)(function*(){var t,n,o,r,i,s,d,p=null===(t=e.auth)||void 0===t?void 0:t.token,m=null===(n=e.auth)||void 0===n?void 0:n.refreshToken;(null===(o=e.auth)||void 0===o?void 0:o.type)==="internal"&&(p=yield r1(),m=r1),p?(u({chatConfig:{bot_id:c.id,auth:{type:D.TOKEN,token:p,onRefreshToken:m,connectorId:rF(e)},ui:{base:{layout:c.layout},chatBot:{uploadable:e.areaUi.uploadable,isNeedClearContext:e.areaUi.isNeedClearContext,isNeedClearMessage:e.areaUi.isNeedClearMessage,isNeedAddNewConversation:null!==(i=e.areaUi.isNeedAddNewConversation)&&void 0!==i&&i,isNeedAudio:null===(s=null===(r=e.areaUi.input)||void 0===r?void 0:r.isNeedAudio)||void 0===s||s,isNeedQuote:null!==(d=e.areaUi.isNeedQuote)&&void 0!==d&&d,isNeedFunctionCallMessage:e.areaUi.isNeedFunctionCallMessage,feedback:e.areaUi.feedback}},conversation_id:"",source:X.ChatFlow},layout:c.layout,userInfo:(0,C._)({id:(0,Z.x0)(),url:"",nickname:""},v||{})}),a(!0)):l(Error("token is empty"))})()}},[s,i]),(0,q.Z)(()=>{a(!1),l(null)},[null==c?void 0:c.id,null==c?void 0:c.type,null==c?void 0:c.conversationName,null==c?void 0:c.conversationId,null==c?void 0:c.mode,null==c?void 0:c.conversationId,null==e?void 0:null===(t=e.workflow)||void 0===t?void 0:t.id]),d&&(d.chatConfig.ui=d.chatConfig.ui||{},d.chatConfig.ui.chatBot=d.chatConfig.ui.chatBot||{},d.chatConfig.ui.chatBot.isNeedClearMessage=null==e?void 0:null===(n=e.areaUi)||void 0===n?void 0:n.isNeedClearMessage,d.chatConfig.ui.chatBot.uploadable=null===(o=e.areaUi)||void 0===o?void 0:o.uploadable,d.chatConfig.ui.chatBot.feedback=null===(r=e.areaUi)||void 0===r?void 0:r.feedback),{hasReady:i,chatProps:d,error:s,refresh:()=>{l(null),a(!1)}}},r5=e=>{var t=(0,j.useRef)(e),n=r$(),o=(0,j.useRef)(n);return t.current=e,o.current=n,(0,j.useMemo)(()=>({scenes:{[tj.NX.SendMessage]:{hooks:{onBeforeSendMessage:[e=>{var n,r,i,a,s,l,d,u,c,v,p,m,h,g,f,_,x,b,y,w,I,N,E,j,T,{body:k}=e,A=JSON.parse(k),M={};return M.additional_messages=A.additional_messages||[],M.connector_id=A.connector_id,M.workflow_id=null==t?void 0:null===(r=t.current)||void 0===r?void 0:null===(n=r.workflow)||void 0===n?void 0:n.id,M.parameters=null==t?void 0:null===(a=t.current)||void 0===a?void 0:null===(i=a.workflow)||void 0===i?void 0:i.parameters,M.version=(null==t?void 0:null===(l=t.current)||void 0===l?void 0:null===(s=l.project)||void 0===s?void 0:s.version)||void 0,M.execute_mode=(null==t?void 0:null===(u=t.current)||void 0===u?void 0:null===(d=u.project)||void 0===d?void 0:d.mode)==="draft"?"DEBUG":void 0,M.app_id=(null==t?void 0:null===(v=t.current)||void 0===v?void 0:null===(c=v.project)||void 0===c?void 0:c.type)==="app"?null==t?void 0:null===(m=t.current)||void 0===m?void 0:null===(p=m.project)||void 0===p?void 0:p.id:void 0,M.bot_id=(null==t?void 0:null===(g=t.current)||void 0===g?void 0:null===(h=g.project)||void 0===h?void 0:h.type)==="bot"?null==t?void 0:null===(_=t.current)||void 0===_?void 0:null===(f=_.project)||void 0===f?void 0:f.id:void 0,M.conversation_id=new URL(e.url).searchParams.get("conversation_id"),M.connector_id=rF(null==t?void 0:t.current),M.ext={_caller:null==t?void 0:null===(b=t.current)||void 0===b?void 0:null===(x=b.project)||void 0===x?void 0:x.caller,user_id:A.user_id},M.suggest_reply_info=(null===(y=o.current)||void 0===y?void 0:y.suggestPromoteInfo)?{suggest_reply_mode:null===(I=o.current)||void 0===I?void 0:null===(w=I.suggestPromoteInfo)||void 0===w?void 0:w.suggestReplyMode,customized_suggest_prompt:null===(E=o.current)||void 0===E?void 0:null===(N=E.suggestPromoteInfo)||void 0===N?void 0:N.customizedSuggestPrompt}:void 0,e.body=JSON.stringify(M),e.url="".concat(tO.a2,"/v1/workflows/chat"),e.headers.push(...Object.entries((null===(T=t.current)||void 0===T?void 0:null===(j=T.workflow)||void 0===j?void 0:j.header)||{})),(0,C._)({},e)}]}},[tj.NX.ClearHistory]:{hooks:{onBeforeRequest:[n=>{var o,r,i,a,s,l,d,u;return(null==e?void 0:null===(o=e.project)||void 0===o?void 0:o.type)==="bot"?n.data={connector_id:rF(e)}:n.data={app_id:null==t?void 0:null===(r=t.current.project)||void 0===r?void 0:r.id,conversation_name:null==t?void 0:null===(a=t.current)||void 0===a?void 0:null===(i=a.project)||void 0===i?void 0:i.conversationName,get_or_create:!1,workflow_id:null==t?void 0:null===(l=t.current)||void 0===l?void 0:null===(s=l.workflow)||void 0===s?void 0:s.id,draft_mode:(null==t?void 0:null===(u=t.current)||void 0===u?void 0:null===(d=u.project)||void 0===d?void 0:d.mode)==="draft",connector_id:rF(e)},(0,C._)({},n)}]}}}}),[])},r3=()=>{var e,t,n,{updateBotInfo:o}=(0,e8.Wp)(),{recordBotInfo:r}=(0,e8.rj)(),i=r$();(0,q.Z)(()=>{var e,t,n,a=(null==i?void 0:null===(e=i.botInfo)||void 0===e?void 0:e.id)||"";r({name:(null==i?void 0:null===(t=i.botInfo)||void 0===t?void 0:t.nickname)||"",avatar:(null==i?void 0:null===(n=i.botInfo)||void 0===n?void 0:n.url)||""}),o(()=>{var e,t,n;return{[a]:{url:(null==i?void 0:null===(e=i.botInfo)||void 0===e?void 0:e.url)||"",nickname:(null==i?void 0:null===(t=i.botInfo)||void 0===t?void 0:t.nickname)||"",id:(null==i?void 0:null===(n=i.botInfo)||void 0===n?void 0:n.id)||"",allowMention:!1}}})},[null==i?void 0:null===(e=i.botInfo)||void 0===e?void 0:e.nickname,null==i?void 0:null===(t=i.botInfo)||void 0===t?void 0:t.url,null==i?void 0:null===(n=i.botInfo)||void 0===n?void 0:n.id])},r9=n("268009"),r8={};r8.styleTagTransform=eI(),r8.setAttributes=eb(),r8.insert=e_().bind(null,"head"),r8.domAPI=eg(),r8.insertStyleElement=ew(),em()(r9.Z,r8);var r6=r9.Z&&r9.Z.locals?r9.Z.locals:void 0,r7=e=>{var t=(0,j.useRef)(null),{bgInfo:n}=e;if(!n||!(null==n?void 0:n.imgUrl))return null;var{themeColor:o="transparent",imgUrl:r}=n;return(0,E.jsxs)("div",{ref:t,className:r6["bg-image"],style:{backgroundColor:o},children:[(0,E.jsx)("div",{className:r6.mask}),(0,E.jsx)("div",{className:r6["img-container"],children:r?(0,E.jsx)("img",{src:r,className:r6.img}):null})]})},ie=n("310659"),it={};it.styleTagTransform=eI(),it.setAttributes=eb(),it.insert=e_().bind(null,"head"),it.domAPI=eg(),it.insertStyleElement=ew(),em()(ie.Z,it);var io=ie.Z&&ie.Z.locals?ie.Z.locals:void 0,ir=e=>{var{label:t,children:n}=e;return(0,E.jsxs)("div",{className:io["label-value"],children:[(0,E.jsxs)("div",{className:io.label,children:[t,":"]}),(0,E.jsx)("div",{className:io.value,children:n})]})},ii=e=>{var t,n,o,r,i,a,s,l,d,u,c,v;return(0,E.jsxs)("div",{className:io.container,children:[(0,E.jsx)(ir,{label:"Bot",children:null==e?void 0:null===(t=e.project)||void 0===t?void 0:t.name}),(0,E.jsx)(ir,{label:"BotIcon",children:(0,E.jsx)("img",{src:null==e?void 0:null===(n=e.project)||void 0===n?void 0:n.iconUrl,className:io.img})}),(0,E.jsx)(ir,{label:"",children:null==e?void 0:null===(r=e.project)||void 0===r?void 0:null===(o=r.onBoarding)||void 0===o?void 0:o.prologue}),(0,E.jsx)(ir,{label:"",children:((null==e?void 0:null===(a=e.project)||void 0===a?void 0:null===(i=a.onBoarding)||void 0===i?void 0:i.suggestions)||[]).map((e,t)=>(0,E.jsx)("div",{children:e},"".concat(t)))}),(0,E.jsx)(ir,{label:"",children:null==e?void 0:null===(s=e.userInfo)||void 0===s?void 0:s.nickname}),(0,E.jsx)(ir,{label:"",children:(0,E.jsx)("img",{src:null==e?void 0:null===(l=e.userInfo)||void 0===l?void 0:l.url,className:io.img})}),(0,E.jsxs)(ir,{label:"placholder",children:[null==e?void 0:null===(u=e.areaUi)||void 0===u?void 0:null===(d=u.input)||void 0===d?void 0:d.placeholder," "]}),(0,E.jsxs)(ir,{label:"",children:[null==e?void 0:null===(v=e.areaUi)||void 0===v?void 0:null===(c=v.input)||void 0===c?void 0:c.defaultText," "]})]})},ia=n("906052"),is={};is.styleTagTransform=eI(),is.setAttributes=eb(),is.insert=e_().bind(null,"head"),is.domAPI=eg(),is.insertStyleElement=ew(),em()(ia.Z,is);var il=ia.Z&&ia.Z.locals?ia.Z.locals:void 0,id=(0,j.forwardRef)((e,t)=>{var n,o,r,i,a,s,{uiBuilderProps:l,chatProps:d}=e,u=(0,j.useRef)(!1),c=(0,j.useRef)(),{areaUi:v}=l,p=(0,S.r)(),m=(0,M.VT)(),h=(0,M.eh)();rX(),r3(),(0,j.useImperativeHandle)(t,()=>({sendMessage:e=>{e.type===A.zc.Text?h({text:e.text,mentionList:[]},"other"):e.type===A.zc.Image?m({payload:{contentType:A.zc.Image,contentObj:{image_list:[e.value]},mention_list:[]}},"other"):"file"===e.type&&m({payload:{contentType:A.zc.File,contentObj:{file_list:[e.value]},mention_list:[]}},"other")},clearContext:()=>{null==p||p()}}),[p,h,m]),(0,j.useEffect)(()=>{var e,t,n;null===(n=c.current)||void 0===n||null===(t=n.setInputText)||void 0===t||t.call(n,(null==v?void 0:null===(e=v.input)||void 0===e?void 0:e.defaultText)||"")},[null==v?void 0:null===(n=v.input)||void 0===n?void 0:n.defaultText]);var g=(null==v?void 0:null===(o=v.input)||void 0===o?void 0:o.renderChatInputTopSlot)?()=>{var e,t;return null==v?void 0:null===(t=v.input)||void 0===t?void 0:null===(e=t.renderChatInputTopSlot)||void 0===e?void 0:e.call(t,!1)}:void 0,f=(null===(r=l.project)||void 0===r?void 0:r.layout)===L.MOBILE,_=e3(),{header:x}=l.areaUi||{};return(0,E.jsx)(th,(0,I._)((0,C._)({},d,v||{}),{coreAreaClassName:il["core-area"],inputPlaceholder:(null==v?void 0:null===(i=v.input)||void 0===i?void 0:i.placeholder)||O.o.t("chatInputPlaceholder"),messageMaxWidth:(null==l?void 0:null===(a=l.project)||void 0===a?void 0:a.mode)!=="websdk"?"600px":void 0,enableMultimodalUpload:!0,showInputArea:null==v?void 0:null===(s=v.input)||void 0===s?void 0:s.isShow,messageGroupListClassName:il["scroll-view"],renderChatInputTopSlot:g,isShowClearContextDivider:!0,headerNode:(0,E.jsx)(rg,{title:(null==x?void 0:x.title)||"",iconUrl:null==x?void 0:x.icon,extra:null==x?void 0:x.extra,theme:_,isMobile:f,isShowConversations:!1,isShowHeader:null==x?void 0:x.isShow}),isMiniScreen:(null==v?void 0:v.uiTheme)==="chatFlow",inputNativeCallbacks:{getController:e=>{if(c.current=e,!u.current){var t,n,o;null===(o=c.current)||void 0===o||null===(n=o.setInputText)||void 0===n||n.call(o,(null==v?void 0:null===(t=v.input)||void 0===t?void 0:t.defaultText)||""),u.current=!0}}}}))}),iu=e=>t=>{var n,o,r,{error:i,onBeforeRetry:a}=t;return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(rT,{error:i,onBeforeRetry:a,refresh:e.refresh}),null===(r=e.areaUi)||void 0===r?void 0:null===(o=r.input)||void 0===o?void 0:null===(n=o.renderChatInputTopSlot)||void 0===n?void 0:n.call(o,!0)]})},ic=e=>{var t,n,o,r,i,a,{children:s}=e,l=(0,N._)(e,["children"]),d=(0,z.w)(),u=e3(),{footer:c}=l.areaUi||{},v=(null===(t=l.project)||void 0===t?void 0:t.layout)===L.MOBILE,p=r$(),m=(0,C._)({},c||{expressionText:""});return((null===(n=l.project)||void 0===n?void 0:n.mode)!=="websdk"&&!m.expressionText&&(m.expressionText=O.o.t("chat_GenAI_tips")),"initSuccess"!==d)?(null==l?void 0:null===(a=l.areaUi)||void 0===a?void 0:null===(i=a.renderLoading)||void 0===i?void 0:i.call(a))||(0,E.jsx)(rn,{}):(0,E.jsxs)("div",{className:k()(il.content,{[il.mobile]:v,[il["bg-theme"]]:"bg-theme"===u}),style:l.style,children:[(0,E.jsxs)("div",{className:k()(il.area,{[il["chat-flow-area"]]:(null===(o=l.areaUi)||void 0===o?void 0:o.uiTheme)==="chatFlow",[il["chat-ui-builder"]]:(null===(r=l.areaUi)||void 0===r?void 0:r.uiTheme)==="uiBuilder"}),children:[(0,E.jsx)(r7,{bgInfo:null==p?void 0:p.customBgInfo}),s]}),(0,E.jsx)(rw,(0,I._)((0,C._)({},m),{theme:u}))]})},iv=(0,j.memo)((0,j.forwardRef)((e,t)=>{var n,o,r,i,a,s,l,{chatProps:d,hasReady:u,error:c,refresh:v}=r2(e),p=rK(e),m=rB({eventCallbacks:e.eventCallbacks}),h=r$();rJ(e);var g=r5(e),f=(0,j.useMemo)(()=>{var t,n;return(0,I._)((0,C._)({url:"",nickname:""},e.userInfo||{}),{id:(null==e?void 0:null===(t=e.userInfo)||void 0===t?void 0:t.id)||(null==d?void 0:null===(n=d.userInfo)||void 0===n?void 0:n.id)||""})},[null==e?void 0:e.userInfo,d]),_=iu((0,I._)((0,C._)({},e),{refresh:v}));if((null==e?void 0:null===(n=e.project)||void 0===n?void 0:n.mode)==="audit")return(0,E.jsx)(ii,(0,C._)({},e));if(c)return(0,E.jsx)(_,{error:null,refresh:v});if(!d||!u)return(null==e?void 0:null===(l=e.areaUi)||void 0===l?void 0:null===(s=l.renderLoading)||void 0===s?void 0:s.call(l))||(0,E.jsx)(rn,{});var x=!!(null==h?void 0:null===(o=h.customBgInfo)||void 0===o?void 0:o.imgUrl);return console.log("[result] isCustomBackground:",x,null==h?void 0:h.customBgInfo),(0,E.jsx)(o6,(0,I._)((0,C._)({},d),{userInfo:f,openRequestInit:p,plugins:[m],requestManagerOptions:g,initErrorFallbackFC:_,onImageClick:null===(r=e.eventCallbacks)||void 0===r?void 0:r.onImageClick,debug:e.debug,isCustomBackground:x,onThemeChange:null==e?void 0:null===(i=e.eventCallbacks)||void 0===i?void 0:i.onThemeChange,readonly:null==e?void 0:null===(a=e.areaUi)||void 0===a?void 0:a.isDisabled,spaceId:null==e?void 0:e.spaceId,children:(0,E.jsx)(ic,(0,I._)((0,C._)({},e),{children:(0,E.jsx)(id,{ref:t,uiBuilderProps:e,chatProps:d})}))}))})),ip=(0,j.forwardRef)((e,t)=>{var[n,o]=(0,j.useState)(null),[r,i]=(0,j.useState)(null);return(0,E.jsx)(rz,{children:(0,E.jsx)(rH,{appDataFromOnLine:n,setAppDataFromOnLine:o,appDataCombineWithProps:r,setAppDataCombineWithProps:i,children:(0,E.jsx)(iv,(0,C._)({ref:t},e))})})}),im=n("707846"),ih={};ih.styleTagTransform=eI(),ih.setAttributes=eb(),ih.insert=e_().bind(null,"head"),ih.domAPI=eg(),ih.insertStyleElement=ew(),em()(im.Z,ih);var ig=im.Z&&im.Z.locals?im.Z.locals:void 0,i_=e=>{var{useInIframe:t=!0}=e,n=(0,N._)(e,["useInIframe"]),{chatConfig:o}=null!=n?n:{};return(null==o?void 0:o.bot_id)?(o.auth&&(o.auth.connectorId=o.auth.connectorId||"999"),(0,E.jsx)(ix,(0,I._)((0,C._)({},n),{useInIframe:t}))):null},ix=e=>{var t,n,o,{layout:r,className:i,useInIframe:a=!1,chatConfig:s,userInfo:l,style:d,onImageClick:u,onThemeChange:c}=e;!s.ui&&(s.ui={}),!s.ui.chatBot&&(s.ui.chatBot={}),(null===(t=s.auth)||void 0===t?void 0:t.type)==="token"?(s.ui.chatBot.isNeedClearMessage=!1,s.ui.chatBot.isNeedAddNewConversation=null===(n=s.ui.chatBot.isNeedAddNewConversation)||void 0===n||n,s.ui.chatBot.isNeedClearContext=null===(o=s.ui.chatBot.isNeedClearContext)||void 0===o||o):(s.ui.chatBot.isNeedClearMessage=!0,s.ui.chatBot.isNeedAddNewConversation=!1,s.ui.chatBot.isNeedClearContext=!1);var v={chatConfig:(0,I._)((0,C._)({},s),{source:X.WebSdk}),layout:r,userInfo:l,initErrorFallbackFC:rT,onImageClick:u};return(0,E.jsx)(rz,{children:(0,E.jsx)("div",{className:k()(ig.cozeChatApp,!a&&ig.bordered,i),style:d,children:(0,E.jsx)(o6,(0,I._)((0,C._)({},v),{onThemeChange:c,children:(0,E.jsx)(ib,{chatProps:v,webSdkProps:e})}))})})},ib=e=>{var t,{chatProps:n,webSdkProps:o}=e,{layout:r,title:i,headerExtra:a,icon:s,chatConfig:l}=o,d=(0,e8.w5)(),u=r===L.MOBILE,{header:c,conversations:v}=(null==l?void 0:l.ui)||{},p=e3(),m=(null==v?void 0:v.isNeed)&&l.type!==R.APP;return"initSuccess"!==d?(0,E.jsx)(rn,{}):(0,E.jsxs)("div",{className:ig.content,children:[(0,E.jsx)(th,(0,I._)((0,C._)({},n),{enableMultimodalUpload:!0,headerNode:(0,E.jsx)(rg,{title:i,extra:a,iconUrl:s,theme:p,isMobile:u,isShowConversations:m,isShowHeader:(null==c?void 0:c.isShow)!==!1})})),(0,E.jsx)(rw,(0,I._)((0,C._)({},(null==l?void 0:null===(t=l.ui)||void 0===t?void 0:t.footer)||{}),{theme:p}))]})}},319276:function(e,t,n){n.d(t,{VG:function(){return a},a2:function(){return r},bQ:function(){return i},zi:function(){return o}});var o="",r="undefined"!=typeof location?location.origin:"https://api.xxx.com",i=e=>"",a={region:"cn",is_release:!1,dev:!1}},903643:function(e,t,n){var o=n(407821),r=n.n(o),i=n(472772),a=n.n(i),s=n(395245),l=n.n(s),d=n(297998),u=n.n(d),c=n(646576),v=n.n(c),p=n(606121),m=n.n(p),h=n(421298),g={};g.styleTagTransform=m(),g.setAttributes=u(),g.insert=l().bind(null,"head"),g.domAPI=a(),g.insertStyleElement=v(),r()(h.Z,g),t.Z=h.Z&&h.Z.locals?h.Z.locals:void 0},193909:function(e,t,n){n(151064),n(455069),t.Z="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgaWQ9ImNvel9iYW4iPgo8cGF0aCBpZD0iVW5pb24iIGQ9Ik0wLjY2Njk5MiA4LjAwMDA4QzAuNjY2OTkyIDEyLjA1MDIgMy45NTAyNCAxNS4zMzM0IDguMDAwMzMgMTUuMzMzNEMxMi4wNTA0IDE1LjMzMzQgMTUuMzMzNyAxMi4wNTAyIDE1LjMzMzcgOC4wMDAwOEMxNS4zMzM3IDMuOTQ5OTkgMTIuMDUwNCAwLjY2Njc0OCA4LjAwMDMzIDAuNjY2NzQ4QzMuOTUwMjQgMC42NjY3NDggMC42NjY5OTIgMy45NDk5OSAwLjY2Njk5MiA4LjAwMDA4Wk0xMS43NDUzIDEyLjY4ODFDMTAuNzE4OSAxMy41MDkxIDkuNDE2OTQgMTQuMDAwMSA4LjAwMDMzIDE0LjAwMDFDNC42ODY2MiAxNC4wMDAxIDIuMDAwMzMgMTEuMzEzOCAyLjAwMDMzIDguMDAwMDhDMi4wMDAzMyA2LjU4MzQ2IDIuNDkxMjcgNS4yODE1MSAzLjMxMjI5IDQuMjU1MDhMMTEuNzQ1MyAxMi42ODgxWk0xMi42ODgyIDExLjc0NTNMNC4yNTUwOCAzLjMxMjI1QzUuMjgxNTQgMi40OTExIDYuNTgzNTkgMi4wMDAwOCA4LjAwMDMzIDIuMDAwMDhDMTEuMzE0IDIuMDAwMDggMTQuMDAwMyA0LjY4NjM3IDE0LjAwMDMgOC4wMDAwOEMxNC4wMDAzIDkuNDE2ODEgMTMuNTA5MyAxMC43MTg5IDEyLjY4ODIgMTEuNzQ1M1oiIGZpbGw9IiMwNjA3MDkiIGZpbGwtb3BhY2l0eT0iMC4zIi8+CjwvZz4KPC9zdmc+Cg=="},474488:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".container-ZlqdDL{flex-direction:column;display:flex}.container-ZlqdDL .icon-container-ZKWWFq{justify-content:space-between;align-items:center;width:100%;padding:4px;display:flex}.container-ZlqdDL .icon-container-ZKWWFq .left-content-yzqflv{flex-shrink:0;align-items:center;gap:4px;display:flex}.container-ZlqdDL .icon-container-ZKWWFq .right-content-eCEyc9{align-items:center;gap:4px;margin-left:8px;display:flex}",""]),a.locals={container:"container-ZlqdDL","icon-container":"icon-container-ZKWWFq",iconContainer:"icon-container-ZKWWFq","left-content":"left-content-yzqflv",leftContent:"left-content-yzqflv","right-content":"right-content-eCEyc9",rightContent:"right-content-eCEyc9"},t.Z=a},410914:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".container-PyPGZJ{border-style:solid;border-width:1px;border-radius:8px;align-items:center;gap:4px;width:100%;height:32px;padding:4px;display:flex;box-shadow:0 2px 8px rgba(0,0,0,.1)}",""]),a.locals={container:"container-PyPGZJ"},t.Z=a},325325:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,"@keyframes trigger-config-button-slider-in-u23_nT{0%{opacity:0;transform:translate(30px)}to{opacity:1;transform:translate(0)}}.slide-in-bSKNxI{animation:.5s linear trigger-config-button-slider-in-u23_nT}",""]),a.locals={"slide-in":"slide-in-bSKNxI",slideIn:"slide-in-bSKNxI","trigger-config-button-slider-in":"trigger-config-button-slider-in-u23_nT",triggerConfigButtonSliderIn:"trigger-config-button-slider-in-u23_nT"},t.Z=a},360033:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".frown-upon-container-e7qriC{border:1px solid rgba(10,17,61,.06);flex-direction:column;width:100%;margin-top:12px;padding:12px;display:flex}.frown-upon-container-e7qriC .header-CqdMLJ{justify-content:space-between;width:100%;margin-bottom:12px;line-height:20px;display:flex}.frown-upon-container-e7qriC .header-CqdMLJ .title-A0VXpN{color:rgba(6,7,9,.96);font-size:14px;font-style:normal;font-weight:600}.frown-upon-container-e7qriC .reasons-Ts7gky{gap:8px;margin-bottom:8px;display:flex}.frown-upon-container-e7qriC .reasons-Ts7gky .item-PJyIoR{cursor:pointer;background-color:rgba(6,7,9,.05);border-radius:6px;padding:8px 16px;font-size:14px;font-style:normal;font-weight:400}.frown-upon-container-e7qriC .reasons-Ts7gky .item-PJyIoR:hover{background-color:rgba(128,138,255,.2)}.frown-upon-container-e7qriC .reasons-Ts7gky .item-PJyIoR.selected-Nbfd_0{background-color:rgba(128,138,255,.4)}.frown-upon-container-e7qriC .textarea-NxEDVd{margin-bottom:12px}.frown-upon-container-e7qriC .footer-mbJE4E{text-align:right}",""]),a.locals={"frown-upon-container":"frown-upon-container-e7qriC",frownUponContainer:"frown-upon-container-e7qriC",header:"header-CqdMLJ",title:"title-A0VXpN",reasons:"reasons-Ts7gky",item:"item-PJyIoR",selected:"selected-Nbfd_0",textarea:"textarea-NxEDVd",footer:"footer-mbJE4E"},t.Z=a},110614:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".mask-O9yckq{pointer-events:none;z-index:10;background:linear-gradient(rgba(99,99,99,.4) 0%,rgba(99,99,99,0) 100%);width:100%;height:216px;position:absolute}",""]),a.locals={mask:"mask-O9yckq"},t.Z=a},323946:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".label-EGd0FD{width:-moz-fit-content;width:fit-content;max-width:calc(100 - 16px);margin-bottom:0;padding-right:0;overflow-x:hidden}.label-EGd0FD .semi-form-field-label-text{flex-wrap:nowrap;align-items:center;width:100%;display:flex}.text-jFeyry{font-size:12px;font-weight:500;line-height:18px}.icon-e_5XAg{margin-left:2px;padding:2px}.icon-e_5XAg svg{width:12px;height:12px}",""]),a.locals={label:"label-EGd0FD",text:"text-jFeyry",icon:"icon-e_5XAg"},t.Z=a},843309:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,"",""]),a.locals={},t.Z=a},790021:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,'.upload-button-j_N2aN{border-style:dashed;min-width:0;padding:8px}button.delete-btn-AnPfvd{border-radius:6px;height:20px;line-height:1}.delete-icon-mdYMxp svg{width:12px;height:12px}.file-Zr1dqc{padding:3px;position:relative}.file-Zr1dqc *{z-index:1}.file-Zr1dqc:focus{border-color:#4e40e5}.file-uploading-TYAuNW:after{content:"";width:var(--var-percent);background-color:#e6e8ff;min-width:15%;height:100%;display:block;position:absolute;top:0;left:0}.container-qVoNiR.container-error-Hv4JUS .upload-button-j_N2aN,.container-qVoNiR.container-error-Hv4JUS .input-UjOMGP,.container-qVoNiR.container-error-Hv4JUS .file-Zr1dqc{border-color:#f22435}.retry-f5xqQB{cursor:pointer;color:#4e40e5;flex-wrap:nowrap;flex-shrink:0;justify-content:flex-start;align-items:center;gap:8px;margin-right:12px;font-size:12px;font-weight:500;line-height:16px;display:flex}.retry-f5xqQB svg{width:12px;height:12px}',""]),a.locals={"upload-button":"upload-button-j_N2aN",uploadButton:"upload-button-j_N2aN","delete-btn":"delete-btn-AnPfvd",deleteBtn:"delete-btn-AnPfvd","delete-icon":"delete-icon-mdYMxp",deleteIcon:"delete-icon-mdYMxp",file:"file-Zr1dqc","file-uploading":"file-uploading-TYAuNW",fileUploading:"file-uploading-TYAuNW",container:"container-qVoNiR","container-error":"container-error-Hv4JUS",containerError:"container-error-Hv4JUS",input:"input-UjOMGP",retry:"retry-f5xqQB"},t.Z=a},186118:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".shortcut-bar-GBIFuC{justify-content:center;display:flex;position:relative}.shortcut-bar-GBIFuC .semi-portal-inner{width:100%;min-width:100%;max-width:100%}",""]),a.locals={"shortcut-bar":"shortcut-bar-GBIFuC",shortcutBar:"shortcut-bar-GBIFuC"},t.Z=a},394727:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".shortcut-template-elqd1g{background:#fff;border:1px solid #4e40e5;border-radius:24px;margin:0 24px 36px}.template-icon-GeCg8R{margin-right:4px}",""]),a.locals={"shortcut-template":"shortcut-template-elqd1g",shortcutTemplate:"shortcut-template-elqd1g","template-icon":"template-icon-GeCg8R",templateIcon:"template-icon-GeCg8R"},t.Z=a},840955:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".upload-content-JO3W6X .semi-checkbox-content{flex:0 auto}",""]),a.locals={"upload-content":"upload-content-JO3W6X",uploadContent:"upload-content-JO3W6X"},t.Z=a},324334:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".table-ZYZeGN{border:1px solid var(--coz-stroke-primary);border-radius:8px;padding:0 12px}.table-ZYZeGN .semi-table-placeholder{border-bottom:0}.table-ZYZeGN .semi-form-field{padding:4px 0}.table-ZYZeGN .semi-table-tbody tr:first-child td{padding-top:8px}.table-ZYZeGN .semi-table-tbody tr:last-child td{padding-bottom:12px}.empty-zuidnN{color:var(--coz-fg-dim);text-align:left}",""]),a.locals={table:"table-ZYZeGN",empty:"empty-zuidnN"},t.Z=a},421298:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".btn-X0DO7p .semi-icon{color:var(--coz-fg-secondary)}.btn-X0DO7p button{padding:2px 8px}.btn-X0DO7p .semi-button-content-right{color:var(--coz-fg-secondary);margin-left:4px;font-weight:500}",""]),a.locals={btn:"btn-X0DO7p"},t.Z=a},202282:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".shortcut-command-x7FRSg{margin-right:10px}.shortcut-button-LeKg4K{box-sizing:border-box;border-radius:99px;height:32px;padding:4px 12px;font-size:14px;font-style:normal;font-weight:400;line-height:16px;min-width:unset!important}.shortcut-button-LeKg4K .semi-button-content-left{margin-right:0}.shortcut-white-wiNLQs .shortcut-button-LeKg4K{-webkit-backdrop-filter:blur(3.45px);backdrop-filter:blur(3.45px);border:1px solid var(--coz-stroke-primary);background-color:rgba(6,7,9,.04);color:rgba(6,7,9,.8)!important}.shortcut-white-wiNLQs .shortcut-button-LeKg4K:hover{background:linear-gradient(0deg,rgba(0,0,0,.06) 0%,rgba(0,0,0,.06) 100%),var(--coz-bg-primary);border:1px solid var(--coz-stroke-primary)}.shortcut-blur-rU8W5q .shortcut-button-LeKg4K{color:var(--coze-fg-image-bots,rgba(6,7,9,.8));background-color:var(--coze-bg-image-bots,rgba(249,249,249,.8));-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border:1px solid var(--coze-stroke-image-bots,rgba(6,7,9,.1));border-radius:12px}.shortcut-blur-rU8W5q .shortcut-button-LeKg4K:hover{border:1px solid var(--coze-stroke-image-bots,rgba(6,7,9,.1));background:rgba(224,224,224,.6)}.shortcut-blur-rU8W5q .shortcut-button-LeKg4K .semi-typography{color:rgba(255,255,255,.79)}.load-more-shortcut-wrapper-AJfy38{position:relative}.load-more-shortcut-wrapper-AJfy38 .load-more-button-RrtRtC{border-radius:12px;justify-content:center;align-items:center;gap:4px;height:32px;padding:4px 12px;display:flex}.load-more-list-FCD1Es::-webkit-scrollbar-thumb{background:rgba(29,28,35,.3);border-radius:3px}.load-more-list-FCD1Es::-webkit-scrollbar{background:0 0;width:6px}",""]),a.locals={"shortcut-command":"shortcut-command-x7FRSg",shortcutCommand:"shortcut-command-x7FRSg","shortcut-button":"shortcut-button-LeKg4K",shortcutButton:"shortcut-button-LeKg4K","shortcut-white":"shortcut-white-wiNLQs",shortcutWhite:"shortcut-white-wiNLQs","shortcut-blur":"shortcut-blur-rU8W5q",shortcutBlur:"shortcut-blur-rU8W5q","load-more-shortcut-wrapper":"load-more-shortcut-wrapper-AJfy38",loadMoreShortcutWrapper:"load-more-shortcut-wrapper-AJfy38","load-more-button":"load-more-button-RrtRtC",loadMoreButton:"load-more-button-RrtRtC","load-more-list":"load-more-list-FCD1Es",loadMoreList:"load-more-list-FCD1Es"},t.Z=a},386575:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".container-box-shadow-ftVmyf{z-index:1;box-shadow:0 2px 6px rgba(0,0,0,.08),0 4px 12px rgba(0,0,0,.04)}",""]),a.locals={"container-box-shadow":"container-box-shadow-ftVmyf",containerBoxShadow:"container-box-shadow-ftVmyf"},t.Z=a},115806:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".image-W6L0lo img{-o-object-fit:cover;object-fit:cover;width:100%;height:100%}",""]),a.locals={image:"image-W6L0lo"},t.Z=a},310659:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".container-qBle38{padding:20px}.container-qBle38 .label-value-Q7qNy_{width:100%;margin-bottom:10px;font-size:14px;display:flex}.container-qBle38 .label-value-Q7qNy_ .label-AfYmFD{width:150px}.container-qBle38 .label-value-Q7qNy_ .value-GRVn_S{flex:1}.container-qBle38 .label-value-Q7qNy_ .img-ai5gLW{max-width:200px;height:auto}",""]),a.locals={container:"container-qBle38","label-value":"label-value-Q7qNy_",labelValue:"label-value-Q7qNy_",label:"label-AfYmFD",value:"value-GRVn_S",img:"img-ai5gLW"},t.Z=a},268009:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,'.bg-image-n2I6TI{z-index:0;box-sizing:border-box;width:100%;height:100%;position:absolute;top:0;left:0;overflow:hidden}.bg-image-n2I6TI .mask-dxGRY4{z-index:3;background-color:rgba(0,0,0,.12);width:100%;height:100%;position:absolute;top:0;left:0}.bg-image-n2I6TI .mask-dxGRY4:after{content:"";z-index:10;background:linear-gradient(rgba(99,99,99,.4),rgba(99,99,99,0));width:100%;height:216px;display:block;position:relative}.bg-image-n2I6TI .img-container-IBtg0x{z-index:2;width:100%;height:100%;position:relative;left:50%;overflow:hidden;transform:translate(-50%)}.bg-image-n2I6TI .img-NLiMbt{-o-object-fit:cover;object-fit:cover;width:100%;height:100%;position:relative;left:50%;transform:translate(-50%)}',""]),a.locals={"bg-image":"bg-image-n2I6TI",bgImage:"bg-image-n2I6TI",mask:"mask-dxGRY4","img-container":"img-container-IBtg0x",imgContainer:"img-container-IBtg0x",img:"img-NLiMbt"},t.Z=a},906052:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".content-qwJhfi{flex-direction:column;width:100%;height:100%;display:flex;position:relative;overflow:hidden}.content-qwJhfi .semi-upload-hidden-input{display:none}.content-qwJhfi .semi-upload-hidden-input-replace{display:none}.content-qwJhfi .-translate-x-1\\/2{--tw-translate-x:-50%}.content-qwJhfi .-translate-y-1\\/2{--tw-translate-y:-50%}.content-qwJhfi .area-q60DKJ{flex:1;overflow:hidden}.content-qwJhfi .area-q60DKJ .loading-wrap-U8e8HA{width:100%;height:100%}.content-qwJhfi .area-q60DKJ.chat-flow-area-ONrKTy{margin:0 -12px}.content-qwJhfi .area-q60DKJ.chat-flow-area-ONrKTy .loading-wrap-U8e8HA{margin:0 12px}.content-qwJhfi .scroll-view-PwFV47{padding-left:0;padding-right:0}.content-qwJhfi .chat-uikit-card-content{min-width:auto}.content-qwJhfi .footer-AuhQsp{background:0 0;width:100%;position:absolute;bottom:2px}.content-qwJhfi .footer-AuhQsp .footer-text-a23yTn{color:rgba(48,59,94,.47);font-size:12px;font-style:normal;font-weight:400;line-height:16px}.content-qwJhfi.bg-theme-WwKnEd .footer-AuhQsp .footer-text-a23yTn{color:rgba(255,255,255,.6)}.content-qwJhfi.mobile-smqdlM .scroll-view-PwFV47{padding:0 12px}.content-qwJhfi.mobile-smqdlM .footer-AuhQsp{position:relative}.content-qwJhfi.mobile-smqdlM .chat-ui-builder-empNuf .core-area-jUeqiX{width:100%}.chat-slot-OZ3YhK{padding:0 30px}",""]),a.locals={content:"content-qwJhfi",area:"area-q60DKJ","loading-wrap":"loading-wrap-U8e8HA",loadingWrap:"loading-wrap-U8e8HA","chat-flow-area":"chat-flow-area-ONrKTy",chatFlowArea:"chat-flow-area-ONrKTy","scroll-view":"scroll-view-PwFV47",scrollView:"scroll-view-PwFV47",footer:"footer-AuhQsp","footer-text":"footer-text-a23yTn",footerText:"footer-text-a23yTn","bg-theme":"bg-theme-WwKnEd",bgTheme:"bg-theme-WwKnEd",mobile:"mobile-smqdlM","chat-ui-builder":"chat-ui-builder-empNuf",chatUiBuilder:"chat-ui-builder-empNuf","core-area":"core-area-jUeqiX",coreArea:"core-area-jUeqiX","chat-slot":"chat-slot-OZ3YhK",chatSlot:"chat-slot-OZ3YhK"},t.Z=a},707846:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".coze-chat-app-NHE0Hb{box-sizing:border-box;flex-direction:column;display:flex}.coze-chat-app-NHE0Hb *{box-sizing:border-box}.coze-chat-app-NHE0Hb.bordered-drh32r{border-radius:8px;box-shadow:0 6px 8px rgba(29,28,35,.06),0 0 2px rgba(29,28,35,.18)}.coze-chat-app-NHE0Hb .content-VAF6I7{flex:auto;min-height:0}",""]),a.locals={"coze-chat-app":"coze-chat-app-NHE0Hb",cozeChatApp:"coze-chat-app-NHE0Hb",bordered:"bordered-drh32r",content:"content-VAF6I7"},t.Z=a},114096:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".conversation-item-CpzeF6{flex-direction:column;display:flex}.conversation-item-time-kuhu7R{color:var(--coz-fg-secondary);margin-top:4px;padding:8px 8px 0;font-size:14px;font-weight:400;line-height:20px}.conversation-item-content-pivoIn{border-radius:var(--mini,5px);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;align-self:stretch;align-items:center;height:40px;padding:4px 8px;display:flex}.conversation-item-content-active-ZTuJvS{background:var(--coz-mg-secondary-hovered)}.conversation-item-mask-BZYCh1{-webkit-backdrop-filter:blur(2.5px)saturate(1.2);backdrop-filter:blur(2.5px)saturate(1.2);width:100%;height:100%;z-index:calc(var(--chat-z-index-input) + 2);background:rgba(255,255,255,.25);position:fixed;top:0;left:0}.conversation-item-content-touched-ftZGzD{will-change:transform;border:1px solid var(--coz-stroke-primary);animation:.7s cubic-bezier(.4,0,.2,1) jelly-XPC18J}.conversation-item-content-operate-visible-bnVhbI{z-index:calc(var(--chat-z-index-input) + 3);background:var(--coz-bg-max);border:1px solid var(--coz-stroke-primary);box-shadow:0 0 8px 1px rgba(0,0,0,.2)}@keyframes jelly-XPC18J{0%{transform:scale(1)}70%{transform:scale(1.08)}to{transform:scale(1)}}",""]),a.locals={"conversation-item":"conversation-item-CpzeF6",conversationItem:"conversation-item-CpzeF6","conversation-item-time":"conversation-item-time-kuhu7R",conversationItemTime:"conversation-item-time-kuhu7R","conversation-item-content":"conversation-item-content-pivoIn",conversationItemContent:"conversation-item-content-pivoIn","conversation-item-content-active":"conversation-item-content-active-ZTuJvS",conversationItemContentActive:"conversation-item-content-active-ZTuJvS","conversation-item-mask":"conversation-item-mask-BZYCh1",conversationItemMask:"conversation-item-mask-BZYCh1","conversation-item-content-touched":"conversation-item-content-touched-ftZGzD",conversationItemContentTouched:"conversation-item-content-touched-ftZGzD",jelly:"jelly-XPC18J","conversation-item-content-operate-visible":"conversation-item-content-operate-visible-bnVhbI",conversationItemContentOperateVisible:"conversation-item-content-operate-visible-bnVhbI"},t.Z=a},294025:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".conversation-item-gabqzx{flex-direction:column;display:flex}.conversation-item-time-Rk3IRP{color:var(--coz-fg-secondary);margin-top:4px;padding:8px 8px 0;font-size:14px;font-weight:400;line-height:20px}.conversation-item-content-T8kW0o{border-radius:var(--mini,5px);cursor:pointer;align-self:stretch;align-items:center;height:40px;padding:4px 8px;display:flex}.conversation-item-content-T8kW0o .conversation-operate-gnn5XD{display:none}.conversation-item-content-T8kW0o:hover{background:var(--coz-mg-secondary-hovered)}.conversation-item-content-T8kW0o:hover .conversation-operate-gnn5XD{display:block}.conversation-item-content-active-QSn_hy{background:var(--coz-mg-secondary-hovered)}",""]),a.locals={"conversation-item":"conversation-item-gabqzx",conversationItem:"conversation-item-gabqzx","conversation-item-time":"conversation-item-time-Rk3IRP",conversationItemTime:"conversation-item-time-Rk3IRP","conversation-item-content":"conversation-item-content-T8kW0o",conversationItemContent:"conversation-item-content-T8kW0o","conversation-operate":"conversation-operate-gnn5XD",conversationOperate:"conversation-operate-gnn5XD","conversation-item-content-active":"conversation-item-content-active-QSn_hy",conversationItemContentActive:"conversation-item-content-active-QSn_hy"},t.Z=a},410017:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".conversations-cW0Mcw{flex-direction:column;min-width:320px;height:100%;display:flex}.conversations-header-xkzEom{justify-content:space-between;align-items:center;padding:12px 16px;display:flex}.conversations-header-title-PYl6cp{color:var(--coz-fg-primary);font-size:16px;font-weight:600;line-height:22px}.conversations-create-button-gqS2MX{width:calc(100% - 32px);margin:0 16px}.conversations-list-RdQ6d4{flex-direction:column;flex:1;gap:4px;margin-bottom:10px;display:flex;overflow-y:auto}.conversations-list-group-V4Rq24{flex-direction:column;padding:0 8px;display:flex}",""]),a.locals={conversations:"conversations-cW0Mcw","conversations-header":"conversations-header-xkzEom",conversationsHeader:"conversations-header-xkzEom","conversations-header-title":"conversations-header-title-PYl6cp",conversationsHeaderTitle:"conversations-header-title-PYl6cp","conversations-create-button":"conversations-create-button-gqS2MX",conversationsCreateButton:"conversations-create-button-gqS2MX","conversations-list":"conversations-list-RdQ6d4",conversationsList:"conversations-list-RdQ6d4","conversations-list-group":"conversations-list-group-V4Rq24",conversationsListGroup:"conversations-list-group-V4Rq24"},t.Z=a},72113:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".conversations-container-OGF1vq{width:100%;height:100%;display:flex}.conversations-side-sheet-Ale4fq{z-index:calc(var(--chat-z-index-input) + 1);padding:0}.conversations-list-delete-modal-text-lR2egX{color:var(--coz-fg-secondary);font-size:14px;font-weight:400;line-height:20px}",""]),a.locals={"conversations-container":"conversations-container-OGF1vq",conversationsContainer:"conversations-container-OGF1vq","conversations-side-sheet":"conversations-side-sheet-Ale4fq",conversationsSideSheet:"conversations-side-sheet-Ale4fq","conversations-list-delete-modal-text":"conversations-list-delete-modal-text-lR2egX",conversationsListDeleteModalText:"conversations-list-delete-modal-text-lR2egX"},t.Z=a},519852:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".wrapper-aRUEQ6{flex-direction:column;flex:1;justify-content:center;align-items:center;height:100%;display:flex}.icon-PM1LyT{width:48px;height:48px}.message-b_dQv0{color:rgba(6,7,9,.8);margin-top:10px;font-size:16px;font-weight:500;line-height:22px}.extra-ENlpHa{color:rgba(6,7,9,.3);margin-top:4px;font-size:12px;line-height:16px}.btn-WZwXBA{margin-top:28px}",""]),a.locals={wrapper:"wrapper-aRUEQ6",icon:"icon-PM1LyT",message:"message-b_dQv0",extra:"extra-ENlpHa",btn:"btn-WZwXBA"},t.Z=a},425765:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".footer-nP6SsK{z-index:50;background:0 0;flex:none;justify-content:center;align-items:center;width:100%;height:32px;font-size:12px;font-weight:400;display:flex;position:absolute;bottom:2px}.footer-nP6SsK>.text-F2ZbvJ{color:rgba(48,59,94,.47);font-size:12px;font-style:normal;font-weight:400;line-height:16px}.footer-nP6SsK>.text-F2ZbvJ>.link-aJnpEC{color:#4d53e8;text-decoration:none}.footer-nP6SsK.bg-theme-b_fojJ>.text-F2ZbvJ{color:rgba(255,255,255,.6)}",""]),a.locals={footer:"footer-nP6SsK",text:"text-F2ZbvJ",link:"link-aJnpEC","bg-theme":"bg-theme-b_fojJ",bgTheme:"bg-theme-b_fojJ"},t.Z=a},93693:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".float-open-conversations-btn-s8kQxJ{position:absolute;top:20px;left:0}",""]),a.locals={"float-open-conversations-btn":"float-open-conversations-btn-s8kQxJ",floatOpenConversationsBtn:"float-open-conversations-btn-s8kQxJ"},t.Z=a},92563:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".header-XJy8DU{flex:none;align-items:center;height:72px;padding:24px 16px 16px;display:flex}.header-XJy8DU .conversation-list-btn-Low_Kd{margin-right:8px}.header-XJy8DU .avatar-qrhZrw{width:28px;height:28px;margin-right:15px}.header-XJy8DU .title-Bn3oBZ{color:rgba(0,0,0,.85);flex:auto;margin-right:12px;font-size:20px;font-weight:700}.header-XJy8DU .icon-btn-asXah6{width:32px;height:32px}.header-XJy8DU.bg-theme-sFJQ59 .icon-btn-asXah6,.header-XJy8DU.bg-theme-sFJQ59 .title-Bn3oBZ{color:#fff}.header-XJy8DU.bg-theme-sFJQ59 .icon-btn-asXah6:disabled,.header-XJy8DU.bg-theme-sFJQ59 .icon-btn-asXah6:hover{color:rgba(255,255,255,.8)!important}",""]),a.locals={header:"header-XJy8DU","conversation-list-btn":"conversation-list-btn-Low_Kd",conversationListBtn:"conversation-list-btn-Low_Kd",avatar:"avatar-qrhZrw",title:"title-Bn3oBZ","icon-btn":"icon-btn-asXah6",iconBtn:"icon-btn-asXah6","bg-theme":"bg-theme-sFJQ59",bgTheme:"bg-theme-sFJQ59"},t.Z=a},954826:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".header-c2GY3w{border-bottom:1px solid rgba(29,28,35,.08);flex:none;align-items:center;height:56px;padding:0 16px;display:flex}.header-c2GY3w .conversation-list-btn-pfVenk{margin-right:8px}.header-c2GY3w .avatar-VBKBWU{width:24px;height:24px;margin-right:8px}.header-c2GY3w .title-doPV6I{color:#1c1d23;flex:auto;margin-right:12px;font-size:18px;font-weight:600}.header-c2GY3w .icon-btn-XW5hXV{width:32px;height:32px}.header-c2GY3w.bg-theme-k2iRN_ .icon-btn-XW5hXV,.header-c2GY3w.bg-theme-k2iRN_ .title-doPV6I{color:#fff}.header-c2GY3w.bg-theme-k2iRN_ .icon-btn-XW5hXV:disabled,.header-c2GY3w.bg-theme-k2iRN_ .icon-btn-XW5hXV:hover{color:rgba(255,255,255,.8)!important}",""]),a.locals={header:"header-c2GY3w","conversation-list-btn":"conversation-list-btn-pfVenk",conversationListBtn:"conversation-list-btn-pfVenk",avatar:"avatar-VBKBWU",title:"title-doPV6I","icon-btn":"icon-btn-XW5hXV",iconBtn:"icon-btn-XW5hXV","bg-theme":"bg-theme-k2iRN_",bgTheme:"bg-theme-k2iRN_"},t.Z=a},21402:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".loading-juzNfh{justify-content:center;align-items:center;width:100%;height:100%;display:flex}",""]),a.locals={loading:"loading-juzNfh"},t.Z=a},357110:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".chat-input-MD2hnr{padding:10px 0}.area-Vifkit{flex-direction:column;flex:auto;width:100%;height:100%;min-height:0;display:flex}.area-Vifkit *{box-sizing:border-box}.area-Vifkit .chat-uikit-on-boarding-pc>div{padding-left:14px;padding-right:14px}.area-Vifkit .safe-area-Hj5Boc{height:24px}",""]),a.locals={"chat-input":"chat-input-MD2hnr",chatInput:"chat-input-MD2hnr",area:"area-Vifkit","safe-area":"safe-area-Hj5Boc",safeArea:"safe-area-Hj5Boc"},t.Z=a},394917:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".container-MAaKnd{background-color:rgba(var(--coze-bg-3),var(--coze-bg-3-alpha));border-radius:4px;padding:4px}.container-MAaKnd .button-reMmTH{text-align:left;width:100%;color:rgba(var(--coze-fg-3),var(--coze-fg-3-alpha));border-radius:4px;justify-content:flex-start;padding-left:8px;padding-right:8px;font-weight:400}.container-MAaKnd .button-reMmTH.coz-btn-secondary{color:rgba(var(--coze-fg-3),var(--coze-fg-3-alpha))}.popover-cntL5v{border-radius:4px}.chat-input-left-slot-TEgGKm .disabled-AeV9HE{color:rgba(55,67,106,.38)!important;background-color:rgba(249,249,249,.8)!important}",""]),a.locals={container:"container-MAaKnd",button:"button-reMmTH",popover:"popover-cntL5v","chat-input-left-slot":"chat-input-left-slot-TEgGKm",chatInputLeftSlot:"chat-input-left-slot-TEgGKm",disabled:"disabled-AeV9HE"},t.Z=a},904375:function(e,t,n){var o=n(125161),r=n.n(o),i=n(404442),a=n.n(i)()(r());a.push([e.id,".message-box-wrapper-TZhKV8 .coz-fg-images-user-name{color:var(--coze-fg-image-user-name)}",""]),a.locals={"message-box-wrapper":"message-box-wrapper-TZhKV8",messageBoxWrapper:"message-box-wrapper-TZhKV8"},t.Z=a},952745:function(){},383003:function(){},206995:function(){},767821:function(){},574621:function(){},796659:function(e,t){t.Z=function(e,t,n){if("function"!=typeof e)throw TypeError("Expected a function");return setTimeout(function(){e.apply(void 0,n)},t)}},747514:function(e,t,n){var o=n(796659),r=(0,n(61910).Z)(function(e,t){return(0,o.Z)(e,1,t)});t.Z=r}}]);
//# sourceMappingURL=7992.ca69190e.js.map