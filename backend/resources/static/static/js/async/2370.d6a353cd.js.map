{"version":3,"file":"static/js/async/2370.d6a353cd.js","sources":["webpack://@coze-studio/app/../../packages/workflow/adapter/playground/src/hooks/use-navigate-back.tsx","webpack://@coze-studio/app/../../packages/workflow/adapter/playground/src/page.tsx","webpack://@coze-studio/app/../../packages/workflow/adapter/playground/src/hooks/use-page-params.ts"],"sourcesContent":["/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useNavigate } from 'react-router-dom';\nimport { useMemo } from 'react';\n\nimport { type WorkflowGlobalStateEntity } from '@coze-workflow/playground';\nimport { type WorkflowMode, workflowApi } from '@coze-workflow/base/api';\nimport { reporter } from '@coze-arch/logger';\nimport {\n  usePageJumpResponse,\n  PageType,\n  usePageJumpService,\n  SceneType,\n} from '@coze-arch/bot-hooks';\nimport { CustomError } from '@coze-arch/bot-error';\n\nconst MAX_HISTORY_COUNT = 2;\n\nconst hasHistory = (): boolean =>\n  Boolean(\n    window.history.length > MAX_HISTORY_COUNT && window.document?.referrer,\n  );\n\ntype NavigateScene = 'publish' | 'exit';\n\n/**\n * Return to previous page logic\n */\nexport const useNavigateBack = () => {\n  const pageJumpResponse = usePageJumpResponse(PageType.WORKFLOW);\n  const { jump } = usePageJumpService();\n  const navigate = useNavigate();\n\n  /** Process details page route update will invalidate pageJumpResponse, so you need to cache a copy of the original version */\n  const memoPageJumpResponse = useMemo(() => pageJumpResponse, []);\n\n  const navigateBack = async (\n    workflowState: WorkflowGlobalStateEntity,\n    scene: NavigateScene,\n  ) => {\n    reporter.event({\n      namespace: 'workflow',\n      eventName: 'workflow_navigate_back',\n    });\n\n    const { spaceId, info, workflowId, flowMode } = workflowState;\n    const { plugin_id } = info;\n    if (!spaceId || !workflowId) {\n      reporter.errorEvent({\n        namespace: 'workflow',\n        eventName: 'workflow_navigate_back_failed',\n        error: new CustomError(\n          'navigate_back_failed',\n          'no spaceId or workflowId',\n        ),\n      });\n      return;\n    }\n\n    // Jump back to the bot details page with scene parameters\n    if (memoPageJumpResponse?.scene) {\n      if (scene === 'publish') {\n        let pluginID = plugin_id;\n\n        // When you publish the process for the first time, you need to retrieve the pluginID from the interface again.\n        if (!pluginID || pluginID === '0') {\n          const workflowRes = await workflowApi.GetCanvasInfo(\n            {\n              workflow_id: workflowId,\n              space_id: spaceId,\n            },\n            {\n              __disableErrorToast: true,\n            },\n          );\n          pluginID = workflowRes.data?.workflow?.plugin_id || '0';\n        }\n\n        if (\n          memoPageJumpResponse.scene === SceneType.BOT__VIEW__WORKFLOW &&\n          memoPageJumpResponse.botID\n        ) {\n          const { botID, agentID, workflowOpenMode } = memoPageJumpResponse;\n          reporter.event({\n            namespace: 'workflow',\n            eventName: 'workflow_navigate_back_to_bot',\n          });\n          jump(SceneType.WORKFLOW_PUBLISHED__BACK__BOT, {\n            spaceID: spaceId,\n            botID,\n            workflowID: workflowId,\n            pluginID,\n            agentID,\n            workflowOpenMode,\n            flowMode: flowMode as WorkflowMode,\n          });\n          return;\n        }\n      }\n\n      if (scene === 'exit') {\n        if (\n          memoPageJumpResponse.scene === SceneType.BOT__VIEW__WORKFLOW &&\n          memoPageJumpResponse.botID\n        ) {\n          const { botID, agentID, workflowOpenMode, workflowModalState } =\n            memoPageJumpResponse;\n          jump(SceneType.WORKFLOW__BACK__BOT, {\n            spaceID: spaceId,\n            botID,\n            workflowModalState,\n            agentID,\n            workflowOpenMode,\n            flowMode: flowMode as WorkflowMode,\n          });\n          return;\n        }\n      }\n    }\n\n    if (hasHistory()) {\n      reporter.event({\n        namespace: 'workflow',\n        eventName: 'workflow_navigate_back_to_history',\n      });\n      navigate(-1);\n    } else {\n      reporter.event({\n        namespace: 'workflow',\n        eventName: 'workflow_navigate_back_to_list',\n      });\n      // If history is only one page, navigate (-1) does not take effect at this time, you need to manually specify the path\n      // At present, the dead path is written first. The disadvantage is that it needs to be changed with the change of the page structure, and then optimized for a better implementation later.\n      // /library coze 2.0 mixed resource list page\n      navigate(`/space/${spaceId}/library`);\n    }\n  };\n\n  return {\n    navigateBack,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport 'reflect-metadata';\nimport React, { useRef, useState } from 'react';\n\nimport { WorkflowPlayground } from '@coze-workflow/playground/workflow-playground';\nimport {\n  type AddNodeRef,\n  type WorkflowPlaygroundRef,\n} from '@coze-workflow/playground/typing';\n\nimport { usePageParams } from './hooks/use-page-params';\nimport { useNavigateBack } from './hooks';\n\n// The added node is placed in the toolbar, but the original sidebar is no longer needed.\nconst EmptySidebar = React.forwardRef<AddNodeRef, unknown>(\n  (_props, _addNodeRef) => null,\n);\n\nexport function WorkflowPage(): React.ReactNode {\n  const workflowPlaygroundRef = useRef<WorkflowPlaygroundRef>(null);\n  const {\n    spaceId,\n    workflowId,\n    version,\n    setVersion,\n    from,\n    optType,\n    nodeId,\n    executeId,\n    subExecuteId,\n  } = usePageParams();\n\n  const [initOnce, setInitOnce] = useState(false);\n  const { navigateBack } = useNavigateBack();\n\n  /** Whether it is read-only mode, derived from the process exploration module */\n  const readonly = from === 'explore';\n\n  if (!workflowId || !spaceId) {\n    return null;\n  }\n\n  return (\n    <>\n      <WorkflowPlayground\n        ref={workflowPlaygroundRef}\n        sidebar={EmptySidebar}\n        workflowId={workflowId}\n        spaceId={spaceId}\n        commitId={setVersion ? undefined : version}\n        commitOptType={setVersion ? undefined : optType}\n        readonly={readonly}\n        executeId={executeId}\n        subExecuteId={subExecuteId}\n        onInit={_workflowState => {\n          if (setVersion && version) {\n            workflowPlaygroundRef.current?.resetToHistory({\n              commitId: version,\n              optType,\n            });\n          }\n\n          // onInit may be called multiple times, it only needs to be executed once\n          if (!initOnce) {\n            // Read the node_id parameters on the link and scroll to the corresponding node\n            if (nodeId) {\n              workflowPlaygroundRef.current?.scrollToNode(nodeId);\n            }\n\n            // Read execute_id show the corresponding execution result\n            if (executeId) {\n              workflowPlaygroundRef.current?.showTestRunResult(\n                executeId,\n                subExecuteId,\n              );\n            }\n\n            setInitOnce(true);\n          }\n        }}\n        from={from}\n        onBackClick={workflowState => {\n          navigateBack(workflowState, 'exit');\n        }}\n        onPublish={workflowState => {\n          navigateBack(workflowState, 'publish');\n        }}\n      />\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport { useMount } from 'ahooks';\nimport { type WorkflowPlaygroundProps } from '@coze-workflow/playground';\nimport { OperateType } from '@coze-workflow/base/api';\nimport { I18n } from '@coze-arch/i18n';\nimport { Toast } from '@coze-arch/coze-design';\n\n/** Process details page parameters */\ninterface SearchParams {\n  workflow_id: string;\n  space_id: string;\n  /** Process version, when multiple people cooperate, there is a version concept, and the corresponding version process can be previewed when set separately */\n  version?: string;\n  /** Whether to restore to the target version, if set, the process draft will be automatically set to the corresponding version */\n  set_version?: string;\n  /** Corresponding version of the operation type */\n  opt_type?: string;\n  /** Process page open source */\n  from?: WorkflowPlaygroundProps['from'];\n  /** The node id configuration will automatically locate to the corresponding node. */\n  node_id?: string;\n  /** The execution id configuration will display the corresponding execution result. */\n  execute_id?: string;\n  /** subprocess execution id */\n  sub_execute_id?: string;\n}\n\nexport function usePageParams() {\n  const searchParams = useMemo(() => {\n    const target: SearchParams = {\n      workflow_id: '',\n      space_id: '',\n    };\n    const params = new URLSearchParams(window.location.search);\n    params.forEach((value, key) => {\n      target[key] = value;\n    });\n\n    return target;\n  }, []);\n\n  const {\n    space_id: spaceId,\n    workflow_id: workflowId,\n    version,\n    set_version: setVersion,\n    opt_type,\n    from,\n    node_id: nodeId,\n    execute_id: executeId,\n    sub_execute_id: subExecuteId,\n  } = searchParams;\n\n  const optType = opt_type\n    ? (Number(opt_type) as OperateType)\n    : OperateType.SubmitOperate;\n\n  useMount(() => {\n    const newSearchParams = new URLSearchParams(window.location.search);\n    let needUpdateSearch = false;\n    if (from === 'createSuccess') {\n      Toast.success(I18n.t('Create_success'));\n      newSearchParams.delete('from');\n      needUpdateSearch = true;\n    } else if (from === 'dupSuccess') {\n      Toast.success(I18n.t('Duplicate_success'));\n      newSearchParams.delete('from');\n      needUpdateSearch = true;\n    }\n\n    // Force setting of historical version\n    if (setVersion) {\n      newSearchParams.delete('set_version');\n      newSearchParams.delete('version');\n      newSearchParams.delete('opt_type');\n      needUpdateSearch = true;\n    }\n\n    if (needUpdateSearch) {\n      history.replaceState(\n        {},\n        '',\n        `${location.origin + location.pathname}?${newSearchParams.toString()}`,\n      );\n    }\n  });\n\n  return {\n    spaceId,\n    workflowId,\n    version,\n    setVersion: Boolean(searchParams.set_version),\n    optType,\n    from,\n    nodeId,\n    executeId,\n    subExecuteId,\n  };\n}\n"],"names":["hasHistory","_window_document","Boolean","window","MAX_HISTORY_COUNT","useNavigateBack","pageJumpResponse","usePageJumpResponse","PageType","jump","usePageJumpService","navigate","useNavigate","memoPageJumpResponse","useMemo","navigateBack","workflowState","scene","reporter","spaceId","info","workflowId","flowMode","plugin_id","CustomError","_workflowRes_data_workflow","pluginID","workflowApi","SceneType","botID","agentID","workflowOpenMode","botID1","agentID1","workflowOpenMode1","workflowModalState","EmptySidebar","React","_props","_addNodeRef","WorkflowPage","workflowPlaygroundRef","useRef","version","setVersion","from","optType","nodeId","executeId","subExecuteId","usePageParams","searchParams","target","params","URLSearchParams","value","key","opt_type","Number","OperateType","useMount","newSearchParams","needUpdateSearch","Toast","I18n","history","location","initOnce","setInitOnce","useState","WorkflowPlayground","undefined","_workflowState","_workflowPlaygroundRef_current","_workflowPlaygroundRef_current1","_workflowPlaygroundRef_current2"],"mappings":"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"}