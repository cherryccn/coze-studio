/*
 * Copyright 2025 coze-dev Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";(self.webpackChunk_coze_studio_app=self.webpackChunk_coze_studio_app||[]).push([["2370"],{364331:function(e,o,r){r.r(o),r.d(o,{WorkflowPage:()=>m});var t=r("151064");r("327212");var a=r("455069"),n=r("985467"),i=r("550540"),c=r("408487"),s=r("336205"),l=r("674343"),_=r("825955"),u=r("157728"),d=r("297158"),w=r("30961"),f=r("727914"),v=()=>{var e;return!!(window.history.length>2&&(null===(e=window.document)||void 0===e?void 0:e.referrer))},p=()=>{var e,o=(0,w.fR)(w.GV.WORKFLOW),{jump:r}=(0,w.oB)(),t=(0,u.useNavigate)(),n=(0,a.useMemo)(()=>o,[]);return{navigateBack:(e=(0,_._)(function*(e,o){d.E7.event({namespace:"workflow",eventName:"workflow_navigate_back"});var{spaceId:a,info:i,workflowId:s,flowMode:l}=e,{plugin_id:_}=i;if(!a||!s){d.E7.errorEvent({namespace:"workflow",eventName:"workflow_navigate_back_failed",error:new f.sH("navigate_back_failed","no spaceId or workflowId")});return}if(null==n?void 0:n.scene){if("publish"===o){var u,p,k=_;if(!k||"0"===k){;k=(null===(p=(yield c.OHc.GetCanvasInfo({workflow_id:s,space_id:a},{__disableErrorToast:!0})).data)||void 0===p?void 0:null===(u=p.workflow)||void 0===u?void 0:u.plugin_id)||"0"}if(n.scene===w.cJ.BOT__VIEW__WORKFLOW&&n.botID){var{botID:m,agentID:b,workflowOpenMode:I}=n;d.E7.event({namespace:"workflow",eventName:"workflow_navigate_back_to_bot"}),r(w.cJ.WORKFLOW_PUBLISHED__BACK__BOT,{spaceID:a,botID:m,workflowID:s,pluginID:k,agentID:b,workflowOpenMode:I,flowMode:l});return}}if("exit"===o&&n.scene===w.cJ.BOT__VIEW__WORKFLOW&&n.botID){var{botID:h,agentID:O,workflowOpenMode:g,workflowModalState:W}=n;r(w.cJ.WORKFLOW__BACK__BOT,{spaceID:a,botID:h,workflowModalState:W,agentID:O,workflowOpenMode:g,flowMode:l});return}}v()?(d.E7.event({namespace:"workflow",eventName:"workflow_navigate_back_to_history"}),t(-1)):(d.E7.event({namespace:"workflow",eventName:"workflow_navigate_back_to_list"}),t("/space/".concat(a,"/library")))}),function(o,r){return e.apply(this,arguments)})}},k=a.forwardRef((e,o)=>null);function m(){var e=(0,a.useRef)(null),{spaceId:o,workflowId:r,version:_,setVersion:u,from:d,optType:w,nodeId:f,executeId:v,subExecuteId:m}=function(){var e=(0,a.useMemo)(()=>{var e={workflow_id:"",space_id:""};return new URLSearchParams(window.location.search).forEach((o,r)=>{e[r]=o}),e},[]),{space_id:o,workflow_id:r,version:t,set_version:n,opt_type:_,from:u,node_id:d,execute_id:w,sub_execute_id:f}=e,v=_?Number(_):c.lcl.SubmitOperate;return(0,i.Z)(()=>{var e=new URLSearchParams(window.location.search),o=!1;"createSuccess"===u?(l.FN.success(s.o.t("Create_success")),e.delete("from"),o=!0):"dupSuccess"===u&&(l.FN.success(s.o.t("Duplicate_success")),e.delete("from"),o=!0),n&&(e.delete("set_version"),e.delete("version"),e.delete("opt_type"),o=!0),o&&history.replaceState({},"","".concat(location.origin+location.pathname,"?").concat(e.toString()))}),{spaceId:o,workflowId:r,version:t,setVersion:!!e.set_version,optType:v,from:u,nodeId:d,executeId:w,subExecuteId:f}}(),[b,I]=(0,a.useState)(!1),{navigateBack:h}=p();return r&&o?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(n.L,{ref:e,sidebar:k,workflowId:r,spaceId:o,commitId:u?void 0:_,commitOptType:u?void 0:w,readonly:"explore"===d,executeId:v,subExecuteId:m,onInit:o=>{var r,t,a;u&&_&&(null===(r=e.current)||void 0===r||r.resetToHistory({commitId:_,optType:w})),!b&&(f&&(null===(t=e.current)||void 0===t||t.scrollToNode(f)),v&&(null===(a=e.current)||void 0===a||a.showTestRunResult(v,m)),I(!0))},from:d,onBackClick:e=>{h(e,"exit")},onPublish:e=>{h(e,"publish")}})}):null}}}]);
//# sourceMappingURL=2370.d6a353cd.js.map