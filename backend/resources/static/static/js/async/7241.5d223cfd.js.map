{"version":3,"file":"static/js/async/7241.5d223cfd.js","sources":["webpack://@coze-studio/app/../../packages/project-ide/biz-workflow/src/hooks/use-refresh.ts","webpack://@coze-studio/app/../../packages/project-ide/biz-workflow/src/hooks/use-project-api.ts","webpack://@coze-studio/app/../../packages/project-ide/biz-workflow/src/hooks/use-listen-message-event.ts","webpack://@coze-studio/app/../../packages/project-ide/biz-workflow/src/main.tsx"],"sourcesContent":["/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, type RefObject } from 'react';\n\nimport { type WorkflowPlaygroundRef } from '@coze-workflow/playground';\nimport {\n  useIDEParams,\n  useIDENavigate,\n  useCurrentWidget,\n  getURLByURI,\n  type ProjectIDEWidget,\n} from '@coze-project-ide/framework';\n\nexport const useRefresh = (ref: RefObject<WorkflowPlaygroundRef>) => {\n  const widget = useCurrentWidget<ProjectIDEWidget>();\n  const params = useIDEParams();\n  const navigate = useIDENavigate();\n\n  useEffect(() => {\n    if (params.refresh) {\n      ref.current?.reload();\n      navigate(getURLByURI(widget.uri!.removeQueryObject('refresh')), {\n        replace: true,\n      });\n    }\n  }, [params.refresh, ref, widget, navigate]);\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemoizedFn } from 'ahooks';\nimport { type ProjectApi } from '@coze-workflow/playground';\nimport {\n  useSendMessageEvent,\n  useIDENavigate,\n  useCurrentWidgetContext,\n  useIDEGlobalContext,\n} from '@coze-project-ide/framework';\n\n/**\n * The ability to inject project APIs into workflow.\n * Note: non-responsive\n */\nexport const useProjectApi = () => {\n  const { sendOpen } = useSendMessageEvent();\n  const { widget: uiWidget } = useCurrentWidgetContext();\n  const navigate = useIDENavigate();\n  const ideGlobalContext = useIDEGlobalContext();\n\n  const getProjectAPI = useMemoizedFn(() => {\n    const api: ProjectApi = {\n      navigate,\n      ideGlobalStore: ideGlobalContext,\n      setWidgetUIState: (status: string) => uiWidget.setUIState(status as any),\n      sendMsgOpenWidget: sendOpen,\n    };\n    return api;\n  });\n\n  return getProjectAPI;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type RefObject } from 'react';\n\nimport { useMemoizedFn } from 'ahooks';\nimport { type WorkflowPlaygroundRef } from '@coze-workflow/playground';\nimport {\n  useListenMessageEvent,\n  type URI,\n  type MessageEvent,\n} from '@coze-project-ide/framework';\n\nexport const useListenWFMessageEvent = (\n  uri: URI,\n  ref: RefObject<WorkflowPlaygroundRef>,\n) => {\n  const listener = useMemoizedFn((e: MessageEvent) => {\n    if (e.name === 'process' && e.data?.executeId && ref.current) {\n      ref.current.getProcess({ executeId: e.data.executeId });\n    } else if (e.name === 'debug' && ref.current) {\n      const { nodeId, executeId, subExecuteId } = e?.data || {};\n      if (nodeId) {\n        setTimeout(() => {\n          ref.current?.scrollToNode(nodeId);\n        }, 1000);\n      }\n      if (executeId) {\n        ref.current.showTestRunResult(executeId, subExecuteId);\n      }\n    }\n  });\n\n  useListenMessageEvent(uri, listener);\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback, useEffect, useMemo, useRef } from 'react';\n\nimport {\n  WorkflowPlayground,\n  type WorkflowGlobalStateEntity,\n  type WorkflowPlaygroundRef,\n} from '@coze-workflow/playground';\nimport type { WsMessageProps } from '@coze-project-ide/framework/src/types';\nimport {\n  useSpaceId,\n  useProjectId,\n  useCommitVersion,\n  useCurrentWidgetContext,\n  useCurrentWidget,\n  type ProjectIDEWidget,\n  useWsListener,\n} from '@coze-project-ide/framework';\nimport {\n  CustomResourceFolderShortcutService,\n  usePrimarySidebarStore,\n} from '@coze-project-ide/biz-components';\nimport { useFlags } from '@coze-arch/bot-flags';\n\nimport { useRefresh } from './hooks/use-refresh';\nimport { useProjectApi, useListenWFMessageEvent } from './hooks';\n\nconst Main = () => {\n  const workflowRef = useRef<WorkflowPlaygroundRef>(null);\n  const spaceId = useSpaceId();\n  const projectId = useProjectId();\n  const { version: commitVersion } = useCommitVersion();\n  const [FLAGS] = useFlags();\n\n  const refetchProjectResourceList = usePrimarySidebarStore(\n    state => state.refetch,\n  );\n  const { uri, widget: uiWidget } = useCurrentWidgetContext();\n  const widget = useCurrentWidget<ProjectIDEWidget>();\n\n  const workflowId = useMemo(() => uri?.displayName, [uri]);\n\n  const getProjectApi = useProjectApi();\n\n  const handleInit = useCallback(\n    (workflowState: WorkflowGlobalStateEntity) => {\n      const name = workflowState.info?.name;\n      if (name) {\n        uiWidget.setTitle(name);\n        uiWidget.setUIState('normal');\n      }\n      uiWidget.setIconType(String(workflowState.flowMode));\n    },\n    [uiWidget],\n  );\n\n  const handleReload = () => {\n    widget.refresh();\n    widget.context.widget.setUIState('loading');\n  };\n\n  useWsListener((props: WsMessageProps) => {\n    if (!FLAGS['bot.automation.project_multi_tab']) {\n      return;\n    }\n    workflowRef.current?.onResourceChange(props, handleReload);\n  });\n\n  useEffect(() => {\n    const disposable = uiWidget.onFocus(() => {\n      workflowRef.current?.triggerFitView();\n      workflowRef.current?.loadGlobalVariables();\n    });\n    return () => {\n      disposable?.dispose?.();\n    };\n  }, []);\n\n  useRefresh(workflowRef);\n  useListenWFMessageEvent(uri!, workflowRef);\n\n  if (!spaceId || !workflowId) {\n    return null;\n  }\n\n  return (\n    <WorkflowPlayground\n      ref={workflowRef}\n      spaceId={spaceId}\n      workflowId={workflowId}\n      projectCommitVersion={commitVersion}\n      renderHeader={() => null}\n      onInit={handleInit}\n      projectId={projectId}\n      getProjectApi={getProjectApi}\n      // parentContainer={widget.container}\n      className=\"project-ide-workflow-playground\"\n      refetchProjectResourceList={refetchProjectResourceList}\n      renameProjectResource={(resourceId: string) => {\n        const shortcutService = widget.container.get(\n          CustomResourceFolderShortcutService,\n        );\n        shortcutService.renameResource(resourceId);\n      }}\n    />\n  );\n};\n\nexport default Main;\n"],"names":["useRefresh","ref","widget","useCurrentWidget","params","useIDEParams","navigate","useIDENavigate","useEffect","_ref_current","getURLByURI","useProjectApi","sendOpen","useSendMessageEvent","uiWidget","useCurrentWidgetContext","ideGlobalContext","useIDEGlobalContext","useMemoizedFn","status","useListenWFMessageEvent","uri","listener","e","_e_data","nodeId","executeId","subExecuteId","setTimeout","useListenMessageEvent","workflowRef","useRef","spaceId","useSpaceId","projectId","useProjectId","commitVersion","useCommitVersion","FLAGS","useFlags","refetchProjectResourceList","usePrimarySidebarStore","state","workflowId","useMemo","getProjectApi","handleInit","useCallback","workflowState","_workflowState_info","name","String","handleReload","useWsListener","props","_workflowRef_current","disposable","_workflowRef_current1","WorkflowPlayground","resourceId","shortcutService","CustomResourceFolderShortcutService"],"mappings":"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"}