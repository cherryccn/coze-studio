{"version":3,"file":"static/js/async/4108.e1c8d227.js","sources":["webpack://@coze-studio/app/../../packages/common/chat-area/plugin-resume/src/hooks/use-get-position.tsx","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-resume/src/custom-components/interrupt-message/interrupt-message-content/index.module.less?a047","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-resume/src/custom-components/interrupt-message/interrupt-message-content/index.tsx","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-resume/src/custom-components/interrupt-message/index.module.less?a25e","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-resume/src/custom-components/interrupt-message/index.tsx","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-resume/src/life-cycle-service/render-life-cycle-service.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-resume/src/life-cycle-service/message-life-cycle-service.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-resume/src/plugin.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-resume/src/index.tsx","webpack://@coze-studio/app/../../packages/agent-ide/chat-area-provider/src/provider/index.tsx","webpack://@coze-studio/app/../../packages/agent-ide/chat-area-provider/src/hooks/use-bot-editor-chat-background.ts","webpack://@coze-studio/app/../../packages/agent-ide/chat-area-plugin-debug-common/src/services/life-cycle/render.ts","webpack://@coze-studio/app/../../packages/agent-ide/chat-area-plugin-debug-common/src/utils/index.ts","webpack://@coze-studio/app/../../packages/agent-ide/chat-area-plugin-debug-common/src/services/life-cycle/message.ts","webpack://@coze-studio/app/../../packages/agent-ide/chat-area-plugin-debug-common/src/services/life-cycle/command.ts","webpack://@coze-studio/app/../../packages/agent-ide/chat-area-plugin-debug-common/src/services/life-cycle/app.ts","webpack://@coze-studio/app/../../packages/agent-ide/chat-area-plugin-debug-common/src/services/life-cycle/index.ts","webpack://@coze-studio/app/../../packages/agent-ide/chat-area-plugin-debug-common/src/plugin.ts","webpack://@coze-studio/app/../../packages/agent-ide/chat-area-plugin-debug-common/src/index.ts","webpack://@coze-studio/app/../../packages/agent-ide/chat-area-provider-adapter/src/provider/index.tsx","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/index.module.less?c913","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/layout.tsx","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/components/header/bot-status/style.module.less?bd68","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/components/header/bot-status/origin-status.tsx","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/components/header/bot-publish-status/index.tsx","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/components/header/bot-info-card/index.tsx","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/components/header/index.module.less?ae97","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/components/header/index.tsx","webpack://@coze-studio/app/../../../common/temp/default/node_modules/.pnpm/@douyinfe+semi-icons@2.81.0_react@18.2.0/node_modules/@douyinfe/semi-icons/lib/es/icons/IconLink.js","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/components/header/more-menu-button/index.module.less?3202","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/components/header/more-menu-button/link-drop-item.tsx","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/components/header/more-menu-button/index.tsx","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/components/header/deploy-button/hooks/service.tsx","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/components/header/deploy-button/index.tsx","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/index.tsx","webpack://@coze-studio/app/../../packages/agent-ide/layout-adapter/src/hooks/use-init-agent.tsx","webpack://@coze-studio/app/../../packages/agent-ide/layout-adapter/src/header/mode-list.tsx","webpack://@coze-studio/app/../../packages/agent-ide/layout-adapter/src/header/index.tsx","webpack://@coze-studio/app/../../packages/agent-ide/layout-adapter/src/layout/base.tsx","webpack://@coze-studio/app/../../packages/arch/idl/src/auto-generated/debugger_api/namespaces/infra.ts","webpack://@coze-studio/app/../../packages/common/chat-area/chat-area-plugin-reasoning/src/services/life-cycle/render.ts","webpack://@coze-studio/app/../../packages/common/chat-area/chat-area-plugin-reasoning/src/services/life-cycle/message.ts","webpack://@coze-studio/app/../../packages/common/chat-area/chat-area-plugin-reasoning/src/services/life-cycle/command.ts","webpack://@coze-studio/app/../../packages/common/chat-area/chat-area-plugin-reasoning/src/services/life-cycle/app.ts","webpack://@coze-studio/app/../../packages/common/chat-area/chat-area-plugin-reasoning/src/services/life-cycle/index.ts","webpack://@coze-studio/app/../../packages/common/chat-area/chat-area-plugin-reasoning/src/custom-components/message-inner-addon-bottom/index.tsx","webpack://@coze-studio/app/../../packages/common/chat-area/chat-area-plugin-reasoning/src/plugin.ts","webpack://@coze-studio/app/../../packages/common/chat-area/chat-area-plugin-reasoning/src/index.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-chat-background/src/types/biz-context.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-chat-background/src/store.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-chat-background/src/services/life-cycle/app.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-chat-background/src/custom-components/chat-background-ui/index.module.less?d9f3","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-chat-background/src/custom-components/chat-background-ui/index.tsx","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-chat-background/src/plugin.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-chat-background/src/index.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/types/plugin-biz-context.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/stores/selection.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/stores/quote.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/stores/preference.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/services/life-cycle/message.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/services/life-cycle/command.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/services/life-cycle/app.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/utils/get-message.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/custom-components/quote-button/index.tsx","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/custom-components/menu-list/index.module.less?b5be","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/custom-components/menu-list/index.tsx","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/constants/filter-message.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/custom-components/message-list-float-slot/grab-menu.tsx","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/hooks/use-hide-quote.ts","webpack://@coze-studio/app/../../../common/temp/default/node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/delay.js","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/utils/get-mouse-nearby-rect.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/hooks/use-float-menu-listener.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/hooks/use-auto-get-max-position.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/custom-components/message-list-float-slot/float-menu.tsx","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/custom-components/message-list-float-slot/index.tsx","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/custom-components/variants.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/custom-components/quote-node/index.module.less?385e","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/custom-components/quote-node/index.tsx","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/utils/get-refer-from-message.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/custom-components/message-inner-top-slot/quote-top-ui.tsx","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/custom-components/message-inner-top-slot/remote-slot.tsx","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/custom-components/message-inner-top-slot/local-slot.tsx","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/custom-components/message-inner-top-slot/index.tsx","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/custom-components/input-addon-top/index.tsx","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/plugin.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/create.ts","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/hooks/use-grab-plugin.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/types/node.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/types/selection.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/is-touch-device.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/constants/range.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/helper/get-all-nodes-in-range.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/helper/find-ancestor-node-by-tag-name.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/get-ancestor-attribute-value.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/should-refine-range.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/helper/find-last-sibling-node.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/helper/find-last-child-node.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/helper/compare-node-position.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/refine-range/fix-start-node.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/helper/find-nearest-link-node.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/refine-range/fix-link.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/refine-range/fix-end-node.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/helper/get-all-child-nodes-in-node.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/helper/find-not-contains-previous-sibling.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/refine-range/fix-end-empty.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/refine-range/refine-range.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/normalizer/is-grab-text-node.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/normalizer/is-grab-link.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/normalizer/is-grab-image.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/normalizer/get-origin-content-text.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/get-picture-node-url.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/find-picture-valid-child-node.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/process-node/process-special-node.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/normalizer/get-normalize-node-list.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/normalizer/get-humanize-content-text.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/helper/is-range-collapsed.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/helper/get-selection-direction.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/get-ancestor-attribute-node.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/get-selection-data.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/get-rect-data.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/hooks/use-grab.ts","webpack://@coze-studio/app/../../packages/common/chat-area/text-grab/src/utils/parse-markdown-to-grab-node.ts","webpack://@coze-studio/app/../../packages/studio/publish-manage-hooks/src/hooks/use-is-publish-record-ready.ts","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/components/header/bot-status/style.module.less","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/components/header/index.module.less","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/components/header/more-menu-button/index.module.less","webpack://@coze-studio/app/../../packages/agent-ide/layout/src/index.module.less","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-chat-background/src/custom-components/chat-background-ui/index.module.less","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/custom-components/menu-list/index.module.less","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-message-grab/src/custom-components/quote-node/index.module.less","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-resume/src/custom-components/interrupt-message/index.module.less","webpack://@coze-studio/app/../../packages/common/chat-area/plugin-resume/src/custom-components/interrupt-message/interrupt-message-content/index.module.less","webpack://@coze-studio/app/../../../common/temp/default/node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_baseDelay.js","webpack://@coze-studio/app/../../../common/temp/default/node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/defer.js"],"sourcesContent":["/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Toast } from '@coze-arch/coze-design';\n\ninterface GetPositionProps {\n  getPositionSuccess: (position: GeolocationPosition) => void;\n}\n\nexport const useGetPosition = ({ getPositionSuccess }: GetPositionProps) => {\n  // Position authorization button loading state\n  const [loading, setLoading] = useState(false);\n\n  const getSysPosition = () => {\n    setLoading(true);\n    /** Acquire system location information */\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(\n        position => {\n          setLoading(false);\n\n          getPositionSuccess?.(position);\n        },\n        error => {\n          setLoading(false);\n          switch (error.code) {\n            case error.PERMISSION_DENIED:\n              Toast.error(\n                I18n.t('bot_ide_user_declines_geolocation_auth_toast'),\n              );\n              break;\n            case error.POSITION_UNAVAILABLE:\n              Toast.error(I18n.t('bot_ide_geolocation_not_usable_toast'));\n              break;\n            case error.TIMEOUT:\n              Toast.error(I18n.t('bot_ide_geolocation_request_timeout_toast'));\n              break;\n            default:\n              Toast.error(\n                I18n.t('bot_ide_geolocation_request_unknown_error_toast'),\n              );\n              break;\n          }\n        },\n      );\n    } else {\n      setLoading(false);\n      Toast.error(I18n.t('bot_ide_browser_not_support_geolocation_toast'));\n    }\n  };\n\n  return {\n    loading,\n    getSysPosition,\n  };\n};\n","\n      import API from \"!../../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./index.module.less\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./index.module.less\";\n       export default content && content.locals ? content.locals : undefined;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport classNames from 'classnames';\nimport {\n  PluginName,\n  useWriteablePlugin,\n  type Message,\n} from '@coze-common/chat-area';\nimport { I18n } from '@coze-arch/i18n';\nimport { Button } from '@coze-arch/coze-design';\nimport { Space } from '@coze-arch/bot-semi';\n\nimport { useGetPosition } from '../../../hooks/use-get-position';\n\nimport styles from './index.module.less';\n\nexport const InterruptMessageContent: React.FC<{\n  interruptMessage: Message;\n  actionText?: string;\n  setActionText: (actionText: string) => void;\n}> = ({ interruptMessage, actionText, setActionText }) => {\n  const plugin = useWriteablePlugin<unknown>(PluginName.Resume);\n\n  const { sendResumeMessage, stopResponding } =\n    plugin.chatAreaPluginContext?.writeableAPI.message ?? {};\n\n  // Get interrupt scene, continue chat id\n  const toolCall =\n    interruptMessage.required_action?.submit_tool_outputs?.tool_calls?.[0];\n\n  const { loading, getSysPosition: handleAllowOnce } = useGetPosition({\n    getPositionSuccess: position => {\n      setActionText(\n        I18n.t('chat_geolocation_auth_allow_tip', {\n          plugin: toolCall?.require_info?.name ?? 'plugin',\n        }),\n      );\n      sendResumeMessage?.({\n        replyId: interruptMessage.reply_id,\n        options: {\n          extendFiled: {\n            interrupt_message_id: interruptMessage.message_id,\n            resume_message_id: interruptMessage.reply_id,\n            tool_outputs: [\n              {\n                tool_call_id: toolCall?.id,\n                output: JSON.stringify({\n                  coordinates: {\n                    longitude: String(position.coords.longitude),\n                    latitude: String(position.coords.latitude),\n                  },\n                }),\n              },\n            ],\n          },\n        },\n      });\n    },\n  });\n\n  const handleReject = () => {\n    setActionText(\n      I18n.t('chat_geolocation_auth_decline_tip', {\n        plugin: toolCall?.require_info?.name ?? 'plugin',\n      }),\n    );\n    stopResponding?.();\n  };\n\n  return (\n    <div className={classNames(styles['interrupt-message-box'])}>\n      {actionText ? (\n        <div className={classNames(styles['interrupt-message-action'])}>\n          {actionText}\n        </div>\n      ) : (\n        <div className={classNames(styles['interrupt-message-content'])}>\n          {toolCall?.require_info?.require_fields?.includes('coordinates') ? (\n            <>\n              {I18n.t('chat_geolocation_auth_request_message', {\n                plugin_name: toolCall?.require_info?.name ?? 'plugin',\n              })}\n              <Space\n                className={classNames(styles['interrupt-message-content-btns'])}\n              >\n                <Button\n                  color=\"highlight\"\n                  size=\"small\"\n                  loading={loading}\n                  onClick={handleAllowOnce}\n                >\n                  {I18n.t('chat_geolocation_auth_request_message_allow_button')}\n                </Button>\n                <Button\n                  color=\"primary\"\n                  size=\"small\"\n                  disabled={loading}\n                  onClick={handleReject}\n                >\n                  {I18n.t(\n                    'chat_geolocation_auth_request_message_decline_button',\n                  )}\n                </Button>\n              </Space>\n            </>\n          ) : null}\n        </div>\n      )}\n    </div>\n  );\n};\n\nInterruptMessageContent.displayName = 'ChatAreaFunctionCallMessageContent';\n","\n      import API from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./index.module.less\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./index.module.less\";\n       export default content && content.locals ? content.locals : undefined;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport classNames from 'classnames';\nimport { MessageBox as UIKitMessageBox } from '@coze-common/chat-uikit';\nimport { type CustomComponent } from '@coze-common/chat-area';\n\nimport { InterruptMessageContent } from './interrupt-message-content';\n\nimport styles from './index.module.less';\n\nexport const InterruptMessageBox: CustomComponent['MessageBox'] = props => {\n  // Copywriting after user operation, front-end maintenance temporary state, refresh and disappear\n  const [actionText, setActionText] = useState('');\n\n  const { message, meta } = props;\n\n  // Do not show logic: chat history, no action and not in the last group\n  if (message._fromHistory || (!actionText && !meta.isFromLatestGroup)) {\n    return null;\n  }\n\n  return (\n    <div className={classNames(styles['interrupt-message-box'])}>\n      <UIKitMessageBox\n        {...props}\n        messageId={message.message_id}\n        senderInfo={{ id: '' }}\n        showUserInfo={false}\n        theme={actionText ? 'none' : 'border'}\n      >\n        <InterruptMessageContent\n          interruptMessage={message}\n          actionText={actionText}\n          setActionText={setActionText}\n        />\n      </UIKitMessageBox>\n    </div>\n  );\n};\n\nInterruptMessageBox.displayName = 'ChatAreaFunctionCallMessageBox';\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  isRequireInfoInterruptMessage,\n  type OnMessageBoxRenderContext,\n  WriteableRenderLifeCycleService,\n} from '@coze-common/chat-area';\n\nimport { InterruptMessageBox } from '../custom-components/interrupt-message';\n\nexport class ResumeRenderLifeCycleService extends WriteableRenderLifeCycleService<unknown> {\n  onMessageBoxRender(ctx: OnMessageBoxRenderContext) {\n    const { message } = ctx;\n\n    if (isRequireInfoInterruptMessage(message)) {\n      return {\n        ...ctx,\n        MessageBox: InterruptMessageBox,\n      };\n    }\n\n    return ctx;\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  isRequireInfoInterruptMessage,\n  WriteableMessageLifeCycleService,\n  type OnBeforeDistributeMessageIntoMemberSetContent,\n} from '@coze-common/chat-area';\n\nexport class ResumeMessageLifeCycleService extends WriteableMessageLifeCycleService<unknown> {\n  onBeforeDistributeMessageIntoMemberSet(\n    ctx: OnBeforeDistributeMessageIntoMemberSetContent,\n  ): OnBeforeDistributeMessageIntoMemberSetContent {\n    const { message } = ctx;\n\n    if (isRequireInfoInterruptMessage(message)) {\n      return { ...ctx, memberSetType: 'llm' };\n    }\n\n    return ctx;\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  PluginMode,\n  PluginName,\n  WriteableChatAreaPlugin,\n} from '@coze-common/chat-area';\n\nimport { ResumeRenderLifeCycleService } from './life-cycle-service/render-life-cycle-service';\nimport { ResumeMessageLifeCycleService } from './life-cycle-service/message-life-cycle-service';\n\nexport class ResumePlugin extends WriteableChatAreaPlugin<unknown> {\n  public pluginMode: PluginMode = PluginMode.Writeable;\n  public pluginName: PluginName = PluginName.Resume;\n\n  public lifeCycleServices = {\n    messageLifeCycleService: new ResumeMessageLifeCycleService(this),\n    renderLifeCycleService: new ResumeRenderLifeCycleService(this),\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type PluginRegistryEntry } from '@coze-common/chat-area';\n\nimport { ResumePlugin } from './plugin';\n\nexport const ResumePluginRegistry: PluginRegistryEntry<unknown> = {\n  createPluginBizContext() {\n    return;\n  },\n  Plugin: ResumePlugin,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type PropsWithChildren } from 'react';\n\nimport { Scene } from '@coze-common/chat-core';\nimport {\n  type MixInitResponse,\n  ChatAreaProvider,\n  type PluginRegistryEntry,\n} from '@coze-common/chat-area';\nimport { reporter } from '@coze-arch/logger';\n// import { CreateRoomScene } from '@coze-arch/idl';\nimport { useSpaceStore } from '@coze-arch/bot-studio-store';\nimport { useUserSenderInfo, useMessageReportEvent } from '@coze-arch/bot-hooks';\nexport interface BotDebugChatAreaProviderProps {\n  botId: string;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any -- biz context type\n  pluginRegistryList?: PluginRegistryEntry<any>[];\n  onInitRequestSuccess?: (params: { conversationId: string }) => void;\n  requestToInit: () => Promise<MixInitResponse>;\n  showBackground: boolean;\n  grabEnableUpload: boolean;\n}\n\nexport const BotDebugChatAreaProvider: React.FC<\n  PropsWithChildren<BotDebugChatAreaProviderProps>\n> = ({\n  children,\n  botId,\n  pluginRegistryList,\n  requestToInit,\n  showBackground,\n  grabEnableUpload,\n}) => {\n  useMessageReportEvent();\n  const userSenderInfo = useUserSenderInfo();\n\n  return (\n    <ChatAreaProvider\n      spaceId={useSpaceStore.getState().getSpaceId()}\n      botId={botId}\n      scene={Scene.Playground}\n      userInfo={userSenderInfo}\n      requestToInit={requestToInit}\n      reporter={reporter}\n      enableChatActionLock\n      enableChatCoreDebug\n      pluginRegistryList={pluginRegistryList}\n      enableImageAutoSize={true}\n      enablePasteUpload={grabEnableUpload}\n      enableDragUpload={grabEnableUpload}\n      uikitChatInputButtonStatus={{\n        isMoreButtonDisabled: !grabEnableUpload,\n      }}\n      showBackground={showBackground}\n    >\n      {children}\n    </ChatAreaProvider>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\n\nimport { useBotSkillStore } from '@coze-studio/bot-detail-store/bot-skill';\nimport {\n  createChatBackgroundPlugin,\n  chatBackgroundEvent,\n  ChatBackgroundEventName,\n} from '@coze-common/chat-area-plugin-chat-background';\n\n// Handling chat background covers communication with plugins in BotEditor\nexport const useBotEditorChatBackground = () => {\n  const backgroundInfo = useBotSkillStore(\n    state => state.backgroundImageInfoList?.[0],\n  );\n  const { ChatBackgroundPlugin } = createChatBackgroundPlugin();\n\n  useEffect(() => {\n    // Monitor the user to set the background cover and pass the updated background cover information to the plugin\n    chatBackgroundEvent.emit(\n      ChatBackgroundEventName.OnBackgroundChange,\n      backgroundInfo,\n    );\n  }, [backgroundInfo]);\n\n  return {\n    ChatBackgroundPlugin,\n    showBackground: !!backgroundInfo?.mobile_background_image?.origin_image_url,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type WriteableRenderLifeCycleServiceGenerator } from '@coze-common/chat-area';\n\nimport { type PluginBizContext } from '../../types/biz-context';\n\nexport const renderLifeCycleServiceGenerator: WriteableRenderLifeCycleServiceGenerator<\n  PluginBizContext\n> = plugin => ({});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { cloneDeep, merge } from 'lodash-es';\nimport { usePageRuntimeStore } from '@coze-studio/bot-detail-store/page-runtime';\nimport { useMultiAgentStore } from '@coze-studio/bot-detail-store/multi-agent';\nimport {\n  useBotInfoStore,\n  type BotInfoStore,\n} from '@coze-studio/bot-detail-store/bot-info';\nimport { useManuallySwitchAgentStore } from '@coze-studio/bot-detail-store';\nimport {\n  type OnBeforeSendMessageContext,\n  Scene,\n  ContentType,\n  type Message,\n  getBotState,\n  type MessageExtraInfoBotState,\n} from '@coze-common/chat-area';\nimport { messageReportEvent, safeJSONParse } from '@coze-arch/bot-utils';\nimport {\n  EVENT_NAMES,\n  type ParamsTypeDefine,\n  sendTeaEvent,\n} from '@coze-arch/bot-tea';\nimport { useSpaceStore } from '@coze-arch/bot-studio-store';\nimport { BotMode } from '@coze-arch/bot-api/developer_api';\nimport { TrafficScene } from '@coze-arch/bot-api/debugger_api';\n\nexport enum MockTrafficEnabled {\n  DISABLE = 0,\n  ENABLE = 1,\n}\n\nexport function getMockSetReqOptions(baseBotInfo: BotInfoStore) {\n  return {\n    headers: {\n      'rpc-persist-mock-traffic-scene':\n        baseBotInfo.mode === BotMode.MultiMode\n          ? TrafficScene.CozeMultiAgentDebug\n          : TrafficScene.CozeSingleAgentDebug,\n      'rpc-persist-mock-traffic-caller-id': baseBotInfo.botId,\n      'rpc-persist-mock-space-id': baseBotInfo?.space_id,\n      'rpc-persist-mock-traffic-enable': MockTrafficEnabled.ENABLE,\n    },\n  };\n}\n\nexport const sendTeaEventOnBeforeSendMessage = (params: {\n  message: Message<ContentType>;\n  from: string;\n  botId: string;\n}) => {\n  const { message, from, botId } = params;\n  const { isSelf } = usePageRuntimeStore.getState();\n  const teaParam: Omit<\n    ParamsTypeDefine[EVENT_NAMES.click_send_message],\n    'from'\n  > = {\n    is_user_owned: isSelf ? 'true' : 'false',\n    message_id: message.extra_info.local_message_id,\n    bot_id: botId,\n  };\n  // The original logic is only in these three scenes sendTea\n  if (from === 'inputAndSend') {\n    sendTeaEvent(EVENT_NAMES.click_send_message, {\n      from: 'type',\n      ...teaParam,\n    });\n  }\n  if (from === 'regenerate') {\n    sendTeaEvent(EVENT_NAMES.click_send_message, {\n      from: 'regenerate',\n      ...teaParam,\n    });\n  }\n  if (from === 'suggestion') {\n    sendTeaEvent(EVENT_NAMES.click_send_message, {\n      from: 'welcome_message_suggestion',\n      ...teaParam,\n    });\n  }\n};\n\nexport const handleBotStateBeforeSendMessage = (\n  params: OnBeforeSendMessageContext,\n  scene: Scene,\n) => {\n  const { message, options } = params;\n  const { mode } = useBotInfoStore.getState();\n\n  if (scene !== Scene.Playground && mode !== BotMode.MultiMode) {\n    return;\n  }\n\n  const clonedOptions: typeof options = cloneDeep(options ?? {});\n\n  if (scene === Scene.Playground) {\n    merge(clonedOptions, {\n      extendFiled: {\n        space_id: useSpaceStore.getState().getSpaceId(),\n      },\n    });\n  }\n\n  if (mode === BotMode.MultiMode) {\n    updateAgentBeforeSendMessage(params);\n    const botState = getBotStateBeforeSendMessage();\n    merge(clonedOptions, {\n      extendFiled: {\n        extra: { bot_state: JSON.stringify(botState) },\n      },\n    });\n  }\n\n  const baseBotInfo = useBotInfoStore.getState();\n  merge(clonedOptions, getMockSetReqOptions(baseBotInfo));\n\n  return {\n    message,\n    options: clonedOptions,\n  };\n};\n\nexport const isCreateTaskMessage = (message: Message<ContentType>) => {\n  if (\n    typeof message === 'object' &&\n    message.type === 'tool_response' &&\n    message.content_type === ContentType.Text\n  ) {\n    const messageContentObject = safeJSONParse(message.content);\n    if (\n      typeof messageContentObject === 'object' &&\n      messageContentObject.response_for_model === 'Task created successfully'\n    ) {\n      return true;\n    }\n  }\n  return false;\n};\n\nexport const reportReceiveEvent = (message: Message<ContentType>) => {\n  if (message.type === 'follow_up') {\n    messageReportEvent.messageReceiveSuggestsEvent.receiveSuggest();\n    return;\n  }\n  messageReportEvent.receiveMessageEvent.receiveMessage(message);\n  if (message.type === 'answer' && message.is_finish) {\n    messageReportEvent.receiveMessageEvent.finish(message);\n    messageReportEvent.receiveMessageEvent.start();\n  }\n};\n\nexport const updateAgentBeforeSendMessage: (\n  param: OnBeforeSendMessageContext,\n) => void = ({ message, options }) => {\n  if (!(options?.isRegenMessage && message.role === 'user')) {\n    return;\n  }\n\n  const {\n    currentAgentID,\n    updatedCurrentAgentIdWithConnectStart,\n    setMultiAgent,\n  } = useMultiAgentStore.getState();\n\n  const regeneratedMessageBotState = getBotState(message.extra_info.bot_state);\n\n  // When regenerating the message, set the currentAgentId to the agentId corresponding to the userMessage.\n  const fixedAgentId =\n    currentAgentID === useManuallySwitchAgentStore.getState().agentId\n      ? currentAgentID\n      : regeneratedMessageBotState?.agent_id;\n\n  if (fixedAgentId) {\n    setMultiAgent({ currentAgentID: fixedAgentId });\n  } else {\n    updatedCurrentAgentIdWithConnectStart();\n  }\n};\n\nexport const getBotStateBeforeSendMessage: () => MessageExtraInfoBotState =\n  () => {\n    const { botId } = useBotInfoStore.getState();\n    const { currentAgentID } = useMultiAgentStore.getState();\n    const botState: MessageExtraInfoBotState = {\n      agent_id: currentAgentID,\n      bot_id: botId,\n    };\n    return botState;\n  };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMultiAgentStore } from '@coze-studio/bot-detail-store/multi-agent';\nimport { useManuallySwitchAgentStore } from '@coze-studio/bot-detail-store';\nimport {\n  CODE_JINJA_FORMAT_ERROR,\n  type WriteableMessageLifeCycleServiceGenerator,\n  parseErrorInfoFromErrorMessage,\n  ChatBusinessErrorCode,\n  getBotState,\n} from '@coze-common/chat-area';\nimport { I18n } from '@coze-arch/i18n';\nimport { Toast } from '@coze-arch/coze-design';\nimport { messageReportEvent } from '@coze-arch/bot-utils';\nimport { CustomError } from '@coze-arch/bot-error';\n\nimport {\n  handleBotStateBeforeSendMessage,\n  isCreateTaskMessage,\n  reportReceiveEvent,\n  sendTeaEventOnBeforeSendMessage,\n} from '../../utils';\nimport { type PluginBizContext } from '../../types/biz-context';\n\nexport const messageLifeCycleServiceGenerator: WriteableMessageLifeCycleServiceGenerator<\n  PluginBizContext\n> = plugin => ({\n  onMessagePullingSuccess() {\n    messageReportEvent.messageReceiveSuggestsEvent.success();\n  },\n  onSendMessageError(ctx) {\n    const { error: inputError } = ctx;\n    if (\n      (inputError as { ext?: { code?: number } }).ext?.code ===\n      CODE_JINJA_FORMAT_ERROR\n    ) {\n      Toast.warning(I18n.t('jinja_invalid'));\n    }\n\n    const error =\n      inputError instanceof Error\n        ? inputError\n        : new CustomError('normal_error', 'unknow');\n    const reason = error.message;\n    messageReportEvent.executeDraftBotEvent.error({ error, reason });\n  },\n  onAfterSendMessage() {\n    messageReportEvent.executeDraftBotEvent.success();\n    messageReportEvent.receiveMessageEvent.start();\n  },\n  onBeforeSendMessage(ctx) {\n    const { botId, scene } = plugin.pluginBizContext;\n    messageReportEvent.executeDraftBotEvent.start();\n    sendTeaEventOnBeforeSendMessage({\n      message: ctx.message,\n      from: ctx.from,\n      botId,\n    });\n\n    const result = handleBotStateBeforeSendMessage(ctx, scene);\n\n    return {\n      ...ctx,\n      ...result,\n    };\n  },\n  onBeforeProcessReceiveMessage(ctx) {\n    const { message } = ctx;\n\n    const { pluginBizContext } = plugin;\n    const {\n      methods: { refreshTaskList },\n    } = pluginBizContext;\n\n    reportReceiveEvent(message);\n\n    // If it is a message to create a scheduled task, you need to refresh the task list.\n    if (isCreateTaskMessage(message)) {\n      refreshTaskList();\n    }\n\n    const botState = getBotState(message.extra_info.bot_state);\n    const agentId = botState?.agent_id;\n    if (agentId) {\n      useManuallySwitchAgentStore.getState().clearAgentId();\n      useMultiAgentStore.getState().setMultiAgent({ currentAgentID: agentId });\n    }\n\n    return ctx;\n  },\n  onMessagePullingError(ctx) {\n    const errorInfo = parseErrorInfoFromErrorMessage(ctx.error?.message);\n    if (!errorInfo) {\n      return;\n    }\n    if (errorInfo.code === ChatBusinessErrorCode.SuggestError) {\n      messageReportEvent.messageReceiveSuggestsEvent.error({\n        error: ctx.error,\n        reason: errorInfo.msg,\n      });\n      return;\n    }\n    messageReportEvent.receiveMessageEvent.error();\n  },\n});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMultiAgentStore } from '@coze-studio/bot-detail-store/multi-agent';\nimport { useBotInfoStore } from '@coze-studio/bot-detail-store/bot-info';\nimport {\n  getBotState,\n  type WriteableCommandLifeCycleServiceGenerator,\n} from '@coze-common/chat-area';\nimport {\n  BotMode,\n  MultiAgentSessionType,\n} from '@coze-arch/bot-api/developer_api';\n\nimport { type PluginBizContext } from '../../types/biz-context';\n\nexport const commandLifeCycleServiceGenerator: WriteableCommandLifeCycleServiceGenerator<\n  PluginBizContext\n> = _ => ({\n  onAfterClearHistory() {\n    const {\n      chatModeConfig,\n      updatedCurrentAgentIdWithConnectStart,\n      resetHostAgent,\n    } = useMultiAgentStore.getState();\n    const { mode } = useBotInfoStore.getState();\n    if (mode === BotMode.MultiMode) {\n      updatedCurrentAgentIdWithConnectStart();\n      if (chatModeConfig.type === MultiAgentSessionType.Host) {\n        resetHostAgent();\n      }\n    }\n  },\n  onAfterStopResponding(ctx) {\n    const { brokenFlattenMessageGroup: brokenMessages } = ctx;\n    const { mode } = useBotInfoStore.getState();\n    const { chatModeConfig, setMultiAgent } = useMultiAgentStore.getState();\n\n    if (\n      mode !== BotMode.MultiMode ||\n      chatModeConfig.type !== MultiAgentSessionType.Host\n    ) {\n      return;\n    }\n\n    const hostAgentId = chatModeConfig.currentHostId;\n    const targetMessage = brokenMessages\n      ?.filter(msg => msg.role === 'assistant' && msg.type === 'answer')\n      .at(-1);\n    if (!targetMessage) {\n      setMultiAgent({ currentAgentID: hostAgentId });\n      return;\n    }\n\n    const parsedBotState = getBotState(targetMessage.extra_info.bot_state);\n    if (!parsedBotState?.awaiting) {\n      setMultiAgent({ currentAgentID: hostAgentId });\n      return;\n    }\n\n    setMultiAgent({ currentAgentID: parsedBotState.awaiting });\n  },\n});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type WriteableAppLifeCycleServiceGenerator } from '@coze-common/chat-area';\n\nimport { type PluginBizContext } from '../../types/biz-context';\n\nexport const appLifeCycleServiceGenerator: WriteableAppLifeCycleServiceGenerator<\n  PluginBizContext\n> = plugin => ({});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type WriteableLifeCycleServiceGenerator } from '@coze-common/chat-area';\n\nimport { type PluginBizContext } from '../../types/biz-context';\nimport { renderLifeCycleServiceGenerator } from './render';\nimport { messageLifeCycleServiceGenerator } from './message';\nimport { commandLifeCycleServiceGenerator } from './command';\nimport { appLifeCycleServiceGenerator } from './app';\n\nexport const bizLifeCycleServiceGenerator: WriteableLifeCycleServiceGenerator<\n  PluginBizContext\n> = plugin => ({\n  appLifeCycleService: appLifeCycleServiceGenerator(plugin),\n  messageLifeCycleService: messageLifeCycleServiceGenerator(plugin),\n  commandLifeCycleService: commandLifeCycleServiceGenerator(plugin),\n  renderLifeCycleService: renderLifeCycleServiceGenerator(plugin),\n});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  PluginMode,\n  PluginName,\n  WriteableChatAreaPlugin,\n  createWriteableLifeCycleServices,\n} from '@coze-common/chat-area';\n\nimport { type PluginBizContext } from './types/biz-context';\nimport { bizLifeCycleServiceGenerator } from './services/life-cycle';\n\nexport class BizPlugin extends WriteableChatAreaPlugin<PluginBizContext> {\n  /**\n   * plugin type\n   * PluginMode. Readonly = read-only mode\n   * PluginMode. Writeable = Writable Mode\n   */\n  public pluginMode = PluginMode.Writeable;\n  /**\n   * plugin name\n   * Please click PluginName to define it.\n   */\n  public pluginName = PluginName.DebugCommon;\n\n  /**\n   * lifecycle services\n   */\n  public lifeCycleServices = createWriteableLifeCycleServices(\n    this,\n    bizLifeCycleServiceGenerator,\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type PluginRegistryEntry } from '@coze-common/chat-area';\n\nimport { type PluginBizContext } from './types/biz-context';\nimport { BizPlugin } from './plugin';\n\nexport const getDebugCommonPluginRegistry = (props: PluginBizContext) => {\n  // eslint-disable-next-line @typescript-eslint/naming-convention -- Plugin names start with uppercase as expected\n  const BizPluginRegistry: PluginRegistryEntry<PluginBizContext> = {\n    /**\n     * Context of components throughout the plug-in lifecycle\n     */\n    createPluginBizContext() {\n      return {\n        ...props,\n      };\n    },\n    /**\n     * plug-in ontology\n     */\n    Plugin: BizPlugin,\n  };\n\n  return BizPluginRegistry;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, type PropsWithChildren } from 'react';\n\nimport { usePageRuntimeStore } from '@coze-studio/bot-detail-store/page-runtime';\nimport { useBotSkillStore } from '@coze-studio/bot-detail-store/bot-skill';\nimport { useBotInfoStore } from '@coze-studio/bot-detail-store/bot-info';\nimport { useEventCallback } from '@coze-common/chat-hooks';\nimport { Scene } from '@coze-common/chat-core';\nimport { ResumePluginRegistry } from '@coze-common/chat-area-plugin-resume';\nimport { ReasoningPluginRegistry } from '@coze-common/chat-area-plugin-reasoning';\nimport { useCreateGrabPlugin } from '@coze-common/chat-area-plugin-message-grab';\nimport { type MixInitResponse, type SenderInfo } from '@coze-common/chat-area';\nimport { useMessageReportEvent } from '@coze-arch/bot-hooks';\nimport {\n  type GetMessageListRequest,\n  Scene as SceneFromIDL,\n} from '@coze-arch/bot-api/developer_api';\nimport { DeveloperApi } from '@coze-arch/bot-api';\nimport {\n  BotDebugChatAreaProvider as BaseProvider,\n  type BotDebugChatAreaProviderProps,\n  useBotEditorChatBackground,\n} from '@coze-agent-ide/chat-area-provider';\nimport { getDebugCommonPluginRegistry } from '@coze-agent-ide/chat-area-plugin-debug-common';\n\nexport interface BotDebugChatAreaProviderAdapterProps\n  extends Pick<BotDebugChatAreaProviderProps, 'botId'> {\n  userId: string | undefined;\n}\n\nexport const BotDebugChatAreaProviderAdapter: React.FC<\n  PropsWithChildren<BotDebugChatAreaProviderAdapterProps>\n> = ({ children, botId, userId }) => {\n  const DebugCommonPlugin = getDebugCommonPluginRegistry({\n    scene: Scene.Playground,\n    botId,\n    methods: {\n      refreshTaskList: () => 0,\n    },\n  });\n\n  const setPageRuntimeBotInfo = usePageRuntimeStore(\n    state => state.setPageRuntimeBotInfo,\n  );\n\n  const { grabEnableUpload, GrabPlugin, grabPluginId } = useCreateGrabPlugin();\n\n  const { ChatBackgroundPlugin, showBackground } = useBotEditorChatBackground();\n\n  useEffect(() => {\n    if (grabPluginId) {\n      setPageRuntimeBotInfo({ grabPluginId });\n    }\n  }, [grabPluginId]);\n\n  useMessageReportEvent();\n\n  const getMessageList = (params: GetMessageListRequest) =>\n    DeveloperApi.GetMessageList(params);\n\n  const requestToInit = useEventCallback(async (): Promise<MixInitResponse> => {\n    const { onboardingContent, backgroundImageInfoList } =\n      useBotSkillStore.getState();\n    const { prologue } = onboardingContent;\n\n    const botInfo = useBotInfoStore.getState();\n    const { name, icon_url } = botInfo ?? {};\n    const params: GetMessageListRequest = {\n      bot_id: botId,\n      cursor: '0',\n      count: 15,\n      draft_mode: true,\n      scene: SceneFromIDL.Playground,\n    };\n    const dratMain = await getMessageList(params);\n\n    return {\n      conversationId: dratMain.conversation_id,\n      cursor: dratMain.cursor,\n      hasMore: dratMain.hasmore,\n      messageList: dratMain.message_list,\n      lastSectionId: dratMain.last_section_id,\n      prologue,\n      botInfoMap: {\n        [botId]: {\n          nickname: name ?? '',\n          url: icon_url ?? '',\n          id: botId,\n          allowMention: false,\n        } satisfies SenderInfo,\n      },\n      backgroundInfo: backgroundImageInfoList[0],\n      next_cursor: dratMain.next_cursor,\n    };\n  });\n\n  const pluginRegistryList = [\n    DebugCommonPlugin,\n    ResumePluginRegistry,\n    GrabPlugin,\n    ChatBackgroundPlugin,\n    ReasoningPluginRegistry,\n  ];\n  if (!userId) {\n    return null;\n  }\n  return (\n    <BaseProvider\n      requestToInit={requestToInit}\n      botId={botId}\n      pluginRegistryList={pluginRegistryList}\n      showBackground={showBackground}\n      grabEnableUpload={grabEnableUpload}\n    >\n      {children}\n    </BaseProvider>\n  );\n};\n","\n      import API from \"!../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./index.module.less\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./index.module.less\";\n       export default content && content.locals ? content.locals : undefined;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useParams } from 'react-router-dom';\nimport React, {\n  useState,\n  type FC,\n  type PropsWithChildren,\n  type ReactNode,\n  type ComponentType,\n} from 'react';\n\nimport classNames from 'classnames';\nimport { useUpdateEffect } from 'ahooks';\nimport { userStoreService } from '@coze-studio/user-store';\nimport { usePageRuntimeStore } from '@coze-studio/bot-detail-store/page-runtime';\nimport { type DynamicParams } from '@coze-arch/bot-typings/teamspace';\nimport { Spin } from '@coze-arch/bot-semi';\nimport { CustomError } from '@coze-arch/bot-error';\nimport { useBotPageStore } from '@coze-agent-ide/space-bot/store';\nimport { BotDebugChatAreaProviderAdapter } from '@coze-agent-ide/chat-area-provider-adapter';\n\nimport s from './index.module.less';\n\nexport interface CustomProviderProps {\n  botId: string;\n}\nexport interface BotEditorLayoutProps {\n  hasHeader?: boolean;\n}\n\nexport interface BotEditorLayoutSlot {\n  header?: ReactNode;\n  headerBottom?: ReactNode;\n  headerTop?: ReactNode;\n  customProvider?: ComponentType<PropsWithChildren<CustomProviderProps>>;\n}\n\nconst DefaultFragment: React.FC<PropsWithChildren<CustomProviderProps>> = ({\n  children,\n}) => <React.Fragment>{children}</React.Fragment>;\n\nconst BotEditorInitLayoutImpl: FC<\n  PropsWithChildren<\n    Omit<BotEditorLayoutProps, 'loading'> &\n      BotEditorLayoutSlot &\n      CustomProviderProps\n  >\n> = ({\n  children,\n  botId,\n  hasHeader = true,\n  headerBottom,\n  headerTop,\n  header,\n  customProvider,\n}) => {\n  // initial load\n  const [isFirstLoad, setIsFirstLoad] = useState(true);\n  const init = usePageRuntimeStore(state => state.init);\n  const userInfo = userStoreService.useUserInfo();\n\n  const modeSwitching = useBotPageStore(state => state.bot.modeSwitching);\n  const CustomProvider = customProvider || DefaultFragment;\n  // Because clearStore will keep the init value, when switching the bot, init is true, not the initial value false.\n  useUpdateEffect(() => {\n    // init The initStore will be updated every time, but only the initial loading needs to be recorded here, so it is necessary to judge the isFirstLoad.\n    if (isFirstLoad && init) {\n      // If init completes and is loading for the first time, indicating that the initial request is complete, set isFirstLoad to false\n      setIsFirstLoad(false);\n    }\n  }, [init]);\n\n  return (\n    <div className={s.wrapper}>\n      {isFirstLoad && !init ? (\n        <Spin spinning wrapperClassName=\"h-full w-full\" />\n      ) : (\n        <CustomProvider botId={botId}>\n          <BotDebugChatAreaProviderAdapter\n            botId={botId}\n            userId={userInfo?.user_id_str}\n          >\n            <Spin\n              spinning={modeSwitching}\n              wrapperClassName={classNames(s['spin-wrapper'], s['top-level'])}\n            >\n              {headerTop}\n              {hasHeader ? header : null}\n              {headerBottom}\n              {children}\n            </Spin>\n          </BotDebugChatAreaProviderAdapter>\n        </CustomProvider>\n      )}\n    </div>\n  );\n};\n\nexport const BotEditorInitLayout: React.FC<\n  PropsWithChildren<BotEditorLayoutProps & BotEditorLayoutSlot>\n> = props => {\n  const { bot_id } = useParams<DynamicParams>();\n  if (!bot_id) {\n    throw new CustomError('normal_error', 'failed to get bot_id');\n  }\n\n  return <BotEditorInitLayoutImpl {...props} botId={bot_id} />;\n};\nexport default BotEditorInitLayout;\n","\n      import API from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./style.module.less\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./style.module.less\";\n       export default content && content.locals ? content.locals : undefined;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReactNode } from 'react';\n\nimport { useShallow } from 'zustand/react/shallow';\nimport { usePageRuntimeStore } from '@coze-studio/bot-detail-store/page-runtime';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozLoading } from '@coze-arch/coze-design/icons';\nimport { Tag } from '@coze-arch/coze-design';\nimport { UIButton } from '@coze-arch/bot-semi';\nimport {\n  ConnectorDynamicStatus,\n  type ConnectorInfo,\n} from '@coze-arch/bot-api/developer_api';\nimport { IconAlertCircle } from '@douyinfe/semi-icons';\n\nimport s from './style.module.less';\n\nexport function OriginStatus() {\n  const { savingInfoSaving, savingInfoTime } = usePageRuntimeStore(\n    useShallow(store => ({\n      savingInfoSaving: store.savingInfo.saving,\n      savingInfoTime: store.savingInfo.time,\n    })),\n  );\n\n  return (\n    <>\n      <Tag\n        color=\"primary\"\n        className=\"!bg-transparent !p-0 !text-xs\"\n        loading={savingInfoSaving}\n        prefixIcon={savingInfoSaving ? <IconCozLoading /> : null}\n      >\n        {savingInfoSaving ? (\n          <div className={s['status-tag-spin']}>\n            <span>{I18n.t('bot_autosave_saving')}</span>\n          </div>\n        ) : (\n          I18n.t('devops_publish_multibranch_auto_saved', {\n            time: savingInfoTime,\n          })\n        )}\n      </Tag>\n    </>\n  );\n}\n\nexport const renderWarningContent = ({\n  warningList,\n  onCancel,\n  readonly,\n  deployButton = null,\n}: {\n  warningList: ConnectorInfo[];\n  onCancel: () => void;\n  readonly?: boolean;\n  deployButton?: ReactNode;\n}) => (\n  <div className={s['warning-content']}>\n    {/* TODO: Multiple abnormal status copies are subsequently returned by the interface. At present, only discord has abnormal status, so I can't go here. */}\n    {warningList.length > 1 ? (\n      <>\n        <div className={s['title-box']}>\n          <IconAlertCircle\n            size=\"large\"\n            style={{ color: 'var(--semi-color-warning)' }}\n          />\n          <span className={s.title}>\n            {I18n.t('bot_pulish_offline_modal_title2', {\n              platform_number: warningList?.length,\n            })}\n          </span>\n        </div>\n        <div className={s.main}>\n          {warningList?.map(item => (\n            <div className={s['warning-list']}>\n              <h4>{item.name}</h4>\n              <span>\n                {I18n.t('bot_publish_offline_notice_no_certain_time', {\n                  platform: item.name,\n                })}\n              </span>\n            </div>\n          ))}\n        </div>\n      </>\n    ) : (\n      <>\n        <div className={s['title-box']}>\n          <IconAlertCircle\n            size=\"large\"\n            style={{ color: 'var(--semi-color-warning)' }}\n          />\n          <span className={s.title}>\n            {warningList[0].connector_status === ConnectorDynamicStatus.Offline\n              ? I18n.t('bot_pulish_offline_modal_title1', {\n                  platform: warningList[0].name,\n                })\n              : warningList[0].name}\n          </span>\n        </div>\n        <div className={s.main}>\n          {warningList[0].connector_status === ConnectorDynamicStatus.Offline\n            ? I18n.t('bot_publish_offline_notice_no_certain_time', {\n                platform: warningList[0].name,\n              })\n            : I18n.t('bot_publish_token_expired_notice', {\n                platform: warningList[0].name,\n              })}\n        </div>\n      </>\n    )}\n    {readonly ? (\n      <div className={s.footer}>\n        <UIButton theme=\"solid\" type=\"warning\" onClick={onCancel}>\n          {I18n.t('devops_publish_multibranch_i_know')}\n        </UIButton>\n      </div>\n    ) : (\n      <div className={s.footer}>\n        <UIButton\n          theme=\"light\"\n          type=\"tertiary\"\n          className={s['cancel-btn']}\n          onClick={onCancel}\n        >\n          {I18n.t('Cancel')}\n        </UIButton>\n        {deployButton}\n      </div>\n    )}\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, type ReactNode } from 'react';\n\nimport { useShallow } from 'zustand/react/shallow';\nimport { useBotInfoStore } from '@coze-studio/bot-detail-store/bot-info';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozCheckMarkCircleFill,\n  IconCozInfoCircleFill,\n} from '@coze-arch/coze-design/icons';\nimport { Tag, Popover, Divider } from '@coze-arch/coze-design';\nimport { ConnectorDynamicStatus } from '@coze-arch/bot-api/developer_api';\n\nimport s from '../bot-status/style.module.less';\nimport { renderWarningContent } from '../bot-status/origin-status';\n\nexport const BotPublishStatus = ({\n  deployButton,\n}: {\n  deployButton: ReactNode;\n}) => {\n  const { connectors, noPublish } = useBotInfoStore(\n    useShallow(store => ({\n      noPublish: !store.has_publish,\n      connectors: store.connectors,\n    })),\n  );\n\n  const [visible, setVisible] = useState(false);\n\n  const renderPublishStatus = () => {\n    const warningList = connectors?.filter(\n      item => item.connector_status !== ConnectorDynamicStatus.Normal,\n    );\n    return warningList?.length ? (\n      <Popover\n        position=\"bottomLeft\"\n        visible={visible}\n        content={renderWarningContent({\n          warningList,\n          onCancel: () => setVisible(false),\n          deployButton,\n        })}\n        trigger=\"custom\"\n      >\n        <Divider layout=\"vertical\" className=\"!h-3 mx-2\" />\n        <Tag\n          color=\"yellow\"\n          className=\"!p-0\"\n          prefixIcon={<IconCozInfoCircleFill />}\n          onClick={() => {\n            setVisible(true);\n          }}\n        >\n          <div>{I18n.t('bot_status_published')}</div>\n        </Tag>\n      </Popover>\n    ) : (\n      <>\n        <Divider layout=\"vertical\" className=\"!h-3 mx-2\" />\n        <Tag\n          color=\"primary\"\n          className=\"!bg-transparent !p-0 !coz-fg-secondary\"\n          prefixIcon={\n            <IconCozCheckMarkCircleFill className=\"coz-fg-hglt-green\" />\n          }\n        >\n          {I18n.t('bot_status_published')}\n        </Tag>\n      </>\n    );\n  };\n\n  return (\n    <div className={s['status-tag']}>\n      {noPublish ? null : renderPublishStatus()}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReactNode } from 'react';\n\nimport { useShallow } from 'zustand/react/shallow';\nimport { useBotInfoStore } from '@coze-studio/bot-detail-store/bot-info';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozPeopleFill,\n  IconCozTeamFill,\n  IconCozCheckMarkCircleFillPalette,\n} from '@coze-arch/coze-design/icons';\nimport {\n  Avatar,\n  Typography,\n  Tag,\n  Popover,\n  IconButton,\n} from '@coze-arch/coze-design';\nimport { formatDate } from '@coze-arch/bot-utils';\nimport { useSpaceStore } from '@coze-arch/bot-studio-store';\nimport { IconEditNew } from '@coze-arch/bot-icons';\nimport { SpaceType } from '@coze-arch/bot-api/developer_api';\n\nimport { BotPublishStatus } from '../bot-publish-status';\n\nconst BotInfoCardContent = ({ deployButton }: { deployButton: ReactNode }) => {\n  const { botInfo } = useBotInfoStore(\n    useShallow(state => ({\n      botInfo: state,\n    })),\n  );\n  const {\n    space: { name: spaceName, space_type: spaceType },\n  } = useSpaceStore();\n  const isPersonal = spaceType === SpaceType.Personal;\n  return (\n    <div className=\"w-[260px] p-4 coz-bg-max\">\n      <div className=\"flex items-center justify-center mb-7\">\n        <Avatar size=\"medium\" src={botInfo.icon_url} />\n      </div>\n      <div className=\"flex items-center justify-center gap-2 flex-col\">\n        <Typography.Text strong className=\"!text-xxl !font-medium\">\n          {botInfo.name}\n        </Typography.Text>\n\n        <div className=\"flex items-cente\">\n          <Tag\n            color=\"primary\"\n            className=\"max-w-[160px] !bg-transparent !coz-fg-secondary !p-0\"\n            prefixIcon={\n              isPersonal ? <IconCozPeopleFill /> : <IconCozTeamFill />\n            }\n          >\n            {spaceName}\n          </Tag>\n          <BotPublishStatus deployButton={deployButton} />\n        </div>\n\n        {botInfo.description ? (\n          <Typography.Paragraph\n            className=\"text-sm coz-fg-primary\"\n            ellipsis={{ rows: 2 }}\n          >\n            {botInfo.description}\n          </Typography.Paragraph>\n        ) : null}\n        <div className=\"text-xs coz-fg-secondary\">\n          {I18n.t('Create_time')}:{' '}\n          {botInfo.create_time ? formatDate(Number(botInfo.create_time)) : null}\n        </div>\n      </div>\n    </div>\n  );\n};\n\ninterface BotInfoCardProps {\n  isReadonly: boolean;\n  editBotInfoFn: () => void;\n  deployButton: ReactNode;\n}\n\nexport const BotInfoCard = ({\n  isReadonly,\n  editBotInfoFn,\n  deployButton,\n}: BotInfoCardProps) => {\n  const { botInfo, noPublish } = useBotInfoStore(\n    useShallow(state => ({\n      botInfo: state,\n      noPublish: !state.has_publish,\n    })),\n  );\n\n  const triggerContent = (\n    <div className=\"flex items-center gap-2\">\n      <div className=\"relative\">\n        <Avatar\n          size=\"small\"\n          shape=\"square\"\n          src={botInfo?.icon_url}\n          className=\"rounded\"\n        ></Avatar>\n        {!noPublish ? (\n          <div className=\"absolute flex justify-center items-center -right-[1px] -bottom-[1px] w-3 h-3 text-[12px] coz-bg-max box-content border-[1.5px] border-solid rounded-small border-[#fff]\">\n            <IconCozCheckMarkCircleFillPalette className=\"relative coz-fg-hglt-green\" />\n          </div>\n        ) : null}\n      </div>\n      <Typography.Title className=\"!text-[16px] !coz-fg-plus !font-medium !leading-[22px]\">\n        {botInfo?.name}\n      </Typography.Title>\n      {!isReadonly && (\n        <IconButton\n          className=\"edit-btn\"\n          color=\"secondary\"\n          icon={<IconEditNew />}\n          theme=\"borderless\"\n          onClick={() => {\n            editBotInfoFn();\n          }}\n          data-testid=\"bot.ide.bot_creator.bot-info-edit-create-edit-info-button\"\n        />\n      )}\n    </div>\n  );\n\n  return (\n    <Popover\n      content={<BotInfoCardContent deployButton={deployButton} />}\n      trigger=\"hover\"\n      position=\"bottomLeft\"\n    >\n      {triggerContent}\n    </Popover>\n  );\n};\n","\n      import API from \"!../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./index.module.less\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./index.module.less\";\n       export default content && content.locals ? content.locals : undefined;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useNavigate } from 'react-router-dom';\nimport { Helmet } from 'react-helmet';\nimport { type ReactNode, useEffect, useRef } from 'react';\n\nimport { useShallow } from 'zustand/react/shallow';\nimport { cloneDeep } from 'lodash-es';\nimport cx from 'classnames';\nimport { useUpdateAgent } from '@coze-studio/entity-adapter';\nimport { usePageRuntimeStore } from '@coze-studio/bot-detail-store/page-runtime';\nimport { useDiffTaskStore } from '@coze-studio/bot-detail-store/diff-task';\nimport { useBotInfoStore } from '@coze-studio/bot-detail-store/bot-info';\nimport { useBotDetailIsReadonly } from '@coze-studio/bot-detail-store';\nimport { BackButton } from '@coze-foundation/layout';\nimport { type SenderInfo, useBotInfo } from '@coze-common/chat-area';\nimport { I18n } from '@coze-arch/i18n';\nimport { renderHtmlTitle } from '@coze-arch/bot-utils';\nimport { BotPageFromEnum } from '@coze-arch/bot-typings/common';\nimport { useSpaceStore } from '@coze-arch/bot-studio-store';\nimport { type DraftBot } from '@coze-arch/bot-api/developer_api';\nimport {\n  ModeSelect,\n  type ModeSelectProps,\n} from '@coze-agent-ide/space-bot/component';\n\nimport { BotInfoCard } from './bot-info-card';\n\nimport s from './index.module.less';\n\nexport interface BotHeaderProps {\n  pageName?: string;\n  isEditLocked?: boolean;\n  addonAfter?: ReactNode;\n  modeOptionList: ModeSelectProps['optionList'];\n  deployButton: ReactNode;\n}\n\nexport const BotHeader: React.FC<BotHeaderProps> = props => {\n  const navigate = useNavigate();\n  const spaceID = useSpaceStore(state => state.space.id);\n  const isReadonly = useBotDetailIsReadonly();\n  const { pageFrom } = usePageRuntimeStore(\n    useShallow(state => ({\n      pageFrom: state.pageFrom,\n    })),\n  );\n\n  const botInfo = useBotInfoStore();\n\n  const { updateBotInfo } = useBotInfo();\n\n  const botInfoRef = useRef<DraftBot>();\n\n  useEffect(() => {\n    botInfoRef.current = botInfo as DraftBot;\n  }, [botInfo]);\n\n  const { modal: updateBotModal, startEdit: editBotInfoFn } = useUpdateAgent({\n    botInfoRef,\n    onSuccess: (\n      botID?: string,\n      spaceId?: string,\n      extra?: {\n        botName?: string;\n        botAvatar?: string;\n      },\n    ) => {\n      updateBotInfo(oldBotInfo => {\n        const botInfoMap = cloneDeep(oldBotInfo);\n\n        if (!botID) {\n          return botInfoMap;\n        }\n        botInfoMap[botID] = {\n          url: extra?.botAvatar ?? '',\n          nickname: extra?.botName ?? '',\n          id: botID,\n          allowMention: false,\n        } satisfies SenderInfo;\n\n        return botInfoMap;\n      });\n    },\n  });\n\n  const diffTask = useDiffTaskStore(state => state.diffTask);\n\n  const goBackToBotList = () => {\n    navigate(`/space/${spaceID}/develop`);\n  };\n\n  return (\n    <>\n      <div className={cx(s.header, 'coz-bg-primary')}>\n        {/* page title */}\n        <Helmet>\n          <title>\n            {renderHtmlTitle(\n              pageFrom === BotPageFromEnum.Bot\n                ? I18n.t('tab_bot_detail', {\n                    bot_name: botInfo?.name ?? '',\n                  })\n                : I18n.t('tab_explore_bot_detail', {\n                    bot_name: botInfo?.name ?? '',\n                  }),\n            )}\n          </title>\n        </Helmet>\n        {/** 1. Left bot information area */}\n        <div className=\"flex items-center\">\n          <BackButton onClickBack={goBackToBotList} />\n          <BotInfoCard\n            isReadonly={isReadonly}\n            editBotInfoFn={editBotInfoFn}\n            deployButton={props.deployButton}\n          />\n          {/**  */}\n          {diffTask ? null : <ModeSelect optionList={props.modeOptionList} />}\n        </div>\n\n        {/* 2. Middle bot menu area - offline */}\n\n        {/* 3. Right bot state area */}\n        {props.addonAfter}\n        {updateBotModal}\n      </div>\n    </>\n  );\n};\n","import * as React from 'react';\nimport { convertIcon } from '../components/Icon';\nfunction SvgComponent(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: \"1em\",\n    height: \"1em\",\n    focusable: false,\n    \"aria-hidden\": true\n  }, props), /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M12.94 2.94a5.74 5.74 0 1 1 8.12 8.12l-2.67 2.67a7.05 7.05 0 0 0-.4-3.85l.95-.94a2.74 2.74 0 1 0-3.88-3.88l-4 4a2.74 2.74 0 0 0 .9 4.48l-2.2 2.2a5.77 5.77 0 0 1-.82-8.8l4-4Zm-10 10 2.67-2.67a7.04 7.04 0 0 0 .4 3.85l-.95.94a2.74 2.74 0 1 0 3.88 3.88l4-4a2.74 2.74 0 0 0-.57-4.31l2.16-2.16a5.74 5.74 0 0 1 .53 8.6l-4 4a5.74 5.74 0 0 1-8.12-8.13Z\",\n    fill: \"currentColor\"\n  }));\n}\nconst IconComponent = convertIcon(SvgComponent, 'link');\nexport default IconComponent;","\n      import API from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./index.module.less\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./index.module.less\";\n       export default content && content.locals ? content.locals : undefined;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReactNode } from 'react';\n\nimport { useShallow } from 'zustand/react/shallow';\nimport copy from 'copy-to-clipboard';\nimport { useBoolean, useRequest } from 'ahooks';\nimport { useBotInfoStore } from '@coze-studio/bot-detail-store/bot-info';\nimport {\n  getBotDetailDtoInfo,\n  updateHeaderStatus,\n  updateBotRequest,\n} from '@coze-studio/bot-detail-store';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  Item,\n  UIIconButton,\n  Toast,\n  Tooltip,\n  Space,\n  Image,\n} from '@coze-arch/bot-semi';\nimport {\n  ConnectorDynamicStatus,\n  type ConnectorInfo,\n} from '@coze-arch/bot-api/developer_api';\nimport { IconLink } from '@douyinfe/semi-icons';\n\nimport s from './index.module.less';\n\nexport type ExtendedConnectorInfo = Omit<ConnectorInfo, 'icon'> & {\n  icon?: string | ReactNode;\n};\n\nexport const LinkDropItem = (props: {\n  linkInfo: ExtendedConnectorInfo;\n  hasMorePlatform: boolean;\n  isReadOnly: boolean;\n}) => {\n  const { linkInfo, hasMorePlatform, isReadOnly } = props;\n  const [mouseIn, { setTrue, setFalse }] = useBoolean(false);\n  const { botId, mode } = useBotInfoStore(\n    useShallow(state => ({\n      botId: state.botId,\n      mode: state.mode,\n    })),\n  );\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const onLinkCopy = (e: any) => {\n    if (!linkInfo.share_link) {\n      return;\n    }\n    e.stopPropagation();\n    const res = copy(linkInfo.share_link);\n    if (res) {\n      Toast.success({\n        showClose: false,\n        content: I18n.t('copy_success'),\n      });\n    }\n  };\n  const { run: updateBot } = useRequest(\n    async () => {\n      if (!botId || isReadOnly) {\n        return;\n      }\n      const { botSkillInfo } = getBotDetailDtoInfo();\n      const { data } = await updateBotRequest({\n        ...botSkillInfo,\n        bot_mode: mode,\n      });\n\n      updateHeaderStatus(data);\n    },\n    {\n      manual: true,\n    },\n  );\n\n  const onConnectorClick = () => {\n    updateBot();\n    window.open(linkInfo.share_link);\n  };\n\n  const isDisableDropItem =\n    linkInfo.connector_status !== ConnectorDynamicStatus.Normal ||\n    hasMorePlatform;\n\n  const content = (function () {\n    return (\n      <div className={s['link-item']}>\n        <Space>\n          {linkInfo.icon ? (\n            typeof linkInfo.icon === 'string' ? (\n              <Image\n                src={linkInfo.icon}\n                width={16}\n                height={16}\n                preview={false}\n                className={s['link-img']}\n              />\n            ) : (\n              <div className=\"w-4 h-4 rounded-mini [&_.semi-icon-default]:w-full [&_.semi-icon-default]:h-full [&_svg]:w-full [&_svg]:h-full\">\n                {linkInfo.icon}\n              </div>\n            )\n          ) : null}\n          <div> {linkInfo.name} </div>\n        </Space>\n\n        <Tooltip content={I18n.t('Copy_link')} position=\"right\">\n          {/* Flow currently does not support pasting and sharing links, coming soon.. */}\n          {mouseIn &&\n          linkInfo.share_link &&\n          linkInfo.id !== FLOW_PUBLISH_ID &&\n          !isReadOnly ? (\n            <UIIconButton\n              icon={<IconLink />}\n              onClick={onLinkCopy}\n              type=\"tertiary\"\n              className={s['copy-btn']}\n              iconSize=\"small\"\n            />\n          ) : null}\n        </Tooltip>\n      </div>\n    );\n  })();\n\n  return (\n    <Item\n      onMouseEnter={setTrue}\n      onMouseLeave={setFalse}\n      disabled={isDisableDropItem}\n      onClick={onConnectorClick}\n    >\n      {isDisableDropItem ? (\n        <Tooltip\n          content={\n            hasMorePlatform\n              ? I18n.t('bot_share_not_supported_opening')\n              : I18n.t('bot_publish_token_expired_notice', {\n                  platform: linkInfo.name,\n                })\n          }\n          position=\"leftTop\"\n        >\n          {content}\n        </Tooltip>\n      ) : (\n        content\n      )}\n    </Item>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useNavigate } from 'react-router-dom';\nimport React, { type FC } from 'react';\n\nimport { useShallow } from 'zustand/react/shallow';\nimport { useIsPublishRecordReady } from '@coze-studio/publish-manage-hooks';\nimport { usePageRuntimeStore } from '@coze-studio/bot-detail-store/page-runtime';\nimport { useBotInfoStore } from '@coze-studio/bot-detail-store/bot-info';\nimport { useBotDetailIsReadonly } from '@coze-studio/bot-detail-store';\nimport MORE_PLATFORM_ICON from '@coze-common/assets/image/more-platform-icon.jpg';\nimport { I18n } from '@coze-arch/i18n';\nimport { Divider } from '@coze-arch/bot-semi';\nimport { IconMenuLogo } from '@coze-arch/bot-icons';\nimport { useFlags } from '@coze-arch/bot-flags';\nimport { IntelligenceType } from '@coze-arch/bot-api/intelligence_api';\nimport {\n  BotMarketStatus,\n  ConnectorDynamicStatus,\n  type ConnectorInfo,\n} from '@coze-arch/bot-api/developer_api';\nimport {\n  IconCozArrowRightFill,\n  IconCozMore,\n} from '@coze-arch/coze-design/icons';\nimport { Dropdown, IconButton, Tooltip } from '@coze-arch/coze-design';\n\nimport { LinkDropItem } from './link-drop-item';\n\nimport s from './index.module.less';\n\nexport type ExtendedConnectorInfo = Omit<ConnectorInfo, 'icon'> & {\n  icon?: string | React.ReactNode;\n};\n\nconst LinkMenu = (props: {\n  connectors: ExtendedConnectorInfo[];\n  renderMorePlatform: boolean;\n  isReadOnly: boolean;\n}) => {\n  const { connectors = [], renderMorePlatform, isReadOnly } = props;\n  return (\n    <Dropdown.Menu mode=\"menu\">\n      {!isReadOnly && (\n        <>\n          <div className={s['open-in-tips']}>\n            {I18n.t('bot_list_open_button', {\n              platform: '',\n            })}\n          </div>\n          <Divider margin={2} layout=\"horizontal\" />\n        </>\n      )}\n      {connectors.map(item => (\n        <LinkDropItem\n          linkInfo={item}\n          key={item.name}\n          hasMorePlatform={false}\n          isReadOnly={isReadOnly}\n        />\n      ))}\n      {renderMorePlatform ? (\n        <LinkDropItem\n          linkInfo={{\n            name: I18n.t('bot_share_more_platforms'),\n            icon: MORE_PLATFORM_ICON,\n          }}\n          hasMorePlatform\n          isReadOnly={isReadOnly}\n        />\n      ) : null}\n    </Dropdown.Menu>\n  );\n};\n\n// eslint-disable-next-line complexity, @coze-arch/max-line-per-function\nexport const MoreMenuButton: FC = () => {\n  const { hasPublish, connectors, version, botId, spaceId, botMarketStatus } =\n    useBotInfoStore(\n      useShallow(state => ({\n        botId: state.botId,\n        spaceId: state.space_id,\n        hasPublish: state.has_publish,\n        connectors: state.connectors,\n        version: state.version,\n        botMarketStatus: state.botMarketStatus,\n      })),\n    );\n  const { historyVisible } = usePageRuntimeStore(\n    useShallow(state => ({\n      historyVisible: state.historyVisible,\n    })),\n  );\n\n  const isReadOnly = useBotDetailIsReadonly();\n\n  const StoreConnector: ExtendedConnectorInfo = {\n    id: 'store',\n    name: I18n.t('bot_edit_store'),\n    icon: (\n      <div className=\"w-4 h-4 rounded-mini [&_.semi-icon-default]:w-full [&_.semi-icon-default]:h-full [&_svg]:w-full [&_svg]:h-full\">\n        <IconMenuLogo />\n      </div>\n    ),\n    share_link: `${window.location.origin}/store/agent/${botId}?bot_id=true`,\n    connector_status:\n      botMarketStatus === BotMarketStatus.Online\n        ? ConnectorDynamicStatus.Normal\n        : ConnectorDynamicStatus.Offline,\n  };\n  const extendedConnectors = [\n    ...(connectors as ExtendedConnectorInfo[]),\n  ].concat(botMarketStatus === BotMarketStatus.Online ? [StoreConnector] : []);\n\n  const hasMorePlatform = extendedConnectors?.some(item => !item.share_link);\n\n  // Do not display open conditions 1. Bot from explore (no more explore) 2. Bot from unreleased platform 3. Bot of historical version (display after considering revert) 4. All released platforms do not share links\n  const hideOpenIn =\n    !extendedConnectors?.length ||\n    (version && historyVisible) ||\n    extendedConnectors?.every(item => !item.share_link);\n\n  const navigate = useNavigate();\n\n  const [FLAGS] = useFlags();\n\n  //Have editing rights & & have published business lines\n  const showPublishManageMenu = !isReadOnly && hasPublish;\n\n  const { ready, inited } = useIsPublishRecordReady({\n    type: IntelligenceType.Bot,\n    intelligenceId: botId,\n    spaceId,\n    enable:\n      showPublishManageMenu &&\n      // Support soon, so stay tuned.\n      FLAGS['bot.studio.publish_management'] &&\n      !IS_OPEN_SOURCE,\n  });\n\n  if (!showPublishManageMenu && hideOpenIn) {\n    return null;\n  }\n\n  const publishMenuItems = [\n    {\n      label: I18n.t('analytics_page_title'),\n      to: `/space/${spaceId}/publish/agent/${botId}?tab=analysis`,\n    },\n    {\n      label: I18n.t('release_management_trace'),\n      to: `/space/${spaceId}/publish/agent/${botId}?tab=logs`,\n    },\n    {\n      label: I18n.t('release_management_trigger'),\n      to: `/space/${spaceId}/publish/agent/${botId}?tab=triggers`,\n    },\n  ];\n\n  return (\n    <Dropdown\n      render={\n        <Dropdown.Menu mode=\"menu\">\n          {/* Support soon, so stay tuned. */}\n          {showPublishManageMenu &&\n          FLAGS['bot.studio.publish_management'] &&\n          !IS_OPEN_SOURCE\n            ? publishMenuItems.map(item => {\n                const menuItem = (\n                  <Dropdown.Item\n                    disabled={!ready}\n                    onClick={() => navigate(item.to)}\n                  >\n                    {item.label}\n                  </Dropdown.Item>\n                );\n                return ready || !inited ? (\n                  menuItem\n                ) : (\n                  <Tooltip content={I18n.t('release_management_generating')}>\n                    <div>{menuItem}</div>\n                  </Tooltip>\n                );\n              })\n            : null}\n          {hideOpenIn ? null : (\n            <>\n              {/* Support soon, so stay tuned. */}\n              {showPublishManageMenu &&\n              FLAGS['bot.studio.publish_management'] &&\n              !IS_OPEN_SOURCE ? (\n                <Dropdown.Divider />\n              ) : null}\n              <Dropdown\n                render={\n                  <LinkMenu\n                    connectors={extendedConnectors?.filter(\n                      item =>\n                        item.share_link &&\n                        // Read-only status Only display normal release channels\n                        (!isReadOnly ||\n                          item.connector_status ===\n                            ConnectorDynamicStatus.Normal),\n                    )}\n                    renderMorePlatform={!isReadOnly && !!hasMorePlatform}\n                    isReadOnly={isReadOnly}\n                  />\n                }\n              >\n                <Dropdown.Item>\n                  <div className=\"w-full flex items-center\">\n                    <div className=\"flex-1\">\n                      {I18n.t('release_management_openin')}\n                    </div>\n                    <IconCozArrowRightFill />\n                  </div>\n                </Dropdown.Item>\n              </Dropdown>\n            </>\n          )}\n        </Dropdown.Menu>\n      }\n    >\n      <IconButton icon={<IconCozMore />} />\n    </Dropdown>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useNavigate } from 'react-router-dom';\n\nimport { useShallow } from 'zustand/react/shallow';\nimport { useBotInfoStore } from '@coze-studio/bot-detail-store/bot-info';\nimport { getBotDetailIsReadonly } from '@coze-studio/bot-detail-store';\nimport { EVENT_NAMES, sendTeaEvent } from '@coze-arch/bot-tea';\nimport { type Type } from '@coze-arch/bot-semi/Button';\n\nexport interface DeployButtonProps {\n  btnType?: Type;\n  btnText?: string;\n  customStyle?: Record<string, string>;\n  readonly?: boolean;\n  tooltip?: string;\n}\n\nexport const useDeployService = () => {\n  const navigate = useNavigate();\n\n  const { botId, botInfo, spaceId } = useBotInfoStore(\n    useShallow(s => ({\n      description: s.description,\n      botId: s.botId,\n      botInfo: s,\n      spaceId: s.space_id,\n    })),\n  );\n\n  const handleDeploy = () => {\n    if (!botId || getBotDetailIsReadonly()) {\n      return;\n    }\n\n    navigate(`/space/${spaceId}/bot/${botId}/publish`);\n  };\n\n  const handlePublish = () => {\n    sendTeaEvent(EVENT_NAMES.bot_publish_button_click, {\n      bot_id: botId || '',\n      bot_name: botInfo?.name || '',\n    });\n\n    handleDeploy();\n  };\n\n  return {\n    handlePublish,\n  } as const;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Fragment } from 'react';\n\nimport { usePageRuntimeStore } from '@coze-studio/bot-detail-store/page-runtime';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozCheckMarkCircleFillPalette } from '@coze-arch/coze-design/icons';\nimport { Tooltip } from '@coze-arch/coze-design';\nimport { type Type } from '@coze-arch/bot-semi/Button';\nimport { BotDebugButton } from '@coze-agent-ide/space-bot/component';\n\nimport { useDeployService } from './hooks/service';\n\nexport interface DeployButtonUIProps {\n  btnType?: Type;\n  btnText?: string;\n  customStyle?: Record<string, string>;\n  readonly?: boolean;\n  tooltip?: string;\n  onClick?: () => void;\n  showChangeTip?: boolean;\n  disabled?: boolean;\n  loading?: boolean;\n}\n\nexport type DeployButtonProps = Omit<\n  DeployButtonUIProps,\n  'showChangeTip' | 'onClick' | 'disabled' | 'loading'\n>;\n\nexport { useDeployService };\n\nexport const DeployButton: React.FC<DeployButtonProps> = props => {\n  const { handlePublish } = useDeployService();\n\n  const hasUnpublishChange = usePageRuntimeStore(s => s.hasUnpublishChange);\n\n  const showChangeTip = hasUnpublishChange;\n  return (\n    <DeployButtonUI\n      onClick={handlePublish}\n      showChangeTip={showChangeTip}\n      {...props}\n    />\n  );\n};\n\nexport const DeployButtonUI = ({\n  btnType = 'primary',\n  btnText = I18n.t('bot_publish_button'),\n  customStyle,\n  readonly = false,\n  tooltip,\n  showChangeTip,\n  onClick,\n  disabled,\n  loading,\n}: DeployButtonUIProps) => {\n  const showTip = showChangeTip || !!tooltip;\n  const ToolTipCom = showTip ? Tooltip : Fragment;\n\n  const btn = (\n    <ToolTipCom\n      content={tooltip || I18n.t('bot_has_changes_tip')}\n      visible={showChangeTip}\n    >\n      <BotDebugButton\n        data-testid=\"agent-ide.goto.publish-button\"\n        theme=\"solid\"\n        type={btnType}\n        iconPosition=\"right\"\n        icon={\n          showChangeTip ? (\n            <IconCozCheckMarkCircleFillPalette className=\"w-[5px] h-[5px]\" />\n          ) : undefined\n        }\n        style={customStyle}\n        disabled={disabled || readonly}\n        onClick={onClick}\n        loading={loading}\n      >\n        {btnText}\n      </BotDebugButton>\n    </ToolTipCom>\n  );\n\n  return disabled ? (\n    <Tooltip\n      content={I18n.t('devops_publish_multibranch_publish_disabled_tooltip')}\n    >\n      {btn}\n    </Tooltip>\n  ) : (\n    btn\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BotEditorInitLayout,\n  type BotEditorLayoutSlot,\n  type BotEditorLayoutProps,\n  type CustomProviderProps,\n} from './layout';\n\nexport { BotHeader, type BotHeaderProps } from './components/header';\n\nexport { MoreMenuButton } from './components/header/more-menu-button';\n\nexport {\n  DeployButtonUI,\n  DeployButton,\n  type DeployButtonProps,\n  type DeployButtonUIProps,\n} from './components/header/deploy-button';\n\nexport {\n  renderWarningContent,\n  OriginStatus,\n} from './components/header/bot-status';\n\nexport {\n  type BotEditorLayoutSlot,\n  type BotEditorLayoutProps,\n  type CustomProviderProps,\n};\n\nexport default BotEditorInitLayout;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useInit } from '@coze-agent-ide/space-bot/hook';\n\nexport const useInitAgent = useInit;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ModeOption } from '@coze-agent-ide/space-bot/component';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozWorkflow } from '@coze-arch/coze-design/icons';\nimport { IconSingleMode } from '@coze-arch/bot-icons';\nimport { BotMode } from '@coze-arch/bot-api/developer_api';\n\nexport const modeOptionList: ModeOption[] = [\n  {\n    value: BotMode.SingleMode,\n    getIsDisabled: () => false,\n    icon: <IconSingleMode />,\n    title: I18n.t('singleagent_LLM_mode'),\n    desc: I18n.t('singleagent_LLM_mode_desc'),\n    showText: true,\n  },\n  {\n    value: BotMode.WorkflowMode,\n    getIsDisabled: () => false,\n    icon: <IconCozWorkflow />,\n    title: I18n.t('singleagent_workflow_mode'),\n    desc: I18n.t('singleagent_workflow_mode_desc'),\n    showText: true,\n  },\n];\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useShallow } from 'zustand/react/shallow';\nimport { Divider } from '@coze-arch/bot-semi';\nimport { DuplicateBot } from '@coze-studio/components';\nimport { usePageRuntimeStore } from '@coze-studio/bot-detail-store/page-runtime';\nimport { useBotInfoStore } from '@coze-studio/bot-detail-store/bot-info';\nimport { useBotDetailIsReadonly } from '@coze-studio/bot-detail-store';\nimport {\n  type BotHeaderProps,\n  DeployButton,\n  MoreMenuButton,\n  OriginStatus,\n} from '@coze-agent-ide/layout';\n\nexport type HeaderAddonAfterProps = Omit<\n  BotHeaderProps,\n  'modeOptionList' | 'deployButton'\n>;\n\nexport const HeaderAddonAfter: React.FC<HeaderAddonAfterProps> = ({\n  isEditLocked,\n}) => {\n  const isReadonly = useBotDetailIsReadonly();\n  const editable = usePageRuntimeStore(state => state.editable);\n  const { botId, botInfo } = useBotInfoStore(\n    useShallow(state => ({\n      botId: state.botId,\n      botInfo: state,\n    })),\n  );\n  return (\n    <div className=\"flex items-center gap-2\">\n      {/** 3.1 State Zone */}\n      <div className=\"flex items-center gap-2\">\n        {/*  3.1.1 Draft Status | Collaboration Status */}\n        {!isReadonly ? <OriginStatus /> : null}\n      </div>\n      {/** TODO: hzf implicitly associated button, which can be extracted later */}\n      {editable ? (\n        <Divider layout=\"vertical\" style={{ height: '20px' }} />\n      ) : null}\n      {/** 3.2 Button area */}\n      <div className=\"flex items-center gap-2\">\n        {!isEditLocked ? (\n          <>\n            <div className=\"flex items-center gap-2\">\n              {/** Function button area */}\n              <MoreMenuButton />\n            </div>\n            {/** Submit post related button */}\n            <div className=\"flex items-center gap-2\">\n              {editable ? <DeployButton /> : null}\n              {!editable && botInfo && botId ? (\n                <DuplicateBot botID={botId} />\n              ) : null}\n              <div id=\"diff-task-button-container\"></div>\n            </div>\n          </>\n        ) : null}\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReactNode, type PropsWithChildren } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { usePageRuntimeStore } from '@coze-studio/bot-detail-store/page-runtime';\nimport BotEditorLayout, {\n  type BotEditorLayoutProps,\n  BotHeader,\n  DeployButton,\n} from '@coze-agent-ide/layout';\n\nimport { useInitAgent } from '../hooks/use-init-agent';\nimport { modeOptionList } from '../header/mode-list';\nimport { HeaderAddonAfter } from '../header';\n\nexport interface LayoutAdapterProps {\n  headerExtra?: ReactNode;\n  pageName?: string;\n}\n\nexport const BotEditorInitLayoutAdapter: React.FC<\n  PropsWithChildren<BotEditorLayoutProps & LayoutAdapterProps>\n> = ({ children, headerExtra, pageName, ...layoutProps }) => {\n  useInitAgent();\n\n  const isPreview = usePageRuntimeStore(state => state.isPreview);\n  const isEditLocked = isPreview;\n\n  return (\n    <BotEditorLayout\n      {...layoutProps}\n      header={\n        <BotHeader\n          pageName={pageName}\n          isEditLocked={isPreview}\n          addonAfter={\n            <HeaderAddonAfter pageName={pageName} isEditLocked={isEditLocked} />\n          }\n          modeOptionList={modeOptionList}\n          deployButton={\n            <DeployButton\n              btnType=\"warning\"\n              btnText={I18n.t('bot_publish_ republish_btn')}\n              customStyle={{ height: '38px' }}\n            />\n          }\n        />\n      }\n    >\n      {children}\n    </BotEditorLayout>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.\n/* eslint-disable */\n/* tslint:disable */\n// @ts-nocheck\n\nexport type Int64 = string | number;\n\n/** ComponentMappingType  */\nexport enum ComponentMappingType {\n  Undefined = 0,\n  MockSet = 1,\n}\n\n/** ComponentType  */\nexport enum ComponentType {\n  Undefined = 0,\n  /** Coze Plugin */\n  CozePlugin = 10000,\n  /** Coze Tool */\n  CozeTool = 10001,\n  /** Coze Workflow */\n  CozeWorkflow = 10002,\n  /** Coze SubWorkflowWorkflowWorkflow */\n  CozeSubWorkflow = 10003,\n  /** Coze workflowLLM */\n  CozeLLMNode = 10004,\n  /** Coze workflowCode */\n  CozeCodeNode = 10005,\n  /** Coze workflowKnowledge */\n  CozeKnowledgeNode = 10006,\n  /** Coze workflowTool */\n  CozeToolNode = 10007,\n  /** Coze workflowstart */\n  CozeStartNode = 10008,\n  /** Coze workflowvariable */\n  CozeVariableNode = 10009,\n  /** Coze varibalebot */\n  CozeVariableBot = 20000,\n  /** Coze varibalechat */\n  CozeVariableChat = 20001,\n}\n\nexport enum CozeChannel {\n  /** Coze,  */\n  Coze = 0,\n}\n\nexport enum DebugScene {\n  /** play ground Debug */\n  Debug = 0,\n}\n\nexport enum OrderBy {\n  UpdateTime = 1,\n}\n\n/** TrafficScene  */\nexport enum TrafficScene {\n  Undefined = 0,\n  /** Agent */\n  CozeSingleAgentDebug = 10000,\n  /** Agent */\n  CozeMultiAgentDebug = 10001,\n  /** Tool */\n  CozeToolDebug = 10002,\n  /** Workflow */\n  CozeWorkflowDebug = 10003,\n}\n\n/** BizCtx  */\nexport interface BizCtx {\n  /** connectorID */\n  connectorID?: string;\n  /** connectorID */\n  connectorUID?: string;\n  /**  */\n  trafficScene?: TrafficScene;\n  /** IDBottrafficSceneIDBotID */\n  trafficCallerID?: string;\n  /** SpaceID */\n  bizSpaceID?: string;\n  /**  */\n  ext?: Record<string, string>;\n}\n\n/** ComponentSubject  */\nexport interface ComponentSubject {\n  /** IDTool IDNode ID */\n  componentID?: string;\n  /**  */\n  componentType?: ComponentType;\n  /** IDTool->Plugin, Node->Workflow */\n  parentComponentID?: string;\n  /**  */\n  parentComponentType?: ComponentType;\n}\n\nexport interface Creator {\n  ID?: string;\n  name?: string;\n  avatarUrl?: string;\n}\n/* eslint-enable */\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReadonlyRenderLifeCycleServiceGenerator } from '@coze-common/chat-area';\n\nimport { type PluginBizContext } from '../../types/biz-context';\n\nexport const renderLifeCycleServiceGenerator: ReadonlyRenderLifeCycleServiceGenerator<\n  PluginBizContext\n> = plugin => ({});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReadonlyMessageLifeCycleServiceGenerator } from '@coze-common/chat-area';\n\nimport { type PluginBizContext } from '../../types/biz-context';\n\nexport const messageLifeCycleServiceGenerator: ReadonlyMessageLifeCycleServiceGenerator<\n  PluginBizContext\n> = plugin => ({});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReadonlyCommandLifeCycleServiceGenerator } from '@coze-common/chat-area';\n\nimport { type PluginBizContext } from '../../types/biz-context';\n\nexport const commandLifeCycleServiceGenerator: ReadonlyCommandLifeCycleServiceGenerator<\n  PluginBizContext\n> = plugin => ({});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReadonlyAppLifeCycleServiceGenerator } from '@coze-common/chat-area';\n\nimport { type PluginBizContext } from '../../types/biz-context';\n\nexport const appLifeCycleServiceGenerator: ReadonlyAppLifeCycleServiceGenerator<\n  PluginBizContext\n> = plugin => ({});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReadonlyLifeCycleServiceGenerator } from '@coze-common/chat-area';\n\nimport { type PluginBizContext } from '../../types/biz-context';\nimport { renderLifeCycleServiceGenerator } from './render';\nimport { messageLifeCycleServiceGenerator } from './message';\nimport { commandLifeCycleServiceGenerator } from './command';\nimport { appLifeCycleServiceGenerator } from './app';\n\nexport const bizLifeCycleServiceGenerator: ReadonlyLifeCycleServiceGenerator<\n  PluginBizContext\n> = plugin => ({\n  appLifeCycleService: appLifeCycleServiceGenerator(plugin),\n  messageLifeCycleService: messageLifeCycleServiceGenerator(plugin),\n  commandLifeCycleService: commandLifeCycleServiceGenerator(plugin),\n  renderLifeCycleService: renderLifeCycleServiceGenerator(plugin),\n});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { memo, useEffect, useRef, useState, type FC } from 'react';\n\nimport { type Message, type ContentType } from '@coze-common/chat-core';\nimport { MdBoxLazy } from '@coze-arch/bot-md-box-adapter/lazy';\n\ntype IProps = Record<'message', Message<ContentType>>;\n\n// export const BizMessageInnerAddonBottom: FC<IProps> = p =>\n//   p.message.role === 'assistant' && p.message.reasoning_content ? (\n//     <div className=\"my-[8px] px-[14px] border-solid border-[0] border-l-[0.25em] border-l-[var(--color-border-default)] text-[var(--color-fg-muted)]\">\n//       {p.message.reasoning_content}\n//     </div>\n//   ) : null;\n\nexport const BizMessageInnerAddonBottom: FC<IProps> = memo(\n  p => {\n    const [reasoningFinished, setReasoningFinished] = useState(false);\n    const ref = useRef(p.message.reasoning_content);\n\n    useEffect(() => {\n      setReasoningFinished(ref.current === p.message.reasoning_content);\n\n      return () => {\n        ref.current = p.message.reasoning_content;\n      };\n      // Content used to trigger reasoning rerender\n    }, [p.message.reasoning_content, p.message.content]);\n\n    return p.message.role === 'assistant' && p.message.reasoning_content ? (\n      <div className=\"my-[8px]\">\n        <MdBoxLazy\n          markDown={`${p.message.reasoning_content.replace(/^/gm, '> ')}`}\n          showIndicator={!p.message.is_finish && !reasoningFinished}\n        ></MdBoxLazy>\n      </div>\n    ) : null;\n  },\n  (prev, next) =>\n    prev.message.role === next.message.role &&\n    prev.message.is_finish === next.message.is_finish &&\n    prev.message.reasoning_content === next.message.reasoning_content &&\n    prev.message.content === next.message.content,\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  PluginMode,\n  PluginName,\n  ReadonlyChatAreaPlugin,\n  createReadonlyLifeCycleServices,\n  createCustomComponents,\n} from '@coze-common/chat-area';\n\nimport { type PluginBizContext } from './types/biz-context';\nimport { bizLifeCycleServiceGenerator } from './services/life-cycle';\nimport { BizMessageInnerAddonBottom } from './custom-components/message-inner-addon-bottom';\n\nexport class BizPlugin extends ReadonlyChatAreaPlugin<PluginBizContext> {\n  /**\n   * plugin type\n   * PluginMode. Readonly = read-only mode\n   * PluginMode. Writeable = Writable Mode\n   */\n  public pluginMode = PluginMode.Readonly;\n  /**\n   * plugin name\n   * Please click PluginName to define it.\n   */\n  public pluginName = PluginName.Demo;\n\n  /**\n   * lifecycle services\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public lifeCycleServices: any = createReadonlyLifeCycleServices(\n    this,\n    bizLifeCycleServiceGenerator,\n  );\n\n  /**\n   * custom component\n   */\n  public customComponents = createCustomComponents({\n    TextMessageInnerTopSlot: BizMessageInnerAddonBottom,\n  });\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type PluginRegistryEntry } from '@coze-common/chat-area';\n\nimport { type PluginBizContext } from './types/biz-context';\nimport { BizPlugin } from './plugin';\n\n// eslint-disable-next-line @typescript-eslint/naming-convention -- Plugin names start with uppercase as expected\nexport const ReasoningPluginRegistry: PluginRegistryEntry<PluginBizContext> = {\n  /**\n   * Context of components throughout the plug-in lifecycle\n   */\n  createPluginBizContext() {\n    return {};\n  },\n  /**\n   * plug-in ontology\n   */\n  Plugin: BizPlugin,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type Emitter } from 'mitt';\nimport { type BackgroundImageInfo } from '@coze-arch/bot-api/developer_api';\n\nimport { type BackgroundImageStore } from '../store';\n\nexport enum ChatBackgroundEventName {\n  OnBackgroundChange = 'onBackgroundChange',\n}\n// eslint-disable-next-line @typescript-eslint/consistent-type-definitions\nexport type ChatBackgroundEvent = {\n  [ChatBackgroundEventName.OnBackgroundChange]: BackgroundImageInfo;\n};\n\nexport interface BackgroundPluginBizContext {\n  storeSet: {\n    useChatBackgroundContext: BackgroundImageStore;\n  };\n  chatBackgroundEvent: Emitter<ChatBackgroundEvent>;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { devtools } from 'zustand/middleware';\nimport { create } from 'zustand';\nimport { type BackgroundImageInfo } from '@coze-arch/bot-api/developer_api';\n\ninterface BackgroundImageState {\n  backgroundImageInfo: BackgroundImageInfo;\n}\n\ninterface BackgroundImageAction {\n  setBackgroundInfo: (backgroundImageInfo: BackgroundImageInfo) => void;\n  clearBackgroundStore: () => void;\n}\n\nexport const createBackgroundImageStore = (mark: string) =>\n  create<BackgroundImageState & BackgroundImageAction>()(\n    devtools(\n      set => ({\n        backgroundImageInfo: {\n          mobile_background_image: {},\n          web_background_image: {},\n        },\n        clearBackgroundStore: () =>\n          set(\n            {\n              backgroundImageInfo: {\n                mobile_background_image: {},\n                web_background_image: {},\n              },\n            },\n            false,\n            'clearBackgroundStore',\n          ),\n        setBackgroundInfo: info => {\n          set({ backgroundImageInfo: info }, false, 'setBackgroundInfo');\n        },\n      }),\n      {\n        name: `botStudio.ChatBackground.${mark}`,\n        enabled: IS_DEV_MODE,\n      },\n    ),\n  );\n\nexport type BackgroundImageStore = ReturnType<\n  typeof createBackgroundImageStore\n>;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReadonlyAppLifeCycleServiceGenerator } from '@coze-common/chat-area';\n\nimport {\n  ChatBackgroundEventName,\n  type BackgroundPluginBizContext,\n} from '../../types/biz-context';\n\nexport const bizAppLifeCycleService: ReadonlyAppLifeCycleServiceGenerator<\n  BackgroundPluginBizContext\n> = plugin => ({\n  onBeforeInitial: () => {\n    const { chatBackgroundEvent, storeSet } = plugin.pluginBizContext;\n\n    const { setBackgroundInfo } = storeSet.useChatBackgroundContext.getState();\n\n    chatBackgroundEvent.on(\n      ChatBackgroundEventName.OnBackgroundChange,\n      backgroundInfo => {\n        setBackgroundInfo(backgroundInfo);\n      },\n    );\n  },\n\n  onAfterInitial: ctx => {\n    const { setBackgroundInfo, clearBackgroundStore } =\n      plugin.pluginBizContext.storeSet.useChatBackgroundContext.getState();\n    const ctxBackgroundInfo = ctx.messageListFromService.backgroundInfo;\n    if (ctxBackgroundInfo) {\n      setBackgroundInfo(ctxBackgroundInfo);\n    } else {\n      clearBackgroundStore();\n    }\n  },\n\n  onBeforeDestroy: () => {\n    const { chatBackgroundEvent } = plugin.pluginBizContext;\n    chatBackgroundEvent.all.clear();\n  },\n});\n","\n      import API from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./index.module.less\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./index.module.less\";\n       export default content && content.locals ? content.locals : undefined;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useShallow } from 'zustand/react/shallow';\nimport { WithRuleImgBackground } from '@coze-common/chat-uikit';\nimport {\n  type CustomComponent,\n  useReadonlyPlugin,\n  PluginName,\n} from '@coze-common/chat-area';\n\nimport { type BackgroundPluginBizContext } from '../../types/biz-context';\n\nimport styles from './index.module.less';\n\nexport const ChatBackgroundUI: CustomComponent['MessageListFloatSlot'] = ({\n  headerNode,\n}) => {\n  const plugin = useReadonlyPlugin<BackgroundPluginBizContext>(\n    PluginName.ChatBackground,\n  );\n  const { useChatBackgroundContext } = plugin.pluginBizContext.storeSet;\n  const backgroundImageInfo = useChatBackgroundContext(\n    useShallow(state => state.backgroundImageInfo),\n  );\n  const isBackgroundMode =\n    !!backgroundImageInfo?.mobile_background_image?.origin_image_url;\n\n  return isBackgroundMode ? (\n    <>\n      {headerNode ? <div className={styles.mask}></div> : null}\n      <WithRuleImgBackground backgroundInfo={backgroundImageInfo} />\n    </>\n  ) : null;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  PluginMode,\n  PluginName,\n  ReadonlyChatAreaPlugin,\n  createCustomComponents,\n  createReadonlyLifeCycleServices,\n  type ReadonlyLifeCycleServiceGenerator,\n} from '@coze-common/chat-area';\n\nimport { type BackgroundPluginBizContext } from './types/biz-context';\nimport { bizAppLifeCycleService } from './services/life-cycle/app';\nimport { ChatBackgroundUI } from './custom-components/chat-background-ui';\n\nexport const bizLifeCycleServiceGenerator: ReadonlyLifeCycleServiceGenerator<\n  BackgroundPluginBizContext\n> = plugin => ({\n  appLifeCycleService: bizAppLifeCycleService(plugin),\n});\n\nexport class BizPlugin extends ReadonlyChatAreaPlugin<BackgroundPluginBizContext> {\n  public pluginMode = PluginMode.Readonly;\n\n  public pluginName = PluginName.ChatBackground;\n\n  public lifeCycleServices = createReadonlyLifeCycleServices(\n    this,\n    bizLifeCycleServiceGenerator,\n  );\n\n  public customComponents = createCustomComponents({\n    MessageListFloatSlot: ChatBackgroundUI,\n  });\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport mitt from 'mitt';\nimport { type PluginRegistryEntry } from '@coze-common/chat-area';\n\nimport {\n  type BackgroundPluginBizContext,\n  type ChatBackgroundEvent,\n} from './types/biz-context';\nimport { createBackgroundImageStore } from './store';\nimport { BizPlugin } from './plugin';\n\nexport const chatBackgroundEvent = mitt<ChatBackgroundEvent>();\nexport {\n  ChatBackgroundEvent,\n  ChatBackgroundEventName,\n} from './types/biz-context';\n\nexport const createChatBackgroundPlugin = () => {\n  const useChatBackgroundContext = createBackgroundImageStore('chatBackground');\n\n  // eslint-disable-next-line @typescript-eslint/naming-convention -- Plugin names start with uppercase as expected\n  const ChatBackgroundPlugin: PluginRegistryEntry<BackgroundPluginBizContext> =\n    {\n      createPluginBizContext() {\n        return {\n          storeSet: {\n            useChatBackgroundContext,\n          },\n          chatBackgroundEvent,\n        };\n      },\n      Plugin: BizPlugin,\n    };\n  return {\n    ChatBackgroundPlugin,\n    chatBackgroundEvent,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type Emitter } from 'mitt';\nimport { type GrabNode } from '@coze-common/text-grab';\nimport {\n  type OnLinkElementContext,\n  type MessageSource,\n} from '@coze-common/chat-area';\n\nimport { type SelectionStore } from '../stores/selection';\nimport { type QuoteStore } from '../stores/quote';\nimport { type PreferenceStore } from '../stores/preference';\nimport { type Scene } from '../create';\n\nexport const enum EventNames {\n  OnViewScroll = 'onViewScroll',\n  OnMessageUpdate = 'onMessageUpdate',\n  OnLinkElementMouseEnter = 'onCardLinkElementMouseEnter',\n  OnLinkElementMouseLeave = 'onCardLinkElementMouseLeave',\n}\n\n// eslint-disable-next-line @typescript-eslint/consistent-type-definitions -- as expected\nexport type EventCenter = {\n  [EventNames.OnMessageUpdate]: unknown;\n  [EventNames.OnViewScroll]: unknown;\n  [EventNames.OnLinkElementMouseEnter]: OnLinkElementContext & {\n    type: 'link' | 'image';\n  };\n  [EventNames.OnLinkElementMouseLeave]: OnLinkElementContext & {\n    type: 'link' | 'image';\n  };\n};\n\nexport const enum PublicEventNames {\n  UpdateQuote = 'updateQuote',\n}\n\n// eslint-disable-next-line @typescript-eslint/consistent-type-definitions\nexport type PublicEventCenter = {\n  [PublicEventNames.UpdateQuote]: {\n    grabPluginId: string;\n    quote: GrabNode[] | null;\n  };\n};\n\nexport interface GrabPluginBizContext {\n  grabPluginId: string;\n  storeSet: {\n    useSelectionStore: SelectionStore;\n    useQuoteStore: QuoteStore;\n    usePreferenceStore: PreferenceStore;\n  };\n  eventCallbacks: EventCallbacks;\n  eventCenter: Emitter<EventCenter>;\n  publicEventCenter: Emitter<PublicEventCenter>;\n  unsubscribe: () => void;\n  scene?: Scene;\n}\n\nexport interface EventCallbacks {\n  onQuote?: ({\n    botId,\n    source,\n  }: {\n    botId: string;\n    source: MessageSource | undefined;\n  }) => void;\n  onQuoteChange?: ({ isEmpty }: { isEmpty: boolean }) => void;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { devtools } from 'zustand/middleware';\nimport { create } from 'zustand';\nimport {\n  type SelectionData,\n  type GrabNode,\n  type GrabPosition,\n} from '@coze-common/text-grab';\n\nexport interface SelectionState {\n  humanizedContentText: string;\n  originContentText: string;\n  normalizeSelectionNodeList: GrabNode[];\n  selectionData: SelectionData | null;\n  isFloatMenuVisible: boolean;\n  floatMenuPosition: GrabPosition | null;\n}\n\nexport interface SelectionAction {\n  updateHumanizedContentText: (text: string) => void;\n  updateOriginContentText: (text: string) => void;\n  updateNormalizeSelectionNodeList: (nodeList: GrabNode[]) => void;\n  updateSelectionData: (selectionData: SelectionData | null) => void;\n  updateIsFloatMenuVisible: (visible: boolean) => void;\n  updateFloatMenuPosition: (position: GrabPosition | null) => void;\n  clearStore: () => void;\n}\n\nexport const createSelectionStore = (mark: string) => {\n  const useSelectionStore = create<SelectionState & SelectionAction>()(\n    devtools(\n      (set, get) => ({\n        humanizedContentText: '',\n        originContentText: '',\n        normalizeSelectionNodeList: [],\n        selectionData: null,\n        isFloatMenuVisible: false,\n        floatMenuPosition: null,\n        updateHumanizedContentText: text => {\n          set({\n            humanizedContentText: text,\n          });\n        },\n        updateOriginContentText: text => {\n          set({\n            originContentText: text,\n          });\n        },\n        updateNormalizeSelectionNodeList: nodeList => {\n          set({\n            normalizeSelectionNodeList: nodeList,\n          });\n        },\n        updateIsFloatMenuVisible: visible => {\n          set({\n            isFloatMenuVisible: visible,\n          });\n        },\n        updateSelectionData: selectionData => {\n          set({\n            selectionData,\n          });\n        },\n        updateFloatMenuPosition: position => {\n          set({\n            floatMenuPosition: position,\n          });\n        },\n        clearStore: () => {\n          set({\n            humanizedContentText: '',\n            originContentText: '',\n            normalizeSelectionNodeList: [],\n            selectionData: null,\n          });\n        },\n      }),\n      {\n        name: `botStudio.ChatAreaGrabPlugin.SelectionStore.${mark}`,\n        enabled: IS_DEV_MODE,\n      },\n    ),\n  );\n\n  return useSelectionStore;\n};\n\nexport type SelectionStore = ReturnType<typeof createSelectionStore>;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { devtools, subscribeWithSelector } from 'zustand/middleware';\nimport { create } from 'zustand';\nimport { produce } from 'immer';\nimport { type GrabNode } from '@coze-common/text-grab';\n\nimport { type EventCallbacks } from '../types/plugin-biz-context';\n\nexport interface QuoteState {\n  quoteContent: GrabNode[] | null;\n  quoteVisible: boolean;\n  quoteContentMap: Record<string, GrabNode[]>;\n}\n\nexport interface QuoteAction {\n  updateQuoteContent: (quote: GrabNode[] | null) => void;\n  updateQuoteContentMapByImmer: (\n    updater: (quoteContentMap: Record<string, GrabNode[]>) => void,\n  ) => void;\n  updateQuoteVisible: (visible: boolean) => void;\n  clearStore: () => void;\n}\n\nexport const createQuoteStore = (mark: string) => {\n  const useQuoteStore = create<QuoteState & QuoteAction>()(\n    devtools(\n      subscribeWithSelector(set => ({\n        quoteContent: null,\n        quoteVisible: false,\n        quoteContentMap: {},\n        updateQuoteContent: quote => {\n          set({\n            quoteContent: quote,\n          });\n        },\n        updateQuoteContentMapByImmer: updater => {\n          set(produce<QuoteState>(state => updater(state.quoteContentMap)));\n        },\n        updateQuoteVisible: visible => {\n          set({\n            quoteVisible: visible,\n          });\n        },\n        clearStore: () => {\n          set({\n            quoteContent: null,\n            quoteVisible: false,\n          });\n        },\n      })),\n      {\n        name: `botStudio.ChatAreaGrabPlugin.Quote.${mark}`,\n        enabled: IS_DEV_MODE,\n      },\n    ),\n  );\n\n  return useQuoteStore;\n};\n\nexport type QuoteStore = ReturnType<typeof createQuoteStore>;\n\nexport const subscribeQuoteUpdate = (\n  store: {\n    useQuoteStore: QuoteStore;\n  },\n  eventCallbacks: EventCallbacks,\n) => {\n  const { useQuoteStore } = store;\n\n  return useQuoteStore.subscribe(\n    state => state.quoteContent,\n    quoteContent => {\n      const { onQuoteChange } = eventCallbacks;\n      onQuoteChange?.({ isEmpty: !quoteContent });\n    },\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { devtools, subscribeWithSelector } from 'zustand/middleware';\nimport { create } from 'zustand';\n\nexport interface PreferenceState {\n  enableGrab: boolean;\n}\n\nexport interface PreferenceAction {\n  updateEnableGrab: (enable: boolean) => void;\n}\n\nexport const createPreferenceStore = (mark: string) => {\n  const usePreferenceStore = create<PreferenceState & PreferenceAction>()(\n    devtools(\n      subscribeWithSelector(set => ({\n        enableGrab: false,\n        updateEnableGrab: enable => {\n          set({\n            enableGrab: enable,\n          });\n        },\n      })),\n      {\n        name: `botStudio.ChatAreaGrabPlugin.Preference.${mark}`,\n        enabled: IS_DEV_MODE,\n      },\n    ),\n  );\n\n  return usePreferenceStore;\n};\n\nexport type PreferenceStore = ReturnType<typeof createPreferenceStore>;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getOriginContentText } from '@coze-common/text-grab';\nimport {\n  ContentType,\n  type OnBeforeAppendSenderMessageIntoStore,\n  WriteableMessageLifeCycleService,\n  type OnAfterAppendSenderMessageIntoStore,\n} from '@coze-common/chat-area';\n\nimport {\n  EventNames,\n  type GrabPluginBizContext,\n} from '../../types/plugin-biz-context';\n\nexport class GrabMessageLifeCycleService extends WriteableMessageLifeCycleService<GrabPluginBizContext> {\n  onBeforeAppendSenderMessageIntoStore(\n    ctx: OnBeforeAppendSenderMessageIntoStore,\n  ) {\n    const { quoteContent, updateQuoteContentMapByImmer } =\n      this.pluginInstance.pluginBizContext.storeSet.useQuoteStore.getState();\n\n    if (!quoteContent || ctx.from === 'shortcut') {\n      return ctx;\n    }\n\n    const originMessage = ctx.message;\n\n    const newContent = {\n      item_list: [\n        {\n          type: 'text',\n          text: originMessage.content,\n        },\n      ],\n      refer_items: [] as unknown[],\n    };\n\n    newContent.refer_items.push({\n      type: ContentType.Text,\n      text: getOriginContentText(quoteContent),\n    });\n\n    const newMessage = {\n      ...originMessage,\n      content_type: ContentType.Mix,\n      content: JSON.stringify(newContent),\n      content_obj: newContent,\n    };\n\n    updateQuoteContentMapByImmer(quoteContentMap => {\n      const localMessageId = newMessage.extra_info.local_message_id;\n      if (!quoteContentMap[localMessageId]) {\n        quoteContentMap[localMessageId] = quoteContent;\n      }\n    });\n\n    return {\n      ...ctx,\n      message: newMessage,\n    };\n  }\n\n  onAfterAppendSenderMessageIntoStore(\n    ctx: OnAfterAppendSenderMessageIntoStore,\n  ) {\n    if (ctx.from === 'shortcut') {\n      return;\n    }\n\n    const { storeSet } = this.pluginInstance.pluginBizContext;\n    const { updateQuoteVisible, updateQuoteContent } =\n      storeSet.useQuoteStore.getState();\n    updateQuoteVisible(false);\n    updateQuoteContent(null);\n\n    return;\n  }\n\n  onAfterProcessReceiveMessage() {\n    const { emit } = this.pluginInstance.pluginBizContext.eventCenter;\n    emit(EventNames.OnMessageUpdate);\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type OnImageElementContext,\n  WriteableCommandLifeCycleService,\n  type OnLinkElementContext,\n} from '@coze-common/chat-area';\n\nimport {\n  EventNames,\n  type GrabPluginBizContext,\n} from '../../types/plugin-biz-context';\n\nexport class GrabCommandLifeCycleService extends WriteableCommandLifeCycleService<GrabPluginBizContext> {\n  onViewScroll(): void {\n    const { emit } = this.pluginInstance.pluginBizContext.eventCenter;\n    emit(EventNames.OnViewScroll);\n  }\n  onCardLinkElementMouseEnter(ctx: OnLinkElementContext) {\n    const { emit } = this.pluginInstance.pluginBizContext.eventCenter;\n    emit(EventNames.OnLinkElementMouseEnter, {\n      ...ctx,\n      type: 'image',\n    });\n  }\n  onCardLinkElementMouseLeave(ctx: OnLinkElementContext) {\n    const { emit } = this.pluginInstance.pluginBizContext.eventCenter;\n    emit(EventNames.OnLinkElementMouseLeave, {\n      ...ctx,\n      type: 'image',\n    });\n  }\n  onMdBoxImageElementMouseEnter(ctx: OnImageElementContext): void {\n    const { emit } = this.pluginInstance.pluginBizContext.eventCenter;\n    emit(EventNames.OnLinkElementMouseEnter, {\n      ...ctx,\n      type: 'image',\n    });\n  }\n  onMdBoxImageElementMouseLeave(ctx: OnImageElementContext): void {\n    const { emit } = this.pluginInstance.pluginBizContext.eventCenter;\n    emit(EventNames.OnLinkElementMouseLeave, {\n      ...ctx,\n      type: 'image',\n    });\n  }\n  onMdBoxLinkElementMouseEnter(ctx: OnLinkElementContext): void {\n    const { emit } = this.pluginInstance.pluginBizContext.eventCenter;\n    emit(EventNames.OnLinkElementMouseEnter, {\n      ...ctx,\n      type: 'link',\n    });\n  }\n  onMdBoxLinkElementMouseLeave(ctx: OnLinkElementContext): void {\n    const { emit } = this.pluginInstance.pluginBizContext.eventCenter;\n    emit(EventNames.OnLinkElementMouseLeave, {\n      ...ctx,\n      type: 'link',\n    });\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type GrabNode } from '@coze-common/text-grab';\nimport { WriteableAppLifeCycleService } from '@coze-common/chat-area';\n\nimport {\n  PublicEventNames,\n  type GrabPluginBizContext,\n} from '../../types/plugin-biz-context';\n\nexport class GrabAppLifeCycleService extends WriteableAppLifeCycleService<GrabPluginBizContext> {\n  onBeforeDestroy(): void {\n    const { unsubscribe, eventCenter, publicEventCenter, scene } =\n      this.pluginInstance.pluginBizContext;\n\n    // There are some problems with the Store history logic, which leads to the situation that destroy is called multiple times but not initialized. Instead of going through the following forced cleaning process, the component life cycle is destroyed.\n    if (scene === 'store') {\n      return;\n    }\n\n    unsubscribe();\n    eventCenter.all.clear();\n    publicEventCenter.all.clear();\n  }\n  onBeforeInitial(): void {\n    const {\n      publicEventCenter,\n      grabPluginId: currentGrabPluginId,\n      storeSet,\n    } = this.pluginInstance.pluginBizContext;\n\n    const { useQuoteStore } = storeSet;\n\n    const { updateQuoteContent, updateQuoteVisible } = useQuoteStore.getState();\n\n    publicEventCenter.on(\n      PublicEventNames.UpdateQuote,\n      ({\n        grabPluginId,\n        quote,\n      }: {\n        grabPluginId: string;\n        quote: GrabNode[] | null;\n      }) => {\n        if (currentGrabPluginId !== grabPluginId) {\n          return;\n        }\n\n        updateQuoteContent(quote);\n        updateQuoteVisible(true);\n      },\n    );\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type ChatAreaPluginContext,\n  type PluginMode,\n} from '@coze-common/chat-area';\n\nexport const getMessage = ({\n  messageId,\n  chatAreaPluginContext,\n}: {\n  messageId: string;\n  chatAreaPluginContext: ChatAreaPluginContext<PluginMode.Writeable>;\n}) => {\n  if (!messageId) {\n    return;\n  }\n\n  const message =\n    chatAreaPluginContext.readonlyAPI.message.findMessage(messageId);\n\n  return message;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { useShallow } from 'zustand/react/shallow';\nimport { PluginName, useWriteablePlugin } from '@coze-common/chat-area';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozQuotation } from '@coze-arch/coze-design/icons';\nimport { IconButton, Tooltip } from '@coze-arch/coze-design';\n\nimport { getMessage } from '../../utils/get-message';\nimport { type GrabPluginBizContext } from '../../types/plugin-biz-context';\n\nexport interface QuoteButtonProps {\n  onClose?: () => void;\n  onClick?: () => void;\n}\n\nexport const QuoteButton: FC<QuoteButtonProps> = ({ onClose, onClick }) => {\n  const { pluginBizContext, chatAreaPluginContext } =\n    useWriteablePlugin<GrabPluginBizContext>(PluginName.MessageGrab);\n\n  const { onQuote } = pluginBizContext.eventCallbacks;\n\n  const { useQuoteStore, useSelectionStore, usePreferenceStore } =\n    pluginBizContext.storeSet;\n\n  const { updateQuoteContent, updateQuoteVisible } = useQuoteStore(\n    useShallow(state => ({\n      updateQuoteVisible: state.updateQuoteVisible,\n      updateQuoteContent: state.updateQuoteContent,\n    })),\n  );\n\n  const enableGrab = usePreferenceStore(state => state.enableGrab);\n\n  const { useDeleteFile } = chatAreaPluginContext.writeableHook.file;\n  const { getFileStoreInstantValues } =\n    chatAreaPluginContext.readonlyAPI.batchFile;\n\n  const deleteFile = useDeleteFile();\n\n  const deleteAllFile = () => {\n    const { fileIdList } = getFileStoreInstantValues();\n\n    fileIdList.forEach(id => deleteFile(id));\n  };\n\n  const getMessageInfo = () => {\n    const { selectionData } = useSelectionStore.getState();\n\n    const messageId = selectionData?.ancestorAttributeValue;\n\n    if (!messageId) {\n      return;\n    }\n\n    return getMessage({ messageId, chatAreaPluginContext });\n  };\n\n  const handleClick = () => {\n    deleteAllFile();\n\n    if (onClick) {\n      onClick();\n      onClose?.();\n      return;\n    }\n\n    const { normalizeSelectionNodeList } = useSelectionStore.getState();\n\n    updateQuoteContent(normalizeSelectionNodeList);\n\n    updateQuoteVisible(true);\n\n    const message = getMessageInfo();\n\n    onQuote?.({ botId: message?.sender_id ?? '', source: message?.source });\n\n    onClose?.();\n  };\n\n  if (!enableGrab) {\n    return null;\n  }\n\n  return (\n    <Tooltip content={I18n.t('quote_ask_in_chat')} clickToHide={true}>\n      <IconButton\n        icon={<IconCozQuotation className=\"text-lg coz-fg-secondary\" />}\n        color=\"secondary\"\n        onClick={handleClick}\n        size=\"small\"\n        wrapperClass=\"flex justify-center items-center\"\n      />\n    </Tooltip>\n  );\n};\n","\n      import API from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./index.module.less\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./index.module.less\";\n       export default content && content.locals ? content.locals : undefined;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type ReactNode,\n  forwardRef,\n  type CSSProperties,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  type MutableRefObject,\n  useState,\n} from 'react';\n\nimport classNames from 'classnames';\nimport { useEventCallback } from '@coze-common/chat-hooks';\nimport { PluginName, useWriteablePlugin } from '@coze-common/chat-area';\n\nimport {\n  EventNames,\n  type GrabPluginBizContext,\n} from '../../types/plugin-biz-context';\n\nimport s from './index.module.less';\n\ninterface MenuListProps {\n  style?: CSSProperties;\n  children: ReactNode;\n  className?: string;\n  onScroll?: () => void;\n  onMouseEnter?: () => void;\n  onMouseLeave?: () => void;\n}\n\nexport interface MenuListRef {\n  getRef: () => MutableRefObject<HTMLDivElement | null>;\n  refreshOpacity: () => void;\n}\n\nconst GRADIENT_RANGE = 100;\n\nexport const MenuList = forwardRef<MenuListRef, MenuListProps>((props, ref) => {\n  const plugin = useWriteablePlugin<GrabPluginBizContext>(\n    PluginName.MessageGrab,\n  );\n\n  const { useGetScrollView } =\n    plugin.chatAreaPluginContext.readonlyHook.scrollView;\n\n  const { on, off } = plugin.pluginBizContext.eventCenter;\n  const { style, children, onScroll, onMouseEnter, onMouseLeave, className } =\n    props;\n\n  const getScrollView = useGetScrollView();\n\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  const [opacity, setOpacity] = useState(1);\n\n  useImperativeHandle(ref, () => ({\n    getRef: () => menuRef,\n    refreshOpacity,\n  }));\n\n  const refreshOpacity = useEventCallback(() => {\n    onScroll?.();\n\n    const localRect = menuRef.current?.getBoundingClientRect();\n\n    const { rect: scrollRect } = getScrollView().getOriginScrollInfo();\n\n    if (!scrollRect || !localRect) {\n      return;\n    }\n\n    if (localRect.y - GRADIENT_RANGE <= scrollRect.top) {\n      const _opacity = (localRect.y - scrollRect.top) / GRADIENT_RANGE;\n      setOpacity(_opacity < 0 ? 0 : _opacity);\n    } else if (localRect.y + GRADIENT_RANGE >= scrollRect.bottom) {\n      const _opacity = (scrollRect.bottom - localRect.y) / GRADIENT_RANGE;\n      setOpacity(_opacity < 0 ? 0 : _opacity);\n    } else {\n      setOpacity(1);\n    }\n  });\n\n  useEffect(() => {\n    on(EventNames.OnMessageUpdate, refreshOpacity);\n    return () => {\n      off(EventNames.OnMessageUpdate, refreshOpacity);\n    };\n  }, []);\n\n  return (\n    <div\n      className={classNames(\n        'fixed p-[2px] coz-bg-max coz-stroke-primary border-[0.5px] rounded-[8px] overflow-hidden grid grid-flow-col gap-[2px] h-[28px]',\n        s['container-box-shadow'],\n        className,\n      )}\n      style={{\n        ...style,\n        opacity,\n      }}\n      ref={menuRef}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n    >\n      {children}\n    </div>\n  );\n});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { messageSource } from '@coze-common/chat-area';\n\nexport const FILTER_MESSAGE_SOURCE: number[] = [messageSource.Notice];\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useRef } from 'react';\n\nimport { useShallow } from 'zustand/react/shallow';\nimport { defer } from 'lodash-es';\nimport classNames from 'classnames';\nimport { type GrabPosition, type SelectionData } from '@coze-common/text-grab';\nimport { useGrab } from '@coze-common/text-grab';\nimport { NO_MESSAGE_ID_MARK } from '@coze-common/chat-uikit';\nimport {\n  PluginName,\n  useWriteablePlugin,\n  type MessageListFloatSlot,\n} from '@coze-common/chat-area';\n\nimport { QuoteButton } from '../quote-button';\nimport { MenuList, type MenuListRef } from '../menu-list';\nimport {\n  EventNames,\n  type GrabPluginBizContext,\n} from '../../types/plugin-biz-context';\nimport { FILTER_MESSAGE_SOURCE } from '../../constants/filter-message';\n\nexport const GrabMenu: MessageListFloatSlot = ({ contentRef }) => {\n  // Get plugin instance\n  const plugin = useWriteablePlugin<GrabPluginBizContext>(\n    PluginName.MessageGrab,\n  );\n\n  // Get business context information for the plug-in\n  const { pluginBizContext } = plugin;\n  const { eventCenter, storeSet } = pluginBizContext;\n  const { usePreferenceStore, useSelectionStore } = storeSet;\n\n  // Event Center Listener Function\n  const { on, off } = eventCenter;\n\n  /**\n   * Floating Menu Ref\n   */\n  const floatMenuRef = useRef<MenuListRef>(null);\n\n  const { isFloatMenuVisible, position, updateFloatMenuPosition } =\n    useSelectionStore(\n      useShallow(state => ({\n        isFloatMenuVisible: state.isFloatMenuVisible,\n        position: state.floatMenuPosition,\n        updateFloatMenuPosition: state.updateFloatMenuPosition,\n      })),\n    );\n\n  /**\n   * Whether to enable the Grab plugin\n   */\n  const enableGrab = usePreferenceStore(state => state.enableGrab);\n\n  /**\n   * Callbacks to handle location information\n   */\n  const handlePositionChange = (_position: GrabPosition | null) => {\n    // Update Floating Menu Data in Store\n    updateFloatMenuPosition(_position);\n\n    // Call the refresh logic after clearing the stack (because the floatMenu is in the hidden state, the rect information obtained through ref is empty, so it needs to be delayed for a while)\n    defer(() => floatMenuRef.current?.refreshOpacity());\n  };\n\n  /**\n   * Handling changes in constituencies\n   */\n  const handleSelectChange = (selectionData: SelectionData | null) => {\n    const {\n      updateHumanizedContentText,\n      updateNormalizeSelectionNodeList,\n      updateOriginContentText,\n      updateSelectionData,\n      updateIsFloatMenuVisible,\n    } = plugin.pluginBizContext.storeSet.useSelectionStore.getState();\n\n    /**\n     * Filtering for special types of messages\n     * Currently only judged by the source messageSource\n     * 1. Notification type (no selection)\n     */\n    if (\n      selectionData &&\n      FILTER_MESSAGE_SOURCE.includes(selectionData.messageSource)\n    ) {\n      return;\n    }\n\n    // Update constituency data\n    updateSelectionData(selectionData);\n\n    // Update the status of displaying the floating menu\n    updateIsFloatMenuVisible(!!selectionData);\n\n    // Get MessageId\n    const messageId = selectionData?.ancestorAttributeValue;\n\n    // Determine whether it is a special message\n    const isSpecialMessage = messageId === NO_MESSAGE_ID_MARK;\n\n    // If you can't get the message ID, it proves that the constituency is not in the message.\n    if (!messageId) {\n      return;\n    }\n\n    // Special processing, you need to determine whether it is a message in the reply.\n    const { is_finish } =\n      plugin.chatAreaPluginContext.readonlyAPI.message.findMessage(messageId) ??\n      {};\n\n    // If the message reply is not completed, and it is not a special message, then it will not be displayed, otherwise it will be displayed\n    if (!is_finish && !isSpecialMessage) {\n      updateIsFloatMenuVisible(false);\n      return;\n    }\n\n    updateHumanizedContentText(selectionData?.humanizedContentText ?? '');\n    updateNormalizeSelectionNodeList(\n      selectionData?.normalizeSelectionNodeList ?? [],\n    );\n    updateOriginContentText(selectionData?.originContentText ?? '');\n  };\n\n  const { clearSelection, isScrolling, computePosition } = useGrab({\n    contentRef,\n    floatMenuRef: floatMenuRef.current?.getRef(),\n    onSelectChange: handleSelectChange,\n    onPositionChange: handlePositionChange,\n  });\n\n  const isShowFloatMenu = !!position && isFloatMenuVisible;\n\n  useEffect(() => {\n    on(EventNames.OnMessageUpdate, computePosition);\n    on(EventNames.OnViewScroll, computePosition);\n\n    return () => {\n      off(EventNames.OnMessageUpdate, computePosition);\n      off(EventNames.OnViewScroll, computePosition);\n    };\n  }, []);\n\n  // If the Grab plugin is not enabled, it will be hidden, of course.\n  if (!enableGrab) {\n    return null;\n  }\n\n  return (\n    <MenuList\n      ref={floatMenuRef}\n      style={{\n        top: position?.y,\n        left: position?.x,\n      }}\n      className={classNames({\n        hidden: !isShowFloatMenu || isScrolling,\n      })}\n    >\n      <QuoteButton onClose={clearSelection} />\n    </MenuList>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type MutableRefObject, useEffect, useRef, useState } from 'react';\n\nimport {\n  CONTENT_ATTRIBUTE_NAME,\n  MESSAGE_SOURCE_ATTRIBUTE_NAME,\n  getAncestorAttributeNode,\n} from '@coze-common/text-grab';\n\nimport { FILTER_MESSAGE_SOURCE } from '../constants/filter-message';\n\ninterface HideQuoteProps<T> {\n  containerRef?: MutableRefObject<T | null>;\n}\n\nexport const useHideQuote = <T extends Element>(props?: HideQuoteProps<T>) => {\n  const containerRef = useRef<T | null>(null);\n  const targetRef = useRef<Element | null>(null);\n\n  const usedContainerRef = props?.containerRef?.current\n    ? props.containerRef\n    : containerRef;\n\n  const [forceHidden, setForceHidden] = useState(false);\n\n  useEffect(() => {\n    const target = getAncestorAttributeNode(\n      usedContainerRef.current,\n      CONTENT_ATTRIBUTE_NAME,\n    );\n\n    const messageSource = target?.attributes.getNamedItem(\n      MESSAGE_SOURCE_ATTRIBUTE_NAME,\n    )?.value;\n\n    if (FILTER_MESSAGE_SOURCE.includes(Number(messageSource))) {\n      setForceHidden(true);\n    }\n\n    targetRef.current = target;\n\n    return () => {\n      setForceHidden(false);\n      targetRef.current = null;\n    };\n  }, [usedContainerRef.current]);\n\n  return { targetRef, containerRef: usedContainerRef, forceHidden };\n};\n","import baseDelay from './_baseDelay.js';\nimport baseRest from './_baseRest.js';\nimport toNumber from './toNumber.js';\n\n/**\n * Invokes `func` after `wait` milliseconds. Any additional arguments are\n * provided to `func` when it's invoked.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to delay.\n * @param {number} wait The number of milliseconds to delay invocation.\n * @param {...*} [args] The arguments to invoke `func` with.\n * @returns {number} Returns the timer id.\n * @example\n *\n * _.delay(function(text) {\n *   console.log(text);\n * }, 1000, 'later');\n * // => Logs 'later' after one second.\n */\nvar delay = baseRest(function(func, wait, args) {\n  return baseDelay(func, toNumber(wait) || 0, args);\n});\n\nexport default delay;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type GrabPosition } from '@coze-common/text-grab';\n\nconst BUFFER_SIZE = 5;\n\nexport const getMouseNearbyRect = (\n  rects: DOMRect[],\n  mouseInfo: GrabPosition,\n) => {\n  let nearbyRect = rects.at(0);\n  for (const rect of rects) {\n    if (\n      mouseInfo.x >= rect.left - BUFFER_SIZE &&\n      mouseInfo.x <= rect.right + BUFFER_SIZE &&\n      mouseInfo.y >= rect.top - BUFFER_SIZE &&\n      mouseInfo.y <= rect.bottom + BUFFER_SIZE\n    ) {\n      nearbyRect = rect;\n    }\n  }\n\n  return nearbyRect;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useRef, useState } from 'react';\n\nimport { defer, delay } from 'lodash-es';\nimport {\n  CONTENT_ATTRIBUTE_NAME,\n  getAncestorAttributeNode,\n  type GrabPosition,\n} from '@coze-common/text-grab';\nimport { NO_MESSAGE_ID_MARK } from '@coze-common/chat-uikit';\nimport { useEventCallback } from '@coze-common/chat-hooks';\nimport {\n  type OnLinkElementContext,\n  type useWriteablePlugin,\n} from '@coze-common/chat-area';\n\nimport { getMouseNearbyRect } from '../utils/get-mouse-nearby-rect';\nimport {\n  EventNames,\n  type GrabPluginBizContext,\n} from '../types/plugin-biz-context';\nimport { type MenuListRef } from '../custom-components/menu-list';\n\nconst DELAY_DISAPPEAR_TIME = 100;\nconst TIMEOUT = 100;\n// eslint-disable-next-line max-lines-per-function, @coze-arch/max-line-per-function\nexport const useFloatMenuListener = ({\n  plugin,\n}: {\n  plugin: ReturnType<typeof useWriteablePlugin<GrabPluginBizContext>>;\n}) => {\n  const floatMenuRef = useRef<MenuListRef>(null);\n\n  const [visible, setVisible] = useState(false);\n\n  const targetElement = useRef<HTMLElement | null>(null);\n  const targetInfo = useRef<{\n    source: string;\n    type: 'image' | 'link';\n    text: string;\n  } | null>(null);\n\n  /**\n   * In Scrolling\n   */\n  const [isScrolling, setIsScrolling] = useState(false);\n\n  /**\n   * Scrolling timer\n   */\n  const scrollingTimer = useRef<NodeJS.Timeout | null>(null);\n\n  const { pluginBizContext } = plugin;\n  const { eventCenter } = pluginBizContext;\n  const { on, off } = eventCenter;\n\n  const isMouseInMenu = useRef(false);\n  const [position, setPosition] = useState<GrabPosition | null>(null);\n  const timer = useRef<number | null>(null);\n\n  const mouseInfo = useRef<GrabPosition>({ x: 0, y: 0 });\n\n  const handleMenuMouseEnter = useEventCallback(() => {\n    isMouseInMenu.current = true;\n    if (timer.current) {\n      clearTimeout(timer.current);\n    }\n  });\n\n  const handleMenuMouseLeave = useEventCallback(() => {\n    isMouseInMenu.current = false;\n    handleCardLinkElementMouseLeave();\n  });\n\n  const isMessageFinished = () => {\n    const target = getAncestorAttributeNode(\n      targetElement.current,\n      CONTENT_ATTRIBUTE_NAME,\n    );\n\n    const messageId = target?.attributes.getNamedItem(\n      CONTENT_ATTRIBUTE_NAME,\n    )?.value;\n\n    const isSpecialMessage = messageId === NO_MESSAGE_ID_MARK;\n\n    if (isSpecialMessage) {\n      return true;\n    }\n\n    if (!messageId) {\n      return false;\n    }\n\n    const { is_finish } =\n      plugin.chatAreaPluginContext.readonlyAPI.message.findMessage(messageId) ??\n      {};\n\n    return is_finish;\n  };\n\n  const handleCardLinkElementMouseEnter = useEventCallback(\n    (ctx: OnLinkElementContext & { type: 'link' | 'image' }) => {\n      if (timer.current) {\n        clearTimeout(timer.current);\n        timer.current = null;\n      }\n      targetElement.current = ctx.element;\n      targetInfo.current = {\n        source: ctx.link,\n        type: ctx.type,\n        text: ctx.element.textContent ?? '',\n      };\n\n      const isFinished = isMessageFinished();\n\n      if (!isFinished) {\n        return;\n      }\n\n      setVisible(true);\n      handleViewScroll();\n\n      defer(() => {\n        floatMenuRef.current?.refreshOpacity();\n      });\n    },\n  );\n\n  const handleCardLinkElementMouseLeave = useEventCallback(() => {\n    timer.current = delay(() => {\n      if (isMouseInMenu.current) {\n        return;\n      }\n      targetElement.current = null;\n      setVisible(false);\n    }, DELAY_DISAPPEAR_TIME);\n  });\n\n  const handleViewScroll = useEventCallback(() => {\n    const menuRef = floatMenuRef.current?.getRef();\n\n    if (\n      !targetElement.current ||\n      !menuRef ||\n      !menuRef.current ||\n      !targetInfo.current\n    ) {\n      return;\n    }\n\n    const target = targetElement.current;\n    const targetRect = target.getBoundingClientRect();\n    const menuRect = menuRef.current.getBoundingClientRect();\n    let x = 0;\n    let y = 0;\n    if (targetInfo.current.type === 'image') {\n      x = targetRect.right;\n      y = targetRect.bottom - targetRect.height / 2 - menuRect.height / 2;\n    } else {\n      const targetRects = target.getClientRects();\n\n      const nearbyRect =\n        getMouseNearbyRect(Array.from(targetRects), mouseInfo.current) ??\n        targetRect;\n\n      x = mouseInfo.current.x;\n      y = nearbyRect.bottom;\n    }\n\n    setPosition({ x, y });\n  });\n\n  const handleMouseMove = useEventCallback((event: MouseEvent) => {\n    const [x, y] = [event.clientX, event.clientY];\n    mouseInfo.current = { x, y };\n  });\n\n  const handleSmartScreenChange = useEventCallback(() => {\n    if (scrollingTimer.current) {\n      clearTimeout(scrollingTimer.current);\n    }\n\n    setIsScrolling(true);\n    scrollingTimer.current = setTimeout(() => {\n      handleViewScroll();\n      setIsScrolling(false);\n    }, TIMEOUT);\n  });\n\n  useEffect(() => {\n    on(EventNames.OnLinkElementMouseEnter, handleCardLinkElementMouseEnter);\n    on(EventNames.OnLinkElementMouseLeave, handleCardLinkElementMouseLeave);\n    on(EventNames.OnViewScroll, handleSmartScreenChange);\n    on(EventNames.OnMessageUpdate, handleSmartScreenChange);\n    window.addEventListener('mousemove', handleMouseMove);\n    window.addEventListener('resize', handleSmartScreenChange);\n    window.addEventListener('wheel', handleSmartScreenChange);\n    window.addEventListener('scroll', handleSmartScreenChange);\n\n    return () => {\n      off(EventNames.OnLinkElementMouseEnter, handleCardLinkElementMouseEnter);\n      off(EventNames.OnLinkElementMouseLeave, handleCardLinkElementMouseLeave);\n      off(EventNames.OnViewScroll, handleSmartScreenChange);\n      off(EventNames.OnMessageUpdate, handleSmartScreenChange);\n      window.removeEventListener('mousemove', handleMouseMove);\n      window.removeEventListener('resize', handleSmartScreenChange);\n      window.removeEventListener('wheel', handleSmartScreenChange);\n      window.removeEventListener('scroll', handleSmartScreenChange);\n    };\n  }, []);\n\n  return {\n    handleMenuMouseEnter,\n    handleMenuMouseLeave,\n    targetElement,\n    targetInfo,\n    position,\n    floatMenuRef,\n    visible,\n    setVisible,\n    computePosition: handleSmartScreenChange,\n    isScrolling,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type MutableRefObject,\n  useEffect,\n  useState,\n  type RefObject,\n} from 'react';\n\nimport { defer } from 'lodash-es';\nimport { type GrabPosition } from '@coze-common/text-grab';\n\nimport { type MenuListRef } from '../custom-components/menu-list';\n\nexport const useAutoGetMaxPosition = ({\n  position,\n  messageRef,\n  floatMenuRef,\n}: {\n  position: GrabPosition | null;\n  messageRef: MutableRefObject<Element | null>;\n  floatMenuRef: RefObject<MenuListRef>;\n}) => {\n  const [maxPositionX, setMaxPositionX] = useState(0);\n\n  useEffect(() => {\n    const maxX = messageRef.current?.getBoundingClientRect().right ?? 0;\n    setMaxPositionX(maxX);\n    defer(() => floatMenuRef.current?.refreshOpacity());\n  }, [position, messageRef.current, floatMenuRef.current]);\n\n  return { maxPositionX };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\n\nimport { useShallow } from 'zustand/react/shallow';\nimport { defer } from 'lodash-es';\nimport classNames from 'classnames';\nimport { isTouchDevice } from '@coze-common/text-grab';\nimport {\n  CONTENT_ATTRIBUTE_NAME,\n  GrabElementType,\n  type GrabNode,\n} from '@coze-common/text-grab';\nimport {\n  PluginName,\n  useWriteablePlugin,\n  type MessageListFloatSlot,\n} from '@coze-common/chat-area';\n\nimport { QuoteButton } from '../quote-button';\nimport { MenuList } from '../menu-list';\nimport { getMessage } from '../../utils/get-message';\nimport {\n  EventNames,\n  type GrabPluginBizContext,\n} from '../../types/plugin-biz-context';\nimport { useHideQuote } from '../../hooks/use-hide-quote';\nimport { useFloatMenuListener } from '../../hooks/use-float-menu-listener';\nimport { useAutoGetMaxPosition } from '../../hooks/use-auto-get-max-position';\n\nexport const FloatMenu: MessageListFloatSlot = () => {\n  const plugin = useWriteablePlugin<GrabPluginBizContext>(\n    PluginName.MessageGrab,\n  );\n  const { chatAreaPluginContext, pluginBizContext } = plugin;\n  const { eventCenter } = pluginBizContext;\n  const { usePreferenceStore } = pluginBizContext.storeSet;\n  const enableGrab = usePreferenceStore(state => state.enableGrab);\n\n  const { on, off } = eventCenter;\n\n  const { useQuoteStore } = pluginBizContext.storeSet;\n  const { updateQuoteContent, updateQuoteVisible } = useQuoteStore(\n    useShallow(state => ({\n      updateQuoteVisible: state.updateQuoteVisible,\n      updateQuoteContent: state.updateQuoteContent,\n    })),\n  );\n\n  const {\n    handleMenuMouseEnter,\n    handleMenuMouseLeave,\n    targetElement,\n    targetInfo,\n    position,\n    floatMenuRef,\n    visible,\n    setVisible,\n    computePosition,\n    isScrolling,\n  } = useFloatMenuListener({\n    plugin,\n  });\n\n  const { targetRef: messageRef, forceHidden } = useHideQuote<HTMLElement>({\n    containerRef: targetElement,\n  });\n\n  const { maxPositionX } = useAutoGetMaxPosition({\n    messageRef,\n    position,\n    floatMenuRef,\n  });\n\n  const isGrabMenuVisible = plugin.pluginBizContext.storeSet.useSelectionStore(\n    state => state.isFloatMenuVisible && !!state.floatMenuPosition,\n  );\n\n  const handleQuoteClick = () => {\n    const { source = '', type = 'link', text = '' } = targetInfo.current ?? {};\n    const target = messageRef.current;\n    const messageId = target?.attributes.getNamedItem(\n      CONTENT_ATTRIBUTE_NAME,\n    )?.value;\n\n    if (!messageId) {\n      return;\n    }\n\n    const message = getMessage({\n      messageId,\n      chatAreaPluginContext,\n    });\n\n    const node: GrabNode =\n      type === 'image'\n        ? {\n            type: GrabElementType.IMAGE,\n            src: source,\n            children: [\n              {\n                text: source,\n              },\n            ],\n          }\n        : {\n            type: GrabElementType.LINK,\n            url: source,\n            children: [\n              {\n                text,\n              },\n            ],\n          };\n\n    updateQuoteContent([node]);\n    updateQuoteVisible(true);\n    pluginBizContext.eventCallbacks.onQuote?.({\n      botId: message?.sender_id ?? '',\n      source: message?.source,\n    });\n  };\n\n  useEffect(() => {\n    on(EventNames.OnMessageUpdate, computePosition);\n    on(EventNames.OnViewScroll, computePosition);\n\n    return () => {\n      off(EventNames.OnMessageUpdate, computePosition);\n      off(EventNames.OnViewScroll, computePosition);\n    };\n  }, []);\n\n  if (!enableGrab || isTouchDevice()) {\n    return null;\n  }\n\n  const top = position?.y;\n  const left =\n    (position?.x ?? 0) > (maxPositionX ?? 0) ? maxPositionX : position?.x;\n\n  return (\n    <>\n      {\n        <MenuList\n          ref={floatMenuRef}\n          className={classNames({\n            hidden: !visible || forceHidden || isGrabMenuVisible || isScrolling,\n          })}\n          style={{\n            top,\n            left,\n          }}\n          onMouseEnter={handleMenuMouseEnter}\n          onMouseLeave={handleMenuMouseLeave}\n        >\n          <QuoteButton\n            onClick={handleQuoteClick}\n            onClose={() => {\n              defer(() => setVisible(false));\n            }}\n          />\n        </MenuList>\n      }\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type MessageListFloatSlot } from '@coze-common/chat-area';\n\nimport { GrabMenu } from './grab-menu';\nimport { FloatMenu } from './float-menu';\n\nexport const MessageListFloat: MessageListFloatSlot = props => (\n  <>\n    <GrabMenu {...props} />\n    <FloatMenu {...props} />\n  </>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { cva, type VariantProps } from 'class-variance-authority';\n\nconst quoteNodeColorVariants = cva([], {\n  variants: {\n    showBackground: {\n      true: ['text-[#FFFFFF/60]'],\n      false: ['coz-fg-secondary'],\n    },\n  },\n});\n\nexport const typeSafeQuoteNodeColorVariants: (\n  props: Required<VariantProps<typeof quoteNodeColorVariants>>,\n) => string = quoteNodeColorVariants;\n","\n      import API from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/style-loader/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./index.module.less\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/index.js??ruleSet[1].rules[10].use[1]!builtin:lightningcss-loader??ruleSet[1].rules[10].use[2]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/postcss-loader/index.js??ruleSet[1].rules[10].use[3]!../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+plugin-less@1.1.1_@rsbuild+core@1.1.13/node_modules/@rsbuild/plugin-less/compiled/less-loader/index.js??ruleSet[1].rules[10].use[4]!./index.module.less\";\n       export default content && content.locals ? content.locals : undefined;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, type FC } from 'react';\n\nimport classNames from 'classnames';\nimport {\n  isGrabTextNode,\n  isGrabLink,\n  isGrabImage,\n} from '@coze-common/text-grab';\nimport { type GrabNode } from '@coze-common/text-grab';\nimport { useShowBackGround } from '@coze-common/chat-area';\nimport { Image, ImagePreview } from '@coze-arch/coze-design';\n\nimport { typeSafeQuoteNodeColorVariants } from '../variants';\nimport DefaultImage from '../../assets/image-default.png';\n\nimport styles from './index.module.less';\n\nconst getQuoteNode = ({\n  nodeList,\n  theme,\n  handleClickImage,\n  showBackground,\n}: {\n  nodeList: GrabNode[];\n  theme: 'white' | 'black';\n  handleClickImage: (url: string) => void;\n  showBackground: boolean;\n}): React.ReactNode =>\n  nodeList.map((node, index) => {\n    if (isGrabTextNode(node)) {\n      return (\n        <span\n          className={classNames('text-[14px] align-middle', 'leading-[16px]', {\n            'coz-fg-secondary': theme === 'black',\n            [typeSafeQuoteNodeColorVariants({ showBackground })]:\n              theme === 'white',\n          })}\n          key={index}\n        >\n          {node.text}\n        </span>\n      );\n    }\n\n    if (isGrabImage(node)) {\n      return (\n        <Image\n          className={classNames(\n            styles.image,\n            'w-[24px] h-[24px] leading-[24px] align-middle rounded-[4px] cursor-zoom-in',\n            {\n              'mx-[4px]': index !== 0,\n              'mr-[4px]': index === 0,\n            },\n          )}\n          src={node.src}\n          onClick={() => handleClickImage(node.src)}\n          key={index}\n          fallback={DefaultImage}\n          preview={false}\n        />\n      );\n    }\n\n    if (isGrabLink(node)) {\n      return (\n        <span\n          className={classNames('text-[14px] align-middle', 'leading-[16px]', {\n            'coz-fg-secondary': theme === 'black',\n            [typeSafeQuoteNodeColorVariants({ showBackground })]:\n              theme === 'white',\n          })}\n          key={index}\n        >\n          [\n          {getQuoteNode({\n            nodeList: node.children,\n            theme,\n            handleClickImage,\n            showBackground,\n          })}\n          ]\n        </span>\n      );\n    }\n\n    return null;\n  });\n\nexport const QuoteNode: FC<{\n  nodeList: GrabNode[];\n  theme: 'white' | 'black';\n}> = ({ nodeList, theme }) => {\n  const [previewUrl, setPreviewUrl] = useState('');\n  const showBackground = useShowBackGround();\n  const handleClickImage = (url: string) => {\n    setPreviewUrl(url);\n  };\n\n  return (\n    <>\n      <ImagePreview\n        src={previewUrl}\n        visible={Boolean(previewUrl)}\n        onVisibleChange={() => setPreviewUrl('')}\n      />\n      {getQuoteNode({\n        nodeList,\n        theme,\n        handleClickImage,\n        showBackground,\n      })}\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ContentType, type Message } from '@coze-common/chat-area';\n\nexport const getReferFromMessage = (message: Message<ContentType>) => {\n  if (message.content_type === ContentType.Mix) {\n    const { refer_items } = JSON.parse(message.content) ?? {};\n\n    if (refer_items) {\n      const firstItem = refer_items?.[0];\n\n      if (firstItem?.type === 'text') {\n        return {\n          type: ContentType.Text,\n          text: firstItem?.text,\n        };\n      } else if (firstItem?.type === 'image') {\n        return {\n          type: ContentType.Image,\n          uri: firstItem?.image?.key,\n          url: firstItem?.image?.image_thumb?.url,\n        };\n      }\n    }\n  }\n  return undefined;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, type PropsWithChildren } from 'react';\n\nimport classNames from 'classnames';\nimport { useShowBackGround } from '@coze-common/chat-area';\nimport { IconCozQuotation } from '@coze-arch/coze-design/icons';\n\nimport { typeSafeQuoteNodeColorVariants } from '../variants';\n\nexport const QuoteTopUI: FC<PropsWithChildren> = ({ children }) => {\n  const showBackground = useShowBackGround();\n  return (\n    <div\n      className={classNames(\n        ['h-auto', 'py-4px'],\n        'flex flex-row items-center select-none w-m-0',\n      )}\n    >\n      <IconCozQuotation\n        className={classNames(\n          typeSafeQuoteNodeColorVariants({ showBackground }),\n          'mr-[8px] shrink-0 w-[12px] h-[12px]',\n        )}\n      />\n      <div\n        className={classNames('flex-1 min-w-0 truncate text-[12px]', [\n          'leading-[16px]',\n          typeSafeQuoteNodeColorVariants({ showBackground }),\n        ])}\n      >\n        {children}\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { parseMarkdownToGrabNode } from '@coze-common/text-grab';\nimport {\n  ContentType,\n  type CustomTextMessageInnerTopSlot,\n} from '@coze-common/chat-area';\n\nimport { QuoteNode } from '../quote-node';\nimport { getReferFromMessage } from '../../utils/get-refer-from-message';\nimport { QuoteTopUI } from './quote-top-ui';\n\nexport const RemoteQuoteInnerTopSlot: CustomTextMessageInnerTopSlot = ({\n  message,\n}) => {\n  // It was not sent locally with server level.\n  const refer = getReferFromMessage(message);\n\n  if (!refer) {\n    return null;\n  }\n\n  if (refer.type === ContentType.Image) {\n    return (\n      <QuoteTopUI>\n        <img className=\"w-[24px] h-[24px] rounded-[4px]\" src={refer.url} />\n      </QuoteTopUI>\n    );\n  }\n\n  // Try to parse ast.\n  const nodeList = parseMarkdownToGrabNode(refer.text);\n\n  return (\n    <QuoteTopUI>\n      <QuoteNode nodeList={nodeList} theme=\"white\" />\n    </QuoteTopUI>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useShallow } from 'zustand/react/shallow';\nimport {\n  PluginName,\n  useWriteablePlugin,\n  type CustomTextMessageInnerTopSlot,\n} from '@coze-common/chat-area';\n\nimport { QuoteNode } from '../quote-node';\nimport { type GrabPluginBizContext } from '../../types/plugin-biz-context';\nimport { QuoteTopUI } from './quote-top-ui';\n\nexport const LocalQuoteInnerTopSlot: CustomTextMessageInnerTopSlot = ({\n  message,\n}) => {\n  const localMessageId = message.extra_info.local_message_id;\n\n  const plugin = useWriteablePlugin<GrabPluginBizContext>(\n    PluginName.MessageGrab,\n  );\n\n  const { useQuoteStore } = plugin.pluginBizContext.storeSet;\n\n  // Preference is given to locally mapped\n  const localNodeList = useQuoteStore(\n    useShallow(state => state.quoteContentMap[localMessageId]),\n  );\n\n  if (localNodeList) {\n    return (\n      <QuoteTopUI>\n        <QuoteNode nodeList={localNodeList} theme=\"white\" />\n      </QuoteTopUI>\n    );\n  }\n\n  return null;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useShallow } from 'zustand/react/shallow';\nimport {\n  PluginName,\n  useWriteablePlugin,\n  type CustomTextMessageInnerTopSlot,\n} from '@coze-common/chat-area';\n\nimport { type GrabPluginBizContext } from '../../types/plugin-biz-context';\nimport { RemoteQuoteInnerTopSlot } from './remote-slot';\nimport { LocalQuoteInnerTopSlot } from './local-slot';\n\nexport const QuoteMessageInnerTopSlot: CustomTextMessageInnerTopSlot = ({\n  message,\n}) => {\n  const localMessageId = message.extra_info.local_message_id;\n\n  const plugin = useWriteablePlugin<GrabPluginBizContext>(\n    PluginName.MessageGrab,\n  );\n\n  const { useQuoteStore } = plugin.pluginBizContext.storeSet;\n\n  // Preference is given to locally mapped\n  const hasLocal = useQuoteStore(\n    useShallow(state => !!state.quoteContentMap[localMessageId]),\n  );\n\n  if (hasLocal) {\n    return <LocalQuoteInnerTopSlot message={message} />;\n  }\n\n  return <RemoteQuoteInnerTopSlot message={message} />;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, type FC } from 'react';\n\nimport { useShallow } from 'zustand/react/shallow';\nimport { PluginName, useWriteablePlugin } from '@coze-common/chat-area';\nimport { IconCozCross, IconCozQuotation } from '@coze-arch/coze-design/icons';\nimport { IconButton } from '@coze-arch/coze-design';\n\nimport { QuoteNode } from '../quote-node';\nimport { type GrabPluginBizContext } from '../../types/plugin-biz-context';\n\ntype IProps = Record<string, unknown>;\n\nexport const QuoteInputAddonTop: FC<IProps> = () => {\n  const { pluginBizContext, chatAreaPluginContext } =\n    useWriteablePlugin<GrabPluginBizContext>(PluginName.MessageGrab);\n\n  const { useChatInputLayout } = chatAreaPluginContext.readonlyHook.input;\n\n  const { useQuoteStore } = pluginBizContext.storeSet;\n\n  const { quoteVisible, quoteContent, updateQuoteVisible, updateQuoteContent } =\n    useQuoteStore(\n      useShallow(state => ({\n        quoteVisible: state.quoteVisible,\n        quoteContent: state.quoteContent,\n        updateQuoteVisible: state.updateQuoteVisible,\n        updateQuoteContent: state.updateQuoteContent,\n      })),\n    );\n\n  const handleClose = () => {\n    updateQuoteContent(null);\n    updateQuoteVisible(false);\n  };\n\n  const { layoutContainerRef } = useChatInputLayout();\n\n  useEffect(() => {\n    if (!layoutContainerRef?.current) {\n      return;\n    }\n\n    const handleStopPropagation = (e: PointerEvent) => e.stopPropagation();\n\n    layoutContainerRef.current.addEventListener(\n      'pointerup',\n      handleStopPropagation,\n    );\n\n    return () => {\n      layoutContainerRef.current?.removeEventListener(\n        'pointerup',\n        handleStopPropagation,\n      );\n    };\n  }, [layoutContainerRef?.current]);\n\n  if (!quoteContent || !quoteVisible) {\n    return null;\n  }\n\n  return (\n    <div className=\"w-full h-[32px] flex items-center px-[16px] coz-mg-primary\">\n      <IconCozQuotation className=\"coz-fg-secondary mr-[8px] w-[12px] h-[12px]\" />\n      <div className=\"flex flex-row items-center flex-1\">\n        <div className=\"coz-fg-secondary flex-1 min-w-0 w-0 truncate text-[12px] leading-[16px]\">\n          <QuoteNode nodeList={quoteContent} theme=\"black\" />\n        </div>\n        <IconButton\n          icon={<IconCozCross className=\"w-[14px] h-[14px]\" />}\n          onClick={handleClose}\n          color=\"secondary\"\n          size=\"small\"\n          className=\"!rounded-[4px]\"\n          wrapperClass=\"flex item-center justify-center\"\n        />\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  PluginMode,\n  PluginName,\n  WriteableChatAreaPlugin,\n  createCustomComponents,\n} from '@coze-common/chat-area';\n\nimport { type GrabPublicMethod } from './types/public-methods';\nimport { type GrabPluginBizContext } from './types/plugin-biz-context';\nimport { GrabMessageLifeCycleService } from './services/life-cycle/message';\nimport { GrabCommandLifeCycleService } from './services/life-cycle/command';\nimport { GrabAppLifeCycleService } from './services/life-cycle/app';\nimport { MessageListFloat } from './custom-components/message-list-float-slot';\nimport { QuoteMessageInnerTopSlot } from './custom-components/message-inner-top-slot';\nimport { QuoteInputAddonTop } from './custom-components/input-addon-top';\n\nexport class ChatAreaGrabPlugin extends WriteableChatAreaPlugin<\n  GrabPluginBizContext,\n  GrabPublicMethod\n> {\n  public pluginMode = PluginMode.Writeable;\n  public pluginName = PluginName.MessageGrab;\n\n  public customComponents = createCustomComponents({\n    MessageListFloatSlot: MessageListFloat,\n    TextMessageInnerTopSlot: QuoteMessageInnerTopSlot,\n    InputAddonTop: QuoteInputAddonTop,\n  });\n\n  public lifeCycleServices = {\n    appLifeCycleService: new GrabAppLifeCycleService(this),\n    messageLifeCycleService: new GrabMessageLifeCycleService(this),\n    commandLifeCycleService: new GrabCommandLifeCycleService(this),\n  };\n\n  public publicMethods: GrabPublicMethod = {\n    updateEnableGrab: (enable: boolean) => {\n      if (!this.pluginBizContext) {\n        return;\n      }\n\n      const { updateEnableGrab } =\n        this.pluginBizContext.storeSet.usePreferenceStore.getState();\n\n      updateEnableGrab(enable);\n    },\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { nanoid } from 'nanoid';\nimport mitt from 'mitt';\nimport { type PluginRegistryEntry } from '@coze-common/chat-area';\n\nimport {\n  type EventCenter,\n  type GrabPluginBizContext,\n  type PublicEventCenter,\n  type EventCallbacks,\n} from './types/plugin-biz-context';\nimport { createSelectionStore } from './stores/selection';\nimport { createQuoteStore, subscribeQuoteUpdate } from './stores/quote';\nimport { createPreferenceStore } from './stores/preference';\nimport { ChatAreaGrabPlugin } from './plugin';\n\ninterface Preference {\n  enableGrab: boolean;\n}\n\nexport type Scene = 'store' | 'other';\n\ntype CreateGrabPluginParams = {\n  preference: Preference;\n  scene?: Scene;\n} & EventCallbacks;\n\nexport const publicEventCenter = mitt<PublicEventCenter>();\n\nexport const createGrabPlugin = (params: CreateGrabPluginParams) => {\n  const { preference, onQuote, onQuoteChange, scene } = params;\n\n  const grabPluginId = nanoid();\n\n  const grabPlugin: PluginRegistryEntry<GrabPluginBizContext> = {\n    createPluginBizContext: () => {\n      const eventCallbacks = {\n        onQuote,\n        onQuoteChange,\n      };\n\n      const storeSet = {\n        useSelectionStore: createSelectionStore('plugin'),\n        useQuoteStore: createQuoteStore('plugin'),\n        usePreferenceStore: createPreferenceStore('plugin'),\n      };\n\n      const eventCenter = mitt<EventCenter>();\n\n      // Default injection preference\n      storeSet.usePreferenceStore\n        .getState()\n        .updateEnableGrab(preference.enableGrab);\n\n      const unsubscribeQuoteStore = subscribeQuoteUpdate(\n        {\n          useQuoteStore: storeSet.useQuoteStore,\n        },\n        eventCallbacks,\n      );\n\n      const ctx = {\n        grabPluginId,\n        storeSet,\n        eventCallbacks,\n        unsubscribe: () => {\n          unsubscribeQuoteStore();\n        },\n        eventCenter,\n        publicEventCenter,\n        scene,\n      };\n\n      return ctx;\n    },\n    Plugin: ChatAreaGrabPlugin,\n  };\n\n  return { grabPlugin, grabPluginId };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo, useState } from 'react';\n\nimport { type MessageSource } from '@coze-common/chat-area';\n\nimport { type Scene, createGrabPlugin } from '../create';\n\ninterface Params {\n  onQuote?: ({\n    botId,\n    source,\n  }: {\n    botId: string;\n    source: MessageSource | undefined;\n  }) => void;\n  // At present, only the scene of the store needs to be distinguished.\n  scene?: Scene;\n}\nexport const useCreateGrabPlugin = (params?: Params) => {\n  const { onQuote, scene = 'other' } = params ?? {};\n  const [grabEnableUpload, setGrabEnableUpload] = useState(true);\n\n  // eslint-disable-next-line @typescript-eslint/naming-convention -- matches the expected naming\n  const { grabPlugin: GrabPlugin, grabPluginId } = useMemo(\n    () =>\n      createGrabPlugin({\n        preference: {\n          enableGrab: true,\n        },\n        onQuote,\n        onQuoteChange: ({ isEmpty }) => {\n          setGrabEnableUpload(isEmpty);\n        },\n        scene,\n      }),\n    [],\n  );\n\n  return { grabEnableUpload, GrabPlugin, grabPluginId };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const enum GrabElementType {\n  IMAGE = 'image',\n  LINK = 'link',\n}\n\nexport interface GrabText {\n  text: string;\n}\n\nexport interface GrabElement {\n  children: GrabNode[];\n}\n\nexport interface GrabLinkElement extends GrabElement {\n  url: string;\n  type: GrabElementType.LINK;\n}\n\nexport interface GrabImageElement extends GrabElement {\n  src: string;\n  type: GrabElementType.IMAGE;\n}\n\nexport type GrabNode =\n  | GrabElement\n  | GrabLinkElement\n  | GrabImageElement\n  | GrabText;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type getOriginContentText } from '../utils/normalizer/get-origin-content-text';\nimport { type getNormalizeNodeList } from '../utils/normalizer/get-normalize-node-list';\nimport { type getHumanizedContentText } from '../utils/normalizer/get-humanize-content-text';\n\nexport interface SelectionData {\n  humanizedContentText: ReturnType<typeof getHumanizedContentText>;\n  originContentText: ReturnType<typeof getOriginContentText>;\n  normalizeSelectionNodeList: ReturnType<typeof getNormalizeNodeList>;\n  nodesAncestorIsMessageBox: boolean;\n  ancestorAttributeValue: string | null;\n  messageSource: number;\n  direction: Direction;\n}\n\nexport interface GrabPosition {\n  x: number;\n  y: number;\n}\n\nexport const enum Direction {\n  Forward = 'forward',\n  Backward = 'backward',\n  Unknown = 'unknown',\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport function isTouchDevice(): boolean {\n  return 'ontouchend' in document;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const CONTENT_ATTRIBUTE_NAME = 'data-grab-mark';\n\nexport const MESSAGE_SOURCE_ATTRIBUTE_NAME = 'data-grab-source';\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Helper function to obtain all nodes in the selection\nexport const getAllNodesInRange = (range: Range): Node[] => {\n  const nodes: Node[] = [];\n  const treeWalker = document.createTreeWalker(\n    range.commonAncestorContainer,\n    NodeFilter.SHOW_ALL,\n    {\n      acceptNode: node =>\n        range.intersectsNode(node)\n          ? NodeFilter.FILTER_ACCEPT\n          : NodeFilter.FILTER_REJECT,\n    },\n  );\n\n  // eslint-disable-next-line prefer-destructuring -- as expected, because the data is to be changed and allowed to be empty\n  let currentNode: Node | null = treeWalker.currentNode;\n\n  while (currentNode) {\n    nodes.push(currentNode);\n    currentNode = treeWalker.nextNode();\n  }\n\n  return nodes;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Find ancestor nodes (including itself) by TagName\n * @param node Node | null\n * @param tagName Target tagName\n * @returns Node | null\n */\nexport const findAncestorNodeByTagName = (\n  node: Node | null,\n  tagName: string,\n): Element | null => {\n  // Convert the tag signature to uppercase, as tag signatures in the DOM are usually uppercase\n  const upperTagName = tagName.toUpperCase();\n\n  // Traverse the node's ancestors until a matching tag is found or the root node is reached\n  while (node) {\n    // Make sure that the current node is an element node and that the tag signatures match\n    if (\n      node.nodeType === Node.ELEMENT_NODE &&\n      (node as Element).tagName === upperTagName\n    ) {\n      return node as Element;\n    }\n    // Move to Parent Node\n    node = node.parentNode;\n  }\n\n  // If no eligible ancestor is found, return null.\n  return null;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const getAncestorAttributeValue = (\n  node: Node | null,\n  attributeName: string,\n): string | null => {\n  while (node && node !== document) {\n    let attributeValue = null;\n    if (node instanceof Element) {\n      attributeValue = node.attributes.getNamedItem(attributeName)?.value;\n    }\n\n    if (node.nodeType === Node.ELEMENT_NODE && attributeValue) {\n      return attributeValue;\n    }\n    node = node.parentNode;\n  }\n  return null;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CONTENT_ATTRIBUTE_NAME } from '../constants/range';\nimport { getAllNodesInRange } from './helper/get-all-nodes-in-range';\nimport { findAncestorNodeByTagName } from './helper/find-ancestor-node-by-tag-name';\nimport { getAncestorAttributeValue } from './get-ancestor-attribute-value';\n\nexport const shouldRefineRange = (range: Range): boolean => {\n  // Get all nodes of the selection\n  const nodes = getAllNodesInRange(range);\n\n  let validNodeLength = 0;\n\n  let hasNodeInLink = false;\n\n  // Traverse all nodes to check if their ancestors have a specific class name attribute\n  for (const node of nodes) {\n    const attributeValue = getAncestorAttributeValue(\n      node,\n      CONTENT_ATTRIBUTE_NAME,\n    );\n\n    // If it doesn't exist, you need to overwrite hasNodeInLink and make sure to find a node in the link.\n    if (!hasNodeInLink) {\n      hasNodeInLink = Boolean(findAncestorNodeByTagName(node, 'A'));\n    }\n\n    if (attributeValue) {\n      validNodeLength++;\n    }\n  }\n\n  const { endOffset } = range;\n\n  return validNodeLength !== nodes.length || hasNodeInLink || endOffset === 0;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getAncestorAttributeValue } from '../get-ancestor-attribute-value';\n\n/**\n * Find the last sibling of a node\n * @param node find node\n * @returns\n */\nexport const findLastSiblingNode = ({\n  node,\n  scopeAncestorAttributeName,\n  targetAttributeValue,\n}: {\n  node: Node | null;\n  scopeAncestorAttributeName?: string;\n  targetAttributeValue?: string | null;\n}): Node | null => {\n  let lastValidSibling: Node | null = null;\n  while (node) {\n    if (\n      scopeAncestorAttributeName &&\n      getAncestorAttributeValue(node, scopeAncestorAttributeName) ===\n        targetAttributeValue\n    ) {\n      lastValidSibling = node;\n    }\n    node = node.nextSibling;\n  }\n  return lastValidSibling;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Find the last sub-node of a node\n * @param node Node\n * @returns Node\n */\nexport const findLastChildNode = (node: Node): Node => {\n  while (node.lastChild) {\n    node = node.lastChild;\n  }\n  return node;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Determine the node inclusion relationship\n * Reference document \"https://developer.mozilla.org/zh-CN/docs/Web/API/Node/compareDocumentPosition\"\n * @param nodeA\n * @param nodeB\n *\n */\nexport const compareNodePosition = (nodeA: Node, nodeB: Node) => {\n  const comparison = nodeA.compareDocumentPosition(nodeB);\n\n  // The reason why the condition is inverse to return, please refer to the official documentation, including the relationship showing the B-A relationship\n  if (comparison & Node.DOCUMENT_POSITION_CONTAINED_BY) {\n    return 'contains'; // NodeA contains nodeB\n  } else if (comparison & Node.DOCUMENT_POSITION_CONTAINS) {\n    return 'containedBy'; // NodeA is contained by nodeB\n  } else if (comparison & Node.DOCUMENT_POSITION_FOLLOWING) {\n    return 'before'; // nodeA before nodeB\n  } else if (comparison & Node.DOCUMENT_POSITION_PRECEDING) {\n    return 'after'; // NodeA after nodeB\n  }\n\n  return 'none'; // Nodes are the same or have no comparable relationship\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getAncestorAttributeValue } from '../get-ancestor-attribute-value';\n\nexport const fixStartNode = ({\n  range,\n  targetAttributeName,\n  targetAttributeValue,\n}: {\n  range: Range;\n  targetAttributeName: string;\n  targetAttributeValue: string;\n}) => {\n  let startNode: Node | null = range.startContainer;\n  let { startOffset } = range;\n\n  // Make sure the starting node meets the requirements\n  while (\n    startNode &&\n    !(\n      getAncestorAttributeValue(startNode, targetAttributeName) ===\n      targetAttributeValue\n    )\n  ) {\n    if (startNode.previousSibling) {\n      startNode = startNode.previousSibling;\n      startOffset = 0; // From the starting position of the previous sibling node\n    } else if (startNode.parentNode && startNode.parentNode !== document) {\n      startNode = startNode.parentNode;\n      startOffset = 0; // Start at the beginning of the parent node\n    } else {\n      // No eligible starting nodes\n      startNode = null;\n      break;\n    }\n  }\n\n  return {\n    startNode,\n    startOffset,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const findNearestAnchor = (\n  node: Node | null,\n): HTMLAnchorElement | null => {\n  // Traverse up from the current node\n  while (node) {\n    // If the current node is an element node and is a < a > tag\n    if (node.nodeType === Node.ELEMENT_NODE && node.nodeName === 'A') {\n      // Return this < a > tag\n      return node as HTMLAnchorElement;\n    }\n    // Move up to the parent node\n    node = node.parentNode;\n  }\n  // If the < a > tag is not found at the root node, return null.\n  return null;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { findNearestAnchor } from '../helper/find-nearest-link-node';\n\nexport const fixLink = (range: Range, startNode: Node, endNode: Node) => {\n  const startAnchor = findNearestAnchor(startNode);\n  const endAnchor = findNearestAnchor(endNode);\n\n  let isFix = false;\n  // If the starting node is within the link, set the starting point of the selection to the start of the link\n  if (startAnchor) {\n    range.setStartBefore(startAnchor);\n    isFix = true;\n  }\n\n  // If the end node is within the link, set the end of the selection to the end of the link\n  if (endAnchor) {\n    range.setEndAfter(endAnchor);\n    isFix = true;\n  }\n\n  return isFix;\n};\n\n/**\n * 1. Link [A... text... link] to B\n * 2. Link A... text [word... link] to B\n * 3.... Text [word, chain] to B\n * 4. Chain [link] B\n */\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { findLastChildNode } from '../helper/find-last-child-node';\nimport { getAncestorAttributeValue } from '../get-ancestor-attribute-value';\n\nexport const fixEndNode = ({\n  range,\n  targetAttributeName,\n  targetAttributeValue,\n}: {\n  range: Range;\n  targetAttributeName: string;\n  targetAttributeValue: string;\n}) => {\n  let endNode: Node | null = range.endContainer;\n  let { endOffset } = range;\n\n  // Make sure the end node meets the conditions\n  while (\n    endNode &&\n    !(\n      getAncestorAttributeValue(endNode, targetAttributeName) ===\n      targetAttributeValue\n    )\n  ) {\n    if (endNode.nextSibling) {\n      endNode = endNode.nextSibling;\n      endOffset = 0; // Start from the starting position of the next sibling node\n    } else if (endNode.parentNode && endNode.parentNode !== document) {\n      endNode = endNode.parentNode;\n      endOffset = endNode\n        ? findLastChildNode(endNode).textContent?.length ?? 0\n        : 0; // Start from the last position of the parent node\n    } else {\n      // No eligible end nodes\n      endNode = null;\n      break;\n    }\n  }\n\n  return {\n    endNode,\n    endOffset,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Helper function to obtain all nodes in the selection\nexport const getAllChildNodesInNode = (node: Node): Node[] => {\n  const nodes: Node[] = [];\n  const treeWalker = document.createTreeWalker(node, NodeFilter.SHOW_ALL, {\n    acceptNode: _node =>\n      node.contains(_node)\n        ? NodeFilter.FILTER_ACCEPT\n        : NodeFilter.FILTER_REJECT,\n  });\n\n  // eslint-disable-next-line prefer-destructuring -- as expected, because the data is to be changed and allowed to be empty\n  let currentNode: Node | null = treeWalker.currentNode;\n\n  while (currentNode) {\n    nodes.push(currentNode);\n    currentNode = treeWalker.nextNode();\n  }\n\n  return nodes;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { compareNodePosition } from './compare-node-position';\n\nexport const findNotContainsPreviousSibling = (\n  node: Node | null,\n): Node | null => {\n  if (!node || node === document) {\n    return null;\n  }\n\n  let sibling: Node | null = node.previousSibling ?? node.parentNode;\n\n  while (sibling) {\n    if (sibling === document) {\n      return null;\n    }\n\n    // Get the relationship between two nodes\n    const relationship = compareNodePosition(sibling, node);\n\n    // If there is no containing relationship between the two nodes, the current sibling is returned\n    if (!['containedBy', 'contains'].includes(relationship)) {\n      return sibling;\n    }\n\n    if (!sibling.previousSibling) {\n      sibling = sibling.parentNode;\n    } else {\n      sibling = sibling.previousSibling;\n    }\n  }\n\n  return null;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getAllChildNodesInNode } from '../helper/get-all-child-nodes-in-node';\nimport { findNotContainsPreviousSibling } from '../helper/find-not-contains-previous-sibling';\n\nexport const fixEndEmpty = ({\n  range,\n  startNode,\n  endNode,\n  endOffset,\n}: {\n  range: Range;\n  startNode: Node;\n  endNode: Node;\n  endOffset: number;\n}): boolean => {\n  // Check if it needs to be fixed: the end node and the start node are different and the end offset is 0\n  if (startNode === endNode || endOffset !== 0) {\n    return false; // No repair required.\n  }\n\n  // Initializes the current node to the previous sibling of the end node\n  let currentNode: Node | null = findNotContainsPreviousSibling(endNode);\n\n  // Find a valid non-unprecedented sibling node\n  while (currentNode) {\n    if (currentNode.nodeType === Node.TEXT_NODE) {\n      // If it is a text node, check if it is not empty\n      const textContent = currentNode.textContent?.trim();\n      if (textContent && currentNode.textContent?.length) {\n        // Not empty, fix the end of the selection\n        range.setEnd(currentNode, currentNode.textContent.length);\n        return true;\n      }\n    } else if (currentNode.nodeType === Node.ELEMENT_NODE) {\n      // If it is an element node, check if there is any visible content\n      const textContent = currentNode.textContent?.trim();\n      if (textContent) {\n        // With visible content, try to set the end position more precisely\n        // If there is a text node inside the element, try to navigate to the last text node\n        let lastTextNode: Node | null = null;\n\n        const allChildNodes = getAllChildNodesInNode(currentNode);\n\n        for (const child of allChildNodes) {\n          if (child.nodeType === Node.TEXT_NODE && child.textContent?.trim()) {\n            lastTextNode = child as Node;\n          }\n        }\n\n        if (lastTextNode && lastTextNode.textContent) {\n          range.setEnd(lastTextNode, lastTextNode.textContent.length);\n          return true;\n        }\n      }\n    }\n    // If the current node is empty or does not meet the conditions, continue to traverse forward/upward\n    currentNode = findNotContainsPreviousSibling(currentNode);\n  }\n\n  // If no suitable node is found after traversing all previous siblings, return false.\n  return false;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Fix the actual function of the selection\n * @param range Range\n */\nimport { findLastSiblingNode } from '../helper/find-last-sibling-node';\nimport { findLastChildNode } from '../helper/find-last-child-node';\nimport { findAncestorNodeByTagName } from '../helper/find-ancestor-node-by-tag-name';\nimport { compareNodePosition } from '../helper/compare-node-position';\nimport { getAncestorAttributeValue } from '../get-ancestor-attribute-value';\nimport { CONTENT_ATTRIBUTE_NAME } from '../../constants/range';\nimport { fixStartNode } from './fix-start-node';\nimport { fixLink } from './fix-link';\nimport { fixEndNode } from './fix-end-node';\nimport { fixEndEmpty } from './fix-end-empty';\n\n// eslint-disable-next-line complexity\nexport const refineRange = ({ range }: { range: Range }): boolean => {\n  // The initial algorithm only uses StartNode as the starting node of the selection\n  const targetAttributeValue = getAncestorAttributeValue(\n    range.startContainer,\n    CONTENT_ATTRIBUTE_NAME,\n  );\n\n  if (!targetAttributeValue) {\n    return false;\n  }\n\n  const { startNode, startOffset } = fixStartNode({\n    range,\n    targetAttributeName: CONTENT_ATTRIBUTE_NAME,\n    targetAttributeValue,\n  });\n\n  let { endNode, endOffset } = fixEndNode({\n    range,\n    targetAttributeName: CONTENT_ATTRIBUTE_NAME,\n    targetAttributeValue,\n  });\n\n  // If the start node is found, but the end node is not found, then continue to try to fix the selection using the last sibling of the start node\n  if (startNode && !endNode) {\n    const { parentNode } = startNode;\n    let lastSibling: Node | null = null;\n\n    // Try to find the nearest < li > or < a > tag\n    const liParentNode = findAncestorNodeByTagName(parentNode, 'LI');\n    const aParentNode = liParentNode\n      ? findAncestorNodeByTagName(liParentNode, 'A')\n      : findAncestorNodeByTagName(parentNode, 'A');\n    // Find the nearest < div > tag\n    const divParentNode = findAncestorNodeByTagName(parentNode, 'DIV');\n\n    // Determine how to find the last sibling based on the type of node found\n    if (aParentNode) {\n      // If < a > is found, use its parent node\n      lastSibling = findLastSiblingNode({\n        node: aParentNode,\n        scopeAncestorAttributeName: CONTENT_ATTRIBUTE_NAME,\n        targetAttributeValue,\n      });\n    } else if (liParentNode) {\n      // If a < li > is found, use its parent node\n      lastSibling = findLastSiblingNode({\n        node: liParentNode,\n        scopeAncestorAttributeName: CONTENT_ATTRIBUTE_NAME,\n        targetAttributeValue,\n      });\n    } else if (divParentNode) {\n      // If a < div > is found, use its parent node (e.g. in the case of a code block).\n      lastSibling = findLastSiblingNode({\n        node: divParentNode,\n        scopeAncestorAttributeName: CONTENT_ATTRIBUTE_NAME,\n        targetAttributeValue,\n      });\n    } else {\n      // Otherwise, use the starting node\n      lastSibling = findLastSiblingNode({\n        node: startNode,\n        scopeAncestorAttributeName: CONTENT_ATTRIBUTE_NAME,\n        targetAttributeValue,\n      });\n    }\n\n    // If the starting node is the same as the found sibling, then use the parent element of the actual node to find its last node\n    if (startNode === lastSibling) {\n      lastSibling = findLastSiblingNode({\n        node: parentNode,\n        scopeAncestorAttributeName: CONTENT_ATTRIBUTE_NAME,\n        targetAttributeValue,\n      });\n    }\n\n    if (lastSibling) {\n      endNode = lastSibling;\n      endOffset =\n        endNode.nodeType === Node.TEXT_NODE\n          ? (endNode as Text).length\n          : findLastChildNode(endNode).textContent?.length ?? 0;\n    }\n  }\n\n  // If both the start and end nodes are found, correct the selection\n  if (startNode && endNode) {\n    const relation = compareNodePosition(startNode, endNode);\n\n    let isFix = false;\n\n    if (['before', 'none'].includes(relation)) {\n      range.setStart(startNode, startOffset);\n      range.setEnd(endNode, endOffset);\n\n      isFix = true;\n    }\n\n    const isFixLink = fixLink(range, startNode, endNode);\n\n    const isFixEndEmpty = fixEndEmpty({ range, startNode, endNode, endOffset });\n\n    return isFix || isFixLink || isFixEndEmpty;\n  }\n\n  range.collapse(false);\n  return false;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type GrabNode, type GrabText } from '../../types/node';\n\nexport const isGrabTextNode = (node: GrabNode): node is GrabText =>\n  node && 'text' in node;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  GrabElementType,\n  type GrabLinkElement,\n  type GrabNode,\n} from '../../types/node';\n\nexport const isGrabLink = (node: GrabNode): node is GrabLinkElement =>\n  node && 'url' in node && 'type' in node && node.type === GrabElementType.LINK;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  GrabElementType,\n  type GrabImageElement,\n  type GrabNode,\n} from '../../types/node';\n\nexport const isGrabImage = (node: GrabNode): node is GrabImageElement =>\n  node &&\n  'src' in node &&\n  'type' in node &&\n  node.type === GrabElementType.IMAGE;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Get formatted SelectionNodeList data\n * Get the text content fed to the large model\n */\nimport { type GrabNode } from '../../types/node';\nimport { isGrabTextNode } from './is-grab-text-node';\nimport { isGrabLink } from './is-grab-link';\nimport { isGrabImage } from './is-grab-image';\n\nexport const getOriginContentText = (normalizeNodeList: GrabNode[]) => {\n  let content = '';\n\n  for (const node of normalizeNodeList) {\n    if (isGrabTextNode(node)) {\n      content += node.text;\n    } else if (isGrabLink(node)) {\n      content += `[${getOriginContentText(node.children)}](${node.url})`;\n    } else if (isGrabImage(node)) {\n      content += `![${getOriginContentText(node.children)}](${node.src})`;\n    } else {\n      content += getOriginContentText(node.children);\n    }\n  }\n\n  return content;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Get URLs in image Node\n * @param node Node\n * @returns string\n */\nexport const getPictureNodeUrl = (node: Node) => {\n  if (!('src' in node) || !(typeof node.src === 'string')) {\n    return;\n  }\n\n  return node.src;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getPictureNodeUrl } from './get-picture-node-url';\n\n/**\n * Get a valid node for the node whose TagName is Picture\n * @param childNodes NodeListOf < Node > sub-node list\n * @returns Node | null\n */\nexport const findPictureValidChildNode = (childNodes: NodeListOf<Node>) =>\n  Array.from(childNodes)\n    .filter(node => getPictureNodeUrl(node))\n    .at(0);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { findPictureValidChildNode } from '../find-picture-valid-child-node';\n\n/**\n * Processing special Node data\n * @param node Node\n * @returns node | undefined\n */\nexport const processSpecialNode = (node: Node) => {\n  // Special optimization for picture types\n  if (node.nodeName.toUpperCase() === 'PICTURE') {\n    const pictureNode = findPictureValidChildNode(node.childNodes);\n\n    if (pictureNode) {\n      return pictureNode;\n    }\n  }\n\n  // Special optimization for links\n  if (node.nodeName.toUpperCase() === 'A') {\n    return node;\n  }\n\n  // Special optimization for tables\n  if (['TH', 'TD'].includes(node.nodeName.toUpperCase())) {\n    return node;\n  }\n\n  return;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { processSpecialNode } from '../process-node/process-special-node';\nimport {\n  GrabElementType,\n  type GrabLinkElement,\n  type GrabImageElement,\n  type GrabNode,\n  type GrabText,\n} from '../../types/node';\n\n/**\n * Get formatted NodeList\n * @param childNodeList NodeListOf<Node>\n */\nexport const getNormalizeNodeList = (childNodeList: NodeListOf<Node>) => {\n  const normalizedNodeList: GrabNode[] = [];\n\n  if (!childNodeList.length) {\n    return normalizedNodeList;\n  }\n\n  for (const childNode of childNodeList) {\n    const specialNode = processSpecialNode(childNode);\n\n    if (specialNode) {\n      const grabNode = generateGrabNode(specialNode);\n\n      grabNode && normalizedNodeList.push(grabNode);\n      continue;\n    } else {\n      const grabNode = generateGrabNode(childNode);\n      grabNode && normalizedNodeList.push(grabNode);\n    }\n\n    const normalizedNodeListInLoop = getNormalizeNodeList(childNode.childNodes);\n    normalizedNodeList.push(...normalizedNodeListInLoop);\n  }\n\n  return normalizedNodeList;\n};\n\n/**\n * Generating Grab Nodes\n * @param node Node | null\n */\nexport const generateGrabNode = (node: Node | null) => {\n  if (!node) {\n    return null;\n  }\n\n  const isTable = ['TH', 'TD'].includes(node.nodeName.toUpperCase());\n\n  // text node\n  if (node.nodeType === node.TEXT_NODE || isTable) {\n    return generateGrabText(node, isTable);\n  }\n\n  // element node\n  if (node.nodeType === node.ELEMENT_NODE && node instanceof Element) {\n    return generateGrabElement(node);\n  }\n};\n\n/**\n * Generate Text Node\n * @param node Node | null\n */\nexport const generateGrabText = (node: Node | null, isTable?: boolean) => {\n  if (!node) {\n    return;\n  }\n\n  const safeTextContent = node.textContent ?? '';\n\n  const text = isTable ? ` ${safeTextContent} ` : safeTextContent;\n\n  const grabText: GrabText = {\n    text,\n  };\n\n  return grabText;\n};\n\n/**\n * Generating Element Node\n * @param node Element | null\n */\nexport const generateGrabElement = (node: Element | null) => {\n  if (!node) {\n    return;\n  }\n\n  if (['IMG', 'SOURCE'].includes(node.tagName.toUpperCase())) {\n    const grabText = generateGrabText(node);\n\n    const grabImageElement: GrabImageElement = {\n      type: GrabElementType.IMAGE,\n      src: 'src' in node && typeof node.src === 'string' ? node.src : '',\n      children: grabText ? [grabText] : [],\n    };\n\n    return grabImageElement;\n  }\n\n  if (node.tagName.toUpperCase() === 'A') {\n    const grabText = generateGrabText(node);\n    const grabLinkElement: GrabLinkElement = {\n      type: GrabElementType.LINK,\n      url: 'href' in node && typeof node.href === 'string' ? node.href : '',\n      children: grabText ? [grabText] : [],\n    };\n\n    return grabLinkElement;\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type GrabNode } from '../../types/node';\nimport { isGrabTextNode } from './is-grab-text-node';\nimport { isGrabLink } from './is-grab-link';\nimport { isGrabImage } from './is-grab-image';\n\n/**\n * Access to user-friendly text content\n */\nexport const getHumanizedContentText = (normalizeNodeList: GrabNode[]) => {\n  let content = '';\n\n  for (const node of normalizeNodeList) {\n    if (isGrabTextNode(node)) {\n      content += node.text;\n    } else if (isGrabLink(node)) {\n      content += `[${getHumanizedContentText(node.children)}]`;\n    } else if (isGrabImage(node)) {\n      content += `![${getHumanizedContentText(node.children)}]`;\n    } else {\n      content += getHumanizedContentText(node.children);\n    }\n  }\n\n  return content;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const hasVisibleSelection = (range: Range): boolean => {\n  // Clone all nodes within the Range\n  const documentFragment = range.cloneContents();\n  const textNodes: Text[] = [];\n\n  // Recursive function to collect all text nodes\n  function collectTextNodes(node: Node) {\n    if (node.nodeType === Node.TEXT_NODE) {\n      textNodes.push(node as Text);\n    } else {\n      node.childNodes.forEach(collectTextNodes);\n    }\n  }\n\n  // Collect text nodes from the root node of the document fragment\n  collectTextNodes(documentFragment);\n\n  // Check for non-blank text in the collected text nodes\n  return textNodes.some(textNode => /\\S/.test(textNode.textContent || ''));\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Direction } from '../../types/selection';\nimport { compareNodePosition } from './compare-node-position';\n\nexport const getSelectionDirection = (selection: Selection): Direction => {\n  // Make sure there are constituencies\n  if (!selection || selection.isCollapsed) {\n    return Direction.Unknown; // No constituencies or constituencies not expanded\n  }\n\n  const { anchorNode } = selection;\n  const { focusNode } = selection;\n\n  // Make sure that neither anchorNode nor focusNode is null\n  if (!anchorNode || !focusNode) {\n    return Direction.Unknown; // Unable to determine direction\n  }\n\n  const { anchorOffset } = selection;\n  const { focusOffset } = selection;\n  // Compare anchor and focus positions\n  if (anchorNode === focusNode) {\n    // If the anchor and focus are on the same node, determine the direction by the offset\n    return anchorOffset <= focusOffset ? Direction.Forward : Direction.Backward;\n  } else {\n    // If not in the same node, use Document Position to determine\n    const position = compareNodePosition(anchorNode, focusNode);\n\n    if (position === 'before') {\n      return Direction.Forward;\n    } else if (position === 'after') {\n      return Direction.Backward;\n    }\n  }\n\n  // If the direction cannot be determined, return'unknown'\n  return Direction.Unknown;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const getAncestorAttributeNode = (\n  node: Node | null,\n  attributeName: string,\n): Element | null => {\n  while (node && node !== document) {\n    let attributeValue = null;\n    if (node instanceof Element) {\n      attributeValue = node.attributes.getNamedItem(attributeName)?.value;\n\n      if (attributeValue) {\n        return node;\n      }\n    }\n\n    node = node.parentNode;\n  }\n  return null;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type SelectionData } from '../types/selection';\nimport {\n  CONTENT_ATTRIBUTE_NAME,\n  MESSAGE_SOURCE_ATTRIBUTE_NAME,\n} from '../constants/range';\nimport { shouldRefineRange } from './should-refine-range';\nimport { refineRange } from './refine-range/refine-range';\nimport { getOriginContentText } from './normalizer/get-origin-content-text';\nimport { getNormalizeNodeList } from './normalizer/get-normalize-node-list';\nimport { getHumanizedContentText } from './normalizer/get-humanize-content-text';\nimport { hasVisibleSelection } from './helper/is-range-collapsed';\nimport { getSelectionDirection } from './helper/get-selection-direction';\nimport { getAncestorAttributeNode } from './get-ancestor-attribute-node';\n\nexport const getSelectionData = ({\n  selection,\n  hasFix,\n}: {\n  selection: Selection;\n  hasFix?: boolean;\n}): SelectionData | undefined => {\n  if (!selection.rangeCount) {\n    return;\n  }\n\n  const range = selection.getRangeAt(0);\n\n  if (!range) {\n    return;\n  }\n\n  const documentFragment = range.cloneContents();\n\n  const direction = getSelectionDirection(selection);\n\n  /**\n   * Determine whether it is an element that can be selected by getting a specific identifier\n   */\n  const ancestorNodeWithAttribute = getAncestorAttributeNode(\n    range.commonAncestorContainer.parentNode,\n    CONTENT_ATTRIBUTE_NAME,\n  );\n\n  // specific logo\n  const ancestorAttributeValue =\n    ancestorNodeWithAttribute?.attributes.getNamedItem(CONTENT_ATTRIBUTE_NAME)\n      ?.value ?? null;\n\n  // source of information\n  const messageSource = ancestorNodeWithAttribute?.attributes.getNamedItem(\n    MESSAGE_SOURCE_ATTRIBUTE_NAME,\n  )?.value;\n\n  if (!hasFix) {\n    // Try to fix the selection\n    const needFix = shouldRefineRange(range);\n\n    // If repaired, retrieve the execution and return\n    if (needFix) {\n      const isFix = refineRange({ range });\n\n      if (!isFix) {\n        return;\n      }\n\n      return getSelectionData({\n        selection,\n        hasFix: true,\n      });\n    }\n  }\n\n  const hasVisibleSelectionResult = hasVisibleSelection(range);\n\n  if (!hasVisibleSelectionResult) {\n    return;\n  }\n\n  // Formatted Selection NodeList\n  const normalizeSelectionNodeList = getNormalizeNodeList(\n    documentFragment.childNodes,\n  );\n\n  if (!normalizeSelectionNodeList.length) {\n    return;\n  }\n\n  // user-friendly text content\n  const humanizedContentText = getHumanizedContentText(\n    normalizeSelectionNodeList,\n  );\n\n  // raw text content\n  const originContentText = getOriginContentText(normalizeSelectionNodeList);\n\n  // If the repair selection is successful, then their components\n\n  return {\n    humanizedContentText,\n    originContentText,\n    normalizeSelectionNodeList,\n    nodesAncestorIsMessageBox: Boolean(ancestorAttributeValue),\n    ancestorAttributeValue,\n    messageSource: Number(messageSource),\n    direction,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const getRectData = ({ selection }: { selection: Selection }) => {\n  if (!selection.rangeCount) {\n    return;\n  }\n\n  const range = selection.getRangeAt(0);\n\n  if (!range) {\n    return;\n  }\n\n  const rangeRects = range.getClientRects();\n\n  return {\n    rangeRects,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useRef, useState, type MutableRefObject } from 'react';\n\nimport { defer } from 'lodash-es';\nimport { useEventCallback } from '@coze-common/chat-hooks';\n\nimport { isTouchDevice } from '../utils/is-touch-device';\nimport { getSelectionData } from '../utils/get-selection-data';\nimport { getRectData } from '../utils/get-rect-data';\nimport {\n  Direction,\n  type GrabPosition,\n  type SelectionData,\n} from '../types/selection';\n\nconst MAX_WIDTH = 40;\nconst TIMEOUT = 100;\n\ninterface GrabParams {\n  /**\n   * Select the Ref of the target container\n   */\n  contentRef: MutableRefObject<HTMLDivElement | null>;\n  /**\n   * Floating Menu Ref\n   */\n  floatMenuRef: MutableRefObject<HTMLDivElement | null> | undefined;\n  /**\n   * Select the callback for the event\n   */\n  onSelectChange: (selectionData: SelectionData | null) => void;\n  /**\n   * Callback of location information\n   */\n  onPositionChange: (position: GrabPosition | null) => void;\n  /**\n   * Resize/Scroll/Wheel is the time of throttling\n   */\n  resizeThrottleTime?: number;\n}\n\n// eslint-disable-next-line @coze-arch/max-line-per-function, max-lines-per-function\nexport const useGrab = ({\n  contentRef,\n  floatMenuRef,\n  onSelectChange,\n  onPositionChange,\n}: GrabParams) => {\n  const timeoutRef = useRef<number>();\n\n  /**\n   * Selection object storage (for internal flow state of hooks)\n   */\n  const selection = useRef<Selection | null>(null);\n\n  /**\n   * Data on the final calculation result of the constituency\n   */\n  const selectionData = useRef<SelectionData | null>(null);\n\n  /**\n   * In Scrolling\n   */\n  const [isScrolling, setIsScrolling] = useState(false);\n\n  /**\n   * Scrolling timer\n   */\n  const scrollingTimer = useRef<number | null>(null);\n\n  /**\n   * Is there SelectionData (for optimizing mount logic)\n   */\n  const hasSelectionData = useRef(false);\n\n  /**\n   * Clear internal data + trigger callback\n   */\n  const clearSelection = () => {\n    onSelectChange(null);\n    onPositionChange(null);\n    selection.current?.removeAllRanges();\n    selection.current = null;\n    setIsScrolling(false);\n    hasSelectionData.current = false;\n    if (scrollingTimer.current) {\n      clearTimeout(scrollingTimer.current);\n    }\n  };\n\n  /**\n   * Handle screen changes Scroll + Resize + Wheel + SelectionChange (mobile device)\n   */\n  const handleScreenChange = () => {\n    // Get Constituency\n    const innerSelection = window.getSelection();\n\n    const { direction = Direction.Unknown } = selectionData.current ?? {};\n\n    // If the selection is empty, return\n    if (!innerSelection) {\n      onSelectChange(null);\n      return;\n    }\n\n    const rectData = getRectData({ selection: innerSelection });\n\n    if (!rectData) {\n      onPositionChange(null);\n      return;\n    }\n\n    // Default use to get the location information of the last line of the selection (both Forward cases)\n    const rangeRect = Array.from(rectData.rangeRects).at(\n      direction === Direction.Backward ? 0 : -1,\n    );\n\n    // Returns if the last line of selection information is incorrect\n    if (!rangeRect) {\n      onPositionChange(null);\n      return;\n    }\n\n    let [x, y] = [0, 0];\n    // If the selection is selected from front to back, it is displayed at the end of the last line, otherwise it is displayed at the beginning\n    if (direction === Direction.Backward) {\n      x = rangeRect.left;\n      y = rangeRect.top + rangeRect.height;\n    } else {\n      x = rangeRect.x + rangeRect.width;\n      y = rangeRect.y + rangeRect.height;\n    }\n\n    /**\n     * Added a logic to avoid the screen\n     */\n    const position = {\n      x: x > screen.width - MAX_WIDTH ? x - MAX_WIDTH : x,\n      y:\n        y > screen.height - MAX_WIDTH\n          ? y - MAX_WIDTH\n          : rangeRect.y + rangeRect.height,\n    };\n\n    onPositionChange(position);\n  };\n\n  /**\n   * Smart processing screen changes, there is a timer + scroll notification logic\n   */\n  const handleSmartScreenChange = useEventCallback(() => {\n    if (scrollingTimer.current) {\n      clearTimeout(scrollingTimer.current);\n    }\n\n    setIsScrolling(true);\n    scrollingTimer.current = setTimeout(() => {\n      handleScreenChange();\n      setIsScrolling(false);\n    }, TIMEOUT);\n  });\n\n  /**\n   * Handling the logic of getting the selection\n   */\n  const handleGetSelection = () => {\n    if (!contentRef.current) {\n      onSelectChange(null);\n      return;\n    }\n\n    // Get Constituency\n    // eslint-disable-next-line @typescript-eslint/naming-convention -- internal variable\n    const _selection = window.getSelection();\n\n    // If the selection is empty, return\n    if (!_selection) {\n      onSelectChange(null);\n      return;\n    }\n\n    selection.current = _selection;\n\n    // Get constituency data\n    // eslint-disable-next-line @typescript-eslint/naming-convention -- internal variable\n    const _selectionData = getSelectionData({\n      selection: _selection,\n    });\n\n    // Hide Floating Button if selection is empty\n    if (!_selectionData || !_selectionData.nodesAncestorIsMessageBox) {\n      onSelectChange(null);\n      return;\n    }\n\n    // Set display and location information\n    selectionData.current = _selectionData;\n    hasSelectionData.current = Boolean(_selectionData);\n\n    handleScreenChange();\n    onSelectChange(_selectionData);\n  };\n\n  /**\n   * The action of raising the mouse\n   */\n  const handleMouseUp = useEventCallback(() => {\n    clearTimeout(timeoutRef.current);\n    timeoutRef.current = defer(handleGetSelection);\n  });\n\n  /**\n   * The action of keyboard pressing\n   */\n  const handleKeyDown = useEventCallback((e: KeyboardEvent) => {\n    const forbiddenKeyboardSelect = () => {\n      if ((e.ctrlKey || e.metaKey) && e.key === 'a') {\n        onSelectChange(null);\n      }\n    };\n\n    if (selectionData.current) {\n      forbiddenKeyboardSelect();\n\n      if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {\n        handleGetSelection();\n      }\n    }\n  });\n\n  /**\n   * Mouse press.\n   */\n  const handleMouseDown = useEventCallback((e: MouseEvent) => {\n    // Check if there is a constituency, and the target of the click event is not in the constituency\n\n    if (!contentRef.current || !floatMenuRef || !floatMenuRef?.current) {\n      return;\n    }\n\n    const { clientX, clientY } = e;\n\n    const floatMenuRect = floatMenuRef.current.getBoundingClientRect();\n\n    const isInFloatMenu =\n      clientY >= floatMenuRect.top &&\n      clientY <= floatMenuRect.bottom &&\n      clientX >= floatMenuRect.left &&\n      clientX <= floatMenuRect.right;\n\n    if (isInFloatMenu) {\n      return;\n    }\n\n    clearSelection();\n  });\n\n  useEffect(() => {\n    if (!hasSelectionData.current) {\n      return;\n    }\n\n    // Listen for mouse down events\n    window.addEventListener('mousedown', handleMouseDown);\n\n    return () => {\n      window.removeEventListener('mousedown', handleMouseDown);\n    };\n  }, [hasSelectionData.current]);\n\n  // When visible, mount the listening event to optimize listening\n  useEffect(() => {\n    if (!hasSelectionData.current) {\n      return;\n    }\n\n    window.addEventListener('resize', handleSmartScreenChange);\n    window.addEventListener('wheel', handleSmartScreenChange);\n    window.addEventListener('scroll', handleSmartScreenChange);\n    window.addEventListener('keydown', handleKeyDown);\n\n    if (isTouchDevice()) {\n      window.addEventListener('selectionchange', handleSmartScreenChange);\n    }\n\n    return () => {\n      window.removeEventListener('resize', handleSmartScreenChange);\n      window.removeEventListener('wheel', handleSmartScreenChange);\n      window.removeEventListener('scroll', handleSmartScreenChange);\n      window.removeEventListener('keydown', handleKeyDown);\n      window.removeEventListener('selectionchange', handleSmartScreenChange);\n    };\n  }, [hasSelectionData.current]);\n\n  // mount monitor on target\n  useEffect(() => {\n    const target = contentRef.current;\n\n    if (!target) {\n      return;\n    }\n\n    // Monitor selection-related mouse lift events\n    target.addEventListener('pointerup', handleMouseUp);\n\n    if (isTouchDevice()) {\n      target.addEventListener('selectionchange', handleMouseUp);\n    }\n\n    return () => {\n      target.removeEventListener('pointerup', handleMouseUp);\n      target.removeEventListener('selectionchange', handleMouseUp);\n    };\n  }, [contentRef.current]);\n\n  return {\n    /**\n     * Clear built-in state and selection\n     */\n    clearSelection,\n    /**\n     * Is it scrolling?\n     */\n    isScrolling,\n    /**\n     * Recalculate the selection position\n     */\n    computePosition: handleSmartScreenChange,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { parseMarkdownHelper } from '@coze-common/chat-area-utils';\nimport { parseMarkdown } from '@coze-arch/bot-md-box-adapter/lazy';\n\nimport { GrabElementType, type GrabNode } from '../types/node';\n\nconst { isImage, isLink, isParent, isText } = parseMarkdownHelper;\n\n/**\n * Get a GrabNode node\n * @param markdown string\n * @returns GrabNode[]\n */\nexport const parseMarkdownToGrabNode = (markdown: string) => {\n  const ast = parseMarkdown(markdown);\n\n  return getGrabNodeFromAst(ast);\n};\n\n/**\n * Parsing from Markdown's AST to a GrabNode node\n * @param ast markdown ast by parseMarkdown (md-box)\n * @returns GrabNode[]\n */\nexport const getGrabNodeFromAst = (ast: unknown): GrabNode[] => {\n  const normalizedNodeList: GrabNode[] = [];\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any -- as expected\n  const traverseAst = (_ast: any) => {\n    if (isText(_ast)) {\n      normalizedNodeList.push({\n        text: _ast.value,\n      });\n    } else if (isLink(_ast)) {\n      const children = _ast.children.map(getGrabNodeFromAst).flat(1);\n      normalizedNodeList.push({\n        type: GrabElementType.LINK,\n        url: _ast.url,\n        children,\n      });\n    } else if (isImage(_ast)) {\n      normalizedNodeList.push({\n        type: GrabElementType.IMAGE,\n        src: _ast.url,\n        children: [\n          {\n            text: _ast.alt ?? '',\n          },\n        ],\n      });\n    } else if (isParent(_ast)) {\n      _ast.children.forEach(traverseAst);\n    }\n  };\n\n  traverseAst(ast);\n\n  return normalizedNodeList;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useState } from 'react';\n\nimport { useRequest } from 'ahooks';\nimport { type IntelligenceType } from '@coze-arch/bot-api/intelligence_api';\nimport { intelligenceApi } from '@coze-arch/bot-api';\n\nexport interface UseIsPublishRecordReadyProps {\n  type: IntelligenceType;\n  intelligenceId: string;\n  spaceId: string;\n  enable?: boolean;\n}\n\nexport const useIsPublishRecordReady = ({\n  type,\n  intelligenceId,\n  spaceId,\n  enable,\n}: UseIsPublishRecordReadyProps) => {\n  const [inited, setInited] = useState(false);\n  const res = useRequest(\n    async () => {\n      const data = await intelligenceApi.PublishIntelligenceList(\n        {\n          space_id: spaceId,\n          intelligence_type: type,\n          intelligence_ids: [intelligenceId],\n          size: 1,\n        },\n        {\n          __disableErrorToast: true,\n        },\n      );\n      return data.data?.intelligences?.[0];\n    },\n    {\n      manual: true,\n      ready: enable,\n      pollingInterval: 60 * 1000, // Polling once every 60 seconds to avoid server level stress due to high frequency requests\n      pollingErrorRetryCount: 3,\n      onSuccess: target => {\n        if (target) {\n          res.cancel();\n        }\n      },\n      onFinally: () => {\n        setInited(true);\n      },\n    },\n  );\n\n  useEffect(() => {\n    setInited(false);\n    res.run();\n    return res.cancel;\n  }, [type, intelligenceId, spaceId, enable]);\n\n  return {\n    inited,\n    ready: !!res.data,\n  };\n};\n","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.status-tag-Q8SaHM{color:var(--light-usage-text-color-text-2,rgba(29,28,35,.6));letter-spacing:.12px;align-items:center;font-size:12px;font-weight:400;line-height:16px;display:flex;position:relative}.status-tag-success-box-IiEBQs{border-radius:4px;align-items:center;padding:4px;display:flex}.status-tag-warning-box-dsEHao{cursor:pointer;border-radius:4px;align-items:center;padding:4px;display:flex}.status-tag-warning-box-dsEHao:hover{background-color:rgba(46,47,56,.05)}.status-tag-warning-box-icon-AAw8Kn{color:var(--semi-color-warning)}.status-tag-warning-box-icon-AAw8Kn svg{width:10px;height:10px}.status-tag-dot-IuhXiy{align-items:center;display:flex}.status-tag-dot-IuhXiy svg,.status-tag-dot-IuhXiy img{margin-right:4px}.saving-info-b4Hfii{color:var(--light-usage-text-color-text-3,rgba(29,28,35,.35));background:var(--Light-color-grey---grey-1,#f0f0f5);border-radius:4px;margin-left:8px;padding:0 6px;font-size:12px;font-weight:500;line-height:16px}.saving-info-b4Hfii .status-tag-spin-QIh8I_{align-items:center;display:flex}.warning-content-Dk2cT_{width:400px;padding:16px}.warning-content-Dk2cT_ .title-box-GK9DE_{align-items:center;margin-bottom:12px;display:flex}.warning-content-Dk2cT_ .title-box-GK9DE_ .title-hlhtge{margin-left:8px;font-size:18px;font-weight:600;line-height:24px}.warning-content-Dk2cT_ .main-B7DftR{margin:0 0 16px 28px;font-size:14px;font-weight:400;line-height:22px}.warning-content-Dk2cT_ .main-B7DftR .warning-list-QG1Opk{flex-direction:column;margin-bottom:8px;display:flex}.warning-content-Dk2cT_ .main-B7DftR .warning-list-QG1Opk span{color:rgba(29,28,35,.6)}.warning-content-Dk2cT_ .footer-gniSC3{justify-content:flex-end;display:flex}.warning-content-Dk2cT_ .footer-gniSC3 .cancel-btn-Teok0g{height:38px;margin-right:16px}.collaboration-tag-t8wOjp{color:var(--Light-usage-text---color-text-2,rgba(29,28,35,.6));background:var(--Light-color-grey---grey-1,#f0f0f5);border-radius:4px;align-items:center;padding:0 6px;font-size:12px;font-style:normal;line-height:16px;display:flex}.collaboration-tag-t8wOjp .semi-icon{margin-right:4px}.collaboration-tag-t8wOjp .icon-submitted-YhK83T{color:var(--semi-color-primary)}.collaboration-tag-t8wOjp .icon-published-dAMlQc{color:var(--semi-color-success)}.collaboration-tag-t8wOjp .icon-warning-jSBXPO{color:var(--semi-color-warning)}`, \"\"]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"status-tag\": `status-tag-Q8SaHM`,\n\t\"statusTag\": `status-tag-Q8SaHM`,\n\t\"status-tag-success-box\": `status-tag-success-box-IiEBQs`,\n\t\"statusTagSuccessBox\": `status-tag-success-box-IiEBQs`,\n\t\"status-tag-warning-box\": `status-tag-warning-box-dsEHao`,\n\t\"statusTagWarningBox\": `status-tag-warning-box-dsEHao`,\n\t\"status-tag-warning-box-icon\": `status-tag-warning-box-icon-AAw8Kn`,\n\t\"statusTagWarningBoxIcon\": `status-tag-warning-box-icon-AAw8Kn`,\n\t\"status-tag-dot\": `status-tag-dot-IuhXiy`,\n\t\"statusTagDot\": `status-tag-dot-IuhXiy`,\n\t\"saving-info\": `saving-info-b4Hfii`,\n\t\"savingInfo\": `saving-info-b4Hfii`,\n\t\"status-tag-spin\": `status-tag-spin-QIh8I_`,\n\t\"statusTagSpin\": `status-tag-spin-QIh8I_`,\n\t\"warning-content\": `warning-content-Dk2cT_`,\n\t\"warningContent\": `warning-content-Dk2cT_`,\n\t\"title-box\": `title-box-GK9DE_`,\n\t\"titleBox\": `title-box-GK9DE_`,\n\t\"title\": `title-hlhtge`,\n\t\"main\": `main-B7DftR`,\n\t\"warning-list\": `warning-list-QG1Opk`,\n\t\"warningList\": `warning-list-QG1Opk`,\n\t\"footer\": `footer-gniSC3`,\n\t\"cancel-btn\": `cancel-btn-Teok0g`,\n\t\"cancelBtn\": `cancel-btn-Teok0g`,\n\t\"collaboration-tag\": `collaboration-tag-t8wOjp`,\n\t\"collaborationTag\": `collaboration-tag-t8wOjp`,\n\t\"icon-submitted\": `icon-submitted-YhK83T`,\n\t\"iconSubmitted\": `icon-submitted-YhK83T`,\n\t\"icon-published\": `icon-published-dAMlQc`,\n\t\"iconPublished\": `icon-published-dAMlQc`,\n\t\"icon-warning\": `icon-warning-jSBXPO`,\n\t\"iconWarning\": `icon-warning-jSBXPO`\n};\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.header-fqNHxr{z-index:999;background:var(--light-color-white);border-bottom:1px solid rgba(var(--coze-stroke-5),var(--coze-stroke-5-alpha));justify-content:space-between;align-items:center;height:56px;padding:8px 12px 8px 8px;display:flex}.header-fqNHxr .bot-avatar-ctn-EfTLJz{width:32px;height:32px;margin:0 12px;position:relative}.header-fqNHxr .bot-avatar-ctn-EfTLJz .bot-avatar-yJdzeJ{border-radius:8px;width:32px;height:32px}.header-fqNHxr .bot-info-KGsSex{flex-direction:column;display:flex}.header-fqNHxr .bot-info-KGsSex .bot-info-title-HXUsk1{max-width:calc(50vw - 237px);font-size:14px;font-weight:600;line-height:inherit;color:var(--light-color-black-black,#000);text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.header-fqNHxr .bot-info-KGsSex .bot-info-item-gap-DXJlZT{margin-bottom:2px}.header-fqNHxr .bot-info-KGsSex .bot-info-item-mw5PKA{align-items:center;height:24px;line-height:24px;display:flex}.header-fqNHxr .bot-info-KGsSex .edit-btn-qb3fv6{color:#6b6d75;margin-left:2px}.header-fqNHxr .bot-info-KGsSex .edit-btn-qb3fv6 svg{width:14px;height:14px}.header-fqNHxr .bot-info-KGsSex .edit-btn-icon-VolRUI>svg{width:16px;height:16px}.header-fqNHxr .bot-info-KGsSex .edit-btn-icon-VolRUI>svg>path{fill:#6b6d75}.header-fqNHxr .team-info-RvDFfG{color:var(--Light-usage-text---color-text-2,rgba(29,28,35,.6));letter-spacing:.12px;align-items:center;margin-right:8px;font-size:12px;font-weight:400;line-height:16px;display:flex}.header-fqNHxr .team-avatar-xSo32A{width:12px;height:12px;margin-right:2px}.header-fqNHxr .team-avatar-xSo32A svg{width:12px;height:12px}.header-fqNHxr .bot-exit-btn-y99fzN .semi-button.semi-button-with-icon-only{width:32px;padding:4px}.header-fqNHxr .status-tag-Jyrddh{color:var(--Light-usage-text---color-text-2,rgba(29,28,35,.6));letter-spacing:.12px;align-items:center;font-size:12px;font-weight:400;line-height:16px;display:flex;position:relative}.header-fqNHxr .status-tag-success-box-i4l_mb{border-radius:4px;align-items:center;display:flex}.header-fqNHxr .status-tag-warning-box-oUYTKx{cursor:pointer;border-radius:4px;align-items:center;display:flex}.header-fqNHxr .status-tag-warning-box-oUYTKx:hover{background-color:rgba(46,47,56,.05)}.header-fqNHxr .status-tag-warning-box-icon-qEcXSp{color:var(--semi-color-warning)}.header-fqNHxr .status-tag-warning-box-icon-qEcXSp svg{width:10px;height:10px}.header-fqNHxr .bot-info-background-QcHYks{background:var(--Light-color-grey---grey-1,#f0f0f5);border-radius:4px;padding:0 6px}.header-fqNHxr .status-tag-dot-XJMNtc{align-items:center;display:flex}.header-fqNHxr .status-tag-dot-XJMNtc svg{margin-right:2px}.header-fqNHxr .edito-btn-vTjeP6{color:#6b6d75;margin-left:8px}.header-fqNHxr .status-tag-spin-qB2rga{align-items:center;display:flex}.header-fqNHxr .change-tip-UkeHKs{color:var(--light-usage-text-color-text-2,rgba(29,28,35,.6));margin-right:20px;font-size:12px;font-style:normal;font-weight:400;line-height:16px}.header-fqNHxr .change-tip-icon-yV3pYV>svg{width:13px;height:13px}.header-fqNHxr .change-tip-icon-yV3pYV>svg>path{fill:#ff9600}.header-fqNHxr .saving-info-QIWJel{color:var(--Light-usage-text---color-text-2,rgba(29,28,35,.6));margin-left:8px;font-size:12px;font-weight:400;line-height:16px}.header-fqNHxr button.icon-btn-iS8vq4{width:32px;min-width:32px;max-width:32px;height:32px;min-height:32px;max-height:32px;color:var(--light-usage-text-color-text-2,rgba(29,28,35,.6));border:1px solid var(--light-usage-border-color-border,rgba(29,28,35,.08));background-color:transparent;border-radius:8px;padding:8px}.warning-content-kpGQZy{width:400px;padding:16px}.warning-content-kpGQZy .title-box-FGzzpw{align-items:center;margin-bottom:12px;display:flex}.warning-content-kpGQZy .title-box-FGzzpw .title-w0fUk6{margin-left:8px;font-size:18px;font-weight:600;line-height:24px}.warning-content-kpGQZy .main-MqVibL{margin:0 0 16px 28px;font-size:14px;font-weight:400;line-height:22px}.warning-content-kpGQZy .main-MqVibL .warning-list-eFdv3W{flex-direction:column;margin-bottom:8px;display:flex}.warning-content-kpGQZy .main-MqVibL .warning-list-eFdv3W span{color:rgba(29,28,35,.6)}.warning-content-kpGQZy .footer-g2ARQx{justify-content:flex-end;display:flex}.warning-content-kpGQZy .footer-g2ARQx .cancel-btn-ggJjZC{height:38px;margin-right:16px}.bot-menu-nav-xmjgGm{position:absolute;left:50%;transform:translate(-50%)}.team-name-VrAecF{max-width:320px}`, \"\"]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"header\": `header-fqNHxr`,\n\t\"bot-avatar-ctn\": `bot-avatar-ctn-EfTLJz`,\n\t\"botAvatarCtn\": `bot-avatar-ctn-EfTLJz`,\n\t\"bot-avatar\": `bot-avatar-yJdzeJ`,\n\t\"botAvatar\": `bot-avatar-yJdzeJ`,\n\t\"bot-info\": `bot-info-KGsSex`,\n\t\"botInfo\": `bot-info-KGsSex`,\n\t\"bot-info-title\": `bot-info-title-HXUsk1`,\n\t\"botInfoTitle\": `bot-info-title-HXUsk1`,\n\t\"bot-info-item-gap\": `bot-info-item-gap-DXJlZT`,\n\t\"botInfoItemGap\": `bot-info-item-gap-DXJlZT`,\n\t\"bot-info-item\": `bot-info-item-mw5PKA`,\n\t\"botInfoItem\": `bot-info-item-mw5PKA`,\n\t\"edit-btn\": `edit-btn-qb3fv6`,\n\t\"editBtn\": `edit-btn-qb3fv6`,\n\t\"edit-btn-icon\": `edit-btn-icon-VolRUI`,\n\t\"editBtnIcon\": `edit-btn-icon-VolRUI`,\n\t\"team-info\": `team-info-RvDFfG`,\n\t\"teamInfo\": `team-info-RvDFfG`,\n\t\"team-avatar\": `team-avatar-xSo32A`,\n\t\"teamAvatar\": `team-avatar-xSo32A`,\n\t\"bot-exit-btn\": `bot-exit-btn-y99fzN`,\n\t\"botExitBtn\": `bot-exit-btn-y99fzN`,\n\t\"status-tag\": `status-tag-Jyrddh`,\n\t\"statusTag\": `status-tag-Jyrddh`,\n\t\"status-tag-success-box\": `status-tag-success-box-i4l_mb`,\n\t\"statusTagSuccessBox\": `status-tag-success-box-i4l_mb`,\n\t\"status-tag-warning-box\": `status-tag-warning-box-oUYTKx`,\n\t\"statusTagWarningBox\": `status-tag-warning-box-oUYTKx`,\n\t\"status-tag-warning-box-icon\": `status-tag-warning-box-icon-qEcXSp`,\n\t\"statusTagWarningBoxIcon\": `status-tag-warning-box-icon-qEcXSp`,\n\t\"bot-info-background\": `bot-info-background-QcHYks`,\n\t\"botInfoBackground\": `bot-info-background-QcHYks`,\n\t\"status-tag-dot\": `status-tag-dot-XJMNtc`,\n\t\"statusTagDot\": `status-tag-dot-XJMNtc`,\n\t\"edito-btn\": `edito-btn-vTjeP6`,\n\t\"editoBtn\": `edito-btn-vTjeP6`,\n\t\"status-tag-spin\": `status-tag-spin-qB2rga`,\n\t\"statusTagSpin\": `status-tag-spin-qB2rga`,\n\t\"change-tip\": `change-tip-UkeHKs`,\n\t\"changeTip\": `change-tip-UkeHKs`,\n\t\"change-tip-icon\": `change-tip-icon-yV3pYV`,\n\t\"changeTipIcon\": `change-tip-icon-yV3pYV`,\n\t\"saving-info\": `saving-info-QIWJel`,\n\t\"savingInfo\": `saving-info-QIWJel`,\n\t\"icon-btn\": `icon-btn-iS8vq4`,\n\t\"iconBtn\": `icon-btn-iS8vq4`,\n\t\"warning-content\": `warning-content-kpGQZy`,\n\t\"warningContent\": `warning-content-kpGQZy`,\n\t\"title-box\": `title-box-FGzzpw`,\n\t\"titleBox\": `title-box-FGzzpw`,\n\t\"title\": `title-w0fUk6`,\n\t\"main\": `main-MqVibL`,\n\t\"warning-list\": `warning-list-eFdv3W`,\n\t\"warningList\": `warning-list-eFdv3W`,\n\t\"footer\": `footer-g2ARQx`,\n\t\"cancel-btn\": `cancel-btn-ggJjZC`,\n\t\"cancelBtn\": `cancel-btn-ggJjZC`,\n\t\"bot-menu-nav\": `bot-menu-nav-xmjgGm`,\n\t\"botMenuNav\": `bot-menu-nav-xmjgGm`,\n\t\"team-name\": `team-name-VrAecF`,\n\t\"teamName\": `team-name-VrAecF`\n};\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `div.link-img-Z46Zt0{border-radius:unset;display:flex}div.link-img-Z46Zt0 img{border:1px solid var(--light-usage-fill-color-fill-1,rgba(46,46,56,.08));border-radius:4px;width:100%;height:100%}.open-in-tips-JXQADQ{color:var(--light-usage-text-color-text-2,rgba(29,28,35,.6));padding:0 8px;font-size:12px;font-weight:500;line-height:16px}`, \"\"]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"link-img\": `link-img-Z46Zt0`,\n\t\"linkImg\": `link-img-Z46Zt0`,\n\t\"open-in-tips\": `open-in-tips-JXQADQ`,\n\t\"openInTips\": `open-in-tips-JXQADQ`\n};\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.wrapper-P0c82V{background-color:rgba(var(--coze-bg-1),var(--coze-bg-1-alpha));flex-direction:column;height:100%;display:flex;overflow:hidden}.layout-hotzone-q3lRf4{z-index:calc(var(--chat-z-index-header,50) + 1)}.text-gNz2wJ{font-size:12px;font-style:normal;font-weight:400;line-height:16px}.container-VD4ZJT{flex-direction:row;flex:1;width:100%;min-height:0;display:flex}.container-VD4ZJT.store-p2CEBx{height:100%}.spin-rDV5ZI{z-index:100;background-color:rgba(255,255,255,.5);width:100%;height:100%;position:absolute;top:0;left:0}.develop-area-pLWbP7{background-color:rgba(var(--coze-bg-2),var(--coze-bg-2-alpha));flex-direction:column;display:flex;overflow:hidden}.develop-area-scroll-FPIfk_{flex:1;overflow:auto}.setting-area-HhHNX9{border-left:1px solid rgba(28,29,35,.12);flex-direction:column;flex:1;display:flex;overflow:hidden}.setting-area-HhHNX9 .setting-title-block-W215sG{justify-content:flex-end;width:100%;margin:12px 0;display:flex}.setting-area-HhHNX9 .semi-collapse-item{border-bottom:none}.setting-area-HhHNX9 .semi-collapse-header{margin-left:0;margin-right:0}.setting-area-HhHNX9 .semi-collapse-content{padding-left:0;padding-right:0}.setting-area-HhHNX9 .semi-select{width:100%;min-width:80px}.setting-area-HhHNX9 .semi-collapsible-wrapper{padding-left:16px}.message-area-z_X4gq{background-color:rgba(var(--coze-bg-3),var(--coze-bg-3-alpha));flex-direction:column;justify-content:space-between;width:100%;min-width:404px;height:100%;transition:min-width .2s;display:flex;position:relative;overflow:hidden}.playground-neat-xqJerk .message-area-z_X4gq{min-width:258px}.title-w7QTwd{margin:8px 0 0 4px!important}.sheet-title-node-cover-yMCrad{flex:1;align-items:center;display:flex;overflow:hidden}.bj-cover-powtB8{background-color:rgba(var(--coze-bg-3),var(--coze-bg-3-alpha));box-shadow:0 2px 4px rgba(0,0,0,.04),0 0 1px rgba(0,0,0,.08)}.bj-img-cover-raS8HS{z-index:20;text-shadow:0 .5px 1px rgba(0,0,0,.25);background-color:transparent!important}.bj-single-cover-XVxLnC{flex:none;height:64px!important}.border-cover-eX9tLS{background-color:rgba(var(--coze-bg-3),var(--coze-bg-3-alpha));border-bottom:none!important}.spin-wrapper-IzLXPt.top-level-Az_JQK{width:100%;height:100%!important}.spin-wrapper-IzLXPt.top-level-Az_JQK .semi-spin-children{flex-direction:column;height:100%;display:flex;overflow:hidden}.sheet-view-new-header-mMtDRv{height:64px!important}.sheet-view-left-header-RV1IPt{padding:16px 16px 16px 28px!important}.icon-button-16-qNTthM{cursor:pointer}.icon-button-16-qNTthM:hover{border-radius:4px}.icon-button-16-qNTthM .semi-button.semi-button-size-small{height:16px;padding:1px!important}.tip-text-sGQwSX{color:var(--light-usage-text-color-text-2,rgba(28,29,35,.6));font-size:14px;font-style:normal;font-weight:400;line-height:22px}.sheet-view-hidden-W3DG_b{display:none}.left-sheet-config-hdxMoT{flex-direction:row;flex-shrink:0;align-items:center;display:flex}.wrapper-single-with-tool-area-hidden-kbX65k{grid-template-columns:26fr 14fr!important}.tool-card-GONXar{grid-template-columns:13fr 13fr;height:100%;display:grid;overflow:hidden}.tool-card-with-tool-area-hidden-HeT8Pd{grid-template-columns:26fr!important}.tool-hidden-hXM6B1{display:none}.config-left-Yrdzlh{flex-shrink:0;justify-content:flex-start;align-items:center;display:flex}.display-none-xiQXc_{display:none!important}`, \"\"]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"wrapper\": `wrapper-P0c82V`,\n\t\"layout-hotzone\": `layout-hotzone-q3lRf4`,\n\t\"layoutHotzone\": `layout-hotzone-q3lRf4`,\n\t\"text\": `text-gNz2wJ`,\n\t\"container\": `container-VD4ZJT`,\n\t\"store\": `store-p2CEBx`,\n\t\"spin\": `spin-rDV5ZI`,\n\t\"develop-area\": `develop-area-pLWbP7`,\n\t\"developArea\": `develop-area-pLWbP7`,\n\t\"develop-area-scroll\": `develop-area-scroll-FPIfk_`,\n\t\"developAreaScroll\": `develop-area-scroll-FPIfk_`,\n\t\"setting-area\": `setting-area-HhHNX9`,\n\t\"settingArea\": `setting-area-HhHNX9`,\n\t\"setting-title-block\": `setting-title-block-W215sG`,\n\t\"settingTitleBlock\": `setting-title-block-W215sG`,\n\t\"message-area\": `message-area-z_X4gq`,\n\t\"messageArea\": `message-area-z_X4gq`,\n\t\"playground-neat\": `playground-neat-xqJerk`,\n\t\"playgroundNeat\": `playground-neat-xqJerk`,\n\t\"title\": `title-w7QTwd`,\n\t\"sheet-title-node-cover\": `sheet-title-node-cover-yMCrad`,\n\t\"sheetTitleNodeCover\": `sheet-title-node-cover-yMCrad`,\n\t\"bj-cover\": `bj-cover-powtB8`,\n\t\"bjCover\": `bj-cover-powtB8`,\n\t\"bj-img-cover\": `bj-img-cover-raS8HS`,\n\t\"bjImgCover\": `bj-img-cover-raS8HS`,\n\t\"bj-single-cover\": `bj-single-cover-XVxLnC`,\n\t\"bjSingleCover\": `bj-single-cover-XVxLnC`,\n\t\"border-cover\": `border-cover-eX9tLS`,\n\t\"borderCover\": `border-cover-eX9tLS`,\n\t\"spin-wrapper\": `spin-wrapper-IzLXPt`,\n\t\"spinWrapper\": `spin-wrapper-IzLXPt`,\n\t\"top-level\": `top-level-Az_JQK`,\n\t\"topLevel\": `top-level-Az_JQK`,\n\t\"sheet-view-new-header\": `sheet-view-new-header-mMtDRv`,\n\t\"sheetViewNewHeader\": `sheet-view-new-header-mMtDRv`,\n\t\"sheet-view-left-header\": `sheet-view-left-header-RV1IPt`,\n\t\"sheetViewLeftHeader\": `sheet-view-left-header-RV1IPt`,\n\t\"icon-button-16\": `icon-button-16-qNTthM`,\n\t\"iconButton16\": `icon-button-16-qNTthM`,\n\t\"tip-text\": `tip-text-sGQwSX`,\n\t\"tipText\": `tip-text-sGQwSX`,\n\t\"sheet-view-hidden\": `sheet-view-hidden-W3DG_b`,\n\t\"sheetViewHidden\": `sheet-view-hidden-W3DG_b`,\n\t\"left-sheet-config\": `left-sheet-config-hdxMoT`,\n\t\"leftSheetConfig\": `left-sheet-config-hdxMoT`,\n\t\"wrapper-single-with-tool-area-hidden\": `wrapper-single-with-tool-area-hidden-kbX65k`,\n\t\"wrapperSingleWithToolAreaHidden\": `wrapper-single-with-tool-area-hidden-kbX65k`,\n\t\"tool-card\": `tool-card-GONXar`,\n\t\"toolCard\": `tool-card-GONXar`,\n\t\"tool-card-with-tool-area-hidden\": `tool-card-with-tool-area-hidden-HeT8Pd`,\n\t\"toolCardWithToolAreaHidden\": `tool-card-with-tool-area-hidden-HeT8Pd`,\n\t\"tool-hidden\": `tool-hidden-hXM6B1`,\n\t\"toolHidden\": `tool-hidden-hXM6B1`,\n\t\"config-left\": `config-left-Yrdzlh`,\n\t\"configLeft\": `config-left-Yrdzlh`,\n\t\"display-none\": `display-none-xiQXc_`,\n\t\"displayNone\": `display-none-xiQXc_`\n};\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.mask-O9yckq{pointer-events:none;z-index:10;background:linear-gradient(rgba(99,99,99,.4) 0%,rgba(99,99,99,0) 100%);width:100%;height:216px;position:absolute}`, \"\"]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"mask\": `mask-O9yckq`\n};\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.container-box-shadow-ftVmyf{z-index:1;box-shadow:0 2px 6px rgba(0,0,0,.08),0 4px 12px rgba(0,0,0,.04)}`, \"\"]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"container-box-shadow\": `container-box-shadow-ftVmyf`,\n\t\"containerBoxShadow\": `container-box-shadow-ftVmyf`\n};\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.image-W6L0lo img{-o-object-fit:cover;object-fit:cover;width:100%;height:100%}`, \"\"]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"image\": `image-W6L0lo`\n};\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.interrupt-message-box-K1c6YG{margin-top:8px}`, \"\"]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"interrupt-message-box\": `interrupt-message-box-K1c6YG`,\n\t\"interruptMessageBox\": `interrupt-message-box-K1c6YG`\n};\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../../../../../common/temp/default/node_modules/.pnpm/@rsbuild+core@1.1.13/node_modules/@rsbuild/core/compiled/css-loader/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.interrupt-message-box-Lpue4t{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;box-sizing:border-box;word-break:break-word;flex-direction:column;width:100%;font-weight:400;line-height:16px;display:flex;overflow:hidden}.interrupt-message-box-Lpue4t .interrupt-message-action-IIr8DA{color:var(--fg-coze-fg-secondary,rgba(6,7,9,.5));padding:6px}.interrupt-message-box-Lpue4t .interrupt-message-content-PWheVJ{color:var(--fg-coze-fg-primary,rgba(6,7,9,.8));background-color:var(--bg-coze-bg-max,#fff);padding:12px}.interrupt-message-box-Lpue4t .interrupt-message-content-PWheVJ .interrupt-message-content-btns-Buc7C9{justify-content:flex-end;margin-top:16px;display:flex}`, \"\"]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"interrupt-message-box\": `interrupt-message-box-Lpue4t`,\n\t\"interruptMessageBox\": `interrupt-message-box-Lpue4t`,\n\t\"interrupt-message-action\": `interrupt-message-action-IIr8DA`,\n\t\"interruptMessageAction\": `interrupt-message-action-IIr8DA`,\n\t\"interrupt-message-content\": `interrupt-message-content-PWheVJ`,\n\t\"interruptMessageContent\": `interrupt-message-content-PWheVJ`,\n\t\"interrupt-message-content-btns\": `interrupt-message-content-btns-Buc7C9`,\n\t\"interruptMessageContentBtns\": `interrupt-message-content-btns-Buc7C9`\n};\nexport default ___CSS_LOADER_EXPORT___;\n","/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * The base implementation of `_.delay` and `_.defer` which accepts `args`\n * to provide to `func`.\n *\n * @private\n * @param {Function} func The function to delay.\n * @param {number} wait The number of milliseconds to delay invocation.\n * @param {Array} args The arguments to provide to `func`.\n * @returns {number|Object} Returns the timer id or timeout object.\n */\nfunction baseDelay(func, wait, args) {\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  return setTimeout(function() { func.apply(undefined, args); }, wait);\n}\n\nexport default baseDelay;\n","import baseDelay from './_baseDelay.js';\nimport baseRest from './_baseRest.js';\n\n/**\n * Defers invoking the `func` until the current call stack has cleared. Any\n * additional arguments are provided to `func` when it's invoked.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to defer.\n * @param {...*} [args] The arguments to invoke `func` with.\n * @returns {number} Returns the timer id.\n * @example\n *\n * _.defer(function(text) {\n *   console.log(text);\n * }, 'deferred');\n * // => Logs 'deferred' after one millisecond.\n */\nvar defer = baseRest(function(func, args) {\n  return baseDelay(func, 1, args);\n});\n\nexport default defer;\n"],"names":["useGetPosition","getPositionSuccess","loading","setLoading","useState","getSysPosition","navigator","position","error","Toast","I18n","undefined","InterruptMessageContent","_plugin_chatAreaPluginContext_writeableAPI_message","_interruptMessage_required_action_submit_tool_outputs_tool_calls","_toolCall_require_info_require_fields","_toolCall_require_info_name","interruptMessage","actionText","setActionText","sendResumeMessage","stopResponding","useWriteablePlugin","PluginName","toolCall","handleAllowOnce","JSON","String","classNames","styles","Space","Button","InterruptMessageBox","props","message","meta","UIKitMessageBox","ResumeRenderLifeCycleService","WriteableRenderLifeCycleService","ctx","isRequireInfoInterruptMessage","ResumeMessageLifeCycleService","WriteableMessageLifeCycleService","ResumePlugin","WriteableChatAreaPlugin","PluginMode","ResumePluginRegistry","BotDebugChatAreaProvider","children","botId","pluginRegistryList","requestToInit","showBackground","grabEnableUpload","useMessageReportEvent","userSenderInfo","useUserSenderInfo","ChatAreaProvider","useSpaceStore","Scene","reporter","useBotEditorChatBackground","_backgroundInfo_mobile_background_image","backgroundInfo","useBotSkillStore","state","_state_backgroundImageInfoList","ChatBackgroundPlugin","createChatBackgroundPlugin","useEffect","chatBackgroundEvent","ChatBackgroundEventName","renderLifeCycleServiceGenerator","plugin","sendTeaEventOnBeforeSendMessage","params","from","isSelf","usePageRuntimeStore","teaParam","sendTeaEvent","EVENT_NAMES","handleBotStateBeforeSendMessage","scene","baseBotInfo","options","mode","useBotInfoStore","BotMode","clonedOptions","cloneDeep","merge","updateAgentBeforeSendMessage","botState","getBotStateBeforeSendMessage","TrafficScene","isCreateTaskMessage","ContentType","messageContentObject","safeJSONParse","reportReceiveEvent","messageReportEvent","currentAgentID","updatedCurrentAgentIdWithConnectStart","setMultiAgent","useMultiAgentStore","regeneratedMessageBotState","getBotState","fixedAgentId","useManuallySwitchAgentStore","messageLifeCycleServiceGenerator","_inputError_ext","inputError","CODE_JINJA_FORMAT_ERROR","Error","CustomError","reason","result","pluginBizContext","refreshTaskList","agentId","_ctx_error","errorInfo","parseErrorInfoFromErrorMessage","ChatBusinessErrorCode","commandLifeCycleServiceGenerator","_","chatModeConfig","resetHostAgent","MultiAgentSessionType","brokenMessages","hostAgentId","targetMessage","msg","parsedBotState","appLifeCycleServiceGenerator","bizLifeCycleServiceGenerator","BizPlugin","createWriteableLifeCycleServices","getDebugCommonPluginRegistry","BotDebugChatAreaProviderAdapter","userId","DebugCommonPlugin","setPageRuntimeBotInfo","GrabPlugin","grabPluginId","useCreateGrabPlugin","getMessageList","DeveloperApi","useEventCallback","onboardingContent","backgroundImageInfoList","prologue","botInfo","name","icon_url","SceneFromIDL","dratMain","ReasoningPluginRegistry","BaseProvider","DefaultFragment","React","BotEditorInitLayoutImpl","hasHeader","headerBottom","headerTop","header","customProvider","isFirstLoad","setIsFirstLoad","init","userInfo","userStoreService","modeSwitching","useBotPageStore","useUpdateEffect","s","Spin","CustomProvider","OriginStatus","savingInfoSaving","savingInfoTime","useShallow","store","Tag","IconCozLoading","renderWarningContent","warningList","onCancel","readonly","deployButton","IconAlertCircle","item","ConnectorDynamicStatus","UIButton","BotPublishStatus","connectors","noPublish","visible","setVisible","Popover","Divider","IconCozInfoCircleFill","IconCozCheckMarkCircleFill","BotInfoCardContent","spaceName","spaceType","isPersonal","SpaceType","Avatar","Typography","IconCozPeopleFill","IconCozTeamFill","formatDate","Number","BotInfoCard","isReadonly","editBotInfoFn","triggerContent","IconCozCheckMarkCircleFillPalette","IconButton","IconEditNew","BotHeader","_botInfo_name","_botInfo_name1","navigate","useNavigate","spaceID","useBotDetailIsReadonly","pageFrom","updateBotInfo","useBotInfo","botInfoRef","useRef","updateBotModal","useUpdateAgent","botID","spaceId","extra","oldBotInfo","_extra_botAvatar","_extra_botName","botInfoMap","diffTask","useDiffTaskStore","cx","Helmet","renderHtmlTitle","BotPageFromEnum","BackButton","ModeSelect","IconComponent","Object","LinkDropItem","linkInfo","hasMorePlatform","isReadOnly","mouseIn","setTrue","setFalse","useBoolean","onLinkCopy","e","copy","updateBot","useRequest","botSkillInfo","getBotDetailDtoInfo","data","updateBotRequest","updateHeaderStatus","isDisableDropItem","content","Image","Tooltip","FLOW_PUBLISH_ID","UIIconButton","IconLink","Item","window","LinkMenu","renderMorePlatform","Dropdown","MoreMenuButton","hasPublish","version","botMarketStatus","historyVisible","StoreConnector","IconMenuLogo","BotMarketStatus","extendedConnectors","hideOpenIn","FLAGS","useFlags","showPublishManageMenu","ready","inited","useIsPublishRecordReady","IntelligenceType","IconCozArrowRightFill","IconCozMore","useDeployService","handleDeploy","getBotDetailIsReadonly","handlePublish","DeployButton","hasUnpublishChange","DeployButtonUI","btnType","btnText","customStyle","tooltip","showChangeTip","onClick","disabled","ToolTipCom","showTip","Fragment","btn","BotDebugButton","bot_id","useParams","useInitAgent","useInit","modeOptionList","IconSingleMode","IconCozWorkflow","HeaderAddonAfter","isEditLocked","editable","DuplicateBot","BotEditorInitLayoutAdapter","headerExtra","pageName","layoutProps","isPreview","BotEditorLayout","ComponentType","OrderBy","BizMessageInnerAddonBottom","memo","p","reasoningFinished","setReasoningFinished","ref","MdBoxLazy","prev","next","ReadonlyChatAreaPlugin","createReadonlyLifeCycleServices","createCustomComponents","createBackgroundImageStore","mark","create","devtools","set","info","IS_DEV_MODE","bizAppLifeCycleService","storeSet","setBackgroundInfo","clearBackgroundStore","ctxBackgroundInfo","ChatBackgroundUI","_backgroundImageInfo_mobile_background_image","headerNode","useChatBackgroundContext","useReadonlyPlugin","backgroundImageInfo","isBackgroundMode","WithRuleImgBackground","mitt","EventNames","PublicEventNames","createSelectionStore","get","text","nodeList","selectionData","createQuoteStore","subscribeWithSelector","quote","updater","produce","subscribeQuoteUpdate","eventCallbacks","useQuoteStore","quoteContent","onQuoteChange","createPreferenceStore","enable","GrabMessageLifeCycleService","updateQuoteContentMapByImmer","originMessage","newContent","getOriginContentText","newMessage","quoteContentMap","localMessageId","updateQuoteVisible","updateQuoteContent","emit","GrabCommandLifeCycleService","WriteableCommandLifeCycleService","GrabAppLifeCycleService","WriteableAppLifeCycleService","unsubscribe","eventCenter","publicEventCenter","currentGrabPluginId","getMessage","messageId","chatAreaPluginContext","QuoteButton","onClose","onQuote","useSelectionStore","usePreferenceStore","enableGrab","useDeleteFile","getFileStoreInstantValues","deleteFile","deleteAllFile","fileIdList","id","getMessageInfo","IconCozQuotation","_message_sender_id","normalizeSelectionNodeList","MenuList","forwardRef","useGetScrollView","on","off","style","onScroll","onMouseEnter","onMouseLeave","className","getScrollView","menuRef","opacity","setOpacity","useImperativeHandle","refreshOpacity","_menuRef_current","localRect","scrollRect","_opacity","_opacity1","FILTER_MESSAGE_SOURCE","messageSource","GrabMenu","_floatMenuRef_current","contentRef","floatMenuRef","isFloatMenuVisible","updateFloatMenuPosition","clearSelection","isScrolling","computePosition","useGrab","_plugin_chatAreaPluginContext_readonlyAPI_message_findMessage","_selectionData_humanizedContentText","_selectionData_normalizeSelectionNodeList","_selectionData_originContentText","updateHumanizedContentText","updateNormalizeSelectionNodeList","updateOriginContentText","updateSelectionData","updateIsFloatMenuVisible","isSpecialMessage","NO_MESSAGE_ID_MARK","is_finish","_position","defer","isShowFloatMenu","useHideQuote","_props_containerRef","containerRef","targetRef","usedContainerRef","forceHidden","setForceHidden","_target_attributes_getNamedItem","target","getAncestorAttributeNode","CONTENT_ATTRIBUTE_NAME","MESSAGE_SOURCE_ATTRIBUTE_NAME","func","wait","args","toNumber","getMouseNearbyRect","rects","mouseInfo","nearbyRect","rect","useFloatMenuListener","targetElement","targetInfo","setIsScrolling","scrollingTimer","isMouseInMenu","setPosition","timer","handleMenuMouseEnter","clearTimeout","handleMenuMouseLeave","handleCardLinkElementMouseLeave","isMessageFinished","handleCardLinkElementMouseEnter","_ctx_element_textContent","handleViewScroll","delay","targetRect","menuRect","x","y","_getMouseNearbyRect","Array","handleMouseMove","event","handleSmartScreenChange","setTimeout","useAutoGetMaxPosition","messageRef","maxPositionX","setMaxPositionX","_messageRef_current_getBoundingClientRect_right","FloatMenu","_position_x","isGrabMenuVisible","isTouchDevice","top","left","_pluginBizContext_eventCallbacks","_targetInfo_current","source","type","GrabElementType","MessageListFloat","quoteNodeColorVariants","cva","getQuoteNode","theme","handleClickImage","node","index","isGrabTextNode","typeSafeQuoteNodeColorVariants","isGrabImage","isGrabLink","QuoteNode","previewUrl","setPreviewUrl","useShowBackGround","ImagePreview","Boolean","url","getReferFromMessage","refer_items","_JSON_parse","_firstItem_image","_firstItem_image_image_thumb","firstItem","QuoteTopUI","RemoteQuoteInnerTopSlot","refer","parseMarkdownToGrabNode","LocalQuoteInnerTopSlot","localNodeList","QuoteMessageInnerTopSlot","QuoteInputAddonTop","useChatInputLayout","quoteVisible","layoutContainerRef","handleStopPropagation","_layoutContainerRef_current","IconCozCross","ChatAreaGrabPlugin","updateEnableGrab","createGrabPlugin","preference","nanoid","grabPlugin","unsubscribeQuoteStore","setGrabEnableUpload","useMemo","isEmpty","Direction","document","getAllNodesInRange","range","nodes","treeWalker","NodeFilter","currentNode","findAncestorNodeByTagName","tagName","upperTagName","Node","getAncestorAttributeValue","attributeName","_node_attributes_getNamedItem","attributeValue","Element","shouldRefineRange","validNodeLength","hasNodeInLink","endOffset","findLastSiblingNode","scopeAncestorAttributeName","targetAttributeValue","lastValidSibling","findLastChildNode","compareNodePosition","nodeA","nodeB","comparison","fixStartNode","targetAttributeName","startNode","startOffset","findNearestAnchor","fixLink","endNode","startAnchor","endAnchor","isFix","fixEndNode","_findLastChildNode_textContent_length","getAllChildNodesInNode","_node","findNotContainsPreviousSibling","_node_previousSibling","sibling","fixEndEmpty","textContent","_currentNode_textContent","_currentNode_textContent1","textContent1","_currentNode_textContent2","_child_textContent","lastTextNode","child","refineRange","parentNode","lastSibling","liParentNode","aParentNode","divParentNode","relation","isFixLink","isFixEndEmpty","normalizeNodeList","getPictureNodeUrl","findPictureValidChildNode","childNodes","processSpecialNode","pictureNode","getNormalizeNodeList","childNodeList","normalizedNodeList","childNode","specialNode","grabNode","generateGrabNode","grabNode1","normalizedNodeListInLoop","isTable","generateGrabText","generateGrabElement","_node_textContent","safeTextContent","grabText","grabText1","getHumanizedContentText","hasVisibleSelection","documentFragment","textNodes","collectTextNodes","textNode","getSelectionDirection","selection","anchorNode","focusNode","anchorOffset","focusOffset","getSelectionData","_ancestorNodeWithAttribute_attributes_getNamedItem_value","_ancestorNodeWithAttribute_attributes_getNamedItem1","hasFix","direction","ancestorNodeWithAttribute","ancestorAttributeValue","humanizedContentText","originContentText","getRectData","rangeRects","onSelectChange","onPositionChange","timeoutRef","hasSelectionData","_selection_current","handleScreenChange","_selectionData_current","innerSelection","rectData","rangeRect","screen","handleGetSelection","_selection","_selectionData","handleMouseUp","handleKeyDown","handleMouseDown","clientX","clientY","floatMenuRect","isImage","isLink","isParent","isText","parseMarkdownHelper","markdown","getGrabNodeFromAst","parseMarkdown","ast","traverseAst","_ast","_ast_alt","intelligenceId","setInited","res","_data_data_intelligences","intelligenceApi","___CSS_LOADER_EXPORT___","module","TypeError"],"mappings":"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"}