{"version":3,"file":"static/js/async/3986.9f883976.js","sources":["webpack://@coze-studio/app/../../packages/workflow/components/src/workflow-modal/hooks/use-workflow-action.tsx","webpack://@coze-studio/app/../../packages/workflow/components/src/workflow-modal/hooks/use-workflow-product-list.ts","webpack://@coze-studio/app/../../packages/workflow/components/src/workflow-modal/hooks/use-workflow-search.tsx","webpack://@coze-studio/app/../../packages/workflow/components/src/workflow-modal/sider/workflow-filter.tsx","webpack://@coze-studio/app/../../packages/workflow/components/src/workflow-modal/sider/index.tsx","webpack://@coze-studio/app/../../packages/workflow/components/src/workflow-modal/hooks/use-workflow-modal-parts.tsx","webpack://@coze-studio/app/../../packages/workflow/components/src/workflow-modal/index.tsx","webpack://@coze-studio/app/../../packages/workflow/components/src/workflow-modal/sider/create-workflow-btn.tsx","webpack://@coze-studio/app/../../packages/workflow/components/src/workflow-modal/type.ts","webpack://@coze-studio/app/../../packages/workflow/components/src/workflow-modal/utils.ts","webpack://@coze-studio/app/../../packages/workflow/components/src/workflow-modal/workflow-modal-context.tsx","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/validate/types.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/render/types.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/validate/encapsulate-validate-manager.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/utils/exclude-start-end.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/generate/types.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/utils/get-nodes-parent-id.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/utils/get-node-point.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/utils/set-node-position.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/encapsulate-context.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/utils/check-encapsulate-gray.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/utils/subcanvas.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/encapsulate/encapsulate-lines-service.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/utils/random-name-suffix.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/utils/has-sub-canvas-nodes.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/api/types.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/api/constants.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/api/encapsulate-api-service.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/utils/variable.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/utils/get-nodes-with-sub-canvas.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/encapsulate/encapsulate-variable-service.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/encapsulate/encapsulate-nodes-service.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/encapsulate/constants.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/encapsulate/encapsulate-service.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/utils/get-sub-workflow-info.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/encapsulate/types.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/encapsulate/encapsulate-manager.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/generate/encapsulate-generate-service.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/validate/encapsulate-validate-service.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/validate/encapsulate-validate-result.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/workflow-encapsulate-container-module.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/validators/encapsulate-base-validator.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/validators/sub-canvas-validator.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/validators/start-end-validator.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/validators/loop-nodes-validator.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/validators/encapsulate-schema-validator.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/validators/encapsulate-ports-validator.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/validators/encapsulate-output-lines-validator.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/validators/encapsulate-input-lines-validator.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/validators/encapsulate-form-validator.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/validators/encapsulate-validators-container-module.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/render/encapsulate-render-service.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/render/encapsulate-shortcuts-contribution.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/render/encapsulate-render-container-module.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/render/hooks/use-selected-nodes.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/render/hooks/use-variable-change.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/render/hooks/use-encapsulate.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/render/encapsulate-tooltip/error-title.tsx","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/render/encapsulate-tooltip/index.tsx","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/render/constants.ts","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/render/encapsulate-button/index.tsx","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/render/hooks/use-validate.tsx","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/render/encapsulate-panel/index.tsx","webpack://@coze-studio/app/../../packages/workflow/feature-encapsulate/src/create-workflow-encapsulate-plugin.ts","webpack://@coze-studio/app/../../packages/workflow/history/src/services/workflow-operation-report-service.ts","webpack://@coze-studio/app/../../packages/workflow/history/src/create-operation-report-plugin.ts","webpack://@coze-studio/app/../../packages/workflow/history/src/workflow-history-config.ts","webpack://@coze-studio/app/../../packages/workflow/history/src/workflow-history-shortcuts-contribution.ts","webpack://@coze-studio/app/../../packages/workflow/history/src/utils/should-merge.ts","webpack://@coze-studio/app/../../packages/workflow/history/src/operation-metas/index.ts","webpack://@coze-studio/app/../../packages/workflow/history/src/operation-metas/add-node.ts","webpack://@coze-studio/app/../../packages/workflow/history/src/operation-metas/add-line.ts","webpack://@coze-studio/app/../../packages/workflow/history/src/workflow-history-operations-contribution.ts","webpack://@coze-studio/app/../../packages/workflow/history/src/workflow-history-container-module.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/constants.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/entity-datas/workflow-node-data/types.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/entity-datas/workflow-node-data/workflow-node-data.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/service/workflow-nodes-service.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/setting-on-error/constants.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/setting-on-error/data-transformer.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/setting-on-error/hooks/index.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/setting-on-error/types.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/setting-on-error/utils.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/setting-on-error/utils/generate-meta.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/setting-on-error/utils/get-timeout-config.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/setting-on-error/utils/outputs.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/typings/trigger.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/utils/get-input-type.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/utils/get-llm-models.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/utils/get-llm-model-ids.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/utils/get-sorted-input-parameters.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/utils/llm-utils.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/utils/node-utils.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/validators/input-tree-validator.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/validators/node-meta-validator.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/validators/json-schema-validator.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/validators/output-tree-validator/schema.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/validators/output-tree-validator/index.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/validators/setting-on-error-validator.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/workflow-json-format.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/workflow-document-with-format.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/workflow-nodes-container-module.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/bots.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/use-bot-info.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/use-extra-bot-option.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/use-project-info.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/chat-history-round/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/code-editor/code-editor.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/code-editor/text-editor.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/code-editor/themes/coze-dark.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/code-editor/themes/coze-light.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/condition-item-logic/constants.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/condition-item-logic/condition-item-logic.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/copy-button/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/database-detail-modal/use-workflow-detail-modal-store.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/database-detail-modal/database-detail-model.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/database-detail-modal/use-open-database-detail.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/editor-container/expand-editor/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/editor-container/inner-editor/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/editor-container/theme-provider.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/file-icon/get-icon-by-extension.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/file-icon/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/line-add-button/button.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/line-add-button/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/model-select/utils/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/model-select/components/selector/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/model-select/components/settings.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/model-select/components/model-setting.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/model-select/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-context-provider.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-icon/node-icon-outlined.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-icon/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/constant.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/components/node-placeholder.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/hooks/node-panel-context.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/hooks/use-template-node-list.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/hooks/use-favorite-plugin-node-list.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/hooks/use-search-node.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/components/node-category-panel/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/components/load-more-card.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/components/custom-drag-card.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/components/card.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/components/sub-workflow-category-list/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/components/plugin-node/plugin-tool-card.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/components/plugin-node/plugin-node-card.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/components/plugin-node/plugin-node.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/components/plugin-node/plugin-node-list.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/components/plugin-node/plugin-category-list.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/components/atom-category-list/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/components/search-result-node-list/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/components/plugin-node/favorite-plugin-node-list.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/components/list.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-panel/components/panel.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/components/condition/condition-tag.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/components/condition/logic-display.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/components/condition/variable-display.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/use-valid-variable.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/components/condition/condition-container.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/components/condition/expression-display.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/message-content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/constants.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/database-condition/database-condition-right.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/database-condition/database-condition-operator.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/database-condition/database-condition-left.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/database-condition/database-condition.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/database-condition/use-conditions.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/field-empty.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/field.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/condition-branch.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/conditions.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/model.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/intents.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/knowledge.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/question-pairs.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/http-api-field/url-field.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/hooks/use-http-url-variables.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/http-api-field/url-container.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/http-api-field/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/database-setting-fields.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/input-parameters.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/label-with-tooltip.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/message-output.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/outputs.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/use-outputs-variable-tags.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/overflow-tag-list.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/port.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/question-pairs-answer.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/terminate-plan.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/use-input-parameters-variable-tags.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/variable-tag-list.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/hooks/use-available-node-variables.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/placeholder.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/popup-container/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/reference-node-info/use-node-origin.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/reference-node-info/reference-node-origin.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/reference-node-info/check-update-version-model.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/reference-node-info/base-version.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/reference-node-info/reference-node-version.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/reference-node-info/skill-version.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sortable-list/hooks/use-sort.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sortable-list/components/sortable-item.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sortable-list/components/custom-drag-layer.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sortable-list/components/sortable-list.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sortable-list/components/drag-handle.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/tag-list/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/bot-project-variable-select/variable-panel/variable-panel.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/bot-project-variable-select/variable-panel/use-related-variable.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/bot-project-variable-select/related-bot-panel/option-item.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/bot-project-variable-select/related-bot-panel/empty-content.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/bot-project-variable-select/related-bot-panel/panel.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/bot-project-variable-select/select.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/bot-project-variable-select/related-bot-panel/use-related.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/bot-project-variable-select/related-bot-panel/use-query-bot-list.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/bot-project-variable-select/select.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/constants/test-form.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/constants/index.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/cost-popover/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/execute-result/test-run-cost-popover.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/hooks/use-cancel-test-run.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/hooks/use-get-start-node.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/hooks/use-need-bot.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/utils/generate-test-form-fields.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/utils/ignore-rehaje-expression.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/utils/generate-test-form-initial-value.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/hooks/use-test-form-initial-value-v2.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/hooks/use-need-scene-bot.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/utils/generate-update-trigger-fields.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/utils/generate-imageflow-generate-test-form-fields.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/utils/generate-crud-nodes-test-run-form-fields.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/hooks/use-get-scene-flow-role-list-schema.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/hooks/use-generate-test-form-fields.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/hooks/use-test-form-schema.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/hooks/use-test-run-flow-v2.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/hooks/use-test-run-flow.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/hooks/use-test-run-status.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/hooks/use-testset-biz-ctx.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/img-log-v2/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/img-log-v2/use-images.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/img-log/use-current-node.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/img-log/use-download-images.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/img-log/use-test-run-result.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/file/use-file-dragging.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/file/custom-upload-node.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/file/custom-file-item.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/file/base-adapter.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/file/types.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/file/typed-file-input/url-input.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/file/typed-file-input/type-select.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/file/typed-file-input/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/json-editor/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/json-editor/index.tsx","webpack://@coze-studio/app/../../packages/workflow/nodes/src/utils/trigger-form.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-run-button/trigger-test-run-button.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-run-button/single-node.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-run-button/start-test-run-button.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/utils/common.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/utils/is-static-object-ref.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/utils/stringify-value.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/template-panel/constants.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-refresh-modal/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-outer-side-sheet/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-references/references-tip.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/execute-result/execute-result-side-sheet/hooks/use-node-error-list.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/execute-result/execute-result-side-sheet/hooks/use-line-error-list.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/execute-result/execute-result-side-sheet/hooks/use-has-error.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/execute-result/execute-result-side-sheet/components/execute-state.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header-info/components/workflow-status.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header-info/components/edit-modal.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header-info/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/publish-button-v2/use-is-publish-disabled.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/publish-button-v2/tooltip-with-disabled.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/publish-button-v2/base-publish-button.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/publish-button-v2/publish-with-version-v2.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/publish-button-v2/publish-with-force.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/publish-button-v2/publish-with-version.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/publish-button-v2/publish-with-diff.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/publish-button-v2/publish-with-env.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/publish-button-v2/publish-button.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/toolbar/constants.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/toolbar/hooks/use-add-node.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/toolbar/hooks/use-minimap-visible.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/toolbar/hooks/use-toolbar-handlers.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/toolbar/hooks/use-auto-layout.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/empty-role-avatar.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-button/role-avatar.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-button/onboarding.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-button/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-voices/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-voices/role-voices.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-voices/voice-player.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-voices/voice-data-select/use-voice-options.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-voices/voice-data-select/voice-select.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-voices/voice-select.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-voices/voice-data-select/use-language-options.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-voices/add-voices.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-voices/text-to-voice.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-suggestion/role-suggestion.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-suggestion/role-suggestion-switch.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-onboarding/suggestion-list.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-onboarding/display-all.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-onboarding/ai-generate-btn.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-name-input.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-input/role-default-input.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-background/background-upload/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-background/background-upload/use-upload-image.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-background/background-upload/use-submit-cropped-image.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-background/background-upload/use-drag-image.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-background/background-upload/upload-modal-footer.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-background/background-upload/drag-upload-content.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-background/background-upload/cropper/use-crop-image.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-background/background-upload/cropper/cropper-cover.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-background/background-upload/cropper/cropper-img.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-background/background-upload/background-modal.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-background/role-background.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-background/add-background.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-avatar-upload/utils/custom-upload-request.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-avatar-upload/utils/get-base64.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/role-avatar-upload/picture-upload.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-form/config-form.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/template-panel/use-workflow-template-list.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/float-layout/float-panel.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/float-layout/float-layout.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/float-layout/panel-wrap.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/flow-role/role-config-panel/config-panel.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/toolbar/components/zoom.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/toolbar/components/minimap-switch.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/toolbar/components/interactive.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/toolbar/components/comment.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/toolbar/components/auto-layout.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/toolbar/components/add-node.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/toolbar/components/tools.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/toolbar/components/minimap.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/toolbar/components/container.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/execute-result/execute-result-side-sheet/hooks/use-result-side-sheet-visible.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/template-panel/template-slide-button.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/template-panel/template-preview-inner.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/template-panel/template-preview.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/template-panel/template-card.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/template-panel/template-card-list.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/template-panel/template-panel.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/retrieve-banner/use-retrieve.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/retrieve-banner/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/execute-result/execute-result-side-sheet/hooks/use-scroll-to-error.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/problem-panel/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/modify-banner/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/drag-tooltip/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/chat-testrun-pause-side-sheet/title.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/chat-testrun-pause-side-sheet/message-form.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/chat-testrun-pause-side-sheet/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/trace/use-goto-node.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/trace/trace-list-panel.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/trace/trace-detail-panel.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/hooks/use-chatflow-info.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/resizable-side-panel/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/resizable-side-panel/constants.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/resizable-side-panel/use-side-panel-width.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/resizable-side-panel/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/resizable-side-panel/use-resizable.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-v3/mode-form-kit/visit-node-leaf.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-v3/mode-form-kit/get-json-mode-field-default-value.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-v3/mode-form-kit/to-json-mode-schema.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-v3/mode-form-kit/set-cache-values.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-v3/mode-form-kit/file-info.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-v3/mode-form-kit/format-values.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-v3/mode-form-kit/merge-form-values.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-v3/mode-form-kit/to-json-values.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-v3/mode-form-kit/try-save-testset.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/json-mode-input/render-dom.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/json-mode-input/voice-widget.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/json-mode-input/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/json-mode-input/file-widget.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/json-mode-input/completion.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/json-mode-input/get-extensions.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/node-field-collapse/node-switch/mode-switch.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/conversation-select/conversations.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/conversation-select/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/variables.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/use-variables.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/use-table-info.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/use-project-variables.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/use-ltm-info.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/use-chat-history.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/table-info.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/item.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/chat-history.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/bot-project-select/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-v3/use-mode-form-schema.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-v3/use-mode-form-event.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-v3/test-run-form-model.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-v3/test-form-v3.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/node-field-collapse/collapse.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/related-field-collapse/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/file/file-v2.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/json-mode-input/json-mode-input.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/testset/testset-save.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/testset/testset-select.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/question-form/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/input-form/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/hooks/use-log-view.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/bot-project-select/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/chat-flow-test-form-panel/testset-bot-project-select.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-sheet-v2/running-panel.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-sheet-v2/result-log.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-sheet-v2/header.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-sheet-v2/footer.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-sheet-v2/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-header/test-form-header.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/chat-history/use-skeleton.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/chat-history/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/chat-flow-test-form-panel/test-form-provider.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/chat-flow-test-form-panel/test-form-float-button.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/conversation-select/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/chat-flow-test-form-panel/test-form.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/chat-flow-test-form-panel/conversation-select/conversation-select.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/chat-flow-test-form-panel/test-form-panel.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-sheet-v2/test-node-form.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-side-sheet/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-container/workflow-float-layout.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-container/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-container/use-data-compensation.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-container/use-nodes-mount.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/force-push-popover/force-push-popover.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/force-push-popover/use-force-push.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/history-button/components/history-drawer/use-commit-action.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/history-button/components/history-drawer/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/duplicate-button.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/reference-modal/utils.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/reference-modal/link-node.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/components/reference-modal/tooltip-content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/constants.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-references/publish-confirm-content.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/hooks/use-diff-confirm/components/diff-table.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/hooks/use-diff-confirm/components/diff-modal.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/hooks/use-diff-confirm/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/hooks/use-merge-confirm/merge-context.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/hooks/use-merge-confirm/use-merge.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/hooks/use-merge-confirm/components/merge-table.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/hooks/use-merge-confirm/components/merge-banner.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/hooks/use-merge-confirm/components/merge-footer.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/hooks/use-merge-confirm/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/hooks/use-publish-reference-confirm.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-header/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-inner-side-sheet/hooks/use-inner-side-sheet-store.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-inner-side-sheet/components/singleton-inner-side-sheet.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-inner-side-sheet/hooks/use-singleton-inner-side-sheet.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/workflow-inner-side-sheet/components/inner-side-sheet-holder.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/constants/condition-operator-map.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/constants/database-field-names.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/constants/index.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/constants/question-settings.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/typings/test-run.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/constant.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/parsers/text.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/parsers/markdown.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/parsers/json.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/parsers/html.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/parsers/index.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/entity-datas/workflow-node-test-run-data/workflow-node-test-run-data.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/utils/add-node-data.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/container/workflow-nodes-v2-contribution.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/output-tree/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/helper.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/node-header/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/model-select/utils/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/model-select/components/selector/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/model-select/components/settings.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/model-select/components/model-setting.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/model-select/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/message-visibility/context.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/message-visibility/player-checkbox-group.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/message-visibility/nickname-variable-checkbox-group.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/message-visibility/role-select-panel.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/message-visibility/role-select-option-item.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/message-visibility/message-visibility.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/message-visibility/constants.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/message-visibility/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/message-visibility/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/input-tree/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/img-log/images.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/img-log/use-element-width.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/img-log/images-with-download.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/img-log/use-images.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/img-log/use-parse-images.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/img-log/use-test-run-outputs-value.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/img-log/empty.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/img-log/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/image-preview/utils/is-input-as-output.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/image-preview/hooks/use-ref-variable-path-list.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/image-preview/hooks/use-listen-variable-change.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/image-preview/hooks/use-input-contains-image.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/image-preview/hooks/use-image-preview-visible.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/image-preview/utils/is-output-contains-image.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/file-upload/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/custom-port/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/cronjob-select/fix-cronjob.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/cronjob-select/ai-cronjob.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/hidden-condition/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/chat-history/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/canvas/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/answer-option/option-item.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/answer-option/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/json-editor/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/cronjob-select/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/input/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/form/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/number/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/code/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/loop-output-select/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/mutable-variable-assign/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/dataset-select/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/dataset-write-index/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/dataset-setting/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/node-input-name/index.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/node-input-name/node-input-name.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/node-output-name/index.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/node-output-name/node-output-name.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/output-label-text/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/custom-port/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/checkbox/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/image-preview/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/local-input-select/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/local-input-select/local-input-select.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/dataset-write-parser/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/dataset-write-chunk/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/decorators/form-layout/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/decorators/form-card/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/decorators/columns-title/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/decorators/index.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/decorators/style/style.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/decorators/form-layout/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/decorators/form-item/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/decorators/form-item-feedback/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/form-ability-extensions-form-contribution/form-ability-extensions-form-contribution.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sub-canvas/hooks/use-parent-node.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sub-canvas/hooks/use-render-props.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sub-canvas/components/header/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sub-canvas/components/background/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sub-canvas/components/container/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sub-canvas/components/border/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sub-canvas/components/ports/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sub-canvas/components/tips/global-store.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sub-canvas/components/tips/use-control.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sub-canvas/components/tips/is-mac-os.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sub-canvas/components/tips/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/sub-canvas/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/execute-result/execute-log-id.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/execute-result/execute-result-panel/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/execute-status-bar-v2/view-data-button.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/utils/generate-auth.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/execute-status-bar-v2/use-status.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/execute-status-bar-v2/use-setting-on-error-desc.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/execute-status-bar-v2/content.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/execute-status-bar-v2/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/wrapper.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/ports.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/header.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-system-error-render/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/error.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/exception-field/exception-port.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/fields/exception-field/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/variable-merge-content/variable-merge-item.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/variable-assign-content/inputs.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/variable-assign-content/use-variable-assign-tags.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/llm-content/use-skill-tags.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/llm-content/skill-tags.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/llm-content/skill.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/llm-content/update-node-skills.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/knowledge-content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/image-generate-content/icon.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/image-generate-content/references.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/image-generate-content/model.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/database-content/database.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/common-content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/question-content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/llm-content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/image-generate-content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/database-content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/variable-merge-content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/variable-merge-content/use-variable-merge-variable-tags.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/variable-assign-content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/http-content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/database-create-content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/database-delete-content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/database-update-content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/content/database-query-content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/node-render-new/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-render/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/line-popover/svg/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/line-popover/line-error-tip.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/line-popover/line-popover.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/model.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/commands/select-all.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/commands/bold.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/commands/italic.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/commands/underline.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/commands/strikethrough.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/commands/paragraph.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/commands/heading.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/commands/clear-format.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/commands/block-prefix.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/hooks/use-model.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/hooks/use-size.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/hooks/use-overflow.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/components/toolbar.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/components/toolbar-container/use-position.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/components/toolbar-container/use-activate.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/components/toolbar-container/portal.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/components/toolbar-container/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/components/editor/placeholder.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/components/editor/leaf.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/components/editor/block.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/components/editor/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/components/drag-area.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/components/content-drag-area.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/components/container.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/components/resize-area.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/components/border-area.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/components/blank-area.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/comment/components/render.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/container/workflow-page-contribution.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/node-placeholder/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/container/workflow-node-contribution.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/container/workflow-page-container-module.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/contexts/add-node-modal-context.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/contexts/node-render-context.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/entities/workflow-test-form-state-entity.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/entities/workflow-template-state-entity.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/entities/workflow-dependency-state-entity.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/entities/workflow-exec-state-entity.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/entities/workflow-global-state-entity.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/entities/workflow-dataset-store-entity.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/add-item-button/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/checkbox-with-label/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/checkbox/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/columns-title-with-action/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/columns-title/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/dataset-select/use-douyin-knowledge-list-modal.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/dataset-select/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/dataset-setting/components/SliderArea/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/dataset-setting/components/TitleArea/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/dataset-setting/components/SearchStrategy/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/dataset-setting/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/dataset-setting/type.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/dataset-write-chunk/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/dataset-write-parser/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/form-card/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/form-item-feedback/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/form-item/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/icon-name-desc-card/tooltip-action.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/icon-name-desc-card/card.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/input-tree/constants.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/input-tree/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/input-tree/context.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/input-tree/components/input-value/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/input-tree/components/input-operator/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/input-tree/components/input-name/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/input-tree/hooks/use-columns-style.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/input-tree/components/input-tree-node/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/input-tree/components/input-header/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/input-tree/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/label-with-tooltip/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/level-line/types.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/level-line/level-line.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/level-line/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/library-select/library-card.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/library-select/library-select.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/loop-output-select/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/mutable-variable-assign/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/node-header/use-move-out.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/node-header/description-display.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/node-header/description.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/node-header/components/PluginMockSet.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/node-header/components/help-link-button.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/node-header/components/close-button.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/node-header/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/node-header/utils/get-bg-color.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-param-display/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/custom-tree-node/constants.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/context.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/response-format/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/json-editor/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/json-import/utils/merge.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/json-import/utils/cut-off.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/json-import/utils/batch.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/json-import/utils/add-readonly-data.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/json-import/json-editor-with-state.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/json-import/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/hooks/use-columns-style.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/constants.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/header/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/custom-tree-node/components/param-type/constants.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/custom-tree-node/components/param-type/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/custom-tree-node/components/param-required/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/custom-tree-node/components/param-operator/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/custom-tree-node/components/param-name/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/file/voice-adapter.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/file/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/custom-tree-node/components/conversation-select/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/custom-tree-node/components/expand-content/input-time.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/custom-tree-node/components/expand-content/default-value-input.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/custom-tree-node/components/expand-content/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/custom-tree-node/components/expand-btn/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/components/custom-tree-node/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/output-tree/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/question-limit/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/radio/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/utils/index.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/hooks/use-json-with-outputs.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/hooks/use-batch-change.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/json-editor/json-editor.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/json-editor/icons.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/components/test-run/test-form-materials/json-editor/new.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/utils/generate-json-schema.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/error-form.tsx","webpack://@coze-studio/app/../../packages/workflow/nodes/src/setting-on-error/hooks/use-timeout-config.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/components/error-form/use-exapand.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/components/timeout/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/components/retry-times/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/components/process-type/option-item.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/components/process-type/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/components/json/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/components/header/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/components/ext/trigger.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/components/ext/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/utils/is-exception.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/hooks/use-exception-change.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/components/error-form/content.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/components/error-form/card.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/components/error-form/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/setting-on-error.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/hooks/use-setting-on-error.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/setting-on-error/hooks/use-refresh-on-variable-change.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/slider-with-input/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/tree-variable-selector/expand-icon.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/tree-variable-selector/node-variable-tree.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/tree-variable-selector/composite-select-option.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/tree-variable-selector/composite-select-tree-panel.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/tree-variable-selector/context.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/tree-variable-selector/global-var-icon.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/tree-variable-selector/value-display.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/tree-variable-selector/composite-select.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/tree-variable-selector/variable-selector.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/tree-variable-selector/types.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/tree-variable-selector/use-global-variable-cache.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/tree-variable-selector/useFormatVariableDataSource.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/tree-variable-selector/utils.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/utils/semi-ui.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/validation/context.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/validation/hooks.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/validation/with-validation.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/validation/validation-error-wrapper.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/value-expression-input/context.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/literal-value-input/utils.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/literal-value-input/input-string.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/literal-value-input/constants.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/literal-value-input/input-number.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/literal-value-input/input-integer.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/literal-value-input/input-boolean.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/literal-value-input/input-time.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/literal-value-input/input-json.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/literal-value-input/input-select.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/literal-value-input/literal-value-input.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/file-input/transform.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/file-input/upload-context.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/file-input/components/file-upload-btn.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/file-input/components/file-tag.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/file-input/components/multi-input.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/file-input/components/img-preview-popover.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/file-input/components/single-input.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/file-input/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/value-expression-input/voice/voice-option.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/value-expression-input/object-ref-display.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/value-expression-input/const.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/value-expression-input/value-expression-input.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/value-expression-input/voice/use-voice.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/value-expression-input/index.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/value-expression-input/typed-value-expression-input.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/value-expression-input/ref-value-display.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/variable-type-selector/utils.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/variable-type-selector/constants.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/variable-type-selector/variable-type-selector.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/variable-type-tag/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/hooks/use-fit-view-port.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/hooks/use-llm-prompt-history.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/hooks/use-vector-model-list.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/hooks/use-get-current-input-parameters.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/hooks/use-node-available-variables.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/answer-option/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/code/hooks/use-ide-input-output-type.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/code/biz-ide-panel/biz-ide.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/code/code-with-biz-ide.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/code/constants.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/code/context.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/code/defaults.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/hidden-condition/condition-item.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/validate/ValidationField.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/condition-params-item/constants.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/condition-params-item/operator/convert-map2options.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/condition-params-item/delete/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/condition-params-item/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/condition-params-item/operator/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/condition-params-item/value-expression-with-state/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/condition-item-logic.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/condition-branch.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/condition-header.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/condition-params-item/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/constants.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/context.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/draggable/condition-branch-preview.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/draggable/condition-branch.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/draggable/container.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/draggable/custom-drag-layer.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/draggable/types.ts","webpack://@coze-studio/app/../../packages/workflow/nodes/src/typings/playground-context.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/validate/use-condition-validate.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/condition/multi-condition/validate/validate.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/database-select/use-modal.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/database-select/database-select.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/database-select/use-libraries.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/database-select/use-tags.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/tag-selector/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/components/tag-selector/use-slot-node.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/delimiter-selector/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/expression-editor/container/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/expression-editor/hooks.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/expression-editor/index.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/expression-editor/utils/convert-inputs.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/model-select/components/selector/model-select-v2.tsx","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/node-input-name/utils.ts","webpack://@coze-studio/app/../../packages/workflow/playground/src/form-extensions/setters/notify/index.tsx"],"sourcesContent":["/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/max-line-per-function */\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { useContext, useEffect } from 'react';\n\nimport { isBoolean } from 'lodash-es';\nimport { type WorkflowNodeJSON } from '@flowgram-adapter/free-layout-editor';\nimport {\n  useCozeProRightsStore,\n  getIsCozePro,\n} from '@coze-workflow/resources-adapter';\nimport {\n  type DeleteType,\n  type Workflow,\n  workflowApi,\n  WorkflowMode,\n} from '@coze-workflow/base/api';\nimport { I18n } from '@coze-arch/i18n';\nimport { type DynamicParams } from '@coze-arch/bot-typings/teamspace';\nimport { CustomError } from '@coze-arch/bot-error';\nimport { ProductEntityType } from '@coze-arch/bot-api/product_api';\nimport { PluginType } from '@coze-arch/bot-api/developer_api';\nimport { PluginDevelopApi } from '@coze-arch/bot-api';\nimport { Button, Space, Toast, Typography } from '@coze-arch/coze-design';\n\nimport WorkflowModalContext from '../workflow-modal-context';\nimport { isSelectProjectCategory } from '../utils';\nimport {\n  type BotPluginWorkFlowItem,\n  DataSourceType,\n  type ProductInfo,\n  type WorkflowInfo,\n  type WorkflowItemType,\n  type WorkFlowModalModeProps,\n} from '../type';\nimport { reporter, wait } from '../../utils';\n\n/**\n * special error code\n * - 788664021: Due to model reasons, replicating workflows in the store is not currently supported\n * - 788664024: The template has not been purchased, please go to the template details page to buy and then copy it.\n */\nconst copyProductErrorCodes = ['788664021', '788664024'];\n\nconst { Text } = Typography;\n\nexport interface WorkflowCardProps extends WorkFlowModalModeProps {\n  data: WorkflowInfo | ProductInfo;\n  workflowNodes?: WorkflowNodeJSON[];\n  copyProductHandle: (\n    item: ProductInfo,\n    targetSpaceId: string,\n  ) => Promise<{\n    workflowId: string;\n    pluginId: string;\n  }>;\n  /**\n   * Workflow delete the handler that is triggered when the button is clicked\n   * @param row\n   */\n  handleDeleteWorkflow?: (row: WorkflowInfo) => Promise<{\n    canDelete: boolean;\n    deleteType: DeleteType;\n    handleDelete:\n      | ((params?: { needDeleteBlockwise: boolean }) => Promise<void>)\n      | undefined;\n  }>;\n  /**\n   * Is it a special offer for the professional version?\n   */\n  isProfessionalTemplate?: boolean;\n}\n\ninterface UseWorkflowActionReturn {\n  /** Copy the official process template */\n  dupWorkflowTpl: () => Promise<void>;\n  /** Copy process product */\n  dupProduct: () => Promise<void>;\n  /** Add process */\n  addWorkflow: () => Promise<boolean>;\n  /** removal process */\n  removeWorkflow: () => void;\n  /**\n   * delete process\n   */\n  deleteWorkflow: () => Promise<void>;\n  /** Process item click */\n  itemClick: () => void;\n}\n\n// eslint-disable-next-line max-lines-per-function\nexport function useWorkflowAction({\n  data,\n  workFlowList,\n  copyProductHandle,\n  onWorkFlowListChange,\n  onAdd,\n  onRemove,\n  onItemClick,\n  onDupSuccess,\n  onDelete,\n  handleDeleteWorkflow,\n  isProfessionalTemplate,\n}: WorkflowCardProps): UseWorkflowActionReturn {\n  const context = useContext(WorkflowModalContext);\n  const { bot_id: botId } = useParams<DynamicParams>();\n\n  const navigate = useNavigate();\n\n  const isCozePro = useCozeProRightsStore(state =>\n    getIsCozePro(state?.rightsInfo),\n  );\n  useEffect(() => {\n    useCozeProRightsStore.getState().getRights();\n  }, []);\n\n  async function getWorkflowItem(config: {\n    spaceId?: string;\n    workflowId?: string;\n    pluginId?: string;\n    isImageflow: boolean;\n    flowMode?: WorkflowMode;\n  }): Promise<BotPluginWorkFlowItem> {\n    if (isSelectProjectCategory(context?.modalState)) {\n      return getProjectWorkflow(config);\n    }\n    return getWorkflowItemByPluginId(config);\n  }\n\n  async function getProjectWorkflow(config: {\n    workflowId?: string;\n    spaceId?: string;\n  }): Promise<BotPluginWorkFlowItem> {\n    if (!config.spaceId || !config.workflowId) {\n      throw new CustomError('normal_error', 'getProjectWorkflow: empty id');\n    }\n    const resp = await workflowApi.GetWorkflowDetail(\n      {\n        space_id: config.spaceId,\n        workflow_ids: [config.workflowId],\n      },\n      {\n        __disableErrorToast: true,\n      },\n    );\n\n    // Get the workflow information first\n    const workflowInfos = resp.data ?? [];\n    if (!workflowInfos?.length) {\n      Toast.error(I18n.t('workflow_add_list_added_id_empty'));\n      throw new CustomError('normal_error', 'project workflow list no item');\n    }\n    return workflowInfos.at(0) as BotPluginWorkFlowItem;\n  }\n  /**\n   * Construct a new workflowItem by plugin ID\n   */\n  // eslint-disable-next-line complexity\n  async function getWorkflowItemByPluginId(config: {\n    spaceId?: string;\n    workflowId?: string;\n    pluginId?: string;\n    isImageflow: boolean;\n    flowMode?: WorkflowMode;\n  }) {\n    if (!config.spaceId || !config.workflowId || !config.pluginId) {\n      throw new CustomError(\n        'normal_error',\n        'getWorkflowItemByPluginId: empty id',\n      );\n    }\n    const resp = await PluginDevelopApi.GetPlaygroundPluginList(\n      {\n        space_id: config.spaceId,\n        page: 1,\n        size: 1,\n        plugin_ids: [config.pluginId || ''],\n        plugin_types: [\n          config.isImageflow ? PluginType.IMAGEFLOW : PluginType.WORKFLOW,\n        ],\n      },\n      {\n        __disableErrorToast: true,\n      },\n    );\n\n    // Get the workflow information first\n    const pluginInfos = resp.data?.plugin_list ?? [];\n    if (!pluginInfos?.length) {\n      Toast.error(\n        I18n.t(\n          config.isImageflow\n            ? 'imageflow_add_toast_error'\n            : 'workflow_add_list_added_id_empty',\n        ),\n      );\n      throw new CustomError('normal_error', 'plugin_list no item');\n    }\n    const target = pluginInfos.at(0);\n    const newWorkflow: BotPluginWorkFlowItem = {\n      workflow_id: config.workflowId || '',\n      plugin_id: config.pluginId || '',\n      name: target?.name || '',\n      desc: target?.desc_for_human || '',\n      parameters: target?.plugin_apis?.at(0)?.parameters ?? [],\n      plugin_icon: target?.plugin_icon || '',\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      version_name: (target as any)?.version_name,\n      flow_mode:\n        target?.plugin_type === PluginType.IMAGEFLOW\n          ? WorkflowMode.Imageflow\n          : config.flowMode ?? WorkflowMode.Workflow,\n    };\n\n    return newWorkflow;\n  }\n\n  function isTypeWorkflow(\n    target: WorkflowInfo | ProductInfo,\n  ): target is WorkflowInfo {\n    return context?.modalState.dataSourceType === DataSourceType.Workflow;\n  }\n\n  /** Open the process details page */\n  function openWorkflowDetailPage(workflow: WorkflowInfo | ProductInfo) {\n    const flowData = workflow as Workflow;\n    const wId = (flowData as WorkflowInfo).workflow_id ?? '';\n\n    const query = new URLSearchParams();\n    botId && query.append('bot_id', botId);\n    query.append('space_id', context?.spaceId ?? '');\n    query.append('workflow_id', wId);\n    window.open(`/work_flow?${query.toString()}`, '_blank');\n  }\n\n  const dupProduct = async () => {\n    if (!context) {\n      return;\n    }\n\n    if (isTypeWorkflow(data)) {\n      return;\n    }\n\n    if (isProfessionalTemplate && !isCozePro) {\n      // Jump to professional version login\n      navigate(\n        `/sign/oauth?redirect=${encodeURIComponent(\n          '/store/bot',\n        )}&platform=volcano&page_from=coze_pro_sign_in`,\n      );\n      return;\n    }\n\n    reporter.info({ message: 'workflow_modal: dupProduct' });\n\n    let newPluginId = '';\n    let newWorkflowId = '';\n    try {\n      const resp = await copyProductHandle(data, context.spaceId);\n      newPluginId = resp.pluginId;\n      newWorkflowId = resp.workflowId;\n    } catch (e) {\n      if (copyProductErrorCodes.includes(e?.code)) {\n        Toast.error(e.message);\n      } else {\n        Toast.error(I18n.t('copy_failed'));\n        reporter.error({\n          message: 'dupProduct: copyProductHandle error',\n          error: e,\n        });\n      }\n      return;\n    }\n\n    // Delayed refresh list, server level leader/follower delay caused problems\n    await wait(100);\n\n    try {\n      const newWorkflow = await getWorkflowItemByPluginId({\n        spaceId: context.spaceId,\n        workflowId: newWorkflowId,\n        pluginId: newPluginId,\n        isImageflow:\n          data?.meta_info?.entity_type ===\n          ProductEntityType.ImageflowTemplateV2,\n      });\n\n      // Construct a new bound workflow list\n      onWorkFlowListChange?.([...(workFlowList ?? []), newWorkflow]);\n      onAdd?.(newWorkflow, { isDup: true, spaceId: context.spaceId });\n\n      if (onDupSuccess) {\n        onDupSuccess(newWorkflow);\n      } else {\n        // Copy product successfully\n        Toast.success({\n          content: (\n            <Space spacing={6}>\n              <Text>{I18n.t('workflowstore_workflow_copy_successful')}</Text>\n              <Button\n                color=\"primary\"\n                onClick={() => {\n                  window.open(\n                    `/work_flow?space_id=${context.spaceId}&workflow_id=${newWorkflow.workflow_id}&from=dupSuccess`,\n                  );\n                }}\n              >\n                {I18n.t('workflowstore_continue_editing')}\n              </Button>\n            </Space>\n          ),\n        });\n      }\n    } catch (e) {\n      Toast.error(I18n.t('workflow_add_list_added_fail'));\n      reporter.error({\n        message: 'dupProduct: getWorkflowItemByPluginId error',\n        error: e,\n      });\n    }\n  };\n\n  const dupWorkflowTpl = async () => {\n    if (!context) {\n      return;\n    }\n\n    if (!isTypeWorkflow(data)) {\n      return;\n    }\n\n    reporter.info({ message: 'workflow_modal: dupWorkflowTpl' });\n\n    let newPluginId = '';\n    let newWorkflowId = '';\n    try {\n      const resp = await workflowApi.CopyWkTemplateApi(\n        {\n          workflow_ids: [data.workflow_id || ''],\n          target_space_id: context.spaceId,\n        },\n        {\n          __disableErrorToast: true,\n        },\n      );\n\n      newWorkflowId = resp.data[data.workflow_id ?? '']?.workflow_id || '';\n      newPluginId = resp.data[data.workflow_id ?? '']?.plugin_id || '0';\n    } catch (e) {\n      Toast.error(I18n.t('copy_failed'));\n      reporter.error({\n        message: 'dupWorkflowTpl: CopyWkTemplateApi error',\n        error: e,\n      });\n      return;\n    }\n\n    if (!newWorkflowId || newPluginId === '0') {\n      Toast.error(I18n.t('copy_failed'));\n      reporter.error({\n        message: 'dupWorkflowTpl: CopyWkTemplateApi error',\n        error: new CustomError(\n          'normal_error',\n          `CopyWkTemplateApi: plugin_id is ${newPluginId}, workflow_id is ${newWorkflowId}`,\n        ),\n      });\n      return;\n    }\n\n    // Delayed refresh list, server level leader/follower delay caused problems\n    await wait(100);\n\n    try {\n      const newWorkflow = await getWorkflowItemByPluginId({\n        spaceId: context.spaceId,\n        workflowId: newWorkflowId,\n        pluginId: newPluginId,\n        isImageflow: context.flowMode === WorkflowMode.Imageflow,\n        flowMode: data.flow_mode,\n      });\n\n      const sourceFlowMode = data?.flow_mode ?? context?.flowMode;\n      if (typeof sourceFlowMode !== 'undefined') {\n        newWorkflow.flow_mode = sourceFlowMode;\n      }\n\n      // Construct a new bound workflow list\n      onWorkFlowListChange?.([...(workFlowList ?? []), newWorkflow]);\n      onAdd?.(newWorkflow, { isDup: true, spaceId: context.spaceId });\n\n      if (onDupSuccess) {\n        onDupSuccess(newWorkflow);\n      } else {\n        Toast.success({\n          content: (\n            <Space spacing={6}>\n              <Text>{I18n.t('workflowstore_workflow_copy_successful')}</Text>\n              <Button\n                color=\"primary\"\n                onClick={() => {\n                  window.open(\n                    `/work_flow?space_id=${context.spaceId}&workflow_id=${newWorkflow.workflow_id}`,\n                  );\n                }}\n              >\n                {I18n.t('workflowstore_continue_editing')}\n              </Button>\n            </Space>\n          ),\n        });\n      }\n    } catch (e) {\n      Toast.error(e.message || I18n.t('workflow_add_list_added_fail'));\n      reporter.error({\n        message: 'dupWorkflowTpl: getWorkflowItemByPluginId error',\n        error: e,\n      });\n    }\n  };\n\n  const removeWorkflow = () => {\n    if (!workFlowList || !isTypeWorkflow(data)) {\n      return;\n    }\n\n    reporter.info({ message: 'workflow_modal: removeWorkflow' });\n\n    const target = workFlowList.find(\n      item => item.workflow_id === data.workflow_id,\n    );\n\n    if (!target) {\n      return;\n    }\n\n    onRemove?.(target);\n    onWorkFlowListChange?.(\n      workFlowList.filter(item => item.workflow_id !== data.workflow_id),\n    );\n  };\n\n  const addWorkflow = async () => {\n    if (!context || !isTypeWorkflow(data)) {\n      return false;\n    }\n\n    reporter.info({ message: 'workflow_modal: addWorkflow' });\n\n    try {\n      const newWorkflow = await getWorkflowItem({\n        spaceId: context.spaceId,\n        workflowId: data.workflow_id,\n        pluginId: data.plugin_id,\n        isImageflow: data?.flow_mode === WorkflowMode.Imageflow,\n        flowMode: data?.flow_mode,\n      });\n\n      if (typeof data?.flow_mode !== 'undefined') {\n        newWorkflow.flow_mode = data?.flow_mode;\n      }\n\n      // Construct a new bound workflow list\n      onWorkFlowListChange?.([...(workFlowList ?? []), newWorkflow]);\n      const addResult = await onAdd?.(newWorkflow, {\n        isDup: false,\n        spaceId: context.spaceId,\n      });\n      /**\n       * Allow external business logic to add failure\n       */\n      if (isBoolean(addResult)) {\n        return addResult as unknown as boolean;\n      }\n      return true;\n    } catch (e) {\n      Toast.error(e.message || I18n.t('workflow_add_list_added_fail'));\n      reporter.error({\n        message: 'addWorkflow: getWorkflowItemByPluginId error',\n        error: e,\n      });\n      return false;\n    }\n  };\n\n  const deleteWorkflow = async () => {\n    if (!isTypeWorkflow(data)) {\n      return;\n    }\n    if (!handleDeleteWorkflow) {\n      return;\n    }\n    reporter.info({ message: 'workflow_modal: deleteWorkflow' });\n    // delete api\n    const deleteConfig = await handleDeleteWorkflow?.(data);\n    if (deleteConfig?.canDelete) {\n      await deleteConfig?.handleDelete?.();\n    }\n    if (!workFlowList) {\n      return;\n    }\n\n    const target = workFlowList.find(\n      item => item.workflow_id === data.workflow_id,\n    );\n\n    if (!target) {\n      return;\n    }\n    onDelete?.(target);\n    onWorkFlowListChange?.(\n      workFlowList.filter(item => item.workflow_id !== data.workflow_id),\n    );\n  };\n\n  const itemClick = () => {\n    if (!context) {\n      return;\n    }\n\n    reporter.info({ message: 'workflow_modal: itemClick' });\n\n    if (onItemClick) {\n      // @ts-expect-error meets expectations\n      const item: WorkflowItemType = {\n        item: data,\n        type: context.modalState.dataSourceType,\n      };\n      const ret = onItemClick(item, context.getModalState(context));\n      if (!ret || ret.handled) {\n        return;\n      }\n    }\n\n    if (isTypeWorkflow(data)) {\n      openWorkflowDetailPage(data);\n    } else {\n      window.open(\n        `/template/workflow/${data.meta_info.id}?entity_id=${ProductEntityType.WorkflowTemplateV2}`,\n        '_blank',\n      );\n    }\n  };\n\n  return {\n    dupWorkflowTpl,\n    dupProduct,\n    addWorkflow,\n    removeWorkflow,\n    deleteWorkflow,\n    itemClick,\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo, useState } from 'react';\n\nimport {\n  useInfiniteQuery,\n  type UseInfiniteQueryResult,\n} from '@tanstack/react-query';\nimport { EVENT_NAMES, sendTeaEvent } from '@coze-arch/bot-tea';\nimport { CustomError } from '@coze-arch/bot-error';\nimport {\n  ProductEntityType,\n  type ProductInfo,\n  type public_api,\n  SortType,\n} from '@coze-arch/bot-api/product_api';\nimport { ProductApi } from '@coze-arch/bot-api';\n\nexport type GetProductListRequest = public_api.GetProductListRequest;\n\ninterface WorkflowProductListReturn {\n  updatePageParam: (newParam: Partial<GetProductListRequest>) => void;\n\n  workflowProductList: ProductInfo[];\n  queryError: UseInfiniteQueryResult['error'];\n  loadingStatus: UseInfiniteQueryResult['status'];\n  refetch: UseInfiniteQueryResult['refetch'];\n  fetchNextPage: UseInfiniteQueryResult['fetchNextPage'];\n  isFetching: UseInfiniteQueryResult['isFetching'];\n  isFetchingNextPage: UseInfiniteQueryResult['isFetchingNextPage'];\n  hasNextPage: UseInfiniteQueryResult['hasNextPage'];\n\n  copyProduct: (\n    item: ProductInfo,\n    targetSpaceId: string,\n  ) => Promise<{\n    workflowId: string;\n    pluginId: string;\n  }>;\n}\n\n// eslint-disable-next-line max-lines-per-function,@coze-arch/max-line-per-function\nexport function useWorkflowProductList({\n  pageSize = 12,\n  enabled = false,\n}: {\n  pageSize?: number;\n  enabled?: boolean;\n} = {}): Readonly<WorkflowProductListReturn> {\n  const [keyword, setKeyword] = useState<string>();\n  const [sortType, setSortType] = useState<SortType>(SortType.Heat);\n  const [categoryId, setCategoryId] = useState<string>();\n  const [source, setSource] = useState<GetProductListRequest['source']>();\n\n  const initialPageParam = useMemo<GetProductListRequest>(\n    () => ({\n      entity_types: [\n        ProductEntityType.WorkflowTemplateV2,\n        ProductEntityType.ImageflowTemplateV2,\n      ],\n      page_num: 1,\n      page_size: pageSize,\n      category_id: categoryId,\n      sort_type: sortType,\n      source,\n      keyword,\n    }),\n    [keyword, sortType, categoryId, source],\n  );\n\n  const updatePageParam = (newParam: Partial<GetProductListRequest>) => {\n    if ('category_id' in newParam) {\n      setCategoryId(newParam.category_id);\n    }\n    if ('sort_type' in newParam) {\n      setSortType(newParam.sort_type ?? SortType.Newest);\n    }\n    if ('keyword' in newParam) {\n      setKeyword(newParam.keyword);\n    }\n    if ('source' in newParam) {\n      setSource(newParam.source);\n    }\n  };\n\n  const queryKey = useMemo(\n    () => ['workflow_product', JSON.stringify(initialPageParam)],\n    [initialPageParam],\n  );\n\n  const fetchProductList = async (params: GetProductListRequest) => {\n    const resp = await ProductApi.PublicGetProductList(params);\n\n    return resp.data;\n  };\n\n  const {\n    data: pageData,\n    error: queryError,\n    fetchNextPage,\n    hasNextPage,\n    isFetching,\n    isFetchingNextPage,\n    status: loadingStatus,\n    refetch,\n  } = useInfiniteQuery({\n    enabled,\n    queryKey,\n    queryFn: ({ pageParam }) => fetchProductList(pageParam),\n    initialPageParam,\n    getNextPageParam: (lastPage, allPages, lastPageParam) => {\n      if (!lastPage?.has_more) {\n        return null;\n      }\n      return {\n        ...lastPageParam,\n        page_num: (lastPageParam.page_num ?? 1) + 1,\n      };\n    },\n  });\n\n  const workflowProductList = useMemo(() => {\n    const result: ProductInfo[] = [];\n    const idMap: Record<string, boolean> = {};\n    pageData?.pages.forEach(page => {\n      page?.products?.forEach(product => {\n        if (!product.meta_info.id) {\n          return;\n        }\n\n        if (!idMap[product.meta_info.id]) {\n          result.push(product);\n        }\n        idMap[product.meta_info.id] = true;\n      });\n    });\n    return result;\n  }, [pageData]);\n\n  const copyProduct = async (item: ProductInfo, targetSpaceId: string) => {\n    if (!item?.meta_info?.id) {\n      throw new CustomError('normal_error', 'no productId');\n    }\n    const res = await ProductApi.PublicDuplicateProduct(\n      {\n        product_id: item?.meta_info?.id,\n        space_id: targetSpaceId,\n        entity_type: item.meta_info.entity_type as ProductEntityType,\n      },\n      {\n        __disableErrorToast: true,\n      },\n    );\n\n    const workflowId = res.data?.new_entity_id;\n    const pluginId = res.data?.new_plugin_id;\n\n    if (!workflowId || !pluginId) {\n      throw new CustomError(\n        'normal_error',\n        'copyProduct fail, no new_entity_id',\n      );\n    }\n    sendTeaEvent(EVENT_NAMES.template_action_front, {\n      template_id: item.meta_info.id ?? '',\n      template_name: item.meta_info.name ?? '',\n      template_type:\n        item.meta_info.entity_type === ProductEntityType.WorkflowTemplateV2\n          ? 'workflow'\n          : 'imageflow',\n      template_tag_professional: item.meta_info.is_professional\n        ? 'professional'\n        : 'basic',\n      entity_id: item.meta_info.entity_id ?? '',\n      ...(item?.meta_info?.is_free\n        ? ({\n            template_tag_prize: 'free',\n          } as const)\n        : ({\n            template_tag_prize: 'paid',\n            template_prize_detail: Number(item?.meta_info?.price?.amount) || 0,\n          } as const)),\n      action: 'duplicate',\n      after_id: workflowId,\n    });\n    return { workflowId, pluginId };\n  };\n  return {\n    // filter criteria\n    updatePageParam,\n\n    //\n    workflowProductList,\n    queryError,\n    loadingStatus,\n    refetch,\n    fetchNextPage,\n    isFetching,\n    isFetchingNextPage,\n    hasNextPage,\n\n    // operation\n    copyProduct,\n  } as const;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useContext } from 'react';\n\nimport { useDebounceFn } from 'ahooks';\nimport { UISearch } from '@coze-studio/components';\nimport { SortType } from '@coze-arch/idl/product_api';\nimport { I18n } from '@coze-arch/i18n';\n\nimport WorkflowModalContext from '../workflow-modal-context';\nimport { DataSourceType, type WorkflowModalState } from '../type';\n\nexport function useWorkflowSearch() {\n  const context = useContext(WorkflowModalContext);\n  const { run: debounceChangeSearch, cancel } = useDebounceFn(\n    (search: string) => {\n      /** Search maximum number of characters */\n      const maxCount = 100;\n      if (search.length > maxCount) {\n        updateSearchQuery(search.substring(0, maxCount));\n      } else {\n        updateSearchQuery(search);\n      }\n    },\n    { wait: 300 },\n  );\n\n  if (!context) {\n    return null;\n  }\n\n  const { dataSourceType, query, isSpaceWorkflow, sortType } =\n    context.modalState;\n\n  const updateSearchQuery = (search?: string) => {\n    const newState: Partial<WorkflowModalState> = { query: search ?? '' };\n    if (dataSourceType === DataSourceType.Workflow) {\n      // If there are tags when searching, reset all\n      newState.workflowTag = isSpaceWorkflow ? 0 : 1;\n      newState.sortType = undefined;\n    }\n\n    if (dataSourceType === DataSourceType.Product) {\n      if (!search && sortType === SortType.Relative) {\n        newState.sortType = SortType.Heat;\n      }\n      if (search && !context.modalState.query) {\n        newState.sortType = newState.sortType = SortType.Relative;\n      }\n    }\n\n    context.updateModalState(newState);\n  };\n  return (\n    <UISearch\n      tabIndex={-1}\n      value={query}\n      placeholder={I18n.t('workflow_add_search_placeholder')}\n      data-testid=\"workflow.modal.search\"\n      onSearch={search => {\n        if (!search) {\n          // If the search is empty, update the query immediately\n          cancel();\n          updateSearchQuery('');\n        } else {\n          // If search has a value, then anti-shake update\n          debounceChangeSearch(search);\n        }\n      }}\n    />\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/max-line-per-function */\nimport {\n  forwardRef,\n  type ReactNode,\n  useContext,\n  useImperativeHandle,\n  useMemo,\n} from 'react';\n\nimport classNames from 'classnames';\nimport { useQuery } from '@tanstack/react-query';\nimport { WorkflowMode } from '@coze-workflow/base/api';\nimport { workflowApi, isGeneralWorkflow } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozAllFill,\n  IconCozFireFill,\n  IconCozKnowledgeFill,\n} from '@coze-arch/coze-design/icons';\nimport { useFlags } from '@coze-arch/bot-flags';\nimport { ProductEntityType } from '@coze-arch/bot-api/product_api';\nimport { ProductApi } from '@coze-arch/bot-api';\n\nimport WorkflowModalContext from '../workflow-modal-context';\nimport {\n  DataSourceType,\n  WorkflowCategory,\n  WorkflowModalFrom,\n  type WorkFlowModalModeProps,\n} from '../type';\n\nimport s from './workflow-filter.module.less';\n\ninterface PluginTag {\n  type?: string | number;\n  name?: string;\n  icon?: string | React.ReactElement;\n  active_icon?: string | React.ReactElement;\n}\n\nexport interface WorkflowFilterRef {\n  getCurrent: () => PluginTag | undefined;\n}\n\nconst WorkflowFilter = forwardRef<\n  WorkflowFilterRef,\n  Pick<\n    WorkFlowModalModeProps,\n    | 'from'\n    | 'hiddenSpaceList'\n    | 'hiddenExplore'\n    | 'hiddenLibrary'\n    | 'hiddenWorkflowCategories'\n  >\n>(\n  (\n    {\n      from,\n      hiddenSpaceList,\n      hiddenExplore,\n      hiddenLibrary,\n      hiddenWorkflowCategories = [],\n    },\n    ref,\n  ) => {\n    const context = useContext(WorkflowModalContext);\n    const [FLAGS] = useFlags();\n\n    const getWorkflowTags = async (): Promise<{\n      type: 'WorkFlowTemplateTag' | 'PublicGetProductCategoryList';\n      data: PluginTag[];\n    }> => {\n      if (hiddenExplore) {\n        return {\n          type: 'WorkFlowTemplateTag',\n          data: [],\n        };\n      }\n\n      if (\n        FLAGS['bot.community.store_imageflow'] ||\n        isGeneralWorkflow(context?.flowMode || WorkflowMode.Workflow)\n      ) {\n        if (IS_OPEN_SOURCE) {\n          return {\n            type: 'PublicGetProductCategoryList',\n            data: [],\n          };\n        }\n\n        const resp = await ProductApi.PublicGetProductCategoryList({\n          // Template classification, for workflow/image circulation\n          entity_type: ProductEntityType.TemplateCommon,\n          need_empty_category: false,\n        });\n\n        const targetList: PluginTag[] = (resp.data?.categories ?? []).map(\n          item => ({\n            type: item.id,\n            name: item.name ?? '',\n            icon: item.icon_url,\n            active_icon: item.active_icon_url,\n          }),\n        );\n\n        targetList.unshift({\n          type: 'recommend',\n          name: I18n.t('workflowstore_category1'),\n          icon: <IconCozFireFill />,\n          active_icon: <IconCozFireFill />,\n        });\n\n        targetList.unshift({\n          type: 'all',\n          name: I18n.t('All'),\n          icon: <IconCozAllFill />,\n          active_icon: <IconCozAllFill />,\n        });\n\n        return {\n          type: 'PublicGetProductCategoryList',\n          data: targetList,\n        };\n      }\n\n      const res = await workflowApi.WorkFlowTemplateTag({\n        flow_mode: context?.flowMode,\n      });\n      return {\n        type: 'WorkFlowTemplateTag',\n        data: res.data?.tags ?? [],\n      };\n    };\n\n    const currentValue = useMemo(() => {\n      if (!context?.modalState) {\n        return '';\n      }\n      return context.modalState.dataSourceType === DataSourceType.Product\n        ? context.modalState.productCategory\n        : context.modalState.workflowTag;\n    }, [context?.modalState]);\n\n    const queryKey = useMemo(() => {\n      const result = ['workflow-modal-side'];\n      result.push(`flowMode-${context?.flowMode}`);\n      return result;\n    }, [context]);\n\n    const { data: tags } = useQuery({\n      enabled: Boolean(context),\n      queryKey,\n      queryFn: getWorkflowTags,\n    });\n\n    useImperativeHandle(ref, () => ({\n      getCurrent: () => tags?.data.find(item => item.type === currentValue),\n    }));\n    /** Showcase space flow, my/team's */\n    const clickSpaceContent = (category?: WorkflowCategory) => {\n      context?.updateModalState({\n        isSpaceWorkflow: category !== WorkflowCategory.Example,\n        workflowCategory: category,\n        workflowTag: 0,\n        query: '',\n        dataSourceType: DataSourceType.Workflow,\n        productCategory: category,\n        sortType: undefined,\n      });\n    };\n    const nodeDataList = useMemo<\n      Array<{\n        title?: string;\n        icon?: ReactNode;\n        testId?: string;\n        category?: WorkflowCategory;\n      }>\n    >(() => {\n      const tempList = hiddenLibrary\n        ? []\n        : [\n            {\n              title: I18n.t('project_resource_modal_library_resources', {\n                resource: I18n.t('library_resource_type_workflow'),\n              }),\n              icon: (\n                <IconCozKnowledgeFill\n                  className={s['tool-tag-list-cell-icon']}\n                />\n              ),\n              testId: 'workflow.modal.search.option.library',\n              category: WorkflowCategory.Library,\n            },\n          ];\n      if (from === WorkflowModalFrom.ProjectWorkflowAddNode) {\n        tempList.push({\n          title: I18n.t('project_resource_modal_project_resources', {\n            resource: I18n.t('library_resource_type_workflow'),\n          }),\n          icon: (\n            <IconCozKnowledgeFill className={s['tool-tag-list-cell-icon']} />\n          ),\n          testId: 'workflow.modal.search.option.project',\n          category: WorkflowCategory.Project,\n        });\n      }\n      tempList.push({\n        title: I18n.t('workflow_add_example'),\n        icon: <IconCozKnowledgeFill className={s['tool-tag-list-cell-icon']} />,\n        testId: 'workflow.modal.search.option.example',\n        category: WorkflowCategory.Example,\n      });\n      return tempList.filter(\n        item => !hiddenWorkflowCategories.includes(item.category),\n      );\n    }, [from, hiddenLibrary, hiddenWorkflowCategories, FLAGS]);\n\n    if (!context) {\n      return null;\n    }\n\n    return (\n      <div className={`tool-tag-list ${s['tool-tag-list']}`}>\n        {!hiddenSpaceList && (\n          <div>\n            {nodeDataList.map(nodeData => {\n              const active =\n                context?.modalState.workflowCategory === nodeData.category;\n              return (\n                <div\n                  key={nodeData.testId}\n                  data-testid={nodeData.testId}\n                  className={classNames(s['tool-tag-list-cell'], {\n                    [s.active]: active,\n                  })}\n                  onClick={() => clickSpaceContent(nodeData.category)}\n                >\n                  {nodeData.icon}\n                  {nodeData.title}\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n    );\n  },\n);\n\nWorkflowFilter.displayName = 'WorkflowFilter';\n\nexport { WorkflowFilter };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { forwardRef, useContext } from 'react';\n\nimport { UICompositionModalSider } from '@coze-arch/bot-semi';\n\nimport WorkflowModalContext from '../workflow-modal-context';\nimport { type WorkFlowModalModeProps } from '../type';\nimport { useWorkflowSearch } from '../hooks/use-workflow-search';\nimport { WorkflowFilter, type WorkflowFilterRef } from './workflow-filter';\nimport { CreateWorkflowBtn } from './create-workflow-btn';\n\nexport const WorkflowModalSider = forwardRef<\n  WorkflowFilterRef,\n  WorkFlowModalModeProps\n>((props, ref) => {\n  const context = useContext(WorkflowModalContext);\n  const { hiddenCreate, hiddenExplore, from } = props;\n\n  const searchNode = useWorkflowSearch();\n\n  if (!context) {\n    return null;\n  }\n\n  return (\n    <UICompositionModalSider style={{ paddingTop: 16 }}>\n      <UICompositionModalSider.Header>\n        {searchNode}\n        {!hiddenCreate && (\n          <CreateWorkflowBtn\n            className=\"!mt-6 w-full\"\n            onCreateSuccess={props.onCreateSuccess}\n            nameValidators={props.nameValidators}\n            from={from}\n          />\n        )}\n      </UICompositionModalSider.Header>\n      <UICompositionModalSider.Content>\n        <WorkflowFilter\n          ref={ref}\n          from={props.from}\n          hiddenExplore={hiddenExplore}\n          hiddenSpaceList={props.hiddenSpaceList}\n          hiddenLibrary={props.hiddenLibrary}\n          hiddenWorkflowCategories={props.hiddenWorkflowCategories}\n        />\n      </UICompositionModalSider.Content>\n    </UICompositionModalSider>\n  );\n});\n\nWorkflowModalSider.displayName = 'WorkflowModalSider';\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useRef, useState } from 'react';\n\nimport { useMount } from 'ahooks';\nimport { QueryClientProvider } from '@tanstack/react-query';\nimport {\n  BindBizType,\n  OrderBy,\n  WorkFlowListStatus,\n  WorkflowMode,\n  workflowQueryClient,\n} from '@coze-workflow/base/api';\nimport { isGeneralWorkflow } from '@coze-workflow/base';\nimport { I18n, type I18nKeysNoOptionsType } from '@coze-arch/i18n';\nimport {\n  EVENT_NAMES,\n  sendTeaEvent,\n  FlowResourceFrom,\n  FlowStoreType,\n  FlowDuplicateType,\n} from '@coze-arch/bot-tea';\nimport { useSpaceStore } from '@coze-arch/bot-studio-store';\nimport { CustomError } from '@coze-arch/bot-error';\nimport { SpaceType } from '@coze-arch/bot-api/playground_api';\n\nimport WorkflowModalContext, {\n  type WorkflowModalContextValue,\n} from '../workflow-modal-context';\nimport {\n  type WorkFlowModalModeProps,\n  DataSourceType,\n  MineActiveEnum,\n  type WorkflowModalState,\n  WorkflowModalFrom,\n  WorkflowCategory,\n} from '../type';\nimport { type WorkflowFilterRef } from '../sider/workflow-filter';\nimport { WorkflowModalSider } from '../sider';\nimport styles from '../index.module.less';\nimport { WorkflowModalFilterForDouyin } from '../filter-douyin';\nimport { WorkflowModalFilter } from '../filter';\nimport { WorkflowModalContent } from '../content';\nimport { reporter } from '../../utils';\nimport { ModalI18nKey, WORKFLOW_MODAL_I18N_KEY_MAP } from './use-i18n-text';\n/**\n * Return to the parts of the process pop-up window Components, content, sides, filter components, split components can be used for different layouts\n * This is for process selection\n */\n// eslint-disable-next-line @coze-arch/max-line-per-function\nexport const useWorkflowModalParts = (props: WorkFlowModalModeProps) => {\n  const {\n    flowMode = WorkflowMode.Workflow,\n    initState,\n    hideSider = false,\n    bindBizId,\n    bindBizType,\n    projectId,\n    i18nMap,\n    from,\n  } = props;\n  const { space_type: spaceType, id: spaceId } = useSpaceStore(\n    state => state.space,\n  );\n  const sideRef = useRef<WorkflowFilterRef>(null);\n  const [modalState, setModalState] = useState<WorkflowModalState>({\n    status: initState?.status ?? WorkFlowListStatus.HadPublished,\n    dataSourceType: initState?.dataSourceType ?? DataSourceType.Workflow,\n    creator: initState?.creator ?? MineActiveEnum.All,\n    workflowTag: initState?.workflowTag ?? 0,\n    productCategory: initState?.productCategory ?? '',\n    query: initState?.query ?? '',\n    isSpaceWorkflow: initState?.isSpaceWorkflow ?? true,\n    workflowCategory:\n      from === WorkflowModalFrom.ProjectWorkflowAddNode\n        ? WorkflowCategory.Project\n        : WorkflowCategory.Library,\n    listFlowMode: initState?.listFlowMode ?? WorkflowMode.All,\n  });\n\n  const updateModalState = useCallback(\n    (newState: Partial<WorkflowModalState>) => {\n      setModalState({\n        ...modalState,\n        ...newState,\n      });\n    },\n    [modalState],\n  );\n\n  // Sorting rules (process data sources)\n  const [orderBy, setOrderBy] = useState(OrderBy.UpdateTime);\n  const [createModalVisible, setCreateModalVisible] = useState(false);\n\n  useMount(() => {\n    setModalState({\n      status: initState?.status ?? WorkFlowListStatus.HadPublished,\n      dataSourceType: initState?.dataSourceType ?? DataSourceType.Workflow,\n      creator: initState?.creator ?? MineActiveEnum.All,\n      workflowTag: initState?.workflowTag ?? 0,\n      productCategory: initState?.productCategory ?? '',\n      query: initState?.query ?? '',\n      isSpaceWorkflow: initState?.isSpaceWorkflow ?? true,\n      workflowCategory:\n        from === WorkflowModalFrom.ProjectWorkflowAddNode\n          ? WorkflowCategory.Project\n          : WorkflowCategory.Library,\n      listFlowMode: initState?.listFlowMode ?? WorkflowMode.All,\n    });\n\n    reporter.info({\n      message: 'useWorkflowModalParts mounted',\n      meta: { from: props.from },\n    });\n  });\n\n  const contextValue: WorkflowModalContextValue = {\n    spaceId: spaceId ?? '',\n    spaceType: spaceType ?? SpaceType.Team,\n    bindBizId,\n    bindBizType,\n    projectId,\n    flowMode,\n    modalState,\n    updateModalState,\n    orderBy,\n    setOrderBy,\n    createModalVisible,\n    setCreateModalVisible,\n    getModalState: ctx => ({\n      ...ctx.modalState,\n    }),\n    i18nMap,\n  };\n\n  if (!spaceType || !spaceId) {\n    reporter.errorEvent({\n      eventName: 'workflow_modal_in_bot_no_spaceId',\n      error: new CustomError('normal_error', 'no spaceId'),\n    });\n    return {\n      sider: null,\n      content: null,\n      filter: null,\n    } as const;\n  }\n\n  const isBindDouyin = bindBizType === BindBizType.DouYinBot;\n  const hideSidebar = hideSider || isBindDouyin;\n\n  /** Sidebar Component */\n  const sider = hideSidebar ? null : (\n    <QueryClientProvider client={workflowQueryClient}>\n      <WorkflowModalContext.Provider value={contextValue}>\n        <WorkflowModalSider ref={sideRef} {...props} />\n      </WorkflowModalContext.Provider>\n    </QueryClientProvider>\n  );\n\n  /** process list component */\n  const content = (\n    <QueryClientProvider client={workflowQueryClient}>\n      <WorkflowModalContext.Provider value={contextValue}>\n        <WorkflowModalContent\n          {...props}\n          onDupSuccess={val => {\n            if (!props.onDupSuccess) {\n              return;\n            }\n\n            if (modalState.dataSourceType === DataSourceType.Product) {\n              const resourceMap: Record<string, FlowResourceFrom> = {\n                [WorkflowModalFrom.SpaceWorkflowList]:\n                  FlowResourceFrom.template,\n                [WorkflowModalFrom.WorkflowAddNode]: FlowResourceFrom.flowIde,\n                [WorkflowModalFrom.BotSkills]: FlowResourceFrom.botIde,\n                [WorkflowModalFrom.BotMultiSkills]: FlowResourceFrom.botIde,\n                [WorkflowModalFrom.BotTrigger]: FlowResourceFrom.botIde,\n                [WorkflowModalFrom.BotShortcut]: FlowResourceFrom.botIde,\n                [WorkflowModalFrom.WorkflowAgent]: FlowResourceFrom.botIde,\n              };\n\n              const resource =\n                resourceMap[props.from || ''] ?? FlowResourceFrom.botIde;\n              sendTeaEvent(EVENT_NAMES.flow_duplicate_click, {\n                store_type: isGeneralWorkflow(flowMode)\n                  ? FlowStoreType.workflow\n                  : FlowStoreType.imageflow,\n                resource,\n                category_name: sideRef.current?.getCurrent()?.name || '',\n                duplicate_type:\n                  props.from === WorkflowModalFrom.BotSkills\n                    ? FlowDuplicateType.toBot\n                    : FlowDuplicateType.toWorkspace,\n              });\n            }\n            props.onDupSuccess(val);\n          }}\n        />\n      </WorkflowModalContext.Provider>\n    </QueryClientProvider>\n  );\n\n  /** filter component */\n  let filter = (\n    <QueryClientProvider client={workflowQueryClient}>\n      <WorkflowModalContext.Provider value={contextValue}>\n        {isBindDouyin ? (\n          <WorkflowModalFilterForDouyin {...props} />\n        ) : (\n          <WorkflowModalFilter {...props} />\n        )}\n      </WorkflowModalContext.Provider>\n    </QueryClientProvider>\n  );\n\n  // After hiding the sider, put the title on the filter\n  if (hideSidebar && !isBindDouyin) {\n    const title = I18n.t(\n      WORKFLOW_MODAL_I18N_KEY_MAP[flowMode]?.[\n        ModalI18nKey.Title\n      ] as I18nKeysNoOptionsType,\n    );\n    filter = (\n      <div className=\"flex flex-col items-start flex-grow flex-shrink-0\">\n        <div className={styles.title}>{title}</div>\n        {filter}\n      </div>\n    );\n  }\n  return {\n    sider,\n    filter,\n    content,\n  } as const;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type FC } from 'react';\n\nimport classNames from 'classnames';\nimport { BindBizType, WorkflowMode } from '@coze-workflow/base/api';\nimport { I18n } from '@coze-arch/i18n';\nimport { UICompositionModal } from '@coze-arch/bot-semi';\n\nimport {\n  DataSourceType,\n  MineActiveEnum,\n  WorkFlowModalModeProps,\n  WorkflowModalFrom,\n  WorkflowModalState,\n  type WorkflowModalProps,\n  WORKFLOW_LIST_STATUS_ALL,\n  BotPluginWorkFlowItem,\n} from './type';\nimport { useWorkflowModalParts } from './hooks/use-workflow-modal-parts';\nimport {\n  WORKFLOW_MODAL_I18N_KEY_MAP,\n  ModalI18nKey,\n} from './hooks/use-i18n-text';\n\nimport styles from './index.module.less';\nexport { ModalI18nKey };\n\nconst WorkflowModal: FC<WorkflowModalProps> = ({\n  className,\n  visible,\n  onClose,\n  ...props\n}) => {\n  const { sider, filter, content } = useWorkflowModalParts(props);\n  const flowMode = props.flowMode ?? WorkflowMode.Workflow;\n  const isDouyinBot = props.bindBizType === BindBizType.DouYinBot;\n\n  return (\n    <UICompositionModal\n      visible={visible}\n      onCancel={onClose}\n      siderWrapperClassName={props.hideSider || isDouyinBot ? 'hidden' : ''}\n      header={I18n.t(\n        WORKFLOW_MODAL_I18N_KEY_MAP[flowMode]?.[ModalI18nKey.Title],\n      )}\n      className={classNames(\n        styles['workflow-modal'],\n        className,\n        'new-workflow-modal',\n        isDouyinBot ? styles['douyin-workflow-modal'] : '',\n      )}\n      sider={sider}\n      filter={filter}\n      content={content}\n    />\n  );\n};\n\nexport default WorkflowModal;\n\nexport {\n  useWorkflowModalParts,\n  DataSourceType,\n  MineActiveEnum,\n  WorkflowModalFrom,\n  WorkflowModalProps,\n  WorkFlowModalModeProps,\n  WorkflowModalState,\n  WORKFLOW_LIST_STATUS_ALL,\n  BotPluginWorkFlowItem,\n};\n\nexport { isSelectProjectCategory } from './utils';\nexport { WorkflowCategory } from './type';\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type FC, useContext, useState } from 'react';\n\nimport { WorkflowMode, BindBizType } from '@coze-arch/idl/workflow_api';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozWorkflow,\n  IconCozChat,\n  IconCozArrowDown,\n} from '@coze-arch/coze-design/icons';\nimport { Menu, Button } from '@coze-arch/coze-design';\nimport { CustomError } from '@coze-arch/bot-error';\n\nimport WorkflowModalContext from '../workflow-modal-context';\nimport { WorkflowModalFrom, type WorkFlowModalModeProps } from '../type';\nimport { useI18nText } from '../hooks/use-i18n-text';\nimport { CreateWorkflowModal } from '../../workflow-edit';\nimport { wait } from '../../utils';\nimport { useOpenWorkflowDetail } from '../../hooks/use-open-workflow-detail';\nexport const CreateWorkflowBtn: FC<\n  Pick<\n    WorkFlowModalModeProps,\n    'onCreateSuccess' | 'nameValidators' | 'from'\n  > & {\n    className?: string;\n  }\n> = ({ className, onCreateSuccess, nameValidators, from }) => {\n  const context = useContext(WorkflowModalContext);\n  const { i18nText, ModalI18nKey } = useI18nText();\n  const openWorkflowDetailPage = useOpenWorkflowDetail();\n\n  const [createFlowMode, setCreateFlowMode] = useState(\n    context?.flowMode ?? WorkflowMode.Workflow,\n  );\n\n  if (!context) {\n    return null;\n  }\n  const { createModalVisible, setCreateModalVisible, bindBizType } = context;\n\n  // If it is a Douyin doppelganger scene, only one [Create Workflow] button will be displayed at this time.\n  const showSingleButton =\n    bindBizType === BindBizType.DouYinBot ||\n    from === WorkflowModalFrom.WorkflowAgent;\n\n  /** Open the process details page */\n  const menuConfig = [\n    {\n      label: I18n.t('workflow_add_navigation_create'),\n      handler: () => {\n        setCreateFlowMode(WorkflowMode.Workflow);\n        setCreateModalVisible(true);\n      },\n      icon: <IconCozWorkflow />,\n    },\n    {\n      label: I18n.t('wf_chatflow_81'),\n      handler: () => {\n        setCreateFlowMode(WorkflowMode.ChatFlow);\n        setCreateModalVisible(true);\n      },\n      icon: <IconCozChat />,\n    },\n  ];\n\n  return (\n    <>\n      {showSingleButton ? (\n        <Button\n          className={className}\n          color=\"hgltplus\"\n          onClick={() => {\n            if (from === WorkflowModalFrom.WorkflowAgent) {\n              setCreateFlowMode(WorkflowMode.ChatFlow);\n            } else {\n              setCreateFlowMode(WorkflowMode.Workflow);\n            }\n            setCreateModalVisible(true);\n          }}\n        >\n          {from === WorkflowModalFrom.WorkflowAgent\n            ? I18n.t('wf_chatflow_81')\n            : I18n.t('workflow_add_navigation_create')}\n        </Button>\n      ) : (\n        <Menu\n          trigger=\"click\"\n          position=\"bottom\"\n          render={\n            <Menu.SubMenu className={'w-[198px]'} mode=\"menu\">\n              {menuConfig.map(item => (\n                <Menu.Item\n                  key={item.label}\n                  onClick={(value, event) => {\n                    event.stopPropagation();\n                    item.handler();\n                  }}\n                  icon={item.icon}\n                >\n                  {item.label}\n                </Menu.Item>\n              ))}\n            </Menu.SubMenu>\n          }\n        >\n          <Button\n            className={className}\n            color=\"hgltplus\"\n            icon={<IconCozArrowDown />}\n            iconPosition=\"right\"\n          >\n            {context.projectId\n              ? I18n.t('wf_chatflow_03')\n              : i18nText(ModalI18nKey.NavigationCreate)}\n          </Button>\n        </Menu>\n      )}\n      <CreateWorkflowModal\n        initConfirmDisabled\n        mode=\"add\"\n        flowMode={createFlowMode}\n        bindBizType={context.bindBizType}\n        bindBizId={context.bindBizId}\n        projectId={context.projectId}\n        visible={createModalVisible}\n        onCancel={() => setCreateModalVisible(false)}\n        onSuccess={async ({ workflowId, flowMode }) => {\n          setCreateModalVisible(false);\n          if (!workflowId) {\n            throw new CustomError(\n              '[Workflow] create failed',\n              'create workflow failed, no workflow id',\n            );\n          }\n          // Due to the delay in the synchronization of the main and standby data of the workflow created by the server level, if you jump directly after the creation, the workflowId may not be found, so the front-end delay reduces the probability of the problem triggering\n          await wait(500);\n\n          if (onCreateSuccess) {\n            onCreateSuccess?.({\n              spaceId: context.spaceId,\n              workflowId,\n              flowMode: flowMode || WorkflowMode.Workflow,\n            });\n          } else {\n            openWorkflowDetailPage({\n              workflowId,\n              spaceId: context.spaceId ?? '',\n            });\n          }\n        }}\n        nameValidators={nameValidators}\n      />\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type BindBizType,\n  type WorkFlowListStatus,\n  type WorkflowMode,\n} from '@coze-workflow/base/api';\nimport { type SortType, type public_api } from '@coze-arch/idl/product_api';\nimport { type PluginParameter } from '@coze-arch/idl/developer_api';\nimport { type WorkflowDetailData } from '@coze-arch/bot-api/workflow_api';\n\nimport { type RuleItem } from '../workflow-edit';\nimport { type WorkflowInfo, WorkflowModalFrom } from '../types';\nimport { type I18nKey, type ModalI18nKey } from './hooks/use-i18n-text';\nexport { WorkflowModalFrom };\n\nexport interface BotPluginWorkFlowItem extends WorkflowDetailData {\n  workflow_id: string;\n  plugin_id: string;\n  name: string;\n  desc: string;\n  parameters: Array<PluginParameter>;\n  plugin_icon: string;\n  flow_mode?: WorkflowMode;\n  version_name?: string;\n}\n\nexport type GetProductListRequest = public_api.GetProductListRequest;\n/**\n * Product type\n *\n * Due to the problem of the same name of the type, the direct export of ProductInfo points to the type in the background, not the target type. You need to use this method to transfer it.\n */\nexport type ProductInfo = public_api.ProductInfo;\n\nexport enum MineActiveEnum {\n  All = '1',\n  Mine = '2',\n}\n\n/** data source */\nexport enum DataSourceType {\n  /** process */\n  Workflow = 'workflow',\n  /** @deprecated process store */\n  Product = 'product',\n}\n\nexport type WorkflowItemType =\n  | { type: DataSourceType.Workflow; item: WorkflowInfo }\n  | { type: DataSourceType.Product; item: ProductInfo };\n\nexport const WORKFLOW_LIST_STATUS_ALL = 'all';\n/**\n * In the category of workflows within a project when subprocesses are added, the resource library/project workflow category\n */\nexport enum WorkflowCategory {\n  /**\n   * project workflow\n   */\n  Project = 'project',\n  /**\n   * repository workflow\n   */\n  Library = 'library',\n  /**\n   * official example\n   */\n  Example = 'example',\n}\n/** Process pop-up status */\nexport interface WorkflowModalState {\n  /** process state */\n  status: WorkFlowListStatus | typeof WORKFLOW_LIST_STATUS_ALL;\n  /** @Deprecated data type, is the process data or store data being requested? */\n  dataSourceType: DataSourceType;\n  /** creator */\n  creator: MineActiveEnum;\n  /** @deprecated workflow template tag */\n  workflowTag: number;\n  /** @deprecated product label */\n  productCategory: string;\n  /** Search keywords */\n  query: string;\n  /** @Deprecated whether to request the current space flow */\n  isSpaceWorkflow: boolean;\n  /** Selected workflow category */\n  workflowCategory?: WorkflowCategory;\n  /** Sort by @deprecated store products  */\n  sortType?: SortType;\n  /** The workflow type for list filtering in the pop-up window, the possible values are All, Workflow, Chatflow. Used for workflow type filtering in the list, at this time Imageflow has been merged into the Workflow type */\n  listFlowMode: WorkflowMode;\n}\n\n/** process pop-up */\nexport interface WorkFlowModalModeProps {\n  /** The source of the current pop-up window is not uploaded by default. */\n  from?: WorkflowModalFrom;\n  /** Process type, workflow or image flow, default workflow */\n  flowMode?: WorkflowMode;\n  /** hidden flow */\n  excludedWorkflowIds?: string[];\n  /**\n   * Filter status Whether the filter component displays all status options, the default is false\n   */\n  filterOptionShowAll?: boolean;\n  /**\n   * Whether to hide the sidebar, the default is false. Use the scene details page to select workflow.\n   */\n  hideSider?: boolean;\n  /* Whether to hide the author filter menu */\n  hideCreatorSelect?: boolean;\n  /**\n   * Whether the workflow item shows the delete button, the default is false, used for scene workflow and Douyin doppelganger workflow\n   */\n  itemShowDelete?: boolean;\n  /** @Deprecated Whether to hide the Workflow list module under the space */\n  hiddenSpaceList?: boolean;\n  /**\n   * @deprecated hiddenWorkflowCategories\n   * Whether to hide the library module\n   */\n  hiddenLibrary?: boolean;\n  /** Whether to hide the creation workflow entry */\n  hiddenCreate?: boolean;\n  /**\n   * @Deprecated Explore category has been changed to official example, using hiddenWorkflowCategories\n   * Hidden Exploration Classification\n   */\n  hiddenExplore?: boolean;\n  /**\n   * Hidden workflow classification, the usage is the same as hiddenLibrary, hiddenExplore,\n   */\n  hiddenWorkflowCategories?: WorkflowCategory[];\n  /**\n   * Hidden workflow list type filter\n   */\n  hiddenListFlowModeFilter?: boolean;\n  /** Copy button copy, default \"copy and add\" */\n  dupText?: string;\n  /** Initial state, configure each filter */\n  initState?: Partial<WorkflowModalState>;\n  /** list of selected processes */\n  workFlowList?: BotPluginWorkFlowItem[];\n  /** Selected process list changes */\n  onWorkFlowListChange?: (newList: BotPluginWorkFlowItem[]) => void;\n  /** selection process */\n  onAdd?: (\n    item: BotPluginWorkFlowItem,\n    config: {\n      /** Does it come from copying? */\n      isDup: boolean;\n      /** Target space */\n      spaceId: string;\n    },\n  ) => void;\n  /** removal process */\n  onRemove?: (item: BotPluginWorkFlowItem) => void;\n  /**\n   * Removes the callback hooks after the process, and removeWorkflow removes the association with the bot/scene\n   * @param item\n   */\n  onDelete?: (item: BotPluginWorkFlowItem) => void;\n  /**\n   * List item click\n   *\n   * Configuration overrides default behavior: Open a new page Open the details page\n   * @Returns returns {handled: true} or undefined does not perform the default action, otherwise the internal default click event is executed\n   */\n  onItemClick?:\n    | ((\n        item: WorkflowItemType,\n        /** Pop-up status, which can be used to initialize the pop-up */\n        modalState: WorkflowModalState,\n      ) => { handled: boolean })\n    | ((\n        item: WorkflowItemType,\n        /** Pop-up status, which can be used to initialize the pop-up */\n        modalState: WorkflowModalState,\n      ) => void);\n  /**\n   * Successful creation process\n   *\n   * Configuration can override default behavior: new page opens process details after replication, with parameter from = createSuccess\n   */\n  onCreateSuccess?: (info: {\n    spaceId: string;\n    workflowId: string;\n    flowMode: WorkflowMode;\n  }) => void;\n  /**\n   * The replication process was successful.\n   *\n   * Configuration can override default behavior: Toast prompt Copy successful, continue editing\n   */\n  onDupSuccess?: (item: BotPluginWorkFlowItem) => void;\n  /** Callback triggered by introducing a repository file into the project */\n  onImport?: (\n    item: Pick<BotPluginWorkFlowItem, 'workflow_id' | 'name'>,\n  ) => void;\n  bindBizId?: string;\n  bindBizType?: BindBizType;\n  projectId?: string;\n  onClose?: () => void;\n  /**\n   * Create name check in workflow pop-up\n   */\n  nameValidators?: RuleItem[];\n  /** Custom i18n copy */\n  i18nMap?: Partial<Record<ModalI18nKey, I18nKey>>;\n}\n\nexport type WorkflowModalProps = {\n  className?: string;\n  visible?: boolean;\n} & WorkFlowModalModeProps;\n\nexport { WorkflowInfo };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type WorkflowModalState, WorkflowCategory } from './type';\n\n/**\n * Workflow modal Whether the project toolflow category is currently selected\n * @param modalState\n */\nexport const isSelectProjectCategory = (modalState?: WorkflowModalState) =>\n  modalState?.workflowCategory === WorkflowCategory.Project;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport {\n  type BindBizType,\n  type OrderBy,\n  type WorkflowMode,\n} from '@coze-workflow/base/api';\nimport { type SpaceType } from '@coze-arch/bot-api/playground_api';\n\nimport { type WorkflowModalState } from './type';\nimport { type I18nKey, type ModalI18nKey } from './hooks/use-i18n-text';\n\nexport interface WorkflowModalContextValue {\n  spaceId: string;\n  spaceType: SpaceType;\n  bindBizId?: string;\n  bindBizType?: BindBizType;\n  /** The current project id, only the workflow within the project has this field */\n  projectId?: string;\n  /** Workflow type, this parameter is passed in by props when created by WorkflowModal pop-up window, possible values are Workflow, Imageflow. Used to distinguish which workflow to add */\n  flowMode: WorkflowMode;\n  modalState: WorkflowModalState;\n  /** Update popup status, merge mode */\n  updateModalState: (newState: Partial<WorkflowModalState>) => void;\n  orderBy: OrderBy;\n  setOrderBy: React.Dispatch<React.SetStateAction<OrderBy>>;\n  createModalVisible: boolean;\n  setCreateModalVisible: React.Dispatch<React.SetStateAction<boolean>>;\n\n  /** Get the current pop-up state, which can be used to restore the pop-up state */\n  getModalState: (ctx: WorkflowModalContextValue) => WorkflowModalState;\n\n  /** Custom i18n copy */\n  i18nMap?: Partial<Record<ModalI18nKey, I18nKey>>;\n}\n\nconst WorkflowModalContext =\n  React.createContext<WorkflowModalContextValue | null>(null);\n\nexport default WorkflowModalContext;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type StandardNodeType } from '@coze-workflow/base/types';\nimport {\n  type WorkflowJSON,\n  type WorkflowNodeEntity,\n} from '@flowgram-adapter/free-layout-editor';\n\n/**\n * Encapsulation check result\n */\nexport interface EncapsulateValidateError {\n  /**\n   * error code\n   */\n  code: EncapsulateValidateErrorCode;\n  /**\n   * error message\n   */\n  message: string;\n  /**\n   * The source of the error, if it is a node problem, is the node ID.\n   */\n  source?: string;\n  /**\n   * Error source name\n   */\n  sourceName?: string;\n  /**\n   * source icon\n   */\n  sourceIcon?: string;\n}\n\n/**\n * check error code\n */\nexport enum EncapsulateValidateErrorCode {\n  NO_START_END = '1001',\n  INVALID_PORTS = '1002',\n  ENCAPSULATE_LINES = '1003',\n  AT_LEAST_TWO_NODES = '1005',\n  INVALID_FORM = '1006',\n  VALIDATE_ERROR = '1007',\n  INVALID_SCHEMA = '1008',\n  INVALID_LOOP_NODES = '1009',\n  INVALID_SUB_CANVAS = '1010',\n}\n\n/**\n * verification result\n */\nexport interface EncapsulateValidateResult {\n  /**\n   * Is there an error?\n   */\n  hasError: () => boolean;\n  /**\n   * add error\n   */\n  addError: (error: EncapsulateValidateError) => void;\n  /**\n   * Get error list\n   * @returns\n   */\n  getErrors: () => EncapsulateValidateError[];\n  /**\n   * Is there a specific code error?\n   */\n  hasErrorCode: (code: EncapsulateValidateErrorCode) => boolean;\n}\n\nexport const EncapsulateValidateResult = Symbol('EncapsulateValidateResult');\n\n/**\n * Validation Result Factory\n */\nexport type EncapsulateValidateResultFactory = () => EncapsulateValidateResult;\n\nexport const EncapsulateValidateResultFactory = Symbol(\n  'EncapsulateValidateResultFactory',\n);\n\n/**\n * Encapsulated Node Verifier\n */\nexport interface EncapsulateNodeValidator {\n  /**\n   * Node type\n   */\n  canHandle: (type: StandardNodeType) => boolean;\n  /**\n   * node validation\n   */\n  validate: (\n    node: WorkflowNodeEntity,\n    result: EncapsulateValidateResult,\n  ) => void | Promise<void>;\n}\n\nexport const EncapsulateNodeValidator = Symbol('EncapsulateNodeValidator');\n\n/**\n * Validators for all node levels\n */\nexport interface EncapsulateNodesValidator {\n  /**\n   * validate all nodes\n   */\n  validate: (\n    nodes: WorkflowNodeEntity[],\n    result: EncapsulateValidateResult,\n  ) => void;\n  /**\n   * Whether to include start and end nodes\n   */\n  includeStartEnd?: boolean;\n}\n\nexport const EncapsulateNodesValidator = Symbol('EncapsulateNodesValidator');\n\n/**\n * Process JSON validator\n */\nexport interface EncapsulateWorkflowJSONValidator {\n  validate: (\n    json: WorkflowJSON,\n    result: EncapsulateValidateResult,\n  ) => void | Promise<void>;\n}\n\nexport const EncapsulateWorkflowJSONValidator = Symbol(\n  'EncapsulateWorkflowJSONValidator',\n);\n\n/**\n * Encapsulation Validation Management\n */\nexport interface EncapsulateValidateManager {\n  /**\n   * Get all node validators\n   */\n  getNodeValidators: () => EncapsulateNodeValidator[];\n  /**\n   * Get the corresponding validator according to the node type\n   * @param type\n   * @returns\n   */\n  getNodeValidatorsByType: (\n    type: StandardNodeType,\n  ) => EncapsulateNodeValidator[];\n  /**\n   * Get all process level validators\n   */\n  getNodesValidators: () => EncapsulateNodesValidator[];\n  /**\n   * Get all process JSON validators\n   * @returns\n   */\n  getWorkflowJSONValidators: () => EncapsulateWorkflowJSONValidator[];\n  /**\n   * destroy\n   */\n  dispose: () => void;\n}\n\nexport const EncapsulateValidateManager = Symbol('EncapsulateValidateManager');\n\n/**\n * Encapsulation Validation Service\n */\nexport interface EncapsulateValidateService {\n  /**\n   * validation\n   * @param nodes\n   * @returns\n   */\n  validate: (nodes: WorkflowNodeEntity[]) => Promise<EncapsulateValidateResult>;\n}\n\nexport const EncapsulateValidateService = Symbol('EncapsulateValidateService');\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Encapsulate/unencapsulate commands\n */\nexport enum EncapsulateCommands {\n  /**\n   * package\n   */\n  ENCAPSULATE = 'ENCAPSULATE',\n  /**\n   * unblock\n   */\n  DECAPSULATE = 'DECAPSULATE',\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { injectable, multiInject, optional } from 'inversify';\nimport { type StandardNodeType } from '@coze-workflow/base/types';\n\nimport {\n  EncapsulateNodeValidator,\n  type EncapsulateValidateManager,\n  EncapsulateNodesValidator,\n  EncapsulateWorkflowJSONValidator,\n} from './types';\n\n@injectable()\nexport class EncapsulateValidateManagerImpl\n  implements EncapsulateValidateManager\n{\n  @multiInject(EncapsulateNodesValidator)\n  @optional()\n  private nodesValidators: EncapsulateNodesValidator[] = [];\n\n  @multiInject(EncapsulateNodeValidator)\n  @optional()\n  private nodeValidators: EncapsulateNodeValidator[] = [];\n\n  @multiInject(EncapsulateWorkflowJSONValidator)\n  @optional()\n  private workflowJSONValidators: EncapsulateWorkflowJSONValidator[] = [];\n\n  getNodeValidators() {\n    return this.nodeValidators || [];\n  }\n\n  getNodesValidators() {\n    return this.nodesValidators || [];\n  }\n\n  getWorkflowJSONValidators() {\n    return this.workflowJSONValidators || [];\n  }\n\n  getNodeValidatorsByType(type: StandardNodeType) {\n    return (this.nodeValidators || []).filter(validator =>\n      validator.canHandle(type),\n    );\n  }\n\n  dispose() {\n    this.nodeValidators = [];\n    this.nodesValidators = [];\n    this.workflowJSONValidators = [];\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { StandardNodeType } from '@coze-workflow/base';\nimport { type WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\n\n/**\n * Exclude start and end nodes\n * @param nodes\n * @returns\n */\nexport function excludeStartEnd(\n  nodes: WorkflowNodeEntity[],\n): WorkflowNodeEntity[] {\n  return nodes.filter(\n    node =>\n      ![StandardNodeType.Start, StandardNodeType.End].includes(\n        node.flowNodeType as StandardNodeType,\n      ),\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type WorkflowNodeEntity,\n  type WorkflowJSON,\n  type WorkflowNodeJSON,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { type Rect } from '../types';\n\n/**\n * Generate subprocess node options\n */\nexport interface GenerateSubWorkflowNodeOptions {\n  name: string;\n  workflowId: string;\n  desc: string;\n  spaceId: string;\n}\n\n/**\n * Encapsulation Generation Service\n */\nexport interface EncapsulateGenerateService {\n  /**\n   * generation flow\n   * @param nodes\n   * @returns\n   */\n  generateWorkflowJSON: (\n    nodes: WorkflowNodeEntity[],\n    options?: {\n      startEndRects?: {\n        start: Rect;\n        end: Rect;\n      };\n    },\n  ) => Promise<WorkflowJSON>;\n  /**\n   * Generate subprocess nodes\n   * @param options\n   * @returns\n   */\n  generateSubWorkflowNode: (\n    options: GenerateSubWorkflowNodeOptions,\n  ) => Partial<WorkflowNodeJSON>;\n}\n\nexport const EncapsulateGenerateService = Symbol('EncapsulateGenerateService');\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\n\n/**\n * Get the parent ID of the node\n */\nexport const getNodesParentId = (nodes: FlowNodeEntity[]): string =>\n  nodes[0]?.parent?.id || 'root';\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { PositionData } from '@flowgram-adapter/free-layout-editor';\nimport {\n  type WorkflowNodeJSON,\n  WorkflowNodeEntity,\n} from '@flowgram-adapter/free-layout-editor';\nimport { type IPoint } from '@flowgram-adapter/common';\n\n/**\n * Get node coordinates\n * @param node\n * @returns\n */\nexport function getNodePoint(\n  node: WorkflowNodeEntity | WorkflowNodeJSON,\n): IPoint {\n  if (node instanceof WorkflowNodeEntity) {\n    const positionData = node.getData<PositionData>(PositionData);\n    return {\n      x: positionData.x,\n      y: positionData.y,\n    };\n  }\n\n  return node?.meta?.position || { x: 0, y: 0 };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type WorkflowNodeJSON } from '@flowgram-adapter/free-layout-editor';\nimport { type IPoint } from '@flowgram-adapter/common';\n\nimport { type Rect } from '../types';\n\n/**\n * Set node coordinates\n * @param node\n * @returns\n */\nexport function setNodePosition(\n  node: WorkflowNodeJSON,\n  position: IPoint,\n): void {\n  if (!node.meta) {\n    node.meta = {};\n  }\n\n  node.meta.position = position;\n}\n\n/**\n * Set node coordinates according to the rectangle\n * @param node\n * @param rect\n */\nexport function setNodePositionByRect(node: WorkflowNodeJSON, rect: Rect) {\n  // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n  setNodePosition(node, { x: rect.x + rect.width / 2, y: rect.y });\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { inject, injectable } from 'inversify';\nimport { type StandardNodeType } from '@coze-workflow/base/types';\nimport { WorkflowMode } from '@coze-workflow/base/api';\nimport {\n  EntityManager,\n  type PluginContext,\n  PlaygroundConfigEntity,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { checkEncapsulateGray } from './utils';\nimport {\n  type NodeMeta,\n  type GetGlobalStateOption,\n  type GetNodeTemplateOption,\n} from './types';\n\n@injectable()\nexport class EncapsulateContext {\n  @inject(EntityManager)\n  protected readonly entityManager: EntityManager;\n\n  @inject(PlaygroundConfigEntity)\n  private playgroundConfigEntity: PlaygroundConfigEntity;\n\n  private pluginContext: PluginContext;\n\n  private getGlobalStateOption: GetGlobalStateOption = () => ({\n    spaceId: '',\n    flowMode: WorkflowMode.Workflow,\n    info: {\n      name: '',\n    },\n  });\n\n  private getNodeMetaTemplateOption: GetNodeTemplateOption = () => () =>\n    undefined;\n\n  setGetGlobalState(getGlobalState: GetGlobalStateOption) {\n    this.getGlobalStateOption = getGlobalState;\n  }\n\n  setGetNodeTemplate(getNodeTemplate: GetNodeTemplateOption) {\n    this.getNodeMetaTemplateOption = getNodeTemplate;\n  }\n\n  getNodeTemplate(type: StandardNodeType): NodeMeta | undefined {\n    return this.getNodeMetaTemplateOption(this.pluginContext)(type);\n  }\n\n  setPluginContext(context: PluginContext) {\n    this.pluginContext = context;\n  }\n\n  private get globalState() {\n    return this.getGlobalStateOption(this.pluginContext);\n  }\n\n  get spaceId() {\n    return this.globalState?.spaceId;\n  }\n\n  get flowName() {\n    return this.globalState?.info?.name;\n  }\n\n  get flowMode() {\n    return this.globalState?.flowMode;\n  }\n\n  get isChatFlow() {\n    return this.globalState?.flowMode === WorkflowMode.ChatFlow;\n  }\n\n  get enabled() {\n    return checkEncapsulateGray() && !this.playgroundConfigEntity.readonly;\n  }\n\n  get projectId() {\n    return this.globalState?.projectId;\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getFlags } from '@coze-arch/bot-flags';\n/**\n * Verify whether it can be encapsulated\n * Can @returns be encapsulated?\n */\nexport function checkEncapsulateGray() {\n  const FLAGS = getFlags();\n  return !!FLAGS['bot.automation.encapsulate'];\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FlowNodeBaseType,\n  type FlowNodeEntity,\n} from '@flowgram-adapter/free-layout-editor';\nimport { type WorkflowSubCanvas } from '@flowgram-adapter/free-layout-editor';\n\n/**\n * Is the multi-node in the subcanvas?\n * @param nodes\n * @returns\n */\nexport const isNodesInSubCanvas = (nodes?: FlowNodeEntity[]) =>\n  isNodeInSubCanvas(nodes?.[0]);\n\n/**\n * Is the single node in the subcanvas?\n * @param nodes\n * @returns\n */\nexport const isNodeInSubCanvas = (node?: FlowNodeEntity) =>\n  node?.parent?.id !== 'root';\n\n/**\n * Is it a child canvas node?\n * @param node\n * @returns\n */\nexport const isSubCanvasNode = (node?: FlowNodeEntity) =>\n  node?.flowNodeType === FlowNodeBaseType.SUB_CANVAS;\n\n/**\n * Get the parent node of the child canvas\n * @param node\n * @returns\n */\nexport const getSubCanvasParent = (node?: FlowNodeEntity) => {\n  const nodeMeta = node?.getNodeMeta();\n  const subCanvas: WorkflowSubCanvas = nodeMeta?.subCanvas(node);\n  return subCanvas?.parentNode;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { groupBy, uniq } from 'lodash-es';\nimport { inject, injectable } from 'inversify';\nimport { type WorkflowJSON } from '@coze-workflow/base';\nimport {\n  type WorkflowLineEntity,\n  WorkflowNodeLinesData,\n  type WorkflowPortEntity,\n  type WorkflowNodeEntity,\n  WorkflowLinesManager,\n  type WorkflowEdgeJSON,\n  type WorkflowLinePortInfo,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { isNodesInSubCanvas } from '../utils/subcanvas';\nimport { type ConnectPortsInfo } from './types';\n\n@injectable()\nexport class EncapsulateLinesService {\n  @inject(WorkflowLinesManager) declare linesManager: WorkflowLinesManager;\n\n  /**\n   * Get a valid encapsulation connection port\n   * @Param nodes Encapsulated array of nodes\n   * @throws Error input line does not conform to encapsulation rules\n   * @Throws Error Output line does not conform to encapsulation rules\n   * @Returns Encapsulated input and output port objects\n   */\n  getValidEncapsulateConnectPorts(\n    nodes: WorkflowNodeEntity[],\n  ): ConnectPortsInfo {\n    const inputLines = this.getEncapsulateNodesInputLines(nodes);\n    const outputLines = this.getEncapsulateNodesOutputLines(nodes);\n\n    if (!this.validateEncapsulateLines(inputLines)) {\n      throw new Error('');\n    }\n\n    if (!this.validateEncapsulateLines(outputLines)) {\n      throw new Error('');\n    }\n\n    return {\n      inputLines,\n      outputLines,\n      fromPorts: uniq(inputLines.map(_line => _line.fromPort)),\n      toPorts: uniq(\n        outputLines\n          .map(_line => _line.toPort)\n          .filter(Boolean) as WorkflowPortEntity[],\n      ),\n    };\n  }\n\n  /**\n   * Connects the specified ports to the given node.\n   *\n   * @param portInfo - Information about the ports to be connected.\n   * @param node - The node to which the ports will be connected.\n   *\n   * This method iterates over the `fromPorts` and `toPorts` arrays, creating lines\n   * between each port and the specified node using the `linesManager.createLine` method.\n   */\n\n  connectPortsToNode(portInfo: ConnectPortsInfo, node: WorkflowNodeEntity) {\n    const { fromPorts, toPorts } = portInfo;\n\n    fromPorts.forEach(_fromPort => {\n      this.linesManager.createLine({\n        from: _fromPort.node.id,\n        fromPort: _fromPort.portID,\n        to: node.id,\n      });\n    });\n\n    toPorts.forEach(_toPort => {\n      this.linesManager.createLine({\n        from: node.id,\n        to: _toPort.node.id,\n        toPort: _toPort.portID,\n      });\n    });\n  }\n\n  /**\n   * Get all input lines in the package range\n   * @Param nodes flowchart node array\n   * @Returns array of input lines in the encapsulated range\n   */\n  getEncapsulateNodesInputLines(\n    nodes: WorkflowNodeEntity[],\n  ): WorkflowLineEntity[] {\n    return uniq(\n      nodes\n        .map(_node => _node.getData(WorkflowNodeLinesData).inputLines)\n        .flat(),\n    ).filter(\n      _line =>\n        _line.from &&\n        !nodes.includes(_line.from) &&\n        (isNodesInSubCanvas(nodes) || !this.isSubCanvasLinkLine(_line)),\n    );\n  }\n\n  /**\n   * Get all output lines in the package range\n   * @Param nodes flowchart node array\n   * @Returns array of output lines in the encapsulated range\n   */\n  getEncapsulateNodesOutputLines(\n    nodes: WorkflowNodeEntity[],\n  ): WorkflowLineEntity[] {\n    return uniq(\n      nodes\n        .map(_node => _node.getData(WorkflowNodeLinesData).outputLines)\n        .flat(),\n    ).filter(\n      _line =>\n        _line.to &&\n        !nodes.includes(_line.to) &&\n        (isNodesInSubCanvas(nodes) || !this.isSubCanvasLinkLine(_line)),\n    );\n  }\n\n  /**\n   * Verify that the input and output lines within the package range comply with the package rules\n   */\n  validateEncapsulateLines(lines: WorkflowLineEntity[]): boolean {\n    const isFromPortUniq =\n      uniq(lines.map(_line => _line.fromPort)).length === 1;\n    const isToPortUniq = uniq(lines.map(_line => _line.toPort)).length === 1;\n    return isFromPortUniq || isToPortUniq;\n  }\n\n  /**\n   * Create encapsulation connection\n   * @param ports\n   * @param subFlowNode\n   * @returns\n   */\n  createEncapsulateLines(\n    ports: ConnectPortsInfo,\n    subFlowNode: WorkflowNodeEntity,\n  ) {\n    const inputLines: WorkflowLineEntity[] = [];\n    const outputLines: WorkflowLineEntity[] = [];\n    ports.inputLines.forEach(line => {\n      const inputLine = this.linesManager.createLine({\n        from: line.from.id,\n        fromPort: line.fromPort.portID,\n        to: subFlowNode.id,\n      });\n\n      if (!inputLine) {\n        throw new Error('create input line failed');\n      }\n      inputLines.push(inputLine);\n    });\n\n    ports.outputLines.forEach(line => {\n      if (!line.to) {\n        return;\n      }\n\n      const outputLine = this.linesManager.createLine({\n        from: subFlowNode.id,\n        to: line.to.id,\n        toPort: line.toPort?.portID,\n      });\n\n      if (!outputLine) {\n        throw new Error('create output line failed');\n      }\n\n      outputLines.push(outputLine);\n    });\n\n    return {\n      inputLines,\n      outputLines,\n    };\n  }\n\n  /**\n   * Create unsealing line\n   * @param options\n   */\n  createDecapsulateLines(options: {\n    node: WorkflowNodeEntity;\n    workflowJSON: WorkflowJSON;\n    startNodeId: string;\n    endNodeId: string;\n    idsMap: Map<string, string>;\n  }) {\n    const { node, startNodeId, endNodeId, idsMap, workflowJSON } = options;\n    const edges = [\n      ...workflowJSON.edges,\n      // Lines in the sub-canvas\n      ...workflowJSON.nodes\n        .map(n => n.edges)\n        .filter(Boolean)\n        .flat(),\n    ] as WorkflowEdgeJSON[];\n\n    const edgesGroup = groupBy(edges, edge => {\n      if (edge.sourceNodeID === startNodeId) {\n        return 'input';\n      }\n      if (edge.targetNodeID === endNodeId) {\n        return 'output';\n      }\n\n      return 'internal';\n    });\n\n    // interconnect\n    const internalLines = this.createDecapsulateInternalLines(\n      edgesGroup.internal || [],\n      idsMap,\n    );\n\n    // input connection\n    const inputLines = this.createDecapsulateInputLines(\n      edgesGroup.input || [],\n      node,\n      idsMap,\n    );\n\n    // output connection\n    const outputLines = this.createDecapsulateOutputLines(\n      edgesGroup.output || [],\n      node,\n      idsMap,\n    );\n\n    return {\n      inputLines,\n      outputLines,\n      internalLines,\n    };\n  }\n\n  /**\n   * Create an unblocked internal connection\n   * @param internalEdges\n   * @param idsMap\n   * @returns\n   */\n  private createDecapsulateInternalLines(\n    internalEdges: WorkflowEdgeJSON[],\n    idsMap: Map<string, string>,\n  ) {\n    const createdLines: WorkflowLineEntity[] = [];\n    internalEdges.forEach(edge => {\n      if (!idsMap.has(edge.sourceNodeID) || !idsMap.has(edge.targetNodeID)) {\n        return;\n      }\n\n      const line = {\n        from: idsMap.get(edge.sourceNodeID) as string,\n        to: idsMap.get(edge.targetNodeID) as string,\n        fromPort: edge.sourcePortID,\n        toPort: edge.targetPortID,\n      };\n\n      if (line.fromPort === 'loop-function-inline-output') {\n        line.from = `LoopFunction_${line.from}`;\n      }\n\n      if (line.toPort === 'loop-function-inline-input') {\n        line.to = `LoopFunction_${line.to}`;\n      }\n\n      if (line.fromPort === 'batch-function-inline-output') {\n        line.from = `BatchFunction_${line.from}`;\n      }\n\n      if (line.toPort === 'batch-function-inline-input') {\n        line.to = `BatchFunction_${line.to}`;\n      }\n\n      this.createLine(line, createdLines);\n    });\n    return createdLines;\n  }\n\n  /**\n   * Create an unsealed input connection\n   * @param inputEdges\n   * @param node\n   * @param idsMap\n   * @returns\n   */\n  private createDecapsulateInputLines(\n    inputEdges: WorkflowEdgeJSON[],\n    node: WorkflowNodeEntity,\n    idsMap: Map<string, string>,\n  ) {\n    const createdLines: WorkflowLineEntity[] = [];\n    const { inputLines } = node.getData(WorkflowNodeLinesData);\n\n    // Encapsulate multiple starts + encapsulate multiple upstream inputs, do not create connections\n    if (inputLines.length > 1 && inputEdges.length > 1) {\n      return createdLines;\n    }\n\n    inputLines.forEach(inputLine => {\n      inputEdges.forEach(edge => {\n        if (!idsMap.has(edge.targetNodeID)) {\n          return;\n        }\n\n        this.createLine(\n          {\n            from: inputLine.from.id,\n            fromPort: inputLine.fromPort.portID,\n            to: idsMap.get(edge.targetNodeID) as string,\n            toPort: edge.targetPortID,\n          },\n          createdLines,\n        );\n      });\n    });\n\n    return createdLines;\n  }\n\n  /**\n   * Create an unsealed output connection\n   * @param outputEdges\n   * @param node\n   * @param idsMap\n   * @returns\n   */\n  private createDecapsulateOutputLines(\n    outputEdges: WorkflowEdgeJSON[],\n    node: WorkflowNodeEntity,\n    idsMap: Map<string, string>,\n  ) {\n    const createdLines: WorkflowLineEntity[] = [];\n    const { outputLines } = node.getData(WorkflowNodeLinesData);\n\n    // Encapsulate multiple outputs + Encapsulate multiple downstream outputs without creating wires\n    if (outputLines.length > 1 && outputEdges.length > 1) {\n      return createdLines;\n    }\n\n    outputLines.forEach(outputLine => {\n      outputEdges.forEach(edge => {\n        if (!idsMap.has(edge.sourceNodeID)) {\n          return;\n        }\n\n        this.createLine(\n          {\n            from: idsMap.get(edge.sourceNodeID) as string,\n            fromPort: edge.sourcePortID,\n            to: outputLine.to?.id,\n            toPort: outputLine.toPort?.portID,\n          },\n          createdLines,\n        );\n      });\n    });\n\n    return createdLines;\n  }\n\n  /**\n   * Create a connection\n   * @param info\n   * @param createdLines\n   */\n  private createLine(\n    info: WorkflowLinePortInfo,\n    createdLines?: WorkflowLineEntity[],\n  ) {\n    const line = this.linesManager.createLine(info);\n\n    if (line && createdLines) {\n      createdLines.push(line);\n    }\n  }\n\n  private isSubCanvasLinkLine(line: WorkflowLineEntity): boolean {\n    if (\n      // The last wire in the loop\n      line.toPort?.portID === 'loop-function-inline-input' ||\n      // The first wire in the loop\n      line.fromPort.portID === 'loop-function-inline-output'\n    ) {\n      return true;\n    }\n    if (\n      line.toPort?.portID === 'batch-function-inline-input' ||\n      line.fromPort.portID === 'batch-function-inline-output'\n    ) {\n      return true;\n    }\n    if (\n      line.fromPort.portID === 'loop-output-to-function' &&\n      line.toPort?.portID === 'loop-function-input'\n    ) {\n      return true;\n    }\n    if (\n      line.fromPort.portID === 'batch-output-to-function' &&\n      line.toPort?.portID === 'batch-function-input'\n    ) {\n      return true;\n    }\n    return false;\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { customAlphabet } from 'nanoid';\n\nconst RANDOM_NUM = 6;\nconst RANDOM_ALPHABET = '0123456789';\n\nexport const randomNameSuffix = () => {\n  const nanoid = customAlphabet(RANDOM_ALPHABET, RANDOM_NUM);\n  return nanoid();\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type WorkflowNodeRegistry,\n  type WorkflowNodeJSON,\n  type WorkflowDocument,\n} from '@flowgram-adapter/free-layout-editor';\n\n/**\n * Is there a node with a child canvas?\n */\nexport const hasSubCanvasNodes = (\n  workflowDocument: WorkflowDocument,\n  nodes: WorkflowNodeJSON[],\n) =>\n  !!nodes.find(node => {\n    const registry = workflowDocument.getNodeRegister(\n      node.type,\n    ) as WorkflowNodeRegistry;\n    return !!registry?.meta?.subCanvas;\n  });\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type ValidateErrorData,\n  type WorkflowMode,\n} from '@coze-workflow/base/';\nimport { type WorkflowJSON } from '@flowgram-adapter/free-layout-editor';\n\nexport interface EncapsulateWorkflowParams {\n  name: string;\n  desc: string;\n  json: WorkflowJSON;\n  flowMode: WorkflowMode;\n}\n\nexport interface EncapsulateApiService {\n  /**\n   * encapsulation process\n   * @param name\n   */\n  encapsulateWorkflow: (\n    params: EncapsulateWorkflowParams,\n  ) => Promise<{ workflowId: string } | null>;\n  /**\n   * Validation Process\n   * @param schema\n   * @returns\n   */\n  validateWorkflow: (json: WorkflowJSON) => Promise<ValidateErrorData[]>;\n  /**\n   * Get process data\n   * @param spaceId\n   * @param workflowId\n   * @returns\n   */\n  getWorkflow: (\n    spaceId: string,\n    workflowId: string,\n    version?: string,\n  ) => Promise<WorkflowJSON | null>;\n}\n\nexport const EncapsulateApiService = Symbol('EncapsulateApiService');\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { WorkflowMode } from '@coze-workflow/base/api';\n\nexport const ICON_URIS = {\n  [WorkflowMode.Workflow]: 'plugin_icon/workflow.png',\n  [WorkflowMode.ChatFlow]: 'plugin_icon/chatflow-icon.png',\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/use-error-in-catch */\nimport { get } from 'lodash-es';\nimport { inject, injectable } from 'inversify';\nimport { OperateType, workflowApi } from '@coze-workflow/base/api';\n\nimport { EncapsulateContext } from '../encapsulate-context';\nimport {\n  type EncapsulateWorkflowParams,\n  type EncapsulateApiService,\n} from './types';\nimport { ICON_URIS } from './constants';\n\n@injectable()\nexport class EncapsulateApiServiceImpl implements EncapsulateApiService {\n  @inject(EncapsulateContext)\n  private encapsulateContext: EncapsulateContext;\n\n  async encapsulateWorkflow({\n    name,\n    desc,\n    json,\n    flowMode,\n  }: EncapsulateWorkflowParams) {\n    try {\n      const res = await workflowApi.EncapsulateWorkflow({\n        space_id: this.encapsulateContext.spaceId,\n        name,\n        flow_mode: flowMode,\n        desc,\n        schema: JSON.stringify(json),\n        icon_uri: ICON_URIS[flowMode],\n        project_id: this.encapsulateContext.projectId,\n      });\n\n      const workflowId = res.data?.workflow_id;\n      if (!workflowId) {\n        return null;\n      }\n\n      return {\n        workflowId,\n      };\n    } catch (e) {\n      return null;\n    }\n  }\n\n  async validateWorkflow(json) {\n    try {\n      const res = await workflowApi.EncapsulateWorkflow({\n        space_id: this.encapsulateContext.spaceId,\n        name: '',\n        desc: '',\n        icon_uri: '',\n        schema: JSON.stringify(json),\n        only_validate: true,\n      });\n      return res?.data?.validate_data || [];\n    } catch (e) {\n      return [\n        {\n          message: 'call validate api failed',\n        },\n      ];\n    }\n  }\n\n  async getWorkflow(spaceId: string, workflowId: string, version?: string) {\n    let json;\n    // Scenes with historical versions get historical versions of data\n    if (version) {\n      const res = await workflowApi.GetHistorySchema({\n        space_id: spaceId,\n        workflow_id: workflowId,\n        workflow_version: version,\n        commit_id: '',\n        type: OperateType.DraftOperate,\n      });\n      json = get(res, 'data.schema');\n    } else {\n      const res = await workflowApi.GetCanvasInfo({\n        space_id: spaceId,\n        workflow_id: workflowId,\n      });\n\n      json = get(res, 'data.workflow.schema_json');\n    }\n\n    if (!json) {\n      return null;\n    }\n\n    return JSON.parse(json);\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isObject, get, has, isArray } from 'lodash-es';\nimport { type WorkflowVariable } from '@coze-workflow/variable';\nimport { type DTODefine } from '@coze-workflow/base';\n\n/**\n * Traverse variable references in DTO JSON\n * @param data\n * @param cb\n * @returns\n */\nexport function traverseRefsInNodeJSON(\n  data: unknown,\n  cb: (_ref: DTODefine.RefExpression) => void,\n) {\n  if (isObject(data)) {\n    // Determine if it conforms to the structure of ValueExpressionDTO\n    if (\n      get(data, 'type') === 'ref' &&\n      get(data, 'content.source') === 'block-output' &&\n      has(data, 'content.blockID') &&\n      has(data, 'content.name')\n    ) {\n      cb(data as unknown as DTODefine.RefExpression);\n    }\n\n    Object.entries(data).forEach(([_key, _val]) => {\n      traverseRefsInNodeJSON(_val, cb);\n    }, {});\n    return;\n  }\n\n  if (isArray(data)) {\n    data.forEach(_item => {\n      traverseRefsInNodeJSON(_item, cb);\n    });\n  }\n}\n\n/**\n * variable sort\n * @param variable\n * @returns\n */\nexport const variableOrder = (name?: string) => {\n  const orders = {\n    USER_INPUT: 2,\n    CONVERSATION_NAME: 1,\n  };\n  return orders[name ?? ''] || 0;\n};\n\nexport const sortVariables = (variables: WorkflowVariable[]) => {\n  if (!variables) {\n    return variables;\n  }\n\n  return variables.sort(\n    (a, b) =>\n      variableOrder(b?.viewMeta?.name) - variableOrder(a?.viewMeta?.name),\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { uniq } from 'lodash-es';\nimport {\n  type WorkflowNodeRegistry,\n  type FlowNodeEntity,\n} from '@flowgram-adapter/free-layout-editor';\n\n/**\n * Get a list of nodes with sub-nodes\n * @param nodes\n * @returns\n */\nexport const getNodesWithSubCanvas = (nodes: FlowNodeEntity[]) =>\n  uniq(\n    nodes\n      .map(node => {\n        const registry = node.getNodeRegistry() as WorkflowNodeRegistry;\n        const subCanvas = registry?.meta?.subCanvas;\n\n        return [\n          node,\n          // All sub-nodes corresponding to the sub-canvas\n          ...(subCanvas?.(node)?.canvasNode?.allCollapsedChildren || []),\n        ];\n      })\n      .flat(),\n  );\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable max-len */\nimport { get, set, uniq } from 'lodash-es';\nimport { inject, injectable } from 'inversify';\nimport { produce } from 'immer';\nimport {\n  type FormModelV2,\n  isFormV2,\n} from '@flowgram-adapter/free-layout-editor';\nimport { FlowNodeFormData } from '@flowgram-adapter/free-layout-editor';\nimport {\n  type FlowNodeJSON,\n  type FlowNodeEntity,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  WorkflowDocument,\n  type WorkflowJSON,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  type UpdateRefInfo,\n  WorkflowNodeRefVariablesData,\n  WorkflowVariableService,\n  type WorkflowVariable,\n  variableUtils,\n  isGlobalVariableKey,\n} from '@coze-workflow/variable';\nimport {\n  type InputValueDTO,\n  type InputValueVO,\n  StandardNodeType,\n  type ValueExpression,\n  ValueExpressionType,\n} from '@coze-workflow/base';\n\nimport {\n  traverseRefsInNodeJSON,\n  sortVariables,\n  variableOrder,\n} from '../utils/variable';\nimport { getNodesWithSubCanvas } from '../utils/get-nodes-with-sub-canvas';\nimport { EncapsulateContext } from '../encapsulate-context';\nimport {\n  type VariableMap,\n  type EncapsulateVars,\n  type DecapsulateContext,\n} from './types';\n\n@injectable()\nexport class EncapsulateVariableService {\n  @inject(WorkflowDocument) document: WorkflowDocument;\n\n  @inject(WorkflowVariableService) variableService: WorkflowVariableService;\n\n  @inject(EncapsulateContext) encapsulateContext: EncapsulateContext;\n\n  /**\n   * Get encapsulation variable\n   * @param nodes\n   * @returns\n   */\n\n  getEncapsulateVars(_nodes: FlowNodeEntity[]): EncapsulateVars {\n    const nodes = getNodesWithSubCanvas(_nodes);\n\n    return {\n      startVars: this.getEncapsulateStartVars(nodes),\n      endVars: this.getEncapsulateEndVars(nodes),\n    };\n  }\n\n  /**\n   * When actively encapsulating, update variable references inside WorkflowJSON\n   * @param workflowJSON\n   * @param vars\n   * @returns\n   */\n  updateVarsInEncapsulateJSON(\n    workflowJSON: WorkflowJSON,\n    vars: EncapsulateVars,\n  ) {\n    const startId =\n      workflowJSON.nodes.find(_node => _node.type === StandardNodeType.Start)\n        ?.id || '100001';\n\n    const nextWorkflowJSON = produce(workflowJSON, draft => {\n      this.updateVarsInEncapsulateNodesJSON(\n        draft.nodes as WorkflowJSON['nodes'],\n        vars,\n        startId,\n      );\n    });\n\n    return nextWorkflowJSON;\n  }\n\n  /**\n   * Update variables in node JSON\n   * @param nodes\n   * @param vars\n   * @param startId\n   */\n  updateVarsInEncapsulateNodesJSON(\n    nodes: WorkflowJSON['nodes'],\n    vars: EncapsulateVars,\n    startId: string,\n  ) {\n    const { startVars, endVars } = vars;\n\n    nodes.forEach(_node => {\n      if (!_node.data) {\n        _node.data = {};\n      }\n\n      // Start Node Setup\n      if (_node.type === StandardNodeType.Start) {\n        _node.data.outputs = Object.entries(startVars).map(_entry => {\n          const [name, variable] = _entry;\n          return {\n            ...variable.dtoMeta,\n            name,\n          };\n        });\n        return;\n      }\n      // End Node Settings\n      if (_node.type === StandardNodeType.End) {\n        _node.data.inputs = {\n          terminatePlan: 'returnVariables',\n          inputParameters: Object.entries(endVars).map(_entry => {\n            const [name, variable] = _entry;\n            return {\n              name,\n              input: variable.refExpressionDTO,\n            };\n          }),\n        };\n        return;\n      }\n      traverseRefsInNodeJSON(_node.data, _ref => {\n        if (!_ref.content) {\n          return;\n        }\n\n        const targetKeyPath = [\n          _ref.content?.blockID,\n          ...(_ref.content?.name?.split('.') || []),\n        ];\n\n        const targetEntry = Object.entries(startVars).find(\n          ([, _var]) =>\n            _var.keyPath[0] === targetKeyPath[0] &&\n            _var.keyPath[1] === targetKeyPath[1],\n        );\n\n        // If the variable of the start node is hit, it is replaced with the variable of the start node\n        if (targetEntry) {\n          _ref.content.blockID = startId;\n          _ref.content.name = [targetEntry[0], ...targetKeyPath.slice(2)].join(\n            '.',\n          );\n        }\n      });\n\n      // Sub-canvas scenes need to be recursive\n      if (_node.blocks) {\n        this.updateVarsInEncapsulateNodesJSON(_node.blocks, vars, startId);\n      }\n    });\n  }\n\n  /**\n   * Update upstream and downstream variable references after encapsulation\n   * @param subFlowNode encapsulation node\n   * @param selectNodes selected node\n   * @param vars encapsulation variable\n   */\n  updateVarsAfterEncapsulate(\n    subFlowNode: FlowNodeEntity,\n    selectNodes: FlowNodeEntity[],\n    vars: EncapsulateVars,\n  ) {\n    const { startVars, endVars } = vars;\n\n    // Encapsulating node input variables\n    this.setSubFlowNodeInputs(subFlowNode, startVars);\n\n    // Variables that encapsulate nodes by downstream references\n    const updateRefInfos: UpdateRefInfo[] = Object.entries(endVars).map(\n      _entry => {\n        const [name, variable] = _entry;\n\n        return {\n          beforeKeyPath: variable.keyPath,\n          afterKeyPath: [subFlowNode.id, name, ...variable.keyPath.slice(2)],\n        };\n      },\n    );\n\n    this.getBeyondNodes([...selectNodes, subFlowNode]).forEach(_node => {\n      _node\n        .getData(WorkflowNodeRefVariablesData)\n        .batchUpdateRefs(updateRefInfos);\n    });\n  }\n\n  /**\n   * Update upstream and downstream variable references after unencapsulation\n   */\n  updateVarsAfterDecapsulate(\n    sourceNode: FlowNodeEntity,\n    group: DecapsulateContext,\n  ) {\n    const { startNode, endNode, middleNodes, idsMap } = group;\n\n    const decapsulateNodes = this.flatNodeJSONs(middleNodes)\n      .map(_node => this.document.getNode(_node.id || ''))\n      .filter(Boolean) as FlowNodeEntity[];\n\n    // 1. Update the variables in the encapsulated node\n    const sourceInputParameters: Record<string, ValueExpression> = sourceNode\n      .getData(FlowNodeFormData)\n      .formModel.getFormItemValueByPath('/inputs/inputParameters');\n    const updateInsideRefInfos: UpdateRefInfo[] = [\n      // Variable reference node Id update\n      ...idsMap.entries().map(_entry => ({\n        beforeKeyPath: [_entry[0]],\n        afterKeyPath: [_entry[1]],\n      })),\n      // Variables entered into the encapsulated node\n      ...Object.entries(sourceInputParameters || {}).map(_entry => {\n        const [name, value] = _entry;\n\n        return {\n          beforeKeyPath: [startNode?.id || '100001', name],\n          afterKeyPath: get(value, 'content.keyPath'),\n          afterExpression: value,\n        };\n      }),\n    ];\n\n    decapsulateNodes.forEach(_node => {\n      _node\n        .getData(WorkflowNodeRefVariablesData)\n        .batchUpdateRefs(updateInsideRefInfos);\n    });\n\n    // 2. Downstream references encapsulate variables within the node\n    const endOutputs: InputValueDTO[] =\n      get(endNode?.data || {}, 'inputs.inputParameters') || [];\n    // Variables output from within the encapsulated node\n    const updateOutsideRefInfos: UpdateRefInfo[] = endOutputs.map(_output => {\n      const { name, input } = _output || {};\n      const beforeKeyPath = [sourceNode.id, name || ''];\n      const expression = variableUtils.valueExpressionToVO(\n        input,\n        this.variableService,\n      );\n\n      if (expression.type === ValueExpressionType.REF) {\n        const [nodeId, ...paths] = get(expression, 'content.keyPath') || [];\n        const actualNodeId = idsMap.get(nodeId) || nodeId;\n        return {\n          beforeKeyPath,\n          afterKeyPath: [actualNodeId, ...paths],\n        };\n      }\n\n      return {\n        beforeKeyPath,\n        afterExpression: expression,\n      };\n    });\n\n    this.getBeyondNodes([sourceNode, ...decapsulateNodes]).forEach(_node => {\n      _node\n        .getData(WorkflowNodeRefVariablesData)\n        .batchUpdateRefs(updateOutsideRefInfos);\n    });\n  }\n\n  protected setSubFlowNodeInputs(\n    subFlowNode: FlowNodeEntity,\n    startVars: EncapsulateVars['startVars'],\n  ) {\n    const formData = subFlowNode.getData(FlowNodeFormData);\n\n    // SubFlow's inputParameters are of type Object\n    const inputParameters: Record<string, InputValueVO> = Object.entries(\n      startVars,\n    )\n      .sort((a, b) => variableOrder(b[0]) - variableOrder(a[0]))\n      .reduce((acm, _entry) => {\n        const [name, variable] = _entry;\n\n        return {\n          ...acm,\n          [name]: {\n            type: ValueExpressionType.REF,\n            content: {\n              keyPath: variable.keyPath,\n            },\n          },\n        };\n      }, {});\n\n    // New form engine updates data\n    if (isFormV2(subFlowNode)) {\n      (formData.formModel as FormModelV2).setValueIn(\n        'inputs.inputParameters',\n        inputParameters,\n      );\n    } else {\n      // Old form engine updates data\n      const fullData = formData.formModel.getFormItemValueByPath('/');\n      set(fullData, 'inputs.inputParameters', inputParameters);\n      formData.fireChange();\n    }\n  }\n\n  /**\n   * Get the start variable of the encapsulated node\n   * @param nodes\n   */\n  protected getEncapsulateStartVars(nodes: FlowNodeEntity[]): VariableMap {\n    const variablesMap = this.generateVariableMap(\n      this.getEncapsulateNodesVars(nodes),\n    );\n    return variablesMap;\n  }\n\n  /**\n   * Get encapsulated node variable\n   * @param _nodes\n   * @returns\n   */\n  protected getEncapsulateNodesVars(\n    nodes: FlowNodeEntity[],\n  ): WorkflowVariable[] {\n    const selectNodeIds = nodes.map(_node => _node.id);\n    const variables = uniq(\n      nodes\n        .map(\n          _node =>\n            Object.values(_node.getData(WorkflowNodeRefVariablesData).refs)\n              .filter(\n                _keyPath =>\n                  !selectNodeIds.includes(_keyPath[0]) &&\n                  !isGlobalVariableKey(_keyPath[0]),\n              )\n              .map(_keyPath =>\n                this.variableService.getWorkflowVariableByKeyPath(\n                  // Product requirements, as long as you take the first level.\n                  _keyPath.slice(0, 2),\n                  { node: _node },\n                ),\n              )\n              .filter(Boolean) as WorkflowVariable[],\n        )\n        .flat(),\n    );\n\n    return sortVariables(variables);\n  }\n\n  /**\n   * Get the end variable of the encapsulated node\n   * @param nodes\n   */\n  protected getEncapsulateEndVars(nodes: FlowNodeEntity[]): VariableMap {\n    const selectNodeIds = nodes.map(_node => _node.id);\n\n    // Get all references to nodes outside the circled scope Variable references in the circled scope\n    const variables = uniq(\n      this.getBeyondNodes(nodes)\n        .map(\n          _node =>\n            Object.values(_node.getData(WorkflowNodeRefVariablesData).refs)\n              .filter(_keyPath => selectNodeIds.includes(_keyPath[0]))\n              .map(_keyPath =>\n                this.variableService.getWorkflowVariableByKeyPath(\n                  // Product requirements, as long as you take the first level.\n                  _keyPath.slice(0, 2),\n                  { node: _node },\n                ),\n              )\n              .filter(Boolean) as WorkflowVariable[],\n        )\n        .flat(),\n    );\n\n    return this.generateVariableMap(variables);\n  }\n\n  /**\n   * Get nodes outside the circled range\n   * @param nodes\n   * @returns\n   */\n  protected getBeyondNodes(nodes: FlowNodeEntity[]) {\n    const selectNodeIds = nodes.map(_node => _node.id);\n\n    return this.document\n      .getAllNodes()\n      .filter(_node => !selectNodeIds.includes(_node.id));\n  }\n\n  /**\n   * Generate variable mapping\n   * @param variables\n   */\n  protected generateVariableMap(variables: WorkflowVariable[]): VariableMap {\n    const variablesMap = variables.reduce((acm, _variable) => {\n      const _keyPath = _variable.keyPath || [];\n      let name = _keyPath[1];\n      let index = 1;\n\n      // If name already exists or conflicts with the system default field, you need to add a suffix\n      while (acm[name] || ['BOT_USER_INPUT'].includes(name)) {\n        name = `${_keyPath[1]}_${index}`;\n        index++;\n      }\n\n      return {\n        ...acm,\n        [name]: _variable,\n      };\n    }, {});\n\n    if (this.encapsulateContext.isChatFlow) {\n      return this.generateChatVariableMap(variablesMap);\n    }\n\n    return variablesMap;\n  }\n\n  /**\n   * 1. Case 1: The imported parameters of all nodes in the box selection range do not contain USER_INPUT and CONVERSATION_NAME. At this time, the encapsulated sub-process is workflow, and the sub-process start does not have default parameters\n   * 2. Case 2: The imported parameters of all nodes in the box selection range contain both USER_INPUT and CONVERSATION_NAME. At this time, the encapsulated sub-process is chatflow. The sub-process start defaults to parameters USER_INPUT and CONVERSATION_NAME, the name remains unchanged, and the reference relationship with the parent process is established\n   * 3. Case 3: The imported parameters of all nodes in the box selection range contain one of USER_INPUT and CONVERSATION_NAME. At this time, the encapsulated sub-process is workflow, the sub-process start does not have default parameters, and the new parameters USER_INPUT_1 or CONVERSATION_NAME_1 to establish a reference relationship with the parent process\n   */\n  protected generateChatVariableMap(variablesMap: VariableMap): VariableMap {\n    if (variablesMap.USER_INPUT && !variablesMap.CONVERSATION_NAME) {\n      variablesMap.USER_INPUT_1 = variablesMap.USER_INPUT;\n      delete variablesMap.USER_INPUT;\n    }\n\n    if (variablesMap.CONVERSATION_NAME && !variablesMap.USER_INPUT) {\n      variablesMap.CONVERSATION_NAME_1 = variablesMap.CONVERSATION_NAME;\n      delete variablesMap.CONVERSATION_NAME;\n    }\n\n    return variablesMap;\n  }\n\n  protected flatNodeJSONs(nodes: FlowNodeJSON[]) {\n    const result: FlowNodeJSON[] = [];\n    const queue = [...nodes];\n\n    while (queue.length > 0) {\n      const node = queue.shift();\n\n      if (node) {\n        result.push(node);\n      }\n\n      if (node?.blocks) {\n        queue.push(...(node.blocks as FlowNodeJSON[]));\n      }\n    }\n\n    return result;\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable max-params */\n/* eslint-disable @typescript-eslint/no-magic-numbers */\nimport { get, set } from 'lodash-es';\nimport { inject, injectable } from 'inversify';\nimport {\n  type DragNodeOperationValue,\n  FreeOperationType,\n  HistoryService,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  PlaygroundContext,\n  TransformData,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  type WorkflowNodeJSON,\n  type WorkflowNodeEntity,\n  WorkflowDocument,\n} from '@flowgram-adapter/free-layout-editor';\nimport { delay, type IPoint } from '@flowgram-adapter/common';\nimport { WorkflowNodesService } from '@coze-workflow/nodes';\nimport { StandardNodeType } from '@coze-workflow/base/types';\n\nimport { getNodesParentId } from '../utils/get-nodes-parent-id';\nimport { getNodePoint } from '../utils';\nimport { EncapsulateGenerateService } from '../generate';\nimport { EncapsulateContext } from '../encapsulate-context';\nimport { ENCAPSULATE_START_END_PAD } from './constants';\n\n/**\n * Node Operation Service\n */\n@injectable()\nexport class EncapsulateNodesService {\n  @inject(WorkflowDocument)\n  private workflowDocument: WorkflowDocument;\n\n  @inject(WorkflowNodesService)\n  private workflowNodesService: WorkflowNodesService;\n\n  @inject(EncapsulateContext)\n  private encapsulateContext: EncapsulateContext;\n\n  @inject(EncapsulateGenerateService)\n  private encapsulateGenerateService: EncapsulateGenerateService;\n\n  @inject(HistoryService)\n  private historyService: HistoryService;\n\n  @inject(PlaygroundContext)\n  private playgroundContext: PlaygroundContext;\n\n  /**\n   * Get the center point of a batch of nodes\n   * @param nodes array\n   * @Returns the coordinate object of the center point\n   */\n  getNodesMiddlePoint(\n    nodes: Array<WorkflowNodeEntity | WorkflowNodeJSON>,\n  ): IPoint {\n    if (nodes.length === 0) {\n      throw new Error('');\n    }\n\n    const rect = this.getNodesRect(nodes);\n\n    return {\n      x: rect.x + rect.width / 2,\n      y: rect.y + rect.height / 2,\n    };\n  }\n\n  /**\n   * Create an unblocked node\n   * @param sourceNode The original unblocked node\n   * @Param nodes to generate node json data\n   * @returns\n   */\n  async createDecapsulateNodes(\n    sourceNode: WorkflowNodeEntity,\n    nodes: WorkflowNodeJSON[],\n    parentId?: string,\n  ) {\n    const { startNode, endNode, middleNodes } = this.groupNodes(nodes);\n    if (!startNode || !endNode) {\n      throw new Error('start or end node not found');\n    }\n    const nodePoint = getNodePoint(sourceNode);\n    const centerPoint = this.getNodesMiddlePoint(middleNodes);\n    // Translate to Center\n    const translate: IPoint = {\n      x: nodePoint.x - centerPoint.x,\n      y: nodePoint.y - centerPoint.y,\n    };\n\n    const idsMap = new Map<string, string>();\n    for (const nodeJSON of middleNodes) {\n      await this.createDecapsulateNode(nodeJSON, translate, idsMap, parentId);\n    }\n\n    return {\n      idsMap,\n      startNode,\n      endNode,\n      middleNodes,\n    };\n  }\n\n  /**\n   * Create encapsulation node\n   * @param name\n   * @param nodes\n   * @returns\n   */\n  async createEncapsulateNode(\n    workflowId: string,\n    name: string,\n    nodes: WorkflowNodeEntity[],\n  ) {\n    const pos = this.getNodesMiddlePoint(nodes);\n    const type = StandardNodeType.SubWorkflow;\n    const nodeJSON = this.encapsulateGenerateService.generateSubWorkflowNode({\n      spaceId: this.encapsulateContext.spaceId,\n      workflowId,\n      name,\n      desc: name,\n    });\n    await this.beforeCreate(type, nodeJSON);\n    const subFlowNode = await this.workflowDocument.createWorkflowNodeByType(\n      type,\n      pos,\n      nodeJSON,\n      getNodesParentId(nodes),\n    );\n    return subFlowNode;\n  }\n\n  /**\n   * Create a new node with JSON\n   * @param json\n   * @returns\n   */\n  async createDecapsulateNode(\n    nodeJSON: WorkflowNodeJSON,\n    translate: IPoint,\n    idsMap?: Map<string, string>,\n    parentId?: string,\n  ) {\n    const json = this.getDecapsulateNodeJSON(nodeJSON, translate, idsMap);\n    await this.beforeCreate(json.type as StandardNodeType, json);\n    const newNode = await this.workflowDocument.createWorkflowNode(\n      json,\n      true,\n      parentId || 'root',\n    );\n    return newNode;\n  }\n\n  /**\n   * Unseal the layout and move all nodes outward by half their width and height\n   */\n  decapsulateLayout(sourceNode: WorkflowNodeEntity, nodes: WorkflowNodeJSON[]) {\n    const point = getNodePoint(sourceNode);\n    const { width, height } = this.getNodesRect(\n      nodes.filter(\n        n =>\n          ![StandardNodeType.Start, StandardNodeType.End].includes(\n            n.type as StandardNodeType,\n          ),\n      ),\n    );\n\n    const value: DragNodeOperationValue = {\n      ids: [],\n      value: [],\n      oldValue: [],\n    };\n\n    this.workflowDocument.getAllNodes().reduce((previousValue, node) => {\n      const nodePoint = getNodePoint(node);\n\n      if (nodePoint.x > point.x) {\n        nodePoint.x += width / 2;\n      }\n\n      if (nodePoint.y > point.y) {\n        nodePoint.y += height / 2;\n      }\n\n      if (nodePoint.x < point.x) {\n        nodePoint.x -= width / 2;\n      }\n\n      if (nodePoint.y < point.y) {\n        nodePoint.y -= height / 2;\n      }\n\n      const transformData = node.getData<TransformData>(TransformData);\n      previousValue.ids.push(node.id);\n      previousValue.value.push(nodePoint);\n      previousValue.oldValue.push({\n        x: transformData.position.x,\n        y: transformData.position.y,\n      });\n      return previousValue;\n    }, value);\n\n    this.historyService.pushOperation({\n      type: FreeOperationType.dragNodes,\n      value,\n    });\n  }\n\n  /**\n   * Get the unblocked node JSON.\n   * @param nodeJSON original node json\n   * @param translate distance\n   * @param idsMap ids\n   * @returns\n   */\n  private getDecapsulateNodeJSON(\n    nodeJSON: WorkflowNodeJSON,\n    translate: IPoint,\n    idsMap?: Map<string, string>,\n  ): WorkflowNodeJSON {\n    const id = this.workflowNodesService.createUniqID();\n\n    if (idsMap) {\n      idsMap.set(nodeJSON.id, id);\n    }\n\n    nodeJSON.id = id;\n    const title = get(nodeJSON, 'data.nodeMeta.title') || nodeJSON.type;\n    const uniqueTitle = this.workflowNodesService.createUniqTitle(title);\n    set(nodeJSON, 'data.nodeMeta.title', uniqueTitle);\n\n    if (!nodeJSON.meta) {\n      nodeJSON.meta = {};\n    }\n\n    nodeJSON.meta.position = this.getDecapsulatePosition(nodeJSON, translate);\n\n    if (nodeJSON.blocks) {\n      nodeJSON.blocks = nodeJSON.blocks.map(block =>\n        this.getDecapsulateNodeJSON(block, translate, idsMap),\n      );\n    }\n    return nodeJSON;\n  }\n\n  /**\n   * Get the unblocked node coordinates\n   * @param nodeJSON\n   * @param translate\n   * @returns\n   */\n  private getDecapsulatePosition(\n    nodeJSON: WorkflowNodeJSON,\n    translate: IPoint,\n  ) {\n    const position = nodeJSON.meta?.position || {\n      x: 0,\n      y: 0,\n    };\n    return {\n      x: position.x + translate.x,\n      y: position.y + translate.y,\n    };\n  }\n\n  /**\n   * Node grouping\n   * @param nodes\n   * @returns\n   */\n  private groupNodes(nodes: WorkflowNodeJSON[]) {\n    const middleNodes: WorkflowNodeJSON[] = [];\n    let startNode: WorkflowNodeJSON | undefined;\n    let endNode: WorkflowNodeJSON | undefined;\n    nodes.forEach(node => {\n      if (node.type === StandardNodeType.Start) {\n        startNode = node;\n      } else if (node.type === StandardNodeType.End) {\n        endNode = node;\n      } else {\n        middleNodes.push(node);\n      }\n    });\n\n    return {\n      startNode,\n      endNode,\n      middleNodes,\n    };\n  }\n\n  /**\n   * Get the combined width and height of multiple nodes\n   * @param nodes\n   * @returns\n   */\n  private getNodesRect(nodes: Array<WorkflowNodeEntity | WorkflowNodeJSON>) {\n    const x1 = Math.min(...nodes.map(node => getNodePoint(node).x));\n    const x2 = Math.max(...nodes.map(node => getNodePoint(node).x));\n    const y1 = Math.min(...nodes.map(node => getNodePoint(node).y));\n    const y2 = Math.max(...nodes.map(node => getNodePoint(node).y));\n\n    const width = x2 - x1;\n    const height = y2 - y1;\n\n    return {\n      width,\n      height,\n      x: x1,\n      y: y1,\n    };\n  }\n\n  getEncapsulateStartEndRects(nodes: WorkflowNodeEntity[]) {\n    const boundaryNodes = this.getBoundaryNodes(nodes);\n\n    if (!boundaryNodes.left || !boundaryNodes.right) {\n      throw new Error('boundaryNodes left or right node not found');\n    }\n\n    return {\n      start: this.getEncapsulateStartEndRect(\n        StandardNodeType.Start,\n        boundaryNodes.left,\n      ),\n      end: this.getEncapsulateStartEndRect(\n        StandardNodeType.End,\n        boundaryNodes.right,\n      ),\n    };\n  }\n\n  /**\n   * Delete Node\n   * @param node   */\n  async deleteNodes(nodes: WorkflowNodeEntity[]) {\n    nodes.forEach(node => {\n      node.dispose();\n    });\n    // Some nodes will delete the relevant connection and wait for its execution to complete.\n    await delay(10);\n  }\n\n  private async beforeCreate(\n    nodeType: string,\n    nodeJSON: Partial<WorkflowNodeJSON>,\n  ) {\n    if (!nodeType) {\n      return;\n    }\n\n    const nodeRegistry = this.workflowDocument.getNodeRegister(nodeType);\n\n    await nodeRegistry?.onInit?.(\n      nodeJSON as WorkflowNodeJSON,\n      this.playgroundContext,\n    );\n  }\n\n  private getEncapsulateStartEndRect(\n    type: StandardNodeType.Start | StandardNodeType.End,\n    boundaryNode: WorkflowNodeEntity,\n  ) {\n    const node = this.workflowDocument\n      .getAllNodes()\n      .find(item => item.flowNodeType === type);\n\n    if (!node) {\n      throw new Error('getEncapsulateStartEndPoint node not found');\n    }\n\n    const nodeReact = this.getNodeRect(node);\n    const boundaryNodeReact = this.getNodeRect(boundaryNode);\n\n    const translateX =\n      type === StandardNodeType.Start\n        ? -ENCAPSULATE_START_END_PAD - nodeReact.width\n        : ENCAPSULATE_START_END_PAD + boundaryNodeReact.width;\n    const translateY = (boundaryNodeReact.height - nodeReact.height) / 2;\n\n    return {\n      x: boundaryNodeReact.x + translateX,\n      y: boundaryNodeReact.y + translateY,\n      width: nodeReact.width,\n      height: nodeReact.height,\n    };\n  }\n\n  private getNodeRect(node: WorkflowNodeEntity) {\n    const transformData = node.getData<TransformData>(TransformData);\n    return {\n      x: transformData.bounds.left,\n      y: transformData.bounds.top,\n      width: transformData.bounds.width,\n      height: transformData.bounds.height,\n    };\n  }\n\n  private getBoundaryNodes(nodes: WorkflowNodeEntity[]) {\n    const boundaryNodes: {\n      left?: WorkflowNodeEntity;\n      right?: WorkflowNodeEntity;\n    } = {};\n\n    nodes.reduce((previousValue, node) => {\n      if (!previousValue.left) {\n        previousValue.left = node;\n      }\n\n      if (!previousValue.right) {\n        previousValue.right = node;\n      }\n\n      if (getNodePoint(node).x < getNodePoint(previousValue.left).x) {\n        previousValue.left = node;\n      }\n\n      if (getNodePoint(node).x > getNodePoint(previousValue.right).x) {\n        previousValue.right = node;\n      }\n\n      return previousValue;\n    }, boundaryNodes);\n\n    return boundaryNodes;\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const ENCAPSULATE_START_END_PAD = 60;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { injectable, inject } from 'inversify';\nimport { WorkflowMode } from '@coze-workflow/base/api';\nimport {\n  reporter,\n  StandardNodeType,\n  type WorkflowJSON,\n} from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { Toast } from '@coze-arch/coze-design';\nimport { HistoryService } from '@flowgram-adapter/free-layout-editor';\nimport {\n  WorkflowDocument,\n  type WorkflowNodeEntity,\n  WorkflowSelectService,\n} from '@flowgram-adapter/free-layout-editor';\nimport { delay, Emitter, logger } from '@flowgram-adapter/common';\n\nimport { EncapsulateValidateService } from '../validate';\nimport { isNodeInSubCanvas } from '../utils/subcanvas';\nimport { randomNameSuffix } from '../utils/random-name-suffix';\nimport { hasSubCanvasNodes } from '../utils/has-sub-canvas-nodes';\nimport { getSubWorkflowInfo } from '../utils';\nimport { EncapsulateGenerateService } from '../generate';\nimport { EncapsulateContext } from '../encapsulate-context';\nimport { EncapsulateApiService } from '../api';\nimport {\n  type EncapsulateErrorResult,\n  type EncapsulateResult,\n  type EncapsulateService,\n} from './types';\nimport { EncapsulateVariableService } from './encapsulate-variable-service';\nimport { EncapsulateNodesService } from './encapsulate-nodes-service';\nimport { EncapsulateLinesService } from './encapsulate-lines-service';\n\n@injectable()\nexport class EncapsulateServiceImpl implements EncapsulateService {\n  private onEncapsulateEmitter = new Emitter<EncapsulateResult>();\n\n  public readonly onEncapsulate = this.onEncapsulateEmitter.event;\n\n  @inject(EncapsulateValidateService)\n  private encapsulateValidateService: EncapsulateValidateService;\n\n  @inject(EncapsulateGenerateService)\n  private encapsulateGenerateService: EncapsulateGenerateService;\n\n  @inject(WorkflowSelectService)\n  private workflowSelectService: WorkflowSelectService;\n\n  @inject(EncapsulateNodesService)\n  private encapsulateNodesService: EncapsulateNodesService;\n\n  @inject(EncapsulateApiService)\n  private encapsulateApiService: EncapsulateApiService;\n\n  @inject(EncapsulateContext)\n  private encapsulateContext: EncapsulateContext;\n\n  @inject(EncapsulateLinesService)\n  private encapsulateLinesService: EncapsulateLinesService;\n\n  @inject(EncapsulateVariableService)\n  private encapsulateVariableService: EncapsulateVariableService;\n\n  @inject(HistoryService)\n  private historyService: HistoryService;\n\n  @inject(WorkflowDocument)\n  private workflowDocument: WorkflowDocument;\n\n  private encapsulating = false;\n  private decapsulating = false;\n\n  validate() {\n    const { selectedNodes } = this.workflowSelectService;\n    return this.encapsulateValidateService.validate(selectedNodes);\n  }\n\n  canEncapsulate(): boolean {\n    return this.encapsulateContext.enabled;\n  }\n\n  async encapsulate() {\n    if (!this.canEncapsulate()) {\n      return this.encapsulateError('encapsulate is not enabled');\n    }\n\n    if (this.encapsulating) {\n      return this.encapsulateError('encapsulating');\n    }\n\n    const name = `${\n      this.encapsulateContext.flowName || ''\n    }_sub_${randomNameSuffix()}`;\n    const { selectedNodes } = this.workflowSelectService;\n\n    if (selectedNodes.length < 2) {\n      return this.encapsulateError('at least 2 nodes');\n    }\n\n    reporter.event({ eventName: 'workflow_encapsulate' });\n\n    this.encapsulating = true;\n\n    let res;\n    try {\n      res = await this.encapsulateNodes(name, selectedNodes);\n      // Encapsulation complete Select the encapsulated node\n      if (res.success) {\n        this.workflowSelectService.selectNode(res.subFlowNode);\n      }\n\n      this.onEncapsulateEmitter.fire(res);\n    } finally {\n      this.encapsulating = false;\n    }\n    return res;\n  }\n\n  canDecapsulate(node: WorkflowNodeEntity) {\n    return (\n      this.encapsulateContext.enabled &&\n      node.flowNodeType === StandardNodeType.SubWorkflow\n    );\n  }\n\n  async decapsulate(node: WorkflowNodeEntity) {\n    if (!node || !this.canDecapsulate(node) || this.decapsulating) {\n      return;\n    }\n\n    reporter.event({ eventName: 'workflow_decapsulate' });\n    this.decapsulating = true;\n    try {\n      await this.decapsulateNode(node);\n    } finally {\n      this.decapsulating = false;\n    }\n  }\n\n  async decapsulateNode(node: WorkflowNodeEntity) {\n    const info = getSubWorkflowInfo(node);\n\n    if (!info) {\n      return;\n    }\n\n    // Get process data\n    const workflow = await this.encapsulateApiService.getWorkflow(\n      info.spaceId && info.spaceId !== '0'\n        ? info.spaceId\n        : this.encapsulateContext.spaceId,\n      info.workflowId,\n      info.workflowVersion,\n    );\n\n    if (!workflow) {\n      return;\n    }\n\n    if (workflow.nodes.length <= 2) {\n      return;\n    }\n\n    // If you unseal the nodes in the sub-canvas, you need to verify whether there is a sub-canvas.\n    if (\n      isNodeInSubCanvas(node) &&\n      hasSubCanvasNodes(this.workflowDocument, workflow.nodes)\n    ) {\n      Toast.warning(\n        I18n.t(\n          'workflow_encapsulate_toast_batch_or_loop',\n          undefined,\n          '/',\n        ),\n      );\n      return;\n    }\n\n    this.historyService.startTransaction();\n\n    // Node-centric expansion\n    this.encapsulateNodesService.decapsulateLayout(node, workflow.nodes);\n\n    // Create Node\n    const { idsMap, startNode, endNode, middleNodes } =\n      await this.encapsulateNodesService.createDecapsulateNodes(\n        node,\n        workflow.nodes,\n        node.parent?.id,\n      );\n\n    // Update variable reference after unblocking\n    this.encapsulateVariableService.updateVarsAfterDecapsulate(node, {\n      idsMap,\n      startNode,\n      endNode,\n      middleNodes,\n    });\n\n    // Create a connection\n    this.encapsulateLinesService.createDecapsulateLines({\n      node,\n      workflowJSON: workflow as WorkflowJSON,\n      startNodeId: startNode.id,\n      endNodeId: endNode.id,\n      idsMap,\n    });\n\n    await delay(30);\n\n    // Remove old node\n    await this.encapsulateNodesService.deleteNodes([node]);\n    this.historyService.endTransaction();\n  }\n\n  dispose() {\n    this.onEncapsulateEmitter.dispose();\n  }\n\n  private async encapsulateNodes(\n    name: string,\n    nodes: WorkflowNodeEntity[],\n  ): Promise<EncapsulateResult> {\n    const ports =\n      this.encapsulateLinesService.getValidEncapsulateConnectPorts(nodes);\n\n    const encapsulateVars =\n      this.encapsulateVariableService.getEncapsulateVars(nodes);\n\n    const startEndRects =\n      this.encapsulateNodesService.getEncapsulateStartEndRects(nodes);\n\n    // Generate JSON and update the variable references in JSON\n    const json = await this.encapsulateGenerateService.generateWorkflowJSON(\n      nodes,\n      {\n        startEndRects,\n      },\n    );\n\n    let workflowId;\n    let flowMode = WorkflowMode.Workflow;\n    if (\n      this.encapsulateContext.isChatFlow &&\n      encapsulateVars.startVars.USER_INPUT &&\n      encapsulateVars.startVars.CONVERSATION_NAME\n    ) {\n      flowMode = WorkflowMode.ChatFlow;\n    }\n\n    try {\n      // save process\n      const res = await this.encapsulateApiService.encapsulateWorkflow({\n        name,\n        desc: name,\n        json,\n        flowMode,\n      });\n      workflowId = res?.workflowId;\n    } catch (error) {\n      logger.error(error);\n      return this.encapsulateError('encapsulate workflow failed');\n    }\n\n    if (!workflowId) {\n      return this.encapsulateError(\n        'encapsulate workflow failed no workflowId returned',\n      );\n    }\n\n    this.historyService.startTransaction();\n    // Replace with calling process node\n    const subFlowNode =\n      await this.encapsulateNodesService.createEncapsulateNode(\n        workflowId,\n        name,\n        nodes,\n      );\n\n    // Update variable references (upstream and downstream + encapsulate node itself input)\n    this.encapsulateVariableService.updateVarsAfterEncapsulate(\n      subFlowNode,\n      nodes,\n      encapsulateVars,\n    );\n\n    // Remove old node\n    await this.encapsulateNodesService.deleteNodes(nodes);\n\n    // Create a new connection\n    const { inputLines, outputLines } =\n      this.encapsulateLinesService.createEncapsulateLines(ports, subFlowNode);\n    await delay(30);\n\n    this.historyService.endTransaction();\n    return {\n      success: true,\n      subFlowNode,\n      inputLines,\n      outputLines,\n      workflowId,\n      projectId: this.encapsulateContext.projectId,\n    };\n  }\n\n  private encapsulateError(message: string): EncapsulateErrorResult {\n    return {\n      success: false,\n      message,\n    };\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FlowNodeFormData } from '@flowgram-adapter/free-layout-editor';\nimport { type WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\n\ninterface SubWorkflowInfo {\n  spaceId: string;\n  workflowId: string;\n  workflowVersion: string;\n}\n\n/**\n * Get subprocess information\n * @param node child process node\n * @returns spaceId and workflowId\n */\nexport function getSubWorkflowInfo(\n  node: WorkflowNodeEntity,\n): SubWorkflowInfo | undefined {\n  const formData = node.getData<FlowNodeFormData>(FlowNodeFormData);\n  const formItem = formData?.formModel.getFormItemValueByPath('/inputs');\n\n  if (!formItem) {\n    return;\n  }\n\n  return {\n    spaceId: formItem.spaceId,\n    workflowId: formItem.workflowId,\n    workflowVersion: formItem.workflowVersion,\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type WorkflowPortEntity,\n  type WorkflowNodeEntity,\n  type WorkflowLineEntity,\n  type WorkflowNodeJSON,\n} from '@flowgram-adapter/free-layout-editor';\nimport { type Event } from '@flowgram-adapter/common';\nimport { type WorkflowVariable } from '@coze-workflow/variable';\n\nimport { type EncapsulateValidateResult } from '../validate';\n\n/**\n * Encapsulation result\n */\nexport type EncapsulateResult =\n  | EncapsulateErrorResult\n  | EncapsulateSuccessResult;\n\n/**\n * Wrong result\n */\nexport interface EncapsulateErrorResult {\n  /**\n   * state\n   */\n  success: false;\n  /**\n   * message prompt\n   */\n  message: string;\n}\n\n/**\n * successful outcome\n */\nexport interface EncapsulateSuccessResult {\n  /**\n   * state\n   */\n  success: true;\n  /**\n   * generated node\n   */\n  subFlowNode: WorkflowNodeEntity;\n  /**\n   * Generated input line\n   */\n  inputLines: WorkflowLineEntity[];\n  /**\n   * Generated output line\n   */\n  outputLines: WorkflowLineEntity[];\n  /**\n   * Generated workflow id\n   */\n  workflowId: string;\n  /**\n   * projectId\n   */\n  projectId?: string;\n}\n\n/**\n * Encapsulation/unsealing service\n */\nexport interface EncapsulateService {\n  /**\n   * Can it be encapsulated?\n   */\n  canEncapsulate: () => boolean;\n  /**\n   * package\n   */\n  encapsulate: () => Promise<EncapsulateResult>;\n  /**\n   * Whether to support unblocking\n   */\n  canDecapsulate: (node: WorkflowNodeEntity) => boolean;\n  /**\n   * unblock\n   */\n  decapsulate: (node: WorkflowNodeEntity) => Promise<void>;\n  /**\n   * validation\n   */\n  validate: () => Promise<EncapsulateValidateResult>;\n  /**\n   * Package successful callback\n   */\n  onEncapsulate: Event<EncapsulateResult>;\n  /**\n   * destroy\n   */\n  dispose: () => void;\n}\n\nexport const EncapsulateService = Symbol('EncapsulateService');\n\n/**\n * Encapsulation/unsealing management\n */\nexport interface EncapsulateManager {\n  /**\n   * initialization\n   */\n  init: () => void;\n  /**\n   * destroy\n   * @returns\n   */\n  dispose: () => void;\n}\n\nexport const EncapsulateManager = Symbol('EncapsulateManager');\n\n/**\n * connection port\n */\nexport interface ConnectPortsInfo {\n  inputLines: WorkflowLineEntity[];\n  outputLines: WorkflowLineEntity[];\n  fromPorts: WorkflowPortEntity[];\n  toPorts: WorkflowPortEntity[];\n}\n\nexport interface DecapsulateContext {\n  idsMap: Map<string, string>;\n  startNode?: WorkflowNodeJSON;\n  endNode?: WorkflowNodeJSON;\n  middleNodes: WorkflowNodeJSON[];\n}\n\nexport type VariableMap = Record<string, WorkflowVariable>;\n\nexport interface EncapsulateVars {\n  startVars: VariableMap;\n  endVars: VariableMap;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { injectable } from 'inversify';\nimport { DisposableCollection } from '@flowgram-adapter/common';\n\nimport { type EncapsulateManager } from './types';\n\n@injectable()\nexport class EncapsulateManagerImpl implements EncapsulateManager {\n  private toDispose: DisposableCollection = new DisposableCollection();\n\n  init() {\n    this.toDispose.pushAll([]);\n  }\n  dispose() {\n    this.toDispose.dispose();\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { uniqBy } from 'lodash-es';\nimport { injectable, inject } from 'inversify';\nimport { StandardNodeType } from '@coze-workflow/base/types';\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport {\n  type WorkflowNodeEntity,\n  WorkflowDocument,\n  type WorkflowJSON,\n  type WorkflowEdgeJSON,\n  type WorkflowNodeJSON,\n  type WorkflowNodeRegistry,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { getNodesParentId } from '../utils/get-nodes-parent-id';\nimport { setNodePositionByRect } from '../utils';\nimport { EncapsulateContext } from '../encapsulate-context';\nimport { EncapsulateLinesService } from '../encapsulate/encapsulate-lines-service';\nimport {\n  EncapsulateVariableService,\n  type ConnectPortsInfo,\n} from '../encapsulate';\nimport {\n  type EncapsulateGenerateService,\n  type GenerateSubWorkflowNodeOptions,\n} from './types';\n\n/**\n * Encapsulate the generation service and generate json data related to workflow\n */\n@injectable()\nexport class EncapsulateGenerateServiceImpl\n  implements EncapsulateGenerateService\n{\n  generate: (nodes: FlowNodeEntity[]) => Promise<WorkflowJSON>;\n  @inject(EncapsulateLinesService)\n  private encapsulateLinesService: EncapsulateLinesService;\n\n  @inject(EncapsulateVariableService)\n  private encapsulateVariableService: EncapsulateVariableService;\n\n  @inject(WorkflowDocument)\n  private workflowDocument: WorkflowDocument;\n\n  @inject(EncapsulateContext)\n  private encapsulateContext: EncapsulateContext;\n\n  /**\n   * Generate json for workflow\n   * @param nodes\n   * @param options\n   * @returns\n   */\n  async generateWorkflowJSON(\n    nodes: WorkflowNodeEntity[],\n    options,\n  ): Promise<WorkflowJSON> {\n    const ports =\n      this.encapsulateLinesService.getValidEncapsulateConnectPorts(nodes);\n    const json = await this.workflowDocument.toJSON();\n    const nodeIds = nodes.map(node => node.id);\n\n    // Step 1: Generate JSON\n    const defaultJSON = this.defaultJSON();\n    const startNode = defaultJSON.nodes.find(\n      node => node.type === StandardNodeType.Start,\n    );\n    const endNode = defaultJSON.nodes.find(\n      node => node.type === StandardNodeType.End,\n    );\n\n    if (!startNode || !endNode) {\n      throw new Error('start or end node not found');\n    }\n\n    // Step 2: Generate JSON for encapsulated nodes\n    const parentId = getNodesParentId(nodes);\n    const parentNodes =\n      parentId === 'root'\n        ? json.nodes\n        : this.findSubCanvasNodeJSON(json.nodes, parentId)?.blocks || [];\n    const encapsulateNodes = parentNodes.filter(node =>\n      nodeIds.includes(node.id),\n    );\n    const parentEdges =\n      parentId === 'root'\n        ? json.edges\n        : this.findSubCanvasNodeJSON(json.nodes, parentId)?.edges || [];\n    const encapsulateEdges = parentEdges.filter(\n      edge =>\n        nodeIds.includes(edge.sourceNodeID) &&\n        nodeIds.includes(edge.targetNodeID),\n    );\n\n    // Step 3: Connect the start end to the encapsulation node\n    const { startEdges, endEdges } = this.generateStartEndEdges(\n      startNode,\n      endNode,\n      ports,\n    );\n\n    // Step 4: Update the start end position\n    if (options?.startEndRects) {\n      setNodePositionByRect(startNode, options.startEndRects.start);\n      setNodePositionByRect(endNode, options.startEndRects.end);\n    }\n\n    let workflowJSON = {\n      nodes: [...defaultJSON.nodes, ...encapsulateNodes],\n      edges: [\n        ...defaultJSON.edges,\n        ...encapsulateEdges,\n        ...startEdges,\n        ...endEdges,\n      ],\n    };\n\n    // Step 5: Update variable reference relationships\n    const vars = this.encapsulateVariableService.getEncapsulateVars(nodes);\n    workflowJSON = this.encapsulateVariableService.updateVarsInEncapsulateJSON(\n      workflowJSON,\n      vars,\n    );\n    return workflowJSON;\n  }\n\n  /**\n   * Generate subprocess nodes\n   * @param param0\n   * @returns\n   */\n  generateSubWorkflowNode = ({\n    name,\n    desc,\n    workflowId,\n    spaceId,\n  }: GenerateSubWorkflowNodeOptions) => {\n    const nodeMeta = this.getTemplateNodeMeta(StandardNodeType.SubWorkflow);\n    return {\n      data: {\n        nodeMeta: {\n          title: name,\n          description: desc,\n          icon: nodeMeta.icon,\n          isImageflow: false,\n        },\n        inputs: {\n          workflowId,\n          spaceId,\n          workflowVersion: this.encapsulateContext.projectId ? '' : 'v0.0.1',\n        },\n      },\n    };\n  };\n\n  /**\n   * Generate start end edge\n   * @param startNode\n   * @param endNode\n   * @param ports\n   * @returns\n   */\n  private generateStartEndEdges(\n    startNode: WorkflowNodeJSON,\n    endNode: WorkflowNodeJSON,\n    ports: ConnectPortsInfo,\n  ) {\n    const startEdges: WorkflowEdgeJSON[] = uniqBy(\n      ports.inputLines.map(line => {\n        const edge = line.toJSON();\n        edge.sourceNodeID = startNode.id;\n        delete edge.sourcePortID;\n        return edge;\n      }),\n      this.getCompareEdgeId,\n    );\n\n    const endEdges: WorkflowEdgeJSON[] = uniqBy(\n      ports.outputLines.map(line => {\n        const edge = line.toJSON();\n        edge.targetNodeID = endNode.id;\n        delete edge.targetPortID;\n        return edge;\n      }),\n      this.getCompareEdgeId,\n    );\n\n    return {\n      startEdges,\n      endEdges,\n    };\n  }\n\n  private getCompareEdgeId(edge) {\n    return `${edge.sourceNodeID || ''}:${edge.sourcePortID || ''}-${\n      edge.targetNodeID || ''\n    }:${edge.targetPortID || ''}`;\n  }\n\n  /**\n   * Default workflow json\n   */\n  private defaultJSON() {\n    return {\n      nodes: [this.generateStartNode(), this.generateEndNode()],\n      edges: [],\n      versions: { loop: 'v2' },\n    };\n  }\n\n  /**\n   * Generate start node\n   */\n  private generateStartNode() {\n    return {\n      id: '100001',\n      type: StandardNodeType.Start,\n      meta: {\n        position: { x: 0, y: 0 },\n      },\n      data: {\n        nodeMeta: this.getTemplateNodeMeta(StandardNodeType.Start),\n        outputs: [],\n      },\n    };\n  }\n\n  /**\n   * end node generation\n   */\n  private generateEndNode() {\n    return {\n      id: '900001',\n      type: StandardNodeType.End,\n      meta: {\n        position: { x: 1000, y: 0 },\n      },\n      data: {\n        nodeMeta: this.getTemplateNodeMeta(StandardNodeType.End),\n        inputs: { terminatePlan: 'returnVariables', inputParameters: [] },\n      },\n    };\n  }\n\n  /**\n   * Get the node's metadata\n   */\n  private getTemplateNodeMeta(type: StandardNodeType) {\n    const template = this.encapsulateContext.getNodeTemplate(type);\n    return template\n      ? {\n          title: template.title,\n          subTitle: template.subTitle,\n          description: template.description,\n          icon: template.icon,\n        }\n      : {};\n  }\n\n  /**\n   * Find the json corresponding to the child workflow\n   * @param nodeJSONs\n   * @param parentId\n   * @returns\n   */\n  private findSubCanvasNodeJSON(\n    nodeJSONs: WorkflowNodeJSON[],\n    parentId: string,\n  ) {\n    const subCanvasNode = this.findSubCanvasSourceNode(parentId);\n    return nodeJSONs.find(nodeJSON => nodeJSON.id === subCanvasNode?.id);\n  }\n\n  /**\n   * Find the node corresponding to the child canvas\n   * @param subCanvasId\n   * @returns\n   */\n  private findSubCanvasSourceNode(subCanvasId: string) {\n    const nodes = this.workflowDocument.getAllNodes();\n    return nodes.find(node => {\n      const registry = node.getNodeRegistry() as WorkflowNodeRegistry;\n      const subCanvas = registry?.meta?.subCanvas;\n\n      return subCanvas?.(node)?.canvasNode?.id === subCanvasId;\n    });\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { inject, injectable } from 'inversify';\nimport { type StandardNodeType } from '@coze-workflow/base/types';\nimport {\n  type WorkflowJSON,\n  type WorkflowNodeEntity,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { excludeStartEnd } from '../utils/exclude-start-end';\nimport { EncapsulateGenerateService } from '../generate';\nimport {\n  EncapsulateValidateManager,\n  type EncapsulateValidateService,\n  type EncapsulateValidateResult,\n  EncapsulateValidateResultFactory,\n} from './types';\n\n@injectable()\nexport class EncapsulateValidateServiceImpl\n  implements EncapsulateValidateService\n{\n  @inject(EncapsulateValidateManager)\n  private encapsulateValidateManager: EncapsulateValidateManager;\n\n  @inject(EncapsulateValidateResultFactory)\n  private encapsulateValidateResultFactory: EncapsulateValidateResultFactory;\n\n  @inject(EncapsulateGenerateService)\n  private encapsulateGenerateService: EncapsulateGenerateService;\n\n  async validate(nodes: WorkflowNodeEntity[]) {\n    const validateResult: EncapsulateValidateResult =\n      this.encapsulateValidateResultFactory();\n    this.validateNodes(nodes, validateResult);\n\n    for (const node of nodes) {\n      await this.validateNode(node, validateResult);\n    }\n\n    if (validateResult.hasError()) {\n      return validateResult;\n    }\n\n    const workflowJSON =\n      await this.encapsulateGenerateService.generateWorkflowJSON(\n        excludeStartEnd(nodes),\n      );\n\n    await this.validateWorkflowJSON(workflowJSON, validateResult);\n    return validateResult;\n  }\n\n  private async validateWorkflowJSON(\n    workflowJSON: WorkflowJSON,\n    validateResult: EncapsulateValidateResult,\n  ) {\n    const workflowJSONValidators =\n      this.encapsulateValidateManager.getWorkflowJSONValidators();\n\n    await Promise.all(\n      workflowJSONValidators.map(workflowJSONValidator =>\n        workflowJSONValidator.validate(workflowJSON, validateResult),\n      ),\n    );\n  }\n\n  private validateNodes(\n    nodes: WorkflowNodeEntity[],\n    validateResult: EncapsulateValidateResult,\n  ) {\n    const nodesValidators =\n      this.encapsulateValidateManager.getNodesValidators();\n\n    for (const nodesValidator of nodesValidators) {\n      // If the node validator needs to include a start node and an end node, it is directly validated\n      // Otherwise, the start and end nodes need to be excluded.\n      nodesValidator.validate(\n        nodesValidator.includeStartEnd ? nodes : excludeStartEnd(nodes),\n        validateResult,\n      );\n    }\n  }\n\n  private async validateNode(\n    node: WorkflowNodeEntity,\n    validateResult: EncapsulateValidateResult,\n  ) {\n    const nodeValidators =\n      this.encapsulateValidateManager.getNodeValidatorsByType(\n        node.flowNodeType as StandardNodeType,\n      );\n\n    for (const nodeValidator of nodeValidators) {\n      await nodeValidator.validate(node, validateResult);\n    }\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { injectable } from 'inversify';\n\nimport {\n  type EncapsulateValidateResult,\n  type EncapsulateValidateErrorCode,\n  type EncapsulateValidateError,\n} from './types';\n\n@injectable()\nexport class EncapsulateValidateResultImpl\n  implements EncapsulateValidateResult\n{\n  private errors: Map<string, EncapsulateValidateError[]> = new Map();\n  addError(error: EncapsulateValidateError) {\n    if (!this.errors.has(error.code)) {\n      this.errors.set(error.code, []);\n    }\n    const errors = this.errors.get(error.code);\n    if (errors && !errors.some(item => item.source === error.source)) {\n      errors.push(error);\n    }\n  }\n\n  getErrors() {\n    return [...this.errors.values()].flat();\n  }\n\n  hasError() {\n    return this.errors.size > 0;\n  }\n\n  hasErrorCode(code: EncapsulateValidateErrorCode) {\n    return this.errors.has(code);\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ContainerModule } from 'inversify';\n\nimport {\n  EncapsulateValidateService,\n  EncapsulateValidateServiceImpl,\n  EncapsulateValidateManager,\n  EncapsulateValidateManagerImpl,\n  EncapsulateValidateResult,\n  EncapsulateValidateResultImpl,\n  EncapsulateValidateResultFactory,\n} from './validate';\nimport {\n  EncapsulateGenerateService,\n  EncapsulateGenerateServiceImpl,\n} from './generate';\nimport { EncapsulateContext } from './encapsulate-context';\nimport {\n  EncapsulateNodesService,\n  EncapsulateService,\n  EncapsulateServiceImpl,\n  EncapsulateManager,\n  EncapsulateManagerImpl,\n  EncapsulateLinesService,\n  EncapsulateVariableService,\n} from './encapsulate';\nimport { EncapsulateApiService, EncapsulateApiServiceImpl } from './api';\n\nexport const WorkflowEncapsulateContainerModule = new ContainerModule(bind => {\n  // encapsulate\n  bind(EncapsulateService).to(EncapsulateServiceImpl).inSingletonScope();\n  bind(EncapsulateManager).to(EncapsulateManagerImpl).inSingletonScope();\n  bind(EncapsulateNodesService).toSelf().inSingletonScope();\n  bind(EncapsulateLinesService).toSelf().inSingletonScope();\n  bind(EncapsulateVariableService).toSelf().inSingletonScope();\n\n  // validate\n  bind(EncapsulateValidateService)\n    .to(EncapsulateValidateServiceImpl)\n    .inSingletonScope();\n  bind(EncapsulateValidateManager)\n    .to(EncapsulateValidateManagerImpl)\n    .inSingletonScope();\n\n  bind(EncapsulateValidateResult)\n    .to(EncapsulateValidateResultImpl)\n    .inTransientScope();\n  bind(EncapsulateValidateResultFactory).toFactory<EncapsulateValidateResult>(\n    context => () =>\n      context.container.get<EncapsulateValidateResult>(\n        EncapsulateValidateResult,\n      ),\n  );\n\n  // generate\n  bind(EncapsulateGenerateService)\n    .to(EncapsulateGenerateServiceImpl)\n    .inSingletonScope();\n\n  // save\n  bind(EncapsulateApiService).to(EncapsulateApiServiceImpl).inSingletonScope();\n\n  // context\n  bind(EncapsulateContext).toSelf().inSingletonScope();\n});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { inject, injectable } from 'inversify';\nimport { WorkflowNode } from '@coze-workflow/base';\nimport {\n  WorkflowDocument,\n  type WorkflowNodeEntity,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { getSubCanvasParent, isSubCanvasNode } from '../utils/subcanvas';\n@injectable()\nexport class EncapsulateBaseValidator {\n  @inject(WorkflowDocument)\n  protected workflowDocument: WorkflowDocument;\n\n  protected getLineName(from: string, to: string) {\n    return `${this.getNodeNameById(from)} -> ${this.getNodeNameById(to)}`;\n  }\n\n  protected getLineSource(from: string, to: string) {\n    return `${from}_${to}`;\n  }\n\n  protected getNodeName(node: WorkflowNodeEntity) {\n    if (!node) {\n      return;\n    }\n\n    if (isSubCanvasNode(node)) {\n      return this.getSubCanvasName(node);\n    }\n    const workflowNode = new WorkflowNode(node);\n    return workflowNode.title || this.defaultNodeName(node.id);\n  }\n\n  protected getSubCanvasName(node: WorkflowNodeEntity) {\n    const nodeMeta = node.getNodeMeta();\n    const { title = '' } = nodeMeta?.renderSubCanvas?.() ?? {};\n    return title || this.defaultNodeName(node.id);\n  }\n\n  protected getSubCanvasIcon(node: WorkflowNodeEntity) {\n    const parent = getSubCanvasParent(node);\n    return this.getNodeIcon(parent);\n  }\n\n  protected getNodeIcon(node: WorkflowNodeEntity) {\n    if (!node) {\n      return;\n    }\n\n    if (isSubCanvasNode(node)) {\n      return this.getSubCanvasIcon(node);\n    }\n    const workflowNode = new WorkflowNode(node);\n    return workflowNode.icon;\n  }\n\n  protected getNodeNameById(id: string) {\n    const node = this.workflowDocument.getNode(id);\n\n    if (!node) {\n      return this.defaultNodeName(id);\n    }\n\n    return this.getNodeName(node);\n  }\n\n  protected defaultNodeName(id: string) {\n    return `Node${id}`;\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { injectable } from 'inversify';\nimport { I18n } from '@coze-arch/i18n';\nimport { type WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport { getSubCanvasParent, isSubCanvasNode } from '@/utils/subcanvas';\n\nimport {\n  type EncapsulateNodesValidator,\n  EncapsulateValidateErrorCode,\n  type EncapsulateValidateResult,\n} from '../validate';\nimport { EncapsulateBaseValidator } from './encapsulate-base-validator';\n\n@injectable()\nexport class SubCanvasValidator\n  extends EncapsulateBaseValidator\n  implements EncapsulateNodesValidator\n{\n  validate(nodes: WorkflowNodeEntity[], result: EncapsulateValidateResult) {\n    nodes\n      .filter(node => isSubCanvasNode(node))\n      .forEach(subCanvasNode => {\n        const parent = getSubCanvasParent(subCanvasNode);\n        if (!parent) {\n          return;\n        }\n\n        const sourceName = this.getNodeName(subCanvasNode);\n        const sourceIcon = this.getNodeIcon(subCanvasNode);\n        if (!nodes.includes(parent)) {\n          result.addError({\n            code: EncapsulateValidateErrorCode.INVALID_SUB_CANVAS,\n            message: I18n.t('workflow_encapsulate_button_unable_loop_or_batch'),\n            source: subCanvasNode.id,\n            sourceName,\n            sourceIcon,\n          });\n        }\n      });\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { injectable } from 'inversify';\nimport { StandardNodeType } from '@coze-workflow/base/types';\nimport { I18n } from '@coze-arch/i18n';\n\nimport {\n  EncapsulateValidateErrorCode,\n  type EncapsulateNodesValidator,\n} from '../validate';\n\n@injectable()\nexport class StartEndValidator implements EncapsulateNodesValidator {\n  validate(nodes, result) {\n    const filtered = nodes.filter(node =>\n      [StandardNodeType.Start, StandardNodeType.End].includes(\n        node.flowNodeType,\n      ),\n    );\n\n    if (filtered.length) {\n      result.addError({\n        code: EncapsulateValidateErrorCode.NO_START_END,\n        message: I18n.t(\n          'workflow_encapsulate_button_unable_start_or_end',\n          undefined,\n          '/',\n        ),\n      });\n    }\n  }\n\n  includeStartEnd = true;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { injectable } from 'inversify';\nimport { StandardNodeType } from '@coze-workflow/base/types';\nimport { I18n } from '@coze-arch/i18n';\n\nimport {\n  EncapsulateValidateErrorCode,\n  type EncapsulateNodesValidator,\n} from '../validate';\n\n@injectable()\nexport class LoopNodesValidator implements EncapsulateNodesValidator {\n  validate(nodes, result) {\n    const filtered = nodes.filter(node =>\n      [StandardNodeType.Break, StandardNodeType.Continue].includes(\n        node.flowNodeType,\n      ),\n    );\n\n    if (filtered.length) {\n      result.addError({\n        code: EncapsulateValidateErrorCode.INVALID_LOOP_NODES,\n        message: I18n.t(\n          'workflow_encapsulate_button_unable_continue_or_teiminate',\n          undefined,\n          '/',\n        ),\n      });\n    }\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { inject, injectable } from 'inversify';\nimport { type WorkflowJSON } from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  EncapsulateValidateErrorCode,\n  type EncapsulateValidateError,\n  type EncapsulateValidateResult,\n  type EncapsulateWorkflowJSONValidator,\n} from '../validate';\nimport { EncapsulateApiService } from '../api';\nimport { EncapsulateBaseValidator } from './encapsulate-base-validator';\n\n@injectable()\nexport class EncapsulateSchemaValidator\n  extends EncapsulateBaseValidator\n  implements EncapsulateWorkflowJSONValidator\n{\n  @inject(EncapsulateApiService)\n  private encapsulateApiService: EncapsulateApiService;\n\n  async validate(workflow: WorkflowJSON, result: EncapsulateValidateResult) {\n    const validateResult = await this.encapsulateApiService.validateWorkflow(\n      workflow,\n    );\n\n    if (!validateResult?.length) {\n      return;\n    }\n\n    const errors = validateResult || [];\n\n    errors.forEach(error => {\n      const nodeId = error.node_error?.node_id || error.path_error?.start || '';\n      const node = this.workflowDocument.getNode(nodeId);\n      let sourceName: EncapsulateValidateError['sourceName'] = undefined;\n      let sourceIcon: EncapsulateValidateError['sourceIcon'] = undefined;\n      let source: EncapsulateValidateError['source'] = undefined;\n\n      if (node) {\n        sourceName = this.getNodeName(node);\n        sourceIcon = this.getNodeIcon(node);\n        source = node.id;\n      }\n\n      result.addError({\n        code: EncapsulateValidateErrorCode.INVALID_SCHEMA,\n        message: error.message || '',\n        source,\n        sourceName,\n        sourceIcon,\n      });\n    });\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { injectable } from 'inversify';\nimport { StandardNodeType } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { FlowNodeBaseType } from '@flowgram-adapter/free-layout-editor';\nimport {\n  type WorkflowNodeEntity,\n  WorkflowNodePortsData,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  EncapsulateValidateErrorCode,\n  type EncapsulateNodesValidator,\n} from '../validate';\nimport { getNodesWithSubCanvas } from '../utils/get-nodes-with-sub-canvas';\nimport { EncapsulateBaseValidator } from './encapsulate-base-validator';\n\n@injectable()\nexport class EncapsulatePortsValidator\n  extends EncapsulateBaseValidator\n  implements EncapsulateNodesValidator\n{\n  validate(nodes: WorkflowNodeEntity[], result) {\n    getNodesWithSubCanvas(nodes).forEach(node => {\n      const ignoreNodes = [\n        StandardNodeType.Comment,\n        FlowNodeBaseType.SUB_CANVAS,\n      ];\n      if (ignoreNodes.includes(node.flowNodeType as StandardNodeType)) {\n        return;\n      }\n\n      const portsData = node.getData<WorkflowNodePortsData>(\n        WorkflowNodePortsData,\n      );\n\n      const hasNotConnectPort = portsData.allPorts.some(\n        port => port.lines.length === 0,\n      );\n      if (hasNotConnectPort) {\n        const sourceName = this.getNodeName(node);\n        const sourceIcon = this.getNodeIcon(node);\n\n        result.addError({\n          code: EncapsulateValidateErrorCode.INVALID_PORTS,\n          message: I18n.t(\n            'workflow_encapsulate_button_unable_uncomplete',\n            undefined,\n            '',\n          ),\n          source: node.id,\n          sourceName,\n          sourceIcon,\n        });\n      }\n    });\n  }\n  includeStartEnd: true;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { inject, injectable } from 'inversify';\nimport { I18n } from '@coze-arch/i18n';\n\nimport {\n  EncapsulateValidateErrorCode,\n  type EncapsulateNodesValidator,\n} from '../validate';\nimport { EncapsulateLinesService } from '../encapsulate';\n\n@injectable()\nexport class EncapsulateOutputLinesValidator\n  implements EncapsulateNodesValidator\n{\n  @inject(EncapsulateLinesService)\n  private encapsulateLinesService: EncapsulateLinesService;\n\n  validate(nodes, result) {\n    const outputLines =\n      this.encapsulateLinesService.getEncapsulateNodesOutputLines(nodes);\n\n    if (outputLines.length === 0) {\n      return;\n    }\n\n    const valid =\n      this.encapsulateLinesService.validateEncapsulateLines(outputLines);\n\n    if (!valid) {\n      result.addError({\n        code: EncapsulateValidateErrorCode.ENCAPSULATE_LINES,\n        message: I18n.t(\n          'workflow_encapsulate_button_unable_connected',\n          undefined,\n          '',\n        ),\n      });\n    }\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { inject, injectable } from 'inversify';\nimport { I18n } from '@coze-arch/i18n';\n\nimport {\n  EncapsulateValidateErrorCode,\n  type EncapsulateNodesValidator,\n} from '../validate';\nimport { EncapsulateLinesService } from '../encapsulate';\n\n@injectable()\nexport class EncapsulateInputLinesValidator\n  implements EncapsulateNodesValidator\n{\n  @inject(EncapsulateLinesService)\n  private encapsulateLinesService: EncapsulateLinesService;\n\n  validate(nodes, result) {\n    const inputLines =\n      this.encapsulateLinesService.getEncapsulateNodesInputLines(nodes);\n\n    if (inputLines.length === 0) {\n      return;\n    }\n    const valid =\n      this.encapsulateLinesService.validateEncapsulateLines(inputLines);\n\n    if (!valid) {\n      result.addError({\n        code: EncapsulateValidateErrorCode.ENCAPSULATE_LINES,\n        message: I18n.t(\n          'workflow_encapsulate_button_unable_connected',\n          undefined,\n          '',\n        ),\n      });\n    }\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { inject, injectable } from 'inversify';\nimport { ValidationService } from '@coze-workflow/base/services';\nimport { StandardNodeType } from '@coze-workflow/base';\nimport { type WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  type EncapsulateNodeValidator,\n  EncapsulateValidateErrorCode,\n  type EncapsulateValidateResult,\n} from '../validate';\nimport { EncapsulateBaseValidator } from './encapsulate-base-validator';\n\n@injectable()\nexport class EncapsulateFormValidator\n  extends EncapsulateBaseValidator\n  implements EncapsulateNodeValidator\n{\n  @inject(ValidationService)\n  private validationService: ValidationService;\n\n  canHandle(_type: string) {\n    return true;\n  }\n\n  async validate(node: WorkflowNodeEntity, result: EncapsulateValidateResult) {\n    // Note nodes do not require validation\n    if (\n      [StandardNodeType.Comment].includes(node.flowNodeType as StandardNodeType)\n    ) {\n      return;\n    }\n\n    const res = await this.validationService.validateNode(node);\n\n    if (!res.hasError) {\n      return;\n    }\n\n    const sourceName = this.getNodeName(node);\n    const sourceIcon = this.getNodeIcon(node);\n    const errors = res.nodeErrorMap[node.id] || [];\n\n    errors.forEach(error => {\n      if (!error.errorInfo || error.errorLevel !== 'error') {\n        return;\n      }\n\n      result.addError({\n        code: EncapsulateValidateErrorCode.INVALID_FORM,\n        message: error.errorInfo,\n        source: node.id,\n        sourceName,\n        sourceIcon,\n      });\n    });\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ContainerModule } from 'inversify';\nimport { bindContributions } from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  EncapsulateNodesValidator,\n  EncapsulateWorkflowJSONValidator,\n  EncapsulateNodeValidator,\n} from '../validate';\nimport { SubCanvasValidator } from './sub-canvas-validator';\nimport { StartEndValidator } from './start-end-validator';\nimport { LoopNodesValidator } from './loop-nodes-validator';\nimport { EncapsulateSchemaValidator } from './encapsulate-schema-validator';\nimport { EncapsulatePortsValidator } from './encapsulate-ports-validator';\nimport { EncapsulateOutputLinesValidator } from './encapsulate-output-lines-validator';\nimport { EncapsulateInputLinesValidator } from './encapsulate-input-lines-validator';\nimport { EncapsulateFormValidator } from './encapsulate-form-validator';\n\nexport const EncapsulateValidatorsContainerModule = new ContainerModule(\n  bind => {\n    // json validators\n    bindContributions(bind, EncapsulateSchemaValidator, [\n      EncapsulateWorkflowJSONValidator,\n    ]);\n    // nodes validators\n    [\n      EncapsulatePortsValidator,\n      EncapsulateInputLinesValidator,\n      EncapsulateOutputLinesValidator,\n      StartEndValidator,\n      LoopNodesValidator,\n      SubCanvasValidator,\n    ].forEach(Validator => {\n      bindContributions(bind, Validator, [EncapsulateNodesValidator]);\n    });\n    // node validator\n    [EncapsulateFormValidator].forEach(Validator => {\n      bindContributions(bind, Validator, [EncapsulateNodeValidator]);\n    });\n  },\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { injectable } from 'inversify';\nimport { Emitter } from '@flowgram-adapter/common';\n\n@injectable()\nexport class EncapsulateRenderService {\n  private isModalVisible = false;\n  private onModalVisibleChangeEmitter = new Emitter<boolean>();\n  readonly onModalVisibleChange = this.onModalVisibleChangeEmitter.event;\n\n  private isTooltipVisible = false;\n  private onTooltipVisibleChangeEmitter = new Emitter<boolean>();\n  readonly onTooltipVisibleChange = this.onTooltipVisibleChangeEmitter.event;\n\n  private isLoading = false;\n  private onLoadingChangeEmitter = new Emitter<boolean>();\n  readonly onLoadingChange = this.onLoadingChangeEmitter.event;\n\n  get modalVisible() {\n    return this.isModalVisible;\n  }\n\n  get tooltipVisible() {\n    return this.isTooltipVisible;\n  }\n\n  get loading() {\n    return this.isLoading;\n  }\n\n  setLoading(value: boolean) {\n    this.isLoading = value;\n    this.onLoadingChangeEmitter.fire(value);\n  }\n\n  openModal() {\n    this.setModalVisible(true);\n  }\n\n  closeModal() {\n    this.setModalVisible(false);\n  }\n\n  showTooltip() {\n    this.setTooltipVisible(true);\n  }\n\n  hideTooltip() {\n    this.setTooltipVisible(false);\n  }\n\n  setTooltipVisible(value: boolean) {\n    this.isTooltipVisible = value;\n    this.onTooltipVisibleChangeEmitter.fire(value);\n  }\n\n  private setModalVisible(value: boolean) {\n    this.isModalVisible = value;\n    this.onModalVisibleChangeEmitter.fire(value);\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { inject, injectable } from 'inversify';\nimport { PlaygroundConfigEntity } from '@flowgram-adapter/free-layout-editor';\nimport {\n  type WorkflowNodeEntity,\n  WorkflowSelectService,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  type WorkflowShortcutsContribution,\n  type WorkflowShortcutsRegistry,\n} from '@coze-workflow/render';\n\nimport { EncapsulateService } from '../encapsulate';\nimport { EncapsulateCommands } from './types';\nimport { EncapsulateRenderService } from './encapsulate-render-service';\n\n/**\n * Package shortcut\n */\n@injectable()\nexport class EncapsulateShortcutsContribution\n  implements WorkflowShortcutsContribution\n{\n  @inject(PlaygroundConfigEntity)\n  private playgroundConfigEntity: PlaygroundConfigEntity;\n\n  @inject(EncapsulateService)\n  private encapsulateService: EncapsulateService;\n\n  @inject(EncapsulateRenderService)\n  private encapsulateRenderService: EncapsulateRenderService;\n\n  @inject(WorkflowSelectService)\n  private workflowSelectService: WorkflowSelectService;\n\n  registerShortcuts(registry: WorkflowShortcutsRegistry): void {\n    registry.addHandlers(\n      /**\n       * package\n       */\n      {\n        commandId: EncapsulateCommands.ENCAPSULATE,\n        shortcuts: ['meta g', 'ctrl g'],\n\n        isEnabled: () => !this.playgroundConfigEntity.readonly,\n\n        execute: async () => {\n          if (!this.encapsulateService.canEncapsulate()) {\n            return;\n          }\n\n          const res = await this.encapsulateService.validate();\n\n          if (res.hasError()) {\n            this.encapsulateRenderService.showTooltip();\n            return;\n          }\n\n          this.encapsulateRenderService.setLoading(true);\n          try {\n            await this.encapsulateService.encapsulate();\n            this.encapsulateRenderService.closeModal();\n          } catch (e) {\n            console.error(e);\n          }\n          this.encapsulateRenderService.setLoading(false);\n        },\n      },\n      /**\n       * unblock\n       */\n      {\n        commandId: EncapsulateCommands.DECAPSULATE,\n        shortcuts: ['meta shift g', 'ctrl shift g'],\n        isEnabled: () => !this.playgroundConfigEntity.readonly,\n        execute: () => {\n          const { selectedNodes } = this.workflowSelectService;\n          if (selectedNodes.length !== 1) {\n            return;\n          }\n\n          const node = selectedNodes[0] as WorkflowNodeEntity;\n          if (!this.encapsulateService.canDecapsulate(node)) {\n            return;\n          }\n          this.encapsulateService.decapsulate(node);\n        },\n      },\n    );\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ContainerModule } from 'inversify';\nimport { bindContributions } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowShortcutsContribution } from '@coze-workflow/render';\n\nimport { EncapsulateShortcutsContribution } from './encapsulate-shortcuts-contribution';\nimport { EncapsulateRenderService } from './encapsulate-render-service';\n\nexport const EncapsulateRenderContainerModule = new ContainerModule(bind => {\n  bindContributions(bind, EncapsulateShortcutsContribution, [\n    WorkflowShortcutsContribution,\n  ]);\n  bind(EncapsulateRenderService).toSelf().inSingletonScope();\n});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useState } from 'react';\n\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowSelectService } from '@flowgram-adapter/free-layout-editor';\n\n/**\n * selected node\n */\nexport function useSelectedNodes() {\n  const selectService = useService<WorkflowSelectService>(\n    WorkflowSelectService,\n  );\n\n  const [selectedNodes, setSelectedNodes] = useState(\n    selectService.selectedNodes,\n  );\n\n  useEffect(() => {\n    const disposable = selectService.onSelectionChanged(() => {\n      setSelectedNodes(selectService.selectedNodes);\n    });\n\n    return () => {\n      disposable.dispose();\n    };\n  });\n\n  return {\n    selectedNodes,\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useState } from 'react';\n\nimport { FlowNodeVariableData } from '@coze-workflow/variable';\n\nexport const useVariableChange = nodes => {\n  const [version, setVersion] = useState(0);\n\n  useEffect(() => {\n    const disposables = nodes\n      .filter(node => node.getData(FlowNodeVariableData)?.public?.available)\n      .map(node =>\n        node.getData(FlowNodeVariableData).public.available.onDataChange(() => {\n          setVersion(version + 1);\n        }),\n      );\n    return () => {\n      disposables.forEach(disposable => disposable?.dispose());\n    };\n  }, [nodes, version]);\n\n  return {\n    version,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useState } from 'react';\n\nimport { useService } from '@flowgram-adapter/free-layout-editor';\n\nimport { EncapsulateRenderService } from '../encapsulate-render-service';\nimport { EncapsulateService } from '../../encapsulate';\n\nexport const useEncapsulate = () => {\n  const encapsulateService = useService<EncapsulateService>(EncapsulateService);\n  const encapsulateRenderService = useService<EncapsulateRenderService>(\n    EncapsulateRenderService,\n  );\n  const [loading, setLoading] = useState(encapsulateRenderService.loading);\n\n  useEffect(() => {\n    const disposable = encapsulateRenderService.onLoadingChange(setLoading);\n    return () => {\n      disposable.dispose();\n    };\n  }, []);\n\n  const handleEncapsulate = async () => {\n    encapsulateRenderService.setLoading(true);\n    try {\n      await encapsulateService.encapsulate();\n      encapsulateRenderService.closeModal();\n    } catch (e) {\n      console.error(e);\n    }\n    encapsulateRenderService.setLoading(false);\n  };\n\n  return {\n    handleEncapsulate,\n    loading,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport classNames from 'classnames';\nimport { Typography } from '@coze-arch/coze-design';\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport {\n  usePlayground,\n  useService,\n  WorkflowSelectService,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { type EncapsulateValidateError } from '../../validate';\n\nimport styles from './index.module.less';\n\ninterface Props {\n  error: EncapsulateValidateError;\n}\n\nexport const ErrorTitle: FC<Props> = ({ error }) => {\n  const selectServices = useService<WorkflowSelectService>(\n    WorkflowSelectService,\n  );\n\n  const playground = usePlayground();\n\n  if (!error?.sourceName && !error.sourceIcon) {\n    return <div></div>;\n  }\n\n  const scrollToNode = async (nodeId: string) => {\n    let success = false;\n    const node = playground.entityManager.getEntityById<FlowNodeEntity>(nodeId);\n\n    if (node) {\n      await selectServices.selectNodeAndScrollToView(node, true);\n      success = true;\n    }\n    return success;\n  };\n\n  return (\n    <div\n      className=\"flex items-center gap-1 cursor-pointer max-w-[120px]\"\n      onClick={() => {\n        if (error.source) {\n          scrollToNode(error.source);\n        }\n      }}\n    >\n      {error.sourceIcon ? (\n        <img\n          width={18}\n          height={18}\n          src={error.sourceIcon}\n          className=\"w-4.5 h-4.5 rounded-[4px]\"\n        />\n      ) : null}\n      {error.sourceName ? (\n        <Typography.Paragraph\n          className={classNames(\n            'font-medium coz-fg-primary',\n            styles['error-name'],\n          )}\n          ellipsis={{\n            rows: 1,\n            showTooltip: {\n              type: 'tooltip',\n              opts: {\n                style: {\n                  width: '100%',\n                  wordBreak: 'break-word',\n                },\n              },\n            },\n          }}\n        >\n          {error.sourceName}\n        </Typography.Paragraph>\n      ) : null}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  useEffect,\n  useState,\n  type PropsWithChildren,\n  type FC,\n  type MouseEventHandler,\n  useMemo,\n} from 'react';\n\nimport { groupBy } from 'lodash-es';\nimport { I18n } from '@coze-arch/i18n';\nimport { Tooltip } from '@coze-arch/coze-design';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\n\nimport { EncapsulateRenderService } from '../encapsulate-render-service';\nimport { type EncapsulateValidateError } from '../../validate';\nimport { ErrorTitle } from './error-title';\n\nimport styles from './index.module.less';\n\ninterface Props {\n  errors: EncapsulateValidateError[];\n  onMouseEnter?: MouseEventHandler<HTMLDivElement>;\n  onMouseLeave?: MouseEventHandler<HTMLDivElement>;\n  getPopupContainer?: () => HTMLElement;\n}\n\nconst ErrorMessage: FC<{\n  error: EncapsulateValidateError;\n}> = ({ error }) => (\n  <div className=\"flex-1 coz-fg-primary font-normal\">{error.message}</div>\n);\n\nexport const EncapsulateTooltip: FC<PropsWithChildren<Props>> = ({\n  errors = [],\n  onMouseEnter,\n  onMouseLeave,\n  children,\n}) => {\n  const encapsulateRenderService = useService<EncapsulateRenderService>(\n    EncapsulateRenderService,\n  );\n\n  const [tooltipVisible, setTooltipVisible] = useState(\n    encapsulateRenderService.tooltipVisible,\n  );\n\n  useEffect(() => {\n    const disposable =\n      encapsulateRenderService.onTooltipVisibleChange(setTooltipVisible);\n\n    return () => {\n      disposable.dispose();\n    };\n  }, []);\n\n  const hasError = errors.length;\n\n  const groupErrors = useMemo(\n    () =>\n      groupBy(\n        errors.filter(e => e.message),\n        error =>\n          error?.sourceName || error?.sourceIcon\n            ? 'withSource'\n            : 'withoutSource',\n      ),\n    [errors],\n  );\n\n  return (\n    <Tooltip\n      trigger=\"custom\"\n      position=\"bottom\"\n      visible={tooltipVisible && errors?.length > 0}\n      showArrow={false}\n      onClickOutSide={() => {\n        setTooltipVisible(false);\n      }}\n      className=\"p-0 max-w-[460px] overflow-hidden\"\n      content={\n        hasError ? (\n          <div\n            onMouseEnter={onMouseEnter}\n            onMouseLeave={onMouseLeave}\n            className={styles.tooltip}\n          >\n            <div className=\"coz-fg-plus font-medium text-[16px]\">\n              {I18n.t(\n                'workflow_encapsulate_button_unable',\n                undefined,\n                '',\n              )}\n            </div>\n\n            {/* No wrong sources */}\n            {(groupErrors.withoutSource || []).map((error, index) => (\n              <div key={index} className=\"flex mt-3 gap-4 items-start\">\n                <ErrorMessage error={error} />\n              </div>\n            ))}\n\n            {/* There is a wrong source */}\n            {(groupErrors.withSource || []).length ? (\n              <div className={styles.errors}>\n                {(groupErrors.withSource || []).map(error => (\n                  <>\n                    <ErrorTitle error={error} />\n                    <ErrorMessage error={error} />\n                  </>\n                ))}\n              </div>\n            ) : null}\n          </div>\n        ) : null\n      }\n    >\n      {children}\n    </Tooltip>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst isMacOS = /(Macintosh|MacIntel|MacPPC|Mac68K|iPad)/.test(\n  navigator.userAgent,\n);\n\nconst CTRL = isMacOS ? '' : 'Ctrl';\nconst SHIFT = isMacOS ? '' : 'Shift';\n\nexport const ENCAPSULATE_SHORTCUTS = {\n  encapsulate: `${CTRL} G`,\n  decapsulate: `${CTRL} ${SHIFT} G`,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type MouseEvent, useRef, type MouseEventHandler } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Button } from '@coze-arch/coze-design';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\n\nimport { useValidate } from '../hooks/use-validate';\nimport { useEncapsulate } from '../hooks/use-encapsulate';\nimport { EncapsulateTooltip } from '../encapsulate-tooltip';\nimport { EncapsulateRenderService } from '../encapsulate-render-service';\nimport { ENCAPSULATE_SHORTCUTS } from '../constants';\n\nimport styles from './styles.module.less';\n\nconst HOVER_DELAY = 200;\n\n/**\n * encapsulation button\n */\nexport function EncapsulateButton() {\n  const encapsulateRenderService = useService<EncapsulateRenderService>(\n    EncapsulateRenderService,\n  );\n  const { handleEncapsulate, loading } = useEncapsulate();\n\n  const { validating, errors } = useValidate();\n\n  const handleClick = (e: MouseEvent) => {\n    e.stopPropagation();\n    if (validating) {\n      return;\n    }\n    handleEncapsulate();\n  };\n\n  const hasError = errors && errors.length > 0;\n  const disabled = !!(!errors || hasError);\n  const timeOutRef = useRef<number>();\n  const ref = useRef<HTMLDivElement>(null);\n\n  const handleMouseLeave: MouseEventHandler<HTMLDivElement> = () => {\n    if (!timeOutRef.current) {\n      timeOutRef.current = window.setTimeout(() => {\n        encapsulateRenderService.hideTooltip();\n        timeOutRef.current = undefined;\n      }, HOVER_DELAY);\n    }\n  };\n\n  const handleMouseEnter: MouseEventHandler<HTMLDivElement> = () => {\n    if (timeOutRef.current) {\n      clearTimeout(timeOutRef.current);\n      timeOutRef.current = undefined;\n    }\n    encapsulateRenderService.showTooltip();\n  };\n\n  return (\n    <EncapsulateTooltip\n      errors={errors}\n      onMouseEnter={handleMouseEnter}\n      onMouseLeave={handleMouseLeave}\n    >\n      <div\n        className=\"pointer-events-auto\"\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n        ref={ref}\n      >\n        <Button\n          loading={loading}\n          disabled={disabled}\n          className={styles.button}\n          color=\"highlight\"\n          onMouseDown={handleClick}\n        >\n          <span>\n            {I18n.t('workflow_encapsulate_button', undefined, '')}\n          </span>\n          <span className={styles.shortcut}>\n            {ENCAPSULATE_SHORTCUTS.encapsulate}\n          </span>\n        </Button>\n      </div>\n    </EncapsulateTooltip>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useRef } from 'react';\n\nimport { useDebounceEffect } from 'ahooks';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  EncapsulateValidateErrorCode,\n  type EncapsulateValidateError,\n} from '../../validate';\nimport { EncapsulateService } from '../../encapsulate';\nimport { useVariableChange } from './use-variable-change';\nimport { useSelectedNodes } from './use-selected-nodes';\n\nconst DEBOUNCE_DELAY = 100;\n\n/**\n * validation\n */\nexport function useValidate() {\n  const { selectedNodes } = useSelectedNodes();\n  const encapsulateService = useService<EncapsulateService>(EncapsulateService);\n\n  const [validating, setValidating] = useState(false);\n  const [errors, setErrors] = useState<EncapsulateValidateError[]>([]);\n  const validationIdRef = useRef(0); // Added Verification ID Tracking\n\n  const handleValidate = async () => {\n    if (selectedNodes.length <= 1) {\n      return;\n    }\n\n    setValidating(true);\n    // Generate the current verification ID\n    const currentValidationId = ++validationIdRef.current;\n\n    try {\n      const validateResult = await encapsulateService.validate();\n\n      // Only process the last verification result\n      if (currentValidationId === validationIdRef.current) {\n        setErrors(validateResult.getErrors());\n        setValidating(false);\n      }\n    } catch (error) {\n      setErrors([\n        {\n          code: EncapsulateValidateErrorCode.VALIDATE_ERROR,\n          message: (error as Error).message,\n        },\n      ]);\n      setValidating(false);\n    }\n  };\n\n  const { version: variableVersion } = useVariableChange(selectedNodes);\n\n  useDebounceEffect(\n    () => {\n      handleValidate();\n    },\n    [selectedNodes, variableVersion],\n    {\n      wait: DEBOUNCE_DELAY,\n    },\n  );\n\n  return {\n    validating,\n    errors,\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useState, type FC } from 'react';\n\nimport classNames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\n\nimport { useSelectedNodes } from '../hooks/use-selected-nodes';\nimport { EncapsulateRenderService } from '../encapsulate-render-service';\nimport { EncapsulateButton } from '../encapsulate-button';\nimport { EncapsulateService } from '../../encapsulate';\n\nimport styles from './index.module.less';\n\nexport const EncapsulatePanel: FC = () => {\n  const { selectedNodes } = useSelectedNodes();\n  const { length } = selectedNodes || [];\n  const [show, setShow] = useState(false);\n\n  const encapsulateService = useService<EncapsulateService>(EncapsulateService);\n  const encapsulateRenderService = useService<EncapsulateRenderService>(\n    EncapsulateRenderService,\n  );\n\n  useEffect(() => {\n    const display = encapsulateService.canEncapsulate() && length > 1;\n    if (!display) {\n      encapsulateRenderService.hideTooltip();\n    }\n    setShow(display);\n  }, [length]);\n\n  return (\n    <div\n      className={classNames(styles['encapsulate-panel'], {\n        [styles['encapsulate-panel-show']]: show,\n      })}\n    >\n      <div className={styles['encapsulate-panel-content']}>\n        {I18n.t(\n          'workflow_encapsulate_selecet',\n          { length },\n          ` ${length} `,\n        )}{' '}\n        <EncapsulateButton />\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  definePluginCreator,\n  type PluginCreator,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { WorkflowEncapsulateContainerModule } from './workflow-encapsulate-container-module';\nimport { EncapsulateValidatorsContainerModule } from './validators';\nimport { EncapsulateValidateManager } from './validate';\nimport {\n  type GetGlobalStateOption,\n  type GetNodeTemplateOption,\n  type OnEncapsulateOption,\n} from './types';\nimport { EncapsulateRenderContainerModule } from './render';\nimport { EncapsulateContext } from './encapsulate-context';\nimport { EncapsulateManager, EncapsulateService } from './encapsulate';\n\ninterface EncapsulatePluginOptions {\n  getNodeTemplate?: GetNodeTemplateOption;\n  getGlobalState?: GetGlobalStateOption;\n  onEncapsulate?: OnEncapsulateOption;\n}\n\nexport const createWorkflowEncapsulatePlugin: PluginCreator<EncapsulatePluginOptions> =\n  definePluginCreator<EncapsulatePluginOptions>({\n    onInit(ctx, options) {\n      ctx.get<EncapsulateManager>(EncapsulateManager).init();\n\n      ctx.get<EncapsulateContext>(EncapsulateContext).setPluginContext(ctx);\n\n      if (options.getNodeTemplate) {\n        ctx\n          .get<EncapsulateContext>(EncapsulateContext)\n          .setGetNodeTemplate(options.getNodeTemplate);\n      }\n\n      if (options.getGlobalState) {\n        ctx\n          .get<EncapsulateContext>(EncapsulateContext)\n          .setGetGlobalState(options.getGlobalState);\n      }\n\n      if (options.onEncapsulate) {\n        ctx.get<EncapsulateService>(EncapsulateService).onEncapsulate(res => {\n          options?.onEncapsulate?.(res, ctx);\n        });\n      }\n    },\n    onDispose(ctx) {\n      ctx.get<EncapsulateValidateManager>(EncapsulateValidateManager).dispose();\n      ctx.get<EncapsulateService>(EncapsulateService).dispose();\n      ctx.get<EncapsulateManager>(EncapsulateManager).dispose();\n    },\n    containerModules: [\n      WorkflowEncapsulateContainerModule,\n      EncapsulateRenderContainerModule,\n      EncapsulateValidatorsContainerModule,\n    ],\n  });\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { snakeCase } from 'lodash-es';\nimport { injectable, inject } from 'inversify';\nimport {\n  type AddOrDeleteLineOperationValue,\n  type AddOrDeleteWorkflowNodeOperationValue,\n  type ChangeNodeDataValue,\n  FreeOperationType,\n} from '@flowgram-adapter/free-layout-editor';\nimport { DisposableCollection } from '@flowgram-adapter/common';\nimport { type Operation, OperationService } from '@flowgram-adapter/common';\nimport { reporter } from '@coze-workflow/base';\n\n@injectable()\nexport class WorkflowOperationReportService {\n  @inject(OperationService)\n  private readonly operationService: OperationService;\n\n  private toDispose = new DisposableCollection();\n\n  private lastOperation: Operation | null = null;\n\n  init() {\n    this.toDispose.pushAll([\n      this.operationService.onApply((operation: Operation) => {\n        if (!operation.type) {\n          return;\n        }\n\n        try {\n          if (!this.shouldReport(operation)) {\n            return;\n          }\n          const message = this.getMessageByOperation(operation);\n          reporter.info({ message });\n        } catch (e) {\n          reporter.error({\n            error: e as Error,\n            message: 'workflow operation report error',\n          });\n        }\n        this.lastOperation = operation;\n      }),\n    ]);\n  }\n\n  dispose() {\n    this.toDispose.dispose();\n  }\n\n  private getMessageByOperation(operation: Operation): string {\n    const { type, value } = operation;\n    const eventName = this.getEventName(type);\n\n    if (\n      type === FreeOperationType.addLine ||\n      type === FreeOperationType.deleteLine\n    ) {\n      const {\n        from,\n        to = '',\n        fromPort = '',\n        toPort = '',\n      } = value as AddOrDeleteLineOperationValue;\n      return `${eventName} from ${from}${this.portToString(\n        fromPort,\n      )} to ${to}${this.portToString(toPort)}`;\n    }\n\n    if (\n      type === FreeOperationType.addNode ||\n      type === FreeOperationType.deleteNode\n    ) {\n      const {\n        node: { id },\n      } = value as AddOrDeleteWorkflowNodeOperationValue;\n      return `${eventName} ${id}`;\n    }\n\n    if (this.isChangeDataType(type)) {\n      const { id, path } = value as ChangeNodeDataValue;\n      const message = `${eventName} node:${id} path:${path}`;\n      return message;\n    }\n\n    return eventName;\n  }\n\n  private getEventName(type: string) {\n    return `workflow_${snakeCase(type)}`;\n  }\n\n  private isChangeDataType(type: string) {\n    return (\n      type === FreeOperationType.changeNodeData || type === 'changeFormValues'\n    );\n  }\n\n  private shouldReport(operation: Operation) {\n    const { value, type } = operation;\n\n    // Modify the same node and report the same attribute only once to prevent frequent editing and reporting too much\n    if (\n      this.isChangeDataType(type) &&\n      this.lastOperation &&\n      type === this.lastOperation.type\n    ) {\n      const { path, id } = value as ChangeNodeDataValue;\n      const { path: lastPath, id: lastId } = this.lastOperation\n        .value as ChangeNodeDataValue;\n      if (path === lastPath && id === lastId) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  private portToString(port: string | number) {\n    return port ? `:${port}` : '';\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  definePluginCreator,\n  type PluginCreator,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { WorkflowOperationReportService } from './services/workflow-operation-report-service';\n\nexport const createOperationReportPlugin: PluginCreator<object> =\n  definePluginCreator<object>({\n    onBind: ({ bind }) => {\n      bind(WorkflowOperationReportService).toSelf().inSingletonScope();\n    },\n    onInit(ctx): void {\n      ctx\n        .get<WorkflowOperationReportService>(WorkflowOperationReportService)\n        .init();\n    },\n    onDispose(ctx) {\n      ctx\n        .get<WorkflowOperationReportService>(WorkflowOperationReportService)\n        .dispose();\n    },\n  });\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { injectable } from 'inversify';\n\n@injectable()\nexport class WorkflowHistoryConfig {\n  disabled = false;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/naming-convention */\nimport { inject, injectable } from 'inversify';\nimport { PlaygroundConfigEntity } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowCommands } from '@flowgram-adapter/free-layout-editor';\nimport { HistoryService } from '@flowgram-adapter/common';\nimport {\n  type WorkflowShortcutsContribution,\n  type WorkflowShortcutsRegistry,\n} from '@coze-workflow/render';\nimport { reporter } from '@coze-workflow/base';\n\nimport { WorkflowHistoryConfig } from './workflow-history-config';\n\n/**\n * History shortcut\n */\n@injectable()\nexport class WorkflowHistoryShortcutsContribution\n  implements WorkflowShortcutsContribution\n{\n  @inject(HistoryService)\n  private _historyService: HistoryService;\n  @inject(WorkflowHistoryConfig)\n  private _config: WorkflowHistoryConfig;\n  @inject(PlaygroundConfigEntity)\n  private _playgroundConfig: PlaygroundConfigEntity;\n\n  registerShortcuts(registry: WorkflowShortcutsRegistry): void {\n    registry.addHandlers(\n      /**\n       * revoke\n       */\n      {\n        commandId: WorkflowCommands.UNDO,\n        shortcuts: ['meta z', 'ctrl z'],\n        isEnabled: () => !this._playgroundConfig.readonly,\n        execute: () => {\n          if (this._config.disabled) {\n            return;\n          }\n          this._historyService.undo();\n          reporter.info({\n            message: 'workflow_undo',\n          });\n        },\n      },\n      /**\n       * redo\n       */\n      {\n        commandId: WorkflowCommands.REDO,\n        shortcuts: ['meta shift z', 'ctrl shift z'],\n        isEnabled: () => !this._playgroundConfig.readonly,\n        execute: () => {\n          if (this._config.disabled) {\n            return;\n          }\n          this._historyService.redo();\n          reporter.info({\n            message: 'workflow_redo',\n          });\n        },\n      },\n    );\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type OperationMeta } from '@flowgram-adapter/free-layout-editor';\n\nexport const shouldMerge: OperationMeta['shouldMerge'] = (_op, prev, element) =>\n  !!(prev && Date.now() - element.getTimestamp() < 500);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type OperationMeta } from '@flowgram-adapter/free-layout-editor';\n\nimport { addNodeOperationMeta } from './add-node';\nimport { addLineOperationMeta } from './add-line';\n\nexport const operationMetas: OperationMeta[] = [\n  addNodeOperationMeta,\n  addLineOperationMeta,\n];\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { cloneDeep } from 'lodash-es';\nimport {\n  type AddOrDeleteWorkflowNodeOperationValue,\n  FreeOperationType,\n  WorkflowDocument,\n  type WorkflowNodeJSON,\n} from '@flowgram-adapter/free-layout-editor';\nimport { type PluginContext } from '@flowgram-adapter/free-layout-editor';\nimport { type OperationMeta } from '@flowgram-adapter/free-layout-editor';\n\nimport { shouldMerge } from '../utils/should-merge';\n\nexport const addNodeOperationMeta: OperationMeta<\n  AddOrDeleteWorkflowNodeOperationValue,\n  PluginContext,\n  void\n> = {\n  type: FreeOperationType.addNode,\n  inverse: op => ({\n    ...op,\n    type: FreeOperationType.deleteNode,\n  }),\n  apply: (operation, ctx: PluginContext) => {\n    const document = ctx.get<WorkflowDocument>(WorkflowDocument);\n    document.createWorkflowNode(\n      cloneDeep(operation.value.node) as WorkflowNodeJSON,\n      true,\n      operation.value.parentID,\n    );\n  },\n  shouldMerge,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type AddOrDeleteLineOperationValue,\n  FreeOperationType,\n  WorkflowDocument,\n  WorkflowLinesManager,\n} from '@flowgram-adapter/free-layout-editor';\nimport { type PluginContext } from '@flowgram-adapter/free-layout-editor';\nimport { type OperationMeta } from '@flowgram-adapter/free-layout-editor';\n\nimport { shouldMerge } from '../utils/should-merge';\n\nexport const addLineOperationMeta: OperationMeta<\n  AddOrDeleteLineOperationValue,\n  PluginContext,\n  void\n> = {\n  type: FreeOperationType.addLine,\n  inverse: op => ({\n    ...op,\n    type: FreeOperationType.deleteLine,\n  }),\n  apply: (operation, ctx: PluginContext) => {\n    const linesManager = ctx.get<WorkflowLinesManager>(WorkflowLinesManager);\n    const document = ctx.get<WorkflowDocument>(WorkflowDocument);\n\n    if (!operation.value.to || !document.getNode(operation.value.to)) {\n      return;\n    }\n\n    linesManager.createLine({\n      ...operation.value,\n      key: operation.value.id,\n    });\n  },\n  shouldMerge,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { injectable } from 'inversify';\nimport {\n  type OperationContribution,\n  type OperationRegistry,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { operationMetas } from './operation-metas';\n\n@injectable()\nexport class WorklfowHistoryOperationsContribution\n  implements OperationContribution\n{\n  registerOperationMeta(operationRegistry: OperationRegistry): void {\n    operationMetas.forEach(operationMeta => {\n      operationRegistry.registerOperationMeta(operationMeta);\n    });\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ContainerModule } from 'inversify';\nimport { OperationContribution } from '@flowgram-adapter/free-layout-editor';\nimport { bindContributions } from '@flowgram-adapter/common';\nimport { WorkflowShortcutsContribution } from '@coze-workflow/render';\n\nimport { WorkflowHistoryShortcutsContribution } from './workflow-history-shortcuts-contribution';\nimport { WorklfowHistoryOperationsContribution } from './workflow-history-operations-contribution';\nimport { WorkflowHistoryConfig } from './workflow-history-config';\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport const WorkflowHistoryContainerModule = new ContainerModule(bind => {\n  bindContributions(bind, WorkflowHistoryShortcutsContribution, [\n    WorkflowShortcutsContribution,\n  ]);\n  bindContributions(bind, WorklfowHistoryOperationsContribution, [\n    OperationContribution,\n  ]);\n  bind(WorkflowHistoryConfig).toSelf().inSingletonScope();\n});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\n\nexport enum LLMModel {\n  GPT_4O = 124,\n  YunqueModel = 1706077826,\n}\n\n/** GPT_4O is selected by default overseas, the bean bag Function Call model is selected by default in China, and the first one is selected by default in the professional version */\nexport const DEFAULT_MODEL_TYPE = IS_OVERSEA\n  ? LLMModel.GPT_4O\n  : LLMModel.YunqueModel;\n\nexport const VARIABLE_NAME_REGEX =\n  /^(?!.*\\b(true|false|and|AND|or|OR|not|NOT|null|nil|If|Switch)\\b)[a-zA-Z_][a-zA-Z_$0-9]*$/;\n\nexport const DEFAULT_NODE_META_PATH = '/nodeMeta';\nexport const DEFAULT_BATCH_PATH = '/inputs/batch';\nexport const DEFAULT_INPUT_PARAMETERS_PATH = '/inputs/inputParameters';\nexport const DEFAULT_OUTPUTS_PATH = '/outputs';\n\nexport const BATCH_CONCURRENT_SIZE_MIN = 1;\nexport const BATCH_CONCURRENT_SIZE_MAX = 10;\nexport const BATCH_SIZE_MIN = 1;\nexport const BATCH_SIZE_MAX = 200;\n\nexport const DEFAULT_BATCH_CONCURRENT_SIZE = BATCH_CONCURRENT_SIZE_MAX;\nexport const DEFAULT_BATCH_SIZE = 100;\n\nexport const INTENT_NODE_MODE = {\n  /** intent recognition node minimalist pattern */\n  MINIMAL: 'top_speed',\n\n  /** intent recognition full pattern */\n  STANDARD: 'all',\n};\n\n/** Lite version maximum number of intent recognition options */\nexport const MINIMAL_INTENT_ITEMS = 10;\n/** Standard Edition maximum number of intent recognition options */\nexport const STANDARD_INTENT_ITEMS = 50;\n\nexport const SYSTEM_DELIMITER = {\n  lineBreak: '\\n',\n  tab: '\\t',\n  period: IS_OVERSEA ? '.' : '',\n  comma: IS_OVERSEA ? ',' : '',\n  semicolon: IS_OVERSEA ? ';' : '',\n  space: ' ',\n};\n\nexport const DEFAULT_DELIMITER_OPTIONS = [\n  {\n    label: I18n.t('workflow_stringprocess_concat_symbol_lineBreak'),\n    value: SYSTEM_DELIMITER.lineBreak,\n    isDefault: true,\n  },\n  {\n    label: I18n.t('workflow_stringprocess_concat_symbol_tab'),\n    value: SYSTEM_DELIMITER.tab,\n    isDefault: true,\n  },\n  {\n    label: I18n.t('workflow_stringprocess_concat_symbol_period'),\n    value: SYSTEM_DELIMITER.period,\n    isDefault: true,\n  },\n  {\n    label: I18n.t('workflow_stringprocess_concat_symbol_comma'),\n    value: SYSTEM_DELIMITER.comma,\n    isDefault: true,\n  },\n  {\n    label: I18n.t('workflow_stringprocess_concat_symbol_semicolon'),\n    value: SYSTEM_DELIMITER.semicolon,\n    isDefault: true,\n  },\n  {\n    label: I18n.t('workflow_stringprocess_concat_symbol_space'),\n    value: SYSTEM_DELIMITER.space,\n    isDefault: true,\n  },\n];\n\n/** scenario workflow role information keyword */\nexport const roleInformationKeyword = 'role_information';\n\n/** Node default width and height (with input/output) */\nexport const DEFAULT_NODE_SIZE = {\n  width: 360,\n  height: 104.7,\n};\n\n/** Input parameter label style */\nexport const DEFAULT_INPUT_LABEL_STYLE = {\n  width: '40%',\n};\n\nexport const NARROW_INPUT_LABEL_STYLE = {\n  width: '36%',\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type StandardNodeType,\n  type BasicStandardNodeTypes,\n  type DTODefine,\n} from '@coze-workflow/base/types';\nimport { type ReleasedWorkflow } from '@coze-arch/bot-api/workflow_api';\n\nimport { type ApiNodeDetailDTO } from '../../typings';\n\n/**\n * Data related to the API stored on the API node\n */\nexport type ApiNodeData = CommonNodeData &\n  Readonly<\n    Partial<ApiNodeDetailDTO> & {\n      /**\n       * The plug-in node in the project needs to save the projectId.\n       */\n      projectId?: string;\n      /** The latest version of the plugin timestamp */\n      latestVersionTs?: string;\n      /** The display name of the latest version of the plugin, like v1.0.0 */\n      latestVersionName?: string;\n      /** The display name of the current version of the plugin, in the form of v1.0.0 */\n      versionName?: string;\n    }\n  >;\n\n/**\n * Related data stored on the subprocess node\n */\nexport type SubWorkflowNodeData = CommonNodeData &\n  Readonly<Omit<ReleasedWorkflow, 'inputs' | 'outputs'>> & {\n    /** Subprocess Node Input Definition */\n    inputsDefinition: DTODefine.InputVariableDTO[];\n    /**\n     * The sub-process in the project needs to save the projectId.\n     */\n    projectId?: string;\n    /** The latest version of the subprocess */\n    latestVersion?: string;\n  };\n\nexport type QuestionNodeData = CommonNodeData & {\n  question: string;\n  options: any;\n  answerType: string;\n};\n\n/**\n * Related data for common node types\n * See Type BasicStandardNodeTypes for basic node definitions\n */\nexport interface CommonNodeData {\n  /**\n   *\n   * Node icon\n   */\n  readonly icon: string;\n  /**\n   * node description\n   */\n  description: string;\n  /**\n   * Node title\n   */\n  title: string;\n  /**\n   * Node main color\n   */\n  mainColor: string;\n}\n\nexport enum LLMNodeDataSkillType {\n  Plugin = 1,\n  Workflow = 4,\n  Dataset = 3,\n}\n\nexport interface LLMNodeDataPluginSkill {\n  type: LLMNodeDataSkillType.Plugin;\n  pluginId?: string;\n  pluginName?: string;\n  apiId?: string;\n  apiName?: string;\n  icon?: string;\n}\n\nexport interface LLMNodeDataWorkflowSkill {\n  type: LLMNodeDataSkillType.Workflow;\n  workflowId: string;\n  pluginId?: string;\n  name?: string;\n  icon?: string;\n}\n\nexport interface LLMNodeDataDatasetSkill {\n  type: LLMNodeDataSkillType.Dataset;\n  id: string;\n  name?: string;\n  icon?: string;\n}\n\nexport type LLMNodeDataSkill =\n  | LLMNodeDataPluginSkill\n  | LLMNodeDataWorkflowSkill\n  | LLMNodeDataDatasetSkill;\n\nexport interface LLMNodeData extends CommonNodeData {\n  skills: LLMNodeDataSkill[];\n}\n\ntype BasicNodeDataMap = {\n  [K in BasicStandardNodeTypes]: CommonNodeData;\n};\n\nexport interface NodeData extends BasicNodeDataMap {\n  [StandardNodeType.Api]: ApiNodeData;\n  [StandardNodeType.SubWorkflow]: SubWorkflowNodeData;\n  [StandardNodeType.Question]: QuestionNodeData;\n  [StandardNodeType.LLM]: LLMNodeData;\n}\n\ntype IfEquals<X, Y, A = X, B = never> = (<T>() => T extends X ? 1 : 2) extends <\n  T,\n>() => T extends Y ? 1 : 2\n  ? A\n  : B;\n\ntype EditAbleProperties<T> = {\n  [P in keyof T]: IfEquals<{ [Q in P]: T[P] }, { -readonly [Q in P]: T[P] }, P>;\n}[keyof T];\n\nexport type EditAbleNodeData<T extends keyof NodeData> = Pick<\n  NodeData[T],\n  EditAbleProperties<NodeData[T]>\n>;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * What is this module for?\n * In the node model of workflow, the default storage for data is only the form, that is, formMeta. This part of the data actually represents the data submitted to the backend for workflow execution\n * However, in the actual business scenario, we need not only the data submitted to the back-end for operation, but also some data that needs to be consumed in the front-end business scenario, but not used by the back-end. For example:\n *  1. spaceId and release status of the api node\n *  2. SpaceId and publication status of the child process node\n * So this module adds a NodeData entity to manage some data on each node for consumption and use by the business layer\n */\nimport { EntityData } from '@flowgram-adapter/free-layout-editor';\n\nimport { type EditAbleNodeData, type NodeData } from './types';\n\nexport class WorkflowNodeData extends EntityData {\n  private nodeData;\n\n  private hasSetNodeData = false;\n\n  init() {\n    this.hasSetNodeData = false;\n    this.nodeData = undefined;\n  }\n\n  getDefaultData() {\n    return undefined;\n  }\n\n  /**\n   *\n   * @param data\n   * Set up data other than form on the node\n   * Generics must pass in the node type StandardNodeType\n   */\n  setNodeData<T extends keyof NodeData = never>(data: NodeData[T]) {\n    if (this.hasSetNodeData) {\n      // The settings will be repeated when undoing and redoing, there is no need to report an error.\n      console.warn(`node ${this.entity.id} has already set WorkflowNodeData`);\n      return;\n    }\n\n    this.nodeData = { ...data };\n    this.hasSetNodeData = true;\n  }\n\n  /**\n   *\n   * @param data\n   * Update data, put only non-readonly field updates\n   * Generics must pass in the node type StandardNodeType\n   */\n  updateNodeData<T extends keyof NodeData = never>(\n    data: Partial<EditAbleNodeData<T>>,\n  ) {\n    this.nodeData = { ...this.nodeData, ...data };\n  }\n  /**\n   *\n   * @returns\n   * Get data other than form on the node\n   */\n  getNodeData<T extends keyof NodeData>(): NodeData[T] {\n    return this.nodeData;\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { customAlphabet } from 'nanoid';\nimport { inject, injectable } from 'inversify';\nimport { FlowNodeFormData } from '@flowgram-adapter/free-layout-editor';\nimport { EntityManager } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { Emitter } from '@flowgram-adapter/common';\n\nimport { type FormNodeMeta } from '../typings';\nimport { DEFAULT_NODE_META_PATH } from '../constants';\n\n@injectable()\nexport class WorkflowNodesService {\n  protected onNodesTitleChangeEmitter = new Emitter<void>();\n  @inject(EntityManager) protected readonly entityManager: EntityManager;\n  private nanoid = customAlphabet('1234567890', 5);\n  /**\n   * Node header change\n   */\n  readonly onNodesTitleChange = this.onNodesTitleChangeEmitter.event;\n\n  /**\n   * Node header update\n   * @param node\n   */\n  getNodeTitle(node: WorkflowNodeEntity): string {\n    const formData = node.getData<FlowNodeFormData>(FlowNodeFormData);\n    const nodeMeta = formData.formModel.getFormItemValueByPath<FormNodeMeta>(\n      DEFAULT_NODE_META_PATH,\n    );\n\n    return nodeMeta?.title || '';\n  }\n\n  /**\n   * Get all nodes\n   */\n  getAllNodes(ignoreNode?: WorkflowNodeEntity): WorkflowNodeEntity[] {\n    return this.entityManager\n      .getEntities<WorkflowNodeEntity>(WorkflowNodeEntity)\n      .filter(n => n.id !== 'root' && n !== ignoreNode);\n  }\n  /**\n   * Get the titles of all nodes\n   */\n  getAllTitles(ignoreNode?: WorkflowNodeEntity): string[] {\n    return this.getAllNodes(ignoreNode).map(node => this.getNodeTitle(node));\n  }\n  /**\n   * Get start node\n   */\n  getStartNode(): WorkflowNodeEntity {\n    return this.entityManager\n      .getEntities<WorkflowNodeEntity>(WorkflowNodeEntity)\n      .find(node => node.isStart) as WorkflowNodeEntity;\n  }\n  /**\n   * Trigger node header update event\n   */\n  fireNodesTitleChange(): void {\n    this.onNodesTitleChangeEmitter.fire();\n  }\n\n  /**\n   * Create non-duplicate titles\n   *\n   * abc_1 -> abc_2\n   */\n\n  createUniqTitle(\n    titlePrefix: string,\n    ignoreNode?: WorkflowNodeEntity | undefined,\n    ignoreTitles?: string[],\n  ): string {\n    const allTitles = this.getAllTitles(ignoreNode);\n    if (ignoreTitles) {\n      allTitles.push(...ignoreTitles);\n    }\n\n    const allTitlesSet = new Set(allTitles);\n\n    let startIndex = 0;\n    let newTitle = `${titlePrefix}`;\n\n    const matched = titlePrefix.match(/_([0-9]+)$/);\n    if (matched) {\n      startIndex = Number(matched[1]);\n      titlePrefix = titlePrefix.slice(0, matched.index);\n    }\n\n    while (allTitlesSet.has(newTitle)) {\n      startIndex += 1;\n      newTitle = `${titlePrefix}_${startIndex}`;\n    }\n    return newTitle;\n  }\n\n  /** Create a unique ID */\n  createUniqID() {\n    let id: string;\n    do {\n      // To prevent the id from starting with 0, the backend will be converted to int64, resulting in 0 loss, so some IDs cannot match\n      id = `1${this.nanoid()}`;\n    } while (this.entityManager.getEntityById(id));\n    return id;\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-magic-numbers */\nimport { StandardNodeType } from '@coze-workflow/base';\n\n/**\n * Nodes using V2 version exception settings\n */\nexport const SETTING_ON_ERROR_V2_NODES = [\n  StandardNodeType.Code,\n  StandardNodeType.LLM,\n  StandardNodeType.Api,\n  StandardNodeType.Database,\n  StandardNodeType.ImageGenerate,\n  StandardNodeType.DatabaseCreate,\n  StandardNodeType.DatabaseUpdate,\n  StandardNodeType.DatabaseQuery,\n  StandardNodeType.DatabaseDelete,\n  StandardNodeType.ImageCanvas,\n  StandardNodeType.Intent,\n];\n\n/**\n * Version exception settings using V1\n */\nexport const SETTING_ON_ERROR_V1_NODES = [StandardNodeType.Http];\n\n/**\n * Nodes with dynamic ports\n */\nexport const SETTING_ON_ERROR_DYNAMIC_PORT_NODES = [StandardNodeType.Intent];\n\n/**\n * Open abnormal node\n */\nexport const SETTING_ON_ERROR_NODES = [\n  ...SETTING_ON_ERROR_V1_NODES,\n  ...SETTING_ON_ERROR_V2_NODES,\n];\n\n/**\n * abnormal port\n */\nexport const SETTING_ON_ERROR_PORT = 'branch_error';\n\n/**\n * Timeout minimum 100ms;\n */\nexport const SETTING_ON_ERROR_MIN_TIMEOUT = 100;\n\n/**\n * Other nodes: default 1 minute, maximum 1 minute;\n */\nexport const SETTING_ON_ERROR_DEFAULT_TIMEOUT = {\n  default: 60 * 1000,\n  max: 60 * 1000,\n};\n\n/**\n * Node configuration\n * LLM: Default 3 minutes, maximum 10 minutes;\n * Plugin: Default 3 minutes, maximum 3 minutes;\n */\nexport const SETTING_ON_ERROR_NODES_CONFIG = {\n  [StandardNodeType.LLM]: {\n    timeout: {\n      default: 3 * 60 * 1000,\n      max: 10 * 60 * 1000,\n      init: 10 * 60 * 1000,\n    },\n    enableBackupModel: true,\n  },\n  [StandardNodeType.Api]: {\n    timeout: {\n      default: 3 * 60 * 1000,\n      max: 3 * 60 * 1000,\n    },\n  },\n};\n\nexport const ERROR_BODY_NAME = 'errorBody';\nexport const IS_SUCCESS_NAME = 'isSuccess';\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type ViewVariableTreeNode,\n  type StandardNodeType,\n} from '@coze-workflow/base';\nimport { type NodeContext } from '@flowgram-adapter/free-layout-editor';\n\nimport { formatModelData } from '../utils';\nimport { getOutputsWithErrorBody } from './utils/outputs';\nimport { getTimeoutConfig } from './utils/get-timeout-config';\nimport { isSettingOnErrorV2 } from './utils';\nimport {\n  type SettingOnErrorDTO,\n  SettingOnErrorProcessType,\n  type SettingOnErrorExt,\n  type NodeValueWithSettingOnErrorDTO,\n  type NodeValueWithSettingOnErrorVO,\n  type SettingOnErrorVO,\n} from './types';\n\nconst formatExtOnInit = (ext: SettingOnErrorDTO['ext']) => {\n  if (!ext) {\n    return ext;\n  }\n  const llmParam = ext?.backupLLmParam;\n\n  return {\n    backupLLmParam: llmParam ? JSON.parse(llmParam) : undefined,\n  };\n};\n\nconst getDTOProcessType = (settingOnError?: SettingOnErrorDTO) =>\n  settingOnError?.processType ||\n  (settingOnError?.switch\n    ? SettingOnErrorProcessType.RETURN\n    : SettingOnErrorProcessType.BREAK);\n\nconst settingOnErrorInitV2 = (\n  settingOnError?: SettingOnErrorDTO,\n  context?: NodeContext,\n  value?: NodeValueWithSettingOnErrorDTO,\n) => {\n  if (!isNodeContextV2(context)) {\n    return {};\n  }\n\n  let timeoutMs = settingOnError?.timeoutMs;\n  const timeoutConfig = getTimeoutConfig(context?.node);\n\n  if (!timeoutMs) {\n    // If no timeout is set and there is an initial value configuration, set the initial value\n    // For example, the default of the LLM backend is 10min, the historical data needs to be set to 10min of init, and the newly added node displays the default default 3min.\n    if (value && timeoutConfig?.init) {\n      timeoutMs = timeoutConfig.init;\n    } else {\n      timeoutMs = timeoutConfig?.default;\n    }\n  }\n\n  return {\n    processType: getDTOProcessType(settingOnError),\n    timeoutMs,\n    retryTimes: settingOnError?.retryTimes ?? 0,\n    ext: formatExtOnInit(settingOnError?.ext),\n  };\n};\n\nconst formatExtOnSave = (\n  ext: SettingOnErrorExt | undefined,\n  playgroundContext,\n) => {\n  if (!ext) {\n    return ext;\n  }\n  const models = playgroundContext?.models || [];\n  const llmParam = ext.backupLLmParam;\n  const modelMeta = models.find(m => m.model_type === llmParam?.modelType);\n\n  return {\n    backupLLmParam: llmParam\n      ? JSON.stringify(formatModelData(llmParam, modelMeta))\n      : undefined,\n  };\n};\n\nconst settingOnErrorSaveV2 = (\n  settingOnError: SettingOnErrorVO,\n  context?: NodeContext,\n) => {\n  const playgroundContext = context?.playgroundContext;\n  const res: Partial<SettingOnErrorDTO> = {\n    processType:\n      settingOnError?.processType ||\n      (settingOnError?.settingOnErrorIsOpen\n        ? SettingOnErrorProcessType.RETURN\n        : undefined),\n    timeoutMs: settingOnError?.timeoutMs,\n    retryTimes: settingOnError?.retryTimes,\n  };\n\n  if (settingOnError?.retryTimes) {\n    res.ext = formatExtOnSave(settingOnError?.ext, playgroundContext);\n  }\n  return res;\n};\n\nconst isNodeContextV2 = (context?: NodeContext) =>\n  isSettingOnErrorV2(context?.node?.flowNodeType as StandardNodeType);\n\nexport const settingOnErrorToVO = (\n  settingOnError?: SettingOnErrorDTO,\n  context?: NodeContext,\n  value?: NodeValueWithSettingOnErrorDTO,\n): SettingOnErrorVO => ({\n  settingOnErrorIsOpen: settingOnError?.switch,\n  settingOnErrorJSON: settingOnError?.dataOnErr,\n  ...settingOnErrorInitV2(settingOnError, context, value),\n});\n\nexport const settingOnErrorToDTO = (\n  settingOnError?: SettingOnErrorVO,\n  context?: NodeContext,\n) => {\n  if (!settingOnError) {\n    return settingOnError;\n  }\n\n  return {\n    switch: settingOnError?.settingOnErrorIsOpen,\n    dataOnErr: settingOnError?.settingOnErrorJSON,\n    ...(isNodeContextV2(context)\n      ? settingOnErrorSaveV2(settingOnError, context)\n      : {}),\n  };\n};\n\nexport const formatOutputsOnInit = (\n  value?: NodeValueWithSettingOnErrorDTO,\n  context?: NodeContext,\n) => {\n  const outputs = value?.outputs;\n  const isV2 = isNodeContextV2(context);\n  const isOpen = !!value?.inputs?.settingOnError?.switch;\n\n  if (!outputs || !isSettingOnErrorV2 || !isOpen) {\n    return;\n  }\n\n  const isBatch = !!value?.inputs?.batch?.batchEnable;\n  return getOutputsWithErrorBody({\n    value: outputs,\n    isBatch,\n    isOpen,\n    isSettingOnErrorV2: isV2,\n  });\n};\n\nexport const settingOnErrorInit = (\n  value?: NodeValueWithSettingOnErrorDTO,\n  context?: NodeContext,\n): {\n  settingOnError?: SettingOnErrorVO;\n  outputs?: ViewVariableTreeNode[];\n} => {\n  const outputs = formatOutputsOnInit(value, context);\n\n  return {\n    settingOnError: settingOnErrorToVO(\n      value?.inputs?.settingOnError,\n      context,\n      value,\n    ),\n    ...(outputs ? { outputs } : {}),\n  };\n};\n\nexport const settingOnErrorSave = (\n  value: NodeValueWithSettingOnErrorVO,\n  context: NodeContext | undefined = undefined,\n) => {\n  const settingOnError = value?.settingOnError;\n  if (value?.settingOnError) {\n    delete value.settingOnError;\n  }\n\n  return {\n    settingOnError: settingOnErrorToDTO(settingOnError, context),\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type StandardNodeType } from '@coze-workflow/base/types';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport { isSettingOnErrorV2, isSettingOnError } from '../utils';\n\nexport const useIsSettingOnErrorV2 = () => {\n  const node = useCurrentEntity();\n\n  return isSettingOnErrorV2(node.flowNodeType as StandardNodeType);\n};\n\nexport const useIsSettingOnError = () => {\n  const node = useCurrentEntity();\n\n  return isSettingOnError(node.flowNodeType as StandardNodeType);\n};\n\nexport { useTimeoutConfig } from './use-timeout-config';\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ViewVariableTreeNode } from '@coze-workflow/base';\n\n/**\n * exception handling type\n * 1 Direct interruption\n * 2 Return to the setting content,\n * 3 Execute abnormal flow\n */\nexport enum SettingOnErrorProcessType {\n  BREAK = 1,\n  RETURN = 2,\n  EXCEPTION = 3,\n}\n\n/**\n * Exception handling extra data\n */\nexport interface SettingOnErrorExt {\n  /**\n   * Alternative Model for LLM Node Retry\n   */\n  backupLLmParam?: {\n    modelName?: string;\n    modelType?: number;\n    temperature?: number;\n    frequencyPenalty?: number;\n    presencePenalty?: number;\n    topP?: number;\n    topK?: number;\n    maxTokens?: number;\n  };\n}\n\ninterface SettingOnErrorBase {\n  /**\n   * processing type\n   */\n  processType?: SettingOnErrorProcessType;\n  /**\n   * Timeout, milliseconds\n   */\n  timeoutMs?: number;\n  /**\n   * Number of retries 0 means no retries\n   */\n  retryTimes?: number;\n}\n\n/**\n * Exception handling front-end architecture\n */\nexport interface SettingOnErrorVO extends SettingOnErrorBase {\n  /**\n   * Whether to enable exception handling\n   */\n  settingOnErrorIsOpen?: boolean;\n  /**\n   * Default value for exception handling to occur\n   */\n  settingOnErrorJSON?: string;\n\n  /**\n   * Other settings\n   */\n  ext?: SettingOnErrorExt;\n}\n\nexport type SettingOnErrorValue = SettingOnErrorVO;\n\n/**\n * exception handling backend structure\n */\nexport interface SettingOnErrorDTO extends SettingOnErrorBase {\n  /**\n   * Whether to enable exception handling\n   */\n  switch: boolean;\n  /**\n   * Default value for exception handling to occur\n   */\n  dataOnErr: string;\n  /**\n   * Other settings\n   */\n  ext?: {\n    backupLLmParam?: string;\n  };\n}\n\n/**\n * Backend node data with abnormal settings\n */\nexport interface NodeValueWithSettingOnErrorDTO {\n  inputs?: {\n    settingOnError?: SettingOnErrorDTO;\n    batch?: {\n      batchEnable?: boolean;\n    };\n  };\n  outputs?: ViewVariableTreeNode[];\n}\n\n/**\n * Front-end node data with exception settings\n */\nexport interface NodeValueWithSettingOnErrorVO {\n  settingOnError?: SettingOnErrorVO;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type StandardNodeType } from '@coze-workflow/base';\n\nimport {\n  SETTING_ON_ERROR_DYNAMIC_PORT_NODES,\n  SETTING_ON_ERROR_NODES,\n  SETTING_ON_ERROR_V2_NODES,\n} from './constants';\n\n/**\n * Is it a node of the v2 version?\n * @param type\n * @returns\n */\nexport const isSettingOnErrorV2 = (type?: StandardNodeType) =>\n  type && SETTING_ON_ERROR_V2_NODES.includes(type);\n\n/**\n * Is it the node with the abnormal setting turned on?\n * @param type\n * @returns\n */\nexport const isSettingOnError = (type?: StandardNodeType) =>\n  type && SETTING_ON_ERROR_NODES.includes(type);\n\n/**\n * Is it a node of the dynamic channel?\n * @param type\n * @returns\n */\nexport const isSettingOnErrorDynamicPort = (type?: StandardNodeType) =>\n  type && SETTING_ON_ERROR_DYNAMIC_PORT_NODES.includes(type);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { nanoid } from 'nanoid';\nimport { ViewVariableType } from '@coze-workflow/base';\n\nimport { ERROR_BODY_NAME, IS_SUCCESS_NAME } from '../constants';\n\nexport const generateErrorBodyMeta = () => ({\n  key: nanoid(),\n  name: ERROR_BODY_NAME,\n  type: ViewVariableType.Object,\n  readonly: true,\n  children: [\n    {\n      key: nanoid(),\n      name: 'errorMessage',\n      type: ViewVariableType.String,\n      readonly: true,\n    },\n    {\n      key: nanoid(),\n      name: 'errorCode',\n      type: ViewVariableType.String,\n      readonly: true,\n    },\n  ],\n});\n\nexport const generateIsSuccessMeta = () => ({\n  key: nanoid(),\n  name: IS_SUCCESS_NAME,\n  type: ViewVariableType.Boolean,\n  readonly: true,\n});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { get } from 'lodash-es';\nimport { PluginType, StandardNodeType } from '@coze-workflow/base';\nimport { type WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  SETTING_ON_ERROR_DEFAULT_TIMEOUT,\n  SETTING_ON_ERROR_MIN_TIMEOUT,\n  SETTING_ON_ERROR_NODES_CONFIG,\n} from '../constants';\nimport { WorkflowNodeData } from '../../entity-datas';\n\n/**\n * Is it a side plug-in?\n * @param node\n * @returns\n */\nconst isLocalPlugin = (node?: WorkflowNodeEntity) => {\n  if (!node) {\n    return false;\n  }\n\n  const nodeDataEntity = node.getData<WorkflowNodeData>(WorkflowNodeData);\n  const nodeData = nodeDataEntity?.getNodeData();\n\n  return !!(\n    node?.flowNodeType === StandardNodeType.Api &&\n    get(nodeData, 'pluginType') === PluginType.LOCAL\n  );\n};\n\n/**\n * Get node timeout configuration\n */\nexport const getTimeoutConfig = (\n  node?: WorkflowNodeEntity,\n): {\n  max: number;\n  default: number;\n  min: number;\n  init?: number;\n  disabled: boolean;\n} => {\n  let timeoutConfig = SETTING_ON_ERROR_DEFAULT_TIMEOUT;\n\n  if (\n    node?.flowNodeType &&\n    SETTING_ON_ERROR_NODES_CONFIG[node.flowNodeType]?.timeout\n  ) {\n    timeoutConfig = SETTING_ON_ERROR_NODES_CONFIG[node.flowNodeType].timeout;\n  }\n\n  return {\n    ...timeoutConfig,\n    min: SETTING_ON_ERROR_MIN_TIMEOUT,\n    disabled: isLocalPlugin(node),\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ViewVariableTreeNode } from '@coze-workflow/base';\n\nimport { ERROR_BODY_NAME, IS_SUCCESS_NAME } from '../constants';\nimport { generateErrorBodyMeta, generateIsSuccessMeta } from './generate-meta';\n\nconst settingOnErrorNames = isSettingOnErrorV2 => [\n  ERROR_BODY_NAME,\n  ...(isSettingOnErrorV2 ? [IS_SUCCESS_NAME] : []),\n];\n\nconst excludeFn = isSettingOnErrorV2 => v =>\n  !settingOnErrorNames(isSettingOnErrorV2).includes(v.name);\n\nconst includeFn = isSettingOnErrorV2 => v =>\n  settingOnErrorNames(isSettingOnErrorV2).includes(v.name);\n\n/**\n * Add/remove errorBody to output\n */\nexport const getOutputsWithErrorBody = ({\n  value,\n  isBatch,\n  isOpen,\n  isSettingOnErrorV2,\n}: {\n  value?: ViewVariableTreeNode[];\n  isBatch: boolean;\n  isOpen: boolean;\n  isSettingOnErrorV2?: boolean;\n}) => {\n  if (!value) {\n    return value;\n  }\n  // Add errorBody\n  if (isOpen) {\n    // In batch mode, append errorBody to children in the first layer\n    if (isBatch) {\n      return [\n        {\n          ...value[0],\n          children: [\n            ...(value[0]?.children ?? []).filter(excludeFn(isSettingOnErrorV2)),\n            generateErrorBodyMeta(),\n            ...(isSettingOnErrorV2 ? [generateIsSuccessMeta()] : []),\n          ],\n        },\n      ];\n      // In single mode, append an errorBody to the first layer\n    } else {\n      return [\n        ...(value ?? []).filter(excludeFn(isSettingOnErrorV2)),\n        generateErrorBodyMeta(),\n        ...(isSettingOnErrorV2 ? [generateIsSuccessMeta()] : []),\n      ];\n    }\n    // errorBody\n  } else {\n    // In batch mode, remove children from the first layer\n    if (isBatch) {\n      const [one, ...rest] = value;\n      return [\n        {\n          ...one,\n          children: [\n            ...(one?.children ?? []).filter(excludeFn(isSettingOnErrorV2)),\n          ],\n        },\n        ...rest,\n      ];\n      // In single mode, remove children from the first layer\n    } else {\n      return [...(value ?? []).filter(excludeFn(isSettingOnErrorV2))];\n    }\n  }\n};\n\n/**\n * The output property is sorted to ensure that errorBody is at the bottom\n */\nexport const sortErrorBody = ({\n  value,\n  isBatch,\n  isSettingOnErrorV2,\n}: {\n  value?: ViewVariableTreeNode[];\n  isBatch: boolean;\n  isSettingOnErrorV2?: boolean;\n}) => {\n  if (!value) {\n    return value;\n  }\n\n  if (isBatch) {\n    const [one, ...rest] = value;\n    return [\n      {\n        ...one,\n        children: [\n          ...(one?.children ?? []).filter(excludeFn(isSettingOnErrorV2)),\n          ...(one?.children ?? []).filter(includeFn(isSettingOnErrorV2)),\n        ],\n      },\n      ...rest,\n    ];\n  }\n  return [\n    ...value.filter(excludeFn(isSettingOnErrorV2)),\n    ...value.filter(includeFn(isSettingOnErrorV2)),\n  ];\n};\n\n/**\n * Remove the errorBody from the value\n */\nexport const getExcludeErrorBody = ({\n  value,\n  isBatch,\n  isSettingOnErrorV2,\n}: {\n  value?: ViewVariableTreeNode[];\n  isBatch: boolean;\n  isSettingOnErrorV2?: boolean;\n}) =>\n  getOutputsWithErrorBody({\n    value,\n    isBatch,\n    isOpen: false,\n    isSettingOnErrorV2,\n  });\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type ValueExpression,\n  type OutputValueVO,\n} from '@coze-workflow/base/types';\nimport {\n  type FormDataTypeName,\n  type IFormItemMeta,\n  type ValidatorProps,\n} from '@flowgram-adapter/free-layout-editor';\n\nexport namespace TriggerForm {\n  export const TabName = 'tab';\n  export enum Tab {\n    Basic = 'basic',\n    Trigger = 'trigger',\n  }\n  export const TriggerFormName = 'trigger';\n  export const TriggerFormIsOpenName = 'isOpen';\n  export const TriggerFormEventTypeName = 'event';\n  export const TriggerFormEventIdName = 'eventID';\n  export const TriggerFormAppIdName = 'appID';\n  export const TriggerFormParametersName = 'parameters';\n  export const TriggerFormCronjobName = 'crontab';\n  export const TriggerFormCronjobTypeName = 'crontabType';\n  export const TriggerFormBindWorkflowName = 'workflowId';\n  export enum TriggerFormEventType {\n    Time = 'time',\n    Event = 'event',\n  }\n\n  export const getVariableName = (variable: OutputValueVO): string =>\n    `${variable?.type},${variable?.key ?? variable?.name}`;\n\n  export type Validation =\n    | 'requiredWhenTriggerOpenedAndSelectedTime'\n    | 'requiredWhenTriggerOpenedAndSelectedEvent'\n    | 'required'\n    | 'cronValidateWhenTriggerOpenedAndSelectedTime'\n    | 'cronValidate';\n  export type ValidationFn = (props: ValidatorProps<any, any>) => string | true;\n\n  export interface FormItemMeta {\n    name: string;\n    label: string;\n    required?: boolean;\n    type: FormDataTypeName;\n    isInTriggerNode?: boolean;\n    setter: string;\n    setterProps?: {\n      defaultValue?: any;\n      size?: string;\n      [k: string]: any;\n    };\n    tooltip?: string;\n    hidden?: string | boolean; // '{{$values.tab === \"time\"}}'\n    validation?: Validation | ValidationFn;\n    otherAbilities?: IFormItemMeta['abilities'];\n    otherMetaProps?: { [k: string]: any };\n    otherDecoratorProps?: { [k: string]: any };\n  }\n\n  export type FormMeta = FormItemMeta[];\n\n  // form value\n  export interface FormValue {\n    [TriggerFormIsOpenName]?: boolean;\n    [TriggerFormEventTypeName]?: TriggerFormEventType;\n    [k: string]: any;\n  }\n}\n\nexport enum CronJobType {\n  Cronjob = 'cronjob',\n  Selecting = 'selecting',\n}\n\nexport interface CronJobValue {\n  type?: CronJobType;\n  content?: ValueExpression;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { variableUtils } from '@coze-workflow/variable';\nimport {\n  type DTODefine,\n  type VariableMetaDTO,\n  ViewVariableType,\n} from '@coze-workflow/base';\n\nexport const getInputTypeBase = (inputType: ViewVariableType) => {\n  const viewType = ViewVariableType.getLabel(inputType);\n\n  return {\n    inputType,\n    viewType,\n    disabledTypes: undefined,\n  };\n};\n\nexport const getInputType = (input: DTODefine.InputVariableDTO) => {\n  const { type: inputType } = variableUtils.dtoMetaToViewMeta(\n    input as VariableMetaDTO,\n  );\n\n  return getInputTypeBase(inputType);\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { QueryClient } from '@tanstack/react-query';\nimport {\n  captureException,\n  RESPONSE_FORMAT_NAME,\n  ResponseFormat,\n} from '@coze-workflow/base';\nimport { logger } from '@coze-arch/logger';\nimport { I18n } from '@coze-arch/i18n';\nimport { ModelScene } from '@coze-arch/bot-api/playground_api';\nimport {\n  type GetTypeListRequest,\n  type Model,\n  type ModelParameter,\n} from '@coze-arch/bot-api/developer_api';\nimport { DeveloperApi as developerApi } from '@coze-arch/bot-api';\n\nimport { getLLMModelIds } from './get-llm-model-ids';\n\n/** Default response format value */\nexport const getDefaultResponseFormat = () => ({\n  name: RESPONSE_FORMAT_NAME,\n  label: I18n.t('model_config_response_format'),\n  desc: I18n.t('model_config_response_format_explain'),\n  type: 2,\n  min: '',\n  max: '',\n  precision: 0,\n  default_val: {\n    default_val: '0',\n  },\n  options: [\n    {\n      label: I18n.t('model_config_history_text'),\n      value: '0',\n    },\n    {\n      label: I18n.t('model_config_history_markdown'),\n      value: '1',\n    },\n  ],\n  param_class: {\n    class_id: 2,\n  },\n});\n\nconst queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      staleTime: Infinity,\n    },\n  },\n});\n\n/**\n * 1. Complete the response_format parameter items for each model in the model list\n * 2. hardcoding settings response_format default value is JSON\n * @param modelList\n * @Returns List of models after completing response_format parameters\n */\nconst repairResponseFormatInModelList = (modelList: Model[]) => {\n  // Find the first response_format item model_params in the model list\n  // This code is taken from the following loop and does not need to be evaluated every time\n  const modelHasResponseFormatItem = modelList\n    .find(_m => _m.model_params?.find(p => p.name === RESPONSE_FORMAT_NAME))\n    ?.model_params?.find(p => p.name === RESPONSE_FORMAT_NAME);\n\n  return modelList.map(m => {\n    // Compatible with unflashed data on the backend, it will be added without responseFormat.\n    const responseFormat = m.model_params?.find(\n      p => p?.name === RESPONSE_FORMAT_NAME,\n    ) as ModelParameter;\n\n    if (!responseFormat) {\n      if (modelHasResponseFormatItem) {\n        m.model_params?.push(modelHasResponseFormatItem as ModelParameter);\n      } else {\n        // Fill in a default response_format parameter\n        m.model_params?.push(getDefaultResponseFormat());\n      }\n    }\n\n    // At this point, find the responseFormat again, because the responseFormat is completed above.\n    const newResponseFormat = m.model_params?.find(\n      p => p?.name === RESPONSE_FORMAT_NAME,\n    ) as ModelParameter;\n\n    // Reset the default value to JSON\n    Object.keys(newResponseFormat?.default_val ?? {}).forEach(k => {\n      newResponseFormat.default_val[k] = ResponseFormat.JSON;\n    });\n\n    if (newResponseFormat) {\n      // Reset options, text markdown json must be supported\n      newResponseFormat.options = [\n        {\n          label: I18n.t('model_config_history_text'),\n          value: ResponseFormat.Text,\n        },\n        {\n          label: I18n.t('model_config_history_markdown'),\n          value: ResponseFormat.Markdown,\n        },\n        {\n          label: I18n.t('model_config_history_json'),\n          value: ResponseFormat.JSON,\n        },\n      ] as unknown as ModelParameter[];\n    }\n\n    return m;\n  });\n};\n\nexport const getLLMModels = async ({\n  info,\n  spaceId,\n  document,\n  isBindDouyin,\n}): Promise<Model[]> => {\n  try {\n    const modelList = await queryClient.fetchQuery({\n      queryKey: ['llm-model'],\n      queryFn: async () => {\n        const schema = JSON.parse(info?.schema_json || '{}');\n\n        const llmModelIds = getLLMModelIds(schema, document);\n\n        const getTypeListParams: GetTypeListRequest = {\n          space_id: spaceId,\n          model: true,\n          cur_model_ids: llmModelIds,\n        };\n\n        if (isBindDouyin) {\n          getTypeListParams.model_scene = ModelScene.Douyin;\n        }\n\n        const resp = await developerApi.GetTypeList(getTypeListParams);\n        const _modelList: Model[] = resp?.data?.model_list ?? [];\n\n        // From here to return modelList is all about wiping the butt of the backend\n        // There is hard code here, you need to set the default value of the output format to JSON\n        return repairResponseFormatInModelList(_modelList);\n      },\n      staleTime: 3000,\n    });\n    return modelList;\n  } catch (error) {\n    logger.error({\n      error: error as Error,\n      eventName: 'api/bot/get_type_list fetch error',\n    });\n    // Report a js error\n    captureException(\n      new Error(\n        I18n.t('workflow_detail_error_message', {\n          msg: 'fetch error',\n        }),\n      ),\n    );\n    // Return empty array\n    return [];\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type WorkflowNodeJSON,\n  type WorkflowJSON,\n  type WorkflowDocument,\n} from '@flowgram-adapter/free-layout-editor';\nimport { type WorkflowNodeRegistry } from '@coze-workflow/base';\n\n/**\n * Get the large model id according to the getLLMModelIdsByNodeJSON method defined in node meta\n * @param nodeJSON\n * @param ids\n * @param document\n */\nfunction getLLMModelIdsByNodeJSON(\n  nodeJSON: WorkflowNodeJSON,\n  ids: string[],\n  document: WorkflowDocument,\n) {\n  const registry = document.getNodeRegistry(\n    nodeJSON.type,\n  ) as WorkflowNodeRegistry;\n\n  const res = registry?.meta?.getLLMModelIdsByNodeJSON?.(nodeJSON);\n\n  if (res) {\n    const modelIds = Array.isArray(res) ? res : [res];\n    modelIds.filter(Boolean).forEach(modelId => {\n      const idstr = `${modelId}`;\n      if (!ids.includes(idstr)) {\n        ids.push(idstr);\n      }\n    });\n  }\n\n  if (nodeJSON.blocks) {\n    nodeJSON.blocks.forEach(block =>\n      getLLMModelIdsByNodeJSON(block, ids, document),\n    );\n  }\n}\n\n/**\n * Get model ids\n * @param json\n * @param document\n * @returns\n */\nexport function getLLMModelIds(\n  json: WorkflowJSON,\n  document: WorkflowDocument,\n): string[] {\n  const ids = [];\n\n  if (!document) {\n    return ids;\n  }\n\n  json.nodes.forEach(node => {\n    getLLMModelIdsByNodeJSON(node, ids, document);\n  });\n  return ids;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { groupBy, sortBy } from 'lodash-es';\nimport { type DTODefine } from '@coze-workflow/base';\n\nexport type InputVariableDTO = DTODefine.InputVariableDTO;\n\n/**\n * Sort the input parameters, then group them by required fields, and put the required fields at the front\n * @param inputs\n * @param groupKey\n * @param sortKey\n * @returns\n */\nexport const getSortedInputParameters = <\n  T extends { name?: string; required?: boolean },\n>(\n  inputs: T[],\n  groupKey = 'required',\n  sortKey = 'name',\n): T[] => {\n  const processedItems = (inputs || []).map(item => ({\n    ...item,\n    required: item.required !== undefined ? item.required : false, // Default setting is false\n  }));\n\n  // Group by required attributes first\n  const grouped = groupBy(processedItems, groupKey);\n\n  // Sort by name attribute within each group\n  const sortedTrueGroup = sortBy(grouped.true, sortKey) || [];\n  const sortedFalseGroup = sortBy(grouped.false, sortKey) || [];\n\n  // Merge true and false groupings\n  const mergedArray = [...sortedTrueGroup, ...sortedFalseGroup];\n\n  return mergedArray;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { mapValues, keyBy, snakeCase, isString, camelCase } from 'lodash-es';\nimport {\n  GenerationDiversity,\n  VariableTypeDTO,\n  type InputValueDTO,\n} from '@coze-workflow/base';\nimport { ModelParamType, type Model } from '@coze-arch/bot-api/developer_api';\n\nimport { DEFAULT_MODEL_TYPE } from '../constants';\n\nconst getDefaultModels = (modelMeta: Model): Record<string, unknown> => {\n  const defaultModel: Record<string, unknown> = {};\n\n  modelMeta?.model_params?.forEach(p => {\n    const k = camelCase(p.name) as string;\n    const { type } = p;\n\n    // Priority to take the balance, custom bottom line\n    const defaultValue =\n      p.default_val[GenerationDiversity.Balance] ??\n      p.default_val[GenerationDiversity.Customize];\n\n    if (defaultValue !== undefined) {\n      if (\n        [ModelParamType.Float, ModelParamType.Int].includes(type) ||\n        ['modelType'].includes(k)\n      ) {\n        defaultModel[k] = Number(defaultValue);\n      }\n    }\n  });\n\n  return defaultModel;\n};\n\n/**\n * Format model data to convert specific strings to numbers according to modelMeta\n * @param model\n * @param modelMeta\n * @returns\n */\nexport const formatModelData = (\n  model: Record<string, unknown>,\n  modelMeta: Model | undefined,\n): Record<string, unknown> => {\n  const modelParamMap = keyBy(modelMeta?.model_params ?? [], 'name');\n  return mapValues(model, (value, key) => {\n    const modelParam = modelParamMap[snakeCase(key)];\n    if (!modelParam || !isString(value)) {\n      return value;\n    }\n\n    const { type } = modelParam;\n\n    if (\n      [ModelParamType.Float, ModelParamType.Int].includes(type) ||\n      ['modelType'].includes(key)\n    ) {\n      return Number(value);\n    }\n\n    return value;\n  });\n};\n\nexport const getDefaultLLMParams = (\n  models: Model[],\n): Record<string, unknown> => {\n  const modelMeta =\n    models.find(m => m.model_type === DEFAULT_MODEL_TYPE) ?? models[0];\n\n  const llmParam = {\n    modelType: modelMeta?.model_type,\n    modelName: modelMeta?.name,\n    generationDiversity: GenerationDiversity.Balance,\n    ...getDefaultModels(modelMeta),\n  };\n\n  return llmParam;\n};\n\nexport const reviseLLMParamPair = (d: InputValueDTO): [string, unknown] => {\n  let k = d?.name || '';\n\n  if (k === 'modleName') {\n    k = 'modelName';\n  }\n  let v = d.input.value.content;\n  if (\n    [VariableTypeDTO.float, VariableTypeDTO.integer].includes(\n      d.input.type as VariableTypeDTO,\n    )\n  ) {\n    v = Number(d.input.value.content);\n  }\n\n  return [k, v];\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isBoolean, isInteger, isNumber, isNil, get, set } from 'lodash-es';\nimport {\n  type SetterOrDecoratorContext,\n  type IFormItemMeta,\n} from '@flowgram-adapter/free-layout-editor';\nimport { FlowNodeBaseType } from '@flowgram-adapter/free-layout-editor';\nimport { nanoid } from '@flowgram-adapter/free-layout-editor';\nimport { variableUtils } from '@coze-workflow/variable';\nimport {\n  type InputValueVO,\n  type LiteralExpression,\n  ValueExpressionType,\n  BatchMode,\n  type BatchDTO,\n  type BatchVO,\n  ViewVariableType,\n  type BatchVOInputList,\n  type ValueExpression,\n} from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { settingOnErrorInit, settingOnErrorSave } from '../setting-on-error';\nimport {\n  DEFAULT_BATCH_CONCURRENT_SIZE,\n  DEFAULT_BATCH_SIZE,\n} from '../constants';\nexport namespace nodeUtils {\n  export const INPUT_PARAMS_PATH = 'inputs.inputParameters';\n  const BATCH_MODE_PATH = 'inputs.batchMode';\n  const BATCH_PATH = 'inputs.batch';\n  const SETTING_ON_ERROR_PATH = 'inputs.settingOnError';\n  const NODE_SETTING_ON_ERROR_PATH = 'settingOnError';\n\n  export type MapToArrayHandler<MapItem, ArrayItem> = (\n    key: string,\n    value: MapItem,\n  ) => ArrayItem;\n  export type ArrayToMapHandler<ArrayItem, MapItem> = (\n    item: ArrayItem,\n  ) => MapItem;\n\n  export function mapToArray<\n    MapItem = InputValueVO['input'],\n    ArrayItem = InputValueVO,\n  >(\n    map: Record<string, MapItem>,\n    handle: MapToArrayHandler<MapItem, ArrayItem>,\n  ) {\n    return Object.keys(map).map((key: string) => handle(key, map[key]));\n  }\n\n  export function arrayToMap<\n    ArrayItem = InputValueVO,\n    MapItem = InputValueVO['input'],\n  >(\n    array: ArrayItem[],\n    key: keyof ArrayItem,\n    handler: ArrayToMapHandler<ArrayItem, MapItem>,\n  ) {\n    const map: Record<string, MapItem> = {};\n    array.forEach((item: ArrayItem): void => {\n      map[item[key] as string] = handler(item);\n    });\n    return map;\n  }\n\n  export function batchToDTO(\n    batchVO: BatchVO | undefined,\n    nodeFormContext: any,\n  ): BatchDTO | undefined {\n    if (!batchVO) {\n      return;\n    }\n\n    const {\n      playgroundContext: { variableService },\n    } = nodeFormContext;\n\n    const {\n      batchSize = DEFAULT_BATCH_SIZE,\n      concurrentSize = DEFAULT_BATCH_CONCURRENT_SIZE,\n      inputLists,\n    } = batchVO;\n    const inputListsDTO = inputLists.map(inputList => ({\n      name: inputList.name,\n      input: variableUtils.valueExpressionToDTO(\n        inputList.input,\n        variableService,\n        {\n          node: nodeFormContext?.node,\n        },\n      ),\n    }));\n    return {\n      batchSize,\n      concurrentSize,\n      inputLists: inputListsDTO,\n    };\n  }\n\n  export function batchToVO(\n    batchDTO: BatchDTO | undefined,\n    nodeFormContext: any,\n  ): BatchVO | undefined {\n    if (!batchDTO) {\n      return;\n    }\n    const {\n      playgroundContext: { variableService },\n    } = nodeFormContext;\n    const { batchSize, concurrentSize, inputLists } = batchDTO;\n    const inputListsVO = (inputLists || []).map(inputList => ({\n      name: inputList.name,\n      id: inputList.id,\n      input: variableUtils.valueExpressionToVO(\n        inputList.input,\n        variableService,\n      ),\n    }));\n    return {\n      batchSize,\n      concurrentSize,\n      inputLists: inputListsVO as BatchVOInputList[],\n    };\n  }\n\n  /**\n   * @Deprecated using variableUtils.valueExpressionToDTO)\n   * @param value\n   * @param nodeFormContext\n   * @returns\n   */\n  export function refExpressionToValueDTO(\n    value: ValueExpression,\n    nodeFormContext: any,\n  ) {\n    if (!value) {\n      return;\n    }\n    const {\n      playgroundContext: { variableService },\n    } = nodeFormContext;\n\n    return {\n      input: variableUtils.valueExpressionToDTO(value, variableService, {\n        node: nodeFormContext?.node,\n      }),\n    };\n  }\n\n  /**\n   * @Deprecated using variableUtils.valueExpressionToDTO\n   * @param value\n   * @returns\n   */\n  export function literalExpressionToValueDTO(value: LiteralExpression) {\n    if (isNil(value)) {\n      return;\n    }\n\n    return {\n      type: variableUtils.getLiteralExpressionValueDTOType(value.content),\n      value: {\n        type: 'literal',\n        content: !isNil(value.content) ? String(value.content) : '',\n      },\n    };\n  }\n\n  export function getLiteralExpressionViewVariableType(\n    content: LiteralExpression['content'],\n  ) {\n    if (isNil(content)) {\n      return ViewVariableType.String;\n    }\n    if (isInteger(content)) {\n      return ViewVariableType.Integer;\n    } else if (isNumber(content)) {\n      return ViewVariableType.Number;\n    } else if (isBoolean(content)) {\n      return ViewVariableType.Boolean;\n    } else {\n      return ViewVariableType.String;\n    }\n  }\n\n  /**\n   * @deprecated using variableUtils.valueExpressionToVO\n   * @param value\n   * @param nodeFormContext\n   * @returns\n   */\n  export function refExpressionDTOToVO(value: any, nodeFormContext: any) {\n    if (isNil(value)) {\n      return;\n    }\n    const {\n      playgroundContext: { variableService },\n    } = nodeFormContext;\n    return variableUtils.valueExpressionToVO(value.input, variableService);\n  }\n\n  /**\n   * @deprecated using variableUtils.valueExpressionToVO\n   * @param input\n   * @returns\n   */\n  export function literalExpressionDTOToVO(input: any) {\n    if (isNil(input)) {\n      return;\n    }\n    const { type, value } = input;\n\n    return {\n      type: 'literal',\n      content: variableUtils.getLiteralValueWithType(type, value?.content),\n    };\n  }\n\n  // Get the default value of batch order item\n  export function getBatchInputListFormDefaultValue(index: number) {\n    return {\n      name: `item${index}`,\n      id: nanoid(),\n      input: {\n        type: ValueExpressionType.REF,\n      },\n    };\n  }\n\n  // Node support batch\n  export function getBatchModeFormMeta(isBatchV2: boolean): IFormItemMeta {\n    // TODO DELETE schemaGray temporary field, backend grey release brush data mark, delete after full amount\n    return {\n      name: 'batchMode',\n      type: 'string',\n      default: 'single',\n      abilities: [\n        {\n          type: 'setter',\n          options: {\n            key: 'Radio',\n            type: 'button',\n            options: [\n              {\n                value: 'single',\n                label: I18n.t('workflow_batch_tab_single_radio'),\n              },\n              {\n                value: 'batch',\n                label: I18n.t('workflow_batch_tab_batch_radio'),\n                disabled: (context: SetterOrDecoratorContext) => {\n                  const { node } = context;\n                  if (\n                    node.parent?.flowNodeType === FlowNodeBaseType.SUB_CANVAS\n                  ) {\n                    return true;\n                  }\n                },\n              },\n            ],\n          },\n        },\n        {\n          type: 'decorator',\n          options: {\n            key: 'FormCard',\n            collapsible: false,\n          },\n        },\n        {\n          type: 'visibility',\n          options: {\n            hidden: isBatchV2,\n          },\n        },\n      ],\n    };\n  }\n\n  // formValueToDto & dtoToFormValue only migrates the adaptation of inputParameters and batch in api-node\n  export function formValueToDto(value: any, context) {\n    const inputParams = get(value, INPUT_PARAMS_PATH);\n    const formattedInputParams = inputParams\n      ? nodeUtils.mapToArray(inputParams, (key, mapValue) => ({\n          name: key,\n          input: mapValue,\n        }))\n      : [];\n\n    const batchMode = get(value, BATCH_MODE_PATH);\n    const batch = get(value, BATCH_PATH);\n\n    const formattedBatch =\n      batchMode === BatchMode.Batch\n        ? {\n            batchEnable: true,\n            ...nodeUtils.batchToDTO(batch, context),\n          }\n        : undefined;\n\n    set(value, INPUT_PARAMS_PATH, formattedInputParams);\n    set(value, BATCH_PATH, formattedBatch);\n    set(value, BATCH_MODE_PATH, undefined);\n    set(value, SETTING_ON_ERROR_PATH, settingOnErrorSave(value).settingOnError);\n    return value;\n  }\n\n  export function dtoToformValue(value, context) {\n    const inputParams = get(value, INPUT_PARAMS_PATH);\n    if (!inputParams || !Array.isArray(inputParams)) {\n      return value;\n    }\n    const formattedInputParams = nodeUtils.arrayToMap(\n      inputParams,\n      'name',\n      (arrayItem: InputValueVO) => arrayItem.input,\n    );\n\n    const batch = get(value, BATCH_PATH);\n\n    const formattedBatchMode = batch?.batchEnable\n      ? BatchMode.Batch\n      : BatchMode.Single;\n    const formattedBatch = batch?.batchEnable\n      ? nodeUtils.batchToVO(batch, context)\n      : undefined;\n\n    set(value, INPUT_PARAMS_PATH, formattedInputParams);\n    set(value, BATCH_MODE_PATH, formattedBatchMode);\n    set(value, BATCH_PATH, formattedBatch);\n    set(\n      value,\n      NODE_SETTING_ON_ERROR_PATH,\n      settingOnErrorInit(value).settingOnError,\n    );\n\n    return value;\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { z, type ZodSchema } from 'zod';\nimport {\n  ValueExpression,\n  ValueExpressionType,\n  type InputValueVO,\n} from '@coze-workflow/base/types';\nimport { I18n } from '@coze-arch/i18n';\nimport { type ValidatorProps } from '@flowgram-adapter/free-layout-editor';\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { type PlaygroundContext } from '@flowgram-adapter/free-layout-editor';\n\nimport { VARIABLE_NAME_REGEX } from '../constants';\n\ntype Path = string | number;\n\ninterface Issue {\n  path: Path[];\n  message: string;\n}\n\n/**\n * input tree validator\n */\nexport class InputTreeValidator {\n  private node: FlowNodeEntity;\n  private playgroundContext: PlaygroundContext;\n  private issues: Issue[] = [];\n  constructor(node: FlowNodeEntity, playgroundContext: PlaygroundContext) {\n    this.node = node;\n    this.playgroundContext = playgroundContext;\n  }\n\n  /**\n   * check function\n   * @param inputalues\n   * @reurns\n   */\n  validate(inputValues: InputValueVO[]): Issue[] {\n    this.issues = [];\n    this.validateInputValues(inputValues);\n    return this.issues;\n  }\n\n  /**\n   * Validate multiple inputs\n   * @param inputValues\n   * @param path\n   * @returns\n   */\n  private validateInputValues(inputValues: InputValueVO[], path: Path[] = []) {\n    if (!inputValues) {\n      return;\n    }\n\n    for (let i = 0; i < inputValues.length; i++) {\n      const inputValue = inputValues[i] || {};\n      const rules = {\n        name: this.validateName,\n        input: this.validateInput,\n      };\n\n      Object.keys(rules).forEach(key => {\n        const message = rules[key].bind(this)({\n          value: inputValue[key],\n          values: inputValues,\n        });\n\n        if (message) {\n          this.issues.push({\n            message,\n            path: path.concat(i, key),\n          });\n        }\n      });\n\n      const children = inputValues[i]?.children || [];\n      // Recursively check sub-node\n      this.validateInputValues(children, path.concat(i, 'children'));\n    }\n  }\n\n  /**\n   * input name validation\n   */\n  private validateName({ value, values }) {\n    if (!value) {\n      return I18n.t('workflow_detail_node_error_name_empty');\n    }\n\n    const names = values.map(v => v.name).filter(Boolean);\n    // name format verification\n    if (!VARIABLE_NAME_REGEX.test(value)) {\n      return I18n.t('workflow_detail_node_error_format');\n    }\n\n    // duplicate name verification\n    const foundSames = names.filter((name: string) => name === value);\n\n    return foundSames.length > 1\n      ? I18n.t('workflow_detail_node_input_duplicated')\n      : undefined;\n  }\n\n  /**\n   * input value validation\n   */\n  private validateInput({ value }) {\n    const { variableValidationService } = this.playgroundContext;\n\n    // check null value\n    if (ValueExpression.isEmpty(value)) {\n      return I18n.t('workflow_detail_node_error_empty');\n    }\n\n    if (value?.type === ValueExpressionType.REF) {\n      return variableValidationService.isRefVariableEligible(value, this.node);\n    }\n  }\n}\n\nexport function inputTreeValidator(params: ValidatorProps<InputValueVO>) {\n  const {\n    value,\n    context: { playgroundContext, node },\n  } = params;\n  const validator = new InputTreeValidator(node, playgroundContext);\n\n  const InputTreeNodeSchema: ZodSchema<any> = z.lazy(() =>\n    z\n      .object({\n        name: z.string().optional(),\n        input: z.any(),\n        children: z.array(InputTreeNodeSchema).optional(),\n      })\n      .passthrough(),\n  );\n\n  const InputTreeSchema = z\n    .array(InputTreeNodeSchema)\n    .superRefine((data, ctx) => {\n      const issues = validator.validate(data);\n\n      issues.forEach(issue => {\n        ctx.addIssue({\n          path: issue.path,\n          message: issue.message,\n          // FIXME: The underlying layer of form validation relies on validation/code, so it won't work if you remove it.\n          validation: 'regex',\n          code: 'invalid_string',\n        });\n      });\n    });\n\n  const parsed = InputTreeSchema.safeParse(value);\n\n  if (!parsed.success) {\n    return JSON.stringify((parsed as any).error);\n  }\n\n  return true;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { z } from 'zod';\nimport { I18n } from '@coze-arch/i18n';\nimport { type ValidatorProps } from '@flowgram-adapter/free-layout-editor';\n\nconst NodeMetaSchema = z.object({\n  title: z\n    .string({\n      required_error: I18n.t('workflow_detail_node_name_error_empty'),\n    })\n    .min(1, I18n.t('workflow_detail_node_name_error_empty'))\n    // .regex(\n    //   /^[a-zA-Z][a-zA-Z0-9_-]{0,}$/,\n    //   I18n.t('workflow_detail_node_error_format'),\n    // )\n    .regex(\n      /^.{0,63}$/,\n      I18n.t('workflow_derail_node_detail_title_max', {\n        max: '63',\n      }),\n    ),\n  icon: z.string().optional(),\n  subtitle: z.string().optional(),\n  description: z.string().optional(),\n});\n\ntype NodeMeta = z.infer<typeof NodeMetaSchema>;\n\nexport const nodeMetaValidator = ({\n  value,\n  context,\n}: ValidatorProps<NodeMeta>) => {\n  const { playgroundContext } = context;\n  function isTitleRepeated(title: string) {\n    if (!title) {\n      return false;\n    }\n\n    const { nodesService } = playgroundContext;\n    const nodes = nodesService\n      .getAllNodes()\n      .filter(node => nodesService.getNodeTitle(node) === title);\n\n    return nodes?.length > 1;\n  }\n\n  // Add Node Name Duplicate Validation\n  const schema = NodeMetaSchema.refine(\n    ({ title }: NodeMeta) => !isTitleRepeated(title),\n    {\n      message: I18n.t('workflow_node_title_duplicated'),\n      path: ['title'],\n    },\n  );\n  const parsed = schema.safeParse(value);\n\n  if (!parsed.success) {\n    return JSON.stringify((parsed as any).error);\n  }\n\n  return true;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Ajv from 'ajv';\nimport {\n  variableUtils,\n  generateInputJsonSchema,\n} from '@coze-workflow/variable';\nimport { type ViewVariableMeta } from '@coze-workflow/base';\nlet ajv;\nexport const jsonSchemaValidator = (\n  v: string,\n  viewVariableMeta: ViewVariableMeta,\n): boolean => {\n  if (!viewVariableMeta || !v) {\n    return true;\n  }\n\n  const dtoMeta = variableUtils.viewMetaToDTOMeta(viewVariableMeta);\n  const jsonSchema = generateInputJsonSchema(dtoMeta);\n  if (!jsonSchema) {\n    return true;\n  }\n  if (!ajv) {\n    ajv = new Ajv();\n  }\n  try {\n    const validate = ajv.compile(jsonSchema);\n    const valid = validate(JSON.parse(v));\n    return valid;\n    // eslint-disable-next-line @coze-arch/use-error-in-catch\n  } catch (error) {\n    // Parse failure indicates that it is not a legal value\n    return false;\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { z, type ZodSchema } from 'zod';\nimport { ViewVariableType } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { jsonSchemaValidator } from '../json-schema-validator';\n// Define Node Schema\nconst OutputTreeNodeSchema: ZodSchema<any> = z.lazy(() =>\n  z\n    .object({\n      name: z\n        .string({\n          required_error: I18n.t('workflow_detail_node_error_name_empty'),\n        })\n        .min(1, I18n.t('workflow_detail_node_error_name_empty'))\n        .regex(\n          /^(?!.*\\b(true|false|and|AND|or|OR|not|NOT|null|nil|If|Switch)\\b)[a-zA-Z_][a-zA-Z_$0-9]*$/,\n          I18n.t('workflow_detail_node_error_format'),\n        ),\n      type: z.number(),\n      children: z.array(OutputTreeNodeSchema).optional(),\n      defaultValue: z.any().optional(),\n    })\n    .passthrough(),\n);\n\nexport const OutputTreeSchema = z.array(OutputTreeNodeSchema);\n\n// Define a helper function to find nodes with duplicate names and return the error path\nconst findDuplicates = (nodes, path = []) => {\n  const seen = new Set();\n  let result: {\n    path: (string | number)[];\n    message: string;\n  };\n\n  for (let i = 0; i < nodes.length; i++) {\n    const { name } = nodes[i];\n    if (seen.has(name)) {\n      // Returns paths and error messages when duplicates are found\n      result = {\n        // @ts-expect-error -- linter-disable-autofix\n        path: path.concat(i, 'name'),\n        message: I18n.t('workflow_detail_node_error_variablename_duplicated'),\n      };\n      break;\n    }\n    seen.add(name);\n    if (nodes[i].children) {\n      // Recursively check sub-node\n      const found = findDuplicates(\n        nodes[i].children,\n        // @ts-expect-error -- linter-disable-autofix\n        path.concat(i, 'children'),\n      );\n      if (found) {\n        result = found;\n        break;\n      }\n    }\n  }\n  // @ts-expect-error -- linter-disable-autofix\n  return result;\n};\n\n// Define a sibling-named unique tree structure schema\nexport const OutputTreeUniqueNameSchema = z\n  .array(OutputTreeNodeSchema)\n  .refine(\n    data => {\n      // Check with a custom function\n      const duplicate = findDuplicates(data);\n      return !duplicate;\n    },\n    data => {\n      // Check with a custom function\n      const duplicate = findDuplicates(data);\n      return {\n        path: duplicate.path,\n        message: duplicate.message,\n        // FIXME: The underlying layer of form validation relies on validation/code, so it won't work if you remove it.\n        validation: 'regex',\n        code: 'invalid_string',\n      };\n    },\n  )\n  .superRefine((data, ctx) => {\n    // Check with a custom function\n    const issues = checkObjectDefaultValue(data);\n    issues.forEach(issue => {\n      ctx.addIssue({\n        path: issue.path,\n        message: issue.message,\n        // FIXME: The underlying layer of form validation relies on validation/code, so it won't work if you remove it.\n        validation: 'regex',\n        code: 'invalid_string',\n      });\n    });\n  });\n\nconst checkObjectDefaultValue = nodes => {\n  const result: Array<{\n    path: (string | number)[];\n    message: string;\n  }> = [];\n\n  for (let i = 0; i < nodes.length; i++) {\n    const { defaultValue, type } = nodes[i];\n    if (typeof defaultValue !== 'string' || !defaultValue) {\n      continue;\n    }\n    if (!ViewVariableType.isJSONInputType(type)) {\n      continue;\n    }\n    if (!jsonSchemaValidator(defaultValue, nodes[i])) {\n      // Returns paths and error messages when duplicates are found\n      result.push({\n        path: [i, 'defaultValue'],\n        message: I18n.t('workflow_debug_wrong_json'),\n      });\n    }\n    // The JSON type only checks the first layer, no recursive check is required\n  }\n  return result;\n};\n// export type alias\nexport type OutputTree = z.infer<typeof OutputTreeSchema>;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ValidatorProps } from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  OutputTreeSchema,\n  OutputTreeUniqueNameSchema,\n  type OutputTree,\n} from './schema';\n\nexport function outputTreeValidator(\n  params: ValidatorProps<\n    OutputTree,\n    {\n      uniqueName?: boolean;\n    }\n  >,\n) {\n  const { value, options } = params;\n  const { uniqueName = false } = options;\n  const parsed = uniqueName\n    ? OutputTreeUniqueNameSchema.safeParse(value)\n    : OutputTreeSchema.safeParse(value);\n\n  if (!parsed.success) {\n    return JSON.stringify((parsed as any).error);\n  }\n\n  return true;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { z } from 'zod';\nimport { type ValidatorProps } from '@flowgram-adapter/free-layout-editor';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { SettingOnErrorProcessType } from '../setting-on-error/types';\n\nconst SettingOnErrorSchema = z.object({\n  settingOnErrorIsOpen: z.boolean().optional(),\n  settingOnErrorJSON: z.string().optional(),\n  processType: z.number().optional(),\n});\n\ntype SettingOnError = z.infer<typeof SettingOnErrorSchema>;\n\nexport const settingOnErrorValidator = ({\n  value,\n}: ValidatorProps<SettingOnError>) => {\n  if (!value) {\n    return true;\n  }\n\n  function isJSONVerified(settingOnError: SettingOnError) {\n    if (settingOnError?.settingOnErrorIsOpen) {\n      if (\n        settingOnError?.processType &&\n        settingOnError?.processType !== SettingOnErrorProcessType.RETURN\n      ) {\n        return true;\n      }\n      try {\n        JSON.parse(settingOnError?.settingOnErrorJSON as string);\n        // eslint-disable-next-line @coze-arch/use-error-in-catch\n      } catch (e) {\n        return false;\n      }\n    }\n    return true;\n  }\n  // json legitimacy check\n  const schemeParesd = SettingOnErrorSchema.refine(\n    settingOnError => isJSONVerified(settingOnError),\n    {\n      message: I18n.t('workflow_exception_ignore_json_error'),\n    },\n  ).safeParse(value);\n\n  if (!schemeParesd.success) {\n    return JSON.stringify((schemeParesd as any).error);\n  }\n\n  return true;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { get, isEmpty, pick, set, isFunction } from 'lodash-es';\nimport { injectable } from 'inversify';\nimport {\n  PlaygroundContext,\n  lazyInject,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  type WorkflowNodeEntity,\n  type WorkflowDocument,\n  type WorkflowJSON,\n  type WorkflowJSONFormatContribution,\n  type WorkflowNodeJSON,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  WorkflowBatchService,\n  WorkflowVariableService,\n  variableUtils,\n  type ViewVariableMeta,\n} from '@coze-workflow/variable';\nimport {\n  StandardNodeType,\n  type BatchDTOInputList,\n  type InputValueDTO,\n  type InputValueVO,\n  type ValueExpressionDTO,\n  type VariableMetaDTO,\n} from '@coze-workflow/base';\n\nimport {\n  WorkflowNodeVariablesMeta,\n  type WorkflowNodeRegistry,\n} from './typings';\n\n/**\n * Transform form data globally, where variable generation logic is primarily handled\n */\n@injectable()\nexport class WorkflowJSONFormat implements WorkflowJSONFormatContribution {\n  @lazyInject(WorkflowVariableService)\n  declare variableService: WorkflowVariableService;\n  @lazyInject(PlaygroundContext) declare playgroundContext: PlaygroundContext;\n  @lazyInject(WorkflowBatchService) batchService: WorkflowBatchService;\n\n  protected getVariablesMeta(\n    nodeType: string | number,\n    document: WorkflowDocument,\n  ): WorkflowNodeVariablesMeta {\n    const { variablesMeta = WorkflowNodeVariablesMeta.DEFAULT } =\n      document.getNodeRegister<WorkflowNodeRegistry>(nodeType);\n    return variablesMeta || WorkflowNodeVariablesMeta.DEFAULT;\n  }\n\n  /**\n   * Convert node variable\n   * @param json\n   * @protected\n   */\n  protected formatOutputVariables(\n    json: WorkflowNodeJSON,\n    doc: WorkflowDocument,\n  ): void {\n    const variablesMeta = this.getVariablesMeta(json.type, doc);\n    if (json.data) {\n      variablesMeta.outputsPathList!.forEach(outputsPath => {\n        const variableMetas = get(json.data, outputsPath) as VariableMetaDTO[];\n        if (variableMetas && Array.isArray(variableMetas)) {\n          variableMetas.forEach((meta: VariableMetaDTO, index) => {\n            if (!meta.type) {\n              return;\n            }\n            const newData = variableUtils.dtoMetaToViewMeta(meta);\n            set(variableMetas, index, newData);\n          });\n        }\n      });\n    }\n  }\n\n  /**\n   * Compatible with historical data with only a single batch variable\n   */\n  protected transformBatchVariable(\n    json: WorkflowNodeJSON,\n    doc: WorkflowDocument,\n  ): void {\n    if (!json.data) {\n      return;\n    }\n    const input: ValueExpressionDTO = get(json.data, 'inputs.batch.inputList');\n    if (!input || isEmpty(input)) {\n      // No compatibility required\n      return;\n    }\n    const inputList: BatchDTOInputList = {\n      name: 'item', // According to PRD, just write it dead.\n      input,\n    };\n    // Filling in new data in JSON\n    json.data.inputs.batch.inputLists = [inputList];\n    // Delete old data\n    delete json.data.inputs.batch.inputList;\n  }\n\n  /**\n   * Fix variable reference logic\n   * @param json\n   * @param doc\n   * @protected\n   */\n  protected formatInputVariables(\n    json: WorkflowNodeJSON,\n    doc: WorkflowDocument,\n  ): void {\n    const variablesMeta = this.getVariablesMeta(json.type, doc);\n    if (json.data) {\n      variablesMeta.inputsPathList!.forEach(inputsPath => {\n        const inputValues: InputValueDTO[] = get(\n          json.data,\n          inputsPath,\n        ) as InputValueDTO[];\n        if (inputValues && Array.isArray(inputValues)) {\n          inputValues.map((inputValue, index) => {\n            set(\n              inputValues,\n              index,\n              variableUtils.inputValueToVO(inputValue, this.variableService),\n            );\n          });\n        }\n      });\n    }\n  }\n\n  /**\n   * Processing node metadata & static copy\n   * @param json\n   * @param doc\n   * @protected\n   */\n  protected formatNodeMeta(\n    json: WorkflowNodeJSON,\n    doc: WorkflowDocument,\n  ): void {\n    // The API plug-in node does not need to process copywriting for the time being.\n    if (\n      json?.type &&\n      [StandardNodeType.Api, StandardNodeType.SubWorkflow].includes(\n        json.type as StandardNodeType,\n      )\n    ) {\n      return;\n    }\n\n    const nodeMeta = get(json, 'data.nodeMeta');\n    // Latest configuration data pulled\n    const meta = this.playgroundContext.getNodeTemplateInfoByType(json.type);\n\n    if (\n      nodeMeta &&\n      typeof nodeMeta === 'object' &&\n      meta &&\n      typeof meta === 'object'\n    ) {\n      // Determined according to the backend configuration, the node metadata is not controlled by the user\n      const staticMeta = pick(meta, ['icon', 'subTitle']);\n\n      set(json, 'data.nodeMeta', {\n        ...nodeMeta,\n        ...staticMeta,\n      });\n    }\n  }\n\n  /**\n   * initialize node\n   * @param json\n   * @param doc\n   * @param isClone\n   */\n  formatNodeOnInit(\n    json: WorkflowNodeJSON,\n    doc: WorkflowDocument,\n    isClone?: boolean,\n  ): WorkflowNodeJSON {\n    // Non-cloning has been triggered in formatOnInit\n    if (!isClone) {\n      return json;\n    }\n    this.formatOutputVariables(json, doc);\n    this.formatInputVariables(json, doc);\n    return json;\n  }\n\n  /**\n   * commit node\n   * @param json\n   * @param doc\n   */\n  formatNodeOnSubmit(\n    json: WorkflowNodeJSON,\n    doc: WorkflowDocument,\n    node: WorkflowNodeEntity,\n  ): WorkflowNodeJSON {\n    const { nodeDTOType } = doc.getNodeRegister<WorkflowNodeRegistry>(\n      json.type,\n    ).meta;\n    const variablesMeta = this.getVariablesMeta(json.type, doc);\n    if (json.data) {\n      // Convert output\n      variablesMeta.outputsPathList!.forEach(outputsPath => {\n        const variableMetas = get(json.data, outputsPath) as ViewVariableMeta[];\n        if (variableMetas && Array.isArray(variableMetas)) {\n          variableMetas.forEach((meta: ViewVariableMeta, index) => {\n            if (!meta.type) {\n              return;\n            }\n            const newData = variableUtils.viewMetaToDTOMeta(meta);\n            set(variableMetas, index, newData);\n          });\n        }\n      });\n      // Conversion input\n      variablesMeta.inputsPathList!.forEach(inputsPath => {\n        const inputValues: InputValueVO[] = get(\n          json.data,\n          inputsPath,\n        ) as InputValueVO[];\n        if (inputValues && Array.isArray(inputValues)) {\n          inputValues.map((inputValue, index) => {\n            if (!inputValue) {\n              return;\n            }\n            set(\n              inputValues,\n              index,\n              variableUtils.inputValueToDTO(inputValue, this.variableService, {\n                node,\n              }),\n            );\n          });\n          // Filter out null values\n          set(json.data, inputsPath, inputValues.filter(Boolean));\n        }\n      });\n    }\n    json.type = String(nodeDTOType || json.type);\n    return json;\n  }\n  /**\n   * Convert variable data during initialization\n   * @param json\n   * @param document\n   */\n  formatOnInit(json: WorkflowJSON, document: WorkflowDocument): WorkflowJSON {\n    // Step0: batch compatible processing\n    json.nodes.forEach(node => this.transformBatchVariable(node, document));\n\n    // Step1: Create an output variable\n    json.nodes.forEach(node => this.formatOutputVariables(node, document));\n\n    // Step2: Handle input median conversion\n    json.nodes.forEach(node => this.formatInputVariables(node, document));\n\n    // Step3: Process static copy data such as node description & subTitle (not from the drop database data, but from the latest node data)\n    json.nodes.forEach(node => this.formatNodeMeta(node, document));\n    return json;\n  }\n\n  /**\n   * Convert variable data at commit time\n   * @param json\n   */\n  formatOnSubmit(json: WorkflowJSON, document: WorkflowDocument): WorkflowJSON {\n    json.nodes = (json.nodes || []).map(node => {\n      const registry = document.getNodeRegister<WorkflowNodeRegistry>(\n        node.type,\n      );\n      if (isFunction(registry?.beforeNodeSubmit)) {\n        return registry.beforeNodeSubmit(node);\n      }\n      return node;\n    });\n\n    console.log('------------------ save ----------------------', json);\n    return json;\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { injectable, multiInject, optional } from 'inversify';\nimport {\n  WorkflowDocument,\n  FlowNodeBaseType,\n  WorkflowLineEntity,\n  type WorkflowNodeEntity,\n  type WorkflowEdgeJSON,\n  type WorkflowJSON,\n  type WorkflowNodeJSON,\n  WorkflowJSONFormatContribution,\n} from '@flowgram-adapter/free-layout-editor';\nimport { compose } from '@flowgram-adapter/common';\n\n@injectable()\nexport class WorkflowDocumentWithFormat extends WorkflowDocument {\n  @multiInject(WorkflowJSONFormatContribution)\n  @optional()\n  protected jsonFormats: WorkflowJSONFormatContribution[] = [];\n\n  /**\n   * load from data\n   * @param json\n   */\n  fromJSON(json: Partial<WorkflowJSON>, fireRender = true): void {\n    const { flattenJSON, nodeBlocks, nodeEdges } = this.flatJSON(json);\n    const formattedJSON: WorkflowJSON = this.formatWorkflowJSON<WorkflowJSON>(\n      flattenJSON,\n      'formatOnInit',\n      this,\n    );\n    const nestedJSON = this.nestJSON(formattedJSON, nodeBlocks, nodeEdges);\n    super.fromJSON(nestedJSON, fireRender);\n  }\n\n  private _formatCache = new Map<string | number | symbol, any>();\n\n  /**\n   * Convert json\n   * @param json\n   * @param formatKey\n   * @param args\n   * @protected\n   */\n  protected formatWorkflowJSON<T>(\n    json: T,\n    formatKey: keyof WorkflowJSONFormatContribution,\n    ...args: any[]\n  ): T {\n    if (this._formatCache.has(formatKey)) {\n      return this._formatCache.get(formatKey)(json, ...args);\n    }\n    const fns: any[] = this.jsonFormats\n      .map(format =>\n        format[formatKey] ? format[formatKey]!.bind(format) : undefined,\n      )\n      .filter(f => Boolean(f));\n    const fn = compose<T>(...fns);\n    this._formatCache.set(formatKey, fn);\n    return fn(json, ...args);\n  }\n\n  /**\n   * Create process node\n   * @param json\n   */\n  createWorkflowNode(\n    json: WorkflowNodeJSON,\n    isClone?: boolean,\n    parentId?: string,\n  ): WorkflowNodeEntity {\n    json = this.formatWorkflowJSON<WorkflowNodeJSON>(\n      json,\n      'formatNodeOnInit',\n      this,\n      isClone,\n    );\n    return super.createWorkflowNode(json, isClone, parentId);\n  }\n\n  toNodeJSON(node: WorkflowNodeEntity): WorkflowNodeJSON {\n    const json = super.toNodeJSON(node);\n    // format\n    const formattedJSON = this.formatWorkflowJSON<WorkflowNodeJSON>(\n      json,\n      'formatNodeOnSubmit',\n      this,\n      node,\n    );\n    return formattedJSON;\n  }\n\n  /**\n   * export data\n   */\n  toJSON(): WorkflowJSON {\n    const rootJSON = this.toNodeJSON(this.root);\n    const json = this.formatWorkflowJSON(\n      {\n        nodes: rootJSON.blocks ?? [],\n        edges: rootJSON.edges ?? [],\n      },\n      'formatOnSubmit',\n      this,\n    );\n    return json;\n  }\n\n  private getEdgeID(edge: WorkflowEdgeJSON): string {\n    return WorkflowLineEntity.portInfoToLineId({\n      from: edge.sourceNodeID,\n      to: edge.targetNodeID,\n      fromPort: edge.sourcePortID,\n      toPort: edge.targetPortID,\n    });\n  }\n\n  /**\n   * Flatten the tree-shaped JSON structure and extract the structure information to the map.\n   */\n  private flatJSON(json: Partial<WorkflowJSON> = { nodes: [], edges: [] }): {\n    flattenJSON: WorkflowJSON;\n    nodeBlocks: Map<string, string[]>;\n    nodeEdges: Map<string, string[]>;\n  } {\n    const nodeBlocks = new Map<string, string[]>();\n    const nodeEdges = new Map<string, string[]>();\n    const rootNodes = json.nodes ?? [];\n    const rootEdges = json.edges ?? [];\n    const flattenNodeJSONs: WorkflowNodeJSON[] = [...rootNodes];\n    const flattenEdgeJSONs: WorkflowEdgeJSON[] = [...rootEdges];\n\n    const rootBlockIDs: string[] = rootNodes.map(node => node.id);\n    const rootEdgeIDs: string[] = rootEdges.map(edge => this.getEdgeID(edge));\n\n    nodeBlocks.set(FlowNodeBaseType.ROOT, rootBlockIDs);\n    nodeEdges.set(FlowNodeBaseType.ROOT, rootEdgeIDs);\n\n    // To support multi-layer structures, the following section is changed to recursive\n    rootNodes.forEach(nodeJSON => {\n      const { blocks, edges } = nodeJSON;\n      if (blocks) {\n        flattenNodeJSONs.push(...blocks);\n        const blockIDs: string[] = [];\n        blocks.forEach(block => {\n          blockIDs.push(block.id);\n        });\n        nodeBlocks.set(nodeJSON.id, blockIDs);\n        delete nodeJSON.blocks;\n      }\n      if (edges) {\n        flattenEdgeJSONs.push(...edges);\n        const edgeIDs: string[] = [];\n        edges.forEach(edge => {\n          const edgeID = this.getEdgeID(edge);\n          edgeIDs.push(edgeID);\n        });\n        nodeEdges.set(nodeJSON.id, edgeIDs);\n        delete nodeJSON.edges;\n      }\n    });\n\n    const flattenJSON: WorkflowJSON = {\n      nodes: flattenNodeJSONs,\n      edges: flattenEdgeJSONs,\n    };\n\n    return {\n      flattenJSON,\n      nodeBlocks,\n      nodeEdges,\n    };\n  }\n\n  /**\n   * Layering JSON\n   */\n  private nestJSON(\n    flattenJSON: WorkflowJSON,\n    nodeBlocks: Map<string, string[]>,\n    nodeEdges: Map<string, string[]>,\n  ): WorkflowJSON {\n    const nestJSON: WorkflowJSON = {\n      nodes: [],\n      edges: [],\n    };\n    const nodeMap = new Map<string, WorkflowNodeJSON>();\n    const edgeMap = new Map<string, WorkflowEdgeJSON>();\n    const rootBlockSet = new Set<string>(\n      nodeBlocks.get(FlowNodeBaseType.ROOT) ?? [],\n    );\n    const rootEdgeSet = new Set<string>(\n      nodeEdges.get(FlowNodeBaseType.ROOT) ?? [],\n    );\n\n    // Construct cache\n    flattenJSON.nodes.forEach(nodeJSON => {\n      nodeMap.set(nodeJSON.id, nodeJSON);\n    });\n\n    flattenJSON.edges.forEach(edgeJSON => {\n      const edgeID = this.getEdgeID(edgeJSON);\n      edgeMap.set(edgeID, edgeJSON);\n    });\n\n    // Restore hierarchical data\n    flattenJSON.nodes.forEach(nodeJSON => {\n      if (rootBlockSet.has(nodeJSON.id)) {\n        nestJSON.nodes.push(nodeJSON);\n      }\n      // Recovery blocks\n      if (nodeBlocks.has(nodeJSON.id)) {\n        const blockIDs = nodeBlocks.get(nodeJSON.id)!;\n        const blockJSONs: WorkflowNodeJSON[] = blockIDs\n          .map(blockID => nodeMap.get(blockID)!)\n          .filter(Boolean);\n        nodeJSON.blocks = blockJSONs;\n      }\n      // Restore edges\n      if (nodeEdges.has(nodeJSON.id)) {\n        const edgeIDs = nodeEdges.get(nodeJSON.id)!;\n        const edgeJSONs: WorkflowEdgeJSON[] = edgeIDs\n          .map(edgeID => edgeMap.get(edgeID)!)\n          .filter(Boolean);\n        nodeJSON.edges = edgeJSONs;\n      }\n    });\n\n    flattenJSON.edges.forEach(edgeJSON => {\n      const edgeID = this.getEdgeID(edgeJSON);\n      if (rootEdgeSet.has(edgeID)) {\n        nestJSON.edges.push(edgeJSON);\n      }\n    });\n\n    return nestJSON;\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ContainerModule } from 'inversify';\nimport {\n  WorkflowJSONFormatContribution,\n  WorkflowDocument,\n} from '@flowgram-adapter/free-layout-editor';\nimport { bindContributions } from '@flowgram-adapter/common';\n\nimport { WorkflowJSONFormat } from './workflow-json-format';\nimport { WorkflowDocumentWithFormat } from './workflow-document-with-format';\nimport { WorkflowNodesService } from './service';\n\nexport const WorkflowNodesContainerModule = new ContainerModule(\n  (bind, unbind, isBound, rebind) => {\n    bind(WorkflowNodesService).toSelf().inSingletonScope();\n    bindContributions(bind, WorkflowJSONFormat, [\n      WorkflowJSONFormatContribution,\n    ]);\n    // Compatible with old canvas documents\n    bind(WorkflowDocumentWithFormat).toSelf().inSingletonScope();\n    rebind(WorkflowDocument).toService(WorkflowDocumentWithFormat);\n  },\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState, useRef, useMemo } from 'react';\n\nimport { debounce } from 'lodash-es';\nimport classNames from 'classnames';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { IconSearch } from '@douyinfe/semi-icons';\nimport { PUBLIC_SPACE_ID } from '@coze-workflow/base/constants';\nimport { concatTestId } from '@coze-workflow/base';\nimport {\n  IntelligenceStatus,\n  IntelligenceType,\n} from '@coze-arch/idl/intelligence_api';\nimport { I18n } from '@coze-arch/i18n';\nimport { Typography, Spin, Avatar, Select } from '@coze-arch/bot-semi';\nimport { intelligenceApi } from '@coze-arch/bot-api';\nimport { Tag, Tooltip } from '@coze-arch/coze-design';\n\nimport { ChatflowService } from '@/services';\n\nimport { useGlobalState, useRelatedBotService } from '../../hooks';\nimport { isItemDisabled } from './utils';\nimport { useExtraBotOption } from './use-extra-bot-option';\nimport type {\n  IBotSelectOption,\n  IBotSelectOptions,\n  ValueType,\n  DisableExtraOptions,\n} from './types';\n\nimport styles from './bots.module.less';\n\nconst RenderCustomOption = (\n  item: IBotSelectOption | undefined,\n  extraOptions: DisableExtraOptions,\n) => {\n  if (!item) {\n    return null;\n  }\n\n  const {\n    disableBot,\n    disableProject,\n    disableBotTooltip,\n    disableProjectTooltip,\n  } = extraOptions;\n\n  const isBot = item.type === IntelligenceType.Bot;\n  const disabled = isItemDisabled({ disableBot, disableProject }, item.type);\n\n  const disabledTooltip =\n    isBot && disableBot ? disableBotTooltip : disableProjectTooltip;\n\n  const renderOptionItem = optionItem => (\n    <div className=\"flex\" style={{ width: '100%', alignItems: 'center' }}>\n      <Avatar\n        size=\"extra-extra-small\"\n        style={{ flexShrink: 0, marginRight: 8 }}\n        shape=\"square\"\n        src={optionItem.avatar}\n      />\n      <div className=\"flex\" style={{ flexGrow: 1, flexShrink: 1, width: 0 }}>\n        <Typography.Text\n          ellipsis={{ showTooltip: true }}\n          style={{\n            fontSize: 12,\n            color: '#1D1C23',\n            fontWeight: 400,\n          }}\n        >\n          {optionItem.name}\n        </Typography.Text>\n      </div>\n      {optionItem.type === IntelligenceType.Project ? (\n        <Tag size=\"mini\" color=\"primary\">\n          {I18n.t('wf_chatflow_106')}\n        </Tag>\n      ) : (\n        <Tag size=\"mini\" color=\"primary\">\n          {I18n.t('wf_chatflow_107')}\n        </Tag>\n      )}\n    </div>\n  );\n\n  return (\n    <Select.Option\n      data-testid={concatTestId(\n        'workflow',\n        'playground',\n        'testrun',\n        'bot-select',\n        'option',\n        item.value,\n      )}\n      value={item.value}\n      showTick={true}\n      key={item.value}\n      disabled={disabled}\n      className={classNames(\n        styles['bot-option'],\n        disabled ? styles['bot-option-disabled'] : '',\n      )}\n    >\n      {disabled ? (\n        <Tooltip content={disabledTooltip} position=\"left\">\n          {renderOptionItem(item)}\n        </Tooltip>\n      ) : (\n        renderOptionItem(item)\n      )}\n    </Select.Option>\n  );\n};\n\nexport const RenderFootLoading = ({\n  onObserver,\n}: {\n  onObserver: () => Promise<void>;\n}) => {\n  const indicatorRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    const callback = entries => {\n      if (entries[0].isIntersecting) {\n        onObserver?.();\n      }\n    };\n    const loadingObserver = new IntersectionObserver(callback);\n    indicatorRef.current && loadingObserver.observe(indicatorRef.current);\n    return () => loadingObserver.disconnect();\n  }, []);\n  return (\n    <div className={styles['loading-tag']} ref={indicatorRef}>\n      <Spin style={{ marginRight: 10 }} size=\"small\" />\n      <span>{I18n.t('workflow_add_common_loading')}</span>\n    </div>\n  );\n};\n\ninterface BotsProps {\n  isBot: boolean;\n  value?: ValueType;\n  onChange?: (value?: ValueType) => void;\n}\n\nexport const Bots: React.FC<BotsProps & DisableExtraOptions> = ({\n  isBot,\n  value,\n  onChange,\n  disableBot = false,\n  disableProject = false,\n  disableBotTooltip = '',\n  disableProjectTooltip = '',\n  ...props\n}) => {\n  const idValue = value?.id;\n  const globalState = useGlobalState();\n  const DebounceTime = 500;\n  const chatflowService = useService<ChatflowService>(ChatflowService);\n  const relatedBotService = useRelatedBotService();\n\n  const isLoadMoreDate = useRef(false);\n  const [selectList = [], setSelectList] = useState<IBotSelectOptions>([]);\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [isShowFoot, setIsShowFoot] = useState<boolean>(false);\n  const [search, setSearch] = useState<string>('');\n  const [searchTotal, setTotal] = useState(0);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const nextCursorRef = useRef<string | undefined>();\n\n  const useNewGlobalVariableCache = !globalState.isInIDE;\n\n  const handleChange = (botInfo?: IBotSelectOption, _value?: ValueType) => {\n    chatflowService.setSelectItem(botInfo);\n    onChange?.(_value);\n  };\n\n  // Due to paging restrictions, the selected botId may not find the corresponding option and needs to be added\n  const extraBotOption = useExtraBotOption(\n    selectList,\n    idValue,\n    isBot,\n    handleChange,\n  );\n\n  // The total number obtained by the interface is not the real total, and the front end may splice options.\n  const listMaxHeight = useMemo(() => {\n    const realTotal = extraBotOption ? searchTotal + 1 : searchTotal;\n    // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n    return realTotal < 7 ? realTotal * 32 : 208;\n  }, [searchTotal, extraBotOption]);\n\n  useEffect(() => {\n    fetchBotList();\n  }, []);\n\n  useEffect(() => {\n    const findItem = selectList?.find(item => item.value === value?.id);\n    const disabled = isItemDisabled(\n      { disableBot, disableProject },\n      findItem?.type,\n    );\n    // Clear the selected value when disabled\n    if (value && findItem?.type && disabled) {\n      onChange?.(undefined);\n    }\n    if (value?.id !== chatflowService.selectItem?.value) {\n      if (!value) {\n        chatflowService.setSelectItem(undefined);\n        return;\n      }\n      if (findItem) {\n        chatflowService.setSelectItem(findItem);\n      }\n    }\n  }, [value, selectList]);\n\n  const fetchBotList = async (query?: string, isReset = false) => {\n    if (query) {\n      setIsLoading(true);\n    }\n    if (isReset) {\n      // If it is a re-search, you need to clear the previous cursor\n      nextCursorRef.current = undefined;\n    }\n\n    // Query the list using the new interface within the project\n    const res = await intelligenceApi.GetDraftIntelligenceList({\n      space_id:\n        globalState.spaceId === PUBLIC_SPACE_ID\n          ? globalState.personalSpaceId\n          : globalState.spaceId,\n      name: query ?? search,\n      types: [IntelligenceType.Bot, IntelligenceType.Project],\n      size: 30,\n      order_by: 0,\n      cursor_id: nextCursorRef.current,\n      status: [\n        IntelligenceStatus.Using,\n        IntelligenceStatus.Banned,\n        IntelligenceStatus.MoveFailed,\n      ],\n    });\n    const { intelligences, total = 0, next_cursor_id } = res?.data ?? {};\n\n    const list: IBotSelectOptions = (intelligences ?? []).map(it => ({\n      name: it.basic_info?.name ?? '',\n      value: it.basic_info?.id ?? '',\n      avatar: it.basic_info?.icon_url ?? '',\n      type: it.type || IntelligenceType.Bot,\n    }));\n    const totalList = isReset ? list : [...selectList, ...list];\n\n    setTotal(total);\n    nextCursorRef.current = next_cursor_id;\n    setSelectList(totalList);\n    setIsShowFoot(totalList.length < total);\n    setIsLoading(false);\n  };\n\n  const loadMoreData = async () => {\n    if (isLoadMoreDate.current) {\n      return;\n    }\n    isLoadMoreDate.current = true;\n    await fetchBotList();\n    isLoadMoreDate.current = false;\n  };\n\n  const handleSearch = query => {\n    setSearch(query);\n    fetchBotList(query, true);\n  };\n\n  return (\n    <div className={styles['select-wrapper']} ref={containerRef}>\n      <Select\n        value={idValue}\n        data-testid={concatTestId(\n          'workflow',\n          'playground',\n          'testerun',\n          'bot-select',\n        )}\n        dropdownClassName={styles.dropdown}\n        filter\n        remote\n        placeholder={I18n.t('wf_chatflow_73')}\n        emptyContent={I18n.t('agentflow_addbot_select_empty_no_bot')}\n        onSearch={debounce(handleSearch, DebounceTime)}\n        prefix={<IconSearch />}\n        loading={isLoading}\n        style={{ width: '100%' }}\n        virtualize={{\n          height: listMaxHeight,\n          width: '100%',\n          itemSize: 32,\n        }}\n        onChange={newValue => {\n          // Set the selected item type (bot/project)\n          const findItem = selectList.find(item => item.value === newValue);\n\n          if (useNewGlobalVariableCache && findItem?.type) {\n            relatedBotService.updateRelatedBot({\n              id: newValue as string,\n              type: findItem?.type === IntelligenceType.Bot ? 'bot' : 'project',\n            });\n          }\n\n          handleChange(\n            findItem,\n            findItem\n              ? {\n                  id: newValue as string,\n                  type: findItem.type,\n                }\n              : undefined,\n          );\n        }}\n        {...props}\n      >\n        {[extraBotOption, ...selectList]\n          .filter(item => item)\n          .map(item =>\n            RenderCustomOption(item, {\n              disableBot,\n              disableProject,\n              disableBotTooltip,\n              disableProjectTooltip,\n            }),\n          )}\n\n        {isShowFoot ? (\n          <Select.Option\n            value={new Date().getTime()}\n            key={new Date().getTime()}\n            className={styles['bot-foot-loading']}\n            disabled\n          >\n            <RenderFootLoading onObserver={loadMoreData} />\n          </Select.Option>\n        ) : null}\n      </Select>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useQuery } from '@tanstack/react-query';\nimport { IntelligenceType } from '@coze-arch/idl/intelligence_api';\nimport {\n  type GetDraftBotInfoAgwData,\n  type ModelInfo,\n} from '@coze-arch/bot-api/playground_api';\nimport { type BotTable } from '@coze-arch/bot-api/memory';\nimport { PlaygroundApi } from '@coze-arch/bot-api';\n\nimport { type IBotSelectOption } from './types';\n\nexport const useBotInfo = (botId?: string) => {\n  const { isLoading, data: botInfo } = useQuery({\n    queryKey: ['bot_info', botId || ''],\n    queryFn: async () => {\n      if (!botId) {\n        return undefined;\n      }\n\n      const { data } = await PlaygroundApi.GetDraftBotInfoAgw({\n        bot_id: botId,\n      });\n      return data;\n    },\n  });\n\n  return { isLoading, botInfo };\n};\n\n// Data conversion using bot information for wf\nexport const transformBotInfo = {\n  // model data\n  model: (data?: GetDraftBotInfoAgwData): ModelInfo =>\n    data?.bot_info?.model_info ?? {},\n  // Basic information data\n  basicInfo: (\n    botInfo?: GetDraftBotInfoAgwData,\n  ): IBotSelectOption | undefined => {\n    if (!botInfo) {\n      return undefined;\n    }\n    return {\n      name: botInfo?.bot_info?.name ?? '',\n      avatar: botInfo?.bot_info?.icon_url ?? '',\n      value: botInfo?.bot_info?.bot_id ?? '',\n      type: IntelligenceType.Bot,\n    };\n  },\n  // database information\n  database: (botInfo?: GetDraftBotInfoAgwData): BotTable[] | undefined =>\n    botInfo?.bot_info?.database_list,\n  // Variable information\n  variable: (botInfo?: GetDraftBotInfoAgwData) =>\n    botInfo?.bot_info?.variable_list,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport { IntelligenceType } from '@coze-arch/idl/intelligence_api';\n\nimport { useProjectItemInfo } from './use-project-info';\nimport { transformBotInfo, useBotInfo } from './use-bot-info';\nimport type { IBotSelectOption, ValueType } from './types';\n\nexport const useExtraBotOption = (\n  botOptionList: IBotSelectOption[],\n  currentBotValue?: string,\n  isBot?: boolean,\n  handleChange?: (botInfo?: IBotSelectOption, _value?: ValueType) => void,\n  // eslint-disable-next-line max-params\n): IBotSelectOption | undefined => {\n  const { botInfo } = useBotInfo(isBot ? currentBotValue : undefined);\n  const { projectItemInfo } = useProjectItemInfo(\n    !isBot ? currentBotValue : undefined,\n  );\n\n  const botValue = useMemo(() => {\n    const botFinded = botOptionList.find(\n      ({ value }) => value === currentBotValue,\n    );\n\n    if (!botFinded) {\n      const botItem = transformBotInfo.basicInfo(botInfo);\n      if (botItem) {\n        handleChange?.(botItem, {\n          id: botItem.value,\n          type: botItem.type,\n        });\n      }\n      return botItem;\n    }\n    return undefined;\n  }, [botOptionList, botInfo, currentBotValue]);\n\n  const projectValue = useMemo(() => {\n    const projectFinded = botOptionList.find(\n      ({ value }) => value === currentBotValue,\n    );\n    if (projectFinded) {\n      return undefined;\n    }\n    let projectItem;\n    if (projectItemInfo) {\n      projectItem = {\n        name: projectItemInfo?.basic_info?.name || '',\n        value: projectItemInfo?.basic_info?.id || '',\n        avatar: projectItemInfo?.basic_info?.icon_url || '',\n        type: IntelligenceType.Project,\n      };\n      handleChange?.(projectItem, {\n        id: projectItem.value,\n        type: projectItem.type,\n      });\n    }\n    return projectItem;\n  }, [projectItemInfo, botOptionList, currentBotValue]);\n\n  return isBot ? botValue : projectValue;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useQuery } from '@tanstack/react-query';\nimport { IntelligenceType } from '@coze-arch/idl/intelligence_api';\nimport { intelligenceApi, MemoryApi } from '@coze-arch/bot-api';\n\nexport const useProjectInfo = (projectId?: string) => {\n  const { isLoading, data: variableList } = useQuery({\n    queryKey: ['project_info', projectId || ''],\n    queryFn: async () => {\n      if (!projectId) {\n        return undefined;\n      }\n\n      const { VariableList } = await MemoryApi.GetProjectVariableList({\n        ProjectID: projectId,\n      });\n\n      return (\n        VariableList?.filter?.(v => v.Enable)?.map(variable => ({\n          key: variable.Keyword,\n        })) || []\n      );\n    },\n  });\n\n  return { isLoading, variableList };\n};\n\nexport const useProjectItemInfo = (projectId?: string) => {\n  const { isLoading, data: projectItemInfo } = useQuery({\n    queryKey: ['project_item_info', projectId || ''],\n    queryFn: async () => {\n      if (!projectId) {\n        return undefined;\n      }\n\n      const { data } = await intelligenceApi.GetDraftIntelligenceInfo({\n        intelligence_id: projectId,\n        intelligence_type: IntelligenceType.Project,\n      });\n      return data;\n    },\n  });\n\n  return { isLoading, projectItemInfo };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IntelligenceType } from '@coze-arch/idl/intelligence_api';\n\nexport const isItemDisabled = (\n  { disableBot, disableProject },\n  type?: IntelligenceType,\n) => {\n  const isBot = type === IntelligenceType.Bot;\n  const isProject = type === IntelligenceType.Project;\n\n  const disabled = (isBot && disableBot) || (isProject && disableProject);\n  return disabled || !type;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozInfoCircle } from '@coze-arch/coze-design/icons';\nimport { Tooltip, CozInputNumber } from '@coze-arch/coze-design';\n\nexport interface ChatHistoryRoundProps {\n  value?: number;\n  onChange?: (value: number) => void;\n  readonly?: boolean;\n}\n\nconst MIN_ROUND = 1;\nconst MAX_ROUND = 30;\n\nexport const ChatHistoryRound = ({\n  value,\n  onChange,\n  readonly,\n}: ChatHistoryRoundProps) => (\n  <div className=\"absolute right-[0] top-[9px] flex items-center gap-[4px]\">\n    <span className=\"text-xs\">{I18n.t('wf_history_rounds')}</span>\n    <Tooltip content={I18n.t('model_config_history_round_explain')}>\n      <IconCozInfoCircle className=\"coz-fg-dim text-xs\" />\n    </Tooltip>\n\n    <CozInputNumber\n      className=\"w-[60px]\"\n      size=\"small\"\n      min={MIN_ROUND}\n      max={MAX_ROUND}\n      disabled={readonly}\n      value={value}\n      onChange={w => {\n        if (isNaN(w as number)) {\n          return;\n        }\n        onChange?.(w as number);\n      }}\n    />\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createRenderer, option } from '@coze-editor/editor/react';\nimport preset, { languages, themes } from '@coze-editor/editor/preset-code';\nimport { shell } from '@coze-editor/editor/language-shell';\nimport { json } from '@coze-editor/editor/language-json';\nimport { mixLanguages } from '@coze-editor/editor';\nimport { EditorView } from '@codemirror/view';\n\nimport { cozeLight } from './themes/coze-light';\nimport { cozeDark } from './themes/coze-dark';\n\n// Registration language\nlanguages.register('json', {\n  // MixLanguages is used to solve the problem of \"interpolation also uses parentheses, which makes it impossible to highlight correctly\"\n  language: mixLanguages({\n    outerLanguage: json.language,\n  }),\n  languageService: json.languageService,\n});\n\nlanguages.register('shell', shell);\n\n// Register a topic\nthemes.register('coze-light', cozeLight);\nthemes.register('coze-dark', cozeDark);\n\nconst minHeightOption = (value?: string | number) =>\n  EditorView.theme({\n    '.cm-content, .cm-gutter, .cm-right-gutter': {\n      minHeight:\n        typeof value === 'number'\n          ? `${value}px`\n          : typeof value === 'string'\n          ? value\n          : 'unset',\n    },\n    '&.cm-editor': {\n      minHeight:\n        typeof value === 'number'\n          ? `${value}px`\n          : typeof value === 'string'\n          ? value\n          : 'unset',\n    },\n  });\n\nconst maxHeightOption = (value?: string | number) =>\n  EditorView.theme({\n    '&.cm-editor': {\n      maxHeight:\n        typeof value === 'number'\n          ? `${value}px`\n          : typeof value === 'string'\n          ? value\n          : 'unset',\n    },\n  });\n\nconst heightOption = (value?: string | number) =>\n  EditorView.theme({\n    '&.cm-editor': {\n      height:\n        typeof value === 'number'\n          ? `${value}px`\n          : typeof value === 'string'\n          ? value\n          : 'unset',\n    },\n  });\n\nconst paddingOption = (value?: string | number) =>\n  EditorView.theme({\n    '&.cm-editor': {\n      padding:\n        typeof value === 'number'\n          ? `${value}px`\n          : typeof value === 'string'\n          ? value\n          : 'unset',\n    },\n  });\n\nconst borderRadiusOption = (value?: string | number) =>\n  EditorView.theme({\n    '&.cm-editor, .cm-gutters': {\n      borderRadius:\n        typeof value === 'number'\n          ? `${value}px`\n          : typeof value === 'string'\n          ? value\n          : 'unset',\n    },\n  });\n\nconst lineHeightOption = (value?: string | number) =>\n  EditorView.theme({\n    '.cm-content, .cm-gutter, .cm-right-gutter': {\n      lineHeight:\n        typeof value === 'number'\n          ? `${value}px`\n          : typeof value === 'string'\n          ? value\n          : 'unset',\n    },\n  });\n\nfunction createStyleOptions() {\n  return [\n    option('minHeight', minHeightOption),\n    option('maxHeight', maxHeightOption),\n    option('editerHeight', heightOption),\n    option('borderRadius', borderRadiusOption),\n    option('padding', paddingOption),\n    option('lineHeight', lineHeightOption),\n  ];\n}\n\nconst builtinExtensions = [\n  EditorView.theme({\n    '&.cm-focused': {\n      outline: 'none',\n    },\n    '& *': {\n      fontFamily: 'Menlo, Monaco, \"Courier New\", monospace',\n    },\n  }),\n  EditorView.theme({\n    '&.cm-content': {\n      wordBreak: 'break-all',\n    },\n  }),\n];\n\nexport const CodeEditor = createRenderer(\n  [...preset, ...createStyleOptions()],\n  builtinExtensions,\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createRenderer, option } from '@coze-editor/editor/react';\nimport universal from '@coze-editor/editor/preset-universal';\nimport { mixLanguages } from '@coze-editor/editor';\nimport { keymap, EditorView } from '@codemirror/view';\nimport { defaultKeymap, history, historyKeymap } from '@codemirror/commands';\n\nconst RawEditorTheme = EditorView.theme({\n  '&.cm-editor': {\n    outline: 'none',\n  },\n  '&.cm-content': {\n    wordBreak: 'break-all',\n  },\n});\n\nconst minHeightOption = (value?: string | number) =>\n  EditorView.theme({\n    '.cm-content, .cm-gutter, .cm-right-gutter': {\n      minHeight:\n        typeof value === 'number'\n          ? `${value}px`\n          : typeof value === 'string'\n          ? value\n          : 'unset',\n    },\n  });\n\nconst lineHeightOption = (value?: string | number) =>\n  EditorView.theme({\n    '.cm-content, .cm-gutter, .cm-right-gutter': {\n      lineHeight:\n        typeof value === 'number'\n          ? `${value}px`\n          : typeof value === 'string'\n          ? value\n          : 'unset',\n    },\n  });\n\nconst extensions = [\n  mixLanguages({}),\n  RawEditorTheme,\n  // ... Other extensions\n  history(),\n  keymap.of([...defaultKeymap, ...historyKeymap]),\n];\n\nexport const TextEditor = createRenderer(\n  [\n    ...universal,\n    option('minHeight', minHeightOption),\n    option('lineHeight', lineHeightOption),\n  ],\n  extensions,\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createTheme, tags as t } from '@coze-editor/editor/preset-code';\nimport { EditorView } from '@codemirror/view';\n\nconst colors = {\n  background: '#151B27',\n  // syntax\n  comment: '#FFFFFF63',\n  key: '#39E5D7',\n  string: '#FF94D2',\n  number: '#FF9933',\n  boolean: '#78B0FF',\n  null: '#78B0FF',\n  separator: '#FFFFFFC9',\n};\n\nexport const cozeDark = [\n  EditorView.theme({\n    '.cm-completionIcon-property': {\n      backgroundImage:\n        'url(\"' +\n        'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xMi4zNTc2IDguMTAzNTVDMTIuMTYyMyA3LjkwODI5IDExLjg0NTcgNy45MDgyOSAxMS42NTA1IDguMTAzNTVMOC4xMDM1NSAxMS42NTA1QzcuOTA4MjkgMTEuODQ1NyA3LjkwODI5IDEyLjE2MjMgOC4xMDM1NSAxMi4zNTc2TDExLjY1MDUgMTUuOTA0NUMxMS44NDU3IDE2LjA5OTggMTIuMTYyMyAxNi4wOTk4IDEyLjM1NzYgMTUuOTA0NUwxNS45MDQ1IDEyLjM1NzZDMTYuMDk5OCAxMi4xNjIzIDE2LjA5OTggMTEuODQ1NyAxNS45MDQ1IDExLjY1MDVMMTIuMzU3NiA4LjEwMzU1WiIgZmlsbD0iI0ZGRkZGRkM5Ii8+PHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMS4wMDI2IDEuNDU1NDVDMTEuNjIxNCAxLjA5ODE4IDEyLjM4MzggMS4wOTgxOCAxMy4wMDI2IDEuNDU1NDVMMjAuNjM4IDUuODYzNzRDMjEuMjU2OCA2LjIyMSAyMS42MzggNi44ODEyNiAyMS42MzggNy41OTU3OVYxNi40MTI0QzIxLjYzOCAxNy4xMjY5IDIxLjI1NjggMTcuNzg3MiAyMC42MzggMTguMTQ0NEwxMy4wMDI2IDIyLjU1MjdDMTIuMzgzOCAyMi45MSAxMS42MjE0IDIyLjkxIDExLjAwMjYgMjIuNTUyN0wzLjM2NzE5IDE4LjE0NDRDMi43NDgzOSAxNy43ODcyIDIuMzY3MTkgMTcuMTI2OSAyLjM2NzE5IDE2LjQxMjRWNy41OTU3OUMyLjM2NzE5IDYuODgxMjYgMi43NDgzOSA2LjIyMTAxIDMuMzY3MTkgNS44NjM3NEwxMS4wMDI2IDEuNDU1NDVaTTEyLjAwMjYgMy4xODc1TDE5LjYzOCA3LjU5NTc5VjE2LjQxMjRMMTIuMDAyNiAyMC44MjA3TDQuMzY3MTkgMTYuNDEyNEw0LjM2NzE5IDcuNTk1NzlMMTIuMDAyNiAzLjE4NzVaIiBmaWxsPSIjRkZGRkZGQzkiLz48L3N2Zz4=' +\n        '\")',\n      backgroundSize: '11px 11px',\n      backgroundRepeat: 'no-repeat',\n      width: '11px',\n      height: '11px',\n    },\n    '.cm-completionIcon-property::after': {\n      content: '\"\"',\n    },\n  }),\n  createTheme({\n    variant: 'dark',\n    settings: {\n      background: colors.background,\n      foreground: '#fff',\n      caret: '#AEAFAD',\n      selection: '#d9d9d942',\n      gutterBackground: colors.background,\n      gutterForeground: '#FFFFFF63',\n      gutterBorderColor: 'transparent',\n      gutterBorderWidth: 0,\n      lineHighlight: '#272e3d36',\n      bracketColors: ['#FFEF61', '#DD99FF', '#78B0FF'],\n      tooltip: {\n        backgroundColor: '#363D4D',\n        color: '#fff',\n        border: 'none',\n      },\n      completionItemHover: {\n        backgroundColor: '#FFFFFF0F',\n      },\n      completionItemSelected: {\n        backgroundColor: '#FFFFFF17',\n      },\n      completionItemIcon: {\n        color: '#FFFFFFC9',\n      },\n      completionItemLabel: {\n        color: '#FFFFFFC9',\n      },\n      completionItemDetail: {\n        color: '#FFFFFF63',\n      },\n    },\n    styles: [\n      // json\n      {\n        tag: t.comment,\n        color: colors.comment,\n      },\n      {\n        tag: [t.propertyName],\n        color: colors.key,\n      },\n      {\n        tag: [t.string],\n        color: colors.string,\n      },\n      {\n        tag: [t.number],\n        color: colors.number,\n      },\n      {\n        tag: [t.bool],\n        color: colors.boolean,\n      },\n      {\n        tag: [t.null],\n        color: colors.null,\n      },\n      {\n        tag: [t.separator],\n        color: colors.separator,\n      },\n\n      // shell\n      // curl\n      {\n        tag: [t.standard(t.variableName)],\n        color: '#3BEB84',\n      },\n      // -X\n      {\n        tag: [t.attributeName],\n        color: '#FF9933',\n      },\n      // url in string (includes quotes), e.g.\n      {\n        tag: [t.special(t.string)],\n        color: '#78B0FF',\n      },\n    ],\n  }),\n];\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createTheme, tags as t } from '@coze-editor/editor/preset-code';\nimport { EditorView } from '@codemirror/view';\n\nconst colors = {\n  background: '#F7F7FC',\n  // syntax\n  comment: '#000A298A',\n  key: '#00818C',\n  string: '#D1009D',\n  number: '#C74200',\n  boolean: '#2B57D9',\n  null: '#2B57D9',\n  separator: '#0F1529D1',\n};\n\nexport const cozeLight = [\n  EditorView.theme({\n    '.cm-completionIcon-property': {\n      backgroundImage:\n        'url(\"' +\n        'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xMi4zNTc2IDguMTAzNTVDMTIuMTYyMyA3LjkwODI5IDExLjg0NTcgNy45MDgyOSAxMS42NTA1IDguMTAzNTVMOC4xMDM1NSAxMS42NTA1QzcuOTA4MjkgMTEuODQ1NyA3LjkwODI5IDEyLjE2MjMgOC4xMDM1NSAxMi4zNTc2TDExLjY1MDUgMTUuOTA0NUMxMS44NDU3IDE2LjA5OTggMTIuMTYyMyAxNi4wOTk4IDEyLjM1NzYgMTUuOTA0NUwxNS45MDQ1IDEyLjM1NzZDMTYuMDk5OCAxMi4xNjIzIDE2LjA5OTggMTEuODQ1NyAxNS45MDQ1IDExLjY1MDVMMTIuMzU3NiA4LjEwMzU1WiIgZmlsbD0iIzA2MDcwOUNDIi8+PHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMS4wMDI2IDEuNDU1NDVDMTEuNjIxNCAxLjA5ODE4IDEyLjM4MzggMS4wOTgxOCAxMy4wMDI2IDEuNDU1NDVMMjAuNjM4IDUuODYzNzRDMjEuMjU2OCA2LjIyMSAyMS42MzggNi44ODEyNiAyMS42MzggNy41OTU3OVYxNi40MTI0QzIxLjYzOCAxNy4xMjY5IDIxLjI1NjggMTcuNzg3MiAyMC42MzggMTguMTQ0NEwxMy4wMDI2IDIyLjU1MjdDMTIuMzgzOCAyMi45MSAxMS42MjE0IDIyLjkxIDExLjAwMjYgMjIuNTUyN0wzLjM2NzE5IDE4LjE0NDRDMi43NDgzOSAxNy43ODcyIDIuMzY3MTkgMTcuMTI2OSAyLjM2NzE5IDE2LjQxMjRWNy41OTU3OUMyLjM2NzE5IDYuODgxMjYgMi43NDgzOSA2LjIyMTAxIDMuMzY3MTkgNS44NjM3NEwxMS4wMDI2IDEuNDU1NDVaTTEyLjAwMjYgMy4xODc1TDE5LjYzOCA3LjU5NTc5VjE2LjQxMjRMMTIuMDAyNiAyMC44MjA3TDQuMzY3MTkgMTYuNDEyNEw0LjM2NzE5IDcuNTk1NzlMMTIuMDAyNiAzLjE4NzVaIiBmaWxsPSIjMDYwNzA5Q0MiLz48L3N2Zz4=' +\n        '\")',\n      backgroundSize: '11px 11px',\n      backgroundRepeat: 'no-repeat',\n      width: '11px',\n      height: '11px',\n    },\n    '.cm-completionIcon-property::after': {\n      content: '\"\"',\n    },\n  }),\n  createTheme({\n    variant: 'light',\n    settings: {\n      background: colors.background,\n      foreground: '#4D4D4C',\n      caret: '#AEAFAD',\n      selection: '#52649A21',\n      gutterBackground: colors.background,\n      gutterForeground: '#000A298A',\n      gutterBorderColor: 'transparent',\n      gutterBorderWidth: 0,\n      lineHighlight: '#efefef78',\n      bracketColors: ['#E4D129', '#AC05FF', '#2B57D9'],\n      tooltip: {\n        backgroundColor: 'var(--coz-bg-max)',\n        color: 'var(--coz-fg-primary)',\n        border: 'solid 1px var(--coz-stroke-plus)',\n        boxShadow: 'var(--coz-shadow-default)',\n        borderRadius: '8px',\n      },\n      tooltipCompletion: {\n        backgroundColor: '#FFFFFF',\n        color: '#060709CC',\n      },\n      completionItemHover: {\n        backgroundColor: '#5768A114',\n      },\n      completionItemSelected: {\n        backgroundColor: '#52649A21',\n      },\n      completionItemIcon: {\n        color: '#060709CC',\n      },\n      completionItemLabel: {\n        color: '#060709CC',\n      },\n      completionItemDetail: {\n        color: '#2029459E',\n      },\n    },\n    styles: [\n      // JSON\n      {\n        tag: t.comment,\n        color: colors.comment,\n      },\n      {\n        tag: [t.propertyName],\n        color: colors.key,\n      },\n      {\n        tag: [t.string],\n        color: colors.string,\n      },\n      {\n        tag: [t.number],\n        color: colors.number,\n      },\n      {\n        tag: [t.bool],\n        color: colors.boolean,\n      },\n      {\n        tag: [t.null],\n        color: colors.null,\n      },\n      {\n        tag: [t.separator],\n        color: colors.separator,\n      },\n\n      // shell\n      // curl\n      {\n        tag: [t.standard(t.variableName)],\n        color: '#00804A',\n      },\n      // -X\n      {\n        tag: [t.attributeName],\n        color: '#C74200',\n      },\n      // url in string (includes quotes), e.g.\n      {\n        tag: [t.special(t.string)],\n        color: '#2B57D9',\n      },\n    ],\n  }),\n];\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ConditionLogic } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\nexport const logicTextMap = new Map<number, string>([\n  [ConditionLogic.OR, I18n.t('workflow_detail_condition_or')],\n  [ConditionLogic.AND, I18n.t('workflow_detail_condition_and')],\n]);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { ConditionLogic } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { Select } from '@coze-arch/coze-design';\n\nimport { logicTextMap } from './constants';\n\nimport styles from './condition-item-logic.module.less';\n\nexport interface ConditionItemLogicProps {\n  /**\n   * And Logic Or\n   */\n  logic?: ConditionLogic;\n  /**\n   * And Or change the logic\n   */\n  onChange: (logic: ConditionLogic) => void;\n  showStroke?: boolean;\n  className?: string;\n  readonly?: boolean;\n  testId?: string;\n}\n\nexport const ConditionItemLogic: FC<ConditionItemLogicProps> = props => {\n  const {\n    logic,\n    onChange,\n    showStroke = false,\n    readonly = false,\n    testId,\n  } = props;\n\n  return (\n    <div className=\"flex flex-col pt-[16px] pb-[16px] w-[50px]\">\n      <div className=\"flex-1 relative\">\n        {showStroke ? (\n          <div className=\"absolute left-1/2 right-0 top-2.5 bottom-0 rounded-tl-lg border-solid border-0 border-t border-l coz-stroke-plus\" />\n        ) : null}\n      </div>\n      <Select\n        className={styles['condition-logic-select']}\n        placeholder={I18n.t('workflow_detail_condition_pleaseselect')}\n        style={{ marginRight: 4 }}\n        value={logic}\n        disabled={readonly}\n        size=\"small\"\n        optionList={[\n          {\n            label: logicTextMap.get(ConditionLogic.AND),\n            value: ConditionLogic.AND,\n          },\n          {\n            label: logicTextMap.get(ConditionLogic.OR),\n            value: ConditionLogic.OR,\n          },\n        ]}\n        onChange={val => onChange(val as ConditionLogic)}\n        data-testid={testId}\n      />\n      <div className=\"flex-1 relative\">\n        {showStroke ? (\n          <div className=\"absolute left-1/2 right-0 top-0 bottom-2.5 rounded-bl-lg border-solid border-0 border-b border-l coz-stroke-plus\" />\n        ) : null}\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useState } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozCopy, IconCozCheckMark } from '@coze-arch/coze-design/icons';\nimport { Tooltip } from '@coze-arch/coze-design';\nimport { UIIconButton } from '@coze-arch/bot-semi';\n\nconst DELAY = 4000;\n\n/**\n * Copy button, click and switch to success state\n * Default delay of 4 seconds\n */\nexport const CopyButton = ({\n  value = '',\n  delayTime,\n}: {\n  value: string;\n  delayTime?: number;\n}) => {\n  const [isSuccess, setSuccess] = useState(false);\n  const handleOnClick = e => {\n    e.stopPropagation();\n    navigator.clipboard.writeText(value as string);\n    setSuccess(true);\n    setTimeout(() => {\n      setSuccess(false);\n    }, delayTime ?? DELAY);\n  };\n\n  return isSuccess ? (\n    <Tooltip content={I18n.t('Duplicate_success')}>\n      <UIIconButton\n        icon={<IconCozCheckMark color={'rgba(107, 109, 117, 1)'} />}\n      />\n    </Tooltip>\n  ) : (\n    <Tooltip content={I18n.t('Copy')}>\n      <UIIconButton\n        onClick={handleOnClick}\n        icon={<IconCozCopy color={'rgba(107, 109, 117, 1)'} />}\n      />\n    </Tooltip>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { devtools } from 'zustand/middleware';\nimport { create } from 'zustand';\n\nimport { type DatabaseDetailTab } from './types';\n\ninterface OpenDatabaseDetailProps {\n  databaseID: string;\n  isAddedInWorkflow: boolean;\n  tab?: DatabaseDetailTab;\n  onChangeDatabaseToWorkflow: (databaseID?: string) => void;\n}\n\ninterface WorkflowDetailModalStore {\n  isVisible: boolean;\n  isAddedInWorkflow: boolean;\n  databaseID: string;\n  tab?: DatabaseDetailTab;\n  onChangeDatabaseToWorkflow: (databaseID?: string) => void;\n  open: (props: OpenDatabaseDetailProps) => void;\n  close: () => void;\n}\n\nexport const useWorkflowDetailModalStore = create<WorkflowDetailModalStore>()(\n  devtools(set => ({\n    isVisible: false,\n    databaseID: '',\n    isAddedInWorkflow: false,\n    tab: 'structure',\n\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    onChangeDatabaseToWorkflow: () => {},\n\n    open: ({\n      databaseID,\n      isAddedInWorkflow = false,\n      onChangeDatabaseToWorkflow,\n      tab,\n    }: OpenDatabaseDetailProps) => {\n      set({\n        isVisible: true,\n        databaseID,\n        isAddedInWorkflow,\n        onChangeDatabaseToWorkflow,\n        tab,\n      });\n    },\n\n    close: () => {\n      set({ isVisible: false });\n    },\n  })),\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Modal } from '@coze-arch/bot-semi';\nimport { DatabaseDetailComponent } from '@coze-data/database-v2';\n\nimport { useGlobalState } from '@/hooks';\n\nimport { useWorkflowDetailModalStore } from './use-workflow-detail-modal-store';\n\nimport styles from './database-detail-model.module.less';\n\n/**\n * database details pop-up\n */\nexport function DatabaseDetailModal() {\n  const {\n    databaseID,\n    isVisible,\n    close,\n    isAddedInWorkflow,\n    onChangeDatabaseToWorkflow,\n    tab = 'structure',\n  } = useWorkflowDetailModalStore();\n\n  const { projectCommitVersion } = useGlobalState();\n\n  if (!databaseID) {\n    return null;\n  }\n\n  const addRemoveButtonText = isAddedInWorkflow\n    ? // This key is named incorrectly. It should be removed from the workflow product. The product has been entered. Continue to use the wrong key here.\n      I18n.t('workflow_remove_to_workflow')\n    : I18n.t('workflow_add_to_workflow');\n\n  return (\n    <Modal\n      fullScreen\n      visible={isVisible}\n      footer={null}\n      closable={false}\n      className={styles.editDatabaseModal}\n      modalContentClass=\"p-0\"\n    >\n      <DatabaseDetailComponent\n        version={projectCommitVersion}\n        databaseId={databaseID}\n        enterFrom=\"workflow\"\n        initialTab={tab}\n        onClose={() => close()}\n        addRemoveButtonText={addRemoveButtonText}\n        onClickAddRemoveButton={() => {\n          if (isAddedInWorkflow) {\n            onChangeDatabaseToWorkflow();\n          } else {\n            onChangeDatabaseToWorkflow(databaseID);\n          }\n\n          close();\n        }}\n      />\n    </Modal>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { set, get } from 'lodash-es';\nimport { useWorkflowNode, StandardNodeType } from '@coze-workflow/base';\n\nimport { useWorkflowDetailModalStore } from './use-workflow-detail-modal-store';\nimport { type DatabaseDetailTab } from './types';\n\ninterface OpenDatabaseDetailProps {\n  databaseID?: string;\n}\n\nexport function useOpenDatabaseDetail() {\n  const { open } = useWorkflowDetailModalStore();\n  const { setData, data, type } = useWorkflowNode();\n\n  const tab: DatabaseDetailTab = 'draft';\n\n  function onChangeDatabaseToWorkflow(databaseID?: string) {\n    const databaseInfoList = databaseID\n      ? [\n          {\n            databaseInfoID: databaseID,\n          },\n        ]\n      : [];\n\n    const dataCopy = { ...data };\n\n    if (type === StandardNodeType.Database) {\n      set(dataCopy, 'databaseInfoList', databaseInfoList);\n    } else {\n      set(dataCopy, 'inputs.databaseInfoList', databaseInfoList);\n    }\n\n    setData(dataCopy);\n  }\n\n  return {\n    openDatabaseDetail: ({ databaseID }: OpenDatabaseDetailProps = {}) => {\n      const databaseInfoList =\n        get(data, 'databaseInfoList') || get(data, 'inputs.databaseInfoList');\n\n      const currentNodeDatabaseID = databaseInfoList?.[0]\n        ?.databaseInfoID as string;\n\n      if (databaseID === undefined) {\n        databaseID = currentNodeDatabaseID;\n      }\n\n      open({\n        databaseID,\n        isAddedInWorkflow: databaseID === currentNodeDatabaseID,\n        onChangeDatabaseToWorkflow,\n        tab,\n      });\n    },\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { FC } from 'react';\n\nimport classNames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozSideCollapse } from '@coze-arch/coze-design/icons';\nimport { IconButton, Tooltip } from '@coze-arch/coze-design';\nimport { IconInfo } from '@coze-arch/bot-icons';\n\nimport styles from './index.module.less';\n\ninterface ExpandEditorContainerProps {\n  id: string;\n  onClose?: () => void;\n  editorTitle?: React.ReactNode;\n  editorTooltip?: string;\n  actions?: React.ReactNode[];\n  closeButton?: React.ReactNode;\n  closeIconClassName?: string;\n  editorContent?: React.ReactNode;\n  containerClassName?: string;\n  headerClassName?: string;\n  contentClassName?: string;\n}\n\n/**\n * pop-up editor container\n * @param editorTitle popup title\n * @param editorTooltip pop-up description\n * @param actions title toolbar\n * @param closeButton Custom close button\n * @param closeIconClassName Close button style\n * @param editorContent pop-up editor area\n * @param containerClassName Container style\n * @param headerClassName title style\n * @param contentClassName editor area style\n */\nexport const ExpandEditorContainer: FC<ExpandEditorContainerProps> = props => {\n  const {\n    id,\n    onClose,\n    closeButton,\n    editorTitle,\n    editorTooltip,\n    actions,\n    editorContent,\n    containerClassName,\n    headerClassName,\n    contentClassName,\n    closeIconClassName,\n  } = props;\n\n  return (\n    <div key={id} className={classNames(styles.container, containerClassName)}>\n      <div className={classNames(headerClassName, styles.header)}>\n        <span className={styles.leftSide}>\n          {editorTitle}\n          {editorTooltip ? (\n            <span>\n              <Tooltip\n                className={styles.tip}\n                position=\"bottom\"\n                content={editorTooltip}\n              >\n                <IconInfo className={styles.info} />\n              </Tooltip>\n            </span>\n          ) : null}\n        </span>\n        <span className={styles.rightSide}>\n          {actions?.map((action, index) => (\n            <span key={index}>{action}</span>\n          ))}\n          {closeButton ?? (\n            <Tooltip content={I18n.t('node_http_json_collapse')}>\n              <span>\n                <IconButton\n                  icon={\n                    <IconCozSideCollapse\n                      fontSize={18}\n                      className={classNames(\n                        closeIconClassName,\n                        styles.iconLight,\n                      )}\n                    />\n                  }\n                  size=\"small\"\n                  color=\"secondary\"\n                  aria-label=\"close\"\n                  onClick={() => onClose?.()}\n                />\n              </span>\n            </Tooltip>\n          )}\n        </span>\n      </div>\n      <div className={classNames(contentClassName, styles.content)}>\n        {editorContent}\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useRef, useState, type FC } from 'react';\n\nimport { debounce } from 'lodash-es';\nimport classNames from 'classnames';\nimport { useNodeTestId } from '@coze-workflow/base';\n\nimport styles from './index.module.less';\n\ninterface InnerContainerProps {\n  name: string;\n  onBlur?: () => void;\n  onFocus?: () => void;\n  isError?: boolean;\n  onMouseEnter?: () => void;\n  onMouseLeave?: () => void;\n  className?: string;\n  children?: React.ReactNode;\n}\n\n/**\n * The editor container in the form encapsulates the border style in the foucs error state\n * @param name\n * @param onBlur\n * @param onFocus\n * @param isError\n * @param onMouseEnter\n * @param onMouseLeave\n * @param className editor outer style\n * @param children\n */\nexport const InnerEditorContainer: FC<InnerContainerProps> = props => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const {\n    name,\n    onBlur,\n    onFocus,\n    isError,\n    className,\n    onMouseEnter,\n    onMouseLeave,\n    children,\n  } = props;\n\n  const [focus, _setFocus] = useState<boolean>(false);\n  const { getNodeSetterId } = useNodeTestId();\n  const dataTestID = getNodeSetterId(name);\n\n  // Set anti-shake to prevent onFocus/onBlur from shaking when clicked\n  const setFocus = useCallback(\n    debounce((newFocusValue: boolean) => {\n      _setFocus(newFocusValue);\n    }, 50),\n    [],\n  );\n\n  const handleOnBlur = () => {\n    setFocus(false);\n    onBlur?.();\n  };\n\n  return (\n    <div\n      key={dataTestID}\n      data-testid={dataTestID}\n      className={classNames(className, 'w-full', {\n        [styles['editor-normal']]: !focus && !isError,\n        [styles['editor-focused']]: focus && !isError,\n        [styles['editor-error']]: isError,\n      })}\n      onFocus={() => {\n        setFocus(true);\n        onFocus?.();\n      }}\n      onMouseEnter={() => onMouseEnter?.()}\n      onMouseLeave={() => onMouseLeave?.()}\n      onBlur={handleOnBlur}\n      ref={containerRef}\n    >\n      {children}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useMemo } from 'react';\n\nimport {\n  EditorThemeContext,\n  EditorTheme,\n} from '@/hooks/use-editor-theme-state';\n\nexport const EditorThemeProvider: React.FC<React.PropsWithChildren> = ({\n  children,\n}) => {\n  const [editorTheme, setEditorTheme] = useState<EditorTheme>(\n    EditorTheme.Light,\n  );\n\n  const isDarkTheme = useMemo(\n    () => editorTheme === EditorTheme.Dark,\n    [editorTheme],\n  );\n\n  return (\n    <EditorThemeContext.Provider\n      value={{ editorTheme, setEditorTheme, isDarkTheme }}\n    >\n      {children}\n    </EditorThemeContext.Provider>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport mime from 'mime-types';\nimport {\n  IconCozFileAudio,\n  IconCozFileCode,\n  IconCozFilePptx,\n  IconCozFileDocx,\n  IconCozFileTxt,\n  IconCozFileZip,\n  IconCozFileXlsx,\n  IconCozFileVideo,\n  IconCozFileOther,\n  IconCozFilePdf,\n} from '@coze-arch/coze-design/illustrations';\n\nconst codeExtensions = [\n  'js',\n  'jsx',\n  'ts',\n  'tsx',\n  'html',\n  'htm',\n  'css',\n  'scss',\n  'sass',\n  'less',\n  'py',\n  'java',\n  'c',\n  'cpp',\n  'h',\n  'hpp',\n  'cs',\n  'go',\n  'rb',\n  'php',\n  'swift',\n  'kt',\n  'kts',\n  'sql',\n  'pl',\n  'sh',\n  'bash',\n  'rs',\n  'dart',\n  'scala',\n  'yaml',\n  'yml',\n  'json',\n];\n\nfunction isCodeFile(extension: string) {\n  return codeExtensions.includes(extension);\n}\n\nfunction isAudioFile(extension: string) {\n  const mimeType = mime.lookup(extension);\n  return mimeType ? mimeType.startsWith('audio/') : false;\n}\n\nfunction isVideoFile(extension: string) {\n  const mimeType = mime.lookup(extension);\n  return mimeType ? mimeType.startsWith('video/') : false;\n}\n\nconst ICON_MAP = {\n  // ppt\n  ppt: IconCozFilePptx,\n  pptx: IconCozFilePptx,\n  // doc\n  doc: IconCozFileDocx,\n  docx: IconCozFileDocx,\n  pdf: IconCozFilePdf,\n  // txt\n  txt: IconCozFileTxt,\n  // zip\n  zip: IconCozFileZip,\n  rar: IconCozFileZip,\n  // excel\n  xls: IconCozFileXlsx,\n  xlsx: IconCozFileXlsx,\n  csv: IconCozFileXlsx,\n  // code\n  code: IconCozFileCode,\n  // video\n  video: IconCozFileVideo,\n  // audio\n  audio: IconCozFileAudio,\n};\n\nexport const getIconByExtension = (extension: string) => {\n  let fileIcon = ICON_MAP[extension] ?? IconCozFileOther;\n  if (isAudioFile(extension)) {\n    fileIcon = ICON_MAP.audio;\n  } else if (isVideoFile(extension)) {\n    fileIcon = ICON_MAP.video;\n  } else if (isCodeFile(extension)) {\n    fileIcon = ICON_MAP.code;\n  }\n\n  return fileIcon;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type CSSProperties } from 'react';\n\nimport { IconCozFileImage } from '@coze-arch/coze-design/illustrations';\nimport { Spin, Image } from '@coze-arch/bot-semi';\n\nimport {\n  FileItemStatus,\n  PREVIEW_IMAGE_TYPE,\n  getFileExtension,\n} from '@/hooks/use-upload';\n\nimport { getIconByExtension } from './get-icon-by-extension';\n\nimport styles from './index.module.less';\n\ninterface FileIconProps {\n  file: {\n    name: string;\n    url?: string;\n    status?: string;\n  };\n  size?: number;\n  iconStyle?: CSSProperties;\n  loadingStyle?: CSSProperties;\n  hideLoadingIcon?: boolean;\n}\n\nexport const FileIcon = (props: FileIconProps) => {\n  const { size = 20, file, iconStyle, loadingStyle, hideLoadingIcon } = props;\n\n  const { url, name, status } = file;\n\n  const extension = getFileExtension(name);\n\n  if (status === FileItemStatus.Uploading && !hideLoadingIcon) {\n    return (\n      <Spin\n        wrapperClassName={styles['file-icon-loading']}\n        style={{\n          width: size,\n          height: size,\n          lineHeight: `${size}px`,\n          ...loadingStyle,\n        }}\n        spinning\n      />\n    );\n  }\n\n  if (PREVIEW_IMAGE_TYPE.includes(extension)) {\n    if (!url) {\n      return (\n        <IconCozFileImage\n          style={{ width: size, height: size, fontSize: size, ...iconStyle }}\n        />\n      );\n    }\n\n    return (\n      <Image\n        preview={false}\n        className=\"object-contain object-center rounded-sm border-0\"\n        style={{ width: size, height: size, ...iconStyle }}\n        imgStyle={{ width: size, height: size }}\n        src={url}\n        alt=\"\"\n      />\n    );\n  }\n\n  const Icon = getIconByExtension(extension);\n\n  return (\n    <Icon style={{ width: size, height: size, fontSize: size, ...iconStyle }} />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const IconPlusCircle = () => (\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g id=\"add\">\n      <path\n        id=\"background\"\n        fill=\"#ffffff\"\n        fillRule=\"evenodd\"\n        stroke=\"none\"\n        d=\"M 24 12 C 24 5.372583 18.627417 0 12 0 C 5.372583 0 -0 5.372583 -0 12 C -0 18.627417 5.372583 24 12 24 C 18.627417 24 24 18.627417 24 12 Z\"\n      />\n      <path\n        id=\"content\"\n        fill=\"currentColor\"\n        fillRule=\"evenodd\"\n        stroke=\"none\"\n        d=\"M 22 12.005 C 22 6.482153 17.522848 2.004999 12 2.004999 C 6.477152 2.004999 2 6.482153 2 12.005 C 2 17.527847 6.477152 22.004999 12 22.004999 C 17.522848 22.004999 22 17.527847 22 12.005 Z\"\n      />\n      <path\n        id=\"cross\"\n        fill=\"#ffffff\"\n        stroke=\"none\"\n        d=\"M 11.411996 16.411797 C 11.411996 16.736704 11.675362 17 12.00023 17 C 12.325109 17 12.588474 16.736704 12.588474 16.411797 L 12.588474 12.58826 L 16.41201 12.58826 C 16.736919 12.58826 17.000216 12.324894 17.000216 12.000015 C 17.000216 11.675147 16.736919 11.411781 16.41201 11.411781 L 12.588474 11.411781 L 12.588474 7.588234 C 12.588474 7.263367 12.325109 7 12.00023 7 C 11.675362 7 11.411996 7.263367 11.411996 7.588234 L 11.411996 11.411781 L 7.588449 11.411781 C 7.263581 11.411781 7.000215 11.675147 7.000215 12.000015 C 7.000215 12.324894 7.263581 12.58826 7.588449 12.58826 L 11.411996 12.58826 L 11.411996 16.411797 Z\"\n      />\n    </g>\n  </svg>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type StandardNodeType } from '@coze-workflow/base';\nimport { Toast } from '@coze-arch/coze-design';\nimport { WorkflowNodePanelService } from '@flowgram-adapter/free-layout-editor';\nimport { type LineRenderProps } from '@flowgram-adapter/free-layout-editor';\nimport {\n  usePlayground,\n  useService,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  LineColors,\n  LineType,\n  type WorkflowLineEntity,\n} from '@flowgram-adapter/free-layout-editor';\nimport { type IPoint } from '@flowgram-adapter/common';\n\nimport { WorkflowCustomDragService } from '@/services';\n\nimport { IconPlusCircle } from './button';\n\nconst useVisible = (params: {\n  line: WorkflowLineEntity;\n  selected?: boolean;\n  color?: string;\n}): boolean => {\n  const playground = usePlayground();\n  const { line, selected = false, color } = params;\n  if (line.disposed) {\n    // After dispose, getting line.to | line.from will cause an error to create a port\n    return false;\n  }\n  if (playground.config.readonly) {\n    return false;\n  }\n  if (!selected && color !== LineColors.HOVER) {\n    return false;\n  }\n  if (\n    line.fromPort.portID === 'loop-output-to-function' &&\n    line.toPort?.portID === 'loop-function-input'\n  ) {\n    return false;\n  }\n  if (\n    line.fromPort.portID === 'batch-output-to-function' &&\n    line.toPort?.portID === 'batch-function-input'\n  ) {\n    return false;\n  }\n  return true;\n};\n\nexport const LineAddButton = (props: LineRenderProps) => {\n  const { line, selected, color, lineType } = props;\n  const visible = useVisible({ line, selected, color });\n  const nodePanelService = useService<WorkflowNodePanelService>(\n    WorkflowNodePanelService,\n  );\n  const dragService = useService(WorkflowCustomDragService);\n\n  if (!visible) {\n    return <></>;\n  }\n\n  const { fromPort, toPort } = line;\n  const { to, from } = line.position;\n\n  const isBezierLine: boolean = lineType === LineType.BEZIER;\n  const mid: IPoint = {\n    x: (to.x + from.x) / 2,\n    y: (to.y + from.y) / 2,\n  };\n\n  return (\n    <div\n      className=\"workflow-line-add-button absolute translate-x-[-50%] translate-y-[-60%] w-[24px] h-[24px] cursor-pointer\"\n      style={{\n        left: isBezierLine ? '50%' : mid.x,\n        top: isBezierLine ? '50%' : mid.y,\n        color,\n      }}\n      data-testid=\"sdk.workflow.canvas.line.add\"\n      data-line-id={line.id}\n      onClick={async () => {\n        const node = await nodePanelService.call({\n          panelPosition: {\n            x: (line.position.from.x + line.position.to.x) / 2,\n            y: (line.position.from.y + line.position.to.y) / 2,\n          },\n          fromPort,\n          toPort,\n          enableBuildLine: true,\n          enableAutoOffset: true,\n          panelProps: {\n            enableScrollClose: true,\n          },\n          canAddNode: ({ nodeType, containerNode }) => {\n            const canDropMessage = dragService.canDropToNode({\n              dragNodeType: nodeType as StandardNodeType,\n              dropNode: containerNode,\n            });\n            if (!canDropMessage.allowDrop) {\n              Toast.warning({\n                content: canDropMessage.message,\n              });\n              return false;\n            }\n            return canDropMessage.allowDrop;\n          },\n        });\n        if (!node) {\n          return;\n        }\n        line.dispose();\n      }}\n    >\n      <IconPlusCircle />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GenerationDiversity } from '@coze-workflow/base';\nimport {\n  type ModelParameter,\n  ModelParamType,\n} from '@coze-arch/bot-api/developer_api';\n\nexport const getCamelNameName = name =>\n  name\n    .split('_')\n    .map((s, i) => (i === 0 ? s : s.slice(0, 1).toUpperCase() + s.slice(1)))\n    .join('');\n\nexport const getValueByType = <T,>(value, type?: ModelParamType): T => {\n  const isNumber =\n    type && [ModelParamType.Float, ModelParamType.Int].includes(type);\n  const _value = isNumber && value ? Number(value) : value;\n  return _value;\n};\n\n// memory level cache\nconst cacheData: {\n  [k: string]: unknown;\n} = {\n  //Record expanded/stowed status\n  expand: undefined,\n};\nexport { cacheData };\n\n/**\n * Generate default values from modelParams\n * If you pass in value, use value first (it can be understood as a min max check for value)\n */\nexport const generateDefaultValueByMeta = ({\n  modelParams,\n  value,\n}: {\n  modelParams?: ModelParameter[];\n  value?: object;\n}): Record<GenerationDiversity, object> => {\n  const _defaultValue: Record<GenerationDiversity, object> = {\n    [GenerationDiversity.Creative]: {},\n    [GenerationDiversity.Balance]: {},\n    [GenerationDiversity.Precise]: {},\n    [GenerationDiversity.Customize]: {},\n  };\n\n  Object.keys(_defaultValue).forEach(generationDiversity => {\n    _defaultValue[generationDiversity] = {};\n    modelParams?.forEach(p => {\n      const key = getCamelNameName(p.name ?? '');\n\n      // Priority is given to taking from the value, and if you can't get it, you can take it from the meta. [Custom] The default value is the bottom.\n      let _v =\n        value?.[key] ??\n        p.default_val?.[generationDiversity] ??\n        p.default_val?.[GenerationDiversity.Customize];\n\n      // Defense code: This is to verify that the backend returns the default value. Theoretically, the default value must be legal, but what if. The default value of the number type needs to be guaranteed max > = v > = min.\n      if (\n        p.type &&\n        [ModelParamType.Float, ModelParamType.Int].includes(p.type)\n      ) {\n        const { min, max } = p;\n\n        // For numeric types, if you really can't get the value, use 0.\n        if (['', undefined].includes(_v)) {\n          _v = 0;\n        }\n\n        if (min !== '' && Number(_v) < Number(min)) {\n          _v = Number(min);\n        }\n\n        if (max !== '' && Number(_v) > Number(max)) {\n          _v = Number(max);\n        }\n      }\n\n      _defaultValue[generationDiversity][key] = _v;\n    });\n  });\n\n  return _defaultValue;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type CSSProperties } from 'react';\n\nimport { type Model } from '@coze-arch/bot-api/developer_api';\n\nimport {\n  ModelSelectV2,\n  type ModelSelectV2Props,\n} from '@/form-extensions/setters/model-select/components/selector/model-select-v2';\n\nexport interface ModelSelectProps\n  extends Pick<ModelSelectV2Props, 'popoverPosition' | 'triggerRender'> {\n  className?: string;\n  style?: CSSProperties;\n  value: number | undefined;\n  onChange: (value: number) => void;\n  models: Model[];\n  readonly?: boolean;\n}\n\nexport const ModelSelector: React.FC<ModelSelectProps> = ({\n  className,\n  value,\n  onChange,\n  models,\n  readonly,\n  triggerRender,\n  popoverPosition,\n}) => (\n  <ModelSelectV2\n    className={className}\n    value={value}\n    onChange={onChange}\n    models={models}\n    readonly={readonly}\n    popoverPosition={popoverPosition}\n    triggerRender={triggerRender}\n  />\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// TODO first encapsulates a business component for joint debugging, and then abstracts it into a general request select.\nimport React, { Suspense, lazy } from 'react';\n\nimport { InputNumber, Tooltip } from '@coze-arch/coze-design';\nimport { Slider } from '@coze-arch/bot-semi';\nimport { IconInfo } from '@coze-arch/bot-icons';\n\nimport styles from '../index.module.less';\nconst LazyMdbox = lazy(async () => {\n  const { MdBoxLazy } = await import('@coze-arch/bot-md-box-adapter/lazy');\n  return {\n    default: MdBoxLazy,\n  };\n});\nexport const Divider = () => (\n  <div className=\"border-0 border-t border-solid coz-stroke-primary\" />\n);\n\nexport const SettingLayout = (props: {\n  title: string;\n  description?: string;\n  bolder?: boolean;\n  center?: React.ReactNode;\n  right?: React.ReactNode;\n  leftClassName?: string;\n}) => {\n  const {\n    title,\n    description,\n    center,\n    right,\n    bolder,\n    leftClassName = '',\n  } = props;\n  return (\n    <div className=\"flex gap-[4px]\">\n      <div\n        className={`${center ? 'w-[162px]' : 'flex-1'} ${\n          bolder ? 'font-semibold' : 'font-normal'\n        } flex items-center ${leftClassName}`}\n      >\n        {title}\n        {description ? (\n          <Tooltip\n            content={\n              <Suspense fallback={null}>\n                <LazyMdbox\n                  markDown={description}\n                  autoFixSyntax={{ autoFixEnding: false }}\n                />\n              </Suspense>\n            }\n          >\n            <IconInfo className=\"pl-[8px] cursor-pointer coz-fg-dim\" />\n          </Tooltip>\n        ) : undefined}\n      </div>\n      {center ? <div className=\"flex-1\">{center}</div> : undefined}\n      {right ? <div className=\"w-[110px]\">{right}</div> : undefined}\n    </div>\n  );\n};\n\nexport const SettingSlider = (props: {\n  title: string;\n  description?: string;\n  min?: number;\n  max?: number;\n  step?: number;\n  value?: number;\n  precision?: number;\n  defaultValue?: number;\n  onChange: (v: string | number) => void;\n  readonly?: boolean;\n}) => {\n  const {\n    title,\n    description,\n    onChange,\n    min = 0,\n    max = 100,\n    value = 0,\n    precision = 0,\n    readonly,\n  } = props;\n\n  const _step = 1 / Math.pow(10, precision);\n  return (\n    <SettingLayout\n      title={title}\n      description={description}\n      center={\n        <div className={`relative ${styles.slider}`}>\n          <Slider\n            key={title}\n            disabled={readonly}\n            value={value}\n            min={min}\n            max={max}\n            step={_step}\n            marks={{\n              [min]: `${min}`,\n              [max]: `${max}`,\n            }}\n            onChange={v => {\n              onChange(v as number);\n            }}\n          />\n        </div>\n      }\n      right={\n        <InputNumber\n          disabled={readonly}\n          precision={precision}\n          value={value}\n          min={min}\n          max={max}\n          step={_step}\n          onChange={v => {\n            if (v !== value) {\n              onChange(v as number);\n            }\n          }}\n        />\n      }\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// TODO first encapsulates a business component for joint debugging, and then abstracts it into a general request select.\nimport React, { type FC, useEffect, useMemo, useState } from 'react';\n\nimport { GenerationDiversity, RESPONSE_FORMAT_NAME } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { type OptionProps } from '@coze-arch/bot-semi/Select';\nimport { Radio, RadioGroup, Select } from '@coze-arch/bot-semi';\nimport { IconDownArrow } from '@coze-arch/bot-icons';\nimport {\n  type Model,\n  type ModelParamClass,\n} from '@coze-arch/bot-api/developer_api';\n\nimport { cacheData, getCamelNameName, getValueByType } from '../utils';\nimport styles from '../index.module.less';\nimport { Divider, SettingLayout, SettingSlider } from './settings';\n\ninterface ModelSettingProps {\n  id: string;\n  value?: { [k: string]: unknown };\n  defaultValue?: Record<GenerationDiversity, object>;\n  model?: Model;\n  onChange: (v: ModelSettingProps['value']) => void;\n  readonly: boolean;\n}\n\nexport const ModelSetting: FC<ModelSettingProps> = ({\n  value,\n  onChange,\n  model,\n  defaultValue,\n  readonly,\n  id,\n}) => {\n  const [settingExpand, setSettingExpand] = useState(\n    cacheData.expand === undefined &&\n      value?.generationDiversity === GenerationDiversity.Customize &&\n      !readonly\n      ? true\n      : cacheData.expand,\n  );\n\n  // Customize to remember the last action of the user, and use as the default when the mode switches back\n  const _defaultValue = {\n    ...defaultValue,\n    [GenerationDiversity.Customize]:\n      cacheData[id] ?? defaultValue?.[GenerationDiversity.Customize],\n  };\n\n  // To remember the expanded state, workflow level sharing\n  useEffect(() => {\n    cacheData.expand = settingExpand;\n  }, [settingExpand]);\n\n  const { doms, generationDiversityGroupTitle } = useMemo(() => {\n    // Specialization 1: Filter out the response format and display it in the output node\n    const modelParams =\n      model?.model_params?.filter(m => m.name !== RESPONSE_FORMAT_NAME) ?? [];\n\n    // Get the group first\n    let groups: ModelParamClass[] = [];\n    modelParams.forEach(m => {\n      if (\n        m.param_class?.class_id &&\n        !groups.map(d => d.class_id).includes(m.param_class.class_id)\n      ) {\n        groups.push(m.param_class);\n      }\n    });\n\n    // Specialization 2: Generation Diversity title The style is written dead. Convention with the backend: Generation Diversity class_id === 1\n    const generationDiversityGroup = groups.find(d => d.class_id === 1);\n    const _generationDiversityGroupTitle =\n      generationDiversityGroup?.label || '';\n    if (generationDiversityGroup) {\n      // If there is Generation Diversity, it must be at the top\n      groups = [\n        generationDiversityGroup,\n        ...groups.filter(d => d.class_id !== generationDiversityGroup.class_id),\n      ];\n    }\n\n    // Render setters one by one in grouping order\n    const _doms: React.ReactNode[] = [];\n    const _setCacheData = (v: { [k: string]: unknown }) => {\n      if (v.generationDiversity === GenerationDiversity.Customize) {\n        cacheData[id] = v;\n      }\n    };\n    groups.forEach((g, i) => {\n      // Groups are inserted directly into the dividing line, the first group is not required\n      if (i !== 0) {\n        _doms.push(<Divider />);\n      }\n      // If the hide & & belongs to the group Generative Diversity, it will not be rendered\n      if (!settingExpand && generationDiversityGroup?.class_id === g.class_id) {\n        return;\n      }\n\n      // Generate diversity title built-in, no need to add additional\n      if (generationDiversityGroup?.class_id !== g.class_id) {\n        _doms.push(<SettingLayout title={g.label ?? ''} bolder />);\n      }\n      const items = modelParams?.filter(\n        m => m.param_class?.class_id === g.class_id,\n      );\n      items?.forEach(item => {\n        const {\n          label = '',\n          name,\n          desc,\n          min,\n          max,\n          options,\n          precision,\n          type,\n        } = item;\n\n        // The API/bot/get_type_list interface gives test_key, and the save interface requires testKey. The front end is not aware (except response_format)\n        const key = getCamelNameName(name ?? '');\n        const _value = getValueByType<string | number | undefined>(\n          value?.[key],\n          type,\n        );\n\n        // If there is an options attribute, use Select\n        if (options?.length) {\n          const _optionsList = options.map(option => ({\n            ...option,\n            label: option.label || option.value,\n            value: getValueByType(option.value, type),\n          }));\n\n          _doms.push(\n            <SettingLayout\n              title={label}\n              description={desc}\n              center={\n                <Select\n                  disabled={readonly}\n                  className=\"w-full\"\n                  value={_value}\n                  onChange={v => {\n                    const _v = {\n                      ...value,\n                      [key]: v,\n                    };\n                    onChange(_v);\n                    _setCacheData(_v);\n                  }}\n                  optionList={_optionsList as OptionProps[]}\n                />\n              }\n            />,\n          );\n          // Otherwise, treat it as number processing, using Slider + NumberInput\n        } else {\n          _doms.push(\n            <SettingSlider\n              readonly={readonly}\n              title={label}\n              description={desc}\n              // defaultValue={getValueByType<number | undefined>(\n              //   _defaultValue?.[value?.generationDiversity as string]?.[key],\n              //   type,\n              // )}\n              value={_value as number | undefined}\n              min={getValueByType<number | undefined>(min, type)}\n              max={getValueByType<number | undefined>(max, type)}\n              precision={getValueByType<number | undefined>(precision, type)}\n              onChange={v => {\n                const _v = {\n                  ...value,\n                  [key]: v,\n                  generationDiversity: GenerationDiversity.Customize,\n                };\n\n                onChange(_v);\n                _setCacheData(_v);\n              }}\n            />,\n          );\n        }\n      });\n    });\n\n    return {\n      doms: _doms,\n      generationDiversityGroupTitle: _generationDiversityGroupTitle,\n    };\n  }, [settingExpand, value, model, readonly]);\n\n  return (\n    <div\n      className={'p-[24px] flex flex-col gap-[16px]'}\n      // onDragStart={e => {\n      //   e.stopPropagation();\n      //   e.preventDefault();\n      // }}\n      // Block canvas framing\n      onMouseDown={e => {\n        e.stopPropagation();\n      }}\n    >\n      <div className=\"flex items-center\">\n        <div className=\"flex-1 text-[18px] font-semibold\">\n          {I18n.t('workflow_detail_llm_model')}\n        </div>\n      </div>\n\n      <Divider />\n\n      <SettingLayout\n        title={generationDiversityGroupTitle}\n        description={I18n.t('model_config_generate_explain')}\n        bolder\n        leftClassName=\"!w-[165px]\"\n        center={\n          <div className=\"w-full pr-[8px]\">\n            <RadioGroup\n              type=\"button\"\n              disabled={readonly}\n              value={value?.generationDiversity as GenerationDiversity}\n              className={`${styles.radioGroup} w-full !flex`}\n              onChange={e => {\n                onChange({\n                  ...value,\n                  ..._defaultValue?.[e.target?.value],\n                  generationDiversity: e.target?.value,\n                });\n\n                if (e.target?.value === GenerationDiversity.Customize) {\n                  setSettingExpand(true);\n                }\n              }}\n            >\n              {[\n                {\n                  value: GenerationDiversity.Precise,\n                  label: I18n.t('model_config_generate_precise'),\n                },\n                {\n                  value: GenerationDiversity.Balance,\n                  label: I18n.t('model_config_generate_balance'),\n                },\n                {\n                  value: GenerationDiversity.Creative,\n                  label: I18n.t('model_config_generate_creative'),\n                },\n                {\n                  value: GenerationDiversity.Customize,\n                  label: I18n.t('model_config_generate_customize'),\n                },\n              ].map(d => (\n                <Radio key={d.value} value={d.value}>\n                  {d.label}\n                </Radio>\n              ))}\n            </RadioGroup>\n          </div>\n        }\n        right={\n          <div\n            className=\"cursor-pointe h-full flex items-center gap-[4px]\"\n            onClick={e => {\n              e.stopPropagation();\n              setSettingExpand(!settingExpand);\n            }}\n          >\n            <span>{I18n.t('model_config_generate_advance')}</span>\n            {settingExpand ? (\n              <IconDownArrow />\n            ) : (\n              <IconDownArrow className=\"rotate-180\" />\n            )}\n          </div>\n        }\n      />\n\n      {/* A setter dynamically rendered according to the backend */}\n      {doms}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, useCallback, useMemo } from 'react';\n\nimport classNames from 'classnames';\nimport {\n  useService,\n  useEntityFromContext,\n} from '@flowgram-adapter/free-layout-editor';\nimport { type WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { GenerationDiversity, useNodeTestId } from '@coze-workflow/base';\nimport { JsonViewer } from '@coze-common/json-viewer';\nimport { IconCozSetting } from '@coze-arch/coze-design/icons';\nimport { IconButton, type PopoverProps } from '@coze-arch/coze-design';\nimport { type OptionItem } from '@coze-arch/bot-semi/Radio';\nimport { Popover } from '@coze-arch/bot-semi';\n\nimport type { IModelValue, ComponentProps } from '@/typing';\nimport { WorkflowModelsService } from '@/services';\nimport { type ModelSelectV2Props } from '@/form-extensions/setters/model-select/components/selector/model-select-v2';\n\nimport PopupContainer from '../popup-container';\nimport { cacheData, generateDefaultValueByMeta } from './utils';\nimport { ModelSelector } from './components/selector';\nimport { ModelSetting } from './components/model-setting';\n\nconst defaultGenerationDiversity = GenerationDiversity.Balance;\n\ninterface ModelSelectProps extends ComponentProps<IModelValue | undefined> {\n  readonly?: boolean;\n  popoverPosition?: PopoverProps['position'];\n  popoverAutoAdjustOverflow?: boolean;\n  testName?: string;\n  triggerRender?: ModelSelectV2Props['triggerRender'];\n  className?: string;\n}\n\nexport const ModelSelect: FC<ModelSelectProps> = ({\n  value: _value,\n  onChange,\n  readonly,\n  popoverPosition,\n  popoverAutoAdjustOverflow,\n  testName,\n  triggerRender,\n  className,\n}) => {\n  const models =\n    useService<WorkflowModelsService>(WorkflowModelsService)?.getModels() ?? [];\n\n  const model = useMemo(\n    () => models.find(m => (m.model_type as number) === _value?.modelType),\n    [models, _value?.modelType],\n  );\n\n  /**\n   * Generate default values from modelMeta\n   */\n  const getDefaultValue = useCallback(\n    ({ modelType, value }: { modelType?: number; value?: object }) => {\n      const _model = models.find(m => m.model_type === modelType);\n      return generateDefaultValueByMeta({\n        modelParams: _model?.model_params,\n        value,\n      });\n    },\n    [models],\n  );\n\n  const defaultValue = useMemo(\n    () =>\n      getDefaultValue({ modelType: model?.model_type as number | undefined }),\n    [getDefaultValue, model?.model_type],\n  );\n\n  const value = useMemo(\n    () => ({\n      generationDiversity: GenerationDiversity.Customize,\n      ...defaultValue[value?.generationDiversity || defaultGenerationDiversity],\n      ..._value,\n    }),\n    [_value, defaultValue],\n  );\n\n  const modelOptions = useMemo(() => {\n    const _options = models.map<OptionItem>(i => {\n      const item = {\n        label: i.name,\n        value: i.model_type,\n      };\n      return item;\n    });\n    return _options;\n  }, [models]);\n\n  const node = useEntityFromContext<WorkflowNodeEntity>();\n  const { getNodeSetterId, concatTestId } = useNodeTestId();\n  const setterTestId = getNodeSetterId(testName || 'llm-select');\n\n  // [Operation and maintenance platform] Since the model list cannot be pulled, the drop-down box will not be rendered, so the existing model values will be directly displayed here.\n  if (IS_BOT_OP && value) {\n    return <JsonViewer data={value} />;\n  }\n\n  return (\n    <PopupContainer>\n      <div\n        className={classNames(\n          'flex gap-[4px] items-center relative',\n          className,\n        )}\n        data-testid={setterTestId}\n      >\n        <ModelSelector\n          readonly={readonly}\n          value={value?.modelType}\n          onChange={_v => {\n            const record = modelOptions.find(j => j.value === _v);\n            if (record) {\n              const generationDiversity =\n                value.generationDiversity ?? defaultGenerationDiversity;\n              let _defaultValue;\n\n              // If custom, priority: cached user value > default\n              if (generationDiversity === GenerationDiversity.Customize) {\n                _defaultValue =\n                  getDefaultValue({\n                    modelType: record.value as number,\n                    value: cacheData[node.id] as object,\n                  })?.[generationDiversity] ?? {};\n              } else {\n                _defaultValue =\n                  getDefaultValue({\n                    modelType: record.value as number,\n                  })?.[generationDiversity] ?? {};\n              }\n\n              onChange?.({\n                ..._defaultValue,\n                modelName: record.label as string,\n                modelType: record.value as number,\n                generationDiversity,\n                // Do not reset the output format when switching models\n                responseFormat:\n                  value?.responseFormat ?? _defaultValue?.responseFormat,\n              });\n            }\n          }}\n          models={models}\n          popoverPosition={popoverPosition}\n          triggerRender={triggerRender}\n        />\n        <Popover\n          autoAdjustOverflow={popoverAutoAdjustOverflow || false}\n          className=\"rounded-md w-[660px]\"\n          trigger=\"click\"\n          position={popoverPosition || 'bottomRight'}\n          content={\n            <ModelSetting\n              id={node.id}\n              defaultValue={defaultValue}\n              value={value}\n              onChange={_v => {\n                onChange?.({\n                  ..._v,\n                  modelName: value.modelName,\n                  modelType: value.modelType,\n                });\n              }}\n              model={model}\n              readonly={!!readonly}\n            />\n          }\n          spacing={30}\n        >\n          <IconButton\n            data-testid={`e2e-ui-button-action-${concatTestId(\n              setterTestId,\n              'model-setting-btn',\n            )}`}\n            wrapperClass=\"leading-none\"\n            color=\"secondary\"\n            size=\"small\"\n            icon={<IconCozSetting />}\n          />\n        </Popover>\n      </div>\n    </PopupContainer>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  startTransition,\n  type PropsWithChildren,\n  useState,\n  useEffect,\n} from 'react';\n\nimport { WorkflowNode, WorkflowNodeContext } from '@coze-workflow/base';\nimport {\n  PlaygroundEntityContext,\n  type FlowNodeEntity,\n  FlowNodeFormData,\n  FlowNodeErrorData,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  NodeRenderSceneContext,\n  type NodeRenderScene,\n} from '@/contexts/node-render-context';\n\ninterface NodeContextProviderProps {\n  node: FlowNodeEntity;\n  scene?: NodeRenderScene;\n}\n\nexport function NodeContextProvider({\n  node,\n  scene,\n  children,\n}: PropsWithChildren<NodeContextProviderProps>) {\n  const workflowNode = useWorkflowNode(node);\n  const [prevErrorMessage, setPrevErrorMessage] = useState<\n    string | undefined\n  >();\n\n  useEffect(() => {\n    if (!workflowNode.data) {\n      return;\n    }\n\n    const errorMessage = workflowNode.registry?.checkError?.(\n      workflowNode.data,\n      node.context,\n    );\n\n    if (errorMessage !== prevErrorMessage) {\n      if (errorMessage) {\n        workflowNode.setError({\n          name: 'CustomNodeError',\n          message: errorMessage,\n        });\n      }\n      setPrevErrorMessage(errorMessage);\n    }\n  }, [workflowNode]);\n\n  return (\n    <NodeRenderSceneContext.Provider value={scene}>\n      <WorkflowNodeContext.Provider value={workflowNode}>\n        <PlaygroundEntityContext.Provider value={node}>\n          {children}\n        </PlaygroundEntityContext.Provider>\n      </WorkflowNodeContext.Provider>\n    </NodeRenderSceneContext.Provider>\n  );\n}\n\nfunction useWorkflowNode(node: FlowNodeEntity) {\n  const [workflowNode, setWorkflowNode] = useState<WorkflowNode>(\n    new WorkflowNode(node),\n  );\n\n  // Monitor the underlying instance data changes and update the business layer instance\n  useEffect(() => {\n    const updateWorkflowNode = () => {\n      startTransition(() => {\n        const newWorkflowNode = new WorkflowNode(node);\n        setWorkflowNode(newWorkflowNode);\n      });\n    };\n\n    const dataChangeDisposer = node\n      .getData(FlowNodeFormData)\n      .onDataChange(() => updateWorkflowNode());\n\n    const initialDisposer = node\n      .getData(FlowNodeFormData)\n      .formModel.onInitialized(() => updateWorkflowNode());\n\n    const errorDisposer = node\n      .getData<FlowNodeErrorData>(FlowNodeErrorData)\n      .onDataChange(() => updateWorkflowNode());\n\n    return () => {\n      dataChangeDisposer?.dispose();\n      initialDisposer?.dispose();\n      errorDisposer?.dispose();\n    };\n  }, [node]);\n\n  return workflowNode;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, type CSSProperties } from 'react';\n\nimport classnames from 'classnames';\nimport { Image } from '@coze-arch/coze-design';\n\nimport styles from './node-icon-outlined.module.less';\nexport interface NodeIconOutlinedProps {\n  borderRadius?: CSSProperties['borderRadius'];\n  size?: number;\n  icon?: string;\n  hideOutline?: boolean;\n  outlineColor?: string;\n  style?: CSSProperties;\n  className?: string;\n}\nexport const NodeIconOutlined: FC<NodeIconOutlinedProps> = ({\n  icon,\n  size = 18,\n  hideOutline,\n  borderRadius = 'var(--coze-3)',\n  outlineColor = 'var(--coz-stroke-primary)',\n  className,\n  style,\n}) => (\n  <div\n    className={classnames(className, styles['node-icon-wrapper'])}\n    style={{ borderRadius, width: size, height: size, ...style }}\n  >\n    <Image\n      className={styles['node-icon']}\n      style={{ borderRadius }}\n      width={size}\n      height={size}\n      src={icon}\n      preview={false}\n    />\n    {hideOutline ? null : (\n      <div\n        className={styles['node-icon-border']}\n        style={{\n          borderRadius,\n          boxShadow: `inset 0 0 0 1px ${outlineColor}`,\n        }}\n      ></div>\n    )}\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { usePlayground } from '@flowgram-adapter/free-layout-editor';\nimport { type NodeData, WorkflowNodeData } from '@coze-workflow/nodes';\nimport { type WithCustomStyle } from '@coze-workflow/base/types';\nimport { CustomError } from '@coze-arch/bot-error';\nexport {\n  NodeIconOutlined,\n  type NodeIconOutlinedProps,\n} from './node-icon-outlined';\ninterface NodeIconProps {\n  nodeId: string;\n  size?: number;\n  alt?: string;\n}\nexport const NodeIcon: FC<WithCustomStyle<NodeIconProps>> = props => {\n  const { nodeId, className, size, alt } = props;\n\n  const playground = usePlayground();\n\n  let nodeEntity: FlowNodeEntity | undefined;\n\n  try {\n    nodeEntity = playground.entityManager.getEntityById(nodeId);\n  } catch (e) {\n    throw new CustomError(\n      `[NodeIcon] get node entity error, id: ${nodeId}`,\n      e.message,\n    );\n  }\n\n  if (!nodeEntity) {\n    return null;\n  }\n\n  const nodeDataEntity = nodeEntity.getData<WorkflowNodeData>(WorkflowNodeData);\n  const nodeData = nodeDataEntity.getNodeData<keyof NodeData>();\n\n  if (!nodeData?.icon) {\n    return null;\n  }\n\n  return (\n    <div className={className}>\n      <img\n        className=\"object-cover\"\n        src={nodeData.icon}\n        alt={alt}\n        style={{\n          width: size || 'auto',\n          height: size || 'auto',\n        }}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const PANEL_WIDTH = 440;\nexport const THROTTLE_INTERVAL = 300;\nexport const PAGE_SIZE = 9;\nexport const LOAD_MORE_PAGE_SIZE = 8;\nexport const LOAD_MORE_PLACEHOLDER = 'loadMore';\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Placeholder } from '@/components/node-render/node-render-new/placeholder';\n\nimport styles from './styles.module.less';\nexport const NodePlaceholder = () => (\n  <div\n    className={styles['node-placeholder']}\n    data-testid=\"workflow.detail.node-panel.placeholder\"\n  >\n    <Placeholder />\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useContext, createContext, type MouseEvent } from 'react';\n\nimport { type NodePanelSearchType } from '@coze-arch/bot-api/workflow_api';\n\nimport { type UnionNodeTemplate } from '@/typing';\ninterface NodePanelContextType {\n  onSelect?: (props: {\n    event: MouseEvent<HTMLElement>;\n    nodeTemplate: UnionNodeTemplate;\n  }) => void;\n  enableDrag?: boolean;\n  keyword?: string;\n  getScrollContainer?: () => HTMLDivElement | undefined;\n  onLoadMore?: (id?: NodePanelSearchType, cursor?: string) => Promise<void>;\n  /**\n   * Update the status of the node being added, clickOutside will not close the node panel at this time\n   * @param isAdding\n   * @returns\n   */\n  onAddingNode?: (isAdding: boolean) => void;\n}\n\nconst NodePanelContext = createContext<NodePanelContextType>({});\n\nexport const NodePanelContextProvider = NodePanelContext.Provider;\n\nexport const useNodePanelContext = () => useContext(NodePanelContext);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type WorkflowNodeEntity,\n  type WorkflowNodeMeta,\n  useService,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  getEnabledNodeTypes,\n  useSupportImageflowNodesQuery,\n} from '@coze-workflow/base-adapter';\nimport { StandardNodeType } from '@coze-workflow/base';\n\nimport { WorkflowPlaygroundContext } from '@/workflow-playground-context';\nimport { type NodeCategory } from '@/typing';\nimport { useGetWorkflowMode, useGlobalState } from '@/hooks';\n\nconst getLoopSelected = (containerNode?: WorkflowNodeEntity) => {\n  if (!containerNode) {\n    return false;\n  }\n  const containerSubCanvas = containerNode\n    .getNodeMeta<WorkflowNodeMeta>()\n    .subCanvas?.(containerNode);\n  if (\n    containerSubCanvas?.isCanvas &&\n    containerSubCanvas.parentNode.flowNodeType === StandardNodeType.Loop\n  ) {\n    return true;\n  }\n  return false;\n};\n\nexport const useTemplateNodeList = (\n  containerNode?: WorkflowNodeEntity,\n): NodeCategory[] => {\n  const loopSelected = getLoopSelected(containerNode);\n\n  const context = useService<WorkflowPlaygroundContext>(\n    WorkflowPlaygroundContext,\n  );\n\n  const { isSceneFlow } = useGetWorkflowMode();\n  const { projectId, isBindDouyin } = useGlobalState();\n  const { isSupportImageflowNodes } = useSupportImageflowNodesQuery();\n\n  const nodeCategoryList = context.getTemplateCategoryList(\n    getEnabledNodeTypes({\n      loopSelected,\n      isSceneFlow,\n      isProject: Boolean(projectId),\n      isSupportImageflowNodes,\n      isBindDouyin: Boolean(isBindDouyin),\n    }),\n    isSupportImageflowNodes,\n  );\n\n  return nodeCategoryList;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport { uniqBy } from 'lodash-es';\nimport { StandardNodeType } from '@coze-workflow/base';\nimport { type FavoriteProductInfo } from '@coze-arch/bot-api/product_api';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\n\nimport { WorkflowPlaygroundContext } from '@/workflow-playground-context';\nimport { type PluginNodeTemplate } from '@/typing';\nimport { createApiNodeInfo } from '@/hooks/use-add-node-modal/helper';\n\nimport { PAGE_SIZE } from '../constant';\nconst formatPluginProduct = (\n  productInfoList?: FavoriteProductInfo[],\n): PluginNodeTemplate[] =>\n  productInfoList?.map(({ product }) => {\n    const pluginId = product.meta_info?.entity_id ?? '';\n    const pluginName = product.meta_info?.name ?? '';\n    const icon = product.meta_info?.icon_url ?? '';\n    const pluginNodeTemplate: PluginNodeTemplate = {\n      plugin_id: pluginId,\n      name: pluginName,\n      desc: product.meta_info?.description ?? '',\n      icon_url: product.meta_info?.icon_url ?? '',\n      tools:\n        product.plugin_extra?.tools?.map(tool => {\n          const nodeJSON = createApiNodeInfo(\n            {\n              name: tool.name,\n              plugin_name: pluginName,\n              api_id: tool.id,\n              plugin_id: pluginId,\n              desc: tool.description,\n            },\n            icon,\n          );\n          return {\n            type: StandardNodeType.Api,\n            name: tool.name,\n            desc: tool.description,\n            plugin_id: pluginId,\n            api_id: tool.id,\n            icon_url: icon,\n            nodeJSON,\n            version: '',\n          };\n        }) ?? [],\n    };\n    return pluginNodeTemplate;\n  }) ?? [];\n\nexport const useFavoritePluginNodeList = (): {\n  hasMore: boolean;\n  pluginNodeList: PluginNodeTemplate[];\n  loadMore: () => Promise<void>;\n  refetch: () => Promise<void>;\n} => {\n  const context = useService<WorkflowPlaygroundContext>(\n    WorkflowPlaygroundContext,\n  );\n\n  const [hasMore, setHasMore] = useState(\n    context.favoritePlugins?.has_more ?? false,\n  );\n\n  const [pluginNodeList, setPluginNodeList] = useState<PluginNodeTemplate[]>(\n    formatPluginProduct(context.favoritePlugins?.favorite_products),\n  );\n\n  const loadMore = async () => {\n    if (!hasMore) {\n      return;\n    }\n    const pageSize = PAGE_SIZE;\n    const pageNum = Math.floor(pluginNodeList.length / pageSize + 1);\n    const resp = await context.fetchFavoritePlugins({ pageNum, pageSize });\n    setHasMore(resp?.has_more ?? false);\n    setPluginNodeList(prev => {\n      const moreList = formatPluginProduct(resp?.favorite_products);\n      const newList = uniqBy(prev.concat(moreList), 'plugin_id');\n      return newList;\n    });\n    // Update the list of plugins saved on the context and keep loading more the next time you open the node panel\n    context.favoritePlugins = {\n      favorite_products: context.favoritePlugins?.favorite_products?.concat(\n        resp?.favorite_products ?? [],\n      ),\n      has_more: resp?.has_more,\n    };\n  };\n\n  const refetch = async () => {\n    try {\n      const pageSize = Math.max(\n        context.favoritePlugins?.favorite_products?.length ?? PAGE_SIZE,\n        PAGE_SIZE,\n      );\n      const pageNum = 1;\n      const resp = await context.fetchFavoritePlugins({ pageNum, pageSize });\n      setHasMore(resp?.has_more ?? false);\n      setPluginNodeList(formatPluginProduct(resp?.favorite_products));\n      context.favoritePlugins = resp;\n    } catch (e) {\n      console.error('refetchFavoritePlugins error', e);\n    }\n  };\n\n  return { pluginNodeList, hasMore, loadMore, refetch };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { cloneDeep } from 'lodash-es';\nimport { type BotPluginWorkFlowItem } from '@coze-workflow/components';\nimport { StandardNodeType } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  NodePanelSearchType,\n  type NodePanelPlugin,\n  type NodePanelSearchResponse,\n  type Workflow,\n} from '@coze-arch/bot-api/workflow_api';\n\nimport {\n  NodeSearchSectionType,\n  type NodeSearchCategoryData,\n  type NodeSearchResult,\n  type PluginNodeTemplate,\n  type SubWorkflowNodeTemplate,\n} from '@/typing';\nimport {\n  createApiNodeInfo,\n  createSubWorkflowNodeInfo,\n} from '@/hooks/use-add-node-modal/helper';\nexport const formatWorkflow = (\n  spaceId: string,\n  workflow: Workflow,\n): SubWorkflowNodeTemplate => {\n  const { name, desc, url, workflow_id, plugin_id } = workflow;\n  return {\n    type: StandardNodeType.SubWorkflow,\n    name,\n    desc,\n    icon_url: url,\n    plugin_id,\n    workflow_id: workflow_id ?? '',\n    nodeJSON: createSubWorkflowNodeInfo({\n      // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n      workflowItem: {\n        name,\n        workflow_id,\n        desc,\n      } as BotPluginWorkFlowItem,\n      spaceId,\n      isImageflow: false,\n      templateIcon: url,\n    }),\n  };\n};\n\nexport const formatPlugin = (plugin: NodePanelPlugin): PluginNodeTemplate => {\n  const {\n    name = '',\n    desc = '',\n    icon = '',\n    plugin_id,\n    tool_list = [],\n    version,\n  } = plugin;\n  return {\n    plugin_id: plugin_id ?? '',\n    name,\n    desc,\n    icon_url: icon,\n    tools: tool_list.map(tool => {\n      const { api_name, api_desc, api_id } = tool;\n      return {\n        type: StandardNodeType.Api,\n        name: api_name,\n        desc: api_desc,\n        plugin_id,\n        version,\n        nodeJSON: createApiNodeInfo(\n          {\n            name: api_name,\n            plugin_name: name,\n            api_id,\n            plugin_id,\n            desc,\n            version_ts: version,\n          },\n          icon,\n        ),\n      };\n    }),\n  };\n};\n\nexport const formatBackendSearchResult = (\n  spaceId: string,\n  response: NodePanelSearchResponse,\n): NodeSearchResult => {\n  if (!response.data) {\n    return [];\n  }\n\n  const panelData = response.data;\n  const workflowCategoryData: Array<\n    NodeSearchCategoryData<SubWorkflowNodeTemplate>\n  > = [];\n  if (panelData?.project_workflow?.workflow_list?.length) {\n    const {\n      workflow_list,\n      has_more = false,\n      next_page_or_cursor,\n    } = panelData.project_workflow;\n    workflowCategoryData.push({\n      id: NodePanelSearchType.ProjectWorkflow,\n      categoryName: I18n.t('workflow_0224_02', {\n        source: I18n.t('wf_chatflow_106'),\n      }),\n      nodeList: workflow_list.map(wf => formatWorkflow(spaceId, wf)),\n      hasMore: has_more,\n      cursor: next_page_or_cursor,\n    });\n  }\n  if (panelData?.resource_workflow?.workflow_list?.length) {\n    const {\n      workflow_list,\n      has_more = false,\n      next_page_or_cursor,\n    } = panelData.resource_workflow;\n    workflowCategoryData.push({\n      id: NodePanelSearchType.ResourceWorkflow,\n      categoryName: I18n.t('workflow_0224_02', {\n        source: I18n.t('navigation_workspace_library'),\n      }),\n      nodeList: workflow_list.map(wf => formatWorkflow(spaceId, wf)),\n      hasMore: has_more,\n      cursor: next_page_or_cursor,\n    });\n  }\n  const pluginCategoryData: Array<NodeSearchCategoryData<PluginNodeTemplate>> =\n    [];\n\n  if (panelData?.favorite_plugin?.plugin_list?.length) {\n    const {\n      plugin_list,\n      has_more = false,\n      next_page_or_cursor,\n    } = panelData.favorite_plugin;\n    pluginCategoryData.push({\n      id: NodePanelSearchType.FavoritePlugin,\n      categoryName: I18n.t('workflow_0224_03'),\n      nodeList: plugin_list.map(formatPlugin),\n      hasMore: has_more,\n      cursor: next_page_or_cursor,\n    });\n  }\n  if (panelData?.project_plugin?.plugin_list?.length) {\n    const {\n      plugin_list,\n      has_more = false,\n      next_page_or_cursor,\n    } = panelData.project_plugin;\n    pluginCategoryData.push({\n      id: NodePanelSearchType.ProjectPlugin,\n      categoryName: I18n.t('workflow_0224_02', {\n        source: I18n.t('wf_chatflow_106'),\n      }),\n      nodeList: plugin_list.map(formatPlugin),\n      hasMore: has_more,\n      cursor: next_page_or_cursor,\n    });\n  }\n  if (panelData?.resource_plugin?.plugin_list?.length) {\n    const {\n      plugin_list,\n      has_more = false,\n      next_page_or_cursor,\n    } = panelData.resource_plugin;\n    pluginCategoryData.push({\n      id: NodePanelSearchType.ResourcePlugin,\n      categoryName: I18n.t('workflow_0224_02', {\n        source: I18n.t('navigation_workspace_library'),\n      }),\n      nodeList: plugin_list.map(formatPlugin),\n      hasMore: has_more,\n      cursor: next_page_or_cursor,\n    });\n  }\n  if (panelData?.store_plugin?.plugin_list?.length) {\n    const {\n      plugin_list,\n      has_more = false,\n      next_page_or_cursor,\n    } = panelData.store_plugin;\n    pluginCategoryData.push({\n      id: NodePanelSearchType.StorePlugin,\n      categoryName: I18n.t('workflow_0224_06'),\n      nodeList: plugin_list.map(formatPlugin),\n      hasMore: has_more,\n      cursor: next_page_or_cursor,\n    });\n  }\n  return [\n    {\n      name: I18n.t('Workflow'),\n      data: workflowCategoryData,\n      dataType: NodeSearchSectionType.SubWorkflow,\n    },\n    {\n      name: I18n.t('project_ide_frame_plugin'),\n      data: pluginCategoryData,\n      dataType: NodeSearchSectionType.Plugin,\n    },\n  ].filter(item => item.data.length > 0) as NodeSearchResult;\n};\n\nexport const mergeSearchResult = (\n  searchType: NodePanelSearchType,\n  prevSearchResult: NodeSearchResult,\n  loadMoreData: NodeSearchResult,\n) => {\n  const copy = cloneDeep(prevSearchResult);\n  for (const item of copy) {\n    const { dataType } = item;\n    for (const subItem of item.data) {\n      const { id } = subItem;\n      if (id === searchType || searchType === NodePanelSearchType.All) {\n        const moreData = loadMoreData\n          .find(i => i.dataType === dataType)\n          ?.data?.find(i => i.id === id);\n        if (moreData?.nodeList.length) {\n          subItem.hasMore = moreData.hasMore;\n          subItem.cursor = moreData.cursor;\n          subItem.nodeList = [\n            ...subItem.nodeList,\n            ...moreData.nodeList,\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          ] as NodeSearchCategoryData<any>['nodeList'];\n        } else {\n          subItem.hasMore = false;\n        }\n      }\n    }\n  }\n  return copy;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo, useState, useCallback } from 'react';\n\nimport { debounce } from 'lodash-es';\nimport { workflowApi } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { NodePanelSearchType } from '@coze-arch/bot-api/workflow_api';\n\nimport {\n  isNodeTemplate,\n  isPluginApiNodeTemplate,\n  isPluginCategoryNodeTemplate,\n} from '@/utils';\nimport {\n  NodeSearchSectionType,\n  type NodeCategory,\n  type NodeSearchResult,\n} from '@/typing';\nimport { useGlobalState } from '@/hooks';\n\nimport { formatBackendSearchResult, mergeSearchResult } from '../utils';\nimport { PAGE_SIZE } from '../constant';\n\nexport interface UseSearchNodeProps {\n  keyword: string;\n  atomNodeCategoryList: NodeCategory[];\n}\n\nexport const useSearchNode = ({\n  atomNodeCategoryList,\n}: {\n  atomNodeCategoryList: NodeCategory[];\n}): {\n  keyword: string;\n  isSearching: boolean;\n  searchResult: NodeSearchResult;\n  noSearchResult: boolean;\n  showSearchResult: boolean;\n  loadMore: (id?: NodePanelSearchType, cursor?: string) => Promise<void>;\n  handleKeywordChange: (keyword: string) => void;\n} => {\n  const [keyword, setKeyword] = useState('');\n\n  const { spaceId, projectId, workflowId } = useGlobalState();\n  const showSearchResult = useMemo(() => Boolean(keyword), [keyword]);\n  const atomNodeSearchResult = useMemo<NodeSearchResult>(() => {\n    if (!keyword) {\n      return [];\n    }\n    const filtered = atomNodeCategoryList\n      .map(({ categoryName, nodeList }) => ({\n        categoryName,\n        nodeList: nodeList.filter(node => {\n          const queryList: Array<string | undefined> = [];\n          if (isPluginApiNodeTemplate(node)) {\n            queryList.push(\n              node.name,\n              node.api_name,\n              node.desc,\n              node.api_id,\n              node.plugin_id,\n            );\n          } else if (isPluginCategoryNodeTemplate(node)) {\n            queryList.push(node.name, node.categoryInfo.categoryId);\n          } else if (isNodeTemplate(node)) {\n            queryList.push(node.name, node.desc);\n          }\n          return queryList\n            .filter((item): item is string => Boolean(item))\n            .some(item => item.toLowerCase().includes(keyword.toLowerCase()));\n        }),\n      }))\n      .filter(({ nodeList }) => nodeList.length);\n    if (filtered.length === 0) {\n      return [];\n    }\n    return [\n      {\n        name: I18n.t('workflow_0224_01'),\n        data: filtered,\n        dataType: NodeSearchSectionType.Atom,\n      },\n    ];\n  }, [keyword, atomNodeCategoryList]);\n  const [isSearching, setIsSearching] = useState(false);\n\n  const [backendSearchResult, setBackendSearchResult] =\n    useState<NodeSearchResult>([]);\n\n  const handleKeywordChange = (newKeyword: string) => {\n    setKeyword(newKeyword);\n    if (!newKeyword) {\n      setBackendSearchResult([]);\n      return;\n    }\n    setIsSearching(true);\n    debouncedBackendSearch(newKeyword);\n  };\n\n  const debouncedBackendSearch = useCallback(\n    debounce(async (_keyword: string) => {\n      try {\n        const resp = await workflowApi.NodePanelSearch({\n          search_type: NodePanelSearchType.All,\n          space_id: spaceId,\n          project_id: projectId,\n          search_key: _keyword,\n          page_size: PAGE_SIZE,\n          page_or_cursor: '',\n          exclude_workflow_id: workflowId,\n        });\n        setBackendSearchResult(formatBackendSearchResult(spaceId, resp));\n      } catch (error) {\n        console.error(error);\n      } finally {\n        setIsSearching(false);\n      }\n    }, 300),\n    [],\n  );\n\n  const loadMore = async (\n    searchType?: NodePanelSearchType,\n    cursor?: string,\n  ) => {\n    const resp = await workflowApi.NodePanelSearch({\n      search_type: searchType ?? NodePanelSearchType.All,\n      space_id: spaceId,\n      project_id: projectId,\n      search_key: keyword,\n      page_size: PAGE_SIZE,\n      page_or_cursor: cursor ?? '',\n    });\n    setBackendSearchResult(prev =>\n      mergeSearchResult(\n        searchType ?? NodePanelSearchType.All,\n        prev,\n        formatBackendSearchResult(spaceId, resp),\n      ),\n    );\n  };\n\n  const searchResult = useMemo<NodeSearchResult>(\n    () => [...atomNodeSearchResult, ...backendSearchResult],\n    [atomNodeSearchResult, backendSearchResult],\n  );\n\n  const noSearchResult = useMemo(\n    () =>\n      showSearchResult &&\n      !isSearching &&\n      searchResult.reduce((acc, curr) => {\n        const nodes = curr.data.flatMap(item => item.nodeList);\n        acc += nodes.length;\n        return acc;\n      }, 0) === 0,\n    [showSearchResult, searchResult, isSearching],\n  );\n\n  return {\n    keyword,\n    handleKeywordChange,\n    showSearchResult,\n    isSearching,\n    noSearchResult,\n    searchResult,\n    loadMore,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type PropsWithChildren } from 'react';\n\nimport { concatTestId } from '@coze-workflow/base';\nimport { Typography } from '@coze-arch/coze-design';\n\nimport styles from './index.module.less';\nexport interface NodeCategoryPanelProps {\n  categoryName?: string;\n}\nexport const NodeCategoryPanel = function ({\n  categoryName,\n  children,\n}: PropsWithChildren<NodeCategoryPanelProps>) {\n  return (\n    <div className=\"node-category-panel\">\n      {categoryName ? (\n        <Typography.Text\n          className=\"block coz-fg-secondary leading-5 mb-1 pl-1 font-['PICO_Sans_VFE_SC']\"\n          weight={500}\n          size=\"normal\"\n          data-testid={concatTestId(\n            'workflow.detail.node-panel.list.category.name',\n            categoryName,\n          )}\n        >\n          {categoryName}\n        </Typography.Text>\n      ) : null}\n      <div\n        className={styles['node-category-list']}\n        data-testid=\"workflow.detail.node-panel.list.category.list\"\n      >\n        {children}\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, useState } from 'react';\n\nimport classNames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozArrowDown, IconCozLoading } from '@coze-arch/coze-design/icons';\nimport { Typography } from '@coze-arch/coze-design';\n\nimport styles from './styles.module.less';\nexport const LoadMoreCard: FC<{\n  onLoadMore: () => Promise<void>;\n}> = ({ onLoadMore }) => {\n  const [loading, setLoading] = useState(false);\n  return (\n    <div\n      className={styles['load-more']}\n      onClick={async () => {\n        try {\n          setLoading(true);\n          await onLoadMore?.();\n        } finally {\n          setLoading(false);\n        }\n      }}\n    >\n      <div className={styles['load-more-icon']}>\n        {loading ? (\n          <IconCozLoading\n            className={classNames(styles.icon, 'semi-spin-animate')}\n          />\n        ) : (\n          <IconCozArrowDown className={styles.icon} />\n        )}\n      </div>\n      <Typography.Text className={styles['load-more-text']}>\n        {I18n.t('workflow_0224_05')}\n      </Typography.Text>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useDrag } from 'react-dnd';\nimport React, { type PropsWithChildren } from 'react';\n\nimport classNames from 'classnames';\nimport { concatTestId, type StandardNodeType } from '@coze-workflow/base';\nimport { Tooltip, type TooltipProps } from '@coze-arch/coze-design';\nimport { useEntity, useService } from '@flowgram-adapter/free-layout-editor';\nimport { type WorkflowNodeJSON } from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  isPluginCategoryNodeTemplate,\n  isPluginApiNodeTemplate,\n  isSubWorkflowNodeTemplate,\n} from '@/utils';\nimport {\n  WorkflowGlobalStateEntity,\n  type UnionNodeTemplate,\n  type DragObject,\n} from '@/typing';\nimport { WorkflowCustomDragService } from '@/services';\nimport { DND_ACCEPT_KEY } from '@/constants';\n\nimport styles from './styles.module.less';\n\nexport interface ICustomDragCardProps {\n  className?: string;\n  style?: React.CSSProperties;\n  nodeType: StandardNodeType;\n  nodeJson?: Partial<WorkflowNodeJSON>;\n  disabled: boolean;\n  children: React.ReactNode;\n  nodeDesc?: string;\n  tooltipPosition?: TooltipProps['position'];\n  nodeTemplate?: UnionNodeTemplate;\n  [k: string]: unknown;\n}\n\nexport function CustomDragCard({\n  className,\n  style,\n  children,\n  nodeType,\n  nodeJson,\n  disabled,\n  nodeDesc,\n  tooltipPosition,\n  nodeTemplate,\n  ...rest\n}: PropsWithChildren<ICustomDragCardProps>) {\n  const workflowState = useEntity<WorkflowGlobalStateEntity>(\n    WorkflowGlobalStateEntity,\n  );\n\n  const dragService = useService<WorkflowCustomDragService>(\n    WorkflowCustomDragService,\n  );\n\n  const testId = concatTestId('workflow.detail.node-panel.card', nodeType);\n\n  const [{ isDragging }, drag, preview] = useDrag<\n    DragObject,\n    unknown,\n    { isDragging: boolean }\n  >(() => ({\n    type: DND_ACCEPT_KEY,\n    item: {\n      nodeType,\n      nodeJson,\n      modalProps: isPluginCategoryNodeTemplate(nodeTemplate)\n        ? {\n            initQuery: {\n              type: nodeTemplate.categoryInfo.categoryId,\n              isOfficial: nodeTemplate.categoryInfo.onlyOfficial\n                ? true\n                : undefined,\n            },\n          }\n        : undefined,\n      nodeVersionInfo: isPluginApiNodeTemplate(nodeTemplate)\n        ? { pluginId: nodeTemplate.plugin_id, version: nodeTemplate.version }\n        : isSubWorkflowNodeTemplate(nodeTemplate)\n        ? // The version information of the workflow is obtained through the interface when dropping\n          {\n            workflowId: nodeTemplate.workflow_id,\n            pluginId: nodeTemplate.plugin_id,\n          }\n        : {},\n    },\n    collect: monitor => {\n      const dragType = monitor.getItemType();\n      const item = monitor.getItem();\n      if (item && dragType === DND_ACCEPT_KEY) {\n        dragService.startDrag({\n          type: item.nodeType,\n          json: item.nodeJson,\n        });\n      } else {\n        dragService.endDrag();\n      }\n      return {\n        isDragging: monitor.isDragging(),\n      };\n    },\n  }));\n\n  const computedClassNames = classNames({\n    [styles.card]: true,\n    [styles['not-allowed']]: workflowState.isExecuting,\n    [styles.grabbing]: isDragging,\n    [className || '']: Boolean(className),\n  });\n\n  const baseContent = (\n    <div\n      className={styles.cardMargin}\n      style={{ position: 'relative' }}\n      data-testid={testId}\n      data-node-type={nodeType}\n    >\n      {/* The copy of the node during the drag process is overwritten by the node below, so no hover or the like is triggered */}\n      <div\n        ref={preview}\n        className={classNames(computedClassNames, styles['preview-card'])}\n        style={style}\n        {...rest}\n      >\n        {children}\n      </div>\n      {/* Draggable nodes, overlaid on node replicas */}\n      {\n        <div\n          ref={!disabled ? drag : null}\n          className={classNames(computedClassNames, styles['drag-card'])}\n          {...rest}\n        >\n          {children}\n        </div>\n      }\n    </div>\n  );\n  if (nodeDesc && !isDragging) {\n    return (\n      <Tooltip\n        content={nodeDesc}\n        position={tooltipPosition}\n        mouseEnterDelay={500}\n      >\n        {baseContent}\n      </Tooltip>\n    );\n  } else {\n    return baseContent;\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, type MouseEvent } from 'react';\n\nimport classNames from 'classnames';\nimport { Typography, Highlight } from '@coze-arch/coze-design';\n\nimport { NodeIconOutlined } from '@/components/node-icon';\n\nimport styles from './styles.module.less';\n\ninterface NodesContainerProps {\n  className?: string;\n  name: string;\n  hideOutline?: boolean;\n  icon: string;\n  keyword?: string;\n  onClick: (event: MouseEvent<HTMLElement>) => void;\n}\n\nexport const NodeCard: FC<NodesContainerProps> = props => {\n  const {\n    name,\n    icon,\n    hideOutline = false,\n    onClick,\n    keyword,\n    className,\n  } = props;\n\n  return (\n    <div\n      className={classNames(styles['node-card'], className)}\n      key={name}\n      onClick={onClick}\n    >\n      <NodeIconOutlined\n        size={20}\n        icon={icon}\n        hideOutline={hideOutline}\n        borderRadius=\"var(--coze-4)\"\n        outlineColor=\"var(--coz-stroke-plus)\"\n      />\n      <Typography.Text\n        className={classNames(\n          styles['node-title'],\n          \"font-['PICO_Sans_VFE_SC']\",\n        )}\n        ellipsis\n      >\n        <Highlight\n          sourceString={name || ''}\n          searchWords={keyword ? [keyword] : []}\n          highlightStyle={{\n            backgroundColor: 'transparent',\n            color: 'var(--coz-fg-color-orange)',\n            fontWeight: 400,\n          }}\n        />\n      </Typography.Text>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, type MouseEvent } from 'react';\n\nimport semver from 'semver';\nimport { cloneDeep, get, set } from 'lodash-es';\nimport { type StandardNodeType } from '@coze-workflow/base';\n\nimport { getWorkflowVersionByPluginId } from '@/utils';\nimport {\n  type NodeSearchCategoryData,\n  type SubWorkflowNodeTemplate,\n} from '@/typing';\nimport { useGlobalState, useNodeVersionService } from '@/hooks';\n\nimport { NodeCategoryPanel } from '../node-category-panel';\nimport { LoadMoreCard } from '../load-more-card';\nimport { CustomDragCard } from '../custom-drag-card';\nimport { NodeCard } from '../card';\nimport { useNodePanelContext } from '../../hooks/node-panel-context';\n\nexport interface SubWorkflowCategoryListProps {\n  data: Array<NodeSearchCategoryData<SubWorkflowNodeTemplate>>;\n}\nexport const SubWorkflowCategoryList: FC<SubWorkflowCategoryListProps> = ({\n  data,\n}) => {\n  const { keyword, enableDrag, onSelect, onLoadMore, onAddingNode } =\n    useNodePanelContext();\n  const { spaceId } = useGlobalState();\n  const nodeVersionService = useNodeVersionService();\n\n  const handleSelect = async ({\n    event,\n    nodeTemplate,\n  }: {\n    event: MouseEvent<HTMLElement>;\n    nodeTemplate: SubWorkflowNodeTemplate;\n  }) => {\n    if (!nodeTemplate.plugin_id || nodeTemplate.plugin_id === '0') {\n      onSelect?.({ event, nodeTemplate });\n      return;\n    }\n\n    try {\n      onAddingNode?.(true);\n      // Complete version information\n      const versionName = await getWorkflowVersionByPluginId({\n        spaceId,\n        pluginId: nodeTemplate.plugin_id,\n      });\n      if (versionName && semver.valid(versionName)) {\n        if (\n          !(await nodeVersionService.addSubWorkflowCheck(\n            nodeTemplate.workflow_id,\n            versionName,\n          ))\n        ) {\n          return;\n        }\n\n        const copy = cloneDeep(nodeTemplate);\n        set(copy, 'nodeJSON.data.inputs.workflowVersion', versionName);\n        onSelect?.({ event, nodeTemplate: copy });\n      }\n    } finally {\n      onAddingNode?.(false);\n    }\n  };\n  return (\n    <>\n      {data.map(({ id, categoryName, nodeList, hasMore, cursor }) => (\n        <NodeCategoryPanel key={id} categoryName={categoryName}>\n          {nodeList.map((nodeTemplate, index) => (\n            <CustomDragCard\n              key={`${nodeTemplate?.type}_${nodeTemplate.name}`}\n              tooltipPosition={index % 2 === 0 ? 'left' : 'right'}\n              nodeType={nodeTemplate?.type as StandardNodeType}\n              nodeDesc={get(nodeTemplate, 'desc')}\n              nodeJson={get(nodeTemplate, 'nodeJSON')}\n              nodeTemplate={nodeTemplate}\n              disabled={!enableDrag}\n            >\n              <NodeCard\n                name={nodeTemplate.name ?? ''}\n                icon={nodeTemplate.icon_url ?? ''}\n                keyword={keyword}\n                onClick={event => handleSelect({ event, nodeTemplate })}\n              />\n            </CustomDragCard>\n          ))}\n          {hasMore ? (\n            <LoadMoreCard\n              onLoadMore={async () => {\n                await onLoadMore?.(id, cursor);\n              }}\n            />\n          ) : null}\n        </NodeCategoryPanel>\n      ))}\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, type MouseEvent } from 'react';\n\nimport { IconCozPluginFill } from '@coze-arch/coze-design/icons';\nimport { Typography, Highlight } from '@coze-arch/coze-design';\n\nimport styles from './styles.module.less';\n\ninterface NodesContainerProps {\n  name: string;\n  keyword?: string;\n  onClick: (event: MouseEvent<HTMLElement>) => void;\n}\n\nexport const PluginToolCard: FC<NodesContainerProps> = props => {\n  const { name, onClick, keyword } = props;\n\n  return (\n    <div className={styles['plugin-tool-card']} key={name} onClick={onClick}>\n      <IconCozPluginFill className=\"text-[16px] coz-fg-dim\" />\n      <Typography.Text\n        size=\"normal\"\n        className=\"coz-fg-secondary leading-5\"\n        ellipsis={{\n          showTooltip: {\n            opts: {\n              content: name,\n              style: { wordBreak: 'break-word' },\n            },\n          },\n        }}\n      >\n        <Highlight\n          sourceString={name || ''}\n          searchWords={keyword ? [keyword] : []}\n          highlightStyle={{\n            backgroundColor: 'transparent',\n            color: 'var(--coz-fg-color-orange)',\n            fontWeight: 400,\n          }}\n        />\n      </Typography.Text>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, type MouseEvent } from 'react';\n\nimport classNames from 'classnames';\nimport { IconCozCross, IconCozExpand } from '@coze-arch/coze-design/icons';\nimport { Typography, Highlight, IconButton } from '@coze-arch/coze-design';\n\nimport { NodeIconOutlined } from '@/components/node-icon';\n\nimport styles from './styles.module.less';\ninterface NodesContainerProps {\n  className?: string;\n  name: string;\n  icon: string;\n  keyword?: string;\n  expand: boolean;\n  onClick: (event: MouseEvent<HTMLElement>) => void;\n}\n\nexport const PluginNodeCard: FC<NodesContainerProps> = props => {\n  const { name, icon, onClick, keyword, expand } = props;\n\n  return (\n    <div\n      className={classNames(styles['plugin-node-card'], {\n        [styles.expand]: expand,\n      })}\n      key={name}\n      onClick={onClick}\n    >\n      <NodeIconOutlined\n        size={20}\n        icon={icon}\n        borderRadius=\"var(--coze-4)\"\n        outlineColor=\"var(--coz-stroke-plus)\"\n      />\n      <Typography.Text\n        className={classNames(\n          styles['node-title'],\n          \"font-['PICO_Sans_VFE_SC']\",\n        )}\n        ellipsis\n      >\n        <Highlight\n          sourceString={name || ''}\n          searchWords={keyword ? [keyword] : []}\n          highlightStyle={{\n            backgroundColor: 'transparent',\n            color: 'var(--coz-fg-color-orange)',\n            fontWeight: 400,\n          }}\n        />\n      </Typography.Text>\n      <div className={styles['expand-btn']}>\n        <IconButton\n          size=\"small\"\n          style={{ width: 20, height: 20, minWidth: 20 }}\n          color=\"secondary\"\n          icon={\n            expand ? (\n              <IconCozCross className=\"coz-fg-secondary text-[16px]\" />\n            ) : (\n              <IconCozExpand className=\"coz-fg-secondary text-[16px]\" />\n            )\n          }\n        />\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, type MouseEvent } from 'react';\n\nimport classNames from 'classnames';\nimport { type StandardNodeType } from '@coze-workflow/base';\nimport { Tooltip } from '@coze-arch/coze-design';\n\nimport { type PluginNodeTemplate, type PluginApiNodeTemplate } from '@/typing';\n\nimport { CustomDragCard } from '../custom-drag-card';\nimport { NodeCard } from '../card';\nimport { PluginNodeCard } from './plugin-node-card';\n\nimport styles from './styles.module.less';\nexport interface PluginNodeProps {\n  index: number;\n  nodeTemplate: PluginNodeTemplate;\n  enableDrag?: boolean;\n  keyword?: string;\n  onSelect?: (props: {\n    event: MouseEvent<HTMLElement>;\n    nodeTemplate: PluginApiNodeTemplate;\n  }) => void;\n  expand?: boolean;\n  onExpandChange?: (expand: boolean) => void;\n}\nexport const PluginNode: FC<PluginNodeProps> = ({\n  index,\n  nodeTemplate,\n  enableDrag,\n  onSelect,\n  keyword,\n  expand,\n  onExpandChange,\n}) => {\n  const {\n    name: pluginName,\n    plugin_id,\n    icon_url,\n    desc: pluginDesc,\n    tools,\n  } = nodeTemplate;\n  const renderPluginNode = () => {\n    const tooltipPosition = index % 2 === 0 ? 'left' : 'right';\n    if (tools?.length === 1) {\n      const pluginTool = tools[0];\n      return (\n        <CustomDragCard\n          key={plugin_id}\n          tooltipPosition={tooltipPosition}\n          nodeType={pluginTool?.type as StandardNodeType}\n          nodeDesc={pluginDesc}\n          nodeJson={pluginTool.nodeJSON}\n          nodeTemplate={pluginTool}\n          disabled={!enableDrag}\n        >\n          <NodeCard\n            name={pluginName ?? ''}\n            icon={icon_url}\n            keyword={keyword}\n            onClick={event => onSelect?.({ event, nodeTemplate: pluginTool })}\n          />\n        </CustomDragCard>\n      );\n    } else {\n      return (\n        <div className={styles['plugin-card-wrapper']}>\n          {expand ? (\n            <div\n              className={classNames(\n                styles['plugin-card-cutcorner'],\n                styles['left-corner'],\n              )}\n            ></div>\n          ) : null}\n          <Tooltip\n            content={pluginDesc}\n            position={tooltipPosition}\n            mouseEnterDelay={500}\n          >\n            <div>\n              <PluginNodeCard\n                name={pluginName ?? ''}\n                icon={icon_url ?? ''}\n                keyword={keyword}\n                expand={expand ?? false}\n                onClick={() => onExpandChange?.(!expand)}\n              />\n            </div>\n          </Tooltip>\n          {expand ? (\n            <div\n              className={classNames(\n                styles['plugin-card-cutcorner'],\n                styles['right-corner'],\n              )}\n            ></div>\n          ) : null}\n        </div>\n      );\n    }\n  };\n  return renderPluginNode();\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, useState, useMemo, type MouseEvent } from 'react';\n\nimport { isNumber } from 'lodash-es';\nimport classNames from 'classnames';\nimport { StandardNodeType, concatTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozArrowRight } from '@coze-arch/coze-design/icons';\nimport { Typography } from '@coze-arch/coze-design';\n\nimport {\n  type UnionNodeTemplate,\n  type PluginApiNodeTemplate,\n  type PluginNodeTemplate,\n} from '@/typing';\nimport { useNodeVersionService } from '@/hooks';\n\nimport { LoadMoreCard } from '../load-more-card';\nimport { CustomDragCard } from '../custom-drag-card';\nimport { useNodePanelContext } from '../../hooks/node-panel-context';\nimport {\n  PAGE_SIZE as INIT_PAGE_SIZE,\n  LOAD_MORE_PAGE_SIZE,\n  LOAD_MORE_PLACEHOLDER,\n} from '../../constant';\nimport { PluginToolCard } from './plugin-tool-card';\nimport { PluginNode } from './plugin-node';\n\nimport styles from './styles.module.less';\nexport interface PluginNodeListProps {\n  pluginNodeList: PluginNodeTemplate[];\n  hasMore?: boolean;\n  onLoadMore: () => Promise<void>;\n  showExploreMore?: boolean;\n  categoryName: string;\n}\n\nexport type LoadMorePlaceholder = typeof LOAD_MORE_PLACEHOLDER;\nexport type PluginNodeListWithLoadMore = Array<\n  PluginNodeTemplate | LoadMorePlaceholder\n>;\nexport const PluginNodeList: FC<PluginNodeListProps> = ({\n  pluginNodeList,\n  hasMore,\n  onLoadMore,\n  showExploreMore,\n  categoryName,\n}) => {\n  const { keyword, enableDrag, onSelect, onAddingNode } = useNodePanelContext();\n\n  // Calculate the list of nodes to be displayed, 5 on the first page, and 4 on each subsequent page (5, 5 + 4, 5 + 4 + 4, 5 + 4 + 4 + 4...)\n  const displayPluginNodeList = useMemo<PluginNodeListWithLoadMore>(() => {\n    const nodeList: PluginNodeListWithLoadMore = pluginNodeList;\n    if (!nodeList) {\n      return nodeList;\n    }\n    const len = nodeList.length;\n    if (!hasMore || len < INIT_PAGE_SIZE) {\n      return nodeList;\n    }\n    const rawPageNum = (len - INIT_PAGE_SIZE) / LOAD_MORE_PAGE_SIZE;\n    // If rawPageNum has a fractional part,\n    if (rawPageNum % 1 > 0) {\n      const displayLen =\n        Math.floor(rawPageNum) * LOAD_MORE_PAGE_SIZE + INIT_PAGE_SIZE;\n      return nodeList.slice(0, displayLen).concat(LOAD_MORE_PLACEHOLDER);\n    }\n    return nodeList.concat(LOAD_MORE_PLACEHOLDER);\n  }, [pluginNodeList, hasMore]);\n\n  const [expandPluginIndex, setExpandPluginIndex] = useState<number>();\n  // Tools list insert location\n  const pluginToolsDisplayIndex = useMemo<number | undefined>(() => {\n    if (!isNumber(expandPluginIndex)) {\n      return;\n    }\n    if (expandPluginIndex % 2 === 0) {\n      return Math.min(\n        expandPluginIndex + 1,\n        (displayPluginNodeList?.length ?? 0) - 1,\n      );\n    }\n    return expandPluginIndex;\n  }, [expandPluginIndex, displayPluginNodeList]);\n\n  const pluginTools = useMemo<PluginApiNodeTemplate[] | undefined>(\n    () =>\n      isNumber(expandPluginIndex) &&\n      ((displayPluginNodeList?.[expandPluginIndex] as PluginNodeTemplate)?.tools\n        ?.length ?? 0) > 1\n        ? (displayPluginNodeList?.[expandPluginIndex] as PluginNodeTemplate)\n            ?.tools\n        : undefined,\n    [expandPluginIndex, displayPluginNodeList],\n  );\n  const nodeVersionService = useNodeVersionService();\n  const handleSelectTool = async (\n    event: MouseEvent<HTMLElement>,\n    nodeTemplate: PluginApiNodeTemplate,\n  ) => {\n    try {\n      onAddingNode?.(true);\n      const { plugin_id: pluginId, version } = nodeTemplate;\n      if (!(await nodeVersionService.addApiCheck(pluginId, version))) {\n        return false;\n      }\n      onSelect?.({ event, nodeTemplate });\n    } finally {\n      onAddingNode?.(false);\n    }\n  };\n  if (!displayPluginNodeList?.length) {\n    return null;\n  }\n  return (\n    <div className={styles['plugin-node-list-container']}>\n      <div\n        className={classNames(\n          'flex flex-row pl-1 mb-1 items-center leading-5',\n          styles['plugin-node-list-header'],\n        )}\n      >\n        <Typography.Text\n          className=\"coz-fg-secondary leading-5\"\n          weight={500}\n          size=\"normal\"\n          data-testid={concatTestId(\n            'workflow.detail.node-panel.list.category.name',\n            'favorite-plugin',\n          )}\n        >\n          {categoryName}\n        </Typography.Text>\n        {showExploreMore ? (\n          <div\n            className={classNames(\n              'flex-row items-center cursor-pointer',\n              styles['explore-more'],\n            )}\n            onClick={e => {\n              const nodeTemp: UnionNodeTemplate = {\n                type: StandardNodeType.Api,\n              };\n              onSelect?.({\n                event: e,\n                nodeTemplate: nodeTemp,\n              });\n            }}\n          >\n            <div className=\"w-[1px] h-3 mx-2 coz-stroke-primary border-l-[1px] border-r-0 border-solid\" />\n            <Typography.Text\n              className=\"coz-fg-secondary leading-5\"\n              size=\"normal\"\n              weight={500}\n            >\n              {I18n.t('workflow_0224_04')}\n            </Typography.Text>\n            <IconCozArrowRight className=\"coz-fg-secondary text-[16px]\" />\n          </div>\n        ) : null}\n      </div>\n      <div\n        className={styles['plugin-node-list']}\n        data-testid=\"workflow.detail.node-panel.list.category.list\"\n      >\n        {displayPluginNodeList.map((nodeTemplate, index) => {\n          const card =\n            nodeTemplate === LOAD_MORE_PLACEHOLDER ? (\n              <LoadMoreCard onLoadMore={onLoadMore} />\n            ) : (\n              <PluginNode\n                key={nodeTemplate.plugin_id}\n                nodeTemplate={nodeTemplate}\n                enableDrag={enableDrag}\n                onSelect={({ event, nodeTemplate: pluginTool }) =>\n                  handleSelectTool(event, pluginTool)\n                }\n                expand={expandPluginIndex === index}\n                onExpandChange={expand => {\n                  expand\n                    ? setExpandPluginIndex(index)\n                    : setExpandPluginIndex(undefined);\n                }}\n                keyword={keyword}\n                index={index}\n              />\n            );\n          return (\n            <>\n              {card}\n              {pluginToolsDisplayIndex === index && pluginTools?.length ? (\n                <div className={styles['plugin-tool-list']}>\n                  {pluginTools.map((pluginTool, toolIndex) => (\n                    <CustomDragCard\n                      key={pluginTool?.api_id}\n                      tooltipPosition={toolIndex % 2 === 0 ? 'left' : 'right'}\n                      nodeType={pluginTool?.type as StandardNodeType}\n                      nodeDesc={pluginTool.desc}\n                      nodeJson={pluginTool.nodeJSON}\n                      nodeTemplate={pluginTool}\n                      disabled={!enableDrag}\n                    >\n                      <PluginToolCard\n                        name={pluginTool.name ?? ''}\n                        keyword={keyword}\n                        onClick={event => handleSelectTool(event, pluginTool)}\n                      />\n                    </CustomDragCard>\n                  ))}\n                </div>\n              ) : null}\n            </>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { type NodeSearchCategoryData, type PluginNodeTemplate } from '@/typing';\n\nimport { useNodePanelContext } from '../../hooks/node-panel-context';\nimport { PluginNodeList } from './plugin-node-list';\nexport interface PluginCategoryListProps {\n  data: Array<NodeSearchCategoryData<PluginNodeTemplate>>;\n}\nexport const PluginCategoryList: FC<PluginCategoryListProps> = ({ data }) => {\n  const { onLoadMore } = useNodePanelContext();\n\n  return (\n    <>\n      {data.map(({ id, categoryName, nodeList, hasMore, cursor }) => (\n        <PluginNodeList\n          key={id}\n          categoryName={categoryName ?? ''}\n          pluginNodeList={nodeList}\n          hasMore={hasMore}\n          onLoadMore={async () => {\n            await onLoadMore?.(id, cursor ?? '');\n          }}\n        />\n      ))}\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { get } from 'lodash-es';\nimport { type StandardNodeType } from '@coze-workflow/base';\n\nimport { isPluginCategoryNodeTemplate } from '@/utils';\nimport { type NodeCategory } from '@/typing';\n\nimport { NodeCategoryPanel } from '../node-category-panel';\nimport { CustomDragCard } from '../custom-drag-card';\nimport { NodeCard } from '../card';\nimport { useNodePanelContext } from '../../hooks/node-panel-context';\n\nexport interface AtomCategoryListProps {\n  data: NodeCategory[];\n}\n\nexport const AtomCategoryList: FC<AtomCategoryListProps> = ({ data }) => {\n  const { keyword, enableDrag, onSelect } = useNodePanelContext();\n\n  return (\n    <>\n      {data.map(({ categoryName, nodeList }) => (\n        <NodeCategoryPanel key={categoryName} categoryName={categoryName}>\n          {nodeList.map((nodeTemplate, index) => (\n            <CustomDragCard\n              key={`${nodeTemplate?.type}_${nodeTemplate.name}`}\n              tooltipPosition={index % 2 === 0 ? 'left' : 'right'}\n              nodeType={nodeTemplate?.type as StandardNodeType}\n              nodeDesc={get(nodeTemplate, 'desc')}\n              nodeJson={get(nodeTemplate, 'nodeJSON')}\n              nodeTemplate={nodeTemplate}\n              disabled={!enableDrag}\n            >\n              <NodeCard\n                name={nodeTemplate.name ?? ''}\n                icon={nodeTemplate.icon_url ?? ''}\n                hideOutline={isPluginCategoryNodeTemplate(nodeTemplate)}\n                keyword={keyword}\n                onClick={event => onSelect?.({ event, nodeTemplate })}\n              />\n            </CustomDragCard>\n          ))}\n        </NodeCategoryPanel>\n      ))}\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, useRef, useLayoutEffect, useState, useMemo } from 'react';\n\nimport { throttle } from 'lodash-es';\nimport classNames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { Loading, Typography } from '@coze-arch/coze-design';\n\nimport {\n  NodeSearchSectionType,\n  type NodeSearchResult,\n  type NodeSearchResultSection,\n} from '@/typing';\n\nimport { SubWorkflowCategoryList } from '../sub-workflow-category-list';\nimport { PluginCategoryList } from '../plugin-node/plugin-category-list';\nimport { AtomCategoryList } from '../atom-category-list';\nimport { useNodePanelContext } from '../../hooks/node-panel-context';\n\nimport styles from './index.module.less';\n\nconst SearchResultSection: FC<{\n  sectionData: NodeSearchResultSection;\n}> = ({ sectionData }) => {\n  const renderSection = ({ dataType, data }: NodeSearchResultSection) => {\n    if (dataType === NodeSearchSectionType.Atom) {\n      return <AtomCategoryList data={data} />;\n    } else if (dataType === NodeSearchSectionType.Plugin) {\n      return <PluginCategoryList data={data} />;\n    } else if (dataType === NodeSearchSectionType.SubWorkflow) {\n      return <SubWorkflowCategoryList data={data} />;\n    }\n  };\n\n  const { getScrollContainer } = useNodePanelContext();\n  const stickyHeaderRef = useRef<HTMLDivElement>(null);\n  const [isSticky, setSticky] = useState(false);\n  useLayoutEffect(() => {\n    const scrollEl = getScrollContainer?.();\n    if (!stickyHeaderRef.current || !scrollEl) {\n      return;\n    }\n    const scrollElTop = scrollEl.getBoundingClientRect().top;\n    const updateSticky = () => {\n      const el = stickyHeaderRef.current;\n      if (!el) {\n        return;\n      }\n\n      const headerTop = el.getBoundingClientRect().top;\n      setSticky(\n        Math.round(scrollElTop - headerTop) === 0 && scrollEl.scrollTop !== 0,\n      );\n    };\n    const handleScroll = throttle(() => updateSticky(), 200);\n\n    scrollEl.addEventListener('scroll', handleScroll);\n    return () => scrollEl.removeEventListener('scroll', handleScroll);\n  }, []);\n\n  return (\n    <div className={styles['search-result-section']}>\n      <div\n        className={classNames(styles['search-result-section-title'], {\n          [styles.sticky]: isSticky,\n        })}\n        ref={stickyHeaderRef}\n      >\n        {sectionData.name}\n      </div>\n      <div className={styles['search-result-section-content']}>\n        {renderSection(sectionData)}\n      </div>\n    </div>\n  );\n};\n\nexport const SearchResultNodeList: FC<{\n  searchResult: NodeSearchResult;\n  loading: boolean;\n}> = ({ searchResult, loading }) => {\n  // (Only front-end search node & & loading) = > out of small circle\n  const showSpinLoading = useMemo(\n    () =>\n      loading &&\n      searchResult.length === 1 &&\n      searchResult[0].dataType === NodeSearchSectionType.Atom,\n    [searchResult, loading],\n  );\n  // (No nodes | | Both nodes of front-end search and back-end search have & & loading) = > out of a large circle\n  const showMaskLoading = useMemo(\n    () =>\n      loading &&\n      (searchResult.length === 0 ||\n        searchResult.some(\n          item => item.dataType !== NodeSearchSectionType.Atom,\n        )),\n    [searchResult, loading],\n  );\n  return (\n    <div\n      className=\"flex flex-col pb-4\"\n      data-testid=\"workflow.detail.node-panel.list\"\n    >\n      {searchResult.map(sectionData => {\n        const key = `${sectionData.dataType}_${sectionData.name}`;\n        return <SearchResultSection key={key} sectionData={sectionData} />;\n      })}\n      {showSpinLoading ? (\n        <div className=\"w-full flex items-center justify-center gap-[4px]\">\n          <Loading className=\"coz-fg-secondary\" loading={true} size=\"mini\" />\n          <Typography.Text\n            className=\"coz-fg-secondary relative top-[-2px]\"\n            weight={500}\n          >\n            {I18n.t('loading')}\n          </Typography.Text>\n        </div>\n      ) : null}\n      {showMaskLoading ? (\n        <div className={styles['mask-loading']}>\n          <Loading\n            className=\"coz-fg-secondary\"\n            label={\n              <Typography.Text\n                className=\"coz-fg-secondary relative top-[-4px]\"\n                weight={500}\n              >\n                {I18n.t('loading')}\n              </Typography.Text>\n            }\n            loading={true}\n            size=\"large\"\n          >\n            <div></div>\n          </Loading>\n        </div>\n      ) : null}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, forwardRef, useImperativeHandle } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport { useFavoritePluginNodeList } from '../../hooks';\nimport { PluginNodeList } from './plugin-node-list';\nexport interface FavoritePluginNodeListRefType {\n  refetch: () => Promise<void>;\n}\nexport const FavoritePluginNodeList = forwardRef<FavoritePluginNodeListRefType>(\n  (props, ref) => {\n    const { pluginNodeList, hasMore, loadMore, refetch } =\n      useFavoritePluginNodeList();\n\n    useImperativeHandle(ref, () => ({\n      refetch,\n    }));\n    useEffect(() => {\n      refetch();\n    }, []);\n\n    if (!pluginNodeList?.length) {\n      return null;\n    }\n    return (\n      <PluginNodeList\n        categoryName={I18n.t('workflow_0224_03')}\n        pluginNodeList={pluginNodeList}\n        hasMore={hasMore}\n        onLoadMore={loadMore}\n        showExploreMore\n      />\n    );\n  },\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  forwardRef,\n  type MouseEvent,\n  type RefObject,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from 'react';\n\nimport { throttle } from 'lodash-es';\nimport classNames from 'classnames';\nimport {\n  Root,\n  ScrollAreaCorner,\n  ScrollAreaScrollbar,\n  ScrollAreaThumb,\n  ScrollAreaViewport,\n} from '@radix-ui/react-scroll-area';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozEmpty, IconCozMagnifier } from '@coze-arch/coze-design/icons';\nimport { EmptyState, Input } from '@coze-arch/coze-design';\nimport { type WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport { type UnionNodeTemplate } from '@/typing';\n\nimport { NodePanelContextProvider } from '../hooks/node-panel-context';\nimport { useSearchNode, useTemplateNodeList } from '../hooks';\nimport { PANEL_WIDTH, THROTTLE_INTERVAL } from '../constant';\nimport { SearchResultNodeList } from './search-result-node-list';\nimport {\n  FavoritePluginNodeList,\n  type FavoritePluginNodeListRefType,\n} from './plugin-node/favorite-plugin-node-list';\nimport { AtomCategoryList } from './atom-category-list';\n\nimport styles from './styles.module.less';\nexport type NodeListRefType = FavoritePluginNodeListRefType;\ninterface NodesContainerProps {\n  onSelect: (props: {\n    event: MouseEvent<HTMLElement>;\n    nodeTemplate: UnionNodeTemplate;\n  }) => void;\n  enableDrag?: boolean;\n  containerNode?: WorkflowNodeEntity;\n  adaptiveHeight?: number;\n  /**\n   * Update the status of the node being added. At this time, clickOutside will not close the node panel to avoid triggering onClose to close before the addition of the node is completed, and the previous connection cannot be destroyed.\n   * @param isAdding\n   * @returns\n   */\n  onAddingNode?: (isAdding: boolean) => void;\n}\nexport const NodeList = forwardRef<NodeListRefType, NodesContainerProps>(\n  (props, ref) => {\n    const {\n      onSelect,\n      enableDrag = false,\n      containerNode,\n      adaptiveHeight,\n      onAddingNode,\n    } = props;\n    const nodeCategoryList = useTemplateNodeList(containerNode);\n    const nodeListRef = useRef<HTMLDivElement>();\n    const [showBorder, setShowBorder] = useState(false);\n    const [input, setInput] = useState('');\n\n    const {\n      showSearchResult,\n      searchResult,\n      isSearching,\n      noSearchResult,\n      loadMore,\n      keyword,\n      handleKeywordChange,\n    } = useSearchNode({\n      atomNodeCategoryList: nodeCategoryList,\n    });\n\n    useEffect(() => {\n      if (!nodeListRef.current || showSearchResult) {\n        setShowBorder(false);\n        return;\n      }\n      const el = nodeListRef.current;\n      const handleScroll = throttle(() => {\n        if ((el.scrollTop ?? 0) > 0) {\n          setShowBorder(true);\n        } else {\n          setShowBorder(false);\n        }\n      }, THROTTLE_INTERVAL);\n      setShowBorder((nodeListRef.current?.scrollTop ?? 0) > 0);\n      el.addEventListener('scroll', handleScroll);\n      return () => el.removeEventListener('scroll', handleScroll);\n    }, [showSearchResult]);\n    const favoritePluginsRef = useRef<FavoritePluginNodeListRefType>();\n\n    useImperativeHandle(ref, () => ({\n      refetch: async () => {\n        await favoritePluginsRef.current?.refetch();\n      },\n    }));\n\n    useEffect(() => {\n      const text = input.replaceAll(' ', ''); // Remove spaces\n      handleKeywordChange(text);\n    }, [input]);\n\n    return (\n      <div\n        className={styles['node-panel']}\n        style={{ height: adaptiveHeight, width: PANEL_WIDTH }}\n        data-flow-editor-selectable=\"false\"\n        data-testid=\"workflow.detail.node-panel\"\n      >\n        <svg style={{ width: 0, height: 0, display: 'block' }}>\n          <clipPath\n            id=\"favorite-plugin-clip-path\"\n            clipPathUnits=\"objectBoundingBox\"\n          >\n            <path d=\"M0,1 H1 V0 C1,0.552,0.552,1,0,1\"></path>\n          </clipPath>\n        </svg>\n        <div\n          className={classNames(\n            styles['node-search'],\n            showBorder ? styles['node-search-shadow'] : '',\n          )}\n          data-testid=\"workflow.detail.node-panel.search\"\n        >\n          <Input\n            className={styles['node-search-input']}\n            showClear\n            placeholder={I18n.t('workflow_250306_01')}\n            value={input}\n            onClear={() => setInput('')}\n            onChange={setInput}\n            prefix={<IconCozMagnifier style={{ fontSize: '16px' }} />}\n          />\n        </div>\n        {noSearchResult ? (\n          <EmptyState\n            className=\"mx-auto mt-[128px] max-w-[270px]\"\n            icon={<IconCozEmpty />}\n            size=\"large\"\n            title={I18n.t('workflow_250305_001')}\n            description={I18n.t('workflow_250305_002')}\n          />\n        ) : null}\n        <Root className={classNames('node-panel-render', styles['node-list'])}>\n          <ScrollAreaViewport\n            ref={nodeListRef as RefObject<HTMLDivElement>}\n            className={styles.viewport}\n          >\n            <NodePanelContextProvider\n              value={{\n                onSelect,\n                enableDrag,\n                keyword,\n                getScrollContainer: () => nodeListRef.current,\n                onLoadMore: loadMore,\n                onAddingNode,\n              }}\n            >\n              {showSearchResult ? (\n                <SearchResultNodeList\n                  searchResult={searchResult}\n                  loading={isSearching}\n                />\n              ) : (\n                <div\n                  className={styles['list-wrapper']}\n                  data-testid=\"workflow.detail.node-panel.list\"\n                >\n                  <AtomCategoryList data={[nodeCategoryList[0]]} />\n                  <FavoritePluginNodeList\n                    ref={\n                      favoritePluginsRef as RefObject<FavoritePluginNodeListRefType>\n                    }\n                  />\n                  <AtomCategoryList data={nodeCategoryList.slice(1)} />\n                </div>\n              )}\n            </NodePanelContextProvider>\n          </ScrollAreaViewport>\n          <ScrollAreaScrollbar\n            className={styles.scrollbar}\n            orientation=\"vertical\"\n          >\n            <ScrollAreaThumb className={styles['scrollbar-thumb']} />\n            <ScrollAreaCorner className={styles['scrollbar-corner']} />\n          </ScrollAreaScrollbar>\n        </Root>\n      </div>\n    );\n  },\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type FC,\n  useRef,\n  useMemo,\n  useEffect,\n  type MouseEvent,\n  type RefObject,\n} from 'react';\n\nimport { get, set } from 'lodash-es';\nimport type { NodePanelRenderProps } from '@flowgram-adapter/free-layout-editor';\nimport {\n  usePlayground,\n  useService,\n} from '@flowgram-adapter/free-layout-editor';\nimport { type WorkflowNodeJSON } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowNodesService } from '@coze-workflow/nodes';\nimport { StandardNodeType } from '@coze-workflow/base';\nimport { reporter } from '@coze-arch/logger';\nimport { handlePluginRiskWarning } from '@coze-agent-ide/plugin-risk-warning';\nimport { Popover } from '@coze-arch/coze-design';\n\nimport { WorkflowPlaygroundContext } from '@/workflow-playground-context';\nimport {\n  isPluginApiNodeTemplate,\n  isPluginCategoryNodeTemplate,\n  isSubWorkflowNodeTemplate,\n} from '@/utils';\nimport {\n  type AddNodePanelProps,\n  type UnionNodeTemplate,\n  type PluginCategoryNodeTemplate,\n} from '@/typing';\nimport { getNodeV2Registry } from '@/nodes-v2';\nimport { useTemplateService } from '@/hooks/use-template-service';\nimport {\n  type AddNodeCallback,\n  AddNodeModalCloseResult,\n} from '@/hooks/use-add-node-modal';\nimport { useDependencyEntity } from '@/hooks';\nimport { useAddNodeModalContext } from '@/contexts/add-node-modal-context';\n\nimport { NodePlaceholder } from './node-placeholder';\nimport { NodeList, type NodeListRefType } from './list';\n\nexport const NodePanel: FC<NodePanelRenderProps> = props => {\n  const { onSelect, position, onClose, containerNode } = props;\n  const context = useService<WorkflowPlaygroundContext>(\n    WorkflowPlaygroundContext,\n  );\n\n  const onSelectAsync = async ({\n    nodeType,\n    selectEvent,\n    nodeJSON,\n  }: {\n    nodeType: StandardNodeType;\n    nodeJSON?: WorkflowNodeJSON;\n    selectEvent: React.MouseEvent;\n  }) => {\n    const nodeV2Registry = getNodeV2Registry(nodeType);\n\n    try {\n      await nodeV2Registry?.onInit?.(nodeJSON as WorkflowNodeJSON, context);\n    } catch (error) {\n      reporter.errorEvent({\n        eventName: 'workflow_registry_v2_on_init_error',\n        namespace: 'workflow',\n        error,\n      });\n    }\n\n    onSelect({\n      nodeType,\n      selectEvent,\n      nodeJSON,\n    });\n  };\n\n  const panelProps = props.panelProps as AddNodePanelProps;\n  const playground = usePlayground();\n  // Node is being added, when true, closing the node panel is not allowed\n  const isAddingNodeRef = useRef(false);\n  const { openPlugin, openWorkflow, openImageflow, updateAddNodePosition } =\n    useAddNodeModalContext();\n\n  const templateState = useTemplateService();\n  const dependencyEntity = useDependencyEntity();\n\n  const adaptiveHeight = useMemo(() => {\n    const docHeight = document.body.clientHeight;\n    let targetHeight: number;\n    const MAXMIUM_HEIGHT = 580;\n    const ADD_NODE_BTN_TOP = 32 + 24 + 8;\n    if (panelProps.fromAddNodeBtn) {\n      targetHeight = Math.min(MAXMIUM_HEIGHT, docHeight - ADD_NODE_BTN_TOP);\n    } else {\n      const positionRelToWindow = playground.config.toFixedPos(position);\n      const topHeight = positionRelToWindow.y;\n      const bottomHeight = document.body.clientHeight - topHeight;\n      targetHeight = Math.min(\n        MAXMIUM_HEIGHT,\n        Math.max(topHeight, bottomHeight),\n      );\n    }\n    // When the maximum height is met, the height is not specified, and it is automatically stretched by the element\n    if (targetHeight === MAXMIUM_HEIGHT) {\n      return MAXMIUM_HEIGHT;\n    }\n    return targetHeight;\n  }, [position, playground, panelProps.fromAddNodeBtn]);\n\n  const nodeListRef = useRef<NodeListRefType>();\n  const nodesService = useService<WorkflowNodesService>(WorkflowNodesService);\n\n  const handleSelectNode = async ({\n    event,\n    nodeTemplate,\n  }: {\n    event: MouseEvent<HTMLElement>;\n    nodeTemplate: UnionNodeTemplate;\n  }) => {\n    const { type: nodeType } = nodeTemplate;\n    if (\n      isPluginApiNodeTemplate(nodeTemplate) ||\n      isSubWorkflowNodeTemplate(nodeTemplate)\n    ) {\n      if (nodeType === StandardNodeType.Api) {\n        handlePluginRiskWarning();\n      }\n      const { nodeJSON } = nodeTemplate;\n      const nodeTitle = get(nodeJSON, 'data.nodeMeta.title');\n      if (nodeTitle) {\n        set(\n          nodeJSON,\n          'data.nodeMeta.title',\n          nodesService.createUniqTitle(nodeTitle),\n        );\n      }\n      await onSelectAsync({\n        nodeType,\n        selectEvent: event,\n        nodeJSON: nodeJSON as WorkflowNodeJSON,\n      });\n      return;\n    }\n\n    if (\n      nodeType &&\n      [\n        StandardNodeType.Api,\n        StandardNodeType.SubWorkflow,\n        StandardNodeType.Imageflow,\n      ].includes(nodeType as StandardNodeType)\n    ) {\n      updateAddNodePosition?.({ ...position, isDrag: false });\n      const onAdd: AddNodeCallback = async ({ nodeJSON }) => {\n        await onSelectAsync({\n          nodeType,\n          selectEvent: event,\n          nodeJSON: nodeJSON as WorkflowNodeJSON,\n        });\n        isAddingNodeRef.current = false;\n      };\n      const onCloseModal = closeResult => {\n        isAddingNodeRef.current = false;\n        if (closeResult === AddNodeModalCloseResult.OpenNewTab) {\n          handleClose();\n        } else if (nodeType === StandardNodeType.Api) {\n          nodeListRef.current?.refetch();\n        }\n      };\n\n      isAddingNodeRef.current = true;\n      if (nodeType === StandardNodeType.Api) {\n        handlePluginRiskWarning();\n        let categoryInfo:\n          | PluginCategoryNodeTemplate['categoryInfo']\n          | undefined;\n        if (isPluginCategoryNodeTemplate(nodeTemplate)) {\n          categoryInfo = nodeTemplate.categoryInfo;\n        }\n        openPlugin?.({\n          onAdd,\n          onClose: onCloseModal,\n          closeOnAdd: !panelProps?.enableModalMultiAdd,\n          modalProps: {\n            initQuery: {\n              type: categoryInfo?.categoryId,\n              isOfficial: categoryInfo?.onlyOfficial ? true : undefined,\n            },\n          },\n        });\n      } else {\n        ({\n          [StandardNodeType.Imageflow]: openImageflow,\n          [StandardNodeType.SubWorkflow]: openWorkflow,\n        })[nodeType]?.({\n          onAdd,\n          onClose: onCloseModal,\n          closeOnAdd: !panelProps?.enableModalMultiAdd,\n        });\n      }\n    } else {\n      await onSelectAsync({ nodeType, selectEvent: event });\n    }\n  };\n\n  const handleClose = () => {\n    if (isAddingNodeRef.current) {\n      return;\n    }\n    onClose();\n  };\n\n  useEffect(() => {\n    if (!panelProps.enableScrollClose) {\n      // Do not listen for scroll events when scrolling off is not enabled\n      return;\n    }\n    const disposer = playground.onScroll(() => {\n      handleClose();\n    });\n    return () => disposer.dispose();\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- custom\n  }, [panelProps, playground]);\n\n  useEffect(() => {\n    const disposable = templateState.onPreviewUpdated(({ previewVisible }) => {\n      if (previewVisible) {\n        handleClose();\n      }\n    });\n\n    return () => {\n      disposable?.dispose?.();\n    };\n  }, [templateState]);\n\n  useEffect(() => {\n    //Close the new button popover when refreshing the pop-up window display\n    if (dependencyEntity?.refreshModalVisible) {\n      handleClose();\n    }\n  }, [dependencyEntity?.refreshModalVisible]);\n\n  return (\n    <Popover\n      visible={true}\n      showArrow={false}\n      trigger=\"custom\"\n      position=\"bottomLeft\"\n      motion={false}\n      onClickOutSide={e => {\n        const isClickAnchor = panelProps.anchorElement\n          ? Boolean(\n              (e.target as HTMLDivElement).closest(panelProps.anchorElement),\n            )\n          : false;\n        if (!isClickAnchor) {\n          handleClose();\n        }\n      }}\n      onEscKeyDown={handleClose}\n      style={{\n        borderRadius: 'var(--coze-12)',\n        boxShadow:\n          '0 2px 6px 0 rgba(var(--coze-shadow-0),.04),0 4px 12px 0 rgba(var(--coze-shadow-0),.02)',\n        border: '1px solid var(--coz-stroke-primary)',\n        padding: 0,\n        background: 'var(--coz-bg-plus)',\n      }}\n      zIndex={999}\n      content={\n        <NodeList\n          ref={nodeListRef as RefObject<NodeListRefType>}\n          adaptiveHeight={adaptiveHeight}\n          enableDrag={panelProps?.enableDrag}\n          onSelect={handleSelectNode}\n          containerNode={containerNode}\n          onAddingNode={isAdding => (isAddingNodeRef.current = isAdding)}\n        />\n      }\n    >\n      <div\n        style={{\n          position: 'absolute',\n          top: position.y,\n          left: position.x,\n          transform: panelProps.enableNodePlaceholder\n            ? 'translateY(-50%)'\n            : undefined,\n          zIndex: 999,\n        }}\n      >\n        {panelProps.enableNodePlaceholder ? <NodePlaceholder /> : null}\n      </div>\n    </Popover>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type PropsWithChildren, type FC, type ReactNode } from 'react';\n\nimport classnames from 'classnames';\nimport { Tag, Tooltip } from '@coze-arch/coze-design';\n\nimport styles from './condition-tag.module.less';\n\nexport const ConditionTag: FC<\n  PropsWithChildren<{\n    tooltip?: ReactNode;\n    invalid?: boolean;\n  }>\n> = props => {\n  const color = props.invalid ? 'yellow' : 'primary';\n  if (props.tooltip && !props.invalid) {\n    return (\n      <Tooltip content={props.tooltip}>\n        <Tag\n          color={color}\n          className={classnames(\n            styles['condition-tag'],\n            'font-medium truncate w-full',\n          )}\n        >\n          {props.children}\n        </Tag>\n      </Tooltip>\n    );\n  } else {\n    return (\n      <Tag\n        color={color}\n        className={classnames(\n          styles['condition-tag'],\n          'font-medium truncate w-full',\n        )}\n      >\n        {props.children}\n      </Tag>\n    );\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { ConditionLogic } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\nexport const LogicDisplay: FC<{\n  logic: ConditionLogic;\n}> = ({ logic }) => (\n  <div className=\"relative text-center py-1\">\n    <div className=\"absolute top-[50%] -mt-[1px] coz-stroke-primary w-full border-0 border-b border-solid\" />\n    <span className=\"min-w-[28px] relative inline-block coz-bg-max\">\n      {logic === ConditionLogic.AND\n        ? I18n.t('workflow_detail_condition_and')\n        : I18n.t('workflow_detail_condition_or')}\n    </span>\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\nimport { getGlobalVariableAlias } from '@coze-workflow/variable';\nimport { type NodeData, WorkflowNodeData } from '@coze-workflow/nodes';\n\nimport { useAvailableNodeVariables } from '../../hooks/use-available-node-variables';\nimport { useValidVariable } from '../../fields/use-valid-variable';\nimport { ConditionTag } from './condition-tag';\n\nexport const VariableDisplay: FC<{\n  keyPath?: string[];\n}> = ({ keyPath }) => {\n  const { variable: workflowVariable, valid } = useValidVariable(keyPath ?? []);\n  const node = useCurrentEntity();\n  useAvailableNodeVariables(node);\n\n  if (!keyPath || !keyPath.length) {\n    return null;\n  }\n  const nodeDataEntity =\n    workflowVariable?.node?.getData<WorkflowNodeData>(WorkflowNodeData);\n  const nodeData = nodeDataEntity?.getNodeData<keyof NodeData>();\n\n  const globalVariableAlias = workflowVariable?.globalVariableKey\n    ? getGlobalVariableAlias(workflowVariable?.globalVariableKey)\n    : undefined;\n\n  const variableText = nodeData?.title || globalVariableAlias;\n\n  return (\n    <ConditionTag\n      invalid={!valid}\n      tooltip={\n        <span>\n          <span>\n            {variableText}\n            <span className=\"mx-2\">-</span>\n          </span>\n          {workflowVariable?.viewMeta?.name}\n        </span>\n      }\n    >\n      <span>\n        {variableText}\n        <span className=\"mx-2\">-</span>\n      </span>\n      {workflowVariable?.viewMeta?.name}\n    </ConditionTag>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  useCurrentEntity,\n  useService,\n} from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowVariableFacadeService } from '@coze-workflow/variable';\n\n/**\n * Get the variable and verify the scope of the variable\n * @param keyPath\n * @returns\n */\nexport function useValidVariable(keyPath?: string[]) {\n  const node = useCurrentEntity();\n  const facadeService: WorkflowVariableFacadeService = useService(\n    WorkflowVariableFacadeService,\n  );\n\n  const valid = !!facadeService.getVariableFacadeByKeyPath(keyPath, {\n    node,\n    checkScope: true,\n  });\n  const variable = facadeService.getVariableFacadeByKeyPath(keyPath, { node });\n\n  return {\n    valid,\n    variable,\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { ConditionLogic } from '@coze-workflow/base';\n\nimport { LogicDisplay } from './logic-display';\n\ninterface Condition {\n  left?: React.ReactNode;\n  operator?: React.ReactNode;\n  right?: React.ReactNode;\n}\n\ninterface ConditionContainerProps {\n  conditions: Condition[];\n  logic?: ConditionLogic;\n}\n\nexport const ConditionContainer: FC<ConditionContainerProps> = props => {\n  const { conditions = [], logic = ConditionLogic.AND } = props;\n\n  return (\n    <div className=\"coz-stroke-plus coz-bg-max border border-solid py-1 rounded-mini text-xs coz-fg-primary min-h-[32px]\">\n      {conditions.map((condition, index) => (\n        <>\n          <div className=\"flex items-center px-1\">\n            <div className=\"flex-1 min-w-0 overflow-hidden\">\n              {condition.left}\n            </div>\n            <div className=\"flex items-center flex-grow-0 flex-shrink-0 basis-[0] px-2 \">\n              {condition.operator}\n            </div>\n\n            <div className=\"flex-1 min-w-0 overflow-hidden\">\n              {condition.right}\n            </div>\n          </div>\n          {index < conditions.length - 1 ? (\n            <LogicDisplay logic={logic} />\n          ) : null}\n        </>\n      ))}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport {\n  ConditionType,\n  ValueExpressionType,\n  type ValueExpression,\n} from '@coze-workflow/base';\n\nimport { VariableDisplay } from './variable-display';\nimport { ConditionTag } from './condition-tag';\n\nconst specialValueMap = {\n  [ConditionType.Null]: 'Empty',\n  [ConditionType.NotNull]: 'Empty',\n  [ConditionType.True]: 'true',\n  [ConditionType.False]: 'false',\n};\n\nexport const ExpressionDisplay: FC<{\n  value?: ValueExpression;\n  operator?: ConditionType;\n}> = ({ value, operator }) => {\n  if (\n    [\n      ConditionType.Null,\n      ConditionType.NotNull,\n      ConditionType.True,\n      ConditionType.False,\n    ].includes(operator as ConditionType)\n  ) {\n    return (\n      <ConditionTag>{specialValueMap[operator as ConditionType]}</ConditionTag>\n    );\n  }\n  if (!value || value?.type === ValueExpressionType.OBJECT_REF) {\n    return null;\n  }\n  if (value?.type === ValueExpressionType.LITERAL) {\n    if (Array.isArray(value.content)) {\n      return (\n        <ConditionTag tooltip={value.content.join(', ')}>\n          {value.content.join(', ')}\n        </ConditionTag>\n      );\n    } else {\n      return (\n        <ConditionTag tooltip={String(value.content)}>\n          {String(value.content)}\n        </ConditionTag>\n      );\n    }\n  } else {\n    return <VariableDisplay keyPath={value?.content?.keyPath} />;\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport { InputParameters, MessageOutput } from '../../fields';\n\nexport function MessageContent() {\n  return (\n    <>\n      <InputParameters label={I18n.t('workflow_detail_node_output')} />\n      <MessageOutput />\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReactElement } from 'react';\n\nimport { ViewVariableType } from '@coze-workflow/base';\nimport {\n  IconCozNumber,\n  IconCozString,\n  IconCozBoolean,\n  IconCozFolder,\n  IconCozBrace,\n  IconCozImage,\n  IconCozStringBracket,\n  IconCozImageBracket,\n  IconCozBooleanBracket,\n  IconCozNumberBracket,\n  IconCozNumberInt,\n  IconCozNumberIntBracket,\n  IconCozBraceBracket,\n  IconCozFolderBracket,\n  IconCozSound,\n  IconCozClock,\n  IconCozClockBracket,\n} from '@coze-arch/coze-design/icons';\n\nconst iconFile = <IconCozFolder />;\nconst iconFileArray = <IconCozFolderBracket />;\nexport const VARIABLE_TYPE_ICON_MAP: Record<ViewVariableType, ReactElement> = {\n  [ViewVariableType.String]: <IconCozString />,\n  [ViewVariableType.Integer]: <IconCozNumberInt />,\n  [ViewVariableType.Number]: <IconCozNumber />,\n  [ViewVariableType.Boolean]: <IconCozBoolean />,\n  [ViewVariableType.Object]: <IconCozBrace />,\n  [ViewVariableType.Image]: <IconCozImage />,\n  [ViewVariableType.Time]: <IconCozClock />,\n  [ViewVariableType.File]: iconFile,\n  [ViewVariableType.Doc]: iconFile,\n  [ViewVariableType.Code]: iconFile,\n  [ViewVariableType.Ppt]: iconFile,\n  [ViewVariableType.Txt]: iconFile,\n  [ViewVariableType.Excel]: iconFile,\n  [ViewVariableType.Audio]: iconFile,\n  [ViewVariableType.Zip]: iconFile,\n  [ViewVariableType.Video]: iconFile,\n  [ViewVariableType.Svg]: iconFile,\n  [ViewVariableType.Voice]: <IconCozSound />,\n  [ViewVariableType.ArrayString]: <IconCozStringBracket />,\n  [ViewVariableType.ArrayInteger]: <IconCozNumberIntBracket />,\n  [ViewVariableType.ArrayNumber]: <IconCozNumberBracket />,\n  [ViewVariableType.ArrayBoolean]: <IconCozBooleanBracket />,\n  [ViewVariableType.ArrayObject]: <IconCozBraceBracket />,\n  [ViewVariableType.ArrayImage]: <IconCozImageBracket />,\n  [ViewVariableType.ArrayFile]: iconFileArray,\n  [ViewVariableType.ArrayDoc]: iconFileArray,\n  [ViewVariableType.ArrayCode]: iconFileArray,\n  [ViewVariableType.ArrayPpt]: iconFileArray,\n  [ViewVariableType.ArrayTxt]: iconFileArray,\n  [ViewVariableType.ArrayExcel]: iconFileArray,\n  [ViewVariableType.ArrayAudio]: iconFileArray,\n  [ViewVariableType.ArrayZip]: iconFileArray,\n  [ViewVariableType.ArrayVideo]: iconFileArray,\n  [ViewVariableType.ArraySvg]: iconFileArray,\n  [ViewVariableType.ArrayVoice]: iconFileArray,\n  [ViewVariableType.ArrayTime]: <IconCozClockBracket />,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type ConditionOperator,\n  type DatabaseConditionRight,\n} from '@coze-workflow/base';\n\nimport { ConditionTag, ExpressionDisplay } from '../../components/condition';\n\nexport function DatabaseConditionRightComponent({\n  value,\n  operator,\n}: {\n  value?: DatabaseConditionRight;\n  operator?: ConditionOperator;\n}) {\n  const rightTextMap = {\n    IS_NULL: 'Empty',\n    IS_NOT_NULL: 'Empty',\n    BE_TRUE: 'true',\n    BE_FALSE: 'false',\n  };\n\n  if (operator && rightTextMap[operator]) {\n    return <ConditionTag>{rightTextMap[operator]}</ConditionTag>;\n  }\n\n  if (!value) {\n    return null;\n  }\n\n  return <ExpressionDisplay value={value} />;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type DatabaseConditionOperator } from '@coze-workflow/base';\n\nimport { ConditionOperatorMap } from '@/constants/condition-operator-map';\n\nexport function DatabaseConditionOperatorComponent({\n  value,\n}: {\n  value?: DatabaseConditionOperator;\n}) {\n  return value ? ConditionOperatorMap[value].operationIcon : null;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type DatabaseConditionLeft } from '@coze-workflow/base';\n\nimport { ConditionTag } from '../../components/condition';\n\nexport function DatabaseConditionLeftComponent({\n  value,\n}: {\n  value?: DatabaseConditionLeft;\n}) {\n  if (!value) {\n    return null;\n  }\n\n  return <ConditionTag>{value}</ConditionTag>;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ConditionContainer } from '../../components/condition';\nimport { Field } from '..';\nimport { useConditions } from './use-conditions';\nimport { DatabaseConditionRightComponent } from './database-condition-right';\nimport { DatabaseConditionOperatorComponent } from './database-condition-operator';\nimport { DatabaseConditionLeftComponent } from './database-condition-left';\n\ninterface DatabaseConditionProps {\n  label: string;\n  name: string;\n}\n\nexport function DatabaseCondition({ label, name }: DatabaseConditionProps) {\n  const { conditionList = [], logic } = useConditions(name);\n\n  return (\n    <Field label={label} isEmpty={conditionList.length === 0}>\n      <ConditionContainer\n        conditions={conditionList.map(condition => ({\n          left: <DatabaseConditionLeftComponent value={condition.left} />,\n          operator: (\n            <DatabaseConditionOperatorComponent value={condition.operator} />\n          ),\n          right: (\n            <DatabaseConditionRightComponent\n              value={condition.right}\n              operator={condition.operator}\n            />\n          ),\n        }))}\n        logic={logic}\n      />\n    </Field>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { get } from 'lodash-es';\nimport {\n  useWorkflowNode,\n  type DatabaseCondition,\n  type ConditionLogic,\n} from '@coze-workflow/base';\n\nexport function useConditions(conditionFieldName: string) {\n  const { data } = useWorkflowNode();\n  const value: { conditionList?: DatabaseCondition[]; logic?: ConditionLogic } =\n    get(data, conditionFieldName, []);\n  return value;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { isString } from 'lodash-es';\n\nimport styles from './field-empty.module.less';\n\ninterface FieldEmptyProps {\n  fieldName: string | React.ReactNode;\n}\n\nexport function FieldEmpty({ fieldName }: FieldEmptyProps) {\n  return (\n    <div className={styles['field-empty']}>\n      <span className=\"flex-1 overflow-hidden truncate nowrap\">\n        {isString(fieldName)\n          ? `${I18n.t('workflow_240919_01')}${fieldName}`\n          : I18n.t('workflow_240919_01')}\n        {!isString(fieldName) && fieldName}\n      </span>\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type PropsWithChildren } from 'react';\nimport classNames from 'classnames';\n\nimport { FieldEmpty } from './field-empty';\n\nimport styles from './field.module.less';\n\ninterface FieldProps {\n  label: string | React.ReactNode;\n  isEmpty?: boolean;\n  labelClassName?: string;\n  contentClassName?: string;\n  customEmptyLabel?: string;\n}\n\nexport function Field({\n  label,\n  isEmpty = false,\n  children,\n  labelClassName,\n  contentClassName,\n  customEmptyLabel,\n}: PropsWithChildren<FieldProps>) {\n  return (\n    <>\n      <div className={classNames(styles.label, labelClassName)}>{label}</div>\n      <div className={`${styles.content} ${contentClassName}`}>\n        {isEmpty ? (\n          <FieldEmpty fieldName={customEmptyLabel ?? label} />\n        ) : (\n          children\n        )}\n      </div>\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { type ConditionLogic } from '@coze-workflow/base';\nimport { type ConditionType } from '@coze-arch/idl/workflow_api';\nimport {\n  IconCozEqual,\n  IconCozEqualSlash,\n  IconCozGreater,\n  IconCozGreaterEqual,\n  IconCozLess,\n  IconCozLessEqual,\n  IconCozProperSuperset,\n  IconCozProperSupersetSlash,\n} from '@coze-arch/coze-design/icons';\n\nimport { type ConditionItem } from '@/form-extensions/setters/condition/multi-condition/types';\n\nimport {\n  VariableDisplay,\n  ConditionContainer,\n  ExpressionDisplay,\n} from '../components/condition';\n\ninterface ConditionBranchProps {\n  branch: {\n    logic: ConditionLogic;\n    conditions: ConditionItem[];\n  };\n}\n\nconst Operator: FC<{\n  operator?: ConditionType;\n}> = props => {\n  const { operator } = props;\n  const operatorMap = {\n    1: <IconCozEqual />,\n    2: <IconCozEqualSlash />,\n    3: <IconCozGreater />,\n    4: <IconCozGreaterEqual />,\n    5: <IconCozLess />,\n    6: <IconCozLessEqual />,\n    // contain\n    7: <IconCozProperSuperset />,\n    // Do not include\n    8: <IconCozProperSupersetSlash />,\n    // isEmpty\n    9: <IconCozEqual />,\n    // isNotEmpty\n    10: <IconCozEqualSlash />,\n    // isTrue\n    11: <IconCozEqual />,\n    // isFalse\n    12: <IconCozEqual />,\n    13: <IconCozGreater />,\n    14: <IconCozGreaterEqual />,\n    15: <IconCozLess />,\n    16: <IconCozLessEqual />,\n  };\n  if (!operator) {\n    return null;\n  }\n\n  return <div className=\"text-center flex\">{operatorMap[operator]}</div>;\n};\n\nexport const ConditionBranch: FC<ConditionBranchProps> = props => {\n  const { branch } = props;\n  const { conditions = [], logic } = branch;\n\n  return (\n    <ConditionContainer\n      conditions={conditions.map(condition => ({\n        left: <VariableDisplay keyPath={condition.left?.content?.keyPath} />,\n        operator: <Operator operator={condition.operator} />,\n        right: (\n          <ExpressionDisplay\n            value={condition.right}\n            operator={condition.operator}\n          />\n        ),\n      }))}\n      logic={logic}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useWorkflowNode } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { Port } from './port';\nimport { Field } from './field';\nimport { ConditionBranch } from './condition-branch';\n\nexport function Conditions() {\n  const { data } = useWorkflowNode();\n  const conditions = data?.condition;\n\n  return (\n    <>\n      {conditions?.map((condition, index) => {\n        let label = I18n.t('worklfow_condition_if', {}, 'If');\n\n        if (index > 0) {\n          label = I18n.t('worklfow_condition_else_if', {}, 'Else if');\n        }\n\n        return (\n          <Field label={label}>\n            <ConditionBranch branch={condition.condition} />\n            <Port id={calcPortId(index)} type=\"output\" />\n          </Field>\n        );\n      })}\n      <Field label={I18n.t('workflow_detail_condition_else')}>\n        <div className=\"h-8 coz-stroke-plus coz-bg-max border border-solid p-1 rounded-mini\" />\n        <Port id={'false'} type=\"output\" />\n      </Field>\n    </>\n  );\n}\n\nfunction calcPortId(index: number) {\n  if (index === 0) {\n    return 'true';\n  } else {\n    return `true_${index}`;\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useEffect } from 'react';\n\nimport { useWorkflowNode } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { CozAvatar } from '@coze-arch/coze-design';\nimport { useWorkflowModels } from '@/hooks';\nimport { Field } from './field';\n\nexport function Model() {\n  const { data } = useWorkflowNode();\n  const [modelName, setModelName] = useState(data?.model?.modelName);\n  const { models } = useWorkflowModels();\n\n  useEffect(() => {\n    // fix:\n    // The drop-down box on the right shows that the model name is obtained in the name field, not the modelName.\n    // Therefore, you need to find the original model according to the modeType, display the name field, and keep the display on both sides consistent.\n    if (data?.model?.modelType) {\n      const model = models.find(v => v.model_type === data?.model?.modelType);\n      if (model) {\n        setModelName(model.name);\n      }\n    }\n  }, [models, data, data?.model]);\n\n  return (\n    <Field label={I18n.t('workflow_detail_llm_model')} isEmpty={!modelName}>\n      <div className=\"flex items-center leading-[20px]\">\n        <CozAvatar\n          size={'mini'}\n          shape=\"square\"\n          src={\n            models.find(item => item.model_type === data?.model?.modelType)\n              ?.model_icon\n          }\n          className={'shrink-0 h-4 w-4 mr-1'}\n          data-testid=\"bot-detail.model-config-modal.model-avatar\"\n        />\n        {modelName}\n      </div>\n    </Field>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Intent to identify nodes, option component rendering\n */\n\nimport { INTENT_NODE_MODE } from '@coze-workflow/nodes';\nimport { useWorkflowNode } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { calcPortId } from '@/form-extensions/setters/answer-option/utils';\n\nimport { AnswerItem } from './question-pairs-answer';\nimport { Port } from './port';\nimport { Field } from './field';\n\nexport function Intents() {\n  const { data } = useWorkflowNode();\n  const intents =\n    data?.intentMode === INTENT_NODE_MODE.MINIMAL\n      ? data?.quickIntents\n      : data?.intents;\n\n  return (\n    <>\n      <div className=\"mt-[20px]\" />\n      <div className=\"mt-[20px]\" />\n      {intents?.map((intent: { name: string }, index: number) => (\n        <Field\n          key={index}\n          label={I18n.t('workflow_ques_ans_type_option_title')}\n        >\n          <AnswerItem\n            key={intent?.name + index}\n            showLabel={false}\n            label=\"\"\n            content={intent?.name}\n            maxWidth={260}\n          />\n          <Port id={calcPortId(index)} type=\"output\" />\n        </Field>\n      ))}\n\n      <Field label={I18n.t('workflow_ques_ans_type_option_other')}>\n        <Port id=\"default\" type=\"output\" />\n      </Field>\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useWorkflowNode } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\n/**\n * Use the same useDataSetInfos as the knowledge list in the form.\n * useDataSetInfos will cache the data internally. When a new knowledge base is selected in the form, there is no need to resend the request to pull the data.\n */\n\nimport { useDataSetInfos } from '@/hooks';\n\nimport { OverflowTagList } from './overflow-tag-list';\nimport { Field } from './field';\n\nexport function Knowledge() {\n  const { data } = useWorkflowNode();\n  const knowledge = data?.inputs?.datasetParameters?.datasetParam ?? [];\n  const { dataSets } = useDataSetInfos({ ids: knowledge });\n  return (\n    <Field\n      label={I18n.t('workflow_detail_knowledge_knowledge')}\n      isEmpty={knowledge.length === 0}\n    >\n      <OverflowTagList\n        value={dataSets.map(d => ({\n          // The operation and maintenance platform can directly display the ID, because the operation and maintenance platform cannot pull the actual knowledge base information.\n          label: IS_BOT_OP ? d.dataset_id : d.name,\n          icon: (\n            <img className=\"w-[16px] h-[16px] rounded-mini\" src={d.icon_url} />\n          ),\n        }))}\n      />\n    </Field>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useMemo } from 'react';\n\nimport { useWorkflowNode } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  WorkflowNodePortsData,\n  useCurrentEntity,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { AnswerType, OptionType } from '@/constants/question-settings';\n\nimport { VariableTagList } from './variable-tag-list';\nimport { useInputParametersVariableTags } from './use-input-parameters-variable-tags';\nimport { AnswerItem } from './question-pairs-answer';\nimport { Port } from './port';\nimport { LabelWithTooltip } from './label-with-tooltip';\nimport { Field } from './field';\n\nimport styles from './question-pairs.module.less';\n\nconst NumToCharIndex = 65;\n\nconst convertNumberToLetters = (n: number) => {\n  let result = '';\n  while (n >= 0) {\n    result = String.fromCharCode((n % 26) + NumToCharIndex) + result;\n    n = Math.floor(n / 26) - 1;\n  }\n  return result;\n};\n\nexport function QuestionPairs() {\n  const { data } = useWorkflowNode();\n  const node = useCurrentEntity();\n  const questionParams = data?.questionParams;\n  const isOptions = useMemo(\n    () => questionParams?.answer_type === AnswerType.Option,\n    [questionParams?.answer_type],\n  );\n\n  const isDynamic = useMemo(\n    () => questionParams?.option_type === OptionType.Dynamic,\n    [questionParams?.option_type],\n  );\n\n  const dynamicOption = useMemo(\n    () => questionParams?.dynamic_option,\n    [questionParams?.dynamic_option],\n  );\n\n  const dynamicOptionTag = useInputParametersVariableTags([\n    {\n      name: I18n.t('workflow_question_dynamic', {}, 'dynamicOption'),\n      input: dynamicOption,\n    },\n  ]);\n\n  useEffect(() => {\n    const portsData = node.getData<WorkflowNodePortsData>(\n      WorkflowNodePortsData,\n    );\n    portsData.updateDynamicPorts();\n  }, [isDynamic]);\n\n  return (\n    <>\n      <Field\n        label={I18n.t('workflow_ques_content', {}, '')}\n        isEmpty={!questionParams?.question}\n      >\n        <LabelWithTooltip\n          customClassName={styles.question_pairs_content}\n          maxWidth={230}\n          content={questionParams?.question ?? ''}\n        />\n      </Field>\n      <Field label={I18n.t('workflow_240919_02', {}, '')}>\n        <div className={styles.question_pairs_content}>\n          {isOptions\n            ? I18n.t('workflow_ques_ans_type_option', {}, '')\n            : I18n.t('workflow_ques_ans_type_direct', {}, '')}\n        </div>\n      </Field>\n      {isOptions ? (\n        <>\n          {isDynamic ? (\n            <Field label={''}>\n              <AnswerItem\n                label={I18n.t('workflow_question_az', {}, 'A~Z')}\n                content={<VariableTagList value={dynamicOptionTag} />}\n              />\n              <Port id={'branch_0'} type=\"output\" />\n            </Field>\n          ) : (\n            questionParams?.options?.map((option, index) => (\n              <Field label={''}>\n                <AnswerItem\n                  label={convertNumberToLetters(index)}\n                  content={option?.name}\n                />\n                {/* Corresponding questionNodeRegistry options table entry */}\n                <Port id={`branch_${index}`} type=\"output\" />\n              </Field>\n            ))\n          )}\n          <Field label={''}>\n            <AnswerItem\n              label={I18n.t('workflow_ques_ans_type_option_other', {}, '')}\n              content={I18n.t('workflow_240919_03', {}, '')}\n            />\n            <Port id={'default'} type=\"output\" />\n          </Field>\n        </>\n      ) : null}\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useRef, useState } from 'react';\n\nimport classNames from 'classnames';\nimport {\n  type WorkflowVariable,\n  useGetWorkflowVariableByKeyPath,\n  GlobalVariableKey,\n  useAvailableWorkflowVariables,\n} from '@coze-workflow/variable';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozWarningCircleFillPalette,\n  IconCozFolder,\n  IconCozPeople,\n  IconCozSetting,\n} from '@coze-arch/coze-design/icons';\nimport { Tag } from '@coze-arch/coze-design';\n\nimport { useVariableWithNodeInfo } from '@/node-registries/http/fields/hooks/use-variable-with-node';\nimport { useNodeServiceAndRefreshForTitleChange } from '@/form-extensions/hooks/use-node-available-variables';\n\nimport { useHttpUrlVariables } from '../../hooks/use-http-url-variables';\n\nimport styles from './index.module.less';\n\ninterface UrlFieldProps {\n  apiUrl: string;\n  allVariables?: WorkflowVariable[];\n  isTooltips?: boolean;\n  setTipsVisible?: (visible: boolean) => void;\n}\n\nconst globalVariableIconMap = {\n  [GlobalVariableKey.App]: <IconCozFolder />,\n  [GlobalVariableKey.User]: <IconCozPeople />,\n  [GlobalVariableKey.System]: <IconCozSetting />,\n};\n\nexport const UrlField = (props: UrlFieldProps, ref) => {\n  const { apiUrl, isTooltips = false, setTipsVisible } = props;\n\n  const allVariables = useAvailableWorkflowVariables();\n\n  const containerRef = useRef<HTMLDivElement>(null);\n  const wrapperRef = useRef<HTMLDivElement>(null);\n  const [isHeightOver, setHeightOver] = useState<boolean>(false);\n\n  const getVariableByKeyPath = useGetWorkflowVariableByKeyPath();\n  const { getNodeInfoInVariableMeta } =\n    useNodeServiceAndRefreshForTitleChange();\n  const availableVariables = useVariableWithNodeInfo(\n    allVariables,\n    getNodeInfoInVariableMeta,\n  );\n\n  const { urlVariables = [], splitedUrl = [] } = useHttpUrlVariables({\n    urlExpressionString: apiUrl,\n    availableVariables,\n    getVariableByKeyPath,\n  });\n\n  useEffect(() => {\n    const observer = new ResizeObserver((entries: ResizeObserverEntry[]) => {\n      const innerHeight = entries[0].contentRect.height;\n      const outerHeight = wrapperRef.current?.clientHeight ?? 0;\n\n      setHeightOver(innerHeight > outerHeight);\n    });\n\n    if (containerRef.current) {\n      observer.observe(containerRef.current);\n    }\n\n    return () => {\n      if (containerRef.current) {\n        observer.unobserve(containerRef.current);\n      }\n    };\n  }, [apiUrl]);\n\n  useEffect(() => {\n    if (isTooltips) {\n      return;\n    }\n    setTipsVisible?.(isHeightOver);\n  }, [isHeightOver, isTooltips]);\n\n  return (\n    <div className=\"relative overflow-hidden\">\n      <div\n        ref={wrapperRef}\n        style={{\n          maxHeight: isTooltips ? 'auto' : '87px',\n        }}\n      >\n        <div ref={containerRef} className={styles.container}>\n          {splitedUrl?.map(urlPart => {\n            if (!urlPart.isVariable) {\n              return <span className=\"inline\">{urlPart.content}</span>;\n            }\n            const curVariableInfo = urlVariables.find(\n              variable => urlPart.content === variable.content,\n            );\n            if (curVariableInfo?.isVariableExist) {\n              return (\n                <span\n                  className={classNames({\n                    [styles['wrapper-error']]: !curVariableInfo?.isValid,\n                    [styles.nodeGlobal]: curVariableInfo?.globalVariableKey,\n                  })}\n                >\n                  <Tag\n                    color=\"primary\"\n                    className={classNames(styles.node, {\n                      [styles.nodeError]: !curVariableInfo?.isValid,\n                    })}\n                    prefixIcon={\n                      curVariableInfo?.globalVariableKey\n                        ? globalVariableIconMap[\n                            curVariableInfo?.globalVariableKey\n                          ]\n                        : null\n                    }\n                  >\n                    {!!curVariableInfo?.iconUrl && (\n                      <img\n                        src={curVariableInfo.iconUrl}\n                        className=\"w-[14px] mr-[4px]\"\n                      />\n                    )}\n                    <span className={styles['node-title']}>\n                      {curVariableInfo.nodeTitle}\n                    </span>\n                    <span className={styles.split}>-</span>\n                    <span\n                      className={classNames(styles.content, 'max-w-[160px]', {\n                        '!text-[#E53241]': !curVariableInfo?.isValid,\n                      })}\n                    >\n                      {curVariableInfo.parsedKeyPath}\n                    </span>\n                  </Tag>\n                </span>\n              );\n            }\n\n            return (\n              <span className={styles['deleted-variable']}>\n                <Tag prefixIcon={<IconCozWarningCircleFillPalette />}>\n                  {I18n.t('node_http_var_infer_delete', {}, '')}\n                </Tag>\n              </span>\n            );\n          })}\n        </div>\n      </div>\n\n      {isHeightOver ? <div className={styles['text-subfix']} /> : null}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useEffect, useRef } from 'react';\n\nimport { isEqual, cloneDeep } from 'lodash-es';\nimport { type WorkflowVariableFacade } from '@coze-workflow/variable/src/core/workflow-variable-facade';\n\nimport {\n  getVariableInfoFromExpression,\n  findInputVariable,\n} from '@/node-registries/http/components/variable-support/utils';\nimport type {\n  VariableWithNodeInfo,\n  InputVariableInfo,\n} from '@/node-registries/http/components/variable-support/types';\n\nexport interface UrlVariableInfoType extends InputVariableInfo {\n  content: string;\n  startIndex: number;\n  endIndex: number;\n}\n\nexport interface SplitedUrlType {\n  content: string;\n  isVariable: boolean;\n}\n\nexport interface UseHttpUrlVariablesProps {\n  urlExpressionString: string;\n  availableVariables: VariableWithNodeInfo[];\n  getVariableByKeyPath: (\n    keyPath: string[],\n  ) => WorkflowVariableFacade | undefined;\n}\n\nexport function useHttpUrlVariables({\n  urlExpressionString,\n  availableVariables,\n  getVariableByKeyPath,\n}: UseHttpUrlVariablesProps): {\n  urlVariables: UrlVariableInfoType[];\n  splitedUrl: SplitedUrlType[];\n} {\n  const [urlVariables, setUrlVariables] = useState<UrlVariableInfoType[]>([]);\n  const [splitedUrl, setSplitedUrl] = useState<SplitedUrlType[]>([]);\n  const doubleBracedPattern = /{{([^}]+)}}/g;\n\n  const apiUrlRef = useRef<string>('');\n  const variableRef = useRef<VariableWithNodeInfo[]>([]);\n\n  useEffect(() => {\n    if (!urlExpressionString) {\n      return;\n    }\n\n    const isUrlChange = apiUrlRef.current !== urlExpressionString;\n    if (isUrlChange) {\n      apiUrlRef.current = urlExpressionString;\n    }\n    const isVariableChange = !isEqual(variableRef.current, availableVariables);\n    if (isVariableChange) {\n      variableRef.current = cloneDeep(availableVariables);\n    }\n\n    if (!isUrlChange && !isVariableChange) {\n      return;\n    }\n\n    const matches: UrlVariableInfoType[] = [];\n    const urlPieces: SplitedUrlType[] = [];\n    let match: RegExpExecArray | null;\n    let lastIndex = 0;\n\n    while (true) {\n      match = doubleBracedPattern.exec(urlExpressionString);\n      if (!match) {\n        break;\n      }\n\n      const content = match[0]; // With double curly braces\n      const {\n        globalVariableKey,\n        nodeName,\n        fieldPart,\n        fieldKeyPath,\n        parsedKeyPath,\n      } = getVariableInfoFromExpression(match[1]);\n\n      const matchedVariable = getVariableByKeyPath(fieldKeyPath ?? []);\n      const variableInfo = findInputVariable(\n        availableVariables,\n        {\n          globalVariableKey,\n          nodePart: nodeName,\n          fieldPart,\n          parsedKeyPath,\n        },\n        matchedVariable,\n      );\n\n      const startIndex = match.index;\n      const endIndex = match.index + content.length;\n      // Add previous string\n      urlPieces.push({\n        content: urlExpressionString.slice(lastIndex, match.index),\n        isVariable: false,\n      });\n      // Add current string\n      urlPieces.push({ content, isVariable: true });\n      // Update lastIndex to the end position of the current match\n      lastIndex = match.index + content.length;\n\n      matches.push({\n        ...variableInfo,\n        content,\n        startIndex,\n        endIndex,\n      });\n    }\n\n    // Add the string after the last match\n    if (lastIndex < urlExpressionString.length) {\n      urlPieces.push({\n        content: urlExpressionString.slice(lastIndex),\n        isVariable: false,\n      });\n    }\n\n    setUrlVariables(matches);\n    setSplitedUrl(urlPieces);\n  }, [urlExpressionString, availableVariables]);\n\n  return { urlVariables, splitedUrl };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useState } from 'react';\n\nimport { Tooltip } from '@coze-arch/coze-design';\n\nimport { UrlField } from './url-field';\n\nexport function UrlContainer({ apiUrl }: { apiUrl: string }) {\n  const [isTipsVisible, setTipsVisible] = useState(false);\n  const [isHover, setHover] = useState(false);\n  const wrapperId = `http-url-tips-${Math.random()}`;\n  return (\n    <div\n      id={wrapperId}\n      onMouseEnter={() => setHover(true)}\n      onMouseLeave={() => setHover(false)}\n    >\n      <Tooltip\n        trigger=\"custom\"\n        visible={isHover && isTipsVisible}\n        key=\"http-url-tips\"\n        motion={false}\n        style={{\n          transform: 'translateX(60%)',\n          backgroundColor: 'rgba(var(--coze-bg-3), 1)',\n        }}\n        content={<UrlField apiUrl={apiUrl} isTooltips />}\n        getPopupContainer={() =>\n          (document.getElementById(wrapperId) as HTMLElement) ?? document.body\n        }\n      >\n        <UrlField apiUrl={apiUrl} setTipsVisible={setTipsVisible} />\n      </Tooltip>\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { PublicScopeProvider } from '@coze-workflow/variable';\nimport { useWorkflowNode } from '@coze-workflow/base';\n\nimport { Field } from '../field';\nimport { UrlContainer } from './url-container';\n\nexport function HttpApiField() {\n  const { data } = useWorkflowNode();\n  const apiInfo = data?.inputs?.apiInfo;\n  const apiUrl = data?.inputs?.apiInfo?.url;\n\n  return (\n    <Field\n      labelClassName=\"h-full\"\n      label={<div className=\"leading-[22px]\">{apiInfo?.method}</div>}\n      isEmpty={!apiUrl}\n      customEmptyLabel={'URL'}\n    >\n      <PublicScopeProvider>\n        <UrlContainer apiUrl={apiUrl} />\n      </PublicScopeProvider>\n    </Field>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { get } from 'lodash-es';\nimport {\n  useWorkflowNode,\n  type DatabaseSettingField,\n  type DatabaseField,\n} from '@coze-workflow/base';\n\nimport { useCurrentDatabaseQuery } from '@/hooks';\n\nimport {\n  VariableTagList,\n  type VariableTagProps,\n  VariableTagStatus,\n} from './variable-tag-list';\nimport { Field } from './field';\n\ninterface SettingFieldsProps {\n  label: string;\n  name: string;\n}\n\n/**\n * Database field setting component\n * @Param props.label title\n * @Param props.name field path to get field settings from node data\n */\nexport function DatabaseSettingFields({ label, name }: SettingFieldsProps) {\n  const { data: database, isLoading, error } = useCurrentDatabaseQuery();\n  const value = useValue(name);\n  const variableTagList = getVariableTagList(\n    value,\n    !error ? database?.fields : [],\n  );\n  const isEmpty = variableTagList.length === 0;\n  return (\n    <Field label={label} isEmpty={isEmpty}>\n      {isLoading ? null : <VariableTagList value={variableTagList} />}\n    </Field>\n  );\n}\n\nfunction useValue(name: string) {\n  const { data } = useWorkflowNode();\n  const value = get(data, name) as DatabaseSettingField[];\n  return value;\n}\n\nfunction getVariableTagList(\n  value: DatabaseSettingField[] = [],\n  fields: DatabaseField[] = [],\n): VariableTagProps[] {\n  return value?.map(settingField => {\n    const field = fields.find(item => item.id === settingField.fieldID);\n    const variableTag: VariableTagProps = getVariableTagProps(\n      settingField,\n      field,\n    );\n    return variableTag;\n  });\n}\n\nfunction getVariableTagProps(\n  settingField: DatabaseSettingField,\n  field?: DatabaseField,\n): VariableTagProps {\n  const content = settingField.fieldValue?.content;\n  return {\n    key: settingField.fieldID.toString(),\n    label: field?.name,\n    type: field?.type,\n    status:\n      content || content === false\n        ? VariableTagStatus.Default\n        : VariableTagStatus.Warning,\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useWorkflowNode } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { VariableTagList } from './variable-tag-list';\nimport { useInputParametersVariableTags } from './use-input-parameters-variable-tags';\nimport { Field } from './field';\n\ninterface InputParametersProps {\n  label?: string;\n}\n\nexport function InputParameters({\n  label = I18n.t('workflow_detail_node_parameter_input'),\n}: InputParametersProps) {\n  const { inputParameters } = useWorkflowNode();\n  const variableTags = useInputParametersVariableTags(inputParameters);\n\n  const isEmpty = !variableTags || variableTags.length === 0;\n\n  return (\n    <Field label={label} isEmpty={isEmpty}>\n      <VariableTagList value={variableTags} />\n    </Field>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useRef, useState } from 'react';\n\nimport { Tooltip } from '@coze-arch/coze-design';\n\nexport const LabelWithTooltip = ({ customClassName, maxWidth, content }) => {\n  const textRef = useRef<HTMLDivElement>(null);\n  const [isOverflowing, setIsOverflowing] = useState(false);\n\n  useEffect(() => {\n    if (textRef.current) {\n      const textWidth = textRef.current?.offsetWidth;\n      setIsOverflowing(textWidth >= maxWidth);\n    }\n  }, [content, maxWidth]); // Depends on the text content, rechecking when the text content changes\n\n  return (\n    <Tooltip\n      content={<span className=\"coz-fg-primary text-lg\">{content ?? ''}</span>}\n      style={{\n        backgroundColor: 'rgba(var(--coze-bg-3), 1)',\n        display: isOverflowing ? 'block' : 'none',\n      }}\n    >\n      <div\n        className={\n          'overflow-hidden text-ellipsis whitespace-nowrap leading-[20px]'\n        }\n        style={{\n          maxWidth: isOverflowing ? `${maxWidth}px` : 'auto',\n        }}\n      >\n        <span ref={textRef} className={customClassName}>\n          {content ?? ''}\n        </span>\n      </div>\n    </Tooltip>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useWorkflowNode } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { AnswerItem } from './question-pairs-answer';\nimport { Field } from './field';\nexport function MessageOutput() {\n  const { data } = useWorkflowNode();\n  const outputContent = data?.inputs?.content;\n  return (\n    <Field label={I18n.t('workflow_241111_01')}>\n      <AnswerItem\n        showLabel={false}\n        label=\"\"\n        content={outputContent}\n        maxWidth={260}\n      />\n    </Field>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useWorkflowNode } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { VariableTagList } from './variable-tag-list';\nimport { useOutputsVariableTags } from './use-outputs-variable-tags';\nimport { Field } from './field';\n\ninterface OutputsProps {\n  label?: string;\n}\n\n/**\n * Node output\n */\nexport function Outputs({\n  label = I18n.t('workflow_detail_node_output'),\n}: OutputsProps) {\n  const { outputs } = useWorkflowNode();\n  const variableTags = useOutputsVariableTags(outputs);\n\n  const isEmpty = !variableTags || variableTags.length === 0;\n\n  return (\n    <Field label={label} isEmpty={isEmpty}>\n      <VariableTagList value={variableTags} />\n    </Field>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\n\nimport {\n  useCurrentEntity,\n  useRefresh,\n} from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowNodeOutputVariablesData } from '@coze-workflow/variable';\nimport { type OutputValueVO } from '@coze-workflow/base/types';\n\nimport { type VariableTagProps } from './variable-tag-list';\nexport function useOutputsVariableTags(\n  outputs: OutputValueVO[] = [],\n): VariableTagProps[] {\n  const node = useCurrentEntity();\n  const refresh = useRefresh();\n\n  const outputVariablesData: WorkflowNodeOutputVariablesData = node.getData(\n    WorkflowNodeOutputVariablesData,\n  );\n\n  const variableTags = outputs.map(\n    (output): VariableTagProps => ({\n      label: output.name,\n      type:\n        output.type ||\n        outputVariablesData.getVariableByKey(output.name)?.viewType,\n    }),\n  );\n\n  useEffect(() => {\n    const disposable = outputVariablesData.onAnyVariablesChange(() => {\n      // Refresh after variable type changes\n      refresh();\n    });\n\n    return () => disposable?.dispose();\n  }, [outputVariablesData, refresh]);\n\n  return variableTags;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  type ReactNode,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from 'react';\n\nimport classnames from 'classnames';\nimport { IconCozMore } from '@coze-arch/coze-design/icons';\nimport { Tooltip, IconButton } from '@coze-arch/coze-design';\nimport { Dropdown } from '@coze-arch/bot-semi';\n\nimport s from './overflow-tag-list.module.less';\n\nexport interface TagProps {\n  key?: string;\n  icon?: ReactNode;\n  label?: ReactNode;\n  tooltip?: ReactNode;\n}\n\nexport interface OverflowTagListProps<T extends TagProps = TagProps> {\n  /* tag list */\n  value?: T[];\n  enableTooltip?: boolean;\n  tagItemRenderer?: (tagData: T) => ReactNode;\n  dropdownClassName?: string;\n  disableMore?: boolean;\n}\n\nconst TAG_ITEM_IDENTIFIER_CLASS = 'tag-item-wrapper';\n\nconst defaultTagItemRenderer = (tag: TagProps): ReactNode => {\n  const { icon, label = '' } = tag;\n  return (\n    <div className={classnames(s.tagItem, s.limitWidth, 'gap-[4px]')}>\n      {icon ? (\n        <span className={classnames(s.tagItemIcon, 'text-lg', 'coz-fg-dim')}>\n          {icon}\n        </span>\n      ) : null}\n      <span className={s.tagItemLabel}>{label}</span>\n    </div>\n  );\n};\n\nexport function OverflowTagList<T extends TagProps = TagProps>({\n  value = [],\n  enableTooltip,\n  tagItemRenderer,\n  dropdownClassName,\n  disableMore,\n}: OverflowTagListProps<T>) {\n  const renderTags = (tags: T[]) =>\n    tags.map(tag => {\n      const { tooltip, key } = tag;\n      const tagItemContent =\n        tagItemRenderer?.(tag) || defaultTagItemRenderer(tag);\n      const tagItem = (\n        <div\n          key={key}\n          className={classnames(TAG_ITEM_IDENTIFIER_CLASS, 'max-w-full')}\n        >\n          {tagItemContent}\n        </div>\n      );\n      if (!tooltip || !enableTooltip) {\n        return tagItem;\n      }\n      return (\n        <Tooltip\n          key={key ? `tooltip-${key}` : undefined}\n          content={<span className=\"coz-fg-primary text-lg\">{tooltip}</span>}\n          style={{ backgroundColor: 'rgba(var(--coze-bg-3), 1)' }}\n        >\n          {tagItem}\n        </Tooltip>\n      );\n    });\n\n  const tagListRef = useRef<HTMLDivElement | null>(null);\n  const [showOverlay, setShowOverlay] = useState(false);\n\n  useLayoutEffect(() => {\n    if (!tagListRef.current) {\n      return;\n    }\n    const listWidth = tagListRef.current?.clientWidth ?? 0;\n    const tags = Array.from(\n      tagListRef.current.getElementsByClassName(TAG_ITEM_IDENTIFIER_CLASS),\n    ) as HTMLElement[];\n    if (!tags?.length) {\n      setShowOverlay(false);\n    } else {\n      const lastTag = tags[tags.length - 1];\n      const right = lastTag.offsetWidth + lastTag.offsetLeft;\n      setShowOverlay(right > listWidth);\n    }\n  }, [value]);\n\n  return (\n    <div\n      ref={tagListRef}\n      className={classnames(s.overflowTagList, 'flex gap-1.5 items-center')}\n    >\n      {renderTags(value)}\n      {showOverlay ? (\n        <div key=\"overlay\" className={s.overlay}>\n          <div className={s.overlayMask}></div>\n          {!disableMore && (\n            <Dropdown\n              position=\"bottomRight\"\n              render={\n                <div\n                  className={classnames(\n                    'w-[230px] p-1.5 gap-1.5 flex flex-row flex-wrap',\n                    {\n                      [dropdownClassName as string]: dropdownClassName,\n                    },\n                  )}\n                >\n                  {renderTags(value)}\n                </div>\n              }\n            >\n              <IconButton\n                className={classnames('w-full', 'h-full')}\n                wrapperClass={classnames(\n                  'pointer-events-auto',\n                  'text-[0px]',\n                  'coz-bg-plus',\n                  'w-[22px]',\n                  'h-[20px]',\n                )}\n                style={{ height: '100%' }}\n                size=\"mini\"\n                iconSize=\"small\"\n                icon={<IconCozMore />}\n              />\n            </Dropdown>\n          )}\n        </div>\n      ) : null}\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CSSProperties } from 'react';\n\nimport styles from './port.module.less';\n\ninterface PortProps {\n  id: string;\n  type: 'input' | 'output';\n  style?: CSSProperties;\n}\n\nexport function Port({ id, type, style }: PortProps) {\n  return (\n    <div\n      className={styles.port}\n      data-port-id={id}\n      data-port-type={type}\n      style={style}\n    />\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport classnames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { LabelWithTooltip } from './label-with-tooltip';\nimport { FieldEmpty } from './field-empty';\n\nimport styles from './question-pairs.module.less';\n\nexport const AnswerItem = ({\n  label,\n  content,\n  showLabel = true,\n  maxWidth = 148,\n}) => (\n  <div className={'flex items-center w-full h-[20px]'}>\n    {showLabel ? (\n      <div\n        className={classnames(\n          styles.tagItem,\n          'px-1 py-0.5 gap-0.5 w-[50px] mr-[6px] flex items-center justify-center',\n        )}\n        style={{\n          flex: '0 0 50px',\n        }}\n      >\n        <span className={styles.tagItemLabel}>{label ?? ''}</span>\n      </div>\n    ) : null}\n    {!content ? (\n      <FieldEmpty\n        fieldName={I18n.t('workflow_ques_ans_type_option_content', {}, '')}\n      />\n    ) : (\n      <LabelWithTooltip\n        customClassName={styles.question_pairs_content}\n        maxWidth={maxWidth}\n        content={content ?? ''}\n      />\n    )}\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useWorkflowNode } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { Typography } from '@coze-arch/coze-design';\n\nimport { defaultTerminalPlanOptions } from '@/node-registries/end/constants';\n\nimport { Field } from './field';\nexport const TerminatePlan = () => {\n  const { data } = useWorkflowNode();\n\n  const terminatePlan = defaultTerminalPlanOptions.find(\n    item => item.value === data?.inputs?.terminatePlan,\n  )?.label;\n  if (!terminatePlan) {\n    return null;\n  }\n  return (\n    <Field label={I18n.t('wf_chatflow_131')}>\n      <div className=\"flex\">\n        <Typography.Text className=\"leading-[20px]\">\n          {terminatePlan}\n        </Typography.Text>\n      </div>\n    </Field>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport isFunction from 'lodash-es/isFunction';\nimport { isNil } from 'lodash-es';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\nimport { variableUtils } from '@coze-workflow/variable';\nimport { WorkflowNodeData } from '@coze-workflow/nodes';\nimport {\n  type InputValueVO,\n  type RefExpressionContent,\n  ValueExpressionType,\n  ViewVariableType,\n  StandardNodeType,\n  isUserInputStartParams,\n  useWorkflowNode,\n  ValueExpression,\n  type VariableTypeDTO,\n  type VariableMetaDTO,\n} from '@coze-workflow/base';\n\nimport { useAvailableNodeVariables } from '../hooks/use-available-node-variables';\nimport { type VariableTagProps } from './variable-tag-list';\n/** Check if the form value is illegal. If required is set, but there is no relevant value, return true. */\nconst checkInvalid = (\n  inputDef: VariableMetaDTO | undefined,\n  input: ValueExpression,\n) => {\n  let invalid = false;\n  // Make invalid judgments only for required parameters\n  if (inputDef?.required) {\n    if (input?.type === ValueExpressionType.REF) {\n      // The reference must exist in the keypath array\n      invalid = !input?.content?.keyPath?.length;\n    } else if (input?.type === ValueExpressionType.LITERAL) {\n      // The specified value must contain content\n      invalid = input?.content === '' || isNil(input?.content);\n    }\n  }\n  return invalid;\n};\n\nexport function useInputParametersVariableTags(\n  inputParameters: InputValueVO[] | Record<string, InputValueVO['input']> = [],\n): VariableTagProps[] {\n  const node = useCurrentEntity();\n  const variableService = useAvailableNodeVariables(node);\n  const { registry } = useWorkflowNode();\n\n  // The inputParameters of some templates in the back end are set to null, and the logic of the default assignment [] will not be reached at this time.\n  // It will cause the following related methods to report an error, such as Object.entries (inputParameters), here is a bottom line\n  if (!inputParameters) {\n    return [];\n  }\n\n  if (!Array.isArray(inputParameters)) {\n    inputParameters = Object.entries(inputParameters).map(([name, input]) => ({\n      name,\n      input,\n    }));\n  }\n\n  const variableTags = inputParameters.map(\n    ({ name, input }): VariableTagProps => {\n      if (isFunction(registry?.meta?.getInputVariableTag)) {\n        return registry?.meta?.getInputVariableTag(name, input, {\n          variableService,\n          node,\n        });\n      }\n\n      let viewType: ViewVariableType | undefined;\n      // Whether the variable is valid, it is valid by default\n      let invalid = false;\n\n      if (input?.rawMeta?.type) {\n        viewType = input?.rawMeta?.type;\n        // To refer to the parameters of the variable, you need to determine whether the variable exists to confirm that it is valid\n        if (input && ValueExpression.isRef(input)) {\n          const variable = variableService.getWorkflowVariableByKeyPath(\n            (input?.content as RefExpressionContent)?.keyPath,\n            { node, checkScope: true },\n          );\n          invalid = !variable;\n        } else if (input && ValueExpression.isLiteral(input)) {\n          invalid = input?.content === '' || isNil(input?.content);\n        }\n      } else if (input?.type === ValueExpressionType.LITERAL) {\n        viewType = input?.rawMeta?.type || ViewVariableType.String;\n      } else if (input?.type === ValueExpressionType.REF) {\n        const variable = variableService.getWorkflowVariableByKeyPath(\n          (input?.content as RefExpressionContent)?.keyPath,\n          { node, checkScope: true },\n        );\n\n        viewType = variable?.viewType;\n      }\n\n      if (node.flowNodeType === StandardNodeType.SubWorkflow) {\n        const nodeData = node.getData<WorkflowNodeData>(WorkflowNodeData);\n        const detail = nodeData?.getNodeData<StandardNodeType.SubWorkflow>();\n        const inputDef = detail?.inputsDefinition?.find(\n          v => v.name === name,\n        ) as VariableMetaDTO;\n        invalid = checkInvalid(inputDef, input);\n\n        // Parameter definition for subprocesses, preferentially using the type of parameter definition\n        if (inputDef) {\n          viewType = variableUtils.DTOTypeToViewType(\n            inputDef.type as VariableTypeDTO,\n            {\n              arrayItemType: inputDef?.schema?.type,\n              assistType: inputDef?.schema?.assistType,\n            },\n          );\n        }\n      }\n\n      // Special handling for plug-in nodes\n      if (node.flowNodeType === StandardNodeType.Api) {\n        const nodeData = node.getData<WorkflowNodeData>(WorkflowNodeData);\n        const detail = nodeData?.getNodeData<StandardNodeType.Api>();\n        const inputDef = detail?.inputs?.find(\n          v => v.name === name,\n        ) as VariableMetaDTO;\n\n        // If a parameter definition exists, the type of the parameter definition is preferred\n        if (inputDef) {\n          viewType = variableUtils.DTOTypeToViewType(inputDef.type, {\n            arrayItemType: inputDef?.schema?.type,\n            assistType: inputDef?.schema?.assistType,\n          });\n        }\n\n        invalid = checkInvalid(inputDef, input);\n      }\n\n      // For BOT_USER_INPUT variables, set the default value type\n      if (isUserInputStartParams(name) && !viewType) {\n        viewType = ViewVariableType.String;\n      }\n\n      return {\n        label: name,\n        type: viewType,\n        invalid,\n      };\n    },\n  );\n\n  return variableTags;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type ReactNode, useMemo } from 'react';\n\nimport classnames from 'classnames';\nimport {\n  type ViewVariableType,\n  VARIABLE_TYPE_ALIAS_MAP,\n} from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozWarningCircle } from '@coze-arch/coze-design/icons';\n\nimport { OverflowTagList, type TagProps } from './overflow-tag-list';\nimport { VARIABLE_TYPE_ICON_MAP } from './constants';\n\nimport s from './variable-tag-list.module.less';\n\n// state\nexport enum VariableTagStatus {\n  Success = 'success',\n  Warning = 'warning',\n  Default = 'default',\n}\n\nexport interface VariableTagProps {\n  key?: string;\n  /* Variable type */\n  type?: ViewVariableType;\n  /* Variable name, when empty, is displayed as Undefined/Undefined */\n  label?: ReactNode;\n  invalid?: boolean;\n  status?: VariableTagStatus;\n}\n\nexport interface VariableTagListProps {\n  /* tag list */\n  value?: VariableTagProps[];\n  /**\n   * The maximum width of each tag, the default is the width of the parent container\n   */\n  maxTagWidth?: number;\n}\n\ninterface VariableTagRenderProps extends TagProps {\n  invalid?: boolean;\n  status?: VariableTagStatus;\n}\n\nexport const VariableTagList: React.FC<VariableTagListProps> = ({\n  value = [],\n  maxTagWidth,\n}) => {\n  const renderTag = ({\n    icon,\n    label,\n    invalid,\n    status,\n  }: VariableTagRenderProps) => {\n    if (!status && invalid) {\n      status = VariableTagStatus.Warning;\n    }\n\n    return (\n      <div\n        className={classnames(\n          s.variableTag,\n          'px-1 py-0.5 gap-0.5',\n          s[`variable-tag_${status || 'default'}`],\n        )}\n      >\n        <span\n          className={classnames(s.variableTagIcon, 'text-lg', 'coz-fg-dim')}\n        >\n          {icon}\n        </span>\n        <span className={s.variableTagLabel} style={{ maxWidth: maxTagWidth }}>\n          {label}\n        </span>\n      </div>\n    );\n  };\n\n  const formattedValue = useMemo<VariableTagRenderProps[]>(\n    () =>\n      value.map(v => {\n        const label = v.label || I18n.t('workflow_variable_undefined');\n        const icon = v.type ? (\n          VARIABLE_TYPE_ICON_MAP[v.type] || <IconCozWarningCircle />\n        ) : (\n          <IconCozWarningCircle />\n        );\n        const invalid = v.invalid || !v.label || !v.type;\n\n        return {\n          key: v.key,\n          label,\n          icon,\n          invalid,\n          tooltip: v.type ? VARIABLE_TYPE_ALIAS_MAP[v.type] : undefined,\n          status: v.status,\n        };\n      }),\n    [value],\n  );\n  return (\n    <OverflowTagList<VariableTagRenderProps>\n      value={formattedValue}\n      enableTooltip\n      tagItemRenderer={renderTag}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, startTransition } from 'react';\n\nimport type { FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { useRefresh } from '@flowgram-adapter/free-layout-editor';\nimport { FlowNodeVariableData } from '@coze-workflow/variable';\n\nimport { useVariableService } from '@/hooks';\n\n/**\n * Get the variable service and listen for variable changes to ensure re-rendering\n */\nexport function useAvailableNodeVariables(node: FlowNodeEntity) {\n  const refresh = useRefresh();\n  const variableService = useVariableService();\n\n  useEffect(() => {\n    const disposable = node\n      .getData(FlowNodeVariableData)\n      .public.available.onDataChange(() => startTransition(() => refresh()));\n    return () => {\n      disposable?.dispose();\n    };\n  }, []);\n\n  return variableService;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Skeleton } from '@coze-arch/bot-semi';\n\nimport styles from './placeholder.module.less';\n\nexport function Placeholder() {\n  return (\n    <Skeleton\n      className={styles.skeleton}\n      loading={true}\n      active={true}\n      placeholder={\n        <div className={styles.placeholder}>\n          <div className={styles.hd}>\n            <Skeleton.Avatar shape=\"square\" className={styles.avatar} />\n            <Skeleton.Title style={{ width: 141 }} />\n          </div>\n          <div className=\"flex flex-col items-start gap-3\">\n            <div className=\"flex flex-row items-center gap-2.5\">\n              <Skeleton.Title style={{ width: 85 }} />\n              <Skeleton.Title style={{ width: 241 }} />\n            </div>\n            <Skeleton.Title style={{ width: 220 }} />\n          </div>\n        </div>\n      }\n    />\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  type PropsWithChildren,\n  type ReactElement,\n  useMemo,\n} from 'react';\n\nimport { nanoid } from 'nanoid';\nimport classNames from 'classnames';\n\nimport s from './index.module.less';\n\nexport const PopupContainer: React.FC<\n  PropsWithChildren<{\n    className?: string;\n    containerName?: string;\n    containerClassName?: string;\n    containerStyle?: React.CSSProperties;\n  }>\n> = ({\n  className,\n  children,\n  containerName,\n  containerClassName,\n  containerStyle,\n}) => {\n  const _nanoid = useMemo(\n    () => `${containerName || 'popup_container'}_${nanoid()}`,\n    [containerName],\n  );\n  const _children = React.cloneElement(children as unknown as ReactElement, {\n    getPopupContainer: () => document.getElementById(_nanoid) as HTMLElement,\n  });\n  return (\n    <div className={classNames(s['popup-container'], className)}>\n      {_children}\n      <div\n        id={_nanoid}\n        style={containerStyle}\n        className={classNames([\n          'nowheel',\n          'popup-container-id',\n          containerClassName,\n        ])}\n      ></div>\n    </div>\n  );\n};\n\nexport default PopupContainer;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowNodeData } from '@coze-workflow/nodes';\nimport { type StandardNodeType } from '@coze-workflow/base';\nimport { PluginFrom } from '@coze-arch/bot-api/playground_api';\n\nimport { isApiNode, isSubWorkflowNode } from '@/services/node-version-service';\n\nexport const useNodeOrigin = (node: FlowNodeEntity) => {\n  const nodeData = node.getData<WorkflowNodeData>(WorkflowNodeData);\n  const isApi = useMemo(() => isApiNode(node), [node]);\n\n  /**\n   * Is it a reference node?\n   */\n  const isReference = useMemo(\n    () => isApi || isSubWorkflowNode(node),\n    [isApi, node],\n  );\n\n  /**\n   * Is it from the project?\n   * 1. Node has projectId\n   */\n  const isFromProject =\n    isReference &&\n    !!nodeData.getNodeData<StandardNodeType.SubWorkflow>().projectId;\n\n  /**\n   * Is it from the store?\n   * 1. Plugin Node\n   * 2. Nodes do not come from the project\n   * 3. There is a shelf status\n   */\n  const apiData = nodeData.getNodeData<StandardNodeType.Api>();\n  const isFromStore = isApi && !isFromProject && !!apiData.pluginProductStatus;\n  const isFromCozeCnStore =\n    isApi && !isFromProject && apiData.plugin_from === PluginFrom.FromSaas;\n\n  /**\n   * Is it from the resource library?\n   * 1. Nodes of reference type\n   * 2. Not from the project or store\n   */\n  const isFromLibrary = isReference && !isFromProject && !isFromStore;\n\n  return {\n    isApi,\n    isFromStore,\n    isFromLibrary,\n    isFromCozeCnStore,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Node source\n */\n\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozStore, IconCozTray } from '@coze-arch/coze-design/icons';\nimport { IconButton, Tooltip } from '@coze-arch/coze-design';\n\nimport { useNodeOrigin } from './use-node-origin';\n\ninterface ReferenceNodeOriginProps {\n  node: FlowNodeEntity;\n}\n\nexport const ReferenceNodeOrigin: React.FC<ReferenceNodeOriginProps> = ({\n  node,\n}) => {\n  const { isFromStore, isFromLibrary, isFromCozeCnStore } = useNodeOrigin(node);\n\n  if (isFromCozeCnStore) {\n    return (\n      <Tooltip\n        content={I18n.t('workflow_node_from_cn_store') || 'From coze.cn store'}\n      >\n        <IconButton icon={<IconCozStore />} size=\"mini\" color=\"secondary\" />\n      </Tooltip>\n    );\n  }\n\n  if (isFromStore) {\n    return (\n      <Tooltip content={I18n.t('workflow_node_from_store')}>\n        <IconButton icon={<IconCozStore />} size=\"mini\" color=\"secondary\" />\n      </Tooltip>\n    );\n  }\n\n  if (isFromLibrary) {\n    return (\n      <Tooltip content={I18n.t('workflow_version_origin_tooltips')}>\n        <IconButton icon={<IconCozTray />} size=\"mini\" color=\"secondary\" />\n      </Tooltip>\n    );\n  }\n\n  return null;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Modal } from '@coze-arch/coze-design';\n\nexport const checkUpdateVersionModel = (content: string) =>\n  new Promise<boolean>(resolve => {\n    Modal.confirm({\n      title: I18n.t('workflow_version_update_model_title'),\n      content,\n      okText: I18n.t('confirm'),\n      cancelText: I18n.t('cancel'),\n      onOk: () => {\n        resolve(true);\n      },\n      onCancel: () => resolve(false),\n    });\n  });\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozInfoCircle,\n  IconCozWarningCircleFill,\n} from '@coze-arch/coze-design/icons';\nimport { IconButton, Tooltip } from '@coze-arch/coze-design';\n\nimport css from './base-version.module.less';\n\ninterface BaseVersionInfoProps {\n  versionName?: string;\n}\n\nexport const BaseVersionInfo: React.FC<BaseVersionInfoProps> = ({\n  versionName,\n}) => (\n  <Tooltip content={versionName}>\n    <IconButton\n      icon={<IconCozInfoCircle />}\n      size=\"mini\"\n      color=\"secondary\"\n      wrapperClass={css['base-version-icon']}\n    />\n  </Tooltip>\n);\n\ninterface OutDatedVersionInfoProps {\n  versionName?: string;\n  onUpdate: () => void;\n}\n\nexport const OutDatedVersionInfo: React.FC<OutDatedVersionInfoProps> = ({\n  versionName,\n  onUpdate,\n}) => (\n  <Tooltip\n    content={\n      <>\n        {versionName}\n        <br />\n        {I18n.t('workflow_version_update_tag_tooltips')}\n      </>\n    }\n  >\n    <IconButton\n      icon={<IconCozWarningCircleFill className=\"coz-fg-hglt-yellow\" />}\n      onClick={onUpdate}\n      size=\"mini\"\n      color=\"secondary\"\n      wrapperClass={css['base-version-icon']}\n    />\n  </Tooltip>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useMemo, useState } from 'react';\n\nimport semver from 'semver';\nimport { I18n } from '@coze-arch/i18n';\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  getMySubWorkflowNodeVersion,\n  getSubWorkflowNode,\n  getApiNodeVersion,\n  getMyApiNodeVersion,\n} from '@/services/node-version-service';\nimport { useNodeVersionService } from '@/hooks/node-version';\nimport { useDependencyService, useGlobalState } from '@/hooks';\n\nimport { useNodeOrigin } from './use-node-origin';\nimport { checkUpdateVersionModel } from './check-update-version-model';\nimport { BaseVersionInfo, OutDatedVersionInfo } from './base-version';\n\ninterface VersionInfoProps {\n  node: FlowNodeEntity;\n  /** explicit version number */\n  versionName?: string;\n  latestVersionName?: string;\n  latestVersionTs?: string;\n  /** Is it already behind? */\n  isOutdated: boolean;\n}\nconst VersionInfo: React.FC<VersionInfoProps> = ({\n  node,\n  versionName,\n  latestVersionName,\n  latestVersionTs,\n  isOutdated,\n}) => {\n  const nodeVersionService = useNodeVersionService();\n  const globalState = useGlobalState();\n  const handleUpdateVersion = async () => {\n    const confirm = await checkUpdateVersionModel(\n      I18n.t('workflow_version_update_model_content', {\n        myVersion: versionName,\n        latestVersion: latestVersionName || latestVersionTs,\n      }),\n    );\n    if (confirm && latestVersionTs) {\n      await nodeVersionService.updateNodesVersion(node, latestVersionTs);\n    }\n  };\n\n  if (isOutdated && !globalState.readonly) {\n    return (\n      <OutDatedVersionInfo\n        versionName={versionName}\n        onUpdate={handleUpdateVersion}\n      />\n    );\n  }\n\n  return <BaseVersionInfo versionName={versionName} />;\n};\n\ninterface ReferenceNodeVersionProps {\n  node: FlowNodeEntity;\n}\n\nconst SubWorkflowVersion: React.FC<ReferenceNodeVersionProps> = ({ node }) => {\n  const myVersion = getMySubWorkflowNodeVersion(node);\n  const nodeData = getSubWorkflowNode(node);\n  const [latestVersion, setLatestVersion] = useState<string>(\n    nodeData?.latestVersion ?? '',\n  );\n  const dependencyService = useDependencyService();\n\n  useEffect(() => {\n    const disposable = dependencyService.onSubWrokflowVersionChange(props => {\n      if (props?.subWorkflowId !== nodeData?.workflow_id) {\n        return;\n      }\n      const curNodeData = getSubWorkflowNode(node);\n      setLatestVersion(curNodeData?.latestVersion ?? '');\n    });\n\n    return () => {\n      disposable?.dispose?.();\n    };\n  }, [node]);\n\n  const hasVersion = Boolean(\n    latestVersion &&\n      myVersion &&\n      semver.valid(latestVersion) &&\n      semver.valid(myVersion),\n  );\n\n  const isOutdated = useMemo(\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    () => hasVersion && semver.lt(myVersion!, latestVersion!),\n    [latestVersion, myVersion, hasVersion],\n  );\n\n  if (!hasVersion) {\n    return null;\n  }\n\n  return (\n    <VersionInfo\n      node={node}\n      versionName={myVersion}\n      latestVersionTs={latestVersion}\n      latestVersionName={latestVersion}\n      isOutdated={isOutdated}\n    />\n  );\n};\n\nconst ApiVersion: React.FC<ReferenceNodeVersionProps> = ({ node }) => {\n  const myVersionTs = getMyApiNodeVersion(node);\n  const {\n    versionName: myVersionName,\n    latestVersionTs,\n    latestVersionName,\n  } = getApiNodeVersion(node);\n\n  const hasVersion = Boolean(\n    latestVersionTs &&\n      myVersionTs &&\n      myVersionTs !== '0' &&\n      latestVersionTs !== '0',\n  );\n\n  const isOutdated = useMemo(\n    () => hasVersion && latestVersionTs !== myVersionTs,\n    [hasVersion, latestVersionTs, myVersionTs],\n  );\n\n  if (!hasVersion) {\n    return null;\n  }\n\n  return (\n    <VersionInfo\n      node={node}\n      versionName={myVersionName || myVersionTs}\n      latestVersionTs={latestVersionTs}\n      latestVersionName={latestVersionName}\n      isOutdated={isOutdated}\n    />\n  );\n};\n\nexport const ReferenceNodeVersion: React.FC<ReferenceNodeVersionProps> = ({\n  node,\n}) => {\n  const { isFromLibrary, isApi } = useNodeOrigin(node);\n\n  if (!isFromLibrary) {\n    return null;\n  }\n\n  return isApi ? (\n    <ApiVersion node={node} />\n  ) : (\n    <SubWorkflowVersion node={node} />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useMemo } from 'react';\n\nimport semver from 'semver';\nimport { toString } from 'lodash-es';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { useNodeVersionService } from '@/hooks/node-version';\nimport { useGlobalState } from '@/hooks';\n\nimport { checkUpdateVersionModel } from './check-update-version-model';\nimport { BaseVersionInfo, OutDatedVersionInfo } from './base-version';\n\ninterface ApiSkillVersionProps {\n  versionName?: string;\n  versionTs?: string;\n  latestVersionName?: string;\n  latestVersionTs?: string | number;\n  pluginId?: string;\n}\n\nexport const ApiSkillVersion: React.FC<ApiSkillVersionProps> = ({\n  versionName,\n  latestVersionName,\n  versionTs,\n  latestVersionTs: originLatestVersionTs,\n  pluginId,\n}) => {\n  const nodeVersionService = useNodeVersionService();\n  const globalState = useGlobalState();\n  const latestVersionTs = toString(originLatestVersionTs);\n  const hasVersion = Boolean(\n    pluginId &&\n      versionTs &&\n      latestVersionTs &&\n      versionTs !== '0' &&\n      latestVersionTs !== '0',\n  );\n\n  const isOutdated = useMemo(\n    () => hasVersion && latestVersionTs !== versionTs,\n    [versionTs, latestVersionTs, hasVersion],\n  );\n\n  const handleUpdate = async () => {\n    const confirm = await checkUpdateVersionModel(\n      I18n.t('workflow_version_update_model_content', {\n        myVersion: versionName,\n        latestVersion: latestVersionName,\n      }),\n    );\n    if (confirm && pluginId && latestVersionTs) {\n      await nodeVersionService.updateApiNodesVersion(pluginId, latestVersionTs);\n    }\n  };\n\n  if (!hasVersion) {\n    return null;\n  }\n\n  return isOutdated && !globalState.readonly ? (\n    <OutDatedVersionInfo versionName={versionName} onUpdate={handleUpdate} />\n  ) : (\n    <BaseVersionInfo versionName={versionName} />\n  );\n};\n\ninterface SubWorkflowSkillVersionProps {\n  versionName?: string;\n  latestVersionName?: string;\n  workflowId?: string;\n}\n\nexport const SubWorkflowSkillVersion: React.FC<\n  SubWorkflowSkillVersionProps\n> = ({ versionName, latestVersionName, workflowId }) => {\n  const nodeVersionService = useNodeVersionService();\n  const globalState = useGlobalState();\n  const hasVersion = Boolean(\n    workflowId &&\n      versionName &&\n      latestVersionName &&\n      semver.valid(latestVersionName) &&\n      semver.valid(versionName),\n  );\n\n  const isOutdated = useMemo(\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    () => hasVersion && semver.lt(versionName!, latestVersionName!),\n    [versionName, latestVersionName, hasVersion],\n  );\n\n  const handleUpdate = async () => {\n    const confirm = await checkUpdateVersionModel(\n      I18n.t('workflow_version_update_model_content', {\n        myVersion: versionName,\n        latestVersion: latestVersionName,\n      }),\n    );\n    if (confirm && workflowId && latestVersionName) {\n      await nodeVersionService.updateSubWorkflowNodesVersion(\n        workflowId,\n        latestVersionName,\n      );\n    }\n  };\n\n  if (!hasVersion) {\n    return null;\n  }\n\n  return isOutdated && !globalState.readonly ? (\n    <OutDatedVersionInfo versionName={versionName} onUpdate={handleUpdate} />\n  ) : (\n    <BaseVersionInfo versionName={versionName} />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport { nanoid } from 'nanoid';\nimport update from 'immutability-helper';\nimport { useUpdateEffect } from 'ahooks';\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nexport interface UseSortParams {\n  value: Array<any>;\n  onChange?: (val: Array<any>) => void;\n  /**\n   * Drag to start callback\n   */\n  onDragStart?: (startIndex: number) => void;\n  /**\n   * Drag and drop order to change callbacks\n   */\n  onDragMove?: (startIndex: number, endIndex: number) => void;\n  /**\n   * Drag end callback\n   */\n  onDragEnd?: (startIndex: number, endIndex: number) => void;\n}\n\nexport const useSort = (params: UseSortParams) => {\n  const { value = [], onChange, onDragStart, onDragMove, onDragEnd } = params;\n\n  // Add dragItemId to value\n  const [data, setData] = useState<\n    Array<{\n      value: any;\n      dragItemId: string;\n    }>\n  >(\n    value.map(item => ({\n      value: item,\n      dragItemId: nanoid(),\n    })),\n  );\n\n  useUpdateEffect(() => {\n    const valueWithDragId = value.map((item, index) => ({\n      value: item,\n      dragItemId: data[index]?.dragItemId || nanoid(),\n    }));\n\n    setData(valueWithDragId);\n  }, [value]);\n\n  const [draggingId, setDraggingId] = useState<string | undefined>('');\n\n  // Initialize a unique ID to distinguish between different drag and drop types\n  const [dragItemType] = useState(nanoid());\n\n  const isDragging = !!draggingId;\n\n  const handleDragStart = (startIndex: number) => {\n    setDraggingId(data[startIndex].dragItemId);\n\n    onDragStart?.(startIndex);\n  };\n\n  const handleDragMove = (startIndex: number, endIndex: number) => {\n    setData(prevData =>\n      update(prevData, {\n        $splice: [\n          [startIndex, 1],\n          [endIndex, 0, prevData[startIndex]],\n        ],\n      }),\n    );\n\n    onDragMove?.(startIndex, endIndex);\n  };\n\n  const handleDragEnd = (startIndex: number, endIndex: number) => {\n    setDraggingId(undefined);\n\n    if (startIndex !== endIndex) {\n      onChange?.(data.map(item => item.value));\n    }\n\n    onDragEnd?.(startIndex, endIndex);\n  };\n\n  return {\n    data,\n    isDragging,\n    draggingId,\n    onDragStart: handleDragStart,\n    onDragMove: handleDragMove,\n    onDragEnd: handleDragEnd,\n    dragItemType,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { getEmptyImage } from 'react-dnd-html5-backend';\nimport { useDrop, useDrag } from 'react-dnd';\nimport React, { useRef, type FC, useEffect } from 'react';\n\nimport type { Identifier } from 'dnd-core';\nimport classNames from 'classnames';\n\ninterface SortItemProps {\n  /**\n   * Type of Drag Element\n   */\n  type: string;\n  /**\n   * Order of Drag and Drop Elements\n   */\n  index: number;\n  /**\n   * Drag and drop the value of the element\n   */\n  value: any;\n  /**\n   * Drag to start callback\n   */\n  onDragStart?: (startIndex: number) => void;\n  /**\n   * Drag and drop order to change callbacks\n   */\n  onDragMove?: (startIndex: number, endIndex: number) => void;\n  /**\n   * Drag end callback\n   */\n  onDragEnd?: (startIndex: number, endIndex: number) => void;\n  children: FC<{\n    dragRef: React.RefObject<HTMLDivElement>;\n    isDragging: boolean;\n  }>;\n}\n\nexport const SortableItem = (props: SortItemProps) => {\n  const { children, type, onDragStart, onDragMove, onDragEnd, value, index } =\n    props;\n\n  const dragRef = useRef<HTMLDivElement>(null);\n\n  const [{ isDragging }, drag, preview] = useDrag(\n    () => ({\n      type,\n      item: () => {\n        onDragStart?.(index);\n        return {\n          type,\n          startIndex: index,\n          index,\n          value,\n        };\n      },\n      end: item => {\n        onDragEnd?.(item.startIndex, index);\n      },\n      collect: monitor => ({\n        isDragging: monitor.isDragging(),\n      }),\n    }),\n    [index, value, onDragStart, onDragEnd],\n  );\n\n  const [, drop] = useDrop<\n    {\n      index: number;\n      name: string;\n    },\n    // eslint-disable-next-line @typescript-eslint/no-invalid-void-type\n    void,\n    { handlerId: Identifier | null }\n  >(\n    () => ({\n      accept: type,\n      hover(item, monitor) {\n        if (!dragRef.current) {\n          return;\n        }\n        const dragIndex = item.index;\n        const hoverIndex = index;\n        if (dragIndex === hoverIndex) {\n          return;\n        } // If you go back to your own pit, then do nothing\n        onDragMove?.(dragIndex, hoverIndex); // Call the incoming method to complete the exchange\n        item.index = hoverIndex; // Assign the index of the current move to the box to the currently dragged box, otherwise two boxes will shake wildly!\n      },\n    }),\n    [index, onDragMove],\n  );\n\n  drag(dragRef);\n\n  // Hide native drag-and-drop preview styles and implement custom preview styles in custom-drag-layer\n  useEffect(() => {\n    preview(getEmptyImage(), { captureDraggingState: true });\n  }, [preview]);\n\n  return (\n    <div\n      ref={drop}\n      className={classNames({\n        ['opacity-0']: isDragging,\n        ['opacity-100']: !isDragging,\n      })}\n    >\n      {children({ dragRef, isDragging })}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useDragLayer } from 'react-dnd';\nimport { useRef, type FC } from 'react';\n\nimport { usePlayground } from '@flowgram-adapter/free-layout-editor';\n\nexport const CustomDragLayer: FC<{\n  type: string;\n  previewRender: (item, index) => React.ReactElement;\n}> = ({ type, previewRender }) => {\n  const layerRef = useRef<HTMLDivElement>(null);\n\n  const playground = usePlayground();\n\n  // Canvas scaling\n  const playgroundScale = playground.config.finalScale;\n\n  const { item, itemType, isDragging, initialOffset, currentOffset } =\n    useDragLayer(monitor => ({\n      item: monitor.getItem(),\n      itemType: monitor.getItemType(),\n      isDragging: monitor.isDragging(),\n      initialOffset: monitor.getInitialSourceClientOffset(),\n      currentOffset: monitor.getSourceClientOffset(),\n    }));\n\n  function renderItem() {\n    // Display only for the passed type, other drag and drop elements are not displayed\n    if (itemType === type) {\n      return previewRender(item.value, item.index);\n    }\n    return null;\n  }\n\n  // Zoom the drag-and-drop preview according to the canvas zoom ratio\n  function getItemStyles() {\n    if (!initialOffset || !currentOffset || !layerRef.current) {\n      return {\n        display: 'none',\n      };\n    }\n    const layerOffset = layerRef.current.getBoundingClientRect();\n\n    let { x, y } = currentOffset;\n\n    // In the new interaction of 2.0, setters are rendered in the right panel and are not affected by canvas scaling, so if it is 2.0, the scaling ratio defaults to 1.\n    const scale = 1;\n\n    x -= layerOffset.x;\n    y -= layerOffset.y;\n    const transform = `translate(${x / scale}px, ${y / scale}px)`;\n    return {\n      transform,\n      WebkitTransform: transform,\n    };\n  }\n\n  if (!isDragging) {\n    return null;\n  }\n\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        pointerEvents: 'none',\n        scale: playgroundScale,\n        zIndex: 100,\n        left: 0,\n        top: 0,\n        width: '100%',\n        height: '100%',\n      }}\n      ref={layerRef}\n    >\n      <div style={getItemStyles()}>{renderItem()}</div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport { useSort } from '../hooks/use-sort';\nimport { SortableItem } from './sortable-item';\nimport { CustomDragLayer } from './custom-drag-layer';\n\ninterface DragOption {\n  /**\n   * The ref that provides the ability to drag and drop can be bound to the corresponding element to drag and drop.\n   */\n  dragRef?: React.RefObject<HTMLDivElement>;\n  /**\n   * Is the current element being dragged?\n   */\n  isDragging?: boolean;\n  /**\n   * Whether the current element is in a drag-and-drop preview state\n   */\n  isPreview?: boolean;\n}\n\nexport interface DraggableListProps {\n  value: Array<any>;\n  onChange?: (v: Array<any>) => void;\n  renderItem: (\n    itemData: any,\n    index: number,\n    dragOption?: DragOption,\n  ) => React.ReactElement;\n  /**\n   * Drag to start callback\n   */\n  onDragStart?: (startIndex: number) => void;\n  /**\n   * Drag and drop order to change callbacks\n   */\n  onDragMove?: (startIndex: number, endIndex: number) => void;\n  /**\n   * Drag end callback\n   */\n  onDragEnd?: (startIndex: number, endIndex: number) => void;\n\n  className?: string;\n}\n\nexport const SortableList = (props: DraggableListProps) => {\n  const { renderItem, className = 'flex flex-col space-y-2 mt-2' } = props;\n  const { onDragEnd, onDragMove, onDragStart, data, dragItemType } =\n    useSort(props);\n\n  const previewRender = (item, index) =>\n    renderItem(item, index, { isPreview: true });\n\n  return (\n    <div className={className}>\n      {data.map((item, index) => (\n        <SortableItem\n          key={item.dragItemId}\n          value={item.value}\n          index={index}\n          type={dragItemType}\n          onDragStart={onDragStart}\n          onDragMove={onDragMove}\n          onDragEnd={onDragEnd}\n        >\n          {dragOption => renderItem(item.value, index, dragOption)}\n        </SortableItem>\n      ))}\n\n      <CustomDragLayer type={dragItemType} previewRender={previewRender} />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { forwardRef, type Ref } from 'react';\n\nimport classnames from 'classnames';\nimport { type WithCustomStyle } from '@coze-workflow/base/types';\nimport { IconHandle } from '@douyinfe/semi-icons';\n\nexport const DragHandle = forwardRef<\n  HTMLElement,\n  WithCustomStyle<{\n    testId?: string;\n  }>\n>(({ className, style, testId }, ref) => (\n  <IconHandle\n    ref={ref as Ref<HTMLSpanElement>}\n    data-disable-node-drag\n    className={classnames(\n      'cursor-move text-[var(--semi-color-text-3)]',\n      className,\n    )}\n    style={style}\n    data-testid={testId}\n  />\n));\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// TagList.tsx\nimport React, { useState } from 'react';\n\nimport copy from 'copy-to-clipboard';\nimport { I18n } from '@coze-arch/i18n';\nimport { Tooltip, Toast } from '@coze-arch/coze-design';\nimport { UITag } from '@coze-arch/bot-semi';\nimport { IconChevronDown } from '@coze-arch/bot-icons';\n\nimport styles from './index.module.less';\n\ninterface TagListProps {\n  className?: string;\n  tags: string[];\n  max: number;\n}\n\nexport const TagList: React.FC<TagListProps> = ({\n  className = '',\n  tags,\n  max,\n}) => {\n  const [expanded, setExpanded] = useState(false);\n  const showMoreCount = tags.length > max && !expanded;\n  const tagsNeedShow = expanded ? tags : tags.slice(0, max);\n  const restTags = tags.length - max;\n\n  return (\n    <div className={`${styles.container} ${className}`}>\n      {tagsNeedShow.map((tag, idx) => (\n        <Tooltip content={I18n.t('database_240522_01')}>\n          <UITag\n            onClick={() => {\n              copy(tag);\n              Toast.success(I18n.t('database_240522_02'));\n            }}\n            key={idx}\n          >\n            {tag}\n          </UITag>\n        </Tooltip>\n      ))}\n      {showMoreCount ? (\n        <UITag onClick={() => setExpanded(true)}>+{restTags}</UITag>\n      ) : null}\n      {expanded ? (\n        <UITag onClick={() => setExpanded(false)}>\n          <IconChevronDown rotate={180} />\n        </UITag>\n      ) : null}\n    </div>\n  );\n};\n\nexport default TagList;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useMemo } from 'react';\n\nimport cls from 'classnames';\nimport { useGlobalVariableServiceState } from '@coze-workflow/variable';\nimport { VARIABLE_TYPE_ALIAS_MAP } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozEmpty } from '@coze-arch/coze-design/icons';\nimport { Select, Tag, Typography } from '@coze-arch/coze-design';\n\nimport { type Variable, type VariablesPanelProps } from '../types';\nimport styles from '../index.module.less';\nimport useRelatedVariable from './use-related-variable';\n\ninterface OptionProps extends Variable {\n  checked?: boolean;\n  onSelect?: (v?: string) => void;\n}\n\nconst OptionItem = (option: OptionProps) => (\n  <Select.Option\n    selected={option.checked}\n    key={`${option.value}-${option.disabled}`}\n    value={option.value}\n    disabled={option.disabled}\n    className={styles['variable-panel-option']}\n    onSelect={v => option.onSelect?.(v?.value)}\n  >\n    <div\n      style={{\n        maxWidth: '100%',\n      }}\n      className={\n        'flex items-center justify-between pl-32px pr-8px pt-2px pb-2px'\n      }\n    >\n      <Typography.Text\n        className={cls('flex-1 leading-20px', {\n          [styles['variable-option-checked']]: option.checked,\n        })}\n        disabled={option.disabled}\n        ellipsis={{ showTooltip: true }}\n        style={{\n          fontSize: 12,\n          marginRight: 4,\n        }}\n      >\n        {option.name}\n      </Typography.Text>\n\n      <Tag disabled={option.disabled} size=\"mini\" color=\"primary\">\n        {VARIABLE_TYPE_ALIAS_MAP[option.type]}\n      </Tag>\n    </div>\n  </Select.Option>\n);\n\ninterface EmptyProps {\n  className?: string;\n}\n\nexport const EmptyVariableContent = ({ className }: EmptyProps) => {\n  const { type } = useGlobalVariableServiceState();\n  const isSelectedBotOrProject = Boolean(type);\n\n  return useMemo(() => {\n    const getEmptyMsg = () => {\n      if (isSelectedBotOrProject) {\n        return I18n.t(\n          'variable_binding_there_are_no_variables_in_this_project',\n        );\n      }\n\n      return I18n.t('variable_select_empty_library_tips');\n    };\n\n    return (\n      <div className={cls(className, styles['empty-block'])}>\n        <IconCozEmpty\n          style={{ fontSize: '32px', color: 'rgba(52, 60, 87, 0.72)' }}\n        />\n        <span className={styles.text}>{getEmptyMsg()}</span>\n      </div>\n    );\n  }, [isSelectedBotOrProject]);\n};\n\nexport default function VariablePanel({\n  onVariableSelect,\n  variableValue,\n  variablePanelStyle,\n  variablesFormatter,\n}: VariablesPanelProps) {\n  const { globalVariables } = useRelatedVariable({ variablesFormatter });\n\n  return (\n    <>\n      {globalVariables.length > 0 && (\n        <div\n          className={\n            'coz-fg-secondary mt-8px mb-4px pl-28px text-[12px] font-medium leading-16px'\n          }\n        >\n          {I18n.t(\n            'variable_binding_please_select_a_variable',\n            {},\n            '',\n          )}\n        </div>\n      )}\n\n      <div className={'h-[292px] overflow-y-auto'} style={variablePanelStyle}>\n        {globalVariables.map(e => (\n          <OptionItem\n            {...e}\n            onSelect={onVariableSelect}\n            checked={variableValue === e.value}\n          />\n        ))}\n\n        {globalVariables.length <= 0 && <EmptyVariableContent />}\n      </div>\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport { isGlobalVariableKey } from '@coze-workflow/variable';\n\nimport { useNodeAvailableVariablesWithNode } from '@/form-extensions/hooks';\n\nimport { type RelatedVariablesHookProps } from '../types';\n\nexport default function useRelatedVariable({\n  variablesFormatter = v => v,\n}: RelatedVariablesHookProps) {\n  const availableVariables = useNodeAvailableVariablesWithNode();\n\n  const globalVariables = useMemo(\n    () =>\n      variablesFormatter(\n        availableVariables.filter(\n          item => item.nodeId && isGlobalVariableKey(item.nodeId),\n        ),\n      ),\n    [availableVariables, variablesFormatter],\n  );\n\n  return {\n    globalVariables,\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport cls from 'classnames';\nimport { IntelligenceType } from '@coze-arch/idl/intelligence_api';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozArrowRight,\n  IconCozCheckMarkFill,\n} from '@coze-arch/coze-design/icons';\nimport { Avatar, Tag, Typography } from '@coze-arch/coze-design';\nimport { useHover } from '@coze-arch/hooks';\n\nimport type { IBotSelectOption } from '@/components/bot-project-select/types';\n\ninterface OptionItemProps extends IBotSelectOption {\n  checked?: boolean;\n  disabled?: boolean;\n}\n\nexport default function OptionItem({\n  disabled,\n  checked,\n  avatar,\n  name,\n  type,\n}: OptionItemProps) {\n  const [ref, isHover] = useHover<HTMLDivElement>();\n\n  const renderOperate = () => {\n    if (isHover && !disabled) {\n      return (\n        <div className={'flex items-center coz-fg-secondary flex-shrink-0'}>\n          <span className={'text-[12px]'}>\n            {I18n.t('variable_binding_continue', {}, '')}\n          </span>\n          <IconCozArrowRight className=\"text-[12px] ml-2px\" />\n        </div>\n      );\n    }\n\n    return type === IntelligenceType.Project ? (\n      <Tag size=\"mini\" color=\"primary\" className={'flex-shrink-0'}>\n        {I18n.t('wf_chatflow_106')}\n      </Tag>\n    ) : (\n      <Tag size=\"mini\" color=\"primary\" className={'flex-shrink-0'}>\n        {I18n.t('wf_chatflow_107')}\n      </Tag>\n    );\n  };\n\n  return (\n    <div\n      ref={ref}\n      className={cls('flex w-full items-center pl-8px pr-8px pt-2px pb-2px')}\n    >\n      {checked ? (\n        <IconCozCheckMarkFill className=\"text-[16px] mr-8px coz-fg-hglt flex-shrink-0\" />\n      ) : (\n        <div className={'w-16px h-16px mr-8px flex-shrink-0'} />\n      )}\n\n      <Avatar\n        style={{ flexShrink: 0, marginRight: 8, width: 16, height: 16 }}\n        shape=\"square\"\n        src={avatar}\n      />\n      <div\n        className=\"flex\"\n        style={{ flexGrow: 1, flexShrink: 1, overflow: 'hidden' }}\n      >\n        <Typography.Text\n          ellipsis={{ showTooltip: true }}\n          style={{\n            fontSize: 12,\n            color: '#1D1C23',\n            fontWeight: 400,\n          }}\n        >\n          {name}\n        </Typography.Text>\n      </div>\n\n      {renderOperate()}\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozEmpty } from '@coze-arch/coze-design/icons';\n\nimport s from '../index.module.less';\n\nexport default function EmptyContent() {\n  return (\n    <div className={s['empty-block']}>\n      <IconCozEmpty\n        style={{ fontSize: '32px', color: 'rgba(52, 60, 87, 0.72)' }}\n      />\n      <span className={s.text}>\n        {I18n.t(\n          'variable_binding_there_are_no_variables_in_this_project',\n          {},\n          '',\n        )}\n      </span>\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport cls from 'classnames';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { GlobalVariableService } from '@coze-workflow/variable';\nimport { IntelligenceType } from '@coze-arch/idl/intelligence_api';\nimport { I18n } from '@coze-arch/i18n';\nimport { Tooltip } from '@coze-arch/coze-design';\n\nimport { useRelatedBotService } from '@/hooks';\n\nimport { type RelatedEntitiesProps } from '../types';\nimport s from '../index.module.less';\nimport { isItemDisabled } from '../../utils';\nimport type { IBotSelectOption, DisableExtraOptions } from '../../types';\nimport { RenderFootLoading } from '../../bots';\nimport OptionItem from './option-item';\nimport EmptyContent from './empty-content';\n\ninterface Options extends DisableExtraOptions {\n  onClick: () => void;\n  checkedValue?: string;\n}\n\nconst renderCustomOption = (\n  item: IBotSelectOption | undefined,\n  extraOptions: Options,\n) => {\n  if (!item) {\n    return null;\n  }\n\n  const {\n    disableBot,\n    disableProject,\n    disableBotTooltip,\n    disableProjectTooltip,\n    onClick,\n    checkedValue,\n  } = extraOptions;\n\n  const isBot = item.type === IntelligenceType.Bot;\n  const disabled = isItemDisabled({ disableBot, disableProject }, item.type);\n\n  const disabledTooltip =\n    isBot && disableBot ? disableBotTooltip : disableProjectTooltip;\n\n  const handleClick = () => {\n    if (disabled) {\n      return;\n    }\n\n    onClick?.();\n  };\n\n  return (\n    <div\n      onClick={handleClick}\n      className={cls(s['related-entities-option'], {\n        [s['related-entities-option-disabled']]: disabled,\n        [s['related-entities-option-selected']]: checkedValue === item.value,\n      })}\n    >\n      {disabled ? (\n        <Tooltip\n          keepDOM={true}\n          content={disabledTooltip}\n          position=\"left\"\n          className={'w-full'}\n        >\n          <div className={'w-full'}>\n            <OptionItem\n              {...item}\n              disabled={disabled}\n              checked={checkedValue === item.value}\n            />\n          </div>\n        </Tooltip>\n      ) : (\n        <OptionItem\n          {...item}\n          disabled={disabled}\n          checked={checkedValue === item.value}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default function Panel({\n  relatedEntities = [],\n  relatedEntityValue,\n  disableProjectTooltip,\n  disableProject,\n  disableBotTooltip,\n  disableBot,\n  isLoadMore,\n  onLoadMore,\n  onRelatedSelect,\n  relatedBotPanelStyle,\n}: RelatedEntitiesProps) {\n  const relatedBotService = useRelatedBotService();\n\n  const globalVariableService = useService<GlobalVariableService>(\n    GlobalVariableService,\n  );\n\n  return (\n    <>\n      {relatedEntities && relatedEntities?.length > 0 ? (\n        <div\n          className={\n            'coz-fg-secondary mt-8px mb-4px pl-28px text-[12px] font-medium leading-16px'\n          }\n        >\n          {I18n.t(\n            'variable_binding_please_bind_an_agent_or_app_first',\n            {},\n            '',\n          )}\n        </div>\n      ) : null}\n\n      <div className={'h-[292px] overflow-y-auto'} style={relatedBotPanelStyle}>\n        {relatedEntities?.map(item =>\n          renderCustomOption(item, {\n            disableProjectTooltip,\n            disableProject,\n            disableBotTooltip,\n            disableBot,\n            onClick: () => {\n              relatedBotService.updateRelatedBot({\n                id: item.value,\n                type: item.type === IntelligenceType.Bot ? 'bot' : 'project',\n              });\n\n              globalVariableService.loadGlobalVariables(\n                item.type === 1 ? 'bot' : 'project',\n                item.value,\n              );\n\n              onRelatedSelect?.(item);\n            },\n            checkedValue: relatedEntityValue?.id,\n          }),\n        )}\n\n        {isLoadMore ? (\n          <div className={s['bot-foot-loading']}>\n            <RenderFootLoading onObserver={onLoadMore} />\n          </div>\n        ) : null}\n\n        {!relatedEntities || relatedEntities?.length <= 0 ? (\n          <EmptyContent />\n        ) : null}\n      </div>\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback, useRef, useState } from 'react';\n\nimport cls from 'classnames';\nimport { IntelligenceType } from '@coze-arch/idl/intelligence_api';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozMagnifier } from '@coze-arch/coze-design/icons';\nimport { Avatar, Select } from '@coze-arch/coze-design';\nimport { type Select as SemiSelect } from '@coze-arch/bot-semi';\n\nimport { useRelatedBotService } from '@/hooks';\n\nimport VariablePanel from './variable-panel/variable-panel';\nimport { type BotProjectVariableSelectProps, type RelatedValue } from './types';\nimport useRelated from './related-bot-panel/use-related';\nimport RelatedBotPanel from './related-bot-panel/panel';\n\nconst formatRelatedBotValue = (value?: {\n  id: string;\n  type: 'bot' | 'project';\n}): RelatedValue | undefined => {\n  if (!value) {\n    return value;\n  }\n\n  return {\n    id: value.id,\n    type:\n      value.type === 'bot' ? IntelligenceType.Bot : IntelligenceType.Project,\n  };\n};\n\nexport default function BotProjectVariableSelect({\n  className,\n  variablesFormatter,\n  relatedEntityValue: relatedEntityValueFromProps,\n  disableBot,\n  disableProject,\n  disableBotTooltip,\n  disableProjectTooltip,\n  onVariableSelect,\n  variableValue,\n  variablePanelStyle,\n  relatedBotPanelStyle,\n  customVariablePanel,\n}: BotProjectVariableSelectProps) {\n  const selectRef = useRef<SemiSelect | null>(null);\n  const relatedBotService = useRelatedBotService();\n  const getRelatedEntityValue = () =>\n    relatedEntityValueFromProps ||\n    formatRelatedBotValue(relatedBotService.getRelatedBotValue());\n  const relatedEntityValue = getRelatedEntityValue();\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  const [showBotPanel, setShowBotPanel] = useState(!relatedEntityValue?.id);\n\n  const {\n    relatedEntities,\n    onRelatedEntitiesSearch,\n    isLoadMore,\n    loadMoreRelatedEntities,\n  } = useRelated({\n    relatedEntityValue,\n  });\n\n  const handleFocus = useCallback(() => {\n    setTimeout(() => {\n      setShowBotPanel(true);\n    }, 100);\n  }, []);\n\n  const handleBlur = useCallback(() => {\n    selectRef.current?.clearInput?.();\n    selectRef.current?.close?.();\n\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n    }\n\n    timeoutRef.current = setTimeout(() => {\n      setShowBotPanel(!getRelatedEntityValue()?.id);\n    }, 300);\n  }, []);\n\n  return (\n    <div className={cls(className, 'w-full flex flex-col p-4px')}>\n      <Select\n        autoClearSearchValue={true}\n        ref={selectRef}\n        filter\n        inputProps={{\n          onBlur: handleBlur,\n          onFocusCapture: handleFocus,\n        }}\n        value={relatedEntityValue?.id}\n        className={'w-full'}\n        size={'small'}\n        placeholder={I18n.t(\n          'variable_binding_search_project',\n          {},\n          '/',\n        )}\n        optionList={[]}\n        onSearch={onRelatedEntitiesSearch}\n        emptyContent={null}\n        prefix={\n          <IconCozMagnifier className={'text-[16px] ml-8px coz-fg-secondary'} />\n        }\n        showArrow={false}\n        renderSelectedItem={() => {\n          const item = relatedEntities.find(\n            e => e.value === relatedEntityValue?.id,\n          );\n          if (item) {\n            return (\n              <div className={'flex items-center'}>\n                <Avatar\n                  className={'w-16px h-16px mr-8px'}\n                  shape=\"square\"\n                  src={item.avatar}\n                />\n                <span className={'text-[12px]'}>{item.name}</span>\n              </div>\n            );\n          }\n          return null;\n        }}\n      />\n\n      <div className={'w-full coz-fg-primary'}>\n        {showBotPanel ? (\n          <RelatedBotPanel\n            relatedBotPanelStyle={relatedBotPanelStyle}\n            relatedEntityValue={relatedEntityValue}\n            relatedEntities={relatedEntities}\n            onLoadMore={loadMoreRelatedEntities}\n            isLoadMore={isLoadMore}\n            disableBot={disableBot}\n            disableProject={disableProject}\n            disableBotTooltip={disableBotTooltip}\n            disableProjectTooltip={disableProjectTooltip}\n            onRelatedSelect={() => {\n              setShowBotPanel(false);\n            }}\n          />\n        ) : (\n          customVariablePanel || (\n            <VariablePanel\n              variablePanelStyle={variablePanelStyle}\n              variableValue={variableValue}\n              onVariableSelect={onVariableSelect}\n              variablesFormatter={variablesFormatter}\n            />\n          )\n        )}\n      </div>\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\n\nimport { debounce } from 'lodash-es';\nimport { PUBLIC_SPACE_ID } from '@coze-workflow/base';\nimport {\n  type DraftIntelligenceListData,\n  IntelligenceStatus,\n  IntelligenceType,\n} from '@coze-arch/idl/intelligence_api';\nimport { intelligenceApi } from '@coze-arch/bot-api';\n\nimport { useGlobalState } from '@/hooks';\n\nimport { type RelatedEntitiesHookProps } from '../types';\nimport { useExtraBotOption } from '../../use-extra-bot-option';\nimport { type IBotSelectOption, type IBotSelectOptions } from '../../types';\nimport useQueryBotList from './use-query-bot-list';\n\nexport default function useRelated({\n  relatedEntityValue,\n}: RelatedEntitiesHookProps) {\n  const [baseRelatedEntities, setBaseRelatedEntities] = useState<\n    IBotSelectOption[]\n  >([]);\n  const [nextCursorId, setNextCursorId] = useState<string | undefined>();\n  const [search, setSearch] = useState<string>('');\n  const [isLoadMore, setIsLoadMore] = useState<boolean>(false);\n  const isLoadMoreDate = useRef(false);\n\n  const { spaceId, personalSpaceId } = useGlobalState();\n\n  const querySpaceId = spaceId === PUBLIC_SPACE_ID ? personalSpaceId : spaceId;\n\n  const defaultBotData = useQueryBotList({\n    spaceId: querySpaceId,\n  });\n\n  const fetchCallback = (\n    fetchBotData?: DraftIntelligenceListData,\n    isReset = false,\n  ) => {\n    const { intelligences, total = 0, next_cursor_id } = fetchBotData ?? {};\n\n    const list: IBotSelectOptions = (intelligences ?? []).map(it => ({\n      name: it.basic_info?.name ?? '',\n      value: it.basic_info?.id ?? '',\n      avatar: it.basic_info?.icon_url ?? '',\n      type: it.type || IntelligenceType.Bot,\n    }));\n\n    const totalList = isReset ? list : [...baseRelatedEntities, ...list];\n\n    setNextCursorId(next_cursor_id);\n    setBaseRelatedEntities(totalList);\n\n    setIsLoadMore(totalList.length < total);\n  };\n\n  const fetchBotList = async (query?: string, isReset = false) => {\n    const res = await intelligenceApi.GetDraftIntelligenceList({\n      space_id: querySpaceId,\n      name: query ?? search,\n      types: [IntelligenceType.Bot, IntelligenceType.Project],\n      size: 30,\n      order_by: 0,\n      cursor_id: nextCursorId,\n      status: [\n        IntelligenceStatus.Using,\n        IntelligenceStatus.Banned,\n        IntelligenceStatus.MoveFailed,\n      ],\n    });\n\n    fetchCallback(res?.data, isReset);\n  };\n\n  const onRelatedEntitiesSearch = useCallback((query: string) => {\n    setSearch(query);\n    setNextCursorId(undefined);\n    fetchBotList(query, true);\n  }, []);\n\n  const loadMore = async () => {\n    if (isLoadMoreDate.current) {\n      return;\n    }\n    isLoadMoreDate.current = true;\n    await fetchBotList();\n    isLoadMoreDate.current = false;\n  };\n\n  useEffect(() => {\n    fetchCallback(defaultBotData, true);\n  }, [defaultBotData]);\n\n  const isBot = relatedEntityValue?.type === IntelligenceType.Bot;\n\n  // Due to paging restrictions, the selected botId may not find the corresponding option and needs to be added\n  const extraBotOption = useExtraBotOption(\n    baseRelatedEntities,\n    relatedEntityValue?.id,\n    isBot,\n  );\n\n  const relatedEntities = useMemo<IBotSelectOption[]>(\n    () => [extraBotOption, ...baseRelatedEntities].filter(e => !!e),\n    [extraBotOption, baseRelatedEntities],\n  );\n\n  return {\n    relatedEntities,\n    onRelatedEntitiesSearch: debounce(onRelatedEntitiesSearch, 300),\n    loadMoreRelatedEntities: loadMore,\n    isLoadMore,\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useQuery } from '@tanstack/react-query';\nimport {\n  IntelligenceStatus,\n  IntelligenceType,\n} from '@coze-arch/idl/intelligence_api';\nimport { intelligenceApi } from '@coze-arch/bot-api';\n\ninterface QueryProps {\n  spaceId: string;\n}\n\nexport default function useQueryBotList({ spaceId }: QueryProps) {\n  const { data } = useQuery({\n    queryKey: ['related-bot-panel', 'GetDraftIntelligenceList', spaceId],\n    queryFn: async () => {\n      const res = await intelligenceApi.GetDraftIntelligenceList({\n        space_id: spaceId,\n        name: '',\n        types: [IntelligenceType.Bot, IntelligenceType.Project],\n        size: 30,\n        order_by: 0,\n        cursor_id: undefined,\n        status: [\n          IntelligenceStatus.Using,\n          IntelligenceStatus.Banned,\n          IntelligenceStatus.MoveFailed,\n        ],\n      });\n\n      return res?.data ?? {};\n    },\n    retry: false,\n  });\n\n  return data;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport { useNeedBot } from '@/components/test-run/hooks/use-need-bot';\nimport { useGetStartNode } from '@/components/test-run/hooks/use-get-start-node';\nimport { TestFormType } from '@/components/test-run/constants';\nimport {\n  BotProjectVariableSelect as BaseSelect,\n  type BotProjectVariableSelectProps,\n} from '@/components/bot-project-select/bot-project-variable-select';\n\nexport default function BotProjectVariableSelect(\n  props: BotProjectVariableSelectProps,\n) {\n  const [options, setOptions] = useState({});\n  const { queryNeedBot } = useNeedBot();\n  const { getNode } = useGetStartNode();\n  const startNode = getNode();\n  const testFormType = TestFormType.Default;\n  useEffect(() => {\n    const initOptions = async () => {\n      if (startNode) {\n        const isNeedBotEnv = await queryNeedBot(testFormType, startNode);\n        const { hasLTMNode, hasConversationNode } = isNeedBotEnv;\n\n        // Session class nodes, subflows (Chatflow) cannot select Bot because Bot does not support multi-session\n        // The LTM node cannot select Project because Project does not yet have LTM capabilities\n        const needDisableBot = hasConversationNode;\n        const botDisableOptions = {\n          disableBot: needDisableBot,\n          disableBotTooltip: needDisableBot ? I18n.t('wf_chatflow_141') : '',\n          disableProject: hasLTMNode,\n          disableProjectTooltip: hasLTMNode ? I18n.t('wf_chatflow_142') : '',\n        };\n        setOptions(botDisableOptions);\n      }\n    };\n    initOptions();\n  }, []);\n\n  return <BaseSelect {...props} {...options} />;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/*******************************************************************************\n * Test form correlation constants\n */\nimport get from 'lodash-es/get';\nimport { FILE_TYPES, ViewVariableType } from '@coze-workflow/base';\nimport { TimeCapsuleMode } from '@coze-arch/idl/playground_api';\nimport { IntelligenceType } from '@coze-arch/idl/intelligence_api';\nimport { I18n } from '@coze-arch/i18n';\nimport { PlaygroundApi } from '@coze-arch/bot-api';\n\nimport { getAccept } from '@/hooks/use-upload';\nimport { type ValueType } from '@/components/bot-project-select/types';\n\nimport { genFileTypeByViewVarType } from '../utils/common';\nimport { type TestFormField } from '../types';\n\n/** The agreed key for testset */\nexport { TESTSET_BOT_NAME } from '@coze-workflow/test-run/constants';\n\n/** Engage the dialogue key for testset */\nexport const TESTSET_CHAT_NAME = '_WORKFLOW_VARIABLE_NODE_CHAT_ID';\n\n/** Test form type */\nexport enum TestFormType {\n  /** in full operation */\n  Default,\n  /** single node operation */\n  Single,\n}\n\n/** Sources of data used for test runs */\nexport enum TestRunDataSource {\n  Aigc = 'aigc',\n  Testset = 'testset',\n  User = 'user',\n}\n\n/** Fixed field name */\nexport enum FieldName {\n  Node = '_node',\n  Batch = '_batch',\n  Input = '_input',\n  Bot = '_bot',\n  Chat = '_chat',\n  Datasets = '_datasets',\n  DatasetsIs = '_datasets_is',\n  DatasetsName = '_datasets_name',\n  DatasetsDescription = '_datasets_description',\n  Setting = '_setting',\n  JSON = '_json',\n}\n\n/** Basic template for fields */\nexport const DEFAULT_FIELD_TEMPLATE = {\n  required: true,\n  decorator: {\n    type: 'FormItem',\n  },\n};\n\n/** Node basic template */\nexport const NODE_FIELD_TEMPLATE = {\n  type: 'FormObject',\n  name: FieldName.Node,\n  component: {\n    type: 'FieldGroup',\n  },\n};\n\nexport const SETTING_FIELD_TEMPLATE = {\n  type: 'FormObject',\n  name: FieldName.Setting,\n  component: {\n    type: 'div',\n  },\n};\n\n/** batch template */\nexport const BATCH_FIELD_TEMPLATE = {\n  type: 'FormObject',\n  name: FieldName.Batch,\n  component: {\n    type: 'div',\n  },\n};\n\n/** input template */\nexport const INPUT_FIELD_TEMPLATE = {\n  type: 'FormObject',\n  name: FieldName.Input,\n  component: {\n    type: 'div',\n  },\n};\n\n/** The template for the entire JSON input */\nexport const INPUT_JSON_FIELD_TEMPLATE = {\n  type: 'FormObject',\n  name: FieldName.JSON,\n};\n\nexport const getConversationTemplate = chatFlowService => {\n  const conversationDefaultVisible =\n    chatFlowService?.selectItem?.type === IntelligenceType.Project;\n  return {\n    type: 'FormString',\n    name: FieldName.Chat,\n    required: true,\n    title: I18n.t('wf_chatflow_74'),\n    component: {\n      type: 'ConversationSelect',\n      props: {\n        // Pass in the projectId of the bot component (the scene where the selection is bot is not displayed)\n        projectId: `{{$parent.children?.find(item => item.type?.name === \"${FieldName.Bot}\")?.value}}`,\n      },\n    },\n    decorator: {\n      type: 'FormItem',\n      props: {\n        tooltip: I18n.t('wf_chatflow_154'),\n      },\n    },\n    // When the bot/project is not selected, the conversation will not be displayed\n    // The initialization setting is false, and the rest of the echo logic is in packages/workflow/playground/src/components/test-run/test-form-sheet-v2/form-v2.tsx\n    visible: conversationDefaultVisible,\n    validator: [\n      {\n        triggerType: 'onBlur',\n        required: true,\n        message: I18n.t('workflow_testset_required_tip', {\n          param_name: 'Conversation',\n        }),\n      },\n      {\n        triggerType: 'onBlur',\n        validator: (value: string) => {\n          if (!value) {\n            return false;\n          }\n          return true;\n        },\n      },\n    ],\n  };\n};\n\nexport const getBotFieldTemplate = (isNeedBotEnv, showBot, chatflowService) => {\n  const { hasLTMNode = false } = isNeedBotEnv || {};\n  /** Select the template for the bot */\n  const BOT_FIELD_TEMPLATE = {\n    type: 'FormVoid',\n    title: I18n.t('wf_chatflow_72'),\n    name: FieldName.Bot,\n    component: {\n      type: 'FieldGroup',\n    },\n    children: showBot\n      ? [\n          {\n            type: 'FormObject',\n            name: FieldName.Bot,\n            required: true,\n            title: I18n.t('wf_chatflow_72'),\n            component: {\n              type: 'BotProjectSelect',\n            },\n            decorator: {\n              type: 'FormItem',\n            },\n            validator: [\n              {\n                triggerType: 'onBlur',\n                required: true,\n                message: I18n.t('workflow_testset_required_tip', {\n                  param_name: 'Bot',\n                }),\n              },\n              {\n                triggerType: 'onBlur',\n                validator: async (\n                  value?:\n                    | {\n                        id?: string;\n                        type?: IntelligenceType;\n                      }\n                    | string,\n                ) => {\n                  const validateValue = (value as ValueType)?.id;\n                  const isProject =\n                    chatflowService?.selectItem?.type ===\n                      IntelligenceType.Project ||\n                    (value as ValueType)?.type === IntelligenceType.Project;\n                  // Only the agent supports onBlur logic, not the project scenario\n                  if (isProject) {\n                    return true;\n                  }\n                  if (!validateValue) {\n                    return true;\n                  }\n                  const botInfo = await PlaygroundApi.GetDraftBotInfoAgw({\n                    bot_id: validateValue,\n                  });\n                  const timeCapsuleMode = get(\n                    botInfo,\n                    [\n                      'data',\n                      'bot_info',\n                      'bot_tag_info',\n                      'time_capsule_info',\n                      'time_capsule_mode',\n                    ],\n                    TimeCapsuleMode.Off,\n                  );\n                  const ltmEnabled = timeCapsuleMode === TimeCapsuleMode.On;\n                  if (hasLTMNode && !ltmEnabled) {\n                    return 'This Bot does not have LTM enabled.';\n                  }\n                  return true;\n                },\n              },\n            ],\n          },\n        ]\n      : [],\n  };\n\n  return BOT_FIELD_TEMPLATE;\n};\n\n/** Save template to datasets */\nexport const DATASETS_FIELD_TEMPLATE = {\n  type: 'FormObject',\n  name: FieldName.Datasets,\n  component: {\n    type: 'div',\n  },\n  children: [\n    {\n      type: 'FormString',\n      name: FieldName.DatasetsIs,\n      component: {\n        type: 'Checkbox',\n        props: {\n          title: I18n.t('workflow_debug_data_save'),\n        },\n      },\n      decorator: {\n        type: 'FormItem',\n      },\n    },\n    // {\n    //   type: 'FormString',\n    //   name: FieldName.DatasetsName,\n    //   title: I18n.t('workflow_testset_name'),\n    //   component: {\n    //     type: 'TestsetNameInput',\n    //     props: {\n    //       maxLength: 50,\n    //     },\n    //   },\n    //   hidden: `{{ !$values?.${FieldName.Datasets}?.${FieldName.DatasetsIs} }}`,\n    //   required: true,\n    //   decorator: {\n    //     type: 'FormItem',\n    //   },\n    //   validator: [\n    //     {\n    //       required: true,\n    //       triggerType: 'onBlur',\n    //       message: I18n.t('workflow_testset_required_tip', {\n    //         param_name: '{{$self.title}}',\n    //       }),\n    //     },\n    //   ],\n    // },\n    // {\n    //   type: 'FormString',\n    //   name: FieldName.DatasetsDescription,\n    //   title: I18n.t('workflow_testset_desc'),\n    //   component: {\n    //     type: 'Input',\n    //     props: {\n    //       maxCount: 200,\n    //       maxLength: 200,\n    //     },\n    //   },\n    //   hidden: `{{ !$values?.${FieldName.Datasets}?.${FieldName.DatasetsIs} }}`,\n    //   decorator: {\n    //     type: 'FormItem',\n    //   },\n    // },\n  ],\n};\n\n/**\n * Some common fields\n */\nexport const COMMON_FIELD = {\n  required: true,\n  decorator: {\n    type: 'FormItem',\n  },\n  validator: [\n    {\n      required: true,\n      triggerType: 'onBlur',\n      message: I18n.t('workflow_testset_required_tip', {\n        param_name: '{{$self.title}}',\n      }),\n    },\n  ],\n};\n\ntype FileTypes =\n  | ViewVariableType.Image\n  | ViewVariableType.File\n  | ViewVariableType.File\n  | ViewVariableType.Image\n  | ViewVariableType.Doc\n  | ViewVariableType.Code\n  | ViewVariableType.Ppt\n  | ViewVariableType.Txt\n  | ViewVariableType.Excel\n  | ViewVariableType.Audio\n  | ViewVariableType.Zip\n  | ViewVariableType.Video\n  | ViewVariableType.Svg\n  | ViewVariableType.Voice\n  | ViewVariableType.ArrayImage\n  | ViewVariableType.ArrayFile\n  | ViewVariableType.ArrayDoc\n  | ViewVariableType.ArrayCode\n  | ViewVariableType.ArrayPpt\n  | ViewVariableType.ArrayTxt\n  | ViewVariableType.ArrayExcel\n  | ViewVariableType.ArrayAudio\n  | ViewVariableType.ArrayZip\n  | ViewVariableType.ArrayVideo\n  | ViewVariableType.ArraySvg\n  | ViewVariableType.ArrayVoice;\n\nconst FILE_TYPE_FIELD_MAP: Record<FileTypes, TestFormField> = FILE_TYPES.reduce(\n  (map, type) => {\n    const multiple = ViewVariableType.isArrayType(type);\n\n    return {\n      ...map,\n      [type]: {\n        type: 'FormString',\n        component: {\n          type: 'File',\n          props: {\n            multiple,\n            accept: getAccept(type),\n            inputType: type,\n            fileType: genFileTypeByViewVarType(type),\n            enableInputURL: true,\n          },\n        },\n      },\n    };\n  },\n  {},\n) as Record<FileTypes, TestFormField>;\n\n/** Mapping of types to fields */\nexport const NOT_FILE_TYPE_FIELD_MAP: Record<\n  Exclude<ViewVariableType, FileTypes>,\n  TestFormField\n> = {\n  [ViewVariableType.String]: {\n    type: 'FormString',\n    component: {\n      type: 'Input',\n    },\n  },\n  [ViewVariableType.Integer]: {\n    type: 'FormNumber',\n    component: {\n      type: 'InputInteger',\n    },\n  },\n  [ViewVariableType.Boolean]: {\n    type: 'FormBoolean',\n    initialValue: true,\n    component: {\n      type: 'Switch',\n    },\n  },\n  [ViewVariableType.Number]: {\n    type: 'FormNumber',\n    component: {\n      type: 'InputNumber',\n    },\n  },\n  [ViewVariableType.Time]: {\n    type: 'FormString',\n    component: {\n      type: 'InputTime',\n    },\n  },\n  [ViewVariableType.Object]: {\n    type: 'FormString',\n    component: {\n      type: 'JsonEditor',\n    },\n    initialValue: '{}',\n  },\n  [ViewVariableType.ArrayString]: {\n    type: 'FormString',\n    component: {\n      type: 'JsonEditor',\n    },\n    initialValue: '[]',\n  },\n  [ViewVariableType.ArrayInteger]: {\n    type: 'FormString',\n    component: {\n      type: 'JsonEditor',\n    },\n    initialValue: '[]',\n  },\n  [ViewVariableType.ArrayBoolean]: {\n    type: 'FormString',\n    component: {\n      type: 'JsonEditor',\n    },\n    initialValue: '[]',\n  },\n  [ViewVariableType.ArrayNumber]: {\n    type: 'FormString',\n    component: {\n      type: 'JsonEditor',\n    },\n    initialValue: '[]',\n  },\n  [ViewVariableType.ArrayObject]: {\n    type: 'FormString',\n    component: {\n      type: 'JsonEditor',\n    },\n    initialValue: '[]',\n  },\n  [ViewVariableType.ArrayTime]: {\n    type: 'FormString',\n    component: {\n      type: 'JsonEditor',\n    },\n    initialValue: '[]',\n  },\n};\n\nexport const TYPE_FIELD_MAP: Record<ViewVariableType, TestFormField> = {\n  ...NOT_FILE_TYPE_FIELD_MAP,\n  ...FILE_TYPE_FIELD_MAP,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport {\n  TestFormType,\n  FieldName,\n  TestRunDataSource,\n  SETTING_FIELD_TEMPLATE,\n  DEFAULT_FIELD_TEMPLATE,\n  NODE_FIELD_TEMPLATE,\n  BATCH_FIELD_TEMPLATE,\n  INPUT_FIELD_TEMPLATE,\n  getBotFieldTemplate,\n  getConversationTemplate,\n  DATASETS_FIELD_TEMPLATE,\n  COMMON_FIELD,\n  TYPE_FIELD_MAP,\n  TESTSET_CHAT_NAME,\n  TESTSET_BOT_NAME,\n  INPUT_JSON_FIELD_TEMPLATE,\n} from './test-form';\n\n/** Test set connector ID is a fixed string */\nexport const TESTSET_CONNECTOR_ID = '10000';\n\n/** This string has no meaning, it is only a marker and cannot be used to determine the start node */\nexport const START_NODE_ID = '100001';\n\n/*******************************************************************************\n * Log related constants\n */\n\nexport enum EndTerminalPlan {\n  Variable = 1,\n  Text = 2,\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type PropsWithChildren, useRef } from 'react';\n\nimport cls from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { type PopoverProps } from '@coze-arch/bot-semi/Popover';\nimport { Tooltip, Popover, Row, Col } from '@coze-arch/bot-semi';\n\nimport s from './index.module.less';\n\ninterface SourceProps {\n  token: string;\n  cost: string;\n}\ninterface ExpendProps {\n  data: {\n    output: SourceProps;\n    input: SourceProps;\n    total: SourceProps;\n  };\n  className?: string;\n  popoverProps?: Partial<PopoverProps>;\n}\n\nexport const CostPopover: React.FC<PropsWithChildren<ExpendProps>> = ({\n  data,\n  popoverProps,\n  className,\n  children,\n}) => {\n  const containerRef = useRef(null);\n\n  return (\n    <div ref={containerRef} className={cls(s.container, className)}>\n      <Popover\n        showArrow\n        getPopupContainer={() => containerRef.current ?? document.body}\n        content={\n          <div className={s.content}>\n            <Row className={s.header}>\n              <Col span={8}>{I18n.t('workflow_detail_title_source')}</Col>\n              <Col span={10}>{I18n.t('workflow_detail_title_token')}</Col>\n              {/* {FEATURE_ENABLE_WORKFLOW_LLM_PAYMENT && (\n                <Col span={6}>{I18n.t('workflow_detail_title_cost')}</Col>\n              )} */}\n            </Row>\n            <Row className={s.text} style={{ paddingBottom: 0 }}>\n              <Col span={8} className={s.title}>\n                {I18n.t('workflow_detail_node_output')}\n              </Col>\n              <Tooltip content={data.output.token}>\n                <Col span={10} className={s.value}>\n                  {data.output.token}\n                </Col>\n              </Tooltip>\n              {/* {FEATURE_ENABLE_WORKFLOW_LLM_PAYMENT && (\n                <Tooltip content={data.output.cost}>\n                  <Col span={6} className={s.value}>\n                    {data.output.cost}\n                  </Col>\n                </Tooltip>\n              )} */}\n            </Row>\n            <Row className={s.text} style={{ paddingTop: 0 }}>\n              <Col span={8} className={s.title}>\n                {I18n.t('workflow_detail_node_parameter_input')}\n              </Col>\n              <Tooltip content={data.input.token}>\n                <Col span={10} className={s.value}>\n                  {data.input.token}\n                </Col>\n              </Tooltip>\n              {/* {FEATURE_ENABLE_WORKFLOW_LLM_PAYMENT && (\n                <Tooltip content={data.input.cost}>\n                  <Col span={6} className={s.value}>\n                    {data.input.cost}\n                  </Col>\n                </Tooltip>\n              )} */}\n            </Row>\n            <Row className={s.footer}>\n              <Col span={8} className={s.title}>\n                {I18n.t('workflow_detail_title_total')}\n              </Col>\n              <Tooltip content={data.total.token}>\n                <Col span={10} className={s.value}>\n                  {data.total.token}\n                </Col>\n              </Tooltip>\n              {/* {FEATURE_ENABLE_WORKFLOW_LLM_PAYMENT && (\n                <Tooltip content={data.total.cost}>\n                  <Col span={6} className={s.value}>\n                    {data.total.cost}\n                  </Col>\n                </Tooltip>\n              )} */}\n            </Row>\n          </div>\n        }\n        {...popoverProps}\n      >\n        {children}\n      </Popover>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { type PropsWithChildren } from 'react';\n\nimport { type TokenAndCost } from '@coze-workflow/base/api';\n\nimport { CostPopover } from '../../cost-popover';\n\nexport const TestRunCostPopover = ({\n  tokenAndCost,\n  children,\n  popoverProps,\n  className,\n}: PropsWithChildren<{\n  tokenAndCost: TokenAndCost;\n  className?: string;\n  popoverProps?: Record<string, any>;\n}>) => {\n  const data = {\n    output: {\n      token: tokenAndCost.outputTokens || '-',\n      cost: tokenAndCost.outputCost || '-',\n    },\n    input: {\n      token: tokenAndCost.inputTokens || '-',\n      cost: tokenAndCost.inputCost || '-',\n    },\n    total: {\n      token: tokenAndCost.totalTokens || '-',\n      cost: tokenAndCost.totalCost || '-',\n    },\n  };\n\n  return (\n    <CostPopover popoverProps={popoverProps} data={data} className={className}>\n      {children}\n    </CostPopover>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMutation } from '@tanstack/react-query';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\n\nimport { WorkflowRunService } from '../../../services';\n\nexport const useCancelTestRun = () => {\n  const runService = useService<WorkflowRunService>(WorkflowRunService);\n\n  const { mutate, isPending } = useMutation({\n    mutationFn: async () => await runService.cancelTestRun(),\n  });\n\n  const cancelTestRun = async () => await mutate();\n\n  return {\n    cancelTestRun,\n    canceling: isPending,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback } from 'react';\n\nimport { StandardNodeType } from '@coze-workflow/base';\nimport { type ViewVariableMeta } from '@coze-workflow/base';\nimport { type FormModelV2 } from '@flowgram-adapter/free-layout-editor';\nimport { FlowNodeFormData } from '@flowgram-adapter/free-layout-editor';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowDocument } from '@flowgram-adapter/free-layout-editor';\n\nconst useGetStartNode = () => {\n  const workflowDocument = useService<WorkflowDocument>(WorkflowDocument);\n\n  const getNode = useCallback(() => {\n    const testRunFormNodes = workflowDocument.getAllNodes();\n    const startNodeEntity = testRunFormNodes.find(\n      n => n.flowNodeType === StandardNodeType.Start,\n    );\n    return startNodeEntity;\n  }, [workflowDocument]);\n\n  return { getNode };\n};\n\nconst useGetStartNodeOutputs = () => {\n  const { getNode } = useGetStartNode();\n  const getStartNodeOutputs = (): ViewVariableMeta[] => {\n    const startNode = getNode();\n    if (!startNode) {\n      return [];\n    }\n    const outputsPath = startNode.getNodeMeta()?.outputsPath ?? '/outputs';\n    const formModel = startNode\n      .getData<FlowNodeFormData>(FlowNodeFormData)\n      .getFormModel<FormModelV2>();\n    return formModel?.getValueIn(outputsPath) ?? [];\n  };\n  return { getStartNodeOutputs };\n};\n\nexport { useGetStartNode, useGetStartNodeOutputs };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { get, intersection } from 'lodash-es';\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport {\n  useService,\n  WorkflowDocument,\n} from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowNodeRefVariablesData } from '@coze-workflow/variable';\nimport { WorkflowNodeData } from '@coze-workflow/nodes';\nimport {\n  StandardNodeType,\n  CONVERSATION_NODES,\n  MESSAGE_NODES,\n  CONVERSATION_HISTORY_NODES,\n  WorkflowMode,\n  ValueExpression,\n  CONVERSATION_NAME,\n} from '@coze-workflow/base';\n\nimport { TestFormType } from '../constants';\nimport {\n  useGetWorkflowMode,\n  useWorkflowOperation,\n  useGlobalState,\n} from '../../../hooks';\n\n/**\n * Check if a session node is included\n * @param typeList\n * @returns\n */\nfunction checkHasConversationNode(typeList: StandardNodeType[]) {\n  return intersection(typeList, CONVERSATION_NODES).length > 0;\n}\n\nfunction checkHasMessageNode(typeList: StandardNodeType[]) {\n  return intersection(typeList, MESSAGE_NODES).length > 0;\n}\n\nfunction checkHasConversationHistoryNode(typeList: StandardNodeType[]) {\n  return intersection(typeList, CONVERSATION_HISTORY_NODES).length > 0;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype NodeData = any;\n\n/**\n * Gets whether the LLM type node has session history enabled\n * @param workflowJson json data of the current node\n * @returns\n */\nfunction getEnableChatHistory(workflowJson: NodeData) {\n  const llmParam = get(workflowJson, 'data.inputs.llmParam');\n  const isIntentNode = workflowJson.type === StandardNodeType.Intent;\n  const enableChatHistory = isIntentNode\n    ? llmParam?.enableChatHistory\n    : get(\n        (llmParam || []).find(item => item.name === 'enableChatHistory'),\n        'input.value.content',\n      ) || false;\n\n  return Boolean(enableChatHistory);\n}\n\n/**\n * Check whether the current node is an LLM, an Intent node, and open the session history\n * @param node Current node\n * @param workflowJson json data of the current node\n * @Returns whether the current node is an LLM, Intent node, and the session history is enabled, returns true, otherwise false\n */\nfunction checkLLMEnableHistory(node: FlowNodeEntity, workflowJson: NodeData) {\n  const isLLMNode = [StandardNodeType.LLM, StandardNodeType.Intent].includes(\n    node.flowNodeType as StandardNodeType,\n  );\n\n  const enableChatHistory = isLLMNode && getEnableChatHistory(workflowJson);\n\n  // At present, there are only LLM type nodes. When opening the session history, single-node debugging needs to display \"Select Session\".\n  return enableChatHistory;\n}\n\n/**\n * Weather current node is subworkflow node and  it's a chatflow\n * @param node current test node\n * @returns\n */\nfunction checkNodeIsChatflow(node: FlowNodeEntity) {\n  const nodeData = node.getData<WorkflowNodeData>(WorkflowNodeData);\n  const subWorkflowDetail =\n    nodeData?.getNodeData<StandardNodeType.SubWorkflow>();\n\n  const nodeIsChatflow = subWorkflowDetail?.flow_mode === WorkflowMode.ChatFlow;\n  return nodeIsChatflow;\n}\n\n/**\n * Weather current node data contains a `CONVERSATION_NAME` input, and it is a ref\n * @param workflowJson current test node data\n * @returns\n */\nfunction checkHasConversationNameRef(workflowJson: NodeData) {\n  const conversationNameItem = (\n    get(workflowJson, 'data.inputs.inputParameters') || []\n  ).find(v => v?.name === CONVERSATION_NAME);\n\n  const isConversationNameRef = conversationNameItem\n    ? ValueExpression.isRef(conversationNameItem?.input?.value)\n    : false;\n\n  return isConversationNameRef;\n}\n\n// eslint-disable-next-line max-lines-per-function\nconst useNeedBot = () => {\n  const operation = useWorkflowOperation();\n  const workflowDocument = useService<WorkflowDocument>(WorkflowDocument);\n  const { isSceneFlow, isChatflow } = useGetWorkflowMode();\n  const globalState = useGlobalState();\n\n  // eslint-disable-next-line complexity\n  const isNeedBot = async () => {\n    const nodeTypes = await operation.queryNodeType();\n    const flowTypeList = nodeTypes?.node_types ?? [];\n    const subFlowTypeList = nodeTypes?.sub_workflow_node_types ?? [];\n    const sumTypeList = [\n      ...flowTypeList,\n      ...subFlowTypeList,\n    ] as StandardNodeType[];\n\n    const flowPropsList = nodeTypes?.nodes_properties ?? [];\n    const subFlowPropsList = nodeTypes?.sub_workflow_nodes_properties ?? [];\n    const sumPropsList = [...flowPropsList, ...subFlowPropsList];\n\n    const hasVariableNode = sumTypeList.includes(StandardNodeType.Variable);\n    const hasVariableAssignNode = sumTypeList.includes(\n      StandardNodeType.VariableAssign,\n    );\n\n    /** @Deprecated This field is not currently used and can be deleted later */\n    const hasDatabaseNode = sumTypeList.includes(StandardNodeType.Database);\n    const hasIntentNode = sumTypeList.includes(StandardNodeType.Intent);\n    const hasLLMNode = sumTypeList.includes(StandardNodeType.LLM);\n    const hasLTMNode = sumTypeList.includes(StandardNodeType.LTM);\n    const hasConversationNode = checkHasConversationNode(sumTypeList);\n    const hasMessageNode = checkHasMessageNode(sumTypeList);\n    const hasConversationHistoryNode =\n      checkHasConversationHistoryNode(sumTypeList);\n    const propsEnableChatHistory = sumPropsList.some(\n      item => item.is_enable_chat_history,\n    );\n    const hasNodeUseGlobalVariable = !!sumPropsList.find(\n      item => item.is_ref_global_variable,\n    );\n\n    const hasChatHistoryEnabledLLM =\n      (hasLLMNode || hasIntentNode) && propsEnableChatHistory;\n\n    const hasSubFlowNode = subFlowTypeList.some(it =>\n      [StandardNodeType.SubWorkflow].includes(it as StandardNodeType),\n    );\n\n    // The process (including the subflow drill-down node) has Variable, Database, and LLM for opening chat history | | subflow nodes have subflow\n    const needBot =\n      hasNodeUseGlobalVariable ||\n      hasVariableAssignNode ||\n      hasVariableNode ||\n      hasLTMNode ||\n      hasChatHistoryEnabledLLM ||\n      hasSubFlowNode ||\n      hasConversationNode ||\n      hasMessageNode ||\n      hasConversationHistoryNode;\n\n    const needConversation = hasChatHistoryEnabledLLM;\n\n    /** If it is a scene workflow, the default Bot of the scene will be automatically associated, and there is no need to manually select it here. */\n    if (isSceneFlow) {\n      return {\n        needBot: false,\n        needConversation: false,\n        hasVariableNode,\n        hasVariableAssignNode,\n        hasNodeUseGlobalVariable,\n        hasDatabaseNode,\n        hasLTMNode,\n        hasChatHistoryEnabledLLM,\n        isChatflow: globalState.isChatflow,\n        hasConversationNode,\n      };\n    }\n\n    return {\n      needBot,\n      needConversation,\n      hasVariableNode,\n      hasVariableAssignNode,\n      hasNodeUseGlobalVariable,\n      hasDatabaseNode,\n      hasLTMNode,\n      hasChatHistoryEnabledLLM,\n      isChatflow: globalState.isChatflow,\n      hasConversationNode,\n    };\n  };\n\n  /** Part of the calculation form requires a bot environment */\n  // eslint-disable-next-line complexity -- refactor later\n  const queryNeedBot = async (\n    testFormType: TestFormType,\n    node: FlowNodeEntity,\n  ) => {\n    let isNeedBotEnv = {\n      /** Do you need to display the selected agent/application? */\n      needBot: false,\n\n      /** Do you need to show the selection session? */\n      needConversation: false,\n      hasVariableNode: false,\n      hasVariableAssignNode: false,\n      hasDatabaseNode: false,\n      hasLTMNode: false,\n      hasChatHistoryEnabledLLM: false,\n      isChatflow: globalState.isChatflow,\n      hasConversationNode: false,\n    };\n\n    if (isSceneFlow) {\n      return isNeedBotEnv;\n    }\n\n    const nodeType = node.flowNodeType as StandardNodeType;\n    const workflowJson = await workflowDocument.toNodeJSON(node);\n    const nodeIsChatflow = checkNodeIsChatflow(node);\n    const isConversationNameRef = checkHasConversationNameRef(workflowJson);\n\n    // If it is a project, it is not necessary to display the selection agent/application, but to further determine whether the session node needs to be displayed.\n    if (globalState.projectId) {\n      const isSubworkflow = nodeType === StandardNodeType.SubWorkflow;\n\n      isNeedBotEnv.needConversation =\n        checkLLMEnableHistory(node, workflowJson) ||\n        (isSubworkflow && nodeIsChatflow && isConversationNameRef);\n\n      return isNeedBotEnv;\n    }\n\n    /** A single node only needs to determine whether this node is a relevant node */\n    if (testFormType === TestFormType.Single) {\n      if (nodeType === StandardNodeType.Variable) {\n        isNeedBotEnv.needBot = true;\n        isNeedBotEnv.hasVariableNode = true;\n      } else if (nodeType === StandardNodeType.VariableAssign) {\n        isNeedBotEnv.needBot = true;\n        isNeedBotEnv.hasVariableAssignNode = true;\n      } else if (nodeType === StandardNodeType.Database) {\n        isNeedBotEnv.hasDatabaseNode = true;\n      } else if (nodeType === StandardNodeType.LTM) {\n        isNeedBotEnv.needBot = true;\n        isNeedBotEnv.hasLTMNode = true;\n      } else if (\n        [StandardNodeType.LLM, StandardNodeType.Intent].includes(nodeType) &&\n        isChatflow\n      ) {\n        const enableChatHistory = getEnableChatHistory(workflowJson);\n        if (enableChatHistory) {\n          isNeedBotEnv.needBot = true;\n          isNeedBotEnv.needConversation = true;\n          isNeedBotEnv.hasChatHistoryEnabledLLM = true;\n        }\n      } else if (nodeType === StandardNodeType.SubWorkflow) {\n        isNeedBotEnv = await isNeedBot();\n\n        // If it is a single-node debugging chatflow, if it is not in the project, it is necessary to display the application selector and have cascading session selection\n        // You don't need to determine what type of nodes are in this chatflow, this logic will be more concise\n        if (nodeIsChatflow) {\n          isNeedBotEnv.needBot = !globalState.projectId;\n          isNeedBotEnv.needConversation = isConversationNameRef;\n        }\n      } else if (\n        [StandardNodeType.Loop, StandardNodeType.Batch].includes(nodeType)\n      ) {\n        isNeedBotEnv = await isNeedBot();\n      } else if (CONVERSATION_NODES.includes(nodeType)) {\n        // If it is a session node\n        isNeedBotEnv.needBot = true;\n        isNeedBotEnv.hasConversationNode = true;\n      } else if (\n        [...MESSAGE_NODES, ...CONVERSATION_HISTORY_NODES].includes(nodeType)\n      ) {\n        // If it is a message node\n        isNeedBotEnv.needBot = true;\n      } else if (node.getData(WorkflowNodeRefVariablesData).hasGlobalRef) {\n        // Node selection If global variables are configured, you need to remind to select bot\\ project.\n        isNeedBotEnv.needBot = true;\n      }\n    } else {\n      if (globalState.isChatflow) {\n        isNeedBotEnv = await isNeedBot();\n\n        // Chatflow in the resource library, the whole process runs, and a selected item is required.\n        isNeedBotEnv.needBot = true;\n        // Chatflow also doesn't have to select a session in the form\n        isNeedBotEnv.needConversation = false;\n      } else {\n        /** Workflow in the resource library, the whole process runs, and the whole process needs to be traversed, including sub-processes */\n        isNeedBotEnv = await isNeedBot();\n        // Under workflow, the whole process practice runs disable conversation\n        isNeedBotEnv.needConversation = false;\n      }\n    }\n\n    return isNeedBotEnv;\n  };\n\n  return { queryNeedBot };\n};\n\nexport { useNeedBot };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Calculate test form fields with formData\n */\nimport md5 from 'md5';\nimport { isObject } from 'lodash-es';\nimport Ajv from 'ajv';\nimport { type WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { isGlobalVariableKey, variableUtils } from '@coze-workflow/variable';\nimport {\n  ViewVariableType,\n  getSortedInputParameters,\n} from '@coze-workflow/nodes';\nimport { type WorkflowNodesService } from '@coze-workflow/nodes';\nimport { ValueExpressionType, type VariableMetaDTO } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { getVariableInfoFromExpression } from '@/node-registries/http/components/variable-support/utils';\n\nimport { type TestFormField } from '../types';\nimport { type JSONEditorSchema } from '../test-form-materials/json-editor';\nimport { COMMON_FIELD, TYPE_FIELD_MAP } from '../constants';\nimport { isStaticObjectRef } from './is-static-object-ref';\nimport { ignoreRehajeExpressionString } from './ignore-rehaje-expression';\nimport { generateInputJsonSchema } from './generate-input-json-schema';\n\nexport type GenerateFn = (\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any -- formData can be any type\n  d: any,\n  context: {\n    node: WorkflowNodeEntity;\n  },\n) => TestFormField[];\n\nexport type GenerateVariableFn = (\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any -- formData can be any type\n  d: any,\n  context: {\n    node: WorkflowNodeEntity;\n    labelPrefix?: string;\n    namePrefix?: string;\n  },\n  nodesService: WorkflowNodesService,\n) => TestFormField[];\n\nexport type GenerateAsyncFn = (\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any -- formData can be any type\n  d: any,\n  context: {\n    node: WorkflowNodeEntity;\n  },\n) => Promise<TestFormField[]>;\n\nexport type GenerateRequiredFn = (\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any -- formData can be any type\n  d: any,\n  context: {\n    node: WorkflowNodeEntity;\n  },\n  requiredRule: (key: string) => boolean,\n) => TestFormField[];\n\nlet ajv: Ajv | undefined;\n/**\n * Calculate table items by type\n */\nexport const generateField = (\n  type: ViewVariableType,\n  required = true,\n  desc = '',\n  jsonSchema?: JSONEditorSchema,\n  // eslint-disable-next-line max-params\n) => {\n  const { validator: commonValidator, ...commonField } = COMMON_FIELD;\n  const decorator = {\n    ...commonField.decorator,\n    props: {\n      // Here is a hidden bug to avoid subsequent commonField.decorator after extending the props field\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      ...(commonField.decorator as any)?.props,\n      tag: ViewVariableType.LabelMap[type],\n      type,\n    },\n  };\n  const {\n    validator: typeValidator,\n    component,\n    ...typeField\n  } = TYPE_FIELD_MAP[type];\n\n  const jsonSchemaValidator = {\n    triggerType: 'onBlur',\n    message: I18n.t('workflow_debug_wrong_json'),\n    validator: v => {\n      if (!jsonSchema || !v) {\n        return true;\n      }\n\n      if (!ajv) {\n        ajv = new Ajv();\n      }\n\n      try {\n        const validate = ajv.compile(jsonSchema);\n        const valid = validate(JSON.parse(v));\n        return valid;\n        // eslint-disable-next-line @coze-arch/use-error-in-catch\n      } catch (error) {\n        // Parse failure indicates that it is not a legal value\n        return false;\n      }\n    },\n  };\n\n  return {\n    ...commonField,\n    decorator,\n    ...typeField,\n    required,\n    validator: [\n      ...(required ? commonValidator : []),\n      ...(typeValidator || []),\n      jsonSchemaValidator,\n    ],\n    description: desc,\n    originType: type,\n    component: {\n      ...component,\n      props: {\n        ...(component?.props || {}),\n        jsonSchema,\n      },\n    },\n  };\n};\n\n/**\n * From the historical code, it is inferred that the start node seems to have a type other than the enumeration. Here is a compatibility. It is not clear whether there is such old data for the time being.\n */\nexport const startNodeOldType2VariableType = (\n  type: string | ViewVariableType,\n): ViewVariableType => {\n  switch (type) {\n    case 'boolean':\n      return ViewVariableType.Boolean;\n    case 'number':\n      return ViewVariableType.Number;\n    case 'integer':\n      return ViewVariableType.Integer;\n    case 'string':\n      return ViewVariableType.String;\n    default:\n      return type as ViewVariableType;\n  }\n};\n\n/**\n * Convert the input structure of the object structure to a form entry\n */\nexport const generateObjectInputParameters: GenerateFn = (\n  inputParameters,\n  context,\n) => {\n  if (!inputParameters || !isObject(inputParameters)) {\n    return [];\n  }\n  const array = Object.keys(inputParameters).map(key => ({\n    name: key,\n    input: inputParameters[key],\n  }));\n  return generateArrayInputParameters(array, context);\n};\n\n/**\n * Convert the input structure of the object structure into a form item, support setting required\n */\nexport const generateObjectInputParametersRequired: GenerateRequiredFn = (\n  inputParameters,\n  context,\n  requiredRule,\n) => {\n  if (!inputParameters || !isObject(inputParameters)) {\n    return [];\n  }\n  const array = Object.keys(inputParameters).map(key => ({\n    name: key,\n    input: inputParameters[key],\n    required: requiredRule(key) ?? false,\n  }));\n  return generateArrayInputParameters(array, context);\n};\n\n/**\n * Convert the input structure of an array structure to a list entry\n */\nexport const generateArrayInputParameters: GenerateFn = (\n  inputParameters,\n  { node },\n) => {\n  if (!inputParameters || !Array.isArray(inputParameters)) {\n    return [];\n  }\n  const inputFields = inputParameters.filter(i => {\n    /** Object reference types do not need to be filtered, all static fields need to be filtered */\n    if (i.input?.type === ValueExpressionType.OBJECT_REF) {\n      return !isStaticObjectRef(i);\n    }\n    /** Direct filtering of non-reference types, no direct filtering of reference values */\n    if (i.input?.type !== 'ref' || !i.input?.content) {\n      return false;\n    }\n    /** If the reference is from itself, there is no need to fill it in */\n    const [nodeId] = i.input.content.keyPath || [];\n    if (nodeId && nodeId === node.id) {\n      return false;\n    }\n    if (isGlobalVariableKey(nodeId)) {\n      return false;\n    }\n\n    return true;\n  });\n\n  const sortedInputFields = getSortedInputParameters(inputFields);\n  return sortedInputFields.map(data => {\n    if (data.input.type === ValueExpressionType.OBJECT_REF) {\n      const dtoMeta = variableUtils.inputValueToDTO(\n        data,\n        node.context.variableService,\n        { node },\n      );\n      const jsonSchema = generateInputJsonSchema(\n        (dtoMeta || {}) as VariableMetaDTO,\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (v: any) => ({\n          name: v?.name,\n          ...(v?.input || {}),\n        }),\n      );\n      return {\n        title: data.label || data.name,\n        name: data.name,\n        ...generateField(\n          ViewVariableType.Object,\n          data?.required,\n          data.description,\n          jsonSchema,\n        ),\n      };\n    }\n\n    const workflowVariable =\n      node.context.variableService.getWorkflowVariableByKeyPath(\n        data.input.content.keyPath,\n        { node },\n      );\n\n    const viewVariable = workflowVariable?.viewMeta;\n    const type: ViewVariableType =\n      variableUtils.getValueExpressionViewType(\n        data.input,\n        node.context.variableService,\n        { node },\n      ) || ViewVariableType.String;\n\n    const dtoMeta = variableUtils.getValueExpressionDTOMeta(\n      data.input,\n      node.context.variableService,\n      { node },\n    );\n\n    const jsonSchema = generateInputJsonSchema(\n      (dtoMeta || {}) as VariableMetaDTO,\n    );\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const fieldItem: any = generateField(\n      type,\n      data?.required,\n      data.description,\n      jsonSchema,\n    );\n    const variableInitialValue = ignoreRehajeExpressionString(\n      viewVariable?.defaultValue,\n    );\n    if (variableInitialValue !== undefined) {\n      fieldItem.initialValue = variableInitialValue;\n    }\n    return {\n      title: data.label || data.name,\n      name: data.name,\n      /** Reserved variable meta */\n      dtoMeta,\n      ...fieldItem,\n    };\n  });\n};\n\n/**\n * Converts a string containing a {{}} reference variable expression to a form entry\n */\nexport const generateExpressionString: GenerateVariableFn = (\n  expressionStr,\n  {\n    node,\n    /**\n     * Label prefix for form display\n     */\n    labelPrefix = '',\n    /**\n     * Name prefix, used to distinguish variables\n     */\n    namePrefix = '',\n  },\n  nodesService,\n) => {\n  if (!expressionStr) {\n    return [];\n  }\n  const doubleBracedPattern = /{{([^}]+)}}/g;\n  const matches = expressionStr.match(doubleBracedPattern);\n  // Remove {{}} from string\n  const matchesContent = matches?.map((varStr: string) =>\n    varStr.replace(/^{{|}}$/g, ''),\n  );\n\n  const inputField: TestFormField[] = [];\n  const formFields: TestFormField[] = [];\n\n  matchesContent?.forEach((varStr: string) => {\n    const {\n      // isGlobalVariable,\n      nodeNameWithDot,\n      fieldPart,\n      fieldKeyPath,\n      // parsedKeyPath,\n    } = getVariableInfoFromExpression(varStr);\n\n    // case:__body_bodyData_rawText + md5(\"block_out_100001.input.field\")\n    const fieldName = namePrefix + md5(nodeNameWithDot + fieldPart);\n    // Duplicate variables are displayed only once\n    if (!inputField.find((item: TestFormField) => item.name === fieldName)) {\n      inputField.push({\n        label: fieldPart,\n        name: fieldName,\n        // Fill in the default value here, which will be replaced by the real type of the variable later.\n        type: '1',\n        input: {\n          type: 'ref',\n          content: {\n            keyPath: fieldKeyPath,\n          },\n        },\n      });\n    }\n  });\n\n  inputField.forEach(data => {\n    const workflowVariable =\n      node.context.variableService.getWorkflowVariableByKeyPath(\n        data.input.content?.keyPath,\n        { node },\n      );\n\n    // The variable cannot be found, indicating that it is an invalid expression, so filter it directly.\n    // Global variables are tested with default values, no data is required\n    if (workflowVariable && !workflowVariable.globalVariableKey) {\n      const nodeTitle = nodesService.getNodeTitle(workflowVariable?.node);\n      const type = workflowVariable.viewType ?? ViewVariableType.String;\n      const jsonSchema = generateInputJsonSchema(\n        workflowVariable?.dtoMeta as VariableMetaDTO,\n      );\n\n      formFields.push({\n        title: `${labelPrefix}-${nodeTitle}-${data.label}` || data.name,\n        name: data.name,\n        ...generateField(type, data?.required, data.description, jsonSchema),\n      });\n    }\n  });\n\n  return formFields;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isString } from 'lodash-es';\n\n/**\n * The value generated by ai may contain expressions for {{xxx}} that will hit rehaje\n * Ignore it for the time being, and the problem can be lifted after replacing the form engine.\n */\nexport const ignoreRehajeExpressionString = (value: unknown) => {\n  if (!isString(value)) {\n    return value;\n  }\n  const reg = /\\{\\{.*\\}\\}/;\n  return value.match(reg) ? undefined : value;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { get, isBoolean, isString, isUndefined } from 'lodash-es';\nimport { ViewVariableType } from '@coze-workflow/base';\nimport { IntelligenceType } from '@coze-arch/idl/intelligence_api';\nimport { typeSafeJSONParse } from '@coze-arch/bot-utils';\n\nimport type {\n  TestFormSchema,\n  FormDataType,\n  TestFormField,\n  TestFormDefaultValue,\n} from '../types';\nimport { FieldName } from '../constants';\nimport { stringifyDefaultValue } from './stringify-value';\nimport { ignoreRehajeExpressionString } from './ignore-rehaje-expression';\n\nconst generateTestFormInitialValue = (\n  fields: TestFormSchema['fields'],\n  cacheData: FormDataType,\n) => {\n  if (!fields || !Array.isArray(fields) || !fields.length || !cacheData) {\n    return undefined;\n  }\n  const initialValue = fields.reduce<undefined | FormDataType>(\n    (previous, current) => {\n      const { name, visible } = current;\n      /** If it is an invalid item, no initial value is required for the time being */\n      if (isBoolean(visible) && !visible) {\n        return previous;\n      }\n      if (!name || current.type === 'FormVoid') {\n        /** If name does not exist, it is a UI or virtual node, take its children to continue recursion, and expand the value tiled. */\n        return {\n          ...previous,\n          ...generateTestFormInitialValue(current.children, cacheData),\n        };\n      }\n      const data: FormDataType = get(cacheData, name);\n      /** It means that it can be drilled. */\n      if (current.children) {\n        return {\n          ...previous,\n          [name]: generateTestFormInitialValue(current.children, data),\n        };\n      }\n      /** Valid values depend on whether the values exist and whether the types match */\n      const isUseValue =\n        data?.type === current.originType && !isUndefined(data?.value);\n      return isUseValue\n        ? {\n            ...previous,\n            [name]: data.value,\n          }\n        : previous;\n    },\n    undefined,\n  );\n\n  return initialValue;\n};\n\nconst generateCacheValues2InitialValue = (\n  fields: TestFormSchema['fields'],\n  cacheData: FormDataType,\n  /** Whether to force the use of cacheData data */\n  force?: boolean,\n) => {\n  if (!fields || !Array.isArray(fields) || !fields.length || !cacheData) {\n    return;\n  }\n  fields.forEach(field => {\n    const { name, visible, type, children, originType } = field;\n    /** If it is an invalid item, no initial value is required for the time being */\n    if (isBoolean(visible) && !visible) {\n      return;\n    }\n    if (!name || type === 'FormVoid') {\n      generateCacheValues2InitialValue(children, cacheData, force);\n      return;\n    }\n    const data: FormDataType = get(cacheData, name);\n    if (children) {\n      generateCacheValues2InitialValue(children, data, force);\n      return;\n    }\n    const initialValue = ignoreRehajeExpressionString(data?.value);\n    if ((data?.type === originType && !isUndefined(initialValue)) || force) {\n      field.initialValue = initialValue;\n    }\n  });\n};\n\nconst generateCacheDataType = (\n  fields: TestFormSchema['fields'],\n  cacheData: FormDataType,\n  blacks: string[] = [],\n) => {\n  if (!fields || !Array.isArray(fields) || !fields.length || !cacheData) {\n    return undefined;\n  }\n  const data = fields.reduce<undefined | FormDataType>((previous, current) => {\n    const { name } = current;\n\n    if (!name || current.type === 'FormVoid') {\n      return {\n        ...previous,\n        ...generateCacheDataType(current?.children, cacheData),\n      };\n    }\n    // Fields in the blacklist do not need to be saved\n    if (blacks.includes(name)) {\n      return previous;\n    }\n    if (current.children) {\n      return {\n        ...previous,\n        [name]: generateCacheDataType(current?.children, cacheData?.[name]),\n      };\n    }\n    const value = cacheData?.[name];\n    const type = current.originType;\n    return isUndefined(value)\n      ? previous\n      : {\n          ...previous,\n          [name]: {\n            type,\n            value,\n          },\n        };\n  }, undefined);\n\n  return data;\n};\n\nconst transformDefaultValueToFormData = (\n  defaultValue: TestFormDefaultValue,\n) => {\n  const { input, bot_id, batch } = defaultValue;\n\n  return {\n    [FieldName.Node]: {\n      [FieldName.Input]: stringifyDefaultValue(input as object),\n      [FieldName.Batch]: stringifyDefaultValue(batch as object),\n    },\n    [FieldName.Bot]: bot_id,\n  };\n};\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst formatObjectValue = (field: TestFormField, data: any) => {\n  if (!field.originType || !isString(data)) {\n    return data;\n  }\n  if (ViewVariableType.isFileType(field.originType)) {\n    return data;\n  }\n  if (\n    ViewVariableType.isArrayType(field.originType) ||\n    ViewVariableType.Object === field.originType\n  ) {\n    try {\n      return JSON.stringify(JSON.parse(data), undefined, 2);\n    } catch {\n      return data;\n    }\n  }\n  // If no conditions are met, it is also returned directly as the bottom line value.\n  return data;\n};\nconst generateHistoryValues2InitialValue = (\n  fields: TestFormSchema['fields'],\n  historyValuesStr: string,\n) => {\n  if (!historyValuesStr) {\n    return;\n  }\n  const input = stringifyDefaultValue(\n    typeSafeJSONParse(historyValuesStr || '{}') as Record<string, string>,\n  );\n  if (!input) {\n    return;\n  }\n  const nodeField = fields.find(i => i.name === FieldName.Node);\n  if (!nodeField || !nodeField.children?.length) {\n    return;\n  }\n  const inputField = nodeField.children.find(i => i.name === FieldName.Input);\n  if (!inputField || !inputField.children?.length) {\n    return;\n  }\n  inputField.children.forEach(i => {\n    const { name } = i;\n    const data = ignoreRehajeExpressionString(input[name]);\n    if (!isUndefined(data)) {\n      i.initialValue = formatObjectValue(i, data);\n    }\n  });\n};\n\nconst generateCaseData2InitialValue = (\n  fields: TestFormSchema['fields'],\n  caseData?: Record<string, unknown>,\n) => {\n  if (!caseData) {\n    return;\n  }\n  const nodeField = fields.find(i => i.name === FieldName.Node);\n  if (!nodeField || !nodeField.children?.length) {\n    return;\n  }\n  const inputField = nodeField.children.find(i => i.name === FieldName.Input);\n  if (!inputField || !inputField.children?.length) {\n    return;\n  }\n  inputField.children.forEach(i => {\n    const { name } = i;\n    const data = caseData[name];\n    if (!isUndefined(data)) {\n      i.initialValue = formatObjectValue(i, data);\n    }\n  });\n};\n\nconst generateRelatedBot2InitialValue = (\n  fields: TestFormSchema['fields'],\n  data?: { id?: string; type?: string },\n) => {\n  if (!data?.id || !data?.type) {\n    return;\n  }\n\n  const nodeField = fields.find(i => i.name === FieldName.Bot);\n  if (!nodeField || !nodeField.children?.length) {\n    return;\n  }\n\n  const botField = nodeField.children.find(i => i.name === FieldName.Bot);\n  if (!botField) {\n    return;\n  }\n\n  botField.initialValue = {\n    id: data.id,\n    type:\n      data.type === 'project' ? IntelligenceType.Project : IntelligenceType.Bot,\n  };\n};\n\nexport {\n  generateTestFormInitialValue,\n  generateCacheDataType,\n  transformDefaultValueToFormData,\n  generateCacheValues2InitialValue,\n  generateHistoryValues2InitialValue,\n  generateCaseData2InitialValue,\n  generateRelatedBot2InitialValue,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { invert } from 'lodash-es';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowDocument } from '@flowgram-adapter/free-layout-editor';\nimport { FieldName, useTestFormService } from '@coze-workflow/test-run';\nimport { workflowApi, StandardNodeType } from '@coze-workflow/base';\nimport { NodeHistoryScene } from '@coze-arch/bot-api/workflow_api';\n\nimport { RelatedCaseDataService } from '@/services';\nimport { useGlobalState, useTestRunReporterService } from '@/hooks';\nimport { TestFormType } from '@/components/test-run/constants';\n\nimport {\n  generateHistoryValues2InitialValue,\n  generateCacheValues2InitialValue,\n  generateCaseData2InitialValue,\n  generateRelatedBot2InitialValue,\n} from '../utils/generate-test-form-initial-value';\nimport { type TestFormSchema } from '../types';\n\nexport const useTestFormInitialValueV2 = () => {\n  const testFormService = useTestFormService();\n  const globalState = useGlobalState();\n  const reporter = useTestRunReporterService();\n  const workflowDocument = useService<WorkflowDocument>(WorkflowDocument);\n  const relatedCaseDataService = useService<RelatedCaseDataService>(\n    RelatedCaseDataService,\n  );\n\n  const isHitGlobalCachedFg = (schema: TestFormSchema) =>\n    !globalState.isInIDE && schema.type === TestFormType.Default;\n\n  const generateInitialValues = async (schema: TestFormSchema) => {\n    if (!schema?.id || !schema?.fields?.length) {\n      return;\n    }\n\n    // Highest merit: The last value the user filled in\n    const cacheData = testFormService.getCacheValues(schema.id);\n    if (cacheData) {\n      generateCacheValues2InitialValue(schema.fields, cacheData);\n      reporter.formGenDataOrigin({ gen_data_origin: 'cache' });\n      return;\n    }\n    const node = workflowDocument.getAllNodes().find(n => n.id === schema.id);\n\n    const map = invert(StandardNodeType);\n\n    if (!node || !map[node.flowNodeType]) {\n      return;\n    }\n\n    try {\n      if (isHitGlobalCachedFg(schema)) {\n        const defaultCaseData = relatedCaseDataService.getRelatedBotValue();\n        generateRelatedBot2InitialValue(schema.fields, defaultCaseData);\n      }\n\n      const res = await workflowApi.GetNodeExecuteHistory({\n        workflow_id: globalState.workflowId,\n        space_id: globalState.spaceId,\n        node_id: schema.id,\n        node_type: map[node.flowNodeType],\n        execute_id: '',\n        node_history_scene: NodeHistoryScene.TestRunInput,\n      });\n\n      if (res.data?.input) {\n        generateHistoryValues2InitialValue(schema.fields, res.data.input);\n        reporter.formGenDataOrigin({ gen_data_origin: 'history' });\n        return;\n      }\n\n      if (isHitGlobalCachedFg(schema)) {\n        const defaultCaseData = relatedCaseDataService.getDefaultCaseCaches();\n        if (defaultCaseData) {\n          generateCaseData2InitialValue(\n            schema.fields,\n            defaultCaseData?.[FieldName.Node]?.[FieldName.Input],\n          );\n        }\n      }\n      // eslint-disable-next-line @coze-arch/no-empty-catch\n    } catch {\n      //\n    }\n  };\n\n  return { generateInitialValues };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type StandardNodeType } from '@coze-workflow/base/types';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { FieldName } from '../constants';\nimport { useGetSceneFlowBot } from '../../../hooks/use-get-scene-flow-params';\nimport { useGetWorkflowMode } from '../../../hooks';\n\n/**\n * Determine if testrun needs an associated bot_id under the scenario workflow\n */\nexport const useNeedSceneBot = (nodeType: StandardNodeType) => {\n  const { isSceneFlow } = useGetWorkflowMode();\n  const sceneFlowHost = useGetSceneFlowBot();\n\n  return {\n    needSceneBot: isSceneFlow,\n    sceneBotSchema: {\n      type: 'FormString',\n      name: FieldName.Bot,\n      initialValue: sceneFlowHost?.participantId,\n      title: I18n.t('workflow_detail_testrun_bot', {}, ' Bot'),\n      disabled: true,\n      // No nodeType, the description is the whole practice run, hidden bot\n      hidden: !nodeType,\n      decorator: {\n        type: 'FormItem',\n      },\n      component: {\n        type: 'Select',\n        props: {\n          optionList: [\n            {\n              label: sceneFlowHost?.name,\n              value: sceneFlowHost?.participantId,\n            },\n          ],\n          disabled: true,\n        },\n      },\n    },\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport { type TestFormField } from '../types';\nimport { generateObjectInputParameters } from './generate-test-form-fields';\n\nexport const generateUpdateTriggerFields = (formData, context) => {\n  const labelMap = {\n    triggerName: I18n.t('workflow_trigger_user_create_name'),\n    triggerId: I18n.t('workflow_trigger_user_create_id'),\n    userId: I18n.t('workflow_trigger_user_create_userid'),\n  };\n\n  const fixedInputs = formData?.inputs?.fixedInputs;\n  const configFields = generateObjectInputParameters(fixedInputs, context).map(\n    i => ({\n      ...i,\n      name: `__trigger_config_${i.name}`,\n      title: i.name ? labelMap[i.name] || i.name : i.name,\n    }),\n  );\n\n  let cronjobFields: TestFormField[] = [];\n  const crontab = formData?.inputs?.dynamicInputs?.crontab;\n  if (crontab?.type === 'cronjob') {\n    cronjobFields = generateObjectInputParameters(\n      {\n        crontab: crontab?.content,\n      },\n      context,\n    ).map(i => ({\n      ...i,\n      name: '__trigger_config_crontab',\n      title: I18n.t('workflow_trigger_user_create_schedula'),\n    }));\n  }\n\n  const payload = formData?.inputs?.payload;\n\n  const payloadFields = generateObjectInputParameters(payload, context).map(\n    i => {\n      // The bound work flows into the argument in the form ${variable.type}, ${variable.key?? variable.name}\n      const parameterKey = i.name?.split(',')[1] || i.name;\n      return {\n        ...i,\n        name: `__trigger_payload_${parameterKey}`,\n        title: parameterKey,\n      };\n    },\n  );\n\n  return [...configFields, ...cronjobFields, ...payloadFields];\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { get } from 'lodash-es';\nimport { I18n, type I18nKeysNoOptionsType } from '@coze-arch/i18n';\n\nimport { generateArrayInputParameters } from './generate-test-form-fields';\n\n/**\n * Generate image generation Single node practice running form fields\n */\nexport function generateImageflowGenerateTestFormFields(formData, context) {\n  const references =\n    get(formData, 'references') || get(formData, 'inputs.references');\n\n  const originParameters =\n    get(formData, 'inputParameters') ||\n    get(formData, 'inputs.inputParameters') ||\n    [];\n\n  const referencesInputParameters =\n    referencesToArrayInputParameters(references) || [];\n\n  const inputParameters = [...originParameters, ...referencesInputParameters];\n\n  const fields = generateArrayInputParameters(inputParameters, context);\n\n  return fields;\n}\n\nfunction referencesToArrayInputParameters(references) {\n  return references\n    ?.filter(({ preprocessor }) => preprocessor)\n    ?.map(({ preprocessor, url }) => ({\n      name: `__image_references_${preprocessor}`,\n      label: I18n.t(\n        `Imageflow_reference${preprocessor}` as I18nKeysNoOptionsType,\n      ),\n      input: url,\n    }));\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type DatabaseCondition } from '@coze-workflow/base';\nimport { MemoryApi } from '@coze-arch/bot-api';\n\nimport { generateArrayInputParameters } from './generate-test-form-fields';\n\n/**\n * Generate database new data node practice run table entry\n */\nexport async function generateDatabaseCreateTestRunFormFields(\n  formData,\n  context,\n) {\n  const databaseID = getDatabaseID(formData);\n\n  if (!databaseID) {\n    return [];\n  }\n\n  const database = await queryDatabase(databaseID);\n\n  const fieldInfoParams = convertFieldInfoToParams(\n    formData.inputs.insertParam.fieldInfo,\n    database,\n  );\n\n  const formFields = generateArrayInputParameters(fieldInfoParams, context);\n\n  return formFields;\n}\n\n/**\n * Generate database update data node practice run table entry\n */\nexport async function generateDatabaseUpdateTestRunFormFields(\n  formData,\n  context,\n) {\n  const databaseID = getDatabaseID(formData);\n\n  if (!databaseID) {\n    return [];\n  }\n\n  const database = await queryDatabase(databaseID);\n\n  const fieldInfo = formData?.inputs?.updateParam?.fieldInfo ?? [];\n  const fieldInfoParams = convertFieldInfoToParams(fieldInfo, database);\n\n  const conditionList =\n    formData?.inputs?.updateParam?.condition?.conditionList ?? [];\n  const conditionListParams = convertConditionListToParams(conditionList);\n\n  const params = [...fieldInfoParams, ...conditionListParams];\n\n  const formFields = generateArrayInputParameters(params, context);\n\n  return formFields;\n}\n\n/**\n * Generate database Delete data node practice run table entry\n */\nexport function generateDatabaseDeleteTestRunFormFields(formData, context) {\n  const conditionList =\n    formData?.inputs?.deleteParam?.condition?.conditionList ?? [];\n  const conditionListParams = convertConditionListToParams(conditionList);\n\n  const formFields = generateArrayInputParameters(conditionListParams, context);\n\n  return formFields;\n}\n\n/**\n * Generate database query data node practice run table entry\n */\nexport function generateDatabaseQueryTestRunFormFields(formData, context) {\n  const conditionList =\n    formData?.inputs?.selectParam?.condition?.conditionList ?? [];\n  const conditionListParams = convertConditionListToParams(conditionList);\n\n  const formFields = generateArrayInputParameters(conditionListParams, context);\n\n  return formFields;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction getDatabaseID(formData: any) {\n  return formData?.inputs?.databaseInfoList[0]?.databaseInfoID;\n}\n\nfunction queryDatabase(databaseID: string) {\n  return MemoryApi.GetDatabaseByID({\n    id: databaseID,\n    need_sys_fields: true,\n  });\n}\n\nfunction convertFieldInfoToParams(fieldInfo, database) {\n  return fieldInfo.map(item => {\n    const databaseField = database?.database_info?.field_list?.find(\n      field => field.alterId === item.fieldID,\n    );\n    return {\n      name: `__setting_field_${item?.fieldID}`,\n      label: databaseField?.name,\n      input: item?.fieldValue,\n    };\n  });\n}\n\nfunction convertConditionListToParams(conditionList: DatabaseCondition[]) {\n  return conditionList.map((item, index) => {\n    const { left, right } = item;\n    const name = left;\n    const rightValue = right;\n\n    return {\n      name: `__condition_right_${index}`,\n      label: `${name}`,\n      input: rightValue,\n    };\n  });\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ViewVariableType } from '@coze-workflow/base/types';\nimport { reporter } from '@coze-arch/logger';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { useGetSceneFlowRoleList } from '../../../hooks/use-get-scene-flow-params';\n\nexport const useGetSceneFlowRoleListSchema = () => {\n  const { isLoading, data: roleList } = useGetSceneFlowRoleList();\n\n  if (isLoading) {\n    return () => null;\n  } else {\n    return () => ({\n      title: (\n        <span className=\"text-sm\">\n          {I18n.t('scene_workflow_testrun_title', {}, '')}\n        </span>\n      ),\n      name: 'role_information',\n      type: 'FormArray',\n      originType: ViewVariableType.ArrayObject,\n      initialValue: roleList?.map(item => ({\n        role: item.role,\n        nickname: item.nickname,\n        origin_nickname: item.nickname,\n        player_description: item.description,\n      })),\n      component: {\n        // Array rendering setter\n        type: 'Array',\n      },\n      decorator: {\n        type: 'FormItem',\n        props: {\n          tooltip: I18n.t(\n            'scene_workflow_testrun_title_tooltip',\n            {},\n            'NicknameNickname',\n          ),\n        },\n      },\n      items: {\n        title:\n          '{{$record.role}} ' +\n          `({{$record.origin_nickname || '${I18n.t(\n            'scene_edit_roles_list_nickname_empty_seat',\n            {},\n            '',\n          )}'}}` +\n          `)${I18n.t(\n            'scene_workflow_testrun_nickname_nickname',\n            {},\n            'Nickname',\n          )}`,\n        type: 'FormString',\n        name: 'nickname',\n        required: true,\n        disabled: '{{!!$record.origin_nickname}}',\n        validator: [\n          {\n            validator: value => {\n              const reg = /^[a-zA-Z0-9_-]{1,64}$/;\n              return reg.test(value)\n                ? true\n                : I18n.t(\n                    'scene_workflow_testrun_nickname_error',\n                    {},\n                    'Nickname ',\n                  );\n            },\n            triggerType: 'onBlur',\n          },\n          {\n            validator: (value, rule, context) => {\n              try {\n                const parentValue = context.graph.parent.value;\n                const currentIndex = context.indexes?.[0];\n                if (!currentIndex) {\n                  return true;\n                }\n\n                const hasRepeatedValue = parentValue\n                  .filter((item, index) => index !== currentIndex)\n                  .find(item => item.nickname === value);\n                if (hasRepeatedValue) {\n                  return I18n.t(\n                    'scene_workflow_testrun_nickname_error',\n                    {},\n                    '',\n                  );\n                } else {\n                  return true;\n                }\n              } catch (e) {\n                reporter.errorEvent({\n                  eventName: 'workflow_testrun_nickname_repeat_validate_err',\n                  namespace: 'workflow',\n                  error: e,\n                });\n                return true;\n              }\n            },\n            triggerType: 'onBlur',\n          },\n        ],\n        decorator: {\n          type: 'FormItem',\n        },\n        component: {\n          type: 'Input',\n          props: {\n            placeholder: I18n.t(\n              'scene_workflow_testrun_nickname_placeholder',\n              {},\n              '',\n            ),\n          },\n        },\n      },\n    });\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable max-lines-per-function */\nimport md5 from 'md5';\nimport { get, pick } from 'lodash-es';\nimport { FlowNodeFormData } from '@flowgram-adapter/free-layout-editor';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport {\n  getSortedInputParameters,\n  roleInformationKeyword,\n  WorkflowNodeData,\n  WorkflowNodesService,\n} from '@coze-workflow/nodes';\nimport { StandardNodeType } from '@coze-workflow/base/types';\nimport {\n  isPresetStartParams,\n  WorkflowMode,\n  CONVERSATION_NAME,\n} from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { AuthType, BodyType } from '@/node-registries/http/setters/constants';\nimport { OptionType } from '@/constants/question-settings';\n\nimport { generateUpdateTriggerFields } from '../utils/generate-update-trigger-fields';\nimport {\n  type GenerateFn,\n  type GenerateAsyncFn,\n} from '../utils/generate-test-form-fields';\nimport {\n  generateField,\n  startNodeOldType2VariableType,\n  generateArrayInputParameters,\n  generateObjectInputParameters,\n  generateExpressionString,\n  generateObjectInputParametersRequired,\n} from '../utils/generate-test-form-fields';\nimport { generateInputJsonSchema } from '../utils/generate-input-json-schema';\nimport { generateImageflowGenerateTestFormFields } from '../utils/generate-imageflow-generate-test-form-fields';\nimport {\n  generateDatabaseCreateTestRunFormFields,\n  generateDatabaseDeleteTestRunFormFields,\n  generateDatabaseQueryTestRunFormFields,\n  generateDatabaseUpdateTestRunFormFields,\n} from '../utils/generate-crud-nodes-test-run-form-fields';\nimport { type TestFormField } from '../types';\nimport { COMMON_FIELD } from '../constants';\nimport { useGetWorkflowMode, useGlobalState } from '../../../hooks';\nimport { useGetSceneFlowRoleListSchema } from './use-get-scene-flow-role-list-schema';\ntype GenerateTestFormFieldsMap = {\n  [key in StandardNodeType]?: GenerateFn | GenerateAsyncFn;\n} & {\n  default: GenerateFn;\n  batch: GenerateFn;\n  setting: GenerateFn;\n};\n\nexport const useGenerateTestFormFieldsMap = () => {\n  const { isSceneFlow } = useGetWorkflowMode();\n  const { isChatflow } = useGlobalState();\n\n  const nodesService = useService<WorkflowNodesService>(WorkflowNodesService);\n\n  const getSceneFlowRoleListSchema = useGetSceneFlowRoleListSchema();\n  const generateTestFormFieldsMap: GenerateTestFormFieldsMap = {\n    [StandardNodeType.Start]: (formData, context) => {\n      let inputParameters = formData?.outputs || [];\n\n      if (isChatflow) {\n        inputParameters = inputParameters.filter(\n          param => !isPresetStartParams(param.name),\n        );\n      }\n\n      const { node } = context;\n\n      const inputFields = inputParameters.filter(input => {\n        if (input.isPreset && !input.enabled) {\n          return false;\n        }\n        return true;\n      });\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const sortedInputFields = getSortedInputParameters(inputFields) as any;\n\n      return (\n        sortedInputFields\n          .map(input => {\n            if (input.name === roleInformationKeyword && isSceneFlow) {\n              return getSceneFlowRoleListSchema();\n            } else {\n              const workflowVariable =\n                node.context.variableService.getWorkflowVariableByKeyPath(\n                  [node.id, input.name],\n                  context,\n                );\n              if (!workflowVariable) {\n                return null;\n              }\n\n              const jsonSchema = generateInputJsonSchema(\n                workflowVariable.dtoMeta,\n              );\n\n              return {\n                name: input.name,\n                title: input.name,\n                // Default values for variable configurations are written directly into the schema, rather than injected after the form is initialized\n                initialValue: input.defaultValue,\n                ...generateField(\n                  startNodeOldType2VariableType(input.type),\n                  input.required,\n                  input.description,\n                  jsonSchema,\n                ),\n              };\n            }\n          })\n          .filter(Boolean)\n          // Put the perfect scene player information (i.e. role_information) at the end\n          .sort((a, b) => {\n            if (a.name === roleInformationKeyword && isSceneFlow) {\n              return 1;\n            } else if (b.name === roleInformationKeyword && isSceneFlow) {\n              return -1;\n            } else {\n              return 0;\n            }\n          })\n      );\n    },\n\n    [StandardNodeType.Variable]: (formData, context) => {\n      const inputParameter = formData?.inputParameters;\n      if (!inputParameter) {\n        return [];\n      }\n      return generateArrayInputParameters(inputParameter, context);\n    },\n    [StandardNodeType.VariableAssign]: (formData, context) => {\n      const inputParameters =\n        formData?.$$input_decorator$$?.inputParameters?.map(e => ({\n          input: e?.right,\n          name: e?.left?.content?.keyPath?.[1],\n        }));\n\n      return generateArrayInputParameters(inputParameters, context);\n    },\n    [StandardNodeType.SubWorkflow]: (formData, context) => {\n      const inputDefs = formData?.inputs?.inputDefs;\n      if (!inputDefs || !Array.isArray(inputDefs)) {\n        return [];\n      }\n\n      const nodeData = context.node.getData<WorkflowNodeData>(WorkflowNodeData);\n      const detail = nodeData.getNodeData<StandardNodeType.SubWorkflow>();\n      const _isChatflow = detail?.flow_mode === WorkflowMode.ChatFlow;\n\n      const inputData = formData?.inputs?.inputParameters || {};\n      const inputParameters = inputDefs\n        // CONVERSATION_NAME parameters in chatflow do not need to be extracted, and a dedicated session selection component is required\n        .filter(i => (_isChatflow ? i.name !== CONVERSATION_NAME : true))\n        .map(i => ({\n          input: inputData[i.name],\n          name: i.name,\n          required: i.required,\n        }));\n      return generateArrayInputParameters(inputParameters, context);\n    },\n    [StandardNodeType.Api]: (formData, context) => {\n      const { node } = context;\n\n      const nodeData = node.getData<WorkflowNodeData>(WorkflowNodeData);\n\n      const detail = nodeData.getNodeData<StandardNodeType.Api>();\n\n      const inputs = detail?.inputs;\n      if (!inputs || !Array.isArray(inputs)) {\n        return [];\n      }\n      const inputData = formData?.inputs?.inputParameters || {};\n      const inputParameters = inputs.map(i => ({\n        input: inputData[i.name],\n        name: i.name,\n        required: i.required,\n      }));\n      return generateArrayInputParameters(inputParameters, context);\n    },\n    [StandardNodeType.Dataset]: (formData, context) =>\n      generateObjectInputParametersRequired(\n        formData?.inputs?.inputParameters,\n        context,\n        () => true,\n      ),\n    [StandardNodeType.DatasetWrite]: (formData, context) =>\n      generateObjectInputParametersRequired(\n        formData?.inputs?.inputParameters,\n        context,\n        () => true,\n      ),\n    [StandardNodeType.Question]: (formData, context) => {\n      const inputFields = generateArrayInputParameters(\n        formData?.inputParameters,\n        context,\n      );\n      const anwserType = get(formData, 'questionParams.answer_type');\n      const optionType = get(formData, 'questionParams.option_type');\n      if (anwserType !== 'option' || optionType !== OptionType.Dynamic) {\n        return inputFields;\n      }\n      const dynamicOption = get(formData, 'questionParams.dynamic_option');\n      const dynamicField = generateObjectInputParameters(\n        {\n          dynamic_option: dynamicOption,\n        },\n        context,\n      );\n      return [...inputFields, ...dynamicField];\n    },\n    [StandardNodeType.Http]: (formData, context) => {\n      const urlFormFields = generateExpressionString(\n        formData.inputs?.apiInfo?.url,\n        {\n          ...context,\n          labelPrefix: I18n.t('node_http_api'),\n          namePrefix: '__apiInfo_url_',\n        },\n        nodesService,\n      );\n      // The name field is the key submitted to the backend\n      const paramsFormFields = generateArrayInputParameters(\n        formData?.inputs?.params,\n        context,\n      ).map(i => ({\n        ...i,\n        name: `__params_${md5(i.name as string)}`,\n        title: `${I18n.t('node_http_request_params')}-${i.name}`,\n      }));\n\n      const headersFormFields = generateArrayInputParameters(\n        formData?.inputs?.headers,\n        context,\n      ).map(i => ({\n        ...i,\n        name: `__headers_${md5(i.name as string)}`,\n        title: `${I18n.t('node_http_headers')}-${i.name}`,\n      }));\n\n      let authFormFields: TestFormField[] = [];\n      const isAuthOpen = formData.inputs.auth?.authOpen;\n      if (isAuthOpen) {\n        const authType = formData.inputs.auth?.authType;\n        const authDataPathMap = {\n          [AuthType.BasicAuth]: 'auth.authData.basicAuthData',\n          [AuthType.Bearer]: 'auth.authData.bearerTokenData',\n          [AuthType.Custom]: 'auth.authData.customData.data',\n        };\n        authFormFields = generateArrayInputParameters(\n          get(formData.inputs, authDataPathMap[authType]),\n          context,\n        );\n        if (authFormFields.length) {\n          const pathStr = authDataPathMap[authType].split('.').join('_');\n          authFormFields = authFormFields.map(i => ({\n            ...i,\n            name: `__${pathStr}_${i.name}`,\n            title: `${I18n.t('node_http_auth')}-${i.name}`,\n          }));\n        }\n      }\n\n      let bodyFormFields: TestFormField[] = [];\n      const bodyType = formData.inputs.body?.bodyType;\n      const bodyDataPathMap = {\n        [BodyType.Binary]: 'body.bodyData.binary',\n        [BodyType.FormData]: 'body.bodyData.formData',\n        [BodyType.FormUrlEncoded]: 'body.bodyData.formURLEncoded',\n        [BodyType.Json]: 'body.bodyData.json',\n        [BodyType.RawText]: 'body.bodyData.rawText',\n      };\n      const dataPath = bodyDataPathMap?.[bodyType];\n      if (\n        bodyType === BodyType.FormUrlEncoded ||\n        bodyType === BodyType.FormData\n      ) {\n        bodyFormFields = generateArrayInputParameters(\n          get(formData.inputs, dataPath),\n          context,\n        ).map(i => {\n          const prefixName =\n            bodyType === BodyType.FormUrlEncoded\n              ? 'formUrlEncoded'\n              : 'formData';\n\n          const pathStr = dataPath.split('.').join('_');\n          return {\n            ...i,\n            name: `__${pathStr}_${md5(i.name as string)}`,\n            title: `${prefixName}-${i.name}`,\n          };\n        });\n      } else if (bodyType === BodyType.Json || bodyType === BodyType.RawText) {\n        bodyFormFields = generateExpressionString(\n          get(formData.inputs, dataPath),\n          {\n            ...context,\n            labelPrefix: I18n.t('node_http_body'),\n            namePrefix: `__${dataPath.replaceAll('.', '_')}_`,\n          },\n          nodesService,\n        );\n      } else if (bodyType === BodyType.Binary) {\n        bodyFormFields = generateObjectInputParameters(\n          get(formData.inputs, dataPath),\n          context,\n        ).map(i => ({\n          ...i,\n          name: `__${dataPath.replaceAll('.', '_')}_fileURL`,\n          title: `${I18n.t('node_http_body')}-${I18n.t(\n            'node_http_body_binary',\n          )}`,\n        }));\n      }\n\n      return [\n        ...urlFormFields,\n        ...paramsFormFields,\n        ...headersFormFields,\n        ...authFormFields,\n        ...bodyFormFields,\n      ];\n    },\n    [StandardNodeType.Loop]: (formData, context) => [\n      ...generateArrayInputParameters(\n        formData?.inputs?.inputParameters,\n        context,\n      ),\n      ...generateArrayInputParameters(\n        formData?.inputs?.variableParameters,\n        context,\n      ),\n    ],\n    [StandardNodeType.Batch]: (formData, context) => [\n      ...generateArrayInputParameters(\n        formData?.inputs?.inputParameters,\n        context,\n      ),\n    ],\n    [StandardNodeType.LLM]: (formData, context) =>\n      generateArrayInputParameters(\n        formData?.$$input_decorator$$?.inputParameters,\n        context,\n      ),\n    [StandardNodeType.LTM]: (formData, context) =>\n      generateArrayInputParameters(formData?.inputs.inputParameters, context),\n    [StandardNodeType.Intent]: (formData, context) =>\n      generateArrayInputParameters(formData?.inputs.inputParameters, context),\n    [StandardNodeType.SceneChat]: (formData, context) => {\n      const normalInputParameters = formData?.inputParameters.filter(\n        item => item.name !== roleInformationKeyword && isSceneFlow,\n      );\n\n      const inputFields = generateArrayInputParameters(\n        normalInputParameters,\n        context,\n      );\n      const roleListSchema = getSceneFlowRoleListSchema();\n      if (roleListSchema) {\n        inputFields.push(roleListSchema);\n      }\n\n      return inputFields;\n    },\n    [StandardNodeType.SceneVariable]: (formData, context) => {\n      const inputParameter =\n        formData?.mode === 'set' ? formData?.set?.input : formData?.get?.input;\n      if (!inputParameter) {\n        return [];\n      }\n      return generateArrayInputParameters([inputParameter], context);\n    },\n    [StandardNodeType.ImageCanvas]: (formData, context) => [\n      ...generateArrayInputParameters(\n        formData?.inputs?.inputParameters,\n        context,\n      ),\n    ],\n    [StandardNodeType.ImageGenerate]: generateImageflowGenerateTestFormFields,\n    [StandardNodeType.Database]: (formData, context) =>\n      generateArrayInputParameters(formData?.inputParameters, context),\n    [StandardNodeType.TriggerDelete]: (formData, context) =>\n      generateObjectInputParametersRequired(\n        formData?.inputs?.inputParameters,\n        context,\n        key => key === 'userId',\n      ),\n    [StandardNodeType.TriggerRead]: (formData, context) =>\n      generateObjectInputParametersRequired(\n        formData?.inputs?.inputParameters,\n        context,\n        key => key === 'userId',\n      ),\n    [StandardNodeType.TriggerUpsert]: generateUpdateTriggerFields,\n    [StandardNodeType.DatabaseCreate]: generateDatabaseCreateTestRunFormFields,\n    [StandardNodeType.DatabaseDelete]: generateDatabaseDeleteTestRunFormFields,\n    [StandardNodeType.DatabaseQuery]: generateDatabaseQueryTestRunFormFields,\n    [StandardNodeType.DatabaseUpdate]: generateDatabaseUpdateTestRunFormFields,\n\n    default: (formData, context) =>\n      generateArrayInputParameters(formData?.inputParameters, context),\n\n    // default: (formData, context) => {\n    //   const { node } = context;\n    //   const registry = node.getNodeRegistry();\n    //   //Part of the path needs to be processed, for example, some parts start with a backslash and need to be removed\n    //   const inputParametersPath =\n    //     registry?.meta?.inputParametersPath ?? 'inputParameters';\n\n    //   return generateArrayInputParameters(\n    //     get(formData, inputParametersPath),\n    //     context,\n    //   );\n    // },\n    batch: (_, context) => {\n      const { node } = context;\n      const path = node.getNodeMeta()?.batchPath;\n      if (!path) {\n        return [];\n      }\n\n      const batchModePath = [\n        StandardNodeType.SubWorkflow,\n        StandardNodeType.Api,\n      ].includes(node.flowNodeType as StandardNodeType)\n        ? '/inputs/batchMode'\n        : '/batchMode';\n      const batchMode = node\n        .getData(FlowNodeFormData)\n        .formModel.getFormItemValueByPath(batchModePath);\n      if (batchMode !== 'batch') {\n        return [];\n      }\n      const batchData = node\n        .getData(FlowNodeFormData)\n        .formModel.getFormItemValueByPath(path);\n      return generateArrayInputParameters(batchData?.inputLists, context).map(\n        i => {\n          /** Batch needs to be tagged. */\n          if (i.decorator.type === 'FormItem') {\n            const decorator = {\n              ...i?.decorator,\n              ...COMMON_FIELD.decorator,\n              props: {\n                ...i?.decorator?.props,\n                tag: [\n                  i?.decorator?.props?.tag,\n                  I18n.t('workflow_detail_node_batch'),\n                ]\n                  .filter(Boolean)\n                  .join(' - '),\n              },\n            };\n            return {\n              ...i,\n              decorator,\n            };\n          }\n          return i;\n        },\n      );\n    },\n    setting: (_, context) => {\n      const { node } = context;\n      if (node.flowNodeType === StandardNodeType.Batch) {\n        const batchData = node\n          .getData(FlowNodeFormData)\n          .formModel.getFormItemValueByPath('/inputs');\n        return generateObjectInputParameters(\n          pick(batchData, ['batchSize', 'concurrentSize']),\n          context,\n        );\n      } else if (node.flowNodeType === StandardNodeType.Loop) {\n        const data = node\n          .getData(FlowNodeFormData)\n          .formModel.getFormItemValueByPath('/inputs');\n        if (data.loopType === 'count') {\n          return generateObjectInputParameters(\n            pick(data, 'loopCount'),\n            context,\n          );\n        }\n      }\n      return [];\n    },\n  };\n  return generateTestFormFieldsMap;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useMemo, type ReactNode } from 'react';\n\nimport { get } from 'lodash-es';\nimport { FlowNodeFormData } from '@flowgram-adapter/free-layout-editor';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { type WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { GlobalVariableService } from '@coze-workflow/variable';\nimport { type NodeData, WorkflowNodeData } from '@coze-workflow/nodes';\nimport { StandardNodeType, WorkflowMode } from '@coze-workflow/base';\nimport { logger } from '@coze-arch/logger';\nimport { I18n } from '@coze-arch/i18n';\nimport { ComponentType, type infra } from '@coze-arch/bot-api/debugger_api';\nimport { debuggerApi } from '@coze-arch/bot-api';\nimport { Typography } from '@coze-arch/coze-design';\n\nimport { type TestFormField } from '../types';\nimport {\n  BATCH_FIELD_TEMPLATE,\n  SETTING_FIELD_TEMPLATE,\n  getBotFieldTemplate,\n  getConversationTemplate,\n  DATASETS_FIELD_TEMPLATE,\n  FieldName,\n  INPUT_FIELD_TEMPLATE,\n  NODE_FIELD_TEMPLATE,\n  TestFormType,\n} from '../constants';\nimport { WorkflowRunService, ChatflowService } from '../../../services';\nimport { useGlobalState, useTestRunReporterService } from '../../../hooks';\nimport { useTestsetBizCtx } from './use-testset-biz-ctx';\nimport { useTestFormInitialValueV2 } from './use-test-form-initial-value-v2';\nimport { useNeedSceneBot } from './use-need-scene-bot';\nimport { useNeedBot } from './use-need-bot';\nimport { useGetStartNode } from './use-get-start-node';\nimport { useGenerateTestFormFieldsMap } from './use-generate-test-form-fields';\n\ninterface GenerateTestsetFieldOptions {\n  bizCtx: infra.BizCtx;\n  startNodeId: string;\n  workflowId: string;\n  testSetIsTitle?: ReactNode;\n}\n\nconst generateTestsetField = (\n  fields: TestFormField[],\n  options: GenerateTestsetFieldOptions,\n) => {\n  const { startNodeId, workflowId, testSetIsTitle } = options;\n  const testsetField: TestFormField = {\n    ...DATASETS_FIELD_TEMPLATE,\n    children: DATASETS_FIELD_TEMPLATE.children.map(field => {\n      if (field.name === FieldName.DatasetsIs && testSetIsTitle) {\n        return {\n          ...field,\n          component: {\n            ...field.component,\n            props: {\n              ...field.component.props,\n              title: testSetIsTitle,\n            },\n          },\n        };\n      }\n\n      if (field.name === FieldName.DatasetsName) {\n        return {\n          ...field,\n          validator: [\n            ...((field as unknown as { validator: unknown[] }).validator || []),\n            {\n              triggerType: 'onBlur',\n              validator: async (value: string) => {\n                if (!value) {\n                  return true;\n                }\n                const pattern = /^[\\w\\s\\u4e00-\\u9fa5]+$/u;\n                if (!pattern.test(value)) {\n                  return I18n.t('create_plugin_modal_nameerror_cn');\n                }\n                try {\n                  const { isPass } = await debuggerApi.CheckCaseDuplicate({\n                    bizCtx: options.bizCtx,\n                    bizComponentSubject: {\n                      componentID: startNodeId,\n                      componentType: ComponentType.CozeStartNode,\n                      parentComponentID: workflowId,\n                      parentComponentType: ComponentType.CozeWorkflow,\n                    },\n                    caseName: value,\n                  });\n                  return isPass\n                    ? true\n                    : I18n.t('workflow_testset_name_duplicated');\n                } catch (e) {\n                  logger.error({\n                    error: e,\n                    eventName: 'testset_name_validate',\n                  });\n                  return true;\n                }\n              },\n            },\n          ],\n        };\n      }\n      return field;\n    }),\n  };\n  fields.push(testsetField);\n};\n\nconst TestSetIsTitle = ({ onCreate }: { onCreate?: () => void }) => {\n  const { Text } = Typography;\n\n  return (\n    <span>\n      {I18n.t('workflow_testset_save')}\n      <Text\n        link\n        style={{\n          lineHeight: '20px',\n        }}\n        onClick={e => {\n          e.stopPropagation();\n          onCreate?.();\n        }}\n      >\n        {I18n.t('workflow_testset_create')}\n      </Text>\n    </span>\n  );\n};\n\ninterface OptionsType {\n  onCreateTestSet?: () => void;\n  hideGroupLabel?: boolean;\n}\n\n/**\n * Derive testFormSchema from node formData\n * The entire schema is currently constructed as follows:\n * - node []//There will be multiple nodes in the future, so nodes need to be divided into dimensionsdes in the future, so nodes need to be divided into dimensions\n *   //batch and input will be in two groups, because the filed.name of batch and input may be duplicatedame of batch and input may be duplicated\n *   - batch\n *   - input\n *     - string\n *     - number\n *     - ...\n * - bot//he is independent only oneependent and there is only one\n * - testset\n *   - is\n *   - name\n *   - description\n */\nexport const useTestFormSchema = (\n  node?: WorkflowNodeEntity,\n  options?: OptionsType,\n) => {\n  const runService = useService<WorkflowRunService>(WorkflowRunService);\n  const globalVariableService = useService<GlobalVariableService>(\n    GlobalVariableService,\n  );\n  const { generateInitialValues } = useTestFormInitialValueV2();\n  const chatflowService = useService<ChatflowService>(ChatflowService);\n  const reporter = useTestRunReporterService();\n  const { canTestset } = useGlobalState();\n\n  const { getNode } = useGetStartNode();\n\n  const generateTestFormFieldsMap = useGenerateTestFormFieldsMap();\n\n  const bizCtx = useTestsetBizCtx();\n\n  /** If it is a start node, it means it is running in full, otherwise it is running on a single node. */\n  const testFormType = useMemo(() => {\n    if (!node || node.flowNodeType === StandardNodeType.Start) {\n      return TestFormType.Default;\n    }\n    return TestFormType.Single;\n  }, [node, node?.flowNodeType]);\n\n  const { queryNeedBot } = useNeedBot();\n  const { needSceneBot, sceneBotSchema } = useNeedSceneBot(\n    node?.flowNodeType as StandardNodeType,\n  );\n\n  const generate = async () => {\n    let current = node;\n    if (!current) {\n      const startNodeEntity = getNode();\n      if (!startNodeEntity) {\n        return null;\n      }\n      current = startNodeEntity;\n    }\n    const reporterKey = reporter.formSchemaGen.start();\n    const nodeDataEntity = current.getData<WorkflowNodeData>(WorkflowNodeData);\n    const nodeData = nodeDataEntity.getNodeData<keyof NodeData>();\n\n    const formData = current\n      .getData(FlowNodeFormData)\n      .formModel.getFormItemValueByPath('/');\n    const nodeTitle = formData?.nodeMeta?.title;\n\n    /** Part of the computing node shell */\n    const nodeField: TestFormField = {\n      ...NODE_FIELD_TEMPLATE,\n      title: I18n.t('workflow_debug_testonenode_group', {\n        nodeTitle,\n      }),\n      component: {\n        ...NODE_FIELD_TEMPLATE.component,\n        props: {\n          icon: nodeData?.icon || formData?.nodeMeta?.icon,\n          hideGroupLabel: options?.hideGroupLabel,\n        },\n      },\n      children: [],\n    };\n\n    /** Part Compute Node Batch Part */\n    const batchFields = generateTestFormFieldsMap.batch(formData, {\n      node: current,\n    });\n    if (batchFields.length) {\n      nodeField.children.push({\n        ...BATCH_FIELD_TEMPLATE,\n        children: batchFields,\n      });\n    }\n\n    /** Part of computing non-input content */\n    const settingFields = generateTestFormFieldsMap.setting(formData, {\n      node: current,\n    });\n    if (settingFields.length) {\n      nodeField.children.push({\n        ...SETTING_FIELD_TEMPLATE,\n        children: settingFields,\n      });\n    }\n\n    /** Parts Compute Node Input */\n    const generateFn =\n      generateTestFormFieldsMap[current.flowNodeType as StandardNodeType] ||\n      generateTestFormFieldsMap.default;\n\n    const inputFields = await generateFn(formData, {\n      node: current,\n    });\n    if (inputFields.length) {\n      nodeField.children.push({\n        ...INPUT_FIELD_TEMPLATE,\n        children: inputFields,\n      });\n    }\n\n    const fields: TestFormField[] = [];\n\n    const isNeedBotEnv = await queryNeedBot(testFormType, current);\n    const {\n      needBot,\n      needConversation,\n      hasVariableNode,\n      hasVariableAssignNode,\n      hasDatabaseNode,\n      hasLTMNode,\n      hasChatHistoryEnabledLLM,\n      hasConversationNode,\n    } = isNeedBotEnv;\n\n    const isSubflow = current.flowNodeType === StandardNodeType.SubWorkflow;\n    const subflowIsChatflow =\n      get(nodeData, 'flow_mode') === WorkflowMode.ChatFlow;\n\n    // The logic is also implemented in the testset: packages/workflow/playground/src/components/test-run/chat-flow-test-form-panel/testset-bot-project-select\n    // Session class nodes, subflows (Chatflow) cannot select Bot because Bot does not support multi-session\n    // The LTM node cannot select Project because Project does not yet have LTM capabilities\n    const needDisableBot =\n      hasConversationNode || (isSubflow && subflowIsChatflow);\n\n    const botDisableOptions = {\n      disableBot: needDisableBot,\n      disableBotTooltip: needDisableBot ? I18n.t('wf_chatflow_141') : '',\n      disableProject: hasLTMNode,\n      disableProjectTooltip: hasLTMNode ? I18n.t('wf_chatflow_142') : '',\n    };\n\n    if (needBot) {\n      const botTemplate = getBotFieldTemplate(\n        isNeedBotEnv,\n        true,\n        chatflowService,\n      );\n\n      if (botTemplate.children?.[0]) {\n        Object.assign(botTemplate.children[0].component, {\n          props: {\n            hasVariableNode,\n            hasVariableAssignNode,\n            hasDatabaseNode,\n            hasLTMNode,\n            hasChatHistoryEnabledLLM,\n            ...botDisableOptions,\n          },\n        });\n\n        // Pull global variable\n        Object.assign(botTemplate.children[0], {\n          events: {\n            onFormValueChange: _v => {\n              const currentValue = _v.currentTarget?.value || {};\n\n              // Pull global variable when switching\n              globalVariableService.loadGlobalVariables(\n                currentValue.type === 1 ? 'bot' : 'project',\n                currentValue.id,\n              );\n            },\n          },\n        });\n      }\n\n      fields.push(botTemplate);\n    }\n\n    if (needConversation) {\n      const conversationTemplate = getConversationTemplate(chatflowService);\n\n      if (!needBot) {\n        Object.assign(conversationTemplate, {\n          visible: true,\n        });\n        fields.push(conversationTemplate);\n      } else if (fields[0]?.children) {\n        fields[0].children.push(conversationTemplate);\n      }\n    }\n\n    if (nodeField.children.length) {\n      fields.push(nodeField);\n    }\n\n    /**If it is a scene workflow, you need to provide the botID associated with the scene. */\n    if (needSceneBot) {\n      fields.push(sceneBotSchema);\n    }\n\n    /** Parts calculation, form testset field */\n    /** If you need to fill in imported parameters and it is the default mode, also show whether to save to datasets */\n    if (\n      canTestset &&\n      fields.length &&\n      testFormType === TestFormType.Default &&\n      !runService.globalState.config.preview\n    ) {\n      generateTestsetField(fields, {\n        bizCtx,\n        startNodeId: current.id,\n        workflowId: runService.globalState.config.workflowId,\n        testSetIsTitle: options?.onCreateTestSet ? (\n          <TestSetIsTitle onCreate={options?.onCreateTestSet} />\n        ) : undefined,\n      });\n    }\n\n    const schema = {\n      id: current.id,\n      type: testFormType,\n      fields,\n    };\n\n    await generateInitialValues(schema);\n\n    reporter.formSchemaGen.end(reporterKey, {\n      node_type: current.flowNodeType as string,\n    });\n\n    return schema;\n  };\n\n  return { generate };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback } from 'react';\n\nimport { WorkflowMode } from '@coze-workflow/base/api';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\n\nimport { WorkflowRunService } from '@/services';\nimport { useValidateWorkflow } from '@/hooks/use-validate-workflow';\nimport { useFloatLayoutService, useSaveService } from '@/hooks';\nimport { LayoutPanelKey } from '@/constants';\n\nimport { useTestFormSchema } from './use-test-form-schema';\nimport { useGetStartNode } from './use-get-start-node';\n\nexport const useTestRunFlowV2 = () => {\n  const runService = useService<WorkflowRunService>(WorkflowRunService);\n  const floatLayoutService = useFloatLayoutService();\n  const saveService = useSaveService();\n  const { getNode } = useGetStartNode();\n\n  const { validate } = useValidateWorkflow();\n  const { generate } = useTestFormSchema();\n  const validateFlow = useCallback(async () => {\n    const hasError = await validate();\n    if (hasError) {\n      floatLayoutService.open('problemPanel', 'bottom');\n    }\n    return hasError;\n  }, [validate, floatLayoutService]);\n\n  const testRunFlow = useCallback(async () => {\n    const node = getNode();\n    if (!node) {\n      return;\n    }\n    // If the process is being saved, wait for the save to complete\n    await saveService.waitSaving();\n    // Save the process once\n    await saveService.save();\n    // Result of dry run\n    runService.clearTestRun();\n    if (runService.globalState.flowMode === WorkflowMode.ChatFlow) {\n      // If it is chatflow verification, it needs to be blocked.\n      if (await validateFlow()) {\n        return;\n      }\n      floatLayoutService.open(LayoutPanelKey.TestChatFlowForm, 'right', {\n        node,\n      });\n      return;\n    }\n    // The form can be opened first.\n    floatLayoutService.open(LayoutPanelKey.TestFlowForm, 'right', { node });\n    // Stop if the verification is wrong\n    if (await validateFlow()) {\n      return;\n    }\n    const schema = await generate();\n    // Stop if there is a form entry\n    if (schema?.fields.length) {\n      return;\n    }\n    runService.testRun();\n  }, [validateFlow, runService, floatLayoutService]);\n\n  return { testRunFlow };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowDocument } from '@flowgram-adapter/free-layout-editor';\nimport { useGlobalVariableServiceState } from '@coze-workflow/variable';\nimport { ValidateErrorType } from '@coze-workflow/base/api';\nimport { EVENT_NAMES, sendTeaEvent } from '@coze-arch/bot-tea';\n\nimport { useFloatLayoutService } from '@/hooks/use-float-layout-service';\nimport { LayoutPanelKey } from '@/constants';\nimport { useInnerSideSheetStoreShallow } from '@/components/workflow-inner-side-sheet';\n\nimport { START_NODE_ID } from '../constants';\nimport {\n  WorkflowRunService,\n  WorkflowValidationService,\n} from '../../../services';\nimport { useBizIDEState } from '../../../hooks/use-biz-ide-state';\nimport {\n  useExecStateEntity,\n  useGlobalState,\n  useLineService,\n  useWorkflowOperation,\n} from '../../../hooks';\nimport { type NodeError } from '../../../entities/workflow-exec-state-entity';\nimport { useTestRunStatus } from './use-test-run-status';\nimport { useTestFormSchema } from './use-test-form-schema';\n\nexport const useTestRunFlow = () => {\n  const globalState = useGlobalState();\n  const { type: variableScopeType, id } = useGlobalVariableServiceState();\n  const { closeBizIDE } = useBizIDEState();\n\n  const lineService = useLineService();\n\n  const { generate } = useTestFormSchema();\n\n  const execEntity = useExecStateEntity();\n\n  const operation = useWorkflowOperation();\n  const floatLayoutService = useFloatLayoutService();\n\n  const validationService = useService<WorkflowValidationService>(\n    WorkflowValidationService,\n  );\n  const runService = useService<WorkflowRunService>(WorkflowRunService);\n  const workflowDocument = useService<WorkflowDocument>(WorkflowDocument);\n\n  const { setLoading } = useTestRunStatus(START_NODE_ID);\n\n  const backendValidate = async () => {\n    const json = await workflowDocument.toJSON();\n    const validateResult = await operation.validateSchema(\n      json,\n      variableScopeType === 'project' ? { projectId: id } : { botId: id },\n    );\n\n    const isError = !!validateResult?.length;\n\n    const nodeErrorMap = validateResult?.reduce(\n      (errorMap: { [nodeId: string]: NodeError[] }, item) => {\n        let nodeId = item.node_error?.node_id || '';\n\n        let error: NodeError;\n\n        if (\n          item.type === ValidateErrorType.BotConcurrentPathErr ||\n          item.type === ValidateErrorType.BotValidatePathErr\n        ) {\n          nodeId = item.path_error?.start || '';\n          error = {\n            nodeId: item.path_error?.start || '',\n            targetNodeId: item.path_error?.end,\n            errorInfo: item.message || '',\n            errorType: 'line',\n            errorLevel: 'error',\n          };\n        } else {\n          error = {\n            nodeId,\n            errorInfo: item.message || '',\n            errorType: 'node',\n            errorLevel: 'error',\n          };\n        }\n\n        const errors = errorMap[nodeId] || [];\n\n        errors.push(error);\n        errorMap[nodeId] = errors;\n\n        return errorMap;\n      },\n      {},\n    );\n\n    return {\n      isError,\n      nodeErrorMap,\n    };\n  };\n\n  const handleNodeError = (nodeErrorMap?: {\n    [nodeId: string]: NodeError[];\n  }) => {\n    if (nodeErrorMap) {\n      Object.keys(nodeErrorMap).forEach(nodeId => {\n        const nodeError = nodeErrorMap[nodeId];\n        execEntity.setNodeError(nodeId, nodeError);\n      });\n    }\n  };\n\n  const { activeId, closeSideSheet } = useInnerSideSheetStoreShallow();\n  const testRunFlow = async () => {\n    // Try closing the open side window. The closeBizIDE below cannot be deleted because closeBizIDE is asynchronous.\n    closeSideSheet(activeId as string);\n\n    sendTeaEvent(EVENT_NAMES.workflow_testrun_result_front, {\n      space_id: globalState.spaceId,\n      workflow_id: globalState.workflowId,\n      action: 'testrun_start',\n    });\n    setLoading(true);\n    try {\n      /** After the code ide is closed, the test run can be performed */\n      if (!(await closeBizIDE())) {\n        sendTeaEvent(EVENT_NAMES.workflow_testrun_result_front, {\n          space_id: globalState.spaceId,\n          workflow_id: globalState.workflowId,\n          action: 'manual_end',\n        });\n        return;\n      }\n\n      // The result of closing a practice run first\n      runService.clearTestRun();\n\n      /** front-end form validation */\n      const { hasError, nodeErrorMap: feErrorMap } =\n        await validationService.validateWorkflow();\n      if (hasError) {\n        sendTeaEvent(EVENT_NAMES.workflow_testrun_result_front, {\n          space_id: globalState.spaceId,\n          workflow_id: globalState.workflowId,\n          action: 'testrun_end',\n          results: 'fail',\n          fail_end: 'front_end',\n          errtype: 'flow_validate',\n        });\n        execEntity.openSideSheet();\n        handleNodeError(feErrorMap);\n        lineService.validateAllLine();\n        return;\n      }\n\n      /** backend validation */\n      const { isError: backendError, nodeErrorMap: beErrorMap } =\n        await backendValidate();\n      if (backendError) {\n        sendTeaEvent(EVENT_NAMES.workflow_testrun_result_front, {\n          space_id: globalState.spaceId,\n          workflow_id: globalState.workflowId,\n          action: 'testrun_end',\n          results: 'fail',\n          fail_end: 'server_end',\n          errtype: 'flow_validate',\n        });\n        execEntity.openSideSheet();\n        handleNodeError(beErrorMap);\n        lineService.validateAllLine();\n        return;\n      }\n\n      lineService.validateAllLine();\n\n      const testFormSchema = await generate();\n      if (!testFormSchema) {\n        return;\n      }\n      execEntity.closeSideSheet();\n      if (!testFormSchema.fields?.length) {\n        // direct run\n        runService.testRun();\n        return;\n      }\n      runService.testFormState.openTestForm(testFormSchema);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const testRunFlowV2 = () => {\n    runService.clearTestRun();\n    floatLayoutService.open(LayoutPanelKey.TestFlowForm);\n  };\n\n  return { testRunFlow, testRunFlowV2 };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo, useState } from 'react';\n\nimport { WorkflowExecStatus } from '@coze-workflow/base';\nimport { useEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  WorkflowGlobalStateEntity,\n  WorkflowTestFormStateEntity,\n} from '../../../entities';\n\nconst useTestRunStatus = (nodeId: string) => {\n  const globalState = useEntity<WorkflowGlobalStateEntity>(\n    WorkflowGlobalStateEntity,\n  );\n  const testFormState = useEntity<WorkflowTestFormStateEntity>(\n    WorkflowTestFormStateEntity,\n  );\n  const [loading, setLoading] = useState(false);\n  const {\n    config: { saving, saveLoading, viewStatus },\n  } = globalState;\n  const {\n    config: { frozen },\n  } = testFormState;\n\n  const disabled = useMemo(\n    () => !loading && (!!frozen || saving),\n    [loading, frozen, saving],\n  );\n\n  /** Is it a lock triggered by this node? */\n  const isMineRunning = useMemo(\n    () => frozen && frozen === nodeId,\n    [frozen, nodeId],\n  );\n\n  const running = useMemo(\n    () => viewStatus === WorkflowExecStatus.EXECUTING,\n    [viewStatus],\n  );\n\n  return {\n    loading,\n    setLoading,\n    saving,\n    saveLoading,\n    frozen,\n    disabled,\n    isMineRunning,\n    running,\n  };\n};\n\nexport { useTestRunStatus };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport { userStoreService } from '@coze-studio/user-store';\nimport { type infra } from '@coze-arch/bot-api/debugger_api';\n\nimport { TESTSET_CONNECTOR_ID } from '../constants';\nimport { useGlobalState } from '../../../hooks';\n\nconst useTestsetBizCtx = () => {\n  const globalState = useGlobalState();\n\n  const spaceID = globalState.spaceId;\n  const userInfo = userStoreService.useUserInfo();\n  const userID = userInfo?.user_id_str;\n\n  return useMemo<infra.BizCtx>(\n    () => ({\n      bizSpaceID: spaceID,\n      connectorUID: userID,\n      connectorID: TESTSET_CONNECTOR_ID,\n    }),\n    [spaceID, userID],\n  );\n};\n\nexport { useTestsetBizCtx };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { LogImages } from '@coze-workflow/test-run';\nimport { type NodeResult } from '@coze-workflow/base';\n\nimport { useImages } from './use-images';\n\nexport const ImgLogV2: React.FC<{\n  testRunResult: NodeResult;\n  nodeId?: string;\n}> = ({ testRunResult, nodeId }) => {\n  const { images, downloadImages } = useImages(testRunResult, nodeId);\n\n  return <LogImages images={images} onDownload={downloadImages} />;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useState } from 'react';\n\nimport { isEqual } from 'lodash-es';\nimport { NodeExeStatus, type NodeResult } from '@coze-workflow/base';\nimport { parseImagesFromOutputData } from '@coze-workflow/base';\nimport { typeSafeJSONParse } from '@coze-arch/bot-utils';\nimport type { FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport {\n  useService,\n  usePlayground,\n} from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowDocument } from '@flowgram-adapter/free-layout-editor';\n\nimport { useDownloadImages } from '../img-log/use-download-images';\n\nexport function useImages(\n  testRunResult: NodeResult,\n  nodeId?: string,\n): {\n  images: string[];\n  downloadImages: () => void;\n} {\n  const playground = usePlayground();\n\n  const workflowDocument = useService<WorkflowDocument>(WorkflowDocument);\n  const [images, setImages] = useState<string[]>([]);\n\n  const downloadImages = useDownloadImages(images);\n\n  useEffect(() => {\n    async function parseImages() {\n      if (!nodeId) {\n        return;\n      }\n      let outputsValue;\n\n      if (testRunResult?.nodeStatus === NodeExeStatus.Success) {\n        const log =\n          testRunResult?.NodeType === 'End' ||\n          testRunResult?.NodeType === 'Message'\n            ? testRunResult?.input\n            : testRunResult?.output || '';\n\n        outputsValue = typeSafeJSONParse(log);\n      }\n      const node =\n        playground.entityManager.getEntityById<FlowNodeEntity>(nodeId);\n      if (!node) {\n        return;\n      }\n      const workflowJson = await workflowDocument.toNodeJSON(node);\n      const res = parseImagesFromOutputData({\n        outputData: outputsValue,\n        nodeSchema: workflowJson,\n      });\n\n      if (!isEqual(res?.sort(), images?.sort())) {\n        setImages(res);\n      }\n    }\n\n    parseImages();\n  }, [nodeId, workflowDocument, testRunResult, images, playground]);\n\n  return {\n    images,\n    downloadImages,\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\n\nexport function useCurrentNode() {\n  const node = useCurrentEntity();\n  return node;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useGlobalState } from '../../../hooks';\n\nexport function useDownloadImages(images: string[]) {\n  const {\n    info: { name },\n  } = useGlobalState();\n\n  const downloadImages = () => {\n    images.forEach(url => {\n      downloadImage(url, name);\n    });\n  };\n\n  return downloadImages;\n}\n\nasync function downloadImage(imageSrc, name) {\n  const image = await fetch(imageSrc);\n  const imageBlog = await image.blob();\n  const imageURL = URL.createObjectURL(imageBlog);\n\n  const link = document.createElement('a');\n  link.href = imageURL;\n  link.download = name;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useExecStateEntity } from '../../../hooks';\nimport { useCurrentNode } from './use-current-node';\n\nexport function useTestRunResult() {\n  const node = useCurrentNode();\n  const nodeId = node.id;\n  const execState = useExecStateEntity();\n  const testRunResult = execState.getNodeExecResult(nodeId);\n\n  return testRunResult;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useRef, useState } from 'react';\n\nimport { useMutationObserver } from 'ahooks';\n\nexport const useFileDragging = () => {\n  const [fileDragging, setFileDragging] = useState(false);\n  const ref = useRef<HTMLDivElement>(null);\n\n  useMutationObserver(\n    mutationsList => {\n      for (const mutation of mutationsList) {\n        if (\n          mutation.type === 'attributes' &&\n          mutation.attributeName === 'class' &&\n          (mutation.target as HTMLDivElement)?.className?.includes(\n            'semi-upload-drag-area',\n          )\n        ) {\n          setFileDragging(\n            (mutation.target as HTMLDivElement)?.className?.includes(\n              'semi-upload-drag-area-legal',\n            ),\n          );\n        }\n      }\n    },\n    ref,\n    { attributes: true, subtree: true, attributeFilter: ['class'] },\n  );\n\n  return {\n    ref,\n    fileDragging,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport classNames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozUpload } from '@coze-arch/coze-design/icons';\nimport { Button, Tooltip } from '@coze-arch/bot-semi';\n\nimport { MAX_FILE_SIZE, MAX_IMAGE_SIZE } from '@/hooks/use-upload/constant';\nimport { type FileItem } from '@/hooks/use-upload';\nimport styles from '@/components/test-run/test-form-materials/file/index.module.less';\n\nconst genAcceptTips = (accept: string) =>\n  accept.replace('image/*', 'image').replaceAll(',.', ', ');\n\ninterface Props {\n  accept: string;\n  fileType?: string;\n  disabled?: boolean;\n  fileDragging?: boolean;\n\n  fileList?: FileItem[];\n  setFileList?: (v?: FileItem[]) => void;\n}\n\nexport default function CustomUploadNode({\n  accept,\n  fileDragging,\n  disabled,\n  fileType,\n  fileList,\n  setFileList,\n}: Props) {\n  return (\n    <div className={'w-full h-full relative'}>\n      <Tooltip\n        position={'bottom'}\n        content={I18n.t('imageflow_upload_type', {\n          type: genAcceptTips(accept),\n        })}\n      >\n        <div className={styles['custom-upload-drag']}>\n          <div className={'flex flex-col items-center'}>\n            <IconCozUpload\n              style={{ visibility: fileDragging ? 'hidden' : 'visible' }}\n              className={'text-[20px] coz-fg-hglt'}\n            />\n            <span className={'mt-[6px] text-[12px]'}>\n              {fileDragging\n                ? I18n.t('workflow_testset_upload_release')\n                : I18n.t('workflow_testset_upload_title')}\n            </span>\n            <span\n              style={{ visibility: fileDragging ? 'hidden' : 'visible' }}\n              className={'mt-[4px] text-[12px] coz-fg-dim'}\n            >\n              {I18n.t('workflow_testset_upload_content', {\n                xx:\n                  (fileType === 'image' ? MAX_IMAGE_SIZE : MAX_FILE_SIZE) /\n                  (1024 * 1024),\n              })}\n            </span>\n          </div>\n        </div>\n      </Tooltip>\n\n      {fileList && fileList?.length > 0 ? (\n        <div\n          onClick={e => e.stopPropagation()}\n          className={classNames(\n            'w-full flex items-center justify-between text-[12px] cursor-default',\n            styles['custom-upload-drag-actions'],\n          )}\n        >\n          <span className={'coz-fg-primary font-medium  cursor-text'}>\n            {I18n.t('workflow_testset_upload_uploaded')}\n          </span>\n          <Button\n            disabled={disabled}\n            onClick={() => {\n              if (disabled) {\n                return;\n              }\n              setFileList?.([]);\n            }}\n            theme=\"light\"\n            style={{\n              borderColor: 'rgba(var(--coze-bg-1), var(--coze-bg-1-alpha))',\n            }}\n            className={\n              'text-[12px] pl-[3px] pr-[3px] !min-w-0 font-medium !coz-fg-primary bg-background-1'\n            }\n            size={'small'}\n          >\n            {I18n.t('workflow_testset_upload_clean')}\n          </Button>\n        </div>\n      ) : null}\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useRef } from 'react';\n\nimport cls from 'classnames';\nimport { useHover } from 'ahooks';\nimport { IconCozTrashCan } from '@coze-arch/coze-design/icons';\nimport { IconButton, Typography, Spin } from '@coze-arch/coze-design';\nimport type { RenderFileItemProps } from '@coze-arch/bot-semi/Upload';\n\nimport styles from './custom-file-item.module.less';\n\ninterface CustomOperationProps extends RenderFileItemProps {\n  hover?: boolean;\n}\n\nexport const CustomOperation = (props: CustomOperationProps) => {\n  if (props.status === 'uploading') {\n    if (!props.percent) {\n      return (\n        <Spin\n          wrapperClassName={styles['file-icon-loading']}\n          style={{\n            width: 14,\n            height: 14,\n            lineHeight: `${14}px`,\n          }}\n          spinning\n        />\n      );\n    }\n\n    return (\n      <span className={'text-[12px] coz-fg-secondary'}>{props.percent}%</span>\n    );\n  }\n\n  if (props.status === 'success' && !props.hover) {\n    return <span className={'text-[12px] coz-fg-secondary'}>{props.size}</span>;\n  }\n\n  return (\n    <IconButton\n      color={'secondary'}\n      size={'small'}\n      icon={<IconCozTrashCan />}\n      onClick={props.onRemove}\n    />\n  );\n};\n\nexport default function CustomFileItem(props: RenderFileItemProps) {\n  const ref = useRef<HTMLDivElement | null>(null);\n  const hover = useHover(ref);\n\n  return (\n    <div className={'w-full custom-upload-file-item'}>\n      <div\n        ref={ref}\n        className={cls(\n          'w-full h-full flex items-center relative',\n          styles.container,\n        )}\n      >\n        {props.previewFile?.(props)}\n\n        <Typography.Text\n          ellipsis={{\n            showTooltip: {\n              opts: { content: props.name },\n            },\n          }}\n          className={styles.name}\n        >\n          {props.name}\n        </Typography.Text>\n\n        <span className={'text-[12px] flex items-center'}>\n          <CustomOperation {...props} hover={hover} />\n        </span>\n\n        {props.status === 'uploading' && (\n          <div className={styles.progress}>\n            <div\n              className={styles['progress-inner']}\n              style={{\n                width: `${props.percent || 0}%`,\n              }}\n            ></div>\n          </div>\n        )}\n      </div>\n      {props.validateMessage ? (\n        <div className={'coz-fg-hglt-red text-[12px]'}>\n          {props.validateMessage}\n        </div>\n      ) : null}\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport ClickAwayListener from 'react-click-away-listener';\nimport React, { useEffect, useRef } from 'react';\n\nimport { nanoid } from 'nanoid';\nimport classNames from 'classnames';\nimport { useUpdateEffect, useSize } from 'ahooks';\nimport { I18n } from '@coze-arch/i18n';\nimport { Toast } from '@coze-arch/coze-design';\nimport { typeSafeJSONParse } from '@coze-arch/bot-utils';\nimport {\n  type FileItem as SemiFileItem,\n  type RenderFileItemProps,\n} from '@coze-arch/bot-semi/Upload';\nimport { Upload } from '@coze-arch/bot-semi';\nimport { usePersistCallback } from '@coze-arch/hooks';\n\nimport {\n  useUpload,\n  type FileItem,\n  FileItemStatus,\n  formatBytes,\n} from '@/hooks/use-upload';\nimport { useFileDragging } from '@/components/test-run/test-form-materials/file/use-file-dragging';\nimport CustomUploadNode from '@/components/test-run/test-form-materials/file/custom-upload-node';\nimport { FileIcon } from '@/components/file-icon';\n\nimport { type BaseFileProps } from './types';\nimport CustomFileItem from './custom-file-item';\n\nimport styles from './index.module.less';\n\nconst TEST_RUN_FILE_NAME_KEY = 'x-wf-file_name';\n\n/**\n * Generate the file URL and add the file name parameter.\n * When a file is not required, it should return undefined.\n */\nconst getFormatFileUrl = (curFile: FileItem) => {\n  const originUrl = curFile?.url;\n  const fileName = curFile?.name ?? '';\n  try {\n    const urlObj = new URL(originUrl as string);\n    const params = new URLSearchParams(urlObj.search);\n\n    if (params.has(TEST_RUN_FILE_NAME_KEY)) {\n      params.set(TEST_RUN_FILE_NAME_KEY, fileName);\n    } else {\n      params.append(TEST_RUN_FILE_NAME_KEY, fileName);\n    }\n\n    urlObj.search = params.toString();\n\n    return urlObj.toString();\n  } catch (e) {\n    return originUrl;\n  }\n};\n\nconst getParsedFileInfo = (formatUrl: string) => {\n  try {\n    const url = new URL(formatUrl);\n    const params = new URLSearchParams(url.search);\n    const fileName =\n      params.get(TEST_RUN_FILE_NAME_KEY) ?? I18n.t('plugin_file_unknown');\n\n    return {\n      url: formatUrl,\n      uid: nanoid(),\n      name: fileName,\n    };\n  } catch (err) {\n    console.error(`parse file url error: ${formatUrl}`, err);\n    return {\n      url: '',\n      uid: nanoid(),\n      name: I18n.t('plugin_file_unknown'),\n    };\n  }\n};\n\nconst getInitialValue = (val: string, multiple: boolean): FileItem[] => {\n  if (multiple) {\n    const multipleVal = typeSafeJSONParse(val);\n    if (Array.isArray(multipleVal)) {\n      return multipleVal.map(url => getParsedFileInfo(url)) as FileItem[];\n    }\n  }\n  if (val) {\n    return [getParsedFileInfo(val)] as FileItem[];\n  }\n  return [];\n};\n\nexport const FileBaseAdapter: React.FC<BaseFileProps> = props => {\n  const {\n    validateStatus,\n    value,\n    onChange,\n    onBlur,\n    onFocus,\n    accept,\n    multiple,\n    disabled,\n    fileType,\n  } = props;\n\n  const focusRef = useRef(false);\n  const { ref: wrapperRef, fileDragging } = useFileDragging();\n  const wrapperSize = useSize(wrapperRef);\n\n  const maxFileCount = multiple ? 20 : 1;\n\n  const { upload, fileList, isUploading, deleteFile, setFileList } = useUpload({\n    multiple,\n    fileType,\n    accept,\n    maxFileCount,\n  });\n\n  const handleFocus = () => {\n    if (!focusRef.current) {\n      focusRef.current = true;\n      onFocus?.();\n    }\n  };\n  const handleBlur = () => {\n    if (focusRef.current) {\n      focusRef.current = false;\n      onBlur?.();\n    }\n  };\n  const handleClickAway = () => {\n    if (!isUploading) {\n      handleBlur();\n    }\n  };\n\n  const handleUpload = async file => {\n    const { fileInstance } = file;\n    await upload(fileInstance);\n  };\n\n  const getSubmitValue = usePersistCallback((): string | undefined => {\n    let newVal: string | undefined;\n    if (multiple) {\n      const fileUrlList = fileList\n        .filter(item => item.url)\n        .map(item => getFormatFileUrl(item));\n      newVal =\n        fileUrlList?.length > 0 ? JSON.stringify(fileUrlList) : undefined;\n    } else {\n      const singleFile = fileList?.[0];\n      newVal = getFormatFileUrl(singleFile);\n    }\n    return newVal;\n  });\n\n  const handleChange = usePersistCallback(val => onChange?.(val));\n\n  // When the fileList is updated, onChange is triggered.\n  useUpdateEffect(() => {\n    const newVal = getSubmitValue();\n    handleChange?.(newVal);\n  }, [fileList]);\n\n  // When the form value is updated, sync to fileList\n  useEffect(() => {\n    const val = getSubmitValue();\n    if (val !== value) {\n      setFileList(getInitialValue(value as string, multiple));\n    }\n  }, [value]);\n\n  const handleAcceptInvalid = () => {\n    Toast.error(\n      I18n.t('imageflow_upload_error_type', {\n        type: accept,\n      }),\n    );\n  };\n\n  const semiFileList: SemiFileItem[] = fileList.map(file => ({\n    name: file.name,\n    size: file.size !== undefined ? formatBytes(file.size) : '',\n    uid: file.uid || nanoid(),\n    status: file.status || FileItemStatus.Success,\n    url: file.uil,\n    validateMessage: file.validateMessage,\n    percent: file.percent,\n    preview: true,\n  }));\n\n  const renderFileItem = (renderProps: RenderFileItemProps) => (\n    <CustomFileItem {...renderProps} />\n  );\n\n  return (\n    <ClickAwayListener onClickAway={handleClickAway}>\n      <div\n        ref={wrapperRef}\n        className={classNames(styles.container, {\n          [styles['hide-upload-area']]: fileList.length >= maxFileCount,\n          [styles['list-item-wrap']]: wrapperSize && wrapperSize.width > 388,\n        })}\n      >\n        <Upload\n          disabled={disabled}\n          action=\"\"\n          limit={maxFileCount}\n          fileList={semiFileList}\n          data-testid={props['data-testid']}\n          className={validateStatus === 'error' ? 'has-error' : ''}\n          customRequest={handleUpload}\n          draggable={true}\n          dragMainText={I18n.t('imageflow_upload_action_common')}\n          dragSubText={I18n.t('imageflow_upload_type', {\n            type: accept,\n          })}\n          multiple={multiple}\n          accept={accept}\n          onDrop={handleFocus}\n          onOpenFileDialog={handleFocus}\n          onAcceptInvalid={handleAcceptInvalid}\n          previewFile={file => {\n            const { uid } = file;\n            const fileItem = fileList.find(item => item.uid === uid);\n            if (fileItem) {\n              return <FileIcon file={fileItem} size={16} hideLoadingIcon />;\n            }\n          }}\n          onRemove={(currentFile, list, currentFileItem) => {\n            deleteFile(currentFileItem.uid);\n          }}\n          showClear={false}\n          renderFileItem={renderFileItem}\n        >\n          <CustomUploadNode\n            accept={accept}\n            fileType={fileType}\n            disabled={disabled}\n            fileDragging={fileDragging}\n            fileList={fileList}\n            setFileList={setFileList}\n          />\n        </Upload>\n      </div>\n    </ClickAwayListener>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ComponentAdapterCommonProps } from '../../types';\n\nexport enum FileInputType {\n  UPLOAD = 'upload',\n  INPUT = 'input',\n}\n\nexport type FileProps = ComponentAdapterCommonProps<string> & {\n  accept: string;\n  multiple: boolean;\n  disabled?: boolean;\n  fileType: 'object' | 'image' | 'voice';\n  // Support file address input\n  enableInputURL?: boolean;\n  // File input type change event\n  fileInputType?: string;\n  // File input type change event\n  onInputTypeChange?: (v: string) => void;\n  // File type selection class name\n  inputTypeSelectClassName?: string;\n  // URL Enter class name\n  inputURLClassName?: string;\n  containerClassName?: string;\n};\n\nexport type BaseFileProps = Omit<FileProps, 'fileType'> & {\n  fileType: 'object' | 'image';\n  className?: string;\n} & {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useRef } from 'react';\n\nimport { Input } from '@coze-arch/coze-design';\n\nimport { type BaseFileProps } from '../types';\nimport { JsonEditorAdapter } from '../../json-editor';\n\nconst URLInput: React.FC<BaseFileProps> = props => {\n  const { onChange, disabled, multiple, value, onBlur, inputURLClassName } =\n    props;\n\n  const valueRef = useRef<string | undefined>(value);\n\n  if (multiple) {\n    return (\n      <JsonEditorAdapter\n        value={value}\n        onChange={val => {\n          valueRef.current = val;\n          onChange?.(val);\n        }}\n        disabled={disabled}\n        onBlur={() => {\n          if (!valueRef.current) {\n            onChange?.('[]');\n          }\n\n          onBlur?.();\n        }}\n      />\n    );\n  }\n\n  return (\n    <div className={inputURLClassName}>\n      <Input\n        value={value}\n        onChange={v => {\n          onChange?.(v === '' ? undefined : v);\n        }}\n        onBlur={onBlur}\n        disabled={disabled}\n        size=\"small\"\n      />\n    </div>\n  );\n};\n\nexport { URLInput };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Select, type SelectProps } from '@coze-arch/coze-design';\n\nimport { FileInputType } from '../types';\n\ninterface FileInputTypeSelectProps {\n  disabled?: boolean;\n  value: FileInputType;\n  onChange: (v: FileInputType) => void;\n  onBlur?: SelectProps['onBlur'];\n}\n\nexport const FileInputTypeSelect: FC<FileInputTypeSelectProps> = ({\n  disabled,\n  value,\n  onChange,\n  onBlur,\n}) => {\n  const options = [\n    {\n      label: I18n.t('workflow_250310_09', undefined, ''),\n      value: FileInputType.UPLOAD,\n    },\n    {\n      label: I18n.t('workflow_250310_10', undefined, 'URL'),\n      value: FileInputType.INPUT,\n    },\n  ];\n\n  return (\n    <Select\n      size=\"small\"\n      className=\"w-full\"\n      disabled={disabled}\n      value={value}\n      onChange={v => {\n        onChange(v as FileInputType);\n      }}\n      onBlur={onBlur}\n    >\n      {options.map(option => (\n        <Select.Option {...option} />\n      ))}\n    </Select>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport classNames from 'classnames';\n\nimport { type BaseFileProps, FileInputType } from '../types';\nimport { FileBaseAdapter } from '../base-adapter';\nimport { URLInput } from './url-input';\nimport { FileInputTypeSelect } from './type-select';\n\nimport styles from './index.module.less';\n\nexport const TypedFileInput: React.FC<BaseFileProps> = ({\n  fileInputType,\n  onInputTypeChange,\n  ...props\n}) => {\n  const [type, setType] = useState<FileInputType>(\n    (fileInputType as FileInputType) || FileInputType.UPLOAD,\n  );\n\n  return (\n    <div className=\"relative\">\n      <div\n        className={classNames(\n          styles['file-input-type-select'],\n          'overflow-hidden absolute top-[-32px] right-0 w-[95px]',\n          props.inputTypeSelectClassName,\n        )}\n      >\n        <FileInputTypeSelect\n          value={type}\n          onChange={newType => {\n            setType(newType);\n            onInputTypeChange?.(newType);\n          }}\n          disabled={props.disabled}\n        />\n      </div>\n\n      {type === FileInputType.UPLOAD ? (\n        <FileBaseAdapter {...props} />\n      ) : (\n        <URLInput {...props} />\n      )}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type SchemaObject } from 'ajv';\nimport { type MonacoEditor } from '@coze-arch/bot-monaco-editor/types';\n\nconst getGlobalSchemas = (monaco: MonacoEditor) =>\n  monaco.languages.json.jsonDefaults.diagnosticsOptions.schemas || [];\n\n/*  diagnosticsOptions is a global sharing configuration, and overwriting needs to be avoided in multi-instance scenarios */\nexport const setJsonSchema = (\n  monaco: MonacoEditor,\n  schema: SchemaObject,\n  uri: string,\n) => {\n  monaco.languages.json.jsonDefaults.diagnosticsOptions;\n  const schemas = getGlobalSchemas(monaco);\n\n  // During local development, the monaco plug-in is commented out due to performance. You can manually add the plug-in back when developing related functions (apps/bot/edenx.config.ts)\n  monaco.languages.json.jsonDefaults.setDiagnosticsOptions({\n    validate: true,\n    schemaValidation: 'error',\n    schemas: [\n      ...schemas,\n      {\n        uri,\n        fileMatch: [uri],\n        schema,\n      },\n    ],\n  });\n};\n\nexport const clearJsonSchema = (monaco: MonacoEditor, uri: string) => {\n  const schemas = getGlobalSchemas(monaco);\n  const disposedSchema = schemas.filter(schema => schema.uri !== uri);\n\n  monaco.languages.json.jsonDefaults.setDiagnosticsOptions({\n    schemas: disposedSchema,\n  });\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\n\nimport cls from 'classnames';\nimport { type SchemaObject } from 'ajv';\nimport { I18n } from '@coze-arch/i18n';\nimport { UIButton, withField } from '@coze-arch/bot-semi';\nimport {\n  type editor as monacoEditorNameSpace,\n  type OnMount,\n} from '@coze-arch/bot-monaco-editor/types';\nimport { Editor as MonacoEditor } from '@coze-arch/bot-monaco-editor';\nimport { IconCozBroom, IconCozRefresh } from '@coze-arch/coze-design/icons';\nimport { Tooltip } from '@coze-arch/coze-design';\n\nimport type { ComponentAdapterCommonProps } from '../../types';\nimport { clearJsonSchema, setJsonSchema } from './utils';\n\nimport lightStyles from './light.module.less';\nimport styles from './index.module.less';\n\nexport type JSONEditorSchema = SchemaObject;\n\ntype JsonEditorProps = ComponentAdapterCommonProps<string> & {\n  jsonSchema?: JSONEditorSchema;\n  disabled?: boolean;\n  className?: string;\n  options?: monacoEditorNameSpace.IStandaloneEditorConstructionOptions;\n  height?: number;\n  defaultValue?: string;\n} & {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any;\n};\n\nexport const JsonEditorAdapter: React.FC<JsonEditorProps> = ({\n  validateStatus,\n  onBlur,\n  onFocus,\n  jsonSchema,\n  options = {},\n  disabled,\n  value,\n  onChange,\n  className,\n  height,\n  defaultValue,\n  ...props\n}) => {\n  const [focus, setFocus] = useState(false);\n\n  const editorRef = useRef<monacoEditorNameSpace.IStandaloneCodeEditor>();\n\n  const valueRef = useRef<string | undefined>(value);\n\n  const handleChange = val => {\n    // No onchange is required when non-focus, avoid format triggering onchange\n    if (!focus) {\n      return;\n    }\n    if (!val) {\n      valueRef.current = undefined;\n      onChange?.(undefined);\n    } else {\n      valueRef.current = val;\n      onChange?.(val);\n    }\n  };\n\n  const triggerFormat = () => {\n    editorRef.current?.trigger('editor', 'editor.action.formatDocument', {});\n  };\n\n  useEffect(() => {\n    // Automatically format once when externally updating values\n    if (value !== valueRef.current) {\n      triggerFormat();\n    }\n  }, [value]);\n\n  const listenerRef = useRef<\n    {\n      dispose: () => void;\n    }[]\n  >([]);\n\n  const disposeListener = useCallback(() => {\n    listenerRef.current.forEach(listener => listener.dispose());\n    listenerRef.current = [];\n  }, [listenerRef]);\n\n  const handleBlur = useCallback(() => {\n    setFocus(false);\n    onBlur?.();\n  }, [onBlur]);\n\n  const handleFocus = useCallback(() => {\n    setFocus(true);\n    onFocus?.();\n  }, [onFocus]);\n\n  const handleDidMount = useCallback<OnMount>(\n    (editor, monaco) => {\n      editorRef.current = editor;\n\n      const uri = editor.getModel()?.uri.toString();\n\n      disposeListener();\n      const blurListener = editor.onDidBlurEditorWidget(handleBlur);\n      const focusListener = editor.onDidFocusEditorWidget(handleFocus);\n      listenerRef.current = [blurListener, focusListener];\n\n      if (jsonSchema && uri) {\n        setJsonSchema(monaco, jsonSchema, uri);\n        editor.onDidDispose(() => clearJsonSchema(monaco, uri));\n      }\n\n      // Initialization formatting once\n      triggerFormat();\n    },\n    [handleBlur, handleFocus],\n  );\n  useEffect(\n    () => () => {\n      disposeListener();\n    },\n    [disposeListener],\n  );\n\n  const isJsonVerified = useMemo(() => {\n    try {\n      const rs = JSON.parse(value);\n      return typeof rs === 'object';\n      // eslint-disable-next-line @coze-arch/use-error-in-catch\n    } catch (error) {\n      return false;\n    }\n  }, [value]);\n\n  return (\n    <div\n      data-testid={props['data-testid']}\n      className={cls(styles['json-editor'], className)}\n    >\n      <div className=\"w-full h-[36px] px-[8px] rounded-t-[8px] coz-bg-primary flex items-center justify-between\">\n        <div>json</div>\n        <div>\n          {typeof defaultValue !== 'undefined' ? (\n            <Tooltip content={I18n.t('Reset')}>\n              <UIButton\n                className=\"bg-transparent\"\n                disabled={disabled}\n                onClick={() => {\n                  onChange?.(defaultValue);\n                }}\n                icon={<IconCozRefresh />}\n              />\n            </Tooltip>\n          ) : null}\n\n          <Tooltip content={I18n.t('workflow_exception_ignore_format')}>\n            <UIButton\n              className=\"bg-transparent\"\n              disabled={disabled || !isJsonVerified}\n              onClick={() => {\n                try {\n                  const formatJSON = JSON.parse(value as string);\n                  const formatedValue = JSON.stringify(formatJSON, null, 4);\n                  valueRef.current = formatedValue;\n                  onChange?.(formatedValue);\n                } catch (e) {\n                  console.error(e);\n                }\n              }}\n              icon={<IconCozBroom />}\n            />\n          </Tooltip>\n        </div>\n      </div>\n      <div\n        className={cls(\n          'p-[12px] h-[120px] transition-height duration-200 ease-in',\n          {\n            [styles.error]: validateStatus === 'error',\n            [styles.focus]: focus && !height,\n            [styles.disabled]: disabled,\n          },\n        )}\n        style={height ? { height: `${height}px` } : {}}\n      >\n        <MonacoEditor\n          value={value || ''}\n          onChange={handleChange}\n          /** The same theme as ide must be used here, otherwise it may be contaminated */\n          theme=\"icube-dark\"\n          defaultLanguage=\"json\"\n          /** Override icube-dark theme with css style */\n          className={lightStyles.light}\n          options={{\n            fontSize: 13,\n            minimap: {\n              enabled: false,\n            },\n            contextmenu: false,\n            scrollbar: {\n              verticalScrollbarSize: 10,\n              alwaysConsumeMouseWheel: false,\n            },\n            lineNumbers: 'on',\n            lineNumbersMinChars: 3,\n            folding: false,\n            lineDecorationsWidth: 2,\n            renderLineHighlight: 'none',\n            glyphMargin: false,\n            scrollBeyondLastLine: false,\n            overviewRulerBorder: false,\n            wordWrap: 'on',\n            fixedOverflowWidgets: true,\n            readOnly: disabled,\n            ...options,\n          }}\n          onMount={handleDidMount}\n          {...props}\n        />\n      </div>\n    </div>\n  );\n};\n\n// Use the Semi Form context to use in the test set form\nconst JsonEditorSemi = withField(JsonEditorAdapter, {\n  valueKey: 'value',\n  onKeyChangeFnName: 'onChange',\n});\n\nexport { JsonEditorSemi };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Why maintain triggerId so much?\n * The new process fetchStartNodeTriggerFormValue without triggerId, after the initial save, the backend returns triggerId\n * The saved process, when fetchStartNodeTriggerFormValue, will return triggerId\n * The acquisition time is different, and it is more troublesome to hard-plug the triggerId into formData, so it is directly maintained in the cacheTriggerId.\n */\nconst cacheTriggerId: Record<string, string> = {};\nexport const setTriggerId = (wfId: string, triggerId: string) => {\n  cacheTriggerId[wfId] = triggerId;\n};\n\nexport const getTriggerId = (wfId: string) => cacheTriggerId[wfId];\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * The trigger node triggers the practice run button\n */\nimport { useMemo, useState } from 'react';\n\nimport { getTriggerId } from '@coze-workflow/nodes';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozPlayCircle,\n  IconCozStopCircle,\n} from '@coze-arch/coze-design/icons';\nimport { IconButton, Tooltip, type ButtonProps } from '@coze-arch/coze-design';\n\nimport { useValidateWorkflow } from '@/hooks/use-validate-workflow';\nimport {\n  useWorkflowRunService,\n  useGlobalState,\n  useTestFormState,\n  useExecStateEntity,\n  useFloatLayoutService,\n  useTestRunReporterService,\n} from '@/hooks';\n\ntype TriggerTestRunButtonProps = Pick<\n  ButtonProps,\n  'size' | 'color' | 'className'\n> & {\n  triggerId?: string;\n};\n\nexport const TriggerTestRunButton: React.FC<\n  TriggerTestRunButtonProps\n> = props => {\n  const globalState = useGlobalState();\n  const testFormState = useTestFormState();\n  const runService = useWorkflowRunService();\n  const execState = useExecStateEntity();\n  const { validate } = useValidateWorkflow();\n  const testRunReporterService = useTestRunReporterService();\n  const floatLayoutService = useFloatLayoutService();\n  const {\n    config: { saving },\n    workflowId,\n  } = globalState;\n  const {\n    config: { frozen },\n  } = testFormState;\n  const {\n    config: { executeId },\n  } = execState;\n\n  const [canceling, setCanceling] = useState(false);\n  /** The triggerId is directly obtained from a cache map, not reactive, and may not be available when the component is initialized */\n  const [innerTriggerId, setInnerTriggerId] = useState(\n    props.triggerId ?? getTriggerId(workflowId),\n  );\n\n  /**\n   * No practice running\n   * 1. Saving process\n   * 2. Process in freeze\n   */\n  const disabled = useMemo(() => saving || !!frozen, [saving, frozen]);\n\n  /**\n   * Cancel practice run\n   * 1. When the process is frozen and is triggered by this triggerId\n   * 2. Existence of executeId\n   * When the process is in a frozen state and the frozen id is equal to this triggerId, the execution can be cancelled through this component\n   */\n  const canCancel = useMemo(\n    () => !!frozen && frozen === innerTriggerId && !!executeId,\n    [frozen, innerTriggerId, executeId],\n  );\n\n  const handleTestRun = async () => {\n    testRunReporterService.tryStart({\n      scene: 'trigger',\n    });\n    if (await validate()) {\n      floatLayoutService.open('problemPanel', 'bottom');\n      return;\n    }\n    /** Update the triggerId before running. */\n    const next = innerTriggerId ? innerTriggerId : getTriggerId(workflowId);\n    if (innerTriggerId !== next && next) {\n      setInnerTriggerId(next);\n    }\n    if (next) {\n      runService.testRunTrigger(next);\n    }\n  };\n  const handleCancelTestRun = async () => {\n    try {\n      setCanceling(true);\n      await runService.cancelTestRun();\n    } finally {\n      setCanceling(false);\n    }\n  };\n\n  if (canCancel) {\n    return (\n      <Tooltip\n        content={I18n.t('workflow_testrun_one_node_cancel_run_tooltips')}\n      >\n        <IconButton\n          color=\"secondary\"\n          disabled={canceling}\n          onClick={handleCancelTestRun}\n          icon={<IconCozStopCircle />}\n        />\n      </Tooltip>\n    );\n  }\n\n  return (\n    <IconButton\n      color=\"secondary\"\n      disabled={disabled}\n      onClick={handleTestRun}\n      icon={<IconCozPlayCircle />}\n      {...props}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback } from 'react';\n\nimport {\n  useEntityFromContext,\n  useService,\n} from '@flowgram-adapter/free-layout-editor';\nimport { type WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { useValidationService } from '@coze-workflow/base/services';\nimport { StandardNodeType, useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozPlayFill,\n  IconCozStopCircle,\n} from '@coze-arch/coze-design/icons';\nimport { IconButton, Tooltip, Toast } from '@coze-arch/coze-design';\n\nimport { WorkflowRunService } from '@/services';\nimport { LayoutPanelKey } from '@/constants';\n\nimport { useTestRunStatus } from '../hooks/use-test-run-status';\nimport { useTestFormSchema } from '../hooks/use-test-form-schema';\nimport { useCancelTestRun } from '../hooks/use-cancel-test-run';\nimport {\n  useGlobalState,\n  useTestFormState,\n  useNodeRenderScene,\n  useFloatLayoutService,\n  useTestRunReporterService,\n} from '../../../hooks';\n\nexport const TestRunSingleNodeButton: React.FC = () => {\n  const node = useEntityFromContext<WorkflowNodeEntity>();\n  const { getNodeSetterId } = useNodeTestId();\n  const floatLayoutService = useFloatLayoutService();\n  const validationService = useValidationService();\n  const testRunReporterService = useTestRunReporterService();\n  const { isNodeSideSheet } = useNodeRenderScene();\n  const runService = useService<WorkflowRunService>(WorkflowRunService);\n  const { playgroundProps } = useGlobalState();\n\n  const { loading, disabled, isMineRunning } = useTestRunStatus(node.id);\n  const testFormState = useTestFormState();\n  const { cancelTestRun, canceling } = useCancelTestRun();\n  const { generate } = useTestFormSchema(node);\n\n  const handleOpenTestFormV2 = useCallback(\n    async e => {\n      e.stopPropagation();\n\n      testRunReporterService.tryStart({\n        scene: 'node',\n      });\n\n      const { hasError } = await validationService.validateNode(node);\n\n      if (hasError) {\n        Toast.error({\n          content: I18n.t('workflow_detail_toast_validation_failed'),\n          showClose: false,\n        });\n      }\n\n      if (isNodeSideSheet) {\n        if (hasError) {\n          return;\n        }\n\n        testFormState.showTestNodeForm();\n      } else {\n        floatLayoutService.open(LayoutPanelKey.NodeForm, 'right', {\n          node,\n          showTestNodeForm: !hasError,\n        });\n\n        if (hasError) {\n          return;\n        }\n\n        testFormState.showTestNodeForm();\n      }\n      const schema = await generate();\n      if (schema?.fields.length) {\n        return;\n      }\n      runService.clearTestRun();\n      runService.testRunOneNode({ nodeId: node.id });\n    },\n    [testFormState],\n  );\n\n  /**\n   * - condition, start, end no single node operation required\n   * - Globally configure whether canTestRun can practice running\n   * - Process component property configuration disabledSingleNodeTest whether to disable single node practice run\n   */\n  if (\n    [\n      StandardNodeType.Start,\n      StandardNodeType.End,\n      StandardNodeType.If,\n    ].includes(node.flowNodeType as StandardNodeType) ||\n    playgroundProps.disabledSingleNodeTest ||\n    !node.getNodeRegistry()?.meta?.test\n  ) {\n    return null;\n  }\n\n  if (isMineRunning) {\n    return (\n      <Tooltip\n        key={`${node.id}-cancel-test-run`}\n        content={I18n.t('workflow_testrun_one_node_cancel_run_tooltips')}\n      >\n        <IconButton\n          color=\"secondary\"\n          size={isNodeSideSheet ? 'default' : 'small'}\n          icon={<IconCozStopCircle />}\n          onClick={cancelTestRun}\n          disabled={canceling}\n          data-testid={getNodeSetterId('testonenode_cancel')}\n        />\n      </Tooltip>\n    );\n  }\n\n  return (\n    <Tooltip\n      key={`${node.id}-test-run`}\n      content={I18n.t('workflow_debug_testonenode')}\n    >\n      <IconButton\n        color=\"secondary\"\n        size={isNodeSideSheet ? 'default' : 'small'}\n        disabled={disabled}\n        icon={<IconCozPlayFill />}\n        onClick={handleOpenTestFormV2}\n        loading={loading}\n        data-testid={getNodeSetterId('testonenode')}\n      />\n    </Tooltip>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useState } from 'react';\n\nimport { useEntity } from '@flowgram-adapter/free-layout-editor';\nimport { BaseTestButton } from '@coze-workflow/test-run';\nimport { I18n } from '@coze-arch/i18n';\nimport { type ButtonProps } from '@coze-arch/coze-design';\n\nimport { useTestRunReporterService, useGlobalState } from '@/hooks';\n\nimport { useTestRunFlowV2 } from '../hooks/use-test-run-flow-v2';\n\ntype StartTestRunButtonProps = Pick<ButtonProps, 'size'>;\n\nimport { WorkflowTestFormStateEntity } from '../../../entities';\n\nexport const StartTestRunButton: React.FC<StartTestRunButtonProps> = props => {\n  const [loading, setLoading] = useState(false);\n  const testFormState = useEntity<WorkflowTestFormStateEntity>(\n    WorkflowTestFormStateEntity,\n  );\n  const {\n    config: { frozen },\n  } = testFormState;\n  const { projectId, projectCommitVersion } = useGlobalState();\n\n  const disabled = !!frozen || loading || !!(projectId && projectCommitVersion);\n  const testRunReporterService = useTestRunReporterService();\n  const { testRunFlow } = useTestRunFlowV2();\n\n  return (\n    <BaseTestButton\n      disabled={disabled}\n      onClick={async () => {\n        testRunReporterService.tryStart({\n          scene: 'toolbar',\n        });\n        try {\n          setLoading(true);\n          await testRunFlow();\n        } finally {\n          setLoading(false);\n        }\n      }}\n      {...props}\n    >\n      {I18n.t('workflow_detail_title_testrun')}\n    </BaseTestButton>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ViewVariableType } from '@coze-workflow/base';\n\nexport const genFileTypeByViewVarType = type => {\n  if ([ViewVariableType.Voice].includes(type)) {\n    return 'voice';\n  }\n\n  if ([ViewVariableType.Image, ViewVariableType.ArrayImage].includes(type)) {\n    return 'image';\n  }\n\n  return 'object';\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type ObjectRefExpression,\n  type InputValueVO,\n  ValueExpressionType,\n} from '@coze-workflow/base';\n\ninterface InputObjectRefVO extends InputValueVO {\n  input: ObjectRefExpression;\n}\n\n/**\n * Is there a variable reference?\n * @param vos\n * @returns\n */\nfunction hasRef(vos?: InputValueVO[]): boolean {\n  if (!vos?.length) {\n    return false;\n  }\n\n  return vos.some(\n    vo => vo.input?.type === ValueExpressionType.REF || hasRef(vo.children),\n  );\n}\n\n/**\n * Is it a static object ref?\n * Inside are the constants used\n */\nexport function isStaticObjectRef(value: InputObjectRefVO): boolean {\n  const input = value?.input;\n\n  if (input?.type !== ValueExpressionType.OBJECT_REF) {\n    return false;\n  }\n\n  return !hasRef(value.children);\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isBoolean, isNumber } from 'lodash-es';\n\n// Convert form values to testrun interface protocol format\nconst stringifyValue = (\n  values: object,\n  stringifyKeys?: string[],\n): Record<string, string> | undefined => {\n  if (!values) {\n    return undefined;\n  }\n  return Object.entries(values).reduce<Record<string, string>>(\n    (buf, [k, v]) => {\n      if (isBoolean(v) || isNumber(v)) {\n        buf[k] = String(v);\n      } else if (stringifyKeys?.includes(k)) {\n        buf[k] = JSON.stringify(v);\n      } else {\n        buf[k] = v as string;\n      }\n      return buf;\n    },\n    {},\n  );\n};\n\n// Ensure that the default values passed in are of type string; the values in the current form are of type string, which can be handled simply. Multiple default value types may be required for verification in the future.\nconst stringifyDefaultValue = (value: object) => {\n  if (!value) {\n    return undefined;\n  }\n  return Object.keys(value).reduce((acc, key) => {\n    const val = value[key];\n    // Bool needs special treatment\n    if (typeof val === 'string' || isBoolean(val)) {\n      acc[key] = val;\n    } else {\n      acc[key] = JSON.stringify(value[key]);\n    }\n    return acc;\n  }, {});\n};\n\nexport { stringifyValue, stringifyDefaultValue };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum TemplateCompZIndex {\n  TemplateSildeButton = 1,\n  TemplatePreview = 9999,\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useState, useRef } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Modal } from '@coze-arch/coze-design';\n\nimport { useGlobalState, useDependencyEntity } from '@/hooks';\n\nimport styles from './index.module.less';\n\nexport const WorkflowRefreshModal = () => {\n  const ref = useRef<HTMLDivElement>(null);\n  const [isLoading, setLoading] = useState(false);\n  const workflowState = useGlobalState();\n  const dependencyEntity = useDependencyEntity();\n\n  const handleOk = () => {\n    setLoading(true);\n    dependencyEntity.refreshFunc?.();\n    workflowState.updateConfig({\n      savingError: false,\n    });\n    workflowState.getProjectApi()?.setWidgetUIState('normal');\n    dependencyEntity.setRefreshModalVisible(false);\n    setLoading(false);\n  };\n\n  return (\n    <div ref={ref}>\n      <Modal\n        icon={null}\n        title={I18n.t('pop_up_title_data_conflict', {}, '')}\n        okText={I18n.t('pop_up_button_refresh', {}, '')}\n        width={320}\n        visible={dependencyEntity.refreshModalVisible}\n        hasCancel={false}\n        closable={false}\n        onOk={handleOk}\n        className={styles['refresh-modal-content']}\n        closeOnEsc={false}\n        confirmLoading={isLoading}\n        getPopupContainer={() => ref?.current || document.body}\n      >\n        {I18n.t(\n          'pop_up_description_data_conflict',\n          {},\n          '',\n        )}\n      </Modal>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * This component provides a sidesheet rendering space in the workflow canvas, so that the sidesheet space in the canvas can squeeze the canvas to achieve some side-pull interaction\n * In this space, the semi-ui SideSheet is still used by default to render the pull window, keeping development simple\n */\n\nimport { WORKFLOW_OUTER_SIDE_SHEET_HOLDER } from '../../constants';\n\nimport styles from './index.module.less';\n\nexport const WorkflowOuterSideSheetHolder = () => (\n  <div\n    id={WORKFLOW_OUTER_SIDE_SHEET_HOLDER}\n    className={styles.workflowOuterSideSheetHolder}\n  ></div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Display the information that the current workflow is referenced by other workflows in the upper left corner of the header\n */\n\nimport React, { type FC, useState } from 'react';\n\nimport { isEmpty } from 'lodash-es';\nimport { type Workflow } from '@coze-workflow/base/api';\nimport { I18n } from '@coze-arch/i18n';\nimport { Tag } from '@coze-arch/coze-design';\nimport { UIButton, List, Popover } from '@coze-arch/bot-semi';\nimport { IconSmallTriangleDown, IconClose } from '@douyinfe/semi-icons';\n\nimport { getWorkflowHeaderTestId } from '../workflow-header/utils';\nimport { getWorkflowUrl } from '../../utils/get-workflow-url';\nimport { useWorkflowReferences } from '../..//hooks/use-workflow-references';\n\nimport styles from './references-tip.module.less';\n\ninterface WorkflowReferences {\n  workflowList?: Workflow[];\n}\n\nconst ReferencingList: FC<\n  WorkflowReferences & {\n    onClose: () => void;\n  }\n> = props => {\n  const { workflowList, onClose } = props;\n  const MAX_RECENT_WORKFLOWS = 30;\n  return (\n    <div className={styles.workflowReferencingListWrapper}>\n      <IconClose\n        onClick={onClose}\n        className={styles.close}\n        data-testid={getWorkflowHeaderTestId('referencing', 'close')}\n      />\n      <div className={styles.workflowReferencingListTitle}>\n        {I18n.t('workflow_detail_node_workflows_referencing', {\n          number: workflowList?.length,\n        })}\n      </div>\n      <div className={styles.workflowReferencingListDesc}>\n        {I18n.t('workflow_detail_node_workflows_referencing_tip', {\n          number: workflowList?.length,\n        })}\n      </div>\n      <List className={styles.workflowReferencingList}>\n        {workflowList?.slice(0, MAX_RECENT_WORKFLOWS)?.map(workflow => (\n          <List.Item\n            key={workflow.workflow_id}\n            className={styles.workflowReferencingListItem}\n            data-testid={getWorkflowHeaderTestId(\n              'referencing',\n              'subworkflow',\n              workflow.workflow_id ?? '',\n            )}\n          >\n            <img className={styles.icon} src={workflow.url} height={32} />\n            <div className={styles.name}>{workflow.name}</div>\n            <UIButton\n              className={styles.btn}\n              type=\"secondary\"\n              data-testid={getWorkflowHeaderTestId(\n                'referencing',\n                'subworkflow',\n                workflow.workflow_id ?? '',\n                'viewdetail',\n              )}\n              onClick={() => {\n                const referencesUrl = getWorkflowUrl({\n                  space_id: workflow.space_id ?? '',\n                  workflow_id: workflow.workflow_id ?? '',\n                });\n                window.open(referencesUrl, '_blank');\n              }}\n            >\n              {I18n.t('binding_view_card')}\n            </UIButton>\n          </List.Item>\n        ))}\n      </List>\n      {!!workflowList && workflowList.length >= MAX_RECENT_WORKFLOWS && (\n        <div className={styles.footer}>\n          {I18n.t('workflow_detail_node_workflows_max', {\n            number: MAX_RECENT_WORKFLOWS,\n          })}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport const WorkflowReferencesTip = () => {\n  const [visible, setVisible] = useState(false);\n\n  const { references } = useWorkflowReferences();\n\n  const toggleVisible = () => setVisible(!visible);\n\n  const closePopover = () => setVisible(false);\n\n  const handleClose = () => closePopover();\n\n  const handleClickTag = () => toggleVisible();\n\n  const handleClickOutSide = () => closePopover();\n\n  if (isEmpty(references?.workflowList)) {\n    return null;\n  }\n\n  return (\n    <Popover\n      position=\"bottomLeft\"\n      trigger=\"custom\"\n      content={<ReferencingList {...references} onClose={handleClose} />}\n      visible={visible}\n      onClickOutSide={handleClickOutSide}\n    >\n      <Tag\n        onClick={handleClickTag}\n        data-testid={getWorkflowHeaderTestId('reference', 'tag')}\n        suffixIcon={<IconSmallTriangleDown />}\n        size=\"mini\"\n        color=\"primary\"\n      >\n        {I18n.t('workflow_detail_node_workflows_referencing', {\n          number: references?.workflowList?.length,\n        })}\n      </Tag>\n    </Popover>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\n/* eslint-disable @typescript-eslint/consistent-type-assertions */\nimport { useExecStateEntity } from '../../../../../hooks';\nimport { type NodeError } from '../../../../../entities/workflow-exec-state-entity';\n\nexport const useNodeErrorList = () => {\n  const { nodeErrors } = useExecStateEntity();\n\n  const nodeErrorList = Object.keys(nodeErrors).reduce(\n    (list, nodeId: string) => {\n      const nodeError = nodeErrors[nodeId].filter(\n        item => item.errorType === 'node',\n      );\n\n      const errors = nodeError.filter(item => item.errorLevel === 'error');\n      const warnings = nodeError.filter(item => item.errorLevel === 'warning');\n\n      const results = errors.length > 0 ? errors : warnings;\n      if (results.length > 0) {\n        return [\n          ...list,\n          {\n            nodeId,\n            errorInfo: results.map(error => error.errorInfo).join(';'),\n            errorLevel: results[0].errorLevel,\n            errorType: 'node',\n          } as NodeError,\n        ];\n      }\n\n      return list;\n    },\n    [] as NodeError[],\n  );\n\n  return {\n    nodeErrorList,\n    hasNodeError: nodeErrorList.length > 0,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport { useExecStateEntity } from '../../../../../hooks';\nimport { type NodeError } from '../../../../../entities/workflow-exec-state-entity';\n\nexport const useLineErrorList = () => {\n  const { nodeErrors } = useExecStateEntity();\n\n  const lineErrorList = Object.keys(nodeErrors).reduce(\n    (list, nodeId: string) => {\n      const lineErrors = nodeErrors[nodeId].filter(\n        item => item.errorType === 'line',\n      );\n\n      return [...list, ...lineErrors];\n    },\n    [] as NodeError[],\n  );\n\n  return {\n    lineErrorList,\n    hasLineError: lineErrorList.length > 0,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport { useExecStateEntity } from '../../../../../hooks';\nimport { useNodeErrorList } from './use-node-error-list';\nimport { useLineErrorList } from './use-line-error-list';\n\nexport const useHasError = (options?: { withWarning: boolean }) => {\n  const { withWarning = true } = options ?? {};\n  const { hasLineError } = useLineErrorList();\n  const { nodeErrorList } = useNodeErrorList();\n  let hasNodeError = nodeErrorList.length > 0;\n  if (!withWarning) {\n    hasNodeError =\n      nodeErrorList.filter(error => error.errorLevel !== 'warning').length > 0;\n  }\n\n  const {\n    config: { systemError },\n  } = useExecStateEntity();\n\n  return hasLineError || hasNodeError || !!systemError;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport React from 'react';\n\nimport classNames from 'classnames';\nimport { WorkflowExeStatus } from '@coze-workflow/base/api';\nimport { WorkflowExecStatus } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozLoading,\n  IconCozWarningCircleFill,\n} from '@coze-arch/coze-design/icons';\nimport { Divider } from '@coze-arch/coze-design';\nimport {\n  IconWorkflowRunSuccess,\n  IconWorkflowRunFail,\n} from '@coze-arch/bot-icons';\n\nimport { useHasError } from '../hooks/use-has-error';\nimport { TestRunCostPopover } from '../../test-run-cost-popover';\nimport { COLOR_STYLE_MAP } from '../../../../workflow-header/constants';\nimport { useTestRun } from '../../../../../hooks/use-test-run';\nimport { useGlobalState, useExecStateEntity } from '../../../../../hooks';\n\nimport styles from './index.module.less';\n\nconst loadingStyle = {\n  backgroundColor: 'var(--light-color-cyan-cyan-1,#c5f3f6)',\n  color: '#0195ad',\n};\n\nconst commonClassNames = classNames(\n  'flex items-center',\n  'h-5',\n  'w-fit',\n  'rounded-medium',\n  'px-2 py-[2px]',\n  'font-medium',\n  'text-[12px]',\n);\n\ninterface Props {\n  hiddenStateText?: boolean;\n  extra?: React.ReactNode;\n  onClick?: () => void;\n}\n\nexport const ExecuteState = ({ hiddenStateText, extra, onClick }: Props) => {\n  const { viewStatus } = useGlobalState();\n\n  const execEntity = useExecStateEntity();\n  const {\n    executeStatus,\n    tokenAndCost = {},\n    workflowExeCost,\n  } = execEntity.config;\n\n  const { hasNodeResult } = execEntity;\n\n  const { isCanceled } = useTestRun();\n\n  // Containing warnings is still considered successful\n  const hasError = useHasError({\n    withWarning: false,\n  });\n\n  const loading =\n    viewStatus === WorkflowExecStatus.EXECUTING ||\n    executeStatus === WorkflowExeStatus.Running;\n\n  // That is, there is no running result, and there is no verification error, indicating that it has not been run and has no running state.\n  if (!hasNodeResult && !hasError && !loading) {\n    return extra ? (\n      <span\n        className={'flex items-center text-[14px] pl-8px pr-8px'}\n        onClick={onClick}\n      >\n        {extra}\n      </span>\n    ) : null;\n  }\n\n  const isSuccess = executeStatus === WorkflowExeStatus.Success && !hasError;\n\n  const getStyle = () => {\n    if (loading) {\n      return loadingStyle;\n    }\n    if (isCanceled) {\n      return COLOR_STYLE_MAP.Tertiary;\n    }\n    if (isSuccess) {\n      return COLOR_STYLE_MAP.Success;\n    }\n    return COLOR_STYLE_MAP.Danger;\n  };\n\n  const style = getStyle();\n\n  const TokenCost = () => (\n    <div className=\"cursor-pointer max-w-[200px] overflow-hidden text-ellipsis whitespace-nowrap\">\n      {tokenAndCost.totalTokens ?? '-'}\n    </div>\n  );\n\n  const ExecuteStatus = () => {\n    const StatusIcon = () => {\n      if (loading) {\n        return <IconCozLoading className=\"animate-spin mr-1  text-[#0195AD]\" />;\n      }\n      if (isCanceled) {\n        return <IconCozWarningCircleFill />;\n      }\n      if (isSuccess) {\n        return <IconWorkflowRunSuccess className={styles['success-icon']} />;\n      }\n      return <IconWorkflowRunFail />;\n    };\n\n    const statusText = (() => {\n      if (loading) {\n        if (hiddenStateText) {\n          return workflowExeCost;\n        }\n\n        return `${I18n.t(\n          'workflow_detail_title_testrun_running',\n        )} ${workflowExeCost}`;\n      }\n      if (isCanceled) {\n        if (hiddenStateText) {\n          return '0.000s';\n        }\n        return I18n.t('workflow_node_stoprun');\n      }\n      if (!hasNodeResult) {\n        if (hiddenStateText) {\n          return '0.000s';\n        }\n        return I18n.t('worklfow_without_run');\n      }\n      if (isSuccess) {\n        if (hiddenStateText) {\n          return workflowExeCost;\n        }\n        return `${I18n.t(\n          'workflow_detail_title_testrun_finished',\n        )} ${workflowExeCost}`;\n      }\n      return I18n.t('workflow_running_results_run_failed');\n    })();\n\n    return (\n      <>\n        <StatusIcon />\n        <span className=\"ml-2\">{statusText}</span>\n      </>\n    );\n  };\n\n  if (!hasNodeResult) {\n    return (\n      <div className={commonClassNames} style={style} onClick={onClick}>\n        {<ExecuteStatus />}\n      </div>\n    );\n  }\n\n  return (\n    <TestRunCostPopover tokenAndCost={tokenAndCost}>\n      <div className=\"w-full\" onClick={onClick}>\n        <div className={commonClassNames} style={style}>\n          {<ExecuteStatus />}\n\n          <div\n            className={classNames('h-3 w-[1px]', 'mx-1')}\n            style={{ backgroundColor: style.color }}\n          />\n\n          <TokenCost />\n\n          {extra ? (\n            <>\n              <Divider layout=\"vertical\" margin={'4px'} />\n              <span className={'flex items-center text-[12px]'}>{extra}</span>\n            </>\n          ) : null}\n        </div>\n      </div>\n    </TestRunCostPopover>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { VCSCanvasType } from '@coze-workflow/base/api';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozCheckMarkCircleFillPalette } from '@coze-arch/coze-design/icons';\nimport { Tag } from '@coze-arch/coze-design';\n\nimport { useGlobalState } from '../../../hooks';\n\n/*\n  Distinguish between single-player mode and collaborative mode.\n  Single-player mode: as long as it has been published, it shows that it has been published;\n  Collaboration Mode: Display current status, draft | submit | publish\n*/\nexport const PublishStatus = () => {\n  const { info, config } = useGlobalState();\n  const { vcsData } = info;\n  const { autoSaveTime } = config;\n  const { type } = vcsData || {};\n  const { operator } = info.operationInfo || {};\n\n  const renderIcon = () => {\n    if (type === VCSCanvasType.Submit) {\n      return (\n        <IconCozCheckMarkCircleFillPalette className=\"coz-fg-color-blue\" />\n      );\n    }\n    if (type === VCSCanvasType.Publish) {\n      return (\n        <IconCozCheckMarkCircleFillPalette className=\"coz-fg-hglt-green\" />\n      );\n    }\n    return null;\n  };\n\n  const renderText = () => {\n    if (type === VCSCanvasType.Draft) {\n      return I18n.t('workflow_publish_multibranch_auto_saved', {\n        time: autoSaveTime,\n      });\n    }\n    if (type === VCSCanvasType.Submit) {\n      return I18n.t('workflow_publish_multibranch_submitted', {\n        name: operator?.name || '',\n        time: autoSaveTime,\n      });\n    }\n    if (type === VCSCanvasType.Publish) {\n      return I18n.t('workflow_publish_multibranch_published', {\n        name: operator?.name || '',\n        time: autoSaveTime,\n      });\n    }\n  };\n\n  return (\n    <Tag size=\"mini\" color=\"primary\" prefixIcon={renderIcon()}>\n      {renderText()}\n    </Tag>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useBoolean } from 'ahooks';\nimport { CreateWorkflowModal } from '@coze-workflow/components';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozEdit } from '@coze-arch/coze-design/icons';\nimport { IconButton, Tooltip } from '@coze-arch/coze-design';\n\nimport { useLatestWorkflowJson, useGlobalState } from '../../../hooks';\n\nexport const EditModal = () => {\n  const globalState = useGlobalState();\n  const { info, flowMode } = globalState;\n\n  const [\n    createWorkflowModalVisible,\n    { setTrue: openCreateWorkflowModal, setFalse: closeCreateWorkflowModal },\n  ] = useBoolean(false);\n\n  const { getLatestWorkflowJson } = useLatestWorkflowJson();\n\n  return (\n    <>\n      <Tooltip content={I18n.t('Edit')}>\n        <IconButton\n          data-testid=\"workflow.detail.title.edit\"\n          icon={<IconCozEdit />}\n          color=\"secondary\"\n          size=\"mini\"\n          onClick={() => openCreateWorkflowModal()}\n        />\n      </Tooltip>\n\n      <CreateWorkflowModal\n        mode=\"update\"\n        flowMode={flowMode}\n        visible={createWorkflowModalVisible}\n        workFlow={info}\n        onCancel={closeCreateWorkflowModal}\n        getLatestWorkflowJson={getLatestWorkflowJson}\n        onSuccess={() => {\n          closeCreateWorkflowModal();\n          globalState.reload();\n        }}\n      />\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable complexity */\nimport isNil from 'lodash-es/isNil';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozInfoCircle,\n  IconCozCheckMarkCircleFillPalette,\n} from '@coze-arch/coze-design/icons';\nimport { Typography, Tag, Tooltip, IconButton } from '@coze-arch/coze-design';\n\nimport { WorkflowReferencesTip } from '../workflow-references/references-tip';\nimport { ExecuteState } from '../test-run/execute-result/execute-result-side-sheet/components/execute-state';\nimport { useGlobalState } from '../../hooks';\nimport { PublishStatus, EditModal } from './components';\n\nimport css from './index.module.less';\n\nconst { Text } = Typography;\n\nexport const WorkflowInfo = () => {\n  const globalState = useGlobalState();\n  const {\n    info,\n    config,\n    readonly,\n    isCollaboratorMode,\n    hasChanged,\n    isViewHistory,\n  } = globalState;\n\n  const { autoSaveTime, savingError, preview } = config;\n\n  // Has the current process been published?\n  const isPublished = info.plugin_id !== '0';\n\n  return (\n    <div className={css['workflow-info']}>\n      <div className={css['workflow-title']}>\n        <Text\n          style={{ maxWidth: 300 }}\n          strong\n          ellipsis={{\n            showTooltip: {\n              opts: {\n                content: info?.name || '-',\n                style: { wordBreak: 'break-word' },\n              },\n            },\n          }}\n        >\n          {info?.name || '-'}\n        </Text>\n\n        <Tooltip\n          content={info?.desc || '-'}\n          style={{ wordBreak: 'break-word', maxWidth: '300px' }}\n        >\n          <IconButton\n            icon={<IconCozInfoCircle />}\n            color=\"secondary\"\n            size=\"mini\"\n          />\n        </Tooltip>\n\n        {isPublished && !isViewHistory ? (\n          <Tooltip content={I18n.t('workflow_detail_title_published')}>\n            <IconButton\n              icon={\n                <IconCozCheckMarkCircleFillPalette className=\"coz-fg-hglt-green\" />\n              }\n              color=\"secondary\"\n              size=\"mini\"\n            />\n          </Tooltip>\n        ) : null}\n\n        {!readonly && <EditModal />}\n      </div>\n\n      <div className={css['workflow-status']}>\n        {(isNil(info) || !preview) && isCollaboratorMode ? (\n          <PublishStatus />\n        ) : null}\n\n        {/* Auto save time tag */}\n        {!readonly && !isCollaboratorMode && (\n          <Tag size=\"mini\" color=\"primary\">\n            {I18n.t('workflow_detail_title_saved_2', {\n              time: autoSaveTime,\n            })}\n          </Tag>\n        )}\n        {/* Save error tag */}\n        {!readonly && !!savingError && (\n          <Tag size=\"mini\" color=\"red\">\n            {I18n.t('workflow_detail_node_save_error')}\n          </Tag>\n        )}\n\n        {/* Preview tag */}\n        {!isNil(info) && preview ? (\n          <Tag size=\"mini\" color=\"blue\">\n            {I18n.t('workflow_detail_title_previewing')}\n          </Tag>\n        ) : null}\n\n        {!readonly && <WorkflowReferencesTip />}\n\n        {/* Prompt for modified but unpublished tags */}\n        {hasChanged && !readonly ? (\n          <Tag size=\"mini\" color=\"primary\">\n            {I18n.t('workflow_unpublish_change')}\n          </Tag>\n        ) : null}\n\n        <ExecuteState />\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { VCSCanvasType } from '@coze-arch/bot-api/workflow_api';\n\nimport { useGlobalState } from '@/hooks';\n\n/**\n * Summarize cases where the publish button is not available:\n * 1. The process is running or saved and cannot be published\n * 2. In multiplayer mode, the process is not submitted and cannot be published\n * 3. In vcs mode, the process has already been published and cannot be published.\n * 4.DB mode has no other restrictions and can be released at will\n */\nexport const useIsPublishDisabled = () => {\n  const { isCollaboratorMode, isExecuting, isVcsMode, config, info } =\n    useGlobalState();\n  const { vcsData } = info;\n  const { saving } = config;\n\n  const disabled = useMemo(() => {\n    // Processes in progress or saved cannot be published\n    if (isExecuting || saving) {\n      return true;\n    }\n    // Multiplayer Collaboration Mode: The process is committed and the process is publishable\n    if (isCollaboratorMode) {\n      const canPublish = vcsData?.type === VCSCanvasType.Submit;\n      return !canPublish;\n    }\n    if (isVcsMode && vcsData?.type === VCSCanvasType.Publish) {\n      return true;\n    }\n\n    return false;\n  }, [isExecuting, saving, isVcsMode, isCollaboratorMode, vcsData]);\n\n  const tooltip = useMemo(() => {\n    if (isCollaboratorMode) {\n      return I18n.t('workflow_publish_multibranch_publish_disabled_tooltip');\n    }\n    if (isVcsMode && vcsData?.type === VCSCanvasType.Publish) {\n      return I18n.t('workflow_no_change_tooltip');\n    }\n  }, [vcsData, isCollaboratorMode, isVcsMode]);\n\n  return { disabled, tooltip };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Tooltip, type TooltipProps } from '@coze-arch/coze-design';\n\ntype TooltipWithDisabledProps = TooltipProps & {\n  disabled?: boolean;\n};\n\nexport const TooltipWithDisabled: React.FC<\n  React.PropsWithChildren<TooltipWithDisabledProps>\n> = ({ children, disabled, ...props }) => {\n  if (disabled) {\n    return <>{children}</>;\n  }\n  return <Tooltip {...props}>{children}</Tooltip>;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Button } from '@coze-arch/coze-design';\n\nimport { useGlobalState } from '@/hooks';\n\nexport interface BasePublishButtonProps {\n  disabled?: boolean;\n  className?: string;\n  step: string;\n  setStep: (v: string) => void;\n  onPublish: () => void;\n}\n\nexport const BasePublishButton: React.FC<BasePublishButtonProps> = ({\n  disabled,\n  className,\n  setStep,\n  onPublish,\n}) => {\n  const { publishing } = useGlobalState();\n\n  const handleClick = () => {\n    setStep('none');\n    onPublish();\n  };\n\n  return (\n    <Button\n      disabled={disabled}\n      className={className}\n      loading={publishing}\n      onClick={handleClick}\n      data-testid=\"workflow-base-publish-button\"\n    >\n      {I18n.t('workflow_detail_title_publish')}\n    </Button>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useState, useRef, useEffect } from 'react';\n\nimport semver from 'semver';\nimport type { PublishWorkflowRequest } from '@coze-arch/idl/workflow_api';\nimport { type SetDefaultTestCaseReq } from '@coze-arch/idl/debugger_api';\nimport { I18n } from '@coze-arch/i18n';\nimport { Form, Button, Popover, type useFormApi } from '@coze-arch/coze-design';\nimport { debuggerApi } from '@coze-arch/bot-api';\n\nimport { useGlobalState } from '@/hooks';\nimport { BasePublishButton } from '@/components/workflow-header/components/publish-button-v2/base-publish-button';\n\nimport { useForcePush } from '../force-push-popover';\nimport TestSetSelect from './test-set-select';\n\nimport css from './publish-with-version.module.less';\n\ntype PublishData = Partial<\n  PublishWorkflowRequest & { defaultTestCase?: SetDefaultTestCaseReq }\n>;\n\ninterface PublishWithVersionProps {\n  disabled?: boolean;\n  className?: string;\n  step: string;\n  setStep: (v: string) => void;\n  onPublish: (obj?: PublishData) => void;\n}\n\nconst VersionForm: React.FC<{\n  onSubmit: (data: PublishData) => void;\n  onCancel: () => void;\n  forcePushVisible?: boolean;\n  onTestRun: () => void;\n  onForcePublish: () => void;\n  onForceCancel: () => void;\n}> = ({\n  onSubmit,\n  onCancel,\n  forcePushVisible,\n  onTestRun,\n  onForcePublish,\n  onForceCancel,\n}) => {\n  const formApiRef = useRef<ReturnType<typeof useFormApi> | null>(null);\n  const currentSelectCase = useRef<SetDefaultTestCaseReq | undefined>(\n    undefined,\n  );\n  const { info } = useGlobalState();\n  const { workflow_version: workflowVersion } = info;\n\n  const getDefaultVersion = () => {\n    if (!workflowVersion) {\n      return 'v0.0.1';\n    }\n    return `v${semver.inc(workflowVersion, 'patch')}`;\n  };\n\n  const handleTestSetSelect = (caseData?: SetDefaultTestCaseReq) => {\n    currentSelectCase.current = caseData;\n  };\n\n  const trySaveDefaultCase = () => {\n    try {\n      if (currentSelectCase.current) {\n        debuggerApi.SetDefaultTestCase(currentSelectCase.current);\n      }\n    } catch (error) {\n      console.error('SetDefaultTestCase Error', error);\n    }\n  };\n\n  const handleSubmit = async (cb?: () => void) => {\n    if (!formApiRef.current) {\n      return;\n    }\n    try {\n      await formApiRef.current.validate();\n      const data = formApiRef.current.getValues();\n      const next: PublishData = {\n        workflow_version: data.version,\n        version_description: data.description,\n      };\n\n      onSubmit(next);\n\n      cb?.();\n\n      trySaveDefaultCase();\n\n      // eslint-disable-next-line @coze-arch/no-empty-catch\n    } catch {\n      // Validation error requires no additional processing\n    }\n  };\n\n  const handleForcePublish = () => {\n    handleSubmit(onForcePublish);\n  };\n\n  const renderBtn = () => {\n    if (forcePushVisible) {\n      return (\n        <div className={'flex flex-row-reverse mt-12px'}>\n          <Button\n            color=\"highlight\"\n            onClick={onTestRun}\n            data-testid=\"workflow-testrun-button\"\n          >\n            {I18n.t('workflow_detail_title_testrun')}\n          </Button>\n          <Button\n            color=\"primary\"\n            onClick={handleForcePublish}\n            className={'mr-[8px]'}\n            data-testid=\"workflow-force-publish-button\"\n          >\n            {I18n.t('workflow_publish_not_testrun_ insist')}\n          </Button>\n          <Button\n            color=\"primary\"\n            onClick={onForceCancel}\n            className={'mr-[8px]'}\n            data-testid=\"workflow-publish-cancel-button\"\n          >\n            {I18n.t('workflow_list_create_modal_footer_cancel')}\n          </Button>\n        </div>\n      );\n    }\n\n    return (\n      <div className={'flex flex-row-reverse mt-12px'}>\n        <Button\n          onClick={() => handleSubmit()}\n          data-testid=\"workflow-publish-button\"\n        >\n          {I18n.t('workflow_detail_title_publish')}\n        </Button>\n\n        <Button\n          color=\"primary\"\n          onClick={onCancel}\n          className={'mr-[8px]'}\n          data-testid=\"workflow-publish-cancel-button\"\n        >\n          {I18n.t('workflow_list_create_modal_footer_cancel')}\n        </Button>\n      </div>\n    );\n  };\n\n  return (\n    <div className={css['version-form-v2']}>\n      {forcePushVisible ? (\n        <div className={css['force-push-tips']}>\n          <div className={css['force-push-tips-label']}>\n            {I18n.t('workflow_publish_not_testrun_title', {}, '')}\n          </div>\n          <div className={css['force-push-tips-content']}>\n            {I18n.t(\n              'workflow_publish_not_testrun_content',\n              {},\n              ',',\n            )}\n          </div>\n        </div>\n      ) : null}\n      <Form getFormApi={v => (formApiRef.current = v)}>\n        <Form.Input\n          label={I18n.t('ocean_deploy_list_pkg_version')}\n          required\n          field=\"version\"\n          initValue={getDefaultVersion()}\n          data-testid=\"workflow-publish-version-name\"\n          rules={[\n            {\n              required: true,\n              message: I18n.t('mockset_field_is_required', {\n                field: I18n.t('ocean_deploy_list_pkg_version'),\n              }),\n            },\n            {\n              validator(_, value) {\n                if (!value) {\n                  return true;\n                }\n                return !!/^v\\d+\\.\\d+\\.\\d+$/.test(value);\n              },\n              message: I18n.t('workflow_version_number_error1'),\n            },\n            {\n              validator(_, value) {\n                if (!value || !semver.valid(value) || !workflowVersion) {\n                  return true;\n                }\n                return semver.lt(workflowVersion, value);\n              },\n              message: I18n.t('workflow_version_number_error2'),\n            },\n          ]}\n        />\n        <Form.TextArea\n          autosize={{\n            minRows: 1,\n            maxRows: 10,\n          }}\n          label={I18n.t('card_builder_builder_publish_changelog_label')}\n          placeholder={I18n.t(\n            'workflow_version_update_placeholder',\n            {},\n            '',\n          )}\n          field=\"description\"\n          data-testid=\"workflow-publish-version-description\"\n          rules={[\n            {\n              required: true,\n              message: I18n.t('mockset_field_is_required', {\n                field: I18n.t('card_builder_builder_publish_changelog_label'),\n              }),\n            },\n            {\n              max: 800,\n              message: I18n.t(\n                'project_resource_sidebar_warning_length_exceeds',\n              ),\n            },\n          ]}\n        />\n\n        {/* will support soon */}\n        {!IS_OPEN_SOURCE && <TestSetSelect onSelect={handleTestSetSelect} />}\n\n        {renderBtn()}\n      </Form>\n    </div>\n  );\n};\n\nexport const PublishWithVersionV2: React.FC<PublishWithVersionProps> = ({\n  onPublish,\n  ...props\n}) => {\n  const { step, setStep } = props;\n  const [visible, setVisible] = useState(false);\n  const {\n    visible: forcePushVisible,\n    tryPushCheck,\n    onCancel: onForcePushCancel,\n    onTestRun,\n  } = useForcePush();\n\n  const handlePublish = async () => {\n    setStep('force');\n    if (!(await tryPushCheck())) {\n      return;\n    }\n\n    setStep('version');\n    setVisible(true);\n  };\n\n  const handleSubmit = (obj?: PublishData) => {\n    onPublish(obj);\n  };\n\n  useEffect(() => {\n    if (step !== 'version') {\n      setVisible(false);\n    }\n  }, [step]);\n\n  return (\n    <Popover\n      position=\"bottomRight\"\n      trigger=\"custom\"\n      onClickOutSide={() => setVisible(false)}\n      visible={visible || forcePushVisible}\n      content={\n        <VersionForm\n          forcePushVisible={forcePushVisible}\n          onSubmit={handleSubmit}\n          onCancel={() => setVisible(false)}\n          onTestRun={() => {\n            onTestRun();\n            setVisible(false);\n          }}\n          onForcePublish={onForcePushCancel}\n          onForceCancel={() => {\n            onForcePushCancel();\n            setVisible(false);\n          }}\n        />\n      }\n    >\n      <div>\n        <BasePublishButton onPublish={handlePublish} {...props} />\n      </div>\n    </Popover>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport { ForcePushPopover, useForcePush } from '../force-push-popover';\nimport { BasePublishButton } from './base-publish-button';\n\ninterface PublishWithForceProps {\n  disabled?: boolean;\n  className?: string;\n  step: string;\n  setStep: (v: string) => void;\n  onPublish: () => void;\n}\n\nexport const PublishWithForce: React.FC<PublishWithForceProps> = ({\n  onPublish,\n  ...props\n}) => {\n  const { step, setStep } = props;\n  const { visible, tryPushCheck, onCancel, onTestRun } = useForcePush();\n\n  const handlePublish = async () => {\n    setStep('force');\n    if (!(await tryPushCheck())) {\n      return;\n    }\n    onPublish();\n  };\n\n  useEffect(() => {\n    if (step === 'none') {\n      onCancel();\n    }\n  }, [step]);\n\n  return (\n    <ForcePushPopover\n      visible={visible}\n      title={I18n.t('workflow_publish_not_testrun_title')}\n      description={I18n.t('workflow_publish_not_testrun_content')}\n      mainButtonText={I18n.t('workflow_publish_not_testrun_ insist')}\n      onCancel={onCancel}\n      onOpenTestRun={onTestRun}\n      onForcePush={() => {\n        onCancel();\n        onPublish();\n      }}\n    >\n      <div>\n        <BasePublishButton onPublish={handlePublish} {...props} />\n      </div>\n    </ForcePushPopover>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useRef, useEffect } from 'react';\n\nimport semver from 'semver';\nimport { I18n } from '@coze-arch/i18n';\nimport { Form, Button, Popover, type useFormApi } from '@coze-arch/coze-design';\nimport { type PublishWorkflowRequest } from '@coze-arch/bot-api/workflow_api';\n\nimport { useGlobalState } from '@/hooks';\n\nimport { PublishWithForce } from './publish-with-force';\n\nimport css from './publish-with-version.module.less';\n\ninterface PublishWithVersionProps {\n  disabled?: boolean;\n  className?: string;\n  step: string;\n  setStep: (v: string) => void;\n  onPublish: (obj?: Partial<PublishWorkflowRequest>) => void;\n}\n\nconst VersionForm: React.FC<{\n  onSubmit: (data: Partial<PublishWorkflowRequest>) => void;\n}> = ({ onSubmit }) => {\n  const formApiRef = useRef<ReturnType<typeof useFormApi> | null>(null);\n  const { info } = useGlobalState();\n  const { workflow_version: workflowVersion } = info;\n\n  const getDefaultVersion = () => {\n    if (!workflowVersion) {\n      return 'v0.0.1';\n    }\n    return `v${semver.inc(workflowVersion, 'patch')}`;\n  };\n\n  const handleSubmit = async () => {\n    if (!formApiRef.current) {\n      return;\n    }\n    try {\n      await formApiRef.current.validate();\n      const data = formApiRef.current.getValues();\n      const next: Partial<PublishWorkflowRequest> = {\n        workflow_version: data.version,\n        version_description: data.description,\n      };\n\n      onSubmit(next);\n      // eslint-disable-next-line @coze-arch/no-empty-catch\n    } catch {\n      // Validation error requires no additional processing\n    }\n  };\n\n  return (\n    <div className={css['version-form']}>\n      <Form getFormApi={v => (formApiRef.current = v)}>\n        <Form.Input\n          label={I18n.t('ocean_deploy_list_pkg_version')}\n          required\n          field=\"version\"\n          initValue={getDefaultVersion()}\n          rules={[\n            {\n              required: true,\n              message: I18n.t('mockset_field_is_required', {\n                field: I18n.t('ocean_deploy_list_pkg_version'),\n              }),\n            },\n            {\n              validator(_, value) {\n                if (!value) {\n                  return true;\n                }\n                return !!/^v\\d+\\.\\d+\\.\\d+$/.test(value);\n              },\n              message: I18n.t('workflow_version_number_error1'),\n            },\n            {\n              validator(_, value) {\n                if (!value || !semver.valid(value) || !workflowVersion) {\n                  return true;\n                }\n                return semver.lt(workflowVersion, value);\n              },\n              message: I18n.t('workflow_version_number_error2'),\n            },\n          ]}\n        />\n        <Form.TextArea\n          label={I18n.t('card_builder_builder_publish_changelog_label')}\n          field=\"description\"\n          maxCount={800}\n          rules={[\n            {\n              required: true,\n              message: I18n.t('mockset_field_is_required', {\n                field: I18n.t('card_builder_builder_publish_changelog_label'),\n              }),\n            },\n            {\n              max: 800,\n              message: I18n.t(\n                'project_resource_sidebar_warning_length_exceeds',\n              ),\n            },\n          ]}\n        />\n        <Button className={css.submit} onClick={handleSubmit}>\n          {I18n.t('workflow_detail_title_publish')}\n        </Button>\n      </Form>\n    </div>\n  );\n};\n\nexport const PublishWithVersion: React.FC<PublishWithVersionProps> = ({\n  onPublish,\n  ...props\n}) => {\n  const { step, setStep } = props;\n  const [visible, setVisible] = useState(false);\n\n  const handlePublish = () => {\n    setStep('version');\n    setVisible(true);\n  };\n  const handleSubmit = (obj?: Partial<PublishWorkflowRequest>) => {\n    onPublish(obj);\n  };\n\n  useEffect(() => {\n    if (step !== 'version') {\n      setVisible(false);\n    }\n  }, [step]);\n\n  return (\n    <Popover\n      position=\"bottomRight\"\n      trigger=\"custom\"\n      onClickOutSide={() => setVisible(false)}\n      visible={visible}\n      content={<VersionForm onSubmit={handleSubmit} />}\n    >\n      <div>\n        <PublishWithForce onPublish={handlePublish} {...props} />\n      </div>\n    </Popover>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useRef } from 'react';\n\nimport { useMemoizedFn } from 'ahooks';\nimport {\n  OperateType,\n  type PublishWorkflowRequest,\n} from '@coze-arch/bot-api/workflow_api';\n\nimport { useGlobalState } from '@/hooks';\n\nimport { usePublishReferenceConfirm, useDiffConfirm } from '../../hooks';\nimport { PublishWithVersionV2 } from './publish-with-version-v2';\nimport { PublishWithVersion } from './publish-with-version';\n\ninterface PublishWithDiffProps {\n  disabled?: boolean;\n  className?: string;\n  step: string;\n  setStep: (v: string) => void;\n  onPublish: (obj?: Partial<PublishWorkflowRequest>) => Promise<boolean>;\n}\n\nexport const PublishWithDiff: React.FC<PublishWithDiffProps> = ({\n  onPublish,\n  ...props\n}) => {\n  const { setStep } = props;\n  const { isCollaboratorMode, isInIDE } = useGlobalState();\n  const { publishUpdateReferencedConfirm } = usePublishReferenceConfirm();\n  // Cache the data that needs to be given to the publishing interface and use it after the user confirms the diff. Because the design of the diff pop-up window is not scalable, it will be handled like this for the time being.\n  const publishDataRef = useRef<Partial<PublishWorkflowRequest>>({});\n\n  const useNewGlobalVariableCache = !isInIDE;\n\n  const passPublish = useMemoizedFn(async () => {\n    const res = await onPublish(publishDataRef.current);\n    publishDataRef.current = {};\n    return res;\n  });\n\n  const { diffConfirm, modal: diffConfirmModal } = useDiffConfirm({\n    submitHandle: passPublish,\n    operateType: OperateType.PublishOperate,\n  });\n\n  const handlePublish = async (obj?: Partial<PublishWorkflowRequest>) => {\n    setStep('diff');\n    publishDataRef.current = obj || {};\n    if (isCollaboratorMode) {\n      await diffConfirm();\n    } else {\n      if (await publishUpdateReferencedConfirm()) {\n        await onPublish(obj);\n      }\n    }\n    publishDataRef.current = {};\n  };\n\n  return (\n    <>\n      {useNewGlobalVariableCache ? (\n        <PublishWithVersionV2 onPublish={handlePublish} {...props} />\n      ) : (\n        <PublishWithVersion onPublish={handlePublish} {...props} />\n      )}\n      {diffConfirmModal}\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Publish to multiple environments\n * Is a single module, abstracted into a component\n */\nimport { useMemo } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozArrowDown } from '@coze-arch/coze-design/icons';\nimport { SplitButtonGroup, Menu, IconButton } from '@coze-arch/coze-design';\nimport {\n  OperateType,\n  type PublishWorkflowRequest,\n} from '@coze-arch/bot-api/workflow_api';\nimport { useNavigate } from 'react-router-dom';\n\nimport { useGlobalState } from '@/hooks';\n\nimport { TooltipWithDisabled } from './tooltip-with-disabled';\nimport { PublishWithDiff } from './publish-with-diff';\n\nimport css from './publish-env.module.less';\n\nconst usePublishEnv = () => {\n  const navigate = useNavigate();\n  const { workflowId, spaceId, isCollaboratorMode, info, isDevSpace } =\n    useGlobalState();\n  const { vcsData, plugin_id } = info;\n\n  /** Whether to support the release of PPE */\n  const canPublishEnv = useMemo(\n    () => isCollaboratorMode && vcsData?.can_edit && isDevSpace,\n    [isDevSpace, isCollaboratorMode, vcsData],\n  );\n  /** It's never been published. */\n  const neverPublished = useMemo(\n    () => !plugin_id || plugin_id === '0',\n    [plugin_id],\n  );\n\n  const onPublishEnv = () => {\n    navigate(\n      `/space/${spaceId}/workflow/${workflowId}/publish?` +\n        `commit_id=${vcsData?.submit_commit_id}&type=${OperateType.SubmitOperate}`,\n      {\n        replace: true,\n      },\n    );\n  };\n\n  return {\n    canPublishEnv,\n    neverPublished,\n    onPublishEnv,\n  };\n};\n\ninterface PublishWithEnvProps {\n  step: string;\n  setStep: (v: string) => void;\n  disabled?: boolean;\n  onPublish: (obj?: Partial<PublishWorkflowRequest>) => Promise<boolean>;\n}\n\nexport const PublishWithEnv: React.FC<PublishWithEnvProps> = props => {\n  const { disabled } = props;\n  const { canPublishEnv, neverPublished, onPublishEnv } = usePublishEnv();\n\n  const disabledPublishEnv = neverPublished || disabled;\n\n  if (!canPublishEnv) {\n    return <PublishWithDiff {...props} />;\n  }\n\n  return (\n    <SplitButtonGroup className={css['publish-env']}>\n      <PublishWithDiff {...props} />\n      <Menu\n        trigger=\"click\"\n        render={\n          <Menu.Menu mode=\"menu\">\n            <Menu.Item disabled={disabledPublishEnv} onClick={onPublishEnv}>\n              <TooltipWithDisabled\n                disabled={!disabledPublishEnv}\n                position=\"left\"\n                content={I18n.t(\n                  'bmv_please_release_the_official_version_before_releasing_it_',\n                )}\n              >\n                {I18n.t('bmv_pre_release_to_lane')}\n              </TooltipWithDisabled>\n            </Menu.Item>\n          </Menu.Menu>\n        }\n      >\n        <IconButton\n          icon={<IconCozArrowDown />}\n          className={css['last-btn']}\n          disabled={disabled}\n          color=\"hgltplus\"\n        />\n      </Menu>\n    </SplitButtonGroup>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Toast } from '@coze-arch/coze-design';\nimport { type PublishWorkflowRequest } from '@coze-arch/bot-api/workflow_api';\n\nimport { useGlobalState, useWorkflowOperation } from '@/hooks';\n\nimport { useIsPublishDisabled } from './use-is-publish-disabled';\nimport { TooltipWithDisabled } from './tooltip-with-disabled';\nimport { PublishWithEnv } from './publish-with-env';\n\nexport const PublishButton = () => {\n  const globalState = useGlobalState();\n  const { playgroundProps } = globalState;\n  const operation = useWorkflowOperation();\n  const { disabled, tooltip } = useIsPublishDisabled();\n\n  /**\n   * Since there are various pop-ups and floating layers around the publish button in the product form, a centralized markup is set to prevent conflicts with each other\n   * This is not a good practice. The product form of the release button should be optimized in the future. It is too cumbersome to release now.\n   */\n  const [step, setStep] = useState('none');\n\n  const handlePublish = async (obj?: Partial<PublishWorkflowRequest>) => {\n    const published = await operation.publish(obj);\n    if (!published) {\n      return published;\n    }\n\n    Toast.success({\n      content: I18n.t('workflow_detail_title_publish_toast'),\n      duration: 1.5,\n    });\n\n    playgroundProps.onPublish?.(globalState);\n    return published;\n  };\n\n  if (globalState.readonly) {\n    return null;\n  }\n\n  return (\n    <TooltipWithDisabled content={tooltip} disabled={!disabled || !tooltip}>\n      <div>\n        <PublishWithEnv\n          step={step}\n          setStep={setStep}\n          disabled={disabled}\n          onPublish={handlePublish}\n        />\n      </div>\n    </TooltipWithDisabled>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { IconCozArrowLeft } from '@coze-arch/coze-design/icons';\nimport { IconButton, CozAvatar } from '@coze-arch/coze-design';\n\nimport { WorkflowInfo } from '../workflow-header-info';\nimport { useGlobalState } from '../../hooks';\nimport { getWorkflowHeaderTestId } from './utils';\nimport { PublishButton } from './components/publish-button-v2';\nimport {\n  CollaboratorsButton,\n  SubmitButton,\n  DuplicateButton,\n  HistoryButton,\n  CreditButton,\n  ReferenceButton,\n} from './components';\n\nimport styles from './index.module.less';\n\nconst WorkFlowHeader: React.FC = () => {\n  const globalState = useGlobalState();\n  const { readonly, info, playgroundProps, workflowId } = globalState;\n\n  return (\n    <div className={styles.container}>\n      <div\n        className={styles.left}\n        data-testid={getWorkflowHeaderTestId('info')}\n      >\n        <IconButton\n          icon={<IconCozArrowLeft />}\n          color=\"secondary\"\n          data-testid={getWorkflowHeaderTestId('back')}\n          onClick={() => {\n            playgroundProps.onBackClick?.(globalState);\n          }}\n        />\n\n        <CozAvatar src={info.url || ''} type=\"platform\" alt=\"Avatar\" />\n\n        <WorkflowInfo />\n      </div>\n\n      <div className={styles.right}>\n        {/* will support soon */}\n        {IS_OPEN_SOURCE ? null : <ReferenceButton workflowId={workflowId} />}\n\n        {IS_OPEN_SOURCE ? null : (\n          <>\n            {!readonly && <CreditButton />}\n\n            <HistoryButton />\n\n            <CollaboratorsButton />\n\n            <SubmitButton />\n          </>\n        )}\n\n        <PublishButton />\n\n        <DuplicateButton mode={readonly ? 'button' : 'icon'} />\n      </div>\n    </div>\n  );\n};\n\nexport default React.memo(WorkFlowHeader);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const ADD_NODE_BUTTON_ID = 'workflow-toolbar-add-node';\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-magic-numbers -- no need to fix */\nimport { useCallback } from 'react';\n\nimport { StandardNodeType } from '@coze-workflow/base';\nimport { Toast } from '@coze-arch/coze-design';\nimport { WorkflowNodePanelService } from '@flowgram-adapter/free-layout-editor';\nimport {\n  type FlowNodeEntity,\n  FlowNodeTransformData,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  type PositionSchema,\n  usePlayground,\n  useService,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  type WorkflowNodeEntity,\n  WorkflowSelectService,\n  type WorkflowNodeMeta,\n  getAntiOverlapPosition,\n  WorkflowDocument,\n  type WorkflowSubCanvas,\n} from '@flowgram-adapter/free-layout-editor';\nimport { Rectangle, type IPoint } from '@flowgram-adapter/common';\n\nimport { WorkflowCustomDragService, WorkflowEditService } from '@/services';\nimport { PANEL_WIDTH } from '@/components/node-panel/constant';\n\nimport { ADD_NODE_BUTTON_ID } from '../constants';\n\n// Get hook for panel position\nconst useGetPanelPosition = () => {\n  const playground = usePlayground();\n  return useCallback(\n    (targetBoundingRect: DOMRect): PositionSchema =>\n      playground.config.getPosFromMouseEvent({\n        clientX:\n          targetBoundingRect.left +\n          (targetBoundingRect.width - PANEL_WIDTH) / 2,\n        clientY: targetBoundingRect.top - 5,\n      }),\n    [playground],\n  );\n};\n\n// Get Node Center\nconst getNodesCenter = (nodes: WorkflowNodeEntity[]): IPoint => {\n  const allBounds = nodes.map(\n    node => node.getData(FlowNodeTransformData).bounds,\n  );\n  const { center } = Rectangle.enlarge(allBounds);\n  return center;\n};\n\n// Select the node and open the node panel\nconst useFocusNode = () => {\n  const editService = useService(WorkflowEditService);\n  return useCallback(\n    (node: WorkflowNodeEntity) => {\n      editService.focusNode(node);\n    },\n    [editService],\n  );\n};\n\n// Hook to handle child canvas nodes\nconst useAddSubCanvasNode = () => {\n  const workflowDocument = useService(WorkflowDocument);\n  const dragService = useService(WorkflowCustomDragService);\n  const nodePanelService = useService<WorkflowNodePanelService>(\n    WorkflowNodePanelService,\n  );\n  const getPanelPosition = useGetPanelPosition();\n  const focusNode = useFocusNode();\n\n  return useCallback(\n    async (\n      targetBoundingRect: DOMRect,\n      containerNode: WorkflowNodeEntity,\n    ): Promise<void> => {\n      const panelPosition = getPanelPosition(targetBoundingRect);\n\n      await nodePanelService.call({\n        panelPosition,\n        containerNode,\n        panelProps: {\n          enableDrag: true,\n          enableModalMultiAdd: true,\n          fromAddNodeBtn: true,\n          anchorElement: `#${ADD_NODE_BUTTON_ID}`,\n        },\n        canAddNode: (params: { nodeType: string }) => {\n          const canDropMessage = dragService.canDropToNode({\n            dragNodeType: params.nodeType as StandardNodeType,\n            dropNode: containerNode,\n          });\n          if (!canDropMessage.allowDrop) {\n            Toast.warning({\n              content: canDropMessage.message,\n            });\n          }\n          return canDropMessage.allowDrop;\n        },\n        customPosition: ({ nodeType }) => {\n          const childrenLength = containerNode.collapsedChildren.length;\n          const containerCenter = getNodesCenter(\n            containerNode.collapsedChildren,\n          );\n          const register = workflowDocument.getNodeRegister(nodeType);\n          const size = register?.meta?.size;\n          const centerPosition = {\n            x: containerCenter.x,\n            y: size ? containerCenter.y - size.height / 2 : containerCenter.y,\n          };\n          const adjustedPosition = dragService.adjustSubNodePosition(\n            nodeType,\n            containerNode,\n            centerPosition,\n          );\n          const offsetPosition = {\n            x: adjustedPosition.x + childrenLength * 30,\n            y: adjustedPosition.y + childrenLength * 30,\n          };\n          return offsetPosition;\n        },\n        afterAddNode: focusNode as (node?: FlowNodeEntity) => void,\n        enableMultiAdd: true,\n      });\n    },\n    [\n      dragService,\n      focusNode,\n      getPanelPosition,\n      nodePanelService,\n      workflowDocument,\n    ],\n  );\n};\n\n// Handling hooks for normal nodes\nconst useAddNormalNode = () => {\n  const workflowDocument = useService(WorkflowDocument);\n  const nodePanelService = useService<WorkflowNodePanelService>(\n    WorkflowNodePanelService,\n  );\n  const playground = usePlayground();\n  const getPanelPosition = useGetPanelPosition();\n  const focusNode = useFocusNode();\n\n  return useCallback(\n    async (targetBoundingRect: DOMRect): Promise<void> => {\n      const panelPosition = getPanelPosition(targetBoundingRect);\n      await nodePanelService.call({\n        panelPosition,\n        panelProps: {\n          enableDrag: true,\n          enableModalMultiAdd: true,\n          fromAddNodeBtn: true,\n          anchorElement: `#${ADD_NODE_BUTTON_ID}`,\n        },\n        customPosition: ({ selectPosition }) => {\n          const nodeWidth = 360;\n          const nodePanelOffset = 450 / playground.config.zoom;\n          const customPositionX =\n            panelPosition.x + nodeWidth / 2 + nodePanelOffset;\n          const customNodePosition = getAntiOverlapPosition(workflowDocument, {\n            x: customPositionX,\n            y: selectPosition.y,\n          });\n          return {\n            x: customNodePosition.x,\n            y: customNodePosition.y,\n          };\n        },\n        enableSelectPosition: true,\n        enableMultiAdd: true,\n        afterAddNode: focusNode as (node?: FlowNodeEntity) => void,\n      });\n    },\n    [\n      getPanelPosition,\n      nodePanelService,\n      playground.config.zoom,\n      workflowDocument,\n      focusNode,\n    ],\n  );\n};\n\nconst getNodeLinage = (node: WorkflowNodeEntity): WorkflowNodeEntity[] => {\n  const linage: WorkflowNodeEntity[] = [node];\n  let currentNode = node;\n  while (currentNode.parent) {\n    linage.unshift(currentNode.parent);\n    currentNode = currentNode.parent;\n  }\n  return linage;\n};\n\n// Get container node\nconst getContainerNode = (selectService: WorkflowSelectService) => {\n  const selectedNode = selectService.activatedNode;\n  if (!selectedNode) {\n    return;\n  }\n  if (selectedNode.getNodeMeta<WorkflowNodeMeta>().isContainer) {\n    return selectedNode;\n  }\n  const selectedNodeType = selectedNode.flowNodeType;\n  if (\n    [StandardNodeType.Loop, StandardNodeType.Batch].includes(\n      selectedNodeType as StandardNodeType,\n    )\n  ) {\n    const nodeMeta: WorkflowNodeMeta = selectedNode.getNodeMeta();\n    const subCanvas = nodeMeta.subCanvas?.(selectedNode);\n    if (!subCanvas) {\n      return;\n    }\n    return subCanvas.canvasNode;\n  }\n  const linage = getNodeLinage(selectedNode);\n  const linageSubCanvas: WorkflowSubCanvas | undefined = linage\n    .map(node => {\n      const nodeMeta = node.getNodeMeta<WorkflowNodeMeta>();\n      const subCanvas = nodeMeta.subCanvas?.(node);\n      return subCanvas;\n    })\n    .filter(Boolean)\n    .find(subCanvas => subCanvas?.isCanvas);\n  // Existing in the parent is considered to be in the child canvas\n  if (!linageSubCanvas) {\n    return;\n  }\n  return linageSubCanvas.canvasNode;\n};\n\nexport const useAddNode = () => {\n  const selectService = useService(WorkflowSelectService);\n  const addSubCanvasNode = useAddSubCanvasNode();\n  const addNormalNode = useAddNormalNode();\n\n  const addNode = useCallback(\n    async (targetBoundingRect: DOMRect): Promise<void> => {\n      const containerNode = getContainerNode(selectService);\n\n      if (containerNode) {\n        await addSubCanvasNode(targetBoundingRect, containerNode);\n      } else {\n        await addNormalNode(targetBoundingRect);\n      }\n    },\n    [selectService, addSubCanvasNode, addNormalNode],\n  );\n\n  return addNode;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useCallback } from 'react';\n\nconst MINIMAP_VISIBLE_KEY = 'workflow-minimap-visible';\n\nconst getMinimapStorageVisible = () => {\n  const visible = localStorage.getItem(MINIMAP_VISIBLE_KEY) ?? 'false';\n  return visible === 'true';\n};\n\nconst setMinimapStorageVisible = (visible: boolean) => {\n  localStorage.setItem(MINIMAP_VISIBLE_KEY, visible ? 'true' : 'false');\n};\n\nexport const useMinimapVisible = () => {\n  const [minimapVisible, setMinimapStateVisible] = useState(\n    getMinimapStorageVisible(),\n  );\n\n  const setMinimapVisible = useCallback((visible: boolean) => {\n    setMinimapStateVisible(visible);\n    setMinimapStorageVisible(visible);\n  }, []);\n\n  return {\n    minimapVisible,\n    setMinimapVisible,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { usePlaygroundTools } from '@flowgram-adapter/free-layout-editor';\n\nimport type { ToolbarHandlers } from '../type';\nimport { useMinimapVisible } from './use-minimap-visible';\nimport { useAddNode } from './use-add-node';\n\nexport const useToolbarHandlers = (): ToolbarHandlers => {\n  const playgroundTools = usePlaygroundTools();\n  const addNode = useAddNode();\n  const { minimapVisible, setMinimapVisible } = useMinimapVisible();\n  return {\n    ...playgroundTools,\n    addNode,\n    minimapVisible,\n    setMinimapVisible,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback } from 'react';\n\nimport {\n  usePlaygroundTools,\n  useService,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { WorkflowLayoutShortcutsContribution } from '@/shortcuts';\n\nexport const useAutoLayout = () => {\n  const tools = usePlaygroundTools();\n  const autoLayoutShortcut = useService(WorkflowLayoutShortcutsContribution);\n  const autoLayout = useCallback(async () => {\n    tools.fitView();\n    await autoLayoutShortcut.autoLayout();\n    tools.fitView();\n  }, [tools, autoLayoutShortcut]);\n  return autoLayout;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CozAvatar, type AvatarProps } from '@coze-arch/coze-design';\n\nimport img from './avatar.png';\n\ninterface EmptyRoleAvatarProps {\n  size?: AvatarProps['size'];\n  type?: AvatarProps['type'];\n  width?: number;\n  className?: string;\n}\n\nexport const EmptyRoleAvatar: React.FC<EmptyRoleAvatarProps> = ({\n  width,\n  ...props\n}) => <CozAvatar src={img} style={{ width, height: width }} {...props} />;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CozAvatar } from '@coze-arch/coze-design';\n\nimport { EmptyRoleAvatar } from '../empty-role-avatar';\n\nimport css from './role-avatar.module.less';\n\ninterface RoleAvatarProps {\n  url?: string;\n}\n\nexport const RoleAvatar: React.FC<RoleAvatarProps> = ({ url }) => {\n  if (!url) {\n    return <EmptyRoleAvatar size=\"small\" className={css['role-avatar']} />;\n  }\n  return <CozAvatar src={url} className={css['role-avatar']} size=\"small\" />;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  Tooltip,\n  Button,\n  Typography,\n  type PopoverProps,\n} from '@coze-arch/coze-design';\nimport { localStorageService } from '@coze-foundation/local-storage';\n\nimport img from './onboarding.png';\n\nimport css from './onboarding.module.less';\n\nconst ONBOARDING_KEY = 'workflow-toolbar-role-onboarding-hidden';\n\nconst OnBoardingPopoverContent: React.FC<{\n  onOk: () => void;\n}> = ({ onOk }) => (\n  <div className={css['popover-content']}>\n    <img src={img} />\n    <br />\n    <Typography.Text>\n      {I18n.t('workflow_role_config_onboarding')}\n    </Typography.Text>\n    <div className={css.btn}>\n      <Button color=\"highlight\" onClick={onOk}>\n        {I18n.t('upgrade_guide_got_it')}\n      </Button>\n    </div>\n  </div>\n);\n\ninterface OnBoardingPopoverProps {\n  visible: boolean;\n  getPopupContainer?: PopoverProps['getPopupContainer'];\n}\n\nexport const OnBoardingPopover: React.FC<\n  React.PropsWithChildren<OnBoardingPopoverProps>\n> = ({ visible, children, ...props }) => {\n  const [localVisible, setLocalVisible] = useState(\n    !localStorageService.getValue(ONBOARDING_KEY),\n  );\n\n  const innerVisible = visible && localVisible;\n\n  const handleClose = () => {\n    setLocalVisible(false);\n    localStorageService.setValue(ONBOARDING_KEY, 'true');\n  };\n\n  if (!visible) {\n    return children;\n  }\n\n  return (\n    <Tooltip\n      position=\"top\"\n      visible={innerVisible}\n      showArrow\n      trigger=\"custom\"\n      spacing={16}\n      content={<OnBoardingPopoverContent onOk={handleClose} />}\n      {...props}\n    >\n      {children}\n    </Tooltip>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useRef, useState } from 'react';\n\nimport { useMemoizedFn } from 'ahooks';\nimport { I18n } from '@coze-arch/i18n';\nimport { Button, Typography } from '@coze-arch/coze-design';\n\nimport { type PanelInfo } from '@/services/workflow-float-layout-service';\nimport {\n  useFloatLayoutService,\n  useRoleService,\n  useRoleServiceStore,\n  useGlobalState,\n} from '@/hooks';\nimport { LayoutPanelKey } from '@/constants';\n\nimport { RoleAvatar } from './role-avatar';\nimport { OnBoardingPopover } from './onboarding';\n\nimport css from './role-button.module.less';\n\nexport const RoleButton = () => {\n  const floatLayoutService = useFloatLayoutService();\n  const roleService = useRoleService();\n\n  const { isInitWorkflow } = useGlobalState();\n  const { isReady, loading, data } = useRoleServiceStore(s => ({\n    isReady: s.isReady,\n    loading: s.loading,\n    data: s.data,\n  }));\n\n  const [onBoardingVisible, setOnBoardingVisible] = useState(false);\n\n  const ref = useRef(null);\n  /**\n   * Is this the first time to open the role configuration panel?\n   */\n  const isInitRef = useRef(false);\n\n  const roleName = data?.name || I18n.t('team_column_role');\n  const roleAvatar = data?.avatar?.image_url;\n\n  const handleClick = () => {\n    floatLayoutService.open(LayoutPanelKey.RoleConfig);\n  };\n\n  const handlePanelClose = useMemoizedFn((info: PanelInfo) => {\n    const { key } = info;\n    if (key === LayoutPanelKey.RoleConfig && isInitRef.current) {\n      setOnBoardingVisible(true);\n    }\n  });\n\n  /**\n   * Initialize request role data\n   */\n  useEffect(() => {\n    roleService.load();\n  }, [roleService]);\n\n  /**\n   * Whether to automatically open the configuration panel\n   */\n  useEffect(() => {\n    /**\n     * Unmodified Process & Unconfigured Role Configuration = > Automatically Expand Role Panel\n     */\n    if (isInitWorkflow && isReady && data === null) {\n      floatLayoutService.open(LayoutPanelKey.RoleConfig);\n      isInitRef.current = true;\n    }\n  }, [isReady, isInitWorkflow, data, floatLayoutService]);\n\n  /**\n   * Whether onboarding is turned on when closing the panel\n   */\n  useEffect(() => {\n    const disposable = floatLayoutService.onUnmount(handlePanelClose);\n\n    return () => disposable.dispose();\n  }, [floatLayoutService, handlePanelClose]);\n\n  return (\n    <div ref={ref} className={css['role-button']}>\n      <OnBoardingPopover\n        visible={onBoardingVisible}\n        getPopupContainer={() => ref.current || document.body}\n      >\n        <Button color=\"secondary\" onClick={handleClick} loading={loading}>\n          <div className={css['role-info']}>\n            <RoleAvatar url={roleAvatar} />\n            <Typography.Text\n              style={{ maxWidth: 100 }}\n              ellipsis={{ showTooltip: true }}\n              strong\n            >\n              {roleName}\n            </Typography.Text>\n          </div>\n        </Button>\n      </OnBoardingPopover>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable complexity */\nimport { isObject, isBoolean } from 'lodash-es';\nimport {\n  SuggestReplyInfoMode,\n  InputMode,\n  type ChatFlowRole,\n} from '@coze-arch/bot-api/workflow_api';\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const formValue2Data = (values: any) => {\n  const temp = values || {};\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const data: Record<string, any> = {\n    // role name\n    name: temp.name,\n    // Role Description\n    description: temp.description,\n    onboarding_info: {\n      display_all_suggestions: values.display_all_suggestions ?? false,\n    },\n    suggest_reply_info: {\n      suggest_reply_mode: SuggestReplyInfoMode.Disable,\n    },\n    audio_config: {},\n    user_input_config: {\n      default_input_mode: InputMode.text,\n    },\n  };\n\n  // avatar\n  if (Array.isArray(temp.avatar) && temp.avatar.length) {\n    const nextAvatar = temp.avatar[0];\n    data.avatar = {\n      image_uri: nextAvatar.uid,\n      image_url: nextAvatar.url,\n    };\n  }\n\n  // Introductory copy\n  if (temp.prologue) {\n    data.onboarding_info.prologue = temp.prologue.replace(/[\\r\\n]+$/g, '');\n  }\n\n  // Opening question\n  if (temp.questions) {\n    data.onboarding_info.suggested_questions = temp.questions;\n  }\n\n  // user suggestion\n  if (temp.suggest && isObject(temp.suggest)) {\n    data.suggest_reply_info = temp.suggest;\n  }\n\n  if (temp.background && isObject(temp.background)) {\n    data.background_image_info = temp.background;\n  }\n\n  // timbre\n  if (temp.voices && isObject(temp.voices)) {\n    if (temp.voices.config && isObject(temp.voices.config)) {\n      data.audio_config.voice_config_map = temp.voices.config;\n    }\n    if (!IS_OVERSEA) {\n      data.audio_config.is_text_to_voice_enable =\n        temp.voices.textToVoice ?? false;\n    }\n  }\n\n  if (temp.default) {\n    data.user_input_config.default_input_mode = temp.default;\n  }\n\n  return data;\n};\n\nexport const data2FormValue = (data: ChatFlowRole = {}) => {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const value: any = {\n    name: data.name,\n    description: data.description,\n    voices: {},\n    background: {},\n    suggest_reply_info: {\n      // The default is open.\n      suggest_reply_mode: SuggestReplyInfoMode.System,\n    },\n    display_all_suggestions:\n      data.onboarding_info?.display_all_suggestions ?? false,\n  };\n\n  if (data.avatar?.image_url) {\n    value.avatar = [\n      {\n        uid: data.avatar.image_uri,\n        url: data.avatar.image_url,\n      },\n    ];\n  }\n  if (data.onboarding_info) {\n    if (data.onboarding_info.prologue) {\n      value.prologue = data.onboarding_info.prologue;\n    }\n    if (data.onboarding_info.suggested_questions) {\n      value.questions = data.onboarding_info.suggested_questions;\n    }\n  }\n  if (data.suggest_reply_info) {\n    value.suggest = data.suggest_reply_info;\n  }\n\n  const background = data.background_image_info;\n  if (background && isObject(background)) {\n    Object.keys(background).forEach(key => {\n      const val = background[key];\n      value.background[key] = {\n        ...val,\n        origin_image_url: val?.image_url || val?.origin_image_url,\n      };\n    });\n  }\n\n  if (data.audio_config) {\n    const voice = data.audio_config;\n    if (voice.voice_config_map) {\n      value.voices.config = voice.voice_config_map;\n    }\n    if (isBoolean(voice.is_text_to_voice_enable) && !IS_OVERSEA) {\n      value.voices.textToVoice = voice.is_text_to_voice_enable;\n    }\n  }\n  if (data.user_input_config) {\n    if (data.user_input_config.default_input_mode) {\n      value.default = data.user_input_config.default_input_mode;\n    }\n  }\n\n  return value;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type VoiceConfig } from '@coze-arch/bot-api/workflow_api';\n\nexport interface VoiceValue {\n  language?: string;\n  data?: VoiceConfig;\n}\n\nexport const formatVoicesObj2Arr = (\n  value: Record<string, VoiceConfig>,\n): VoiceValue[] => {\n  const temp = Object.keys(value).map(lang => ({\n    language: lang,\n    data: value[lang],\n  }));\n  return temp.length ? temp : [{}];\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useEffect } from 'react';\n\nimport { Tag } from '@coze-arch/coze-design';\nimport { type VoiceConfig } from '@coze-arch/bot-api/workflow_api';\nimport { type VoiceDetail } from '@coze-arch/bot-api/multimedia_api';\nimport { MultimediaApi } from '@coze-arch/bot-api';\n\nimport { formatVoicesObj2Arr } from './utils';\n\ninterface RoleVoicesProps {\n  value?: Record<string, VoiceConfig>;\n}\n\nexport const RoleVoices: React.FC<RoleVoicesProps> = ({ value }) => {\n  const [innerValue, setInnerValue] = useState<VoiceDetail[]>([]);\n\n  const fetch = async (ids: string[]) => {\n    const { data } = await MultimediaApi.APIMGetVoice({\n      voice_ids: ids,\n    });\n\n    setInnerValue(data?.voices || []);\n  };\n\n  useEffect(() => {\n    const ids = formatVoicesObj2Arr(value || {})\n      .map(i => i.data?.voice_id)\n      .filter((i): i is string => Boolean(i));\n    if (!ids.length) {\n      setInnerValue([]);\n    } else {\n      fetch(ids);\n    }\n  }, [value]);\n\n  return (\n    <div className=\"flex flex-wrap gap-[4px] mb-[8px]\">\n      {innerValue.map(i => (\n        <Tag size=\"small\" color=\"primary\" key={i.voice_id}>\n          {i.voice_name}({i.language_name})\n        </Tag>\n      ))}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IconCozPauseFill, IconCozVolume } from '@coze-arch/coze-design/icons';\nimport { IconButton } from '@coze-arch/coze-design';\nimport { useAudioPlayer } from '@coze-workflow/resources-adapter';\n\ninterface VoicePlayerProps {\n  preview?: string;\n}\n\nexport const VoicePlayer: React.FC<VoicePlayerProps> = ({ preview }) => {\n  const { isPlaying, togglePlayPause } = useAudioPlayer(preview);\n\n  return (\n    <IconButton\n      disabled={!preview}\n      onClick={e => {\n        e.stopPropagation();\n        togglePlayPause();\n      }}\n      icon={isPlaying ? <IconCozPauseFill /> : <IconCozVolume />}\n      size=\"small\"\n      color=\"secondary\"\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useParams, useSearchParams } from 'react-router-dom';\n\nimport { useInfiniteScroll } from 'ahooks';\nimport { VoiceScene, type VoiceConfigV2 } from '@coze-arch/idl/playground_api';\nimport { type DynamicParams } from '@coze-arch/bot-typings/teamspace';\nimport { PlaygroundApi } from '@coze-arch/bot-api';\n\nexport interface VoiceOptionParams {\n  language?: string;\n  voiceType?: VoiceScene;\n}\n\ninterface InfiniteScrollData {\n  list: VoiceConfigV2[];\n  hasMore?: boolean;\n  nextCursor?: string;\n}\n\nexport const useVoiceOptions = ({ language, voiceType }: VoiceOptionParams) => {\n  const { space_id } = useParams<DynamicParams>();\n  const [searchParams] = useSearchParams();\n  // The workflow details page space_id in the query string\n  const spaceId = space_id ?? searchParams.get('space_id') ?? '';\n\n  const { data, loading, loadMore, loadingMore } = useInfiniteScroll(\n    async (currentData?: InfiniteScrollData): Promise<InfiniteScrollData> => {\n      if (!language) {\n        return { list: [], hasMore: false };\n      }\n      const res = await PlaygroundApi.GetVoiceListV2({\n        page_size: 20,\n        language_code: language,\n        voice_type: voiceType ?? VoiceScene.Preset,\n        space_id: voiceType === VoiceScene.Library ? spaceId : undefined,\n        next_cursor: currentData?.nextCursor,\n      });\n      return {\n        list: res.data?.voice_list ?? [],\n        hasMore: res.data?.has_more,\n        nextCursor: res.data?.next_cursor,\n      };\n    },\n    {\n      reloadDeps: [language, voiceType],\n      isNoMore: currentData => !currentData?.hasMore,\n    },\n  );\n\n  return { options: data?.list ?? [], loading, loadMore, loadingMore };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useRef, useState } from 'react';\n\nimport { useInViewport } from 'ahooks';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozEmpty } from '@coze-arch/coze-design/icons';\nimport {\n  CozAvatar,\n  SegmentTab,\n  Select,\n  Tag,\n  Typography,\n  type SelectProps,\n} from '@coze-arch/coze-design';\nimport { type VoiceConfig } from '@coze-arch/bot-api/workflow_api';\nimport { VoiceScene } from '@coze-arch/bot-api/playground_api';\n\nimport { VoicePlayer } from '../voice-player';\nimport { useVoiceOptions } from './use-voice-options';\n\n// packages/studio/space-bot/src/component/text-to-speech/use-choose-voice/voice-select.tsx\nfunction LoadMoreTrigger({ onLoadMore }: { onLoadMore: () => void }) {\n  const divRef = useRef<HTMLDivElement>(null);\n  const [isInView] = useInViewport(divRef);\n\n  useEffect(() => {\n    if (!isInView) {\n      return;\n    }\n    onLoadMore?.();\n  }, [isInView]);\n\n  return <div ref={divRef} style={{ height: 1 }} />;\n}\n\nconst voiceTabs = [\n  {\n    label: I18n.t('workflow_select_voice_official'),\n    value: VoiceScene.Preset,\n  },\n  {\n    label: I18n.t('workflow_select_voice_library'),\n    value: VoiceScene.Library,\n  },\n];\n\ninterface VoiceDataSelectProps {\n  language?: string;\n  value?: VoiceConfig;\n  onChange: (v: { voice_id: string; voice_name: string }) => void;\n}\n\nexport const VoiceDataSelect: React.FC<VoiceDataSelectProps> = ({\n  value,\n  language,\n  onChange,\n}) => {\n  const [voiceType, setVoiceType] = useState(VoiceScene.Preset);\n\n  const { loading, options, loadMore, loadingMore } = useVoiceOptions({\n    language,\n    voiceType,\n  });\n\n  const handleChange = (v: string) => {\n    const voice = options.find(item => item.id === v);\n    if (voice) {\n      onChange({\n        voice_id: v,\n        voice_name: voice.name,\n      });\n    }\n  };\n\n  const selectedOption = options.find(i => i.id === value?.voice_id);\n\n  return (\n    <>\n      <Select\n        loading={loading}\n        value={value?.voice_id}\n        disabled={!language}\n        className=\"grow mr-[8px]\"\n        renderSelectedItem={() => selectedOption?.name ?? value?.voice_name}\n        onChange={handleChange as SelectProps['onChange']}\n        dropdownClassName=\"w-[308px] min-h-[152px] [&_.semi-select-loading-wrapper]:text-center\"\n        outerTopSlot={\n          <SegmentTab\n            size=\"small\"\n            className=\"mb-[2px]\"\n            value={voiceType}\n            options={voiceTabs}\n            onChange={e => setVoiceType(e.target.value)}\n          />\n        }\n        innerBottomSlot={\n          // When the Select option scrolls to the bottom, if it is not currently loaded, it triggers Load More\n          <LoadMoreTrigger\n            onLoadMore={() => {\n              if (!loading && !loadingMore) {\n                loadMore();\n              }\n            }}\n          />\n        }\n        emptyContent={\n          <div className=\"h-[92px] flex flex-col justify-center   items-center gap-[4px]\">\n            <IconCozEmpty className=\"text-[32px] coz-fg-dim\" />\n            <Typography.Text fontSize=\"14px\" weight={500}>\n              {I18n.t('voice_select_library_null')}\n            </Typography.Text>\n          </div>\n        }\n      >\n        {options.map(item => (\n          <Select.Option\n            className=\"[&_.option-text-wrapper]:overflow-hidden\"\n            value={item.id}\n            key={item.id}\n          >\n            <div className=\"h-[40px] w-full flex items-center gap-[8px] px-[8px] py-[6px]\">\n              <CozAvatar\n                type=\"platform\"\n                size=\"default\"\n                src={item.icon_url}\n                className=\"shrink-0\"\n              />\n              <div className=\"grow flex flex-col items-start overflow-hidden\">\n                <Typography.Text fontSize=\"14px\">{item.name}</Typography.Text>\n                {item.create_user_info ? (\n                  <div className=\"flex gap-[4px] items-center\">\n                    <CozAvatar\n                      size=\"micro\"\n                      src={item.create_user_info.icon_url}\n                    />\n                    <Typography.Text fontSize=\"12px\">\n                      {item.create_user_info.nick_name}\n                    </Typography.Text>\n                    <Typography.Text fontSize=\"12px\" type=\"secondary\">\n                      @{item.create_user_info.name}\n                    </Typography.Text>\n                  </div>\n                ) : item.scene ? (\n                  <Tag size=\"mini\" color=\"grey\">\n                    {item.scene}\n                  </Tag>\n                ) : null}\n              </div>\n              <div className=\"shrink-0\">\n                <VoicePlayer preview={item.preview_audio} />\n              </div>\n            </div>\n          </Select.Option>\n        ))}\n      </Select>\n      <VoicePlayer\n        key={selectedOption?.id}\n        preview={selectedOption?.preview_audio}\n      />\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozTrashCan } from '@coze-arch/coze-design/icons';\nimport { Select, IconButton, type SelectProps } from '@coze-arch/coze-design';\n\nimport { type LanguageOption } from './voice-data-select/use-language-options';\nimport { VoiceDataSelect } from './voice-data-select';\nimport { type VoiceValue } from './utils';\n\ninterface VoiceLanguageSelectProps {\n  value?: string;\n  onChange: (v: string) => void;\n  languageOptions: LanguageOption[];\n  disabledLanguages?: string[];\n}\n\nexport const VoiceLanguageSelect: React.FC<VoiceLanguageSelectProps> = ({\n  value,\n  onChange,\n  languageOptions,\n  disabledLanguages = [],\n}) => {\n  const optionList = useMemo(\n    () =>\n      languageOptions.map(item => ({\n        label: item.languageName,\n        value: item.languageCode,\n        disabled: disabledLanguages.includes(item.languageCode),\n      })),\n    [languageOptions, disabledLanguages],\n  );\n  return (\n    <Select\n      placeholder={I18n.t('bot_edit_voices_modal_language')}\n      optionList={optionList}\n      value={value}\n      onChange={onChange as SelectProps['onChange']}\n      className=\"w-[140px] shrink-0\"\n    />\n  );\n};\n\ninterface VoiceSelectProps {\n  value: VoiceValue;\n  languageOptions: LanguageOption[];\n  disabledLanguages?: string[];\n  onChange: (v: VoiceValue) => void;\n  onDelete: () => void;\n}\n\nexport const VoiceSelect: React.FC<VoiceSelectProps> = ({\n  value,\n  languageOptions,\n  disabledLanguages,\n  onChange,\n  onDelete,\n}) => (\n  <div className=\"flex items-center gap-[8px] px-[8px] py-[12px]\">\n    <VoiceLanguageSelect\n      value={value.language}\n      languageOptions={languageOptions}\n      disabledLanguages={disabledLanguages}\n      onChange={v => onChange({ language: v })}\n    />\n    <VoiceDataSelect\n      language={value.language}\n      value={value.data}\n      onChange={v =>\n        onChange({\n          language: value.language,\n          data: v,\n        })\n      }\n    />\n    <IconButton\n      color=\"secondary\"\n      size=\"small\"\n      icon={<IconCozTrashCan />}\n      onClick={onDelete}\n    />\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport { useRequest } from 'ahooks';\nimport { PlaygroundApi } from '@coze-arch/bot-api';\n\nexport interface LanguageOption {\n  languageCode: string;\n  languageName: string;\n}\n\nexport const useLanguageOptions = () => {\n  const [options, setOptions] = useState<LanguageOption[]>([]);\n\n  const { loading } = useRequest(() => PlaygroundApi.GetSupportLanguage(), {\n    onSuccess: res =>\n      setOptions(\n        res.language_list?.map(item => ({\n          languageCode: item.language_code ?? '',\n          languageName: item.language_name ?? '',\n        })) ?? [],\n      ),\n    onError: () => setOptions([]),\n  });\n\n  return { loading, options };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport {\n  useField,\n  observer,\n  type ObjectField,\n} from '@coze-workflow/test-run/formily';\nimport { I18n } from '@coze-arch/i18n';\nimport { type VoiceConfig } from '@coze-arch/bot-api/workflow_api';\nimport { IconCozEdit, IconCozPlus } from '@coze-arch/coze-design/icons';\nimport { IconButton, Button, Modal, Typography } from '@coze-arch/coze-design';\n\nimport { VoiceSelect } from './voice-select';\nimport {\n  type LanguageOption,\n  useLanguageOptions,\n} from './voice-data-select/use-language-options';\nimport { formatVoicesObj2Arr, type VoiceValue } from './utils';\n\ninterface AddVoicesFormProps {\n  initialValue: Record<string, VoiceConfig>;\n  languageOptions: LanguageOption[];\n  onChange: (v: Record<string, VoiceConfig>) => void;\n  onCancel: () => void;\n}\n\nconst getLanguages = (value: VoiceValue[]) =>\n  value.map(i => i.language).filter((i): i is string => Boolean(i));\n\nconst AddVoicesForm: React.FC<AddVoicesFormProps> = ({\n  initialValue,\n  languageOptions,\n  onChange,\n  onCancel,\n}) => {\n  const [innerValue, setInnerValue] = useState(\n    formatVoicesObj2Arr(initialValue),\n  );\n\n  const handleLanguageChange = (idx: number, val: VoiceValue) => {\n    setInnerValue(innerValue.map((i, index) => (index === idx ? val : i)));\n  };\n\n  const handleDelete = (idx: number) => {\n    setInnerValue(innerValue.filter((_, index) => index !== idx));\n  };\n\n  const handleAdd = () => {\n    setInnerValue([...innerValue, {}]);\n  };\n\n  const handleSubmit = () => {\n    const next = innerValue.reduce(\n      (prev, cur) => {\n        if (cur.data && cur.language) {\n          prev[cur.language] = cur.data;\n        }\n        return prev;\n      },\n      // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n      {} as Record<string, VoiceConfig>,\n    );\n    onChange(next);\n  };\n\n  const canAdd = innerValue.length < languageOptions.length;\n\n  return (\n    <div className=\"flex flex-col\">\n      {innerValue.map((item, idx) => (\n        <VoiceSelect\n          key={idx}\n          value={item}\n          onChange={v => handleLanguageChange(idx, v)}\n          onDelete={() => handleDelete(idx)}\n          languageOptions={languageOptions}\n          disabledLanguages={getLanguages(innerValue)}\n        />\n      ))}\n      {canAdd ? (\n        <div className=\"px-[8px] py-[12px]\">\n          <Button\n            color=\"primary\"\n            className=\"flex w-[140px]\"\n            icon={<IconCozPlus />}\n            onClick={handleAdd}\n          >\n            {I18n.t('bot_edit_voices_modal_add_language')}\n          </Button>\n        </div>\n      ) : null}\n      <div className=\"flex justify-end gap-[12px] mt-[24px]\">\n        <Button onClick={onCancel} color=\"primary\">\n          {I18n.t('cancel')}\n        </Button>\n        <Button onClick={handleSubmit}>{I18n.t('background_confirm')}</Button>\n      </div>\n    </div>\n  );\n};\n\nexport const AddVoices: React.FC = observer(() => {\n  const [visible, setVisible] = useState(false);\n  const field = useField<ObjectField>();\n  const { value, disabled } = field;\n\n  const voiceConfig = value?.config || {};\n\n  const isEdit = Object.values(voiceConfig).length > 0;\n\n  const { options: languageOptions } = useLanguageOptions();\n\n  const handleChange = (v: Record<string, VoiceConfig>) => {\n    field.setValue({\n      ...value,\n      config: v,\n    });\n    setVisible(false);\n  };\n\n  return (\n    <>\n      <IconButton\n        color=\"secondary\"\n        size=\"small\"\n        disabled={disabled}\n        icon={isEdit ? <IconCozEdit /> : <IconCozPlus />}\n        onClick={() => setVisible(true)}\n      />\n      <Modal\n        visible={visible}\n        title={I18n.t('bot_edit_voices_modal_title')}\n        onCancel={() => setVisible(false)}\n        footer={null}\n        className=\"[&_.semi-modal-footer]:hidden\"\n      >\n        <Typography.Text fontSize=\"14px\" className=\"mb-[16px]\">\n          {I18n.t('bot_edit_voices_modal_description', {\n            platform: IS_OVERSEA ? 'Cici' : '',\n          })}\n        </Typography.Text>\n        <AddVoicesForm\n          initialValue={voiceConfig}\n          languageOptions={languageOptions}\n          onCancel={() => setVisible(false)}\n          onChange={handleChange}\n        />\n      </Modal>\n    </>\n  );\n});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Typography, Switch } from '@coze-arch/coze-design';\n\ninterface TextToVoiceProps {\n  value?: boolean;\n  disabled?: boolean;\n  onChange: (v: boolean) => void;\n}\n\nexport const TextToVoice: React.FC<TextToVoiceProps> = ({\n  value,\n  disabled,\n  onChange,\n}) => (\n  <div className=\"flex items-center justify-between mb-[8px]\">\n    <div className=\"flex items-center gap-[4px]\">\n      <Typography.Text size=\"small\">\n        {I18n.t('workflow_role_config_text_2_voice')}\n      </Typography.Text>\n    </div>\n    <Switch\n      size=\"mini\"\n      checked={value}\n      disabled={disabled}\n      onChange={onChange}\n    />\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  Checkbox,\n  TextArea,\n  Typography,\n  type CheckboxProps,\n} from '@coze-arch/coze-design';\nimport { SuggestReplyInfoMode } from '@coze-arch/bot-api/workflow_api';\n\nimport css from './role-suggestion.module.less';\n\ninterface SuggestionValue {\n  suggest_reply_mode?: SuggestReplyInfoMode;\n  customized_suggest_prompt?: string;\n}\n\ninterface RoleSuggestionProps {\n  value?: SuggestionValue;\n  disabled?: boolean;\n  onChange: (v: SuggestionValue) => void;\n}\n\nexport const RoleSuggestion: React.FC<RoleSuggestionProps> = ({\n  value,\n  disabled,\n  onChange,\n}) => {\n  const mode = value?.suggest_reply_mode ?? SuggestReplyInfoMode.Disable;\n  const prompt = value?.customized_suggest_prompt;\n\n  const label = useMemo(() => {\n    if (mode === SuggestReplyInfoMode.Custom) {\n      return I18n.t('bot_edit_auto_suggestion_customize_description');\n    }\n    if (mode === SuggestReplyInfoMode.System) {\n      return I18n.t('bot_edit_auto_suggestion_default_description');\n    }\n    return I18n.t('bot_edit_auto_suggestion_off_description');\n  }, [mode]);\n\n  const isOpen = mode !== SuggestReplyInfoMode.Disable;\n  const isCustom = mode === SuggestReplyInfoMode.Custom;\n\n  const handleModeChange: CheckboxProps['onChange'] = v => {\n    const next = v.target.checked\n      ? SuggestReplyInfoMode.Custom\n      : SuggestReplyInfoMode.System;\n    onChange({\n      suggest_reply_mode: next,\n    });\n  };\n  const handlePromptChange = (v: string) => {\n    onChange({\n      suggest_reply_mode: SuggestReplyInfoMode.Custom,\n      customized_suggest_prompt: v,\n    });\n  };\n\n  return (\n    <div>\n      <Typography.Text size=\"small\" type=\"secondary\">\n        {label}\n      </Typography.Text>\n\n      {isOpen ? (\n        <div className={css['custom-block']}>\n          <Checkbox\n            checked={isCustom}\n            disabled={disabled}\n            onChange={handleModeChange}\n          >\n            <Typography.Text size=\"small\" style={{ lineHeight: '20px' }} strong>\n              {I18n.t('bot_edit_auto_suggestion_customize_user_checkbox')}\n            </Typography.Text>\n          </Checkbox>\n          {isCustom ? (\n            <TextArea\n              disabled={disabled}\n              placeholder={I18n.t(\n                'bot_edit_auto_suggestion_customize_modal_prompt_placeholder',\n              )}\n              value={prompt}\n              onChange={handlePromptChange}\n            />\n          ) : null}\n        </div>\n      ) : null}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  useField,\n  observer,\n  type ObjectField,\n} from '@coze-workflow/test-run/formily';\nimport { SuggestReplyInfoMode } from '@coze-arch/bot-api/workflow_api';\nimport { Switch } from '@coze-arch/coze-design';\n\nexport const RoleSuggestionSwitch: React.FC = observer(() => {\n  const field = useField<ObjectField>();\n  const { value, disabled } = field;\n  const status = value?.suggest_reply_mode;\n\n  const handleChange = v => {\n    const next = v ? SuggestReplyInfoMode.System : SuggestReplyInfoMode.Disable;\n\n    field.setValue({\n      suggest_reply_mode: next,\n    });\n  };\n\n  return (\n    <Switch\n      size=\"mini\"\n      checked={\n        status === SuggestReplyInfoMode.System ||\n        status === SuggestReplyInfoMode.Custom\n      }\n      disabled={disabled}\n      onChange={handleChange}\n    />\n  );\n});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport cls from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozHandle,\n  IconCozMinusCircle,\n} from '@coze-arch/coze-design/icons';\nimport { TextArea, IconButton, Typography } from '@coze-arch/coze-design';\n\nimport { SortableList } from '@/components/sortable-list';\n\nimport css from './suggestion-list.module.less';\n\nconst MAX_LEN = 100;\n\ninterface SuggestionItemProps {\n  value?: string;\n  dragRef?: React.Ref<HTMLDivElement>;\n  isLast: boolean;\n  disabled?: boolean;\n  onChange: (val: string) => void;\n  onDelete: () => void;\n}\n\nconst SuggestionItem: React.FC<SuggestionItemProps> = ({\n  value,\n  dragRef,\n  isLast,\n  disabled,\n  onChange,\n  onDelete,\n}) => {\n  const draggable = !(isLast && !value) && !disabled;\n  const deletable = !(isLast && !value) && !disabled;\n\n  return (\n    <div className={css['suggestion-list']}>\n      <div\n        className={cls(css['drag-btn'], {\n          [css.disabled]: !draggable,\n        })}\n        ref={draggable ? dragRef : null}\n      >\n        <IconCozHandle />\n      </div>\n      <TextArea\n        value={value}\n        className={css['text-area']}\n        autosize\n        rows={1}\n        onChange={onChange}\n        disabled={disabled}\n        placeholder={I18n.t('opening_question_placeholder')}\n      />\n      <div className={css['delete-btn']}>\n        <IconButton\n          color=\"secondary\"\n          size=\"small\"\n          disabled={!deletable}\n          icon={<IconCozMinusCircle />}\n          onClick={onDelete}\n        />\n      </div>\n    </div>\n  );\n};\n\ninterface SuggestionListProps {\n  value?: string[];\n  disabled?: boolean;\n  onChange: (val?: string[]) => void;\n}\n\nexport const SuggestionList: React.FC<SuggestionListProps> = ({\n  value,\n  disabled,\n  onChange,\n}) => {\n  const innerValue = useMemo(() => {\n    if (disabled) {\n      return value || [];\n    }\n    if (!value || (value.length < MAX_LEN && value.every(Boolean))) {\n      return (value || []).concat('');\n    }\n    return value || [];\n  }, [value, disabled]);\n\n  const handleChange = (next: string[]) => {\n    // Filter out all empty items\n    const temp = next.filter(i => Boolean(i));\n    onChange(temp);\n  };\n\n  const handleDelete = (idx: number) => {\n    handleChange(innerValue.filter((_, index) => index !== idx));\n  };\n\n  const handleContentChange = (idx: number, val: string) => {\n    const next = [...innerValue];\n    next.splice(idx, 1, val);\n    handleChange(next);\n  };\n\n  // The length is 0, it only appears in the read-only state, and the prompt text can be used.\n  if (!innerValue.length) {\n    return (\n      <Typography.Text size=\"small\">\n        {I18n.t('bot_element_unset')}\n      </Typography.Text>\n    );\n  }\n\n  return (\n    <SortableList\n      value={innerValue}\n      onChange={handleChange}\n      renderItem={(field, idx, opt) => (\n        <SuggestionItem\n          dragRef={opt?.dragRef}\n          value={innerValue[idx]}\n          isLast={idx === innerValue.length - 1}\n          disabled={disabled}\n          onChange={val => handleContentChange(idx, val)}\n          onDelete={() => handleDelete(idx)}\n        />\n      )}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useForm, observer } from '@coze-workflow/test-run/formily';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozInfoCircle } from '@coze-arch/coze-design/icons';\nimport { Popover, Switch, Typography } from '@coze-arch/coze-design';\n\nimport SugLayoutLimit from './sug_layout_limit.png';\nimport SugLayoutFull from './sug_layout_full.png';\n\nimport css from './display-all.module.less';\n\nexport const DisplayAllSwitch: React.FC = observer(() => {\n  const form = useForm();\n  const value = form.getValuesIn('display_all_suggestions') ?? false;\n\n  const { disabled } = form;\n\n  const handleChange = (v: boolean) => {\n    form.setValuesIn('display_all_suggestions', v);\n  };\n\n  return (\n    <div className={css['display-all']}>\n      <Popover\n        content={\n          <div>\n            <div className=\"coz-fg-plus text-base\tfont-medium\">\n              {I18n.t('opening_showall')}\n            </div>\n            <div className=\"coz-fg-secondary text-xs pb-3\">\n              {I18n.t('opening_showall_explain')}\n            </div>\n            <div className=\"coz-fg-secondary text-xs pb-[6px]\">\n              {I18n.t('opening_showall_explain_demo_on')}\n            </div>\n            <img height=\"112px\" width=\"288px\" src={SugLayoutLimit} />\n            <div className=\"coz-fg-secondary text-xs pb-[6px]\">\n              {I18n.t('opening_showall_explain_demo_off')}\n            </div>\n            <img height=\"112px\" width=\"288px\" src={SugLayoutFull} />\n          </div>\n        }\n      >\n        <IconCozInfoCircle />\n      </Popover>\n      <Typography.Text size=\"small\">\n        {I18n.t('opening_showall')}\n      </Typography.Text>\n      <Switch\n        size=\"mini\"\n        checked={value}\n        onChange={handleChange}\n        disabled={disabled}\n      />\n    </div>\n  );\n});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport { useForm, observer } from '@coze-workflow/test-run/formily';\nimport { workflowApi } from '@coze-workflow/base';\nimport { CopilotType } from '@coze-arch/bot-api/workflow_api';\nimport { AIButton } from '@coze-arch/coze-design';\n\nimport { useGlobalState } from '@/hooks';\n\nconst PROLOGUE_KEY = IS_OVERSEA ? 'Prologues:' : ':';\nconst QUESTION_KEY = IS_OVERSEA ? 'SuggestedQuestions:' : ':';\n\nconst formatContent = (str: string) => {\n  const parts = str.split('\\n\\n');\n  let prologue = '';\n  let questions: string[] = [];\n  for (const part of parts) {\n    if (part.startsWith(PROLOGUE_KEY)) {\n      prologue = part.replace(`${PROLOGUE_KEY}\\n`, '').trim(); // Extract the opening line and remove the label\n    } else if (part.startsWith(QUESTION_KEY)) {\n      const questionLines = part.replace(`${QUESTION_KEY}\\n`, '').trim(); // Remove the label\n      questions = questionLines.split('\\n').map(q => q.trim()); // Remove the number\n    }\n  }\n\n  return {\n    prologue,\n    questions,\n  };\n};\n\nexport const AIGenerateBtn: React.FC = observer(() => {\n  const form = useForm();\n  const [generating, setGenerating] = useState(false);\n\n  const { spaceId, workflowId } = useGlobalState();\n\n  const generate = async () => {\n    const query = form.getValuesIn('name');\n\n    try {\n      setGenerating(true);\n      const { data } = await workflowApi.CopilotGenerate({\n        space_id: spaceId,\n        project_id: '',\n        copilot_type: CopilotType.OnboardingMessage,\n        query,\n        workflow_id: workflowId,\n      });\n      const { prologue, questions } = formatContent(data?.content || '');\n\n      if (prologue) {\n        form.setValuesIn('prologue', prologue);\n      }\n      if (Array.isArray(questions) && questions.length) {\n        form.setValuesIn('questions', questions);\n      }\n    } finally {\n      setGenerating(false);\n    }\n  };\n\n  return (\n    <AIButton\n      size=\"small\"\n      color=\"aihglt\"\n      onlyIcon\n      loading={generating}\n      disabled={form.disabled}\n      onClick={generate}\n    />\n  );\n});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useEffect } from 'react';\n\nimport { Input } from '@coze-workflow/test-run/formily';\n\nimport { useGlobalState } from '@/hooks';\n\nexport const RoleNameInput = ({ value, onChange, onBlur, ...props }) => {\n  const [innerValue, setInnerValue] = useState(value);\n  const { info } = useGlobalState();\n\n  const handleChange = (val: string) => {\n    setInnerValue(val);\n  };\n\n  const handleBlur = () => {\n    let nextValue = innerValue;\n    // If the user deletes the character name, the original value needs to be backfilled after being out of focus\n    if (!nextValue && value) {\n      nextValue = value;\n    }\n    onChange(nextValue);\n    setInnerValue(nextValue);\n    onBlur();\n  };\n\n  useEffect(() => {\n    if (value !== innerValue) {\n      setInnerValue(value);\n    }\n  }, [value]);\n\n  return (\n    <Input\n      value={innerValue}\n      placeholder={info?.name}\n      onChange={handleChange}\n      onBlur={handleBlur}\n      {...props}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozInfoCircle } from '@coze-arch/coze-design/icons';\nimport { Typography, Select, Tooltip } from '@coze-arch/coze-design';\nimport { InputMode } from '@coze-arch/bot-api/workflow_api';\n\nimport tooltipImg from './tooltip.png';\n\nimport css from './role-default-input.module.less';\n\ninterface RoleDefaultInputProps {\n  value?: InputMode;\n  disabled?: boolean;\n  onChange: (v: InputMode) => void;\n}\n\nconst options = [\n  {\n    label: I18n.t('agent_ide_default_input_option_text'),\n    value: InputMode.text,\n  },\n  {\n    label: I18n.t('agent_ide_default_input_option_voice'),\n    value: InputMode.audio,\n  },\n];\n\nexport const RoleDefaultInput: React.FC<RoleDefaultInputProps> = ({\n  value,\n  disabled,\n  onChange,\n}) => {\n  const innerValue = value ?? InputMode.text;\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const handleChange = (v: any) => {\n    onChange(v);\n  };\n\n  return (\n    <div className={css['default-input']}>\n      <div className={css['input-label']}>\n        <Typography.Text size=\"small\">\n          {I18n.t('agent_ide_default_input_option')}\n        </Typography.Text>\n        <Tooltip\n          className={css['tooltip-wrap']}\n          theme=\"dark\"\n          content={\n            <div className={css['input-tooltip']}>\n              <img src={tooltipImg} />\n              <Typography.Text className=\"coz-fg-hglt-plus\">\n                {I18n.t('workflow_role_config_default_input_tooltip')}\n              </Typography.Text>\n            </div>\n          }\n        >\n          <IconCozInfoCircle className={css['tooltip-icon']} />\n        </Tooltip>\n      </div>\n      <Select\n        value={innerValue}\n        optionList={options}\n        size=\"small\"\n        disabled={disabled}\n        style={{ width: 130 }}\n        onChange={handleChange}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReactCropperElement } from 'react-cropper';\nimport { type RefObject } from 'react';\n\nimport { floor, pick } from 'lodash-es';\nimport ColorThief from 'colorthief';\nimport { MODE_CONFIG } from '@coze-common/chat-uikit';\nimport { I18n } from '@coze-arch/i18n';\nimport { Toast } from '@coze-arch/coze-design';\nimport { CustomError } from '@coze-arch/bot-error';\nimport { type BackgroundImageInfo } from '@coze-arch/bot-api/workflow_api';\nimport {\n  type CanvasPosition,\n  type GradientPosition,\n} from '@coze-arch/bot-api/developer_api';\n\nconst MIN_HEIGHT = 640;\n\n// The function that limits the width and height of the image upload, returns true if the conditions are met, false if not\nexport const checkImageWidthAndHeight = (file: Blob): Promise<boolean> =>\n  new Promise((resolve, reject) => {\n    const fileReader = new FileReader();\n    fileReader.onload = event => {\n      const result = event.target?.result;\n      if (!result || typeof result !== 'string') {\n        reject(\n          new CustomError('checkImageWidthAndHeight', 'file read invalid'),\n        );\n        return;\n      }\n      const image = new Image();\n      image.src = result;\n      image.onload = function () {\n        if (image.height < MIN_HEIGHT) {\n          Toast.error(I18n.t('bgi_upload_image_format_requirement'));\n          resolve(false);\n        } else if (image.complete) {\n          resolve(true);\n        }\n      };\n    };\n    fileReader.onerror = () => {\n      reject(new CustomError('checkImageWidthAndHeight', 'file read fail'));\n    };\n    fileReader.onabort = () => {\n      reject(new CustomError('checkImageWidthAndHeight', 'file read abort'));\n    };\n    fileReader.readAsDataURL(file);\n  });\n\nexport const getPictureValue = (value?: BackgroundImageInfo) => {\n  if (!value) {\n    return {};\n  }\n  return {\n    url: value?.web_background_image?.origin_image_url ?? '',\n    uri: value?.web_background_image?.origin_image_uri ?? '',\n  };\n};\n\nexport const getModeInfo = (mode: 'pc' | 'mobile') => MODE_CONFIG[mode];\n\n// Calculate shadow position\nexport const computePosition = (\n  mode: 'pc' | 'mobile',\n  cropperRef: RefObject<ReactCropperElement>,\n): GradientPosition => {\n  const cropperObj = cropperRef?.current?.cropper;\n  if (!cropperObj) {\n    return {\n      left: 0,\n      right: 0,\n    };\n  }\n  const { size } = getModeInfo(mode);\n  const cropperWidth = size.width;\n  const canvasData = cropperObj?.getCanvasData();\n  const imgData = cropperObj?.getImageData();\n\n  // Image left edge, distance, offset distance from the left edge of the crop area\n  const imgToScreenLeft = imgData.left + canvasData?.left;\n  // The distance of the picture from the right screen, > 0, the right side is not full of pictures\n  const imgToScreenRight = cropperWidth - imgData.width - imgToScreenLeft;\n\n  // Left value required for gradual change of left rendering: render left when there is a gap on the left, otherwise no need\n  const leftPercent = floor(imgToScreenLeft / cropperWidth, 2);\n\n  // The right value required for gradual change of right rendering\n  const rightPercent = floor(imgToScreenRight / cropperWidth, 2);\n\n  return {\n    left: leftPercent,\n    right: rightPercent,\n  };\n};\nexport const canvasPosition = (\n  cropperRef: RefObject<ReactCropperElement>,\n): CanvasPosition =>\n  pick(cropperRef.current?.cropper.getCanvasData(), [\n    'left',\n    'top',\n    'width',\n    'height',\n  ]);\n\nexport function getImageThemeColor(url: string): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const colorThief = new ColorThief();\n    const img = new Image();\n    img.src = url;\n    img.onload = () => {\n      const thiefColor = colorThief.getColor(img);\n      if (thiefColor) {\n        const [a, b, c] = thiefColor;\n        const color = `rgba(${a}, ${b}, ${c})`;\n        resolve(color);\n      } else {\n        reject(new CustomError('getImageThemeColor', 'not get theme color'));\n      }\n    };\n  });\n}\n\n// Calculate theme color\nexport const computeThemeColor = (\n  cropperRefList: RefObject<ReactCropperElement>[],\n): Promise<string[]> =>\n  new Promise((resolve, reject) => {\n    const promises: Promise<string>[] = [];\n    // Process each canvas element\n    cropperRefList.forEach(cropperEle => {\n      promises.push(\n        new Promise<string>((resolveColor, rejectColor) => {\n          const cropperObj = cropperEle.current?.cropper;\n          const corp = cropperObj\n            ?.getCroppedCanvas()\n            ?.toDataURL('image/webp', 0.7);\n          if (!corp) {\n            rejectColor(\n              new CustomError('computeThemeColor', 'cropper not exist'),\n            );\n          } else {\n            getImageThemeColor(corp).then((res: string) => {\n              resolveColor(res);\n            });\n          }\n        }),\n      );\n    });\n    Promise.all(promises)\n      .then(colors => resolve(colors))\n      .catch(error => reject(error));\n  });\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { workflowApi } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { upLoadFile } from '@coze-arch/bot-utils';\nimport { Toast } from '@coze-arch/bot-semi';\n\nexport const useUploadImage = ({\n  onUploadError,\n  onUploadSuccess,\n}: {\n  onUploadSuccess: (param: { url: string; uri: string }) => void;\n  onUploadError: () => void;\n}) => {\n  const handleError = () => {\n    onUploadError();\n    Toast.error({\n      content: I18n.t('Upload_failed'),\n      showClose: false,\n    });\n  };\n\n  const upload = async (file: File) => {\n    let uri: string, url: string;\n    try {\n      uri = await upLoadFile({\n        biz: 'workflow',\n        fileType: 'image',\n        file,\n      });\n    } catch {\n      handleError();\n      return;\n    }\n    if (!uri) {\n      handleError();\n      return;\n    }\n\n    try {\n      const data = await workflowApi.SignImageURL({\n        uri,\n        Scene: 'AUDIT',\n      });\n      url = data.url;\n      if (!url) {\n        handleError();\n        return;\n      }\n    } catch {\n      onUploadError();\n      return;\n    }\n    onUploadSuccess({\n      uri,\n      url,\n    });\n  };\n\n  return {\n    upload,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReactCropperElement } from 'react-cropper';\nimport { type RefObject } from 'react';\n\nimport { logger } from '@coze-arch/logger';\nimport { type FileItem } from '@coze-arch/bot-semi/Upload';\nimport {\n  type BackgroundImageDetail,\n  type BackgroundImageInfo,\n} from '@coze-arch/bot-api/developer_api';\n\nimport { canvasPosition, computePosition, computeThemeColor } from './utils';\nimport { useUploadImage } from './use-upload-image';\n\nexport interface SubmitCroppedImageParams {\n  cropperWebRef: RefObject<ReactCropperElement>;\n  cropperMobileRef: RefObject<ReactCropperElement>;\n  setLoading: (loading: boolean) => void;\n  onSuccess: (value: BackgroundImageInfo) => void;\n  currentOriginImage: Partial<FileItem>;\n  handleCancel: () => void;\n  onAuditCheck: (notPass: boolean) => void;\n}\n\nexport interface FileValue {\n  uri: string;\n  url: string;\n}\n\ninterface GetBackgroundInfoItemParams {\n  mode: 'pc' | 'mobile';\n  originImageInfo: {\n    origin_image_uri: string;\n    origin_image_url: string;\n  };\n  themeColorList: string[];\n}\nexport const useSubmitCroppedImage = ({\n  cropperWebRef,\n  cropperMobileRef,\n  setLoading,\n  onSuccess,\n  currentOriginImage,\n  handleCancel,\n}: SubmitCroppedImageParams) => {\n  const getBackgroundInfoItem = ({\n    mode,\n    originImageInfo,\n    themeColorList,\n  }: GetBackgroundInfoItemParams): BackgroundImageDetail => {\n    const cropperRef = mode === 'pc' ? cropperWebRef : cropperMobileRef;\n    return {\n      ...originImageInfo,\n      theme_color: mode === 'pc' ? themeColorList[0] : themeColorList[1],\n      gradient_position: computePosition(mode, cropperRef),\n      canvas_position: canvasPosition(cropperRef),\n    };\n  };\n\n  const handleUploadAllSuccess = async (croppedImage?: FileValue) => {\n    setLoading(false);\n\n    const themeColorList = await computeThemeColor([\n      cropperWebRef,\n      cropperMobileRef,\n    ]);\n\n    if (!currentOriginImage?.url) {\n      return;\n    }\n\n    const originImageInfo = {\n      origin_image_uri: croppedImage?.uri || currentOriginImage.uri,\n      origin_image_url: croppedImage?.url || currentOriginImage.url,\n    };\n    const info = {\n      themeColorList,\n      originImageInfo,\n    };\n    const backgroundImage = {\n      web_background_image: getBackgroundInfoItem({\n        mode: 'pc',\n        ...info,\n      }),\n      mobile_background_image: getBackgroundInfoItem({\n        mode: 'mobile',\n        ...info,\n      }),\n    };\n\n    onSuccess(backgroundImage);\n    handleCancel();\n  };\n  const { upload } = useUploadImage({\n    onUploadSuccess: handleUploadAllSuccess,\n    onUploadError: () => {\n      setLoading(false);\n    },\n  });\n\n  const handleSubmit = () => {\n    setLoading(true);\n\n    try {\n      if (\n        currentOriginImage?.fileInstance &&\n        currentOriginImage?.fileInstance instanceof File\n      ) {\n        upload(currentOriginImage.fileInstance);\n      } else {\n        // When backfilling the document, there is no need to save the original image.\n        handleUploadAllSuccess();\n      }\n    } catch (error) {\n      if (error instanceof Error) {\n        logger.error({ error });\n      }\n    }\n  };\n\n  return { handleSubmit };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type React from 'react';\nimport { type DragEventHandler, useRef, useState } from 'react';\n\nconst checkHasFileOnDrag = (e: React.DragEvent<HTMLDivElement>) =>\n  // The basis for the judgment is to directly look at the type explanation of types\n  Boolean(e.dataTransfer?.types.includes('Files'));\n\nexport const useDragImage = () => {\n  const timer = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  const [isDragIn, setIsDragIn] = useState(false);\n\n  const clearTimer = () => {\n    if (!timer.current) {\n      return;\n    }\n    clearTimeout(timer.current);\n    timer.current = null;\n  };\n  const onDragEnter: DragEventHandler<HTMLDivElement> = e => {\n    clearTimer();\n    if (!checkHasFileOnDrag(e)) {\n      return;\n    }\n    setIsDragIn(true);\n  };\n\n  const onDragEnd = () => {\n    clearTimer();\n    timer.current = setTimeout(() => {\n      setIsDragIn(false);\n    }, 100);\n  };\n\n  const onDragOver: DragEventHandler<HTMLDivElement> = e => {\n    e.preventDefault();\n    clearTimer();\n    if (!checkHasFileOnDrag(e)) {\n      return;\n    }\n    setIsDragIn(true);\n  };\n\n  return {\n    isDragIn,\n    setIsDragIn,\n    onDragEnter,\n    onDragEnd,\n    onDragOver,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Button, Typography } from '@coze-arch/coze-design';\n\nimport css from './upload-modal-footer.module.less';\n\ninterface UploadModalFooterProps {\n  onReUpload: () => void;\n  onSubmit: () => void;\n  onCancel: () => void;\n}\n\nexport const UploadModalFooter: React.FC<UploadModalFooterProps> = ({\n  onReUpload,\n  onSubmit,\n  onCancel,\n}) => (\n  <div className={css['modal-footer']}>\n    <div className={css['modal-left']}>\n      <Button color=\"primary\" onClick={onReUpload}>\n        {I18n.t('bgi_reupload')}\n      </Button>\n      <Typography.Text type=\"secondary\" size=\"small\">\n        {I18n.t('bgi_adjust_tooltip_content')}\n      </Typography.Text>\n    </div>\n    <div className={css['modal-right']}>\n      <Button color=\"highlight\" onClick={onCancel}>\n        {I18n.t('Cancel')}\n      </Button>\n      <Button onClick={onSubmit}>{I18n.t('Confirm')}</Button>\n    </div>\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport cls from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozUpload, IconCozInfoCircle } from '@coze-arch/coze-design/icons';\nimport { Typography, Tooltip, Button } from '@coze-arch/coze-design';\n\nimport img from './image.png';\n\nimport css from './drag-upload-content.module.less';\n\ninterface BaseDragUploadContentProps {\n  onUpload?: () => void;\n}\n\nconst BaseDragUploadContent: React.FC<BaseDragUploadContentProps> = ({\n  onUpload,\n}) => (\n  <div className={css['base-upload-content']}>\n    <IconCozUpload className={css['upload-icon']} />\n    <div className={css['upload-title']}>\n      {I18n.t('upload_image_guide')}\n      <Tooltip\n        content={\n          <div className={css['upload-tooltip']}>\n            <Typography.Text>\n              {I18n.t('bgi_upload_image_format_requirement_title')}\n            </Typography.Text>\n            <br />\n            <Typography.Text size=\"small\" type=\"secondary\">\n              {I18n.t('bgi_upload_image_format_requirement')}\n            </Typography.Text>\n            <br />\n            <img src={img} />\n          </div>\n        }\n      >\n        <IconCozInfoCircle className={css['tooltip-icon']} />\n      </Tooltip>\n    </div>\n    <Typography.Text\n      size=\"small\"\n      type=\"secondary\"\n      className={css['upload-desc']}\n    >\n      {I18n.t('upload_image_format_requirement')}\n    </Typography.Text>\n    <Button onClick={onUpload} color=\"primary\">\n      {I18n.t('upload_image')}\n    </Button>\n  </div>\n);\n\nexport const FullDragUploadContent = () => (\n  <div className={css['full-upload-content']}>\n    <BaseDragUploadContent />\n  </div>\n);\n\ninterface DragUploadContentProps {\n  onUpload: () => void;\n}\n\nexport const DragUploadContent: React.FC<DragUploadContentProps> = ({\n  onUpload,\n}) => {\n  const [dragIn, setDragIn] = useState(false);\n\n  return (\n    <div\n      className={cls(css['normal-upload-content'], {\n        [css.dragging]: dragIn,\n      })}\n      onClick={e => e.stopPropagation()}\n      onDragEnter={() => {\n        setDragIn(true);\n      }}\n      onDragLeave={() => {\n        setDragIn(false);\n      }}\n    >\n      <BaseDragUploadContent onUpload={onUpload} />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReactCropperElement } from 'react-cropper';\nimport { type RefObject, useState, useEffect, useRef } from 'react';\n\nimport { ceil, floor } from 'lodash-es';\nimport { MODE_CONFIG } from '@coze-common/chat-uikit';\nimport {\n  type BackgroundImageDetail,\n  type GradientPosition,\n} from '@coze-arch/bot-api/developer_api';\n\nimport { computePosition, getImageThemeColor } from '../utils';\n\nexport const useCropperImg = ({\n  cropperRef,\n  url,\n  mode,\n  setLoading,\n  backgroundInfo,\n}: {\n  cropperRef: RefObject<ReactCropperElement>;\n  url: string;\n  mode: 'pc' | 'mobile';\n  setLoading: (loading: boolean) => void;\n  backgroundInfo?: BackgroundImageDetail;\n}) => {\n  const [gradientPosition, setGradientPosition] = useState<GradientPosition>({\n    left: 0,\n    right: 0,\n  });\n  const [themeColor, setThemeColor] = useState(\n    backgroundInfo?.theme_color ?? '#fff',\n  );\n  const currentUrl = useRef(url);\n  const { size, centerWidth } = MODE_CONFIG[mode];\n  useEffect(() => {\n    currentUrl.current = url;\n    if (!url) {\n      setThemeColor('#fff');\n    }\n    handleGradientPosition();\n  }, [url]);\n\n  // Set the maximum zoom ratio\n  const onZoom = () => {\n    const {\n      width = 0,\n      height = 0,\n      naturalWidth = 0,\n      naturalHeight = 0,\n    } = cropperRef.current?.cropper?.getCanvasData() ?? {};\n\n    if (naturalWidth > naturalHeight) {\n      if (height >= size.height * 2) {\n        cropperRef.current?.cropper.setCanvasData({\n          height: size.width * 2,\n        });\n      }\n    } else {\n      if (width > size.width * 2) {\n        cropperRef.current?.cropper.setCanvasData({\n          width: size.width * 2,\n        });\n      }\n    }\n    // TODO: Because there is no zoom end event, the zoom gets the theme color in real time. The large picture card is serious, so the scene does not get the theme color temporarily, modify the interaction or try webworker to solve this problem.\n    // await handleThemeColor();\n  };\n\n  const handleGradientPosition = () => {\n    const position = computePosition(mode, cropperRef);\n    setGradientPosition(position);\n  };\n\n  const handleDragLimit = (y: number) => {\n    const cropperObj = cropperRef?.current?.cropper;\n\n    if (!cropperObj) {\n      return;\n    }\n    const canvasData = cropperObj?.getCanvasData();\n    const imgData = cropperObj?.getImageData();\n    // Image lower edge, distance, offset distance of lower edge of crop area\n    const scaleTop = imgData.height + canvasData.top - size.height;\n    // Image left edge, distance, offset distance from the left edge of the crop area\n    const scaleLeft = ceil(imgData.left + canvasData?.left, 2);\n\n    // Drag the picture up and down, it cannot exceed the picture container.\n    if (y < 0) {\n      cropperRef.current?.cropper.setCanvasData({\n        top: 0,\n      });\n    }\n    if (scaleTop < 0) {\n      cropperRef.current?.cropper.setCanvasData({\n        top: size.height - imgData.height,\n      });\n    }\n\n    // UX product requirements: drag left and right cannot exceed, fix \"dialogue bubble container\" left or right 80%\n    const maxRightOffset = floor(\n      (size.width - centerWidth) / 2 + centerWidth * 0.4,\n      2,\n    );\n    const maxLeftOffset = floor(size.width - imgData.width - maxRightOffset, 2);\n    if (scaleLeft > maxRightOffset || scaleLeft < maxLeftOffset) {\n      cropperRef.current?.cropper.setCanvasData({\n        left: scaleLeft > maxRightOffset ? maxRightOffset : maxLeftOffset,\n      });\n    }\n  };\n\n  const handleCrop = (detail: Cropper.CropEvent) => {\n    handleGradientPosition();\n    handleDragLimit(detail.detail.y);\n  };\n\n  const cropEnd = async () => {\n    await handleThemeColor();\n    handleGradientPosition();\n  };\n\n  const handleThemeColor = async () => {\n    const cropperObj = cropperRef.current?.cropper;\n    // Large picture move card optimization scheme: move is prohibited before the theme color is obtained when the move stops\n    cropperObj?.disable();\n    // To load faster, set the picture quality to medium\n    const corp = cropperObj?.getCroppedCanvas()?.toDataURL('image/webp', 0.7);\n    if (corp) {\n      const color = await getImageThemeColor(corp);\n      setThemeColor(color);\n      cropperObj?.enable();\n    }\n  };\n\n  const handleReady = async () => {\n    const cropperObj = cropperRef.current?.cropper;\n    if (\n      backgroundInfo?.canvas_position &&\n      currentUrl.current === backgroundInfo.origin_image_url\n    ) {\n      cropperObj?.setCanvasData(backgroundInfo?.canvas_position);\n    }\n    await handleThemeColor();\n\n    setLoading(false);\n  };\n\n  return {\n    gradientPosition,\n    handleReady,\n    handleThemeColor,\n    handleCrop,\n    cropEnd,\n    onZoom,\n    themeColor,\n    size,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport classNames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { Tag } from '@coze-arch/coze-design';\nimport { IconSpin } from '@douyinfe/semi-icons';\n\nimport s from './cropper-cover.module.less';\ninterface CropperCoverProps {\n  loading: boolean;\n  mode: 'pc' | 'mobile';\n  hasUrl: boolean;\n}\n\nconst Config = {\n  pc: [\n    {\n      width: 300,\n      height: 45,\n    },\n    {\n      width: 300,\n      height: 34,\n    },\n    {\n      width: 73,\n      height: 24,\n    },\n  ],\n\n  mobile: [\n    {\n      width: 186,\n      height: 63,\n    },\n    {\n      width: 185,\n      height: 28,\n    },\n    {\n      width: 60,\n      height: 20,\n    },\n  ],\n};\n\nconst BubbleContent = ({\n  bg,\n  width,\n  height,\n  rounded,\n  className,\n}: {\n  bg: string;\n  width: number;\n  height: number;\n  rounded: string;\n  className: string;\n}) => (\n  <div\n    className={`rounded-${rounded} ${className}`}\n    style={{\n      background: bg,\n      width,\n      height,\n      backdropFilter: 'blur(6px)',\n    }}\n  ></div>\n);\n\nconst AvaterContent = ({ bg, size }: { bg: string; size: number }) => (\n  <div\n    className={`bg-[${bg}] rounded-full`}\n    style={{\n      background: bg,\n      width: size,\n      height: size,\n    }}\n  ></div>\n);\n\nexport const CropperCover: React.FC<CropperCoverProps> = ({\n  mode,\n  loading = false,\n  hasUrl = false,\n}) =>\n  useMemo(\n    () => (\n      <div className=\"w-full h-full p-2 absolute z-[200] pointer-events-none \">\n        <div className=\"flex gap-2 mb-6\">\n          <Tag\n            color=\"primary\"\n            prefixIcon={null}\n            // The background cover color is suitable here, and the color is fixed and does not change.\n            className=\"!text-white !bg-[rgba(0,0,0,0.28)]\"\n          >\n            {mode === 'pc'\n              ? I18n.t('display_on_widescreen')\n              : I18n.t('display_on_vertical_screen')}\n          </Tag>\n          {loading ? (\n            <Tag\n              color=\"primary\"\n              prefixIcon={<IconSpin spin />}\n              className=\"!text-white !bg-[rgba(0,0,0,0.28)]\"\n            >\n              {I18n.t('knowledge_insert_img_009')}\n            </Tag>\n          ) : null}\n        </div>\n        <div className=\"flex justify-center\">\n          <div className={mode === 'pc' ? 'w-[326px]' : 'w-[205px]'}>\n            {Config[mode].map((item, index) => {\n              const notHasBackground = loading || !hasUrl;\n              const background = notHasBackground\n                ? index === 1\n                  ? '#4E40E5'\n                  : '#F4F4F6'\n                : index === 1\n                ? 'rgba(6, 7, 9, 0.24)'\n                : 'rgba(255, 255, 255, 0.60)';\n              return (\n                <div className=\"flex gap-1 mb-2\" key={index}>\n                  <AvaterContent\n                    size={mode === 'pc' ? 18 : 16}\n                    bg={background}\n                  />\n                  <div>\n                    <div\n                      className={classNames(s.text, {\n                        [s.shadow]: !notHasBackground,\n                        'coz-fg-dim': notHasBackground,\n                        'text-white': !notHasBackground,\n                      })}\n                    >\n                      {index === 1 ? 'Glory' : 'Coze'}\n                    </div>\n                    <BubbleContent\n                      width={item.width}\n                      height={item.height}\n                      bg={background}\n                      rounded=\"lg\"\n                      className={classNames({\n                        [s['background-border']]: !notHasBackground,\n                        [s.default]: notHasBackground,\n                      })}\n                    />\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n    ),\n    [mode, loading, hasUrl],\n  );\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Cropper, { type ReactCropperElement } from 'react-cropper';\nimport React, { type RefObject } from 'react';\n\nimport { debounce } from 'lodash-es';\nimport classNames from 'classnames';\nimport { WithRuleImgBackground } from '@coze-common/chat-uikit';\nimport { type BackgroundImageDetail } from '@coze-arch/bot-api/developer_api';\n\nimport { useCropperImg } from './use-crop-image';\nimport { CropperCover } from './cropper-cover';\n\nimport s from './cropper-img.module.less';\n\nimport 'cropperjs/dist/cropper.css';\n\ninterface CropperProps {\n  url?: string;\n  cropperRef: RefObject<ReactCropperElement>;\n  accept?: string;\n  mode?: 'pc' | 'mobile';\n\n  loading: boolean;\n  setLoading: (loading: boolean) => void;\n  backgroundInfo?: BackgroundImageDetail;\n}\n\nexport const CropperImg: React.FC<CropperProps> = ({\n  url = '',\n  mode = 'pc',\n  cropperRef,\n  loading,\n  setLoading,\n  backgroundInfo,\n}) => {\n  const {\n    handleCrop,\n    handleReady,\n    themeColor,\n    gradientPosition,\n    size,\n    onZoom,\n    cropEnd,\n  } = useCropperImg({\n    url,\n    mode,\n    cropperRef,\n    setLoading,\n    backgroundInfo,\n  });\n\n  const currentBackgroundInfo: BackgroundImageDetail = {\n    image_url: url,\n    gradient_position: gradientPosition,\n    theme_color: themeColor,\n  };\n\n  const debouncedZoom = debounce(onZoom, 100);\n  return (\n    <div\n      className={`${classNames(\n        s['cropper-container'],\n      )} outline outline-1 outline-[#0607091A] hover:outline-[#4E40E5]`}\n      style={{ background: themeColor, height: size.height, width: size.width }}\n    >\n      <CropperCover mode={mode} loading={loading} hasUrl={!!url} />\n      <WithRuleImgBackground\n        key={mode}\n        backgroundInfo={{\n          web_background_image: mode === 'pc' ? currentBackgroundInfo : {},\n          mobile_background_image:\n            mode === 'mobile' ? currentBackgroundInfo : {},\n        }}\n        preview\n      />\n      {url ? (\n        <Cropper\n          ready={handleReady}\n          initialAspectRatio={size.width / size.height}\n          src={url}\n          style={{ height: size.height, width: size.width }}\n          background={false} // Whether to display a grid background within the container\n          guides={false}\n          zoom={debouncedZoom}\n          ref={cropperRef}\n          dragMode=\"move\" // Image container removable\n          viewMode={0} // Define the view mode of the cropper, 0 allows the cropping box to extend beyond the image container\n          modal={false} // Whether to display a black mask between the image and the crop box\n          center={false}\n          cropBoxMovable={false} // Whether you can drag and drop the crop box, the default is true.\n          cropBoxResizable={false} // Default true, whether to allow dragging, change the size of the crop box\n          highlight={false}\n          autoCropArea={1}\n          minCanvasHeight={size.height}\n          minCropBoxHeight={size.height}\n          minCropBoxWidth={size.width}\n          minContainerWidth={size.width}\n          crop={handleCrop}\n          cropend={cropEnd}\n          checkCrossOrigin={false}\n          checkOrientation={false}\n          crossOrigin={'anonymous'}\n        />\n      ) : null}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReactCropperElement } from 'react-cropper';\nimport { useState, useRef, createRef } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  Modal,\n  Upload,\n  Toast,\n  type UploadProps,\n  type FileItem,\n} from '@coze-arch/coze-design';\nimport { type BackgroundImageInfo } from '@coze-arch/bot-api/workflow_api';\n\nimport { checkImageWidthAndHeight, getPictureValue } from './utils';\nimport { useSubmitCroppedImage } from './use-submit-cropped-image';\nimport { useDragImage } from './use-drag-image';\nimport { UploadModalFooter } from './upload-modal-footer';\nimport {\n  DragUploadContent,\n  FullDragUploadContent,\n} from './drag-upload-content';\nimport { CropperImg } from './cropper';\n\nimport css from './background-modal.module.less';\n\nexport const MAX_IMG_SIZE = 10 * 1024;\n\ninterface BackgroundModalProps {\n  visible?: boolean;\n  value?: BackgroundImageInfo;\n  onChange: (v: BackgroundImageInfo) => void;\n  onCancel: () => void;\n}\n\nexport const BackgroundModal: React.FC<BackgroundModalProps> = ({\n  visible,\n  value,\n  onChange,\n  onCancel,\n}) => {\n  const [loading, setLoading] = useState(false);\n  const { onDragEnter, onDragEnd, isDragIn, onDragOver } = useDragImage();\n  const [pictureValue, setPictureValue] = useState<Partial<FileItem>>(\n    getPictureValue(value),\n  );\n  const uploaderRef = useRef<Upload>(null);\n  const cropperWebRef = createRef<ReactCropperElement>();\n  const cropperMobileRef = createRef<ReactCropperElement>();\n\n  const isEmpty = !pictureValue.url;\n\n  const customRequest: UploadProps['customRequest'] = async options => {\n    setLoading(true);\n    const { onSuccess, onError, file } = options;\n    if (typeof file === 'string') {\n      return;\n    }\n    try {\n      const { fileInstance } = file;\n      if (fileInstance) {\n        const validateSize = await checkImageWidthAndHeight(fileInstance);\n        if (validateSize) {\n          onSuccess(file);\n          setPictureValue(file);\n        } else {\n          setLoading(false);\n        }\n      } else {\n        onError({\n          status: 0,\n        });\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const clearAllSideEffect = () => {\n    [cropperWebRef, cropperMobileRef].forEach(item => {\n      item.current?.cropper?.destroy();\n    });\n  };\n\n  const handleCancel = () => {\n    onCancel();\n    clearAllSideEffect();\n  };\n\n  const { handleSubmit } = useSubmitCroppedImage({\n    onSuccess: onChange,\n    handleCancel,\n    cropperWebRef,\n    cropperMobileRef,\n    currentOriginImage: pictureValue ?? {},\n    setLoading,\n    onAuditCheck: () => {\n      Toast.error({\n        content: I18n.t('audit_unsuccess_general_type', {\n          link: (\n            <a\n              rel=\"noreferrer noopener\"\n              href=\"/docs/guides/content_principles\"\n              target=\"_blank\"\n            >\n              {I18n.t('audit_unsuccess_general_type_url')}\n            </a>\n          ),\n        }),\n      });\n    },\n  });\n\n  return (\n    <Modal\n      visible={visible}\n      width={800}\n      title={I18n.t('bgi_title')}\n      centered\n      maskClosable={false}\n      onCancel={onCancel}\n    >\n      <Upload\n        ref={uploaderRef}\n        action=\"\"\n        limit={1}\n        draggable\n        customRequest={customRequest}\n        accept=\".jpeg,.jpg,.png,.webp,.gif\"\n        showReplace={false}\n        showUploadList={false}\n        maxSize={MAX_IMG_SIZE}\n        onSizeError={() => {\n          Toast.error({\n            content: I18n.t('upload_image_size_limit', { max_size: '10M' }),\n            showClose: false,\n          });\n        }}\n      >\n        {isEmpty ? (\n          <DragUploadContent\n            onUpload={() => {\n              uploaderRef?.current?.openFileDialog();\n            }}\n          />\n        ) : (\n          <div\n            className={css.preview}\n            onClick={e => {\n              e.stopPropagation();\n            }}\n            onDragEnter={onDragEnter}\n            onDragOver={onDragOver}\n            onDragLeave={onDragEnd}\n          >\n            <CropperImg\n              cropperRef={cropperWebRef}\n              mode=\"pc\"\n              url={pictureValue.url}\n              backgroundInfo={value?.web_background_image}\n              loading={loading}\n              setLoading={setLoading}\n            />\n            <CropperImg\n              cropperRef={cropperMobileRef}\n              mode=\"mobile\"\n              url={pictureValue.url}\n              backgroundInfo={value?.mobile_background_image}\n              loading={loading}\n              setLoading={setLoading}\n            />\n            {isDragIn ? <FullDragUploadContent /> : null}\n          </div>\n        )}\n      </Upload>\n      {!isEmpty && (\n        <UploadModalFooter\n          onReUpload={() => {\n            uploaderRef?.current?.openFileDialog();\n          }}\n          onCancel={() => setPictureValue({})}\n          onSubmit={handleSubmit}\n        />\n      )}\n    </Modal>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozEdit, IconCozTrashCan } from '@coze-arch/coze-design/icons';\nimport { Typography, CozAvatar, IconButton } from '@coze-arch/coze-design';\nimport { type BackgroundImageInfo } from '@coze-arch/bot-api/workflow_api';\n\nimport { BackgroundModal } from './background-upload';\n\nimport css from './role-background.module.less';\n\ninterface RoleBackgroundProps {\n  value?: BackgroundImageInfo;\n  disabled?: boolean;\n  onChange: (v: BackgroundImageInfo) => void;\n}\n\nexport const RoleBackground: React.FC<RoleBackgroundProps> = ({\n  value,\n  disabled,\n  onChange,\n}) => {\n  const [visible, setVisible] = useState(false);\n  const url = value?.web_background_image?.origin_image_url;\n\n  return (\n    <div>\n      <Typography.Text size=\"small\" type=\"secondary\">\n        {I18n.t('bgi_desc')}\n      </Typography.Text>\n\n      {url ? (\n        <div className={css['bg-block']}>\n          <CozAvatar src={url} type=\"platform\" />\n          <div className={css['op-btns']}>\n            <IconButton\n              icon={<IconCozEdit />}\n              color=\"secondary\"\n              size=\"small\"\n              disabled={disabled}\n              onClick={() => setVisible(true)}\n            />\n            <IconButton\n              icon={<IconCozTrashCan />}\n              color=\"secondary\"\n              size=\"small\"\n              disabled={disabled}\n              onClick={() => onChange({})}\n            />\n          </div>\n          <BackgroundModal\n            visible={visible}\n            value={value}\n            onCancel={() => setVisible(false)}\n            onChange={onChange}\n          />\n        </div>\n      ) : null}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport {\n  useField,\n  observer,\n  type ObjectField,\n} from '@coze-workflow/test-run/formily';\nimport { type BackgroundImageInfo } from '@coze-arch/bot-api/workflow_api';\nimport { IconCozPlus } from '@coze-arch/coze-design/icons';\nimport { IconButton } from '@coze-arch/coze-design';\n\nimport { BackgroundModal } from './background-upload';\n\nexport const AddBackground: React.FC = observer(() => {\n  const [visible, setVisible] = useState(false);\n  const field = useField<ObjectField>();\n  const { value, disabled } = field;\n\n  const handleChange = (v: BackgroundImageInfo) => {\n    field.setValue(v);\n  };\n\n  if (value?.web_background_image?.origin_image_url) {\n    return null;\n  }\n\n  return (\n    <>\n      <IconButton\n        color=\"secondary\"\n        size=\"small\"\n        disabled={disabled}\n        icon={<IconCozPlus />}\n        onClick={() => setVisible(true)}\n      />\n      <BackgroundModal\n        visible={visible}\n        value={value}\n        onCancel={() => setVisible(false)}\n        onChange={handleChange}\n      />\n    </>\n  );\n});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { REPORT_EVENTS as ReportEventNames } from '@coze-arch/report-events';\nimport { I18n } from '@coze-arch/i18n';\nimport { type customRequestArgs } from '@coze-arch/bot-semi/Upload';\nimport { CustomError } from '@coze-arch/bot-error';\nimport {\n  type UploadFileData,\n  type FileBizType,\n} from '@coze-arch/bot-api/developer_api';\nimport { DeveloperApi } from '@coze-arch/bot-api';\n\nimport getBase64 from './get-base64';\n\nfunction customUploadRequest(\n  options: Omit<customRequestArgs, 'onSuccess'> & {\n    fileBizType: FileBizType;\n    onSuccess: (data?: UploadFileData) => void;\n    beforeUploadCustom?: () => void;\n    afterUploadCustom?: () => void;\n  },\n): void {\n  const {\n    onSuccess,\n    onError,\n    file,\n    beforeUploadCustom,\n    afterUploadCustom,\n    fileBizType,\n  } = options;\n\n  if (typeof file === 'string') {\n    return;\n  }\n  beforeUploadCustom?.();\n  const getFileExtension = (name: string) => {\n    const index = name.lastIndexOf('.');\n    return name.slice(index + 1);\n  };\n  try {\n    const { fileInstance } = file;\n\n    // business\n    if (fileInstance) {\n      const extension = getFileExtension(file.name);\n\n      //   business\n      (async () => {\n        try {\n          const base64 = await getBase64(fileInstance);\n          const result = await DeveloperApi.UploadFile({\n            file_head: {\n              file_type: extension,\n              biz_type: fileBizType,\n            },\n            data: base64,\n          });\n          onSuccess?.(result.data);\n          afterUploadCustom?.();\n        } catch (error) {\n          // If parameter validation fails, it will go to catch.\n          afterUploadCustom?.();\n        }\n      })();\n    } else {\n      afterUploadCustom?.();\n      throw new CustomError(ReportEventNames.parmasValidation, I18n.t('error'));\n    }\n  } catch (e) {\n    afterUploadCustom?.();\n    onError?.({\n      status: 0,\n    });\n  }\n}\n\nexport default customUploadRequest;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { REPORT_EVENTS as ReportEventNames } from '@coze-arch/report-events';\nimport { CustomError } from '@coze-arch/bot-error';\n\nfunction getBase64(file: Blob): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const fileReader = new FileReader();\n    fileReader.onload = event => {\n      const result = event.target?.result;\n      if (!result || typeof result !== 'string') {\n        reject(\n          new CustomError(ReportEventNames.parmasValidation, 'file read fail'),\n        );\n        return;\n      }\n      resolve(result.replace(/^.*?,/, ''));\n    };\n    fileReader.readAsDataURL(file);\n  });\n}\n\nexport default getBase64;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useRef, useState } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozEdit } from '@coze-arch/coze-design/icons';\nimport { CozAvatar, Toast, Upload } from '@coze-arch/coze-design';\nimport { type FileItem, type UploadProps } from '@coze-arch/bot-semi/Upload';\nimport { FileBizType } from '@coze-arch/bot-api/developer_api';\n\nimport { EmptyRoleAvatar } from '../../empty-role-avatar';\nimport customUploadRequest from './utils/custom-upload-request';\nimport { AutoGenerate } from './auto-generate';\n\nimport s from './index.module.less';\n\nexport type UploadValue = { uid: string | undefined; url: string }[];\nexport interface GenerateInfo {\n  name: string;\n  desc?: string;\n}\n\ninterface PackageUploadProps {\n  value?: FileItem[];\n  onChange?: (value: UploadValue) => void;\n  disabled?: boolean;\n  generateInfo?: GenerateInfo | (() => GenerateInfo);\n  generateTooltip?: {\n    generateBtnText?: string;\n    contentNotLegalText?: string;\n  };\n  /**\n   * Maximum number of candidates automatically generated\n   * @default 5\n   */\n  maxCandidateCount?: number;\n  beforeUploadCustom?: () => void;\n  afterUploadCustom?: () => void;\n  accept?: string;\n  onGenerateStaticImageClick?: React.MouseEventHandler<HTMLButtonElement>;\n  onGenerateGifClick?: React.MouseEventHandler<HTMLButtonElement>;\n}\n\nexport const RoleAvatarUpload = (props: PackageUploadProps) => {\n  //   business\n  const {\n    onChange,\n    value,\n    disabled = false,\n    generateInfo,\n    generateTooltip,\n    beforeUploadCustom,\n    afterUploadCustom,\n    accept = 'image/*',\n    maxCandidateCount,\n  } = props;\n  const uploadRef = useRef<Upload>(null);\n  const pictureValue = value?.at(0);\n  const [showAiAvatar, setShowAiAvatar] = useState(true);\n\n  const customRequest: UploadProps['customRequest'] = options => {\n    customUploadRequest({\n      ...options,\n      fileBizType: FileBizType.BIZ_BOT_WORKFLOW,\n      onSuccess: data => {\n        setShowAiAvatar(false);\n        options.onSuccess(data);\n        onChange?.([\n          {\n            uid: data?.upload_uri || '',\n            url: data?.upload_url || '',\n          },\n        ]);\n      },\n      beforeUploadCustom,\n      afterUploadCustom,\n    });\n  };\n\n  return (\n    <div className={s['upload-with-auto-generate']}>\n      <Upload\n        action=\"\"\n        className={s.upload}\n        limit={1}\n        customRequest={customRequest}\n        fileList={value}\n        accept={accept}\n        showReplace={false}\n        showUploadList={false}\n        ref={uploadRef}\n        disabled={disabled}\n        // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n        maxSize={2 * 1024}\n        onSizeError={() => {\n          Toast.error({\n            // Starling toggle\n            content: I18n.t(\n              'dataset_upload_image_warning',\n              {},\n              'Please upload an image less than 2MB',\n            ),\n            showClose: false,\n          });\n        }}\n      >\n        <div className={s['avatar-wrap']}>\n          {!pictureValue ? (\n            <EmptyRoleAvatar width={36} type=\"platform\" />\n          ) : (\n            <CozAvatar\n              src={pictureValue?.url}\n              className={s.avatar}\n              type=\"platform\"\n            />\n          )}\n\n          {!disabled && (\n            <div className={s.mask}>\n              <div className=\"relative inline-flex\">\n                <IconCozEdit className=\"text-[24px]\" />\n              </div>\n            </div>\n          )}\n        </div>\n      </Upload>\n\n      {/* will support soon */}\n      {!disabled && !IS_OPEN_SOURCE ? (\n        <AutoGenerate\n          generateInfo={generateInfo}\n          generateTooltip={generateTooltip}\n          showAiAvatar={showAiAvatar}\n          onChange={(autoValue?: UploadValue) => {\n            setShowAiAvatar(true);\n            if (autoValue) {\n              onChange?.(autoValue);\n            }\n          }}\n          maxCandidateCount={maxCandidateCount}\n        />\n      ) : null}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport { type Form } from '@coze-workflow/test-run/formily';\nimport { LazyFormCore } from '@coze-workflow/test-run';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { useRoleService } from '@/hooks';\n\nimport { formValue2Data, data2FormValue } from './utils';\nimport { RoleVoices, AddVoices, TextToVoice } from './role-voices';\nimport { RoleSuggestion, RoleSuggestionSwitch } from './role-suggestion';\nimport {\n  SuggestionList,\n  DisplayAllSwitch,\n  AIGenerateBtn,\n} from './role-onboarding';\nimport { RoleNameInput } from './role-name-input';\nimport { RoleDefaultInput } from './role-input';\nimport { RoleBackground, AddBackground } from './role-background';\nimport { RoleAvatarUpload } from './role-avatar-upload';\n\nconst schema = {\n  type: 'object',\n  properties: {\n    info: {\n      type: 'void',\n      'x-component': 'FormSection',\n      'x-component-props': {\n        title: I18n.t('skill_role_information'),\n        tooltip: I18n.t('workflow_role_config_title_tooltip'),\n        collapsible: true,\n      },\n      properties: {\n        name: {\n          title: I18n.t('scene_edit_roles_create_name'),\n          type: 'string',\n          required: true,\n          'x-component': 'RoleNameInput',\n          'x-decorator': 'FormItem',\n          'x-decorator-props': {\n            tooltip: I18n.t('workflow_role_config_name_tooltip'),\n          },\n          'x-validator': {\n            required: true,\n            message: I18n.t('workflow_testset_required_tip', {\n              param_name: I18n.t('scene_edit_roles_create_name'),\n            }),\n          },\n        },\n        description: {\n          title: I18n.t('role_info.description'),\n          type: 'string',\n          'x-component': 'TextArea',\n          'x-component-props': {\n            placeholder: I18n.t('workflow_role_config_description_placeheader'),\n            size: 'small',\n          },\n          'x-decorator': 'FormItem',\n        },\n        avatar: {\n          title: I18n.t('workflow_role_config_avatar'),\n          type: 'string',\n          'x-component': 'RoleAvatarUpload',\n          'x-reactions': [\n            {\n              dependencies: ['name', 'description'],\n              fulfill: {\n                schema: {\n                  'x-component-props.generateInfo': {\n                    name: '{{$deps[0]}}',\n                    desc: '{{$deps[1]}}',\n                  },\n                },\n              },\n            },\n          ],\n          'x-decorator': 'FormItem',\n        },\n      },\n    },\n    onboarding: {\n      type: 'void',\n      'x-component': 'FormSection',\n      'x-component-props': {\n        title: I18n.t('devops_publish_multibranch_BotInfo.OnboardingInfo'),\n        collapsible: true,\n        // will support soon\n        action: IS_OPEN_SOURCE ? null : <AIGenerateBtn />,\n      },\n      properties: {\n        prologue: {\n          title: I18n.t('bot_edit_opening_text_title'),\n          type: 'string',\n          'x-component': 'FullInput',\n          'x-component-props': {\n            placeholder: I18n.t(\n              'community_Please_enter_please_enter_your_post',\n            ),\n            modalTitle: I18n.t('bot_edit_opening_text_title'),\n          },\n          'x-decorator': 'FormItem',\n        },\n        questions: {\n          title: I18n.t('review_bot_Onboarding_suggested_questions'),\n          type: 'string',\n          'x-component': 'SuggestionList',\n          'x-decorator': 'FormItem',\n          'x-decorator-props': {\n            action: <DisplayAllSwitch />,\n          },\n        },\n      },\n    },\n    suggest: {\n      type: 'object',\n      'x-component': 'RoleSuggestion',\n      'x-component-props': {},\n      'x-decorator': 'FormSection',\n      'x-decorator-props': {\n        title: I18n.t('review_agent_suggestreplyinfo'),\n        collapsible: true,\n        action: <RoleSuggestionSwitch />,\n      },\n    },\n    background: {\n      type: 'object',\n      'x-component': 'RoleBackground',\n      'x-decorator': 'FormSection',\n      'x-decorator-props': {\n        title: I18n.t(\n          'devops_publish_multibranch_BotInfo.BackgroundImageInfoList',\n        ),\n        collapsible: true,\n        action: <AddBackground />,\n      },\n    },\n    voices: {\n      type: 'object',\n      // will support soon\n      'x-visible': !IS_OVERSEA && !IS_OPEN_SOURCE,\n      'x-decorator': 'FormSection',\n      'x-decorator-props': {\n        title: I18n.t('workflow_role_config_voices_title'),\n        collapsible: true,\n        action: <AddVoices />,\n      },\n      properties: {\n        config: {\n          type: 'object',\n          'x-component': 'RoleVoices',\n        },\n        textToVoice: {\n          type: 'boolean',\n          'x-component': 'TextToVoice',\n        },\n      },\n    },\n    input: {\n      type: 'void',\n      // will support soon\n      'x-visible': !IS_OVERSEA && !IS_OPEN_SOURCE,\n      'x-component': 'FormSection',\n      'x-component-props': {\n        title: I18n.t('workflow_role_config_input_title'),\n        collapsible: true,\n      },\n      properties: {\n        default: {\n          type: 'string',\n          'x-component': 'RoleDefaultInput',\n        },\n      },\n    },\n  },\n};\n\nexport const RoleConfigForm: React.FC<{\n  disabled?: boolean;\n}> = ({ disabled }) => {\n  const roleService = useRoleService();\n\n  const initialValues = useMemo(\n    () => data2FormValue(roleService.role || {}),\n    [roleService],\n  );\n\n  const handleFormValuesChange = (form: Form) => {\n    if (disabled) {\n      return;\n    }\n    const v = form.values;\n    roleService.debounceSave(formValue2Data(v));\n  };\n\n  return (\n    <div>\n      <LazyFormCore\n        schema={schema}\n        components={{\n          SuggestionList,\n          RoleSuggestion,\n          RoleVoices,\n          RoleDefaultInput,\n          TextToVoice,\n          RoleBackground,\n          RoleNameInput,\n          RoleAvatarUpload,\n        }}\n        disabled={disabled}\n        initialValues={initialValues}\n        onFormValuesChange={handleFormValuesChange}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useState } from 'react';\n\nimport {\n  workflowApi,\n  type WorkflowMode,\n  type Workflow,\n} from '@coze-workflow/base/api';\n\nexport const useWorkflowTemplateList = ({\n  spaceId,\n  flowMode,\n  isInitWorkflow,\n}: {\n  spaceId: string;\n  flowMode: WorkflowMode;\n  isInitWorkflow?: boolean;\n}): {\n  workflowTemplateList: Workflow[];\n} => {\n  const [workflowTemplateList, setWorkflowList] = useState<Workflow[]>([]);\n\n  const getWorkflowProductList = async () => {\n    const workflowProductList = await workflowApi.GetExampleWorkFlowList({\n      page: 1,\n      size: 20,\n      name: '',\n      flow_mode: flowMode,\n    });\n\n    setWorkflowList(workflowProductList?.data?.workflow_list ?? []);\n  };\n  useEffect(() => {\n    if (!isInitWorkflow) {\n      return;\n    }\n\n    getWorkflowProductList();\n  }, [spaceId, isInitWorkflow]);\n\n  return {\n    workflowTemplateList,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type React from 'react';\nimport { useEffect, useState, startTransition, useRef } from 'react';\n\nimport { type FloatLayoutPanel } from '../../services/workflow-float-layout-service';\n\ninterface FloatPanelProps {\n  panel: FloatLayoutPanel;\n}\n\nexport const FloatPanel: React.FC<FloatPanelProps> = ({ panel }) => {\n  const nodeRef = useRef(panel.render());\n  const [, setVersion] = useState(0);\n\n  useEffect(() => {\n    const dispose = panel.onUpdate(next => {\n      /**\n       * Click on the blank area to close the scene of SideSheet.\n       *\n       * Question:\n       * - Closing SideSheet directly will cause the Blur event of the form in the drawer to not be triggered, and the UI will be destroyed first\n       *\n       * Solution ideas:\n       * - UI updates need to be prioritized lower than form blur related data updates in the drawer\n       *\n       * Specific plan:\n       * - Use start Transition to lower the priority of UI destruction this time, so that Blur-related data updates can be executed before the UI destruction of the drawer\n       */\n      startTransition(() => {\n        nodeRef.current = next;\n        setVersion(v => v + 1);\n      });\n    });\n    return () => dispose.dispose();\n  }, [panel]);\n\n  return <>{nodeRef.current}</>;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Layout floating layer covering the entire canvas, carrying some linked suspension components\n */\nimport React, { useEffect, useLayoutEffect, useRef } from 'react';\n\nimport { useSize } from 'ahooks';\n\nimport { type Render } from '@/services/workflow-float-layout-service';\nimport { useTemplateService } from '@/hooks/use-template-service';\nimport { useFloatLayoutService } from '@/hooks/use-float-layout-service';\nimport { useGlobalState } from '@/hooks';\n\nimport { useWorkflowTemplateList } from '../template-panel/use-workflow-template-list';\nimport { FloatPanel } from './float-panel';\n\nimport styles from './float-layout.module.less';\n\nexport interface FloatLayoutProps {\n  components: Record<string, Render>;\n}\n\nexport const FloatLayout: React.FC<\n  React.PropsWithChildren<FloatLayoutProps>\n> = ({ components, children }) => {\n  const ref = useRef<HTMLDivElement>(null);\n  const { isInitWorkflow, spaceId, flowMode } = useGlobalState();\n\n  const floatLayoutService = useFloatLayoutService();\n  const templateState = useTemplateService();\n\n  const size = useSize(ref);\n\n  useLayoutEffect(() => {\n    // Only trigger once\n    floatLayoutService.register(components);\n  }, []);\n\n  useEffect(() => {\n    if (size) {\n      floatLayoutService.setLayoutSize(size);\n    }\n  }, [size, floatLayoutService]);\n\n  const { workflowTemplateList } = useWorkflowTemplateList({\n    spaceId,\n    flowMode,\n    isInitWorkflow,\n  });\n\n  useEffect(() => {\n    if (isInitWorkflow) {\n      if (!workflowTemplateList?.length) {\n        return;\n      }\n      templateState.setTemplateList(workflowTemplateList);\n      floatLayoutService.open('templatePanel', 'bottom');\n      templateState.openTemplate();\n    } else {\n      templateState.closeTemplate();\n      // Process template closing animation for 200 ms, close bottom panel after animation\n      setTimeout(() => {\n        floatLayoutService.close('bottom');\n      }, 300);\n    }\n  }, [isInitWorkflow, workflowTemplateList, floatLayoutService, templateState]);\n\n  return (\n    <div className={styles['float-layout']} ref={ref}>\n      <div className={styles['left-panel']}>\n        {/* main panel */}\n        <div className={styles['left-main-panel']}>{children}</div>\n        {/* Bottom panel, the priority is higher than the main area, the default height is 0, once there is a height, it will squeeze the main panel */}\n        <div className={styles['left-bottom-panel']}>\n          <FloatPanel panel={floatLayoutService.bottom} />\n        </div>\n      </div>\n      {/* The right area has the highest priority. The default width is 0. Once there is a width, the left side will be squeezed. */}\n      <div className={styles['right-panel']}>\n        <FloatPanel panel={floatLayoutService.right} />\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport cls from 'classnames';\n\nimport { useGlobalState } from '../../hooks';\n\nimport styles from './panel-wrap.module.less';\n\ninterface PanelWrapProps {\n  layout?: 'horizontal' | 'vertical';\n  className?: string;\n  style?: React.CSSProperties;\n}\n\nexport const PanelWrap: React.FC<React.PropsWithChildren<PanelWrapProps>> = ({\n  layout = 'horizontal',\n  children,\n  className,\n  ...props\n}) => {\n  const { isInIDE } = useGlobalState();\n\n  return (\n    <div\n      className={cls(styles['panel-wrap'], className, {\n        [styles.vertical]: layout === 'vertical' && !isInIDE,\n        [styles.horizontal]: layout === 'horizontal' && !isInIDE,\n        [styles.vertical_project]: layout === 'vertical' && isInIDE,\n        [styles.horizontal_project]: layout === 'horizontal' && isInIDE,\n      })}\n      {...props}\n    >\n      {children}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozCross } from '@coze-arch/coze-design/icons';\nimport { Typography, IconButton } from '@coze-arch/coze-design';\n\nimport { useFloatLayoutService, useGlobalState } from '@/hooks';\n\nimport { RoleConfigForm } from '../role-config-form';\nimport { PanelWrap } from '../../float-layout';\n\nimport css from './config-panel.module.less';\n\nconst ConfigPanelHeader = () => {\n  const floatLayoutService = useFloatLayoutService();\n\n  const handleClose = () => {\n    floatLayoutService.close('right');\n  };\n\n  return (\n    <div className={css['panel-header']}>\n      <Typography.Text fontSize=\"16px\" strong>\n        {I18n.t('workflow_role_config_title')}\n      </Typography.Text>\n      <IconButton\n        icon={<IconCozCross />}\n        color=\"secondary\"\n        onClick={handleClose}\n      />\n    </div>\n  );\n};\n\nexport const RoleConfigPanel = () => {\n  const { readonly } = useGlobalState();\n\n  return (\n    <PanelWrap layout=\"vertical\">\n      <div className={css['config-panel']}>\n        <ConfigPanelHeader />\n        <div className={css['panel-content']}>\n          <RoleConfigForm disabled={readonly} />\n        </div>\n      </div>\n    </PanelWrap>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-magic-numbers */\nimport { useMemo, useState, type CSSProperties } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozArrowDown } from '@coze-arch/coze-design/icons';\nimport { Dropdown, Divider } from '@coze-arch/coze-design';\nimport { usePlaygroundTools } from '@flowgram-adapter/free-layout-editor';\nimport { usePlayground } from '@flowgram-adapter/free-layout-editor';\n\nexport const Zoom = () => {\n  const tools = usePlaygroundTools();\n  const playground = usePlayground();\n  const [selected, setSelected] = useState(false);\n  const zoom = useMemo(() => {\n    const zoomValue = tools.zoom * 100;\n    return zoomValue.toFixed(0);\n  }, [tools.zoom]);\n  // In order to override the style of the cozed design, you cannot use tailwind css.\n  const zoomOptionStyle: CSSProperties = {\n    padding: '8px',\n    lineHeight: '16px',\n  };\n  return (\n    <Dropdown\n      clickToHide\n      position=\"top\"\n      trigger=\"custom\"\n      visible={selected}\n      onClickOutSide={() => setSelected(false)}\n      onVisibleChange={setSelected}\n      render={\n        <Dropdown.Menu>\n          <Dropdown.Item\n            data-testid=\"workflow.detail.toolbar.zoom.out\"\n            style={zoomOptionStyle}\n            onClick={() => tools.zoomout()}\n          >\n            {I18n.t('workflow_toolbar_zoom_out')}\n          </Dropdown.Item>\n          <Dropdown.Item\n            data-testid=\"workflow.detail.toolbar.zoom.in\"\n            style={zoomOptionStyle}\n            onClick={() => tools.zoomin()}\n          >\n            {I18n.t('workflow_toolbar_zoom_in')}\n          </Dropdown.Item>\n          <Dropdown.Item\n            data-testid=\"workflow.detail.toolbar.zoom.fit\"\n            style={zoomOptionStyle}\n            onClick={() => tools.fitView()}\n          >\n            {I18n.t('workflow_toolbar_zoom_fit')}\n          </Dropdown.Item>\n          <Divider className=\"m-[4px] w-[108px]\" />\n          <Dropdown.Item\n            data-testid=\"workflow.detail.toolbar.zoom.50\"\n            style={zoomOptionStyle}\n            onClick={() => {\n              playground.config.updateZoom(0.5);\n            }}\n          >\n            {I18n.t('workflow_toolbar_zoom_to')} 50%\n          </Dropdown.Item>\n          <Dropdown.Item\n            data-testid=\"workflow.detail.toolbar.zoom.100\"\n            style={zoomOptionStyle}\n            onClick={() => {\n              playground.config.updateZoom(1);\n            }}\n          >\n            {I18n.t('workflow_toolbar_zoom_to')} 100%\n          </Dropdown.Item>\n          <Dropdown.Item\n            data-testid=\"workflow.detail.toolbar.zoom.150\"\n            style={zoomOptionStyle}\n            onClick={() => {\n              playground.config.updateZoom(1.5);\n            }}\n          >\n            {I18n.t('workflow_toolbar_zoom_to')} 150%\n          </Dropdown.Item>\n          <Dropdown.Item\n            data-testid=\"workflow.detail.toolbar.zoom.200\"\n            style={zoomOptionStyle}\n            onClick={() => {\n              playground.config.updateZoom(2);\n            }}\n          >\n            {I18n.t('workflow_toolbar_zoom_to')} 200%\n          </Dropdown.Item>\n        </Dropdown.Menu>\n      }\n    >\n      <div\n        className=\"workflow-toolbar-zoom flex justify-start items-center w-[70px] h-[24px] p-[2px] rounded-small border border-solid border-[var(--coz-stroke-plus)] cursor-pointer select-none\"\n        data-testid=\"workflow.detail.toolbar.zoom\"\n        onClick={() => setSelected(!selected)}\n        style={{\n          borderColor: selected\n            ? 'var(--coz-stroke-hglt)'\n            : 'var(--coz-stroke-plus)',\n        }}\n      >\n        <p className=\"text-[12px] flex items-center mx-[4px] w-[40px] h-[20px]\">\n          {zoom}%\n        </p>\n        <div\n          className=\"flex items-center justify-center pr-[2px] color-[var(--coz-fg-secondary)]\"\n          style={{\n            color: 'var(--coz-fg-secondary)',\n          }}\n        >\n          <IconCozArrowDown />\n        </div>\n      </div>\n    </Dropdown>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozRectangleMap } from '@coze-arch/coze-design/icons';\nimport { Tooltip, IconButton } from '@coze-arch/coze-design';\n\nimport type { ITool } from '../type';\n\nexport const MinimapSwitch = (props: ITool) => {\n  const { handlers } = props;\n  const { minimapVisible, setMinimapVisible } = handlers;\n\n  return (\n    <Tooltip content={I18n.t('workflow_toolbar_minimap_tooltips')}>\n      <IconButton\n        icon={\n          <IconCozRectangleMap\n            className={minimapVisible ? undefined : 'coz-fg-primary'}\n          />\n        }\n        color={minimapVisible ? 'highlight' : 'secondary'}\n        data-testid=\"workflow.detail.toolbar.minimap-switch\"\n        onClick={() => setMinimapVisible(!minimapVisible)}\n      />\n    </Tooltip>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useState } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Tooltip } from '@coze-arch/coze-design';\nimport { usePlaygroundTools } from '@flowgram-adapter/free-layout-editor';\nimport { type InteractiveType as IdeInteractiveType } from '@flowgram-adapter/free-layout-editor';\nimport {\n  GuidingPopover,\n  InteractiveType,\n  MousePadSelector,\n  getPreferInteractiveType,\n  setPreferInteractiveType,\n} from '@coze-common/mouse-pad-selector';\n\nexport const Interactive = () => {\n  const tools = usePlaygroundTools();\n\n  const [interactiveType, setInteractiveType] = useState<InteractiveType>(\n    () => getPreferInteractiveType() as InteractiveType,\n  );\n\n  const [showInteractivePanel, setShowInteractivePanel] = useState(false);\n\n  const mousePadTooltip = I18n.t(\n    interactiveType === InteractiveType.Mouse\n      ? 'workflow_mouse_friendly'\n      : 'workflow_pad_friendly',\n  );\n\n  useEffect(() => {\n    tools.setMouseScrollDelta(zoom => zoom / 20);\n\n    // Read interactive mode from cache, application takes effect\n    const preferInteractiveType = getPreferInteractiveType();\n    tools.setInteractiveType(preferInteractiveType as IdeInteractiveType);\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- init\n  }, []);\n\n  return (\n    <GuidingPopover>\n      <Tooltip\n        content={mousePadTooltip}\n        style={{ display: showInteractivePanel ? 'none' : 'block' }}\n      >\n        <div\n          className=\"workflow-toolbar-interactive\"\n          data-testid=\"workflow.detail.toolbar.interactive\"\n        >\n          <MousePadSelector\n            value={interactiveType}\n            onChange={value => {\n              setInteractiveType(value);\n              setPreferInteractiveType(value);\n              tools.setInteractiveType(value as unknown as IdeInteractiveType);\n            }}\n            onPopupVisibleChange={setShowInteractivePanel}\n            containerStyle={{\n              border: 'none',\n              height: '24px',\n              width: '38px',\n              justifyContent: 'center',\n              alignItems: 'center',\n              gap: '2px',\n              padding: '4px',\n              paddingTop: '1px',\n              borderRadius: 'var(--small, 6px)',\n            }}\n            iconStyle={{\n              margin: '0',\n              width: '16px',\n              height: '16px',\n            }}\n            arrowStyle={{\n              width: '12px',\n              height: '12px',\n            }}\n          />\n        </div>\n      </Tooltip>\n    </GuidingPopover>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useState } from 'react';\n\nimport { StandardNodeType } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozComment } from '@coze-arch/coze-design/icons';\nimport { Tooltip, IconButton } from '@coze-arch/coze-design';\nimport { FlowNodeTransformData } from '@flowgram-adapter/free-layout-editor';\nimport {\n  WorkflowDocument,\n  type WorkflowNodeEntity,\n  type WorkflowNodeMeta,\n  WorkflowSelectService,\n  usePlayground,\n  useService,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { WorkflowCustomDragService } from '@/services';\n\nexport const Comment = () => {\n  const playground = usePlayground();\n  const document = useService(WorkflowDocument);\n  const selectService = useService(WorkflowSelectService);\n  const dragService = useService(WorkflowCustomDragService);\n\n  const [tooltipVisible, setTooltipVisible] = useState(false);\n\n  const calcNodePosition = useCallback(\n    (\n      mouseEvent: React.MouseEvent<HTMLButtonElement>,\n      containerNode?: WorkflowNodeEntity,\n    ) => {\n      const mousePosition = playground.config.getPosFromMouseEvent(mouseEvent);\n      if (!containerNode) {\n        return {\n          x: mousePosition.x,\n          y: mousePosition.y - 75,\n        };\n      }\n      const containerTransform = containerNode.getData(FlowNodeTransformData);\n      const childrenLength = containerNode.collapsedChildren.length;\n      return {\n        x:\n          containerTransform.padding.left -\n          containerTransform.padding.left +\n          childrenLength * 30,\n        y: containerTransform.padding.top + childrenLength * 30,\n      };\n    },\n    [playground],\n  );\n\n  const createComment = useCallback(\n    async (mouseEvent: React.MouseEvent<HTMLButtonElement>) => {\n      setTooltipVisible(false);\n      let containerNode: WorkflowNodeEntity | undefined;\n      if (\n        selectService.activatedNode?.getNodeMeta<WorkflowNodeMeta>().isContainer\n      ) {\n        containerNode = selectService.activatedNode;\n      }\n      const canvasPosition = calcNodePosition(mouseEvent, containerNode);\n      // Create Node\n      const node = await document.createWorkflowNodeByType(\n        StandardNodeType.Comment,\n        canvasPosition,\n        {},\n        containerNode?.id,\n      );\n      // Wait for node to render\n      setTimeout(() => {\n        if (containerNode) {\n          return;\n        }\n        // selected node\n        selectService.selectNode(node);\n        // Start dragging\n        dragService.startDragSelectedNodes(mouseEvent);\n        // eslint-disable-next-line @typescript-eslint/no-magic-numbers -- waiting for node render\n      }, 50);\n    },\n    [selectService, calcNodePosition, document, dragService],\n  );\n\n  if (playground.config.readonly) {\n    return <></>;\n  }\n\n  return (\n    <Tooltip\n      trigger=\"custom\"\n      visible={tooltipVisible}\n      onVisibleChange={setTooltipVisible}\n      content={I18n.t('workflow_toolbar_comment_tooltips')}\n    >\n      <IconButton\n        icon={<IconCozComment className=\"coz-fg-primary\" />}\n        color=\"secondary\"\n        data-testid=\"workflow.detail.controls.comment\"\n        onClick={createComment}\n        onMouseEnter={() => setTooltipVisible(true)}\n        onMouseLeave={() => setTooltipVisible(false)}\n      />\n    </Tooltip>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback } from 'react';\n\nimport { reporter } from '@coze-arch/logger';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozAutoLayout } from '@coze-arch/coze-design/icons';\nimport { IconButton, Tooltip } from '@coze-arch/coze-design';\nimport { useEntity, usePlayground } from '@flowgram-adapter/free-layout-editor';\n\nimport { useAutoLayout } from '../hooks';\nimport { WorkflowGlobalStateEntity } from '../../../entities';\n\nexport const AutoLayout = () => {\n  const runAutoLayout = useAutoLayout();\n  const playground = usePlayground();\n  const workflowState = useEntity<WorkflowGlobalStateEntity>(\n    WorkflowGlobalStateEntity,\n  );\n  const { workflowId } = workflowState;\n  const autoLayout = useCallback(async () => {\n    await runAutoLayout();\n    reporter.event({\n      eventName: 'workflow_control_auto_layout',\n      namespace: 'workflow',\n      scope: 'control', // Secondary namespace to refine specific scenarios\n      meta: {\n        workflowId,\n      }, // For other custom information, try to avoid reporting irrelevant or redundant information\n    });\n  }, [runAutoLayout, workflowId]);\n\n  if (playground.config.readonly) {\n    return <></>;\n  }\n\n  return (\n    <Tooltip content={I18n.t('workflow_detail_layout_optimization_tooltip')}>\n      <IconButton\n        onClick={autoLayout}\n        icon={<IconCozAutoLayout className=\"coz-fg-primary\" />}\n        color=\"secondary\"\n        data-testid=\"workflow.detail.toolbar.auto-layout\"\n      />\n    </Tooltip>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useRef, type RefObject } from 'react';\n\nimport { debounce } from 'lodash-es';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozPlus } from '@coze-arch/coze-design/icons';\nimport { Button } from '@coze-arch/coze-design';\n\nimport type { ITool } from '../type';\nimport { ADD_NODE_BUTTON_ID } from '../constants';\nexport const AddNode = (\n  props: ITool & { toolbarRef?: RefObject<HTMLDivElement | undefined> },\n) => {\n  const { handlers, toolbarRef } = props;\n  const { addNode } = handlers;\n\n  const addNodePanelVisibleRef = useRef(false);\n\n  const handleAddNode = (rect: DOMRect) => {\n    if (addNodePanelVisibleRef.current) {\n      return;\n    }\n    addNodePanelVisibleRef.current = true;\n    const toolbarRect = toolbarRef?.current?.getBoundingClientRect();\n    toolbarRect ? (rect = toolbarRect) : null;\n\n    return addNode(rect).finally(\n      () => (addNodePanelVisibleRef.current = false),\n    );\n  };\n  const debounceAddNode = debounce(handleAddNode, 100);\n  return (\n    <Button\n      icon={<IconCozPlus />}\n      color=\"highlight\"\n      id={ADD_NODE_BUTTON_ID}\n      onClick={event => {\n        debounceAddNode.cancel();\n        handleAddNode(event.currentTarget.getBoundingClientRect());\n      }}\n      onMouseEnter={event => {\n        const rect = event.currentTarget.getBoundingClientRect();\n        debounceAddNode(rect);\n      }}\n      onMouseLeave={() => {\n        debounceAddNode.cancel();\n      }}\n      data-testid=\"workflow.detail.toolbar.add-node\"\n    >\n      {I18n.t('workflow_toolbar_add_node')}\n    </Button>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useRef, type RefObject } from 'react';\n\nimport cls from 'classnames';\nimport { usePlayground } from '@flowgram-adapter/free-layout-editor';\nimport { Divider } from '@coze-arch/coze-design';\n\nimport { useTemplateService } from '@/hooks/use-template-service';\n\nimport type { ITool } from '../type';\nimport { StartTestRunButton } from '../../test-run/test-run-button/start-test-run-button';\nimport { OpenTraceButton } from '../../test-run/test-run-button/open-trace-button';\nimport { RoleButton } from '../../flow-role';\nimport { useGlobalState } from '../../../hooks';\nimport { Zoom } from './zoom';\nimport { MinimapSwitch } from './minimap-switch';\nimport { Interactive } from './interactive';\nimport { Comment } from './comment';\nimport { AutoLayout } from './auto-layout';\nimport { AddNode } from './add-node';\n\nimport css from './tools.module.less';\n\nexport const Tools = (props: ITool) => {\n  const templateState = useTemplateService();\n\n  const playground = usePlayground();\n  const { isChatflow } = useGlobalState();\n  const enableAddNode = !playground.config.readonly;\n  const toolbarRef = useRef<HTMLDivElement>();\n  return (\n    <div\n      className={cls(\n        css['tools-wrap'],\n        templateState.templateVisible ? 'bottom-[2px]' : 'bottom-[16px]',\n      )}\n      ref={toolbarRef as RefObject<HTMLDivElement>}\n    >\n      <div className={css['tools-section']}>\n        <Interactive />\n        <Zoom />\n        <Comment />\n        <AutoLayout />\n        <MinimapSwitch {...props} />\n        {enableAddNode ? (\n          <>\n            <Divider layout=\"vertical\" style={{ height: '16px' }} margin={3} />\n            <AddNode {...props} toolbarRef={toolbarRef} />\n          </>\n        ) : null}\n      </div>\n      <div className={cls(css['tools-section'], css['test-run'])}>\n        {isChatflow ? <RoleButton /> : null}\n        {/* The operation and maintenance platform does not need debugging and practice running, just need to view the information to troubleshoot problems */}\n        {IS_BOT_OP ? (\n          <OpenTraceButton />\n        ) : (\n          <>\n            {isChatflow ? (\n              <Divider\n                layout=\"vertical\"\n                style={{ height: '16px' }}\n                margin={3}\n              />\n            ) : null}\n            {/* will support soon */}\n            {!IS_OPEN_SOURCE && <OpenTraceButton />}\n            <StartTestRunButton />\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FlowMinimapService,\n  MinimapRender,\n} from '@flowgram-adapter/free-layout-editor';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\n\nimport type { ToolbarHandlers } from '../type';\n\ninterface IMinimap {\n  handlers: ToolbarHandlers;\n}\n\nexport const Minimap = (props: IMinimap) => {\n  const { handlers } = props;\n  const { minimapVisible } = handlers;\n  const minimapService = useService(FlowMinimapService);\n  if (!minimapVisible) {\n    return <></>;\n  }\n  return (\n    <div\n      className=\"workflow-toolbar-minimap flex mb-2\"\n      data-testid=\"workflow.detail.toolbar.minimap\"\n    >\n      <MinimapRender\n        service={minimapService}\n        panelStyles={{}}\n        containerStyles={{\n          pointerEvents: 'auto',\n          position: 'relative',\n          top: 'unset',\n          right: 'unset',\n          bottom: 'unset',\n          left: 'unset',\n        }}\n        inactiveStyle={{\n          opacity: 1,\n          scale: 1,\n          translateX: 0,\n          translateY: 0,\n        }}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useToolbarHandlers } from '../hooks';\nimport { Tools } from './tools';\nimport { Minimap } from './minimap';\n\nimport css from './tools.module.less';\n\nexport const ToolbarContainer = ({\n  disableTraceAndTestRun,\n}: {\n  disableTraceAndTestRun?: boolean;\n}) => {\n  const handlers = useToolbarHandlers();\n\n  if (disableTraceAndTestRun) {\n    return <></>;\n  }\n\n  return (\n    <div className={css.tools}>\n      <div>\n        <Minimap handlers={handlers} />\n        <Tools handlers={handlers} />\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable max-lines-per-function */\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport { useEffect, useMemo } from 'react';\n\nimport { useUpdateEffect } from 'ahooks';\nimport {\n  WorkflowExeStatus,\n  WorkflowExeHistoryStatus,\n  type GetWorkFlowProcessData,\n} from '@coze-workflow/base/api';\nimport { WorkflowExecStatus } from '@coze-workflow/base';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\n\nimport { useSingletonInnerSideSheet } from '../../../../workflow-inner-side-sheet';\nimport { WorkflowRunService } from '../../../../../services';\nimport {\n  useExecStateEntity,\n  useLineService,\n  useGlobalState,\n} from '../../../../../hooks';\nimport { useHasError } from './use-has-error';\n\nexport const useResultSideSheetVisible = () => {\n  const runService = useService<WorkflowRunService>(WorkflowRunService);\n  const execEntity = useExecStateEntity();\n  const lineService = useLineService();\n  const { resultSideSheetVisible, resultSideSheetLoading, hasNodeResult } =\n    execEntity;\n\n  const { viewStatus, playgroundProps, canTestRunHistory } = useGlobalState();\n\n  const { visible, handleOpen, handleClose } =\n    useSingletonInnerSideSheet('execute-result');\n  const resultVisible = useMemo(\n    () => hasNodeResult || visible,\n    [hasNodeResult, visible],\n  );\n\n  useEffect(() => {\n    playgroundProps.onTestRunResultVisibleChange?.(resultVisible);\n  }, [resultVisible, playgroundProps.onTestRunResultVisibleChange]);\n\n  const { exeHistoryStatus } = execEntity.config;\n\n  const hasError = useHasError();\n\n  const getProcess = (showResult?: boolean) =>\n    runService.getProcessResult({ showNodeResults: showResult });\n\n  const openSideSheet = async () => {\n    const opened = await handleOpen();\n    if (!opened) {\n      return false;\n    }\n    execEntity.openSideSheet();\n    return true;\n  };\n\n  const openSideSheetAndShowResult = async () => {\n    const opened = await openSideSheet();\n    if (!opened) {\n      return;\n    }\n\n    // 1. If there is already an error, display the error. 2. There are already results and do not pull. 3. The result cannot be obtained during operation.\n    if (\n      !hasError &&\n      !hasNodeResult &&\n      viewStatus !== WorkflowExecStatus.EXECUTING &&\n      canTestRunHistory\n    ) {\n      execEntity.updateConfig({\n        resultSideSheetLoading: true,\n      });\n      await runService.getProcessResult({ showNodeResults: true });\n      execEntity.updateConfig({\n        resultSideSheetLoading: false,\n      });\n    }\n\n    lineService.validateAllLine();\n  };\n\n  const closeSideSheet = () => {\n    handleClose();\n    execEntity.closeSideSheet();\n  };\n\n  const closeSideSheetAndHideResult = () => {\n    closeSideSheet();\n    runService.clearTestRun();\n    lineService.validateAllLine();\n  };\n\n  const showResult = async (config?: {\n    executeId?: string;\n    processResp?: GetWorkFlowProcessData;\n    subExecuteId?: string;\n  }) => {\n    const { executeId, processResp, subExecuteId } = config ?? {};\n\n    // There is already an error reported, no need to query the result, just open the pop-up window.\n    if (hasError && !executeId && !processResp) {\n      openSideSheet();\n      return;\n    }\n    // Query results, if there is an error, open the pop-up window\n    const { executeStatus } = await runService.getProcessResult({\n      executeId,\n      processResp,\n      showNodeResults: true,\n      subExecuteId,\n    });\n    if (executeStatus === WorkflowExeStatus.Fail) {\n      openSideSheet();\n    }\n  };\n\n  const hasLastResult =\n    exeHistoryStatus === WorkflowExeHistoryStatus.HasHistory;\n\n  // Keep resultSideSheetVisible and singleton popups visible\n  useUpdateEffect(() => {\n    if (resultSideSheetVisible) {\n      handleOpen().then(opened => {\n        if (!opened) {\n          execEntity.openSideSheet();\n        }\n      });\n    } else {\n      handleClose().then(closed => {\n        if (!closed) {\n          execEntity.closeSideSheet();\n        }\n      });\n    }\n    lineService.validateAllLine();\n  }, [resultSideSheetVisible]);\n\n  return {\n    openSideSheet,\n    openSideSheetAndShowResult,\n    closeSideSheet,\n    closeSideSheetAndHideResult,\n\n    getProcess,\n    hasLastResult,\n\n    resultSideSheetVisible: visible,\n    loading: resultSideSheetLoading,\n    showResult,\n    resultVisible,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport classNames from 'classnames';\nimport {\n  IconCozArrowLeft,\n  IconCozArrowRight,\n} from '@coze-arch/coze-design/icons';\nimport { IconButton } from '@coze-arch/coze-design';\n\nimport { TemplateCompZIndex } from './constants';\n\nimport styles from './index.module.less';\n\nexport const TemplateSlideButton = ({\n  onTemplateScorll,\n  templateVisible,\n  slidable,\n  direction,\n}) => {\n  const IconComp = direction === 'right' ? IconCozArrowRight : IconCozArrowLeft;\n\n  if (!slidable) {\n    return null;\n  }\n\n  return (\n    <div\n      className={classNames(\n        'absolute',\n        direction === 'right' ? 'right-[8px]' : 'left-[8px]',\n        styles['slide-button'],\n        {\n          [styles['slide-button-visible']]: templateVisible,\n        },\n      )}\n      style={{\n        zIndex: TemplateCompZIndex.TemplateSildeButton,\n      }}\n    >\n      <IconButton\n        icon={<IconComp className=\"text-xxl coz-fg-hglt-white\" />}\n        style={{\n          maxWidth: '24px',\n          minWidth: '24px',\n          height: '24px',\n          cursor: slidable ? 'pointer' : 'not-allowed',\n          background: 'white',\n          boxShadow:\n            '0px 4px 24px 0px rgba(0, 0, 0, 0.25), 0px 12px 48px 0px rgba(0, 0, 0, 0.20)',\n        }}\n        onClick={() => onTemplateScorll(direction)}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect } from 'react';\n\nimport { useWorkflowPlayground } from '@/use-workflow-playground';\n\nexport const TemplatePreviewInner = ({ spaceId, workflowId }) => {\n  const { workflowComp, init: initWorkflow } = useWorkflowPlayground({\n    from: 'workflowTemplate',\n  });\n\n  useEffect(() => {\n    initWorkflow({\n      spaceId,\n      workflowId,\n      showExecuteResult: false,\n      enableInitTestRunInput: false,\n      disabledSingleNodeTest: true,\n      disableTraceAndTestRun: true,\n      disableGetTestCase: true,\n    });\n  }, [workflowId, spaceId]);\n\n  return <>{workflowComp}</>;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { isEmpty } from 'lodash-es';\n\nimport { useTemplateService } from '@/hooks/use-template-service';\n\nimport { TemplatePreviewInner } from './template-preview-inner';\nimport { TemplateCompZIndex } from './constants';\n\nexport const TemplatePreview = () => {\n  const templateService = useTemplateService();\n  const previewInfo = templateService.templatePreviewInfo;\n\n  return !isEmpty(previewInfo) ? (\n    <div\n      className=\"absolute w-full px-[8px] pt-[8px] pointer-events-auto\"\n      style={{\n        height: 'calc(100% - 10px)',\n        zIndex: TemplateCompZIndex.TemplatePreview,\n      }}\n    >\n      <div\n        className=\"w-full h-full p-[12px] bg-[#F9F9F9] rounded-lg\"\n        style={{\n          border:\n            '0.548px solid var(--Stroke-COZ-stroke-primary, rgba(6, 7, 9, 0.10))',\n        }}\n      >\n        <div className=\"relative w-full h-full flex justify-center items-center\">\n          {/* workflow_id changes, the canvas area re-renders */}\n          <TemplatePreviewInner\n            key={previewInfo?.workflow_id}\n            spaceId={previewInfo?.space_id}\n            workflowId={previewInfo?.workflow_id}\n          />\n        </div>\n      </div>\n    </div>\n  ) : (\n    <></>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useRef, useState } from 'react';\n\nimport classNames from 'classnames';\nimport { PUBLIC_SPACE_ID, workflowApi } from '@coze-workflow/base';\nimport { type Workflow } from '@coze-arch/idl/workflow_api';\nimport { I18n } from '@coze-arch/i18n';\nimport { Toast } from '@coze-arch/coze-design';\nimport { Image } from '@coze-arch/bot-semi';\nimport {\n  type WorkflowJSON,\n  useService,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { WorkflowRunService, WorkflowSaveService } from '@/services';\nimport { useTemplateService } from '@/hooks/use-template-service';\nimport { useFloatLayoutService } from '@/hooks/use-float-layout-service';\n\nimport { Text } from '../../form-extensions/components/text';\n\nimport styles from './index.module.less';\n\nexport const TemplateCard = ({\n  workflowTemplate,\n  cardIndex,\n  onBlur,\n  onFocus,\n  isDragActive,\n  isMove,\n}: {\n  workflowTemplate: Workflow;\n  cardIndex: number;\n  onBlur: () => void;\n  onFocus: (data: Workflow) => void;\n  isDragActive?: boolean;\n  isMove?: boolean;\n}) => {\n  const cardRef = useRef(null);\n  const [show, setShow] = useState(false);\n\n  const templateState = useTemplateService();\n  const floatLayoutService = useFloatLayoutService();\n\n  const saveService = useService<WorkflowSaveService>(WorkflowSaveService);\n  const runService = useService<WorkflowRunService>(WorkflowRunService);\n\n  useEffect(() => {\n    setTimeout(() => {\n      setShow(true);\n    }, cardIndex * 100);\n  }, [cardIndex, setShow]);\n\n  const handleClick = async () => {\n    if (isDragActive || isMove) {\n      return;\n    }\n    try {\n      let schemaJson = workflowTemplate?.schema_json;\n      if (!schemaJson) {\n        // Ask for schema_json\n        const res = await workflowApi.GetCanvasInfo({\n          space_id: workflowTemplate.space_id ?? PUBLIC_SPACE_ID,\n          workflow_id: workflowTemplate.workflow_id,\n        });\n        schemaJson = res?.data?.workflow?.schema_json;\n      }\n\n      await saveService.reloadDocument({\n        customWorkflowJson: JSON.parse(schemaJson ?? '{}') as WorkflowJSON,\n      });\n      saveService.highPrioritySave();\n      Toast.success(I18n.t('workflow_example_succeed'));\n      // The result of closing a practice run first\n      runService.clearTestRun();\n      templateState.closeTemplate();\n      // Process template closing animation for 200 ms, close bottom panel after animation\n      setTimeout(() => {\n        floatLayoutService.close('bottom');\n      }, 300);\n    } catch (e) {\n      Toast.error(I18n.t('copy_failed'));\n    } finally {\n      templateState.closePreview();\n    }\n  };\n\n  return (\n    <div\n      ref={cardRef}\n      className={classNames(\n        'flex flex-col gap-[4px] min-w-[240px] max-w-[240px] max-h-[108px] bg-white p-[8px]',\n        styles['template-card'],\n        'select-none',\n        isDragActive ? 'cursor-grabbing' : 'cursor-pointer',\n        { [styles['slide-up']]: show },\n      )}\n      onMouseEnter={() => onFocus(workflowTemplate)}\n      onMouseLeave={onBlur}\n      tabIndex={cardIndex}\n      onClick={handleClick}\n    >\n      <div className=\"flex gap-[4px] h-[24px]\">\n        <div>\n          <Image\n            height={'24px'}\n            width={'24px'}\n            preview={false}\n            src={workflowTemplate?.url ?? ''}\n            className={styles['card-header']}\n          />\n        </div>\n        <Text\n          className=\"text-[16px] font-medium leading-[22px]\"\n          text={workflowTemplate?.name ?? ''}\n        />\n      </div>\n      <Text\n        className=\"text-[#0607094D] text-[12px] leading-[16px] font-normal\"\n        text={workflowTemplate?.desc ?? ''}\n        rows={3}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useState, type ForwardedRef } from 'react';\n\nimport classNames from 'classnames';\nimport { type Workflow } from '@coze-arch/idl/workflow_api';\nimport {\n  InteractiveType,\n  getPreferInteractiveType,\n} from '@coze-common/mouse-pad-selector';\n\nimport { useTemplateService } from '@/hooks/use-template-service';\n\nimport { TemplateCard } from './template-card';\n\nimport styles from './index.module.less';\n\ninterface TemplateCardListProps {\n  workflowTemplateList: Workflow[];\n  isCardsOver: boolean;\n}\n\nexport const TemplateCardList = React.forwardRef(\n  (props: TemplateCardListProps, ref: ForwardedRef<HTMLDivElement>) => {\n    const { workflowTemplateList, isCardsOver } = props;\n    const [isDragActive, setDragActive] = useState(false);\n    const [startX, setStartX] = useState(0);\n    const [isMove, setMove] = useState(false);\n\n    const templateState = useTemplateService();\n\n    const isMouseMode = getPreferInteractiveType() === InteractiveType.Mouse;\n\n    const handleMouseDown = event => {\n      const curRef = (ref as React.RefObject<HTMLDivElement>)?.current;\n      if (!curRef || !isMouseMode) {\n        return;\n      }\n      setDragActive(true);\n      setStartX(event.clientX);\n    };\n\n    const handleMouseUp = event => {\n      if (!isMouseMode) {\n        return;\n      }\n      if (isDragActive) {\n        event.preventDefault();\n      }\n      setStartX(0);\n      setDragActive(false);\n    };\n\n    const handleMouseMove = event => {\n      event.preventDefault();\n      const curRef = (ref as React.RefObject<HTMLDivElement>)?.current;\n      const walk = (event.clientX - startX) * 0.1; // Control rolling speed\n\n      // mouseDown, the mouse movement starts to drag\n      setMove(isDragActive && !!walk);\n\n      if (!isDragActive || !curRef || !isMouseMode) {\n        return;\n      }\n      curRef.scrollLeft = curRef?.scrollLeft - walk;\n    };\n\n    const handleCardBlur = () => {\n      templateState.closePreview();\n    };\n    const handleCardFouce = templateInfo => {\n      // If you are dragging, show a preview example\n      if (isDragActive) {\n        return;\n      }\n      templateState.openPreview(templateInfo);\n    };\n\n    return (\n      <>\n        <div className=\"w-[16px]\" />\n        <div\n          ref={ref as { current: HTMLDivElement | null }}\n          className={classNames(\n            'flex flex-1  gap-[13px] overflow-x-scroll overflow-y-hidden',\n            // Card height 116 + 8px to avoid shadows being cut\n            'w-0 h-[124px] pt-[8px]',\n            styles['list-container'],\n            isCardsOver ? 'justify-start' : 'justify-center',\n            {\n              'cursor-grabbing': isMouseMode && isDragActive,\n            },\n          )}\n          onMouseDown={handleMouseDown}\n          onMouseUp={handleMouseUp}\n          onMouseLeave={handleMouseUp}\n          onMouseMove={handleMouseMove}\n        >\n          {workflowTemplateList?.map((templateInfo, index) => (\n            <TemplateCard\n              key={templateInfo.workflow_id}\n              workflowTemplate={templateInfo}\n              cardIndex={index}\n              onBlur={handleCardBlur}\n              onFocus={handleCardFouce}\n              isDragActive={isDragActive}\n              isMove={isMove}\n            />\n          ))}\n        </div>\n        <div className=\"w-[16px]\" />\n      </>\n    );\n  },\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\n\nimport classNames from 'classnames';\nimport {\n  DataSourceType,\n  WorkflowModalContext,\n  type WorkflowModalContextValue,\n} from '@coze-workflow/components';\nimport { WorkflowMode } from '@coze-arch/idl/developer_api';\n\nimport { useTemplateService } from '@/hooks/use-template-service';\nimport { useGlobalState } from '@/hooks';\n\nimport { PanelWrap } from '../float-layout';\nimport { TemplateSlideButton } from './template-slide-button';\nimport { TemplateCardList } from './template-card-list';\n\nimport styles from './index.module.less';\n\nexport const TemplatePanel = () => {\n  const { spaceId, readonly } = useGlobalState();\n\n  const templateState = useTemplateService();\n\n  const [isLeftSlidable, setLeftSlidable] = useState(true);\n  const [isRightSlidable, setRightSlidable] = useState(true);\n  const scrollRef = useRef<HTMLDivElement | null>(null);\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const isCardsOver =\n    (scrollRef?.current?.scrollWidth as number) >\n    (containerRef?.current?.scrollWidth as number);\n\n  const scrollAction = useRef<string>('');\n\n  const handleClickSlide = useCallback(\n    (direction: 'left' | 'right') => {\n      const scrollContainer = scrollRef.current;\n      if (!scrollContainer) {\n        return;\n      }\n      const scrollAmount = 400;\n      const currentScrollLeft = scrollContainer?.scrollLeft ?? 0;\n\n      let newScrollLeft = 0;\n      if (direction === 'left') {\n        newScrollLeft = Math.max(currentScrollLeft - scrollAmount, 0);\n        // Set the left swipe button disabled state\n      } else if (direction === 'right') {\n        newScrollLeft = Math.min(\n          currentScrollLeft + scrollAmount,\n          scrollContainer.scrollWidth - scrollContainer.clientWidth,\n        );\n      }\n\n      scrollAction.current = 'click';\n\n      scrollContainer.scrollTo({\n        left: newScrollLeft,\n        behavior: 'smooth',\n      });\n    },\n    [setLeftSlidable, setRightSlidable],\n  );\n\n  // Check if it can be scrolled.\n  const checkScrollability = () => {\n    const scrollElement = scrollRef.current;\n    if (!scrollElement) {\n      return;\n    }\n    setLeftSlidable(scrollElement.scrollLeft > 0);\n    setRightSlidable(\n      scrollElement.scrollWidth > scrollElement.clientWidth &&\n        Math.ceil(scrollElement.scrollLeft) <\n          scrollElement.scrollWidth - scrollElement.clientWidth,\n    );\n  };\n\n  useEffect(() => {\n    const scrollElement = scrollRef.current;\n    if (!scrollElement) {\n      return;\n    }\n\n    // Monitor width change\n    const resizeObserver = new ResizeObserver(() => {\n      checkScrollability();\n    });\n    resizeObserver.observe(scrollElement);\n\n    // listen for scrolling events\n    scrollElement.addEventListener('scroll', checkScrollability);\n\n    return () => {\n      if (scrollElement) {\n        resizeObserver.unobserve(scrollElement);\n        scrollElement.removeEventListener('scroll', checkScrollability);\n      }\n    };\n  }, []);\n\n  const contextValue = {\n    spaceId: spaceId ?? '',\n    flowMode: WorkflowMode.Workflow,\n    modalState: DataSourceType.Workflow,\n  } as unknown as WorkflowModalContextValue;\n\n  if (readonly) {\n    return;\n  }\n\n  return (\n    <PanelWrap\n      className={classNames(styles['template-panel-container'], {\n        [styles['template-slide-down']]: !templateState.templateVisible,\n      })}\n      style={{\n        paddingTop: '0px',\n      }}\n    >\n      <WorkflowModalContext.Provider value={contextValue}>\n        <div ref={containerRef} className=\"relative flex overflow-hidden\">\n          <TemplateCardList\n            ref={scrollRef}\n            workflowTemplateList={templateState.templateList}\n            isCardsOver={isCardsOver}\n          />\n        </div>\n      </WorkflowModalContext.Provider>\n\n      <TemplateSlideButton\n        onTemplateScorll={handleClickSlide}\n        templateVisible={templateState.templateList?.length > 0}\n        slidable={isLeftSlidable}\n        direction={'left'}\n      />\n      <TemplateSlideButton\n        onTemplateScorll={handleClickSlide}\n        templateVisible={templateState.templateList?.length > 0}\n        slidable={isRightSlidable}\n        direction={'right'}\n      />\n    </PanelWrap>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useRef } from 'react';\n\nimport axios, { type Canceler } from 'axios';\nimport { useQuery } from '@tanstack/react-query';\nimport { workflowApi } from '@coze-workflow/base/api';\nimport { useUpdateEffect } from '@coze-arch/hooks';\n\nimport { useMergeConfirm } from '../workflow-header/hooks';\nimport { useGlobalState } from '../../hooks';\n\nconst LOOP_TIME = 10000;\n\nexport const useRetrieve = () => {\n  const {\n    workflowId,\n    spaceId,\n    info,\n    loading,\n    isViewHistory,\n    isCollaboratorMode,\n  } = useGlobalState();\n\n  const { vcsData } = info;\n\n  const { draft_commit_id, submit_commit_id } = vcsData || {};\n\n  const [needMerge, setNeedMerge] = useState(false);\n\n  const cancelReq = useRef<Canceler>();\n\n  // TODO: Use 10-second intervals for rotations in this issue, and use long links instead in the second phase of requirements\n  const { data: author } = useQuery({\n    queryKey: ['workflow_retrieve', spaceId, workflowId],\n    queryFn: async () => {\n      const { data } = await workflowApi.CheckLatestSubmitVersion(\n        {\n          workflow_id: workflowId,\n          space_id: spaceId,\n        },\n        {\n          cancelToken: new axios.CancelToken(canceler => {\n            cancelReq.current = canceler;\n          }),\n        },\n      );\n\n      const { need_merge, latest_submit_author } = data;\n      setNeedMerge(!!need_merge);\n      return latest_submit_author;\n    },\n    refetchInterval: LOOP_TIME,\n    enabled: !loading && !!draft_commit_id && isCollaboratorMode && !needMerge,\n  });\n\n  useUpdateEffect(() => {\n    setNeedMerge(false);\n    cancelReq.current?.();\n    // Base version changes, for example, after merging, you need to close the banner and re-rotate\n  }, [submit_commit_id]);\n\n  const { mergeConfirm } = useMergeConfirm();\n\n  const handleRetrieve = async () => {\n    await mergeConfirm();\n  };\n\n  return {\n    showRetrieve: needMerge && isCollaboratorMode && !isViewHistory,\n    author,\n    handleRetrieve,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Banner } from '@coze-arch/coze-design';\nimport { Typography } from '@coze-arch/bot-semi';\n\nimport { useRetrieve } from './use-retrieve';\n\nconst { Text } = Typography;\n\nconst RetrieveBanner = () => {\n  const { showRetrieve, author, handleRetrieve } = useRetrieve();\n\n  if (!showRetrieve || IS_BOT_OP) {\n    return null;\n  }\n\n  return (\n    <Banner\n      type=\"info\"\n      icon={null}\n      closeIcon={null}\n      description={\n        <Text>\n          {I18n.t('workflow_publish_multibranch_merge_comfirm_desc', {\n            user_name: author,\n          })}\n          <Text link onClick={handleRetrieve} style={{ marginLeft: 8 }}>\n            {I18n.t('workflow_publish_multibranch_merge_retrieve')}\n          </Text>\n        </Text>\n      }\n    />\n  );\n};\n\nexport default RetrieveBanner;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport { useScrollToNode, useScrollToLine } from '../../../../../hooks';\nimport { type NodeError } from '../../../../../entities/workflow-exec-state-entity';\n\nexport const useScrollToError = () => {\n  const scrollToNode = useScrollToNode();\n  const scrollToLine = useScrollToLine();\n\n  const scrollToError = (error: NodeError) => {\n    const { nodeId, errorType, targetNodeId } = error;\n    if (errorType === 'line') {\n      return scrollToLine(nodeId, targetNodeId || '');\n    } else {\n      return scrollToNode(nodeId);\n    }\n  };\n\n  return scrollToError;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback } from 'react';\n\nimport { useMemoizedFn } from 'ahooks';\nimport type { FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { usePlayground } from '@flowgram-adapter/free-layout-editor';\nimport { ProblemPanel as ProblemPanelCore } from '@coze-workflow/test-run';\nimport { type ValidateError } from '@coze-workflow/base/services';\nimport { I18n } from '@coze-arch/i18n';\nimport { Toast } from '@coze-arch/coze-design';\n\nimport { useWatchValidateWorkflow } from '@/hooks/use-validate-workflow';\nimport { useTemplateService } from '@/hooks/use-template-service';\nimport {\n  useFloatLayoutService,\n  useFloatLayoutSize,\n  useGlobalState,\n} from '@/hooks';\nimport { LayoutPanelKey } from '@/constants';\n\nimport { useScrollToError } from '../test-run/execute-result/execute-result-side-sheet/hooks/use-scroll-to-error';\nimport { PanelWrap, PANEL_PADDING } from '../float-layout';\n\nexport const ProblemPanel = () => {\n  const floatLayoutService = useFloatLayoutService();\n  const globalState = useGlobalState();\n  const templateState = useTemplateService();\n  const { height: layoutHeight } = useFloatLayoutSize();\n  const scrollToError = useScrollToError();\n  const playground = usePlayground();\n\n  const handleScroll = useCallback(\n    async (problem: ValidateError) => {\n      const scrolled = await scrollToError(problem);\n      if (!scrolled) {\n        Toast.error(I18n.t('workflow_node_has_delete'));\n        return;\n      }\n      if (problem.errorType === 'node' && problem.nodeId) {\n        const node = playground.entityManager.getEntityById<FlowNodeEntity>(\n          problem.nodeId,\n        );\n        if (node) {\n          floatLayoutService.open(LayoutPanelKey.NodeForm, 'right', { node });\n        }\n      }\n    },\n    [scrollToError],\n  );\n\n  const handleJump = useMemoizedFn(\n    (problem: ValidateError, workflowId: string) => {\n      const isInProject = !!globalState.projectId;\n      const projectApi = globalState.getProjectApi();\n      if (isInProject && projectApi) {\n        projectApi.sendMsgOpenWidget(`/workflow/${workflowId}`, {\n          name: 'debug',\n          data: {\n            nodeId: problem.nodeId,\n          },\n        });\n        return;\n      }\n      const url =\n        `/work_flow?space_id=${globalState.spaceId}&workflow_id=${globalState.workflowId}` +\n        `&node_id=${problem.nodeId}`;\n      window.open(url);\n    },\n  );\n\n  const handleClose = useCallback(() => {\n    floatLayoutService.close('bottom');\n    if (templateState.templateVisible) {\n      floatLayoutService.open('templatePanel', 'bottom');\n    }\n  }, [floatLayoutService]);\n\n  useWatchValidateWorkflow();\n\n  return (\n    <PanelWrap>\n      <ProblemPanelCore\n        workflowId={globalState.workflowId}\n        maxHeight={layoutHeight - PANEL_PADDING * 2}\n        onScroll={handleScroll}\n        onJump={handleJump}\n        onClose={handleClose}\n      />\n    </PanelWrap>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isEmpty } from 'lodash-es';\nimport classNames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozCross } from '@coze-arch/coze-design/icons';\nimport { Banner } from '@coze-arch/coze-design';\n\nimport { useWorkflowReferences } from '../../hooks/use-workflow-references';\nimport { useGlobalState } from '../../hooks';\n\nimport styles from './index.module.less';\nexport const ModifyBanner = () => {\n  const { readonly } = useGlobalState();\n\n  const { references } = useWorkflowReferences();\n\n  const showBanner = !readonly && !isEmpty(references?.workflowList);\n\n  if (!showBanner) {\n    return null;\n  }\n\n  return (\n    <Banner\n      type=\"info\"\n      icon={null}\n      className={styles['modify-banner']}\n      closeIcon={\n        <div\n          className={classNames(\n            'flex items-center',\n            'cursor-pointer space-x-2',\n            'text-[#06070980]',\n          )}\n        >\n          <div>{I18n.t('workflow_detail_edit_prompt_button')}</div>\n          <IconCozCross />\n        </div>\n      }\n      description={\n        <div>{I18n.t('workflow_detail_sub_workflow_change_banner')}</div>\n      }\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useDragLayer } from 'react-dnd';\nimport { useMemo, useRef } from 'react';\n\nimport {\n  IconCozCheckMarkCircleFillPalette,\n  IconCozInfoCircleFillPalette,\n} from '@coze-arch/coze-design/icons';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\n\nimport { WorkflowCustomDragService } from '../../services';\nimport { useGlobalState } from '../../hooks';\nimport { DND_ACCEPT_KEY } from '../../constants';\n\nimport styles from './index.module.less';\n\nexport const DragTooltip = () => {\n  const dragService = useService<WorkflowCustomDragService>(\n    WorkflowCustomDragService,\n  );\n  const globalState = useGlobalState();\n  const { item, itemType, currentOffset, allowDrop, message } = useDragLayer(\n    monitor => {\n      const canDrop = dragService.computeCanDrop({\n        coord: currentOffset ?? { x: 0, y: 0 },\n        dragNode: {\n          type: item?.nodeType,\n          json: item?.nodeJson,\n        },\n      });\n\n      return {\n        allowDrop: canDrop.allowDrop,\n        message: canDrop.message,\n        item: monitor.getItem(),\n        itemType: monitor.getItemType() as string,\n        currentOffset: monitor.getSourceClientOffset() ?? { x: 0, y: 0 },\n      };\n    },\n  );\n\n  const display = useMemo(() => {\n    if (itemType !== DND_ACCEPT_KEY) {\n      return false;\n    }\n    if (!message) {\n      // Show only when there is news\n      return false;\n    }\n    return true;\n  }, [itemType, message]);\n\n  const tooltipRef = useRef<HTMLDivElement>(null);\n  const offset = useMemo(() => {\n    const isInProject = Boolean(globalState.projectId);\n    // The initial position is the upper left corner of the canvas, and currentOffset is the offset from the upper left corner of the screen. You need to subtract the offset of the canvas from the upper left corner of the screen.\n    const playgroundOffsetX = isInProject ? 276 : 0;\n    const playgroundOffsetY = isInProject ? 100 : 73;\n\n    const nodeCardWidth = 204;\n    const tooltipArrowHeight = 10;\n    const left =\n      currentOffset.x -\n      playgroundOffsetX -\n      ((tooltipRef.current?.clientWidth ?? 0) - nodeCardWidth) / 2;\n    const top =\n      currentOffset.y -\n      playgroundOffsetY -\n      (tooltipRef.current?.clientHeight ?? 0) -\n      tooltipArrowHeight;\n    return { left, top };\n  }, [currentOffset, globalState.projectId]);\n  return (\n    <div\n      className={styles['drag-tooltip-container']}\n      ref={tooltipRef}\n      style={{\n        display: display ? 'block' : 'none',\n        ...offset,\n      }}\n    >\n      <div className={styles['drag-tooltip-main']}>\n        <div className={styles['drag-tooltip-icon']}>\n          {allowDrop ? (\n            <IconCozCheckMarkCircleFillPalette\n              className={styles['success-icon']}\n            />\n          ) : (\n            <IconCozInfoCircleFillPalette className={styles['warning-icon']} />\n          )}\n        </div>\n        <div className={styles['drag-tooltip-content']}>{message}</div>\n      </div>\n      <svg\n        className={styles['drag-tooltip-arrow']}\n        width=\"24\"\n        height=\"8\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path\n          d=\"M0 0.5L0 1.5C4 1.5, 5.5 3, 7.5 5S10,8 12,8S14.5 7, 16.5 5S20,1.5 24,1.5L24 0.5L0 0.5z\"\n          fill=\"var(--semi-color-border)\"\n          opacity=\"1\"\n        ></path>\n        <path\n          d=\"M0 0L0 1C4 1, 5.5 2, 7.5 4S10,7 12,7S14.5  6, 16.5 4S20,1 24,1L24 0L0 0z\"\n          fill=\"var(--semi-color-bg-3)\"\n        ></path>\n      </svg>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Tag, Typography } from '@coze-arch/coze-design';\n\nexport const Title: FC<{\n  icon: string;\n}> = props => {\n  const { icon } = props;\n  return (\n    <div className=\"flex items-center gap-2 mb-3\">\n      <img src={icon} width={16} height={16} />\n      <Typography.Title heading={6}>\n        {I18n.t('scene_workflow_chat_node_name', {}, 'Role scheduling')}\n      </Typography.Title>\n      <Tag color=\"cyan\" loading>\n        {I18n.t('scene_workflow_chat_node_test_run_running', {}, 'Running')}\n      </Tag>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, useRef } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Tag } from '@coze-arch/coze-design';\nimport { Form, ArrayField, UIButton, Typography } from '@coze-arch/bot-semi';\nimport { IconPlay } from '@douyinfe/semi-icons';\n\nimport { type MessageFormValue } from './types';\n\nconst { Input } = Form;\n\ninterface MessageFormProps {\n  initValues: MessageFormValue;\n  onSubmit: (values: MessageFormValue) => void;\n}\n\nexport const MessageForm: FC<MessageFormProps> = props => {\n  const { initValues, onSubmit } = props;\n  const formRef = useRef<Form<MessageFormValue>>(null);\n\n  const renderNickNameLabel = (nickName, roleName) => (\n    <>\n      {`${nickName}`} <Tag>{roleName ? roleName : nickName}</Tag>\n    </>\n  );\n\n  return (\n    <Form<MessageFormValue>\n      ref={formRef}\n      onSubmit={onSubmit}\n      className=\"relative h-full flex flex-col\"\n    >\n      <div className=\"p-6 rounded-lg coz-bg-max coz-stroke-primary flex-1 mb-6 border border-solid\">\n        <ArrayField field=\"Messages\" initValue={initValues.Messages}>\n          {({ arrayFields }) => (\n            <>\n              {arrayFields.map(({ field, key, remove }, index) => {\n                if (initValues.Messages[index].content) {\n                  return (\n                    <div className=\"py-3\">\n                      <Form.Label>\n                        {renderNickNameLabel(\n                          initValues.Messages[index].nickname,\n                          initValues.Messages[index].role,\n                        )}\n                      </Form.Label>\n\n                      <div>\n                        <Typography.Text>\n                          {initValues.Messages[index].content}\n                        </Typography.Text>\n                      </div>\n                    </div>\n                  );\n                } else {\n                  return (\n                    <Input\n                      label={renderNickNameLabel(\n                        initValues.Messages[index].nickname,\n                        initValues.Messages[index].role,\n                      )}\n                      field={`${field}[content]`}\n                      rules={[\n                        {\n                          required: true,\n                          message: 'Required',\n                        },\n                      ]}\n                    />\n                  );\n                }\n              })}\n            </>\n          )}\n        </ArrayField>\n      </div>\n      <div className=\"mb-6 text-right\">\n        <UIButton\n          icon={<IconPlay />}\n          type=\"primary\"\n          theme=\"solid\"\n          htmlType=\"submit\"\n          className=\"btn-margin-right \"\n        >\n          {I18n.t(\n            'scene_workflow_chat_node_test_run_button',\n            {},\n            'Continue running',\n          )}\n        </UIButton>\n      </div>\n    </Form>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useEffect } from 'react';\n\n// import { useMutation } from '@tanstack/react-query';\nimport { EventType, workflowApi } from '@coze-workflow/base/api';\nimport { I18n } from '@coze-arch/i18n';\nimport { SideSheet } from '@coze-arch/coze-design';\nimport { typeSafeJSONParse } from '@coze-arch/bot-utils';\nimport { UIIconButton } from '@coze-arch/bot-semi';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { IconClose } from '@douyinfe/semi-icons';\n\nimport { useCancelTestRun } from '../test-run/hooks/use-cancel-test-run';\nimport { WorkflowRunService } from '../../services';\nimport { useExecStateEntity, useGlobalState } from '../../hooks';\n// import { useGenerateMessageFormInitValue } from './use-generate-message-form-init-value';\nimport { type MessageFormValue } from './types';\nimport { Title } from './title';\nimport { MessageForm } from './message-form';\n\nexport const ChatTestRunPauseSideSheet = () => {\n  const [visible, setVisible] = useState(false);\n\n  const { workflowId, spaceId } = useGlobalState();\n\n  const { cancelTestRun } = useCancelTestRun();\n\n  const exeState = useExecStateEntity();\n\n  const testrunService = useService<WorkflowRunService>(WorkflowRunService);\n\n  const sceneChatNodeEvent = exeState.getNodeEvent(EventType.SceneChat);\n\n  // const generateMessageFormInitValue = useGenerateMessageFormInitValue();\n\n  // const { mutate } = useMutation({\n  //   mutationFn: workflowApi.WorkFlowTestResume,\n  //   onSuccess: () => {\n  //     debugger;\n  //     testrunService.continueTestRun();\n  //     setVisible(false);\n  //   },\n  // });\n\n  useEffect(() => {\n    if (sceneChatNodeEvent) {\n      testrunService.pauseTestRun();\n      setVisible(true);\n    } else {\n      setVisible(false);\n    }\n  }, [sceneChatNodeEvent]);\n\n  const handleClose = () => {\n    setVisible(false);\n    cancelTestRun();\n  };\n\n  const handleMessageFormSubmit = async (values: MessageFormValue) => {\n    await workflowApi.WorkFlowTestResume({\n      workflow_id: workflowId,\n      execute_id: exeState.config.executeId,\n      event_id: sceneChatNodeEvent?.id ?? '',\n      space_id: spaceId,\n      data: JSON.stringify(values),\n    });\n\n    testrunService.continueTestRun();\n    setVisible(false);\n\n    // debugger;\n    // mutate({\n    //   workflow_id: workflowId,\n    //   execute_id: exeState.config.executeId,\n    //   event_id: sceneChatNodeEvent?.id ?? '',\n    //   data: JSON.stringify(values),\n    // });\n  };\n\n  if (visible) {\n    return (\n      <SideSheet\n        visible={visible}\n        closable={false}\n        width={600}\n        title={\n          <div className=\"flex items-center\">\n            <UIIconButton\n              type=\"secondary\"\n              icon={<IconClose style={{ color: '#1C1D23' }} />}\n              iconSize=\"large\"\n              onClick={handleClose}\n            />\n            {I18n.t(\n              'scene_workflow_chat_node_test_run_title',\n              {},\n              'Test Q&A nodes',\n            )}\n          </div>\n        }\n        style={{\n          background: '#F7F7FA',\n        }}\n      >\n        <div className=\"h-full flex flex-col\">\n          <Title icon={sceneChatNodeEvent?.node_icon ?? ''} />\n          <div className=\"flex-1\">\n            <MessageForm\n              initValues={{\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                Messages: (typeSafeJSONParse(sceneChatNodeEvent?.data) as any)\n                  ?.messages,\n\n                // messages:\n                //   generateMessageFormInitValue(\n                //     // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                //     (typeSafeJSONParse(sceneChatNodeEvent?.data) as any)\n                //       ?.messages,\n                //   ) ?? [],\n              }}\n              onSubmit={handleMessageFormSubmit}\n            />\n          </div>\n        </div>\n      </SideSheet>\n    );\n  } else {\n    return null;\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { workflowApi } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { Toast } from '@coze-arch/coze-design';\n\nimport { useGlobalState, useScrollToNode } from '@/hooks';\n\nexport interface GotoParams {\n  nodeId: string;\n  workflowId: string;\n  executeId: string;\n  subExecuteId: string;\n}\n\nexport const useGotoNode = () => {\n  const scrollToNode = useScrollToNode();\n  const globalState = useGlobalState();\n  const isInProject = !!globalState.projectId;\n\n  const isProjectWorkflow = async (workflowId: string) => {\n    try {\n      const res = await workflowApi.GetWorkflowDetail(\n        {\n          space_id: globalState.spaceId,\n          workflow_ids: [workflowId],\n        },\n        { __disableErrorToast: true },\n      );\n\n      const info = res?.data?.[0];\n      return !!info.project_id;\n    } catch {\n      return false;\n    }\n  };\n\n  const gotoLibrary = (params: GotoParams) => {\n    const { nodeId, workflowId, executeId, subExecuteId } = params;\n    const { spaceId } = globalState;\n    const url =\n      `/work_flow?space_id=${spaceId}&workflow_id=${workflowId}` +\n      `&node_id=${nodeId}&execute_id=${executeId}&sub_execute_id=${subExecuteId}`;\n\n    window.open(url);\n  };\n\n  const goto = async (params: GotoParams) => {\n    const { nodeId, workflowId, executeId, subExecuteId } = params;\n    // The same process, directly focus on the node\n    if (workflowId === globalState.workflowId && nodeId) {\n      const scrolled = await scrollToNode(nodeId);\n      if (!scrolled) {\n        Toast.error(I18n.t('workflow_node_has_delete'));\n      }\n      return;\n    }\n\n    // Special jumping logic of operation and maintenance platform\n    if (IS_BOT_OP) {\n      const searchParams = new URLSearchParams();\n      searchParams.append('workflow_id', workflowId);\n      searchParams.append('execute_id', executeId);\n      searchParams.append('sub_execute_id', subExecuteId);\n      searchParams.append('node_id', nodeId);\n      window.open(\n        `${window.location.pathname}?${searchParams.toString()}`,\n        '_blank',\n      );\n      return;\n    }\n\n    // The host process is the resource library process, directly open the new tab of the browser to jump\n    if (!isInProject) {\n      gotoLibrary(params);\n      return;\n    }\n\n    const inProject = await isProjectWorkflow(workflowId);\n    const projectApi = globalState.getProjectApi();\n    if (!inProject || !projectApi) {\n      gotoLibrary(params);\n      return;\n    }\n    projectApi.sendMsgOpenWidget(`/workflow/${workflowId}`, {\n      name: 'debug',\n      data: {\n        nodeId,\n        executeId,\n        subExecuteId,\n      },\n    });\n  };\n\n  return {\n    goto,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\n\nimport { TraceListPanel as TraceListPanelNext } from '@coze-workflow/test-run-next';\n\nimport { useTemplateService } from '@/hooks/use-template-service';\nimport { useFloatLayoutService } from '@/hooks/use-float-layout-service';\nimport {\n  useGlobalState,\n  useFloatLayoutSize,\n  useTestRunReporterService,\n} from '@/hooks';\n\nimport { PanelWrap, PANEL_PADDING } from '../../float-layout';\nimport { useGotoNode } from './use-goto-node';\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface TraceListPanelProps {}\n\nexport const TraceListPanel: React.FC<TraceListPanelProps> = () => {\n  const floatLayoutService = useFloatLayoutService();\n  const templateState = useTemplateService();\n  const globalState = useGlobalState();\n  const { height: layoutHeight } = useFloatLayoutSize();\n\n  const { goto: gotoNode } = useGotoNode();\n  const reporter = useTestRunReporterService();\n  const handleClose = () => {\n    floatLayoutService.close('bottom');\n    if (templateState.templateVisible) {\n      floatLayoutService.open('templatePanel', 'bottom');\n    }\n  };\n\n  useEffect(() => {\n    reporter.traceOpen({ panel_type: 'list' });\n  }, [reporter]);\n\n  return (\n    <PanelWrap>\n      <TraceListPanelNext\n        spaceId={globalState.spaceId}\n        workflowId={globalState.workflowId}\n        maxHeight={layoutHeight - PANEL_PADDING * 2}\n        onOpenDetail={span => {\n          floatLayoutService.open('traceDetail', 'right', { span });\n        }}\n        onClose={handleClose}\n        isInOp={IS_BOT_OP}\n        onGotoNode={gotoNode}\n      />\n    </PanelWrap>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\n\nimport { TraceDetailPanel as TraceDetailPanelNext } from '@coze-workflow/test-run-next';\nimport { type TraceFrontendSpan } from '@coze-workflow/base';\n\nimport { useFloatLayoutService, useTestRunReporterService } from '@/hooks';\n\nimport { PanelWrap } from '../../float-layout';\nimport { useGotoNode } from './use-goto-node';\n\nexport interface TraceDetailPanelProps {\n  span: TraceFrontendSpan;\n}\n\nexport const TraceDetailPanel: React.FC<TraceDetailPanelProps> = ({ span }) => {\n  const floatLayoutService = useFloatLayoutService();\n  const reporter = useTestRunReporterService();\n  const { goto: gotoNode } = useGotoNode();\n  const handleClose = () => {\n    floatLayoutService.close('right');\n  };\n\n  useEffect(() => {\n    reporter.traceOpen({ panel_type: 'detail', log_id: span.log_id });\n  }, [reporter, span.log_id]);\n\n  return (\n    <PanelWrap layout=\"vertical\">\n      <TraceDetailPanelNext\n        span={span}\n        onClose={handleClose}\n        onGotoNode={gotoNode}\n      />\n    </PanelWrap>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useEffect } from 'react';\n\nimport { useService } from '@flowgram-adapter/free-layout-editor';\n\nimport { ChatflowService } from '@/services';\n\nexport const useChatflowInfo = () => {\n  const chatflowService = useService<ChatflowService>(ChatflowService);\n  const [sessionInfo, setSessionInfo] = useState(chatflowService.selectItem);\n  const [conversationInfo, setConversationInfo] = useState(\n    chatflowService.selectConversationItem,\n  );\n\n  useEffect(() => {\n    const disposable = chatflowService.onSelectItemChange(info =>\n      setSessionInfo(info),\n    );\n    const conversationDisposable =\n      chatflowService.onSelectConversationItemChange(info => {\n        setConversationInfo(info);\n      });\n    return () => {\n      disposable?.dispose?.();\n      conversationDisposable?.dispose?.();\n    };\n  }, []);\n\n  return { sessionInfo, conversationInfo };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { MIN_WIDTH } from './constants';\n\nexport function getConstraintWidth(width, max) {\n  return Math.max(MIN_WIDTH, Math.min(max, width));\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const MIN_WIDTH = 360;\nexport const MAX_WIDTH = 546;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useResizableSidePanelStore } from '@/hooks/use-resizable-side-panel-store';\nimport { useFloatLayoutSize } from '@/hooks';\n\nimport { getConstraintWidth } from './utils';\nimport { MAX_WIDTH } from './constants';\n\nconst PADDING = 16;\n\nexport function useSidePanelWidth(): { max: number; width: number } {\n  const storeWidth = useResizableSidePanelStore(state => state.width);\n  const { width: layoutWidth } = useFloatLayoutSize();\n  const maxLayoutWidth = layoutWidth ? layoutWidth - PADDING : 0;\n  const max = maxLayoutWidth ? Math.min(maxLayoutWidth, MAX_WIDTH) : MAX_WIDTH;\n  const width = getConstraintWidth(storeWidth, max);\n\n  return {\n    max,\n    width,\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Nodal side window with adjustable width\n */\nimport { type FC } from 'react';\n\nimport { type ResizableProps, Resizable } from 're-resizable';\n\nimport { useResizable } from './use-resizable';\n\ninterface ResizableSidePanelProps extends ResizableProps {\n  bypass?: boolean;\n}\n\nexport const ResizableSidePanel: FC<ResizableSidePanelProps> = ({\n  children,\n  bypass,\n  ...props\n}) => {\n  const resizable = useResizable();\n\n  if (bypass) {\n    return <>{children}</>;\n  }\n\n  return <Resizable {...{ ...resizable, ...props }}>{children}</Resizable>;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable max-params */\nimport { useCallback, useRef } from 'react';\n\nimport { type NumberSize, type ResizableProps } from 're-resizable';\n\nimport { useResizableSidePanelStore } from '@/hooks/use-resizable-side-panel-store';\n\nimport { getConstraintWidth } from './utils';\nimport { useSidePanelWidth } from './use-side-panel-width';\nimport { MIN_WIDTH } from './constants';\n\nimport styles from './index.module.less';\n\nexport function useResizable(): ResizableProps {\n  const setStoreWidth = useResizableSidePanelStore(state => state.setWidth);\n  const { width, max } = useSidePanelWidth();\n  const initWidth = useRef(width);\n\n  const handleResizeStart = useCallback(\n    (_event, _direction, _elementRef) => {\n      initWidth.current = width;\n    },\n    [width],\n  );\n\n  const handleResize = useCallback(\n    (_event, _direction, _elementRef, delta: NumberSize) => {\n      if (!initWidth.current) {\n        return;\n      }\n      setStoreWidth(getConstraintWidth(initWidth.current + delta.width, max));\n    },\n    [max, setStoreWidth],\n  );\n\n  const handleResizeStop = useCallback(\n    (_event, _direction, _elementRef, delta: NumberSize) => {\n      if (!initWidth.current) {\n        return;\n      }\n      setStoreWidth(getConstraintWidth(initWidth.current + delta.width, max));\n    },\n    [max, setStoreWidth],\n  );\n\n  return {\n    enable: {\n      left: true,\n    },\n    minWidth: MIN_WIDTH,\n    maxWidth: max,\n    size: {\n      width,\n      height: '100%',\n    },\n    handleWrapperClass: styles['resizable-handle-wrapper'],\n    onResizeStart: handleResizeStart,\n    onResize: handleResize,\n    onResizeStop: handleResizeStop,\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type IFormSchema } from '@coze-workflow/test-run-next';\n\nexport const visitNodeLeaf = (\n  properties: IFormSchema['properties'],\n  fn: (groupKey: string, key: string, field: IFormSchema) => void,\n) => {\n  Object.entries(properties || {}).forEach(([groupKey, groupField]) => {\n    Object.entries(groupField?.properties || {}).forEach(([key, field]) => {\n      fn(groupKey, key, field);\n    });\n  });\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable complexity */\nimport { toNumber, isUndefined } from 'lodash-es';\nimport { safeJsonParse } from '@coze-workflow/test-run-next';\nimport { ViewVariableType } from '@coze-workflow/base';\n\nconst generateJsonSchemaFileValue = (value: string) => {\n  if (!value) {\n    return value;\n  }\n  return `<#file:${value}#>`;\n};\nconst generateJsonSchemaVoiceValue = (value: string) => {\n  if (!value) {\n    return value;\n  }\n  return `<#voice:${value}#>`;\n};\n\nexport const getJsonModeFieldDefaultValue = (\n  type: ViewVariableType,\n  value: any,\n) => {\n  let temp = value;\n  // Complex types such as objects and arrays require deserialization\n  if (\n    type === ViewVariableType.Object ||\n    type >= ViewVariableType.ArrayString\n  ) {\n    temp = safeJsonParse(temp);\n  }\n  // timbre\n  if (ViewVariableType.isVoiceType(type)) {\n    temp = generateJsonSchemaVoiceValue(temp);\n    // Files other than timbre\n  } else if (ViewVariableType.isFileType(type)) {\n    if (ViewVariableType.isArrayType(type)) {\n      temp = temp?.map(generateJsonSchemaFileValue);\n    } else {\n      temp = generateJsonSchemaFileValue(temp);\n    }\n  }\n\n  // The number type needs to be converted to bigNumber to ensure value safety\n  if (type === ViewVariableType.Integer || type === ViewVariableType.Number) {\n    temp = toNumber(temp) || 0;\n  }\n\n  if (!isUndefined(temp)) {\n    return temp;\n  }\n  if (type === ViewVariableType.Integer || type === ViewVariableType.Number) {\n    return 0;\n  }\n  if (type === ViewVariableType.Boolean) {\n    return true;\n  }\n  if (type === ViewVariableType.Object) {\n    return {};\n  }\n  if (type >= ViewVariableType.ArrayString) {\n    return [];\n  }\n  return '';\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport { type SchemaObject } from 'ajv';\nimport {\n  TestFormFieldName,\n  generateFieldValidator,\n  type IFormSchema,\n} from '@coze-workflow/test-run-next';\nimport { ViewVariableType } from '@coze-workflow/base';\n\nimport { visitNodeLeaf } from './visit-node-leaf';\nimport { getJsonModeFieldDefaultValue } from './get-json-mode-field-default-value';\n\nconst getDefaultValue = (properties: IFormSchema['properties']) => {\n  const values = {};\n  visitNodeLeaf(properties, (groupKey, key, field) => {\n    values[groupKey] = {\n      ...values[groupKey],\n      [key]: getJsonModeFieldDefaultValue(\n        field['x-origin-type'] as any,\n        field.defaultValue,\n      ),\n    };\n  });\n  return JSON.stringify(values, undefined, 2);\n};\n\nconst generateValidateJsonSchemaField = (field: IFormSchema) => {\n  const originType = field['x-origin-type'] as any;\n  if (originType === ViewVariableType.Integer) {\n    return {\n      type: 'integer',\n    };\n  }\n  if (originType === ViewVariableType.Number) {\n    return {\n      type: 'number',\n    };\n  }\n  if (originType === ViewVariableType.Boolean) {\n    return {\n      type: 'boolean',\n    };\n  }\n  if (\n    ViewVariableType.isArrayType(originType) &&\n    ViewVariableType.isFileType(originType)\n  ) {\n    return {\n      type: 'array',\n      items: { type: 'string' },\n    };\n  }\n  // A complex type uses its own jsonSchema.\n  if (\n    ViewVariableType.isArrayType(originType) ||\n    originType === ViewVariableType.Object\n  ) {\n    return field['x-component-props']?.jsonSchema;\n  }\n\n  return {\n    type: 'string',\n  };\n};\n\nconst getValidateJsonSchema = (properties: IFormSchema['properties']) => {\n  const temp: SchemaObject = {\n    type: 'object',\n    properties: {},\n    required: [],\n  };\n  visitNodeLeaf(properties, (groupKey, key, field) => {\n    const groupTemp = temp.properties[groupKey] || {\n      type: 'object',\n      properties: {},\n      required: [],\n    };\n    groupTemp.properties[key] = generateValidateJsonSchemaField(field);\n    if (field.required) {\n      groupTemp.required.push(key);\n      if (!temp.required.includes(groupKey)) {\n        temp.required.push(groupKey);\n      }\n    }\n    temp.properties[groupKey] = groupTemp;\n  });\n  return temp;\n};\n\nexport const toJsonModeSchema = (origin: IFormSchema) => {\n  const nodeField = origin.properties?.[TestFormFieldName.Node];\n  const nodeProperties = nodeField?.properties;\n  /**\n   * If the node does not have any imported parameters, it is not processed\n   */\n  if (!nodeProperties) {\n    return;\n  }\n  const validateJsonSchema = getValidateJsonSchema(nodeProperties);\n\n  nodeField.properties = {\n    [TestFormFieldName.JSON]: {\n      ['x-component']: 'JsonModeInput',\n      ['x-component-props']: {\n        properties: nodeProperties,\n        validateJsonSchema,\n      },\n      defaultValue: getDefaultValue(nodeProperties),\n      ...generateFieldValidator({\n        name: TestFormFieldName.JSON,\n        validateJsonSchema,\n      }),\n    },\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { isUndefined } from 'lodash-es';\nimport { type IFormSchema } from '@coze-workflow/test-run-next';\n\ninterface SetCacheValuesOptions {\n  properties: IFormSchema['properties'];\n  defaultValues: any;\n  /** Whether to force the use of defaultValues data */\n  force?: boolean;\n}\n\nexport const setDefaultValues = ({\n  properties,\n  defaultValues,\n  force,\n}: SetCacheValuesOptions) => {\n  if (!properties) {\n    return;\n  }\n  Object.keys(properties).forEach(key => {\n    const field = properties[key];\n    const value = defaultValues?.[key];\n    if (field.type === 'object') {\n      setDefaultValues({\n        properties: field.properties,\n        defaultValues: value,\n        force,\n      });\n      return;\n    }\n    if (!isUndefined(value) || force) {\n      field.defaultValue = value;\n    }\n  });\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const TEST_RUN_FILE_NAME_KEY = 'x-wf-file_name';\nexport const TEST_RUN_FILE_UPLOADING_KEY = 'x-wf-file_uploading';\n\nexport const getFileInfo = (formatUrl: string) => {\n  const url = new URL(formatUrl);\n  const params = new URLSearchParams(url.search);\n  const fileName = params.get(TEST_RUN_FILE_NAME_KEY) ?? '';\n  const uploading = params.get(TEST_RUN_FILE_UPLOADING_KEY);\n\n  return {\n    url: formatUrl,\n    name: fileName,\n    uploading,\n  };\n};\n\nexport const getUrlWithFilename = (url: string, name?: string) => {\n  if (!name || !url) {\n    return url;\n  }\n  try {\n    const urlObj = new URL(url);\n    const params = new URLSearchParams(urlObj.search);\n\n    if (params.has(TEST_RUN_FILE_NAME_KEY)) {\n      params.set(TEST_RUN_FILE_NAME_KEY, name);\n    } else {\n      params.append(TEST_RUN_FILE_NAME_KEY, name);\n    }\n\n    urlObj.search = params.toString();\n\n    return urlObj.toString();\n  } catch (e) {\n    return url;\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { isUndefined } from 'lodash-es';\nimport {\n  type IFormSchema,\n  safeJsonParse,\n  TestFormFieldName,\n} from '@coze-workflow/test-run-next';\nimport { ViewVariableType } from '@coze-workflow/base';\n\nimport { visitNodeLeaf } from './visit-node-leaf';\nimport { getFileInfo } from './file-info';\n\nconst getFormSchemaFileUrl = (value: string) => {\n  if (!value) {\n    return undefined;\n  }\n  const match = value.match(/<#file:(https?:.+?)#>/);\n  // Unknown string format reserved\n  if (!match) {\n    return value;\n  }\n  const fileInfo = getFileInfo(match[1]);\n  // The value that has not been uploaded is directly discarded.\n  if (fileInfo.uploading) {\n    return undefined;\n  }\n  return match[1];\n};\n\nconst getFormSchemaVoiceId = (value: string) => {\n  if (!value) {\n    return undefined;\n  }\n  const match = value.match(/<#voice:(\\d+)#>/);\n  // Unknown string reservation\n  if (!match) {\n    return value;\n  }\n  return match[1];\n};\n\nconst generateJsonSchemaToFormValue = (type: ViewVariableType, value: any) => {\n  if (isUndefined(value)) {\n    return value;\n  }\n  let temp = value;\n  // timbre\n  if (ViewVariableType.isVoiceType(type)) {\n    temp = getFormSchemaVoiceId(temp);\n    // if (!force && !temp) {\n    //   temp = '';\n    // }\n    // Files other than timbre\n  } else if (ViewVariableType.isFileType(type)) {\n    if (ViewVariableType.isArrayType(type)) {\n      temp = temp?.map(getFormSchemaFileUrl);\n      // For files, if the array is empty, it should be empty\n      if (!temp?.length) {\n        // temp = force ? undefined : [];\n        temp = undefined;\n      }\n    } else {\n      temp = getFormSchemaFileUrl(temp);\n      // if (!force && !temp) {\n      //   temp = '';\n      // }\n    }\n  }\n  // Complex types such as objects and arrays require serialization\n  if (\n    type === ViewVariableType.Object ||\n    type >= ViewVariableType.ArrayString\n  ) {\n    temp = JSON.stringify(temp, undefined, 2);\n  }\n  return temp;\n};\n\ninterface ToValuesOptions {\n  mode: 'json' | 'form';\n  originFormSchema: IFormSchema;\n  formValues: any;\n  /** Whether to force the use of cacheData data */\n  force?: boolean;\n}\n\nexport const formatValues = ({\n  mode,\n  originFormSchema,\n  formValues,\n}: ToValuesOptions) => {\n  if (mode === 'form' || !formValues) {\n    return formValues;\n  }\n  const jsonValues = safeJsonParse(\n    formValues?.[TestFormFieldName.Node]?.[TestFormFieldName.JSON],\n  );\n  const nodeField = originFormSchema.properties?.[TestFormFieldName.Node];\n  const nodeProperties = nodeField?.properties;\n  if (!jsonValues || !nodeProperties) {\n    return formValues;\n  }\n\n  const formatJsonValues: Record<string, any> = {};\n  visitNodeLeaf(nodeProperties, (groupKey, key, field) => {\n    const groupValues = formatJsonValues[groupKey] || {};\n    groupValues[key] = generateJsonSchemaToFormValue(\n      field['x-origin-type'] || ('' as any),\n      jsonValues?.[groupKey]?.[key],\n    );\n    formatJsonValues[groupKey] = groupValues;\n  });\n  formValues[TestFormFieldName.Node] = formatJsonValues;\n  return formValues;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { isUndefined, isString, get, isObject, set } from 'lodash-es';\nimport {\n  type IFormSchema,\n  TestFormFieldName,\n} from '@coze-workflow/test-run-next';\nimport { ViewVariableType } from '@coze-workflow/base';\n\nimport { visitNodeLeaf } from './visit-node-leaf';\nimport { formatValues } from './format-values';\n\nconst isEmpty = (v: any) => {\n  if (isUndefined(v)) {\n    return true;\n  }\n  if (isString(v) && (v === '' || v === '[]' || v === '{}')) {\n    return true;\n  }\n  return false;\n};\n\ninterface MergeFormValuesOptions {\n  mode: 'json' | 'form';\n  originFormSchema: IFormSchema;\n  prevValues?: any;\n  nextValues?: any;\n  ai?: boolean;\n  cover?: boolean;\n}\n\nexport const mergeFormValues = (options: MergeFormValuesOptions) => {\n  const { mode, originFormSchema, prevValues, nextValues, ai, cover } = options;\n  const preFormattedValues = formatValues({\n    originFormSchema,\n    formValues: prevValues,\n    mode,\n  });\n  const finialValues = {};\n  const getValue = (path: string[], type: ViewVariableType) => {\n    const prev = get(preFormattedValues, path);\n    let next = get(nextValues, path);\n    if (isObject(next)) {\n      next = JSON.stringify(next, undefined, 2);\n    }\n    // AI scene to discard file type\n    if (ai && ViewVariableType.isFileType(type)) {\n      return prev;\n    }\n    /**\n     * 1. If it is null, overwrite it directly\n     * 2. If it is mandatory coverage, it is also directly covered.\n     */\n    if (isEmpty(prev) || cover) {\n      return next;\n    }\n    return prev;\n  };\n\n  Object.entries(originFormSchema.properties || {}).forEach(\n    ([parentKey, parent]) => {\n      if (parentKey !== TestFormFieldName.Node) {\n        finialValues[parentKey] =\n          nextValues?.[parentKey] || prevValues?.[parentKey];\n        return;\n      }\n      visitNodeLeaf(parent.properties, (groupKey, key, field) => {\n        const next = getValue(\n          [parentKey, groupKey, key],\n          field['x-origin-type'] as any,\n        );\n        set(finialValues, [parentKey, groupKey, key], next);\n      });\n    },\n  );\n  return finialValues;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { get, set } from 'lodash-es';\nimport {\n  type IFormSchema,\n  TestFormFieldName,\n} from '@coze-workflow/test-run-next';\n\nimport { visitNodeLeaf } from './visit-node-leaf';\nimport { getJsonModeFieldDefaultValue } from './get-json-mode-field-default-value';\n\nexport const toJsonValues = (\n  schema: IFormSchema,\n  values?: Record<string, any>,\n) => {\n  if (!values) {\n    return values;\n  }\n  const jsonValue = get(values, TestFormFieldName.Node);\n  /** If it cannot be parsed normally, it will be ignored directly. */\n  if (!jsonValue) {\n    return values;\n  }\n  const formatJsonValue: Record<string, any> = {};\n  const nodeFieldProperties =\n    schema.properties?.[TestFormFieldName.Node]?.properties;\n  visitNodeLeaf(nodeFieldProperties, (groupKey, key, field) => {\n    const groupValues = formatJsonValue[groupKey] || {};\n    groupValues[key] = getJsonModeFieldDefaultValue(\n      field['x-origin-type'] as any,\n      get(jsonValue, [groupKey, key]),\n    );\n    formatJsonValue[groupKey] = groupValues;\n  });\n  set(values, TestFormFieldName.Node, {\n    [TestFormFieldName.JSON]: JSON.stringify(formatJsonValue, undefined, 2),\n  });\n  return values;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-empty-catch */\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport dayjs from 'dayjs';\nimport {\n  type IFormSchema,\n  TestFormFieldName,\n} from '@coze-workflow/test-run-next';\nimport { FormItemSchemaType } from '@coze-workflow/test-run';\nimport { ViewVariableType } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { ComponentType } from '@coze-arch/bot-api/debugger_api';\nimport { debuggerApi } from '@coze-arch/bot-api';\nimport { Toast } from '@coze-arch/coze-design';\n\nimport { type WorkflowNodeEntity } from '@/test-run-kit';\n\nimport { TESTSET_BOT_NAME } from '../../constants';\n\ninterface TrySaveTestsetOptions {\n  schema: IFormSchema;\n  node: WorkflowNodeEntity;\n  workflowId: string;\n  bizCtx: any;\n  values: any;\n  bot: any;\n}\n\nconst CASE_NAME_DUPLICATE = 600303204;\n\nconst variableType2TestsetType = (type: ViewVariableType) => {\n  if (ViewVariableType.isArrayType(type)) {\n    return FormItemSchemaType.LIST;\n  }\n  switch (type) {\n    case ViewVariableType.String:\n      return FormItemSchemaType.STRING;\n    case ViewVariableType.Boolean:\n      return FormItemSchemaType.BOOLEAN;\n    case ViewVariableType.Integer:\n      return FormItemSchemaType.INTEGER;\n    case ViewVariableType.Number:\n      return FormItemSchemaType.NUMBER;\n    default:\n      return FormItemSchemaType.OBJECT;\n  }\n};\n\nconst genDefaultCaseName = () =>\n  I18n.t('workflow_testset_creation_time', {\n    xxx: dayjs().format('YYYY_MM_DD HH_mm_ss'),\n  });\n\nconst checkName = async (data: any) => {\n  let count = 0;\n  let caseName = genDefaultCaseName();\n\n  const check = async () => {\n    const res = await debuggerApi.CheckCaseDuplicate({\n      ...data,\n      caseName,\n    });\n\n    if (res.failCode === CASE_NAME_DUPLICATE && count < 1) {\n      count++;\n      caseName = `${caseName}_1`;\n\n      return await check();\n    } else {\n      return res;\n    }\n  };\n\n  try {\n    const res = await check();\n    return {\n      ...res,\n      caseName,\n    };\n  } catch (err) {\n    return {\n      isPass: false,\n      caseName,\n    };\n  }\n};\n\nexport const trySaveTestset = async (options: TrySaveTestsetOptions) => {\n  const { schema, node, workflowId, bizCtx, values, bot } = options;\n  const inputProperties =\n    schema.properties?.[TestFormFieldName.Node]?.properties?.[\n      TestFormFieldName.Input\n    ]?.properties;\n  if (!inputProperties) {\n    return;\n  }\n  const inputFields = Object.entries(inputProperties || {}).map(\n    ([key, value]) => ({\n      name: key,\n      required: value.required,\n      value: values[key],\n      type: variableType2TestsetType(value['x-origin-type'] as any),\n    }),\n  );\n  const input = {\n    component_id: node?.id,\n    component_type: ComponentType.CozeStartNode,\n    inputs: inputFields,\n  };\n  const inputs = [input];\n  if (bot) {\n    inputs.push({\n      component_id: `${ComponentType.CozeVariableBot}`,\n      component_type: ComponentType.CozeVariableBot,\n      inputs: [\n        {\n          name: TESTSET_BOT_NAME,\n          required: true,\n          type: FormItemSchemaType.BOT,\n          value: bot,\n        },\n      ],\n    });\n  }\n\n  try {\n    const { caseName, isPass, failReason, failCode } = await checkName({\n      bizCtx,\n      bizComponentSubject: {\n        componentID: node?.id,\n        componentType: ComponentType.CozeStartNode,\n        parentComponentID: workflowId,\n        parentComponentType: ComponentType.CozeWorkflow,\n      },\n    });\n\n    if (!isPass) {\n      Toast.error({\n        content:\n          failCode === CASE_NAME_DUPLICATE\n            ? I18n.t('workflow_testset_name_duplicated')\n            : failReason,\n        duration: 2,\n      });\n\n      return {\n        checkError: true,\n      };\n    }\n\n    debuggerApi.SaveCaseData({\n      bizCtx,\n      bizComponentSubject: {\n        componentID: node?.id,\n        componentType: ComponentType.CozeStartNode,\n        parentComponentID: workflowId,\n        parentComponentType: ComponentType.CozeWorkflow,\n      },\n      caseBase: {\n        name: caseName,\n        input: JSON.stringify(inputs),\n      },\n    });\n  } catch {\n    // No need to deal with\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createRoot } from 'react-dom/client';\n\nexport const renderDom = <T extends {}>(\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  Comp: React.ComponentType<T>,\n  props: T,\n) => {\n  const dom = document.createElement('span');\n  const root = createRoot(dom);\n  root.render(<Comp {...props} />);\n\n  return {\n    dom,\n    root,\n    destroy() {\n      root.unmount();\n    },\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport { type Root } from 'react-dom/client';\nimport { useRequest } from 'ahooks';\nimport { type VoiceDetail } from '@coze-arch/bot-api/multimedia_api';\nimport { MultimediaApi } from '@coze-arch/bot-api';\nimport { useAudioPlayer } from '@coze-workflow/resources-adapter';\nimport { IconCozVolume, IconCozPauseFill } from '@coze-arch/coze-design/icons';\nimport { Avatar, Spin } from '@coze-arch/coze-design';\nimport { type EditorView, WidgetType } from '@codemirror/view';\nimport { EditorSelection } from '@codemirror/state';\n\nimport { renderDom } from './render-dom';\n\nimport css from './voice-widget.module.less';\n\ninterface VoiceDisplayProps {\n  voiceId: string;\n  onClick: () => void;\n}\n\nconst useVoiceSource = (id?: string) => {\n  const [voice, setVoice] = useState<VoiceDetail | null | undefined>(null);\n\n  const { loading } = useRequest(\n    () => {\n      if (!id) {\n        return Promise.resolve(null).then(() => {\n          setVoice(null);\n          return null;\n        });\n      }\n\n      return MultimediaApi.APIMGetVoice({\n        voice_ids: [id],\n      })\n        .then(data => {\n          const v = data?.data?.voices?.[0];\n          setVoice(data?.data?.voices?.[0]);\n          return v;\n        })\n        .catch(() => {\n          setVoice(null);\n          return null;\n        });\n    },\n    {\n      refreshDeps: [id],\n    },\n  );\n\n  return {\n    voice,\n    setVoice,\n    loading,\n  };\n};\n\nconst VoiceDisPlay: React.FC<VoiceDisplayProps> = ({ voiceId, onClick }) => {\n  const { voice, loading } = useVoiceSource(voiceId);\n  const { isPlaying, togglePlayPause } = useAudioPlayer(voice?.preview_audio);\n\n  return (\n    <div className={css['voice-widget']} onClick={onClick}>\n      {loading ? (\n        <Spin size=\"small\" />\n      ) : (\n        <>\n          <Avatar shape=\"square\" size=\"12px\" src={voice?.icon_url} />\n          <span className={css.name}>{voice?.voice_name}</span>\n          {isPlaying ? (\n            <IconCozPauseFill className={css.icon} onClick={togglePlayPause} />\n          ) : (\n            <IconCozVolume className={css.icon} onClick={togglePlayPause} />\n          )}\n        </>\n      )}\n    </div>\n  );\n};\n\ninterface VoiceWidgetOptions {\n  voiceId: string;\n  from: number;\n  to: number;\n}\n\nexport class VoiceWidget extends WidgetType {\n  root?: Root;\n\n  constructor(public options: VoiceWidgetOptions) {\n    super();\n  }\n\n  toDOM(view: EditorView): HTMLElement {\n    const handleClick = () => {\n      const { from, to } = this.options;\n      view.dispatch({\n        selection: EditorSelection.range(from, to),\n      });\n    };\n    const { root, dom } = renderDom<VoiceDisplayProps>(VoiceDisPlay, {\n      voiceId: this.options.voiceId,\n      onClick: handleClick,\n    });\n    this.root = root;\n    return dom;\n  }\n\n  getEqKey() {\n    return [this.options.voiceId].join('');\n  }\n\n  eq(prev) {\n    return prev.getEqKey() === this.getEqKey();\n  }\n\n  destroy(): void {\n    this.root?.unmount();\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const TEST_RUN_FILE_NAME_KEY = 'x-wf-file_name';\nexport const TEST_RUN_FILE_UPLOADING_KEY = 'x-wf-file_uploading';\n\nexport const generateFileInfo = (formatUrl: string) => {\n  const url = new URL(formatUrl);\n  const params = new URLSearchParams(url.search);\n  const fileName = params.get(TEST_RUN_FILE_NAME_KEY) ?? '';\n  const uploading = params.get(TEST_RUN_FILE_UPLOADING_KEY);\n\n  return {\n    url: formatUrl,\n    name: fileName,\n    uploading,\n  };\n};\nexport const generateUrlWithFilename = (url: string, name?: string) => {\n  if (!name || !url) {\n    return url;\n  }\n  try {\n    const urlObj = new URL(url);\n    const params = new URLSearchParams(urlObj.search);\n\n    if (params.has(TEST_RUN_FILE_NAME_KEY)) {\n      params.set(TEST_RUN_FILE_NAME_KEY, name);\n    } else {\n      params.append(TEST_RUN_FILE_NAME_KEY, name);\n    }\n\n    urlObj.search = params.toString();\n\n    return urlObj.toString();\n  } catch (e) {\n    return url;\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport { type Root } from 'react-dom/client';\nimport { FileIcon, FileItemStatus, isImageFile } from '@coze-workflow/test-run';\nimport { I18n } from '@coze-arch/i18n';\nimport { Typography, Popover, Image } from '@coze-arch/coze-design';\nimport { type EditorView, WidgetType } from '@codemirror/view';\nimport { EditorSelection } from '@codemirror/state';\n\nimport { generateFileInfo } from './utils';\nimport { renderDom } from './render-dom';\n\nimport css from './file-widget.module.less';\n\ninterface FileDisplayProps {\n  url: string;\n  onClick: () => void;\n}\n\nconst FileDisplay: React.FC<FileDisplayProps> = ({ url, onClick }) => {\n  const file = useMemo(() => generateFileInfo(url), [url]);\n\n  const isImage = isImageFile(file.name);\n\n  const el = (\n    <div className={css['file-widget']} onClick={onClick}>\n      <FileIcon\n        size={12}\n        file={{\n          ...file,\n          status: file.uploading ? FileItemStatus.Uploading : undefined,\n        }}\n      />\n      {file.uploading ? (\n        <Typography.Text strong className={css['file-name']} ellipsis>\n          {I18n.t('plugin_file_uploading')}\n        </Typography.Text>\n      ) : null}\n      {!file.uploading && (\n        <Typography.Text strong className={css['file-name']} ellipsis>\n          {file.name ?? I18n.t('plugin_file_unknown')}\n        </Typography.Text>\n      )}\n    </div>\n  );\n\n  if (isImage) {\n    return (\n      <Popover content={<Image src={file.url} width={126} />}>{el}</Popover>\n    );\n  }\n\n  return el;\n};\n\ninterface FileWidgetOptions {\n  url: string;\n  from: number;\n  to: number;\n}\n\nexport class FileWidget extends WidgetType {\n  root?: Root;\n\n  constructor(public options: FileWidgetOptions) {\n    super();\n  }\n\n  toDOM(view: EditorView): HTMLElement {\n    const handleClick = () => {\n      const { from, to } = this.options;\n      view.dispatch({\n        selection: EditorSelection.range(from, to),\n      });\n    };\n    const { root, dom } = renderDom<FileDisplayProps>(FileDisplay, {\n      url: this.options.url,\n      onClick: handleClick,\n    });\n    this.root = root;\n    return dom;\n  }\n\n  eq(prev) {\n    return prev.options.url === this.options.url;\n  }\n\n  destroy(): void {\n    this.root?.unmount();\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { useEffect, useRef } from 'react';\n\nimport { nanoid } from 'nanoid';\nimport { toString } from 'lodash-es';\nimport { useSelectVoiceModal } from '@coze-workflow/resources-adapter';\nimport { workflowApi } from '@coze-workflow/base';\nimport { type EditorAPI } from '@coze-editor/editor/preset-code';\nimport { I18n } from '@coze-arch/i18n';\nimport { upLoadFile } from '@coze-arch/bot-utils';\nimport { IconCozUpload, IconCozPlus } from '@coze-arch/coze-design/icons';\nimport { Toast, Upload } from '@coze-arch/coze-design';\nimport { EditorSelection } from '@codemirror/state';\n\nimport { validate } from '@/hooks/use-upload/validate';\nimport { MAX_IMAGE_SIZE, MAX_FILE_SIZE } from '@/hooks/use-upload/constant';\n\nimport { generateUrlWithFilename, TEST_RUN_FILE_UPLOADING_KEY } from './utils';\n\nimport css from './completion.module.less';\n\nconst upload = async (file: any, fileType: 'object' | 'image') => {\n  const uri = await upLoadFile({\n    biz: 'workflow',\n    fileType,\n    file,\n  });\n  if (!uri) {\n    throw new Error('no uri');\n  }\n  const { url } = await workflowApi.SignImageURL(\n    {\n      uri,\n    },\n    {\n      __disableErrorToast: true,\n    },\n  );\n  if (!url) {\n    throw new Error(I18n.t('imageflow_upload_error'));\n  }\n  return url;\n};\n\ninterface UploadButtonProps {\n  editorRef: React.MutableRefObject<EditorAPI>;\n  position: number;\n  fileType: 'object' | 'image';\n  accept: string;\n}\n\nexport const UploadButton: React.FC<UploadButtonProps> = ({\n  editorRef,\n  position,\n  fileType,\n  accept,\n}) => {\n  const ref = useRef<any>(null);\n  const changeEditor = (insert: string, from: number, to: number) => {\n    if (!editorRef.current?.$view) {\n      return;\n    }\n\n    editorRef.current.$view.dispatch({\n      changes: {\n        from,\n        to,\n        insert,\n      },\n      selection: EditorSelection.range(\n        position + insert.length,\n        position + insert.length,\n      ),\n      effects: [],\n    });\n  };\n\n  const getFrom = (str: string) => {\n    if (!editorRef.current?.$view) {\n      return -1;\n    }\n    const fullText = editorRef.current.$view.state.doc.toString();\n    return fullText.indexOf(str);\n  };\n\n  const handleUpload = async file => {\n    const loadingFlag = `<#file:https:loading?${TEST_RUN_FILE_UPLOADING_KEY}=${nanoid()}#>`;\n    changeEditor(loadingFlag, position, position);\n    const { fileInstance } = file;\n    const validateMsg = await validate(fileInstance, {\n      maxSize: fileType === 'image' ? MAX_IMAGE_SIZE : MAX_FILE_SIZE,\n      accept,\n    });\n    if (validateMsg) {\n      Toast.error(validateMsg);\n      const from = getFrom(loadingFlag);\n      if (from > -1) {\n        changeEditor('', from, from + loadingFlag.length);\n      }\n      return;\n    }\n\n    try {\n      const url = await upload(fileInstance, fileType);\n      const fileFlag = `<#file:${generateUrlWithFilename(\n        url,\n        fileInstance.name,\n      )}#>`;\n      const from = getFrom(loadingFlag);\n      if (from > -1) {\n        changeEditor(fileFlag, from, from + loadingFlag.length);\n      }\n    } catch (e) {\n      Toast.error(toString(e));\n      const from = getFrom(loadingFlag);\n      if (from > -1) {\n        changeEditor('', from, from + loadingFlag.length);\n      }\n    }\n  };\n\n  useEffect(() => {\n    setTimeout(() => {\n      editorRef.current?.disableKeybindings(['Enter']);\n    });\n\n    const openUpload = event => {\n      if (event.key === 'Enter') {\n        ref.current?.openFileDialog();\n      }\n    };\n    document.addEventListener('keydown', openUpload);\n    return () => {\n      setTimeout(() => {\n        editorRef.current?.disableKeybindings([]);\n        document.removeEventListener('keydown', openUpload);\n      });\n    };\n  }, []);\n\n  return (\n    <Upload action=\"\" accept={accept} customRequest={handleUpload} ref={ref}>\n      <div className={css['completion-item']}>\n        <IconCozUpload />\n        <span>{I18n.t('plugin_file_upload')}</span>\n      </div>\n    </Upload>\n  );\n};\n\ninterface VoiceButtonProps {\n  editorRef: React.MutableRefObject<EditorAPI>;\n  position: number;\n  spaceId: string;\n}\n\nexport const VoiceButton: React.FC<VoiceButtonProps> = ({\n  editorRef,\n  position,\n  spaceId,\n}) => {\n  const handleChange = (voiceId: string) => {\n    if (!editorRef.current?.$view) {\n      return;\n    }\n    const insert = `<#voice:${voiceId}#>`;\n    editorRef.current.$view.dispatch({\n      changes: {\n        from: position,\n        to: position,\n        insert,\n      },\n      selection: EditorSelection.range(\n        position + insert.length,\n        position + insert.length,\n      ),\n      effects: [],\n    });\n  };\n\n  const { open: openSelectVoiceModal, modal: selectVoiceModal } =\n    useSelectVoiceModal({\n      spaceId,\n      onSelectVoice: v => {\n        handleChange(v.voice_id);\n      },\n    });\n\n  useEffect(() => {\n    setTimeout(() => {\n      editorRef.current?.disableKeybindings(['Enter']);\n    });\n\n    const openUpload = event => {\n      if (event.key === 'Enter') {\n        openSelectVoiceModal();\n      }\n    };\n    document.addEventListener('keydown', openUpload);\n    return () => {\n      setTimeout(() => {\n        editorRef.current?.disableKeybindings([]);\n        document.removeEventListener('keydown', openUpload);\n      });\n    };\n  }, []);\n\n  return (\n    <>\n      <div className={css['completion-item']} onClick={openSelectVoiceModal}>\n        <IconCozPlus />\n        <span>{I18n.t('workflow_variable_select_voice')}</span>\n      </div>\n      {selectVoiceModal}\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable max-params */\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { isNumber } from 'lodash-es';\nimport {\n  type IFormSchema,\n  TestFormFieldName,\n} from '@coze-workflow/test-run-next';\nimport { ViewVariableType } from '@coze-workflow/base';\nimport regexpDecorator from '@coze-editor/extension-regexp-decorator';\nimport jsonUnnecessaryProperties from '@coze-editor/extension-json-unnecessary-properties';\nimport jsonHover from '@coze-editor/extension-json-hover';\nimport jsonEmptyStringValueCompletion from '@coze-editor/extension-json-empty-string-value-completion';\nimport { I18n } from '@coze-arch/i18n';\nimport { Typography, Tag } from '@coze-arch/coze-design';\nimport { Decoration } from '@codemirror/view';\n\nimport { VoiceWidget } from './voice-widget';\nimport { renderDom } from './render-dom';\nimport { FileWidget } from './file-widget';\nimport { UploadButton, VoiceButton } from './completion';\n\nimport css from './key-hover.module.less';\n\ninterface KeyHoverPopoverValue {\n  title?: string;\n  required?: boolean;\n  tag?: string;\n  description?: string;\n}\n\nconst generateHoverMap = (properties: IFormSchema['properties']) => {\n  const map = {};\n  const GROUP_MAP: Record<string, KeyHoverPopoverValue> = {\n    [TestFormFieldName.Input]: {\n      title: I18n.t('wf_testrun_form_json_group_input'),\n      description: I18n.t('wf_testrun_form_json_group_input_extra'),\n    },\n    [TestFormFieldName.Batch]: {\n      title: I18n.t('wf_testrun_form_json_group_batch'),\n      description: I18n.t('wf_testrun_form_json_group_batch_extra'),\n    },\n    [TestFormFieldName.Setting]: {\n      title: I18n.t('wf_testrun_form_json_group_settings'),\n      description: I18n.t('wf_testrun_form_json_group_settings_extra'),\n    },\n  };\n  Object.entries(properties || {}).forEach(([groupKey, group]) => {\n    map[groupKey] = GROUP_MAP[groupKey];\n    Object.entries(group.properties || {}).forEach(([key, field]) => {\n      map[`${groupKey}.${key}`] = {\n        title: field.title || key,\n        description: field.description,\n        required: field.required,\n        tag: field['x-decorator-props']?.tag,\n        type: field['x-origin-type'],\n        props: field['x-component-props'],\n      };\n    });\n  });\n  return map;\n};\n\nconst KeyHoverPopover: React.FC<KeyHoverPopoverValue> = ({\n  title,\n  required,\n  tag,\n  description,\n}) => (\n  <div className={css['key-hover']}>\n    {title ? (\n      <div className={css.label}>\n        {\n          <Typography.Text size=\"small\" strong>\n            {title}\n          </Typography.Text>\n        }\n        {required ? <span className={css.asterisk}>*</span> : null}\n        {tag ? (\n          <Tag size=\"mini\" color=\"primary\">\n            {tag}\n          </Tag>\n        ) : null}\n      </div>\n    ) : null}\n    {description ? (\n      <Typography.Text size=\"small\" type=\"secondary\" style={{ maxWidth: 200 }}>\n        {description}\n      </Typography.Text>\n    ) : null}\n  </div>\n);\n\ninterface GetExtensionsOptions {\n  properties: IFormSchema['properties'];\n  spaceId: string;\n  editorRef: any;\n}\n\nexport const getExtensions = ({\n  properties,\n  spaceId,\n  editorRef,\n}: GetExtensionsOptions) => {\n  const map = generateHoverMap(properties);\n\n  return [\n    jsonHover({\n      key({ paths }) {\n        const value = map[paths.join('.')];\n        if (!value && paths.length > 2) {\n          return undefined;\n        }\n        return renderDom(\n          KeyHoverPopover,\n          value ?? {\n            description: I18n.t('wf_testrun_form_json_key_hover_no'),\n          },\n        );\n      },\n    }),\n    jsonUnnecessaryProperties(({ paths }) => {\n      if (paths.length > 2) {\n        return false;\n      }\n      return !map[paths.join('.')];\n    }),\n    regexpDecorator({\n      regexp: /<#file:(https?:.+)#>/g,\n      decorate(add, from, to, matches) {\n        add(\n          from,\n          to,\n          Decoration.replace({\n            widget: new FileWidget({ url: matches[1], from, to }),\n            atomicRange: true,\n            selectable: true,\n          }),\n        );\n      },\n    }),\n    regexpDecorator({\n      regexp: /<#voice:(\\d+)#>/g,\n      decorate(add, from, to, matches) {\n        add(\n          from,\n          to,\n          Decoration.replace({\n            widget: new VoiceWidget({\n              voiceId: matches[1],\n              from,\n              to,\n            }),\n            atomicRange: true,\n            selectable: true,\n          }),\n        );\n      },\n    }),\n    jsonEmptyStringValueCompletion(({ paths, position }) => {\n      const key = isNumber(paths[paths.length - 1])\n        ? paths.slice(0, -1).join('.')\n        : paths.join('.');\n      const val = map[key];\n      if (val?.type && ViewVariableType.isVoiceType(val.type)) {\n        return renderDom(VoiceButton, {\n          editorRef,\n          position,\n          spaceId,\n        });\n      }\n      if (val?.type && ViewVariableType.isFileType(val.type)) {\n        return renderDom(UploadButton, {\n          editorRef,\n          position,\n          ...val.props,\n        });\n      }\n    }),\n  ] as any[];\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useTestRunFormStore } from '@coze-workflow/test-run-next';\nimport { I18n } from '@coze-arch/i18n';\nimport { Switch } from '@coze-arch/coze-design';\n\nimport css from './mode-switch.module.less';\n\nexport const ModeSwitch: React.FC<{\n  disabled?: boolean;\n}> = ({ disabled }) => {\n  const { mode, patch } = useTestRunFormStore(s => ({\n    mode: s.mode,\n    patch: s.patch,\n  }));\n\n  const handleChange = (next: boolean) => {\n    patch({ mode: next ? 'json' : 'form' });\n  };\n\n  return (\n    <div className={css['mode-switch']}>\n      {I18n.t('wf_testrun_form_mode_text')}\n      <Switch\n        size=\"mini\"\n        disabled={disabled}\n        checked={mode === 'json'}\n        onChange={handleChange}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState, useMemo } from 'react';\n\nimport { debounce } from 'lodash-es';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { CONVERSATION_NAME, workflowApi } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { Typography, Select } from '@coze-arch/coze-design';\nimport { CreateMethod, CreateEnv } from '@coze-arch/bot-api/workflow_api';\n\nimport { ChatflowService } from '@/services';\n\nimport {\n  useGetStartNode,\n  useGetStartNodeOutputs,\n} from '../test-run/hooks/use-get-start-node';\nimport { type ValueType } from '../bot-project-select/types';\nimport { useGlobalState } from '../../hooks';\n\nimport styles from './bots.module.less';\n\nconst MAX_LIMIT = 1000;\n\nconst RenderCustomOption = item => {\n  if (!item) {\n    return null;\n  }\n  return (\n    <Select.Option\n      value={item.value}\n      showTick={true}\n      key={item.value}\n      className={styles['bot-option']}\n    >\n      <div className=\"flex\" style={{ width: '100%' }}>\n        <div className=\"flex\" style={{ flexGrow: 1, flexShrink: 1, width: 0 }}>\n          <Typography.Text\n            ellipsis={{ showTooltip: true }}\n            style={{\n              fontSize: 12,\n              color: '#1D1C23',\n              fontWeight: 400,\n            }}\n          >\n            {item.label}\n          </Typography.Text>\n        </div>\n      </div>\n    </Select.Option>\n  );\n};\ninterface ConversationsProps {\n  enableTypes?: 'static' | 'dynamic'[];\n  value?: string;\n  onChange?: (value: string) => void;\n  projectId?: string | ValueType;\n}\n\ninterface ConversationItem {\n  value: string;\n  label: string;\n  conversationId: string;\n}\n\nexport const Conversations: React.FC<ConversationsProps> = ({\n  enableTypes = ['static', 'dynamic'],\n  value,\n  onChange,\n  projectId: propsProjectId,\n  ...props\n}) => {\n  const globalState = useGlobalState();\n  const { getNode } = useGetStartNode();\n  const startNode = getNode();\n\n  const DebounceTime = 500;\n  const chatflowService = useService<ChatflowService>(ChatflowService);\n\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [search, setSearch] = useState<string>('');\n  const [staticList, setStaticList] = useState<\n    ConversationItem[] | undefined\n  >();\n  const [dynamicList, setDynamicList] = useState<\n    ConversationItem[] | undefined\n  >();\n  const [fetchingProjectId, setFetchingProjectId] = useState('');\n  const projectId =\n    (propsProjectId as ValueType)?.id ||\n    (propsProjectId as string) ||\n    globalState.projectId ||\n    '';\n\n  // The total number obtained by the interface is not the real total, and the front end may splice options.\n  const listMaxHeight = useMemo(() => {\n    const realTotal = (staticList?.length || 0) + (dynamicList?.length || 0);\n    // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n    return realTotal < 7 ? realTotal * 32 : 208;\n  }, [staticList, dynamicList]);\n\n  const handleChange = (newValue: string, findItem?: ConversationItem) => {\n    if (findItem) {\n      chatflowService.setSelectConversationItem(findItem);\n    }\n    onChange?.(newValue);\n  };\n  const { getStartNodeOutputs } = useGetStartNodeOutputs();\n\n  const initFn = async () => {\n    const list = await fetchList();\n    // Get the data from the start node to set the initial value\n    if (startNode && !value) {\n      const outputs = getStartNodeOutputs();\n      const defaultName =\n        outputs.find(output => output.name === CONVERSATION_NAME)\n          ?.defaultValue || '';\n      const findItem = list.find(item => item.label === defaultName);\n      // The conversation_name of the start node is selected by default, if not, Default default session is selected by default\n      handleChange(findItem?.value || list[0]?.value, findItem || list[0]);\n    }\n  };\n\n  useEffect(() => {\n    if (projectId) {\n      initFn();\n    }\n  }, [projectId]);\n\n  useEffect(() => {\n    // Lock to ensure that the current list content is consistent with the incoming projectId, and then search for the corresponding item from the list\n    // Initialize any list without getting ready for follow-up logic\n    if (fetchingProjectId !== projectId || !staticList || !dynamicList) {\n      return;\n    }\n    const findItem = [...staticList, ...dynamicList].find(\n      item => item.value === value,\n    );\n    if (\n      value &&\n      findItem?.value !== chatflowService.selectConversationItem?.value\n    ) {\n      chatflowService.setSelectConversationItem(findItem);\n    }\n  }, [value, staticList, dynamicList]);\n\n  const fetchList = async (query?: string) => {\n    setIsLoading(true);\n    let staticRes: ConversationItem[] = [];\n    let dynamicRes: ConversationItem[] = [];\n    setFetchingProjectId(projectId);\n\n    if (enableTypes.includes('static')) {\n      const staticListRes = await workflowApi.ListProjectConversationDef({\n        space_id: globalState.spaceId,\n        project_id: projectId,\n        project_version: globalState.projectCommitVersion,\n        create_method: CreateMethod.ManualCreate,\n        create_env: CreateEnv.Draft,\n        nameLike: query ?? search,\n        limit: MAX_LIMIT,\n      });\n      staticRes =\n        staticListRes.data?.map(item => ({\n          value: item.unique_id || '',\n          label: item.conversation_name || '',\n          conversationId: item.conversation_id || '',\n        })) || [];\n      setStaticList(staticRes);\n    }\n    if (enableTypes.includes('dynamic')) {\n      const dynamicListRes = await workflowApi.ListProjectConversationDef({\n        space_id: globalState.spaceId || '',\n        project_id: projectId,\n        project_version: globalState.projectCommitVersion,\n        create_method: CreateMethod.NodeCreate,\n        create_env: CreateEnv.Draft,\n        nameLike: query ?? search,\n        limit: MAX_LIMIT,\n      });\n      dynamicRes =\n        dynamicListRes.data?.map(item => ({\n          value: item.unique_id || '',\n          label: item.conversation_name || '',\n          conversationId: item.conversation_id || '',\n        })) || [];\n      setDynamicList(dynamicRes);\n    }\n    setIsLoading(false);\n    return [...staticRes, ...dynamicRes];\n  };\n\n  const handleSearch = query => {\n    setSearch(query);\n    fetchList(query);\n  };\n\n  return (\n    <Select\n      value={value}\n      dropdownClassName={styles.dropdown}\n      filter\n      remote\n      placeholder={I18n.t('wf_chatflow_114')}\n      emptyContent={I18n.t('wf_chatflow_115')}\n      onSearch={debounce(handleSearch, DebounceTime)}\n      loading={isLoading}\n      style={{ width: '100%' }}\n      virtualize={{\n        height: listMaxHeight,\n        width: '100%',\n        itemSize: 32,\n      }}\n      onChange={newValue => {\n        const findItem = [...(staticList || []), ...(dynamicList || [])].find(\n          item => item.value === newValue,\n        );\n        handleChange(newValue as string, findItem);\n      }}\n      {...props}\n    >\n      <Select.OptGroup\n        key={Number(new Date())}\n        label={I18n.t('wf_chatflow_103')}\n      >\n        {(staticList || []).map(item => RenderCustomOption(item))}\n      </Select.OptGroup>\n      <Select.OptGroup\n        key={Number(new Date())}\n        label={I18n.t('wf_chatflow_43')}\n      >\n        {(dynamicList || []).map(item => RenderCustomOption(item))}\n      </Select.OptGroup>\n    </Select>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { withField } from '@coze-arch/bot-semi';\n\nimport { Conversations } from './conversations';\n\ninterface ConversationSelectProps {\n  value?: string;\n  onChange?: (value: string) => void;\n}\n\nexport const ConversationSelect: React.FC<ConversationSelectProps> = ({\n  value,\n  onChange,\n  ...props\n}) => <Conversations value={value} onChange={onChange} {...props} />;\n\nexport const ConversationSelectWithField = withField(ConversationSelect, {\n  valueKey: 'value',\n  onKeyChangeFnName: 'onChange',\n});\n\nConversationSelectWithField.defaultProps = {\n  fieldStyle: { overflow: 'visible' },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type Variable } from '@coze-arch/bot-api/playground_api';\n\nimport { TagList } from '../tag-list';\n\ninterface VariablesProps {\n  variables: Variable[];\n}\n\nexport const Variables: React.FC<VariablesProps> = ({ variables }) => {\n  const tagList = variables.map(({ key }) => key ?? '');\n\n  return <TagList tags={tagList} max={5} />;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type Variable } from '@coze-arch/bot-api/playground_api';\n\nimport { transformBotInfo, useBotInfo } from './use-bot-info';\n\nexport const useVariables = (botID?: string) => {\n  const { botInfo, isLoading } = useBotInfo(botID);\n  const variables: Variable[] | undefined = transformBotInfo.variable(botInfo);\n\n  return {\n    variables,\n    isLoading,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type BotTable, BotTableRWMode } from '@coze-arch/bot-api/memory';\n\nimport { transformBotInfo, useBotInfo } from './use-bot-info';\n\n// In multiplayer mode, the product hopes that the front-end will display uuid & id. At present, these two fields will be filtered by the back-end. The front-end will supplement these two fields first, and the back-end will fully evaluate and then remove the filtering logic.\nfunction addUidAndIdToBotFieldsIfIsUnlimitedReadWriteMode(\n  tableInfo: BotTable[],\n): BotTable[] {\n  tableInfo.forEach(bot => {\n    if (\n      bot.rw_mode === BotTableRWMode.UnlimitedReadWrite &&\n      (bot?.field_list?.length as number) > 0\n    ) {\n      ['id', 'uuid'].forEach(name => {\n        const fieldExisted = !!bot.field_list?.find(\n          field => field.name === name,\n        );\n        if (!fieldExisted) {\n          bot.field_list?.unshift({ name });\n        }\n      });\n    }\n  });\n\n  return tableInfo;\n}\n\nexport const useTableInfo = (botID?: string) => {\n  const { isLoading, botInfo } = useBotInfo(botID);\n  let tableInfo: BotTable[] | undefined;\n  tableInfo = transformBotInfo.database(botInfo);\n  if (tableInfo) {\n    tableInfo = addUidAndIdToBotFieldsIfIsUnlimitedReadWriteMode(tableInfo);\n  }\n\n  return { tableInfo, isLoading };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useProjectInfo } from './use-project-info';\n\nexport const useProjectVariables = (projectID?: string) => {\n  const { variableList, isLoading } = useProjectInfo(projectID);\n\n  return {\n    variables: variableList,\n    isLoading,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport get from 'lodash-es/get';\nimport { TimeCapsuleMode } from '@coze-arch/idl/playground_api';\n\nimport { useBotInfo } from './use-bot-info';\n\nexport const useLTMInfo = (botId?: string) => {\n  const { isLoading, botInfo } = useBotInfo(botId);\n  const timeCapsuleMode = get(\n    botInfo,\n    ['bot_info', 'bot_tag_info', 'time_capsule_info', 'time_capsule_mode'],\n    TimeCapsuleMode.Off,\n  );\n\n  return {\n    // Is long-term memory switched on?\n    ltmEnabled: timeCapsuleMode === TimeCapsuleMode.On,\n    isLoading,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useQuery } from '@tanstack/react-query';\nimport { Scene } from '@coze-arch/bot-api/developer_api';\nimport { DeveloperApi } from '@coze-arch/bot-api';\n\nimport { transformBotInfo, useBotInfo } from './use-bot-info';\n\nconst MAX_ROUND_COUNT = 20;\nconst getMessageList = async ({\n  botId,\n  botCount,\n}: {\n  botId: string;\n  botCount: number;\n}) => {\n  const totalRound = Math.ceil(botCount / MAX_ROUND_COUNT);\n\n  let cursor = '0';\n  let round = 0;\n  let conversationId = '';\n  let sectionId = '';\n\n  let messageList: { role: string; content: string }[] = [];\n  while (round < totalRound) {\n    const res = await DeveloperApi.GetMessageList({\n      bot_id: botId,\n      draft_mode: true,\n      scene: Scene.Playground,\n\n      cursor,\n      count: Math.min(botCount - round * MAX_ROUND_COUNT, MAX_ROUND_COUNT),\n    });\n\n    messageList = [\n      ...messageList,\n      ...res.message_list\n        .filter(item => item.type === 'question' || item.type === 'answer')\n        .map(item => ({\n          role: item?.role as string,\n          content: item?.content as string,\n        })),\n    ];\n\n    conversationId = res?.connector_conversation_id || '';\n    sectionId = res?.last_section_id || '';\n    cursor = res?.cursor;\n    round += 1;\n\n    if (!res.hasmore) {\n      break;\n    }\n  }\n\n  return { messageList, conversationId, sectionId };\n};\n\nexport const useChatHistory = (botId?: string) => {\n  const { botInfo, isLoading: isBotInfoLoading } = useBotInfo(botId);\n\n  const botCount =\n    transformBotInfo.model(botInfo)?.short_memory_policy?.history_round ?? 0;\n\n  const { isLoading: isMessageLoading, data } = useQuery({\n    queryKey: ['bot_info', botId, botCount],\n    queryFn: () =>\n      getMessageList({\n        botId: botId as string,\n        botCount,\n      }),\n    enabled: botCount !== undefined,\n  });\n\n  const { messageList, conversationId, sectionId } = data || {};\n\n  return {\n    chatHistory: messageList?.length\n      ? {\n          chatHistory: messageList,\n        }\n      : null,\n    isLoading: isBotInfoLoading || isMessageLoading,\n    conversationId,\n    sectionId,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Table } from '@coze-arch/bot-semi';\nimport { type BotTable } from '@coze-arch/bot-api/memory';\n\nimport { TagList } from '../tag-list';\n\nimport styles from './table-info.module.less';\n\ninterface TableInfoProps {\n  data?: BotTable[];\n}\n\nexport const TableInfo: React.FC<TableInfoProps> = ({\n  data = [{ table_name: 'none' }],\n}) => {\n  const columns = [\n    {\n      title: I18n.t('db_add_table_name'),\n      dataIndex: 'table_name',\n      render: (text: string) => <span>{text}</span>,\n    },\n    {\n      title: I18n.t('db_add_table_field_name'),\n      dataIndex: 'field_list',\n      render: (fieldList: BotTable['field_list']) => {\n        if (fieldList && fieldList.length > 0) {\n          return (\n            <TagList\n              tags={(fieldList ?? []).map(({ name }) => name || '')}\n              max={3}\n            />\n          );\n        }\n\n        return 'none';\n      },\n    },\n  ];\n\n  return (\n    <Table\n      className={styles.table}\n      columns={columns}\n      dataSource={data}\n      pagination={false}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type PropsWithChildren } from 'react';\n\nimport styles from './item.module.less';\n\ninterface ItemProps {\n  label: string;\n  defaultText?: string;\n  hideLabel?: boolean;\n}\n\nexport const Item: React.FC<PropsWithChildren<ItemProps>> = ({\n  children,\n  label,\n  defaultText,\n  hideLabel = false,\n}) => {\n  const haveChildren = !!children;\n  const showDefaultText = !haveChildren && !!defaultText;\n  const showLabel = !hideLabel && !showDefaultText;\n\n  return (\n    <div className={styles.container}>\n      {showLabel ? <div className={styles.label}>{label}</div> : null}\n      {showDefaultText ? (\n        <div className={styles['default-text']}>{defaultText}</div>\n      ) : null}\n      {children}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { JsonViewer } from '@coze-common/json-viewer';\n\nimport styles from './chat-history.module.less';\n\ninterface Props {\n  data: object | null;\n}\n\nexport const ChatHistory: FC<Props> = ({ data }) => (\n  <JsonViewer data={data} className={styles['json-viewer']} />\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable complexity */\nimport React from 'react';\n\nimport { useMount } from 'ahooks';\nimport { IntelligenceType } from '@coze-arch/idl/intelligence_api';\nimport { I18n } from '@coze-arch/i18n';\nimport { withField } from '@coze-arch/bot-semi';\n\nimport { Variables } from './variables';\nimport { useVariables } from './use-variables';\nimport { useTableInfo } from './use-table-info';\nimport { useProjectVariables } from './use-project-variables';\nimport { useLTMInfo } from './use-ltm-info';\nimport { useChatHistory } from './use-chat-history';\nimport { type ValueType } from './types';\nimport { TableInfo } from './table-info';\nimport { Item } from './item';\nimport { ChatHistory } from './chat-history';\nimport { Bots } from './bots';\n\nimport styles from './index.module.less';\n\ninterface BotSelectProps {\n  value?: ValueType;\n  onChange?: (value?: ValueType) => void;\n  hideLabel?: boolean;\n  hideVariblesForce?: boolean;\n  hasVariableNode?: boolean;\n  hasVariableAssignNode?: boolean;\n  hasDatabaseNode?: boolean;\n  hasLTMNode?: boolean;\n  hasChatHistoryEnabledLLM?: boolean;\n\n  disableBot?: boolean;\n  disableBotTooltip?: string;\n  disableProject?: boolean;\n  disableProjectTooltip?: string;\n}\n\n/**\n * copy from bot-select\n */\nexport const BotProjectSelect: React.FC<BotSelectProps> = ({\n  value: originValue,\n  onChange,\n  hideLabel = false,\n  hideVariblesForce = false,\n  hasVariableNode = false,\n  hasVariableAssignNode = false,\n  hasDatabaseNode = false,\n  hasChatHistoryEnabledLLM = false,\n  hasLTMNode = false,\n  ...props\n}) => {\n  let value = originValue;\n  // Compatible with historical data\n  if (typeof originValue === 'string') {\n    value = {\n      id: originValue,\n      type: IntelligenceType.Bot,\n    };\n  }\n  const valueId = value?.id;\n  const isBot = value?.type === IntelligenceType.Bot;\n  const { tableInfo, isLoading: isTableInfoLoading } = useTableInfo(\n    isBot ? valueId : undefined,\n  );\n  const { variables, isLoading: isVariablesLoading } = useVariables(\n    isBot ? valueId : undefined,\n  );\n  const { variables: projectVariables, isLoading: isProjectVariablesLoading } =\n    useProjectVariables(!isBot ? valueId : undefined);\n  const {\n    chatHistory,\n    // conversationId,\n    // sectionId,\n  } = useChatHistory(isBot ? valueId : undefined);\n  const { ltmEnabled, isLoading: isLTMInfoLoading } = useLTMInfo(\n    isBot ? valueId : undefined,\n  );\n\n  const botSelected = !!valueId;\n\n  const hasVariables = variables && variables.length > 0;\n  const hasTableInfo = tableInfo && tableInfo.length > 0;\n  const hasProjectVariables = projectVariables && projectVariables?.length > 0;\n  const hasChatHistory = !!chatHistory;\n\n  const showTableInfo = botSelected && !isTableInfoLoading && hasDatabaseNode;\n  const showVariables =\n    botSelected &&\n    !isVariablesLoading &&\n    (hasVariableNode || hasVariableAssignNode) &&\n    !hideVariblesForce;\n\n  // Practice running is a temporary session, here the bot chat history display may be misleading, first hide\n  const showChatHistory = false;\n  // const showChatHistory =\n  //   botSelected && !isChatHistoryLoading && hasChatHistoryEnabledLLM;\n  const showLTMInfo = botSelected && hasLTMNode && !isLTMInfoLoading;\n  const showProjectVariables =\n    botSelected &&\n    (hasVariableNode || hasVariableAssignNode) &&\n    !isProjectVariablesLoading &&\n    !isBot;\n\n  useMount(() => {\n    const sourceBotId = new URLSearchParams(window.location.search).get(\n      'bot_id',\n    );\n    if (!valueId && sourceBotId) {\n      onChange?.({\n        id: sourceBotId,\n        type: IntelligenceType.Bot,\n      });\n    }\n  });\n\n  return (\n    <>\n      <Item hideLabel={hideLabel} label={I18n.t('workflow_240218_02')}>\n        <Bots isBot={isBot} value={value} onChange={onChange} {...props} />\n      </Item>\n\n      {showProjectVariables ? (\n        <div className={styles.container}>\n          <Item\n            label={I18n.t('wf_chatflow_126')}\n            defaultText={I18n.t('wf_chatflow_127')}\n          >\n            {hasProjectVariables ? (\n              <Variables variables={projectVariables} />\n            ) : null}\n          </Item>\n        </div>\n      ) : null}\n\n      {isBot ? (\n        <div\n          className={styles.container}\n          style={{\n            display:\n              showVariables || showTableInfo || showChatHistory || showLTMInfo\n                ? 'block'\n                : 'none',\n          }}\n        >\n          {showVariables ? (\n            <Item\n              label={I18n.t('workflow_detail_testrun_variable_node_field')}\n              defaultText={I18n.t(\n                'workflow_detail_testrun_variable_node_nofield',\n              )}\n            >\n              {hasVariables ? <Variables variables={variables} /> : null}\n            </Item>\n          ) : null}\n\n          {showTableInfo ? (\n            <Item\n              label={I18n.t('workflow_240218_05')}\n              defaultText={I18n.t('workflow_240218_04')}\n            >\n              {hasTableInfo ? <TableInfo data={tableInfo} /> : null}\n            </Item>\n          ) : null}\n\n          {showChatHistory ? (\n            <Item\n              label={I18n.t('workflow_chathistory_testrun_title')}\n              defaultText={I18n.t('workflow_chathistory_testrun_nocontent')}\n            >\n              {hasChatHistory ? <ChatHistory data={chatHistory} /> : null}\n            </Item>\n          ) : null}\n\n          {showLTMInfo ? (\n            <Item label={I18n.t('ltm_240617_02')}>\n              <div className=\"text-[12px]\">\n                {I18n.t('timecapsule_1228_001')}:{' '}\n                {ltmEnabled\n                  ? I18n.t('timecapsule_0124_001')\n                  : I18n.t('timecapsule_0124_002')}\n              </div>\n            </Item>\n          ) : null}\n        </div>\n      ) : null}\n    </>\n  );\n};\n\nexport const BotProjectSelectWithField = withField(BotProjectSelect, {\n  valueKey: 'value',\n  onKeyChangeFnName: 'onChange',\n});\n\nBotProjectSelectWithField.defaultProps = {\n  fieldStyle: { overflow: 'visible' },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-batch-import-or-export */\n/* eslint-disable @coze-arch/zustand/prefer-shallow */\nimport { type MutableRefObject, useEffect, useState } from 'react';\n\nimport { cloneDeep } from 'lodash-es';\nimport { useMemoizedFn } from 'ahooks';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport {\n  WorkflowDocument,\n  WorkflowContentChangeType,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  type IFormSchema,\n  useTestRunFormStore,\n} from '@coze-workflow/test-run-next';\nimport { useTestFormService } from '@coze-workflow/test-run';\n\nimport {\n  generateFormSchema,\n  useFormDefaultValues,\n  type WorkflowNodeEntity,\n} from '@/test-run-kit';\nimport { useGlobalState } from '@/hooks';\n\nimport { type TestRunFormModel } from './test-run-form-model';\nimport * as ModeFormKit from './mode-form-kit';\n\ninterface UseModeFormSchemaOptions {\n  node: WorkflowNodeEntity;\n  formApiRef: MutableRefObject<TestRunFormModel>;\n}\n\nexport const useModeFormSchema = (options: UseModeFormSchemaOptions) => {\n  const { formApiRef } = options;\n  const [schemaWithMode, setSchemaWithMode] = useState<null | IFormSchema>(\n    null,\n  );\n  const { mode, patch, getSchema } = useTestRunFormStore(store => ({\n    mode: store.mode,\n    patch: store.patch,\n    getSchema: store.getSchema,\n  }));\n  const globalState = useGlobalState();\n\n  const document = useService<WorkflowDocument>(WorkflowDocument);\n  const testFormService = useTestFormService();\n  const { getDefaultValues } = useFormDefaultValues();\n  /**\n   * Computation schema\n   */\n  const generate = useMemoizedFn(async () => {\n    const schema = await generateFormSchema({\n      node: options.node,\n      isChatflow: globalState.isChatflow,\n      isInProject: globalState.isInIDE,\n      workflowId: globalState.workflowId,\n      spaceId: globalState.spaceId,\n      isPreview: globalState.config.preview,\n    });\n    const defaultValues = await getDefaultValues(schema);\n    if (defaultValues) {\n      ModeFormKit.setDefaultValues({\n        properties: schema.properties,\n        defaultValues,\n      });\n    }\n    patch({\n      schema,\n    });\n    formApiRef.current.originSchema = schema;\n    generateMode(schema);\n  });\n  const generateMode = useMemoizedFn(\n    (originSchema: IFormSchema, update?: boolean) => {\n      const innerSchema = cloneDeep(originSchema);\n      innerSchema['x-form-mode'] = mode;\n      const nodeId = innerSchema['x-node-id'];\n      const cacheValues = testFormService.getCacheValues(nodeId || '');\n      if (update && cacheValues) {\n        ModeFormKit.setDefaultValues({\n          properties: innerSchema.properties,\n          defaultValues: cacheValues,\n          force: true,\n        });\n      }\n      if (mode === 'json') {\n        ModeFormKit.toJsonModeSchema(innerSchema);\n      }\n      setSchemaWithMode(innerSchema);\n      formApiRef.current.modeSchema = innerSchema;\n    },\n  );\n\n  useEffect(() => {\n    generate();\n    const dispose = document.onContentChange(e => {\n      if (e.type === WorkflowContentChangeType.NODE_DATA_CHANGE) {\n        generate();\n      }\n    });\n    return () => dispose.dispose();\n  }, [options.node, document, generate]);\n\n  useEffect(() => {\n    const originSchema = getSchema();\n    if (originSchema) {\n      generateMode(originSchema, true);\n    }\n  }, [mode, generateMode]);\n\n  return {\n    schemaWithMode,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-batch-import-or-export */\nimport { type MutableRefObject } from 'react';\n\nimport { cloneDeep } from 'lodash-es';\nimport { useMemoizedFn } from 'ahooks';\nimport {\n  type IFormSchema,\n  useTestRunFormStore,\n} from '@coze-workflow/test-run-next';\nimport { useTestFormService } from '@coze-workflow/test-run';\n\nimport { type TestRunFormModel } from './test-run-form-model';\nimport * as ModeFormKit from './mode-form-kit';\n\ninterface UseModeFormEventOptions {\n  schemaWithMode: IFormSchema | null;\n  formApiRef: MutableRefObject<TestRunFormModel>;\n}\n\nexport const useModeFormEvent = ({\n  schemaWithMode,\n  formApiRef,\n}: UseModeFormEventOptions) => {\n  const testFormService = useTestFormService();\n  const getSchema = useTestRunFormStore(store => store.getSchema);\n\n  const onMounted = useMemoizedFn(model => {\n    formApiRef.current.mounted(model);\n  });\n\n  const onFormValuesChange = useMemoizedFn(({ values }) => {\n    const currentValue = cloneDeep(values);\n    const nodeId = schemaWithMode?.['x-node-id'];\n    const originSchema = getSchema();\n    if (originSchema && schemaWithMode) {\n      ModeFormKit.formatValues({\n        mode: schemaWithMode['x-form-mode'] || 'form',\n        originFormSchema: originSchema,\n        formValues: currentValue,\n      });\n    }\n\n    if (nodeId) {\n      testFormService.setCacheValues(nodeId, currentValue);\n    }\n  });\n\n  return {\n    onFormValuesChange,\n    onMounted,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { cloneDeep } from 'lodash-es';\nimport { type FormModel, type IFormSchema } from '@coze-workflow/test-run-next';\n\nimport { formatValues } from './mode-form-kit';\ninterface SubmitResult {\n  /**\n   * Is it an empty form?\n   */\n  empty?: boolean;\n  /**\n   * Whether the verification is passed\n   */\n  validate?: boolean;\n  /**\n   * form value\n   */\n  values?: any;\n}\n\n/**\n * Form capability transparency model\n */\nexport class TestRunFormModel {\n  innerForm: FormModel | null = null;\n\n  /**\n   * Original schema\n   */\n  originSchema: IFormSchema | null = null;\n  /**\n   * View-converted schema\n   */\n  modeSchema: IFormSchema | null = null;\n\n  /**\n   * mount form instance\n   */\n  mounted(next: FormModel) {\n    this.innerForm = next;\n  }\n\n  getUIMode() {\n    return this.modeSchema?.['x-form-mode'] || 'form';\n  }\n\n  /**\n   * Submit the form, including form validation\n   */\n  async submit(): Promise<SubmitResult> {\n    if (!this.modeSchema || !this.innerForm) {\n      return { empty: true, validate: true };\n    }\n    const validateResult = await this.innerForm.validate();\n\n    if (validateResult.length) {\n      return {\n        validate: false,\n      };\n    }\n    const values = formatValues({\n      mode: this.modeSchema['x-form-mode'] || 'form',\n      originFormSchema: this.originSchema || {},\n      formValues: cloneDeep(this.innerForm.values),\n    });\n    return {\n      validate: true,\n      values,\n    };\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useRef } from 'react';\n\nimport {\n  TestRunForm,\n  TestRunFormProvider,\n  isFormSchemaPropertyEmpty,\n} from '@coze-workflow/test-run-next';\nimport { InputFormEmpty } from '@coze-workflow/test-run';\n\nimport { type WorkflowNodeEntity } from '@/test-run-kit';\n\nimport { TestsetSave, TestsetSelect } from '../test-form-materials/testset';\nimport { JsonModeInput } from '../test-form-materials/json-mode-input';\nimport { TypedFileInput } from '../test-form-materials/file/file-v2';\nimport {\n  NodeFieldCollapse,\n  RelatedFieldCollapse,\n} from '../test-form-materials';\nimport { useModeFormSchema } from './use-mode-form-schema';\nimport { useModeFormEvent } from './use-mode-form-event';\nimport { TestRunFormModel } from './test-run-form-model';\n\ninterface TestFormV3Props {\n  node: WorkflowNodeEntity;\n  onMounted: (formApi: TestRunFormModel) => void;\n}\n\nconst components = {\n  NodeFieldCollapse,\n  RelatedFieldCollapse,\n  TypedFileInput,\n  JsonModeInput,\n  TestsetSave,\n  TestsetSelect,\n};\n\nexport const InnerTestForm: React.FC<TestFormV3Props> = ({\n  node,\n  onMounted,\n}) => {\n  const formApiRef = useRef(new TestRunFormModel());\n  const { schemaWithMode } = useModeFormSchema({ node, formApiRef });\n  const events = useModeFormEvent({ schemaWithMode, formApiRef });\n\n  useEffect(() => {\n    onMounted(formApiRef.current);\n  }, [formApiRef]);\n\n  if (!schemaWithMode) {\n    return null;\n  }\n  if (schemaWithMode && isFormSchemaPropertyEmpty(schemaWithMode.properties)) {\n    return <InputFormEmpty />;\n  }\n\n  return (\n    <TestRunForm schema={schemaWithMode} components={components} {...events} />\n  );\n};\n\nexport const TestFormV3: React.FC<TestFormV3Props> = props => (\n  <TestRunFormProvider>\n    <InnerTestForm {...props} />\n  </TestRunFormProvider>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-batch-import-or-export */\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  useFormSchema,\n  useTestRunFormStore,\n  FormBaseGroupCollapse,\n  useForm,\n} from '@coze-workflow/test-run-next';\nimport { I18n } from '@coze-arch/i18n';\n\nimport * as ModeFormKit from '../../test-form-v3/mode-form-kit';\nimport { ModeSwitch } from './node-switch';\nimport { AIGenerateButton } from './ai-generate';\n\nimport css from './collapse.module.less';\n\nexport const NodeFieldCollapse: React.FC<React.PropsWithChildren> = ({\n  children,\n}) => {\n  const schema = useFormSchema();\n  const form = useForm();\n  const getSchema = useTestRunFormStore(store => store.getSchema);\n  const handleAiGenerate = (data, cover) => {\n    const originSchema = getSchema();\n    if (!originSchema) {\n      return;\n    }\n    const mode = schema['x-form-mode'] || 'form';\n    let next: any = ModeFormKit.mergeFormValues({\n      mode,\n      originFormSchema: originSchema,\n      prevValues: form.values,\n      nextValues: data,\n      ai: true,\n      cover,\n    });\n    if (mode === 'json') {\n      next = ModeFormKit.toJsonValues(originSchema, next);\n    }\n    form.values = next;\n  };\n\n  return (\n    <FormBaseGroupCollapse\n      label={I18n.t('wf_test_run_form_input_collapse_label')}\n      extra={\n        <div className={css.extra}>\n          <ModeSwitch />\n\n          {/* will support soon */}\n          {IS_OPEN_SOURCE ? null : (\n            <AIGenerateButton\n              schema={schema}\n              onGenStart={() => {\n                schema.uiState.set('disabled', true);\n              }}\n              onGenerate={handleAiGenerate}\n              onGenEnd={() => {\n                schema.uiState.set('disabled', false);\n              }}\n            />\n          )}\n        </div>\n      }\n    >\n      {children}\n    </FormBaseGroupCollapse>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/ban-ts-comment */\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { useMemo } from 'react';\n\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { GlobalVariableService } from '@coze-workflow/variable';\nimport {\n  FormBaseGroupCollapse,\n  useCurrentFieldState,\n  FormBaseFieldItem,\n  TestFormFieldName,\n} from '@coze-workflow/test-run-next';\nimport { I18n } from '@coze-arch/i18n';\nimport { IntelligenceType } from '@coze-arch/bot-api/intelligence_api';\n\nimport { useGlobalState } from '@/hooks';\n\nimport { ConversationSelect } from '../../../conversation-select';\nimport { BotProjectSelect } from '../../../bot-project-select';\n\ninterface RelatedFieldCollapseProps {\n  value: any;\n  isNeedBot: boolean;\n  isNeedConversation?: boolean;\n  hasVariableAssignNode?: boolean;\n  hasLTMNode?: boolean;\n  disableBot?: boolean;\n  disableBotTooltip?: string;\n  disableProject?: boolean;\n  disableProjectTooltip?: string;\n  onChange: (v?: any) => void;\n  onBlur: () => void;\n}\n\nexport const RelatedFieldCollapse: React.FC<RelatedFieldCollapseProps> = ({\n  value,\n  isNeedBot,\n  isNeedConversation,\n  onChange,\n  onBlur,\n  ...props\n}) => {\n  const { errors } = useCurrentFieldState();\n  const botErrors = (errors || [])\n    .filter(i => i?.type === 'bot')\n    .map(i => i.message);\n  const conversationErrors = (errors || [])\n    .filter(i => i?.type === 'conversation')\n    .map(i => i.message);\n  const globalState = useGlobalState();\n  const globalVariableService = useService<GlobalVariableService>(\n    GlobalVariableService,\n  );\n  const globalProjectId = globalState.projectId;\n\n  const botValue = value?.[TestFormFieldName.Bot];\n  const conversationValue = value?.[TestFormFieldName.Conversation];\n  const projectId = useMemo(() => {\n    if (globalProjectId) {\n      return globalProjectId;\n    }\n    if (botValue?.type === IntelligenceType.Project) {\n      return botValue?.id;\n    }\n  }, [globalProjectId, botValue]);\n\n  const isConversationVisible = isNeedConversation && !!projectId;\n  const handleBotProjectValueChange = next => {\n    const nextValue = {\n      [TestFormFieldName.Bot]: next,\n    };\n    onChange(nextValue);\n    onBlur();\n    globalVariableService.loadGlobalVariables(\n      next.type === IntelligenceType.Bot ? 'bot' : 'project',\n      next.id,\n    );\n  };\n  const handleConversationValueChange = next => {\n    const nextValue = {\n      ...value,\n      [TestFormFieldName.Conversation]: next,\n    };\n    onChange(nextValue);\n    onBlur();\n  };\n\n  return (\n    <FormBaseGroupCollapse label={I18n.t('wf_testrun_form_related_title')}>\n      {isNeedBot ? (\n        <FormBaseFieldItem\n          title={I18n.t('wf_chatflow_72')}\n          required\n          feedback={botErrors.join(',')}\n        >\n          <BotProjectSelect\n            size=\"small\"\n            hideLabel={true}\n            value={botValue}\n            onChange={handleBotProjectValueChange}\n            {...props}\n            // @ts-expect-error\n            validateStatus={botErrors.length ? 'error' : undefined}\n          />\n        </FormBaseFieldItem>\n      ) : null}\n      {isConversationVisible ? (\n        <FormBaseFieldItem\n          title={I18n.t('wf_chatflow_74')}\n          required\n          tooltip={I18n.t('wf_chatflow_154')}\n          feedback={conversationErrors.join(',')}\n        >\n          <ConversationSelect\n            size=\"small\"\n            value={conversationValue}\n            projectId={projectId}\n            onChange={handleConversationValueChange}\n            {...props}\n            // @ts-expect-error\n            validateStatus={conversationErrors.length ? 'error' : undefined}\n          />\n        </FormBaseFieldItem>\n      ) : null}\n    </FormBaseGroupCollapse>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TypedFileInput as OriginTypedFileInput } from './typed-file-input';\n\nexport const TypedFileInput = props => (\n  <div style={{ marginTop: '15px' }}>\n    <OriginTypedFileInput {...props} />\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { useRef } from 'react';\n\nimport {\n  FormBaseInputJson,\n  type IFormSchema,\n} from '@coze-workflow/test-run-next';\n\nimport { useGlobalState } from '@/hooks';\n\nimport { getExtensions } from './get-extensions';\n\ninterface JsonModeInputProps {\n  properties: IFormSchema['properties'];\n  validateJsonSchema: any;\n}\n\nexport const JsonModeInput: React.FC<JsonModeInputProps> = ({\n  properties,\n  validateJsonSchema,\n  ...props\n}) => {\n  const globalState = useGlobalState();\n  const editorRef = useRef();\n  const extensionsRef = useRef(\n    getExtensions({\n      properties,\n      spaceId: globalState.spaceId,\n      editorRef,\n    }),\n  );\n  return (\n    <FormBaseInputJson\n      jsonSchema={validateJsonSchema}\n      extensions={extensionsRef.current}\n      height=\"364px\"\n      didMount={editor => {\n        editorRef.current = editor;\n      }}\n      {...props}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useTestsetManageStore } from '@coze-workflow/test-run';\nimport { I18n } from '@coze-arch/i18n';\nimport { Checkbox, Typography } from '@coze-arch/coze-design';\n\nimport css from './testset-save.module.less';\n\ninterface TestsetSaveProps {\n  value?: boolean;\n  onChange: (v?: boolean) => void;\n  onBlur: () => void;\n}\n\nexport const TestsetSave: React.FC<TestsetSaveProps> = ({\n  value,\n  onChange,\n  onBlur,\n  ...props\n}) => {\n  const { openEditPanel } = useTestsetManageStore(store => ({\n    openEditPanel: store.openEditPanel,\n  }));\n  const handleChange = e => {\n    onChange?.(e.target.checked);\n    onBlur?.();\n  };\n\n  return (\n    <div className={css['testset-save']}>\n      <Checkbox checked={value} onChange={handleChange} {...props}>\n        <Typography.Text size=\"small\">\n          {I18n.t('workflow_testset_save')}\n        </Typography.Text>\n        <Typography.Text\n          link\n          size=\"small\"\n          style={{\n            lineHeight: '20px',\n          }}\n          onClick={e => {\n            e.stopPropagation();\n            openEditPanel();\n          }}\n        >\n          {I18n.t('workflow_testset_create')}\n        </Typography.Text>\n      </Checkbox>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @coze-arch/no-batch-import-or-export */\nimport {\n  FormBaseGroupCollapse,\n  useForm,\n  useFormSchema,\n  useTestRunFormStore,\n  TestFormFieldName,\n} from '@coze-workflow/test-run-next';\nimport { TestsetSelect as InnerTestsetSelect } from '@coze-workflow/test-run';\nimport { I18n } from '@coze-arch/i18n';\n\nimport * as ModeFormKit from '../../test-form-v3/mode-form-kit';\n\nimport css from './testset-select.module.less';\n\ninterface TestsetSelectProps {\n  disabled?: boolean;\n}\n\nexport const TestsetSelect: React.FC<TestsetSelectProps> = ({ disabled }) => {\n  const schema = useFormSchema();\n  const form = useForm();\n  const getSchema = useTestRunFormStore(store => store.getSchema);\n  const handleSelectTestset = (data: any) => {\n    const originSchema = getSchema();\n    if (!data || !originSchema) {\n      // If the data does not exist, it means that the data has been deleted and there is no need to proceed further.\n      return;\n    }\n    const mode = schema['x-form-mode'] || 'form';\n    let next: any = ModeFormKit.mergeFormValues({\n      mode,\n      originFormSchema: originSchema,\n      prevValues: form.values,\n      nextValues: data,\n      cover: true,\n    });\n    /** Uncheck if save is in the ticked state */\n    if (next?.[TestFormFieldName.TestsetSave] === true) {\n      next[TestFormFieldName.TestsetSave] = false;\n    }\n    if (mode === 'json') {\n      next = ModeFormKit.toJsonValues(originSchema, next);\n    }\n    form.values = next;\n  };\n\n  return (\n    <FormBaseGroupCollapse\n      label={I18n.t('workflow_testset_available')}\n      tooltip={I18n.t('workflow_testset_hover_tips')}\n    >\n      <InnerTestsetSelect\n        className={css['testset-select']}\n        disabled={disabled}\n        onSelect={handleSelectTestset}\n        size=\"small\"\n      />\n    </FormBaseGroupCollapse>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { QuestionForm as QuestionFormCore } from '@coze-workflow/test-run';\nimport { EventType } from '@coze-arch/bot-api/workflow_api';\n\nimport { useExecStateEntity, useGlobalState } from '@/hooks';\n\nexport const QuestionForm = () => {\n  const { workflowId, spaceId } = useGlobalState();\n  const exeState = useExecStateEntity();\n\n  const nodeQuestionEvent = exeState.getNodeEvent(EventType.Question);\n\n  return (\n    <QuestionFormCore\n      spaceId={spaceId}\n      workflowId={workflowId}\n      executeId={exeState.config.executeId}\n      questionEvent={nodeQuestionEvent}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InputForm as InputFormCore } from '@coze-workflow/test-run/input';\nimport { EventType } from '@coze-arch/bot-api/workflow_api';\n\nimport { useExecStateEntity, useGlobalState } from '@/hooks';\n\nexport const InputForm = () => {\n  const { workflowId, spaceId } = useGlobalState();\n  const exeState = useExecStateEntity();\n  const nodeInputEvent = exeState.getNodeEvent(EventType.InputNode);\n\n  return (\n    <InputFormCore\n      spaceId={spaceId}\n      workflowId={workflowId}\n      executeId={exeState.config.executeId}\n      inputEvent={nodeInputEvent}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useRef } from 'react';\n\nimport { useScroll, useInViewport, useMount } from 'ahooks';\nimport { NodeExeStatus } from '@coze-arch/idl/workflow_api';\n\ninterface Props {\n  onMount?: (rect?: DOMRect) => void;\n}\n\nconst LogEndView = ({ onMount }: Props) => {\n  const ref = useRef<HTMLDivElement | null>(null);\n\n  useMount(() => {\n    onMount?.(ref.current?.getBoundingClientRect());\n  });\n\n  return <div ref={ref} />;\n};\n\nexport default function useLogView() {\n  const logNodeRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLDivElement>(null);\n  const statusRef = useRef<NodeExeStatus | undefined>(undefined);\n\n  const [inputInViewport] = useInViewport(inputRef);\n  const scroll = useScroll(logNodeRef);\n\n  const updateRunStatus = (status?: NodeExeStatus) => {\n    statusRef.current = status;\n  };\n\n  const scrollToInputEnd = (endViewRect?: DOMRect) => {\n    const needScroll =\n      !!statusRef.current &&\n      [NodeExeStatus.Success, NodeExeStatus.Fail].includes(statusRef.current);\n\n    if (!needScroll) {\n      return;\n    }\n\n    const logNodeRect = logNodeRef.current?.getBoundingClientRect();\n    const inView =\n      endViewRect && logNodeRect && endViewRect?.bottom <= logNodeRect?.bottom;\n\n    if (inView) {\n      return;\n    }\n\n    const inputRect = inputRef.current?.getBoundingClientRect?.();\n    const scrollHeight = inputRect?.height;\n\n    if (scrollHeight && logNodeRef.current) {\n      logNodeRef.current?.scrollTo?.({\n        top: scrollHeight,\n        behavior: 'smooth',\n      });\n    }\n\n    statusRef.current = undefined;\n  };\n\n  return {\n    showInputBorder: Boolean(scroll?.top && scroll?.top > 0 && inputInViewport),\n    showOutputBorder: Boolean(\n      scroll?.top && scroll?.top > 0 && !inputInViewport,\n    ),\n    updateRunStatus,\n    logNodeRef,\n    inputRef,\n    logView: <LogEndView onMount={scrollToInputEnd} />,\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ComponentAdapterCommonProps } from '../../types';\nimport { FieldName } from '../../constants';\nimport { type ValueType } from '../../../bot-project-select/types';\nimport { BotProjectSelectWithField } from '../../../bot-project-select';\n\nexport type BotSelectProps = ComponentAdapterCommonProps<\n  ValueType | undefined\n> & {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any;\n};\n\nconst BotProjectSelectTestset: React.FC<BotSelectProps> = ({\n  value,\n  ...props\n}) => (\n  <BotProjectSelectWithField\n    field={FieldName.Bot}\n    hideLabel={true}\n    {...props}\n  />\n);\n\nexport { BotProjectSelectTestset };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useState } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport {\n  BotProjectSelectTestset,\n  type BotSelectProps,\n} from '../test-form-materials/bot-project-select';\nimport { useNeedBot } from '../hooks/use-need-bot';\nimport { useGetStartNode } from '../hooks/use-get-start-node';\nimport { TestFormType } from '../constants';\n\nexport const TestsetBotProjectSelect = (props: BotSelectProps) => {\n  const [options, setOptions] = useState({});\n  const { queryNeedBot } = useNeedBot();\n  const { getNode } = useGetStartNode();\n  const startNode = getNode();\n  const testFormType = TestFormType.Default;\n  useEffect(() => {\n    const initOptions = async () => {\n      if (startNode) {\n        const isNeedBotEnv = await queryNeedBot(testFormType, startNode);\n        const { hasLTMNode, hasConversationNode } = isNeedBotEnv;\n\n        // Session class nodes, subflows (Chatflow) cannot select Bot because Bot does not support multi-session\n        // The LTM node cannot select Project because Project does not yet have LTM capabilities\n        const needDisableBot = hasConversationNode;\n        const botDisableOptions = {\n          disableBot: needDisableBot,\n          disableBotTooltip: needDisableBot ? I18n.t('wf_chatflow_141') : '',\n          disableProject: hasLTMNode,\n          disableProjectTooltip: hasLTMNode ? I18n.t('wf_chatflow_142') : '',\n        };\n        setOptions(botDisableOptions);\n      }\n    };\n    initOptions();\n  }, []);\n\n  return <BotProjectSelectTestset {...props} {...options} />;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport cls from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozLoading } from '@coze-arch/coze-design/icons';\n\nimport styles from './styles.module.less';\n\nexport default function RunningPanel() {\n  return (\n    <div\n      className={cls(\n        'w-full h-full absolute flex flex-col items-center justify-center bg-white',\n        styles['content-bg-color'],\n      )}\n    >\n      <IconCozLoading className=\"animate-spin coz-fg-dim mb-[4px] text-[32px]\" />\n      <span className={'text-[14px]'}>\n        {I18n.t('workflow_testset_testruning')}\n      </span>\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { FormBaseGroupCollapse } from '@coze-workflow/test-run-next';\nimport { LogDetail } from '@coze-workflow/test-run';\nimport { type NodeResult } from '@coze-workflow/base/api';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { useOpenWorkflow } from '@/test-run-kit';\nimport { useGlobalState } from '@/hooks';\n\nimport { ImgLogV2 } from '../img-log-v2';\n\nexport const ResultLog: React.FC<{\n  result: NodeResult;\n  node?: FlowNodeEntity;\n  extra?: React.ReactNode;\n}> = ({ result, node, extra }) => {\n  const globalState = useGlobalState();\n  const { open: openWorkflow } = useOpenWorkflow();\n  return (\n    <>\n      <FormBaseGroupCollapse label={I18n.t('workflow_running_results')}>\n        <LogDetail\n          spaceId={globalState.spaceId}\n          workflowId={globalState.workflowId}\n          result={result}\n          paginationFixedCount={5}\n          LogImages={ImgLogV2}\n          node={node}\n          onOpenWorkflowLink={openWorkflow}\n        />\n\n        {extra}\n      </FormBaseGroupCollapse>\n      <div className=\"pb-2\"></div>\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback } from 'react';\n\nimport cls from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozCross } from '@coze-arch/coze-design/icons';\nimport { IconButton } from '@coze-arch/coze-design';\n\nimport { useFloatLayoutService } from '@/hooks/use-float-layout-service';\nimport { useOpenTraceListPanel } from '@/hooks';\nimport { useTestRunStatus } from '@/components/test-run/hooks/use-test-run-status';\nimport { START_NODE_ID } from '@/components/test-run/constants';\n\nimport { ExecuteState } from '../execute-result/execute-result-side-sheet/components/execute-state';\n\nimport styles from './styles.module.less';\n\nexport const TestFormSheetHeaderV2 = () => {\n  const { running } = useTestRunStatus(START_NODE_ID);\n\n  const floatLayoutService = useFloatLayoutService();\n\n  const { open } = useOpenTraceListPanel();\n\n  const handleOpenTraceBottomSheet = useCallback(() => {\n    // will support soon\n    if (IS_OPEN_SOURCE) {\n      return;\n    }\n    open();\n  }, [open]);\n\n  const handleClose = useCallback(() => {\n    floatLayoutService.close('right');\n  }, [floatLayoutService]);\n\n  return (\n    <div className={styles['test-form-sheet-header-v2']}>\n      <div className={cls(styles['header-title-v2'])}>\n        {I18n.t('workflow_detail_title_testrun')}\n      </div>\n\n      <div className=\"flex items-center\">\n        {!running && (\n          <ExecuteState\n            onClick={handleOpenTraceBottomSheet}\n            hiddenStateText\n            extra={\n              // will support soon\n              !IS_OPEN_SOURCE && (\n                <span className={cls('cursor-pointer font-medium')}>\n                  {I18n.t('workflow_testset_view_log')}\n                </span>\n              )\n            }\n          />\n        )}\n        <IconButton\n          className={'ml-[4px]'}\n          icon={<IconCozCross className={'text-[18px]'} />}\n          color=\"secondary\"\n          onClick={handleClose}\n        />\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useMemo } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozPlayFill,\n  IconCozStopCircle,\n} from '@coze-arch/coze-design/icons';\nimport { Button } from '@coze-arch/coze-design';\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport { useExecStateEntity } from '@/hooks';\n\nimport { useTestRunStatus } from '../hooks/use-test-run-status';\nimport { useCancelTestRun } from '../hooks/use-cancel-test-run';\nimport { START_NODE_ID } from '../constants';\n\nimport styles from './styles.module.less';\n\ninterface TestFormSheetFooterV2Props {\n  node?: FlowNodeEntity;\n  onClick?: (e: React.MouseEvent) => void;\n}\n\nconst TestRunFlowButton: React.FC<{\n  onClick?: (e: React.MouseEvent) => void;\n}> = ({ onClick }) => {\n  const { loading, disabled, saveLoading, running } =\n    useTestRunStatus(START_NODE_ID);\n  const { cancelTestRun, canceling } = useCancelTestRun();\n  const {\n    config: { executeId },\n  } = useExecStateEntity();\n  /** There are different copies in the save. */\n  const text = useMemo(\n    () =>\n      saveLoading\n        ? I18n.t('bot_autosave_saving')\n        : I18n.t('workflow_detail_title_testrun'),\n    [saveLoading],\n  );\n  // It is running and has an execution id to cancel.\n  return running ? (\n    <Button\n      icon={<IconCozStopCircle />}\n      onClick={cancelTestRun}\n      disabled={canceling || (!executeId && disabled)}\n      color=\"primary\"\n    >\n      {I18n.t('devops_publish_changelog_generate_stop')}\n    </Button>\n  ) : (\n    <Button\n      disabled={disabled}\n      loading={loading}\n      icon={<IconCozPlayFill />}\n      color=\"green\"\n      onClick={onClick}\n    >\n      {text}\n    </Button>\n  );\n};\nexport const TestRunNodeButton: React.FC<{\n  node: FlowNodeEntity;\n  onClick?: (e: React.MouseEvent) => void;\n}> = ({ node, onClick }) => {\n  const { loading, disabled, isMineRunning } = useTestRunStatus(node.id);\n  const { cancelTestRun, canceling } = useCancelTestRun();\n  const {\n    config: { executeId },\n  } = useExecStateEntity();\n\n  return isMineRunning ? (\n    <Button\n      icon={<IconCozStopCircle />}\n      onClick={cancelTestRun}\n      disabled={canceling || (!executeId && disabled)}\n      color=\"primary\"\n      style={{ width: '100%' }}\n    >\n      {I18n.t('devops_publish_changelog_generate_stop')}\n    </Button>\n  ) : (\n    <Button\n      icon={<IconCozPlayFill />}\n      disabled={disabled}\n      loading={loading}\n      onClick={onClick}\n      color=\"green\"\n      style={{ width: '100%' }}\n    >\n      {I18n.t('workflow_debug_run')}\n    </Button>\n  );\n};\n\nexport const TestFormSheetFooterV2: React.FC<TestFormSheetFooterV2Props> = ({\n  node,\n  onClick,\n}) => (\n  <div className={styles['test-form-sheet-footer-v2']}>\n    {node ? (\n      <TestRunNodeButton node={node} onClick={onClick} />\n    ) : (\n      <TestRunFlowButton onClick={onClick} />\n    )}\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any -- history code */\n/**\n * Adapt coze graph 2.0 test form\n */\n\nimport { useRef } from 'react';\n\nimport cls from 'classnames';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { TestFormFieldName } from '@coze-workflow/test-run-next';\nimport {\n  FormItemSchemaType,\n  FormPanelLayout,\n  TestsetEditPanel,\n  TestsetManageProvider,\n} from '@coze-workflow/test-run';\nimport { NodeExeStatus } from '@coze-workflow/base/api';\nimport { userStoreService } from '@coze-studio/user-store';\nimport {\n  PremiumPaywallBanner,\n  PremiumPaywallBannerScene,\n} from '@coze-studio/premium-components-adapter';\nimport { IntelligenceType } from '@coze-arch/idl/intelligence_api';\nimport { I18n } from '@coze-arch/i18n';\nimport { Toast } from '@coze-arch/coze-design';\n\nimport { type WorkflowNodeEntity } from '@/test-run-kit';\nimport { useValidateWorkflow } from '@/hooks/use-validate-workflow';\nimport {\n  useExecStateEntity,\n  useFloatLayoutService,\n  useGlobalState,\n  useTestRunReporterService,\n} from '@/hooks';\nimport { useChatflowInfo } from '@/components/test-run/hooks/use-chatflow-info';\nimport { ResizableSidePanel } from '@/components/resizable-side-panel';\n\nimport { stringifyValue } from '../utils/stringify-value';\nimport { trySaveTestset } from '../test-form-v3/mode-form-kit';\nimport { TestFormV3 } from '../test-form-v3';\nimport { JsonEditorSemi } from '../test-form-materials/json-editor';\nimport { QuestionForm } from '../question-form';\nimport { InputForm } from '../input-form';\nimport { useTestsetBizCtx } from '../hooks/use-testset-biz-ctx';\nimport { useTestRunStatus } from '../hooks/use-test-run-status';\nimport useLogView from '../hooks/use-log-view';\nimport { useGetStartNode } from '../hooks/use-get-start-node';\nimport { START_NODE_ID } from '../constants';\nimport { TestsetBotProjectSelect } from '../chat-flow-test-form-panel/testset-bot-project-select';\nimport { PanelWrap } from '../../float-layout';\nimport { WorkflowRunService } from '../../../services';\nimport RunningPanel from './running-panel';\nimport { ResultLog } from './result-log';\nimport { TestFormSheetHeaderV2 } from './header';\nimport { TestFormSheetFooterV2 } from './footer';\n\nimport styles from './styles.module.less';\n\ninterface TestWorkflowFormPanelProps {\n  node: WorkflowNodeEntity;\n}\n\nconst TestFormSheetV2: React.FC<TestWorkflowFormPanelProps> = ({ node }) => {\n  const formApiRef = useRef<any>(null);\n\n  const execEntity = useExecStateEntity();\n  const runService = useService<WorkflowRunService>(WorkflowRunService);\n  const reporter = useTestRunReporterService();\n\n  const bizCtx = useTestsetBizCtx();\n\n  const { validate } = useValidateWorkflow();\n  const floatLayoutService = useFloatLayoutService();\n  const globalState = useGlobalState();\n  const userInfo = userStoreService.useUserInfo();\n  const result = execEntity.getEndNodeResult();\n  const { getNode } = useGetStartNode();\n  const { sessionInfo } = useChatflowInfo();\n\n  const { running } = useTestRunStatus(START_NODE_ID);\n\n  const { updateRunStatus, logNodeRef, logView } = useLogView();\n\n  const showResult =\n    !!result?.nodeStatus &&\n    [NodeExeStatus.Success, NodeExeStatus.Fail].includes(result.nodeStatus);\n\n  const testRunFlowV3 = async () => {\n    const hasError = await validate();\n    if (hasError) {\n      floatLayoutService.open('problemPanel', 'bottom');\n      return;\n    }\n    if (!formApiRef.current) {\n      return;\n    }\n    const {\n      empty,\n      validate: formValidate,\n      values,\n    } = await formApiRef.current.submit();\n    if (!formValidate) {\n      Toast.error(I18n.t('workflow_testrun_form_vailate_error_toast'));\n      return;\n    }\n    let inputData: object | undefined;\n    let input: Record<string, string> | undefined;\n    let related: Record<string, string> | undefined;\n    let botId: string | undefined;\n    let testsetSave: boolean | undefined;\n    if (!empty) {\n      inputData = values?.[TestFormFieldName.Node]?.[TestFormFieldName.Input];\n      input = stringifyValue(inputData as object);\n      related = values?.[TestFormFieldName.Related];\n      botId = related?.[TestFormFieldName.Bot] as any;\n      testsetSave = values?.[TestFormFieldName.TestsetSave];\n    }\n\n    if (testsetSave) {\n      const checkMsg = await trySaveTestset({\n        values: inputData,\n        bot: botId,\n        schema: formApiRef.current.originSchema,\n        bizCtx,\n        node,\n        workflowId: globalState.workflowId,\n      });\n\n      if (checkMsg?.checkError) {\n        return;\n      }\n    }\n\n    reporter.formRunUIMode({\n      form_ui_mode: formApiRef.current.getUIMode(),\n    });\n\n    const useProject = sessionInfo?.type === IntelligenceType.Project;\n    await runService.testRun(input, (botId as any)?.id || botId, useProject);\n\n    const currentNodeStatus = execEntity.getEndNodeResult()?.nodeStatus;\n\n    updateRunStatus(currentNodeStatus);\n\n    if (\n      currentNodeStatus === NodeExeStatus.Success &&\n      testsetSave &&\n      formApiRef.current.innerForm\n    ) {\n      formApiRef.current.innerForm.setValueIn(\n        TestFormFieldName.TestsetSave,\n        false,\n      );\n    }\n  };\n\n  const handleSubmit = async () => {\n    // The result of closing a practice run first\n    runService.clearTestRun();\n    await testRunFlowV3();\n  };\n\n  return (\n    <div className={styles['test-form-v2']}>\n      <TestsetManageProvider\n        spaceId={globalState.spaceId}\n        workflowId={globalState.workflowId}\n        userId={userInfo?.user_id_str}\n        nodeId={getNode()?.id}\n        projectId={globalState.projectId}\n        formRenders={{\n          [FormItemSchemaType.BOT]: TestsetBotProjectSelect as any,\n          [FormItemSchemaType.LIST]: JsonEditorSemi as any,\n          [FormItemSchemaType.OBJECT]: JsonEditorSemi as any,\n        }}\n      >\n        <TestFormSheetHeaderV2 />\n\n        <PremiumPaywallBanner scene={PremiumPaywallBannerScene.Token} />\n        <div ref={logNodeRef} className={styles['test-form-content']}>\n          <div\n            className={cls('w-full h-full', {\n              [styles['test-form-content-absolute']]: running,\n            })}\n          >\n            <TestFormV3 node={node} onMounted={v => (formApiRef.current = v)} />\n\n            {showResult ? <ResultLog result={result} extra={logView} /> : null}\n          </div>\n\n          {running ? <RunningPanel /> : null}\n        </div>\n        <TestFormSheetFooterV2 onClick={() => handleSubmit()} />\n        <TestsetEditPanel />\n        <QuestionForm />\n        <InputForm />\n      </TestsetManageProvider>\n    </div>\n  );\n};\n\nconst StartTestFormSheet: React.FC<TestWorkflowFormPanelProps> = props => (\n  <PanelWrap layout=\"vertical\">\n    <ResizableSidePanel>\n      <FormPanelLayout>\n        <TestFormSheetV2 {...props} />\n      </FormPanelLayout>\n    </ResizableSidePanel>\n  </PanelWrap>\n);\n\nexport { TestFormSheetV2, StartTestFormSheet, type TestWorkflowFormPanelProps };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozCross } from '@coze-arch/coze-design/icons';\nimport { IconButton } from '@coze-arch/coze-design';\n\nimport { useFloatLayoutService } from '@/hooks/use-float-layout-service';\nimport { useOpenTraceListPanel } from '@/hooks';\n\nimport { ExecuteState } from '../execute-result/execute-result-side-sheet/components/execute-state';\n\nimport styles from './test-form-header.module.less';\n\nexport const TestFormHeader: React.FC = () => {\n  const floatLayoutService = useFloatLayoutService();\n\n  const { open } = useOpenTraceListPanel();\n\n  const handleOpenTraceBottomSheet = useCallback(() => {\n    // will support soon\n    if (IS_OPEN_SOURCE) {\n      return;\n    }\n    open();\n  }, [open]);\n\n  const handleClose = useCallback(() => {\n    floatLayoutService.close('right');\n  }, [floatLayoutService]);\n\n  return (\n    <div className={styles['test-form-sheet-header-v2']}>\n      <div className={styles['header-title-v2']}>\n        {I18n.t('workflow_detail_title_testrun')}\n      </div>\n\n      <div className=\"flex gap-x-1 items-center\">\n        <ExecuteState\n          hiddenStateText\n          onClick={handleOpenTraceBottomSheet}\n          extra={\n            // will support soon\n            !IS_OPEN_SOURCE && (\n              <span className={'cursor-pointer font-medium'}>\n                {I18n.t('workflow_testset_view_log')}\n              </span>\n            )\n          }\n        />\n        <IconButton\n          icon={<IconCozCross className={'text-[18px]'} />}\n          color=\"secondary\"\n          onClick={handleClose}\n        />\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback } from 'react';\n\nimport { Skeleton } from '@coze-arch/coze-design';\n\nimport styles from './index.module.less';\n\nexport const useSkeleton = () => {\n  const renderLoading = useCallback(\n    () => (\n      <Skeleton\n        style={{ width: '100%', height: '100%' }}\n        placeholder={\n          <div className={styles['skeleton-container']}>\n            <div className={styles['skeleton-item']}>\n              <Skeleton.Avatar className={styles['skeleton-avatar']} />\n              <div className={styles['skeleton-column']}>\n                <Skeleton.Title className={styles['skeleton-name']} />\n                <Skeleton.Image className={styles['skeleton-content']} />\n              </div>\n            </div>\n            <div className={styles['skeleton-item']}>\n              <Skeleton.Avatar className={styles['skeleton-avatar']} />\n              <Skeleton.Image className={styles['skeleton-content-mini']} />\n            </div>\n            <div className={styles['skeleton-item']}>\n              <Skeleton.Avatar className={styles['skeleton-avatar']} />\n              <div className={styles['skeleton-column']}>\n                <Skeleton.Title className={styles['skeleton-name']} />\n                <Skeleton.Image className={styles['skeleton-content']} />\n              </div>\n            </div>\n          </div>\n        }\n        active\n        loading={true}\n      />\n    ),\n    [],\n  );\n  return renderLoading;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { Suspense, lazy } from 'react';\n\nimport { isEmpty } from 'lodash-es';\nimport { userStoreService } from '@coze-studio/user-store';\nimport { type IWorkflow, type IProject } from '@coze-studio/open-chat';\nimport { IntelligenceType } from '@coze-arch/idl/intelligence_api';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozIllusAdd } from '@coze-arch/coze-design/illustrations';\nimport { EmptyState } from '@coze-arch/coze-design';\nimport {\n  type ProjectConversation,\n  CreateEnv,\n} from '@coze-arch/bot-api/workflow_api';\n\nimport { useSkeleton } from './use-skeleton';\n\nconst LazyBuilderChat = lazy(async () => {\n  const { BuilderChat } = await import('@coze-studio/open-chat');\n  return { default: BuilderChat };\n});\nexport interface ProjectOrBotInfoType {\n  id: string;\n  iconUrl: string;\n  name: string;\n  type: IntelligenceType;\n}\n\nexport interface ChatHistoryProps {\n  workflowInfo?: IWorkflow;\n  showInputArea?: boolean;\n  projectOrBotInfo?: ProjectOrBotInfoType;\n  activateChat?: ProjectConversation;\n  type: CreateEnv;\n  defaultText?: string;\n  topSlot?: (isChatError?: boolean) => React.ReactNode;\n  onGetChatFlowExecuteId?: (executeId: string) => void;\n}\n\n/** Backend @qiangshunliang definition, display empty state when no dialogue exists */\nconst DISABLED_CONVERSATION = '0';\n\n// eslint-disable-next-line complexity\nexport const ChatHistory = ({\n  workflowInfo = {},\n  projectOrBotInfo,\n  activateChat,\n  type,\n  // Default does not show dialog box\n  showInputArea = false,\n  onGetChatFlowExecuteId,\n  defaultText = '',\n  topSlot,\n}: ChatHistoryProps) => {\n  const userInfo = userStoreService.getUserInfo();\n  const renderLoading = useSkeleton();\n\n  const chatUserInfo = {\n    id: userInfo?.user_id_str || '',\n    nickname: userInfo?.name || '',\n    url: userInfo?.avatar_url || '',\n  };\n\n  if (\n    !projectOrBotInfo?.id ||\n    !activateChat?.conversation_name ||\n    (activateChat?.conversation_id === DISABLED_CONVERSATION &&\n      isEmpty(workflowInfo))\n  ) {\n    // Workflow scenes do not show empty states\n    if (!isEmpty(workflowInfo)) {\n      return null;\n    }\n    return (\n      <EmptyState\n        size=\"full_screen\"\n        icon={<IconCozIllusAdd />}\n        title={I18n.t('wf_chatflow_61')}\n        description={I18n.t('wf_chatflow_62')}\n      />\n    );\n  }\n  const conversationName =\n    type === CreateEnv.Draft\n      ? activateChat?.conversation_name || ''\n      : activateChat?.release_conversation_name ||\n        activateChat?.conversation_name ||\n        '';\n  const projectInfo: IProject = {\n    id: projectOrBotInfo?.id,\n    conversationName,\n    defaultName: activateChat?.conversation_name || projectOrBotInfo?.name,\n    defaultIconUrl: projectOrBotInfo?.iconUrl,\n    connectorId: type === CreateEnv.Draft ? '10000010' : '1024',\n    type: projectOrBotInfo?.type === IntelligenceType.Project ? 'app' : 'bot',\n    mode: type === CreateEnv.Draft ? 'draft' : 'release',\n    conversationId: activateChat?.conversation_id,\n    caller: type === CreateEnv.Draft ? 'CANVAS' : undefined,\n  };\n\n  return (\n    <Suspense fallback={null}>\n      <LazyBuilderChat\n        workflow={workflowInfo}\n        project={projectInfo}\n        eventCallbacks={{\n          onGetChatFlowExecuteId,\n        }}\n        areaUi={{\n          isNeedClearContext: false,\n          isNeedClearMessage: true,\n          input: {\n            isShow: showInputArea,\n            defaultText,\n            renderChatInputTopSlot: topSlot,\n            isNeedAudio: false,\n          },\n          renderLoading,\n          uiTheme: 'chatFlow',\n        }}\n        userInfo={chatUserInfo}\n        auth={{\n          type: 'internal',\n        }}\n      ></LazyBuilderChat>\n    </Suspense>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createContext, useContext, useMemo } from 'react';\n\nimport { createWithEqualityFn } from 'zustand/traditional';\nimport { shallow } from 'zustand/shallow';\n\ninterface ChatFlowTestFormState {\n  visible: boolean;\n  hasForm: boolean;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  formData: null | Record<string, any>;\n}\n\ninterface ChatFlowTestFormAction {\n  patch: (next: Partial<ChatFlowTestFormState>) => void;\n  getFormData: () => ChatFlowTestFormState['formData'];\n}\n\nconst createChatFlowTestFormStore = () =>\n  createWithEqualityFn<ChatFlowTestFormState & ChatFlowTestFormAction>(\n    (set, get) => ({\n      visible: false,\n      hasForm: false,\n      formData: null,\n      patch: next => set(() => next),\n      getFormData: () => get().formData,\n    }),\n    shallow,\n  );\n\ntype ChatFlowTestFormStore = ReturnType<typeof createChatFlowTestFormStore>;\n\nconst chatFlowTestFormContext = createContext<ChatFlowTestFormStore>(\n  {} as unknown as ChatFlowTestFormStore,\n);\n\nconst useChatFlowTestFormStore = <T,>(\n  selector: (s: ChatFlowTestFormState & ChatFlowTestFormAction) => T,\n) => {\n  const store = useContext(chatFlowTestFormContext);\n  return store(selector);\n};\n\nconst ChatFlowTestFormProvider: React.FC<React.PropsWithChildren> = ({\n  children,\n}) => {\n  const store = useMemo(() => createChatFlowTestFormStore(), []);\n\n  return (\n    <chatFlowTestFormContext.Provider value={store}>\n      {children}\n    </chatFlowTestFormContext.Provider>\n  );\n};\n\nexport { ChatFlowTestFormProvider, useChatFlowTestFormStore };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozAdjust } from '@coze-arch/coze-design/icons';\nimport { Typography } from '@coze-arch/coze-design';\n\nimport { useChatFlowTestFormStore } from './test-form-provider';\n\nimport css from './test-form-float-button.module.less';\n\nexport const TestFormFloatButton = ({\n  isChatError,\n}: {\n  isChatError?: boolean;\n}) => {\n  const { hasForm, patch } = useChatFlowTestFormStore(store => ({\n    hasForm: store.hasForm,\n    patch: store.patch,\n  }));\n\n  const handleOpenForm = () => {\n    patch({ visible: true });\n  };\n\n  if (!hasForm) {\n    return null;\n  }\n\n  return (\n    <div className={css['float-button-container']}>\n      <div\n        className={css['float-button']}\n        onClick={handleOpenForm}\n        style={\n          isChatError === true\n            ? { position: 'absolute', left: 69, bottom: 123 }\n            : {}\n        }\n      >\n        <Typography.Text className=\"coz-fg-primary\">\n          {I18n.t('wf_chatflow_71')}\n        </Typography.Text>\n        <IconCozAdjust className=\"coz-fg-dim\" />\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ComponentAdapterCommonProps } from '../../types';\nimport { FieldName } from '../../constants';\nimport { ConversationSelectWithField } from '../../../conversation-select';\n\ntype ConversationSelectProps = ComponentAdapterCommonProps<string> & {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any;\n};\n\nconst ConversationSelectTestset: React.FC<ConversationSelectProps> = ({\n  value,\n  ...props\n}) => <ConversationSelectWithField field={FieldName.Chat} {...props} />;\n\nexport { ConversationSelectTestset };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { useRef } from 'react';\n\nimport { TestFormFieldName } from '@coze-workflow/test-run-next';\nimport {\n  ResizablePanel,\n  TestsetEditPanel,\n  TestsetManageProvider,\n  FormItemSchemaType,\n} from '@coze-workflow/test-run';\nimport { userStoreService } from '@coze-studio/user-store';\nimport {\n  PremiumPaywallBanner,\n  PremiumPaywallBannerScene,\n} from '@coze-studio/premium-components-adapter';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozPlayFill } from '@coze-arch/coze-design/icons';\nimport { Button, Toast, Typography } from '@coze-arch/coze-design';\n\nimport { type WorkflowNodeEntity } from '@/test-run-kit';\nimport { useValidateWorkflow } from '@/hooks/use-validate-workflow';\nimport {\n  useFloatLayoutService,\n  useGlobalState,\n  useTestRunReporterService,\n} from '@/hooks';\n\nimport { trySaveTestset } from '../test-form-v3/mode-form-kit';\nimport { TestFormV3 } from '../test-form-v3';\nimport { JsonEditorSemi } from '../test-form-materials/json-editor';\nimport { ConversationSelectTestset } from '../test-form-materials/conversation-select';\nimport { useTestsetBizCtx } from '../hooks/use-testset-biz-ctx';\nimport { useGetStartNode } from '../hooks/use-get-start-node';\nimport { FieldName } from '../constants';\nimport { TestsetBotProjectSelect } from './testset-bot-project-select';\nimport { useChatFlowTestFormStore } from './test-form-provider';\n\nimport css from './test-form.module.less';\n\ninterface TestWorkflowFormPanelProps {\n  node: WorkflowNodeEntity;\n}\n\nexport const ChatFlowTestForm: React.FC<TestWorkflowFormPanelProps> = ({\n  node,\n}) => {\n  const formApiRef = useRef<any>(null);\n  const globalState = useGlobalState();\n  const { patch, formData } = useChatFlowTestFormStore(store => ({\n    patch: store.patch,\n    formData: store.formData,\n  }));\n  const userInfo = userStoreService.useUserInfo();\n  const { getNode } = useGetStartNode();\n  const reporter = useTestRunReporterService();\n  const { validate } = useValidateWorkflow();\n  const floatLayoutService = useFloatLayoutService();\n  const panelRef = useRef<any>(null);\n  const bizCtx = useTestsetBizCtx();\n\n  const testRunChatFlowV3 = async () => {\n    const hasError = await validate();\n    if (hasError) {\n      floatLayoutService.open('problemPanel', 'bottom');\n      return;\n    }\n\n    if (!formApiRef.current) {\n      return;\n    }\n    const {\n      empty,\n      validate: formValidate,\n      values,\n    } = await formApiRef.current.submit();\n    if (!formValidate) {\n      Toast.error(I18n.t('workflow_testrun_form_vailate_error_toast'));\n      return;\n    }\n    if (!empty) {\n      reporter.formRunUIMode({\n        form_ui_mode: formApiRef.current.getUIMode(),\n      });\n      const testsetSave = values?.[TestFormFieldName.TestsetSave];\n      if (testsetSave) {\n        const botId = values?.[FieldName.Bot];\n        const inputData = values?.[FieldName.Node]?.[FieldName.Input];\n        const checkMsg = await trySaveTestset({\n          values: inputData,\n          bot: botId,\n          schema: formApiRef.current.originSchema,\n          bizCtx,\n          node,\n          workflowId: globalState.workflowId,\n        });\n\n        if (checkMsg?.checkError) {\n          return;\n        }\n      }\n    }\n    patch({ formData: values });\n    panelRef.current?.close();\n  };\n\n  const handleClose = () => {\n    patch({ visible: false });\n  };\n\n  return (\n    <TestsetManageProvider\n      spaceId={globalState.spaceId}\n      workflowId={globalState.workflowId}\n      userId={userInfo?.user_id_str}\n      nodeId={getNode()?.id}\n      projectId={globalState.projectId}\n      formRenders={{\n        [FormItemSchemaType.CHAT]: ConversationSelectTestset as any,\n        [FormItemSchemaType.BOT]: TestsetBotProjectSelect as any,\n        [FormItemSchemaType.LIST]: JsonEditorSemi as any,\n        [FormItemSchemaType.OBJECT]: JsonEditorSemi as any,\n      }}\n    >\n      <ResizablePanel\n        animation={'translateY'}\n        header={\n          <div className={css['test-form-header']}>\n            <Typography.Text strong fontSize=\"16px\">\n              {I18n.t('wf_chatflow_71')}\n            </Typography.Text>\n          </div>\n        }\n        headerExtra={\n          <PremiumPaywallBanner scene={PremiumPaywallBannerScene.Token} />\n        }\n        className={css['resizable-panel']}\n        footer={\n          <Button\n            color=\"green\"\n            className=\"w-full\"\n            icon={<IconCozPlayFill />}\n            onClick={() => {\n              testRunChatFlowV3();\n            }}\n          >\n            {I18n.t('wf_chatflow_75')}\n          </Button>\n        }\n        ref={panelRef}\n        hideClose={!formData}\n        onClose={handleClose}\n      >\n        <TestFormV3 node={node} onMounted={v => (formApiRef.current = v)} />\n\n        <TestsetEditPanel\n          isChatFlow\n          onParentClose={() => {\n            panelRef.current.close();\n          }}\n        />\n      </ResizablePanel>\n    </TestsetManageProvider>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo, useState } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Typography } from '@coze-arch/coze-design';\nimport { IntelligenceType } from '@coze-arch/bot-api/intelligence_api';\n\nimport { useGlobalState } from '@/hooks';\n\nimport { useChatflowInfo } from '../../hooks/use-chatflow-info';\nimport { Conversations as OnlyConversationSelect } from '../../../conversation-select/conversations';\n\nimport css from './conversation-select.module.less';\n\nexport const ConversationSelect = () => {\n  const { projectId: myProjectId } = useGlobalState();\n  const { sessionInfo } = useChatflowInfo();\n  const [value, setValue] = useState<string | undefined>();\n\n  const projectId = useMemo(() => {\n    // In the project, use the project's ID directly.\n    if (myProjectId) {\n      return myProjectId;\n    }\n    if (sessionInfo?.type === IntelligenceType.Project) {\n      return sessionInfo.value;\n    }\n    return null;\n  }, [myProjectId, sessionInfo]);\n\n  // No rendering without projectId\n  if (!projectId) {\n    return null;\n  }\n\n  return (\n    <div className={css['conversation-select']}>\n      <Typography.Text fontSize=\"14px\">\n        {I18n.t('wf_chatflow_74')}\n      </Typography.Text>\n\n      <OnlyConversationSelect\n        projectId={projectId}\n        value={value}\n        onChange={setValue}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\n\nimport { useMemoizedFn } from 'ahooks';\nimport { FormPanelLayout } from '@coze-workflow/test-run';\nimport { USER_INPUT } from '@coze-workflow/base';\nimport { CreateEnv } from '@coze-arch/idl/workflow_api';\nimport {\n  IntelligenceType,\n  type IntelligenceBasicInfo,\n} from '@coze-arch/idl/intelligence_api';\n\nimport { type WorkflowNodeEntity } from '@/test-run-kit';\nimport { useGlobalState, useWorkflowRunService } from '@/hooks';\nimport { WorkflowExecStatus } from '@/entities';\nimport { useChatflowInfo } from '@/components/test-run/hooks/use-chatflow-info';\nimport { ResizableSidePanel } from '@/components/resizable-side-panel';\n\nimport { TestFormHeader } from '../test-form-header';\nimport { useTestFormSchema } from '../hooks/use-test-form-schema';\nimport {\n  useGetStartNode,\n  useGetStartNodeOutputs,\n} from '../hooks/use-get-start-node';\nimport { FieldName } from '../constants';\nimport { ChatHistory } from '../chat-history';\nimport { PanelWrap } from '../../float-layout';\nimport {\n  ChatFlowTestFormProvider,\n  useChatFlowTestFormStore,\n} from './test-form-provider';\nimport { TestFormFloatButton } from './test-form-float-button';\nimport { ChatFlowTestForm } from './test-form';\nimport { ConversationSelect } from './conversation-select';\n\nimport css from './test-form-panel.module.less';\n\nexport interface ChatFlowTestFormPanelProps {\n  node: WorkflowNodeEntity;\n}\n\nconst ChatFlowTestRunHistory = (props: {\n  projectInfo?: IntelligenceBasicInfo;\n  showInputArea?: boolean;\n}) => {\n  const { formData } = useChatFlowTestFormStore(store => ({\n    formData: store.formData,\n  }));\n  const { projectInfo, ...restProps } = props;\n  const { config } = useGlobalState();\n  const { getNode } = useGetStartNode();\n  const { getStartNodeOutputs } = useGetStartNodeOutputs();\n\n  const startNode = getNode();\n  let defaultText = '';\n  if (startNode) {\n    const outputs = getStartNodeOutputs();\n    defaultText =\n      outputs.find(output => output.name === USER_INPUT)?.defaultValue || '';\n  }\n  const runService = useWorkflowRunService();\n  const { sessionInfo, conversationInfo } = useChatflowInfo();\n  const inputData = formData?.[FieldName.Node]?.[FieldName.Input];\n  const projectOrBotInfo = sessionInfo\n    ? {\n        id: sessionInfo.value,\n        name: sessionInfo.name,\n        iconUrl: sessionInfo.avatar,\n        type: sessionInfo.type,\n      }\n    : {\n        id: projectInfo?.id || '',\n        name: projectInfo?.name || '',\n        iconUrl: projectInfo?.icon_url || '',\n        type: IntelligenceType.Project,\n      };\n\n  // Get the default value of the start node\n  return (\n    <ChatHistory\n      type={CreateEnv.Draft}\n      projectOrBotInfo={projectOrBotInfo}\n      workflowInfo={{\n        id: config.workflowId,\n        parameters: inputData,\n        header: {\n          'rpc-persist-mock-traffic-enable': '1',\n        },\n      }}\n      activateChat={{\n        unique_id: conversationInfo?.value,\n        conversation_name:\n          projectOrBotInfo?.type === IntelligenceType.Bot\n            ? projectOrBotInfo?.name\n            : conversationInfo?.label,\n        conversation_id: conversationInfo?.conversationId,\n      }}\n      onGetChatFlowExecuteId={(executeId: string) => {\n        // Help backend @zhangshiqi.live compatibility logic\n        // Do not use the newly given executeId when there is already a polling in progress\n        if (\n          runService.globalState.viewStatus === WorkflowExecStatus.EXECUTING\n        ) {\n          return;\n        }\n        runService.clearTestRun();\n        runService.getRTProcessResult({ executeId });\n      }}\n      topSlot={(isChatError?: boolean) => (\n        <TestFormFloatButton isChatError={isChatError} />\n      )}\n      defaultText={defaultText}\n      {...restProps}\n    />\n  );\n};\n\nconst ChatflowFormPanel = ({ node }: ChatFlowTestFormPanelProps) => {\n  const { visible, patch } = useChatFlowTestFormStore(store => ({\n    visible: store.visible,\n    patch: store.patch,\n  }));\n  const { generate } = useTestFormSchema();\n  const init = useMemoizedFn(async () => {\n    const schema = await generate();\n    if (schema?.fields.length) {\n      patch({ visible: true, hasForm: true });\n    }\n  });\n  useEffect(() => {\n    // Open by default\n    init();\n  }, []);\n  return visible ? <ChatFlowTestForm node={node} /> : null;\n};\n\nexport const ChatFlowTestFormPanel: React.FC<ChatFlowTestFormPanelProps> = ({\n  node,\n}) => {\n  const { getProjectApi } = useGlobalState();\n  const projectInfo = getProjectApi()?.ideGlobalStore(\n    store => store.projectInfo?.projectInfo,\n  );\n\n  return (\n    <PanelWrap layout=\"vertical\">\n      <ChatFlowTestFormProvider>\n        <ResizableSidePanel>\n          <FormPanelLayout className={css['test-form']}>\n            <TestFormHeader />\n            <ConversationSelect />\n            <ChatFlowTestRunHistory\n              projectInfo={projectInfo}\n              showInputArea={true}\n            />\n            <ChatflowFormPanel node={node} />\n          </FormPanelLayout>\n        </ResizableSidePanel>\n      </ChatFlowTestFormProvider>\n    </PanelWrap>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable complexity */\n/**\n * Adapt coze graph 2.0 node test form\n */\n\nimport { useState, useEffect, useRef, useCallback } from 'react';\n\nimport cls from 'classnames';\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { TestFormFieldName } from '@coze-workflow/test-run-next';\nimport { ResizablePanel } from '@coze-workflow/test-run';\nimport { useValidationService } from '@coze-workflow/base/services';\nimport { NodeExeStatus } from '@coze-workflow/base/api';\nimport { CONVERSATION_NAME } from '@coze-workflow/base';\nimport {\n  PremiumPaywallBanner,\n  PremiumPaywallBannerScene,\n} from '@coze-studio/premium-components-adapter';\nimport { IntelligenceType } from '@coze-arch/idl/intelligence_api';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozCross } from '@coze-arch/coze-design/icons';\nimport { IconButton, Toast, Typography } from '@coze-arch/coze-design';\n\nimport {\n  useExecStateEntity,\n  useOpenTraceListPanel,\n  useTestFormState,\n} from '@/hooks';\nimport useLogView from '@/components/test-run/hooks/use-log-view';\nimport { useChatflowInfo } from '@/components/test-run/hooks/use-chatflow-info';\n\nimport { stringifyValue } from '../utils/stringify-value';\nimport { TestFormV3 } from '../test-form-v3';\nimport { QuestionForm } from '../question-form';\nimport { InputForm } from '../input-form';\nimport { useTestRunStatus } from '../hooks/use-test-run-status';\nimport { ExecuteState } from '../execute-result/execute-result-side-sheet/components/execute-state';\nimport { FieldName } from '../constants';\nimport { TestRunState } from '../../../services/workflow-run-service';\nimport { WorkflowRunService } from '../../../services';\nimport RunningPanel from './running-panel';\nimport { ResultLog } from './result-log';\nimport { TestRunNodeButton } from './footer';\n\nimport styles from './test-node-form.module.less';\n\ninterface TestNodeFormProps {\n  node: FlowNodeEntity;\n}\n\ninterface TestNodeFormBaseProps {\n  node: FlowNodeEntity;\n  onClose: () => void;\n}\n\nexport const useShowResultNotice = (node: FlowNodeEntity) => {\n  const execEntity = useExecStateEntity();\n  const result = execEntity.getNodeExecResult(node.id);\n  const testFormState = useTestFormState();\n  const {\n    config: { testNodeFormVisible },\n  } = testFormState;\n  const hasResult =\n    !!result?.nodeStatus &&\n    [NodeExeStatus.Success, NodeExeStatus.Fail].includes(result.nodeStatus);\n\n  return hasResult && execEntity.config.isSingleMode && !testNodeFormVisible;\n};\n\nconst TestNodeResultNotice: React.FC<{ node: FlowNodeEntity }> = ({ node }) => {\n  const testFormState = useTestFormState();\n  const execEntity = useExecStateEntity();\n\n  const [transition, setTransition] = useState(false);\n\n  useEffect(() => {\n    setTimeout(() => setTransition(true));\n  }, []);\n\n  return (\n    <div\n      className={cls(styles['test-node-result-notice'], {\n        [styles['transition-show']]: transition,\n      })}\n      onClick={() => {\n        testFormState.showTestNodeForm();\n      }}\n    >\n      <div className={styles['result-notice-bg']}>\n        <Typography.Text className=\"coz-fg-hglt\" size=\"small\">\n          {I18n.t('workflow_running_results_banner')}\n        </Typography.Text>\n        <IconButton\n          icon={<IconCozCross />}\n          color=\"secondary\"\n          onClick={e => {\n            e.stopPropagation();\n            execEntity.clearNodeResult();\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst TestNodeFormCore: React.FC<TestNodeFormBaseProps> = ({\n  node,\n  onClose,\n}) => {\n  const formApiRef = useRef<any>(null);\n  const validationService = useValidationService();\n  const execEntity = useExecStateEntity();\n  const runService = useService<WorkflowRunService>(WorkflowRunService);\n\n  const panelRef = useRef<any>(null);\n  const result = execEntity.getNodeExecResult(node.id);\n  const { sessionInfo, conversationInfo } = useChatflowInfo();\n  const { running } = useTestRunStatus(node.id);\n\n  const { logNodeRef, logView } = useLogView();\n\n  const showResult =\n    !!result?.nodeStatus &&\n    execEntity.config.isSingleMode &&\n    [NodeExeStatus.Success, NodeExeStatus.Fail].includes(result.nodeStatus);\n\n  const testRunNodeV3 = async () => {\n    const { hasError } = await validationService.validateNode(\n      node as FlowNodeEntity,\n    );\n    if (hasError) {\n      Toast.error({\n        content: I18n.t('workflow_detail_toast_validation_failed'),\n        showClose: false,\n      });\n      panelRef.current?.minimize();\n      return;\n    }\n    if (!formApiRef.current) {\n      return;\n    }\n    panelRef.current?.maximize();\n    const { empty, validate, values } = await formApiRef.current.submit();\n    if (!validate) {\n      Toast.error(I18n.t('workflow_testrun_form_vailate_error_toast'));\n      return;\n    }\n    let input: Record<string, string> | undefined;\n    let setting: Record<string, string> | undefined;\n    let batch: Record<string, string> | undefined;\n    let related: Record<string, string> | undefined;\n    let botId: string | undefined;\n    if (!empty) {\n      input = stringifyValue(values?.[FieldName.Node]?.[FieldName.Input], [\n        'role_information',\n      ]);\n      batch = stringifyValue(values?.[FieldName.Node]?.[FieldName.Batch]);\n      setting = stringifyValue(values?.[FieldName.Node]?.[FieldName.Setting]);\n      related = values?.[TestFormFieldName.Related];\n      botId = (related?.[FieldName.Bot] as any)?.id || related?.[FieldName.Bot];\n      const conversation = related?.[TestFormFieldName.Conversation];\n      /** Although the session selector has a value, it is not used. Historical design issues, expect to be optimized later */\n      if (conversation && conversationInfo?.label) {\n        input = {\n          ...input,\n          [CONVERSATION_NAME]: conversationInfo?.label,\n        };\n      }\n    }\n    await runService.testRunOneNode({\n      input,\n      batch,\n      setting,\n      botId,\n      nodeId: node.id,\n      useProject: sessionInfo?.type === IntelligenceType.Project,\n    });\n  };\n\n  const handleSubmit = async () => {\n    // The result of closing a practice run first\n    runService.clearTestRun();\n    await testRunNodeV3();\n  };\n\n  const { open } = useOpenTraceListPanel();\n\n  const handleOpenTraceBottomSheet = useCallback(() => {\n    // will support soon\n    if (IS_OPEN_SOURCE) {\n      return;\n    }\n    open();\n  }, [open]);\n\n  const headerRender = () => (\n    <div className={'w-full flex items-center justify-between mr-[4px]'}>\n      <span className={'font-medium'}>\n        {I18n.t('workflow_detail_title_testrun')}\n      </span>\n\n      {!running && (\n        <ExecuteState\n          onClick={handleOpenTraceBottomSheet}\n          hiddenStateText\n          extra={\n            // will support soon\n            !IS_OPEN_SOURCE && (\n              <span className={'font-medium cursor-pointer'}>\n                {I18n.t('workflow_testset_view_log')}\n              </span>\n            )\n          }\n        />\n      )}\n    </div>\n  );\n\n  return (\n    <ResizablePanel\n      animation={'translateY'}\n      className={cls('test-node-form-panel', styles['test-node-form-panel'])}\n      ref={panelRef}\n      innerScrollRef={logNodeRef}\n      header={headerRender()}\n      headerExtra={\n        <PremiumPaywallBanner scene={PremiumPaywallBannerScene.Token} />\n      }\n      footer={<TestRunNodeButton node={node} onClick={() => handleSubmit()} />}\n      onClose={onClose}\n    >\n      <div className={styles['test-node-form-content']}>\n        <div\n          className={cls('w-full h-full', {\n            [styles['test-form-content-absolute']]: running,\n          })}\n        >\n          <TestFormV3 node={node} onMounted={v => (formApiRef.current = v)} />\n          {showResult ? (\n            <ResultLog result={result} node={node} extra={logView} />\n          ) : null}\n        </div>\n\n        {running ? <RunningPanel /> : null}\n      </div>\n      <QuestionForm />\n      <InputForm />\n    </ResizablePanel>\n  );\n};\n\nconst TestNodeForm: React.FC<TestNodeFormProps> = ({ node }) => {\n  const testFormState = useTestFormState();\n  const runService = useService<WorkflowRunService>(WorkflowRunService);\n  const {\n    config: { testNodeFormVisible },\n  } = testFormState;\n\n  const handleClose = useCallback(() => {\n    testFormState.closeTestNodeForm();\n    if (\n      runService.testRunState === TestRunState.Executing ||\n      runService.testRunState === TestRunState.Paused\n    ) {\n      runService.cancelTestRun();\n    }\n  }, [testFormState, runService]);\n\n  if (!testNodeFormVisible) {\n    return null;\n  }\n\n  return <TestNodeFormCore node={node} onClose={handleClose} />;\n};\n\nexport { TestNodeForm, TestNodeResultNotice };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Node side window\n */\nimport {\n  type PropsWithChildren,\n  type FC,\n  useEffect,\n  useState,\n  useMemo,\n} from 'react';\n\nimport classnames from 'classnames';\nimport { type NodeMeta } from '@coze-workflow/base/types';\nimport { concatNodeTestId } from '@coze-workflow/base';\nimport {\n  FlowNodeFormData,\n  NodeRender,\n} from '@flowgram-adapter/free-layout-editor';\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  NodeFormPanelContext,\n  useNodeFormPanelState,\n} from '@/hooks/use-node-side-sheet-store';\nimport {\n  useTestFormState,\n  useFloatLayoutSize,\n  useFloatLayoutService,\n} from '@/hooks';\nimport { useSidePanelWidth } from '@/components/resizable-side-panel/use-side-panel-width';\nimport { ResizableSidePanel } from '@/components/resizable-side-panel';\n\nimport {\n  TestNodeForm,\n  TestNodeResultNotice,\n  useShowResultNotice,\n} from '../test-run/test-form-sheet-v2/test-node-form';\nimport { NodeContextProvider } from '../node-context-provider';\nimport { PanelWrap } from '../float-layout';\nimport { EditorThemeProvider } from '../editor-container';\n\nimport styles from './index.module.less';\n\nconst PADDING = 16;\n\nconst NodeFormPanelProvider: React.FC<React.PropsWithChildren> = ({\n  children,\n}) => {\n  const [fullscreenPanel, setFullscreenPanel] = useState<React.ReactNode>(null);\n\n  return (\n    <NodeFormPanelContext.Provider\n      value={{ fullscreenPanel, setFullscreenPanel }}\n    >\n      {children}\n    </NodeFormPanelContext.Provider>\n  );\n};\n\nconst NodeSideSheetPanel: FC<\n  PropsWithChildren<{\n    width?: number | string;\n    className?: string;\n  }>\n> = props => {\n  const { width, children, className } = props;\n  return (\n    <div\n      className={classnames(className, 'h-full flex-none overflow-auto')}\n      style={{\n        width,\n      }}\n    >\n      {children}\n    </div>\n  );\n};\n\nexport interface NodeFormPanelProps {\n  node: FlowNodeEntity;\n  showTestNodeForm?: boolean;\n}\n\nexport const NodeSideSheet: React.FC<NodeFormPanelProps> = ({\n  node,\n  showTestNodeForm,\n}) => {\n  const testFormState = useTestFormState();\n  const floatLayoutService = useFloatLayoutService();\n  const showTestRunResultNotice = useShowResultNotice(node);\n  const {\n    config: { testNodeFormVisible },\n  } = testFormState;\n\n  const { width: layoutWidth } = useFloatLayoutSize();\n\n  const { fullscreenPanel } = useNodeFormPanelState();\n\n  const { width: sideWidth } = useSidePanelWidth();\n\n  const leftFullWidth = useMemo(\n    () => layoutWidth - sideWidth - PADDING,\n    [layoutWidth, sideWidth],\n  );\n\n  useEffect(() => {\n    if (showTestNodeForm) {\n      testFormState.showTestNodeForm();\n    } else {\n      testFormState.closeTestNodeForm();\n    }\n  }, [showTestNodeForm, node]);\n\n  // This panel needs to be closed when a node is deleted\n  useEffect(() => {\n    const disposable = node.onDispose(() => {\n      floatLayoutService.close();\n    });\n    return () => disposable.dispose();\n  }, [node, floatLayoutService]);\n\n  if (!node) {\n    return null;\n  }\n\n  const nodeMeta: NodeMeta = node.getNodeMeta();\n\n  if (nodeMeta.disableSideSheet) {\n    return null;\n  }\n\n  const { formModel } = node.getData(FlowNodeFormData);\n  const { initialized } = formModel;\n\n  if (!initialized) {\n    return null;\n  }\n\n  return (\n    <PanelWrap layout=\"vertical\">\n      <NodeContextProvider\n        key={node?.id?.toString()}\n        node={node}\n        scene=\"node-side-sheet\"\n      >\n        <EditorThemeProvider>\n          <ResizableSidePanel bypass={!!fullscreenPanel}>\n            <div\n              className={classnames(\n                styles['node-side-sheet'],\n                'rounded-lg coz-bg-plus flex h-full overflow-hidden',\n              )}\n            >\n              {fullscreenPanel ? (\n                <NodeSideSheetPanel\n                  className=\"coz-stroke-primary border-0 border-r border-solid !flex-1\"\n                  width={leftFullWidth}\n                >\n                  {fullscreenPanel}\n                </NodeSideSheetPanel>\n              ) : null}\n              <ResizableSidePanel\n                className=\"relative h-full flex-none\"\n                bypass={!fullscreenPanel}\n              >\n                <NodeSideSheetPanel width={sideWidth}>\n                  <div\n                    className={classnames(\n                      'px-3 pb-4',\n                      styles['node-side-sheet-form'],\n                      {\n                        [styles['has-result-notice']]:\n                          showTestRunResultNotice || testNodeFormVisible,\n                      },\n                    )}\n                    data-testid={concatNodeTestId(node, 'node-side-sheet-form')}\n                  >\n                    <NodeRender node={node} />\n                  </div>\n                  <TestNodeForm node={node} />\n                  {showTestRunResultNotice ? (\n                    <TestNodeResultNotice node={node} />\n                  ) : null}\n                </NodeSideSheetPanel>\n              </ResizableSidePanel>\n            </div>\n          </ResizableSidePanel>\n        </EditorThemeProvider>\n      </NodeContextProvider>\n    </PanelWrap>\n  );\n};\n\nexport const NodeFormPanel: React.FC<NodeFormPanelProps> = props => (\n  <NodeFormPanelProvider>\n    <NodeSideSheet {...props} />\n  </NodeFormPanelProvider>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useMemo, useEffect } from 'react';\n\nimport { useMemoizedFn } from 'ahooks';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowSelectService } from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  WorkflowRunService,\n  TestRunState,\n} from '@/services/workflow-run-service';\nimport { type PanelInfo } from '@/services/workflow-float-layout-service';\nimport { useFloatLayoutService } from '@/hooks';\nimport { LayoutPanelKey } from '@/constants';\n\nimport {\n  TraceListPanel,\n  TraceDetailPanel,\n  type TraceListPanelProps,\n  type TraceDetailPanelProps,\n} from '../test-run/trace';\nimport {\n  StartTestFormSheet,\n  type TestWorkflowFormPanelProps,\n} from '../test-run/test-form-sheet-v2';\nimport {\n  ChatFlowTestFormPanel,\n  type ChatFlowTestFormPanelProps,\n} from '../test-run/chat-flow-test-form-panel';\nimport { NodeFormPanel, type NodeFormPanelProps } from '../node-side-sheet';\nimport { RoleConfigPanel } from '../flow-role';\nimport { FloatLayout, type FloatLayoutProps } from '../float-layout';\n\nconst useCloseNodeFormWhenBlur = () => {\n  const selectService = useService(WorkflowSelectService);\n  const floatLayoutService = useFloatLayoutService();\n  const runService = useService<WorkflowRunService>(WorkflowRunService);\n  useEffect(() => {\n    const disposable = selectService.onSelectionChanged(() => {\n      const running = [TestRunState.Executing, TestRunState.Paused].includes(\n        runService.testRunState,\n      );\n      if (\n        !selectService.activatedNode &&\n        floatLayoutService.right.key === LayoutPanelKey.NodeForm &&\n        !running\n      ) {\n        floatLayoutService.close();\n      }\n    });\n    return () => disposable.dispose();\n  }, [selectService, floatLayoutService, runService]);\n};\n\n/**\n * Try canceling practice run after closing the node and practice run panel\n */\nconst useCancelTestRunWhenClosePanel = () => {\n  const floatLayoutService = useFloatLayoutService();\n  const runService = useService<WorkflowRunService>(WorkflowRunService);\n  const tryCancelTestRun = useMemoizedFn((info: PanelInfo) => {\n    const { key } = info;\n    const running = [TestRunState.Executing, TestRunState.Paused].includes(\n      runService.testRunState,\n    );\n    if (\n      running &&\n      [\n        LayoutPanelKey.NodeForm,\n        LayoutPanelKey.TestFlowForm,\n        LayoutPanelKey.TestChatFlowForm,\n      ].includes(key as LayoutPanelKey)\n    ) {\n      runService.cancelTestRun();\n    }\n  });\n\n  useEffect(() => {\n    const disposable = floatLayoutService.onUnmount(tryCancelTestRun);\n\n    return () => disposable.dispose();\n  }, [floatLayoutService, tryCancelTestRun]);\n};\n\nexport const WorkflowFloatLayout: React.FC<\n  React.PropsWithChildren<FloatLayoutProps>\n> = ({ components, children }) => {\n  const registry = useMemo(\n    () => ({\n      ...components,\n      [LayoutPanelKey.NodeForm]: (p: NodeFormPanelProps) => (\n        <NodeFormPanel {...p} />\n      ),\n      [LayoutPanelKey.TestFlowForm]: (p: TestWorkflowFormPanelProps) => (\n        <StartTestFormSheet {...p} />\n      ),\n      [LayoutPanelKey.TraceList]: (p: TraceListPanelProps) => (\n        <TraceListPanel {...p} />\n      ),\n      [LayoutPanelKey.TestChatFlowForm]: (p: ChatFlowTestFormPanelProps) => (\n        <ChatFlowTestFormPanel {...p} />\n      ),\n      [LayoutPanelKey.RoleConfig]: () => <RoleConfigPanel />,\n      traceDetail: (p: TraceDetailPanelProps) => <TraceDetailPanel {...p} />,\n    }),\n    [components],\n  );\n\n  useCancelTestRunWhenClosePanel();\n\n  useCloseNodeFormWhenBlur();\n\n  return <FloatLayout components={registry}>{children}</FloatLayout>;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Helmet } from 'react-helmet';\nimport { useDrop } from 'react-dnd';\nimport {\n  forwardRef,\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  type DragEventHandler,\n} from 'react';\n\nimport classnames from 'classnames';\nimport { QueryClientProvider } from '@tanstack/react-query';\nimport {\n  PlaygroundReactRenderer,\n  useService,\n} from '@flowgram-adapter/free-layout-editor';\nimport { EncapsulatePanel } from '@coze-workflow/feature-encapsulate';\nimport { workflowQueryClient } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { Spin } from '@coze-arch/bot-semi';\nimport { getFlags } from '@coze-arch/bot-flags';\nimport { CustomError } from '@coze-arch/bot-error';\nimport { type BotSpace } from '@coze-arch/bot-api/developer_api';\n\nimport { AddNodeModalProvider } from '@/contexts/add-node-modal-context';\n\nimport { WorkflowRefreshModal } from '../workflow-refresh-modal';\nimport { WorkflowOuterSideSheetHolder } from '../workflow-outer-side-sheet';\nimport { WorkflowInnerSideSheetHolder } from '../workflow-inner-side-sheet';\nimport { useCommitAction } from '../workflow-header/components/history-button/components/history-drawer/use-commit-action';\nimport WorkflowHeader from '../workflow-header';\nimport { Toolbar } from '../toolbar';\nimport { useResultSideSheetVisible } from '../test-run/execute-result/execute-result-side-sheet/hooks/use-result-side-sheet-visible';\nimport { TemplatePanel, TemplatePreview } from '../template-panel';\nimport RetrieveBanner from '../retrieve-banner';\nimport { ProblemPanel } from '../problem-panel';\nimport { ModifyBanner } from '../modify-banner';\nimport { DragTooltip } from '../drag-tooltip';\nimport { DatabaseDetailModal } from '../database-detail-modal';\nimport { ChatTestRunPauseSideSheet } from '../chat-testrun-pause-side-sheet';\nimport {\n  type AddNodeRef,\n  type WorkflowPlaygroundProps,\n  type WorkflowPlaygroundRef,\n  type DragObject,\n} from '../../typing';\nimport { WorkflowCustomDragService, WorkflowSaveService } from '../../services';\nimport { useTestRun } from '../../hooks/use-test-run';\nimport {\n  useFloatLayoutService,\n  useGlobalState,\n  useScrollToNode,\n  useWorkflowRunService,\n  useDependencyService,\n} from '../../hooks';\nimport {\n  DND_ACCEPT_KEY,\n  WORKFLOW_PLAYGROUND_CONTENT_ID,\n} from '../../constants';\nimport { WorkflowFloatLayout } from './workflow-float-layout';\nimport { useNodesMount } from './use-nodes-mount';\nimport { useDataCompensation } from './use-data-compensation';\n\nimport styles from './index.module.less';\n\n/**\n * Process Canvas\n */\nconst WorkflowContainer = forwardRef<\n  WorkflowPlaygroundRef,\n  WorkflowPlaygroundProps & {\n    spaceList: BotSpace[];\n  }\n>((props, ref) => {\n  const workflowState = useGlobalState();\n  const workflowSaveService =\n    useService<WorkflowSaveService>(WorkflowSaveService);\n  const dependencyService = useDependencyService();\n  const floatLayoutService = useFloatLayoutService();\n  const runService = useWorkflowRunService();\n  const { handleTestRun, cancelTestRun } = useTestRun({ callbacks: props });\n  const { resetToCommitById } = useCommitAction();\n  const { closeSideSheetAndHideResult, showResult } =\n    useResultSideSheetVisible();\n  const { loading, loadingError, readonly, isBindDouyin } = workflowState;\n  let playgroundContent;\n  const addNodeRef = useRef<AddNodeRef>(null);\n  const hasFitView = useRef<boolean>(false);\n  const isNodesMount = useNodesMount();\n  // Synchronize component properties to globalStatus\n  useMemo(() => {\n    const { spaceList, ...playgroundProps } = props;\n\n    workflowState.updateConfig({\n      playgroundProps,\n      spaceList,\n    });\n  }, [props]);\n\n  // Initialization successful\n  useEffect(() => {\n    if (!loading && !loadingError && isNodesMount) {\n      props.onInit?.(workflowState);\n    }\n  }, [loading, isNodesMount, loadingError, workflowState]);\n\n  // Listen for TTI events, perform data compensation operations, and save drafts\n  useDataCompensation(workflowState);\n\n  const onDragOver: DragEventHandler<HTMLDivElement> = useCallback(event => {\n    event.preventDefault();\n    if (event.dataTransfer) {\n      event.dataTransfer.dropEffect = 'move';\n    }\n  }, []);\n\n  const dragService = useService<WorkflowCustomDragService>(\n    WorkflowCustomDragService,\n  );\n\n  const [, drop] = useDrop(() => ({\n    accept: DND_ACCEPT_KEY,\n    canDrop: (item: DragObject, monitor) =>\n      dragService.canDrop({\n        coord: monitor.getSourceClientOffset() ?? { x: 0, y: 0 },\n        dragNode: {\n          type: item.nodeType,\n          json: item.nodeJson,\n        },\n      }),\n    drop: (item: DragObject, monitor) => {\n      const coord = monitor.getClientOffset() ?? { x: 0, y: 0 };\n      addNodeRef.current?.handleAddNode?.(item, coord, true);\n    },\n  }));\n\n  const scrollToNode = useScrollToNode();\n\n  useImperativeHandle(ref, () => ({\n    triggerTestRun: async () => {\n      await handleTestRun();\n      return true;\n    },\n    getProcess: async (obj: { executeId?: string }) => {\n      await runService.getRTProcessResult(obj);\n    },\n    reload: async () => {\n      floatLayoutService.closeAll();\n      await workflowSaveService.reloadDocument();\n      props.onInit?.(workflowState);\n    },\n    cancelTestRun: () => cancelTestRun(),\n    showTestRunResult: (executeIdOrResp, subExecuteId) => {\n      if (!executeIdOrResp) {\n        // Show results of the latest practice run\n        showResult();\n      } else if (typeof executeIdOrResp === 'string') {\n        // Display the result of the specified run ID\n        showResult({ executeId: executeIdOrResp, subExecuteId });\n      } else {\n        // Direct display of results\n        showResult({ processResp: executeIdOrResp });\n      }\n    },\n    hideTestRunResult: () => {\n      closeSideSheetAndHideResult();\n    },\n    resetToHistory: ({ commitId, optType }) => {\n      resetToCommitById(commitId, optType);\n    },\n    scrollToNode: (nodeId: string) => {\n      if (nodeId) {\n        scrollToNode(nodeId);\n      }\n    },\n    triggerFitView: async () => {\n      if (!hasFitView.current) {\n        await workflowSaveService.fitView();\n        hasFitView.current = true;\n      }\n    },\n    loadGlobalVariables: async () => {\n      await workflowSaveService.loadGlobalVariables();\n    },\n    onResourceChange: (resourceProps, callback) =>\n      dependencyService.updateDependencySources(resourceProps, callback),\n  }));\n\n  if (loading) {\n    playgroundContent = (\n      <Spin spinning={true} style={{ height: '100%', width: '100%' }} />\n    );\n  } else if (loadingError) {\n    // Trigger exception, go to the top error boundary fallback\n    throw new CustomError('normal_error', loadingError);\n  } else {\n    const Sidebar = props.sidebar;\n\n    // When the workflow is binded to Douyin Accountthe template preview is not displayed\n    const showTemplatePreview = !isBindDouyin;\n    playgroundContent = (\n      <QueryClientProvider client={workflowQueryClient}>\n        <div className=\"flex flex-1 h-full\">\n          <div className=\"flex flex-1 flex-col\">\n            {props.renderHeader ? (\n              props.renderHeader({ handleTestRun })\n            ) : (\n              <WorkflowHeader />\n            )}\n            <RetrieveBanner />\n            {/* No need to display within the project */}\n            {!workflowState.projectId && <ModifyBanner />}\n            <div className={`${styles.workflowContent} clean-code`}>\n              {!readonly && Sidebar ? <Sidebar ref={addNodeRef} /> : null}\n              <AddNodeModalProvider ref={addNodeRef} readonly={readonly}>\n                <div\n                  id={WORKFLOW_PLAYGROUND_CONTENT_ID}\n                  className={styles.workflowPlayground}\n                >\n                  <div\n                    ref={drop}\n                    className={styles.workflowPlaygroundRender}\n                    // onDrop={onDrop}\n                    onDragOver={onDragOver}\n                  >\n                    <PlaygroundReactRenderer />\n\n                    <DragTooltip />\n\n                    <WorkflowFloatLayout\n                      components={{\n                        problemPanel: () => <ProblemPanel />,\n                        templatePanel: () =>\n                          showTemplatePreview ? <TemplatePanel /> : null,\n                      }}\n                    >\n                      <Toolbar\n                        disableTraceAndTestRun={props?.disableTraceAndTestRun}\n                      />\n                      {showTemplatePreview ? <TemplatePreview /> : null}\n                      {getFlags()['bot.automation.encapsulate'] ? (\n                        <EncapsulatePanel />\n                      ) : null}\n                    </WorkflowFloatLayout>\n                    <WorkflowRefreshModal />\n                  </div>\n                </div>\n              </AddNodeModalProvider>\n              {/* The space occupied by the local pull window used to render the interior of the canvas will squeeze the canvas */}\n              <WorkflowInnerSideSheetHolder />\n            </div>\n          </div>\n          <WorkflowOuterSideSheetHolder />\n        </div>\n        <ChatTestRunPauseSideSheet />\n      </QueryClientProvider>\n    );\n  }\n\n  return (\n    <>\n      {!workflowState.projectId && (\n        <Helmet>\n          <title>\n            {I18n.t('workflow_tab_title', {\n              name: workflowState.info?.name,\n            })}\n          </title>\n        </Helmet>\n      )}\n\n      <div\n        className={classnames({\n          [styles.workflowContainer]: true,\n          [styles.workflowContainerOp]: IS_BOT_OP,\n          [props.className || '']: props.className,\n        })}\n        style={props.style}\n      >\n        {playgroundContent}\n\n        <DatabaseDetailModal />\n      </div>\n    </>\n  );\n});\n\nexport default WorkflowContainer;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\n\nimport {\n  StandardNodeType,\n  reporter,\n  isUserInputStartParams,\n} from '@coze-workflow/base';\nimport {\n  LoggerEvent,\n  LoggerService,\n  useService,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { WorkflowSaveService } from '../../services/workflow-save-service';\nimport { type WorkflowGlobalStateEntity } from '../../entities';\n\n/**\n * Whether the imported parameter BotUserInput of the start node has been compensated for (changed from required to non-required)\n * Changed the required settings in packages/workflow/nodes/src/workflow-nodes/start-node/index.ts\n * @param schemaJson\n * @returns\n */\nexport function isBotUserInputChanged(schemaJson: string | undefined): boolean {\n  if (!schemaJson) {\n    return false;\n  }\n\n  const schema = JSON.parse(schemaJson || '');\n  const startNode = schema?.nodes?.find(v => v.type === StandardNodeType.Start);\n  const startOutputs = startNode?.data?.outputs || [];\n  const botUserInput = startOutputs.find(v => isUserInputStartParams(v.name));\n\n  return Boolean(botUserInput?.required);\n}\n\nexport function useDataCompensation(workflowState: WorkflowGlobalStateEntity) {\n  const workflowSaveService =\n    useService<WorkflowSaveService>(WorkflowSaveService);\n  const loggerService = useService<LoggerService>(LoggerService);\n\n  useEffect(() => {\n    const disposable = loggerService.onLogger(({ event }) => {\n      if (event === LoggerEvent.CANVAS_TTI) {\n        // When reporting TTI, the node canvas layer is rendered\n\n        const { inPluginUpdated } = workflowState || {};\n        const isBotUserInputUpdated = isBotUserInputChanged(\n          workflowState?.info?.schema_json,\n        );\n\n        const needDataCompensation = inPluginUpdated || isBotUserInputUpdated;\n        if (needDataCompensation) {\n          reporter.event({\n            eventName: 'workflow_data_compensation_save',\n          });\n\n          // Data Compensation Save to Draft\n          workflowSaveService.highPrioritySave();\n        }\n      }\n    });\n\n    return () => {\n      disposable?.dispose();\n    };\n  }, []);\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useLayoutEffect, useState } from 'react';\n\nimport {\n  LoggerEvent,\n  LoggerService,\n  useService,\n} from '@flowgram-adapter/free-layout-editor';\n\nexport function useNodesMount() {\n  const [isMounted, setMounted] = useState(false);\n  const loggerService = useService<LoggerService>(LoggerService);\n\n  useLayoutEffect(() => {\n    const disposable = loggerService.onLogger(({ event }) => {\n      if (event === LoggerEvent.CANVAS_TTI) {\n        setMounted(true);\n      }\n    });\n\n    return () => {\n      disposable?.dispose();\n    };\n  }, []);\n\n  return isMounted;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Button, Popover, Typography } from '@coze-arch/coze-design';\n\nimport styles from './force-push-popover.module.less';\n\ninterface ForcePushPopoverContentProps {\n  title?: string;\n  description?: string;\n  mainButtonText?: string;\n  onOpenTestRun: () => void;\n  onForcePush: () => void;\n  onCancel: () => void;\n}\n\nconst ForcePushPopoverContent: React.FC<ForcePushPopoverContentProps> = ({\n  title,\n  description,\n  mainButtonText,\n  onOpenTestRun,\n  onForcePush,\n  onCancel,\n}) => (\n  <div className={styles['popover-content']}>\n    <Typography.Text strong>{title}</Typography.Text>\n    <br />\n    <Typography.Text type=\"secondary\" size=\"small\">\n      {description}\n    </Typography.Text>\n    <div className={styles['popover-btns']}>\n      <Button size=\"small\" color=\"hgltplus\" onClick={onOpenTestRun}>\n        {I18n.t('workflow_detail_title_testrun')}\n      </Button>\n      <Button size=\"small\" color=\"primary\" onClick={onForcePush}>\n        {mainButtonText}\n      </Button>\n      <Button size=\"small\" color=\"primary\" onClick={onCancel}>\n        {I18n.t('workflow_list_create_modal_footer_cancel')}\n      </Button>\n    </div>\n  </div>\n);\n\ninterface ForcePushPopoverProps {\n  visible: boolean;\n  title?: string;\n  description?: string;\n  mainButtonText?: string;\n  onOpenTestRun: () => void;\n  onForcePush: () => void;\n  onCancel: () => void;\n}\n\nexport const ForcePushPopover: React.FC<\n  React.PropsWithChildren<ForcePushPopoverProps>\n> = ({ visible, children, ...props }) => (\n  <Popover\n    visible={visible}\n    trigger=\"custom\"\n    position=\"bottomRight\"\n    content={<ForcePushPopoverContent {...props} />}\n  >\n    {children}\n  </Popover>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useMemo } from 'react';\n\nimport {\n  VCSCanvasType,\n  WorkFlowDevStatus,\n  WorkFlowStatus,\n} from '@coze-workflow/base/api';\n\nimport { useValidateWorkflow } from '@/hooks/use-validate-workflow';\nimport {\n  useGlobalState,\n  useFloatLayoutService,\n  useTestRunReporterService,\n} from '@/hooks';\n\nimport { useTestRunFlowV2 } from '../../../test-run/hooks/use-test-run-flow-v2';\n\nexport const useForcePush = () => {\n  const [visible, setVisible] = useState(false);\n  const testRunReporterService = useTestRunReporterService();\n  const { isCollaboratorMode, info, inPluginUpdated } = useGlobalState();\n  const { validate } = useValidateWorkflow();\n  const { testRunFlow } = useTestRunFlowV2();\n  const floatLayoutService = useFloatLayoutService();\n\n  const { status, vcsData } = info;\n  const { type } = vcsData || {};\n\n  const needTestRun = useMemo(() => {\n    // When the plugin is updated, it needs to be re-testrun.\n    if (inPluginUpdated) {\n      return true;\n    }\n    if (isCollaboratorMode) {\n      // Draft status, and the status is not submittable, you need to re-testrun\n      if (info.vcsData?.type === VCSCanvasType.Draft) {\n        return (\n          info.status !== WorkFlowDevStatus.CanSubmit &&\n          info.status !== WorkFlowDevStatus.HadSubmit\n        );\n      }\n      return false;\n    } else {\n      return (\n        info.status !== WorkFlowStatus.CanPublish &&\n        info.status !== WorkFlowStatus.HadPublished\n      );\n    }\n  }, [isCollaboratorMode, status, type, inPluginUpdated]);\n\n  const tryPushCheck = async () => {\n    /** Validation Process */\n    if (await validate()) {\n      floatLayoutService.open('problemPanel', 'bottom');\n      return false;\n    }\n    /** Need test run */\n    if (needTestRun) {\n      setVisible(true);\n      return false;\n    }\n    return true;\n  };\n\n  const handleCancel = () => setVisible(false);\n\n  const handleTestRun = () => {\n    setVisible(false);\n    testRunReporterService.tryStart({\n      scene: 'publish',\n    });\n    testRunFlow();\n  };\n\n  return {\n    visible,\n    tryPushCheck,\n    onCancel: handleCancel,\n    onTestRun: handleTestRun,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable max-lines-per-function */\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport {\n  workflowApi,\n  type VersionMetaInfo,\n  OperateType,\n} from '@coze-workflow/base/api';\nimport { reporter } from '@coze-arch/logger';\nimport { I18n } from '@coze-arch/i18n';\nimport { Toast, Modal } from '@coze-arch/coze-design';\nimport { EVENT_NAMES, sendTeaEvent } from '@coze-arch/bot-tea';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { useNavigate } from 'react-router-dom';\n\nimport {\n  WorkflowSaveService,\n  WorkflowRunService,\n} from '../../../../../../services';\nimport { useGlobalState } from '../../../../../../hooks';\n\nconst revertConfirm = () =>\n  new Promise(resolve => {\n    Modal.warning({\n      title: I18n.t('workflow_publish_multibranch_revert_confirm_title'),\n      content: I18n.t('workflow_publish_multibranch_revert_confirm_content'),\n      okText: I18n.t('confirm'),\n      cancelText: I18n.t('cancel'),\n      onOk: () => resolve(true),\n      onCancel: () => resolve(false),\n    });\n  });\n\nexport function useCommitAction() {\n  const navigate = useNavigate();\n  const globalState = useGlobalState();\n  const saveService = useService<WorkflowSaveService>(WorkflowSaveService);\n  const runService = useService<WorkflowRunService>(WorkflowRunService);\n\n  const showCurrent = async () => {\n    await saveService.reloadDocument({});\n  };\n\n  const resetToCommit = async (item: VersionMetaInfo) => {\n    const confirmed = await revertConfirm();\n\n    if (!confirmed) {\n      return;\n    }\n\n    sendTeaEvent(EVENT_NAMES.workflow_submit_version_revert, {\n      workflow_id: globalState.workflowId,\n      workspace_id: globalState.spaceId,\n      version_id: item.submit_commit_id || item.commit_id || '',\n    });\n\n    try {\n      // Priority is given to using the commit ID to operate, and the commit ID is fixed to the OperateType. SubmitOperate type\n      await workflowApi.RevertDraft({\n        workflow_id: globalState.workflowId,\n        space_id: globalState.spaceId,\n        commit_id: item.submit_commit_id || item.commit_id || '',\n        type:\n          (item.submit_commit_id ? OperateType.SubmitOperate : item.type) ??\n          OperateType.SubmitOperate,\n        env: item.submit_commit_id ? '' : item.env,\n      });\n      reporter.successEvent({\n        eventName: 'workflow_revert_success',\n        namespace: 'workflow',\n      });\n\n      Toast.success({\n        content: I18n.t('workflow_publish_multibranch_revert_success'),\n        showClose: false,\n      });\n    } catch (error) {\n      reporter.errorEvent({\n        eventName: 'workflow_revert_fail',\n        namespace: 'workflow',\n        error,\n      });\n    }\n\n    await showCurrent();\n\n    return true;\n  };\n\n  const resetToCommitById = async (commitId: string, type?: OperateType) => {\n    const resp = await workflowApi.VersionHistoryList({\n      workflow_id: globalState.workflowId,\n      space_id: globalState.spaceId,\n      type: type ?? OperateType.SubmitOperate,\n      commit_ids: [commitId],\n      limit: 1,\n    });\n\n    const target = resp?.data?.version_list?.[0];\n\n    if (!target) {\n      return;\n    }\n\n    await resetToCommit(target);\n  };\n\n  const viewCommit = async (item: VersionMetaInfo) => {\n    if (!item.commit_id || !item.type) {\n      return;\n    }\n\n    sendTeaEvent(EVENT_NAMES.workflow_submit_version_view, {\n      workflow_id: globalState.workflowId,\n      workspace_id: globalState.spaceId,\n      version_id: item.commit_id,\n    });\n\n    if (item.submit_commit_id) {\n      await saveService.reloadDocument({\n        commitId: item.submit_commit_id,\n        type: OperateType.SubmitOperate,\n      });\n    } else {\n      await saveService.reloadDocument({\n        commitId: item.commit_id,\n        type: item.type,\n        env: item.env,\n      });\n    }\n    // You need to dry run results after switching versions\n    runService.clearTestRun();\n  };\n\n  const viewCommitNewPage = (item: VersionMetaInfo) => {\n    const query = new URLSearchParams();\n    query.append('space_id', item.space_id || '');\n    query.append('workflow_id', item.workflow_id || '');\n\n    if (item.submit_commit_id) {\n      query.append('version', item.submit_commit_id || '');\n    } else {\n      if (item.type) {\n        query.append('opt_type', item.type.toString());\n      }\n      query.append('version', item.commit_id || '');\n    }\n\n    const targetUrl = `/work_flow?${query.toString()}`;\n\n    window.open(targetUrl, '_blank');\n  };\n\n  const publishPPE = (item: VersionMetaInfo) => {\n    navigate(\n      `/space/${item.space_id}/workflow/${item.workflow_id}/publish?commit_id=${item.commit_id}&type=${item.type}`,\n      { replace: true },\n    );\n  };\n\n  return {\n    resetToCommit,\n    viewCommit,\n    publishPPE,\n    showCurrent,\n    resetToCommitById,\n    viewCommitNewPage,\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport { type FC, useState, useEffect, useMemo } from 'react';\n\nimport { WorkflowCommitList } from '@coze-workflow/components';\nimport { OperateType } from '@coze-workflow/base/api';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  Button,\n  IconButton,\n  Typography,\n  SideSheet,\n  Select,\n} from '@coze-arch/coze-design';\nimport { EVENT_NAMES, sendTeaEvent } from '@coze-arch/bot-tea';\nimport { IconCloseNoCycle } from '@coze-arch/bot-icons';\nimport { useNavigate } from 'react-router-dom';\n\nimport { useFloatLayoutService } from '@/hooks';\n\nimport { getWorkflowOuterSideSheetHolder } from '../../../../../../utils/get-workflow-outer-side-sheet-holder';\nimport { useGlobalState } from '../../../../../../hooks';\nimport { useCommitAction } from './use-commit-action';\n\ninterface HistoryDrawerProps {\n  spaceId: string;\n  workflowId: string;\n  visible;\n  value?: string;\n  enablePublishPPE?: boolean;\n  onClose?: () => void;\n}\n\nconst defaultTabOptions = [\n  {\n    value: OperateType.SubmitPublishPPEOperate,\n    label: I18n.t('query_status_all'),\n  },\n  {\n    value: OperateType.SubmitOperate,\n    label: I18n.t('workflow_publish_multibranch_submitted_title'),\n  },\n  {\n    value: OperateType.PubPPEOperate,\n    label: I18n.t('bmv_ppe_lane'),\n  },\n  {\n    value: OperateType.PublishOperate,\n    label: I18n.t('workflow_publish_multibranch_published_title'),\n  },\n];\n\nconst { Title } = Typography;\n\nconst defaultActiveItem = 'current';\n\nexport const HistoryDrawer: FC<HistoryDrawerProps> = ({\n  spaceId,\n  workflowId,\n  visible,\n  onClose,\n  enablePublishPPE,\n}) => {\n  const globalState = useGlobalState();\n  const navigate = useNavigate();\n  const flowLayoutService = useFloatLayoutService();\n\n  const {\n    resetToCommit,\n    viewCommit,\n    publishPPE,\n    showCurrent,\n    viewCommitNewPage,\n  } = useCommitAction();\n  const tabOptions = useMemo(() => {\n    if (enablePublishPPE) {\n      return defaultTabOptions;\n    }\n\n    return defaultTabOptions.filter(\n      item => item.value !== OperateType.PubPPEOperate,\n    );\n  }, [enablePublishPPE]);\n  const [optType, setOptType] = useState(tabOptions[0].value);\n  const [activeItem, setActiveItem] = useState(defaultActiveItem);\n\n  /**\n   * Whether to display the current version\n   */\n  const showLatest = useMemo(\n    () =>\n      optType === OperateType.SubmitOperate ||\n      optType === OperateType.SubmitPublishPPEOperate,\n    [optType],\n  );\n\n  const SideSheetTitle = () => (\n    <div className=\"flex\">\n      <Title heading={5} className=\"flex-1\">\n        {I18n.t('workflow_publish_multibranch_history')}\n      </Title>\n\n      <IconButton\n        icon={<IconCloseNoCycle />}\n        onClick={() => {\n          if (activeItem !== 'current') {\n            showCurrent();\n          }\n          onClose?.();\n        }}\n      />\n    </div>\n  );\n\n  const goPublish = () => {\n    navigate(`/space/${spaceId}/workflow/${workflowId}/publish`, {\n      replace: true,\n    });\n  };\n\n  useEffect(() => {\n    if (!visible) {\n      setActiveItem(defaultActiveItem);\n      setOptType(tabOptions[0].value);\n    }\n  }, [visible]);\n\n  useEffect(() => {\n    if (!visible) {\n      return;\n    }\n\n    sendTeaEvent(EVENT_NAMES.workflow_history_show, {\n      workspace_id: spaceId,\n      workflow_id: workflowId,\n      from: 0,\n      channel: optType,\n    });\n  }, [visible, optType]);\n\n  return (\n    <SideSheet\n      width={400}\n      visible={visible}\n      getPopupContainer={getWorkflowOuterSideSheetHolder}\n      title={<SideSheetTitle />}\n      // During the animation, the scrollWidth of the parent container will be stretched open, resulting in the scrollbar. Trigger a recalculation after the animation to make the scrollbar disappear\n      afterVisibleChange={() => requestAnimationFrame(() => undefined)}\n      closable={false}\n      mask={false}\n      maskClosable={false}\n      footer={\n        enablePublishPPE ? (\n          <Button\n            className=\"w-full\"\n            color=\"highlight\"\n            onClick={() => {\n              sendTeaEvent(EVENT_NAMES.workflow_pre_release_ppe, {\n                workspace_id: globalState.spaceId,\n                workflow_id: globalState.workflowId,\n                channel: 1,\n              });\n              goPublish();\n            }}\n          >\n            {I18n.t('bwc_view_multiple_environments')}\n          </Button>\n        ) : undefined\n      }\n    >\n      <Select\n        optionList={tabOptions}\n        value={optType}\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        onChange={(e: any) => {\n          setOptType(e);\n        }}\n        className=\"w-full\"\n      />\n      <WorkflowCommitList\n        className=\"mt-3\"\n        showCurrent={showLatest}\n        value={activeItem}\n        enablePublishPPE={enablePublishPPE}\n        spaceId={spaceId}\n        workflowId={workflowId}\n        type={optType}\n        hideCommitId={!globalState.isDevSpace}\n        onResetToCommit={async item => {\n          const isSuccess = await resetToCommit(item);\n          if (isSuccess) {\n            onClose?.();\n          }\n        }}\n        onShowCommit={viewCommitNewPage}\n        onPublishPPE={item => {\n          sendTeaEvent(EVENT_NAMES.workflow_pre_release_ppe, {\n            workspace_id: globalState.spaceId,\n            workflow_id: globalState.workflowId,\n            channel: 2,\n          });\n          publishPPE(item);\n        }}\n        onCurrentClick={key => {\n          if (activeItem === key) {\n            return;\n          }\n\n          setActiveItem(key);\n          showCurrent();\n          flowLayoutService.closeAll();\n        }}\n        onItemClick={item => {\n          if (activeItem === item.commit_id) {\n            return;\n          }\n\n          setActiveItem(item.commit_id || '');\n          viewCommit(item);\n          flowLayoutService.closeAll();\n        }}\n      />\n    </SideSheet>\n  );\n};\n\nexport function useHistoryDrawer({\n  ...props\n}: Omit<HistoryDrawerProps, 'visible' | 'onClose'>) {\n  const [visible, setVisible] = useState(false);\n\n  const node = (\n    <HistoryDrawer\n      visible={visible}\n      onClose={() => setVisible(false)}\n      {...props}\n    />\n  );\n  return {\n    node,\n    show: () => setVisible(true),\n    close: () => setVisible(false),\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useState } from 'react';\n\nimport { useShallow } from 'zustand/react/shallow';\nimport { WorkflowExecStatus } from '@coze-workflow/base';\nimport { SelectSpaceModal } from '@coze-studio/components';\nimport { I18n } from '@coze-arch/i18n';\nimport { Toast, Tooltip } from '@coze-arch/coze-design';\nimport { openNewWindow } from '@coze-arch/bot-utils';\nimport { useSpaceStore } from '@coze-arch/bot-studio-store';\nimport { UIButton } from '@coze-arch/bot-semi';\nimport { IconCopyStroked } from '@douyinfe/semi-icons';\n\nimport styles from '../index.module.less';\nimport { getWorkflowUrl } from '../../../utils/get-workflow-url';\nimport { useWorkflowOperation, useGlobalState } from '../../../hooks';\n\ninterface Props {\n  mode: 'icon' | 'button';\n}\n\nexport const DuplicateButton = ({ mode }: Props) => {\n  const {\n    isFromExplore,\n    isSceneFlow,\n    spaceId: spaceID,\n    viewStatus,\n    isViewHistory,\n    isBindDouyin,\n    readonly,\n  } = useGlobalState();\n\n  const operation = useWorkflowOperation();\n\n  /** Replication disabled at runtime */\n  const disabled = viewStatus === WorkflowExecStatus.EXECUTING;\n\n  // Scene workflow hidden replication at readonly or runtime or browsing history\n  const visible =\n    !(isSceneFlow && readonly) &&\n    viewStatus !== WorkflowExecStatus.EXECUTING &&\n    !isViewHistory &&\n    !isBindDouyin; // Duplication is not displayed in Douyin doppelganger mode\n\n  const [loading, setLoading] = useState(false);\n  const [showSpaceModal, setShowSpaceModal] = useState(false);\n\n  const { spaceList } = useSpaceStore(\n    useShallow(store => ({\n      spaceList: store.spaces.bot_space_list,\n    })),\n  );\n\n  const getCopyUrl = async (_spaceID?: string) => {\n    setLoading(true);\n    const resp = await operation.copy();\n\n    if (!resp?.workflow_id) {\n      return Toast.error(I18n.t('workflow_detail_toast_createcopy_failed'));\n    }\n\n    Toast.success({\n      content: I18n.t('workflow_detail_toast_createcopy_succeed'),\n      showClose: false,\n    });\n\n    setLoading(false);\n    return getWorkflowUrl({\n      space_id: _spaceID || '',\n      workflow_id: resp.workflow_id,\n    });\n  };\n\n  const handleCopy = (id?: string) => {\n    openNewWindow(() => getCopyUrl(id));\n  };\n\n  const handleDuplicate = useCallback(() => {\n    if (spaceList.length > 1 && isFromExplore) {\n      setShowSpaceModal(true);\n    } else {\n      handleCopy(spaceID);\n    }\n  }, [spaceList, isFromExplore, spaceID]);\n\n  if (!visible) {\n    return null;\n  }\n\n  return (\n    <>\n      {/* No copy copy is displayed in the running state of the process */}\n      {/* UX optimization - align preview tag display logic, non-process owner copy button display remains unchanged */}\n      {mode === 'button' ? (\n        <UIButton\n          disabled={disabled}\n          theme=\"solid\"\n          type=\"primary\"\n          loading={loading}\n          onClick={handleDuplicate}\n        >\n          {I18n.t('workflow_detail_title_copy')}\n        </UIButton>\n      ) : null}\n\n      {/* UX optimization - align preview tag display logic, process owner copy button is displayed on the far right, weaken interaction */}\n      {mode === 'icon' ? (\n        <Tooltip\n          content={I18n.t('workflow_detail_title_copy')}\n          position=\"bottom\"\n        >\n          <UIButton\n            className={styles['icon-copy']}\n            disabled={disabled}\n            loading={loading}\n            onClick={handleDuplicate}\n            icon={<IconCopyStroked />}\n            data-testid=\"workflow.detail.title.duplicate\"\n          />\n        </Tooltip>\n      ) : null}\n\n      {showSpaceModal ? (\n        <SelectSpaceModal\n          visible={true}\n          onCancel={() => {\n            setShowSpaceModal(false);\n          }}\n          onConfirm={id => {\n            handleCopy(id);\n            setShowSpaceModal(false);\n          }}\n        />\n      ) : null}\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isNil } from 'lodash-es';\nimport { NodeType, DependencyOrigin } from '@coze-common/resource-tree';\n\nexport const navigateResource = ({\n  info,\n  spaceId,\n  projectId,\n}: {\n  info: {\n    id: string;\n    type: NodeType;\n    from: DependencyOrigin;\n  };\n  spaceId: string;\n  projectId?: string;\n}) => {\n  if (!spaceId) {\n    return;\n  }\n  if (!(info.id && !isNil(info.type))) {\n    return;\n  }\n\n  if (info.from === DependencyOrigin.APP && projectId) {\n    switch (info.type) {\n      case NodeType.PLUGIN:\n        window.open(\n          `/space/${spaceId}/project-ide/${projectId}/plugin/${info.id}`,\n        );\n        break;\n      case NodeType.WORKFLOW:\n      case NodeType.CHAT_FLOW:\n        window.open(\n          `/space/${spaceId}/project-ide/${projectId}/workflow/${info.id}`,\n        );\n        break;\n      case NodeType.KNOWLEDGE:\n        window.open(\n          `/space/${spaceId}/project-ide/${projectId}/knowledge/${info.id}`,\n        );\n        break;\n      case NodeType.DATABASE:\n        window.open(\n          `/space/${spaceId}/project-ide/${projectId}/database/${info.id}`,\n        );\n        break;\n      default:\n        return;\n    }\n  }\n\n  if (info.from === DependencyOrigin.LIBRARY) {\n    switch (info.type) {\n      case NodeType.PLUGIN:\n        window.open(`/space/${spaceId}/plugin/${info.id}`);\n        break;\n      case NodeType.WORKFLOW:\n      case NodeType.CHAT_FLOW:\n        window.open(`/work_flow?space_id=${spaceId}&workflow_id=${info.id}`);\n        break;\n      case NodeType.KNOWLEDGE:\n        window.open(`/space/${spaceId}/knowledge/${info.id}`);\n        break;\n      case NodeType.DATABASE:\n        window.open(`/space/${spaceId}/database/${info.id}`);\n        break;\n      default:\n        return;\n    }\n  }\n  // Only plugins may be sourced for the store\n  if (info.type === NodeType.PLUGIN && info.from === DependencyOrigin.SHOP) {\n    window.open(`/store/plugin/${info.id}`);\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozLongArrowTopRight } from '@coze-arch/coze-design/icons';\nimport { Tooltip, IconButton } from '@coze-arch/coze-design';\nimport { NodeType, DependencyOrigin } from '@coze-common/resource-tree';\n\nimport { usePluginDetail } from '@coze-workflow/playground';\nimport { navigateResource } from './utils';\n\nexport const LinkNode = ({\n  extraInfo,\n  spaceId,\n  projectId,\n}: {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  extraInfo: any;\n  spaceId: string;\n  projectId?: string;\n}) => {\n  // New tab opens\n  // Business side navigating jumping logic\n  const isStorePlugin =\n    extraInfo.type === NodeType.PLUGIN &&\n    extraInfo.from === DependencyOrigin.SHOP;\n  const { isLoading, storePluginId } = usePluginDetail({\n    pluginId: extraInfo.id,\n    needQuery: isStorePlugin,\n  });\n\n  const handleJump = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    navigateResource({\n      info: {\n        ...extraInfo,\n        id: storePluginId,\n      },\n      spaceId,\n      projectId,\n    });\n  };\n  return (\n    <Tooltip\n      content={I18n.t('reference_graph_node_open_in_new_tab')}\n      theme=\"dark\"\n    >\n      <IconButton\n        loading={isLoading}\n        size=\"small\"\n        icon={<IconCozLongArrowTopRight />}\n        onClick={handleJump}\n      />\n    </Tooltip>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport s from './styles.module.less';\n\nexport const TooltipContent = () => (\n  <div className={s['tooltip-container']}>\n    <div>{I18n.t('reference_graph_modal_title_info_hover_tip')}</div>\n    <div className={s['canvas-container']}>\n      <div className={s.cards}>\n        <div className={s.a}>A</div>\n        <div className={s['arrow-wrapper']}>\n          <div className={s['arrow-line']}></div>\n          <div className={s['arrow-head']}></div>\n        </div>\n        <div className={s.b}>B</div>\n      </div>\n      <div className={s['text-container']}>\n        <div>\n          {I18n.t('reference_graph_modal_title_info_hover_tip_explain')}\n        </div>\n      </div>\n    </div>\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\n\nexport enum ChangeType {\n  Add = 'Add',\n  Modify = 'Modify',\n  Delete = 'Delete',\n}\n\nexport const COLOR_STYLE_MAP = {\n  Info: {\n    backgroundColor: 'var(--semi-color-info-light-hover)',\n    color: 'var(--semi-color-info)',\n  },\n  Success: {\n    backgroundColor: 'var(--semi-color-success-light-hover)',\n    color: 'var(--semi-color-success)',\n  },\n  Danger: {\n    backgroundColor: 'var(--semi-color-danger-light-hover)',\n    color: 'var(--semi-color-danger)',\n  },\n  Warning: {\n    backgroundColor: 'var(--semi-color-warning-light-hover)',\n    color: 'var(--semi-color-warning)',\n  },\n  Tertiary: {\n    backgroundColor: 'var(--semi-color-tertiary-light-hover)',\n    color: 'var(--semi-color-tertiary-active)',\n  },\n};\n\nexport const CHANGE_TYPE_TAG_STYLES = {\n  Add: COLOR_STYLE_MAP.Success,\n  Modify: COLOR_STYLE_MAP.Warning,\n  Delete: COLOR_STYLE_MAP.Danger,\n};\n\nexport enum DiffItems {\n  Name = 'name_dif',\n  Describe = 'describe_dif',\n  IconUrl = 'icon_url_dif',\n  Schema = 'schema_dif',\n}\n\nexport const MERGE_KEY_MAP = {\n  name_dif: 'name',\n  describe_dif: 'desc',\n  icon_url_dif: 'icon_uri',\n  schema_dif: 'schema',\n};\n\nexport const DIFF_ITEM_NAMES = {\n  name_dif: I18n.t('workflow_publish_multibranch_workflow_name'),\n  describe_dif: I18n.t('workflow_publish_multibranch_workflow_describe'),\n  icon_url_dif: I18n.t('workflow_publish_multibranch_workflow_picture'),\n  schema_dif: I18n.t('workflow_publish_multibranch_workflow_flow'),\n};\n\nexport const DIFF_ITEM_MODIFY_MSG = {\n  icon_url_dif: I18n.t('workflow_publish_multibranch_change_picture'),\n  schema_dif: I18n.t('workflow_publish_multibranch_modity_flow'),\n};\n\nexport enum Retained {\n  Submit = 'submit',\n  Draft = 'draft',\n}\n\nexport type RetainedResult = {\n  [key in DiffItems]?: Retained;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Check the reference relationship before the process is published\n */\nimport { type FC } from 'react';\n\nimport { type Workflow } from '@coze-workflow/base/api';\nimport { Table } from '@coze-arch/bot-semi';\nimport { I18n } from '@coze-arch/i18n';\n\nimport styles from './publish-confirm-content.module.less';\n\ninterface PublishConfirmContentProps {\n  workflowList: Workflow[];\n}\n\nexport const ReferenceTable = ({ num }: { num: number }) => (\n  <div className={styles.referenceTable}>\n    <Table\n      pagination={false}\n      dataSource={[\n        {\n          relationship: I18n.t('workflow_detail_node_workflows_referencing', {\n            number: num,\n          }),\n          impact: I18n.t('workflow_detail_node_workflows_referencing_invalid'),\n        },\n      ]}\n      columns={[\n        {\n          title: I18n.t(\n            'workflow_detail_node_workflows_referencing_relationship',\n          ),\n          dataIndex: 'relationship',\n        },\n        {\n          title: I18n.t('workflow_detail_node_workflows_referencing_impact'),\n          dataIndex: 'impact',\n        },\n      ]}\n    />\n  </div>\n);\n\nexport const PublishConfirmContent: FC<PublishConfirmContentProps> = props => {\n  const { workflowList } = props;\n  return (\n    <div>\n      <div\n        style={{\n          margin: '24px 0 16px 0',\n          color: 'var(--semi-color-text-2)',\n        }}\n      >\n        {I18n.t('workflow_detail_node_workflows_referencing_update')}\n      </div>\n      <ReferenceTable num={workflowList.length} />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useQuery } from '@tanstack/react-query';\nimport {\n  workflowApi,\n  type OperateType,\n  type DiffContent,\n} from '@coze-workflow/base/api';\nimport { UITag, UITable, UIEmpty, Typography } from '@coze-arch/bot-semi';\nimport { IconYesFilled } from '@coze-arch/bot-icons';\nimport { I18n } from '@coze-arch/i18n';\n\nconst { Text } = Typography;\n\nimport {\n  CHANGE_TYPE_TAG_STYLES,\n  ChangeType,\n  DIFF_ITEM_NAMES,\n  DIFF_ITEM_MODIFY_MSG,\n} from '../../../constants';\n\nconst transformDiffContent = (diffContent?: DiffContent) => {\n  if (!diffContent) {\n    return;\n  }\n  return Object.keys(diffContent)\n    .filter(key => diffContent[key].modify)\n    .map(key => {\n      const changes =\n        DIFF_ITEM_MODIFY_MSG[key] ||\n        `\"${\n          diffContent[key].before ||\n          I18n.t('workflow_publish_multibranch_default_value')\n        }\" -> \"${diffContent[key].after}\"`;\n\n      return {\n        property: DIFF_ITEM_NAMES[key] || key,\n        changeType: ChangeType.Modify,\n        changes,\n      };\n    });\n};\n\nexport const DiffTable = ({\n  spaceId,\n  workflowId,\n  operateType,\n}: {\n  spaceId: string;\n  workflowId: string;\n  operateType: OperateType;\n}) => {\n  const { isLoading: loading, data } = useQuery({\n    queryKey: ['workflow_diff'],\n    queryFn: async () => {\n      const { data: diffContent } = await workflowApi.ShowDifferences({\n        space_id: spaceId,\n        workflow_id: workflowId,\n        type: operateType,\n      });\n      return transformDiffContent(diffContent);\n    },\n  });\n\n  const columns = [\n    {\n      title: I18n.t('workflow_publish_multibranch_property'),\n      dataIndex: 'property',\n      width: 280,\n    },\n    {\n      title: I18n.t('workflow_publish_multibranch_changetype'),\n      dataIndex: 'changeType',\n      width: 120,\n      render: text => (\n        <UITag style={{ ...CHANGE_TYPE_TAG_STYLES[text], flexShrink: 0 }}>\n          {I18n.t('workflow_publish_multibranch_modify')}\n        </UITag>\n      ),\n    },\n    {\n      title: I18n.t('workflow_publish_multibranch_changes'),\n      dataIndex: 'changes',\n      width: 512,\n    },\n  ];\n\n  const isNoDiff = !loading && data?.length === 0;\n\n  return (\n    <div>\n      {isNoDiff ? (\n        <UIEmpty\n          empty={{\n            icon: <IconYesFilled />,\n            title: I18n.t('workflow_publish_multibranch_nodiff'),\n          }}\n        />\n      ) : (\n        <div className=\"mt-8 max-w-[912px]\">\n          {!loading ? (\n            <Text strong>\n              {I18n.t('workflow_publish_multibranch_workflow_btn')}\n            </Text>\n          ) : null}\n\n          <UITable\n            tableProps={{\n              columns,\n              dataSource: data,\n              pagination: false,\n              loading,\n            }}\n          />\n        </div>\n      )}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport classNames from 'classnames';\nimport { OperateType } from '@coze-workflow/base/api';\nimport { withQueryClient } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { TextArea } from '@coze-arch/coze-design';\nimport { sendTeaEvent, EVENT_NAMES } from '@coze-arch/bot-tea';\nimport { Typography } from '@coze-arch/bot-semi';\n\nimport { ReferenceTable } from '@/components/workflow-references/publish-confirm-content';\n\nimport { DiffTable } from './diff-table';\n\nconst { Text } = Typography;\n\nexport const DiffModal = withQueryClient(\n  ({\n    spaceId,\n    workflowId,\n    operateType,\n    referenceNum,\n    onDescChange,\n    needDesc,\n  }: {\n    spaceId: string;\n    workflowId: string;\n    operateType: OperateType;\n    referenceNum?: number;\n    onDescChange: (val: string) => void;\n    needDesc: boolean;\n  }) => {\n    const [showDiff, setShowDiff] = useState(false);\n\n    const confirmText =\n      operateType === OperateType.SubmitOperate\n        ? I18n.t('workflow_publish_multibranch_submit_comfirm_desc')\n        : I18n.t('workflow_publish_multibranch_publish_confirm_content');\n\n    return (\n      <div>\n        <div\n          className={classNames(\n            'min-w-[512px]',\n            'text-sm',\n            'text-[var(--semi-color-text-2)]',\n            'mb-4',\n            'font-[SF Pro Display]',\n            {\n              'w-[512px]': !showDiff && !referenceNum,\n            },\n          )}\n        >\n          {confirmText}\n        </div>\n        {needDesc && operateType === OperateType.SubmitOperate ? (\n          <div className=\"mb-2\">\n            <TextArea\n              placeholder={I18n.t('bmv_enter_version_description')}\n              maxCount={500}\n              onChange={val => {\n                onDescChange(val);\n              }}\n            />\n          </div>\n        ) : null}\n        {referenceNum ? <ReferenceTable num={referenceNum} /> : null}\n\n        <Text\n          link\n          onClick={() => {\n            sendTeaEvent(\n              operateType === OperateType.SubmitOperate\n                ? EVENT_NAMES.workflow_submit_difference\n                : EVENT_NAMES.workflow_publish_difference,\n              {\n                workflow_id: workflowId,\n                workspace_id: spaceId,\n              },\n            );\n\n            setShowDiff(!showDiff);\n          }}\n        >\n          {showDiff\n            ? I18n.t('workflow_publish_multibranch_hidediff')\n            : I18n.t('workflow_publish_multibranch_diff_btn')}\n        </Text>\n\n        {showDiff ? (\n          <DiffTable\n            spaceId={spaceId}\n            workflowId={workflowId}\n            operateType={operateType}\n          />\n        ) : null}\n      </div>\n    );\n  },\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport { type FC, useEffect, useMemo, useRef, useState } from 'react';\n\nimport { useUnmount } from 'ahooks';\nimport { OperateType } from '@coze-workflow/base/api';\nimport { Toast } from '@coze-arch/coze-design';\nimport { UIModal } from '@coze-arch/bot-semi';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { useWorkflowReferences } from '../../../../hooks/use-workflow-references';\nimport { useGlobalState } from '../../../../hooks';\nimport { DiffModal } from './components/diff-modal';\n\nimport styles from './index.module.less';\n\ninterface DiffConfirmModalProps {\n  visible: boolean;\n  operateType: OperateType;\n  /** commit function */\n  submitHandle: (val: { desc: string }) => Promise<boolean>;\n  /** Pop-up successful */\n  onOk?: () => void;\n  /** pop-up cancellation */\n  onCancel?: () => void;\n}\n\nconst DiffConfirmModal: FC<DiffConfirmModalProps> = ({\n  visible,\n  operateType,\n  submitHandle,\n  onOk,\n  onCancel,\n}) => {\n  const { spaceId, workflowId, isDevSpace } = useGlobalState();\n  const { refetchReferences } = useWorkflowReferences();\n  const okParam = useRef({ desc: '' });\n  const [desc, setDesc] = useState('');\n  const [referenceNum, setReferenceNum] = useState(0);\n\n  const okText =\n    operateType === OperateType.SubmitOperate\n      ? I18n.t('workflow_publish_multibranch_submit_btn')\n      : I18n.t('workflow_publish_multibranch_publish_btn');\n\n  const title =\n    operateType === OperateType.SubmitOperate\n      ? I18n.t('workflow_publish_multibranch_submit_comfirm')\n      : I18n.t('workflow_publish_multibranch_publish_comfirm_title');\n\n  useEffect(() => {\n    (async () => {\n      if (operateType === OperateType.PublishOperate) {\n        const { data } = await refetchReferences();\n        setReferenceNum(data?.workflowList.length || 0);\n      }\n    })();\n  }, [operateType]);\n\n  return (\n    <UIModal\n      visible={visible}\n      onOk={async () => {\n        // form validation\n        if (okParam.current.desc.length > 500) {\n          Toast.error(I18n.t('bwc_version_description_exceeds_word_limit'));\n          return;\n        }\n\n        const result = await submitHandle({ desc });\n\n        if (result) {\n          onOk?.();\n        }\n      }}\n      title={title}\n      okText={okText}\n      maskClosable={false}\n      onCancel={() => {\n        onCancel?.();\n      }}\n      className={styles['diff-modal']}\n      icon={null}\n      okButtonProps={{\n        disabled: false,\n      }}\n    >\n      <DiffModal\n        spaceId={spaceId}\n        workflowId={workflowId}\n        operateType={operateType}\n        referenceNum={referenceNum}\n        onDescChange={val => {\n          okParam.current.desc = val;\n          setDesc(val);\n        }}\n        needDesc={isDevSpace}\n      />\n    </UIModal>\n  );\n};\n\nexport const useDiffConfirm = ({\n  submitHandle,\n  operateType,\n}: Pick<DiffConfirmModalProps, 'operateType' | 'submitHandle'>) => {\n  const [visible, setVisible] = useState(false);\n  const targetFuc = useRef<(value: boolean) => void>();\n  const modal = useMemo(\n    () => (\n      <DiffConfirmModal\n        visible\n        operateType={operateType}\n        submitHandle={submitHandle}\n        onCancel={() => {\n          setVisible(false);\n          targetFuc.current?.(false);\n        }}\n        onOk={() => {\n          setVisible(false);\n          targetFuc.current?.(true);\n        }}\n      />\n    ),\n    [operateType, submitHandle, targetFuc],\n  );\n\n  useEffect(() => {\n    if (!visible) {\n      targetFuc.current = undefined;\n    }\n  }, [visible]);\n\n  useUnmount(() => {\n    targetFuc.current = undefined;\n  });\n\n  return {\n    modal: visible && modal,\n    diffConfirm: () => {\n      setVisible(true);\n      return new Promise<boolean>(resolve => {\n        targetFuc.current = resolve;\n      });\n    },\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createContext, useState } from 'react';\n\nimport { useQuery } from '@tanstack/react-query';\nimport {\n  workflowApi,\n  type DiffContent,\n  type DiffContentMeta,\n} from '@coze-workflow/base/api';\nimport { withQueryClient } from '@coze-workflow/base';\n\nimport {\n  DiffItems,\n  DIFF_ITEM_NAMES,\n  type RetainedResult,\n} from '../../constants';\nimport { Retained } from '../../constants';\n\nexport interface DiffItemData {\n  key: string;\n  property: string;\n  lastVersion: DiffContentMeta | undefined;\n  myDraft: DiffContentMeta | undefined;\n  isConflict: boolean;\n}\n\ninterface MergeProviderProps {\n  spaceId: string;\n  workflowId: string;\n  children: React.ReactNode;\n}\n\nconst transformMergeDiff = (\n  submitDiff?: DiffContent,\n  draftDiff?: DiffContent,\n) =>\n  Object.values(DiffItems)\n    .map(key => ({\n      key,\n      property: DIFF_ITEM_NAMES[key],\n      lastVersion: submitDiff?.[key],\n      myDraft: draftDiff?.[key],\n      // Both are modified as conflicts\n      isConflict: !!(submitDiff?.[key]?.modify && draftDiff?.[key]?.modify),\n      // At least one of the two has been modified before the diff is displayed.\n      hasDiff: !!(submitDiff?.[key]?.modify || draftDiff?.[key]?.modify),\n    }))\n    .filter(item => item.hasDiff);\n\nexport const MergeContext = createContext<{\n  workflowId: string;\n  spaceId: string;\n  loading: boolean;\n  mergeable: boolean;\n  hasConflict: boolean;\n  submitDiff?: DiffContent;\n  draftDiff?: DiffContent;\n  data: Array<DiffItemData>;\n  retainedResult: RetainedResult;\n  handleRetained: (result: Record<string, string>) => void;\n}>({\n  workflowId: '',\n  spaceId: '',\n  loading: false,\n  mergeable: false,\n  hasConflict: false,\n  data: [],\n  retainedResult: {},\n  handleRetained: result => null,\n});\n\nexport const MergeProvider = withQueryClient(\n  ({ children, spaceId, workflowId }: MergeProviderProps) => {\n    const [retainedResult, setRetainedResult] = useState<RetainedResult>({\n      [DiffItems.Schema]: Retained.Draft,\n    });\n\n    const handleRetained = result => {\n      setRetainedResult({\n        ...retainedResult,\n        ...result,\n      });\n    };\n\n    const { isLoading, data: mergeDiff } = useQuery({\n      queryKey: ['workflow_merge', spaceId, workflowId],\n      queryFn: async () => {\n        const { data } = await workflowApi.GetConflictFromContent({\n          space_id: spaceId,\n          workflow_id: workflowId,\n        });\n        return data;\n      },\n    });\n\n    const { submit_diff: submitDiff, draft_diff: draftDiff } = mergeDiff || {};\n\n    const data: Array<DiffItemData> = transformMergeDiff(submitDiff, draftDiff);\n\n    const hasConflict = !!data.some(item => item.isConflict);\n\n    const mergeable = true;\n\n    return (\n      <MergeContext.Provider\n        value={{\n          workflowId,\n          spaceId,\n          loading: isLoading,\n          submitDiff,\n          draftDiff,\n          data,\n          hasConflict,\n          mergeable,\n          retainedResult,\n          handleRetained,\n        }}\n      >\n        {children}\n      </MergeContext.Provider>\n    );\n  },\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useContext } from 'react';\n\nimport { workflowApi } from '@coze-workflow/base';\nimport { reporter } from '@coze-arch/logger';\nimport { sendTeaEvent, EVENT_NAMES } from '@coze-arch/bot-tea';\n\nimport { DiffItems, MERGE_KEY_MAP } from '../../constants';\nimport { MergeContext } from './merge-context';\n\nexport const useMerge = () => {\n  const context = useContext(MergeContext);\n\n  const handleMerge = async (): Promise<boolean> => {\n    try {\n      const { workflowId, spaceId, retainedResult, submitDiff, draftDiff } =\n        context;\n\n      sendTeaEvent(EVENT_NAMES.workflow_merge, {\n        workflow_id: workflowId,\n        workspace_id: spaceId,\n        merge_type: retainedResult[DiffItems.Schema] || '',\n      });\n\n      const mergeResults = Object.values(DiffItems).reduce((result, key) => {\n        let mergeResult;\n        // No conflict, choose the latest\n        if (!retainedResult[key]) {\n          if (submitDiff?.[key]?.modify) {\n            mergeResult = submitDiff?.[key]?.after;\n          } else {\n            mergeResult = draftDiff?.[key]?.after;\n          }\n        } else {\n          // If there is a conflict, choose the corresponding one.\n          if (retainedResult[key] === 'submit') {\n            mergeResult = submitDiff?.[key]?.after;\n          } else {\n            mergeResult = draftDiff?.[key]?.after;\n          }\n        }\n\n        return {\n          ...result,\n          [MERGE_KEY_MAP[key]]: mergeResult,\n        };\n      }, {});\n\n      await workflowApi.MergeWorkflow({\n        workflow_id: workflowId,\n        space_id: spaceId,\n        submit_commit_id: submitDiff?.name_dif?.after_commit_id || '',\n        ...mergeResults,\n      });\n      reporter.successEvent({\n        eventName: 'workflow_merge_success',\n        namespace: 'workflow',\n      });\n      return true;\n    } catch (error) {\n      reporter.errorEvent({\n        eventName: 'workflow_merge_fail',\n        namespace: 'workflow',\n        error,\n      });\n      return false;\n    }\n  };\n\n  return { ...context, handleMerge };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport { type DiffContentMeta } from '@coze-workflow/base/api';\nimport {\n  Typography,\n  UITag,\n  Table,\n  Checkbox,\n  Select,\n  Space,\n  Spin,\n} from '@coze-arch/bot-semi';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { useMerge } from '../use-merge';\nimport {\n  DIFF_ITEM_MODIFY_MSG,\n  Retained,\n  CHANGE_TYPE_TAG_STYLES,\n  ChangeType,\n} from '../../../constants';\n\nconst { Text } = Typography;\n\nconst mergeOptions = [\n  {\n    label: I18n.t('workflow_publish_multibranch_my_draft'),\n    value: Retained.Draft,\n  },\n  {\n    label: I18n.t('workflow_publish_multibranch_latest_version'),\n    value: Retained.Submit,\n  },\n];\n\nconst renderDiff = (key: string, diff: DiffContentMeta) => {\n  const { modify, before, after } = diff || {};\n\n  if (!modify) {\n    return '-';\n  }\n\n  return (\n    <Space spacing={8}>\n      <UITag\n        style={{ ...CHANGE_TYPE_TAG_STYLES[ChangeType.Modify], flexShrink: 0 }}\n      >\n        {I18n.t('workflow_publish_multibranch_modify')}\n      </UITag>\n      {DIFF_ITEM_MODIFY_MSG[key] ||\n        `\"${\n          before || I18n.t('workflow_publish_multibranch_default_value')\n        }\" -> \"${after}\"`}\n    </Space>\n  );\n};\n\nconst MergeTable = () => {\n  const { data, loading, retainedResult, handleRetained } = useMerge();\n\n  const [onlyConflict, setOnlyConflict] = useState(false);\n\n  const columns = [\n    {\n      title: I18n.t('workflow_publish_multibranch_property'),\n      dataIndex: 'property',\n      width: 200,\n    },\n    {\n      title: I18n.t('workflow_publish_multibranch_latest_version'),\n      dataIndex: 'lastVersion',\n      width: 320,\n      render: (text, { key, lastVersion }) => renderDiff(key, lastVersion),\n    },\n    {\n      title: I18n.t('workflow_publish_multibranch_my_draft'),\n      dataIndex: 'myDraft',\n      width: 320,\n      render: (text, { key, myDraft }) => renderDiff(key, myDraft),\n    },\n    {\n      title: I18n.t('workflow_publish_multibranch_RetainedResult'),\n      dataIndex: 'retainedResult',\n      width: 120,\n      render: (text, { lastVersion, myDraft, isConflict, key }) => {\n        if (isConflict) {\n          return (\n            <Select\n              size=\"small\"\n              style={{\n                width: 104,\n                height: 24,\n              }}\n              placeholder={I18n.t('workflow_publish_multibranch_PleaseSelect')}\n              value={retainedResult[key]}\n              optionList={mergeOptions}\n              onChange={result => handleRetained({ [key]: result as string })}\n            />\n          );\n        }\n\n        return (\n          <div>\n            {lastVersion?.modify\n              ? I18n.t('workflow_publish_multibranch_latest_version')\n              : I18n.t('workflow_publish_multibranch_my_draft')}\n          </div>\n        );\n      },\n    },\n  ];\n\n  if (loading) {\n    return <Spin size=\"large\" wrapperClassName=\"w-full mt-20\" />;\n  }\n\n  return (\n    <div className=\"overflow-auto  pt-4 pb-9 flex flex-col items-center\">\n      <div>\n        <Checkbox\n          checked={onlyConflict}\n          onChange={e => setOnlyConflict(!!e.target.checked)}\n        >\n          {I18n.t('workflow_publish_multibranch_view_conflict')}\n        </Checkbox>\n        <div className=\"mt-6\">\n          <Text strong>\n            {I18n.t('workflow_publish_multibranch_workflow_btn')}\n          </Text>\n          <Table\n            columns={columns}\n            dataSource={data.filter(item => !onlyConflict || item.isConflict)}\n            pagination={false}\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default MergeTable;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport { Banner, Typography } from '@coze-arch/bot-semi';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { useMerge } from '../use-merge';\nimport { getWorkflowUrl } from '../../../../../utils/get-workflow-url';\n\nconst { Text } = Typography;\n\nconst MergeBanner = () => {\n  const { workflowId, spaceId, hasConflict, submitDiff } = useMerge();\n\n  const submitCommitId = submitDiff?.name_dif?.after_commit_id;\n\n  const handleViewLatest = () => {\n    const versionUrl = getWorkflowUrl({\n      space_id: spaceId,\n      workflow_id: workflowId,\n      version: submitCommitId,\n    });\n\n    window.open(versionUrl, '_blank');\n  };\n\n  return submitCommitId ? (\n    <Banner\n      type={hasConflict ? 'info' : 'success'}\n      icon={null}\n      closeIcon={null}\n      description={\n        <Text>\n          {hasConflict\n            ? I18n.t('workflow_publish_multibranch_diffNodice')\n            : I18n.t('workflow_publish_multibranch_no_diff')}\n          <Text link onClick={handleViewLatest} style={{ marginLeft: 8 }}>\n            {I18n.t('workflow_publish_multibranch_view_lastest_version')}\n          </Text>\n        </Text>\n      }\n    />\n  ) : null;\n};\n\nexport default MergeBanner;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { UIButton } from '@coze-arch/bot-semi';\n\nimport { useMerge } from '../use-merge';\n\nexport const MergeFooter = ({\n  onCancel,\n  onOk,\n}: {\n  onCancel: () => void;\n  onOk: () => Promise<void>;\n}) => {\n  const { handleMerge } = useMerge();\n\n  return (\n    <div className=\"flex justify-end my-6 space-x-3\">\n      <UIButton onClick={onCancel} type=\"tertiary\">\n        {I18n.t('Cancel')}\n      </UIButton>\n\n      <UIButton\n        theme=\"solid\"\n        onClick={async () => {\n          const merged = await handleMerge();\n          if (merged) {\n            await onOk();\n          }\n        }}\n      >\n        {I18n.t('Confirm')}\n      </UIButton>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Toast, Typography } from '@coze-arch/coze-design';\nimport { sendTeaEvent, EVENT_NAMES } from '@coze-arch/bot-tea';\nimport { RadioGroup, Radio, UIModal } from '@coze-arch/bot-semi';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\n\nimport { DiffItems } from '../../constants';\nimport { getWorkflowUrl } from '../../../../utils/get-workflow-url';\nimport { WorkflowSaveService } from '../../../../services';\nimport { useGlobalState } from '../../../../hooks';\nconst { Text } = Typography;\nimport { useMerge } from './use-merge';\nimport { MergeProvider } from './merge-context';\nimport { MergeFooter } from './components';\n\nconst ModalContent = ({\n  onCancel,\n  onOk,\n}: {\n  onCancel: () => void;\n  onOk: () => Promise<void>;\n}) => {\n  const { spaceId, workflowId, submitDiff, handleRetained } = useMerge();\n\n  const handleViewLatest = () => {\n    const versionUrl = getWorkflowUrl({\n      space_id: spaceId,\n      workflow_id: workflowId,\n      version: submitDiff?.schema_dif?.after_commit_id,\n    });\n\n    window.open(versionUrl, '_blank');\n  };\n\n  return (\n    <>\n      <div className=\"flex flex-col\">\n        <div className=\"pb-3\">\n          {I18n.t('wmv_diff_latest_draft')}\n          <Text link onClick={handleViewLatest} className=\"ml-[1px]\">\n            {I18n.t('wmv_view_latest_version')}\n          </Text>\n        </div>\n        <RadioGroup\n          direction=\"vertical\"\n          defaultValue=\"draft\"\n          onChange={val => {\n            handleRetained({ [DiffItems.Schema]: val.target.value });\n          }}\n        >\n          <Radio value=\"draft\">{I18n.t('wmv_draft_version')}</Radio>\n          <Radio value=\"submit\">{I18n.t('wmv_latest_version')}</Radio>\n        </RadioGroup>\n      </div>\n      <MergeFooter onOk={onOk} onCancel={onCancel} />\n    </>\n  );\n};\n\nexport const useMergeConfirm = () => {\n  const { workflowId, spaceId } = useGlobalState();\n  const saveService = useService<WorkflowSaveService>(WorkflowSaveService);\n\n  const mergeConfirm = async (needNotice?: boolean): Promise<boolean> => {\n    sendTeaEvent(EVENT_NAMES.workflow_merge_page, {\n      workflow_id: workflowId,\n      workspace_id: spaceId,\n    });\n\n    if (needNotice) {\n      const confirm = await new Promise(resolve => {\n        UIModal.warning({\n          title: I18n.t('workflow_publish_multibranch_merge_comfirm'),\n          content: I18n.t('workflow_publish_multibranch_merge_comfirm_desc'),\n          onOk: () => resolve(true),\n          onCancel: () => resolve(false),\n        });\n      });\n      if (!confirm) {\n        return false;\n      }\n    }\n    return new Promise(resolve => {\n      const modal = UIModal.confirm({\n        icon: null,\n        content: (\n          <MergeProvider workflowId={workflowId} spaceId={spaceId}>\n            <ModalContent\n              onCancel={() => {\n                modal.destroy();\n                resolve(false);\n              }}\n              onOk={async () => {\n                // Refresh the canvas after merging\n                await saveService.reloadDocument({});\n                Toast.success(\n                  I18n.t('workflow_publish_multibranch_merge_success'),\n                );\n                modal.destroy();\n                resolve(true);\n              }}\n            />\n          </MergeProvider>\n        ),\n        title: I18n.t('wmv_merge_versions'),\n        footer: null,\n      });\n    });\n  };\n\n  return {\n    mergeConfirm,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Check the reference relationship before the process is published\n */\nimport { isEmpty } from 'lodash-es';\nimport { Modal } from '@coze-arch/bot-semi';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { PublishConfirmContent } from '../../workflow-references/publish-confirm-content';\nimport { useWorkflowReferences } from '../../../hooks/use-workflow-references';\n\nexport const usePublishReferenceConfirm = () => {\n  const { refetchReferences } = useWorkflowReferences();\n\n  const publishUpdateReferencedConfirm = async () => {\n    const { data } = await refetchReferences();\n\n    if (!data || isEmpty(data.workflowList)) {\n      return true;\n    }\n\n    return new Promise(resolve => {\n      Modal.confirm({\n        width: 560,\n        icon: null,\n        title: I18n.t('card_builder_builtinLogic_confirm_message'),\n        content: <PublishConfirmContent {...data} />,\n        onOk: () => resolve(true),\n        onCancel: () => resolve(false),\n        okText: I18n.t('Confirm'),\n        cancelText: I18n.t('Cancel'),\n      });\n    });\n  };\n\n  return {\n    publishUpdateReferencedConfirm,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { concatTestId } from '@coze-workflow/base';\n\ntype WorkflowHeaderTestId = `workflow.playground.header.${string}`;\nexport const getWorkflowHeaderTestId = (\n  ...args: string[]\n): WorkflowHeaderTestId =>\n  concatTestId(\n    'workflow',\n    'playground',\n    'header',\n    ...args,\n  ) as WorkflowHeaderTestId;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useShallow } from 'zustand/react/shallow';\nimport { create } from 'zustand';\n\nexport interface SingletonSideSheetProps {\n  sideSheetId: string;\n  // The confirmation method when closing, you need to confirm before closing.\n  closeConfirm?: () => boolean | Promise<boolean>;\n  // Whether mutual exclusion with the left panel\n  mutexWithLeftSideSheet?: boolean;\n}\n\ninterface SideSheetMap {\n  [id: string]: SingletonSideSheetProps;\n}\n\ninterface InnerSideSheetStore {\n  activeId?: string;\n  sideSheetMap: SideSheetMap;\n}\n\ninterface InnerSideSheetAction {\n  forceUpdateActiveId: (id?: string) => void;\n  registerSideSheet: (id: string, props: SingletonSideSheetProps) => void;\n  unRegisterSideSheet: (id: string) => void;\n  openSideSheet: (id: string) => Promise<boolean>;\n  closeSideSheet: (id: string) => Promise<boolean>;\n}\n\nexport const useInnerSideSheetStore = create<\n  InnerSideSheetStore & InnerSideSheetAction\n>((set, get) => ({\n  activeId: undefined,\n  forceUpdateActiveId: activeId => {\n    set({ activeId });\n  },\n  sideSheetMap: {},\n  registerSideSheet: (id, props: SingletonSideSheetProps) => {\n    const { sideSheetMap } = get();\n    sideSheetMap[id] = props;\n    set({ sideSheetMap });\n  },\n  unRegisterSideSheet: id => {\n    const { sideSheetMap } = get();\n    if (sideSheetMap[id]) {\n      delete sideSheetMap[id];\n      set({ sideSheetMap });\n    }\n  },\n  openSideSheet: async (sideSheetId: string) => {\n    const { sideSheetMap } = get();\n\n    // Get all close methods except the current sideSheet\n    const closeFns = Object.keys(sideSheetMap).reduce((fns, id) => {\n      const closeFn = sideSheetMap[id].closeConfirm;\n\n      if (id === sideSheetId || !closeFn) {\n        return fns;\n      }\n\n      return [...fns, closeFn];\n    }, [] as Array<() => boolean | Promise<boolean>>);\n\n    // Call the Close All method\n    const closeResult = await Promise.all(closeFns.map(fn => fn()));\n\n    const success = !closeResult.some(result => result === false);\n\n    if (success) {\n      // Open successfully, switch the active state to the current pop-up window\n      set({ activeId: sideSheetId });\n    }\n\n    return success;\n  },\n  closeSideSheet: async (sideSheetId: string) => {\n    const { sideSheetMap, activeId } = get();\n    if (activeId !== sideSheetId) {\n      return true;\n    }\n\n    const { closeConfirm } = sideSheetMap[sideSheetId] || {};\n    const closed = await closeConfirm?.();\n    if (closeConfirm && !closed) {\n      // Closure failed, fallback to visible state\n      return false;\n    }\n\n    set({ activeId: undefined });\n    return true;\n  },\n}));\n\nexport const useInnerSideSheetStoreShallow = () => {\n  const store = useInnerSideSheetStore(\n    useShallow(s => ({\n      activeId: s.activeId,\n      forceUpdateActiveId: s.forceUpdateActiveId,\n      sideSheetMap: s.sideSheetMap,\n      registerSideSheet: s.registerSideSheet,\n      unRegisterSideSheet: s.unRegisterSideSheet,\n      openSideSheet: s.openSideSheet,\n      closeSideSheet: s.closeSideSheet,\n    })),\n  );\n\n  return store;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { useEffect, type PropsWithChildren } from 'react';\n\nimport { SideSheet } from '@coze-arch/bot-semi';\n\nimport {\n  useInnerSideSheetStoreShallow,\n  type SingletonSideSheetProps,\n} from '../hooks/use-inner-side-sheet-store';\nimport { getWorkflowInnerSideSheetHolder } from '../../../utils/get-workflow-inner-side-sheet-holder';\n\n/* Singleton InnerSideSheet pop-up window, open one and close the other */\nexport const SingletonInnerSideSheet = (\n  props: PropsWithChildren<\n    SingletonSideSheetProps & {\n      sideSheetProps: Record<string, any>;\n    }\n  >,\n) => {\n  const {\n    sideSheetId,\n    closeConfirm,\n    mutexWithLeftSideSheet,\n    sideSheetProps,\n    children,\n  } = props;\n\n  const { registerSideSheet, unRegisterSideSheet, activeId } =\n    useInnerSideSheetStoreShallow();\n\n  useEffect(() => {\n    registerSideSheet(sideSheetId, {\n      sideSheetId,\n      closeConfirm,\n      mutexWithLeftSideSheet,\n    });\n\n    return () => unRegisterSideSheet(sideSheetId);\n  }, [sideSheetId, closeConfirm, mutexWithLeftSideSheet]);\n\n  if (activeId !== sideSheetId) {\n    return null;\n  }\n\n  return (\n    <SideSheet\n      closable={false}\n      mask={false}\n      maskClosable={false}\n      {...sideSheetProps}\n      visible={!!activeId}\n      getPopupContainer={getWorkflowInnerSideSheetHolder}\n    >\n      {children}\n    </SideSheet>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useInnerSideSheetStoreShallow } from './use-inner-side-sheet-store';\n\nexport const useSingletonInnerSideSheet = (sideSheetId: string) => {\n  const { activeId, openSideSheet, closeSideSheet, forceUpdateActiveId } =\n    useInnerSideSheetStoreShallow();\n\n  const visible = activeId === sideSheetId;\n\n  const handleOpen = async (id?: string) =>\n    await openSideSheet(id || sideSheetId);\n\n  const handleClose = async (id?: string) =>\n    await closeSideSheet(id || sideSheetId);\n\n  const forceClose = () => {\n    forceUpdateActiveId();\n  };\n\n  return {\n    visible,\n    handleOpen,\n    handleClose,\n    forceClose,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * This component provides a sidesheet rendering space in the workflow canvas, so that the sidesheet space in the canvas can squeeze the canvas to achieve some side-pull interaction\n * In this space, the semi-ui SideSheet is still used by default to render the pull window, keeping development simple\n */\nimport { useEffect } from 'react';\n\nimport { useSingletonInnerSideSheet } from '../hooks/use-singleton-inner-side-sheet';\nimport { WORKFLOW_INNER_SIDE_SHEET_HOLDER } from '../../../constants';\n\nimport styles from './index.module.less';\n\nexport const WorkflowInnerSideSheetHolder = () => {\n  const { forceClose } = useSingletonInnerSideSheet('');\n\n  // Clear single pop-up window status when destroyed\n  useEffect(() => () => forceClose(), []);\n\n  return (\n    <div\n      id={WORKFLOW_INNER_SIDE_SHEET_HOLDER}\n      className={styles.workflowInnerSideSheetHolder}\n    ></div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ConditionOperator } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozEqual,\n  IconCozEqualSlash,\n  IconCozGreater,\n  IconCozGreaterEqual,\n  IconCozLess,\n  IconCozLessEqual,\n  IconCozMatch,\n  IconCozMatchSlash,\n  IconCozElementOf,\n  IconCozElementOfSlash,\n} from '@coze-arch/coze-design/icons';\n\nexport const ConditionOperatorMap: Record<\n  ConditionOperator,\n  {\n    label: string;\n    operationIcon: React.ReactNode;\n  }\n> = {\n  EQUAL: {\n    label: I18n.t('workflow_condition_operation_equal', {}, ''),\n    operationIcon: <IconCozEqual />,\n  },\n  NOT_EQUAL: {\n    label: I18n.t('workflow_condition_operation_not_equal', {}, ''),\n    operationIcon: <IconCozEqualSlash />,\n  },\n  GREATER_THAN: {\n    label: I18n.t('workflow_condition_operation_greater_than', {}, ''),\n    operationIcon: <IconCozGreater />,\n  },\n  LESS_THAN: {\n    label: I18n.t('workflow_condition_operation_less_than', {}, ''),\n    operationIcon: <IconCozLess />,\n  },\n  GREATER_EQUAL: {\n    label: I18n.t('workflow_condition_operation_greater_equal', {}, ''),\n    operationIcon: <IconCozGreaterEqual />,\n  },\n  LESS_EQUAL: {\n    label: I18n.t('workflow_condition_operation_less_equal', {}, ''),\n    operationIcon: <IconCozLessEqual />,\n  },\n  IN: {\n    label: I18n.t('workflow_condition_operation_in', {}, ''),\n    operationIcon: <IconCozElementOf />,\n  },\n  NOT_IN: {\n    label: I18n.t('workflow_condition_operation_not_in', {}, ''),\n    operationIcon: <IconCozElementOfSlash />,\n  },\n  IS_NULL: {\n    label: I18n.t('workflow_condition_operation_is_null', {}, ''),\n    operationIcon: <IconCozEqual />,\n  },\n  IS_NOT_NULL: {\n    label: I18n.t('workflow_condition_operation_is_not_null', {}, ''),\n    operationIcon: <IconCozEqualSlash />,\n  },\n  LIKE: {\n    label: I18n.t('workflow_condition_operation_like', {}, ''),\n    operationIcon: <IconCozMatch />,\n  },\n  NOT_LIKE: {\n    label: I18n.t('workflow_condition_operation_not_like', {}, ''),\n    operationIcon: <IconCozMatchSlash />,\n  },\n  BE_TRUE: {\n    label: I18n.t('workflow_condition_operation_be_true', {}, ''),\n    operationIcon: <IconCozEqual />,\n  },\n  BE_FALSE: {\n    label: I18n.t('workflow_condition_operation_be_false', {}, ''),\n    operationIcon: <IconCozEqual />,\n  },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const createSelectAndSetFieldsFieldName = 'inputs.insertParam.fieldInfo';\nexport const databaseSelectFieldName = 'inputs.databaseInfoList';\n\nexport const orderByFieldName = 'inputs.selectParam.orderByList';\nexport const queryFieldsFieldName = 'inputs.selectParam.fieldList';\nexport const queryLimitFieldName = 'inputs.selectParam.limit';\nexport const queryConditionFieldName = 'inputs.selectParam.condition';\nexport const queryConditionListFieldName = `${queryConditionFieldName}.conditionList`;\nexport const queryConditionLogicFieldName = `${queryConditionFieldName}.logic`;\n\nexport const updateSelectAndSetFieldsFieldName = 'inputs.updateParam.fieldInfo';\nexport const updateConditionFieldName = 'inputs.updateParam.condition';\nexport const updateConditionListFieldName = `${updateConditionFieldName}.conditionList`;\nexport const updateConditionLogicFieldName = `${updateConditionFieldName}.logic`;\n\nexport const deleteConditionFieldName = 'inputs.deleteParam.condition';\nexport const deleteConditionListFieldName = `${deleteConditionFieldName}.conditionList`;\nexport const deleteConditionLogicFieldName = `${deleteConditionFieldName}.logic`;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const WORKFLOW_INNER_SIDE_SHEET_HOLDER =\n  'workflow-inner-side-sheet-holder';\n\nexport const WORKFLOW_OUTER_SIDE_SHEET_HOLDER =\n  'workflow-outer-side-sheet-holder';\n\nexport const DND_ACCEPT_KEY = 'flow-workflow-canvas-dnd';\n\nexport const WORKFLOW_PLAYGROUND_CONTENT_ID = 'workflow-playground-content';\n\nexport const WORKFLOW_CONTENT_ID = 'workflow-content';\n\nexport const SYSTEM_PROMPT_PANEL = 'system-prompt-panel';\n\nexport enum LayoutPanelKey {\n  /** Node Form */\n  NodeForm = 'node-form',\n  /** Practice running process forms */\n  TestFlowForm = 'test-flow-form',\n  /** Practice running chatflow */\n  TestChatFlowForm = 'test-chat-flow-form',\n  /** log list */\n  TraceList = 'trace-list',\n  /** log details */\n  TraceDetail = 'trace-detail',\n  /** role configuration */\n  RoleConfig = 'role-config',\n}\n\n/**\n * dependent source type\n */\nexport enum DependencySourceType {\n  /** database */\n  DataBase = 'database',\n  /** Knowledge Base */\n  DataSet = 'dataset',\n  /** Large model */\n  LLM = 'llm',\n  /** plugin */\n  Plugin = 'plugin',\n  /** Workflow */\n  Workflow = 'workflow',\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum AnswerType {\n  Option = 'option',\n  Text = 'text',\n}\n\nexport enum OptionType {\n  Static = 'static',\n  Dynamic = 'dynamic',\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum WorkflowRenderKey {\n  EXECUTE_STATUS_BAR = 'execute_status_bar', // Test run top bar\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/naming-convention -- enum */\n\nexport enum CommentEditorFormField {\n  Size = 'size',\n  Note = 'note',\n}\n\n/** editor event */\nexport enum CommentEditorEvent {\n  /** content change event */\n  Change = 'change',\n  /** multiple choice event */\n  MultiSelect = 'multiSelect',\n  /** radio event */\n  Select = 'select',\n  /** out of focus event */\n  Blur = 'blur',\n}\n\n/** editor block format */\nexport enum CommentEditorBlockFormat {\n  /** paragraph */\n  Paragraph = 'paragraph',\n  /** Title I */\n  HeadingOne = 'heading-one',\n  /** Title II */\n  HeadingTwo = 'heading-two',\n  /** Title III */\n  HeadingThree = 'heading-three',\n  /** quote */\n  Blockquote = 'block-quote',\n  /** unordered list */\n  BulletedList = 'bulleted-list',\n  /** ordered list */\n  NumberedList = 'numbered-list',\n  /** list item */\n  ListItem = 'list-item',\n}\n\nexport const CommentEditorListBlockFormat = [\n  CommentEditorBlockFormat.BulletedList,\n  CommentEditorBlockFormat.NumberedList,\n];\n\nexport const CommentEditorLeafType = 'text';\n\n/** Editor leaf node format */\nexport enum CommentEditorLeafFormat {\n  /** bold */\n  Bold = 'bold',\n  /** Italic */\n  Italic = 'italic',\n  /** underline */\n  Underline = 'underline',\n  /** Strikethrough */\n  Strikethrough = 'strikethrough',\n  /** link */\n  Link = 'link',\n}\n\n/** Editor default block */\nexport const CommentEditorDefaultBlocks = [\n  {\n    type: CommentEditorBlockFormat.Paragraph,\n    children: [{ text: '' }],\n  },\n];\n\n/** Editor Default */\nexport const CommentEditorDefaultValue = JSON.stringify(\n  CommentEditorDefaultBlocks,\n);\n\n/** Toolbar display delay */\nexport const CommentToolbarDisplayDelay = 200;\n\n/** default link */\nexport const CommentDefaultLink = 'about:blank';\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-namespace -- namespace is necessary */\nimport type { CommentEditorBlock, CommentEditorLeaf } from '../type';\nimport { CommentEditorBlockFormat } from '../constant';\n\nexport namespace CommentEditorTextParser {\n  // Convert leaf nodes to plain text\n  const convertLeafToText = (leaf: CommentEditorLeaf): string => leaf.text;\n\n  // Convert paragraphs to plain text\n  const convertParagraphToText = (block: CommentEditorBlock): string => {\n    const content: string = block.children\n      .map(child => {\n        if ('text' in child) {\n          return convertLeafToText(child);\n        }\n        return convertBlockToText(child);\n      })\n      .join('');\n    return `${content}\\n`;\n  };\n\n  // Convert the title to plain text\n  const convertHeadingToText = (block: CommentEditorBlock): string => {\n    const content: string = block.children\n      .map(child => {\n        if ('text' in child) {\n          return convertLeafToText(child);\n        }\n        return '';\n      })\n      .join('');\n    return `${content}\\n`;\n  };\n\n  // Convert a reference to plain text\n  const convertBlockquoteToText = (block: CommentEditorBlock): string => {\n    const processQuoteContent = (\n      child: CommentEditorLeaf | CommentEditorBlock,\n    ): string => {\n      if ('text' in child) {\n        return child.text;\n      }\n      return convertBlockToText(child);\n    };\n\n    const content: string = block.children\n      .map(processQuoteContent)\n      .join('')\n      .trim();\n\n    return `${content}\\n`;\n  };\n\n  // Convert a list to plain text\n  const convertListToText = (\n    block: CommentEditorBlock,\n    indent = '',\n  ): string => {\n    const content: string = block.children\n      .map(child => {\n        if (\n          'type' in child &&\n          child.type === CommentEditorBlockFormat.ListItem\n        ) {\n          const itemContent: string = child.children\n            .map(grandChild => {\n              if ('text' in grandChild) {\n                return convertLeafToText(grandChild);\n              }\n              if (\n                grandChild.type === CommentEditorBlockFormat.BulletedList ||\n                grandChild.type === CommentEditorBlockFormat.NumberedList\n              ) {\n                return convertListToText(grandChild, `${indent}  `);\n              }\n              return '';\n            })\n            .join('');\n\n          return `${indent}${itemContent}\\n`;\n        }\n        return '';\n      })\n      .join('');\n\n    return content;\n  };\n\n  // Convert a block to plain text\n  const convertBlockToText = (block: CommentEditorBlock): string => {\n    switch (block.type) {\n      case CommentEditorBlockFormat.Paragraph:\n        return convertParagraphToText(block);\n      case CommentEditorBlockFormat.HeadingOne:\n      case CommentEditorBlockFormat.HeadingTwo:\n      case CommentEditorBlockFormat.HeadingThree:\n        return convertHeadingToText(block);\n      case CommentEditorBlockFormat.Blockquote:\n        return convertBlockquoteToText(block);\n      case CommentEditorBlockFormat.BulletedList:\n      case CommentEditorBlockFormat.NumberedList:\n        return convertListToText(block);\n      default:\n        return '';\n    }\n  };\n\n  // Main function: Converts the entire schema to plain text\n  export const to = (schema: CommentEditorBlock[]): string => {\n    const text: string = schema\n      .map(block => convertBlockToText(block))\n      .join('');\n    return text.trim();\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-magic-numbers -- no need */\n/* eslint-disable @typescript-eslint/no-namespace -- namespace is necessary */\nimport type { CommentEditorBlock, CommentEditorLeaf } from '../type';\nimport { CommentEditorBlockFormat, CommentEditorLeafFormat } from '../constant';\n\nexport namespace CommentEditorMarkdownParser {\n  // Convert leaf nodes to Markdown\n  const convertLeafToMarkdown = (leaf: CommentEditorLeaf): string => {\n    let result: string = leaf.text;\n\n    if (leaf[CommentEditorLeafFormat.Bold]) {\n      result = `**${result}**`;\n    }\n    if (leaf[CommentEditorLeafFormat.Italic]) {\n      result = `*${result}*`;\n    }\n    if (leaf[CommentEditorLeafFormat.Underline]) {\n      result = `__${result}__`;\n    }\n    if (leaf[CommentEditorLeafFormat.Strikethrough]) {\n      result = `~~${result}~~`;\n    }\n    if (leaf[CommentEditorLeafFormat.Link]) {\n      result = `[${result}](${leaf[CommentEditorLeafFormat.Link]})`;\n    }\n\n    return result;\n  };\n\n  // Convert paragraphs to Markdown\n  const convertParagraphToMarkdown = (block: CommentEditorBlock): string => {\n    const content: string = block.children\n      .map(child => {\n        if ('text' in child) {\n          return convertLeafToMarkdown(child);\n        }\n        return convertBlockToMarkdown(child);\n      })\n      .join('');\n    return `${content}\\n\\n`;\n  };\n\n  // Convert headings to Markdown\n  const convertHeadingToMarkdown = (block: CommentEditorBlock): string => {\n    const content: string = block.children\n      .map(child => {\n        if ('text' in child) {\n          return convertLeafToMarkdown(child);\n        }\n        return '';\n      })\n      .join('');\n    const level: number =\n      block.type === CommentEditorBlockFormat.HeadingOne\n        ? 1\n        : block.type === CommentEditorBlockFormat.HeadingTwo\n        ? 2\n        : 3;\n    return `${'#'.repeat(level)} ${content}\\n\\n`;\n  };\n\n  // Convert Reference to Markdown\n  const convertBlockquoteToMarkdown = (block: CommentEditorBlock): string => {\n    // Process the content in the reference block\n    const processQuoteContent = (\n      child: CommentEditorLeaf | CommentEditorBlock,\n    ): string => {\n      if ('text' in child) {\n        return convertLeafToMarkdown(child);\n      }\n      if (child.type === CommentEditorBlockFormat.Paragraph) {\n        return convertParagraphToMarkdown(child).trimEnd();\n      }\n      return convertBlockToMarkdown(child);\n    };\n\n    // Convert content to citation format\n    const convertToQuoteFormat = (content: string): string =>\n      content\n        .split('\\n')\n        .map((line: string): string => `> ${line}`)\n        .join('\\n');\n\n    // Handle all child elements\n    const content: string = block.children\n      .map(processQuoteContent)\n      .join('\\n')\n      .trim();\n\n    // Convert to reference format and add extra line breaks\n    return `${convertToQuoteFormat(content)}\\n\\n`;\n  };\n\n  // Convert List to Markdown\n  const convertListToMarkdown = (\n    block: CommentEditorBlock,\n    indent = '',\n  ): string => {\n    const isNumbered: boolean =\n      block.type === CommentEditorBlockFormat.NumberedList;\n    let index = 1;\n\n    const content: string = block.children\n      .map(child => {\n        if (\n          'type' in child &&\n          child.type === CommentEditorBlockFormat.ListItem\n        ) {\n          const itemContent: string = child.children\n            .map(grandChild => {\n              if ('text' in grandChild) {\n                return convertLeafToMarkdown(grandChild);\n              }\n              if (\n                grandChild.type === CommentEditorBlockFormat.BulletedList ||\n                grandChild.type === CommentEditorBlockFormat.NumberedList\n              ) {\n                return convertListToMarkdown(grandChild, `${indent}  `);\n              }\n              return '';\n            })\n            .join('');\n\n          const prefix: string = isNumbered ? `${index}. ` : '- ';\n          index++;\n          return `${indent}${prefix}${itemContent}\\n`;\n        }\n        return '';\n      })\n      .join('');\n\n    return `${content}\\n`;\n  };\n\n  // Convert block to Markdown\n  const convertBlockToMarkdown = (block: CommentEditorBlock): string => {\n    switch (block.type) {\n      case CommentEditorBlockFormat.Paragraph:\n        return convertParagraphToMarkdown(block);\n      case CommentEditorBlockFormat.HeadingOne:\n      case CommentEditorBlockFormat.HeadingTwo:\n      case CommentEditorBlockFormat.HeadingThree:\n        return convertHeadingToMarkdown(block);\n      case CommentEditorBlockFormat.Blockquote:\n        return convertBlockquoteToMarkdown(block);\n      case CommentEditorBlockFormat.BulletedList:\n      case CommentEditorBlockFormat.NumberedList:\n        return convertListToMarkdown(block);\n      default:\n        return '';\n    }\n  };\n\n  // Main function: Converts the entire schema to Markdown\n  export const to = (schema: CommentEditorBlock[]): string => {\n    const markdown: string = schema\n      .map(block => convertBlockToMarkdown(block))\n      .join('');\n    return markdown.trim();\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-namespace -- namespace is necessary */\nimport type { CommentEditorBlock } from '../type';\nimport {\n  type CommentEditorBlockFormat,\n  CommentEditorDefaultBlocks,\n  CommentEditorLeafType,\n} from '../constant';\n\nexport namespace CommentEditorJSONParser {\n  // Processing a single node\n  const processNode = (node: CommentEditorBlock): CommentEditorBlock => {\n    if ('text' in node && !node.type) {\n      return {\n        ...node,\n        type: CommentEditorLeafType as unknown as CommentEditorBlockFormat,\n      };\n    }\n\n    if ('type' in node && 'children' in node) {\n      return {\n        ...node,\n        children: (node.children as CommentEditorBlock[]).map(processNode),\n      };\n    }\n\n    return node as CommentEditorBlock;\n  };\n\n  // Main function: handle the entire schema\n  const addLeafType = (schema: CommentEditorBlock[]): CommentEditorBlock[] =>\n    schema.map(processNode);\n\n  /** Convert JSON to Schema */\n  export const from = (value?: string): CommentEditorBlock[] | undefined => {\n    if (!value || value === '') {\n      return CommentEditorDefaultBlocks as CommentEditorBlock[];\n    }\n    try {\n      const blocks = JSON.parse(value);\n      return blocks;\n      // eslint-disable-next-line @coze-arch/use-error-in-catch -- no need to handle error\n    } catch (error) {\n      return;\n    }\n  };\n\n  /** Schema to JSON */\n  export const to = (schema: CommentEditorBlock[]): string | undefined => {\n    try {\n      const value = JSON.stringify(addLeafType(schema));\n      return value;\n      // eslint-disable-next-line @coze-arch/use-error-in-catch -- no need to handle error\n    } catch (error) {\n      return;\n    }\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-magic-numbers -- no need */\n/* eslint-disable @typescript-eslint/no-namespace -- namespace is necessary */\n\nimport type { CommentEditorBlock, CommentEditorLeaf } from '../type';\nimport { CommentEditorBlockFormat, CommentEditorLeafFormat } from '../constant';\n\nexport namespace CommentEditorHTMLParser {\n  // Convert leaf nodes to HTML\n  const convertLeafToHtml = (leaf: CommentEditorLeaf): string => {\n    let result: string = leaf.text;\n\n    if (leaf[CommentEditorLeafFormat.Bold]) {\n      result = `<strong>${result}</strong>`;\n    }\n    if (leaf[CommentEditorLeafFormat.Italic]) {\n      result = `<em>${result}</em>`;\n    }\n    if (leaf[CommentEditorLeafFormat.Underline]) {\n      result = `<u>${result}</u>`;\n    }\n    if (leaf[CommentEditorLeafFormat.Strikethrough]) {\n      result = `<del>${result}</del>`;\n    }\n    if (leaf[CommentEditorLeafFormat.Link]) {\n      result = `<a href=\"${leaf[CommentEditorLeafFormat.Link]}\">${result}</a>`;\n    }\n\n    return result;\n  };\n\n  // Convert paragraphs to HTML\n  const convertParagraphToHtml = (block: CommentEditorBlock): string => {\n    const content: string = block.children\n      .map(child => {\n        if ('text' in child) {\n          return convertLeafToHtml(child);\n        }\n        return convertBlockToHtml(child);\n      })\n      .join('');\n    return `<p>${content}</p>`;\n  };\n\n  // Convert title to HTML\n  const convertHeadingToHtml = (block: CommentEditorBlock): string => {\n    const content: string = block.children\n      .map(child => {\n        if ('text' in child) {\n          return convertLeafToHtml(child);\n        }\n        return '';\n      })\n      .join('');\n    const level: number =\n      block.type === CommentEditorBlockFormat.HeadingOne\n        ? 1\n        : block.type === CommentEditorBlockFormat.HeadingTwo\n        ? 2\n        : 3;\n    return `<h${level}>${content}</h${level}>`;\n  };\n\n  // Convert reference to HTML\n  const convertBlockquoteToHtml = (block: CommentEditorBlock): string => {\n    // Process the content in the reference block\n    const processQuoteContent = (\n      child: CommentEditorLeaf | CommentEditorBlock,\n    ): string => {\n      if ('text' in child) {\n        return convertLeafToHtml(child);\n      }\n      return convertBlockToHtml(child);\n    };\n\n    // Handle all child elements\n    const content: string = block.children.map(processQuoteContent).join('');\n\n    // Wrap the content inside a < p > tag, then put in a < blockquote > tag\n    return `<blockquote><p>${content}</p></blockquote>`;\n  };\n\n  // Convert list to HTML\n  const convertListToHtml = (block: CommentEditorBlock): string => {\n    const isNumbered: boolean =\n      block.type === CommentEditorBlockFormat.NumberedList;\n    const listTag: string = isNumbered ? 'ol' : 'ul';\n\n    const content: string = block.children\n      .map(child => {\n        if (\n          'type' in child &&\n          child.type === CommentEditorBlockFormat.ListItem\n        ) {\n          const itemContent: string = child.children\n            .map(grandChild => {\n              if ('text' in grandChild) {\n                return convertLeafToHtml(grandChild);\n              }\n              if (\n                grandChild.type === CommentEditorBlockFormat.BulletedList ||\n                grandChild.type === CommentEditorBlockFormat.NumberedList\n              ) {\n                return convertListToHtml(grandChild);\n              }\n              return '';\n            })\n            .join('');\n\n          return `<li>${itemContent}</li>`;\n        }\n        return '';\n      })\n      .join('');\n\n    return `<${listTag}>${content}</${listTag}>`;\n  };\n\n  // Convert block to HTML\n  const convertBlockToHtml = (block: CommentEditorBlock): string => {\n    switch (block.type) {\n      case CommentEditorBlockFormat.Paragraph:\n        return convertParagraphToHtml(block);\n      case CommentEditorBlockFormat.HeadingOne:\n      case CommentEditorBlockFormat.HeadingTwo:\n      case CommentEditorBlockFormat.HeadingThree:\n        return convertHeadingToHtml(block);\n      case CommentEditorBlockFormat.Blockquote:\n        return convertBlockquoteToHtml(block);\n      case CommentEditorBlockFormat.BulletedList:\n      case CommentEditorBlockFormat.NumberedList:\n        return convertListToHtml(block);\n      default:\n        return '';\n    }\n  };\n\n  // Main function: Converts the entire schema to HTML\n  export const to = (schema: CommentEditorBlock[]): string => {\n    const html: string = schema\n      .map(block => convertBlockToHtml(block))\n      .join('');\n    return html;\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-namespace -- namespace is necessary */\n\nimport { CommentEditorTextParser } from './text';\nimport { CommentEditorMarkdownParser } from './markdown';\nimport { CommentEditorJSONParser } from './json';\nimport { CommentEditorHTMLParser } from './html';\n\nexport namespace CommentEditorParser {\n  export const fromJSON = CommentEditorJSONParser.from;\n  export const toJSON = CommentEditorJSONParser.to;\n  export const toText = CommentEditorTextParser.to;\n  export const toMarkdown = CommentEditorMarkdownParser.to;\n  export const toHTML = CommentEditorHTMLParser.to;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EntityData } from '@flowgram-adapter/free-layout-editor';\nimport { type WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport { type NodeTestRunResult } from './typings';\n\nexport class WorkflowNodeTestRunData extends EntityData<NodeTestRunResult | null> {\n  static readonly type = 'WorkflowNodeTestRunData';\n  entity: WorkflowNodeEntity;\n\n  get result(): NodeTestRunResult | null {\n    return this.data;\n  }\n\n  set result(result: NodeTestRunResult | null) {\n    this.update(result);\n  }\n\n  getDefaultData(): NodeTestRunResult | null {\n    return null;\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport {\n  type BasicStandardNodeTypes,\n  type StandardNodeType,\n} from '@coze-workflow/base/types';\n\nimport { type PlaygroundContext } from '../typings';\nimport { type NodeData, WorkflowNodeData } from '../entity-datas';\n\n/**\n *\n * @param node\n * @param data\n * Set the node data for the basic type node, do not modify it at will\n */\nexport const addBasicNodeData = (\n  node: FlowNodeEntity,\n  playgroundContext: PlaygroundContext,\n) => {\n  const nodeDataEntity = node.getData<WorkflowNodeData>(WorkflowNodeData);\n  const meta = playgroundContext.getNodeTemplateInfoByType(\n    node.flowNodeType as StandardNodeType,\n  );\n  const nodeData = nodeDataEntity.getNodeData<keyof NodeData>();\n\n  // The formMeta method on some nodes will be executed repeatedly, so add a check here\n  if (!nodeData && meta) {\n    nodeDataEntity.setNodeData<BasicStandardNodeTypes>({\n      icon: meta.icon,\n      description: meta.description,\n      title: meta.title,\n      mainColor: meta.mainColor,\n    });\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { injectable } from 'inversify';\nimport {\n  type FlowDocument,\n  type FlowDocumentContribution,\n  PlaygroundContext,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  addBasicNodeData,\n  WorkflowNodeData,\n  WorkflowNodeTestRunData,\n} from '@coze-workflow/nodes';\n\nimport { isNodeV2, NODES_V2 } from '@/nodes-v2';\nimport { nodeV2RegistryUtils } from '@/node-registries/common/utils/nodes-v2-registry-utils';\n\n/**\n * Register process node\n */\n@injectable()\nexport class WorkflowNodesV2Contribution implements FlowDocumentContribution {\n  /**\n   * Register Node\n   * @param document\n   */\n  registerDocument(document: FlowDocument): void {\n    document.registerFlowNodes(\n      ...NODES_V2.map(node => nodeV2RegistryUtils.processNodeRegistry(node)),\n    );\n\n    document.registerNodeDatas(WorkflowNodeTestRunData, WorkflowNodeData);\n\n    document.onNodeCreate(({ node }) => {\n      if (isNodeV2(node)) {\n        const playgroundContext =\n          node.getService<PlaygroundContext>(PlaygroundContext);\n\n        addBasicNodeData(node, playgroundContext);\n      }\n    });\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { useEffect, useMemo, useRef } from 'react';\n\nimport {\n  type SetterComponentProps,\n  type SetterExtension,\n} from '@flowgram-adapter/free-layout-editor';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowBatchService } from '@coze-workflow/variable';\nimport { sortErrorBody } from '@coze-workflow/nodes';\nimport { HistoryService } from '@coze-workflow/history';\nimport {\n  BatchMode,\n  type ResponseFormat,\n  type ViewVariableTreeNode,\n} from '@coze-workflow/base';\nimport { useNodeTestId } from '@coze-workflow/base';\n\nimport { withValidation } from '../../components/validation';\nimport { OutputTree, type OutputTreeProps } from '../../components/output-tree';\n\ntype OutputTreeValue = Array<ViewVariableTreeNode> | undefined;\ninterface OutputTreeOptions {\n  id: string;\n  batchMode?: BatchMode;\n  withDescription?: boolean;\n  withRequired?: boolean;\n  disabled?: boolean;\n  disabledTooltip?: string;\n  readonly?: boolean;\n  topLevelReadonly?: boolean;\n  allowDeleteLast?: boolean;\n  emptyPlaceholder?: string;\n  showResponseFormat?: boolean;\n  responseFormat?: ResponseFormat;\n  needErrorBody?: boolean;\n  hide?: boolean;\n  defaultCollapse?: boolean;\n  needAppendChildWhenNodeIsPreset?: boolean;\n  /**\n   * Can the default value be configured?\n   */\n  withDefaultValue?: boolean;\n  /**\n   * Default expanded parameter name\n   */\n  defaultExpandParams?: string[];\n  /**\n   * Is it a new exception setting?\n   */\n  isSettingOnErrorV2?: boolean;\n}\ntype OutputTreeSetterProps = SetterComponentProps<\n  OutputTreeValue,\n  OutputTreeOptions & Pick<OutputTreeProps, 'hiddenTypes' | 'columnsRatio'>\n>;\n\nexport const OutputWithValidation = withValidation<OutputTreeSetterProps>(\n  ({ value, onChange, options, readonly: workflowReadonly, context }) => {\n    const {\n      id,\n      disabled = false,\n      batchMode,\n      withDescription = false,\n      withRequired = false,\n      readonly = false,\n      topLevelReadonly = false,\n      allowDeleteLast = false,\n      emptyPlaceholder,\n      hiddenTypes,\n      showResponseFormat = false,\n      responseFormat,\n      needErrorBody = false,\n      hide = false,\n      defaultCollapse,\n      needAppendChildWhenNodeIsPreset,\n      withDefaultValue = false,\n      isSettingOnErrorV2,\n      ...props\n    } = options || {};\n\n    const isBatch = batchMode === BatchMode.Batch;\n    const historyService = useService<HistoryService>(HistoryService);\n\n    // Record current batchMode\n    const curBatchMode = useRef<BatchMode>();\n\n    // Changes do not record history\n    const onChangeWithoutHistory = (outputTreeValue: OutputTreeValue) => {\n      historyService.stop();\n      onChange(outputTreeValue);\n      historyService.start();\n    };\n\n    useEffect(() => {\n      /**\n       * When initializing, assign curBatchMode, but do not modify the value\n       */\n      if (!curBatchMode.current) {\n        curBatchMode.current = batchMode;\n        return;\n      }\n\n      /**\n       * To switch batch mode, you need to wrap the output of single mode into a list, or remove the list layer from the outputList of batch mode\n       */\n      if (batchMode !== curBatchMode.current) {\n        curBatchMode.current = batchMode;\n\n        if (batchMode === BatchMode.Batch) {\n          onChangeWithoutHistory(\n            WorkflowBatchService.singleOutputMetasToList(value),\n          );\n          return;\n        }\n        if (batchMode === BatchMode.Single) {\n          onChangeWithoutHistory(\n            WorkflowBatchService.listOutputMetasToSingle(value),\n          );\n          return;\n        }\n      }\n    }, [batchMode, onChange]);\n\n    const { getNodeSetterId } = useNodeTestId();\n\n    // To sort value, ensure that the errorbody property is at the bottom\n    const _value = useMemo(() => {\n      if (needErrorBody) {\n        return sortErrorBody({\n          value: value as ViewVariableTreeNode[],\n          isBatch,\n          isSettingOnErrorV2,\n        });\n      }\n      return value;\n    }, [value, needErrorBody, isBatch, isSettingOnErrorV2]);\n\n    if (hide) {\n      return null;\n    }\n\n    return (\n      <OutputTree\n        {...props}\n        id={id}\n        testId={getNodeSetterId(context.path)}\n        responseFormat={{\n          visible: showResponseFormat,\n          value: responseFormat,\n          readonly: needErrorBody,\n          onChange: v => {\n            const item = context.form.getFormItemByPath('/model');\n            if (item?.value) {\n              item.value = {\n                ...item.value,\n                responseFormat: v,\n              };\n            }\n          },\n        }}\n        readonly={readonly || workflowReadonly}\n        disabled={disabled}\n        value={_value as any}\n        onChange={onChange as any}\n        isBatch={isBatch}\n        withDescription={withDescription}\n        withDefaultValue={withDefaultValue}\n        withRequired={withRequired}\n        topLevelReadonly={topLevelReadonly}\n        allowDeleteLast={allowDeleteLast}\n        emptyPlaceholder={emptyPlaceholder}\n        hiddenTypes={hiddenTypes}\n        defaultCollapse={defaultCollapse}\n        needAppendChildWhenNodeIsPreset={needAppendChildWhenNodeIsPreset}\n      />\n    );\n  },\n);\n\nexport const output: SetterExtension = {\n  key: 'OutputTree',\n  component: OutputWithValidation as any,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** Variable Naming Validation Rules */\nexport const nameValidationRule =\n  /^(?!.*\\b(true|false|and|AND|or|OR|not|NOT|null|nil|If|Switch)\\b)[a-zA-Z_][a-zA-Z_$0-9]*$/;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { useNodeRenderScene, useGlobalState } from '@/hooks';\n\nimport { withValidation } from '../../components/validation';\nimport { NodeHeader } from '../../components/node-header';\n\nconst NodeHeaderWithValidation = withValidation(\n  ({\n    value,\n    onChange,\n    options,\n    readonly: workflowReadonly,\n  }: SetterComponentProps) => {\n    const { title, icon, subTitle, description } = value;\n    const { projectId, projectCommitVersion } = useGlobalState();\n    const {\n      readonly = false,\n      hideTest = false,\n      extraOperation,\n      showTrigger,\n      triggerIsOpen,\n      nodeDisabled = false,\n    } = options;\n\n    const { isNodeSideSheet } = useNodeRenderScene();\n\n    return (\n      <NodeHeader\n        title={title}\n        subTitle={subTitle}\n        // If it is the new version of coze2.0 node rendering, hide the description.\n        description={description}\n        logo={icon}\n        onTitleChange={newTitle => {\n          onChange({ ...value, title: newTitle });\n        }}\n        onDescriptionChange={desc => onChange({ ...value, description: desc })}\n        readonly={readonly || workflowReadonly}\n        // [Operation and maintenance platform] is read-only, there is no need to display the test button, and the submission history of the project is also read-only, so practice running cannot be done for the time being.\n        hideTest={\n          hideTest || IS_BOT_OP || !!(projectId && projectCommitVersion)\n        }\n        extraOperation={extraOperation}\n        showCloseButton={isNodeSideSheet}\n        showTrigger={showTrigger}\n        triggerIsOpen={triggerIsOpen}\n        nodeDisabled={nodeDisabled}\n      />\n    );\n  },\n);\n\nexport const nodeHeaderSetter = {\n  key: 'NodeHeader',\n  component: NodeHeaderWithValidation,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GenerationDiversity } from '@coze-workflow/base';\nimport {\n  ModelParamType,\n  type ModelParameter,\n} from '@coze-arch/bot-api/developer_api';\nexport const getCamelNameName = name =>\n  name\n    .split('_')\n    .map((s, i) => (i === 0 ? s : s.slice(0, 1).toUpperCase() + s.slice(1)))\n    .join('');\n\nexport const getValueByType = <T,>(value, type?: ModelParamType): T => {\n  const isNumber =\n    type && [ModelParamType.Float, ModelParamType.Int].includes(type);\n  const _value = isNumber && value ? Number(value) : value;\n  return _value;\n};\n\n// memory level cache\nconst cacheData: {\n  [k: string]: unknown;\n} = {\n  //Record expanded/stowed status\n  expand: undefined,\n};\nexport { cacheData };\n\n/**\n * Generate default values from modelParams\n * If you pass in value, use value first (it can be understood as a min max check for value)\n */\nexport const generateDefaultValueByMeta = ({\n  modelParams,\n  value,\n}: {\n  modelParams?: ModelParameter[];\n  value?: object;\n}): Record<GenerationDiversity, object> => {\n  const _defaultValue: Record<GenerationDiversity, object> = {\n    [GenerationDiversity.Creative]: {},\n    [GenerationDiversity.Balance]: {},\n    [GenerationDiversity.Precise]: {},\n    [GenerationDiversity.Customize]: {},\n  };\n\n  Object.keys(_defaultValue).forEach(generationDiversity => {\n    _defaultValue[generationDiversity] = {};\n    modelParams?.forEach(p => {\n      const key = getCamelNameName(p.name ?? '');\n\n      // Priority is given to taking from the value, and if you can't get it, you can take it from the meta. [Custom] The default value is the bottom.\n      let _v =\n        value?.[key] ??\n        p.default_val?.[generationDiversity] ??\n        p.default_val?.[GenerationDiversity.Customize];\n\n      // Defense code: This is to verify that the backend returns the default value. Theoretically, the default value must be legal, but what if. The default value of the number type needs to be guaranteed max > = v > = min.\n      if (\n        p.type &&\n        [ModelParamType.Float, ModelParamType.Int].includes(p.type)\n      ) {\n        const { min, max } = p;\n\n        // For numeric types, if you really can't get the value, use 0.\n        if (['', undefined].includes(_v)) {\n          _v = 0;\n        }\n\n        if (min !== '' && Number(_v) < Number(min)) {\n          _v = Number(min);\n        }\n\n        if (max !== '' && Number(_v) > Number(max)) {\n          _v = Number(max);\n        }\n      }\n\n      _defaultValue[generationDiversity][key] = _v;\n    });\n  });\n\n  return _defaultValue;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type CSSProperties } from 'react';\n\nimport { type Model } from '@coze-arch/bot-api/developer_api';\n\nimport { ModelSelectV2 } from './model-select-v2';\n\nexport interface ModelSelectProps {\n  className?: string;\n  style?: CSSProperties;\n  value: number | undefined;\n  onChange: (value: number) => void;\n  models: Model[];\n  readonly?: boolean;\n}\n\nexport const ModelSelector: React.FC<ModelSelectProps> = ({\n  className,\n  value,\n  onChange,\n  models,\n  readonly,\n}) => (\n  <ModelSelectV2\n    className={className}\n    value={value}\n    onChange={onChange}\n    models={models}\n    readonly={readonly}\n  />\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// TODO first encapsulates a business component for joint debugging, and then abstracts it into a general request select.\nimport React, { Suspense, lazy } from 'react';\n\nimport { InputNumber, Tooltip, Slider } from '@coze-arch/coze-design';\nimport { IconInfo } from '@coze-arch/bot-icons';\n\nimport styles from '../index.module.less';\n\nconst LazyMdbox = lazy(async () => {\n  const { MdBoxLazy } = await import('@coze-arch/bot-md-box-adapter/lazy');\n  return {\n    default: MdBoxLazy,\n  };\n});\n\nexport const Divider = () => (\n  <div className=\"border-0 border-t border-solid coz-stroke-primary\" />\n);\n\nexport const SettingLayout = (props: {\n  title: string;\n  description?: string;\n  bolder?: boolean;\n  center?: React.ReactNode;\n  right?: React.ReactNode;\n  leftClassName?: string;\n}) => {\n  const {\n    title,\n    description,\n    center,\n    right,\n    bolder,\n    leftClassName = '',\n  } = props;\n  return (\n    <div className=\"flex gap-[4px]\">\n      <div\n        className={`${center ? 'w-[162px]' : 'flex-1'} ${\n          bolder ? 'font-semibold' : 'font-normal'\n        } flex items-center ${leftClassName}`}\n      >\n        {title}\n        {description ? (\n          <Tooltip\n            content={\n              <Suspense fallback={null}>\n                <LazyMdbox\n                  markDown={description}\n                  autoFixSyntax={{ autoFixEnding: false }}\n                />\n              </Suspense>\n            }\n          >\n            <IconInfo className=\"pl-[8px] cursor-pointer coz-fg-dim\" />\n          </Tooltip>\n        ) : undefined}\n      </div>\n      {center ? <div className=\"flex-1\">{center}</div> : undefined}\n      {right ? <div className=\"w-[110px]\">{right}</div> : undefined}\n    </div>\n  );\n};\n\nexport const SettingSlider = (props: {\n  title: string;\n  description?: string;\n  min?: number;\n  max?: number;\n  step?: number;\n  value?: number;\n  precision?: number;\n  defaultValue?: number;\n  onChange: (v: string | number) => void;\n  readonly?: boolean;\n}) => {\n  const {\n    title,\n    description,\n    onChange,\n    min = 0,\n    max = 100,\n    value = 0,\n    precision = 0,\n    readonly,\n  } = props;\n\n  const _step = 1 / Math.pow(10, precision);\n  return (\n    <SettingLayout\n      title={title}\n      description={description}\n      center={\n        <div className={`relative ${styles.slider}`}>\n          <Slider\n            key={title}\n            disabled={readonly}\n            value={value}\n            min={min}\n            max={max}\n            step={_step}\n            marks={{\n              [min]: `${min}`,\n              [max]: `${max}`,\n            }}\n            onChange={v => {\n              onChange(v as number);\n            }}\n          />\n        </div>\n      }\n      right={\n        <InputNumber\n          disabled={readonly}\n          precision={precision}\n          value={value}\n          min={min}\n          max={max}\n          step={_step}\n          onChange={v => {\n            if (v !== value) {\n              onChange(v as number);\n            }\n          }}\n        />\n      }\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// TODO first encapsulates a business component for joint debugging, and then abstracts it into a general request select.\nimport React, { useEffect, useMemo, useState, type FC } from 'react';\n\nimport { GenerationDiversity, RESPONSE_FORMAT_NAME } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { type OptionProps } from '@coze-arch/bot-semi/Select';\nimport { IconDownArrow } from '@coze-arch/bot-icons';\nimport {\n  type ModelParamClass,\n  type Model,\n} from '@coze-arch/bot-api/developer_api';\nimport { Select, Radio, RadioGroup } from '@coze-arch/coze-design';\n\nimport { cacheData, getCamelNameName, getValueByType } from '../utils';\nimport styles from '../index.module.less';\nimport { Divider, SettingLayout, SettingSlider } from './settings';\n\ninterface ModelSettingProps {\n  id: string;\n  value?: { [k: string]: unknown };\n  defaultValue?: Record<GenerationDiversity, object>;\n  model?: Model;\n  onChange: (v: ModelSettingProps['value']) => void;\n  readonly: boolean;\n}\n\nexport const ModelSetting: FC<ModelSettingProps> = ({\n  value,\n  onChange,\n  model,\n  defaultValue,\n  readonly,\n  id,\n}) => {\n  const [settingExpand, setSettingExpand] = useState(\n    cacheData.expand === undefined &&\n      value?.generationDiversity === GenerationDiversity.Customize &&\n      !readonly\n      ? true\n      : cacheData.expand,\n  );\n  // Customize to remember the last action of the user, and use as the default when the mode switches back\n  const _defaultValue = {\n    ...defaultValue,\n    [GenerationDiversity.Customize]:\n      cacheData[id] ?? defaultValue?.[GenerationDiversity.Customize],\n  };\n\n  // To remember the expanded state, workflow level sharing\n  useEffect(() => {\n    cacheData.expand = settingExpand;\n  }, [settingExpand]);\n\n  const { doms, generationDiversityGroupTitle } = useMemo(() => {\n    // Specialization 1: Filter out the response format and display it in the output node\n    const modelParams =\n      model?.model_params?.filter(m => m.name !== RESPONSE_FORMAT_NAME) ?? [];\n\n    // Get the group first\n    let groups: ModelParamClass[] = [];\n    modelParams.forEach(m => {\n      if (\n        m.param_class?.class_id &&\n        !groups.map(d => d.class_id).includes(m.param_class.class_id)\n      ) {\n        groups.push(m.param_class);\n      }\n    });\n\n    // Specialization 2: Generation Diversity title The style is written dead. Convention with the backend: Generation Diversity class_id === 1\n    const generationDiversityGroup = groups.find(d => d.class_id === 1);\n    const _generationDiversityGroupTitle =\n      generationDiversityGroup?.label || '';\n    if (generationDiversityGroup) {\n      // If there is Generation Diversity, it must be at the top\n      groups = [\n        generationDiversityGroup,\n        ...groups.filter(d => d.class_id !== generationDiversityGroup.class_id),\n      ];\n    }\n\n    // Render setters one by one in grouping order\n    const _doms: React.ReactNode[] = [];\n    const _setCacheData = (v: { [k: string]: unknown }) => {\n      if (v.generationDiversity === GenerationDiversity.Customize) {\n        cacheData[id] = v;\n      }\n    };\n    groups.forEach((g, i) => {\n      // Groups are inserted directly into the dividing line, the first group is not required\n      if (i !== 0) {\n        _doms.push(<Divider />);\n      }\n      // If the hide & & belongs to the group Generative Diversity, it will not be rendered\n      if (!settingExpand && generationDiversityGroup?.class_id === g.class_id) {\n        return;\n      }\n\n      // Generate diversity title built-in, no need to add additional\n      if (generationDiversityGroup?.class_id !== g.class_id) {\n        _doms.push(<SettingLayout title={g.label ?? ''} bolder />);\n      }\n      const items = modelParams?.filter(\n        m => m.param_class?.class_id === g.class_id,\n      );\n      items?.forEach(item => {\n        const {\n          label = '',\n          name,\n          desc,\n          min,\n          max,\n          options,\n          precision,\n          type,\n        } = item;\n\n        // The API/bot/get_type_list interface gives test_key, and the save interface requires testKey. The front end is not aware (except response_format)\n        const key = getCamelNameName(name ?? '');\n        const _value = getValueByType<string | number | undefined>(\n          value?.[key],\n          type,\n        );\n\n        // If there is an options attribute, use Select\n        if (options?.length) {\n          const _optionsList = options.map(option => ({\n            ...option,\n            label: option.label || option.value,\n            value: getValueByType(option.value, type),\n          }));\n\n          _doms.push(\n            <SettingLayout\n              title={label}\n              description={desc}\n              center={\n                <Select\n                  disabled={readonly}\n                  className=\"w-full\"\n                  value={_value}\n                  onChange={v => {\n                    const _v = {\n                      ...value,\n                      [key]: v,\n                    };\n                    onChange(_v);\n                    _setCacheData(_v);\n                  }}\n                  optionList={_optionsList as OptionProps[]}\n                />\n              }\n            />,\n          );\n          // Otherwise, treat it as number processing, using Slider + NumberInput\n        } else {\n          _doms.push(\n            <SettingSlider\n              readonly={readonly}\n              title={label}\n              description={desc}\n              // defaultValue={getValueByType<number | undefined>(\n              //   _defaultValue?.[value?.generationDiversity as string]?.[key],\n              //   type,\n              // )}\n              value={_value as number | undefined}\n              min={getValueByType<number | undefined>(min, type)}\n              max={getValueByType<number | undefined>(max, type)}\n              precision={getValueByType<number | undefined>(precision, type)}\n              onChange={v => {\n                const _v = {\n                  ...value,\n                  [key]: v,\n                  generationDiversity: GenerationDiversity.Customize,\n                };\n\n                onChange(_v);\n                _setCacheData(_v);\n              }}\n            />,\n          );\n        }\n      });\n    });\n\n    return {\n      doms: _doms,\n      generationDiversityGroupTitle: _generationDiversityGroupTitle,\n    };\n  }, [settingExpand, value, model, readonly]);\n\n  return (\n    <div\n      className={'p-[24px] flex flex-col gap-[16px]'}\n      // onDragStart={e => {\n      //   e.stopPropagation();\n      //   e.preventDefault();\n      // }}\n      // Block canvas framing\n      onMouseDown={e => {\n        e.stopPropagation();\n      }}\n    >\n      <div className=\"flex items-center\">\n        <div className=\"flex-1 text-[18px] font-semibold\">\n          {I18n.t('workflow_detail_llm_model')}\n        </div>\n      </div>\n\n      <Divider />\n\n      <SettingLayout\n        title={generationDiversityGroupTitle}\n        description={I18n.t('model_config_generate_explain')}\n        bolder\n        leftClassName=\"!w-[165px]\"\n        center={\n          <div className=\"w-full pr-[8px]\">\n            <RadioGroup\n              type=\"button\"\n              disabled={readonly}\n              value={value?.generationDiversity as GenerationDiversity}\n              className={`${styles.radioGroup} w-full !flex`}\n              onChange={e => {\n                onChange({\n                  ...value,\n                  ..._defaultValue?.[e.target?.value],\n                  generationDiversity: e.target?.value,\n                });\n\n                if (e.target?.value === GenerationDiversity.Customize) {\n                  setSettingExpand(true);\n                }\n              }}\n            >\n              {[\n                {\n                  value: GenerationDiversity.Precise,\n                  label: I18n.t('model_config_generate_precise'),\n                },\n                {\n                  value: GenerationDiversity.Balance,\n                  label: I18n.t('model_config_generate_balance'),\n                },\n                {\n                  value: GenerationDiversity.Creative,\n                  label: I18n.t('model_config_generate_creative'),\n                },\n                {\n                  value: GenerationDiversity.Customize,\n                  label: I18n.t('model_config_generate_customize'),\n                },\n              ].map(d => (\n                <Radio key={d.value} value={d.value}>\n                  {d.label}\n                </Radio>\n              ))}\n            </RadioGroup>\n          </div>\n        }\n        right={\n          <div\n            className=\"cursor-pointe h-full flex items-center gap-[4px]\"\n            onClick={e => {\n              e.stopPropagation();\n              setSettingExpand(!settingExpand);\n            }}\n          >\n            <span>{I18n.t('model_config_generate_advance')}</span>\n            {settingExpand ? (\n              <IconDownArrow />\n            ) : (\n              <IconDownArrow className=\"rotate-180\" />\n            )}\n          </div>\n        }\n      />\n\n      {/* A setter dynamically rendered according to the backend */}\n      {doms}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useMemo, type FC } from 'react';\n\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\nimport { useEntityFromContext } from '@flowgram-adapter/free-layout-editor';\nimport { type WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { JsonViewer } from '@coze-common/json-viewer';\nimport {\n  GenerationDiversity,\n  type ResponseFormat,\n  useNodeTestId,\n} from '@coze-workflow/base';\nimport { type OptionItem } from '@coze-arch/bot-semi/Radio';\nimport { type Model } from '@coze-arch/bot-api/developer_api';\nimport { IconCozSetting } from '@coze-arch/coze-design/icons';\nimport { IconButton, Popover } from '@coze-arch/coze-design';\n\nimport { useWorkflowModels } from '@/hooks';\nimport PopupContainer from '@/components/popup-container';\n\nimport { cacheData, generateDefaultValueByMeta } from './utils';\nimport { ModelSelector } from './components/selector';\nimport { ModelSetting } from './components/model-setting';\n\nconst defaultGenerationDiversity = GenerationDiversity.Balance;\n\ninterface IValue {\n  modelName?: string;\n  modelType?: number;\n  generationDiversity?: GenerationDiversity;\n  responseFormat?: ResponseFormat;\n  [k: string]: unknown;\n}\n\ntype ModelSelectProps = SetterComponentProps<\n  IValue | undefined,\n  {\n    models: Model[];\n  }\n>;\n\nexport const ModelSelect: FC<ModelSelectProps> = ({\n  value: _value,\n  onChange,\n  readonly,\n}) => {\n  const { models } = useWorkflowModels();\n  const model = useMemo(\n    () => models.find(m => (m.model_type as number) === _value?.modelType),\n    [models, _value?.modelType],\n  );\n\n  /**\n   * Generate default values from modelMeta\n   */\n  const getDefaultValue = useCallback(\n    ({ modelType, value }: { modelType?: number; value?: object }) => {\n      const _model = models.find(m => m.model_type === modelType);\n      return generateDefaultValueByMeta({\n        modelParams: _model?.model_params,\n        value,\n      });\n    },\n    [models],\n  );\n\n  const defaultValue = useMemo(\n    () =>\n      getDefaultValue({ modelType: model?.model_type as number | undefined }),\n    [model],\n  );\n\n  const value = useMemo(\n    () => ({\n      generationDiversity: GenerationDiversity.Customize,\n      ...defaultValue[value?.generationDiversity || defaultGenerationDiversity],\n      ..._value,\n    }),\n    [_value, defaultValue],\n  );\n\n  const modelOptions = useMemo(() => {\n    const _options = models.map<OptionItem>(i => {\n      const item = {\n        label: i.name,\n        value: i.model_type,\n      };\n      return item;\n    });\n    return _options;\n  }, [models]);\n\n  const node = useEntityFromContext<WorkflowNodeEntity>();\n  const { getNodeSetterId, concatTestId } = useNodeTestId();\n  const setterTestId = getNodeSetterId('llm-select');\n\n  // [Operation and maintenance platform] Since the model list cannot be pulled, the drop-down box will not be rendered, so the existing model values will be directly displayed here.\n  if (IS_BOT_OP && value) {\n    return <JsonViewer data={value} />;\n  }\n\n  return (\n    <PopupContainer>\n      <div className=\"flex gap-1 items-center\">\n        <ModelSelector\n          data-testid={setterTestId}\n          readonly={readonly}\n          value={value?.modelType}\n          onChange={_v => {\n            const record = modelOptions.find(j => j.value === _v);\n            if (record) {\n              const generationDiversity =\n                value.generationDiversity ?? defaultGenerationDiversity;\n              let _defaultValue;\n\n              // If custom, priority: cached user value > default\n              if (generationDiversity === GenerationDiversity.Customize) {\n                _defaultValue =\n                  getDefaultValue({\n                    modelType: record.value as number,\n                    value: cacheData[node.id] as object,\n                  })?.[generationDiversity] ?? {};\n              } else {\n                _defaultValue =\n                  getDefaultValue({\n                    modelType: record.value as number,\n                  })?.[generationDiversity] ?? {};\n              }\n\n              onChange?.({\n                ..._defaultValue,\n                modelName: record.label as string,\n                modelType: record.value as number,\n                generationDiversity,\n                // Do not reset the output format when switching models\n                responseFormat:\n                  value?.responseFormat ?? _defaultValue?.responseFormat,\n              });\n            }\n          }}\n          models={models}\n        />\n        <Popover\n          autoAdjustOverflow={false}\n          className=\"rounded-md w-[660px]\"\n          trigger=\"click\"\n          content={\n            <ModelSetting\n              id={node.id}\n              defaultValue={defaultValue}\n              value={value}\n              onChange={_v => {\n                onChange?.({\n                  ..._v,\n                  modelName: value.modelName,\n                  modelType: value.modelType,\n                });\n              }}\n              model={model}\n              readonly={readonly}\n            />\n          }\n          spacing={30}\n        >\n          <IconButton\n            data-testid={`e2e-ui-button-action-${concatTestId(\n              setterTestId,\n              'model-setting-btn',\n            )}`}\n            wrapperClass=\"leading-none\"\n            color=\"secondary\"\n            size=\"small\"\n            icon={<IconCozSetting />}\n          />\n        </Popover>\n      </div>\n    </PopupContainer>\n  );\n};\n\nexport const modelSelect = {\n  key: 'ModelSelect',\n  component: ModelSelect,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/naming-convention */\nimport { createContext, useContext } from 'react';\n\nimport { type NicknameVariables, type MessageVisibilityValue } from './types';\n\ninterface MessageVisibilityContext {\n  value?: MessageVisibilityValue;\n  handleValueChange?: (value: MessageVisibilityValue) => void;\n  nicknameVariables?: NicknameVariables;\n  testId: string;\n}\n\nconst messageVisibilityContext = createContext<MessageVisibilityContext>({\n  testId: '',\n});\n\nexport const MessageVisibilityContextProvider =\n  messageVisibilityContext.Provider;\nexport const useMessageVisibilityContext = () =>\n  useContext(messageVisibilityContext);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, useEffect } from 'react';\n\nimport { intersectionWith } from 'lodash-es';\nimport { concatTestId } from '@coze-workflow/base';\nimport { RoleType } from '@coze-arch/idl/social_api';\nimport { I18n } from '@coze-arch/i18n';\nimport { CheckboxGroup, Checkbox } from '@coze-arch/coze-design';\n\nimport { VariableTypeTag } from '../../components/variable-type-tag';\nimport { useGetSceneFlowRoleList } from '../../../hooks/use-get-scene-flow-params';\nimport { type RoleSetting } from './types';\nimport { useMessageVisibilityContext } from './context';\n\ninterface PlayerCheckboxGroupProps {\n  value?: RoleSetting[];\n  onChange: (userSettings: RoleSetting[]) => void;\n}\n\nexport const PlayerCheckboxGroup: FC<PlayerCheckboxGroupProps> = props => {\n  const { value, onChange } = props;\n  const { testId } = useMessageVisibilityContext();\n  const { data: roleList = [] } = useGetSceneFlowRoleList();\n\n  useEffect(() => {\n    // If there is biz_role_id, the description is role information\n    const roleValues = value?.filter(item => item.biz_role_id);\n\n    if (!roleValues?.length) {\n      const hostUserSetting = roleList.find(\n        item => item.role_type === RoleType.Host,\n      );\n      if (hostUserSetting) {\n        onChange?.([hostUserSetting]);\n      }\n    }\n  }, []);\n\n  const handleOnChange = checkedValue => {\n    const result = intersectionWith(\n      roleList,\n      checkedValue,\n      (a: RoleSetting, b) => !!b && a.biz_role_id === b,\n    );\n    onChange?.(result);\n  };\n\n  let placeholderIdx = 1;\n\n  return (\n    <CheckboxGroup\n      value={(value || []).map(item => item.biz_role_id)}\n      className=\"mt-4\"\n      style={{ width: '100%' }}\n      onChange={handleOnChange}\n    >\n      {roleList?.map(item => (\n        <Checkbox\n          value={item.biz_role_id}\n          disabled={item.role_type === RoleType.Host}\n          data-testid={concatTestId(testId, 'role', item.biz_role_id)}\n        >\n          {item.role}\n          <VariableTypeTag>\n            {item.nickname ||\n              `${I18n.t(\n                'scene_edit_roles_list_nickname_empty_seat',\n                {},\n                '',\n              )}${placeholderIdx++}`}\n          </VariableTypeTag>\n        </Checkbox>\n      ))}\n    </CheckboxGroup>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { intersectionWith } from 'lodash-es';\nimport classnames from 'classnames';\nimport {\n  type RefExpression,\n  ValueExpressionType,\n  ViewVariableType,\n  useVariableType,\n} from '@coze-workflow/variable';\nimport { VARIABLE_TYPE_ALIAS_MAP } from '@coze-workflow/base/types';\nimport { concatTestId } from '@coze-workflow/base';\nimport { Tooltip, Checkbox, CheckboxGroup } from '@coze-arch/coze-design';\n\nimport { VariableTypeTag } from '../../components/variable-type-tag';\nimport { type NicknameVariable, type NicknameVariableSetting } from './types';\nimport { useMessageVisibilityContext } from './context';\n\nimport styles from './nickname-variable-checkbox-group.module.less';\n\nexport const NicknameVariableCheckboxGroup: FC<{\n  value?: NicknameVariableSetting[];\n  onChange: (userSettings: NicknameVariableSetting[]) => void;\n}> = props => {\n  const { nicknameVariables = [], testId } = useMessageVisibilityContext();\n  const { value, onChange } = props;\n\n  const handleOnChange = (checkedValue: string[]) => {\n    const result = intersectionWith(\n      nicknameVariables,\n      checkedValue,\n      (a, b) => a.name === b,\n    ).map<NicknameVariableSetting>(item => ({\n      biz_role_id: '',\n      role: '',\n      nickname: item.name,\n    }));\n\n    onChange?.(result);\n  };\n\n  return (\n    <CheckboxGroup\n      className={classnames('\"mt-4\"', styles['nickname-checkbox-group'])}\n      value={value?.map(item => item.nickname)}\n      onChange={handleOnChange}\n    >\n      {nicknameVariables?.map(item => (\n        <Checkbox\n          value={item.name}\n          data-testid={concatTestId(testId, 'nickname', item.name)}\n        >\n          <NicknameVariableLabel data={item} />\n        </Checkbox>\n      ))}\n    </CheckboxGroup>\n  );\n};\n\nconst NicknameVariableLabel: FC<{\n  data: NicknameVariable;\n}> = props => {\n  const { data } = props;\n  const { input } = data;\n\n  if (input?.type === ValueExpressionType.LITERAL) {\n    return (\n      <>\n        <Tooltip content={data.name}>\n          <div className=\"whitespace-nowrap truncate\">{data.name}</div>\n        </Tooltip>\n        <VariableTypeTag>\n          {VARIABLE_TYPE_ALIAS_MAP[ViewVariableType.String]}\n        </VariableTypeTag>\n      </>\n    );\n  } else {\n    return (\n      <RefVariableLabel name={data.name} input={data.input as RefExpression} />\n    );\n  }\n};\n\nconst RefVariableLabel: FC<{\n  name: string;\n  input: RefExpression;\n}> = props => {\n  const { name, input } = props;\n  const variableType = useVariableType(input?.content?.keyPath ?? []);\n\n  return (\n    <>\n      <Tooltip content={name}>\n        <div className=\"whitespace-nowrap truncate\">{name}</div>\n      </Tooltip>\n\n      {variableType ? (\n        <VariableTypeTag>\n          {VARIABLE_TYPE_ALIAS_MAP[variableType]}\n        </VariableTypeTag>\n      ) : null}\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, useState } from 'react';\n\nimport { concatTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { Radio } from '@coze-arch/coze-design';\n\nimport {\n  type UserSettings,\n  type RoleSelectHandler,\n  type RoleSetting,\n  type NicknameVariableSetting,\n} from './types';\nimport { PlayerCheckboxGroup } from './player-checkbox-group';\nimport { NicknameVariableCheckboxGroup } from './nickname-variable-checkbox-group';\nimport { useMessageVisibilityContext } from './context';\n\nimport styles from './role-select-panel.module.less';\n\nconst RadioGroup = Radio.Group;\n\ninterface RoleSelectPanelProps {\n  onSelect: RoleSelectHandler;\n}\n\nenum RoleType {\n  Player = '1',\n  NicknameVariable = '2',\n}\n\nconst getInitialRoleType = (userSettings?: UserSettings) => {\n  if (!userSettings || !userSettings.length) {\n    return RoleType.Player;\n  } else {\n    if (userSettings?.every(item => !!item.biz_role_id)) {\n      return RoleType.Player;\n    } else {\n      return RoleType.NicknameVariable;\n    }\n  }\n};\n\nexport const RoleSelectPanel: FC<RoleSelectPanelProps> = props => {\n  const { value, testId } = useMessageVisibilityContext();\n  const { onSelect } = props;\n\n  const [roleType, setRoleType] = useState(\n    getInitialRoleType(value?.user_settings),\n  );\n\n  const [selectedSettings, setSelectedSettings] = useState<{\n    [RoleType.Player]: RoleSetting[] | undefined;\n    [RoleType.NicknameVariable]: NicknameVariableSetting[] | undefined;\n  }>({\n    [RoleType.Player]:\n      getInitialRoleType(value?.user_settings) === RoleType.Player\n        ? (value?.user_settings as RoleSetting[])\n        : [],\n    [RoleType.NicknameVariable]:\n      getInitialRoleType(value?.user_settings) === RoleType.NicknameVariable\n        ? (value?.user_settings as NicknameVariableSetting[])\n        : [],\n  });\n\n  const handleRadioChange = e => {\n    e.stopPropagation();\n    e.preventDefault();\n    onSelect?.(selectedSettings[e.target.value]);\n    setRoleType(e.target.value);\n  };\n\n  const handleSelect = (_roleType: RoleType) => (_value: UserSettings) => {\n    setSelectedSettings({\n      ...selectedSettings,\n      [_roleType]: _value,\n    });\n\n    onSelect?.(_value);\n  };\n\n  return (\n    <div className=\"w-[320px] p-4\">\n      <RadioGroup\n        className={`w-full ${styles['role-type-radio-group']}`}\n        onChange={handleRadioChange}\n        type=\"button\"\n        value={roleType}\n      >\n        <Radio\n          value={RoleType.Player}\n          className=\"w-[50%]\"\n          data-testid={concatTestId(testId, 'roleType', 'player')}\n        >\n          {I18n.t(\n            'scene_workflow_chat_node_conversation_visibility_custom_roles',\n            {},\n            'Player',\n          )}\n        </Radio>\n        <Radio\n          value={RoleType.NicknameVariable}\n          className=\"w-[50%]\"\n          data-testid={concatTestId(testId, 'roleType', 'nickname')}\n        >\n          {I18n.t(\n            'scene_workflow_chat_node_conversation_visibility_custom_variable',\n            {},\n            'Nickname Variables',\n          )}\n        </Radio>\n      </RadioGroup>\n      <div className=\"h-max-[280px] overflow-auto\">\n        {roleType === RoleType.Player ? (\n          <PlayerCheckboxGroup\n            key=\"player\"\n            value={selectedSettings[RoleType.Player]}\n            onChange={handleSelect(RoleType.Player)}\n          />\n        ) : (\n          // <div>123</div>\n          <NicknameVariableCheckboxGroup\n            value={selectedSettings[RoleType.NicknameVariable]}\n            key=\"nickname\"\n            onChange={handleSelect(RoleType.NicknameVariable)}\n          />\n        )}\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useRef, type FC, useState, useEffect } from 'react';\n\nimport classnames from 'classnames';\nimport { IconChevronRight, IconTick } from '@douyinfe/semi-icons';\nimport { concatTestId } from '@coze-workflow/base';\nimport { Popover, Space, Dropdown } from '@coze-arch/coze-design';\n\nimport { type RenderSelectOptionParams } from './types';\nimport { RoleSelectPanel } from './role-select-panel';\nimport { useMessageVisibilityContext } from './context';\n\nexport const RoleSelectOptionItem: FC<RenderSelectOptionParams> = props => {\n  const { label, value: optionValue, focused, selected } = props;\n  const ref = useRef<HTMLDivElement>(null);\n\n  const { handleValueChange, testId } = useMessageVisibilityContext();\n  const [popupVisible, setPopupVisible] = useState(focused || selected);\n\n  useEffect(() => {\n    if (focused || selected) {\n      setPopupVisible(true);\n    } else {\n      setPopupVisible(false);\n    }\n  }, [focused, selected]);\n\n  const handleSelect = selectedRoles => {\n    handleValueChange?.({\n      visibility: optionValue,\n      user_settings: selectedRoles,\n    });\n  };\n\n  return (\n    <div\n      ref={ref}\n      className=\"relative\"\n      onMouseOver={() => setPopupVisible(true)}\n    >\n      <Popover\n        visible={popupVisible}\n        onVisibleChange={visible => {\n          setPopupVisible(visible);\n        }}\n        trigger=\"custom\"\n        getPopupContainer={() => ref.current || document.body}\n        content={<RoleSelectPanel onSelect={handleSelect} />}\n        position=\"rightTop\"\n      >\n        <Dropdown.Item\n          className=\"w-full flex justify-between\"\n          data-testid={concatTestId(testId, optionValue)}\n        >\n          <Space>\n            <IconTick\n              className={classnames({\n                ['text-[var(--semi-color-text-2)]']: selected,\n                ['text-transparent\t']: !selected,\n              })}\n            />\n            <div>{label}</div>\n          </Space>\n\n          <IconChevronRight />\n        </Dropdown.Item>\n      </Popover>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport classnames from 'classnames';\nimport { type Setter } from '@coze-workflow/setters';\nimport { IconTick } from '@douyinfe/semi-icons';\nimport { ViewVariableType } from '@coze-workflow/variable';\nimport { concatTestId } from '@coze-workflow/base';\nimport { RoleType } from '@coze-arch/idl/social_api';\nimport { I18n } from '@coze-arch/i18n';\nimport { type SelectProps } from '@coze-arch/bot-semi/Select';\nimport { Select, Space, Dropdown, Tag } from '@coze-arch/coze-design';\n\nimport PopupContainer from '@/components/popup-container';\n\nimport { useGetCurrentInputsParameters } from '../../hooks/use-get-current-input-parameters';\nimport { useGetSceneFlowRoleList } from '../../../hooks/use-get-scene-flow-params';\nimport { isRoleUserSettings } from './utils';\nimport {\n  type MessageVisibilityValue,\n  type MessageVisibilitySetterOptions,\n  type RoleSetting,\n  type NicknameVariableSetting,\n} from './types';\nimport { RoleSelectOptionItem } from './role-select-option-item';\nimport { MessageVisibilityContextProvider } from './context';\nimport { customVisibilityValue } from './constants';\n\nimport styles from './message-visibility.module.less';\n\nconst normalOptions = [\n  {\n    label: I18n.t(\n      'scene_workflow_chat_node_conversation_visibility_speaker',\n      {},\n      '',\n    ),\n    value: '2',\n  },\n  {\n    label: I18n.t(\n      'scene_workflow_chat_node_conversation_visibility_all',\n      {},\n      '',\n    ),\n    value: '4',\n  },\n  {\n    label: I18n.t(\n      'scene_workflow_chat_node_conversation_visibility_custom',\n      {},\n      '',\n    ),\n    value: customVisibilityValue,\n  },\n];\n\nexport const MessageVisibility: Setter<\n  MessageVisibilityValue,\n  MessageVisibilitySetterOptions\n> = props => {\n  const { value: initialValue, onChange, readonly, testId = '' } = props;\n  const inputParameters = useGetCurrentInputsParameters();\n\n  const { data: roleList } = useGetSceneFlowRoleList();\n\n  const [value, setValue] = useState<MessageVisibilityValue | undefined>(\n    initialValue,\n  );\n\n  const handleValueChange = (newValue: MessageVisibilityValue) => {\n    setValue(newValue);\n    onChange?.(newValue);\n  };\n\n  const renderOptionItem = renderProps => {\n    const { label, value: optionValue, onClick, selected } = renderProps;\n\n    const handleClick = () => {\n      handleValueChange({\n        visibility: optionValue,\n        user_settings: undefined,\n      });\n\n      onClick();\n    };\n\n    if (optionValue === customVisibilityValue) {\n      return <RoleSelectOptionItem {...renderProps} />;\n    } else {\n      return (\n        <Dropdown.Item\n          className={classnames('w-full justify-start', {\n            ['font-semibold']: selected,\n          })}\n          onClick={handleClick}\n          data-testid={concatTestId(testId, optionValue)}\n        >\n          <Space>\n            <IconTick\n              className={classnames({\n                ['text-[var(--semi-color-text-2)]']: selected,\n                ['text-transparent\t']: !selected,\n              })}\n            />\n            <div>{label}</div>\n          </Space>\n        </Dropdown.Item>\n      );\n    }\n  };\n\n  const handleRemoveUserSetting =\n    (userSetting: RoleSetting | NicknameVariableSetting) => () => {\n      if (!value?.user_settings) {\n        return;\n      }\n      const userSettings = value.user_settings;\n      if (isRoleUserSettings(userSettings)) {\n        handleValueChange({\n          ...value,\n          user_settings: (userSettings as RoleSetting[]).filter(\n            item => item.biz_role_id !== userSetting.biz_role_id,\n          ),\n        });\n      } else {\n        handleValueChange({\n          ...value,\n          user_settings: (userSettings as NicknameVariableSetting[]).filter(\n            item => item.nickname !== userSetting.nickname,\n          ),\n        });\n      }\n    };\n\n  const renderSelectedItem: SelectProps['renderSelectedItem'] = option => {\n    if (value?.visibility !== customVisibilityValue) {\n      return option.label;\n    } else {\n      if (value?.user_settings?.length) {\n        return value?.user_settings?.map(item => (\n          <Tag\n            color=\"primary\"\n            key={item.biz_role_id || item.nickname}\n            closable={\n              roleList?.find(role => role.biz_role_id === item.biz_role_id)\n                ?.role_type === RoleType.Host\n                ? false\n                : true\n            }\n            onClose={handleRemoveUserSetting(item)}\n          >\n            {item.biz_role_id\n              ? item.nickname\n                ? `${item.role}(${item.nickname})`\n                : item.role\n              : item.nickname}\n          </Tag>\n        ));\n      } else {\n        return null;\n      }\n    }\n  };\n\n  return (\n    <MessageVisibilityContextProvider\n      value={{\n        value,\n        handleValueChange,\n        nicknameVariables: inputParameters.filter(\n          item =>\n            item.name &&\n            (item.type === ViewVariableType.String ||\n              item.type === ViewVariableType.ArrayString),\n        ),\n        testId,\n      }}\n    >\n      <PopupContainer>\n        <Select\n          placeholder={I18n.t('workflow_testset_please_select')}\n          value={value?.visibility}\n          dropdownMatchSelectWidth\n          className={classnames('w-full', {\n            'pointer-events-none': readonly,\n          })}\n          optionList={normalOptions}\n          renderOptionItem={renderOptionItem}\n          dropdownClassName={styles['message-visibility-select-dropdown']}\n          renderSelectedItem={renderSelectedItem}\n          data-testid={testId}\n        />\n      </PopupContainer>\n    </MessageVisibilityContextProvider>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const customVisibilityValue = '3';\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport { toStandardSetter } from '../to-standard-setter';\n// import { MessageVisibilityWrapper } from './message-visibility-wrapper';\nimport { MessageVisibility } from './message-visibility';\nimport { customVisibilityValue } from './constants';\n\nexport const messageVisibility = {\n  key: 'MessageVisibility',\n  component: toStandardSetter(MessageVisibility),\n  validator: ({ value }) => {\n    if (\n      value.visibility === customVisibilityValue &&\n      !value.user_settings?.length\n    ) {\n      return I18n.t('required', {}, 'Required');\n    } else {\n      return true;\n    }\n  },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type NicknameVariableSetting, type RoleSetting } from './types';\n\nexport function isRoleUserSettings(\n  userSettings: RoleSetting[] | NicknameVariableSetting[],\n) {\n  return (userSettings as RoleSetting[]).some(item => item.biz_role_id !== '');\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type SetterComponentProps,\n  type SetterExtension,\n} from '@flowgram-adapter/free-layout-editor';\nimport { useNodeTestId } from '@coze-workflow/base';\n\nimport { withValidation } from '../../components/validation';\nimport { InputTree, type InputTreeProps } from '../../components/input-tree';\n\ninterface InputTreeOptions {\n  id: string;\n  disabled?: boolean;\n  disabledTooltip?: string;\n  readonly?: boolean;\n  emptyPlaceholder?: string;\n}\ntype InputTreeSetterProps = SetterComponentProps<\n  InputTreeProps['value'],\n  InputTreeOptions & Pick<InputTreeProps, 'columnsRatio'>\n>;\n\nconst InputWithValidation = withValidation<InputTreeSetterProps>(\n  ({ value, onChange, options, readonly: workflowReadonly, context }) => {\n    const {\n      disabled = false,\n      readonly = false,\n      emptyPlaceholder,\n      ...props\n    } = options || {};\n\n    const { getNodeSetterId } = useNodeTestId();\n\n    return (\n      <InputTree\n        {...props}\n        testId={getNodeSetterId(context.path)}\n        readonly={readonly || workflowReadonly}\n        disabled={disabled}\n        value={value}\n        onChange={onChange}\n        emptyPlaceholder={emptyPlaceholder}\n      />\n    );\n  },\n);\n\nexport const inputTree: SetterExtension = {\n  key: 'InputTree',\n  component: InputWithValidation,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { ImagePreview, Image } from '@coze-arch/bot-semi';\n\nimport { useElementWidth } from './use-element-width';\n\nimport styles from './index.module.less';\n\ninterface ImagesProps {\n  images?: string[];\n}\n\nexport const Images = ({ images = [] }: ImagesProps) => {\n  const { width, ref } = useElementWidth<HTMLDivElement>();\n  const onlyOneImage = images.length === 1;\n  const itemWidth = onlyOneImage ? width : (width - 12) / 2;\n  const itemHeight = Math.min((3 / 4) * itemWidth, 280);\n  const contentMaxHeight = onlyOneImage ? 'auto' : itemHeight * 2.5 + 16 * 2;\n\n  return (\n    <div ref={ref}>\n      <ImagePreview\n        className={styles.content}\n        style={{ maxHeight: contentMaxHeight }}\n        getPopupContainer={() => document.body}\n      >\n        {images.map((imageUrl, index) => (\n          <Image\n            key={index}\n            className={styles.item}\n            style={{ width: itemWidth, height: itemHeight }}\n            src={imageUrl}\n          />\n        ))}\n      </ImagePreview>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useLayoutEffect, useRef } from 'react';\n\nexport function useElementWidth<T extends HTMLElement>() {\n  const ref = useRef<T>(null);\n  const [width, setWidth] = useState(0);\n\n  useLayoutEffect(() => {\n    // Function to define the updated size\n    const updateSize = () => {\n      setWidth(ref.current ? ref.current.offsetWidth : 0);\n    };\n\n    // Create a ResizeObserver instance and observe the target element\n    const observer = new ResizeObserver(updateSize);\n    if (ref.current) {\n      observer.observe(ref.current);\n    }\n\n    // Update the size once when the component is loaded\n    updateSize();\n\n    // cleanup function\n    return () => {\n      observer.disconnect();\n    };\n  }, [ref.current]);\n\n  return { ref, width };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { UIButton } from '@coze-arch/bot-semi';\nimport { IconDownloadStroked } from '@douyinfe/semi-icons';\n\nimport { useImages } from './use-images';\nimport { Images } from './images';\n\nimport styles from './index.module.less';\n\nexport const ImagesWithDownload = () => {\n  const { images, downloadImages } = useImages();\n\n  return (\n    <div className={styles.container}>\n      {images.length > 0 && (\n        <>\n          <UIButton\n            className={styles.downloadImages}\n            type=\"primary\"\n            theme=\"borderless\"\n            onClick={downloadImages}\n            icon={<IconDownloadStroked />}\n          >\n            {I18n.t('imageflow_output_display_save')}\n          </UIButton>\n          <Images images={images} />\n        </>\n      )}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useTestRunOutputsValue } from './use-test-run-outputs-value';\nimport { useParseImages } from './use-parse-images';\nimport { useDownloadImages } from './use-download-images';\nexport function useImages(): {\n  images: string[];\n  downloadImages: () => void;\n} {\n  const outputsValue = useTestRunOutputsValue();\n  const images = useParseImages(outputsValue);\n  const downloadImages = useDownloadImages(images);\n\n  return {\n    images,\n    downloadImages,\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useState } from 'react';\n\nimport { isEqual } from 'lodash-es';\nimport { parseImagesFromOutputData } from '@coze-workflow/base';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowDocument } from '@flowgram-adapter/free-layout-editor';\n\nimport { useCurrentNode } from './use-current-node';\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function useParseImages(outputData: any) {\n  const node = useCurrentNode();\n  const workflowDocument = useService<WorkflowDocument>(WorkflowDocument);\n\n  const [images, setImages] = useState<string[]>([]);\n  useEffect(() => {\n    async function parseImages() {\n      const workflowJson = await workflowDocument.toNodeJSON(node);\n      const res = parseImagesFromOutputData({\n        outputData,\n        nodeSchema: workflowJson,\n      });\n\n      if (!isEqual(res?.sort(), images?.sort())) {\n        setImages(res);\n      }\n    }\n\n    parseImages();\n  }, [node, workflowDocument, outputData]);\n\n  return images;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { NodeExeStatus } from '@coze-arch/idl/workflow_api';\nimport { typeSafeJSONParse } from '@coze-arch/bot-utils';\n\nimport { useTestRunResult } from './use-test-run-result';\n\ninterface BatchItem {\n  output: string;\n}\n\ntype Batch = BatchItem[];\n\n// Get node debug output\nexport function useTestRunOutputsValue() {\n  let outputsValue;\n  const testRunResult = useTestRunResult();\n\n  if (testRunResult?.nodeStatus !== NodeExeStatus.Success) {\n    return;\n  }\n\n  // batch mode\n  if (testRunResult?.batch) {\n    const batch = typeSafeJSONParse(testRunResult.batch) as Batch;\n    const outputList = batch.map(item => typeSafeJSONParse(item.output));\n\n    outputsValue = {\n      outputList,\n    };\n  } else {\n    const log =\n      testRunResult?.NodeType === 'End' || testRunResult?.NodeType === 'Message'\n        ? testRunResult?.input\n        : testRunResult?.output || '';\n\n    outputsValue = typeSafeJSONParse(log);\n  }\n\n  return outputsValue;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n, type I18nKeysNoOptionsType } from '@coze-arch/i18n';\nimport { Spin } from '@coze-arch/bot-semi';\nimport { NodeExeStatus } from '@coze-arch/bot-api/workflow_api';\n\nimport { useTestRunResult } from './use-test-run-result';\nimport waitIcon from './assets/wait.svg';\nimport runningIcon from './assets/running.svg';\nimport failIcon from './assets/fail.svg';\n\nimport styles from './empty.module.less';\n\nexport function Empty() {\n  const testRunResult = useTestRunResult();\n  let text: I18nKeysNoOptionsType = 'imageflow_output_display_desc1';\n  let imageUrl = waitIcon;\n  const isRunning = testRunResult?.nodeStatus === NodeExeStatus.Running;\n  const isFail = testRunResult?.nodeStatus === NodeExeStatus.Fail;\n\n  if (isRunning) {\n    text = 'imageflow_output_display_desc2';\n    imageUrl = runningIcon;\n  }\n\n  if (isFail) {\n    text = 'imageflow_output_display_desc3';\n    imageUrl = failIcon;\n  }\n\n  const image = <img className={styles.img} src={imageUrl} />;\n\n  return (\n    <div className={styles.container}>\n      {isRunning ? (\n        <Spin wrapperClassName={styles.spin} indicator={image} />\n      ) : (\n        image\n      )}\n      <span className={styles.text}>{I18n.t(text)}</span>\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { NodeExeStatus } from '@coze-arch/idl/workflow_api';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { FormCard } from '../../../form-extensions/components/form-card';\nimport { useTestRunResult } from './use-test-run-result';\nimport { ImagesWithDownload } from './images-with-download';\nimport { Empty } from './empty';\n\nexport const ImgLog = () => {\n  const testRunResult = useTestRunResult();\n  const isShowTestRunResult = !!testRunResult;\n\n  return (\n    <FormCard\n      header={I18n.t('imageflow_output_display')}\n      expand={isShowTestRunResult}\n    >\n      {testRunResult?.nodeStatus === NodeExeStatus.Success ? (\n        <ImagesWithDownload />\n      ) : (\n        <Empty />\n      )}\n    </FormCard>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { StandardNodeType } from '@coze-workflow/base';\nconst inputAsOutputNodes = [StandardNodeType.End, StandardNodeType.Output];\n\nexport const isInputAsOutput = (flowNodeType: StandardNodeType) =>\n  inputAsOutputNodes.includes(flowNodeType);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport { isEqual } from 'lodash-es';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\nimport {\n  type StandardNodeType,\n  useWorkflowNode,\n  type RefExpressionContent,\n} from '@coze-workflow/base';\n\nimport { isInputAsOutput } from '../utils';\n\n/**\n * Get the list of reference variable paths in node inputs\n */\nexport const useRefVariablePathList = () => {\n  const workflowNode = useWorkflowNode();\n  const [pathList, setPathList] = useState<Array<Array<string>>>([]);\n  const node = useCurrentEntity();\n\n  // Non-target nodes directly return an empty list to avoid unnecessary listening\n  if (!isInputAsOutput(node?.flowNodeType as StandardNodeType)) {\n    return [];\n  }\n\n  const { inputParameters } = workflowNode || {};\n  const keyPathList = (inputParameters || []).reduce(\n    (list: Array<Array<string>>, i) => {\n      if (i.input?.type === 'ref') {\n        const variablePath = (i.input.content as RefExpressionContent)?.keyPath;\n\n        if (variablePath) {\n          return [...list, variablePath];\n        }\n      }\n      return list;\n    },\n    [],\n  );\n\n  if (!isEqual(pathList, keyPathList)) {\n    setPathList(keyPathList);\n  }\n\n  return pathList;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\n\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { DisposableCollection } from '@flowgram-adapter/common';\nimport { WorkflowVariableFacadeService } from '@coze-workflow/variable';\n\nexport const useListenVariableChange = ({ variablePathList, callback }) => {\n  const facadeService: WorkflowVariableFacadeService = useService(\n    WorkflowVariableFacadeService,\n  );\n\n  useEffect(() => {\n    callback();\n\n    const toDispose = new DisposableCollection();\n    variablePathList.forEach(path => {\n      toDispose.push(\n        facadeService.listenKeyPathTypeChange(path, () => {\n          callback();\n        }),\n      );\n    });\n    return () => toDispose.dispose();\n  }, [variablePathList, facadeService, callback]);\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useState } from 'react';\n\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { ViewVariableType } from '@coze-workflow/base';\n\nimport { useRefVariablePathList } from './use-ref-variable-path-list';\nimport { useListenVariableChange } from './use-listen-variable-change';\n\nexport const useInputContainsImage = (node: FlowNodeEntity) => {\n  const [inputContainsImage, setInputContainsImage] = useState(false);\n\n  const variablePathList = useRefVariablePathList();\n\n  const getInputContainsImage = useCallback(\n    () =>\n      variablePathList.some(path => {\n        const variable = node.context.variableService.getViewVariableByKeyPath(\n          path,\n          { node },\n        );\n        return [\n          ViewVariableType.Image,\n          ViewVariableType.ArrayImage,\n          ViewVariableType.Svg,\n          ViewVariableType.ArraySvg,\n        ].includes(variable?.type);\n      }),\n    [node, variablePathList],\n  );\n\n  // Trigger recalculation after listening for variable changes\n  useListenVariableChange({\n    variablePathList,\n    callback: () => setInputContainsImage(getInputContainsImage()),\n  });\n\n  return inputContainsImage;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\nimport { StandardNodeType } from '@coze-workflow/base';\n\nimport { isInputAsOutput, isOutputsContainsImage } from '../utils';\nimport { useInputContainsImage } from './use-input-contains-image';\n\n/**\n * According to the input and output of the node, determine whether to display the picture preview module\n */\nexport const useImagePreviewVisible = () => {\n  const node: FlowNodeEntity = useCurrentEntity();\n\n  const { flowNodeType } = node;\n\n  const inputContainsImage = useInputContainsImage(node);\n\n  // The starting node is not required\n  if (flowNodeType === StandardNodeType.Start) {\n    return false;\n  }\n\n  // The input of the end node and the message node is the output. When the input refers to the image type, it needs to be displayed\n  if (isInputAsOutput(flowNodeType as StandardNodeType)) {\n    return inputContainsImage;\n  } else {\n    // When the output contains a picture type, it needs to be displayed\n    return isOutputsContainsImage(node);\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FlowNodeFormData } from '@flowgram-adapter/free-layout-editor';\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { ViewVariableType } from '@coze-workflow/base';\n\nfunction isContainsImage(output): boolean {\n  if (!output) {\n    return false;\n  }\n\n  const checkValue = (_value): boolean => {\n    if (\n      [\n        ViewVariableType.Image,\n        ViewVariableType.ArrayImage,\n        ViewVariableType.Svg,\n        ViewVariableType.ArraySvg,\n      ].includes(_value?.type || '')\n    ) {\n      return true;\n    }\n\n    return _value?.children?.some(checkValue) ?? false;\n  };\n\n  return Array.isArray(output) ? output.some(checkValue) : checkValue(output);\n}\n\nexport function isOutputsContainsImage(node: FlowNodeEntity): boolean {\n  const formModel = node?.getData<FlowNodeFormData>(FlowNodeFormData).formModel;\n  const outputs = formModel?.getFormItemValueByPath?.('/outputs');\n\n  return isContainsImage(outputs);\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useEffect } from 'react';\n\nimport { nanoid } from 'nanoid';\nimport classNames from 'classnames';\nimport { useUpdateEffect } from 'ahooks';\nimport { ViewVariableType } from '@coze-workflow/base/types';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  Upload,\n  Toast,\n  type FileItem as SemiFileItem,\n} from '@coze-arch/coze-design';\nimport { typeSafeJSONParse } from '@coze-arch/bot-utils';\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  useUpload,\n  type FileItem,\n  FileItemStatus,\n  formatBytes,\n  getAccept,\n} from '@/hooks/use-upload';\nimport { FileIcon } from '@/components/file-icon';\n\nimport styles from './index.module.less';\n\ninterface IProps {\n  accept: string;\n  multiple: boolean;\n  disabled?: boolean;\n  viewVariableType?: ViewVariableType;\n  fileType: 'object' | 'image';\n}\ntype FileUploadProps = SetterComponentProps<string | undefined, IProps>;\n\nconst getInitialValue = (\n  val: string | undefined,\n  multiple: boolean,\n): FileItem[] => {\n  if (multiple) {\n    const multipleVal = typeSafeJSONParse(val);\n    if (Array.isArray(multipleVal)) {\n      return multipleVal.map(url => ({\n        url,\n        uid: nanoid(),\n        name: I18n.t('plugin_file_unknown'),\n      })) as FileItem[];\n    }\n  }\n  if (val) {\n    return [\n      {\n        url: val,\n        uid: nanoid(),\n        name: I18n.t('plugin_file_unknown'),\n      },\n    ] as FileItem[];\n  }\n  return [];\n};\n\nconst getDefaultPropsByViewVariableType = (\n  viewVariableType?: ViewVariableType,\n) =>\n  viewVariableType\n    ? {\n        accept: getAccept(viewVariableType),\n        fileType: [\n          ViewVariableType.Image,\n          ViewVariableType.ArrayImage,\n        ].includes(viewVariableType)\n          ? 'image'\n          : 'object',\n        multiple: ViewVariableType.isArrayType(viewVariableType),\n      }\n    : {};\n\nconst FileUpload = ({\n  value,\n  onChange,\n  readonly,\n  options,\n}: FileUploadProps) => {\n  const { accept, multiple, fileType, ...restOptions } = Object.assign(\n    {},\n    getDefaultPropsByViewVariableType(options.viewVariableType),\n    options,\n  );\n\n  const maxFileCount = multiple ? 20 : 1;\n\n  const {\n    upload,\n    fileList,\n    // isUploading,\n    deleteFile,\n    setFileList,\n  } = useUpload({\n    multiple,\n    fileType,\n    accept,\n    maxFileCount,\n  });\n\n  const handleUpload = async file => {\n    const { fileInstance } = file;\n    await upload(fileInstance);\n  };\n\n  const getSubmitValue = useCallback((): string | undefined => {\n    let newVal: string | undefined;\n    if (multiple) {\n      newVal = JSON.stringify(\n        fileList.filter(item => item.url).map(item => item.url),\n      );\n    } else {\n      newVal = fileList[0]?.url;\n    }\n    return newVal;\n  }, [fileList, multiple]);\n\n  // When the fileList is updated, onChange is triggered.\n  useUpdateEffect(() => {\n    const newVal = getSubmitValue();\n    onChange?.(newVal);\n  }, [getSubmitValue]);\n\n  // When the form value is updated, sync to fileList\n  useEffect(() => {\n    const val = getSubmitValue();\n    if (val !== value) {\n      setFileList(getInitialValue(value, multiple));\n    }\n  }, [value]);\n\n  const handleAcceptInvalid = () => {\n    Toast.error(\n      I18n.t('imageflow_upload_error_type', {\n        type: accept,\n      }),\n    );\n  };\n\n  const semiFileList: SemiFileItem[] = fileList.map(file => ({\n    name: file.name,\n    size: file.size !== undefined ? formatBytes(file.size) : '',\n    uid: file.uid || nanoid(),\n    status: file.status || FileItemStatus.Success,\n    url: file.uil,\n    validateMessage: file.validateMessage,\n    percent: file.percent,\n    preview: true,\n  }));\n\n  return (\n    <div\n      className={classNames(styles.container, {\n        [styles['hide-upload-area']]: fileList?.length >= maxFileCount,\n      })}\n    >\n      <Upload\n        disabled={readonly}\n        action=\"\"\n        limit={maxFileCount}\n        fileList={semiFileList}\n        customRequest={handleUpload}\n        draggable={true}\n        dragMainText={I18n.t('imageflow_upload_action_common')}\n        dragSubText={I18n.t('imageflow_upload_type', {\n          type: accept,\n        })}\n        multiple={multiple}\n        accept={accept}\n        onAcceptInvalid={handleAcceptInvalid}\n        previewFile={file => {\n          const { uid } = file;\n          const fileItem = fileList.find(item => item.uid === uid);\n          if (fileItem) {\n            return <FileIcon file={fileItem} size={36} />;\n          }\n        }}\n        onRemove={(currentFile, list, currentFileItem) => {\n          deleteFile(currentFileItem.uid);\n        }}\n        onClear={() => setFileList([])}\n        {...restOptions}\n      />\n    </div>\n  );\n};\n\nexport const fileUpload = {\n  key: 'FileUpload',\n  component: FileUpload,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createPortal } from 'react-dom';\nimport { type CSSProperties } from 'react';\n\nimport { useNodeRenderData } from '../../hooks';\n\n/**\n * Custom port components, support expand/retract;\n * When a node is stowed, the port dom is proxied to the node-render layer to avoid being affected by display: none.\n */\nexport const CustomPort = ({\n  portId,\n  portType,\n  className,\n  style,\n  collapsedClassName,\n  collapsedStyle,\n  testId,\n}: {\n  portId: string;\n  portType: 'input' | 'output';\n  className?: string;\n  style?: CSSProperties;\n  collapsedClassName?: string;\n  collapsedStyle?: CSSProperties;\n  testId?: string;\n}) => {\n  const { expanded, node: nodeElement } = useNodeRenderData();\n\n  if (expanded) {\n    return (\n      <div\n        className={className}\n        data-port-id={portId}\n        data-port-type={portType}\n        data-testid={testId}\n        style={style}\n      />\n    );\n  }\n\n  return createPortal(\n    <div\n      data-port-id={portId}\n      data-port-type={portType}\n      data-testid={testId}\n      className={`${collapsedClassName} absolute top-[50%] ${\n        portType === 'output' ? 'right-0' : 'left-0'\n      }`}\n      style={collapsedStyle}\n    />,\n    nodeElement,\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useRef, type ReactNode, useCallback } from 'react';\n\nimport { isUndefined } from 'lodash-es';\nimport CronGenerator from 'cron-string-generator';\nimport {\n  type ValueExpression,\n  ValueExpressionType,\n} from '@coze-workflow/base/types';\nimport { REPORT_EVENTS as ReportEventNames } from '@coze-arch/report-events';\nimport { I18n } from '@coze-arch/i18n';\nimport { Cascader, type CascaderData } from '@coze-arch/coze-design';\nimport { CustomError } from '@coze-arch/bot-error';\n\nconst hoursSize = 24;\nconst padStart = 2;\nconst hoursLeaf: CascaderData[] = Array.from(new Array(hoursSize).keys()).map(\n  i => ({\n    label: i.toString().padStart(padStart, '0').concat(':00'),\n    value: i,\n    isLeaf: true,\n  }),\n);\nconst weekDaysNode: () => CascaderData[] = () => {\n  const size = 7;\n  return Array.from({ length: size }).map((item, index) => ({\n    label: I18n.t('bot_task_preset_day_of_week', { day: index }),\n    value: index,\n    children: hoursLeaf,\n  }));\n};\n\nconst monthDaysNode: () => CascaderData[] = () => {\n  const size = 31;\n  return Array.from({ length: size }).map((item, index) => ({\n    label: I18n.t('bot_task_preset_day_of_month', { day: index + 1 }),\n    value: index + 1,\n    children: hoursLeaf,\n  }));\n};\n\nconst intervalDaysNode: () => CascaderData[] = () => {\n  const size = 5;\n  const offset = 2;\n  return Array.from({ length: size }).map((item, index) => ({\n    label: I18n.t('bot_task_preset_day_of_month', { day: index + offset }),\n    value: index + offset,\n    children: hoursLeaf,\n  }));\n};\n\nconst triggeredEveryday = () => I18n.t('bot_task_preset_triggered_everyday');\nconst triggeredEveryweek = () => I18n.t('bot_task_preset_triggered_everyweek');\nconst triggeredMonthly = () => I18n.t('bot_task_preset_triggered_monthly');\nconst triggeredInterval = () => I18n.t('bot_task_preset_triggered_interval');\n\nconst treeData: () => CascaderData[] = () => [\n  {\n    label: triggeredEveryday(),\n    value: 'daily',\n    children: hoursLeaf,\n  },\n  {\n    label: triggeredEveryweek(),\n    value: 'weekly',\n    children: weekDaysNode(),\n  },\n  {\n    label: triggeredMonthly(),\n    value: 'monthly',\n    children: monthDaysNode(),\n  },\n  {\n    label: triggeredInterval(),\n    value: 'intervalDaily',\n    children: intervalDaysNode(),\n  },\n];\n\ntype TaskSchedule = [string, number] | [string, number, number];\n\nconst createCron = (schedule: TaskSchedule) => {\n  const head = schedule[0];\n  const cronGenerator = new CronGenerator();\n\n  if (head === 'daily') {\n    const hour = schedule[1];\n    return cronGenerator.every(1).days().atHour(hour).atMinute(0).toString();\n  }\n  const day = schedule[1];\n  const hour = schedule[2];\n  if (isUndefined(hour)) {\n    throw new CustomError(\n      ReportEventNames.parmasValidation,\n      'invalid schedule',\n    );\n  }\n  if (head === 'weekly') {\n    return cronGenerator.atHour(hour).atMinute(0).onDaysOfWeek(day).toString();\n  }\n  if (head === 'monthly') {\n    return cronGenerator.atHour(hour).atMinute(0).onDaysOfMonth(day).toString();\n  }\n  return cronGenerator.every(day).days().atHour(hour).atMinute(0).toString();\n};\nexport const parseCron: (cron: string) => TaskSchedule = cronExpr => {\n  // The current demand is only 5, minutes, hours, day of month, month, day of week\n  // Bytescheduler only supports 6 bits, seconds, minutes, hours, day of month, month, day of week\n  const cronUnits = cronExpr?.split?.(' ').slice?.(1);\n  const hour = cronUnits?.at(1);\n  const dayOfMonthIndex = 2;\n  const dayOfMonth = cronUnits?.at(dayOfMonthIndex);\n  const dayOfWeek = cronExpr?.at(-1);\n\n  const numberHour = Number(hour);\n  // wild-card\n  const wildcard = '*';\n  if (dayOfWeek !== wildcard) {\n    return ['weekly', Number(dayOfWeek), numberHour];\n  }\n  if (dayOfMonth !== wildcard) {\n    if (dayOfMonth?.startsWith(wildcard)) {\n      return ['intervalDaily', Number(dayOfMonth.split('/').at(1)), numberHour];\n    }\n    return ['monthly', Number(dayOfMonth), numberHour];\n  }\n  return ['daily', numberHour];\n};\n\n// Convert key to corresponding copy\n// export const getOptionNodeText = (val: TaskSchedule): string[] => {\n//   let resultData = treeData();\n//   const nodeList = val?.map(item => {\n//     const findData = resultData.find(data => data.value === item);\n//     if (findData) {\n//       resultData = findData?.children || [];\n//       return String(findData.label) ?? '';\n//     } else {\n//       return '';\n//     }\n//   });\n//   return nodeList;\n// };\n\nconst renderDisplay = (nodeList: string[]) => {\n  const head = nodeList.at(0);\n  const formatHours = (hours?: string) => {\n    const formattedHours = hours?.startsWith?.('0') ? hours.slice?.(1) : hours;\n    return formattedHours;\n  };\n  if (head === triggeredEveryday()) {\n    const hours = nodeList.at(1);\n    return I18n.t('bot_task_preset_everyday_task', {\n      time: formatHours(hours),\n    });\n  }\n\n  const numberRegx = /[0-9]+/;\n  const dayNode = nodeList.at(1);\n  const days = Number(dayNode?.match?.(numberRegx)?.[0]);\n  const hoursIndex = 2;\n  const hours = nodeList.at(hoursIndex);\n\n  const formattedHours = formatHours(hours);\n  if (head === triggeredEveryweek()) {\n    return I18n.t('bot_task_preset_everyweek_task', {\n      day: dayNode,\n      time: formattedHours,\n    });\n  }\n  if (head === triggeredMonthly()) {\n    return I18n.t('bot_task_preset_monthly_task', {\n      day: days,\n      time: formattedHours,\n    });\n  }\n  if (head === triggeredInterval()) {\n    return I18n.t('bot_task_preset_interval_task', {\n      day: days,\n      time: formattedHours,\n    });\n  }\n  return '';\n};\n\ninterface FixCronjobSelectProps {\n  value?: ValueExpression;\n  onChange?: (e: ValueExpression) => void;\n  readonly?: boolean;\n  hasError?: boolean;\n}\n\n/** Select time and time zone components */\nexport const FixCronjobSelect: React.FC<FixCronjobSelectProps> = ({\n  value: _value,\n  onChange: _onChange,\n  readonly,\n  hasError,\n}) => {\n  const displayText = useRef<ReactNode>('');\n  const value = _value?.content as string;\n\n  const onChange = useCallback(\n    (v: string) => {\n      _onChange?.({\n        type: ValueExpressionType.LITERAL,\n        content: v,\n      });\n    },\n    [_onChange],\n  );\n\n  return (\n    <>\n      <Cascader\n        hasError={hasError}\n        size=\"small\"\n        className=\"w-full\"\n        disabled={readonly}\n        showClear={false}\n        placeholder={I18n.t('task_preset_trigger_time')}\n        value={value ? parseCron(value) : void 0}\n        onChange={v => {\n          if (Array.isArray(v) && v.length) {\n            // The resulting cron expression is 5 bits, but 6 bits are required\n            const cronExpr = `0 ${createCron(v as TaskSchedule)}`;\n            onChange?.(cronExpr);\n            return;\n          }\n          onChange?.('');\n        }}\n        treeData={treeData()}\n        displayRender={nodes => {\n          if (Array.isArray(nodes)) {\n            displayText.current = renderDisplay(nodes);\n            return displayText.current;\n          }\n        }}\n      />\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useRef, useState } from 'react';\n\nimport classNames from 'classnames';\nimport {\n  workflowApi,\n  CopilotType,\n  ValueExpression,\n  ValueExpressionType,\n  ViewVariableType,\n} from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozStopCircle, IconCozApply } from '@coze-arch/coze-design/icons';\nimport {\n  AIButton,\n  Button,\n  IconButton,\n  Input,\n  Popconfirm,\n} from '@coze-arch/coze-design';\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport { useRefInput } from '@/hooks/use-ref-input';\nimport { useGlobalState } from '@/hooks';\n\nimport style from './index.module.less';\n\ninterface AICronjobSelectProps {\n  value?: ValueExpression;\n  onChange: (v: ValueExpression | undefined) => void;\n  readonly?: boolean;\n  node: FlowNodeEntity;\n  needRefInput?: boolean;\n  hasError?: boolean;\n}\n\nconst Suffix = ({ onChange }: { onChange: (v: string) => void }) => {\n  const [visible, setVisible] = useState(false);\n  const [prompt, setPrompt] = useState('');\n  const [cronjob, setCronjob] = useState('');\n  const [aiGenerating, setAIGenerating] = useState(false);\n  const cancelRequest = useRef<(reason?: unknown) => void>();\n\n  const { spaceId, projectId, workflowId } = useGlobalState();\n  return (\n    <>\n      <Popconfirm\n        className=\"w-[330px]\"\n        title={I18n.t('workflow_start_trigger_cron_ai', {}, ' AI ')}\n        trigger=\"custom\"\n        stopPropagation\n        onClickOutSide={() => {\n          setVisible(false);\n        }}\n        content={\n          <div className=\"mt-[12px] flex flex-col gap-[12px] text-[12px]\">\n            <div className=\"flex flex-col gap-[4px] p-[8px] rounded-mini coz-mg-hglt\">\n              {/* <div className=\"font-medium coz-fg-plus\">Sample i18n</div> */}\n              <div className=\"coz-fg-primary\">\n                {I18n.t(\n                  'workflow_trigger_cron_gen_sample_placeholder',\n                  {},\n                  '18Cron 0 18 * * *  18 ',\n                )}\n              </div>\n            </div>\n\n            <div className=\"flex flex-col gap-[4px]\">\n              <div className=\"flex justify-between\">\n                <div className=\"text-[14px] font-medium coz-fg-plus\">\n                  {I18n.t('Imageflow_prompt', {}, 'Prompt')}\n                </div>\n                {!aiGenerating ? (\n                  <AIButton\n                    size=\"small\"\n                    disabled={!prompt}\n                    onClick={async () => {\n                      try {\n                        setAIGenerating(true);\n\n                        const rs = await workflowApi.CopilotGenerate({\n                          space_id: spaceId,\n                          project_id: projectId ?? '',\n                          copilot_type: CopilotType.CRONTAB,\n                          workflow_id: workflowId,\n                          query: prompt,\n                        });\n\n                        setCronjob(rs?.data?.content ?? '');\n                      } finally {\n                        setAIGenerating(false);\n                      }\n                    }}\n                    color=\"aihglt\"\n                  >\n                    {I18n.t('workflow_start_trigger_cron_gen', {}, '')}\n                  </AIButton>\n                ) : (\n                  <IconButton\n                    size=\"small\"\n                    onClick={() => {\n                      try {\n                        cancelRequest.current?.('cancel');\n                      } finally {\n                        setAIGenerating(false);\n                      }\n                    }}\n                    icon={<IconCozStopCircle />}\n                    color=\"aihglt\"\n                  >\n                    {I18n.t('workflow_start_trigger_cron_gen_stop', {}, '')}\n                  </IconButton>\n                )}\n              </div>\n              <Input\n                size=\"small\"\n                value={prompt}\n                placeholder={I18n.t(\n                  'workflow_trigger_cron_gen_prompt_placeholder',\n                  {},\n                  '18',\n                )}\n                onChange={setPrompt}\n              ></Input>\n            </div>\n\n            <div className=\"flex flex-col gap-[4px]\">\n              <div className=\"text-[14px] font-medium coz-fg-plus\">\n                {I18n.t(\n                  'workflow_start_trigger_cron_generated',\n                  {},\n                  ' Cron ',\n                )}\n              </div>\n              <div className=\"flex flex-row gap-[8px]\">\n                <Input\n                  loading={aiGenerating}\n                  size=\"small\"\n                  disabled\n                  value={cronjob}\n                  onChange={setCronjob}\n                ></Input>\n                <Button\n                  size=\"small\"\n                  loading={aiGenerating}\n                  disabled={!cronjob}\n                  onClick={() => {\n                    if (cronjob) {\n                      onChange(cronjob);\n                      setVisible(false);\n                    }\n                  }}\n                >\n                  {I18n.t('workflow_start_trigger_cron_fillin', {}, '')}\n                </Button>\n              </div>\n            </div>\n          </div>\n        }\n        visible={visible}\n        onVisibleChange={v => {\n          setVisible(v);\n        }}\n        onCancel={() => {\n          setVisible(false);\n        }}\n        okText={''}\n        cancelText={I18n.t('workflow_start_trigger_cron_cancel', {}, '')}\n      >\n        <div>\n          <AIButton\n            size=\"mini\"\n            onClick={() => setVisible(true)}\n            color=\"aihglt\"\n            onlyIcon\n          />\n        </div>\n      </Popconfirm>\n    </>\n  );\n};\n\nexport const AICronjobSelect = ({\n  value,\n  onChange: _onChange,\n  readonly,\n  node,\n  needRefInput = false,\n  hasError,\n}: AICronjobSelectProps) => {\n  const onLiteralChange = useCallback(\n    (v: string) => {\n      _onChange({\n        type: ValueExpressionType.LITERAL,\n        content: v,\n      });\n    },\n    [_onChange],\n  );\n\n  const isRef = value?.type && ValueExpression.isRef(value);\n\n  const { renderVariableSelect, renderVariableDisplay } = useRefInput({\n    value,\n    onChange: _onChange,\n    readonly,\n    node,\n    style: { width: '100%' },\n    disabledTypes: ViewVariableType.getComplement([ViewVariableType.String]),\n  });\n  return (\n    <div className=\"w-full flex flex-row gap-[4px]\">\n      {isRef ? (\n        renderVariableDisplay({ needWrapper: true })\n      ) : (\n        <Input\n          error={hasError}\n          size=\"small\"\n          disabled={readonly}\n          className={classNames(['w-full flex-1', style.input])}\n          value={value?.content as string}\n          placeholder={I18n.t(\n            'workflow_start_trigger_cron_ai_sample',\n            {},\n            ' cron 0 18 * * *  18 ',\n          )}\n          onChange={onLiteralChange}\n          suffix={\n            <div className=\"flex flex-row gap-[4px]\">\n              <Suffix onChange={onLiteralChange} />\n              {needRefInput ? (\n                <div>\n                  {renderVariableSelect(\n                    <IconButton\n                      size=\"mini\"\n                      color=\"secondary\"\n                      icon={<IconCozApply className=\"text-[16px]\" />}\n                    />,\n                  )}\n                </div>\n              ) : undefined}\n            </div>\n          }\n        ></Input>\n      )}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  type ConditionItem,\n  type ConditionValue,\n} from '../multi-condition/types';\nimport { HiddenConditionItem } from './condition-item';\n\ntype ConditionProps = SetterComponentProps<ConditionValue>;\n\nexport const HiddenCondition: FC<ConditionProps> = props => {\n  const { value, onChange } = props;\n\n  const handleConditionItemChange: (\n    branchIndex: number,\n    conditionItemIndex: number,\n  ) => (data: ConditionItem) => void =\n    (branchIndex, conditionItemIndex) => conditionItem => {\n      const activeBranch = value[branchIndex];\n\n      const newConditions = activeBranch.condition.conditions.map(\n        (item, subIndex) => {\n          if (subIndex === conditionItemIndex) {\n            return {\n              ...conditionItem,\n            };\n          } else {\n            return item;\n          }\n        },\n      );\n\n      onChange?.(\n        value.map((branch, index) => {\n          if (index === branchIndex) {\n            return {\n              condition: {\n                ...branch.condition,\n                conditions: newConditions,\n              },\n            };\n          } else {\n            return branch;\n          }\n        }),\n      );\n    };\n\n  return (\n    <>\n      {value?.map((branch, branchIndex) =>\n        branch.condition.conditions.map((item, conditionItemIndex) => (\n          <HiddenConditionItem\n            data={item}\n            onDataChange={handleConditionItemChange(\n              branchIndex,\n              conditionItemIndex,\n            )}\n          />\n        )),\n      )}\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState, useCallback, type FC } from 'react';\n\nimport { isEqual } from 'lodash-es';\nimport update from 'immutability-helper';\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\nimport { useAutoSyncRenameData } from '@coze-workflow/variable';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\nimport {} from '@/hooks/use-update-sorted-port-lines';\n\nimport {\n  useNodeRenderData,\n  useNodeRenderScene,\n  useUpdateSortedPortLines,\n} from '@/hooks';\n\nimport { HiddenCondition } from '../hidden-condition';\nimport { useConditionValidate } from './validate/use-condition-validate';\nimport {\n  type ConditionValue,\n  Logic,\n  type ConditionValueWithUid,\n  type ConditionBranchValueWithUid,\n} from './types';\nimport { CustomDragLayer } from './draggable/custom-drag-layer';\nimport { ConditionDraggableContainer } from './draggable/container';\nimport { DraggableConditionBranchPreview } from './draggable/condition-branch-preview';\nimport { DraggableConditionBranch } from './draggable/condition-branch';\nimport { ConditionContextProvider } from './context';\nimport { ConditionHeader } from './condition-header';\n\ntype ConditionProps = SetterComponentProps<ConditionValue>;\n\nconst CONDITION_PORT_ID_PREFIX = 'true';\n\nexport function ConditionSetter(props: ConditionProps): JSX.Element {\n  const { context, value, onChange, readonly } = props;\n\n  const { getNodeTestId, concatTestId } = useNodeTestId();\n\n  const [branches, setBranches] = useState<ConditionValueWithUid>(\n    (value ?? []).map((item, index) => ({\n      ...item,\n      uid: index,\n    })),\n  );\n\n  const { node } = context;\n\n  const [draggingBranchUid, setDraggingBranchUid] = useState<\n    number | undefined\n  >();\n  const { expanded } = useNodeRenderData();\n\n  const calcPortId = (index: number) => {\n    if (index === 0) {\n      return CONDITION_PORT_ID_PREFIX;\n    } else {\n      return `${CONDITION_PORT_ID_PREFIX}_${index}`;\n    }\n  };\n\n  const updateSortedPortLines = useUpdateSortedPortLines(calcPortId);\n\n  const {\n    validateResults,\n    initValidateResultsWithBranches,\n    validateAllBranches,\n  } = useConditionValidate();\n\n  useEffect(() => {\n    initValidateResultsWithBranches(value || []);\n  }, []);\n\n  useEffect(() => {\n    // Monitor the canvas to save the form, and perform an overall verification when submitting\n    const disposable = context.onFormValidate(() => {\n      validateAllBranches(branches);\n    });\n    return () => {\n      disposable.dispose();\n    };\n  }, [branches]);\n\n  useEffect(() => {\n    if (typeof draggingBranchUid === 'undefined') {\n      validateAllBranches(branches);\n      onChange?.(\n        branches.map(item => ({\n          condition: item.condition,\n        })),\n      );\n    } else {\n      validateAllBranches(branches);\n    }\n  }, [branches, draggingBranchUid]);\n\n  useEffect(() => {\n    // Here we need to determine whether the external value is consistent with the branches in the state\n    // Update branches only when they are inconsistent to avoid endless loops\n    if (\n      !isEqual(\n        value,\n        branches.map(item => ({\n          condition: item.condition,\n        })),\n      )\n    ) {\n      setBranches(\n        (value ?? []).map((item, index) => ({\n          ...item,\n          uid: index,\n        })),\n      );\n    }\n  }, [value]);\n\n  useAutoSyncRenameData(branches, {\n    onDataRenamed: _branches => {\n      setBranches(_branches);\n    },\n  });\n\n  const handleBranchChange =\n    (index: number) => (branch: ConditionBranchValueWithUid) => {\n      setBranches(\n        branches.map((item, innerIndex) => {\n          if (innerIndex === index) {\n            return branch;\n          } else {\n            return item;\n          }\n        }),\n      );\n    };\n\n  const calcUid = () => {\n    const uidArr = (branches ?? []).reduce<number[]>((buf, branch) => {\n      const { uid } = branch;\n      if (uid) {\n        buf.push(uid);\n      }\n      return buf;\n    }, []);\n\n    return uidArr.length ? Math.max(...uidArr) + 1 : 1;\n  };\n\n  const handleAddBranch = () => {\n    setBranches(\n      branches.concat([\n        {\n          uid: calcUid(),\n          condition: {\n            logic: Logic.AND,\n            conditions: [\n              {\n                left: undefined,\n                operator: undefined,\n                right: undefined,\n              },\n            ],\n          },\n        },\n      ]),\n    );\n  };\n\n  const handleDeleteBranch = index => () => {\n    // Move the port to be deleted to the end so that the deletion does not affect other connection sequences\n    updateSortedPortLines(index, value.length);\n    setBranches(branches.filter((item, innerIndex) => innerIndex !== index));\n  };\n\n  const handleMoveBranch = useCallback(\n    (dragIndex: number, hoverIndex: number) => {\n      setBranches(prevBranches =>\n        update(prevBranches, {\n          $splice: [\n            [dragIndex, 1],\n            [hoverIndex, 0, prevBranches[dragIndex]],\n          ],\n        }),\n      );\n    },\n    [],\n  );\n\n  const handleDragEnd = (startIndex: number, endIndex: number) => {\n    setDraggingBranchUid(undefined);\n    // When the connection service recalculates the port, the dom may not have been updated yet, so add a delay here to ensure that the dom has been updated when the recalculation is completed\n    setTimeout(() => {\n      updateSortedPortLines(startIndex, endIndex);\n    }, 0);\n  };\n\n  const draggingBranch = (branches ?? []).find(\n    branch => branch.uid === draggingBranchUid,\n  );\n  const draggingIndex = (branches ?? []).findIndex(\n    branch => branch.uid === draggingBranchUid,\n  );\n\n  return (\n    <div className=\"mt-3\" style={{ borderBottomWidth: 0, paddingBottom: 0 }}>\n      <ConditionContextProvider\n        value={{\n          flowNodeEntity: node,\n          readonly,\n          expanded,\n          setterPath: concatTestId(getNodeTestId(), context.path),\n        }}\n      >\n        {expanded ? <ConditionHeader onAdd={handleAddBranch} /> : null}\n        <ConditionDraggableContainer>\n          {branches?.map((branch, index) => (\n            <DraggableConditionBranch\n              key={branch.uid}\n              index={index}\n              isFirstBranch={index === 0}\n              showDraggable={branches.length > 1}\n              priority={branches.length > 1 ? index + 1 : undefined}\n              prefixName={\n                index === 0\n                  ? I18n.t('worklfow_condition_if', {}, 'If')\n                  : I18n.t('worklfow_condition_else_if', {}, 'Else if')\n              }\n              portId={calcPortId(index)}\n              branch={branch}\n              onChange={handleBranchChange(index)}\n              onDelete={handleDeleteBranch(index)}\n              deletable={branches.length > 1}\n              branchValidateResult={validateResults[index]}\n              onDragStart={setDraggingBranchUid}\n              onDragEnd={handleDragEnd}\n              onMoveBranch={handleMoveBranch}\n            />\n          ))}\n          <CustomDragLayer\n            preview={\n              typeof draggingBranchUid === 'undefined' ||\n              !draggingBranch ? null : (\n                <DraggableConditionBranchPreview\n                  index={draggingIndex}\n                  priority={draggingIndex + 1}\n                  prefixName={\n                    draggingIndex === 0\n                      ? I18n.t('worklfow_condition_if', {}, 'If')\n                      : I18n.t('worklfow_condition_else_if', {}, 'Else if')\n                  }\n                  portId={calcPortId(draggingIndex)}\n                  branch={draggingBranch}\n                />\n              )\n            }\n          />\n        </ConditionDraggableContainer>\n      </ConditionContextProvider>\n    </div>\n  );\n}\n\nexport const Condition: FC<ConditionProps> = props => {\n  const { isNewNodeRender } = useNodeRenderScene();\n\n  if (isNewNodeRender) {\n    return <HiddenCondition {...props} />;\n  } else {\n    return <ConditionSetter {...props} />;\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { nanoid } from 'nanoid';\nimport { ViewVariableType, useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { Tooltip, Switch } from '@coze-arch/coze-design';\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { ChatHistoryRound } from '@/components/chat-history-round';\n\nimport { OutputTree, type OutputTreeProps } from '../../components/output-tree';\nimport { FormCard } from '../../components/form-card';\n\nimport styles from './index.module.less';\n\nconst VALUE = [\n  {\n    key: nanoid(),\n    name: 'chatHistory',\n    type: ViewVariableType.ArrayObject,\n    children: [\n      {\n        key: nanoid(),\n        name: 'role',\n        type: ViewVariableType.String,\n      },\n      {\n        key: nanoid(),\n        name: 'content',\n        type: ViewVariableType.String,\n      },\n    ],\n  },\n] as OutputTreeProps['value'];\n\nexport interface ChatHistoryValue {\n  enableChatHistory: boolean;\n  chatHistoryRound: number;\n}\n\nexport const ChatHistory: FC<SetterComponentProps<ChatHistoryValue>> = ({\n  value,\n  onChange,\n  readonly,\n  context,\n}) => {\n  const { getNodeSetterId } = useNodeTestId();\n\n  return (\n    <>\n      <FormCard.Action>\n        <Tooltip content={I18n.t('wf_chatflow_125')} position=\"right\">\n          <div className=\"flex items-center gap-1\">\n            <div className={styles['chat-history-text']}>\n              {I18n.t('wf_chatflow_124')}\n            </div>\n            <Switch\n              size=\"mini\"\n              checked={value?.enableChatHistory}\n              data-testid={getNodeSetterId(context.meta.name)}\n              onChange={checked => {\n                if (value.enableChatHistory === checked) {\n                  return;\n                }\n\n                onChange?.({\n                  ...value,\n                  enableChatHistory: checked,\n                });\n              }}\n              disabled={readonly}\n            />\n          </div>\n        </Tooltip>\n      </FormCard.Action>\n      {value?.enableChatHistory ? (\n        <div className=\"relative\">\n          <OutputTree\n            id=\"chat-history\"\n            readonly\n            value={VALUE}\n            defaultCollapse\n            // eslint-disable-next-line @typescript-eslint/no-empty-function\n            onChange={() => {}}\n            withDescription={false}\n            withRequired={false}\n            noCard\n          />\n          <div className={styles.line} />\n\n          <ChatHistoryRound\n            value={value.chatHistoryRound}\n            readonly={readonly}\n            onChange={w => {\n              onChange({\n                ...value,\n                chatHistoryRound: Number(w),\n              });\n            }}\n          />\n        </div>\n      ) : null}\n    </>\n  );\n};\n\nexport const chatHistory = {\n  key: 'ChatHistory',\n  component: ChatHistory,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Suspense, lazy } from 'react';\n\nimport { type SetterExtension } from '@flowgram-adapter/free-layout-editor';\n\nimport { useInputVariables } from '@/hooks';\n\nconst CanvasLazy = lazy(async () => {\n  const { Canvas: CanvasNode } = await import('./components/canvas');\n  return {\n    default: CanvasNode,\n  };\n});\n\nconst Canvas = props => {\n  /**\n   * useInputVariables internally uses useContext\n   * lazyLoad will cause context changes that cannot be monitored\n   * Get the variables in advance\n   */\n  const variables = useInputVariables({\n    needNullType: true,\n    needNullName: true,\n  });\n\n  return (\n    <Suspense fallback={<div>canvas loading...</div>}>\n      <CanvasLazy {...props} variables={variables} />\n    </Suspense>\n  );\n};\n\n/**\n *  Imageflow's canvas editing node, implemented based on fabric\n */\nexport const canvas: SetterExtension = {\n  key: 'canvas',\n  component: Canvas,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { forwardRef } from 'react';\n\nimport classNames from 'classnames';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { IconCozMinus } from '@coze-arch/coze-design/icons';\nimport { IconButton } from '@coze-arch/coze-design';\nimport { type SetterOrDecoratorContext } from '@flowgram-adapter/free-layout-editor';\nimport { IconHandle } from '@douyinfe/semi-icons';\n\nimport { ExpressionEditorContainer } from '../expression-editor/container';\nimport { ValidationErrorWrapper } from '../../components/validation';\n\nimport styles from './index.module.less';\n\nexport interface OptionItemProps {\n  index?: number;\n  optionName: string;\n  content: string;\n  portId?: string;\n  canDrag?: boolean;\n  readonly?: boolean;\n  className?: string;\n  disableDelete?: boolean;\n  showOptionName?: boolean;\n  optionPlaceholder?: string;\n  optionEnableInterpolation?: boolean;\n  onChange?: (val: string) => void;\n  onDelete?: () => void;\n  setterContext: SetterOrDecoratorContext;\n}\n\nexport const OptionItem = forwardRef<HTMLDivElement, OptionItemProps>(\n  (props, dragRef) => {\n    const {\n      content,\n      canDrag,\n      portId,\n      readonly = false,\n      className,\n      index,\n      optionName,\n      disableDelete,\n      onChange,\n      onDelete,\n      setterContext,\n      showOptionName,\n      optionPlaceholder,\n      optionEnableInterpolation,\n    } = props;\n\n    const { getNodeSetterId, concatTestId } = useNodeTestId();\n\n    return (\n      <div\n        className={classNames('flex items-start space-x-1 text-xs', className)}\n      >\n        <div className=\"flex w-4 min-w-4 shrink-0 mt-[4px]\">\n          {canDrag ? (\n            <IconHandle\n              data-testid={concatTestId(\n                getNodeSetterId('answer-option-item-handle'),\n                portId || '',\n              )}\n              data-disable-node-drag=\"true\"\n              className={classNames({\n                'cursor-move': !readonly,\n                'pointer-events-none': readonly,\n              })}\n              ref={dragRef}\n              style={{ color: '#aaa' }}\n            />\n          ) : null}\n        </div>\n        {showOptionName ? (\n          <div className=\"break-keep min-w-[75px] mt-[5px]\">{optionName}</div>\n        ) : null}\n\n        <ValidationErrorWrapper path={`${index}`} className=\"w-full\">\n          {options => (\n            <div className=\"flex items-center space-x-1 w-full min-h-[24px]\">\n              {!readonly ? (\n                <ExpressionEditorContainer\n                  value={content}\n                  onChange={val => {\n                    onChange?.(val);\n                    options.onChange();\n                  }}\n                  onFocus={() => options.onFocus()}\n                  onBlur={() => options.onBlur()}\n                  isError={options.showError}\n                  context={setterContext}\n                  readonly={readonly}\n                  minRows={1}\n                  placeholder={optionPlaceholder}\n                  disableSuggestion={!optionEnableInterpolation}\n                  customClassName={classNames(\n                    '!rounded-[6px]',\n                    !optionEnableInterpolation\n                      ? styles['expression-editor-no-interpolation']\n                      : '',\n                  )}\n                />\n              ) : (\n                <div className=\"w-full\">{content}</div>\n              )}\n\n              <div>\n                {onDelete && !readonly ? (\n                  <IconButton\n                    size=\"small\"\n                    color=\"secondary\"\n                    data-testid={concatTestId(\n                      getNodeSetterId('answer-option-item-delete'),\n                      portId || '',\n                    )}\n                    className={classNames('flex', {\n                      'cursor-pointer': !disableDelete,\n                      'cursor-not-allowed': disableDelete,\n                      'text-[--semi-color-tertiary-active]': disableDelete,\n                    })}\n                    onClick={() => {\n                      if (disableDelete) {\n                        return;\n                      }\n                      onDelete();\n                    }}\n                    icon={<IconCozMinus className=\"text-sm\" />}\n                  />\n                ) : null}\n              </div>\n            </div>\n          )}\n        </ValidationErrorWrapper>\n      </div>\n    );\n  },\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport update from 'immutability-helper';\nimport classNames from 'classnames';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozPlus } from '@coze-arch/coze-design/icons';\nimport { IconButton, Tooltip } from '@coze-arch/coze-design';\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { withValidation } from '../../components/validation';\nimport { useUpdateSortedPortLines } from '../../../hooks/use-update-sorted-port-lines';\nimport { SortableList } from '../../../components/sortable-list';\nimport { convertNumberToLetters, calcPortId } from './utils';\nimport { OptionItem } from './option-item';\n\nexport interface AnswerOptionProps {\n  /** Whether to display the title line */\n  showTitleRow?: boolean;\n\n  /** Whether to display option labels */\n  showOptionName?: boolean;\n\n  /** Option placeholder */\n  optionPlaceholder?: string;\n\n  /** Default branch name */\n  defaultOptionText?: string;\n\n  /** Option whether to allow interpolation */\n  optionEnableInterpolation?: boolean;\n\n  /** Option maximum quantity limit, default value is integer maximum */\n  maxItems?: number;\n\n  /** New button style */\n  addButtonClassName?: string;\n\n  /** Display Forbid Add Tooltip */\n  showDisableAddTooltip?: boolean;\n  customDisabledAddTooltip?: string;\n}\n\nexport const AnswerOption = withValidation<\n  SetterComponentProps & AnswerOptionProps\n>(props => {\n  const { value, onChange, context, readonly, options } = props;\n  const {\n    showTitleRow = true,\n    showOptionName = true,\n    optionPlaceholder = '',\n    defaultOptionText,\n    optionEnableInterpolation,\n    maxItems = Number.MAX_SAFE_INTEGER,\n    addButtonClassName = '',\n    showDisableAddTooltip = true,\n    customDisabledAddTooltip,\n  } = options;\n\n  const { getNodeSetterId } = useNodeTestId();\n\n  const handleChange = val => {\n    onChange(val);\n  };\n\n  const updateSortedPortLines = useUpdateSortedPortLines(calcPortId);\n\n  const onItemDelete = (index: number) => {\n    // Move the port to be deleted to the end so that the deletion does not affect other connection sequences\n    updateSortedPortLines(index, value.length);\n\n    const newVal = update(value, { $splice: [[index, 1]] });\n    handleChange(newVal);\n  };\n\n  const onItemChange = (val: string, index: number) => {\n    const newVal = update(value, {\n      [index]: {\n        name: { $set: val },\n      },\n    });\n\n    handleChange(newVal);\n  };\n\n  const AddActionButton = (\n    <IconButton\n      className={classNames('absolute right-3 top-3', {\n        [addButtonClassName]: addButtonClassName,\n      })}\n      color=\"highlight\"\n      size=\"small\"\n      disabled={readonly || value.length >= maxItems}\n      data-testid={getNodeSetterId('answer-option-add-btn')}\n      // Solve the problem that onClick does not trigger due to Button displacement\n      onMouseDown={() => {\n        handleChange([...value, { name: '' }]);\n      }}\n      icon={<IconCozPlus className=\"text-sm\" />}\n    />\n  );\n\n  return (\n    <div\n      className={classNames({\n        [options?.customClassName]: options?.customClassName,\n      })}\n    >\n      {showTitleRow ? (\n        <div className=\"flex items-center text-xs text-[#1D1C23] opacity-60 h-7\">\n          <div className={'ml-1 w-[71px]'}>\n            {I18n.t('workflow_ques_ans_type_option_title', {}, 'options')}\n          </div>\n          <div className={'ml-6'}>\n            {I18n.t('workflow_ques_ans_type_option_content', {}, 'content')}\n          </div>\n        </div>\n      ) : null}\n\n      <SortableList\n        value={value}\n        onChange={handleChange}\n        onDragEnd={updateSortedPortLines}\n        renderItem={(item, index, dragOption) => {\n          const { dragRef, isPreview } = dragOption || {};\n\n          return (\n            <OptionItem\n              ref={dragRef}\n              index={index}\n              content={item.name}\n              onChange={val => onItemChange(val, index)}\n              portId={isPreview ? undefined : calcPortId(index)}\n              optionName={convertNumberToLetters(index)}\n              onDelete={!isPreview ? () => onItemDelete(index) : undefined}\n              disableDelete={value.length <= 1}\n              canDrag\n              readonly={readonly}\n              setterContext={context}\n              showOptionName={showOptionName}\n              optionPlaceholder={optionPlaceholder}\n              optionEnableInterpolation={optionEnableInterpolation}\n            />\n          );\n        }}\n      />\n      <OptionItem\n        className=\"mt-2\"\n        content={defaultOptionText}\n        optionName={I18n.t('workflow_ques_ans_type_option_other', {}, 'other')}\n        portId=\"default\"\n        readonly\n        setterContext={context}\n        showOptionName={showOptionName}\n        optionPlaceholder={optionPlaceholder}\n      />\n\n      <div className=\"mt-2 answer-option-add-button\">\n        {showDisableAddTooltip && value.length >= maxItems ? (\n          <Tooltip\n            content={\n              customDisabledAddTooltip ||\n              I18n.t('workflow_250117_05', { maxCount: maxItems })\n            }\n          >\n            <div className=\"absolute right-3 top-3 background w-[24px] h-[24px] coz-mg-hglt coz-fg-hglt-dim p-[5px] rounded-[5px] flex items-center cursor-not-allowed\">\n              <IconCozPlus className=\"text-sm\" />\n            </div>\n          </Tooltip>\n        ) : (\n          AddActionButton\n        )}\n      </div>\n    </div>\n  );\n});\n\nexport const answerOption = {\n  key: 'answer-option',\n  component: AnswerOption,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type SetterExtension } from '@flowgram-adapter/free-layout-editor';\nimport {\n  Boolean,\n  Enum,\n  EnumImageModel,\n  Number,\n  String,\n} from '@coze-workflow/setters';\nimport { SizeSelect } from '@coze-workflow/components';\n\nimport { viewVariableSelect } from './view-variable-select';\nimport { variableSelect } from './variable-select';\nimport { valueExpressionInput } from './value-expression-input';\nimport { triggerParameterTitle } from './trigger-parameter-title';\nimport { triggerList } from './trigger-list';\nimport { triggerBindWorkflow } from './trigger-bind-workflow';\nimport { toStandardSetter } from './to-standard-setter';\nimport { timezone } from './timezone';\nimport { textDisplay } from './text-display';\nimport { textArea } from './text-area';\nimport { temperature } from './temperature';\nimport { systemPrompt } from './system-prompt';\nimport { switchSetter } from './switch';\nimport { sql } from './sql';\nimport { speakerMessageSetArray } from './speaker-message-set-array';\nimport { slider } from './slider';\nimport { settingOnErrorSetter } from './setting-on-error';\nimport { select } from './select';\nimport { radio } from './radio';\nimport { questionLimit } from './question-limit';\nimport { output } from './output-tree';\nimport { outputLabelTextSetter } from './output-label-text';\nimport { number } from './number';\nimport { notify } from './notify';\nimport { nodeOutputName } from './node-output-name';\nimport { nodeInputName } from './node-input-name';\nimport { nodeHeaderSetter } from './node-header';\nimport { MutableVariableAssign } from './mutable-variable-assign';\nimport { modelSelect } from './model-select';\nimport { messageVisibility } from './message-visibility';\nimport { LoopOutputSelect } from './loop-output-select';\nimport { localInputSelect } from './local-input-select';\nimport { jsonEditor } from './json-editor';\nimport { inputTree } from './input-tree';\nimport { input } from './input';\nimport { ImagePreview } from './image-preview';\nimport { form } from './form';\nimport { fileUpload } from './file-upload';\nimport { expressionEditor } from './expression-editor';\nimport { delimiterSelectorSetter } from './delimiter-selector';\nimport { DatasetWriteParseSetter } from './dataset-write-parser';\nimport { DatasetWriteIndexSetter } from './dataset-write-index';\nimport { DatasetWriteChunkSetter } from './dataset-write-chunk';\nimport { DatasetSettingSetter } from './dataset-setting';\nimport { DatasetSelectSetter } from './dataset-select';\nimport { DatabaseSelect } from './database-select';\nimport { customPort } from './custom-port';\nimport { cronJobSelect } from './cronjob-select';\nimport { condition } from './condition';\nimport { code } from './code';\nimport { checkbox } from './checkbox';\nimport { chatHistory } from './chat-history';\nimport { canvas } from './canvas';\nimport { answerOption } from './answer-option';\n\nexport const setters: SetterExtension[] = [\n  triggerBindWorkflow,\n  triggerList,\n  triggerParameterTitle,\n  jsonEditor,\n  fileUpload,\n  timezone,\n  cronJobSelect,\n  input,\n  condition,\n  form,\n  nodeHeaderSetter,\n  select,\n  switchSetter,\n  textArea,\n  expressionEditor,\n  temperature,\n  radio,\n  number,\n  notify,\n  code,\n  output,\n  inputTree,\n  modelSelect,\n  variableSelect,\n  viewVariableSelect,\n  LoopOutputSelect,\n  MutableVariableAssign,\n  DatasetSelectSetter,\n  DatasetWriteIndexSetter,\n  DatasetSettingSetter,\n  valueExpressionInput,\n  nodeInputName,\n  nodeOutputName,\n  outputLabelTextSetter,\n  sql,\n  customPort,\n  chatHistory,\n  systemPrompt,\n  delimiterSelectorSetter,\n  slider,\n  canvas,\n  { key: 'string', component: toStandardSetter(String) },\n  { key: 'boolean', component: toStandardSetter(Boolean) },\n  { key: 'enum', component: toStandardSetter(Enum) },\n  { key: 'database-select', component: toStandardSetter(DatabaseSelect) },\n  {\n    key: 'enum-image-model',\n    component: toStandardSetter(EnumImageModel),\n  },\n  { key: 'number', component: toStandardSetter(Number) },\n  { ...expressionEditor, key: 'text' },\n  { ...output, key: 'parameters' },\n  { ...valueExpressionInput, key: 'expression' },\n  { ...radio, key: 'radio' },\n  checkbox,\n  questionLimit,\n  answerOption,\n  {\n    key: 'image-preview',\n    component: ImagePreview,\n  },\n  messageVisibility,\n  textDisplay,\n  localInputSelect,\n  speakerMessageSetArray,\n  { key: 'size-select', component: toStandardSetter(SizeSelect) },\n  DatasetWriteParseSetter,\n  DatasetWriteChunkSetter,\n  settingOnErrorSetter,\n];\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { JsonEditorAdapter } from '@/components/test-run/test-form-materials/json-editor';\n\ntype SwitchProps = SetterComponentProps;\n\nconst JSONEditorSetter = ({\n  value,\n  onChange,\n  options,\n  readonly,\n}: SwitchProps) => {\n  const { defaultValue } = options;\n\n  return (\n    <JsonEditorAdapter\n      // className={styles['json-editor']}\n      value={value ?? ''}\n      options={{\n        quickSuggestions: false,\n        suggestOnTriggerCharacters: false,\n      }}\n      onChange={onChange}\n      disabled={readonly}\n      height={264}\n      defaultValue={defaultValue}\n    />\n  );\n};\n\nexport const jsonEditor = {\n  key: 'JSONEditor',\n  component: JSONEditorSetter,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport {\n  type SetterComponentProps,\n  type SetterExtension,\n} from '@flowgram-adapter/free-layout-editor';\nimport { cronJobTranslator } from '@coze-workflow/components';\nimport { CronJobType, type CronJobValue } from '@coze-workflow/nodes';\nimport { ValueExpressionType, ValueExpression } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { Select } from '@coze-arch/coze-design';\n\nimport { Text } from '@/form-extensions/components/text';\n\nimport { FixCronjobSelect } from './fix-cronjob';\nimport { AICronjobSelect } from './ai-cronjob';\n\ntype CronJobSelectProps = SetterComponentProps<\n  CronJobValue,\n  { needRefInput?: boolean }\n>;\n\nconst CronJobSelect = (props: CronJobSelectProps) => {\n  const {\n    value = {\n      type: CronJobType.Selecting,\n      content: {\n        type: ValueExpressionType.LITERAL,\n        content: '',\n      },\n    },\n    onChange: _onChange,\n    options,\n    readonly,\n    context,\n    feedbackStatus,\n  } = props;\n\n  const hasError = feedbackStatus === 'error';\n  const { needRefInput } = options;\n\n  const type = value.type ?? CronJobType.Selecting;\n  const onChange = (content: ValueExpression | undefined) => {\n    _onChange({\n      type,\n      content: content ?? {\n        type: ValueExpressionType.LITERAL,\n      },\n    });\n  };\n\n  const cronjobTranslateText = useMemo(() => {\n    if (\n      hasError ||\n      type === CronJobType.Selecting ||\n      (value.content && ValueExpression.isRef(value.content))\n    ) {\n      return '';\n    }\n\n    return cronJobTranslator(value.content?.content as unknown as string);\n  }, [hasError, value.content, type]);\n\n  return (\n    <div>\n      <div className=\"flex flex-row gap-[2px]\">\n        <Select\n          size=\"small\"\n          value={type}\n          className=\"w-fit mb-[4px]\"\n          disabled={readonly}\n          onChange={v => {\n            _onChange({\n              type: v as CronJobType,\n              content: {\n                type: ValueExpressionType.LITERAL,\n              },\n            });\n          }}\n          optionList={[\n            {\n              label: I18n.t(\n                'workflow_start_trigger_cron_option',\n                {},\n                '',\n              ),\n              value: CronJobType.Selecting,\n            },\n            {\n              label: I18n.t(\n                'workflow_start_trigger_cron_job',\n                {},\n                'Cron',\n              ),\n              value: CronJobType.Cronjob,\n            },\n          ]}\n        ></Select>\n\n        <div className=\"flex-1 overflow-hidden\">\n          {type === CronJobType.Selecting ? (\n            <FixCronjobSelect\n              hasError={hasError}\n              value={value.content}\n              onChange={onChange}\n              readonly={readonly}\n            />\n          ) : (\n            <AICronjobSelect\n              hasError={hasError}\n              value={value.content}\n              onChange={onChange}\n              readonly={readonly}\n              node={context.node}\n              needRefInput={needRefInput}\n            />\n          )}\n        </div>\n      </div>\n      {cronjobTranslateText ? (\n        <div className=\"coz-mg-primary w-full h-[24px] flex flex-row items-center justify-center rounded-[4px]\">\n          <Text text={cronjobTranslateText} className=\"text-[12px]\" />\n        </div>\n      ) : null}\n    </div>\n  );\n};\n\nexport const cronJobSelect: SetterExtension = {\n  key: 'CronJobSelect',\n  component: CronJobSelect,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { Input as UIInput } from '@coze-arch/coze-design';\n\nfunction Input({\n  value,\n  onChange,\n  options,\n}: SetterComponentProps): JSX.Element {\n  const { style } = options;\n  const { getNodeSetterId } = useNodeTestId();\n  const onValueChange = React.useCallback(\n    (innerValue: string) => {\n      onChange(innerValue);\n    },\n    [value, onChange],\n  );\n  return (\n    <div style={style}>\n      <UIInput\n        value={value}\n        onChange={onValueChange}\n        data-testid={getNodeSetterId('input')}\n      />\n    </div>\n  );\n}\n\nexport const input = {\n  key: 'Input',\n  component: Input,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { validateAllBranchesFromOutside } from './multi-condition/validate/validate';\nimport { Condition } from './multi-condition';\n\nexport const condition = {\n  key: 'Condition',\n  component: Condition,\n  validator: ({ value, context }) =>\n    validateAllBranchesFromOutside(value, context),\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nexport function Form({ children }: SetterComponentProps): JSX.Element {\n  return <div>{children}</div>;\n}\n\nexport const form = {\n  key: 'Form',\n  component: Form,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { InputNumber as InputNumberUI } from '@coze-arch/coze-design';\n\ntype InputNumberProps = SetterComponentProps;\nexport const InputNumber: FC<InputNumberProps> = props => {\n  const { value, onChange, options, readonly } = props;\n\n  const { key, style, ...others } = options;\n\n  const { getNodeSetterId } = useNodeTestId();\n\n  return (\n    <InputNumberUI\n      {...others}\n      value={value}\n      onChange={onChange}\n      style={{\n        ...style,\n        pointerEvents: readonly ? 'none' : 'auto',\n      }}\n      data-testid={getNodeSetterId('number-input')}\n    />\n  );\n};\n\nexport const number = {\n  key: 'Number',\n  component: InputNumber,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { ConfigProvider } from '@coze-arch/coze-design';\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { CodeSetterContext } from './context';\n// import { CodeEditorWithMonaco } from './code-with-monaco';\nimport { CodeEditorWithBizIDE } from './code-with-biz-ide';\n\nexport const CodeSetter: FC<SetterComponentProps> = props => {\n  const {\n    value,\n    onChange,\n    options,\n    readonly,\n    feedbackText,\n    feedbackStatus,\n    ...othersSetterProps\n  } = props;\n\n  const { key, ...others } = options;\n\n  // if (others.enableBizIDE) {\n  return (\n    <ConfigProvider getPopupContainer={() => document.body}>\n      <CodeSetterContext.Provider\n        value={{\n          ...othersSetterProps,\n          readonly,\n        }}\n      >\n        <CodeEditorWithBizIDE\n          {...others}\n          value={value}\n          onChange={onChange}\n          feedbackText={feedbackText}\n          feedbackStatus={feedbackStatus}\n        />\n      </CodeSetterContext.Provider>\n    </ConfigProvider>\n  );\n  // } else {\n  //   return (\n  //     <CodeEditorWithMonaco\n  //       {...others}\n  //       value={value}\n  //       onChange={onChange}\n  //       readonly={readonly}\n  //     />\n  //   );\n  // }\n};\n\nexport const code = {\n  key: 'Code',\n  component: CodeSetter,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type SetterComponentProps,\n  type ValidatorProps,\n} from '@flowgram-adapter/free-layout-editor';\nimport { useNodeTestId, type RefExpression } from '@coze-workflow/base';\n\nimport { LoopOutputSelect as LoopOutputSelectComponent } from '@/form-extensions/components/loop-output-select';\n\nimport { valueExpressionValidator } from '../../validators';\n\ntype LoopOutputSelectSetterProps = SetterComponentProps<RefExpression>;\n\nexport function LoopOutputSelectSetter(\n  props: LoopOutputSelectSetterProps,\n): JSX.Element {\n  const { value, onChange, readonly, context } = props;\n\n  const { getNodeSetterId } = useNodeTestId();\n  const testId = getNodeSetterId(context?.path);\n\n  return (\n    <LoopOutputSelectComponent\n      value={value}\n      onChange={onChange}\n      readonly={readonly}\n      testId={testId}\n    />\n  );\n}\n\nexport const LoopOutputSelect = {\n  key: 'LoopOutputSelect',\n  component: LoopOutputSelectSetter,\n  validator: ({ value, context }: ValidatorProps) => {\n    const { meta, playgroundContext, node } = context;\n    const { required } = meta;\n    return valueExpressionValidator({\n      value,\n      playgroundContext,\n      node,\n      required,\n    });\n  },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type SetterComponentProps,\n  type ValidatorProps,\n} from '@flowgram-adapter/free-layout-editor';\nimport { type RefExpression, useNodeTestId } from '@coze-workflow/base';\n\nimport { MutableVariableAssign as MutableVariableAssignComponent } from '@/form-extensions/components/mutable-variable-assign';\n\nimport { valueExpressionValidator } from '../../validators';\n\ntype MutableVariableAssignSetterProps = SetterComponentProps<RefExpression>;\n\nfunction MutableVariableAssignSetter(\n  props: MutableVariableAssignSetterProps,\n): JSX.Element {\n  const { value, onChange, readonly, options, context } = props;\n  const { right, inputParameters, index } = options;\n\n  const { getNodeSetterId } = useNodeTestId();\n  const testId = getNodeSetterId(context.path);\n\n  return (\n    <MutableVariableAssignComponent\n      value={value}\n      onChange={onChange}\n      readonly={readonly}\n      node={context.node}\n      right={right}\n      inputParameters={inputParameters}\n      index={index}\n      testId={testId}\n    />\n  );\n}\n\nexport const MutableVariableAssign = {\n  key: 'MutableVariableAssign',\n  component: MutableVariableAssignSetter,\n  validator: ({ value, context }: ValidatorProps) => {\n    const { meta, playgroundContext, node } = context;\n    const { required } = meta;\n    return valueExpressionValidator({\n      value,\n      playgroundContext,\n      node,\n      required,\n    });\n  },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { DatasetSelect as BaseDatasetSelect } from '../../components/dataset-select';\n\nconst DatasetSelect = (props: SetterComponentProps<string[]>) => (\n  <BaseDatasetSelect {...props} />\n);\n\nexport const DatasetSelectSetter = {\n  key: 'DatasetSelect',\n  component: DatasetSelect,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, type FC } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Select } from '@coze-arch/coze-design';\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { useVectorModelList } from '@/form-extensions/hooks';\nimport { CheckboxWithLabel } from '@/form-extensions/components/checkbox-with-label';\n\nimport styles from './index.module.less';\n\ninterface DatasetWriteIndexValue {\n  vectorModel: {\n    name: string;\n  };\n  vectorIndexing: boolean;\n  keywordIndexing: boolean;\n  hierarchicalIndexing: boolean;\n}\nexport type DatasetWriteIndexProps =\n  SetterComponentProps<DatasetWriteIndexValue>;\n\nexport const DatasetWriteIndex: FC<DatasetWriteIndexProps> = ({\n  value,\n  onChange,\n  readonly,\n}) => {\n  const { vectorModellList } = useVectorModelList();\n  const vectorModelOptions = vectorModellList?.map(item => ({\n    label: item.name,\n    value: item.name,\n  }));\n\n  useEffect(() => {\n    if (vectorModellList?.length > 0) {\n      const defaultModelName = vectorModellList[0].name;\n      if (defaultModelName && value?.vectorModel?.name !== defaultModelName) {\n        onChange({\n          ...value,\n          vectorModel: {\n            name: defaultModelName,\n          },\n        });\n      }\n    }\n  }, [value, onChange, vectorModellList]);\n\n  return (\n    <div className=\"mt-[4px]\">\n      <CheckboxWithLabel\n        label={I18n.t('kl_write_017')}\n        description={I18n.t('kl_write_018')}\n        checked={value?.vectorIndexing}\n        onChange={v =>\n          onChange?.({\n            ...value,\n            vectorIndexing: v as boolean,\n          })\n        }\n        readonly={readonly}\n        disabled\n      >\n        <CheckboxWithLabel\n          needCheckBox={false}\n          label={I18n.t('kl_write_019')}\n          style={{ paddingLeft: '22px' }}\n        >\n          <Select\n            size=\"small\"\n            className={styles['model-select']}\n            optionList={vectorModelOptions}\n            style={{ width: '426px', height: '24px', borderColor: '#06070926' }}\n            value={value?.vectorModel?.name}\n            onChange={v =>\n              onChange({\n                ...value,\n                vectorModel: {\n                  name: v as string,\n                },\n              })\n            }\n            // The first phase only supports the default model.\n            disabled={readonly || true}\n          />\n        </CheckboxWithLabel>\n      </CheckboxWithLabel>\n      <CheckboxWithLabel\n        label={I18n.t('kl_write_020')}\n        description={I18n.t('kl_write_021')}\n        checked={value?.keywordIndexing}\n        onChange={v =>\n          onChange?.({\n            ...value,\n            keywordIndexing: v as boolean,\n          })\n        }\n        disabled\n      />\n      {/* phase one ban */}\n      {/* {DatasetWriteFLAG ? (\n        <CheckboxWithLabel\n          Label = \"Hierarchical Index\"\n          Description = \"Suitable for long documents and complex multi-step reasoning tasks.\"\n          checked={value?.hierarchicalIndexing}\n          onChange={v =>\n            onChange?.({\n              ...value,\n              hierarchicalIndexing: v as boolean,\n            })\n          }\n          disabled={readonly}\n        />\n      ) : null} */}\n    </div>\n  );\n};\nexport const DatasetWriteIndexSetter = {\n  key: 'DatasetWriteIndex',\n  component: DatasetWriteIndex,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { useWorkflowNode } from '@coze-workflow/base';\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { useDataSetInfos } from '@/hooks';\n\nimport { type DataSetInfo } from '../../components/dataset-setting/type';\nimport { DataSetSetting as BaseDataSetSetting } from '../../components/dataset-setting';\n\nconst DatasetSetting = ({\n  value,\n  onChange,\n  options,\n  readonly: workflowReadonly,\n}: SetterComponentProps<DataSetInfo>) => {\n  const { readonly = false, disabled = false, style = {}, ...props } = options;\n\n  const { data } = useWorkflowNode();\n  const selectDataSet = data.inputs?.datasetParameters?.datasetParam ?? [];\n\n  const { dataSets, isReady } = useDataSetInfos({ ids: selectDataSet });\n\n  return (\n    <BaseDataSetSetting\n      {...props}\n      readonly={readonly || workflowReadonly}\n      disabled={disabled}\n      style={style}\n      onDataSetInfoChange={onChange}\n      dataSets={dataSets}\n      dataSetInfo={value}\n      isReady={isReady}\n    />\n  );\n};\n\nexport const DatasetSettingSetter = {\n  key: 'DatasetSetting',\n  component: DatasetSetting,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  type ValidatorProps,\n  type FormItemMaterialContext,\n  type SetterExtension,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { nameValidationRule } from '../helper';\nimport { defaultGetNames } from './utils';\nimport { NodeInputName } from './node-input-name';\n\ntype NodeInputNameValidatorProps = ValidatorProps<\n  string,\n  {\n    validatorConfig?: {\n      rule?: RegExp;\n      errorMessage?: string;\n    };\n    getNames?: (context: FormItemMaterialContext) => string[];\n    invalidValues?: Record<string, string>;\n  }\n>;\n\nexport const nodeInputName: SetterExtension = {\n  key: 'NodeInputName',\n  component: NodeInputName,\n  validator: (props: NodeInputNameValidatorProps) => {\n    const { value, options, context } = props;\n    const {\n      validatorConfig,\n      getNames = defaultGetNames,\n      invalidValues = {},\n    } = options;\n    const validatorRule = validatorConfig?.rule ?? nameValidationRule;\n    const validatorErrorMessage =\n      validatorConfig?.errorMessage ??\n      I18n.t('workflow_detail_node_error_format');\n\n    /** name check */\n    if (!validatorRule.test(value)) {\n      return validatorErrorMessage;\n    }\n\n    /** Illegal value verification */\n    if (invalidValues[value]) {\n      return invalidValues[value];\n    }\n\n    const names: string[] = getNames(context);\n\n    const foundSames = names.filter((name: string) => name === value);\n\n    return foundSames.length > 1\n      ? I18n.t('workflow_detail_node_input_duplicated')\n      : undefined;\n  },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable complexity */\nimport React, { useMemo, useCallback, useEffect, useState } from 'react';\n\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowVariableFacadeService } from '@coze-workflow/variable';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozInfoCircle } from '@coze-arch/coze-design/icons';\nimport { Tooltip, Typography, Input } from '@coze-arch/coze-design';\n\nimport { useNodeRenderScene } from '@/hooks/use-node-render-scene';\n\nimport { feedbackStatus2ValidateStatus } from '../../components/utils';\nimport { getUniqueName, getVariableName } from './utils';\nimport type { NodeInputNameProps } from './type';\n\nexport const NodeInputName = ({\n  options,\n  feedbackStatus,\n  value,\n  onChange,\n  readonly,\n  context,\n}: NodeInputNameProps) => {\n  const {\n    style,\n    input,\n    inputParameters,\n    initValidate = false,\n    isPureText = false,\n    prefix = '',\n    suffix = '',\n    format,\n    tooltip,\n    disabled,\n  } = options;\n  const [initialized, setInitialized] = useState<boolean>(false);\n  const [userEdited, setUserEdited] = useState<boolean>(false);\n  const [variableName, setVariableName] = useState<string | undefined>(value);\n  const [text, setText] = useState<string | undefined>(value);\n\n  const { getNodeSetterId } = useNodeTestId();\n  const { isNewNodeRender } = useNodeRenderScene();\n  const variableService = useService(WorkflowVariableFacadeService);\n\n  // The text state is controlled (the value of the linked text when deleting a node)\n  useEffect(() => {\n    if (value !== text) {\n      setText(value);\n    }\n  }, [value]);\n\n  const computedVariableName = getVariableName({\n    input,\n    prefix,\n    suffix,\n    format,\n    node: context.node,\n    variableService,\n  });\n\n  const onInputChange = useCallback(\n    (newInputValue: string): void => {\n      setUserEdited(true);\n      setText(newInputValue || '');\n      setVariableName(undefined);\n    },\n    [onChange],\n  );\n\n  const onBlur = () => {\n    onChange(text);\n  };\n\n  const validateStatus = useMemo(\n    () => feedbackStatus2ValidateStatus(feedbackStatus),\n    [feedbackStatus],\n  );\n\n  useEffect(() => {\n    if (initValidate) {\n      // Initialize write value to trigger verification\n      onChange(value);\n    }\n    if (value) {\n      setUserEdited(true);\n    }\n    setInitialized(true);\n  }, []);\n\n  if (initialized && !readonly && !userEdited && !isNewNodeRender) {\n    if (computedVariableName && computedVariableName !== variableName) {\n      const computedUniqueName = getUniqueName({\n        variableName: computedVariableName,\n        inputParameters,\n      });\n      onChange(computedUniqueName);\n      setVariableName(computedVariableName);\n      setText(computedUniqueName);\n    } else if (!computedVariableName && variableName) {\n      setVariableName(undefined);\n      setText(undefined);\n    }\n  }\n\n  return (\n    <div\n      className=\"flex items-center\"\n      style={{\n        ...style,\n        pointerEvents: readonly ? 'none' : 'auto',\n      }}\n    >\n      {isPureText ? (\n        <>\n          <Typography.Text className=\"leading-8 text-xs\">\n            {value}\n          </Typography.Text>\n          {tooltip ? (\n            <Tooltip content={tooltip}>\n              <IconCozInfoCircle\n                className=\"ml-1\"\n                style={{\n                  fontSize: 12,\n                }}\n              />\n            </Tooltip>\n          ) : null}\n        </>\n      ) : (\n        <>\n          <Input\n            data-testid={getNodeSetterId(context.path)}\n            value={text}\n            onChange={onInputChange}\n            onBlur={onBlur}\n            validateStatus={validateStatus}\n            placeholder={I18n.t('workflow_detail_node_input_entername')}\n            size=\"small\"\n            disabled={disabled}\n          />\n          {tooltip ? (\n            <Tooltip content={tooltip}>\n              <IconCozInfoCircle\n                className=\"ml-1\"\n                style={{\n                  fontSize: 12,\n                }}\n              />\n            </Tooltip>\n          ) : null}\n        </>\n      )}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { type SetterExtension } from '@flowgram-adapter/free-layout-editor';\n\nimport { nameValidationRule } from '../helper';\nimport { NodeOutputName } from './node-output-name';\ninterface PartialOutputParameter {\n  name: string | undefined;\n}\n\nexport const nodeOutputName: SetterExtension = {\n  key: 'NodeOutputName',\n  component: NodeOutputName,\n  validator: ({ value, context }) => {\n    const { node } = context;\n\n    /** name check */\n    if (!nameValidationRule.test(value)) {\n      return I18n.t('workflow_detail_node_error_format');\n    }\n\n    const outputsPath = node.getNodeMeta()?.outputsPath;\n\n    if (!outputsPath) {\n      return;\n    }\n\n    const nodeInputParameters =\n      context.getFormItemValueByPath<PartialOutputParameter[]>(outputsPath) ||\n      [];\n\n    const foundSame = nodeInputParameters.filter(\n      (input: PartialOutputParameter) => input.name === value,\n    );\n\n    return foundSame?.length > 1\n      ? I18n.t('workflow_detail_node_error_name_duplicated', {\n          name: value,\n        })\n      : undefined;\n  },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useMemo } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Input } from '@coze-arch/coze-design';\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { feedbackStatus2ValidateStatus } from '../../components/utils';\n\nimport styles from './index.module.less';\n\ntype NodeOutputNameProps = SetterComponentProps & { readonly?: boolean };\n\nconst MaxCount = 20;\n\nexport const NodeOutputName = ({\n  options,\n  feedbackStatus,\n  value,\n  onChange,\n  readonly,\n}: NodeOutputNameProps) => {\n  const { style = {} } = options;\n\n  const onValueChange = React.useCallback(\n    (v: string): void => {\n      onChange(v);\n    },\n    [onChange],\n  );\n\n  const validateStatus = useMemo(\n    () => feedbackStatus2ValidateStatus(feedbackStatus),\n    [feedbackStatus],\n  );\n\n  const LimitCountNode = useMemo(\n    () => (\n      <span className={styles['limit-count']}>\n        {value?.length || 0}/{MaxCount}\n      </span>\n    ),\n    [value],\n  );\n\n  return (\n    <div style={{ ...style, pointerEvents: readonly ? 'none' : 'auto' }}>\n      <Input\n        value={value}\n        onChange={onValueChange}\n        maxLength={MaxCount}\n        validateStatus={validateStatus}\n        placeholder={I18n.t('workflow_detail_node_input_entername')}\n        suffix={LimitCountNode}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { OutputsParamDisplay } from '../../components/output-param-display';\n\ntype IOutputSingleTextProps = SetterComponentProps;\n\nconst OutputLabelText = (props: IOutputSingleTextProps) => (\n  <OutputsParamDisplay {...props} />\n);\n\nexport const outputLabelTextSetter = {\n  key: 'OutputLabelText',\n  component: OutputLabelText,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type CSSProperties } from 'react';\n\nimport { useNodeTestId } from '@coze-workflow/base';\nimport type {\n  SetterComponentProps,\n  SetterExtension,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { CustomPort } from '../../../components/custom-port';\n\ntype CustomPortProps = SetterComponentProps<{\n  portId: string;\n  portType: 'input' | 'output';\n  className?: string;\n  style: CSSProperties;\n  collapsedClassName?: string;\n  collapsedStyle?: CSSProperties;\n}>;\n\nexport const CustomPortSetter = ({ options }: CustomPortProps) => {\n  const {\n    portID,\n    portType,\n    className,\n    style,\n    collapsedClassName,\n    collapsedStyle,\n  } = options;\n\n  const { getNodeSetterId, concatTestId } = useNodeTestId();\n  const setterTestId = getNodeSetterId('custom-port');\n  const testId = concatTestId(setterTestId, portID);\n\n  return (\n    <CustomPort\n      portId={portID}\n      portType={portType}\n      className={className}\n      style={style}\n      collapsedClassName={collapsedClassName}\n      collapsedStyle={collapsedStyle}\n      testId={testId}\n    />\n  );\n};\n\nexport const customPort: SetterExtension = {\n  key: 'CustomPort',\n  component: CustomPortSetter,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { Checkbox as BaseCheckbox } from '../../components/checkbox';\n\nexport type CheckboxProps = SetterComponentProps<\n  boolean,\n  { text: string; itemTooltip?: string }\n>;\n\nexport const Checkbox: FC<CheckboxProps> = props => <BaseCheckbox {...props} />;\n\nexport const checkbox = {\n  key: 'checkbox',\n  component: Checkbox,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ImgLog } from '../../../components/test-run/img-log';\nimport { useImagePreviewVisible } from './hooks/use-image-preview-visible';\n\nexport function ImagePreview() {\n  const imagePreviewVisible = useImagePreviewVisible();\n\n  if (imagePreviewVisible) {\n    return <ImgLog />;\n  }\n\n  return null;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { LocalInputSelect } from './local-input-select';\n\nexport const localInputSelect = {\n  key: 'LocalInputSelect',\n  component: LocalInputSelect,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport classnames from 'classnames';\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\nimport { IconTick } from '@douyinfe/semi-icons';\nimport { type ViewVariableType } from '@coze-workflow/variable';\nimport { VARIABLE_TYPE_ALIAS_MAP } from '@coze-workflow/base/types';\nimport { I18n } from '@coze-arch/i18n';\nimport { type SelectProps } from '@coze-arch/bot-semi/Select';\nimport { Select, Space, Dropdown } from '@coze-arch/coze-design';\n\nimport { useGetCurrentInputsParameters } from '../../hooks/use-get-current-input-parameters';\nimport { VariableTypeTag } from '../../components/variable-type-tag';\n\nimport styles from './local-input-select.module.less';\n\nexport const LocalInputSelect: FC<\n  SetterComponentProps<\n    string,\n    {\n      disabledTypes?: ViewVariableType[];\n      allowedTypes?: ViewVariableType[];\n    }\n  >\n> = props => {\n  const { value, onChange, options } = props;\n  const { disabledTypes, allowedTypes } = options;\n\n  const inputsParameters = useGetCurrentInputsParameters();\n\n  const renderOptionItem = renderOption => {\n    const { selected } = renderOption;\n    return (\n      <Dropdown.Item\n        onClick={renderOption.onClick}\n        className={classnames({\n          ['font-semibold']: selected,\n        })}\n      >\n        <Space>\n          <IconTick\n            className={classnames({\n              ['text-[var(--semi-color-text-2)]']: selected,\n              ['text-transparent\t']: !selected,\n            })}\n          />\n          {renderOption.label}{' '}\n          <VariableTypeTag>\n            {VARIABLE_TYPE_ALIAS_MAP[renderOption.type]}\n          </VariableTypeTag>\n        </Space>\n      </Dropdown.Item>\n    );\n  };\n\n  return (\n    <Select\n      className=\"w-full\"\n      dropdownMatchSelectWidth\n      placeholder={I18n.t(\n        'scene_workflow_chat_node_conversation_content_speaker_placeholder',\n        {},\n        'Please choose player',\n      )}\n      optionList={inputsParameters\n        .filter(item => {\n          if (allowedTypes?.length) {\n            return allowedTypes.includes(item.type);\n          }\n\n          if (!disabledTypes?.length) {\n            return true;\n          }\n          if (disabledTypes?.includes(item.type)) {\n            return false;\n          } else {\n            return true;\n          }\n        })\n        .map(item => ({\n          label: item.name,\n          value: item.name,\n          type: item.type,\n        }))}\n      value={value}\n      onChange={onChange as SelectProps['onChange']}\n      onBlur={e => {\n        onChange?.(value);\n      }}\n      renderOptionItem={renderOptionItem}\n      dropdownClassName={styles['local-input-select-dropdown']}\n      emptyContent={I18n.t('workflow_detail_node_nodata')}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type FC } from 'react';\n\nimport type { OptionItem, RadioType } from '@coze-arch/bot-semi/Radio';\nimport type {\n  SetterComponentProps,\n  SetterOrDecoratorContext,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { DatasetWriteParser as BaseDatasetWriteParser } from '@/form-extensions/components/dataset-write-parser';\n\ntype RadioItem = OptionItem & {\n  disabled?: boolean | ((context: SetterOrDecoratorContext) => boolean);\n};\n\nenum ParseStratgy {\n  Fast = 'fast',\n  Accurate = 'accurate',\n}\ntype RadioProps = SetterComponentProps<\n  {\n    parsingType?: ParseStratgy;\n    imageExtraction?: boolean;\n    tableExtraction?: boolean;\n    imageOcr?: boolean;\n  },\n  {\n    mode: RadioType;\n    options: RadioItem[];\n    direction?: 'vertical' | 'horizontal';\n    customClassName?: string;\n  }\n>;\n\nexport const DatasetWriteParser: FC<RadioProps> = props => (\n  <BaseDatasetWriteParser {...props} />\n);\n\nexport const DatasetWriteParseSetter = {\n  key: 'DatasetWriteParser',\n  component: DatasetWriteParser,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type FC } from 'react';\n\nimport type {\n  SetterComponentProps,\n  SetterOrDecoratorContext,\n} from '@flowgram-adapter/free-layout-editor';\nimport type { SeperatorType } from '@coze-data/knowledge-resource-processor-base/types';\nimport type { OptionItem, RadioType } from '@coze-arch/bot-semi/Radio';\n\nimport { DatasetWriteChunk as BaseDatasetWriteChunk } from '@/form-extensions/components/dataset-write-chunk';\n\ntype RadioItem = OptionItem & {\n  disabled?: boolean | ((context: SetterOrDecoratorContext) => boolean);\n};\n\nenum ChunkStratgy {\n  Default = 'default',\n  Layer = 'layer',\n  Custom = 'custom',\n}\n\ntype RadioProps = SetterComponentProps<\n  {\n    chunkType: ChunkStratgy;\n    maxLevel?: number;\n    saveTitle?: boolean;\n    overlap?: number;\n    maxToken?: number;\n    separator?: string;\n    separatorType?: SeperatorType;\n  },\n  {\n    mode: RadioType;\n    options: RadioItem[];\n    direction?: 'vertical' | 'horizontal';\n    customClassName?: string;\n  }\n>;\n\nexport const DatasetWriteChunk: FC<RadioProps> = props => (\n  <BaseDatasetWriteChunk {...props} />\n);\n\nexport const DatasetWriteChunkSetter = {\n  key: 'DatasetWriteChunk',\n  component: DatasetWriteChunk,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type FC,\n  type ReactElement,\n  useState,\n  type CSSProperties,\n} from 'react';\n\nimport classNames from 'classnames';\nimport {\n  IconCozArrowDownFill,\n  IconCozInfoCircle,\n} from '@coze-arch/coze-design/icons';\nimport { Col, Row, Collapsible } from '@coze-arch/coze-design';\nimport { type DecoratorComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { FormCard } from '../../components/form-card';\nimport AutoSizeTooltip from '../../../ui-components/auto-size-tooltip';\nimport { chunkArray } from './utils';\n\nimport s from './index.module.less';\n\ninterface FormLayoutDecoratorOptions {\n  cols?: number;\n  direction?: 'horizontal' | 'vertical';\n  gutter?: number;\n  gridColumns?: { title: string; ratio: number; style?: CSSProperties }[];\n  isSplit?: boolean;\n  title?: string;\n  tooltip?: string;\n}\n\n// TODO: Temporarily extract the real children in the format of rehaje React Node, and then develop with rehaje to solve the problem of children.\nconst extractRealChildFromRehajeReactNode = (propsChildren: ReactElement) => {\n  const { children = [] } = propsChildren.props;\n  const [, realChildren] = children;\n  return realChildren ?? [];\n};\n\n/**\n * @Description Suitable for scenes where the number of children in Meta is greater than 1 and there are custom requirements for grid layout, you can refer to the writing method of variable nodes\n * @param props grid configuration imported parameters\n * @Returns custom grid layout node\n */\nconst FormLayoutDecorator: FC<DecoratorComponentProps> = props => {\n  const { children, options } = props;\n  const {\n    cols = 2,\n    gutter = 24,\n    direction = 'horizontal',\n    gridColumns,\n    isSplit = true,\n    tooltip,\n    title,\n  } = options as FormLayoutDecoratorOptions;\n  const [isOpen, setOpen] = useState(true);\n\n  if (direction === 'horizontal') {\n    const realChildren = extractRealChildFromRehajeReactNode(children);\n    const childrenChunk = chunkArray<ReactElement>(realChildren, cols);\n\n    return (\n      <div className={isSplit ? s['form-layout'] : ''}>\n        <FormCard collapsible={false} noPadding>\n          {typeof title === 'string' ? (\n            <div className=\"mb-2\" onClick={() => setOpen(!isOpen)}>\n              <Row type=\"flex\" align={'middle'}>\n                <IconCozArrowDownFill\n                  className={classNames('coz-fg-secondary font-bold mr-[3px]', {\n                    [s['icon-arrow-row']]: isOpen,\n                    [s['icon-arrow-column']]: true,\n                  })}\n                />\n\n                <span className={`${s['form-layout-title']} ml-1`}>\n                  {title}\n                </span>\n                {tooltip ? (\n                  <AutoSizeTooltip\n                    showArrow\n                    position=\"top\"\n                    className={s.tooltip}\n                    content={tooltip}\n                  >\n                    <IconCozInfoCircle className=\"text-lg coz-fg-secondary ml-1\" />\n                  </AutoSizeTooltip>\n                ) : null}\n              </Row>\n            </div>\n          ) : (\n            ''\n          )}\n\n          <Collapsible keepDOM isOpen={isOpen}>\n            {childrenChunk.map(subChildren => (\n              <Row type=\"flex\" gutter={gutter}>\n                {subChildren.map((item, i) => {\n                  const content = gridColumns?.[i];\n                  return (\n                    <Col\n                      style={{\n                        display: isOpen ? 'unset' : 'none',\n                        ...content?.style,\n                      }}\n                      span={content?.ratio ?? gutter / cols}\n                    >\n                      {content ? (\n                        <span className={s['form-layout-item']}>\n                          {content?.title}\n                        </span>\n                      ) : (\n                        ''\n                      )}\n                      {item}\n                    </Col>\n                  );\n                })}\n              </Row>\n            ))}\n          </Collapsible>\n        </FormCard>\n      </div>\n    );\n  }\n  return <div>{children}</div>;\n};\n\nexport const formLayout = {\n  key: 'FormLayout',\n  component: FormLayoutDecorator,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { type DecoratorComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { FormCard, type FormCardProps } from '../../components/form-card';\nimport {\n  ColumnsTitle,\n  type ColumnsTitleProps,\n} from '../../components/columns-title';\n\nimport styles from './index.module.less';\ninterface FormCardDecoratorOptions extends FormCardProps {\n  columns: ColumnsTitleProps['columns'];\n}\n\nconst FormCardDecorator: FC<\n  DecoratorComponentProps<FormCardDecoratorOptions>\n> = props => {\n  const { context, children, options, feedbackText, feedbackStatus } = props;\n  const { title } = context.meta;\n\n  const { key, columns, ...others } = options;\n  return (\n    <FormCard\n      header={title}\n      {...others}\n      feedbackText={feedbackText}\n      feedbackStatus={feedbackStatus}\n    >\n      {columns ? (\n        <div className={styles.formCardColumns}>\n          <ColumnsTitle columns={columns} />\n        </div>\n      ) : null}\n      {children}\n    </FormCard>\n  );\n};\n\nexport const formCard = {\n  key: 'FormCard',\n  component: FormCardDecorator,\n};\n\nexport const formCardAction = {\n  key: 'FormCardAction',\n  component: FormCard.Action,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { type DecoratorComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { ColumnsTitle } from '../../components/columns-title';\n\nimport styles from './index.module.less';\n\nconst COLUMNS = [\n  {\n    title: I18n.t('workflow_detail_node_parameter_name'),\n    style: {\n      width: 160,\n    },\n  },\n  {\n    title: I18n.t('workflow_detail_node_parameter_value'),\n    style: {\n      width: 160,\n    },\n  },\n];\n\ntype ColumnsTitleProps = DecoratorComponentProps<{\n  columns?: Array<{\n    title: string;\n    style: Record<string, unknown>;\n  }>;\n}>;\n\nconst ColumnsTitleDecorator = ({ options, children }: ColumnsTitleProps) => {\n  const { columns } = options;\n  return (\n    <div className={styles['column-title-dec-wrapper']}>\n      <ColumnsTitle columns={columns || COLUMNS} />\n      {children}\n    </div>\n  );\n};\n\nexport const columnsTitle = {\n  key: 'ColumnsTitle',\n  component: ColumnsTitleDecorator,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type DecoratorExtension } from '@flowgram-adapter/free-layout-editor';\n\nimport { style } from './style';\nimport { formLayout } from './form-layout';\nimport { formItemFeedback } from './form-item-feedback';\nimport { formItem } from './form-item';\nimport { formCard, formCardAction } from './form-card';\nimport { columnsTitle } from './columns-title';\n\nexport const decorators: DecoratorExtension[] = [\n  style,\n  formLayout,\n  formCard,\n  formCardAction,\n  formItem,\n  formItemFeedback,\n  columnsTitle,\n] as DecoratorExtension[];\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback } from 'react';\n\nimport { type DecoratorComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nfunction StyleComponent({\n  children,\n  options,\n}: DecoratorComponentProps): JSX.Element {\n  const { style } = options;\n\n  const renderContent = useCallback(\n    () => <div style={style}>{children}</div>,\n    [],\n  );\n  return renderContent();\n}\n\nexport const style = {\n  key: 'Style',\n  component: StyleComponent,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport function chunkArray<T>(array: T[], chunkSize: number): T[][] {\n  return array.reduce((previous, current, index) => {\n    if (index % chunkSize === 0) {\n      previous.push([current]);\n    } else {\n      previous[previous.length - 1].push(current);\n    }\n    return previous;\n  }, [] as T[][]);\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { type DecoratorComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { FormItem, type FormItemProps } from '../../components/form-item';\n\nconst FormItem2Decorator: FC<\n  DecoratorComponentProps<\n    { key: string } & Omit<FormItemProps, 'title' | 'required'>\n  >\n> = props => {\n  const { children, feedbackText, feedbackStatus, formItemMeta, options } =\n    props;\n  const { title, required, description } = formItemMeta;\n\n  const { key, ...others } = options;\n  return (\n    <FormItem\n      label={title}\n      required={required}\n      tooltip={description}\n      feedbackText={feedbackText}\n      feedbackStatus={feedbackStatus}\n      {...others}\n    >\n      {children}\n    </FormItem>\n  );\n};\n\nexport const formItem = {\n  key: 'FormItem',\n  component: FormItem2Decorator,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { type DecoratorComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { FormItemFeedback } from '../../components/form-item-feedback';\n\ntype FormItemFeedbackProps = DecoratorComponentProps;\n\nexport const FormItemFeedback2Decorator = ({\n  children,\n  feedbackText,\n  feedbackStatus,\n  options,\n}: FormItemFeedbackProps) => {\n  const { className, style } = options;\n\n  return (\n    <div className={className} style={style}>\n      {children}\n      <FormItemFeedback\n        feedbackText={feedbackText}\n        feedbackStatus={feedbackStatus}\n      />\n    </div>\n  );\n};\n\nexport const formItemFeedback = {\n  key: 'FormItemFeedback',\n  component: FormItemFeedback2Decorator,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { injectable } from 'inversify';\nimport {\n  DecoratorAbility,\n  type FormContribution,\n  type FormManager,\n  SetterAbility,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { setters } from '../setters';\nimport { decorators } from '../decorators';\n\n@injectable()\nexport class FormAbilityExtensionsFormContribution implements FormContribution {\n  onRegister(formManager: FormManager): void {\n    setters.forEach(setter => {\n      formManager.registerAbilityExtension(SetterAbility.type, setter);\n    });\n\n    decorators.forEach(decorator => {\n      formManager.registerAbilityExtension(DecoratorAbility.type, decorator);\n    });\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport {\n  useNodeRender,\n  type WorkflowSubCanvas,\n} from '@flowgram-adapter/free-layout-editor';\n\nexport const useParentNode = () => {\n  const { node } = useNodeRender();\n  const nodeMeta = node.getNodeMeta();\n\n  const parentNode = useMemo(() => {\n    const subCanvas: WorkflowSubCanvas = nodeMeta.subCanvas(node);\n    return subCanvas.parentNode;\n  }, [node, nodeMeta]);\n\n  return parentNode;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useNodeRender } from '@flowgram-adapter/free-layout-editor';\n\nimport { type SubCanvasRenderProps } from '../type';\n\nexport const useSubCanvasRenderProps = (): SubCanvasRenderProps => {\n  const { node } = useNodeRender();\n  const nodeMeta = node.getNodeMeta();\n\n  const {\n    title = '',\n    tooltip,\n    renderPorts = [],\n    style = {},\n  } = (nodeMeta?.renderSubCanvas?.() ?? {}) as Partial<SubCanvasRenderProps>;\n\n  return {\n    title,\n    tooltip,\n    renderPorts,\n    style,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo, type FC } from 'react';\n\nimport { useNodeRender } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowNodeData } from '@coze-workflow/nodes';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { IconInfo } from '@coze-arch/bot-icons';\n\nimport AutoSizeTooltip from '@/ui-components/auto-size-tooltip';\nimport { getBgColor } from '@/form-extensions/components/node-header/utils/get-bg-color';\n\nimport { useParentNode, useSubCanvasRenderProps } from '../../hooks';\nimport { NodeIcon } from '../../../node-icon';\n\nimport styles from './index.module.less';\n\nexport const SubCanvasHeader: FC = () => {\n  const { startDrag, onFocus, onBlur } = useNodeRender();\n  const { getNodeTestId, concatTestId } = useNodeTestId();\n\n  const { title, tooltip } = useSubCanvasRenderProps();\n\n  const parentNode = useParentNode();\n\n  const bgColor = useMemo(() => {\n    const parentNodeDataEntity =\n      parentNode.getData<WorkflowNodeData>(WorkflowNodeData);\n    const parentNodeData = parentNodeDataEntity.getNodeData();\n    if (parentNodeData?.mainColor) {\n      const OPACITY = 0.08;\n      return `linear-gradient(${getBgColor(\n        parentNodeData.mainColor,\n        OPACITY,\n      )} 0%, var(--coz-bg-plus) 100%)`;\n    } else {\n      return 'var(--coz-bg-plus)';\n    }\n  }, [parentNode]);\n\n  return (\n    <div\n      className={styles['sub-canvas-header']}\n      draggable={true}\n      onMouseDown={e => {\n        startDrag(e);\n      }}\n      onFocus={onFocus}\n      onBlur={onBlur}\n      style={{\n        background: bgColor,\n      }}\n    >\n      <NodeIcon\n        className={styles['sub-canvas-logo']}\n        nodeId={parentNode.id}\n        size={24}\n        alt=\"logo\"\n      />\n      <p\n        className={styles['sub-canvas-title']}\n        data-testid={concatTestId(getNodeTestId(), 'title')}\n      >\n        {title}\n      </p>\n      {tooltip ? (\n        <AutoSizeTooltip\n          showArrow\n          position=\"top\"\n          content={<span>{tooltip}</span>}\n          className={styles['sub-canvas-tooltip']}\n        >\n          <IconInfo\n            className={styles['sub-canvas-tooltip-icon']}\n            data-testid={concatTestId(getNodeTestId(), 'tips')}\n          />\n        </AutoSizeTooltip>\n      ) : null}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { FC } from 'react';\n\nimport { useNodeRender } from '@flowgram-adapter/free-layout-editor';\n\nimport styles from './index.module.less';\n\nexport const SubCanvasBackground: FC = () => {\n  const { node } = useNodeRender();\n  return (\n    <div\n      className={styles['sub-canvas-background']}\n      data-flow-editor-selectable=\"true\"\n    >\n      <svg width=\"100%\" height=\"100%\">\n        <pattern\n          id=\"sub-canvas-dot-pattern\"\n          width=\"20\"\n          height=\"20\"\n          patternUnits=\"userSpaceOnUse\"\n        >\n          <circle cx=\"1\" cy=\"1\" r=\"1\" stroke=\"#eceeef\" fillOpacity=\"0.5\" />\n        </pattern>\n        <rect\n          width=\"100%\"\n          height=\"100%\"\n          fill=\"url(#sub-canvas-dot-pattern)\"\n          data-node-panel-container={node.id}\n        />\n      </svg>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable react-hooks/exhaustive-deps -- custom */\nimport { useEffect, useState, type FC, type ReactNode } from 'react';\n\nimport classNames from 'classnames';\nimport { FlowNodeTransformData } from '@flowgram-adapter/free-layout-editor';\nimport {\n  useNodeRender,\n  useService,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { WorkflowEditService } from '@/services';\n\nimport { useParentNode, useSubCanvasRenderProps } from '../../hooks';\n\nimport styles from './index.module.less';\n\ninterface ISubCanvasContainer {\n  children: ReactNode[];\n}\n\nexport const SubCanvasContainer: FC<ISubCanvasContainer> = ({ children }) => {\n  const { node, selected, selectNode, nodeRef } = useNodeRender();\n  const editService = useService(WorkflowEditService);\n  const nodeMeta = node.getNodeMeta();\n  const { size = { width: 300, height: 200 } } = nodeMeta;\n  const { style = {} } = useSubCanvasRenderProps();\n\n  const transform = node.getData<FlowNodeTransformData>(FlowNodeTransformData);\n  const [width, setWidth] = useState(size.width);\n  const [height, setHeight] = useState(size.height);\n\n  const parentNode = useParentNode();\n\n  useEffect(() => {\n    const updateSize = () => {\n      // When there is no sub-node\n      if (node.collapsedChildren.length === 0) {\n        const parentTransform = parentNode.getData<FlowNodeTransformData>(\n          FlowNodeTransformData,\n        );\n        setWidth(parentTransform.bounds.width ?? size.width);\n        setHeight(parentTransform.bounds.height ?? size.height);\n        return;\n      }\n      // When there is a sub-node, it only listens for width and height changes\n      if (width !== transform.bounds.width) {\n        setWidth(transform.bounds.width);\n      }\n      if (height !== transform.bounds.height) {\n        setHeight(transform.bounds.height);\n      }\n    };\n    updateSize();\n    const dispose = transform.onDataChange(() => {\n      updateSize();\n    });\n    return () => dispose.dispose();\n  }, [parentNode, transform]);\n\n  return (\n    <div\n      className={classNames(styles['sub-canvas-container'], {\n        selected,\n      })}\n      style={{\n        width,\n        height,\n        ...style,\n      }}\n      ref={nodeRef}\n      data-node-selected={String(selected)}\n      onMouseDown={selectNode}\n      onClick={e => {\n        selectNode(e);\n        editService.focusNode();\n      }}\n    >\n      {children}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport styles from './index.module.less';\n\nexport const SubCanvasBorder = () => (\n  <div className={styles['sub-canvas-border']}></div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, type FC } from 'react';\n\nimport {\n  WorkflowNodePortsData,\n  useNodeRender,\n} from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowPortRender } from '@coze-workflow/render';\nimport { useNodeTestId } from '@coze-workflow/base';\n\nimport { useSubCanvasRenderProps } from '../../hooks';\n\nexport const SubCanvasPorts: FC = () => {\n  const { node, ports } = useNodeRender();\n  const { renderPorts } = useSubCanvasRenderProps();\n\n  const { getNodeTestId, concatTestId } = useNodeTestId();\n  const testId = getNodeTestId();\n\n  useEffect(() => {\n    const portsData = node.getData<WorkflowNodePortsData>(\n      WorkflowNodePortsData,\n    );\n    portsData.updateDynamicPorts();\n  }, [node]);\n\n  return (\n    <>\n      {renderPorts.map(p => (\n        <div\n          key={`canvas-port${p.id}`}\n          className=\"sub-canvas-port\"\n          data-port-id={p.id}\n          data-port-type={p.type}\n          style={p.style}\n          data-testid={concatTestId(testId, 'port', p.id)}\n        />\n      ))}\n      {ports.map(p => (\n        <WorkflowPortRender key={p.id} entity={p} />\n      ))}\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/naming-convention -- no need */\n\nconst STORAGE_KEY = 'workflow-move-into-sub-canvas-tip-visible';\nconst STORAGE_VALUE = 'false';\n\nexport class TipsGlobalStore {\n  private static _instance?: TipsGlobalStore;\n  public static get instance(): TipsGlobalStore {\n    if (!this._instance) {\n      this._instance = new TipsGlobalStore();\n    }\n    return this._instance;\n  }\n\n  private closed = false;\n\n  public isClosed(): boolean {\n    return this.isCloseForever() || this.closed;\n  }\n\n  public close(): void {\n    this.closed = true;\n  }\n\n  public isCloseForever(): boolean {\n    return localStorage.getItem(STORAGE_KEY) === STORAGE_VALUE;\n  }\n\n  public closeForever(): void {\n    localStorage.setItem(STORAGE_KEY, STORAGE_VALUE);\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useEffect, useState } from 'react';\n\nimport {\n  NodeIntoContainerService,\n  NodeIntoContainerType,\n} from '@flowgram-adapter/free-layout-editor';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { useNodeRender } from '@flowgram-adapter/free-layout-editor';\n\nimport { TipsGlobalStore } from './global-store';\n\nexport const useControlTips = () => {\n  const { node } = useNodeRender();\n  const [visible, setVisible] = useState(false);\n  const globalStore = TipsGlobalStore.instance;\n\n  const nodeIntoContainerService = useService<NodeIntoContainerService>(\n    NodeIntoContainerService,\n  );\n\n  const show = useCallback(() => {\n    if (globalStore.isClosed()) {\n      return;\n    }\n\n    setVisible(true);\n  }, [globalStore]);\n\n  const close = useCallback(() => {\n    globalStore.close();\n    setVisible(false);\n  }, [globalStore]);\n\n  const closeForever = useCallback(() => {\n    globalStore.closeForever();\n    close();\n  }, [close, globalStore]);\n\n  useEffect(() => {\n    // monitor move in\n    const inDisposer = nodeIntoContainerService.on(e => {\n      if (e.type !== NodeIntoContainerType.In) {\n        return;\n      }\n      if (e.targetContainer === node) {\n        show();\n      }\n    });\n    // listen for move-out events\n    const outDisposer = nodeIntoContainerService.on(e => {\n      if (e.type !== NodeIntoContainerType.Out) {\n        return;\n      }\n      if (e.sourceContainer === node && !node.blocks.length) {\n        setVisible(false);\n      }\n    });\n    return () => {\n      inDisposer.dispose();\n      outDisposer.dispose();\n    };\n  }, [nodeIntoContainerService, node, show, close, visible]);\n\n  return {\n    visible,\n    close,\n    closeForever,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const isMacOS = /(Macintosh|MacIntel|MacPPC|Mac68K|iPad)/.test(\n  navigator.userAgent,\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozeCross } from '@coze-arch/bot-icons';\n\nimport { useControlTips } from './use-control';\nimport { isMacOS } from './is-mac-os';\n\nimport styles from './index.module.less';\n\nexport const SubCanvasTips = () => {\n  const { visible, close, closeForever } = useControlTips();\n\n  if (!visible) {\n    return null;\n  }\n  return (\n    <div className={styles['sub-canvas-tips']}>\n      <div className={styles.container}>\n        <div className={styles.content}>\n          <p className={styles.text}>\n            {I18n.t('workflow_subcanvas_pull_out', {\n              ctrl: isMacOS ? 'Cmd ' : 'Ctrl',\n            })}\n          </p>\n          <div\n            className={styles.space}\n            style={{\n              width: I18n.language === 'zh-CN' ? 0 : 128,\n            }}\n          />\n        </div>\n        <div className={styles.actions}>\n          <p className={styles.closeForever} onClick={closeForever}>\n            {I18n.t('workflow_subcanvas_never_remind')}\n          </p>\n          <div className={styles.close} onClick={close}>\n            <IconCozeCross color=\"coz-fg-plus\" />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { FC } from 'react';\n\nimport type { WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  SubCanvasBackground,\n  SubCanvasTips,\n  SubCanvasHeader,\n  SubCanvasPorts,\n  SubCanvasBorder,\n  SubCanvasContainer,\n} from './components';\n\nexport const SubCanvasRender: FC<{\n  node: WorkflowNodeEntity;\n}> = props => (\n  <SubCanvasContainer>\n    <SubCanvasBorder />\n    <SubCanvasBackground />\n    <SubCanvasTips />\n    <SubCanvasHeader />\n    <SubCanvasPorts />\n  </SubCanvasContainer>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport copy from 'copy-to-clipboard';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozCopy } from '@coze-arch/coze-design/icons';\nimport { Typography, Toast } from '@coze-arch/coze-design';\nimport { UIIconButton } from '@coze-arch/bot-semi';\n\nimport { useExecStateEntity } from '../../../hooks';\n\nconst { Text } = Typography;\n\nexport const ExecuteLogId = () => {\n  const execEntity = useExecStateEntity();\n\n  const { executeLogId = '', logID = '' } = execEntity;\n\n  const handleCopy = (id: string) => {\n    const success = copy(id);\n    if (success) {\n      Toast.success({ content: I18n.t('copy_success'), showClose: false });\n    } else {\n      Toast.warning({ content: I18n.t('copy_failed'), showClose: false });\n    }\n  };\n\n  if (!executeLogId) {\n    return null;\n  }\n\n  return (\n    <>\n      <div>\n        <Text className=\"inline break-words\" size=\"small\" type=\"quaternary\">\n          {`${I18n.t(\n            'workflow_running_results_error_executeid',\n          )}: ${executeLogId}`}\n          <UIIconButton\n            wrapperClass=\"inline\"\n            iconSize=\"small\"\n            icon={<IconCozCopy color=\"#1D1C2359\" />}\n            onClick={() => handleCopy(executeLogId)}\n          />\n        </Text>\n      </div>\n\n      <div>\n        <Text className=\"inline break-words\" size=\"small\" type=\"quaternary\">\n          {`logID: ${logID}`}\n          <UIIconButton\n            wrapperClass=\"inline\"\n            iconSize=\"small\"\n            icon={<IconCozCopy color=\"#1D1C2359\" />}\n            onClick={() => handleCopy(logID)}\n          />\n        </Text>\n      </div>\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport React, { useCallback, useMemo } from 'react';\n\nimport cls from 'classnames';\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { LogDetail, type WorkflowLinkLogData } from '@coze-workflow/test-run';\n\nimport { ExecuteLogId } from '../execute-log-id';\nimport { ImgLogV2 } from '../../img-log-v2';\nimport { useExecStateEntity, useGlobalState } from '../../../../hooks';\n// import { LogDetail } from './log-detail';\n\nimport styles from './index.module.less';\n\ntype ExecuteResultPanelProps = {\n  node: FlowNodeEntity;\n  /** Open sub-workflow jump link */\n  onOpenWorkflowLink?: (data: WorkflowLinkLogData) => void;\n} & React.HTMLAttributes<HTMLDivElement>;\n\nconst ExecuteResultPanel: React.FC<ExecuteResultPanelProps> = ({\n  node,\n  className,\n  onOpenWorkflowLink,\n  ...props\n}) => {\n  const entity = useExecStateEntity();\n  const id = useMemo(() => node.id, [node]);\n  const executeResult = entity.getNodeExecResult(id);\n  const globalState = useGlobalState();\n\n  /**\n   * The hover event uniformly goes through mousemove bubbling, because the hover node algorithm does not consider the case that the node is a polygon\n   * The move in the floating layer will be misjudged as playground or line, which will trigger the circling logic or highlight the line, so prevent mousemove from bubbling.\n   * Mousedown must also prevent bubbling, otherwise it will determine the circling\n   * Drag events go mousemove capture uniformly, so drag is not affected\n   */\n  const handleStepPropagation = useCallback<\n    React.MouseEventHandler<HTMLDivElement>\n  >(e => {\n    e.stopPropagation();\n  }, []);\n\n  const hasError = executeResult?.errorLevel === 'Error';\n\n  return (\n    <div\n      className={cls(styles['flow-test-run-result-panel'], className)}\n      onMouseDown={handleStepPropagation}\n      onMouseMove={handleStepPropagation}\n      {...props}\n    >\n      {executeResult ? (\n        <LogDetail\n          spaceId={globalState.spaceId}\n          workflowId={globalState.workflowId}\n          result={executeResult}\n          paginationFixedCount={5}\n          LogImages={ImgLogV2}\n          onOpenWorkflowLink={onOpenWorkflowLink}\n          node={node}\n        />\n      ) : null}\n      {hasError ? (\n        <div className=\"mt-4\">\n          <ExecuteLogId />\n        </div>\n      ) : null}\n    </div>\n  );\n};\n\nexport { ExecuteResultPanel };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Button } from '@coze-arch/coze-design';\n\nimport { useOpenDatabaseDetail } from '@/components/database-detail-modal';\n\nexport function ViewDataButton() {\n  const { openDatabaseDetail } = useOpenDatabaseDetail();\n\n  return (\n    <Button\n      onClick={e => {\n        e.stopPropagation();\n        openDatabaseDetail();\n      }}\n      size=\"small\"\n      color=\"secondary\"\n      className=\"!coz-fg-hglt\"\n    >\n      {I18n.t('workflow_view_data', {}, '')}\n    </Button>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type NodeResult } from '@coze-workflow/base/api';\nimport { safeJSONParse } from '@coze-arch/bot-utils';\n\nconst generateAuth = (result?: NodeResult) => {\n  if (!result?.extra) {\n    return {\n      needAuth: false,\n      authLink: '',\n    };\n  }\n\n  const extra = safeJSONParse(result?.extra, {});\n  const auth = extra?.auth || {};\n  const { auth_info: authLink, need_auth: needAuth } = auth;\n\n  return {\n    needAuth,\n    authLink,\n  };\n};\n\nexport { generateAuth };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { generateAuth } from '../utils/generate-auth';\nimport { useExecStateEntity } from '../../../hooks';\nimport { type NodeError } from '../../../entities/workflow-exec-state-entity';\n\nconst transformNodeError = (nodeErrors?: NodeError[]) => {\n  if (!nodeErrors) {\n    return;\n  }\n  const error = nodeErrors.find(item => item.errorLevel === 'error');\n  const warning = nodeErrors.find(item => item.errorLevel === 'warning');\n  const pending = nodeErrors.find(item => item.errorLevel === 'pending');\n\n  return error || warning || pending;\n};\n\nexport const useStatus = (nodeId: string) => {\n  const execEntity = useExecStateEntity();\n  const { projectId: runProjectId } = execEntity.config;\n\n  const executeResult = execEntity.getNodeExecResult(nodeId);\n  const { nodeStatus, nodeExeCost, tokenAndCost } = executeResult || {};\n\n  const { needAuth, authLink } = generateAuth(executeResult);\n\n  const handleAuth = () => {\n    const features =\n      'toolbar=no, location=no, status=no, menubar=no, scrollbars=yes, resizable=yes, width=480, height=630';\n    window.open(authLink, 'targetWindow', features);\n  };\n\n  const nodeError = execEntity.getNodeError(nodeId);\n\n  const { errorLevel, errorInfo } = transformNodeError(nodeError) || {};\n\n  return {\n    nodeStatus,\n    hasExecuteResult: !!executeResult,\n    nodeExeCost,\n    tokenAndCost,\n    errorLevel,\n    errorInfo,\n    needAuth,\n    handleAuth,\n    runProjectId,\n    isSingleMode: execEntity.config.isSingleMode,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isObject } from 'lodash-es';\nimport { SettingOnErrorProcessType } from '@coze-workflow/nodes';\nimport { NodeExeStatus, useWorkflowNode } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { typeSafeJSONParse } from '@coze-arch/bot-utils';\n\nimport { useExecStateEntity } from '../../../hooks';\n\nconst hasError = (output?: string) => {\n  if (!output) {\n    return false;\n  }\n\n  const outputJSON = typeSafeJSONParse(output) as {\n    isSuccess?: boolean;\n    errorBody?: {\n      errorCode?: string;\n    };\n  };\n  return (\n    outputJSON &&\n    isObject(outputJSON) &&\n    outputJSON.isSuccess === false &&\n    outputJSON.errorBody?.errorCode\n  );\n};\n\nexport const useSettingOnErrorDesc = (nodeId: string) => {\n  const execEntity = useExecStateEntity();\n\n  const executeResult = execEntity.getNodeExecResult(nodeId);\n  const { nodeStatus, output } = executeResult || {};\n  const settingOnError = useWorkflowNode().data?.settingOnError;\n\n  if (\n    !settingOnError?.settingOnErrorIsOpen ||\n    nodeStatus !== NodeExeStatus.Success ||\n    !hasError(output)\n  ) {\n    return;\n  }\n\n  const processType =\n    settingOnError?.processType || SettingOnErrorProcessType.RETURN;\n\n  return processType === SettingOnErrorProcessType.EXCEPTION\n    ? I18n.t('workflow_250421_01', undefined, '')\n    : I18n.t('workflow_250421_02', undefined, '');\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useMemo } from 'react';\n\nimport classNames from 'classnames';\nimport type { FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { useNodeRender } from '@flowgram-adapter/free-layout-editor';\nimport { NodeStatusBar } from '@coze-workflow/test-run/log';\nimport { NodeExeStatus } from '@coze-workflow/base/api';\nimport { CONVERSATION_NODES, StandardNodeType } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { Spin, Typography } from '@coze-arch/bot-semi';\nimport {\n  IconWorkflowRunning,\n  IconWorkflowRunSuccess,\n} from '@coze-arch/bot-icons';\nimport {\n  IconCozWarningCircleFill,\n  IconCozInfoCircle,\n} from '@coze-arch/coze-design/icons';\nimport { Tag } from '@coze-arch/coze-design';\n\nimport { TestRunCostPopover } from '../../test-run/execute-result/test-run-cost-popover';\nimport { ExecuteResultPanel } from '../../test-run/execute-result/execute-result-panel';\nimport { useGlobalState } from '../../../hooks';\nimport { ViewDataButton } from './view-data-button';\nimport { useStatus } from './use-status';\nimport { useSettingOnErrorDesc } from './use-setting-on-error-desc';\n\nimport styles from './styles.module.less';\n\ninterface ExecuteStatusBarProps {\n  node: FlowNodeEntity;\n  className?: string;\n  style?: React.CSSProperties;\n}\n\nconst { Text } = Typography;\n\nexport const ExecuteStatusBarContent: React.FC<ExecuteStatusBarProps> = ({\n  node,\n}) => {\n  const { id, flowNodeType: nodeType } = node;\n  const { playgroundProps, projectId, spaceId, getProjectApi } =\n    useGlobalState();\n\n  const isLLM = nodeType === StandardNodeType.LLM;\n\n  const {\n    hasExecuteResult,\n    nodeStatus,\n    nodeExeCost,\n    tokenAndCost,\n    needAuth,\n    handleAuth,\n    runProjectId,\n    errorLevel,\n  } = useStatus(id);\n  const settingOnErrorDesc = useSettingOnErrorDesc(id);\n  const { selectNode } = useNodeRender();\n\n  // Node 4 states\n  const isNodeSuccess = nodeStatus === NodeExeStatus.Success;\n  const isNodeRunning = nodeStatus === NodeExeStatus.Running;\n\n  const isNodeWarning = errorLevel === 'warning';\n  const isNodeError = errorLevel === 'error';\n  const isNodePending = errorLevel === 'pending';\n\n  /** Results The default expansion mode supports external configuration. If there is no external configuration, the image stream is expanded by default. */\n  const defaultResultCollapseMode = playgroundProps.defaultResultCollapseMode\n    ? 'all'\n    : 'end';\n  /**\n   * Default expansion mode\n   * Error reporting node expanded by default\n   */\n  const defaultShowPanel = defaultResultCollapseMode === 'all';\n\n  const hasConversation =\n    !!runProjectId && CONVERSATION_NODES.includes(nodeType as StandardNodeType);\n\n  const tagColor = useMemo(() => {\n    if (isNodeSuccess) {\n      return 'green';\n    }\n    if (isNodeError) {\n      return 'red';\n    }\n    if (isNodeRunning) {\n      return 'blue';\n    }\n    if (isNodeWarning) {\n      return 'yellow';\n    }\n  }, [isNodeSuccess, isNodeError, isNodeRunning, isNodeWarning]);\n\n  const renderIcon = () => {\n    if (isNodeRunning) {\n      return (\n        <Spin\n          size=\"small\"\n          wrapperClassName={styles['spin-container']}\n          indicator={\n            <IconWorkflowRunning\n              className={classNames(styles['status-icon'])}\n            />\n          }\n        />\n      );\n    }\n    if (isNodeSuccess && !isNodeWarning) {\n      return <IconWorkflowRunSuccess className={styles['status-icon']} />;\n    }\n    return (\n      <IconCozWarningCircleFill\n        className={classNames(styles['status-icon'], 'text-[20px]', {\n          'text-[--semi-color-danger]': isNodeError,\n          'text-[--semi-color-warning]': isNodeWarning,\n          'text-[--semi-color-secondary]': isNodePending,\n        })}\n      />\n    );\n  };\n  const renderDesc = () => {\n    const getDesc = () => {\n      if (isNodeRunning) {\n        return I18n.t('workflow_detail_title_testrun_running', {}, 'Running');\n      } else if (isNodePending) {\n        return I18n.t('workflow_node_stoprun', {}, 'Run terminated');\n      } else if (isNodeSuccess) {\n        return (\n          settingOnErrorDesc ||\n          I18n.t('workflow_detail_title_testrun_succeed_node', {}, 'Succeed')\n        );\n      } else if (isNodeError) {\n        return I18n.t(\n          'workflow_detail_title_testrun_failed_node',\n          {},\n          'Failed',\n        );\n      }\n    };\n\n    const desc = getDesc();\n\n    return desc ? (\n      <Text\n        className={styles['font-normal']}\n        ellipsis={{ showTooltip: true }}\n        data-testid=\"workflow.detail.node.testrun.status\"\n      >\n        {desc}\n      </Text>\n    ) : null;\n  };\n  const renderCostPopover = () => {\n    if (!isLLM || !FEATURE_ENABLE_WORKFLOW_LLM_PAYMENT || !hasExecuteResult) {\n      return null;\n    }\n    return (\n      <TestRunCostPopover\n        tokenAndCost={tokenAndCost || {}}\n        popoverProps={{ position: 'top' }}\n        className=\"leading-none\"\n      >\n        <Tag suffixIcon={<IconCozInfoCircle />} size=\"mini\" color={tagColor}>\n          {I18n.t('analytic_query_table_title_tokens')}\n        </Tag>\n      </TestRunCostPopover>\n    );\n  };\n\n  const handleJumpToProjectConversation = () => {\n    const projectApi = getProjectApi();\n    if (projectId && projectApi) {\n      projectApi.sendMsgOpenWidget('/session', {\n        name: 'tab',\n        data: { value: 'testrun' },\n      });\n    } else {\n      window.open(`/space/${spaceId}/project-ide/${runProjectId}/session`);\n    }\n  };\n\n  return (\n    <NodeStatusBar\n      defaultShowDetail={defaultShowPanel}\n      hasExecuteResult={hasExecuteResult}\n      needAuth={needAuth}\n      onAuth={handleAuth}\n      hasConversation={hasConversation}\n      onJumpToProjectConversation={handleJumpToProjectConversation}\n      header={\n        <>\n          {renderIcon()}\n          {renderDesc()}\n          {nodeExeCost ? (\n            <Tag size=\"mini\" color={tagColor} className=\"shrink-0\">\n              {nodeExeCost}\n            </Tag>\n          ) : null}\n          {renderCostPopover()}\n        </>\n      }\n      extraBtns={\n        [\n          StandardNodeType.Database,\n          StandardNodeType.DatabaseQuery,\n          StandardNodeType.DatabaseUpdate,\n          StandardNodeType.DatabaseDelete,\n          StandardNodeType.DatabaseCreate,\n        ].includes(`${nodeType}` as StandardNodeType)\n          ? [<ViewDataButton />]\n          : []\n      }\n    >\n      <ExecuteResultPanel\n        id={id}\n        node={node}\n        onClick={e => {\n          e.stopPropagation();\n          selectNode(e);\n        }}\n        onOpenWorkflowLink={data => {\n          const { workflowId, executeId, subExecuteId } = data;\n          const projectApi = getProjectApi();\n\n          if (projectId && projectApi) {\n            // in-app jump\n            projectApi.sendMsgOpenWidget(`/workflow/${workflowId}`, {\n              name: 'debug',\n              data: {\n                executeId,\n                subExecuteId,\n              },\n            });\n          } else {\n            // Resource library or operation and maintenance platform jump\n            const url = new URL(window.location.href);\n            const params = new URLSearchParams();\n\n            // Add/update query parameters to keep only these 4 parameters, including space_id\n            params.append('space_id', url.searchParams.get('space_id') || '0');\n            params.append('workflow_id', workflowId);\n            params.append('execute_id', executeId);\n            params.append('sub_execute_id', subExecuteId);\n\n            // Build a new URL\n            url.search = params.toString();\n\n            // Open in a new tab\n            window.open(url.toString(), '_blank');\n          }\n        }}\n      />\n    </NodeStatusBar>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Node status bar for coze graph 2.0\n */\nimport React from 'react';\n\nimport { WorkflowExecStatus, NodeExeStatus } from '@coze-workflow/base';\nimport { getNodeError } from '@flowgram-adapter/free-layout-editor';\nimport type { FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport { useExecStateEntity, useGlobalState } from '../../../hooks';\nimport { ExecuteStatusBarContent } from './content';\n\ninterface ExecuteStatusBarV2Props {\n  node: FlowNodeEntity;\n}\n\nconst ExecuteStatusBarV2: React.FC<ExecuteStatusBarV2Props> = props => {\n  const { node } = props;\n\n  const execEntity = useExecStateEntity();\n  const globalState = useGlobalState();\n\n  // Workflow related\n  const { viewStatus } = globalState;\n  const executeNodeResult = execEntity.getNodeExecResult(node.id);\n\n  // node correlation\n  const { nodeStatus } = executeNodeResult || {};\n  // Node 4 states\n  const isNodeWaiting = nodeStatus === NodeExeStatus.Waiting;\n  // Determine whether to display this component.\n  // When a workflow is running or running, and there is a running result, and the node is not waiting\n  const showStatusBar =\n    (viewStatus === WorkflowExecStatus.EXECUTING ||\n      viewStatus === WorkflowExecStatus.DONE) &&\n    Boolean(executeNodeResult) &&\n    !isNodeWaiting;\n\n  const isInvalidNode = getNodeError(node);\n  /**\n   * 1. Invalid node does not display status bar\n   * 2. Do not display status bar when display conditions are not met\n   */\n  if (isInvalidNode || !showStatusBar) {\n    return null;\n  }\n\n  return <ExecuteStatusBarContent {...props} />;\n};\n\nexport { ExecuteStatusBarV2 };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type PropsWithChildren, useCallback, useState } from 'react';\n\nimport { ConfigProvider } from '@coze-arch/bot-semi';\nimport { useNodeRender } from '@flowgram-adapter/free-layout-editor';\n\ninterface WrapperProps {\n  className?: string;\n  onClick?: (e) => void;\n}\n\nexport function Wrapper({\n  children,\n  className = '',\n  onClick,\n}: PropsWithChildren<WrapperProps>) {\n  const [isDragging, setIsDragging] = useState(false);\n  const { startDrag, nodeRef, onFocus, onBlur } = useNodeRender();\n\n  const handleClick = e => {\n    if (!isDragging) {\n      onClick?.(e);\n    }\n  };\n\n  const handleDragStart = e => {\n    setIsDragging(true);\n    startDrag(e);\n  };\n\n  const handleMouseUp = () => {\n    setIsDragging(false);\n  };\n\n  const getPopupContainer = useCallback(\n    () => nodeRef.current || document.body,\n    [nodeRef],\n  );\n\n  return (\n    <ConfigProvider getPopupContainer={getPopupContainer}>\n      <div\n        className={className}\n        onClick={handleClick}\n        ref={nodeRef}\n        onFocus={onFocus}\n        onBlur={onBlur}\n        onDragStart={handleDragStart}\n        onMouseUp={handleMouseUp}\n        draggable\n      >\n        {children}\n      </div>\n    </ConfigProvider>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback } from 'react';\n\nimport { WorkflowNodePanelService } from '@flowgram-adapter/free-layout-editor';\nimport {\n  FlowNodeBaseType,\n  type FlowNodeEntity,\n  FlowNodeTransformData,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  useNodeRender,\n  type WorkflowPortEntity,\n  useService,\n  usePlayground,\n  WorkflowDocument,\n  getAntiOverlapPosition,\n  type WorkflowNodeEntity,\n} from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowPortRender } from '@coze-workflow/render';\nimport { type StandardNodeType } from '@coze-workflow/base';\nimport { Toast } from '@coze-arch/coze-design';\n\nimport { WorkflowCustomDragService, WorkflowEditService } from '@/services';\n\nconst useClickPort = () => {\n  const document = useService(WorkflowDocument);\n  const nodePanelService = useService(WorkflowNodePanelService);\n  const dragService = useService(WorkflowCustomDragService);\n  const editService = useService(WorkflowEditService);\n  const playground = usePlayground();\n\n  const getContainer = (fromNode: WorkflowNodeEntity) => {\n    const fromContainer = fromNode?.parent;\n    if (fromNode?.flowNodeType === FlowNodeBaseType.SUB_CANVAS) {\n      // Subcanvas internal input wiring\n      return fromNode;\n    }\n    if (fromContainer?.flowNodeType === FlowNodeBaseType.ROOT) {\n      return;\n    }\n    return fromContainer;\n  };\n\n  const clickPort = useCallback(\n    async (event: React.MouseEvent, port: WorkflowPortEntity) => {\n      if (playground.config.readonly) {\n        return;\n      }\n      const sourceNode = port.node;\n      const containerNode = getContainer(sourceNode);\n      const panelPosition = playground.config.getPosFromMouseEvent(event);\n      const node = await (nodePanelService as WorkflowNodePanelService).call({\n        panelPosition,\n        enableBuildLine: true,\n        fromPort: port,\n        panelProps: {\n          enableScrollClose: true,\n        },\n        canAddNode: ({ nodeType }) => {\n          const canDropMessage = dragService.canDropToNode({\n            dragNodeType: nodeType as StandardNodeType,\n            dropNode: containerNode,\n          });\n          if (!canDropMessage.allowDrop) {\n            Toast.warning({\n              content: canDropMessage.message,\n            });\n          }\n          return canDropMessage.allowDrop;\n        },\n        customPosition({ nodeType }) {\n          const sourceRect = sourceNode.getData(FlowNodeTransformData).bounds;\n          const offsetPosition = {\n            x: sourceRect.right + 300,\n            y: sourceRect.y,\n          };\n          const adjustedPosition = dragService.adjustSubNodePosition(\n            nodeType,\n            containerNode,\n            offsetPosition,\n          );\n          const antiOverlapPosition = getAntiOverlapPosition(\n            document,\n            adjustedPosition,\n            containerNode,\n          );\n          return antiOverlapPosition;\n        },\n      });\n      editService.focusNode(node as FlowNodeEntity);\n      return node;\n    },\n    [document, dragService, editService, nodePanelService, playground],\n  );\n\n  return clickPort;\n};\n\nexport function Ports() {\n  const { ports } = useNodeRender();\n  const clickPort = useClickPort();\n  return (\n    <>\n      {ports.map(port => (\n        <WorkflowPortRender key={port.id} entity={port} onClick={clickPort} />\n      ))}\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback } from 'react';\n\nimport { WorkflowNode } from '@coze-workflow/base';\nimport {\n  useCurrentEntity,\n  type FormModelV2,\n  Form,\n  Field,\n  type FieldRenderProps,\n  FlowNodeFormData,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  NodeHeader,\n  type NodeHeaderValue,\n  useDefaultNodeMeta,\n} from '@/nodes-v2';\nimport { useGlobalState } from '@/hooks';\n\nimport styles from './header.module.less';\n\nexport function Header() {\n  const node = useCurrentEntity();\n  const defaultNodeMeta = useDefaultNodeMeta();\n\n  const { projectId } = useGlobalState();\n  const renderNodeV2Header = useCallback(() => {\n    const formModel = node\n      .getData(FlowNodeFormData)\n      .getFormModel<FormModelV2>();\n    const triggerIsOpen = formModel.getValueIn('trigger.isOpen');\n    const formControl = formModel?.formControl;\n    const wrappedNode = new WorkflowNode(node);\n    return (\n      <Form control={formControl}>\n        <Field\n          name={'nodeMeta'}\n          deps={['outputs', 'batchMode']}\n          defaultValue={defaultNodeMeta as unknown as NodeHeaderValue}\n        >\n          {({ field, fieldState }: FieldRenderProps<NodeHeaderValue>) => (\n            <NodeHeader\n              {...field}\n              readonly={!!wrappedNode?.registry?.meta?.headerReadonly}\n              hideTest={!!wrappedNode?.registry?.meta?.hideTest}\n              readonlyAllowDeleteOperation={\n                !!wrappedNode?.registry?.meta\n                  ?.headerReadonlyAllowDeleteOperation\n              }\n              showTrigger={\n                !!wrappedNode.registry?.meta?.showTrigger?.({ projectId })\n              }\n              triggerIsOpen={triggerIsOpen}\n              outputsPath={'outputs'}\n              batchModePath={'batchMode'}\n              extraOperation={wrappedNode?.registry?.getHeaderExtraOperation?.(\n                formModel.getValues(),\n                node,\n              )}\n              errors={fieldState?.errors || []}\n            />\n          )}\n        </Field>\n      </Form>\n    );\n  }, [defaultNodeMeta, node]);\n  return (\n    <div className={styles['node-render-new-header']}>\n      {renderNodeV2Header()}\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport classNames from 'classnames';\nimport {\n  type FlowNodeEntity,\n  FlowNodeErrorData,\n  useService,\n  type NodeErrorRenderProps,\n} from '@flowgram-adapter/free-layout-editor';\nimport { type NodeData, WorkflowNodeData } from '@coze-workflow/nodes';\nimport { StandardNodeType } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { Typography, UIButton } from '@coze-arch/bot-semi';\nimport { IconAlertFilled } from '@coze-arch/bot-icons';\nimport { IconCozTrashCan } from '@coze-arch/coze-design/icons';\n\nimport { NodeIcon } from '../node-icon';\nimport { WorkflowEditService } from '../../services';\nimport { useGlobalState, useNodeRenderScene } from '../../hooks';\n\nconst { Text, Title } = Typography;\n\nexport const SystemError = ({ node }: { node: FlowNodeEntity }) => {\n  const globalState = useGlobalState();\n  const { isNewNodeRender } = useNodeRenderScene();\n\n  const nodeData = node.getData<WorkflowNodeData>(WorkflowNodeData);\n  const nodeMeta = nodeData.getNodeData<keyof NodeData>();\n\n  const errorData = node.getData<FlowNodeErrorData>(FlowNodeErrorData);\n  const error = errorData.getError();\n\n  const { title, description } = nodeMeta || {};\n\n  const editService = useService<WorkflowEditService>(WorkflowEditService);\n\n  const handleDelete = () => {\n    editService.deleteNode(node);\n  };\n\n  const showDeleteButton = ![\n    StandardNodeType.Start,\n    StandardNodeType.End,\n  ].includes(node.flowNodeType as StandardNodeType);\n\n  return (\n    <div className={isNewNodeRender ? 'w-full p-12px' : 'h-[242px] w-[482px]'}>\n      <div\n        className={classNames(\n          'flex items-center space-x-2',\n          'absolute top-0 left-0',\n          'w-full h-[46px]',\n          'rounded-t-[7px]',\n          'px-4 py-3',\n          'bg-[--semi-color-danger-light-default]',\n        )}\n      >\n        <IconAlertFilled size=\"extra-large\" className=\"text-[#ff441e]\" />\n        <span className=\"text-[14px]\">{error?.message}</span>\n      </div>\n\n      <div\n        className={classNames(\n          'flex flex-col justify-center items-center space-y-[10px]',\n          'h-full',\n          'mt-[46px]',\n        )}\n      >\n        <NodeIcon nodeId={node.id} size={72} />\n        <Title heading={6}>{title}</Title>\n\n        <div className=\"max-w-[400px] max-h-[44px]\">\n          <Text type=\"quaternary\" ellipsis={{ showTooltip: true, rows: 2 }}>\n            {description}\n          </Text>\n        </div>\n        <div>\n          {!globalState.readonly && showDeleteButton ? (\n            <UIButton\n              type=\"tertiary\"\n              icon={<IconCozTrashCan />}\n              onClick={handleDelete}\n            >\n              {I18n.t('Delete')}\n            </UIButton>\n          ) : null}\n        </div>\n      </div>\n    </div>\n  );\n};\nexport const nodeSystemErrorRender = ({ context }: NodeErrorRenderProps) => (\n  <SystemError node={context.node} />\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport { SystemError } from '@/components/node-system-error-render';\n\nexport function Error() {\n  const node = useCurrentEntity();\n\n  return <SystemError node={node} />;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\n\nimport {\n  useCurrentEntity,\n  WorkflowNodePortsData,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  isSettingOnErrorDynamicPort,\n  SETTING_ON_ERROR_PORT,\n} from '@coze-workflow/nodes';\nimport { type StandardNodeType } from '@coze-workflow/base';\n\nimport { Port } from '../port';\n\n/**\n * abnormal port\n */\nexport function ExceptionPort() {\n  const node = useCurrentEntity();\n  const portsData = node.getData<WorkflowNodePortsData>(WorkflowNodePortsData);\n\n  useEffect(() => {\n    // Nodes for dynamic ports\n    if (isSettingOnErrorDynamicPort(node.flowNodeType as StandardNodeType)) {\n      portsData.updateDynamicPorts();\n      return;\n    }\n\n    // Node on static port\n    portsData.updateStaticPorts([\n      { type: 'input' },\n      { type: 'output', portID: 'default' },\n    ]);\n  }, [node, portsData]);\n\n  return <Port id={SETTING_ON_ERROR_PORT} type=\"output\" />;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  SettingOnErrorProcessType,\n  useIsSettingOnErrorV2,\n} from '@coze-workflow/nodes';\nimport { useWorkflowNode } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { Field } from '../field';\nimport { ExceptionPort } from './exception-port';\n\nexport function ExceptionField() {\n  const settingOnError = useWorkflowNode().data?.settingOnError;\n  const hasException =\n    settingOnError?.settingOnErrorIsOpen &&\n    settingOnError?.processType === SettingOnErrorProcessType.EXCEPTION;\n  const isSettingOnErrorV2 = useIsSettingOnErrorV2();\n\n  if (!hasException || !isSettingOnErrorV2) {\n    return null;\n  }\n\n  return (\n    <Field label={I18n.t('workflow_250407_201', undefined, '')}>\n      <div className=\"coz-fg-primary font-medium leading-4 text-md\">\n        {I18n.t('workflow_250407_202', undefined, '')}\n      </div>\n      <ExceptionPort />\n    </Field>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type FC } from 'react';\n\nimport classnames from 'classnames';\n\nimport { VariableTagList } from '../../fields/variable-tag-list';\nimport { type VariableMergeGroup } from './types';\n\ninterface VariableMergeItemProps {\n  mergeGroup: VariableMergeGroup;\n  index: number;\n}\n\n/**\n * variable merge\n */\nexport const VariableMergeItem: FC<VariableMergeItemProps> = ({\n  mergeGroup,\n  index,\n}) => {\n  const cls = index !== 0 ? 'mt-[6px]' : '';\n  return (\n    <>\n      <div\n        className={classnames(\n          'w-[69px] h-5 leading-5 truncate coz-fg-dim font-medium text-xs pr-0.5',\n          cls,\n        )}\n      >\n        {mergeGroup.name}\n      </div>\n      <div className={classnames('space-y-2', cls)}>\n        {mergeGroup.type ? <VariableTagList value={[mergeGroup]} /> : null}\n        <VariableTagList value={mergeGroup.variableTags} maxTagWidth={120} />\n      </div>\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { useWorkflowNode } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { VariableTagList } from '../../fields/variable-tag-list';\nimport { Field } from '../../fields';\nimport { useVariableAssignTags } from './use-variable-assign-tags';\n\nexport default function Inputs() {\n  const { inputParameters } = useWorkflowNode();\n  const variableTags = useVariableAssignTags(inputParameters);\n\n  const isEmpty = !variableTags || variableTags.length === 0;\n\n  return (\n    <Field\n      label={I18n.t('workflow_detail_node_parameter_input')}\n      isEmpty={isEmpty}\n    >\n      <VariableTagList value={variableTags} />\n    </Field>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isNil } from 'lodash-es';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\nimport {\n  type ValueExpression,\n  ValueExpressionType,\n} from '@coze-workflow/variable';\nimport { type InputValueVO, type RefExpression } from '@coze-workflow/base';\n\nimport { useAvailableNodeVariables } from '../../hooks/use-available-node-variables';\nimport { type VariableTagProps } from '../../fields/variable-tag-list';\n\nexport function useVariableAssignTags(\n  inputParameters: InputValueVO[] | Record<string, InputValueVO['input']> = [],\n): VariableTagProps[] {\n  const node = useCurrentEntity();\n  const variableService = useAvailableNodeVariables(node);\n\n  if (!Array.isArray(inputParameters)) {\n    return [];\n  }\n\n  const setVariableInputs = inputParameters as unknown as {\n    left: RefExpression;\n    right: ValueExpression;\n  }[];\n\n  return setVariableInputs\n    .map(({ left, right }) => {\n      const variableLeft = variableService.getWorkflowVariableByKeyPath(\n        left?.content?.keyPath,\n        { node, checkScope: true },\n      );\n\n      if (!variableLeft) {\n        return {\n          label: undefined,\n          invalid: true,\n          type: undefined,\n        };\n      }\n\n      const pathLabel = left?.content?.keyPath?.[1];\n      const viewType = left?.rawMeta?.type ?? variableLeft.viewType;\n      if (\n        right?.type === ValueExpressionType.LITERAL &&\n        isNil(right?.content)\n      ) {\n        return {\n          label: pathLabel,\n          invalid: true,\n          type: viewType,\n        };\n      }\n\n      if (right?.type === ValueExpressionType.REF) {\n        const variableRight = variableService.getWorkflowVariableByKeyPath(\n          right?.content?.keyPath,\n          { node, checkScope: true },\n        );\n\n        if (!variableRight) {\n          return {\n            label: pathLabel,\n            invalid: true,\n            type: viewType,\n          };\n        }\n      }\n\n      return {\n        label: variableLeft.viewMeta?.name ?? variableLeft.keyPath[1],\n        type: viewType,\n      };\n    })\n    .filter(Boolean) as VariableTagProps[];\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\n\nimport { uniqBy } from 'lodash-es';\nimport { useWorkflowNode } from '@coze-workflow/base';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport {\n  isSkillsEmpty,\n  getSkillsQueryParams,\n} from '@/nodes-v2/llm/skills/utils';\nimport { useQuerySettingDetail } from '@/nodes-v2/llm/skills/use-query-setting-detail';\nimport { type BoundSkills } from '@/nodes-v2/llm/skills/types';\nimport { useGlobalState, useDependencyService } from '@/hooks';\n\nimport { updateNodeSkills } from './update-node-skills';\nimport { type SkillTag } from './skill-tags';\n\nfunction getSkillTag(value?: { name?: string; icon_url?: string }): SkillTag {\n  return {\n    label: value?.name ?? '',\n    icon: value?.icon_url,\n  };\n}\n\nexport function useSkillTags(): SkillTag[] {\n  const { data } = useWorkflowNode();\n  const fcParam: BoundSkills = data?.fcParam || {};\n  const globalState = useGlobalState();\n  const node = useCurrentEntity();\n  const dependencyService = useDependencyService();\n\n  const { data: skillsDetail, refetch } = useQuerySettingDetail({\n    workflowId: globalState.workflowId,\n    spaceId: globalState.spaceId,\n    nodeId: node.id,\n    enabled: !isSkillsEmpty(fcParam),\n    ...getSkillsQueryParams(fcParam),\n  });\n\n  useEffect(() => {\n    const disposable = dependencyService.onDependencyChange(props => {\n      if (!props?.extra?.nodeIds?.includes(node.id)) {\n        return;\n      }\n      refetch();\n    });\n\n    return () => {\n      disposable?.dispose?.();\n    };\n  }, []);\n\n  const skills: SkillTag[] = [\n    uniqBy(\n      fcParam.pluginFCParam?.pluginList || [],\n      plugin => plugin.plugin_id,\n    ).map(item =>\n      getSkillTag(skillsDetail?.plugin_detail_map?.[item.plugin_id]),\n    ),\n    (fcParam.workflowFCParam?.workflowList || [])?.map(item =>\n      getSkillTag(skillsDetail?.workflow_detail_map?.[item.workflow_id]),\n    ),\n    (fcParam.knowledgeFCParam?.knowledgeList || [])?.map(item =>\n      getSkillTag(skillsDetail?.dataset_detail_map?.[item.id]),\n    ),\n  ].flat();\n\n  updateNodeSkills(node, fcParam, skillsDetail);\n\n  return skills;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { CozAvatar } from '@coze-arch/coze-design';\n\nimport { OverflowTagList } from '../../fields/overflow-tag-list';\n\nexport interface SkillTag {\n  icon?: string;\n  label?: string;\n}\n\nexport const SkillTags: React.FC<{ skillTags: SkillTag[] }> = ({\n  skillTags = [],\n}) => {\n  const renderTag = ({ icon, label }: SkillTag) => (\n    <div className=\"flex items-center leading-[20px]\">\n      {icon ? (\n        <CozAvatar\n          size={'mini'}\n          shape=\"square\"\n          src={icon}\n          className={'shrink-0 h-4 w-4 mr-1'}\n        />\n      ) : null}\n\n      <span className=\"truncate\">{label}</span>\n    </div>\n  );\n\n  return (\n    <OverflowTagList<SkillTag>\n      value={skillTags}\n      enableTooltip\n      tagItemRenderer={renderTag}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport { Field } from '../../fields/field';\nimport { useSkillTags } from './use-skill-tags';\nimport { SkillTags } from './skill-tags';\n\ninterface Props {\n  label?: string;\n}\n\nexport function Skill({ label = I18n.t('debug_skills') }: Props) {\n  const skillTags = useSkillTags();\n\n  const isEmpty = !skillTags || skillTags.length === 0;\n\n  return (\n    <Field label={label} isEmpty={isEmpty}>\n      <SkillTags skillTags={skillTags} />\n    </Field>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport {\n  type LLMNodeDataSkill,\n  WorkflowNodeData,\n  LLMNodeDataSkillType,\n  type LLMNodeDataWorkflowSkill,\n  type LLMNodeDataPluginSkill,\n  type LLMNodeDataDatasetSkill,\n} from '@coze-workflow/nodes';\nimport {\n  type GetLLMNodeFCSettingDetailResponse,\n  type StandardNodeType,\n} from '@coze-workflow/base';\n\nimport { type BoundSkills } from '@/nodes-v2/llm/skills/types';\n\n/**\n * Cache a skill name and icon data on the node\n * @param node\n * @param fcParam\n * @param skillsDetail\n * @returns\n */\nexport function updateNodeSkills(\n  node: WorkflowNodeEntity,\n  fcParam: BoundSkills,\n  skillsDetail: GetLLMNodeFCSettingDetailResponse | undefined,\n): void {\n  if (!skillsDetail) {\n    return;\n  }\n  const skills: LLMNodeDataSkill[] = [\n    (fcParam.pluginFCParam?.pluginList || []).map(item => {\n      const pluginDetail = skillsDetail?.plugin_detail_map?.[item.plugin_id];\n      const apiDetail = skillsDetail?.plugin_api_detail_map?.[item.api_id];\n      const skill: LLMNodeDataPluginSkill = {\n        type: LLMNodeDataSkillType.Plugin,\n        pluginId: item.plugin_id,\n        apiId: item.api_id,\n        apiName: apiDetail?.name,\n        pluginName: pluginDetail?.name,\n        icon: pluginDetail?.icon_url,\n      };\n      return skill;\n    }),\n    (fcParam.workflowFCParam?.workflowList || []).map(item => {\n      const detail = skillsDetail?.workflow_detail_map?.[item.workflow_id];\n      const skill: LLMNodeDataWorkflowSkill = {\n        type: LLMNodeDataSkillType.Workflow,\n        pluginId: item.plugin_id,\n        workflowId: item.workflow_id,\n        name: detail?.name,\n        icon: detail?.icon_url,\n      };\n      return skill;\n    }),\n    (fcParam.knowledgeFCParam?.knowledgeList || []).map(item => {\n      const detail = skillsDetail?.dataset_detail_map?.[item.id];\n      const skill: LLMNodeDataDatasetSkill = {\n        id: item.id,\n        type: LLMNodeDataSkillType.Dataset,\n        name: detail?.name,\n        icon: detail?.icon_url,\n      };\n      return skill;\n    }),\n  ].flat();\n\n  const nodeData = node.getData(WorkflowNodeData);\n  nodeData.updateNodeData<StandardNodeType.LLM>({\n    skills,\n  });\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InputParameters, Outputs, Knowledge } from '../../fields';\n\nexport function DatasetContent() {\n  return (\n    <>\n      <InputParameters />\n      <Outputs />\n      <Knowledge />\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Avatar } from '@coze-arch/coze-design';\n\ninterface Props {\n  src?: string;\n}\n\nexport function Icon({ src }: Props) {\n  return <Avatar className=\"w-[16px] h-[16px]\" shape=\"square\" src={src} />;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { get } from 'lodash-es';\nimport { useWorkflowNode } from '@coze-workflow/base';\nimport { I18n, type I18nKeysNoOptionsType } from '@coze-arch/i18n';\n\nimport { Field, OverflowTagList } from '../../fields';\nimport { Icon } from './icon';\nimport thumbnail7 from './assets/reference-7.png';\nimport thumbnail6 from './assets/reference-6.jpg';\nimport thumbnail5 from './assets/reference-5.jpg';\nimport thumbnail4 from './assets/reference-4.jpg';\nimport thumbnail3 from './assets/reference-3.jpg';\nimport thumbnail2 from './assets/reference-2.jpg';\nimport thumbnail1 from './assets/reference-1.jpg';\n\nconst thumbnails = [\n  thumbnail1,\n  thumbnail2,\n  thumbnail3,\n  thumbnail4,\n  thumbnail5,\n  thumbnail6,\n  thumbnail7,\n];\n\nexport function References() {\n  const { data } = useWorkflowNode();\n\n  const references = (\n    get(data, 'references') || get(data, 'inputs.references')\n  )?.filter(({ preprocessor }) => preprocessor !== undefined);\n\n  return (\n    <Field\n      contentClassName=\"flex gap-[6px]\"\n      label={I18n.t('Imageflow_reference_image')}\n      isEmpty={!references || references.length === 0}\n    >\n      <OverflowTagList\n        value={references?.map(({ preprocessor }) => ({\n          label: I18n.t(\n            `Imageflow_reference${preprocessor}` as I18nKeysNoOptionsType,\n          ),\n          icon: <Icon src={thumbnails[preprocessor - 1]} />,\n        }))}\n      />\n    </Field>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { get } from 'lodash-es';\nimport { useWorkflowNode } from '@coze-workflow/base';\nimport { I18n, type I18nKeysNoOptionsType } from '@coze-arch/i18n';\n\nimport { Field, OverflowTagList } from '../../fields';\nimport { Icon } from './icon';\nimport thumbnail8 from './assets/8.png';\nimport thumbnail7 from './assets/7.jpg';\nimport thumbnail6 from './assets/6.jpg';\nimport thumbnail5 from './assets/5.jpg';\nimport thumbnail4 from './assets/4.jpg';\nimport thumbnail3 from './assets/3.jpg';\nimport thumbnail2 from './assets/2.jpg';\nimport thumbnail1 from './assets/1.jpg';\n\nconst thumbnails = [\n  thumbnail1,\n  thumbnail2,\n  thumbnail3,\n  thumbnail4,\n  thumbnail5,\n  thumbnail6,\n  thumbnail7,\n  thumbnail8,\n];\n\nexport function Model() {\n  const { data } = useWorkflowNode();\n  // Component form field name supports point syntax. The new version generally starts from inputs. It needs to be compatible with the old version.\n  const model =\n    get(data, 'modelSetting.model') || get(data, 'inputs.modelSetting.model');\n\n  return (\n    <Field label={I18n.t('Imageflow_model')} isEmpty={!model}>\n      <OverflowTagList\n        value={[\n          {\n            label: I18n.t(`Imageflow_model${model}` as I18nKeysNoOptionsType),\n            icon: <Icon src={thumbnails[model - 1]} />,\n          },\n        ]}\n      />\n    </Field>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport { useCurrentDatabaseID, useCurrentDatabaseQuery } from '@/hooks';\nimport { useOpenDatabaseDetail } from '@/components/database-detail-modal';\n\nimport { Field, OverflowTagList } from '../../fields';\n\nexport function Database() {\n  const databaseID = useCurrentDatabaseID();\n  const { data: database } = useCurrentDatabaseQuery();\n  const { openDatabaseDetail } = useOpenDatabaseDetail();\n\n  const list = database\n    ? [\n        {\n          icon: (\n            <img\n              src={database.iconUrl}\n              className=\"w-[16px] h-[16px] rounded-mini\"\n            />\n          ),\n          // The operation and maintenance platform can directly display the ID, because the operation and maintenance platform cannot pull the actual database information.\n          label: IS_BOT_OP ? databaseID : database.tableName,\n        },\n      ]\n    : [];\n\n  return (\n    <Field\n      label={I18n.t('workflow_database_node_database_table_title')}\n      isEmpty={!database}\n    >\n      <div\n        className=\"inline-flex cursor-pointer\"\n        onClick={() => openDatabaseDetail()}\n      >\n        <OverflowTagList value={list} />\n      </div>\n    </Field>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Outputs, InputParameters } from '../../fields';\n\nexport function CommonContent() {\n  return (\n    <>\n      <InputParameters />\n      <Outputs />\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { StandardNodeType, useWorkflowNode } from '@coze-workflow/base';\n\nimport { VariableContent } from '@/node-registries/variable';\nimport { TriggerUpsertContent } from '@/node-registries/trigger-upsert';\nimport { TriggerReadContent } from '@/node-registries/trigger-read';\nimport { TriggerDeleteContent } from '@/node-registries/trigger-delete';\nimport { SubWorkflowContent as SubWorkflowContentV2 } from '@/node-registries/sub-workflow';\nimport { StartContent } from '@/node-registries/start';\nimport { SetVariableContent } from '@/node-registries/set-variable';\nimport { PluginContent } from '@/node-registries/plugin';\nimport { OutputContent } from '@/node-registries/output';\nimport { LtmContent } from '@/node-registries/ltm';\nimport { LoopContent } from '@/node-registries/loop';\nimport { JsonStringifyContent } from '@/node-registries/json-stringify';\nimport { IntentContent } from '@/node-registries/intent';\nimport { InputContent } from '@/node-registries/input';\nimport { ImageCanvasContent } from '@/node-registries/image-canvas';\nimport { IfContent } from '@/node-registries/if';\nimport { EndContent } from '@/node-registries/end';\nimport { ContinueContent } from '@/node-registries/continue';\nimport { CodeContent } from '@/node-registries/code';\nimport { BreakContent } from '@/node-registries/break';\nimport { BatchContent } from '@/node-registries/batch';\n\nimport { ExceptionField } from '../fields/exception-field';\nimport { VariableMergeContent } from './variable-merge-content';\nimport { VariableAssignContent } from './variable-assign-content';\nimport { QuestionContent } from './question-content';\nimport { LLMContent } from './llm-content';\nimport { DatasetContent } from './knowledge-content';\nimport { ImageGenerateContent } from './image-generate-content';\nimport { HttpContent } from './http-content';\nimport { DatabaseUpdateContent } from './database-update-content';\nimport { DatabaseQueryContent } from './database-query-content';\nimport { DatabaseDeleteContent } from './database-delete-content';\nimport { DatabaseCreateContent } from './database-create-content';\nimport { DatabaseContent } from './database-content';\nimport { CommonContent } from './common-content';\n\nimport styles from './index.module.less';\n\nconst ContentMap = {\n  [StandardNodeType.Start]: StartContent,\n  [StandardNodeType.End]: EndContent,\n  [StandardNodeType.If]: IfContent,\n  [StandardNodeType.Intent]: IntentContent,\n  [StandardNodeType.SubWorkflow]: SubWorkflowContentV2,\n  [StandardNodeType.Dataset]: DatasetContent,\n  [StandardNodeType.DatasetWrite]: DatasetContent,\n  [StandardNodeType.Question]: QuestionContent,\n  [StandardNodeType.Output]: OutputContent,\n  [StandardNodeType.LLM]: LLMContent,\n  [StandardNodeType.Loop]: LoopContent,\n  [StandardNodeType.Break]: BreakContent,\n  [StandardNodeType.Continue]: ContinueContent,\n  [StandardNodeType.SetVariable]: SetVariableContent,\n  [StandardNodeType.Batch]: BatchContent,\n  [StandardNodeType.ImageGenerate]: ImageGenerateContent,\n  [StandardNodeType.Input]: InputContent,\n  [StandardNodeType.Database]: DatabaseContent,\n  [StandardNodeType.VariableMerge]: VariableMergeContent,\n  [StandardNodeType.VariableAssign]: VariableAssignContent,\n  [StandardNodeType.Http]: HttpContent,\n  [StandardNodeType.DatabaseCreate]: DatabaseCreateContent,\n  [StandardNodeType.DatabaseDelete]: DatabaseDeleteContent,\n  [StandardNodeType.DatabaseUpdate]: DatabaseUpdateContent,\n  [StandardNodeType.DatabaseQuery]: DatabaseQueryContent,\n  [StandardNodeType.LTM]: LtmContent,\n  [StandardNodeType.Code]: CodeContent,\n  [StandardNodeType.TriggerUpsert]: TriggerUpsertContent,\n  [StandardNodeType.ImageCanvas]: ImageCanvasContent,\n  [StandardNodeType.TriggerDelete]: TriggerDeleteContent,\n  [StandardNodeType.TriggerRead]: TriggerReadContent,\n  [StandardNodeType.Api]: PluginContent,\n  [StandardNodeType.Variable]: VariableContent,\n  [StandardNodeType.JsonStringify]: JsonStringifyContent,\n};\n\n/**\n * Node content area\n */\nexport function Content() {\n  const { type } = useWorkflowNode();\n  const NodeContent = ContentMap[type] || CommonContent;\n\n  return (\n    <div className={styles.wrapper}>\n      <NodeContent />\n      <ExceptionField />\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InputParameters, Outputs, QuestionPairs } from '../../fields';\n\nexport function QuestionContent() {\n  return (\n    <>\n      <InputParameters />\n      <Outputs />\n      <QuestionPairs />\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InputParameters, Outputs, Model } from '../../fields';\nimport { Skill } from './skill';\n\nexport function LLMContent() {\n  return (\n    <>\n      <InputParameters />\n      <Outputs />\n      <Model />\n      <Skill />\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InputParameters, Outputs } from '../../fields';\nimport { References } from './references';\nimport { Model } from './model';\n\nexport function ImageGenerateContent() {\n  return (\n    <>\n      <InputParameters />\n      <Outputs />\n      <Model />\n      <References />\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Outputs, InputParameters } from '../../fields';\nimport { Database } from './database';\n\nexport function DatabaseContent() {\n  return (\n    <>\n      <InputParameters />\n      <Outputs />\n      <Database />\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { VariableMergeItem } from './variable-merge-item';\nimport { useVariableMergeVariableTags } from './use-variable-merge-variable-tags';\n\n/**\n * Merge variable node content\n */\nexport function VariableMergeContent() {\n  const mergeGroups = useVariableMergeVariableTags();\n\n  return (\n    <>\n      {mergeGroups.map((mergeGroup, index) => (\n        <VariableMergeItem\n          mergeGroup={mergeGroup}\n          key={mergeGroup.name}\n          index={index}\n        />\n      ))}\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type RefExpressionContent,\n  useWorkflowNode,\n  VARIABLE_TYPE_ALIAS_MAP,\n  ValueExpression,\n} from '@coze-workflow/base';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport { isOutputVariable } from '@/nodes-v2/variable-merge/utils/is-output-variable';\nimport { type VariableMergeFormData } from '@/nodes-v2/variable-merge/types';\nimport { useExecStateEntity } from '@/hooks';\n\nimport { useAvailableNodeVariables } from '../../hooks/use-available-node-variables';\nimport { VariableTagStatus } from '../../fields/variable-tag-list';\nimport { VARIABLE_TYPE_ICON_MAP } from '../../fields/constants';\nimport { type VariableMergeGroup } from './types';\n\n/**\n * Get a list of variable labels for the merged variable\n * @returns\n */\nexport function useVariableMergeVariableTags(): VariableMergeGroup[] {\n  const node = useCurrentEntity();\n  const variableService = useAvailableNodeVariables(node);\n  const { data } = useWorkflowNode() as { data: VariableMergeFormData };\n  const execEntity = useExecStateEntity();\n  const executeNodeResult = execEntity.getNodeExecResult(node.id);\n\n  const mergeGroups = (data?.inputs?.mergeGroups || []).map(\n    (mergeGroup, groupIndex) => {\n      const variables = mergeGroup?.variables || [];\n\n      const variableTags = variables\n        .map((v, index) => {\n          const variable = variableService.getWorkflowVariableByKeyPath(\n            (v?.content as RefExpressionContent)?.keyPath,\n            { node },\n          );\n\n          const isLiteral = ValueExpression.isLiteral(v);\n          // Verify whether the variable is valid\n          const invalid =\n            !isLiteral &&\n            !variableService.getWorkflowVariableByKeyPath(\n              (v?.content as RefExpressionContent)?.keyPath,\n              { node, checkScope: true },\n            );\n\n          // Is it the output variable of the run?\n          const isOutput = isOutputVariable(\n            groupIndex,\n            index,\n            executeNodeResult,\n          );\n          let label = '';\n          if (isLiteral) {\n            label = String(v?.content ?? '');\n          } else {\n            label = variable?.viewMeta?.name ?? '';\n          }\n          return {\n            type: v?.rawMeta?.type ?? variable?.viewType,\n            label,\n            invalid,\n            status: isOutput ? VariableTagStatus.Success : undefined,\n          };\n        })\n        .filter(v => v.type && VARIABLE_TYPE_ICON_MAP[v.type]);\n\n      // Type Take the type of the first variable\n      const type = variableTags[0]?.type;\n      const label = type ? VARIABLE_TYPE_ALIAS_MAP[type] : '';\n\n      return {\n        name: mergeGroup.name,\n        label: label || '-',\n        type,\n        variableTags,\n      };\n    },\n  );\n\n  return mergeGroups;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { PublicScopeProvider } from '@coze-workflow/variable';\n\nimport { Outputs } from '../../fields';\nimport Inputs from './inputs';\n\nexport function VariableAssignContent() {\n  return (\n    <>\n      <PublicScopeProvider>\n        <Inputs />\n      </PublicScopeProvider>\n\n      <Outputs />\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Outputs, HttpApiField } from '../../fields';\n\nexport function HttpContent() {\n  return (\n    <>\n      <HttpApiField />\n      <Outputs />\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport { createSelectAndSetFieldsFieldName } from '@/constants/database-field-names';\n\nimport { Database } from '../database-content/database';\nimport { Outputs, DatabaseSettingFields } from '../../fields';\n\nexport function DatabaseCreateContent() {\n  return (\n    <>\n      <Outputs />\n      <Database />\n      <DatabaseSettingFields\n        label={I18n.t('workflow_setting_fields')}\n        name={createSelectAndSetFieldsFieldName}\n      />\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport { deleteConditionFieldName } from '@/constants/database-field-names';\n\nimport { Database } from '../database-content/database';\nimport { Outputs, DatabaseCondition } from '../../fields';\n\nexport function DatabaseDeleteContent() {\n  return (\n    <>\n      <Outputs />\n      <Database />\n      <DatabaseCondition\n        label={I18n.t('workflow_delete_conditon_title')}\n        name={deleteConditionFieldName}\n      />\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport {\n  updateConditionFieldName,\n  updateSelectAndSetFieldsFieldName,\n} from '@/constants/database-field-names';\n\nimport { Database } from '../database-content/database';\nimport { DatabaseCondition } from '../../fields/database-condition';\nimport { Outputs, DatabaseSettingFields } from '../../fields';\n\nexport function DatabaseUpdateContent() {\n  return (\n    <>\n      <Outputs />\n      <Database />\n      <DatabaseCondition\n        label={I18n.t('workflow_update_condition_title')}\n        name={updateConditionFieldName}\n      />\n      <DatabaseSettingFields\n        label={I18n.t('workflow_update_fields')}\n        name={updateSelectAndSetFieldsFieldName}\n      />\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport { queryConditionFieldName } from '@/constants/database-field-names';\n\nimport { Database } from '../database-content/database';\nimport { Outputs, DatabaseCondition } from '../../fields';\n\nexport function DatabaseQueryContent() {\n  return (\n    <>\n      <Outputs />\n      <Database />\n      <DatabaseCondition\n        label={I18n.t('workflow_query_condition_title')}\n        name={queryConditionFieldName}\n      />\n    </>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport cx from 'classnames';\nimport { useWorkflowNode } from '@coze-workflow/base';\nimport { ErrorBoundary, logger } from '@coze-arch/logger';\nimport {\n  useNodeRender,\n  type WorkflowNodeRenderProps,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { useNodeSideSheetStore } from '@/hooks/use-node-side-sheet-store';\nimport { useFloatLayoutService } from '@/hooks/use-float-layout-service';\nimport { useGlobalState, useTestFormState } from '@/hooks';\nimport { WorkflowExecStatus } from '@/entities';\nimport { LayoutPanelKey } from '@/constants';\n\nimport { ExecuteStatusBarV2 } from '../../test-run/execute-status-bar-v2';\nimport { Wrapper } from './wrapper';\nimport { Ports } from './ports';\nimport { Placeholder } from './placeholder';\nimport { Header } from './header';\nimport { Error } from './error';\nimport { Content } from './content';\n\nimport styles from './index.module.less';\n\nexport function NodeRenderNew(props: WorkflowNodeRenderProps) {\n  const { node } = props;\n  const globalState = useGlobalState(false);\n  const testFormState = useTestFormState();\n  const { selected, selectNode } = useNodeRender();\n  const { isError, isInitialized } = useWorkflowNode();\n  const openNodeSideSheet = useNodeSideSheetStore(\n    state => state.openNodeSideSheet,\n  );\n  const floatLayoutService = useFloatLayoutService();\n\n  const handleNodeClick = e => {\n    selectNode(e);\n    // The process in progress prohibits switching panels\n    if (globalState.viewStatus !== WorkflowExecStatus.EXECUTING && !isError) {\n      testFormState.closeCommonSheet();\n      openNodeSideSheet();\n      floatLayoutService.open(LayoutPanelKey.NodeForm, 'right', { node });\n    }\n  };\n\n  return (\n    <ErrorBoundary\n      FallbackComponent={() => <Error />}\n      errorBoundaryName=\"workflow-node-render\"\n      logger={logger}\n    >\n      <Wrapper\n        className={cx(styles['node-render'], {\n          [styles.selected]: selected,\n        })}\n        onClick={handleNodeClick}\n      >\n        {isError ? <Error /> : null}\n\n        {!isError && !isInitialized ? <Placeholder /> : null}\n\n        {!isError && isInitialized ? (\n          <>\n            <ExecuteStatusBarV2 node={node} />\n\n            <Header />\n\n            <Content />\n          </>\n        ) : null}\n\n        <Ports />\n      </Wrapper>\n    </ErrorBoundary>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type WorkflowNodeRenderProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { NodeContextProvider } from '../node-context-provider';\nimport { NodeRenderNew } from './node-render-new';\n\nexport function NodeRender(props: WorkflowNodeRenderProps) {\n  const { node } = props;\n\n  return (\n    <NodeContextProvider node={node} scene=\"new-node-render\">\n      <NodeRenderNew {...props} />\n    </NodeContextProvider>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line @coze-arch/no-pkg-dir-import\nimport { IconFactory } from '@coze-arch/bot-icons/src/factory';\n\nimport { ReactComponent as SvgLineError } from './line-error.svg';\nimport { ReactComponent as SvgLineErrorCaseI18n } from './line-error-case-i18n.svg';\nimport { ReactComponent as SvgLineErrorCaseCn } from './line-error-case-cn.svg';\n\nexport const IconLineErrorCaseI18n: ReturnType<typeof IconFactory> =\n  IconFactory(<SvgLineErrorCaseI18n />);\n\nexport const IconLineErrorCaseCn: ReturnType<typeof IconFactory> = IconFactory(\n  <SvgLineErrorCaseCn />,\n);\n\nexport const IconLineError: ReturnType<typeof IconFactory> = IconFactory(\n  <SvgLineError />,\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { Typography } from '@coze-arch/bot-semi';\nimport { I18n } from '@coze-arch/i18n';\n\nconst { Title } = Typography;\n\nimport { IconLineErrorCaseI18n, IconLineErrorCaseCn } from './svg';\n\nexport const LineErrorTip = () => {\n  const lang = I18n.getLanguages();\n  const currentLang = lang[0];\n\n  const renderIcon = () => {\n    if (currentLang === 'zh-CN' || currentLang === 'zh') {\n      return <IconLineErrorCaseCn />;\n    }\n    return <IconLineErrorCaseI18n />;\n  };\n\n  return (\n    <div className=\"w-[420px]\">\n      <Title heading={6}>{I18n.t('workflow_running_results_line_error')}</Title>\n      <div className=\"flex mt-2\">{renderIcon()}</div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport classNames from 'classnames';\nimport { Popover } from '@coze-arch/bot-semi';\nimport { type IPoint } from '@flowgram-adapter/common';\n\nimport { LineErrorTip } from './line-error-tip';\n\nconst PADDING = 12;\n\nexport const LinePopover = (props: Record<string, any>) => {\n  const { className, line, isHovered, ...other } = props;\n\n  const { hasError, bezier, position } = line;\n\n  const { bbox } = bezier;\n  // relative position\n  const toRelative = (p: IPoint) => ({\n    x: p.x - bbox.x + PADDING,\n    y: p.y - bbox.y + PADDING,\n  });\n  const fromPos = toRelative(position.from);\n  const toPos = toRelative(position.to);\n\n  const left = bbox.x + Math.abs((toPos.x - fromPos.x) / 2);\n  const top = bbox.y + Math.abs((toPos.y - fromPos.y) / 2);\n\n  return (\n    <Popover\n      className={classNames('p-4', className)}\n      showArrow\n      content={() => <LineErrorTip />}\n      visible={isHovered && hasError}\n      {...other}\n    >\n      {/* Tooltip anchor point, you need to calculate the center position of the line */}\n      <div\n        style={{\n          left,\n          top,\n          position: 'absolute',\n        }}\n      ></div>\n    </Popover>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/require-await -- async to avoid block slate render */\nimport type { KeyboardEventHandler, ClipboardEvent } from 'react';\n\nimport { ReactEditor, withReact } from 'slate-react';\nimport { withHistory } from 'slate-history';\nimport {\n  type BaseEditor,\n  type Descendant,\n  createEditor,\n  Range,\n  Transforms,\n  Editor,\n  Element as SlateElement,\n  Node as SlateNode,\n  Path as SlatePath,\n} from 'slate';\nimport EventEmitter from 'eventemitter3';\n\nimport type {\n  CommentEditorEventDisposer,\n  CommentEditorEventParams,\n  CommentEditorBlock,\n  CommentEditorFormat,\n  CommentEditorElement,\n  CommentEditorNode,\n  CommentEditorCommand,\n} from './type';\nimport { CommentEditorParser } from './parsers';\nimport {\n  CommentEditorBlockFormat,\n  CommentEditorEvent,\n  CommentEditorLeafFormat,\n  CommentEditorListBlockFormat,\n  CommentEditorDefaultValue,\n  CommentEditorDefaultBlocks,\n} from './constant';\n\nexport class CommentEditorModel {\n  public readonly editor: BaseEditor & ReactEditor;\n  private innerValue: string;\n  private innerBlocks: CommentEditorBlock[];\n  private emitter: EventEmitter;\n  private commands: CommentEditorCommand[];\n\n  constructor() {\n    this.commands = [];\n    this.emitter = new EventEmitter();\n    this.editor = this.createEditor();\n    this.innerValue = CommentEditorDefaultValue;\n    this.innerBlocks = CommentEditorDefaultBlocks as CommentEditorBlock[];\n  }\n\n  /** Get the current value */\n  public get value(): string {\n    return this.innerValue;\n  }\n\n  /** External setting model values */\n  public setValue(newValue?: string): void {\n    const value = newValue ?? CommentEditorDefaultValue;\n    if (value === this.innerValue) {\n      return;\n    }\n    const blocks = this.deserialize(value);\n    if (!blocks) {\n      return;\n    }\n    this.innerValue = value;\n    this.innerBlocks = blocks;\n    this.syncEditorValue();\n    this.emitter.emit(CommentEditorEvent.Change, {\n      blocks: this.innerBlocks,\n      value: this.innerValue,\n    });\n  }\n\n  /** Get all blocks */\n  public get blocks(): CommentEditorBlock[] {\n    return this.innerBlocks;\n  }\n\n  /** Get editor DOM node */\n  public get element(): HTMLDivElement | null {\n    try {\n      return ReactEditor.toDOMNode(this.editor, this.editor) as HTMLDivElement;\n      // eslint-disable-next-line @coze-arch/use-error-in-catch -- no need\n    } catch (error) {\n      return null;\n    }\n  }\n\n  /** Register command */\n  public registerCommand(command: CommentEditorCommand): this {\n    this.commands.push(command);\n    return this;\n  }\n\n  /** keyboard event */\n  public keydown(\n    event: Parameters<KeyboardEventHandler<HTMLDivElement>>[0],\n  ): void {\n    const { ctrlKey, metaKey, shiftKey, key } = event;\n    // Use ctrlKey or metaKey as a unified modifier key check\n    const modifierKey = ctrlKey || metaKey;\n    // Iterate through all registered commands\n    const matchedCommands = this.commands\n      .filter(command => command.key === key)\n      .filter(\n        command =>\n          command.modifier === undefined || command.modifier === modifierKey,\n      )\n      .filter(\n        command => command.shift === undefined || command.shift === shiftKey,\n      );\n\n    matchedCommands.forEach(command => {\n      command.exec({\n        model: this,\n        event,\n      });\n    });\n  }\n\n  /** paste event */\n  public paste(event: ClipboardEvent<HTMLDivElement>): void {\n    const fragment = event.clipboardData.getData(\n      'application/x-slate-fragment',\n    );\n    const decoded = decodeURIComponent(window.atob(fragment));\n    if (!decoded) {\n      return;\n    }\n    const parsed = JSON.parse(decoded) as CommentEditorBlock[];\n    if (!parsed || !Array.isArray(parsed) || parsed.length === 0) {\n      return;\n    }\n    if (this.isBlockMarked(CommentEditorBlockFormat.ListItem)) {\n      // Clear list format to prevent nesting of lists under paste scenes\n      this.markBlock(CommentEditorBlockFormat.Paragraph);\n    }\n  }\n\n  /** Register an event */\n  public on<T extends CommentEditorEvent>(\n    event: T,\n    callback: (params: CommentEditorEventParams<T>) => void,\n  ): CommentEditorEventDisposer {\n    this.emitter.on(event, callback);\n    return () => {\n      this.emitter.off(event, callback);\n    };\n  }\n\n  /** Editor Focus/Out of Focus */\n  public setFocus(focused: boolean): void {\n    if (focused && !this.focused) {\n      ReactEditor.focus(this.editor);\n    } else if (!focused && this.focused) {\n      ReactEditor.blur(this.editor);\n      ReactEditor.deselect(this.editor);\n      this.emitter.emit(CommentEditorEvent.Blur, {});\n    }\n  }\n\n  /** Select end */\n  public selectEnd(): void {\n    // Get all nodes in the editor\n    const nodes = Array.from(\n      Editor.nodes(this.editor, {\n        at: [],\n        match: n => Editor.isBlock(this.editor, n as SlateElement),\n      }),\n    );\n\n    // If there is no node, return directly\n    if (nodes.length === 0) {\n      return;\n    }\n\n    // Get the path to the last block-level node\n    const lastNodeEntry = nodes[nodes.length - 1];\n    const lastPath = lastNodeEntry[1];\n\n    // Get the end point of the last node\n    const endPoint = Editor.end(this.editor, lastPath);\n\n    // Create a new range, starting and ending at the end of the last node\n    const range: Range = {\n      anchor: endPoint,\n      focus: endPoint,\n    };\n\n    // Set the selection to the newly created range\n    Transforms.select(this.editor, range);\n  }\n\n  /** Get focus status */\n  public get focused(): boolean {\n    return ReactEditor.isFocused(this.editor);\n  }\n\n  /** data change event */\n  public async fireChange(): Promise<void> {\n    const isAstChange = this.editor.operations.some(\n      op => 'set_selection' !== op.type,\n    );\n    if (isAstChange) {\n      this.change();\n    }\n    const { selection } = this.editor;\n    if (selection) {\n      if (Range.isCollapsed(selection)) {\n        this.select();\n      } else {\n        this.multiSelect();\n      }\n    }\n  }\n\n  /** tag block */\n  public markBlock(format: CommentEditorBlockFormat): void {\n    const isMarked = this.isBlockMarked(format);\n    const isListBlock = CommentEditorListBlockFormat.includes(format);\n    // Empty parent existing blocks\n    Transforms.unwrapNodes<CommentEditorNode>(this.editor, {\n      match: n =>\n        !Editor.isEditor(n) &&\n        SlateElement.isElement(n) &&\n        CommentEditorListBlockFormat.includes(\n          (n as unknown as CommentEditorBlock).type,\n        ),\n      split: true,\n    });\n    const getBlockType = () => {\n      if (isMarked) {\n        // Reset to paragraph\n        return CommentEditorBlockFormat.Paragraph;\n      }\n      if (isListBlock) {\n        // List block is reset to list item\n        return CommentEditorBlockFormat.ListItem;\n      }\n      return format;\n    };\n    const properties: Partial<CommentEditorBlock> = {\n      type: getBlockType(),\n    };\n    Transforms.setNodes<CommentEditorNode>(\n      this.editor,\n      properties as CommentEditorNode,\n    );\n    if (isMarked) {\n      return;\n    }\n    if (isListBlock) {\n      const block = { type: format, children: [] };\n      Transforms.wrapNodes<CommentEditorNode>(\n        this.editor,\n        block as CommentEditorElement,\n      );\n      return;\n    }\n  }\n\n  /** Is the block marked? */\n  public isBlockMarked(format: CommentEditorBlockFormat): boolean {\n    const { selection } = this.editor;\n    if (!selection) {\n      return false;\n    }\n\n    const [match] = Array.from(\n      Editor.nodes(this.editor, {\n        at: Editor.unhangRange(this.editor, selection),\n        match: n =>\n          !Editor.isEditor(n) &&\n          SlateElement.isElement(n) &&\n          (n as unknown as CommentEditorBlock).type === format,\n      }),\n    );\n    return !!match;\n  }\n\n  /** Mark leaves */\n  public markLeaf(\n    format: CommentEditorLeafFormat,\n    value: boolean | string = true,\n  ): void {\n    const isMarked = this.isLeafMarked(format);\n    if (isMarked) {\n      Editor.removeMark(this.editor, format);\n    } else {\n      Editor.addMark(this.editor, format, value);\n    }\n  }\n\n  /** Are the leaves marked? */\n  public isLeafMarked(format: CommentEditorFormat): boolean {\n    const marks = Editor.marks(this.editor);\n    return !!marks && !!marks[format];\n  }\n\n  /** Get leaf value */\n  public getLeafValue(\n    format: CommentEditorFormat,\n  ): boolean | string | undefined {\n    const marks = Editor.marks(this.editor);\n    return marks?.[format];\n  }\n\n  /** Set leaf value */\n  public setLeafValue(\n    format: CommentEditorFormat,\n    value: boolean | string = true,\n  ): void {\n    Editor.addMark(this.editor, format, value);\n  }\n\n  /** Clear all formatting of the current block */\n  public clearFormat(): void {\n    Object.values(CommentEditorLeafFormat).forEach(format => {\n      Editor.removeMark(this.editor, format);\n    });\n    this.markBlock(CommentEditorBlockFormat.Paragraph);\n  }\n\n  /** Get block text */\n  public getBlockText(): {\n    text: string;\n    before: string;\n    after: string;\n  } {\n    const { selection } = this.editor;\n    const emptyResult = { text: '', before: '', after: '' };\n\n    // If no cursor exists, return an empty result\n    if (!selection?.anchor) {\n      return emptyResult;\n    }\n\n    // Get the current block-level element\n    const entry = Editor.above(this.editor, {\n      match: (n): boolean =>\n        SlateElement.isElement(n) && Editor.isBlock(this.editor, n),\n    });\n\n    // If no block-level elements are found, an empty result is returned\n    if (!entry) {\n      return emptyResult;\n    }\n\n    const [block, path] = entry;\n\n    // Make sure the block is an Element type\n    if (!SlateElement.isElement(block)) {\n      return emptyResult;\n    }\n\n    // Get the full text\n    const text = SlateNode.string(block);\n\n    // Create a range from the beginning of the block to the current cursor position\n    const beforeRange = {\n      anchor: Editor.start(this.editor, path),\n      focus: selection.anchor,\n    };\n\n    // Get the text in front of the cursor\n    const before = Editor.string(this.editor, beforeRange);\n\n    // Calculate the text after the cursor\n    const after = text.slice(before.length);\n\n    return { text, before, after };\n  }\n\n  /** Create editor */\n  private createEditor(): ReactEditor {\n    return this.withInsertBreak(withReact(withHistory(createEditor())));\n  }\n\n  /** Whether to initialize */\n  private get initialized(): boolean {\n    return (\n      Array.isArray(this.editor.children) && this.editor.children.length > 0\n    );\n  }\n\n  /**\n   * Synchronize editor instance content\n   * > ** NOTICE: ** * To ensure that performance is not affected, it should only be called when an external value change causes the editor value to be inconsistent with the model value.\n   */\n  private syncEditorValue(): void {\n    if (!this.initialized) {\n      // Slate DOM is not created when not initialized, no active synchronization is required, otherwise Slate will report an error and cannot find the DOM.\n      return;\n    }\n    try {\n      Editor.withoutNormalizing(this.editor, () => {\n        // Delete all existing content\n        Transforms.delete(this.editor, {\n          at: {\n            anchor: Editor.start(this.editor, []),\n            focus: Editor.end(this.editor, []),\n          },\n        });\n        // Make sure the selection is at the beginning of the document\n        Transforms.select(this.editor, Editor.start(this.editor, []));\n        // Insert a new blank document\n        // Set the children of the editor directly\n        this.editor.children = this.blocks as unknown as Descendant[];\n      });\n    } catch (error) {\n      // There may be DOM handling errors inside Slate, which will not affect external use\n      console.error('@CommentEditorModel::SyncEditorValue::Error', error);\n    }\n  }\n\n  /** Insert newline */\n  private withInsertBreak(editor: ReactEditor): ReactEditor {\n    const { insertBreak } = editor;\n\n    editor.insertBreak = () => {\n      const { selection } = editor;\n\n      // If there is no selection or the selection is not collapsed, perform the default line wrapping operation\n      if (!selection || !Range.isCollapsed(selection)) {\n        insertBreak();\n        return;\n      }\n\n      const result = Editor.above(editor, {\n        match: n => SlateElement.isElement(n) && Editor.isBlock(editor, n),\n      });\n\n      const { after } = this.getBlockText();\n\n      // If no block is found or not at the end of the line, perform the default line break\n      if (!result || after !== '') {\n        insertBreak();\n        return;\n      }\n\n      const [node, path] = result;\n      const blockType = (node as unknown as CommentEditorBlock).type;\n\n      // Execute the original line feed\n      insertBreak();\n\n      // Get the path to the newly inserted block\n      const newPath = SlatePath.next(path);\n\n      // Clear formatting only if it is not a list or a reference\n      const shouldClearFormat = ![\n        CommentEditorBlockFormat.NumberedList,\n        CommentEditorBlockFormat.BulletedList,\n        CommentEditorBlockFormat.ListItem,\n        CommentEditorBlockFormat.Blockquote,\n      ].includes(blockType as CommentEditorBlockFormat);\n\n      if (shouldClearFormat) {\n        this.clearFormatAtPath(newPath);\n      }\n\n      // Make sure the cursor is at the beginning of a new line\n      Transforms.select(editor, Editor.start(editor, newPath));\n    };\n\n    return editor;\n  }\n\n  /** Clears the block-level and internal connection formats of the specified path */\n  private clearFormatAtPath(path: SlatePath): void {\n    // Select the entire block of the specified path\n    Transforms.select(this.editor, path);\n\n    // Use the existing clearFormat method to clear the format\n    this.clearFormat();\n  }\n\n  /** data change event */\n  private change(): void {\n    this.innerBlocks = this.editor.children as unknown as CommentEditorBlock[];\n    const value = this.serialize(this.innerBlocks);\n    if (!value) {\n      return;\n    }\n    this.innerValue = value;\n    this.emitter.emit(CommentEditorEvent.Change, {\n      blocks: this.innerBlocks,\n      value: this.innerValue,\n    });\n  }\n\n  /** radio event */\n  private select(): void {\n    const { selection } = this.editor;\n    if (!selection) {\n      return;\n    }\n    const text = Editor.string(this.editor, selection);\n    if (text !== '') {\n      return;\n    }\n    this.emitter.emit(CommentEditorEvent.Select, {});\n  }\n\n  /** multiple choice event */\n  private multiSelect(): void {\n    const { selection } = this.editor;\n    if (!selection) {\n      return;\n    }\n    const text = Editor.string(this.editor, selection);\n    if (text === '') {\n      return;\n    }\n    this.emitter.emit(CommentEditorEvent.MultiSelect, {});\n  }\n\n  /** Serialization */\n  private serialize(blocks: CommentEditorBlock[]): string | undefined {\n    return CommentEditorParser.toJSON(blocks);\n  }\n\n  /** deserialization */\n  private deserialize(value?: string): CommentEditorBlock[] | undefined {\n    return CommentEditorParser.fromJSON(value);\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Editor, Transforms } from 'slate';\n\nimport type { CommentEditorCommand } from '../type';\n\nexport const selectAllCommand: CommentEditorCommand = {\n  key: 'a',\n  modifier: true,\n  exec: ({ model, event }) => {\n    event.preventDefault();\n    Transforms.select(model.editor, {\n      anchor: Editor.start(model.editor, []),\n      focus: Editor.end(model.editor, []),\n    });\n  },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CommentEditorCommand } from '../type';\nimport { CommentEditorLeafFormat } from '../constant';\n\nexport const boldCommand: CommentEditorCommand = {\n  key: 'b',\n  modifier: true,\n  exec: ({ model, event }) => {\n    event.preventDefault();\n    model.markLeaf(CommentEditorLeafFormat.Bold);\n  },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CommentEditorCommand } from '../type';\nimport { CommentEditorLeafFormat } from '../constant';\n\nexport const italicCommand: CommentEditorCommand = {\n  key: 'i',\n  modifier: true,\n  exec: ({ model, event }) => {\n    event.preventDefault();\n    model.markLeaf(CommentEditorLeafFormat.Italic);\n  },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CommentEditorCommand } from '../type';\nimport { CommentEditorLeafFormat } from '../constant';\n\nexport const underlineCommand: CommentEditorCommand = {\n  key: 'u',\n  modifier: true,\n  exec: ({ model, event }) => {\n    event.preventDefault();\n    model.markLeaf(CommentEditorLeafFormat.Underline);\n  },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CommentEditorCommand } from '../type';\nimport { CommentEditorLeafFormat } from '../constant';\n\nexport const strikethroughCommand: CommentEditorCommand = {\n  key: 's',\n  modifier: true,\n  exec: ({ model, event }) => {\n    event.preventDefault();\n    model.markLeaf(CommentEditorLeafFormat.Strikethrough);\n  },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CommentEditorCommand } from '../type';\nimport { CommentEditorBlockFormat } from '../constant';\n\nexport const paragraphCommand: CommentEditorCommand = {\n  key: 'o',\n  modifier: true,\n  exec: ({ model, event }) => {\n    event.preventDefault();\n    model.markBlock(CommentEditorBlockFormat.Paragraph);\n  },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CommentEditorCommand } from '../type';\nimport { CommentEditorBlockFormat } from '../constant';\n\nexport const headingOneCommand: CommentEditorCommand = {\n  key: '1',\n  modifier: true,\n  exec: ({ model, event }) => {\n    event.preventDefault();\n    model.markBlock(CommentEditorBlockFormat.HeadingOne);\n  },\n};\n\nexport const headingTwoCommand: CommentEditorCommand = {\n  key: '2',\n  modifier: true,\n  exec: ({ model, event }) => {\n    event.preventDefault();\n    model.markBlock(CommentEditorBlockFormat.HeadingTwo);\n  },\n};\n\nexport const headingThreeCommand: CommentEditorCommand = {\n  key: '3',\n  modifier: true,\n  exec: ({ model, event }) => {\n    event.preventDefault();\n    model.markBlock(CommentEditorBlockFormat.HeadingThree);\n  },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CommentEditorCommand } from '../type';\nimport { CommentEditorBlockFormat } from '../constant';\n\nexport const clearFormatEnterCommand: CommentEditorCommand = {\n  key: 'Enter',\n  shift: false,\n  exec: ({ model, event }) => {\n    // Check if pinyin is being entered.\n    if (event.nativeEvent.isComposing) {\n      return;\n    }\n\n    const isEmptyBlock = !model.getBlockText().text;\n    const hasBlockFormat = !model.isBlockMarked(\n      CommentEditorBlockFormat.Paragraph,\n    );\n\n    if (!isEmptyBlock || !hasBlockFormat) {\n      return;\n    }\n\n    event.preventDefault();\n    model.clearFormat();\n  },\n};\n\nexport const clearFormatBackspaceCommand: CommentEditorCommand = {\n  key: 'Backspace',\n  shift: false,\n  exec: ({ model, event }) => {\n    const isAtBlockStart = !model.getBlockText().before;\n    const hasBlockFormat = !model.isBlockMarked(\n      CommentEditorBlockFormat.Paragraph,\n    );\n\n    if (!isAtBlockStart || !hasBlockFormat) {\n      return;\n    }\n\n    event.preventDefault();\n    model.clearFormat();\n  },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Editor } from 'slate';\n\nimport type { CommentEditorCommand } from '../type';\nimport type { CommentEditorModel } from '../model';\nimport { CommentEditorBlockFormat } from '../constant';\n\n// Define the block prefix pattern and corresponding format\nconst blockPrefixConfig: Array<[RegExp, CommentEditorBlockFormat]> = [\n  [/^#$/, CommentEditorBlockFormat.HeadingOne],\n  [/^##$/, CommentEditorBlockFormat.HeadingTwo],\n  [/^###$/, CommentEditorBlockFormat.HeadingThree],\n  [/^>$/, CommentEditorBlockFormat.Blockquote],\n  [/^-$/, CommentEditorBlockFormat.BulletedList],\n  [/^\\*$/, CommentEditorBlockFormat.BulletedList],\n  [/^1\\.$/, CommentEditorBlockFormat.NumberedList],\n];\n\n// Function to delete text\nconst deleteText = (model: CommentEditorModel, text: string): void => {\n  Array.from(text).forEach(() => {\n    Editor.deleteBackward(model.editor, { unit: 'character' });\n  });\n};\n\n// Functions that handle block prefixes\nconst handleBlockPrefix = (\n  model: CommentEditorModel,\n  text: string,\n): boolean => {\n  const matchedConfig = blockPrefixConfig.find(([pattern]) =>\n    pattern.test(text),\n  );\n\n  if (matchedConfig) {\n    const [, format] = matchedConfig;\n    deleteText(model, text);\n    model.markBlock(format);\n    return true;\n  }\n\n  return false;\n};\n\nexport const blockPrefixCommand: CommentEditorCommand = {\n  key: ' ',\n  exec: ({ model, event }) => {\n    // Check if pinyin is being entered.\n    if (event.nativeEvent.isComposing) {\n      return;\n    }\n\n    const { before: beforeText } = model.getBlockText();\n    if (!beforeText) {\n      return;\n    }\n\n    if (handleBlockPrefix(model, beforeText)) {\n      event.preventDefault();\n    }\n  },\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useMemo } from 'react';\n\nimport { type FormModelV2 } from '@flowgram-adapter/free-layout-editor';\nimport { FlowNodeFormData } from '@flowgram-adapter/free-layout-editor';\nimport { useEntityFromContext } from '@flowgram-adapter/free-layout-editor';\nimport {\n  useNodeRender,\n  type WorkflowNodeEntity,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { CommentEditorModel } from '../model';\nimport { CommentEditorFormField } from '../constant';\nimport {\n  boldCommand,\n  headingOneCommand,\n  headingThreeCommand,\n  headingTwoCommand,\n  italicCommand,\n  paragraphCommand,\n  selectAllCommand,\n  strikethroughCommand,\n  underlineCommand,\n  clearFormatBackspaceCommand,\n  clearFormatEnterCommand,\n  blockPrefixCommand,\n} from '../commands';\n\nconst createModel = () =>\n  new CommentEditorModel()\n    .registerCommand(boldCommand)\n    .registerCommand(italicCommand)\n    .registerCommand(underlineCommand)\n    .registerCommand(strikethroughCommand)\n    .registerCommand(paragraphCommand)\n    .registerCommand(headingOneCommand)\n    .registerCommand(headingTwoCommand)\n    .registerCommand(headingThreeCommand)\n    .registerCommand(blockPrefixCommand)\n    .registerCommand(selectAllCommand)\n    .registerCommand(clearFormatEnterCommand)\n    .registerCommand(clearFormatBackspaceCommand);\n\nexport const useModel = () => {\n  const node = useEntityFromContext<WorkflowNodeEntity>();\n  const { selected: focused } = useNodeRender();\n\n  const formModel = node.getData(FlowNodeFormData).getFormModel<FormModelV2>();\n\n  const model = useMemo(createModel, []);\n\n  // Synchronized out-of-focus state\n  useEffect(() => {\n    if (focused) {\n      return;\n    }\n    model.setFocus(focused);\n  }, [focused, model]);\n\n  // Synchronized form value initialization\n  useEffect(() => {\n    const value = formModel.getValueIn<string>(CommentEditorFormField.Note);\n    model.setValue(value); // Set initial value\n    model.selectEnd(); // Set the initialization cursor position\n  }, [formModel, model]);\n\n  // Synchronize form external value changes: undo/redo/synergy\n  useEffect(() => {\n    const disposer = formModel.onFormValuesChange(({ name }) => {\n      if (name !== CommentEditorFormField.Note) {\n        return;\n      }\n      const value = formModel.getValueIn<string>(CommentEditorFormField.Note);\n      model.setValue(value);\n    });\n    return () => disposer.dispose();\n  }, [formModel, model]);\n\n  return model;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable max-lines-per-function -- no need fix */\n/* eslint-disable @typescript-eslint/no-magic-numbers -- no need fix */\nimport { useCallback, useState, useEffect } from 'react';\n\nimport { type FormModelV2 } from '@flowgram-adapter/free-layout-editor';\nimport {\n  FreeOperationType,\n  HistoryService,\n} from '@flowgram-adapter/free-layout-editor';\nimport { FlowNodeFormData } from '@flowgram-adapter/free-layout-editor';\nimport {\n  TransformData,\n  usePlayground,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  useCurrentEntity,\n  useService,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { CommentEditorFormField } from '../constant';\n\nexport const useSize = () => {\n  const node = useCurrentEntity();\n  const nodeMeta = node.getNodeMeta();\n  const playground = usePlayground();\n  const historyService = useService(HistoryService);\n  const { size = { width: 240, height: 150 } } = nodeMeta;\n  const transform = node.getData(TransformData);\n  const formModel = node.getData(FlowNodeFormData).getFormModel<FormModelV2>();\n  const formSize = formModel.getValueIn<{ width: number; height: number }>(\n    CommentEditorFormField.Size,\n  );\n\n  const [width, setWidth] = useState(formSize?.width ?? size.width);\n  const [height, setHeight] = useState(formSize?.height ?? size.height);\n\n  // Initialize form value\n  useEffect(() => {\n    const initSize = formModel.getValueIn<{ width: number; height: number }>(\n      CommentEditorFormField.Size,\n    );\n    if (!initSize) {\n      formModel.setValueIn(CommentEditorFormField.Size, {\n        width,\n        height,\n      });\n    }\n  }, [formModel, width, height]);\n\n  // Synchronize form external value changes: initialize/undo/redo/coordinate\n  useEffect(() => {\n    const disposer = formModel.onFormValuesChange(({ name }) => {\n      if (name !== CommentEditorFormField.Size) {\n        return;\n      }\n      const newSize = formModel.getValueIn<{ width: number; height: number }>(\n        CommentEditorFormField.Size,\n      );\n      if (!newSize) {\n        return;\n      }\n      setWidth(newSize.width);\n      setHeight(newSize.height);\n    });\n    return () => disposer.dispose();\n  }, [formModel]);\n\n  const onResize = useCallback(() => {\n    const resizeState = {\n      width,\n      height,\n      originalWidth: width,\n      originalHeight: height,\n      positionX: transform.position.x,\n      positionY: transform.position.y,\n      offsetX: 0,\n      offsetY: 0,\n    };\n    const resizing = (delta: {\n      top: number;\n      right: number;\n      bottom: number;\n      left: number;\n    }) => {\n      if (!resizeState) {\n        return;\n      }\n\n      const { zoom } = playground.config;\n\n      const top = delta.top / zoom;\n      const right = delta.right / zoom;\n      const bottom = delta.bottom / zoom;\n      const left = delta.left / zoom;\n\n      const minWidth = 120;\n      const minHeight = 80;\n\n      const newWidth = Math.max(\n        minWidth,\n        resizeState.originalWidth + right - left,\n      );\n      const newHeight = Math.max(\n        minHeight,\n        resizeState.originalHeight + bottom - top,\n      );\n\n      // If the width or height is less than the minimum, the offset is not updated\n      const newOffsetX =\n        (left > 0 || right < 0) && newWidth <= minWidth\n          ? resizeState.offsetX\n          : left / 2 + right / 2;\n      const newOffsetY =\n        (top > 0 || bottom < 0) && newHeight <= minHeight\n          ? resizeState.offsetY\n          : top;\n\n      const newPositionX = resizeState.positionX + newOffsetX;\n      const newPositionY = resizeState.positionY + newOffsetY;\n\n      resizeState.width = newWidth;\n      resizeState.height = newHeight;\n      resizeState.offsetX = newOffsetX;\n      resizeState.offsetY = newOffsetY;\n\n      // update status\n      setWidth(newWidth);\n      setHeight(newHeight);\n\n      // Update Offset\n      transform.update({\n        position: {\n          x: newPositionX,\n          y: newPositionY,\n        },\n      });\n    };\n\n    const resizeEnd = () => {\n      historyService.transact(() => {\n        historyService.pushOperation(\n          {\n            type: FreeOperationType.dragNodes,\n            value: {\n              ids: [node.id],\n              value: [\n                {\n                  x: resizeState.positionX + resizeState.offsetX,\n                  y: resizeState.positionY + resizeState.offsetY,\n                },\n              ],\n              oldValue: [\n                {\n                  x: resizeState.positionX,\n                  y: resizeState.positionY,\n                },\n              ],\n            },\n          },\n          {\n            noApply: true,\n          },\n        );\n        formModel.setValueIn(CommentEditorFormField.Size, {\n          width: resizeState.width,\n          height: resizeState.height,\n        });\n      });\n    };\n\n    return {\n      resizing,\n      resizeEnd,\n    };\n  }, [node, width, height, transform, playground, formModel, historyService]);\n\n  return {\n    width,\n    height,\n    onResize,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useState, useEffect } from 'react';\n\nimport { usePlayground } from '@flowgram-adapter/free-layout-editor';\n\nimport type { CommentEditorModel } from '../model';\nimport { CommentEditorEvent } from '../constant';\n\nexport const useOverflow = (params: {\n  model: CommentEditorModel;\n  height: number;\n}) => {\n  const { model, height } = params;\n  const playground = usePlayground();\n\n  const [overflow, setOverflow] = useState(false);\n\n  const isOverflow = useCallback((): boolean => {\n    if (!model.element) {\n      return false;\n    }\n    const containerHeight = height * playground.config.zoom;\n    const { height: editorHeight } = model.element.getBoundingClientRect();\n    return editorHeight > containerHeight;\n  }, [model, height, playground]);\n\n  // Update overflow\n  const updateOverflow = useCallback(() => {\n    setOverflow(isOverflow());\n  }, [isOverflow]);\n\n  // Monitor height change\n  useEffect(() => {\n    updateOverflow();\n  }, [height, updateOverflow]);\n\n  // Monitor change events\n  useEffect(() => {\n    const changeDispose = model.on<CommentEditorEvent.Change>(\n      CommentEditorEvent.Change,\n      () => {\n        updateOverflow();\n      },\n    );\n    return () => {\n      changeDispose();\n    };\n  }, [model, updateOverflow]);\n\n  return { overflow, updateOverflow };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable max-lines-per-function -- no need to split */\nimport { type RefObject, type FC } from 'react';\n\nimport classNames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { Tooltip } from '@coze-arch/bot-semi';\nimport {\n  IconCozArrowDown,\n  IconCozBold,\n  IconCozQuotation,\n  IconCozH1,\n  IconCozH2,\n  IconCozH3,\n  IconCozItalic,\n  IconCozLink,\n  IconCozListDisorder,\n  IconCozListOrder,\n  IconCozStrikethrough,\n  IconCozTextStyle,\n  IconCozUnderscore,\n} from '@coze-arch/coze-design/icons';\nimport { Dropdown, Input } from '@coze-arch/coze-design';\n\nimport { type CommentEditorModel } from '../model';\nimport {\n  CommentEditorBlockFormat,\n  CommentEditorLeafFormat,\n  CommentDefaultLink,\n} from '../constant';\n\ninterface ICommentToolbar {\n  model: CommentEditorModel;\n  containerRef: RefObject<HTMLDivElement>;\n  visible: boolean;\n}\n\nexport const CommentToolbar: FC<ICommentToolbar> = props => {\n  const { model, containerRef } = props;\n\n  const linkValue = model.getLeafValue(CommentEditorLeafFormat.Link) as string;\n  const linkDisplay = linkValue === CommentDefaultLink ? '' : linkValue;\n\n  const tooltipDelay = 1000;\n  const toolItemClass =\n    'flex items-center gap-[2px] w-auto h-[24px] p-[4px] rounded-[6px] hover:bg-[var(--coz-mg-primary)] cursor-pointer select-none';\n  const toolItemMarkedClass =\n    'text-[var(--coz-fg-hglt)] bg-[var(--coz-mg-hglt)] hover:bg-[var(--coz-mg-hglt-hovered)]';\n  const separatorClass = 'w-[1px] h-[16px] bg-[var(--coz-stroke-primary)]';\n  const textItemClass =\n    'w-full h-[32px] p-[8px] text-[14px] flex gap-[8px] items-center rounded-[5px] cursor-pointer select-none hover:bg-[var(--coz-mg-primary)]';\n  const textItemMarkedClass =\n    'text-[var(--coz-fg-hglt)] bg-[var(--coz-mg-hglt)] hover:bg-[var(--coz-mg-hglt-hovered)]';\n\n  return (\n    <div\n      className={classNames(\n        'workflow-comment-toolbar absolute left-[-140px]',\n        model.isLeafMarked(CommentEditorLeafFormat.Link)\n          ? 'top-[-48px]'\n          : 'top-[-14px]',\n      )}\n    >\n      <div\n        className=\"flex items-center gap-[3px] h-[32px] p-[4px] w-auto bg-[var(--coz-bg-max)] rounded-[8px] border-[1px] border-solid border-[var(--coz-stroke-primary)]\"\n        style={{\n          boxShadow:\n            '0px 4px 12px 0px rgba(0, 0, 0, 0.08), 0px 8px 24px 0px rgba(0, 0, 0, 0.04)',\n        }}\n        onMouseDown={e => {\n          e.preventDefault();\n          e.stopPropagation();\n        }}\n        onClick={e => {\n          e.preventDefault();\n          e.stopPropagation();\n        }}\n      >\n        {/** Text style */}\n        <Dropdown\n          position=\"bottom\"\n          trigger=\"hover\"\n          clickToHide\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- must exist\n          getPopupContainer={() => containerRef.current!}\n          render={\n            <div\n              className=\"flex flex-col gap-[2px] justify-start items-center w-[120px] p-[4px] rounded-[8px] border-[0.5px] border-solid border-[var(--coz-stroke-primary)] bg-[var(--coz-bg-max)]\"\n              style={{\n                boxShadow:\n                  '0px 8px 24px 0px rgba(0, 0, 0, 0.16), 0px 16px 48px 0px rgba(0, 0, 0, 0.08)',\n              }}\n            >\n              {/** text */}\n              <div\n                className={classNames(textItemClass, {\n                  [textItemMarkedClass]: model.isBlockMarked(\n                    CommentEditorBlockFormat.Paragraph,\n                  ),\n                })}\n                onClick={e => {\n                  model.markBlock(CommentEditorBlockFormat.Paragraph);\n                }}\n              >\n                <IconCozTextStyle className=\"text-xxl\" />\n                <p>{I18n.t('workflow_note_main_text')}</p>\n              </div>\n              {/** first-level title */}\n              <div\n                className={classNames(textItemClass, {\n                  [textItemMarkedClass]: model.isBlockMarked(\n                    CommentEditorBlockFormat.HeadingOne,\n                  ),\n                })}\n                onClick={e => {\n                  model.markBlock(CommentEditorBlockFormat.HeadingOne);\n                }}\n              >\n                <IconCozH1 className=\"text-xxl\" />\n                <p>{I18n.t('workflow_note_heading')} 1</p>\n              </div>\n              {/** secondary title */}\n              <div\n                className={classNames(textItemClass, {\n                  [textItemMarkedClass]: model.isBlockMarked(\n                    CommentEditorBlockFormat.HeadingTwo,\n                  ),\n                })}\n                onClick={e => {\n                  model.markBlock(CommentEditorBlockFormat.HeadingTwo);\n                }}\n              >\n                <IconCozH2 className=\"text-xxl\" />\n                <p>{I18n.t('workflow_note_heading')} 2</p>\n              </div>\n              {/** third-level title */}\n              <div\n                className={classNames(textItemClass, {\n                  [textItemMarkedClass]: model.isBlockMarked(\n                    CommentEditorBlockFormat.HeadingThree,\n                  ),\n                })}\n                onClick={e => {\n                  model.markBlock(CommentEditorBlockFormat.HeadingThree);\n                }}\n              >\n                <IconCozH3 className=\"text-xxl\" />\n                <p>{I18n.t('workflow_note_heading')} 3</p>\n              </div>\n            </div>\n          }\n        >\n          <span className={toolItemClass}>\n            <IconCozTextStyle />\n            <IconCozArrowDown />\n          </span>\n        </Dropdown>\n\n        <div className={separatorClass} />\n\n        {/** bold */}\n        <Tooltip\n          content={I18n.t('workflow_note_bold')}\n          mouseEnterDelay={tooltipDelay}\n        >\n          <span\n            className={classNames(toolItemClass, {\n              [toolItemMarkedClass]: model.isLeafMarked(\n                CommentEditorLeafFormat.Bold,\n              ),\n            })}\n            onClick={e => {\n              model.markLeaf(CommentEditorLeafFormat.Bold);\n            }}\n          >\n            <IconCozBold />\n          </span>\n        </Tooltip>\n\n        {/** Italic */}\n        <Tooltip\n          content={I18n.t('workflow_note_italic')}\n          mouseEnterDelay={tooltipDelay}\n        >\n          <span\n            className={classNames(toolItemClass, {\n              [toolItemMarkedClass]: model.isLeafMarked(\n                CommentEditorLeafFormat.Italic,\n              ),\n            })}\n            onClick={e => {\n              model.markLeaf(CommentEditorLeafFormat.Italic);\n            }}\n          >\n            <IconCozItalic />\n          </span>\n        </Tooltip>\n\n        {/** underline */}\n        <Tooltip\n          content={I18n.t('workflow_note_underline')}\n          mouseEnterDelay={tooltipDelay}\n        >\n          <span\n            className={classNames(toolItemClass, {\n              [toolItemMarkedClass]: model.isLeafMarked(\n                CommentEditorLeafFormat.Underline,\n              ),\n            })}\n            onClick={e => {\n              model.markLeaf(CommentEditorLeafFormat.Underline);\n            }}\n          >\n            <IconCozUnderscore />\n          </span>\n        </Tooltip>\n\n        {/** Strikethrough */}\n        <Tooltip\n          content={I18n.t('workflow_note_strikethrough')}\n          mouseEnterDelay={tooltipDelay}\n        >\n          <span\n            className={classNames(toolItemClass, {\n              [toolItemMarkedClass]: model.isLeafMarked(\n                CommentEditorLeafFormat.Strikethrough,\n              ),\n            })}\n            onClick={e => {\n              model.markLeaf(CommentEditorLeafFormat.Strikethrough);\n            }}\n          >\n            <IconCozStrikethrough />\n          </span>\n        </Tooltip>\n\n        <div className={separatorClass} />\n\n        {/** unordered list */}\n        <Tooltip\n          content={I18n.t('workflow_note_bulleted_list')}\n          mouseEnterDelay={tooltipDelay}\n        >\n          <span\n            className={classNames(toolItemClass, {\n              [toolItemMarkedClass]: model.isBlockMarked(\n                CommentEditorBlockFormat.BulletedList,\n              ),\n            })}\n            onClick={e => {\n              model.markBlock(CommentEditorBlockFormat.BulletedList);\n            }}\n          >\n            <IconCozListDisorder />\n          </span>\n        </Tooltip>\n\n        {/** ordered list */}\n        <Tooltip\n          content={I18n.t('workflow_note_numbered_list')}\n          mouseEnterDelay={tooltipDelay}\n        >\n          <span\n            className={classNames(toolItemClass, {\n              [toolItemMarkedClass]: model.isBlockMarked(\n                CommentEditorBlockFormat.NumberedList,\n              ),\n            })}\n            onClick={e => {\n              model.markBlock(CommentEditorBlockFormat.NumberedList);\n            }}\n          >\n            <IconCozListOrder />\n          </span>\n        </Tooltip>\n\n        {/** quote */}\n        <Tooltip\n          content={I18n.t('workflow_note_quote')}\n          mouseEnterDelay={tooltipDelay}\n        >\n          <span\n            className={classNames(toolItemClass, {\n              [toolItemMarkedClass]: model.isBlockMarked(\n                CommentEditorBlockFormat.Blockquote,\n              ),\n            })}\n            onClick={e => {\n              model.markBlock(CommentEditorBlockFormat.Blockquote);\n            }}\n          >\n            <IconCozQuotation />\n          </span>\n        </Tooltip>\n\n        <div className={separatorClass} />\n\n        {/** link */}\n        <Tooltip\n          content={I18n.t('workflow_note_hyperlink')}\n          mouseEnterDelay={tooltipDelay}\n        >\n          <span\n            className={classNames(toolItemClass, {\n              [toolItemMarkedClass]: model.isLeafMarked(\n                CommentEditorLeafFormat.Link,\n              ),\n            })}\n            onClick={e => {\n              e.preventDefault();\n              e.stopPropagation();\n              model.markLeaf(CommentEditorLeafFormat.Link, CommentDefaultLink);\n            }}\n          >\n            <IconCozLink />\n          </span>\n        </Tooltip>\n      </div>\n      <div\n        className=\"w-full overflow-hidden absolute top-[34px]\"\n        style={{\n          display: model.isLeafMarked(CommentEditorLeafFormat.Link)\n            ? 'flex'\n            : 'none',\n        }}\n        onMouseDown={e => {\n          e.stopPropagation();\n        }}\n      >\n        <Input\n          // cp-disable-next-line\n          placeholder=\"https://\"\n          style={{\n            // Overlay style is needed here, tailwind class priority is not high enough\n            backgroundColor: '#fff',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n          }}\n          value={linkDisplay}\n          onChange={value => {\n            model.setLeafValue(\n              CommentEditorLeafFormat.Link,\n              value || CommentDefaultLink,\n            );\n          }}\n        ></Input>\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type RefObject, useState, useCallback, useEffect } from 'react';\n\nimport { ReactEditor } from 'slate-react';\nimport {\n  type PositionSchema,\n  usePlayground,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport type { CommentEditorModel } from '../../model';\nimport { CommentEditorEvent } from '../../constant';\n\nexport const usePosition = (params: {\n  model: CommentEditorModel;\n  containerRef: RefObject<HTMLDivElement>;\n}): PositionSchema | undefined => {\n  const { model, containerRef } = params;\n  const playground = usePlayground();\n\n  const [position, setPosition] = useState<PositionSchema | undefined>();\n\n  const calcPosition = useCallback(() => {\n    const containerRect = containerRef?.current?.getBoundingClientRect();\n    if (!model.editor.selection || !containerRect) {\n      setPosition(undefined);\n      return;\n    }\n    const selectionRect = ReactEditor.toDOMRange(\n      model.editor,\n      model.editor.selection,\n    ).getBoundingClientRect();\n\n    const { zoom } = playground.config;\n    const lineHeight = 24;\n\n    const selectionWidth = selectionRect.width / zoom;\n    const selectionX = selectionRect.left / zoom;\n    const selectionY = selectionRect.top / zoom;\n    const containerX = containerRect.left / zoom;\n    const containerY = containerRect.top / zoom;\n\n    const positionX = selectionX - containerX + selectionWidth / 2;\n    const positionY = selectionY - containerY - lineHeight;\n\n    const selectionPosition: PositionSchema = {\n      x: positionX,\n      y: positionY,\n    };\n    setPosition(selectionPosition);\n  }, [containerRef, model.editor, playground.config]);\n\n  useEffect(() => {\n    calcPosition();\n    const multiSelectDispose = model.on<CommentEditorEvent.MultiSelect>(\n      CommentEditorEvent.MultiSelect,\n      () => {\n        calcPosition();\n      },\n    );\n    const changeDispose = model.on<CommentEditorEvent.Change>(\n      CommentEditorEvent.Change,\n      () => {\n        setTimeout(() => {\n          calcPosition();\n        }, 20);\n      },\n    );\n    return () => {\n      multiSelectDispose();\n      changeDispose();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- init\n  }, []);\n\n  return position;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/naming-convention -- inner value */\n/* eslint-disable react-hooks/exhaustive-deps -- init */\nimport { type RefObject, useCallback, useEffect, useState } from 'react';\n\nimport { debounce } from 'lodash-es';\n\nimport type { CommentEditorModel } from '../../model';\nimport { CommentEditorEvent, CommentToolbarDisplayDelay } from '../../constant';\n\nexport const useActivate = (params: {\n  model: CommentEditorModel;\n  toolbarRef: RefObject<HTMLDivElement>;\n}) => {\n  const { model, toolbarRef } = params;\n  const [activated, _setActivated] = useState(false);\n\n  const setActivated = useCallback(\n    debounce((active: boolean) => {\n      _setActivated(active);\n    }, CommentToolbarDisplayDelay),\n    [],\n  );\n\n  // Clean up the debounce\n  useEffect(() => () => setActivated.cancel(), [setActivated]);\n\n  // Listening for handling model events\n  useEffect(() => {\n    const eventHandlers = {\n      [CommentEditorEvent.MultiSelect]: () => setActivated(true),\n      [CommentEditorEvent.Select]: () => setActivated(false),\n      [CommentEditorEvent.Change]: () => setActivated(false),\n      [CommentEditorEvent.Blur]: () => setActivated(false),\n    };\n\n    const disposers = Object.entries(eventHandlers).map(([event, handler]) =>\n      model.on(event as CommentEditorEvent, handler),\n    );\n\n    return () => {\n      disposers.forEach(dispose => dispose());\n    };\n  }, [model, setActivated]);\n\n  // mouse event handling\n  useEffect(() => {\n    const mouseHandler = (e: MouseEvent) => {\n      if (\n        !toolbarRef.current ||\n        toolbarRef.current.contains(e.target as Node)\n      ) {\n        return;\n      }\n      setActivated(false);\n    };\n\n    window.addEventListener('mousedown', mouseHandler);\n    return () => window.removeEventListener('mousedown', mouseHandler);\n  }, [toolbarRef, setActivated]);\n\n  return activated;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport ReactDOM from 'react-dom';\nimport { type ReactNode } from 'react';\n\ninterface IPortal {\n  container: HTMLElement;\n  children?: ReactNode;\n}\n\nexport const Portal = ({ children, container }: IPortal) =>\n  typeof document === 'object'\n    ? ReactDOM.createPortal(children, container)\n    : null;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, type RefObject, useRef } from 'react';\n\nimport { CommentToolbar } from '../toolbar';\nimport type { CommentEditorModel } from '../../model';\nimport { usePosition } from './use-position';\nimport { useActivate } from './use-activate';\nimport { Portal } from './portal';\n\ninterface ICommentToolbar {\n  disabled?: boolean;\n  model: CommentEditorModel;\n  containerRef: RefObject<HTMLDivElement>;\n}\n\nexport const CommentToolbarContainer: FC<ICommentToolbar> = props => {\n  const { disabled = false, model, containerRef } = props;\n  const toolbarRef = useRef<HTMLDivElement>(null);\n  const shouldRender = !!containerRef?.current;\n  const activated = useActivate({ model, toolbarRef });\n  const position = usePosition({ model, containerRef });\n  const visible = activated && Boolean(position);\n\n  if (!shouldRender || disabled) {\n    return <></>;\n  }\n\n  return (\n    <Portal container={containerRef.current}>\n      <div\n        className=\"workflow-comment-toolbar-container absolute z-[1000]\"\n        ref={toolbarRef}\n        style={{\n          display: visible ? 'flex' : 'none',\n          top: position?.y,\n          left: position?.x,\n        }}\n      >\n        <CommentToolbar\n          model={model}\n          containerRef={containerRef}\n          visible={visible}\n        />\n      </div>\n    </Portal>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { type RenderPlaceholderProps } from 'slate-react';\n\nexport const Placeholder: FC<RenderPlaceholderProps> = props => {\n  const { children, attributes } = props;\n  return (\n    <div\n      {...attributes}\n      className=\"workflow-comment-editor-placeholder text-[12px] text-[var(--coz-fg-dim)] overflow-hidden absolute pointer-events-none w-full select-none decoration-clone\"\n      style={\n        {\n          // Override slate built-in style\n        }\n      }\n    >\n      <p>{children}</p>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CommentEditorLeafFormat, CommentDefaultLink } from '../../constant';\n\nexport const Leaf = ({ attributes, children, leaf }) => {\n  if (leaf[CommentEditorLeafFormat.Bold]) {\n    children = <strong>{children}</strong>;\n  }\n\n  if (leaf[CommentEditorLeafFormat.Strikethrough]) {\n    children = <del>{children}</del>;\n  }\n\n  if (leaf[CommentEditorLeafFormat.Italic]) {\n    children = <em>{children}</em>;\n  }\n\n  if (leaf[CommentEditorLeafFormat.Underline]) {\n    children = <u>{children}</u>;\n  }\n\n  if (leaf[CommentEditorLeafFormat.Link]) {\n    children = (\n      <a\n        className=\"text-[var(--semi-color-link)] cursor-pointer\"\n        href={leaf[CommentEditorLeafFormat.Link]}\n        onClick={e => {\n          e.preventDefault();\n          e.stopPropagation();\n          const link: string = leaf[CommentEditorLeafFormat.Link];\n          if (link === CommentDefaultLink) {\n            // If the link is the default link, open it directly.\n            return window.open(link, '_blank');\n          } else if (/^([a-zA-Z][a-zA-Z\\d+\\-.]*):\\/\\//.test(link)) {\n            // If a legal agreement is already included, open it directly\n            return window.open(link, '_blank');\n          } else {\n            // If there is no legal agreement, add the https protocol header.\n            // cp-disable-next-line\n            return window.open(`https://${link}`, '_blank');\n          }\n        }}\n      >\n        {children}\n      </a>\n    );\n  }\n\n  return <span {...attributes}>{children}</span>;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CommentEditorBlockFormat } from '../../constant';\n\nexport const Block = ({ attributes, children, element }) => {\n  const style = {\n    textAlign: element.align,\n    color: 'var(--coz-fg-primary, rgba(6, 7, 9, 0.80))',\n  };\n  // Select the corresponding HTML tag based on the element type\n  switch (element.type) {\n    case CommentEditorBlockFormat.Paragraph:\n      // Render paragraph\n      return (\n        <p className=\"text-[12px] m-0 p-0\" style={style} {...attributes}>\n          {children}\n        </p>\n      );\n    case CommentEditorBlockFormat.Blockquote:\n      // Render reference block\n      return (\n        <blockquote\n          className=\"border-l-[3px] border-t-0 border-b-0 border-r-0 border-solid border-[#ced0d4] m-0 p-0 pl-[8px] ml-[8px] text-[12px]\"\n          style={{\n            ...style,\n            color: 'var(--coz-fg-secondary, rgba(32, 41, 69, 0.62))',\n          }}\n          {...attributes}\n        >\n          {children}\n        </blockquote>\n      );\n    case CommentEditorBlockFormat.HeadingOne:\n      // Render first-level title\n      return (\n        <h1\n          className=\"text-[18px] mx-0 my-[6px] p-0 font-[600]\"\n          style={style}\n          {...attributes}\n        >\n          {children}\n        </h1>\n      );\n    case CommentEditorBlockFormat.HeadingTwo:\n      // Render secondary title\n      return (\n        <h2\n          className=\"text-[16px] mx-0 my-[6px] p-0 font-[600]\"\n          style={style}\n          {...attributes}\n        >\n          {children}\n        </h2>\n      );\n    case CommentEditorBlockFormat.HeadingThree:\n      // Render three-level title\n      return (\n        <h3\n          className=\"text-[14px] mx-0 my-[6px] p-0 font-[600]\"\n          style={style}\n          {...attributes}\n        >\n          {children}\n        </h3>\n      );\n    case CommentEditorBlockFormat.BulletedList:\n      // Render unordered list\n      return (\n        <ul\n          className=\"text-[12px] m-0 p-0 pl-[16px] font-[400]\"\n          style={style}\n          {...attributes}\n        >\n          {children}\n        </ul>\n      );\n    case CommentEditorBlockFormat.NumberedList:\n      // Render ordered list\n      return (\n        <ol\n          className=\"text-[12px] m-0 p-0 pl-[16px]\"\n          style={style}\n          {...attributes}\n        >\n          {children}\n        </ol>\n      );\n    case CommentEditorBlockFormat.ListItem:\n      // Render list items\n      return (\n        <li className=\"text-[12px] m-0 p-0\" style={style} {...attributes}>\n          {children}\n        </li>\n      );\n    default:\n      // Default render as paragraph\n      return (\n        <p className=\"text-[12px] m-0 p-0\" style={style} {...attributes}>\n          {children}\n        </p>\n      );\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  type FC,\n  useCallback,\n  type CSSProperties,\n  useEffect,\n} from 'react';\n\nimport { Editable, Slate } from 'slate-react';\nimport type { Descendant } from 'slate';\nimport { I18n } from '@coze-arch/i18n';\nimport { usePlayground } from '@flowgram-adapter/free-layout-editor';\n\nimport type { CommentEditorModel } from '../../model';\nimport { CommentEditorEvent } from '../../constant';\nimport { Placeholder } from './placeholder';\nimport { Leaf } from './leaf';\nimport { Block } from './block';\n\ninterface ICommentEditor {\n  model: CommentEditorModel;\n  style?: CSSProperties;\n  value?: string;\n  onChange?: (value: string) => void;\n}\n\nexport const CommentEditor: FC<ICommentEditor> = props => {\n  const { model, style, onChange } = props;\n  const playground = usePlayground();\n  const renderBlock = useCallback(blockProps => <Block {...blockProps} />, []);\n  const renderLeaf = useCallback(leafProps => <Leaf {...leafProps} />, []);\n\n  // Synchronize editor internal value changes\n  useEffect(() => {\n    const dispose = model.on<CommentEditorEvent.Change>(\n      CommentEditorEvent.Change,\n      () => {\n        onChange?.(model.value);\n      },\n    );\n    return () => dispose();\n  }, [model, onChange]);\n\n  return (\n    <Slate\n      editor={model.editor}\n      initialValue={model.blocks as unknown as Descendant[]}\n      onChange={() => model.fireChange()}\n    >\n      <Editable\n        className=\"workflow-comment-editor w-full cursor-text\"\n        spellCheck\n        readOnly={playground.config.readonly}\n        renderElement={renderBlock}\n        renderLeaf={renderLeaf}\n        onKeyDown={e => model.keydown(e)}\n        onPaste={e => model.paste(e)}\n        style={style}\n        placeholder={I18n.t('workflow_note_placeholder')}\n        renderPlaceholder={p => <Placeholder {...p} />}\n      />\n    </Slate>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport classNames from 'classnames';\nimport {\n  useNodeRender,\n  usePlayground,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { type CommentEditorModel } from '../model';\n\ninterface IDragArea {\n  className?: string;\n  model: CommentEditorModel;\n  stopEvent?: boolean;\n}\n\nexport const DragArea: FC<IDragArea> = props => {\n  const { className = '', model, stopEvent = true } = props;\n\n  const playground = usePlayground();\n\n  const {\n    startDrag: onStartDrag,\n    onFocus,\n    onBlur,\n    selectNode,\n  } = useNodeRender();\n\n  return (\n    <div\n      className={classNames(\n        'workflow-comment-drag-area',\n        'absolute flex items-center justify-center cursor-move',\n        className,\n      )}\n      data-flow-editor-selectable=\"false\"\n      draggable={true}\n      onMouseDown={e => {\n        if (stopEvent) {\n          e.preventDefault();\n          e.stopPropagation();\n        }\n        model.setFocus(false);\n        onStartDrag(e);\n        selectNode(e);\n        playground.node.focus(); // Prevent nodes from being deleted\n      }}\n      onFocus={onFocus}\n      onBlur={onBlur}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, useState, useEffect, type WheelEventHandler } from 'react';\n\nimport classNames from 'classnames';\nimport {\n  useNodeRender,\n  usePlayground,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport type { CommentEditorModel } from '../model';\nimport { DragArea } from './drag-area';\n\ninterface IContentDragArea {\n  model: CommentEditorModel;\n  focused: boolean;\n  overflow: boolean;\n}\n\nexport const ContentDragArea: FC<IContentDragArea> = props => {\n  const { model, focused, overflow } = props;\n  const playground = usePlayground();\n  const { selectNode } = useNodeRender();\n\n  const [active, setActive] = useState(false);\n\n  useEffect(() => {\n    // When the editor loses focus, deactivate it\n    if (!focused) {\n      setActive(false);\n    }\n  }, [focused]);\n\n  const handleWheel: WheelEventHandler<HTMLDivElement> = e => {\n    const containerElement = model.element?.parentElement;\n    if (active || !overflow || !containerElement) {\n      return;\n    }\n    e.stopPropagation();\n    const maxScroll =\n      containerElement.scrollHeight - containerElement.clientHeight;\n    const newScrollTop = Math.min(\n      Math.max(containerElement.scrollTop + e.deltaY, 0),\n      maxScroll,\n    );\n    containerElement.scroll(0, newScrollTop);\n  };\n\n  const handleMouseDown = (mouseDownEvent: React.MouseEvent) => {\n    if (active) {\n      return;\n    }\n    mouseDownEvent.preventDefault();\n    mouseDownEvent.stopPropagation();\n    model.setFocus(false);\n    selectNode(mouseDownEvent);\n    playground.node.focus(); // Prevent nodes from being deleted\n\n    const startX = mouseDownEvent.clientX;\n    const startY = mouseDownEvent.clientY;\n\n    const handleMouseUp = (mouseMoveEvent: MouseEvent) => {\n      const deltaX = mouseMoveEvent.clientX - startX;\n      const deltaY = mouseMoveEvent.clientY - startY;\n      // Determine whether to drag or click\n      const delta = 5;\n      if (Math.abs(deltaX) < delta && Math.abs(deltaY) < delta) {\n        // Hide after clicking\n        setActive(true);\n      }\n      document.removeEventListener('mouseup', handleMouseUp);\n      document.removeEventListener('click', handleMouseUp);\n    };\n\n    document.addEventListener('mouseup', handleMouseUp);\n    document.addEventListener('click', handleMouseUp);\n  };\n\n  return (\n    <div\n      className={classNames(\n        'workflow-comment-content-drag-area absolute h-full w-[calc(100%-20px)]',\n        {\n          hidden: active,\n        },\n      )}\n      onMouseDown={handleMouseDown}\n      onWheel={handleWheel}\n    >\n      <DragArea\n        className=\"relative h-full w-full\"\n        model={model}\n        stopEvent={false}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReactNode, type FC, type CSSProperties } from 'react';\n\nimport classNames from 'classnames';\n\ninterface ICommentContainer {\n  focused: boolean;\n  children?: ReactNode;\n  style?: React.CSSProperties;\n}\n\nexport const CommentContainer: FC<ICommentContainer> = props => {\n  const { focused, children, style } = props;\n\n  const scrollbarStyle = {\n    // scroll bar style\n    scrollbarWidth: 'thin',\n    scrollbarColor: 'rgb(159 159 158 / 65%) transparent',\n    // Styles for WebKit browsers such as Chrome, Safari\n    '&::-webkit-scrollbar': {\n      width: '4px',\n    },\n    '&::-webkit-scrollbar-track': {\n      background: 'transparent',\n    },\n    '&::-webkit-scrollbar-thumb': {\n      backgroundColor: 'rgb(159 159 158 / 65%)',\n      borderRadius: '20px',\n      border: '2px solid transparent',\n    },\n  } as unknown as CSSProperties;\n\n  return (\n    <div\n      className={classNames(\n        'workflow-comment-container flex flex-col items-start justify-start w-full h-full rounded-[8px] outline-solid py-[6px] px-[10px] overflow-y-auto overflow-x-hidden outline-[1px]',\n        {\n          'bg-[#FFF3EA] outline-[#FF811A]': focused,\n          'bg-[#FFFBED] outline-[#F2B600]': !focused,\n        },\n      )}\n      data-flow-editor-selectable=\"false\"\n      style={{\n        // Tailwind does not support the style of outline, so you need to use style to set it here.\n        outline: focused ? '1px solid #FF811A' : '1px solid #F2B600',\n        ...scrollbarStyle,\n        ...style,\n      }}\n    >\n      {children}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport classNames from 'classnames';\nimport {\n  useNodeRender,\n  usePlayground,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport type { CommentEditorModel } from '../model';\n\ninterface IResizeArea {\n  className?: string;\n  model: CommentEditorModel;\n  onResize?: () => {\n    resizing: (delta: {\n      top: number;\n      right: number;\n      bottom: number;\n      left: number;\n    }) => void;\n    resizeEnd: () => void;\n  };\n  getDelta?: (delta: { x: number; y: number }) => {\n    top: number;\n    right: number;\n    bottom: number;\n    left: number;\n  };\n}\n\nexport const ResizeArea: FC<IResizeArea> = props => {\n  const { className = '', model, onResize, getDelta } = props;\n\n  const playground = usePlayground();\n\n  const { selectNode } = useNodeRender();\n\n  const handleMouseDown = (mouseDownEvent: React.MouseEvent) => {\n    mouseDownEvent.preventDefault();\n    mouseDownEvent.stopPropagation();\n    if (!onResize) {\n      return;\n    }\n    const { resizing, resizeEnd } = onResize();\n    model.setFocus(false);\n    selectNode(mouseDownEvent);\n    playground.node.focus(); // Prevent nodes from being deleted\n\n    const startX = mouseDownEvent.clientX;\n    const startY = mouseDownEvent.clientY;\n\n    const handleMouseMove = (mouseMoveEvent: MouseEvent) => {\n      const deltaX = mouseMoveEvent.clientX - startX;\n      const deltaY = mouseMoveEvent.clientY - startY;\n      const delta = getDelta?.({ x: deltaX, y: deltaY });\n      if (!delta || !resizing) {\n        return;\n      }\n      resizing(delta);\n    };\n\n    const handleMouseUp = () => {\n      resizeEnd();\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n      document.removeEventListener('click', handleMouseUp);\n    };\n\n    document.addEventListener('mousemove', handleMouseMove);\n    document.addEventListener('mouseup', handleMouseUp);\n    document.addEventListener('click', handleMouseUp);\n  };\n\n  return (\n    <div\n      className={classNames(\n        className,\n        'workflow-comment-resize-area absolute w-[10px] h-[10px]',\n      )}\n      data-flow-editor-selectable=\"false\"\n      onMouseDown={handleMouseDown}\n    ></div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport classNames from 'classnames';\n\nimport type { CommentEditorModel } from '../model';\nimport { ResizeArea } from './resize-area';\nimport { DragArea } from './drag-area';\n\ninterface IBorderArea {\n  model: CommentEditorModel;\n  overflow: boolean;\n  onResize?: () => {\n    resizing: (delta: {\n      top: number;\n      right: number;\n      bottom: number;\n      left: number;\n    }) => void;\n    resizeEnd: () => void;\n  };\n}\n\nexport const BorderArea: FC<IBorderArea> = props => {\n  const { model, overflow, onResize } = props;\n\n  return (\n    <div className=\"workflow-comment-border-area z-[999]\">\n      {/* Left */}\n      <DragArea\n        className=\"left-[-10px] top-[10px] w-[20px] h-[calc(100%-20px)]\"\n        model={model}\n      />\n      {/* Right */}\n      <DragArea\n        className={classNames('right-[-10px] top-[10px] h-[calc(100%-20px)]', {\n          'w-[10px]': overflow, // Prevent occlusion of scroll bars\n          'w-[20px]': !overflow,\n        })}\n        model={model}\n      />\n      {/* above */}\n      <DragArea\n        className=\"top-[-10px] left-[10px] w-[calc(100%-20px)] h-[20px]\"\n        model={model}\n      />\n      {/* below */}\n      <DragArea\n        className=\"bottom-[-10px] left-[10px] w-[calc(100%-20px)] h-[20px]\"\n        model={model}\n      />\n      {/** upper left corner */}\n      <ResizeArea\n        className=\"left-0 top-0 cursor-nwse-resize\"\n        model={model}\n        getDelta={({ x, y }) => ({ top: y, right: 0, bottom: 0, left: x })}\n        onResize={onResize}\n      />\n      {/** upper right corner */}\n      <ResizeArea\n        className=\"right-0 top-0 cursor-nesw-resize\"\n        model={model}\n        getDelta={({ x, y }) => ({ top: y, right: x, bottom: 0, left: 0 })}\n        onResize={onResize}\n      />\n      {/** lower right corner */}\n      <ResizeArea\n        className=\"right-0 bottom-0 cursor-nwse-resize\"\n        model={model}\n        getDelta={({ x, y }) => ({ top: 0, right: x, bottom: y, left: 0 })}\n        onResize={onResize}\n      />\n      {/** Lower left corner */}\n      <ResizeArea\n        className=\"left-0 bottom-0 cursor-nesw-resize\"\n        model={model}\n        getDelta={({ x, y }) => ({ top: 0, right: 0, bottom: y, left: x })}\n        onResize={onResize}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { FC } from 'react';\n\nimport {\n  useNodeRender,\n  usePlayground,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport type { CommentEditorModel } from '../model';\nimport { DragArea } from './drag-area';\n\ninterface IBlankArea {\n  model: CommentEditorModel;\n}\n\nexport const BlankArea: FC<IBlankArea> = props => {\n  const { model } = props;\n  const playground = usePlayground();\n  const { selectNode } = useNodeRender();\n\n  return (\n    <div\n      className=\"workflow-comment-blank-area h-full w-full\"\n      onMouseDown={e => {\n        e.preventDefault();\n        e.stopPropagation();\n        model.setFocus(false);\n        selectNode(e);\n        playground.node.focus(); // Prevent nodes from being deleted\n      }}\n      onClick={e => {\n        model.setFocus(true);\n        model.selectEnd();\n      }}\n    >\n      <DragArea\n        className=\"relative h-full w-full\"\n        model={model}\n        stopEvent={false}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ErrorBoundary } from 'react-error-boundary';\nimport { type FC } from 'react';\n\nimport {\n  Field,\n  type FieldRenderProps,\n  FlowNodeFormData,\n  Form,\n  type FormModelV2,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  useNodeRender,\n  type WorkflowNodeEntity,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { useSize, useModel, useOverflow } from '../hooks';\nimport { CommentEditorFormField } from '../constant';\nimport { CommentToolbarContainer } from './toolbar-container';\nimport { CommentEditor } from './editor';\nimport { ContentDragArea } from './content-drag-area';\nimport { CommentContainer } from './container';\nimport { BorderArea } from './border-area';\nimport { BlankArea } from './blank-area';\n\nexport const CommentRender: FC<{\n  node: WorkflowNodeEntity;\n}> = props => {\n  const { node } = props;\n  const model = useModel();\n\n  const { selected: focused, selectNode, nodeRef } = useNodeRender();\n\n  const formModel = node.getData(FlowNodeFormData).getFormModel<FormModelV2>();\n  const formControl = formModel?.formControl;\n\n  const { width, height, onResize } = useSize();\n  const { overflow, updateOverflow } = useOverflow({ model, height });\n\n  return (\n    <div\n      className=\"workflow-comment w-auto h-auto min-w-[120px] min-h-[80px]\"\n      style={{\n        width,\n        height,\n      }}\n      ref={nodeRef}\n      data-node-selected={String(focused)}\n      onMouseEnter={updateOverflow}\n      onMouseDown={e => {\n        setTimeout(() => {\n          // Prevent selectNode from intercepting events, causing the slate editor to fail to focus\n          selectNode(e);\n          // eslint-disable-next-line @typescript-eslint/no-magic-numbers -- delay\n        }, 20);\n      }}\n    >\n      <ErrorBoundary\n        fallback={\n          <p className=\"text-red-500\">ERROR: Workflow Comment Form Error</p>\n        }\n      >\n        <Form control={formControl}>\n          <>\n            {/* background */}\n            <CommentContainer focused={focused} style={{ height }}>\n              <ErrorBoundary\n                fallback={\n                  <p className=\"text-red-500\">\n                    ERROR: Workflow Comment Render Failed\n                  </p>\n                }\n              >\n                <Field name={CommentEditorFormField.Note}>\n                  {({ field }: FieldRenderProps<string>) => (\n                    <>\n                      {/** editor */}\n                      <CommentEditor\n                        model={model}\n                        value={field.value}\n                        onChange={field.onChange}\n                      />\n                      {/* blank space */}\n                      <BlankArea model={model} />\n                      {/* content drag and drop area (hidden after clicking) */}\n                      <ContentDragArea\n                        model={model}\n                        focused={focused}\n                        overflow={overflow}\n                      />\n                      {/* toolbar */}\n                      <CommentToolbarContainer\n                        model={model}\n                        containerRef={nodeRef}\n                      />\n                    </>\n                  )}\n                </Field>\n              </ErrorBoundary>\n            </CommentContainer>\n            {/* border */}\n            <BorderArea model={model} overflow={overflow} onResize={onResize} />\n          </>\n        </Form>\n      </ErrorBoundary>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { injectable } from 'inversify';\nimport { type FlowDocumentContribution } from '@flowgram-adapter/free-layout-editor';\nimport { lazyInject } from '@flowgram-adapter/free-layout-editor';\nimport { type WorkflowDocument } from '@flowgram-adapter/free-layout-editor';\nimport {\n  type FlowRendererContribution,\n  FlowRendererKey,\n  type FlowRendererRegistry,\n} from '@coze-workflow/render';\nimport { WorkflowRenderKey } from '@coze-workflow/nodes';\nimport { StandardNodeType } from '@coze-workflow/base';\n\nimport { WorkflowSaveService } from '../services';\nimport { SubCanvasRender } from '../components/sub-canvas';\nimport { NodeRender } from '../components/node-render';\nimport { LinePopover } from '../components/line-popover';\nimport { CommentRender } from '../components/comment';\n\nconst LINE_POPOVER = 'line-popover';\n\n@injectable()\nexport class WorkflowPageContribution\n  implements\n    FlowRendererContribution,\n    FlowDocumentContribution<WorkflowDocument>\n{\n  @lazyInject(WorkflowSaveService) declare saveService: WorkflowSaveService;\n  protected document: WorkflowDocument;\n\n  /**\n   * Regedit single data\n   * @param document\n   */\n  // registerDocument(document: WorkflowDocument): void {\n  //   document.registerNodeDatas(...createNodeEntityDatas());\n  // }\n  /**\n   * load data\n   */\n  async loadDocument(doc: WorkflowDocument): Promise<void> {\n    this.document = doc;\n    await this.saveService.loadDocument(doc);\n  }\n\n  /**\n   * Register node rendering component\n   * @param registry\n   */\n  registerRenderer(renderer: FlowRendererRegistry): void {\n    // Register node rendering component\n    renderer.registerReactComponent(FlowRendererKey.NODE_RENDER, NodeRender);\n\n    renderer.registerReactComponent(\n      FlowRendererKey.SUB_CANVAS,\n      SubCanvasRender,\n    );\n\n    renderer.registerReactComponent(StandardNodeType.Comment, CommentRender);\n\n    renderer.registerReactComponent(LINE_POPOVER, LinePopover as any);\n\n    // Register the node above the test run related rendering components\n    renderer.registerReactComponent(\n      WorkflowRenderKey.EXECUTE_STATUS_BAR,\n      () => null,\n    );\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Skeleton } from '@coze-arch/bot-semi';\n\nimport styles from './index.module.less';\n\nexport const NodePlaceholder = () => (\n  <Skeleton\n    loading={true}\n    active={true}\n    placeholder={\n      <div className={styles.placeholder}>\n        <div className={styles.hd}>\n          <div className={styles.line}>\n            <Skeleton.Avatar shape=\"square\" className={styles.avatar} />\n            <Skeleton.Title className={styles.title} />\n          </div>\n          <Skeleton.Paragraph rows={2} />\n        </div>\n        <Skeleton.Paragraph className={styles.paragraph} rows={2} />\n        <Skeleton.Paragraph className={styles.paragraph} rows={2} />\n        <div\n          className={`${styles.paragraph} ${styles['last-paragraph']}`}\n        ></div>\n      </div>\n    }\n  />\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { injectable } from 'inversify';\nimport {\n  type NodeContribution,\n  type NodeManager,\n  registerNodeErrorRender,\n  registerNodePlaceholderRender,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport { nodeSystemErrorRender } from '../components/node-system-error-render';\nimport { NodePlaceholder } from '../components/node-placeholder';\n\n@injectable()\nexport class WorkflowNodeContribution implements NodeContribution {\n  onRegister(nodeManager: NodeManager) {\n    registerNodeErrorRender(nodeManager, nodeSystemErrorRender);\n    registerNodePlaceholderRender(nodeManager, NodePlaceholder);\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ContainerModule } from 'inversify';\nimport {\n  FormContribution,\n  NodeContribution,\n} from '@flowgram-adapter/free-layout-editor';\nimport { FlowDocumentContribution } from '@flowgram-adapter/free-layout-editor';\nimport { PlaygroundContext } from '@flowgram-adapter/free-layout-editor';\nimport {\n  bindConfigEntity,\n  WorkflowDocumentOptions,\n  WorkflowDragService,\n} from '@flowgram-adapter/free-layout-editor';\nimport { bindContributions } from '@flowgram-adapter/common';\nimport {\n  TestRunService,\n  TestRunReporterService,\n} from '@coze-workflow/test-run/plugins';\nimport {\n  FlowRendererContribution,\n  WorkflowShortcutsContribution,\n} from '@coze-workflow/render';\nimport { ValidationService } from '@coze-workflow/base/services';\n\nimport {\n  bindShortcuts,\n  WorkflowCopyShortcutsContribution,\n  // WorkflowDeleteShortcutsContribution,\n  WorkflowExportShortcutsContribution,\n  WorkflowLayoutShortcutsContribution,\n  WorkflowLoadShortcutsContribution,\n  WorkflowPasteShortcutsContribution,\n  WorkflowSelectAllShortcutsContribution,\n  WorkflowZoomShortcutsContribution,\n} from '@/shortcuts';\nimport { WorkflowNodesV2Contribution } from '@/container/workflow-nodes-v2-contribution';\n\nimport { WorkflowPlaygroundContext } from '../workflow-playground-context';\nimport { WorkflowOperationServiceProvider } from '../services/workflow-operation-service';\nimport {\n  WorkflowLinesService,\n  WorkflowLinesServiceProvider,\n} from '../services/workflow-line-service';\nimport {\n  WorkflowCustomDragService,\n  WorkflowEditService,\n  WorkflowOperationService,\n  WorkflowRunService,\n  WorkflowSaveService,\n  WorkflowValidationService,\n  WorkflowModelsService,\n  WorkflowFloatLayoutService,\n  ChatflowService,\n  NodeVersionService,\n  RoleService,\n  RelatedCaseDataService,\n  TestRunReporterService as WorkflowTestRunReporterService,\n  ValueExpressionService,\n  ValueExpressionServiceImpl,\n  DatabaseNodeService,\n  DatabaseNodeServiceImpl,\n  TriggerService,\n  PluginNodeService,\n  SubWorkflowNodeService,\n  WorkflowDependencyService,\n} from '../services';\nimport { WorkflowDocumentCustomOptions } from '../options/workflow-document-custom-options';\nimport { FormAbilityExtensionsFormContribution } from '../form-extensions';\nimport {\n  WorkflowDependencyStateEntity,\n  WorkflowExecStateEntity,\n  WorkflowGlobalStateEntity,\n  WorkflowTestFormStateEntity,\n} from '../entities';\nimport { WorkflowPageContribution } from './workflow-page-contribution';\nimport { WorkflowNodeContribution } from './workflow-node-contribution';\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport const WorkflowPageContainerModule = new ContainerModule(\n  // eslint-disable-next-line max-params\n  (bind, _unbind, _isbound, rebind) => {\n    /**\n     * validation\n     */\n    bind(ValidationService).to(WorkflowValidationService).inSingletonScope();\n    // Combine old identifiers\n    bind(WorkflowValidationService).toService(ValidationService);\n\n    bind(WorkflowEditService).toSelf().inSingletonScope();\n    bind(TestRunReporterService)\n      .to(WorkflowTestRunReporterService)\n      .inSingletonScope();\n    bind(WorkflowTestRunReporterService).toService(TestRunReporterService);\n    bind(WorkflowRunService).toSelf().inSingletonScope();\n    bind(TestRunService).toService(WorkflowRunService);\n    bind(WorkflowSaveService).toSelf().inSingletonScope();\n    bind(WorkflowOperationService).toSelf().inSingletonScope();\n    bind(WorkflowFloatLayoutService).toSelf().inSingletonScope();\n    bind(NodeVersionService).toSelf().inSingletonScope();\n    bind(RoleService).toSelf().inSingletonScope();\n    bind(PluginNodeService).toSelf().inSingletonScope();\n    bind(SubWorkflowNodeService).toSelf().inSingletonScope();\n    bind(RelatedCaseDataService).toSelf().inSingletonScope();\n    bind(WorkflowDependencyService).toSelf().inSingletonScope();\n\n    bind(ChatflowService).toSelf().inSingletonScope();\n\n    bind(WorkflowOperationServiceProvider)\n      .toDynamicValue(ctx => () => ctx.container.get(WorkflowOperationService))\n      .inSingletonScope();\n\n    bind(WorkflowPlaygroundContext).toSelf().inSingletonScope();\n    bind(WorkflowModelsService).toSelf().inSingletonScope();\n\n    bind(WorkflowDocumentCustomOptions).toSelf().inSingletonScope();\n    rebind(WorkflowDocumentOptions).toService(WorkflowDocumentCustomOptions);\n    bind(WorkflowLinesService).toSelf().inSingletonScope();\n    bind(WorkflowCustomDragService).toSelf().inSingletonScope();\n    rebind(WorkflowDragService).toService(WorkflowCustomDragService);\n\n    bind(WorkflowLinesServiceProvider)\n      .toDynamicValue(ctx => () => ctx.container.get(WorkflowLinesService))\n      .inSingletonScope();\n\n    rebind(PlaygroundContext).toService(WorkflowPlaygroundContext);\n    bindConfigEntity(bind, WorkflowExecStateEntity);\n    bindConfigEntity(bind, WorkflowGlobalStateEntity);\n    bindConfigEntity(bind, WorkflowTestFormStateEntity);\n    bindConfigEntity(bind, WorkflowDependencyStateEntity);\n    bindContributions(bind, WorkflowPageContribution, [\n      FlowDocumentContribution,\n      FlowRendererContribution,\n    ]);\n    bindShortcuts(bind, WorkflowShortcutsContribution, [\n      WorkflowCopyShortcutsContribution,\n      WorkflowPasteShortcutsContribution,\n      // WorkflowDeleteShortcutsContribution,\n      WorkflowLayoutShortcutsContribution,\n      WorkflowZoomShortcutsContribution,\n      WorkflowExportShortcutsContribution,\n      WorkflowLoadShortcutsContribution,\n      WorkflowSelectAllShortcutsContribution,\n    ]);\n    bindContributions(bind, FormAbilityExtensionsFormContribution, [\n      FormContribution,\n    ]);\n    bindContributions(bind, WorkflowNodeContribution, [NodeContribution]);\n    // WorkflowPageContainerModule can be rewritten as function generation, receive relevant props, and can currently consider receiving only WorkflowNodesV2Contribution parameters\n    bindContributions(bind, WorkflowNodesV2Contribution, [\n      FlowDocumentContribution,\n    ]);\n\n    bind(ValueExpressionService)\n      .to(ValueExpressionServiceImpl)\n      .inSingletonScope();\n\n    bind(DatabaseNodeService).to(DatabaseNodeServiceImpl).inSingletonScope();\n\n    bind(TriggerService).toSelf().inSingletonScope();\n  },\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  createContext,\n  useContext,\n  forwardRef,\n  type PropsWithChildren,\n  useImperativeHandle,\n} from 'react';\n\nimport { type AddNodeRef } from '@/typing';\nimport { useAddNode } from '@/hooks/use-add-node';\n\nexport type AddNodeModalContextType = Partial<\n  Pick<\n    ReturnType<typeof useAddNode>,\n    'openImageflow' | 'openWorkflow' | 'openPlugin' | 'updateAddNodePosition'\n  >\n>;\nexport type AddNodeModalProviderRefType = AddNodeRef;\n\nconst AddNodeModalContext = createContext<AddNodeModalContextType>({});\n\nexport const useAddNodeModalContext = () => useContext(AddNodeModalContext);\n\nexport const AddNodeModalProvider = forwardRef<\n  AddNodeModalProviderRefType,\n  PropsWithChildren<{ readonly: boolean }>\n>(({ readonly, children }, ref) => {\n  const {\n    handleAddNode,\n    updateAddNodePosition,\n    modals,\n    openPlugin,\n    openWorkflow,\n    openImageflow,\n  } = useAddNode();\n  useImperativeHandle(\n    ref,\n    () => ({\n      handleAddNode: (item, coord, isDrag) => {\n        if (readonly) {\n          return;\n        }\n        handleAddNode(item, coord, isDrag);\n      },\n    }),\n    [readonly, handleAddNode],\n  );\n  return (\n    <AddNodeModalContext.Provider\n      value={{ openPlugin, openWorkflow, openImageflow, updateAddNodePosition }}\n    >\n      {children}\n      {modals}\n    </AddNodeModalContext.Provider>\n  );\n});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createContext } from 'react';\n\nexport type NodeRenderScene =\n  | 'new-node-render'\n  | 'node-side-sheet'\n  | 'old-node-render'\n  | 'side-expand-modal'\n  | undefined;\n\n/** Used to determine under what scenarios the node-render front end is used */\nexport const NodeRenderSceneContext = createContext<NodeRenderScene>(undefined);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ConfigEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport type {\n  TestFormSchema,\n  FormDataType,\n  TestFormDefaultValue,\n} from '../components/test-run/types';\nimport { TestRunDataSource } from '../components/test-run/constants';\nimport { WorkflowGlobalStateEntity } from './workflow-global-state-entity';\n\ninterface WorkflowTestFormState {\n  /** Test run form is visible */\n  formVisible: boolean;\n  /** Only one test run can be run at a time for freezing */\n  frozen: string | null;\n  autoGenerating: boolean;\n\n  /** Coze graph 2.0 Node panel */\n  commonSheetKey: null | string;\n  testNodeFormVisible: boolean;\n}\n\nexport class WorkflowTestFormStateEntity extends ConfigEntity<WorkflowTestFormState> {\n  static type = 'WorkflowTestFormStateEntity';\n\n  /** Schema without reactive */\n  formSchema?: TestFormSchema;\n\n  testRunDataSource = TestRunDataSource.User;\n\n  /**\n   * Cache user-filled data\n   */\n  formDataCacheMap = new Map<string, FormDataType>();\n\n  /**\n   * Form default, lower priority than formDataCache\n   */\n  formDefaultValue: Array<TestFormDefaultValue> = [];\n\n  getDefaultConfig(): WorkflowTestFormState {\n    return {\n      formVisible: false,\n      frozen: null,\n      autoGenerating: false,\n      commonSheetKey: null,\n      testNodeFormVisible: false,\n    };\n  }\n  openTestForm(schema: TestFormSchema) {\n    this.formSchema = schema;\n    this.updateConfig({\n      formVisible: true,\n    });\n  }\n  closeTestForm() {\n    this.updateConfig({\n      formVisible: false,\n    });\n    this.testRunDataSource = TestRunDataSource.User;\n  }\n\n  /**\n   * Set testForm to cache data\n   */\n  setFormData(id: string, data: FormDataType) {\n    this.formDataCacheMap.set(id, data);\n  }\n\n  /**\n   * Set the cached data for the currently open testForm\n   */\n  setThisFormData(data: FormDataType) {\n    /** This method does not need to specify an id. To ensure that formSchema is valid, it is only allowed when the testForm is open */\n    if (!this.config.formVisible) {\n      return;\n    }\n    const id = this.formSchema?.id;\n    if (id) {\n      this.setFormData(id, data);\n    }\n  }\n\n  /**\n   * Does testForm have cached data?\n   */\n  hasFormData(id: string) {\n    return this.formDataCacheMap.has(id);\n  }\n\n  /**\n   * Get testForm cache data\n   */\n  getFormData(id: string) {\n    return this.formDataCacheMap.get(id);\n  }\n\n  /**\n   * Clear all cached data, must be done when the canvas is destroyed\n   */\n  clearFormData() {\n    this.formDataCacheMap.clear();\n  }\n\n  setTestFormDefaultValue(defaultValues: Array<TestFormDefaultValue>) {\n    this.formDefaultValue = defaultValues;\n  }\n\n  getTestFormDefaultValue(id?: string): TestFormDefaultValue | undefined {\n    const globalState = this.entityManager.getEntity<WorkflowGlobalStateEntity>(\n      WorkflowGlobalStateEntity,\n    );\n\n    return (\n      this.formDefaultValue.find(item => item.node_id === id) ??\n      // PlaygroundProps can pass in test run form defaults\n      globalState?.config.playgroundProps.testFormDefaultValues?.find(\n        item => item.node_id === id,\n      )\n    );\n  }\n\n  clearTestFormDefaultValue() {\n    this.formDefaultValue = [];\n  }\n\n  /** Freeze test run */\n  freezeTestRun(id: string) {\n    this.updateConfig({\n      frozen: id,\n    });\n  }\n  /** Thaw test run */\n  unfreezeTestRun() {\n    this.updateConfig({\n      frozen: null,\n    });\n  }\n\n  get autoGenerating() {\n    return this.config.autoGenerating;\n  }\n  set autoGenerating(val: boolean) {\n    this.updateConfig({\n      autoGenerating: val,\n    });\n  }\n\n  get commonSheetKey() {\n    return this.config.commonSheetKey;\n  }\n\n  openCommonSheet(key: string) {\n    this.updateConfig({\n      commonSheetKey: key,\n    });\n  }\n  closeCommonSheet() {\n    this.updateConfig({\n      commonSheetKey: null,\n    });\n  }\n  showTestNodeForm() {\n    this.updateConfig({\n      testNodeFormVisible: true,\n    });\n  }\n  closeTestNodeForm() {\n    this.updateConfig({\n      testNodeFormVisible: false,\n    });\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type Workflow } from '@coze-arch/idl/workflow_api';\nimport { ConfigEntity } from '@flowgram-adapter/free-layout-editor';\nimport { Emitter } from '@flowgram-adapter/common';\n\ninterface WorkflowTemplateState {\n  visible: boolean;\n  previewVisible: boolean;\n  previewInfo: Workflow;\n  dataList: Workflow[];\n}\n\nexport class WorkflowTemplateStateEntity extends ConfigEntity<WorkflowTemplateState> {\n  static type = 'WorkflowTemplateStateEntity';\n\n  visible: boolean;\n  previewVisible: boolean;\n  previewInfo: Workflow;\n  dataList: Workflow[];\n\n  // Triggered after update\n  onPreviewUpdatedEmitter = new Emitter();\n  onPreviewUpdated = this.onPreviewUpdatedEmitter.event;\n\n  getDefaultConfig(): WorkflowTemplateState {\n    return {\n      visible: false,\n      previewVisible: false,\n      previewInfo: {},\n      dataList: [],\n    };\n  }\n\n  setTemplateList(list: Workflow[]) {\n    this.updateConfig({\n      dataList: list,\n    });\n  }\n\n  openTemplate() {\n    this.updateConfig({\n      visible: true,\n    });\n  }\n\n  closeTemplate() {\n    this.updateConfig({\n      visible: false,\n    });\n  }\n\n  public get templatePreviewInfo() {\n    return this.config.previewInfo;\n  }\n\n  public get templateVisible() {\n    return this.config.visible;\n  }\n\n  public get templateList() {\n    return this.config.dataList;\n  }\n\n  openPreview(templateInfo) {\n    this.updateConfig({\n      previewVisible: true,\n      previewInfo: templateInfo,\n    });\n\n    this.onPreviewUpdatedEmitter.fire({\n      previewVisible: true,\n    });\n  }\n  closePreview() {\n    this.updateConfig({\n      previewVisible: false,\n      previewInfo: undefined,\n    });\n\n    this.onPreviewUpdatedEmitter.fire({\n      previewVisible: false,\n    });\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ConfigEntity } from '@flowgram-adapter/free-layout-editor';\n\ninterface WorkflowDependencyState {\n  refreshModalVisible: boolean;\n  saveVersion: bigint;\n  refreshFunc: (() => void) | undefined;\n}\n\nexport class WorkflowDependencyStateEntity extends ConfigEntity<WorkflowDependencyState> {\n  static type = 'WorkflowDependencyStateEntity';\n  getDefaultConfig(): WorkflowDependencyState {\n    return {\n      refreshModalVisible: false,\n      saveVersion: BigInt(0),\n      refreshFunc: undefined,\n    };\n  }\n\n  setRefreshModalVisible(visible: boolean) {\n    this.updateConfig({\n      refreshModalVisible: visible,\n    });\n  }\n\n  public get refreshModalVisible() {\n    return this.config.refreshModalVisible;\n  }\n\n  public get saveVersion() {\n    return this.config.saveVersion;\n  }\n\n  public setSaveVersion(version: bigint) {\n    this.updateConfig({\n      saveVersion: version,\n    });\n  }\n\n  public addSaveVersion() {\n    const nextVersion = this.config.saveVersion + BigInt(1);\n    this.updateConfig({\n      saveVersion: nextVersion,\n    });\n  }\n\n  public get refreshFunc() {\n    return this.config.refreshFunc;\n  }\n\n  public setRefreshFunc(func: () => void) {\n    this.updateConfig({\n      refreshFunc: func,\n    });\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ValidateError } from '@coze-workflow/base/services';\nimport {\n  type GetWorkFlowProcessData,\n  WorkflowExeHistoryStatus,\n  type NodeResult,\n  type NodeEvent,\n  type EventType,\n} from '@coze-workflow/base/api';\nimport { type WorkflowExecStatus } from '@coze-workflow/base';\nimport { ConfigEntity } from '@flowgram-adapter/free-layout-editor';\n\nexport type NodeError = ValidateError;\n\nexport type NodeErrorMap = Map<string, NodeError[]>;\n\n/**\n * Current process status\n */\nexport interface WorkflowExecState extends GetWorkFlowProcessData {\n  executeId: string;\n  // Is there any execution history?\n  exeHistoryStatus: WorkflowExeHistoryStatus;\n  /**\n   * Current workflow view state\n   */\n  viewStatus?: WorkflowExecStatus;\n\n  /**\n   * Run Results Panel Hidden Status\n   */\n  resultSideSheetVisible: boolean;\n  resultSideSheetLoading: boolean;\n\n  // The version here is temporarily meaningless, just to trigger an errorMap update\n  version?: number;\n\n  // error message\n  nodeErrorMap: NodeErrorMap;\n\n  // Some errors cannot be located to specific nodes and are placed in systemError\n  systemError?: string;\n\n  // Execution ID\n  executeLogId?: string;\n\n  // Whether to run as a single node\n  isSingleMode?: boolean;\n\n  // Running project environment id\n  projectId?: string;\n\n  nodeEvents: NodeEvent[];\n}\n\nexport interface NodeErrorSetting {\n  showError: boolean; // Whether to display errors\n}\n\n/**\n * Process global state management (singleton)\n */\nexport class WorkflowExecStateEntity extends ConfigEntity<WorkflowExecState> {\n  static type = 'WorkflowExecStateEntity';\n\n  readonly nodeResultMap = new Map<string, NodeResult>();\n  readonly nodeErrorSettingMap = new Map<string, NodeErrorSetting>();\n\n  getDefaultConfig(): WorkflowExecState {\n    return {\n      logID: '',\n      executeId: '',\n      exeHistoryStatus: WorkflowExeHistoryStatus.NoHistory,\n      workflowExeCost: '',\n      resultSideSheetVisible: false,\n      resultSideSheetLoading: false,\n      nodeErrorMap: new Map(),\n      nodeEvents: [],\n      projectId: '',\n    };\n  }\n\n  getNodeExecResult(nodeId: string): NodeResult | undefined {\n    return this.nodeResultMap.get(nodeId);\n  }\n\n  setNodeExecResult(nodeId: string, result: NodeResult): void {\n    this.nodeResultMap.set(nodeId, result);\n  }\n\n  get hasNodeResult() {\n    return this.nodeResultMap.size > 0;\n  }\n\n  getEndNodeResult() {\n    const nodeResults = Object.fromEntries(this.nodeResultMap);\n    const endNodeId = Object.keys(nodeResults).find(\n      key => nodeResults[key].NodeType === 'End',\n    );\n\n    if (endNodeId) {\n      return this.getNodeExecResult(endNodeId);\n    }\n  }\n\n  clearNodeResult(): void {\n    this.nodeResultMap.clear();\n\n    this.updateConfig({\n      version: Date.now(),\n    });\n  }\n\n  setNodeError(nodeId: string, nodeError: NodeError[]) {\n    this.config.nodeErrorMap.set(nodeId, nodeError);\n\n    this.updateConfig({\n      version: Date.now(),\n    });\n  }\n  /** batch setup */\n  setNodeErrors(map: { [nodeId: string]: NodeError[] }) {\n    Object.keys(map).forEach(nodeId => {\n      const nodeError = map[nodeId];\n      this.config.nodeErrorMap.set(nodeId, nodeError);\n    });\n    this.updateConfig({\n      version: Date.now(),\n    });\n  }\n\n  getNodeError(nodeId: string) {\n    return this.config.nodeErrorMap.get(nodeId);\n  }\n\n  clearNodeError(nodeId: string) {\n    this.config.nodeErrorMap.delete(nodeId);\n  }\n  clearNodeErrorMap() {\n    this.config.nodeErrorMap.clear();\n  }\n\n  openSideSheet() {\n    this.updateConfig({\n      resultSideSheetVisible: true,\n    });\n  }\n\n  closeSideSheet() {\n    this.updateConfig({\n      resultSideSheetVisible: false,\n    });\n  }\n\n  get nodeErrors() {\n    return Object.fromEntries(this.config.nodeErrorMap);\n  }\n\n  get resultSideSheetVisible() {\n    return this.config.resultSideSheetVisible;\n  }\n\n  get resultSideSheetLoading() {\n    return this.config.resultSideSheetLoading;\n  }\n\n  get executeLogId() {\n    return this.config.executeLogId;\n  }\n\n  get logID() {\n    return this.config.logID;\n  }\n\n  setNodeErrorSetting(nodeId: string, result: NodeErrorSetting): void {\n    this.nodeErrorSettingMap.set(nodeId, result);\n  }\n\n  getNodeErrorSetting(nodeId: string): NodeErrorSetting | undefined {\n    return this.nodeErrorSettingMap.get(nodeId);\n  }\n\n  clearNodeErrorSetting(): void {\n    this.nodeErrorSettingMap.clear();\n  }\n\n  setNodeEvents(nodeEvents?: NodeEvent[]) {\n    if (!nodeEvents) {\n      return;\n    }\n    this.config.nodeEvents = nodeEvents;\n  }\n\n  getNodeEvent(eventType: EventType): NodeEvent | undefined {\n    return this.config.nodeEvents.find(event => event.type === eventType);\n  }\n\n  clearNodeEvents() {\n    this.config.nodeEvents = [];\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/consistent-type-assertions */\n/* eslint-disable max-lines */\nimport { isFunction } from 'lodash-es';\nimport dayjs from 'dayjs';\nimport {\n  ConfigEntity,\n  PlaygroundConfigEntity,\n} from '@flowgram-adapter/free-layout-editor';\nimport { type WorkflowJSON } from '@flowgram-adapter/free-layout-editor';\nimport { PUBLIC_SPACE_ID } from '@coze-workflow/base/constants';\nimport {\n  workflowApi,\n  type Workflow,\n  OperateType,\n  WorkFlowDevStatus,\n  type VCSCanvasData,\n  type OperationInfo,\n  VCSCanvasType,\n  WorkflowMode,\n  WorkFlowStatus,\n  WorkFlowType,\n  type GetHistorySchemaRequest,\n  CollaboratorMode,\n  PersistenceModel,\n  BindBizType,\n} from '@coze-workflow/base/api';\nimport { isGeneralWorkflow } from '@coze-workflow/base';\nimport { REPORT_EVENTS } from '@coze-arch/report-events';\nimport { reporter } from '@coze-arch/logger';\nimport { I18n, type I18nKeysNoOptionsType } from '@coze-arch/i18n';\nimport { CustomError } from '@coze-arch/bot-error';\nimport { SpaceType } from '@coze-arch/bot-api/playground_api';\nimport { SpaceMode, type BotSpace } from '@coze-arch/bot-api/developer_api';\nimport { DeveloperApi } from '@coze-arch/bot-api';\n\nconst getAutoSaveTime = timestamp => {\n  let autoSaveTime = dayjs().format('HH:mm:ss');\n\n  /**\n   * If the backend has a return update time and the update time is unix timestamp, it will be used, otherwise the bottom cover will display the fake time.\n   */\n  if (timestamp && typeof timestamp === 'number') {\n    const time = dayjs.unix(timestamp);\n    if (time.isValid()) {\n      const target = dayjs.unix(timestamp);\n      const now = dayjs();\n      if (now.diff(target, 'y') >= 1) {\n        autoSaveTime = target.format('YYYY-MM-DD HH:mm:ss');\n      } else if (!now.isSame(target, 'd')) {\n        autoSaveTime = target.format('MM-DD HH:mm:ss');\n      } else {\n        autoSaveTime = target.format('HH:mm:ss');\n      }\n    }\n  }\n\n  return autoSaveTime;\n};\n\nimport { getIsInitWorkflow } from '@/utils/get-is-init-workflow';\n\nimport { type WorkflowPlaygroundProps } from '../typing';\nimport { DataSetStore } from './workflow-dataset-store-entity';\n\nexport type WorkflowInfo = Omit<Workflow, 'status'> & {\n  status?: WorkFlowDevStatus | WorkFlowStatus;\n  vcsData?: VCSCanvasData;\n  operationInfo?: OperationInfo;\n  is_bind_agent?: boolean;\n  bind_biz_id?: string;\n  bind_biz_type?: number;\n  workflow_version?: string;\n} & {\n  /**\n   * The spaceId returned in the workflow details is not equal to the value of the current space in the official example scenario\n   */\n  workflowSourceSpaceId?: string;\n};\n\nexport enum WorkflowExecStatus {\n  DEFAULT = 'default',\n  /** in progress */\n  EXECUTING = 'executing',\n  /** End of execution (there is still an end of execution banner at this time, and the workflow is disabled) */\n  DONE = 'done',\n}\n\n/**\n * Current process status\n */\nexport interface WorkflowGlobalState {\n  /** Workflow component pass-in properties */\n  playgroundProps: WorkflowPlaygroundProps;\n  workflowId: string;\n  /**  Canvas loading */\n  loading: boolean;\n  /**  Save interface request time is shorter than save. */\n  saveLoading: boolean;\n  /**  Saving, including debouncing time */\n  saving: boolean;\n  savingError?: boolean;\n  loadingError?: string;\n  /**\n   * In release\n   */\n  publishing: boolean;\n  /**\n   * Workflow auto-save time\n   */\n  autoSaveTime?: string;\n  autoSaveTimestamp?: number;\n\n  /** Workflow Details */\n  info: WorkflowInfo;\n\n  /** Current space type */\n  spaceType?: SpaceType;\n  /** List of user spaces */\n  spaceList: BotSpace[];\n  /** Spatial Mode */\n  spaceMode: SpaceMode;\n\n  /** Is the process in preview state? */\n  preview: boolean;\n\n  /**\n   * Workflow view state (distinguished from publication state)\n   * @default WorkflowExecStatus.DEFAULT\n   */\n  viewStatus?: WorkflowExecStatus;\n\n  /** Has it been released? When the process is first released, it will be registered as a plugin with the bot. */\n  pluginId: string;\n\n  // Add is_bind_agent field, whether the process is bound to the bot as an agent\n  isBindAgent: boolean;\n\n  /** Is Douyin bound? */\n  isBindDouyin: boolean;\n\n  /** Is there an update to the Workflow stock plug-in, and if so, modifies the relevant form data and requires a practice run */\n  inPluginUpdated?: boolean;\n  /* Are you checking history? */\n  historyStatus?: OperateType;\n  /** Bound business scenario id */\n  bindBizID?: string;\n  /** bound business type */\n  bindBizType?: number;\n  /** Is the node sidebar bed open? */\n  nodeSideSheetVisible?: boolean;\n  schemaGray?: {\n    loop?: string;\n    batch?: string;\n  };\n\n  /** Whether the nodes and lines of the process are in the initial state, only the entry and exit parameters of the beginning and end nodes are judged */\n  isInitWorkflow?: boolean;\n\n  /**\n   * Knowledge Base Information\n   */\n  sharedDataSet?: DataSetStore;\n}\n\n/**\n * Process global state management (singleton)\n */\nexport class WorkflowGlobalStateEntity extends ConfigEntity<WorkflowGlobalState> {\n  static type = 'WorkflowGlobalStateEntity';\n\n  getDefaultConfig(): WorkflowGlobalState {\n    return {\n      historyStatus: undefined,\n      playgroundProps: Object.create(null),\n      workflowId: '',\n      loading: true,\n      autoSaveTime: dayjs().format('HH:mm:ss'),\n      saveLoading: false,\n      saving: false,\n      preview: false,\n      publishing: false,\n      info: {},\n      viewStatus: WorkflowExecStatus.DEFAULT,\n      spaceList: [],\n      spaceMode: SpaceMode.Normal,\n      pluginId: '',\n      isBindAgent: false,\n      inPluginUpdated: false,\n      nodeSideSheetVisible: false,\n      isInitWorkflow: false,\n      isBindDouyin: false,\n      sharedDataSet: new DataSetStore(),\n    };\n  }\n\n  async load(\n    workflowId: string,\n    spaceId: string,\n  ): Promise<WorkflowJSON | undefined> {\n    if (!workflowId) {\n      throw new CustomError(\n        REPORT_EVENTS.parmasValidation,\n        I18n.t('workflow_detail_error_missing_id'),\n      );\n    }\n\n    // Load workflow tcc configuration\n    await Promise.all([this.setSpaceInfo()]);\n\n    const workflowInfo = await this.queryWorkflowDetail(workflowId, spaceId);\n    const autoSaveTime = getAutoSaveTime(workflowInfo?.update_time);\n\n    /** Determine whether the process is in preview state, from the official process, component configuration read-only readonly, non-vcs mode is not the creator's process, vcs mode has no collaborator permission, and the process is in preview state */\n    const isVcsMode = workflowInfo.collaborator_mode === CollaboratorMode.Open;\n    const isReadOnly = this.config.playgroundProps.readonly;\n    const isGuanFangType = workflowInfo?.type === WorkFlowType.GuanFang;\n    const isProjectPreview = Boolean(\n      this.projectId && this.config.playgroundProps.projectCommitVersion,\n    );\n    const isUserType = workflowInfo?.type === WorkFlowType.User;\n    const hasSingleEditPermission = !isVcsMode && workflowInfo.creator?.self;\n    const hasVcsEditPermission = isVcsMode && workflowInfo.vcsData?.can_edit;\n    const preview =\n      isReadOnly ||\n      isGuanFangType ||\n      isProjectPreview ||\n      (isUserType && !(hasSingleEditPermission || hasVcsEditPermission));\n\n    const jsonStr = workflowInfo?.schema_json;\n    const workflowJSON = (\n      jsonStr ? JSON.parse(jsonStr) : undefined\n    ) as WorkflowJSON;\n\n    const isInitWorkflow = getIsInitWorkflow(\n      workflowJSON,\n      workflowInfo?.flow_mode || WorkflowMode.Workflow,\n    );\n\n    this.updateConfig({\n      workflowId,\n      pluginId:\n        workflowInfo?.plugin_id && workflowInfo.plugin_id !== '0'\n          ? workflowInfo.plugin_id\n          : '',\n      info: workflowInfo,\n      autoSaveTime,\n      autoSaveTimestamp: workflowInfo?.update_time as number,\n      preview,\n      isBindAgent: workflowInfo?.is_bind_agent,\n      bindBizID: workflowInfo?.bind_biz_id,\n      bindBizType: workflowInfo?.bind_biz_type,\n      historyStatus: undefined,\n      schemaGray: (\n        workflowJSON as WorkflowJSON & {\n          versions: {\n            loop: string;\n            batch: string;\n          };\n        }\n      )?.versions,\n      isInitWorkflow,\n    });\n\n    // Update the readonly status of the canvas\n    this.entityManager\n      .getEntity<PlaygroundConfigEntity>(PlaygroundConfigEntity)\n      ?.updateConfig({\n        /** Initially, the preview state = > canvas is not editable */\n        readonly: preview,\n      });\n    return workflowJSON;\n  }\n\n  async loadHistory(\n    params: Omit<GetHistorySchemaRequest, 'workflow_id' | 'space_id'>,\n  ) {\n    const workflowId = this.workflowId || this.playgroundProps.workflowId;\n    const spaceId = this.spaceId || this.playgroundProps.spaceId;\n    const projectCommitVersion =\n      this.projectCommitVersion || this.playgroundProps.projectCommitVersion;\n    const { projectId } = this;\n\n    const {\n      commit_id,\n      type: operateType,\n      env,\n      log_id,\n      execute_id,\n      sub_execute_id,\n    } = params;\n\n    if (!workflowId || !spaceId) {\n      throw new CustomError(\n        REPORT_EVENTS.parmasValidation,\n        I18n.t(\n          'loadHistory error: no workflowId or spaceId' as I18nKeysNoOptionsType,\n        ),\n      );\n    }\n\n    const { data } = await workflowApi.GetHistorySchema({\n      workflow_id: workflowId,\n      space_id: spaceId,\n      commit_id,\n      log_id,\n      execute_id,\n      sub_execute_id,\n      type: operateType,\n      env,\n      project_version: projectCommitVersion,\n      project_id: projectId,\n    });\n\n    const {\n      schema,\n      name,\n      describe,\n      url,\n      flow_mode,\n      bind_biz_id,\n      bind_biz_type,\n    } = data;\n    const { vcsData } = this.info;\n    const workflowInfo: WorkflowInfo = {\n      workflow_id: workflowId,\n      space_id: spaceId,\n      name,\n      desc: describe,\n      flow_mode: flow_mode ?? WorkflowMode.Workflow,\n      url,\n      status: WorkFlowDevStatus.HadSubmit,\n      type: WorkFlowType.User,\n      schema_json: schema,\n      collaborator_mode: CollaboratorMode.Open,\n      vcsData: {\n        ...(vcsData || {}),\n        type:\n          operateType === OperateType.PublishOperate\n            ? VCSCanvasType.Publish\n            : VCSCanvasType.Submit,\n        submit_commit_id: commit_id,\n      },\n    };\n\n    const workflowJSON = (\n      schema ? JSON.parse(schema) : undefined\n    ) as WorkflowJSON;\n\n    this.updateConfig({\n      workflowId,\n      info: workflowInfo,\n      preview: true,\n      bindBizID: bind_biz_id,\n      bindBizType: bind_biz_type,\n      historyStatus: operateType,\n      schemaGray: (\n        workflowJSON as WorkflowJSON & {\n          versions: {\n            loop: string;\n            batch: string;\n          };\n        }\n      )?.versions,\n    });\n\n    // Update the readonly status of the canvas\n    this.entityManager\n      .getEntity<PlaygroundConfigEntity>(PlaygroundConfigEntity)\n      ?.updateConfig({\n        /** Initially, the preview state = > canvas is not editable */\n        readonly: true,\n      });\n\n    return workflowJSON;\n  }\n\n  /** Acquire space-related information */\n  async setSpaceInfo() {\n    if (!this.config.spaceList.length) {\n      const { bot_space_list } = await DeveloperApi.SpaceList();\n      this.updateConfig({\n        spaceList: bot_space_list,\n      });\n    }\n    const { spaceList } = this.config;\n\n    if (this.spaceId === PUBLIC_SPACE_ID) {\n      this.updateConfig({\n        spaceType: SpaceType.Team,\n        spaceMode: SpaceMode.Normal,\n      });\n      return;\n    }\n    const currentSpace = spaceList.find(space => space.id === this.spaceId);\n\n    if (!currentSpace) {\n      throw new Error(\"space id don't in list\");\n    }\n    const { space_type, space_mode } = currentSpace;\n\n    this.updateConfig({\n      spaceType: space_type,\n      spaceMode: space_mode,\n    });\n  }\n\n  get isPersonalSpace(): boolean {\n    return this.config?.spaceType === SpaceType.Personal;\n  }\n\n  get isTeamSpace(): boolean {\n    return this.config?.spaceType === SpaceType.Team;\n  }\n\n  /** Whether the process has been published, and whether there is a pluginId indicating whether the process has been published */\n  get hasPublished(): boolean {\n    return Boolean(this.config?.pluginId);\n  }\n\n  /**\n   * Is the space enabled in Dev mode?\n   * @Deprecated Dev mode is currently offline\n   */\n  get isDevSpace(): boolean {\n    return this.config.spaceMode === SpaceMode.DevMode;\n  }\n\n  get personalSpaceId(): string {\n    const target = this.config.spaceList.find(\n      item => item.space_type === SpaceType.Personal,\n    );\n    return target?.id ?? '';\n  }\n\n  /* New interface, multi-player collaboration mode grey release under this interface */\n  protected async queryCollaborationWorkflow(\n    workflowId: string,\n    spaceId: string,\n  ): Promise<WorkflowInfo> {\n    const { data } = await workflowApi.GetCanvasInfo(\n      {\n        workflow_id: workflowId,\n        space_id: spaceId,\n      },\n      {\n        __disableErrorToast: true,\n      },\n    );\n\n    const {\n      workflow,\n      vcs_data,\n      db_data,\n      operation_info,\n      is_bind_agent,\n      bind_biz_id,\n      bind_biz_type,\n      workflow_version,\n    } = data;\n\n    return {\n      ...workflow,\n      is_bind_agent,\n      space_id: spaceId,\n      status: db_data?.status ?? workflow?.status,\n      vcsData: vcs_data,\n      operationInfo: operation_info,\n      bind_biz_id,\n      bind_biz_type,\n      workflow_version,\n      workflowSourceSpaceId: workflow?.space_id,\n    } as WorkflowInfo;\n  }\n\n  protected async queryWorkflowDetail(\n    workflowId: string,\n    spaceId: string,\n  ): Promise<WorkflowInfo> {\n    try {\n      const res = await this.queryCollaborationWorkflow(workflowId, spaceId);\n      return res;\n    } catch (e) {\n      reporter.errorEvent({\n        eventName: 'query_workflow_detail_fail',\n        namespace: 'workflow',\n        error: e,\n      });\n      // When the public space template is deleted, there is a cache for about 5 minutes. Here, you need to back up to prevent the preview of the deleted process from crashing.\n      if (spaceId !== PUBLIC_SPACE_ID) {\n        throw e;\n      }\n      return {};\n    }\n  }\n\n  /** external incoming property */\n  get playgroundProps(): WorkflowPlaygroundProps {\n    return this.config.playgroundProps;\n  }\n\n  get workflowId(): string {\n    return this.config.playgroundProps.workflowId || '';\n  }\n\n  get workflowCommitId(): string {\n    return this.config.playgroundProps.commitId || '';\n  }\n\n  get projectCommitVersion(): string {\n    return this.config.playgroundProps.projectCommitVersion || '';\n  }\n\n  get logId(): string {\n    return this.config.playgroundProps.logId || '';\n  }\n\n  get spaceId(): string {\n    return this.config.playgroundProps.spaceId || '';\n  }\n\n  get projectId(): string | undefined {\n    // The projectId currently passed into the page or the projectId returned by interfaces such as canvas\n    return (\n      this.config.playgroundProps.projectId || this.config.info?.project_id\n    );\n  }\n\n  /** Is it in the IDE? */\n  get isInIDE(): boolean {\n    return !!this.projectId;\n  }\n\n  /**\n   * Get the ability of project injection, return null in non-project\n   */\n  getProjectApi = () => {\n    const outGetProjectApi = this.config.playgroundProps.getProjectApi;\n    if (outGetProjectApi && isFunction(outGetProjectApi)) {\n      return outGetProjectApi();\n    }\n    return null;\n  };\n  /**\n   * Reload\n   */\n  reload = async () => {\n    const workflowJson = await this.load(\n      this.config.playgroundProps.workflowId,\n      this.config.playgroundProps.spaceId || '',\n    );\n    return workflowJson;\n  };\n\n  /**\n   * canvas description information\n   */\n  get info(): WorkflowInfo {\n    return this.config.info;\n  }\n\n  setInfo(info: Partial<WorkflowInfo>) {\n    this.config.info = {\n      ...this.config.info,\n      ...info,\n    } as WorkflowInfo;\n    this.fireChange();\n  }\n\n  /**\n   * The process cannot be edited, such as: the process in practice run, the process in preview state cannot be edited, the component configuration readonly, etc\n   */\n  get readonly(): boolean {\n    return this.config.preview || this.isExecuting;\n  }\n\n  get isFromExplore(): boolean {\n    return this.config.playgroundProps.from === 'explore';\n  }\n\n  /**\n   * The published workflow has changed and the copy needs to be displayed\n   */\n  get hasChanged(): boolean {\n    const { config } = this;\n    return (\n      config.info.plugin_id !== '0' &&\n      config.info.status !== WorkFlowStatus.HadPublished\n    );\n  }\n\n  get loadingError(): string | undefined {\n    return this.config.loadingError;\n  }\n\n  /**\n   * Is the canvas loading?\n   */\n  get loading(): boolean {\n    return this.config.loading;\n  }\n\n  get isExecuting(): boolean {\n    return this.config.viewStatus === WorkflowExecStatus.EXECUTING;\n  }\n\n  get viewStatus(): WorkflowExecStatus | undefined {\n    return this.config.viewStatus;\n  }\n\n  set viewStatus(status: WorkflowExecStatus | undefined) {\n    this.config.viewStatus = status;\n    this.entityManager\n      .getEntity<PlaygroundConfigEntity>(PlaygroundConfigEntity)\n      ?.updateConfig({\n        readonly:\n          status === WorkflowExecStatus.EXECUTING || this.config.preview,\n      });\n    this.fireChange();\n  }\n\n  /**\n   * Whether to enable collaboration mode\n   */\n  get isCollaboratorMode() {\n    return this.info.collaborator_mode === CollaboratorMode.Open;\n  }\n\n  get isBindAgent() {\n    return this.config.isBindAgent;\n  }\n\n  get bindBizID() {\n    return this.config.bindBizID;\n  }\n\n  get bindBizType() {\n    return this.config.bindBizType;\n  }\n\n  /** Is the current workflow bound to the Douyin doppelganger? */\n  get isBindDouyin() {\n    return Boolean(\n      this.config.bindBizType === BindBizType.DouYinBot &&\n        this.config.bindBizID,\n    );\n  }\n\n  get flowMode() {\n    return (this.config.info.flow_mode ||\n      WorkflowMode.Workflow) as WorkflowMode;\n  }\n\n  /* Determine whether the storage mode is vcs mode, and a new interface is required in vcs mode */\n  get isVcsMode() {\n    return this.config.info.persistence_model === PersistenceModel.VCS;\n  }\n\n  get isNormalWorkflow() {\n    return isGeneralWorkflow(this.flowMode);\n  }\n\n  get isChatflow() {\n    return this.flowMode === WorkflowMode.ChatFlow;\n  }\n\n  /**\n   * @deprecated to be offline\n   */\n  get isSceneFlow() {\n    return this.flowMode === WorkflowMode.SceneFlow;\n  }\n\n  /** Is there an update for the existing plugins? */\n  get inPluginUpdated() {\n    return Boolean(this.config.inPluginUpdated);\n  }\n\n  /** Set whether there is an updated value for the existing plug-ins. */\n  set inPluginUpdated(value: boolean) {\n    this.updateConfig({\n      inPluginUpdated: value,\n    });\n  }\n\n  get canTestset() {\n    return (\n      this.spaceId !== PUBLIC_SPACE_ID &&\n      this.flowMode !== WorkflowMode.SceneFlow\n    );\n  }\n\n  get publishing() {\n    return this.config.publishing;\n  }\n\n  /**\n   * Weather show plugin node related mockset feature\n   *\n   * only show when the workflow meet the following conditions:\n   * - the space is not a public space(999999)\n   * - and not in project\n   * - and not in bot op\n   */\n  get canMockset() {\n    return (\n      this.spaceId !== PUBLIC_SPACE_ID &&\n      !this.projectId &&\n      !IS_BOT_OP &&\n      // will support soon\n      !IS_OPEN_SOURCE\n    );\n  }\n\n  /** Whether to show the Add Collaborator feature */\n  get canCollaboration() {\n    return (\n      this.isTeamSpace &&\n      this.spaceId !== PUBLIC_SPACE_ID &&\n      !this.isSceneFlow &&\n      !this.isBindDouyin\n    );\n  }\n\n  get canTestRunHistory() {\n    // Unable to get practice run history when viewing history\n    if (this.isViewHistory) {\n      return false;\n    }\n\n    // When the author does not turn on the collaboration mode, it is equivalent to a single person and can access history\n    if (!this.isCollaboratorMode && this.info.creator?.self) {\n      return true;\n    }\n\n    const { vcsData, persistence_model } = this.info;\n    // In VCS mode, only your own draft can get the practice run history\n    if (\n      persistence_model === PersistenceModel.VCS &&\n      !(vcsData?.type === VCSCanvasType.Draft && this.info.vcsData?.can_edit)\n    ) {\n      return false;\n    }\n    return true;\n  }\n\n  get isViewHistory() {\n    return this.config.historyStatus !== undefined;\n  }\n\n  get isInitWorkflow() {\n    return this.config.isInitWorkflow;\n  }\n\n  get sharedDataSetStore() {\n    if (!this.config.sharedDataSet) {\n      this.config.sharedDataSet = new DataSetStore();\n    }\n    return this.config.sharedDataSet;\n  }\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { debounce } from 'lodash-es';\nimport { I18n } from '@coze-arch/i18n';\nimport { Toast } from '@coze-arch/coze-design';\nimport { type Dataset } from '@coze-arch/bot-api/knowledge';\nimport { KnowledgeApi as knowledgeApi } from '@coze-arch/bot-api';\n\n/**\n * Knowledge Base Global State Management (Singleton)\n */\nexport class DataSetStore {\n  private dataSetInfosMap: { [k: string]: Dataset } = {};\n  private queryQueue: string[] = [];\n  private listeners: {\n    ids: string[];\n    callback: (DataSetInfos: Dataset[]) => void;\n  }[] = [];\n\n  setDataSetInfosMap = (dataSetInfos: Dataset[]) => {\n    dataSetInfos.forEach(d => {\n      if (!this.dataSetInfosMap[d.dataset_id as string]) {\n        this.dataSetInfosMap[d.dataset_id as string] = d;\n      }\n    });\n  };\n  getDataSetInfosByIds = (ids: string[], spaceId): Promise<Dataset[]> =>\n    new Promise(resolve => {\n      this.getDataSetInfosByIdsCallback(ids, spaceId, dataSetInfos => {\n        resolve(dataSetInfos);\n      });\n    });\n  private getDataSetInfosByIdsCallback(\n    ids: string[],\n    spaceId,\n    callback: (dataSetInfos: Dataset[]) => void,\n  ): void {\n    const existDataInfoIds: string[] = [];\n    const needQueryInfoIds: string[] = [];\n    ids.forEach(id => {\n      if (this.dataSetInfosMap[id]) {\n        existDataInfoIds.push(id);\n      } else {\n        needQueryInfoIds.push(id);\n      }\n    });\n\n    // If all hits cache, return directly\n    if (needQueryInfoIds.length === 0) {\n      callback(existDataInfoIds.map(id => this.dataSetInfosMap[id]));\n      return;\n    }\n\n    // Otherwise, register the queue and call the callback after the query is completed.\n    this.listeners.push({\n      ids,\n      callback,\n    });\n\n    // Analyze IDs that require additional queries\n    const needAddToQueryQueueIds = needQueryInfoIds.filter(\n      id => !this.queryQueue.includes(id),\n    );\n\n    // If there are no ids that require additional queries, just wait\n    if (needAddToQueryQueueIds.length === 0) {\n      return;\n    }\n\n    // If there are ids that require additional queries, throw them into the queue to be queried\n    this.queryQueue = this.queryQueue.concat(needAddToQueryQueueIds);\n    // Invoke query\n    this.query(spaceId);\n  }\n\n  private query = debounce(async (spaceId: string) => {\n    const { dataset_list = [] } = await knowledgeApi.ListDataset({\n      space_id: spaceId,\n      page: 1,\n      size: 99,\n      filter: { dataset_ids: this.queryQueue },\n    });\n    const ids = this.queryQueue;\n    this.queryQueue = [];\n\n    const unUseIds: string[] = [];\n    ids.forEach(id => {\n      if (!dataset_list.find(d => d.dataset_id === id)) {\n        unUseIds.push(id);\n      }\n    });\n\n    this.addDataSetInfo(dataset_list, unUseIds);\n\n    if (unUseIds.length > 0) {\n      Toast.error(\n        I18n.t(\n          'workflow_knowledeg_unexit_error',\n          {\n            id: unUseIds.join(','),\n          },\n          '',\n        ),\n      );\n    }\n    this.onQueried();\n  }, 100);\n\n  onQueried = () => {\n    this.listeners.forEach(l => {\n      const { ids, callback } = l;\n\n      let isQueryDone = true;\n      ids.forEach(id => {\n        if (!this.dataSetInfosMap[id]) {\n          isQueryDone = false;\n        }\n      });\n\n      if (isQueryDone) {\n        callback(ids.map(id => this.dataSetInfosMap[id]));\n        this.listeners = this.listeners.filter(_l => l !== _l);\n      }\n    });\n  };\n\n  addDataSetInfo = (dataSetInfos: Dataset[], unUseIds?: string[]) => {\n    dataSetInfos.forEach(d => {\n      if (!this.dataSetInfosMap[d.dataset_id as string]) {\n        this.dataSetInfosMap[d.dataset_id as string] = d;\n      } else {\n        // Update cached knowledge base information\n        this.dataSetInfosMap[d.dataset_id as string] = {\n          ...this.dataSetInfosMap[d.dataset_id as string],\n          ...d,\n        };\n      }\n    });\n\n    unUseIds?.forEach(id => {\n      if (!this.dataSetInfosMap[id]) {\n        this.dataSetInfosMap[id] = {\n          dataset_id: id,\n          name: I18n.t('workflow_knowledeg_un_exit', {}, ''),\n        };\n      }\n    });\n  };\n\n  clearDataSetInfosMap = () => {\n    this.dataSetInfosMap = {};\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type FC } from 'react';\n\nimport classnames from 'classnames';\nimport { IconCozPlus } from '@coze-arch/coze-design/icons';\nimport { IconButton, Tooltip } from '@coze-arch/coze-design';\n\ninterface Props {\n  onClick?: React.MouseEventHandler<HTMLButtonElement>;\n  onMouseDown?: React.MouseEventHandler<HTMLButtonElement>;\n  title?: string;\n  className?: string;\n  style?: React.CSSProperties;\n  readonly?: boolean;\n  disabled?: boolean;\n  disabledTooltip?: string;\n  testId?: string;\n}\n\nexport const AddItemButton: FC<Props> = ({\n  onClick,\n  onMouseDown,\n  disabled,\n  disabledTooltip,\n  className,\n  style,\n  title,\n  testId,\n}) => {\n  const ButtonContent = (\n    <IconButton\n      color=\"highlight\"\n      size=\"small\"\n      icon={<IconCozPlus className=\"text-sm\" />}\n      onMouseDown={e => onMouseDown?.(e)}\n      onClick={e => onClick?.(e)}\n      className={classnames('!block', className)}\n      style={style}\n      disabled={disabled}\n      data-testid={testId}\n    />\n  );\n\n  if (disabledTooltip) {\n    return <Tooltip content={disabledTooltip}>{ButtonContent}</Tooltip>;\n  }\n\n  return !disabled ? ButtonContent : null;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport classNames from 'classnames';\nimport { Tooltip } from '@coze-arch/coze-design';\nimport { Checkbox } from '@coze-arch/bot-semi';\nimport { IconInfo } from '@coze-arch/bot-icons';\n\nimport styles from './index.module.less';\n\nexport interface CheckboxItemProps {\n  checked?: boolean;\n  label?: string;\n  tooltip?: React.ReactNode;\n  tipWrapperClassName?: string;\n  description?: string;\n  children?: React.ReactNode;\n  readonly?: boolean;\n  disabled?: boolean;\n  needCheckBox?: boolean;\n  className?: string;\n  style?: React.CSSProperties;\n  onChange?: (checked: boolean) => void;\n  dataTestId?: string;\n}\n\nexport const CheckboxWithLabel: FC<CheckboxItemProps> = ({\n  checked,\n  label,\n  description,\n  tooltip,\n  tipWrapperClassName,\n  children,\n  needCheckBox = true,\n  className,\n  style,\n  readonly,\n  disabled,\n  onChange,\n  dataTestId,\n}) => (\n  <div\n    className={classNames('flex flex-col gap-[4px] py-[4px]', className)}\n    style={style}\n  >\n    <div className=\"flex items-center gap-[8px]\">\n      {needCheckBox ? (\n        <div>\n          <Checkbox\n            className={styles['checkbox-small']}\n            checked={checked}\n            disabled={readonly || disabled}\n            onChange={e => onChange?.(e?.target?.checked as boolean)}\n            data-testid={dataTestId}\n          />\n        </div>\n      ) : null}\n      <div className=\"flex items-center gap-[4px] text-[12px] text-[#060709CC]\">\n        {label}\n        {tooltip ? (\n          <Tooltip className={tipWrapperClassName} content={tooltip}>\n            <IconInfo\n              className={styles['lable-wrapper']}\n              style={{\n                color: 'rgba(167, 169, 176, 1)',\n                cursor: 'pointer',\n              }}\n            />\n          </Tooltip>\n        ) : null}\n      </div>\n    </div>\n    {description ? (\n      <div style={{ paddingLeft: '24px' }}>\n        <span className={styles.description}>{description}</span>\n      </div>\n    ) : null}\n    {children}\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { IconCozInfoCircle } from '@coze-arch/coze-design/icons';\nimport { Tooltip, Checkbox as SemiCheckbox } from '@coze-arch/coze-design';\n\nexport const Checkbox = props => {\n  const { value, onChange, context, options, readonly } = props;\n  const { text, itemTooltip } = options;\n  const { getNodeSetterId } = useNodeTestId();\n\n  return (\n    <div className=\"flex items-center\">\n      <SemiCheckbox\n        onChange={e => onChange(e.target.checked)}\n        checked={!!value}\n        data-testid={getNodeSetterId(context.meta.name)}\n        disabled={readonly}\n      >\n        {text}\n      </SemiCheckbox>\n\n      {!!itemTooltip && (\n        <Tooltip content={itemTooltip}>\n          <IconCozInfoCircle className=\"text-[#A7A9B0] text-sm ml-1\" />\n        </Tooltip>\n      )}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type CSSProperties } from 'react';\n\nimport classnames from 'classnames';\n\nimport { ColumnsTitle, type ColumnsTitleProps } from '../columns-title';\n\nexport interface ColumnsTitleWithActionProps extends ColumnsTitleProps {\n  actionWidth?: number;\n  readonly?: boolean;\n  className?: string;\n  style?: CSSProperties;\n}\n\nconst getActionColumns = (\n  columns: ColumnsTitleProps['columns'],\n  readonly?: boolean,\n  actionWidth = 24,\n) => [\n  ...columns,\n  ...(readonly\n    ? []\n    : [\n        {\n          title: '',\n          style: {\n            width: actionWidth,\n          },\n        },\n      ]),\n];\n\nexport const ColumnsTitleWithAction = ({\n  actionWidth,\n  className,\n  columns,\n  readonly,\n  style,\n}: ColumnsTitleWithActionProps) => (\n  <ColumnsTitle\n    className={classnames('gap-1', className)}\n    columns={getActionColumns(columns, readonly, actionWidth)}\n    style={style}\n  />\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type CSSProperties } from 'react';\n\nimport classnames from 'classnames';\n\nimport { type AnyValue } from '../../setters/typings';\n\nimport styles from './index.module.less';\n\nexport interface Column {\n  title: string;\n  style?: AnyValue;\n}\nexport interface ColumnsTitleProps {\n  columns: Column[];\n  className?: string;\n  style?: CSSProperties;\n}\n\nexport const ColumnsTitle = ({\n  columns,\n  className,\n  style,\n}: ColumnsTitleProps) => (\n  <div className={classnames(styles.columnsTitle, className)} style={style}>\n    {columns.map(({ title, style: colStyle }: Column) => (\n      <div style={colStyle}>{title}</div>\n    ))}\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useState } from 'react';\n\nimport { type Dataset } from '@coze-arch/bot-api/knowledge';\nimport { DouyinKnowledgeListModal } from '@coze-workflow/resources-adapter';\n\nexport interface UseDouyinKnowledgeListModalParams {\n  botId: string;\n  spaceId: string;\n  datasetList: Dataset[];\n  onDatasetListChange: (list: Dataset[]) => void;\n  onClickKnowledgeDetail: (knowledgeID: string) => void;\n  onCancel: () => void;\n}\n\nexport interface UseDouyinKnowledgeListReturnValue {\n  node: JSX.Element;\n  open: () => void;\n  close: () => void;\n}\n\nexport const useDouyinKnowledgeListModal = (\n  props: UseDouyinKnowledgeListModalParams,\n): UseDouyinKnowledgeListReturnValue => {\n  const [visible, setVisible] = useState(false);\n\n  const handleClose = () => {\n    setVisible(false);\n  };\n\n  const handleOpen = () => {\n    setVisible(true);\n  };\n\n  return {\n    node: <DouyinKnowledgeListModal {...props} visible={visible} />,\n    open: handleOpen,\n    close: handleClose,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useMemo, useState, useEffect, useRef } from 'react';\n\nimport { BindBizType } from '@coze-workflow/base/api';\nimport {\n  StandardNodeType,\n  useWorkflowNode,\n  useNodeTestId,\n} from '@coze-workflow/base';\nimport { FilterKnowledgeType } from '@coze-data/knowledge-modal-base';\nimport { useKnowledgeListModal } from '@coze-data/knowledge-modal-adapter';\nimport { useBizWorkflowKnowledgeIDEFullScreenModal } from '@coze-data/knowledge-ide-adapter';\nimport { I18n } from '@coze-arch/i18n';\nimport { ConfigProvider } from '@coze-arch/bot-semi';\nimport { DatasetStatus } from '@coze-arch/bot-api/knowledge';\nimport { Button } from '@coze-arch/coze-design';\n\nimport { useGlobalState, useDataSetInfos, useSpaceId } from '@/hooks';\n\nimport { LibrarySelect } from '../library-select';\nimport { useDouyinKnowledgeListModal } from './use-douyin-knowledge-list-modal';\n\nexport const DatasetSelect = ({\n  value: _value,\n  onChange,\n  readonly,\n}: {\n  value: string[];\n  onChange: (value: string[]) => void;\n  readonly: boolean;\n}) => {\n  const { getNodeSetterId } = useNodeTestId();\n  const addButtonTestID = getNodeSetterId('dataset-select-add');\n  const libraryCardTestID = getNodeSetterId('dataset-select-card');\n\n  // When initializing, it will be worn to the default value: [null]\n  const value = useMemo(() => _value?.filter?.(d => !!d) || [], [_value]);\n\n  const { dataSets, cacheDataSetInfo } = useDataSetInfos({ ids: value });\n  const res = useWorkflowNode();\n  const { type } = res;\n  const isDatasetWrite = type === StandardNodeType.DatasetWrite;\n  const knowledgeType = isDatasetWrite\n    ? FilterKnowledgeType.TEXT\n    : FilterKnowledgeType.ALL;\n  const hiddenAddBtn = !!(isDatasetWrite && value?.length);\n\n  const addKnowledge = useCallback(\n    id => {\n      onChange([...value, id]);\n      knowledgePreviewModalClose();\n    },\n    [value, onChange],\n  );\n\n  const removeKnowledge = useCallback(\n    id => {\n      onChange(value.filter(_v => _v !== id));\n      knowledgePreviewModalClose();\n    },\n    [value, onChange],\n  );\n\n  const [buttonType, setButtonType] = useState('add');\n  const [curDateSetID, setCurDateSetID] = useState<string>();\n\n  const curDataset = useMemo(\n    () => dataSets.find(d => d.dataset_id === curDateSetID),\n    [dataSets, curDateSetID],\n  );\n  const button = useMemo(\n    () => (\n      <Button\n        // Add details page Add knowledge details page, disable the action button to add an unenabled knowledge base\n        disabled={\n          readonly || curDataset?.status === DatasetStatus.DatasetForbid\n        }\n        onClick={() => {\n          buttonType === 'add'\n            ? addKnowledge(curDateSetID)\n            : removeKnowledge(curDateSetID);\n        }}\n      >\n        {buttonType === 'add'\n          ? I18n.t('knowledge_add_btn_by_workflow')\n          : I18n.t('knowledge_remove_btn_by_workflow')}\n      </Button>\n    ),\n    [\n      dataSets,\n      buttonType,\n      addKnowledge,\n      removeKnowledge,\n      curDateSetID,\n      curDataset,\n    ],\n  );\n\n  const {\n    node: knowledgePreviewModal,\n    open: knowledgePreviewModalOpen,\n    close: knowledgePreviewModalClose,\n  } = useBizWorkflowKnowledgeIDEFullScreenModal({\n    navBarProps: {\n      actionButtons: button,\n    },\n    biz: 'workflow',\n  });\n\n  const { projectId, getProjectApi, playgroundProps, bindBizID, bindBizType } =\n    useGlobalState();\n  const spaceID = useSpaceId();\n  const isBindDouyin = bindBizType === BindBizType.DouYinBot;\n  const newWindowRef = useRef<WindowProxy | null>();\n\n  const { node, open, close } = useKnowledgeListModal({\n    datasetList: value.map(d => ({\n      dataset_id: d,\n    })),\n    onClickKnowledgeDetail: (datasetID: string) => {\n      if (value.includes(datasetID)) {\n        setButtonType('remove');\n      } else {\n        setButtonType('add');\n      }\n      setCurDateSetID(datasetID);\n      knowledgePreviewModalOpen(datasetID);\n      // close();\n    },\n    onDatasetListChange: list => {\n      cacheDataSetInfo(list);\n      onChange(list.map(l => l.dataset_id) as string[]);\n    },\n    defaultType: knowledgeType,\n    // Pass undefined to display the full knowledge base\n    knowledgeTypeConfigList: isDatasetWrite\n      ? [FilterKnowledgeType.TEXT]\n      : undefined,\n    projectID: projectId,\n    beforeCreate: shouldUpload => {\n      if (shouldUpload && !projectId) {\n        newWindowRef.current = window.open();\n      }\n    },\n    onClickAddKnowledge: (id, unitType, shouldUpload) => {\n      if (shouldUpload) {\n        if (projectId) {\n          const IDENav = getProjectApi()?.navigate;\n          IDENav?.(`/knowledge/${id}?module=upload&type=${unitType}`);\n        } else if (newWindowRef.current) {\n          if (id) {\n            newWindowRef.current.location = `/space/${spaceID}/knowledge/${id}/upload?type=${unitType}`;\n          } else {\n            newWindowRef.current.close();\n          }\n        }\n      }\n      close();\n      if (projectId) {\n        playgroundProps.refetchProjectResourceList?.();\n      }\n    },\n  });\n\n  const {\n    node: douyinModal,\n    open: openDouyinModal,\n    close: closeDouyinModal,\n  } = useDouyinKnowledgeListModal({\n    spaceId: spaceID,\n    botId: bindBizID || '',\n    datasetList: value.map(d => ({\n      dataset_id: d,\n    })),\n    onClickKnowledgeDetail: (datasetID: string) => {\n      if (value.includes(datasetID)) {\n        setButtonType('remove');\n      } else {\n        setButtonType('add');\n      }\n      setCurDateSetID(datasetID);\n      knowledgePreviewModalOpen(datasetID);\n    },\n    onDatasetListChange: list => {\n      cacheDataSetInfo(list);\n      onChange(list.map(l => l.dataset_id) as string[]);\n    },\n    onCancel: () => {\n      closeDouyinModal();\n    },\n  });\n\n  useEffect(() => {\n    // The knowledge base writing node can only select one knowledge base and then close it, limiting multiple selection\n    if (isDatasetWrite && value?.length) {\n      close();\n    }\n  }, [value, close, isDatasetWrite]);\n\n  return (\n    <div className=\"relative\">\n      {/* Semi is mounted on the body by default, but it is overridden and mounted on the current node in workflow. You need to manually overwrite it to the body here, otherwise the knowledge pop-up window will not open. */}\n      <ConfigProvider getPopupContainer={() => document.body}>\n        {knowledgePreviewModal}\n        {isBindDouyin ? douyinModal : node}\n      </ConfigProvider>\n      <LibrarySelect\n        libraries={dataSets?.map(\n          ({\n            dataset_id = '',\n            name,\n            description,\n            icon_url,\n            create_time = '',\n            creator_id = '',\n          }) => ({\n            id: dataset_id,\n            name,\n            description,\n            iconUrl: icon_url,\n            // Invalid Knowledge Base is disabled\n            isInvalid: !create_time && !creator_id,\n          }),\n        )}\n        readonly={readonly}\n        onDeleteLibrary={id => {\n          onChange(value.filter(_v => _v !== id));\n        }}\n        onAddLibrary={() => (isBindDouyin ? openDouyinModal() : open())}\n        onClickLibrary={id => {\n          if (id) {\n            setButtonType('remove');\n            setCurDateSetID(id);\n            knowledgePreviewModalOpen(id);\n          }\n        }}\n        emptyText={\n          isDatasetWrite\n            ? I18n.t('kl_write_003')\n            : I18n.t('workflow_knowledge_node_empty')\n        }\n        hideAddButton={hiddenAddBtn}\n        addButtonTestID={addButtonTestID}\n        libraryCardTestID={libraryCardTestID}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type ReactNode } from 'react';\n\nimport classNames from 'classnames';\nimport { Slider } from '@coze-arch/coze-design';\n\nimport s from './index.module.less';\n\ninterface SliderAreaProps {\n  min?: number;\n  max?: number;\n  step?: number;\n  value: number;\n  marks?: { markKey: number; markText: string | ReactNode };\n  disabled?: boolean;\n  onChange: (value: number) => void;\n  onClickDefault?: () => void;\n  onMouseUp?: (e: unknown) => void;\n  isDataSet?: boolean;\n  customStyles?: {\n    sliderAreaStyle: React.CSSProperties;\n    boundaryStyle: React.CSSProperties;\n  };\n}\n\nexport const SliderArea: React.FC<SliderAreaProps> = ({\n  min = 0,\n  max = 100,\n  step = 1,\n  value,\n  marks,\n  onChange,\n  onMouseUp,\n  onClickDefault,\n  disabled,\n  customStyles,\n  isDataSet = false,\n}) => (\n  <div\n    className={classNames(s['slider-area'], {\n      [s['slider-area-dataset']]: isDataSet,\n    })}\n  >\n    <div className={s['slider-wrapper']}>\n      <div className={s.slider} style={customStyles?.sliderAreaStyle}>\n        <Slider\n          step={step}\n          min={min}\n          max={max}\n          value={value}\n          marks={marks ? { [marks.markKey]: '' } : {}}\n          disabled={disabled}\n          onChange={v => onChange(v as number)}\n          onMouseUp={e => {\n            onMouseUp?.(e);\n          }}\n        />\n      </div>\n    </div>\n    <div className={s['slider-boundary']} style={customStyles?.boundaryStyle}>\n      <div className={s.min}>{min}</div>\n      <div className={s.max}>{max}</div>\n      {marks ? (\n        <div\n          className={s.marks}\n          style={{\n            left: `${((marks.markKey - min) / (max - min)) * 100}%`,\n          }}\n          onClick={() => {\n            onClickDefault?.();\n          }}\n        >\n          {marks.markText}\n        </div>\n      ) : (\n        <></>\n      )}\n    </div>\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { Tooltip } from '@coze-arch/coze-design';\nimport { IconInfo } from '@coze-arch/bot-icons';\n\nimport s from './index.module.less';\n\ninterface TitleAreaProps {\n  title: string;\n  tip?: string;\n  titleClassName?: string;\n}\nexport const TitleArea: React.FC<TitleAreaProps> = ({\n  title,\n  tip,\n  titleClassName,\n}) => (\n  <div className={s['title-area']}>\n    <span className={titleClassName}>{title}</span>\n    {!!tip && (\n      <Tooltip\n        showArrow\n        position=\"top\"\n        style={{\n          maxWidth: '380px',\n          padding: '8px 12px',\n          borderRadius: '6px',\n        }}\n        content={tip}\n      >\n        <IconInfo className={s['title-area-icon']} />\n      </Tooltip>\n    )}\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { Select } from '@coze-arch/coze-design';\n\nimport { Strategy } from '../../type';\n\nimport s from './index.module.less';\n\nconst optionList = [\n  {\n    value: Strategy.Semantic,\n    label: I18n.t('knowledge_semantic_search_title'),\n  },\n  {\n    value: Strategy.Hybird,\n    label: I18n.t('knowledge_hybird_search_title'),\n  },\n  {\n    value: Strategy.FullText,\n    label: I18n.t('knowledge_full_text_search_title'),\n  },\n];\n\ninterface SearchStrategyProps {\n  value: Strategy;\n  onChange: (v: Strategy) => void;\n  style?: React.CSSProperties;\n  readonly?: boolean;\n}\n\nexport const SearchStrategy: React.FC<SearchStrategyProps> = props => {\n  const { value, onChange, style, readonly } = props;\n\n  const { getNodeSetterId } = useNodeTestId();\n\n  return (\n    <Select\n      className={s['strategy-area']}\n      dropdownClassName={s['strategy-area-dropdown']}\n      size=\"small\"\n      value={value}\n      style={{\n        ...style,\n        pointerEvents: readonly ? 'none' : 'auto',\n      }}\n      onChange={onChange as (v: unknown) => void}\n      // defaultValue={Strategy.Semantic}\n      data-testid={getNodeSetterId('dataset-search-strategy')}\n    >\n      {optionList.map(v => (\n        <Select.Option\n          value={v.value}\n          key={v.value}\n          data-testid={getNodeSetterId('dataset-search-strategy-option')}\n        >\n          {v.label}\n        </Select.Option>\n      ))}\n    </Select>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable complexity */\nimport { type FC, useEffect, useState, useMemo } from 'react';\n\nimport { isNil, set, omit } from 'lodash-es';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { RewriteTips, RerankTips } from '@coze-common/biz-tooltip-ui';\nimport { type Dataset, FormatType } from '@coze-arch/idl/knowledge';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconWarningInfo } from '@coze-arch/bot-icons';\nimport { Popover } from '@coze-arch/coze-design';\n\nimport { CheckboxWithLabel } from '../checkbox-with-label';\nimport { Strategy, type DataSetInfo } from './type';\nimport { TitleArea, SliderArea, SearchStrategy } from './components';\n\nimport s from './index.module.less';\n\n/** Prompt beyond this value */\nconst SUGGEST_TOP_K = 5;\n/** default minimum match */\nconst DEFAULT_MIN_SCORE = 0.5;\n/** default maximum recall  */\nconst DEFAULT_TOP_K = 5;\n\nexport interface DataSetSettingProps {\n  dataSetInfo: DataSetInfo;\n  onDataSetInfoChange: (v: DataSetInfo) => void;\n  readonly?: boolean;\n  disabled?: boolean;\n  style?: Record<string, unknown>;\n  isReady?: boolean;\n  dataSets?: Dataset[];\n}\n\nexport const DataSetSetting: FC<DataSetSettingProps> = ({\n  dataSetInfo,\n  onDataSetInfoChange,\n  readonly,\n  disabled,\n  style,\n  isReady,\n  dataSets,\n}) => {\n  const {\n    min_score: minScore,\n    top_k: topK,\n    strategy,\n    use_nl2sql: useNl2sql,\n    use_rerank: useRerank,\n    use_rewrite: useRewrite,\n    is_personal_only: isPersonalOnly,\n  } = dataSetInfo || {};\n\n  const isDatasetWriteActive = true;\n\n  const [isDatasetEmpty, setDatasetEmpty] = useState(true);\n\n  const isContainSqlDataSet = useMemo(\n    () => dataSets?.some(dataset => dataset?.format_type === FormatType.Table),\n    [dataSets],\n  );\n\n  const { getNodeSetterId } = useNodeTestId();\n\n  // Set default value\n  useEffect(() => {\n    if (isDatasetEmpty) {\n      return;\n    }\n\n    if (\n      isNil(minScore) &&\n      isNil(topK) &&\n      isNil(strategy) &&\n      isNil(useRerank) &&\n      isNil(useRewrite) &&\n      isNil(isPersonalOnly)\n    ) {\n      const initDataSetInfo = {\n        min_score: DEFAULT_MIN_SCORE,\n        top_k: DEFAULT_TOP_K,\n        strategy: Strategy.Hybird,\n      };\n\n      if (isDatasetWriteActive) {\n        set(initDataSetInfo, 'use_rerank', true);\n        set(initDataSetInfo, 'use_rewrite', true);\n        set(initDataSetInfo, 'is_personal_only', true);\n      }\n\n      // The search policy for new nodes defaults to Hybird\n      onDataSetInfoChange?.({\n        ...dataSetInfo,\n        ...initDataSetInfo,\n      });\n    } else if (isNil(strategy)) {\n      // The search policy for existing processes defaults to Hybird\n      onDataSetInfoChange?.({\n        ...dataSetInfo,\n        strategy: Strategy.Hybird,\n      });\n    } else if (\n      // stock process supplement default value\n      isNil(useRerank) &&\n      isNil(useRewrite) &&\n      isNil(isPersonalOnly) &&\n      isDatasetWriteActive\n    ) {\n      onDataSetInfoChange?.({\n        ...dataSetInfo,\n        use_rerank: true,\n        use_rewrite: true,\n        is_personal_only: true,\n      });\n    }\n  }, [dataSetInfo, isDatasetWriteActive, isContainSqlDataSet, isDatasetEmpty]);\n\n  useEffect(() => {\n    // Avoid situations where unrequested Knowledge Base List data results in an isContainSqlDataSet status error\n    if (!isReady) {\n      return;\n    }\n    if (isNil(useNl2sql)) {\n      if (isContainSqlDataSet) {\n        const nextDataSetInfo = {\n          ...dataSetInfo,\n          use_nl2sql: true,\n        };\n        onDataSetInfoChange(nextDataSetInfo as DataSetInfo);\n      }\n    } else {\n      // No table database Clear this field\n      if (!isContainSqlDataSet) {\n        const nextDataSetInfo = omit(dataSetInfo, ['use_nl2sql']);\n        onDataSetInfoChange(nextDataSetInfo as DataSetInfo);\n      }\n    }\n  }, [isContainSqlDataSet, useNl2sql, isReady]);\n\n  useEffect(() => {\n    if (!isReady) {\n      return;\n    }\n    // Empty data when no database exists\n    setDatasetEmpty(!dataSets?.length);\n    if (!dataSets?.length) {\n      const nextDataSetInfo = {};\n      onDataSetInfoChange(nextDataSetInfo as DataSetInfo);\n    }\n  }, [dataSets, isReady, setDatasetEmpty]);\n\n  const [minScoreVisible, setMinScoreVisible] = useState(true);\n\n  useEffect(() => {\n    setMinScoreVisible(!!useRerank);\n    let nextDataSetInfo: DataSetInfo;\n    if (!useRerank) {\n      nextDataSetInfo = omit(dataSetInfo, ['min_score']);\n      onDataSetInfoChange?.(nextDataSetInfo);\n    } else if (useRerank && isNil(minScore)) {\n      nextDataSetInfo = {\n        ...dataSetInfo,\n        min_score: DEFAULT_MIN_SCORE,\n      };\n      onDataSetInfoChange?.(nextDataSetInfo);\n    }\n  }, [useRerank, setMinScoreVisible]);\n\n  const [topKSuggestVisible, setTopKSuggestVisible] = useState(false);\n\n  const suggestTopKPopover = () => (\n    <div className={s['tip-area']}>\n      <IconWarningInfo></IconWarningInfo>\n      <div className={s['tip-area-content']}>\n        <div className={s['tip-area-title']}>\n          {I18n.t('workflow_detail_knowledge_proceed_with_caution')}\n        </div>\n        <div className={s['tip-area-text']}>\n          {I18n.t('dataset_max_recall_desc')}\n        </div>\n      </div>\n    </div>\n  );\n\n  if (isDatasetEmpty) {\n    return <></>;\n  }\n\n  return (\n    // Set the positioning to prevent the slider from overshifting\n    <div className={s.setting} style={{ ...style, position: 'relative' }}>\n      <div className={s['setting-item']}>\n        <TitleArea\n          title={I18n.t('knowledge_search_strategy_title')}\n          tip={I18n.t('knowledge_search_strategy_tooltip')}\n        />\n        <SearchStrategy\n          readonly={readonly}\n          value={strategy as Strategy}\n          onChange={v => {\n            onDataSetInfoChange(\n              v === Strategy.FullText\n                ? {\n                    top_k: dataSetInfo?.top_k,\n                    strategy: v,\n                  }\n                : {\n                    ...dataSetInfo,\n                    // From fulltext - > rest policies, you need to add min_score by default\n                    min_score: dataSetInfo?.min_score || DEFAULT_MIN_SCORE,\n                    strategy: v,\n                  },\n            );\n          }}\n        />\n      </div>\n\n      <div className={s['setting-item']}>\n        <TitleArea\n          title={I18n.t('dataset_max_recall')}\n          tip={I18n.t('bot_edit_datasetsSettings_MaxTip')}\n        />\n        <Popover\n          showArrow={false}\n          position=\"bottom\"\n          trigger=\"custom\"\n          visible={topKSuggestVisible}\n          content={suggestTopKPopover}\n          onClickOutSide={() => {\n            setTopKSuggestVisible(false);\n          }}\n          className={s['dataset-top-k-popover']}\n          getPopupContainer={() => document.body}\n        >\n          <div style={{ position: 'relative' }}>\n            <SliderArea\n              min={1}\n              max={20}\n              step={1}\n              value={topK}\n              customStyles={{\n                sliderAreaStyle: {\n                  width: '160px',\n                },\n                boundaryStyle: {\n                  width: '158px',\n                  margin: 0,\n                },\n              }}\n              isDataSet\n              marks={{\n                markKey: DEFAULT_TOP_K,\n                // Set margin-left to avoid overlap with number 1\n                markText: <span className=\"ml-2\">Default</span>,\n              }}\n              onChange={v => {\n                onDataSetInfoChange({\n                  ...dataSetInfo,\n                  top_k: v,\n                });\n                if (v > SUGGEST_TOP_K) {\n                  setTopKSuggestVisible(true);\n                } else {\n                  setTopKSuggestVisible(false);\n                }\n              }}\n              onClickDefault={() => {\n                onDataSetInfoChange({\n                  ...dataSetInfo,\n                  top_k: DEFAULT_TOP_K,\n                });\n              }}\n              // Semi version is not high enough\n              // onMouseUp={e => {\n              //   console.info('e', { e });\n              // if (v > SUGGEST_TOP_K) {\n              //   setTopKSuggestVisible(true);\n              // } else {\n              //   setTopKSuggestVisible(false);\n              // }\n              // }}\n              disabled={readonly || disabled}\n            />\n          </div>\n        </Popover>\n      </div>\n\n      {minScoreVisible && strategy !== Strategy.FullText ? (\n        <div className={s['setting-item']}>\n          <TitleArea\n            title={I18n.t('dataset_min_degree')}\n            tip={I18n.t('bot_edit_datasetsSettings_MinTip')}\n          />\n          <div style={{ position: 'relative' }}>\n            <SliderArea\n              min={0.01}\n              max={0.99}\n              step={0.01}\n              customStyles={{\n                sliderAreaStyle: {\n                  width: '160px',\n                },\n                boundaryStyle: {\n                  width: '158px',\n                  margin: 0,\n                },\n              }}\n              isDataSet\n              value={minScore as number}\n              marks={{ markKey: 0.5, markText: 'Default' }}\n              disabled={readonly || disabled}\n              onChange={v => {\n                onDataSetInfoChange({\n                  ...dataSetInfo,\n                  min_score: v,\n                });\n              }}\n              onClickDefault={() => {\n                onDataSetInfoChange({\n                  ...dataSetInfo,\n                  min_score: DEFAULT_MIN_SCORE,\n                });\n              }}\n            />\n          </div>\n        </div>\n      ) : (\n        <></>\n      )}\n      {isDatasetWriteActive && isContainSqlDataSet ? (\n        <div className={s['setting-item']}>\n          <CheckboxWithLabel\n            checked={useNl2sql}\n            onChange={checked => {\n              onDataSetInfoChange({\n                ...dataSetInfo,\n                use_nl2sql: checked,\n              });\n            }}\n            readonly={readonly}\n            label={I18n.t('kl_write_022')}\n            description={I18n.t('kl_write_023')}\n            dataTestId={getNodeSetterId('dataset_use_nl2sql')}\n          />\n        </div>\n      ) : null}\n\n      {isDatasetWriteActive ? (\n        <>\n          <CheckboxWithLabel\n            checked={useRewrite}\n            onChange={checked => {\n              onDataSetInfoChange({\n                ...dataSetInfo,\n                use_rewrite: checked,\n              });\n            }}\n            readonly={readonly}\n            label={I18n.t('kl_write_024')}\n            description={I18n.t('kl_write_025')}\n            dataTestId={getNodeSetterId('dataset_use_rewrite')}\n            tooltip={<RewriteTips />}\n            tipWrapperClassName={s['tips-container']}\n          />\n          <CheckboxWithLabel\n            checked={useRerank}\n            onChange={checked => {\n              onDataSetInfoChange({\n                ...dataSetInfo,\n                use_rerank: checked,\n              });\n            }}\n            readonly={readonly}\n            label={I18n.t('kl_write_026')}\n            description={I18n.t('kl_write_027')}\n            dataTestId={getNodeSetterId('dataset_use_rerank')}\n            tooltip={<RerankTips />}\n            tipWrapperClassName={s['tips-container']}\n          />\n          <CheckboxWithLabel\n            checked={isPersonalOnly}\n            onChange={checked => {\n              onDataSetInfoChange({\n                ...dataSetInfo,\n                is_personal_only: checked,\n              });\n            }}\n            readonly={readonly}\n            label={I18n.t('kl_write_028')}\n            description={I18n.t('kl_write_029')}\n            dataTestId={getNodeSetterId('dataset_is_only_personal')}\n          />\n        </>\n      ) : null}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum Strategy {\n  Semantic = 0,\n  Hybird = 1,\n  FullText = 20,\n}\n\nexport interface DataSetInfo {\n  top_k: number;\n  min_score?: number;\n  strategy?: Strategy;\n  use_nl2sql?: boolean;\n  use_rerank?: boolean;\n  use_rewrite?: boolean;\n  is_personal_only?: boolean;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, type FC } from 'react';\n\nimport { isNil, set } from 'lodash-es';\nimport classNames from 'classnames';\nimport type {\n  FeedbackStatus,\n  SetterOrDecoratorContext,\n} from '@flowgram-adapter/free-layout-editor';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { SeperatorType } from '@coze-data/knowledge-resource-processor-base/types';\nimport { getSeperatorOptionList } from '@coze-data/knowledge-resource-processor-base/constants';\nimport { I18n } from '@coze-arch/i18n';\nimport type {\n  OptionItem,\n  RadioChangeEvent,\n  RadioType,\n} from '@coze-arch/bot-semi/Radio';\nimport { Select, Input } from '@coze-arch/coze-design';\n\nimport { Radio } from '../radio';\nimport { SliderArea, TitleArea } from '../dataset-setting/components';\n\nimport styles from './index.module.less';\n\ntype RadioItem = OptionItem & {\n  disabled?: boolean | ((context: SetterOrDecoratorContext) => boolean);\n};\n\nenum ChunkStratgy {\n  Default = 'default',\n  Layer = 'layer',\n  Custom = 'custom',\n}\n\nexport interface ChunkValue {\n  chunkType: ChunkStratgy;\n  maxLevel?: number;\n  saveTitle?: boolean;\n  overlap?: number;\n  maxToken?: number;\n  separator?: string;\n  separatorType?: SeperatorType;\n}\n\ninterface RadioProps {\n  value: ChunkValue;\n  onChange: (v: ChunkValue) => void;\n  readonly: boolean;\n  feedbackStatus?: FeedbackStatus;\n  feedbackText?: string;\n  options: {\n    mode: RadioType;\n    options: RadioItem[];\n    direction?: 'vertical' | 'horizontal';\n    customClassName?: string;\n  };\n  customInputComp?: React.ReactNode;\n}\n\nconst DEFAULT_MAX_LEVEL = 3;\nconst DEFAULT_MAX_TOKEN = 800;\nconst DEFAULT_OVERLAP = 0.1;\n\nexport const DatasetWriteChunk: FC<RadioProps> = props => {\n  const {\n    value,\n    onChange,\n    options,\n    readonly,\n    feedbackStatus,\n    feedbackText,\n    customInputComp,\n  } = props;\n\n  const { getNodeSetterId } = useNodeTestId();\n\n  // Set default value\n  useEffect(() => {\n    if (\n      isNil(value?.chunkType) &&\n      isNil(value?.maxLevel) &&\n      isNil(value?.saveTitle) &&\n      isNil(value?.overlap) &&\n      isNil(value?.maxToken) &&\n      isNil(value?.separator)\n    ) {\n      onChange?.({\n        chunkType: ChunkStratgy.Default,\n      });\n    }\n  }, [value, onChange]);\n\n  const seperatorOptionList = getSeperatorOptionList() ?? [];\n\n  const isCustomChunk = value?.chunkType === ChunkStratgy.Custom;\n  const isCustomSeparator = value?.separatorType === SeperatorType.CUSTOM;\n\n  return (\n    <div\n      className={classNames('w-full mt-[4px]', {\n        [options?.customClassName as string]: options?.customClassName,\n      })}\n    >\n      <Radio\n        {...props}\n        options={{\n          ...props?.options,\n          direction: 'vertical',\n          customClassName: classNames(\n            styles['parser-radio-group'],\n            isCustomChunk ? 'mb-[4px]' : 'mb-[24px]',\n          ),\n        }}\n        value={value?.chunkType}\n        onChange={v => {\n          const nextChunkType = (v as unknown as RadioChangeEvent)?.target\n            ?.value as ChunkStratgy;\n          const nextValue = {\n            chunkType: nextChunkType,\n          };\n          if (nextChunkType === ChunkStratgy.Layer) {\n            set(nextValue, 'maxLevel', DEFAULT_MAX_LEVEL);\n          } else if (nextChunkType === ChunkStratgy.Custom) {\n            set(nextValue, 'separatorType', SeperatorType.LINE_BREAK);\n            set(nextValue, 'separator', SeperatorType.LINE_BREAK);\n            set(nextValue, 'maxToken', DEFAULT_MAX_TOKEN);\n            set(nextValue, 'overlap', DEFAULT_OVERLAP);\n          }\n          onChange(nextValue);\n        }}\n      />\n      {/* Issue 1 does not show */}\n      {/* {value?.chunkType === ChunkStratgy.Layer && (\n        <div>\n          <div className={styles['setting-item']}>\n            <TitleArea\n              Title = {'Segment Hierarchy'}\n              tip={\n                'The maximum hierarchical range of the segmented tree structure, e.g. 3 layers will identify the document title, primary title, and secondary title structure information'\n              }\n              titleClassName=\"text-[#060709CC] text-[12px]\"\n            />\n            <InputNumber\n              className=\"w-[360px]\"\n              size=\"small\"\n              value={value?.maxLevel}\n              onChange={v =>\n                onChange({\n                  ...value,\n                  maxLevel: v as number,\n                })\n              }\n            />\n          </div>\n          <CheckboxWithLabel\n            Label = \"Retrieve slice retention level information\"\n            Tooltip = \"Whether to keep the level header information in the slice, it is easier to return all the slice content under that level when retrieving the title after retention\"\n            checked={value?.saveTitle}\n            onChange={v =>\n              onChange({\n                ...value,\n                saveTitle: v as boolean,\n              })\n            }\n            className=\"text-[#060709CC]\"\n          />\n        </div>\n      )} */}\n      {isCustomChunk ? (\n        <div>\n          <div\n            className={styles['setting-item']}\n            style={{\n              marginBottom: isCustomSeparator ? '8px' : '16px',\n            }}\n          >\n            <div\n              style={{\n                flex: 2,\n              }}\n            >\n              <TitleArea\n                title={I18n.t('datasets_Custom_segmentID')}\n                tip={I18n.t('kl_write_030')}\n                titleClassName=\"text-[#060709CC] text-[12px]\"\n              />\n            </div>\n\n            <div\n              style={{\n                flex: 3,\n              }}\n            >\n              <Select\n                size=\"small\"\n                placeholder={I18n.t('datasets_custom_segmentID_placeholder')}\n                className={styles['separator-select']}\n                style={{\n                  width: '100%',\n                  height: '24px',\n                  borderColor: '#06070926',\n                  borderRadius: '6px',\n                }}\n                value={value?.separatorType}\n                onChange={v =>\n                  onChange({\n                    ...value,\n                    separator:\n                      v === SeperatorType.CUSTOM ? '###' : (v as SeperatorType),\n                    separatorType: v as SeperatorType,\n                  })\n                }\n                data-testid={getNodeSetterId('dataset-write-separator-select')}\n              >\n                {seperatorOptionList?.map(item => (\n                  <Select.Option\n                    key={item.value}\n                    value={item.value}\n                    data-testid={getNodeSetterId(\n                      'dataset-write-separator-option',\n                    )}\n                  >\n                    {item.label}\n                  </Select.Option>\n                ))}\n              </Select>\n            </div>\n          </div>\n          {isCustomSeparator ? (\n            <div\n              className={classNames(\n                `w-full flex items-end 'flex-row' ${styles['custom-input']}`,\n              )}\n            >\n              <div\n                style={{\n                  flex: 2,\n                }}\n              >\n                <div className=\"w-[20px] h-[28px]\" />\n              </div>\n              <div\n                style={{\n                  flex: 3,\n                }}\n              >\n                {customInputComp ? (\n                  customInputComp\n                ) : (\n                  <>\n                    <Input\n                      style={{\n                        fontSize: '12px',\n                        width: '100%',\n                      }}\n                      value={value?.separator}\n                      onChange={v =>\n                        onChange({\n                          ...value,\n                          separator: v as string,\n                        })\n                      }\n                      placeholder={I18n.t(\n                        'datasets_custom_segmentID_placeholder',\n                      )}\n                      data-testid={getNodeSetterId(\n                        'dataset-write-separator-input',\n                      )}\n                    />\n                    {feedbackStatus === 'error' && (\n                      <div className=\"text-[12px] leading-[16px] text-[#ff441e]\">\n                        {feedbackText}\n                      </div>\n                    )}\n                  </>\n                )}\n              </div>\n            </div>\n          ) : null}\n\n          <div className={styles['setting-item']}>\n            <div\n              style={{\n                flex: 2,\n              }}\n            >\n              <TitleArea\n                title={I18n.t('datasets_Custom_maxLength')}\n                tip={I18n.t('kl_write_031')}\n                titleClassName=\"text-[#060709CC] text-[12px]\"\n              />\n            </div>\n            <div\n              className=\"relative pt-[14px]\"\n              style={{\n                flex: 3,\n              }}\n            >\n              <SliderArea\n                min={100}\n                max={5000}\n                step={1}\n                customStyles={{\n                  sliderAreaStyle: {\n                    width: '100%',\n                  },\n                  boundaryStyle: {\n                    width: '100%',\n                    margin: 0,\n                  },\n                }}\n                isDataSet\n                value={value?.maxToken as number}\n                marks={{\n                  markKey: DEFAULT_MAX_TOKEN,\n                  // Set margin-left to avoid overlap with number 1\n                  markText: <span className=\"ml-9\">Default</span>,\n                }}\n                disabled={readonly}\n                onChange={v => {\n                  onChange({\n                    ...value,\n                    maxToken: v as number,\n                  });\n                }}\n                onClickDefault={() => {\n                  onChange({\n                    ...value,\n                    maxToken: DEFAULT_MAX_TOKEN,\n                  });\n                }}\n              />\n            </div>\n          </div>\n          <div className={styles['setting-item']}>\n            <div\n              style={{\n                flex: 2,\n              }}\n            >\n              <TitleArea\n                title={I18n.t('kl_write_014')}\n                tip={I18n.t('kl_write_015')}\n                titleClassName=\"text-[#060709CC] text-[12px]\"\n              />\n            </div>\n            <div\n              className=\"relative pt-[14px]\"\n              style={{\n                flex: 3,\n              }}\n            >\n              <SliderArea\n                min={0}\n                max={0.9}\n                step={0.01}\n                customStyles={{\n                  sliderAreaStyle: {\n                    width: '100%',\n                  },\n                  boundaryStyle: {\n                    width: '100%',\n                    margin: 0,\n                  },\n                }}\n                isDataSet\n                value={value?.overlap as number}\n                marks={{\n                  markKey: DEFAULT_OVERLAP,\n                  // Set margin-left to avoid overlap with number 1\n                  markText: <span className=\"ml-8\">Default</span>,\n                }}\n                disabled={readonly}\n                onChange={v => {\n                  onChange({\n                    ...value,\n                    overlap: v as number,\n                  });\n                }}\n                onClickDefault={() => {\n                  onChange({\n                    ...value,\n                    overlap: DEFAULT_OVERLAP,\n                  });\n                }}\n              />\n            </div>\n          </div>\n        </div>\n      ) : null}\n    </div>\n  );\n};\n\nexport const DatasetWriteChunkSetter = {\n  key: 'DatasetWriteChunk',\n  component: DatasetWriteChunk,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, type FC, useMemo } from 'react';\n\nimport { isNil, set } from 'lodash-es';\nimport { useWorkflowNode, useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport type {\n  OptionItem,\n  RadioChangeEvent,\n  RadioType,\n} from '@coze-arch/bot-semi/Radio';\nimport type { SetterOrDecoratorContext } from '@flowgram-adapter/free-layout-editor';\n\nimport { Radio } from '../radio';\nimport { CheckboxWithLabel } from '../checkbox-with-label';\n\nimport styles from './index.module.less';\n\ntype RadioItem = OptionItem & {\n  disabled?: boolean | ((context: SetterOrDecoratorContext) => boolean);\n};\n\nenum ParseStratgy {\n  Fast = 'fast',\n  Accurate = 'accurate',\n}\n\ninterface ParserValue {\n  parsingType?: ParseStratgy;\n  imageExtraction?: boolean;\n  tableExtraction?: boolean;\n  imageOcr?: boolean;\n}\n\ninterface RadioProps {\n  value?: ParserValue;\n  onChange?: (v: ParserValue) => void;\n  readonly?: boolean;\n  options: {\n    mode: RadioType;\n    options: RadioItem[];\n    direction?: 'vertical' | 'horizontal';\n    customClassName?: string;\n  };\n}\n\nexport const DatasetWriteParser: FC<RadioProps> = props => {\n  const { value, onChange, readonly } = props;\n\n  const { data } = useWorkflowNode();\n  const { getNodeSetterId } = useNodeTestId();\n\n  // Set default value\n  useEffect(() => {\n    if (\n      isNil(value?.parsingType) &&\n      isNil(value?.imageExtraction) &&\n      isNil(value?.tableExtraction) &&\n      isNil(value?.imageOcr)\n    ) {\n      // The search policy for new nodes defaults to Hybird\n      onChange?.({\n        parsingType: ParseStratgy.Fast,\n      });\n    }\n  }, [value, onChange]);\n\n  const isPresice = value?.parsingType === ParseStratgy.Accurate;\n  const isCustomChunk =\n    data.inputs?.datasetWriteParameters?.chunkStrategy?.chunkType === 'custom';\n\n  // The first phase does not support \"accurate analysis\" + \"custom segmentation\" + \"picture Chinese text\"\n  const isImageOcrDisable = useMemo(\n    () => isPresice && isCustomChunk,\n    [isPresice, isCustomChunk],\n  );\n\n  useEffect(() => {\n    if (isImageOcrDisable) {\n      onChange?.({\n        ...value,\n        imageOcr: false,\n      });\n    }\n  }, [isImageOcrDisable]);\n\n  return (\n    <div className=\"mb-[12px] mt-[4px]\">\n      <Radio\n        {...props}\n        options={{\n          ...props?.options,\n          direction: 'vertical',\n          customClassName: styles['parser-radio-group'],\n        }}\n        value={value?.parsingType}\n        onChange={v => {\n          const nextParsingType = (v as unknown as RadioChangeEvent)?.target\n            ?.value as ParseStratgy;\n          const nextValue = {\n            parsingType: nextParsingType,\n          };\n\n          // Switch to \"Precision Resolution\" setting default\n          if (nextParsingType === ParseStratgy.Accurate) {\n            set(nextValue, 'imageExtraction', true);\n            set(nextValue, 'tableExtraction', true);\n            set(nextValue, 'imageOcr', true);\n          }\n\n          onChange?.(nextValue);\n        }}\n        readonly={readonly}\n      />\n      {value?.parsingType === ParseStratgy.Accurate ? (\n        <div className=\"mt-[8px]\">\n          <CheckboxWithLabel\n            label={I18n.t('kl_write_008')}\n            checked={value?.imageExtraction}\n            onChange={v =>\n              onChange?.({\n                ...value,\n                imageExtraction: v as boolean,\n              })\n            }\n            readonly={readonly}\n            dataTestId={getNodeSetterId('dataset-write-imageExtraction')}\n          />\n          <CheckboxWithLabel\n            label={I18n.t('kl_write_009')}\n            checked={value?.imageOcr}\n            onChange={v =>\n              onChange?.({\n                ...value,\n                imageOcr: v as boolean,\n              })\n            }\n            disabled={isImageOcrDisable}\n            readonly={readonly}\n            dataTestId={getNodeSetterId('dataset-write-imageOcr')}\n          />\n          <CheckboxWithLabel\n            label={I18n.t('kl_write_010')}\n            checked={value?.tableExtraction}\n            onChange={v =>\n              onChange?.({\n                ...value,\n                tableExtraction: v as boolean,\n              })\n            }\n            readonly={readonly}\n            dataTestId={getNodeSetterId('dataset-write-tableExtraction')}\n          />\n        </div>\n      ) : null}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n  type CSSProperties,\n  type ForwardedRef,\n  type PropsWithChildren,\n  type ReactNode,\n} from 'react';\n\nimport classNames from 'classnames';\nimport { type WorkflowPortType } from '@flowgram-adapter/free-layout-editor';\nimport { EmptyFunction } from '@coze-workflow/base/constants';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport {\n  IconCozArrowDownFill,\n  IconCozInfoCircle,\n} from '@coze-arch/coze-design/icons';\nimport { Collapsible, Image } from '@coze-arch/coze-design';\n\nimport {\n  FormItemFeedback,\n  type FormItemErrorProps,\n} from '../form-item-feedback';\nimport createSlots from '../../../utils/create-slots';\nimport AutoSizeTooltip from '../../../ui-components/auto-size-tooltip';\n\nimport s from './index.module.less';\n\nexport interface FormCardProps {\n  header?: ReactNode;\n  icon?: string;\n  actionButton?: ReactNode;\n  actionButtonStyle?: CSSProperties;\n  tooltip?: string | ReactNode;\n  tooltipContent?: ReactNode;\n  tooltipClassName?: string;\n  maxContentHeight?: number;\n  showBottomBorder?: boolean;\n  showBorderTopRadius?: boolean;\n  className?: string;\n  contentClassName?: string;\n  headerClassName?: string;\n  style?: CSSProperties;\n  collapsible?: boolean;\n  defaultExpand?: boolean;\n  expand?: boolean;\n  onExpandChange?: (expand: boolean) => void;\n  autoExpandWhenDomChange?: boolean;\n  onRef?: ForwardedRef<ContentRef>;\n  noPadding?: boolean;\n  feedbackText?: FormItemErrorProps['feedbackText'];\n  feedbackStatus?: FormItemErrorProps['feedbackStatus'];\n  disableFeedback?: boolean;\n  portInfo?: { portID: string; portType: WorkflowPortType }; // point\n  testId?: string;\n  motion?: boolean;\n  required?: boolean;\n  hidden?: boolean;\n  headerStyle?: CSSProperties;\n}\n\nexport interface ContentRef {\n  setOpen?: (isOpen: boolean) => void;\n}\n\n/** Customize the action button class name to determine whether the click event triggers the collapse */\nconst CUSTOM_ACTION_BUTTON_CLASS = 'custom-action-button';\n\nconst { Slots, Slot } = createSlots(['Action']);\n\nconst Action: React.FC<React.PropsWithChildren> = ({ children }) => (\n  <Slot name=\"Action\">{children}</Slot>\n);\n\nconst FormCard: React.FC<PropsWithChildren<FormCardProps>> & {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  Action: React.FC<React.PropsWithChildren>;\n} = ({\n  children,\n  icon,\n  header,\n  actionButton,\n  actionButtonStyle,\n  maxContentHeight,\n  tooltip,\n  tooltipClassName,\n  className,\n  contentClassName,\n  headerClassName,\n  style,\n  collapsible = true,\n  defaultExpand = true,\n  autoExpandWhenDomChange,\n  onRef,\n  noPadding = false,\n  feedbackText,\n  feedbackStatus,\n  disableFeedback = false,\n  expand,\n  motion,\n  required,\n  hidden,\n  headerStyle,\n  testId,\n}) => {\n  const [isOpen, setIsOpen] = useState(expand ?? defaultExpand);\n  const childNodeRef = useRef<HTMLDivElement>(null);\n\n  const { getNodeSetterId, concatTestId } = useNodeTestId();\n\n  const setterTestId = concatTestId(testId || getNodeSetterId(''), 'form-card');\n\n  const childNode = (\n    <div\n      ref={childNodeRef}\n      style={{ maxHeight: maxContentHeight ? maxContentHeight : 'unset' }}\n    >\n      {children}\n    </div>\n  );\n\n  useEffect(() => {\n    if (typeof expand !== 'undefined') {\n      setIsOpen(expand);\n    }\n  }, [expand]);\n\n  useEffect(() => {\n    const target = childNodeRef.current;\n    if (autoExpandWhenDomChange && target) {\n      const config = { attributes: true, childList: true, subtree: true };\n      // Only when the dom change auto-unfold function is turned on\n      const callback: MutationCallback = mutationList => {\n        if (mutationList.length > 0 && !isOpen) {\n          // When the dom changes and is not turned on, it will automatically turn on\n          setIsOpen(!isOpen);\n        }\n      };\n      const observer = new MutationObserver(callback);\n      observer.observe(target, config);\n\n      return () => {\n        observer.disconnect();\n      };\n    }\n    return EmptyFunction;\n  }, [isOpen]);\n\n  useImperativeHandle(onRef, () => ({\n    setOpen,\n  }));\n\n  // eslint-disable-next-line @typescript-eslint/no-shadow\n  const setOpen = (isOpen: boolean) => {\n    setIsOpen(isOpen);\n  };\n\n  return (\n    <Slots>\n      {slots => (\n        <div\n          className={classNames(className, s['content-block'], {\n            [s['no-padding']]: noPadding,\n            hidden,\n          })}\n          style={style}\n        >\n          <header\n            className={classNames(s['header-content'], headerClassName, {\n              [s['header-has-content']]: isOpen\n                ? collapsible || icon || header || tooltip\n                : false,\n              [s['header-is-closed']]: !isOpen,\n              'cursor-pointer': collapsible,\n            })}\n            style={headerStyle}\n            onClick={e => {\n              if (!collapsible) {\n                return;\n              }\n              // Region checks whether the click event comes from the action button and does not collapse the click button event\n              // Q: Why not directly in the operation button stopPropagation?\n              // A: In order not to hinder the top-level capture card click event, it is used to put the card on the top\n              let el = e.target as HTMLElement;\n              // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n              for (let i = 0; i <= 8; i++) {\n                if (el.classList.contains(CUSTOM_ACTION_BUTTON_CLASS)) {\n                  return;\n                }\n                if (!el.parentElement) {\n                  break;\n                }\n                el = el.parentElement;\n              }\n              // endregion\n              setIsOpen(!isOpen);\n            }}\n          >\n            <div\n              className={s.header}\n              data-testid={concatTestId(setterTestId, 'title')}\n            >\n              {collapsible ? (\n                <div\n                  className={classNames(\n                    collapsible ? 'cursor-pointer' : 'cursor-default',\n                    {\n                      [s['header-icon-arrow']]: true,\n                      [s.open]: isOpen,\n                    },\n                  )}\n                  data-testid={concatTestId(setterTestId, 'arrow')}\n                >\n                  <IconCozArrowDownFill className=\"coz-fg-secondary\" />\n                </div>\n              ) : null}\n              {icon ? (\n                <Image\n                  preview={false}\n                  className={s['header-icon']}\n                  src={icon}\n                />\n              ) : null}\n              {header ? (\n                <div className={s.label}>\n                  {header}\n                  {required ? (\n                    <span className=\"ml-[2px] text-[#FF441E]\">*</span>\n                  ) : null}\n                </div>\n              ) : null}\n              {tooltip ? (\n                <AutoSizeTooltip\n                  showArrow\n                  position=\"top\"\n                  className={s.popover}\n                  content={\n                    <span\n                      data-testid={concatTestId(\n                        setterTestId,\n                        'tooltip-content',\n                      )}\n                    >\n                      {tooltip}\n                    </span>\n                  }\n                  tooltipClassName={tooltipClassName}\n                >\n                  <IconCozInfoCircle\n                    data-testid={concatTestId(\n                      setterTestId,\n                      'tooltip-icon-info',\n                    )}\n                    className=\"text-lg coz-fg-secondary\"\n                  />\n                </AutoSizeTooltip>\n              ) : null}\n            </div>\n            <div\n              className={CUSTOM_ACTION_BUTTON_CLASS}\n              style={{ ...(actionButtonStyle || {}) }}\n            >\n              {slots.Action || actionButton}\n            </div>\n          </header>\n          <div\n            className={classNames({\n              [s['overflow-content']]: true,\n              [contentClassName || '']: Boolean(contentClassName),\n              [s.open]: isOpen,\n            })}\n          >\n            <Collapsible keepDOM fade isOpen={isOpen} motion={motion}>\n              {childNode}\n            </Collapsible>\n          </div>\n          {!disableFeedback && (\n            <FormItemFeedback\n              feedbackText={feedbackText}\n              feedbackStatus={feedbackStatus}\n            />\n          )}\n        </div>\n      )}\n    </Slots>\n  );\n};\n\nFormCard.Action = Action;\n\nexport { FormCard };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport classnames from 'classnames';\nimport { type WithCustomStyle } from '@coze-workflow/base/types';\nimport { type FeedbackStatus } from '@flowgram-adapter/free-layout-editor';\n\nimport s from './index.module.less';\n\nexport interface FormItemErrorProps extends WithCustomStyle {\n  feedbackText?: string;\n  feedbackStatus?: FeedbackStatus;\n}\n\nexport const FormItemFeedback = ({\n  feedbackText,\n  className,\n  style,\n}: FormItemErrorProps) =>\n  feedbackText ? (\n    <div className={classnames(s.formItemError, className)} style={style}>\n      {feedbackText}\n    </div>\n  ) : null;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  type FC,\n  type ReactNode,\n  type CSSProperties,\n  type PropsWithChildren,\n} from 'react';\n\nimport classNames from 'classnames';\nimport { type WithCustomStyle } from '@coze-workflow/base/types';\nimport { IconCozInfoCircle } from '@coze-arch/coze-design/icons';\nimport { Row, Col } from '@coze-arch/coze-design';\nimport { type ColProps } from '@coze-arch/bot-semi/Grid';\n\nimport {\n  FormItemFeedback,\n  type FormItemErrorProps,\n} from '../form-item-feedback';\nimport AutoSizeTooltip from '../../../ui-components/auto-size-tooltip';\n\nimport s from './index.module.less';\n\nexport interface FormItemProps {\n  required?: boolean;\n  hideRequiredTag?: boolean;\n  layout?: 'horizontal' | 'vertical';\n  label?: ReactNode;\n  tooltip?: ReactNode;\n  tag?: ReactNode;\n  labelAlign?: 'left' | 'right';\n  labelCol?: ColProps;\n  wrapperCol?: ColProps;\n  labelBlockStyle?: CSSProperties;\n  labelStyle?: CSSProperties;\n  labelColStyle?: CSSProperties;\n  labelClassName?: string;\n  wrapperColStyle?: CSSProperties;\n  feedbackText?: FormItemErrorProps['feedbackText'];\n  feedbackStatus?: FormItemErrorProps['feedbackStatus'];\n  disableFeedback?: boolean;\n}\n\n/**\n * Since the semi-ui Form does not provide a FormItem component for layout, it encapsulates a FormItem separately and continues to iterate with requirements\n */\nexport const FormItem: FC<\n  PropsWithChildren<WithCustomStyle<FormItemProps>>\n> = props => {\n  const {\n    className,\n    style = {},\n    required,\n    hideRequiredTag = false,\n    layout = 'horizontal',\n    label,\n    tooltip,\n    tag,\n    labelAlign = 'left',\n    labelCol = {\n      span: 9,\n    },\n    wrapperCol = {\n      span: 15,\n    },\n    labelBlockStyle = {},\n    labelStyle = {},\n    labelColStyle = {},\n    wrapperColStyle = {},\n    labelClassName,\n    feedbackText,\n    feedbackStatus,\n    children,\n    disableFeedback = false,\n  } = props;\n  const renderLabelContent = () => (\n    <div className=\"flex items-center\">\n      <div className=\"flex overflow-hidden items-center\">\n        <AutoSizeTooltip\n          content={label}\n          showArrow\n          position=\"top\"\n          className=\"flex-1 grow-1 truncate\"\n        >\n          <span\n            className={classNames(\n              'flex-1 grow-1 truncate coz-fg-primary text-[12px] leading-[24px]',\n              labelClassName,\n            )}\n            style={labelStyle}\n          >\n            {label}\n          </span>\n        </AutoSizeTooltip>\n\n        {required && !hideRequiredTag ? (\n          <span\n            className=\"mt-[2px]\"\n            style={{ color: 'var(--light-usage-danger-color-danger,#f93920)' }}\n          >\n            *\n          </span>\n        ) : null}\n        {tooltip ? (\n          <AutoSizeTooltip\n            showArrow\n            position=\"top\"\n            className={s.popover}\n            content={tooltip}\n          >\n            <IconCozInfoCircle className=\"coz-fg-secondary text-xs\" />\n          </AutoSizeTooltip>\n        ) : null}\n      </div>\n      {tag ? (\n        <div className=\"flex-1 shrink-0 grow-1 flex items-center\">{tag}</div>\n      ) : null}\n    </div>\n  );\n\n  const showLabel = !!label;\n  if (layout === 'horizontal') {\n    return (\n      <div\n        className={classNames(s.formItem, className, {\n          [s.formItemHorizontal]: layout === 'horizontal',\n        })}\n        style={style}\n      >\n        <Row type=\"flex\" align=\"middle\">\n          <Col\n            {...labelCol}\n            style={{\n              ...{ alignSelf: 'flex-start' },\n              ...labelColStyle,\n            }}\n          >\n            <div\n              className={classNames(s.formItemLabel, {\n                [s.formItemLabelRight]: labelAlign === 'right',\n              })}\n            >\n              {renderLabelContent()}\n            </div>\n          </Col>\n          <Col {...wrapperCol} style={wrapperColStyle}>\n            {children}\n            {!disableFeedback && (\n              <FormItemFeedback\n                feedbackText={feedbackText}\n                feedbackStatus={feedbackStatus}\n              />\n            )}\n          </Col>\n        </Row>\n      </div>\n    );\n  } else {\n    return (\n      <div\n        className={classNames(s.formItem, className, {\n          [s.formItemVertical]: layout === 'vertical',\n        })}\n        style={style}\n      >\n        {showLabel ? (\n          <div\n            className={classNames(s.formItemLabel, {\n              [s.formItemLabelRight]: labelAlign === 'right',\n            })}\n            style={labelBlockStyle}\n          >\n            {renderLabelContent()}\n          </div>\n        ) : null}\n        <div>{children}</div>\n        {!disableFeedback && (\n          <FormItemFeedback\n            feedbackText={feedbackText}\n            feedbackStatus={feedbackStatus}\n          />\n        )}\n      </div>\n    );\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type MouseEventHandler, type FC, type ReactNode } from 'react';\n\nimport { Tooltip, IconButton } from '@coze-arch/coze-design';\n\nexport const TooltipAction: FC<{\n  icon: ReactNode;\n  tooltip: ReactNode;\n  onClick?: MouseEventHandler<HTMLButtonElement>;\n  testID?: string;\n}> = props => {\n  const { icon, tooltip, onClick, testID } = props;\n  return (\n    <Tooltip content={tooltip} autoAdjustOverflow>\n      <IconButton\n        icon={icon}\n        color=\"secondary\"\n        onClick={onClick}\n        data-testid={testID}\n      />\n    </Tooltip>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, type ReactNode } from 'react';\n\nimport classnames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozTrashCan } from '@coze-arch/coze-design/icons';\nimport { Avatar } from '@coze-arch/coze-design';\nimport { type Position } from '@coze-arch/bot-semi/Tooltip';\n\nimport { Text } from '../text';\nimport { TooltipAction } from './tooltip-action';\n\ninterface IconNameDescProps {\n  icon?: string | React.ReactNode;\n  name?: string;\n  description?: string;\n  onRemove?: () => void;\n  readonly?: boolean;\n  onClick?: () => void;\n  actions?: ReactNode;\n  testID?: string;\n  nameSuffix?: ReactNode | string;\n  isInvalid?: boolean;\n  showDeleteBtn?: boolean;\n  alwaysShowActions?: boolean;\n  className?: string;\n  descriptionTooltipPosition?: Position;\n}\n\nexport const IconNameDescCard: FC<IconNameDescProps> = props => {\n  const {\n    name,\n    icon,\n    description,\n    onRemove,\n    onClick,\n    readonly,\n    actions,\n    testID,\n    nameSuffix,\n    isInvalid,\n    showDeleteBtn = true,\n    alwaysShowActions = false,\n    className,\n    descriptionTooltipPosition,\n  } = props;\n\n  return (\n    <div\n      className={classnames(\n        'group coz-stroke-primary coz-mg-card p-2.5 rounded-lg border border-solid flex items-center gap-2.5 mb-2 last:mb-0 hover:coz-mg-secondary',\n        {\n          'cursor-pointer hover:cursor-pointer': onClick && !isInvalid,\n          'cursor-not-allowed': isInvalid,\n        },\n        className,\n      )}\n      onClick={readonly ? undefined : onClick}\n      data-testid={testID}\n    >\n      <div\n        className=\"h-8\"\n        style={{\n          flex: '0 0 32px',\n        }}\n      >\n        {icon ? (\n          typeof icon === 'string' ? (\n            <Avatar\n              src={icon}\n              size=\"small\"\n              className=\"coz-stroke-primary rounded-mini overflow-hidden border border-solid\"\n            />\n          ) : (\n            icon\n          )\n        ) : null}\n      </div>\n      <div className=\"flex-1 overflow-hidden\">\n        <div className=\"flex items-center\">\n          <Text\n            className=\"!coz-fg-primary !leading-mini !font-medium !text-base\"\n            text={name}\n          />\n          {nameSuffix ? (\n            <div className=\"flex items-center ml-[4px]\">{nameSuffix}</div>\n          ) : null}\n        </div>\n        <Text\n          className=\"!coz-fg-secondary !leading-mini !font-normal !text-base\"\n          text={description}\n          tooltipPosition={descriptionTooltipPosition}\n        />\n      </div>\n      <div\n        className={classnames('flex-0', {\n          'hidden group-hover:block': !alwaysShowActions,\n        })}\n        onClick={e => {\n          e.stopPropagation();\n        }}\n      >\n        <div className=\"flex gap-1.5\">\n          {readonly ? (\n            <></>\n          ) : (\n            <>\n              {actions ?? undefined}\n              {showDeleteBtn ? (\n                <TooltipAction\n                  tooltip={I18n.t('Remove')}\n                  icon={<IconCozTrashCan />}\n                  onClick={onRemove}\n                  testID={`${testID}.remove`}\n                />\n              ) : null}\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/naming-convention */\n\n/** Indent width of each level of tree */\nexport const TreeIndentWidth = 15;\n/** Tree Node Expand Collapse Button Width */\nexport const TreeCollapseWidth = 10;\n\nexport enum ChangeMode {\n  Update,\n  Delete,\n  Append,\n  DeleteChildren,\n}\nexport const MAX_TREE_LEVEL = 3;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { nanoid } from 'nanoid';\nimport { type InputValueVO, ViewVariableType } from '@coze-workflow/base';\n\nimport { type TreeNodeCustomData } from './types';\n\ninterface RootFindResult {\n  isRoot: true;\n  data: TreeNodeCustomData;\n  parentData: null;\n}\ninterface ChildrenFindResult {\n  isRoot: false;\n  parentData: TreeNodeCustomData;\n  data: TreeNodeCustomData;\n}\n\nexport type FindDataResult = RootFindResult | ChildrenFindResult | null;\n/**\n * According to the target array, find the value and position of the key in the item, mainly to obtain the position, which is convenient for operating the children of the parent.\n */\nexport function findCustomTreeNodeDataResult(\n  target: Array<TreeNodeCustomData>,\n  findField: string,\n): FindDataResult {\n  const dataInRoot = target.find(item => item.field === findField);\n  if (dataInRoot) {\n    // If it is the root node\n    return {\n      isRoot: true,\n      parentData: null,\n      data: dataInRoot,\n    };\n  }\n  function findDataInChildrenLoop(\n    customChildren: Array<TreeNodeCustomData>,\n    parentData?: TreeNodeCustomData,\n  ): FindDataResult {\n    function findDataLoop(\n      customData: TreeNodeCustomData,\n      _parentData: TreeNodeCustomData,\n    ): FindDataResult {\n      if (customData.field === findField) {\n        return {\n          isRoot: false,\n          parentData: _parentData,\n          data: customData,\n        };\n      }\n      if (customData.children && customData.children.length > 0) {\n        return findDataInChildrenLoop(\n          customData.children as Array<TreeNodeCustomData>,\n          customData,\n        );\n      }\n      return null;\n    }\n    for (const child of customChildren) {\n      const childResult = findDataLoop(child, parentData || child);\n      if (childResult) {\n        return childResult;\n      }\n    }\n    return null;\n  }\n  return findDataInChildrenLoop(target);\n}\nexport function isObjectTreeNode(item?: TreeNodeCustomData) {\n  return item?.input?.rawMeta?.type === ViewVariableType.Object;\n}\n\nconst MAX_LINE_LEVEL = 2;\nexport function formatTreeData(data: Array<TreeNodeCustomData>) {\n  let hasObject = false;\n  const itemKeysWithChildren: string[] = [];\n  function resolveActionParamList(\n    list: Array<TreeNodeCustomData>,\n    field: string,\n    // It is mainly used to assist the judgment of the display line.\n    {\n      parentData,\n      level,\n    }: {\n      parentData?: TreeNodeCustomData;\n      level: number;\n    },\n  ) {\n    const items = list || [];\n    const inputParameters = items\n      .map(item =>\n        item\n          ? {\n              name: item.name,\n              input: item.input,\n            }\n          : undefined,\n      )\n      .filter(Boolean) as InputValueVO[];\n    items.forEach((item, index) => {\n      const keyField = `${field}[${index}]`;\n      hasObject = hasObject || isObjectTreeNode(item);\n      // Assignment children\n      item.key = item.key ?? item.fieldRandomKey ?? nanoid();\n      item.field = keyField;\n      item.inputParameters = inputParameters;\n      item.isFirst = index === 0;\n      item.isLast = index === list.length - 1;\n      item.isSingle = item.isFirst && item.isLast;\n      item.level = level;\n      // The first level does not show the auxiliary line, you need to judge the level\n      // That is, the second level (level = 1) only needs its own level line\n      // After the third level (level = 2), the guide line is required to show the guide line of the previous level\n      item.helpLineShow =\n        parentData && level >= MAX_LINE_LEVEL\n          ? (parentData.helpLineShow || []).concat(!parentData.isLast)\n          : [];\n      if (item.children && item.children.length > 0) {\n        itemKeysWithChildren.push(item.key);\n        resolveActionParamList(\n          item.children as Array<TreeNodeCustomData>,\n          `${keyField}.children`,\n          {\n            parentData: item,\n            level: level + 1,\n          },\n        );\n      }\n    });\n  }\n\n  resolveActionParamList(data || [], '', { level: 0 });\n\n  return {\n    data,\n    hasObject,\n    itemKeysWithChildren,\n  };\n}\n\n/** Calculate Sidebar Width */\nexport const calcIDESideSheetWidth = (nodeWidth?: number) => {\n  const minWorkflowWidth = 1000;\n  const sideSheetReduceScale = 0.66;\n  const sideSheetMinWidth = 850;\n  const windowWidth = window.innerWidth;\n  const computedSideSheetWidth = windowWidth * sideSheetReduceScale;\n  const computedCanvasWidth = windowWidth - computedSideSheetWidth;\n\n  if (windowWidth < minWorkflowWidth) {\n    return computedSideSheetWidth;\n  }\n\n  if (nodeWidth && computedCanvasWidth < nodeWidth) {\n    return windowWidth - nodeWidth;\n  }\n\n  if (computedSideSheetWidth < sideSheetMinWidth) {\n    return sideSheetMinWidth;\n  } else {\n    return computedSideSheetWidth;\n  }\n};\n\ninterface TreeNode<T> {\n  children?: T[];\n  [key: string]: unknown;\n}\n\nexport function traverse<T extends TreeNode<T>>(\n  nodeOrNodes: T | T[],\n  action: (node: T) => void,\n) {\n  const nodes = Array.isArray(nodeOrNodes) ? nodeOrNodes : [nodeOrNodes];\n\n  nodes.forEach(node => {\n    action(node);\n\n    if (node.children && node.children.length > 0) {\n      traverse(node.children, action);\n    }\n  });\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createContext, useContext } from 'react';\n\ninterface InputTreeContext {\n  testId?: string;\n}\n\nconst inputTreeContext = createContext<InputTreeContext>({});\n\nexport const useInputTreeContext = () => useContext(inputTreeContext);\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport const InputTreeContextProvider = inputTreeContext.Provider;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo, type FC } from 'react';\n\nimport {\n  useNodeTestId,\n  ValueExpression,\n  ViewVariableType,\n} from '@coze-workflow/base';\n\nimport {\n  ValueExpressionInput,\n  type ValueExpressionInputProps,\n} from '@/form-extensions/components/value-expression-input';\n\nimport { type TreeNodeCustomData } from '../../types';\nimport { MAX_TREE_LEVEL } from '../../constants';\nimport { ValidationErrorWrapper } from '../../../validation/validation-error-wrapper';\n\nimport styles from './index.module.less';\n\ninterface Props {\n  data: TreeNodeCustomData;\n  onChange: ValueExpressionInputProps['onChange'];\n  style?: React.CSSProperties;\n  level: number;\n  disabled?: boolean;\n  disabledTypes?: ViewVariableType[];\n  testName?: string;\n}\n\nexport const InputValue: FC<Props> = ({\n  data,\n  onChange,\n  style,\n  level,\n  disabled,\n  disabledTypes,\n  testName = '',\n}) => {\n  const finalDisabledTypes = useMemo(() => {\n    // Object refs restrict type selection\n    if (data.input && ValueExpression.isObjectRef(data.input)) {\n      return ViewVariableType.getComplement([ViewVariableType.Object]);\n    }\n    // More than three levels are not allowed to select Object ArrayObject\n    const levelLimitTypes =\n      level >= MAX_TREE_LEVEL\n        ? [ViewVariableType.Object, ViewVariableType.ArrayObject]\n        : [];\n    return [...new Set([...levelLimitTypes, ...(disabledTypes || [])])];\n  }, [data.input, disabledTypes, level]);\n  const { getNodeSetterId } = useNodeTestId();\n\n  return (\n    <ValidationErrorWrapper\n      path={`${data.field?.slice(data.field.indexOf('['))}.input`}\n      className={styles.container}\n      style={style}\n      errorCompClassName={'output-param-name-error-text'}\n    >\n      {options => (\n        <ValueExpressionInput\n          testId={getNodeSetterId(`${testName}/input`)}\n          value={data?.input}\n          onBlur={() => {\n            // There is a problem with the timing of the validator, add setTimeout to avoid the error message flashing.\n            setTimeout(() => {\n              options.onBlur();\n            }, 33);\n          }}\n          onChange={v => {\n            options.onChange();\n            onChange(v);\n          }}\n          readonly={disabled}\n          disabledTypes={finalDisabledTypes}\n          validateStatus={options.showError ? 'error' : 'default'}\n        />\n      )}\n    </ValidationErrorWrapper>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport React from 'react';\n\nimport classNames from 'classnames';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozMinus } from '@coze-arch/coze-design/icons';\nimport { Tooltip, IconButton } from '@coze-arch/coze-design';\n\nimport { isObjectTreeNode } from '../../utils';\nimport { type TreeNodeCustomData } from '../../types';\nimport { useInputTreeContext } from '../../context';\nimport AddOperation from '../../../../../ui-components/add-operation';\n\nimport styles from './index.module.less';\n\ninterface InputOperatorProps {\n  data: TreeNodeCustomData;\n  level: number;\n  onAppend: () => void;\n  onDelete: () => void;\n  hasObject?: boolean;\n  needRenderAppendChild?: boolean;\n  disableDelete: boolean;\n}\n\nexport function InputOperator({\n  data,\n  level,\n  onDelete,\n  onAppend,\n  hasObject,\n  needRenderAppendChild = true,\n  disableDelete,\n}: InputOperatorProps) {\n  const { testId } = useInputTreeContext();\n  const { concatTestId } = useNodeTestId();\n  const isLimited = level >= 3;\n  // Whether to display the button for adding a child item\n  const _needRenderAppendChild = isObjectTreeNode(data) && !isLimited;\n\n  return (\n    <div className={classNames(styles.container, 'gap-1')}>\n      {hasObject ? (\n        <div className={styles.add}>\n          <Tooltip content={I18n.t('workflow_detail_node_output_add_subitem')}>\n            <div>\n              {_needRenderAppendChild && needRenderAppendChild ? (\n                <AddOperation\n                  data-testid={concatTestId(\n                    testId ?? '',\n                    data.field,\n                    'add-sub-param',\n                  )}\n                  size=\"small\"\n                  color=\"secondary\"\n                  className=\"cursor-pointer\"\n                  onClick={onAppend}\n                  subitem={true}\n                />\n              ) : null}\n            </div>\n          </Tooltip>\n        </div>\n      ) : null}\n\n      <IconButton\n        className=\"!block\"\n        size=\"small\"\n        color=\"secondary\"\n        data-testid={concatTestId(testId ?? '', data.field, 'remove-param')}\n        onClick={() => {\n          onDelete();\n        }}\n        disabled={disableDelete}\n        icon={<IconCozMinus className=\"text-sm\" />}\n      />\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { type RefExpression } from '@coze-workflow/base';\n\nimport { NodeInputName } from '@/nodes-v2/components/node-input-name';\n\nimport { type TreeNodeCustomData } from '../../types';\nimport { ValidationErrorWrapper } from '../../../validation/validation-error-wrapper';\n\nimport styles from './index.module.less';\n\ninterface InputNameProps {\n  data: TreeNodeCustomData;\n  disabled?: boolean;\n  onChange: (name: string) => void;\n  style?: React.CSSProperties;\n  isPureText?: boolean;\n  initValidate?: boolean;\n  testName?: string;\n}\n\n/**\n * Enter name\n */\nexport function InputName({\n  data,\n  disabled,\n  onChange,\n  style,\n  isPureText = false,\n  testName = '',\n}: InputNameProps) {\n  return (\n    <ValidationErrorWrapper\n      path={`${data.field?.slice(data.field.indexOf('['))}.name`}\n      className={styles.container}\n      style={style}\n      errorCompClassName={'output-param-name-error-text'}\n    >\n      {options => (\n        <NodeInputName\n          name={`${testName}/name`}\n          value={data.name}\n          input={data.input as RefExpression}\n          inputParameters={data.inputParameters || []}\n          onChange={name => {\n            onChange?.(name as string);\n            options.onChange();\n          }}\n          onBlur={() => {\n            // There is a problem with the timing of the validator, add setTimeout to avoid the error message flashing.\n            setTimeout(() => {\n              options.onBlur();\n            }, 33);\n          }}\n          isPureText={isPureText}\n          disabled={disabled}\n        />\n      )}\n    </ValidationErrorWrapper>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TreeIndentWidth } from '../constants';\n\ninterface ColumnsStyle {\n  name: React.CSSProperties;\n  value: React.CSSProperties;\n}\n\nexport function useColumnsStyle(columnsRatio = '3:2', level = 0): ColumnsStyle {\n  const [nameWidth, valueWidth] = columnsRatio.split(':').map(Number);\n\n  return {\n    name: {\n      flex: `${nameWidth} ${nameWidth} 0`,\n    },\n    value: {\n      flex: `${valueWidth} ${valueWidth} ${\n        (level * TreeIndentWidth * valueWidth) / nameWidth\n      }px`,\n    },\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useRef } from 'react';\n\nimport classNames from 'classnames';\nimport {\n  type ViewVariableType,\n  type ValueExpression,\n} from '@coze-workflow/base';\nimport { type RenderFullLabelProps } from '@coze-arch/bot-semi/Tree';\n\nimport { LevelLine } from '@/form-extensions/components/level-line';\n\nimport { InputValue } from '../input-value';\nimport { InputOperator } from '../input-operator';\nimport { InputName } from '../input-name';\nimport { type TreeNodeCustomData } from '../../types';\nimport { useColumnsStyle } from '../../hooks/use-columns-style';\nimport { TreeCollapseWidth, ChangeMode } from '../../constants';\n\nimport styles from './index.module.less';\nexport interface InputTreeNodeProps extends RenderFullLabelProps {\n  readonly?: boolean;\n  needRenderAppendChild?: boolean;\n  onChange: (mode: ChangeMode, param: TreeNodeCustomData) => void;\n  hasObject?: boolean;\n  withDescription?: boolean;\n  withRequired?: boolean;\n  couldCollapse?: boolean;\n  collapsed?: boolean;\n  onCollapse?: (collapsed: boolean) => void;\n  defaultExpand?: boolean;\n  columnsRatio?: string;\n  isNamePureText?: boolean;\n  disabledTypes?: ViewVariableType[];\n  disableDelete: boolean;\n}\n\nexport default function InputTreeNode(props: InputTreeNodeProps) {\n  const {\n    data,\n    className,\n    level,\n    readonly = false,\n    onChange,\n    hasObject,\n    couldCollapse = true,\n    collapsed = true,\n    onCollapse,\n    needRenderAppendChild = true,\n    columnsRatio,\n    isNamePureText,\n    disabledTypes,\n    disableDelete,\n  } = props;\n\n  // current value\n  const value = data as TreeNodeCustomData;\n  const treeNodeRef = useRef<HTMLDivElement>(null);\n  const columnsStyle = useColumnsStyle(columnsRatio, level);\n  const testName = `/inputs/inputParameters${(data.field || '')\n    .replaceAll('.', '/')\n    .replace(/\\[(\\d+)\\]/g, '/$1')}`;\n  const nameRef = useRef(value?.name);\n  const inputRef = useRef(value?.input);\n\n  // When deleting\n  const onDelete = () => {\n    onChange(ChangeMode.Delete, value);\n  };\n\n  // When adding a child\n  const onAppend = () => {\n    onChange(ChangeMode.Append, value);\n  };\n\n  // update name\n  const onNameChange = (name: string) => {\n    if (value.name === name) {\n      return;\n    }\n    nameRef.current = name;\n    onChange(ChangeMode.Update, { ...value, name, input: inputRef.current });\n  };\n\n  const onValueChange = (input?: ValueExpression) => {\n    inputRef.current = input;\n    onChange(ChangeMode.Update, { ...value, input, name: nameRef.current });\n  };\n\n  const paramRow = (\n    <div\n      className={classNames({\n        [styles.wrapper]: true,\n      })}\n    >\n      <InputName\n        data={value}\n        onChange={onNameChange}\n        style={columnsStyle.name}\n        disabled={readonly}\n        isPureText={isNamePureText}\n        testName={testName}\n      />\n      <InputValue\n        data={value}\n        onChange={onValueChange}\n        style={columnsStyle.value}\n        level={level}\n        disabled={readonly}\n        disabledTypes={disabledTypes}\n        testName={testName}\n      ></InputValue>\n\n      {!readonly ? (\n        <InputOperator\n          data={value}\n          level={level}\n          onDelete={onDelete}\n          onAppend={onAppend}\n          hasObject={hasObject}\n          needRenderAppendChild={needRenderAppendChild}\n          disableDelete={disableDelete}\n        />\n      ) : null}\n    </div>\n  );\n\n  return (\n    <div\n      className={classNames({\n        [className]: Boolean(className),\n        [styles['param-container']]: true,\n      })}\n      ref={treeNodeRef}\n    >\n      <LevelLine\n        level={level}\n        data={value}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n        couldCollapse={couldCollapse}\n        readonly={readonly}\n        expandContentVisible={true}\n      />\n      <div\n        className=\"w-full\"\n        style={{ paddingLeft: couldCollapse ? TreeCollapseWidth : 0 }}\n      >\n        <div\n          className={classNames({\n            [styles['expand-wrapper']]: true,\n            'flex-grow': !couldCollapse,\n          })}\n        >\n          {paramRow}\n        </div>\n      </div>\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-magic-numbers */\nimport React from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport { useColumnsStyle } from '../../hooks/use-columns-style';\nimport { TreeCollapseWidth } from '../../constants';\n\nimport styles from './index.module.less';\n\ninterface HeaderProps {\n  readonly?: boolean;\n  config: {\n    hasObject?: boolean;\n    hasCollapse?: boolean;\n  };\n  columnsRatio?: string;\n}\n\nexport default function InputHeader({\n  readonly,\n  config,\n  columnsRatio,\n}: HeaderProps) {\n  const columnsStyle = useColumnsStyle(columnsRatio);\n\n  if (readonly) {\n    return null;\n  }\n  return (\n    <div\n      className={styles.header}\n      style={{\n        marginLeft: config.hasCollapse ? TreeCollapseWidth + 8 : 0,\n      }}\n    >\n      {/* name */}\n      <div className={styles.name} style={columnsStyle.name}>\n        <span className={styles.text}>\n          {I18n.t('workflow_detail_node_parameter_name')}\n        </span>\n      </div>\n\n      {/* value */}\n      <div className={styles.value} style={columnsStyle.value}>\n        <span className={styles.text}>\n          {I18n.t('workflow_detail_node_parameter_value')}\n        </span>\n      </div>\n\n      {readonly ? null : (\n        <div className=\"relative flex gap-1\">\n          {/* Object operation placeholder */}\n          {config.hasObject ? <div className=\"w-6\"></div> : null}\n\n          {/* Delete button placeholder */}\n          <div className=\"w-6\"></div>\n        </div>\n      )}\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable max-lines-per-function */\n/* eslint-disable @typescript-eslint/no-shadow */\n/* eslint-disable complexity */\nimport React, {\n  type ReactNode,\n  useCallback,\n  useMemo,\n  useRef,\n  useState,\n  type PropsWithChildren,\n} from 'react';\n\nimport { nanoid } from 'nanoid';\nimport cloneDeep from 'lodash-es/cloneDeep';\nimport classNames from 'classnames';\nimport {\n  type InputValueVO,\n  ValueExpressionType,\n  ViewVariableType,\n  useNodeTestId,\n} from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { Toast, Tree } from '@coze-arch/coze-design';\nimport { type TreeNodeData, type TreeProps } from '@coze-arch/bot-semi/Tree';\n\nimport { FormCard } from '../form-card';\nimport { AddItemButton } from '../add-item-button';\nimport {\n  findCustomTreeNodeDataResult,\n  formatTreeData,\n  traverse,\n} from './utils';\nimport { type TreeNodeCustomData } from './types';\nimport { InputTreeContextProvider } from './context';\nimport { TreeCollapseWidth, ChangeMode } from './constants';\nimport InputTreeNode from './components/input-tree-node';\nimport InputHeader from './components/input-header';\n\nimport styles from './index.module.less';\n\nexport interface SimpleTreeNodeCustomData {\n  key: string;\n}\n\nexport interface InputTreeProps {\n  testId?: string;\n  // Whether to allow new root nodes, the default is true\n  allowAppendRootData?: boolean;\n  // Is it batch processing?\n  isBatch?: boolean;\n  treeProps?: TreeProps;\n  readonly?: boolean;\n  disabled?: boolean;\n  disabledTooltip?: string;\n  title?: string;\n  titleTooltip?: string | ReactNode;\n  className?: string;\n  style?: React.CSSProperties;\n  value: InputValueVO[] | undefined;\n  onChange: (value: InputValueVO[]) => void;\n  topLevelReadonly?: boolean;\n  emptyPlaceholder?: string;\n  noCard?: boolean;\n  addItemTitle?: string;\n  defaultCollapse?: boolean;\n\n  // Is the outermost output folded by default?\n  formCardDefaultCollapse?: boolean;\n  children?: React.ReactNode;\n  maxLimit?: number;\n  /**\n   * Column widths such as 6:4 represent 6 copies of the name and 4 copies of the type\n   */\n  columnsRatio?: string;\n  /**\n   * Name is plain text\n   */\n  isNamePureText?: boolean;\n  /**\n   * Default added value\n   * @param items\n   * @returns\n   */\n  defaultAppendValue?: (items: TreeNodeCustomData[]) => any;\n  /**\n   * The first one can be deleted.\n   */\n  nthCannotDeleted?: number;\n  /**\n   * Delete not allowed\n   */\n  disableDelete?: boolean;\n}\n\nconst getDefaultAppendValue = (\n  items: TreeNodeCustomData[],\n  defaultAppendValue: InputTreeProps['defaultAppendValue'],\n) => {\n  const defaultValue: {\n    fieldRandomKey: string;\n    type: ViewVariableType;\n    required?: boolean;\n  } = {\n    fieldRandomKey: nanoid(),\n    ...(defaultAppendValue?.(items) || {}),\n  };\n\n  return defaultValue;\n};\n\nfunction useExpandedKeys(keys: string[], defaultCollapse: boolean) {\n  const [expandedKeys, setExpandedKeys] = useState(defaultCollapse ? [] : keys);\n\n  const expandTreeNode = useCallback(\n    (key: string) => {\n      setExpandedKeys([...new Set([...expandedKeys, key])]);\n    },\n    [keys],\n  );\n\n  const collapseTreeNode = useCallback(\n    (key: string) => {\n      setExpandedKeys([\n        ...expandedKeys.filter(expandedKey => expandedKey !== key),\n      ]);\n    },\n    [keys],\n  );\n\n  return { expandedKeys, expandTreeNode, collapseTreeNode };\n}\n\nexport function InputTree(props: PropsWithChildren<InputTreeProps>) {\n  const {\n    testId,\n    readonly = false,\n    isBatch = false,\n    disabled,\n    disabledTooltip,\n    children,\n    allowAppendRootData = true,\n    treeProps,\n    title = I18n.t('workflow_detail_node_parameter_input'),\n    titleTooltip = title,\n    className,\n    style,\n    value,\n    onChange,\n    topLevelReadonly = false,\n    emptyPlaceholder,\n    noCard = false,\n    addItemTitle = I18n.t('workflow_add_input'),\n    defaultCollapse = false,\n    formCardDefaultCollapse = false,\n    maxLimit,\n    columnsRatio = '4:6',\n    isNamePureText,\n    defaultAppendValue,\n    nthCannotDeleted = 0,\n    disableDelete,\n  } = props;\n\n  // Monitor for changes in this value\n  const cardRef = useRef<HTMLDivElement>(null);\n  const isValueEmpty = !value || value.length === 0;\n  const {\n    data: formattedTreeData = [],\n    hasObject,\n    itemKeysWithChildren,\n  } = formatTreeData(cloneDeep(value) as TreeNodeCustomData[]);\n  const isDataEmpty = formattedTreeData.length === 0;\n  const { expandedKeys, expandTreeNode, collapseTreeNode } = useExpandedKeys(\n    itemKeysWithChildren,\n    defaultCollapse,\n  );\n\n  const disableAdd = useMemo(() => {\n    if (maxLimit === undefined) {\n      return false;\n    }\n    return (value?.length ?? 0) >= maxLimit;\n  }, [value, maxLimit]);\n\n  const { concatTestId } = useNodeTestId();\n\n  const onAdd = () => {\n    if (onChange) {\n      onChange(\n        (formattedTreeData || []).concat({\n          ...getDefaultAppendValue(formattedTreeData, defaultAppendValue),\n          // Add field\n          field: `[${formattedTreeData.length}]`,\n          // At this time, there is no need to specify the type, so as as is used to cancel the type and report an error.\n        } as unknown as TreeNodeCustomData) as InputValueVO[],\n      );\n    }\n  };\n\n  // How to change this component\n  const onValueChange = (freshValue?: Array<TreeNodeCustomData>) => {\n    if (onChange) {\n      freshValue = (freshValue || []).concat([]);\n      // Clean up useless fields\n      traverse<TreeNodeCustomData>(freshValue, node => {\n        const { key, name, input, children } = node;\n        // eslint-disable-next-line guard-for-in\n        for (const prop in node) {\n          delete node[prop];\n        }\n        node.key = key || nanoid();\n        node.name = name;\n        node.input = input;\n\n        if (children) {\n          node.children = children;\n        }\n      });\n      onChange(freshValue as InputValueVO[]);\n    }\n  };\n\n  const convertObjectRef = (mode: ChangeMode, data: TreeNodeCustomData) => {\n    // If it is an object, the first time you add a sub-node, you need to convert it to object ref.\n    if (mode === ChangeMode.Append) {\n      if (\n        data.input?.rawMeta?.type === ViewVariableType.Object &&\n        data.input?.type !== ValueExpressionType.OBJECT_REF &&\n        (data.children || []).length === 0\n      ) {\n        data.input = {\n          type: ValueExpressionType.OBJECT_REF,\n          rawMeta: {\n            type: ViewVariableType.Object,\n          },\n        };\n      }\n    }\n\n    // When deleting a sub-node, fallback to object literal if all sub-nodes are cleared.\n    if ([ChangeMode.Delete, ChangeMode.DeleteChildren].includes(mode)) {\n      if (\n        data.input?.rawMeta?.type === ViewVariableType.Object &&\n        data.input.type !== ValueExpressionType.REF &&\n        (data.children || []).length === 0\n      ) {\n        data.input = {\n          type: ValueExpressionType.LITERAL,\n          rawMeta: data.input?.rawMeta,\n          content: '{}',\n        };\n      }\n    }\n\n    return data;\n  };\n\n  // Tree node change method\n  const onTreeNodeChange = (mode: ChangeMode, param: TreeNodeCustomData) => {\n    // Clone one first, because the Tree will execute isEqual on treeData, cloning one must be false.\n    const cloneDeepTreeData = cloneDeep(\n      formattedTreeData,\n    ) as Array<TreeNodeCustomData>;\n\n    const findResult = findCustomTreeNodeDataResult(\n      cloneDeepTreeData,\n      param.field as string,\n    );\n\n    if (findResult) {\n      switch (mode) {\n        case ChangeMode.Append: {\n          // You can't use parentData as a standard for adding, you need to add it under the current data.\n          const { data } = findResult;\n          const currentChildren = data.children || [];\n\n          convertObjectRef(mode, data);\n          // @ts-expect-error Some values do not need to be specified at this time because format is executed during rerender\n          data.children = currentChildren.concat({\n            ...getDefaultAppendValue(currentChildren, defaultAppendValue),\n            // Add field\n            field: `${data.field}.children[${currentChildren.length}]`,\n          });\n\n          onValueChange(cloneDeepTreeData);\n\n          // Add a new node under the current node and expand the current node\n          if (findResult?.data?.key) {\n            expandTreeNode(findResult.data.key);\n          }\n\n          break;\n        }\n        case ChangeMode.Update: {\n          const targetArray = findResult.isRoot\n            ? cloneDeepTreeData\n            : findResult.parentData?.children;\n          const index = targetArray?.findIndex(item => item.key === param.key);\n\n          if (index !== undefined) {\n            targetArray?.splice(index, 1, param);\n            onValueChange(cloneDeepTreeData);\n          }\n          break;\n        }\n        case ChangeMode.Delete: {\n          if (findResult.isRoot) {\n            const freshValue = (cloneDeepTreeData || []).filter(\n              item => item.key !== param.key,\n            );\n            onValueChange(freshValue);\n          } else {\n            const parentData = findResult.parentData as TreeNodeData;\n            parentData.children = (parentData.children || []).filter(\n              item => item.key !== param.key,\n            );\n            convertObjectRef(mode, parentData as TreeNodeCustomData);\n            onValueChange(cloneDeepTreeData);\n          }\n          break;\n        }\n        case ChangeMode.DeleteChildren: {\n          const { data } = findResult;\n          data.children = [];\n          if (!findResult.isRoot) {\n            convertObjectRef(mode, data);\n          }\n          onValueChange(cloneDeepTreeData);\n          break;\n        }\n        default:\n      }\n    } else {\n      Toast.error(I18n.t('workflow_detail_node_output_parsingfailed'));\n    }\n  };\n\n  if (readonly && isValueEmpty) {\n    return null;\n  }\n\n  const Card = noCard ? React.Fragment : FormCard;\n  const showAddButton =\n    !readonly && !topLevelReadonly && allowAppendRootData && !disableAdd;\n  const rootLength = formattedTreeData.length;\n  return (\n    <InputTreeContextProvider value={{ testId }}>\n      <div\n        className={classNames({\n          [styles.container]: true,\n          [styles['not-readonly']]: !readonly,\n          [className || '']: Boolean(className),\n          [styles['could-collapse']]: itemKeysWithChildren.length > 0,\n        })}\n        style={style}\n        ref={cardRef}\n      >\n        <Card\n          autoExpandWhenDomChange\n          defaultExpand={!formCardDefaultCollapse}\n          showBottomBorder\n          header={title}\n          tooltip={titleTooltip}\n          contentClassName=\"nowheel\"\n          noPadding\n        >\n          {!isDataEmpty && (\n            <InputHeader\n              readonly={readonly}\n              config={{\n                hasObject,\n                hasCollapse: itemKeysWithChildren.length > 0,\n              }}\n              columnsRatio={columnsRatio}\n            />\n          )}\n          <Tree\n            expandAll={!readonly}\n            style={readonly ? {} : { overflow: 'inherit' }}\n            motion={false}\n            disabled={disabled}\n            className={classNames({\n              [styles.content]: true,\n              [styles.readonly]: readonly,\n              [styles['content-fix-pop-container']]: !readonly,\n            })}\n            renderFullLabel={renderFullLabelProps => {\n              const { data } = renderFullLabelProps;\n\n              const onCollapse = (collapsed: boolean) => {\n                const { key } = data;\n\n                if (!key) {\n                  return;\n                }\n\n                if (collapsed) {\n                  expandTreeNode(key);\n                } else {\n                  collapseTreeNode(key);\n                }\n              };\n\n              const isDeleteDisabled = (() => {\n                if (disableDelete) {\n                  return true;\n                }\n\n                if (nthCannotDeleted === 0) {\n                  return false;\n                }\n                const canDelete: boolean =\n                  (data.level === 0\n                    ? rootLength\n                    : data.parent?.children?.length || 0) <\n                  nthCannotDeleted + 1;\n                return canDelete;\n              })();\n\n              return (\n                <InputTreeNode\n                  {...renderFullLabelProps}\n                  readonly={readonly}\n                  onChange={onTreeNodeChange}\n                  hasObject={hasObject}\n                  disableDelete={isDeleteDisabled}\n                  couldCollapse={itemKeysWithChildren.length > 0}\n                  collapsed={renderFullLabelProps.expandStatus.expanded}\n                  onCollapse={onCollapse}\n                  columnsRatio={columnsRatio}\n                  isNamePureText={isNamePureText}\n                />\n              );\n            }}\n            emptyContent={\n              emptyPlaceholder && (\n                <p className={styles.emptyPlaceholder}>{emptyPlaceholder}</p>\n              )\n            }\n            expandedKeys={[...expandedKeys, nanoid()]} // The nanoid is added to prevent the internal memo state of the component from causing out of sync, and force a recalculation of the hidden state\n            treeData={formattedTreeData}\n            {...treeProps}\n          />\n          {showAddButton ? (\n            <AddItemButton\n              className=\"absolute right-0 top-0\"\n              // Solve the problem that onClick does not trigger due to Button displacement\n              onMouseDown={onAdd}\n              disabled={isBatch || disabled}\n              disabledTooltip={disabledTooltip}\n              testId={concatTestId(testId ?? '', 'add-output-item')}\n              style={{\n                marginLeft:\n                  itemKeysWithChildren.length > 0 ? TreeCollapseWidth : 0,\n              }}\n              title={addItemTitle}\n            />\n          ) : null}\n          {children}\n        </Card>\n      </div>\n    </InputTreeContextProvider>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Tooltip, Typography } from '@coze-arch/coze-design';\nimport { IconInfo } from '@coze-arch/bot-icons';\n\nexport const LabelWithTooltip = ({\n  label,\n  tooltip,\n}: {\n  label: string;\n  tooltip: string;\n}) => (\n  <div className=\"flex items-center\">\n    <Typography.Text\n      className=\"mr-[8px]\"\n      ellipsis={{\n        showTooltip: { opts: { content: label } },\n      }}\n      style={{ maxWidth: 160 }}\n    >\n      {label}\n    </Typography.Text>\n    <Tooltip content={tooltip}>\n      <IconInfo style={{ color: 'rgba(167, 169, 176, 1)' }} />\n    </Tooltip>\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport interface LineData {\n  children?: LineData[];\n  helpLineShow?: unknown[];\n  isLast?: boolean;\n  isFirst?: boolean;\n}\n\nexport enum LineShowResult {\n  HalfTopRoot,\n  HalfTopRootWithChildren,\n  HalfBottomRoot,\n  HalfBottomRootWithChildren,\n  FullRoot,\n  FullRootWithChildren,\n  HalfTopChild,\n  HalfTopChildWithChildren,\n  FullChild,\n  FullChildWithChildren,\n  EmptyBlock,\n  HelpLineBlock,\n  RootWithChildren,\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport classNames from 'classnames';\nimport {\n  IconCozArrowDown,\n  IconCozArrowRight,\n} from '@coze-arch/coze-design/icons';\n\nimport { getLineShowResult } from './utils';\nimport { type LineData, LineShowResult } from './types';\n\nimport styles from './index.module.less';\n\ninterface IconComponentProps {\n  className?: string;\n  style?: React.CSSProperties;\n  collapsed?: boolean;\n  onCollapse?: (collapsed: boolean) => void;\n}\n\nexport function Triangle({\n  className,\n  style,\n  collapsed,\n  onCollapse,\n}: IconComponentProps) {\n  if (collapsed) {\n    return (\n      <IconCozArrowDown\n        className={classNames(styles.triangle, className)}\n        style={style}\n        onClick={() => onCollapse?.(false)}\n      />\n    );\n  } else {\n    return (\n      <IconCozArrowRight\n        className={classNames(styles.triangle, className)}\n        style={style}\n        onClick={() => onCollapse?.(true)}\n      />\n    );\n  }\n}\n\nexport function EmptyBlock({ className, style }: IconComponentProps) {\n  return (\n    <div className={classNames(styles.emptyBlock, className)} style={style} />\n  );\n}\n\nexport function HelpLineBlock({ className, style }: IconComponentProps) {\n  return (\n    <div className={classNames(styles.helpLineBlock, className)} style={style}>\n      <div className={styles.line} />\n    </div>\n  );\n}\n\nexport function HalfTopRoot({\n  className,\n  style,\n  collapsed,\n  onCollapse,\n}: IconComponentProps) {\n  return (\n    <div className={classNames(styles.halfTopRoot, className)} style={style}>\n      <div className={styles.line} />\n      <Triangle\n        className={styles.triangle}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    </div>\n  );\n}\n\nexport function HalfTopRootWithChildren({\n  className,\n  style,\n  collapsed,\n  onCollapse,\n}: IconComponentProps) {\n  return (\n    <HalfTopRoot\n      className={classNames(styles.children, className)}\n      style={style}\n      collapsed={collapsed}\n      onCollapse={onCollapse}\n    />\n  );\n}\n\nexport function HalfBottomRoot({\n  className,\n  style,\n  collapsed,\n  onCollapse,\n}: IconComponentProps) {\n  return (\n    <div className={classNames(styles.halfBottomRoot, className)} style={style}>\n      <div className={styles.line} />\n      <Triangle\n        className={styles.triangle}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    </div>\n  );\n}\n\nexport function HalfBottomRootWithChildren({\n  className,\n  style,\n  collapsed,\n  onCollapse,\n}: IconComponentProps) {\n  return (\n    <HalfBottomRoot\n      className={classNames(styles.children, className)}\n      style={style}\n      collapsed={collapsed}\n      onCollapse={onCollapse}\n    />\n  );\n}\n\nexport function FullRoot({\n  className,\n  style,\n  collapsed,\n  onCollapse,\n}: IconComponentProps) {\n  return (\n    <div className={classNames(styles.fullRoot, className)} style={style}>\n      <div className={styles.topLine} />\n      <div className={styles.bottomLine} />\n      <Triangle\n        className={styles.triangle}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    </div>\n  );\n}\n\nexport function FullRootWithChildren({\n  className,\n  style,\n  collapsed,\n  onCollapse,\n}: IconComponentProps) {\n  return (\n    <FullRoot\n      className={classNames(styles.children, className)}\n      style={style}\n      collapsed={collapsed}\n      onCollapse={onCollapse}\n    />\n  );\n}\n\nexport function HalfTopChild({\n  className,\n  style,\n  collapsed,\n  onCollapse,\n}: IconComponentProps) {\n  return (\n    <div className={classNames(styles.halfTopChild, className)} style={style}>\n      <div className={styles.line} />\n      <Triangle\n        className={styles.triangle}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    </div>\n  );\n}\n\nexport function HalfTopChildWithChildren({\n  className,\n  style,\n  collapsed,\n  onCollapse,\n}: IconComponentProps) {\n  return (\n    <div\n      className={classNames(styles.halfTopChild, styles.children, className)}\n      style={style}\n    >\n      <div className={styles.topLine} />\n      <Triangle\n        className={styles.triangle}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    </div>\n  );\n}\n\nexport function FullChild({\n  className,\n  style,\n  collapsed,\n  onCollapse,\n}: IconComponentProps) {\n  return (\n    <div className={classNames(styles.fullChild, className)} style={style}>\n      <div className={styles.line} />\n      <div className={styles.bottomLine} />\n      <Triangle\n        className={styles.triangle}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    </div>\n  );\n}\n\nexport function FullChildWithChildren({\n  className,\n  style,\n  collapsed,\n  onCollapse,\n}: IconComponentProps) {\n  return (\n    <FullChild\n      className={classNames(styles.children, className)}\n      style={style}\n      collapsed={collapsed}\n      onCollapse={onCollapse}\n    />\n  );\n}\n\nexport function RootWithChildren({\n  className,\n  style,\n  collapsed,\n  onCollapse,\n}: IconComponentProps) {\n  return (\n    <div\n      className={classNames(styles.rootWithChildren, className)}\n      style={style}\n    >\n      <Triangle\n        className={styles.triangle}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    </div>\n  );\n}\n\ninterface LevelLineProps {\n  level: number;\n  data: LineData;\n  className?: string;\n  style?: React.CSSProperties;\n  multiInfo?: {\n    multiline: boolean;\n    withNameError?: boolean;\n  };\n  collapsed?: boolean;\n  onCollapse?: (collapsed: boolean) => void;\n  couldCollapse?: boolean;\n  /** Expand whether the content is visible, and render expand-line when visible */\n  expandContentVisible?: boolean;\n  readonly?: boolean;\n  treeIndentWidth?: number;\n}\n\n// eslint-disable-next-line complexity\nexport function LevelLine({\n  level,\n  data,\n  className,\n  style,\n  collapsed = true,\n  onCollapse,\n  multiInfo = { multiline: false },\n  couldCollapse,\n  expandContentVisible,\n  readonly,\n  treeIndentWidth = 15,\n}: LevelLineProps) {\n  // getLineShowResult returns data, no root drawing is involved for the time being\n  const lineShowResult = getLineShowResult({ level, data });\n  const showMap: Record<LineShowResult, React.ReactNode> = {\n    [LineShowResult.HalfTopRoot]: (\n      <HalfTopRoot\n        className={className}\n        style={style}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    ),\n    [LineShowResult.HalfTopRootWithChildren]: (\n      <HalfTopRootWithChildren\n        className={className}\n        style={style}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    ),\n    [LineShowResult.HalfBottomRoot]: (\n      <HalfBottomRoot\n        className={className}\n        style={style}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    ),\n    [LineShowResult.HalfBottomRootWithChildren]: (\n      <HalfBottomRootWithChildren\n        className={className}\n        style={style}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    ),\n    [LineShowResult.FullRoot]: (\n      <FullRoot\n        className={className}\n        style={style}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    ),\n    [LineShowResult.FullRootWithChildren]: (\n      <FullRootWithChildren\n        className={className}\n        style={style}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    ),\n    // In the output tree, there is no root drawing involved for the time being\n    [LineShowResult.HalfTopChild]: (\n      <HalfTopChild\n        className={classNames(\n          multiInfo?.multiline ? styles.multiline : null,\n          multiInfo?.withNameError ? styles['with-name-error'] : null,\n          className,\n        )}\n        style={style}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    ),\n    [LineShowResult.HalfTopChildWithChildren]: (\n      <HalfTopChildWithChildren\n        className={classNames(\n          multiInfo?.multiline ? styles.multiline : null,\n          multiInfo?.withNameError ? styles['with-name-error'] : null,\n          className,\n        )}\n        style={style}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    ),\n    [LineShowResult.FullChild]: (\n      <FullChild\n        className={classNames(\n          multiInfo?.multiline ? styles.multiline : null,\n          multiInfo?.withNameError ? styles['with-name-error'] : null,\n          className,\n        )}\n        style={style}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    ),\n    [LineShowResult.FullChildWithChildren]: (\n      <FullChildWithChildren\n        className={classNames(\n          multiInfo?.multiline ? styles.multiline : null,\n          multiInfo?.withNameError ? styles['with-name-error'] : null,\n          className,\n        )}\n        style={style}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    ),\n    [LineShowResult.EmptyBlock]: (\n      <EmptyBlock\n        className={className}\n        style={style}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    ),\n    [LineShowResult.HelpLineBlock]: (\n      <HelpLineBlock\n        className={className}\n        style={style}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    ),\n    [LineShowResult.RootWithChildren]: (\n      <RootWithChildren\n        className={className}\n        style={style}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n      />\n    ),\n  };\n\n  {\n    /* Default 20 width, 20 more length for each additional level */\n  }\n  return (\n    <div\n      style={{ width: couldCollapse ? level * treeIndentWidth : 0 }}\n      className={classNames(\n        className,\n        styles['level-line'],\n        readonly ? styles.readonly : '',\n        couldCollapse ? styles['could-collapse'] : '',\n      )}\n    >\n      {lineShowResult.map((item, index) => (\n        <React.Fragment key={index}>{showMap[item]}</React.Fragment>\n      ))}\n      {expandContentVisible &&\n      lineShowResult?.length &&\n      data.children?.length &&\n      // The collapsed state is written upside down. What is actually represented here is that the collapsed state does not render this div.\n      collapsed ? (\n        <div\n          className={styles['expand-line']}\n          // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n          style={{ transform: `translateX(${level * 15}px)` }}\n        ></div>\n      ) : null}\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { LineShowResult, type LineData } from './types';\n\n// eslint-disable-next-line complexity\nexport function getLineShowResult<Data extends LineData>({\n  level,\n  data,\n}: {\n  level: number;\n  data: Data;\n}): Array<LineShowResult> {\n  const isRootWithChildren = level === 0 && (data.children || []).length > 0;\n  const isRootWithoutChildren =\n    level === 0 && (data.children || []).length === 0;\n  const isChildWithChildren = level > 0 && (data.children || []).length > 0;\n  const isChildWithoutChildren =\n    level > 0 && (data.children || []).length === 0;\n  const res: Array<LineShowResult> = (data.helpLineShow || []).map(item =>\n    item ? LineShowResult.HelpLineBlock : LineShowResult.EmptyBlock,\n  );\n\n  if (isRootWithChildren) {\n    res.push(LineShowResult.RootWithChildren);\n  } else if (!isRootWithoutChildren) {\n    // The root node does not need a display line, only non-root nodes need auxiliary lines.\n    if (isChildWithChildren) {\n      if (data.isLast) {\n        res.push(LineShowResult.HalfTopChildWithChildren);\n      } else if (data.isFirst) {\n        res.push(LineShowResult.FullChildWithChildren);\n      } else {\n        res.push(LineShowResult.FullChildWithChildren);\n      }\n    } else if (isChildWithoutChildren) {\n      if (data.isLast) {\n        res.push(LineShowResult.HalfTopChild);\n      } else if (data.isFirst) {\n        res.push(LineShowResult.FullChild);\n      } else {\n        res.push(LineShowResult.FullChild);\n      }\n    }\n  }\n  return res;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { IconNameDescCard } from '../icon-name-desc-card';\nimport { type Library } from './types';\n\ninterface LibraryCardProps {\n  readonly?: boolean;\n  library: Library;\n  onDelete?: (id: string) => void;\n  onClick?: (id: string) => void;\n  testID?: string;\n  isInvalid?: boolean;\n}\n\nexport const LibraryCard: FC<LibraryCardProps> = props => {\n  const {\n    readonly,\n    onDelete,\n    onClick,\n    library,\n    testID = '',\n    isInvalid,\n  } = props;\n\n  return (\n    <IconNameDescCard\n      readonly={readonly}\n      name={library?.name}\n      nameSuffix={library?.nameExtra}\n      description={library?.description}\n      icon={library?.iconUrl}\n      onRemove={() => onDelete?.(library.id)}\n      testID={testID}\n      onClick={() => onClick?.(library.id)}\n      isInvalid={isInvalid}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IconCozPlus } from '@coze-arch/coze-design/icons';\nimport { IconButton } from '@coze-arch/coze-design';\n\nimport { FieldEmpty } from '@/form';\n\nimport { type Library } from './types';\nimport { LibraryCard } from './library-card';\n\ntype DefaultLibraryRender = () => React.ReactNode;\ninterface RenderLibraryProps {\n  defaultLibraryRender: DefaultLibraryRender;\n  library: Library;\n}\ntype RenderLibrary = (props: RenderLibraryProps) => React.ReactNode;\n\ninterface LibrarySelectProps {\n  libraries?: Library[];\n  readonly?: boolean;\n  onDeleteLibrary?: (id: string) => void;\n  onAddLibrary?: () => void;\n  onClickLibrary?: (id: string) => void;\n  renderLibrary?: RenderLibrary;\n  emptyText?: string;\n  hideAddButton?: boolean;\n  addButtonTestID?: string;\n  libraryCardTestID?: string;\n}\n\nexport const LibrarySelect = ({\n  libraries = [],\n  readonly,\n  onDeleteLibrary,\n  onAddLibrary,\n  onClickLibrary,\n  renderLibrary,\n  emptyText = '',\n  hideAddButton = false,\n  addButtonTestID = '',\n  libraryCardTestID = '',\n}: LibrarySelectProps) => (\n  <div className=\"relative\">\n    {readonly || hideAddButton ? (\n      <></>\n    ) : (\n      <div className=\"absolute right-[0] top-[-32px]\">\n        <IconButton\n          color=\"highlight\"\n          onClick={onAddLibrary}\n          theme=\"borderless\"\n          icon={<IconCozPlus />}\n          size=\"small\"\n          data-testid={addButtonTestID}\n        />\n      </div>\n    )}\n    <div className=\"flex flex-col gap-[4px]\">\n      {libraries.length > 0 ? (\n        libraries.map(library => {\n          const isInvalid = library?.isInvalid;\n          const defaultLibraryRender = () => (\n            <LibraryCard\n              isInvalid={isInvalid}\n              readonly={readonly}\n              key={library.id}\n              library={library}\n              onDelete={onDeleteLibrary}\n              onClick={id => {\n                if (isInvalid) {\n                  return;\n                }\n                onClickLibrary?.(id);\n              }}\n              testID={libraryCardTestID}\n            />\n          );\n\n          if (renderLibrary) {\n            return renderLibrary({ library, defaultLibraryRender });\n          }\n\n          return defaultLibraryRender();\n        })\n      ) : (\n        <FieldEmpty text={emptyText} isEmpty={true} />\n      )}\n    </div>\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, type FC } from 'react';\n\nimport { get } from 'lodash-es';\nimport classNames from 'classnames';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\nimport {\n  WorkflowVariableService,\n  useVariableTypeChange,\n  variableUtils,\n} from '@coze-workflow/variable';\nimport {\n  VARIABLE_TYPE_ALIAS_MAP,\n  ValueExpressionType,\n  ViewVariableType,\n  useNodeTestId,\n  type RefExpression,\n  type ValueExpression,\n} from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { type CascaderProps } from '@coze-arch/bot-semi/Cascader';\n\nimport { ValueExpressionInput } from '../../components/value-expression-input';\n\nimport styles from './index.module.less';\n\ninterface LoopOutputSelectProps {\n  value: RefExpression;\n  onChange: (value: RefExpression) => void;\n  readonly?: boolean;\n  testId?: string;\n}\n\nexport const LoopOutputSelect: FC<LoopOutputSelectProps> = ({\n  value,\n  onChange,\n  readonly,\n  testId,\n}) => {\n  const [validation, setValidation] = useState<{\n    status: CascaderProps['validateStatus'];\n    message?: string;\n  }>({\n    status: 'default',\n  });\n\n  const node = useCurrentEntity();\n  const { getNodeSetterId, concatTestId } = useNodeTestId();\n  const computedTestId = getNodeSetterId('loopOutputSelect');\n  const variableService: WorkflowVariableService = useService(\n    WorkflowVariableService,\n  );\n\n  const keyPath = get(value, 'content.keyPath') as string[];\n\n  const isLoopSelfVariable = keyPath?.[0] === node.id;\n  const originType = variableUtils.getValueExpressionViewType(\n    value,\n    variableService,\n    { node },\n  );\n\n  let variableType = originType;\n  if (!isLoopSelfVariable && originType) {\n    // Two-dimensional arrays are temporarily not supported\n    if (ViewVariableType.isArrayType(originType)) {\n      variableType = undefined;\n    } else {\n      variableType = ViewVariableType.wrapToArrayType(originType);\n    }\n  }\n  const typeLabel = variableType\n    ? VARIABLE_TYPE_ALIAS_MAP[variableType]\n    : undefined;\n\n  useVariableTypeChange({\n    keyPath,\n    onTypeChange: ({ variableMeta }) => {\n      if (\n        !variableMeta ||\n        // Variables in LoopFunction temporarily do not support 2D arrays\n        (!isLoopSelfVariable &&\n          ViewVariableType.isArrayType(variableMeta?.type))\n      ) {\n        setValidation({\n          status: 'error',\n          message: I18n.t('card_builder_userVar_list_search_empty'),\n        });\n        onChange({ type: ValueExpressionType.REF });\n        return;\n      }\n      setValidation({\n        status: 'success',\n      });\n    },\n  });\n\n  const handleOnChange = (newValue: ValueExpression | undefined) => {\n    if (newValue === undefined || newValue.type !== ValueExpressionType.REF) {\n      return;\n    }\n    const path = newValue?.content?.keyPath ?? [];\n    if (path.length === 1 && path[0] === node.id) {\n      return;\n    }\n    onChange?.(newValue);\n    setValidation({\n      status: 'success',\n    });\n  };\n\n  return (\n    <div className={styles['loop-output-select']}>\n      <ValueExpressionInput\n        className={styles['variable-select']}\n        value={value}\n        hideSettingIcon={true}\n        hideDeleteIcon={true}\n        literalDisabled={true}\n        enableSelectNode={true}\n        renderDisplayVarName={({ meta: _meta, path }) => {\n          if (path?.[0] === node.id) {\n            return _meta?.name || ''; // loop intermediate variable\n          }\n          return `[${_meta?.name}] * n`; // loop body node output variable\n        }}\n        customFilterVar={({ meta: _meta, path }) => {\n          if (path?.[0] === node.id) {\n            if (path.length === 2) {\n              return !!_meta?.mutable;\n            }\n            // Variables under Current Node Variable Reserved\n            return true;\n          }\n          // For the time being, it is not supported to assemble two-dimensional arrays in the loop body.\n          return !!_meta?.type && !ViewVariableType.isArrayType(_meta?.type);\n        }}\n        handleDataSource={datasource =>\n          datasource.filter(\n            data => data.nodeId !== node.id || Boolean(data.children?.length),\n          )\n        }\n        readonly={readonly}\n        onChange={handleOnChange}\n        validateStatus={validation.status}\n        invalidContent={validation.message}\n        testId={testId}\n        forbidTypeCast\n      />\n      <div\n        className={classNames(styles['variable-type'], {\n          [styles['variable-type-bg']]: Boolean(typeLabel),\n        })}\n        data-testid={concatTestId(testId ?? computedTestId, 'variable-type')}\n      >\n        {typeLabel ? (\n          <p className={styles['variable-type-content']}>{typeLabel}</p>\n        ) : (\n          <p className={styles['variable-type-placeholder']}>\n            {I18n.t('workflow_detail_node_nodata')}\n          </p>\n        )}\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, useCallback, useEffect, useMemo } from 'react';\n\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { type WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowVariableService } from '@coze-workflow/variable';\nimport {\n  ValueExpressionType,\n  type RefExpression,\n  type ValueExpression,\n} from '@coze-workflow/base';\n\nimport { ValueExpressionInput } from '../../components/value-expression-input';\n\nimport styles from './index.module.less';\n\nexport interface MutableVariableAssignSetterProps {\n  value: RefExpression;\n  onChange: (value: RefExpression) => void;\n  right: RefExpression;\n  inputParameters: {\n    left: RefExpression;\n    right: RefExpression;\n  }[];\n  index: number;\n  node: WorkflowNodeEntity;\n  readonly?: boolean;\n  testId?: string;\n}\n\nexport const MutableVariableAssign: FC<MutableVariableAssignSetterProps> = ({\n  value,\n  onChange,\n  readonly,\n  right,\n  inputParameters,\n  index,\n  node,\n  testId,\n}) => {\n  const variableService: WorkflowVariableService = useService(\n    WorkflowVariableService,\n  );\n\n  const leftKeyPath: string[] = value?.content?.keyPath ?? [];\n  const leftVariable = variableService.getViewVariableByKeyPath(leftKeyPath, {\n    node,\n  });\n\n  const rightKeyPath: string[] = right?.content?.keyPath ?? [];\n  const rightVariable = variableService.getViewVariableByKeyPath(rightKeyPath, {\n    node,\n  });\n\n  const rightStringPaths: string[] = useMemo(() => {\n    if (!Array.isArray(inputParameters) || !inputParameters?.length) {\n      return [];\n    }\n    return (\n      inputParameters\n        .filter((_, i) => i !== index) // Filter itself\n        .map(input => input?.left?.content?.keyPath)\n        .filter(Boolean)\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        .map(path => path!.join('.'))\n    );\n  }, [inputParameters]);\n\n  useEffect(() => {\n    if (!leftVariable && !rightVariable) {\n      // Initialization does not trigger form validation\n      return;\n    }\n    // Rvalue change triggers form validation\n    onChange?.(value);\n  }, [right]);\n\n  const handleOnChange = (newValue: ValueExpression | undefined) => {\n    if (newValue === undefined || newValue.type !== ValueExpressionType.REF) {\n      return;\n    }\n    const newLeftVar = variableService.getViewVariableByKeyPath(\n      newValue.content?.keyPath,\n      {\n        node,\n      },\n    );\n    if (!newLeftVar) {\n      return;\n    }\n    onChange?.(newValue);\n  };\n\n  const optionFilter = useCallback(\n    (v: string[]) => {\n      const subVariableMeta = variableService.getViewVariableByKeyPath(v, {\n        node,\n      });\n      if (!rightVariable?.type) {\n        return true;\n      } else if (\n        subVariableMeta?.type &&\n        subVariableMeta.type === rightVariable.type\n      ) {\n        return true;\n      }\n      return false;\n    },\n    [variableService],\n  );\n\n  return (\n    <div className={styles['mutable-variable-assign']}>\n      <ValueExpressionInput\n        className={styles['variable-select']}\n        literalDisabled={true}\n        value={value}\n        readonly={readonly}\n        onChange={handleOnChange}\n        optionFilter={optionFilter}\n        testId={testId}\n        forbidTypeCast\n        hideDeleteIcon={true}\n        customFilterVar={({ meta: _meta, path }) => {\n          if (path?.length !== 2) {\n            // exception handling\n            return false;\n          }\n          if (\n            _meta?.type &&\n            rightVariable &&\n            _meta.type !== rightVariable.type\n          ) {\n            // Left and right value types do not match\n            return false;\n          }\n          if (!_meta?.mutable) {\n            // Not a variable of mutable type\n            return false;\n          }\n          const stringPath = path.join('.');\n          if (rightStringPaths.includes(stringPath)) {\n            // variable repeated assignment\n            return false;\n          }\n          const rightStringPath = rightKeyPath.join('.');\n          if (rightStringPath === stringPath) {\n            // Left and right values are equal\n            return false;\n          }\n          return true;\n        }}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useState, type MouseEvent } from 'react';\n\nimport { NodeIntoContainerService } from '@flowgram-adapter/free-layout-editor';\nimport {\n  useEntityFromContext,\n  useService,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  delay,\n  WorkflowDragService,\n  WorkflowSelectService,\n  type WorkflowNodeEntity,\n} from '@flowgram-adapter/free-layout-editor';\n\ninterface UseMoveOutProps {\n  onHandle: () => void;\n}\n\nexport const useMoveOut = ({ onHandle }: UseMoveOutProps) => {\n  const node = useEntityFromContext<WorkflowNodeEntity>();\n  const nodeIntoContainerService = useService<NodeIntoContainerService>(\n    NodeIntoContainerService,\n  );\n  const selectService = useService<WorkflowSelectService>(\n    WorkflowSelectService,\n  );\n  const dragService = useService<WorkflowDragService>(WorkflowDragService);\n\n  const [canMoveOut, setCanMoveOut] = useState(\n    nodeIntoContainerService.canMoveOutContainer(node),\n  );\n\n  const updateCanMoveOut = useCallback(() => {\n    setCanMoveOut(nodeIntoContainerService.canMoveOutContainer(node));\n  }, [node, nodeIntoContainerService]);\n\n  const handleMoveOut = useCallback(\n    async (e: MouseEvent) => {\n      e.stopPropagation();\n      const sourceContainer = node.parent;\n      if (!sourceContainer) {\n        return;\n      }\n      nodeIntoContainerService.moveOutContainer({ node });\n      nodeIntoContainerService.removeNodeLines(node);\n      await new Promise(resolve => requestAnimationFrame(resolve));\n      await delay(20);\n      updateCanMoveOut();\n      selectService.clear();\n      selectService.selectNode(node);\n      dragService.startDragSelectedNodes(e);\n      onHandle();\n    },\n    [\n      dragService,\n      node,\n      nodeIntoContainerService,\n      selectService,\n      updateCanMoveOut,\n      onHandle,\n    ],\n  );\n\n  return {\n    canMoveOut,\n    handleMoveOut,\n    updateCanMoveOut,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowNodeData } from '@coze-workflow/nodes';\nimport { Typography } from '@coze-arch/coze-design';\n\nexport const DescriptionDisplay: FC<{\n  description?: string;\n}> = props => {\n  const { description } = props;\n\n  const node = useCurrentEntity();\n\n  if (!description) {\n    return null;\n  }\n\n  const nodeDataEntity = node.getData<WorkflowNodeData>(WorkflowNodeData);\n  const nodeData = nodeDataEntity.getNodeData();\n\n  if (nodeData?.description === description) {\n    return null;\n  } else {\n    return (\n      <Typography.Text\n        className=\"coz-fg-secondary pt-2\"\n        size=\"small\"\n        ellipsis={{\n          rows: 1,\n        }}\n      >\n        {description}\n      </Typography.Text>\n    );\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, useState, useRef } from 'react';\n\nimport classnames from 'classnames';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { Typography, TextArea, Tag, Divider } from '@coze-arch/coze-design';\n\nimport { useNodeRenderScene } from '@/hooks';\n\nimport styles from './index.module.less';\n\nconst MAX_CNT = 100;\n\ninterface DescriptionProps {\n  description?: string;\n  expanded: boolean;\n  isLocalPlugin?: boolean;\n  readonly?: boolean;\n  onChange: (desc: string) => void;\n}\n\nexport const Description: FC<DescriptionProps> = props => {\n  const {\n    description,\n    expanded,\n    isLocalPlugin = false,\n    onChange,\n    readonly = false,\n  } = props;\n\n  const { concatTestId, getNodeTestId } = useNodeTestId();\n  const { isNodeSideSheet } = useNodeRenderScene();\n  const [isEdit, setIsEdit] = useState(false);\n\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n\n  const handleClick = () => {\n    setIsEdit(true);\n    setTimeout(() => {\n      textareaRef.current?.focus();\n    }, 0);\n  };\n\n  const handleBlur = e => {\n    const desc = e.target?.value;\n    if (desc && desc.length <= MAX_CNT) {\n      onChange?.(desc);\n    }\n    setIsEdit(false);\n  };\n\n  if (!description) {\n    return null;\n  }\n\n  const localPluginTag = isLocalPlugin ? (\n    <>\n      <Tag color=\"cyan\" size=\"mini\">\n        {I18n.t('local_plugin_label')}\n      </Tag>\n      <Divider\n        layout=\"vertical\"\n        className=\"coz-stroke-primary h-[10px] ml-[4px] mr-[2px]\"\n      />\n    </>\n  ) : null;\n\n  if (isEdit) {\n    return (\n      <div\n        className={classnames('pb-[12px] w-full', styles['text-area-wrapper'])}\n      >\n        <TextArea\n          defaultValue={description}\n          ref={textareaRef}\n          rows={2}\n          maxCount={MAX_CNT}\n          readonly={readonly}\n          onBlur={handleBlur}\n        />\n      </div>\n    );\n  } else {\n    return (\n      <div className=\"px-0 w-full flex items-center mb-[8px]\">\n        {localPluginTag}\n        <Typography.Text\n          size=\"small\"\n          data-testid={concatTestId(getNodeTestId(), 'node-description')}\n          className={classnames(\n            'break-words inline-block px-1 py-0.5 break-all',\n            'coz-fg-secondary hover:coz-mg-secondary-hovered active:coz-mg-secondary-pressed',\n            'rounded-lg',\n            {\n              '!hidden': !expanded,\n              'cursor-pointer': isNodeSideSheet,\n            },\n          )}\n          onClick={handleClick}\n          ellipsis={{\n            showTooltip: {\n              opts: {\n                content: description,\n                style: { wordBreak: 'break-word' },\n              },\n            },\n            rows: 2,\n          }}\n        >\n          {description}\n        </Typography.Text>\n      </div>\n    );\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport { useEffect, useRef, useMemo } from 'react';\n\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowNodeData } from '@coze-workflow/nodes';\nimport {\n  BlockInput,\n  StandardNodeType,\n  WorkflowNode,\n} from '@coze-workflow/base';\nimport {\n  MockSetSelect,\n  type MockSetSelectActions,\n} from '@coze-devops/mockset-manage';\nimport { ComponentType, TrafficScene } from '@coze-arch/bot-api/debugger_api';\n\nimport { useGlobalState } from '../../../../hooks';\n\nconst PluginMockSet = ({\n  node,\n  readonly,\n}: {\n  node: FlowNodeEntity;\n  readonly?: boolean;\n}) => {\n  const { workflowId, spaceId, isCollaboratorMode, info } = useGlobalState();\n  const ref = useRef<MockSetSelectActions>(null);\n  const workflowNode = useMemo(() => new WorkflowNode(node), [node]);\n\n  const { vcsData } = info;\n\n  useEffect(() => {\n    const toDispose = node.onDispose(() =>\n      ref.current?.handleParentNodeDelete(),\n    );\n\n    return () => toDispose.dispose();\n  }, []);\n\n  // Non-API node, no rendering required. No test run permission does not show\n  if (\n    node?.flowNodeType !== StandardNodeType.Api ||\n    // collaboration mode no permission\n    (isCollaboratorMode && !vcsData?.can_edit) ||\n    // Non-collaborative mode only you can see\n    (!isCollaboratorMode && !info.creator?.self)\n  ) {\n    return null;\n  }\n\n  const nodeId = node.id;\n  const apiParams = workflowNode.data?.inputs?.apiParam ?? [];\n  const apiOutputs = node\n    .getData(WorkflowNodeData)\n    ?.getNodeData<StandardNodeType.Api>()?.outputs;\n\n  const pluginId = BlockInput.toLiteral(\n    apiParams.find(param => param.name === 'pluginID'),\n  );\n\n  const apiId: string = BlockInput.toLiteral(\n    apiParams.find(param => param.name === 'apiID'),\n  );\n\n  const apiName: string = BlockInput.toLiteral(\n    apiParams.find(param => param.name === 'apiName'),\n  );\n\n  return (\n    <MockSetSelect\n      ref={ref}\n      readonly={readonly || apiOutputs === null}\n      style={{ maxWidth: 90 }}\n      bindSubjectInfo={{\n        componentID: nodeId,\n        componentType: ComponentType.CozeToolNode,\n        parentComponentID: workflowId,\n        parentComponentType: ComponentType.CozeWorkflow,\n        detail: { name: apiName },\n      }}\n      bizCtx={{\n        trafficScene: TrafficScene.CozeWorkflowDebug,\n        trafficCallerID: workflowId,\n        bizSpaceID: spaceId,\n        ext: {\n          mockSubjectInfo: JSON.stringify({\n            componentType: ComponentType.CozeTool,\n            componentID: apiId,\n            parentComponentType: ComponentType.CozePlugin,\n            parentComponentID: pluginId,\n          }),\n        },\n      }}\n    />\n  );\n};\n\nexport default PluginMockSet;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { get } from 'lodash-es';\nimport { type FlowNodeType } from '@flowgram-adapter/free-layout-editor';\nimport { type NodeData } from '@coze-workflow/nodes';\nimport { EVENT_NAMES, sendTeaEvent } from '@coze-arch/bot-tea';\nimport { IconCozQuestionMarkCircle } from '@coze-arch/coze-design/icons';\nimport { IconButton } from '@coze-arch/coze-design';\n\nexport const HelpLinkButton = ({\n  helpLink,\n  nodeData,\n  nodeType,\n}: {\n  helpLink: string | ((props: { apiName: string }) => string);\n  nodeData: NodeData[keyof NodeData];\n  nodeType: FlowNodeType;\n}) => {\n  const handleClick = () => {\n    sendTeaEvent(EVENT_NAMES.workflow_test_run_click, {\n      nodes_type: String(nodeType),\n      action: 'click_doc',\n    });\n    const path =\n      typeof helpLink === 'string'\n        ? helpLink\n        : helpLink({\n            apiName: get(nodeData, 'apiName') || '',\n          });\n    window.open(path, '_blank');\n  };\n  return (\n    <>\n      <IconButton\n        onClick={handleClick}\n        icon={<IconCozQuestionMarkCircle />}\n        size=\"default\"\n        color=\"secondary\"\n      />\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { IconCozCross } from '@coze-arch/coze-design/icons';\nimport { IconButton } from '@coze-arch/coze-design';\n\nimport { useFloatLayoutService } from '@/hooks/use-float-layout-service';\nimport { useNodeRenderScene } from '@/hooks';\n\nexport const CloseButton = () => {\n  const floatLayoutService = useFloatLayoutService();\n\n  const handleClose = () => {\n    floatLayoutService.close();\n  };\n\n  const { isNodeSideSheet } = useNodeRenderScene();\n\n  return (\n    <>\n      <IconButton\n        onClick={handleClose}\n        icon={<IconCozCross />}\n        size={isNodeSideSheet ? 'default' : 'small'}\n        color=\"secondary\"\n      />\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable complexity */\n/* eslint-disable max-lines-per-function */\nimport React, {\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n  type ReactNode,\n  type MouseEvent,\n} from 'react';\n\nimport { get } from 'lodash-es';\nimport classnames from 'classnames';\nimport {\n  useEntityFromContext,\n  useService,\n  usePlaygroundContainer,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  type WorkflowNodeEntity,\n  type WorkflowNodeMeta,\n} from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowNodeData, type NodeData } from '@coze-workflow/nodes';\nimport {\n  ENCAPSULATE_SHORTCUTS,\n  EncapsulateService,\n} from '@coze-workflow/feature-encapsulate';\nimport { StandardNodeType } from '@coze-workflow/base/types';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozMore,\n  IconCozTrigger,\n  IconCozWarningCircleFill,\n} from '@coze-arch/coze-design/icons';\nimport {\n  IconButton,\n  Typography,\n  Dropdown,\n  Input,\n  Tag,\n  Divider,\n} from '@coze-arch/coze-design';\nimport { PluginType } from '@coze-arch/bot-api/developer_api';\n\nimport { useNodeSideSheetStore } from '@/hooks/use-node-side-sheet-store';\n\nimport { ValidationErrorWrapper, useError } from '../validation';\nimport { WorkflowEditService } from '../../../services';\nimport {\n  useNodeRenderData,\n  useGlobalState,\n  useNodeRenderScene,\n} from '../../../hooks';\nimport { TestRunSingleNodeButton } from '../../../components/test-run/test-run-button/single-node';\nimport {\n  ReferenceNodeOrigin,\n  ReferenceNodeVersion,\n} from '../../../components/reference-node-info';\nimport { NodeIcon } from '../../../components/node-icon';\nimport { getBgColor } from './utils/get-bg-color';\nimport { useMoveOut } from './use-move-out';\nimport { DescriptionDisplay } from './description-display';\nimport { Description } from './description';\nimport PluginMockSet from './components/PluginMockSet';\nimport { HelpLinkButton } from './components/help-link-button';\nimport { CloseButton } from './components/close-button';\n\nimport styles from './index.module.less';\n\ninterface NodeHeaderProps {\n  title: string;\n  subTitle?: string;\n  description?: string;\n  logo: string;\n  readonly?: boolean;\n  readonlyAllowDeleteOperation?: boolean;\n  hideTest?: boolean;\n  onTitleChange: (newTitle: string) => void;\n  onDescriptionChange: (desc: string) => void;\n  extraOperation: ReactNode;\n  showCloseButton?: boolean;\n  className?: string;\n  showTrigger?: boolean;\n  triggerIsOpen?: boolean;\n  nodeDisabled?: boolean;\n}\n\nexport const NodeHeader: React.FC<NodeHeaderProps> = ({\n  title,\n  description,\n  readonly,\n  readonlyAllowDeleteOperation,\n  hideTest,\n  onTitleChange,\n  onDescriptionChange,\n  extraOperation,\n  showCloseButton = false,\n  className = '',\n  showTrigger,\n  triggerIsOpen,\n  nodeDisabled,\n}) => {\n  const titleInput = useRef<HTMLInputElement>(null);\n  const [editableTitle, setEditableTitle] = useState(title);\n  const [editable, setEditable] = useState(false);\n  const editService = useService<WorkflowEditService>(WorkflowEditService);\n  const encapsulateService = useService<EncapsulateService>(EncapsulateService);\n  const node = useEntityFromContext<WorkflowNodeEntity>();\n  const [menusVisible, setMenusVisible] = useState(true);\n\n  const { canMoveOut, handleMoveOut, updateCanMoveOut } = useMoveOut({\n    onHandle: () => {\n      // Forced destruction of Dropdown menu\n      setMenusVisible(false);\n      requestAnimationFrame(() => {\n        setMenusVisible(true);\n      });\n    },\n  });\n\n  const closeNodeSideSheet = useNodeSideSheetStore(\n    state => state.closeNodeSideSheet,\n  );\n\n  const { expanded } = useNodeRenderData();\n\n  const { getNodeTestId, concatTestId } = useNodeTestId();\n\n  const meta = node.getNodeMeta<WorkflowNodeMeta>();\n\n  const { canMockset } = useGlobalState(false);\n  const { isNewNodeRender, isNodeSideSheet } = useNodeRenderScene();\n\n  const showMockset = !isNewNodeRender && canMockset;\n\n  useEffect(() => {\n    setEditableTitle(title);\n  }, [title]);\n\n  /**\n   * Delete Node\n   */\n  const handleDelete = (e: MouseEvent) => {\n    e.stopPropagation();\n    // Add a setTimtout, close the panel and then display the delete pop-up window.\n    setTimeout(() => {\n      editService.deleteNode(node, true);\n      closeNodeSideSheet();\n      // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n    }, 10);\n  };\n\n  const container = usePlaygroundContainer();\n  const handleCopy = useCallback(\n    async (_: unknown, e: MouseEvent) => {\n      e.stopPropagation();\n      const {\n        WorkflowCopyShortcutsContribution,\n        WorkflowPasteShortcutsContribution,\n      } = await import('@/shortcuts');\n      const copyService = container.get(WorkflowCopyShortcutsContribution);\n      const pasteService = container.get(WorkflowPasteShortcutsContribution);\n      const data = await copyService.toData([node]);\n      pasteService.apply(data);\n    },\n    [container, node],\n  );\n\n  const handleDecapsulate = (_, e: MouseEvent) => {\n    e.stopPropagation();\n    encapsulateService.decapsulate(node);\n  };\n\n  const handleEditState = useCallback((e: MouseEvent) => {\n    e.stopPropagation();\n    setEditable(true);\n    setTimeout(() => {\n      titleInput.current?.focus();\n    }, 0);\n  }, []);\n\n  const error = useError('title');\n\n  const quitEditable = useCallback(\n    e => {\n      if (e.target !== titleInput?.current && !error) {\n        setEditable(false);\n        document.body.removeEventListener('click', quitEditable);\n      }\n    },\n    [error],\n  );\n\n  useEffect(() => {\n    if (editable) {\n      document.body.addEventListener('click', quitEditable);\n    }\n    return () => {\n      document.body.removeEventListener('click', quitEditable);\n    };\n  }, [editable, quitEditable]);\n\n  const nodeDataEntity = node.getData<WorkflowNodeData>(WorkflowNodeData);\n  const registry = node.getNodeRegistry();\n\n  const nodeData = nodeDataEntity.getNodeData();\n\n  const handleTitleChange = (newTitle: string) => {\n    // const newTitle = event.target.value;\n    setEditableTitle(newTitle);\n\n    // Update the title to nodeDataEntity for easy consumption elsewhere\n    nodeDataEntity.updateNodeData<keyof NodeData>({\n      title: newTitle,\n    });\n  };\n\n  // Do you need to render... more operations, non-read-only state, or show when there are additional operations\n  const needShowOperations =\n    (!readonly ||\n      (readonly && readonlyAllowDeleteOperation) ||\n      !!extraOperation) &&\n    menusVisible;\n\n  // Whether it is a terminal plug-in, the terminal plug-in displays a special tag.\n  const isLocalPlugin =\n    node.flowNodeType === StandardNodeType.Api &&\n    get(nodeData, 'pluginType') === PluginType.LOCAL;\n\n  return (\n    <div\n      className={classnames(\n        'node-header',\n        'coz-bg-plus !p-0',\n        styles.container,\n        {\n          '!mb-0': !expanded,\n          [className]: !!className,\n          '!cursor-default mx-[-12px]': isNodeSideSheet,\n          'cursor-move': !isNodeSideSheet,\n          'rounded-[7px] overflow-hidden': isNewNodeRender,\n        },\n      )}\n    >\n      <div\n        className={classnames('node-header-title', 'w-full', {\n          '!cursor-default': isNodeSideSheet,\n        })}\n      >\n        {nodeDisabled && isNodeSideSheet ? (\n          <div\n            className={'flex items-center p-8px'}\n            style={{\n              background:\n                ' var(--coz-mg-hglt-yellow, rgba(255, 188, 133, 0.2))',\n            }}\n          >\n            <IconCozWarningCircleFill\n              style={{\n                flexShrink: 0,\n                fontSize: '24px',\n                color: 'var(--coz-fg-hglt-yellow, rgba(255, 129, 26, 1))',\n              }}\n            />\n\n            <span\n              className={'ml-8px'}\n              style={{\n                fontSize: '14px',\n                lineHeight: '20px',\n                color: 'var(--coz-fg-primary, rgba(15, 21, 41, 0.82))',\n              }}\n            >\n              {I18n.t('variable_node_offline_toast')}\n            </span>\n          </div>\n        ) : null}\n\n        <div\n          className={classnames(\n            'flex items-center w-full py-3 px-3 pb-[8px] pr-[10px]',\n            {\n              'cursor-move': !isNodeSideSheet,\n            },\n          )}\n          style={{\n            background: nodeData?.mainColor\n              ? `linear-gradient(${getBgColor(\n                  nodeData.mainColor,\n                  0.08,\n                )} 0%, var(--coz-bg-plus) 100%)`\n              : 'var(--coz-bg-plus)',\n          }}\n        >\n          <NodeIcon\n            className={styles.logo}\n            nodeId={node.id}\n            size={24}\n            alt=\"logo\"\n          />\n          {\n            <ValidationErrorWrapper\n              path=\"title\"\n              className={styles['input-wrapper']}\n            >\n              {({ showError, onBlur, onChange }) => {\n                const _readonly = readonly || !editable;\n\n                return _readonly ? (\n                  <div\n                    className={styles['input-readonly']}\n                    onDoubleClick={handleEditState}\n                    data-testid={concatTestId(\n                      getNodeTestId(),\n                      'input',\n                      'rename',\n                      'readonly',\n                    )}\n                  >\n                    <Typography.Paragraph\n                      ellipsis={{\n                        rows: 1,\n                        showTooltip: {\n                          type: 'tooltip',\n                          opts: {\n                            style: {\n                              width: '100%',\n                              wordBreak: 'break-word',\n                            },\n                          },\n                        },\n                      }}\n                    >\n                      {editableTitle}\n                      {showTrigger ? (\n                        <span className=\"h-full inline-flex flex-row items-center\">\n                          <Tag\n                            size=\"mini\"\n                            className={'ml-[4px]'}\n                            prefixIcon={<IconCozTrigger />}\n                            color={triggerIsOpen ? 'brand' : 'primary'}\n                          >\n                            {I18n.t(\n                              'workflow_start_trigger_triggername',\n                              {},\n                              '',\n                            )}\n                          </Tag>\n                        </span>\n                      ) : undefined}\n                    </Typography.Paragraph>\n                    <ReferenceNodeOrigin node={node} />\n                    <ReferenceNodeVersion node={node} />\n                  </div>\n                ) : (\n                  <Input\n                    onBlur={() => {\n                      onTitleChange(editableTitle);\n                      onBlur();\n                    }}\n                    ref={titleInput}\n                    // size=\"small\"\n                    readonly={_readonly}\n                    value={editableTitle}\n                    onChange={e => {\n                      handleTitleChange(e);\n                      onChange();\n                    }}\n                    className={`${styles.input} ${\n                      showError ? styles.inputError : ''\n                    }`}\n                    placeholder={I18n.t('workflow_detail_node_name_default')}\n                    data-testid={concatTestId(\n                      getNodeTestId(),\n                      'input',\n                      'rename',\n                    )}\n                  />\n                );\n              }}\n            </ValidationErrorWrapper>\n          }\n\n          <div className={styles.operators}>\n            {showMockset ? (\n              <PluginMockSet node={node} readonly={readonly} />\n            ) : null}\n\n            {!hideTest ? (\n              <div>\n                <TestRunSingleNodeButton />\n              </div>\n            ) : null}\n\n            {registry?.meta?.helpLink && isNodeSideSheet ? (\n              <HelpLinkButton\n                nodeData={nodeData}\n                nodeType={registry.type}\n                helpLink={registry.meta.helpLink}\n              />\n            ) : null}\n\n            {needShowOperations ? (\n              <Dropdown\n                trigger=\"hover\"\n                position=\"bottomRight\"\n                onVisibleChange={updateCanMoveOut}\n                render={\n                  <Dropdown.Menu className={styles['dropdown-menus']}>\n                    {!readonly && canMoveOut ? (\n                      <>\n                        <Dropdown.Item\n                          onClick={(_v, e) => handleMoveOut(e)}\n                          data-testid={concatTestId(\n                            getNodeTestId(),\n                            'opr',\n                            'move_out_container',\n                          )}\n                        >\n                          {I18n.t('workflow_subcanvas_remove')}\n                        </Dropdown.Item>\n                        <Divider />\n                      </>\n                    ) : null}\n                    {!readonly ? (\n                      <Dropdown.Item\n                        onClick={(_v, e) => handleEditState(e)}\n                        data-testid={concatTestId(\n                          getNodeTestId(),\n                          'opr',\n                          'rename',\n                        )}\n                      >\n                        {I18n.t('workflow_detail_node_rename')}\n                      </Dropdown.Item>\n                    ) : null}\n                    {!readonly ? (\n                      <Dropdown.Item\n                        onClick={handleCopy}\n                        data-testid={concatTestId(\n                          getNodeTestId(),\n                          'opr',\n                          'copy',\n                        )}\n                      >\n                        {I18n.t('workflow_detail_title_copy')}\n                      </Dropdown.Item>\n                    ) : null}\n                    {!meta.deleteDisable &&\n                    (!readonly ||\n                      (readonly && readonlyAllowDeleteOperation)) ? (\n                      <Dropdown.Item\n                        onClick={(_v, e) => handleDelete(e)}\n                        data-testid={concatTestId(\n                          getNodeTestId(),\n                          'opr',\n                          'delete',\n                        )}\n                      >\n                        {I18n.t('workflow_detail_node_delete')}\n                      </Dropdown.Item>\n                    ) : null}\n                    {encapsulateService.canDecapsulate(node) && (\n                      <Dropdown.Item\n                        onClick={handleDecapsulate}\n                        data-testid={concatTestId(\n                          getNodeTestId(),\n                          'opr',\n                          'decapsulate',\n                        )}\n                      >\n                        <div className=\"cursor-pointer flex items-center w-full justify-between absolute inset-0 px-2\">\n                          <div>\n                            {I18n.t(\n                              'workflow_encapsulate_decapsulate',\n                              undefined,\n                              '',\n                            )}\n                          </div>\n                          <div className=\"coz-fg-secondary text-xs\">\n                            {ENCAPSULATE_SHORTCUTS.decapsulate}\n                          </div>\n                        </div>\n                      </Dropdown.Item>\n                    )}\n                    {extraOperation ? (\n                      <Dropdown.Item\n                        className=\"extra-operation-item\"\n                        data-testid={concatTestId(\n                          getNodeTestId(),\n                          'opr',\n                          'extra-operation',\n                        )}\n                      >\n                        {extraOperation}\n                      </Dropdown.Item>\n                    ) : null}\n                  </Dropdown.Menu>\n                }\n              >\n                <IconButton\n                  color=\"secondary\"\n                  size={isNodeSideSheet ? 'default' : 'small'}\n                  icon={<IconCozMore />}\n                  onClick={e => e.stopPropagation()}\n                />\n              </Dropdown>\n            ) : undefined}\n            {showCloseButton ? <CloseButton /> : null}\n          </div>\n        </div>\n      </div>\n\n      <div\n        className={classnames('node-header-description px-2 w-full', {\n          '!cursor-default': isNodeSideSheet,\n          'pb-2': isNewNodeRender,\n          '!mb-0': !expanded,\n        })}\n      >\n        {isNewNodeRender ? (\n          <DescriptionDisplay description={description} />\n        ) : (\n          <Description\n            description={description}\n            expanded={expanded}\n            isLocalPlugin={isLocalPlugin}\n            onChange={onDescriptionChange}\n            readonly={readonly || nodeDisabled}\n          />\n        )}\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nfunction hexToRgb(hex) {\n  hex = hex.replace('#', '');\n\n  // Verify hex format\n  if (!/^[0-9A-Fa-f]{3}$|^[0-9A-Fa-f]{6}$|^[0-9A-Fa-f]{8}$/.test(hex)) {\n    throw new Error('Invalid hex color format');\n  }\n\n  let r,\n    g,\n    b,\n    a = 1;\n\n  if (hex.length === 3) {\n    r = parseInt(hex[0] + hex[0], 16);\n    g = parseInt(hex[1] + hex[1], 16);\n    b = parseInt(hex[2] + hex[2], 16);\n  } else if (hex.length === 6) {\n    r = parseInt(hex.substring(0, 2), 16);\n    g = parseInt(hex.substring(2, 4), 16);\n    b = parseInt(hex.substring(4, 6), 16);\n  } else {\n    r = parseInt(hex.substring(0, 2), 16);\n    g = parseInt(hex.substring(2, 4), 16);\n    b = parseInt(hex.substring(4, 6), 16);\n    a = (parseInt(hex.substring(6, 8), 16) / 255).toFixed(\n      2,\n    ) as unknown as number;\n  }\n\n  return [r, g, b, a];\n}\n\n// eslint-disable-next-line max-params\nfunction rgbaToHexWithBackground(r, g, b, a, bgR = 255, bgG = 255, bgB = 255) {\n  // Make sure the RGB and Alpha values are within the correct range\n  r = Math.min(255, Math.max(0, Math.round(r)));\n  g = Math.min(255, Math.max(0, Math.round(g)));\n  b = Math.min(255, Math.max(0, Math.round(b)));\n  a = Math.min(1, Math.max(0, a));\n\n  // Calculate the new RGB value\n  const newR = Math.round(r * a + bgR * (1 - a));\n  const newG = Math.round(g * a + bgG * (1 - a));\n  const newB = Math.round(b * a + bgB * (1 - a));\n\n  // Convert to hexadecimal and ensure two digits\n  const toHex = n => {\n    const hex = n.toString(16);\n    return hex.length === 1 ? `0${hex}` : hex;\n  };\n\n  // Returns 6 hexadecimal color values\n  return `#${toHex(newR)}${toHex(newG)}${toHex(newB)}`;\n}\n\nexport const getBgColor = (mainColor: string, opacity: number) => {\n  const themeColor = mainColor || '#5C62FF';\n\n  const [r, g, b] = hexToRgb(themeColor);\n\n  return rgbaToHexWithBackground(r, g, b, opacity);\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport classNames from 'classnames';\nimport { Tag } from '@coze-arch/coze-design';\n\nimport styles from './index.module.less';\n\nexport interface OutputInfoType {\n  label: string;\n  type: string;\n  required?: boolean;\n  style?: React.CSSProperties;\n}\n\nexport const OutputsParamDisplay = ({\n  options,\n}: {\n  options: {\n    outputInfo: OutputInfoType[];\n    customClassNames?: string;\n  };\n}) => {\n  const { outputInfo, customClassNames } = options ?? {};\n\n  return (\n    <div className={classNames('flex flex-col gap-[8px]', customClassNames)}>\n      {outputInfo?.map?.(({ label, type, required, style }) => (\n        <div className=\"flex items-center\" style={style}>\n          <div className={styles.label}>{label}</div>\n          {required ? <span className={styles.required}>*</span> : null}\n          {type ? (\n            <Tag\n              className={classNames(styles.tag, '!px-[3px] !py-[1px]')}\n              color=\"primary\"\n            >\n              {type}\n            </Tag>\n          ) : null}\n        </div>\n      ))}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ViewVariableType } from '@coze-workflow/base';\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport const ObjectLikeTypes = [\n  ViewVariableType.Object,\n  ViewVariableType.ArrayObject,\n];\n\nexport enum ChangeMode {\n  Update,\n  Delete,\n  Append,\n  DeleteChildren,\n}\n\nexport enum DescriptionLine {\n  Single = 'singleline',\n  Multi = 'multiline',\n}\n\n// Name up to 20 characters\nexport const MAX_NAME_LENGTH = 20;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { nanoid } from 'nanoid';\n\nimport { type TreeNodeCustomData } from './components/custom-tree-node/type';\nimport { ObjectLikeTypes } from './components/custom-tree-node/constants';\n\ninterface RootFindResult {\n  isRoot: true;\n  data: TreeNodeCustomData;\n  parentData: null;\n}\ninterface ChildrenFindResult {\n  isRoot: false;\n  parentData: TreeNodeCustomData;\n  data: TreeNodeCustomData;\n}\n\nexport type FindDataResult = RootFindResult | ChildrenFindResult | null;\n/**\n * According to the target array, find the value and position of the key in the item, mainly to obtain the position, which is convenient for operating the children of the parent.\n */\nexport function findCustomTreeNodeDataResult(\n  target: Array<TreeNodeCustomData>,\n  findField: string,\n): FindDataResult {\n  const dataInRoot = target.find(item => item.field === findField);\n  if (dataInRoot) {\n    // If it is the root node\n    return {\n      isRoot: true,\n      parentData: null,\n      data: dataInRoot,\n    };\n  }\n  function findDataInChildrenLoop(\n    customChildren: Array<TreeNodeCustomData>,\n    parentData?: TreeNodeCustomData,\n  ): FindDataResult {\n    function findDataLoop(\n      customData: TreeNodeCustomData,\n      _parentData: TreeNodeCustomData,\n    ): FindDataResult {\n      if (customData.field === findField) {\n        return {\n          isRoot: false,\n          parentData: _parentData,\n          data: customData,\n        };\n      }\n      if (customData.children && customData.children.length > 0) {\n        return findDataInChildrenLoop(\n          customData.children as Array<TreeNodeCustomData>,\n          customData,\n        );\n      }\n      return null;\n    }\n    for (const child of customChildren) {\n      const childResult = findDataLoop(child, parentData || child);\n      if (childResult) {\n        return childResult;\n      }\n    }\n    return null;\n  }\n  return findDataInChildrenLoop(target);\n}\n\nconst MAX_LINE_LEVEL = 2;\nexport function formatTreeData(\n  data: Array<TreeNodeCustomData>,\n  startField: string,\n) {\n  let hasObjectLike = false;\n  const itemKeysWithChildren: string[] = [];\n  function resolveActionParamList(\n    list: Array<TreeNodeCustomData>,\n    field: string,\n    // It is mainly used to assist the judgment of the display line.\n    {\n      parentData,\n      level,\n    }: {\n      parentData?: TreeNodeCustomData;\n      level: number;\n    },\n  ) {\n    (list || []).forEach((item, index) => {\n      const keyField = `${field}[${index}]`;\n      hasObjectLike = hasObjectLike || ObjectLikeTypes.includes(item.type);\n      // Assignment children\n      item.key = item.key ?? item.fieldRandomKey ?? nanoid();\n      item.field = keyField;\n      item.isFirst = index === 0;\n      item.isLast = index === list.length - 1;\n      item.isSingle = item.isFirst && item.isLast;\n      item.level = level;\n      // The first level does not show the auxiliary line, you need to judge the level\n      // That is, the second level (level = 1) only needs its own level line\n      // After the third level (level = 2), the guide line is required to show the guide line of the previous level\n      item.helpLineShow =\n        parentData && level >= MAX_LINE_LEVEL\n          ? (parentData.helpLineShow || []).concat(!parentData.isLast)\n          : [];\n      if (item.children && item.children.length > 0) {\n        itemKeysWithChildren.push(item.key);\n        resolveActionParamList(\n          item.children as Array<TreeNodeCustomData>,\n          `${keyField}.children`,\n          {\n            parentData: item,\n            level: level + 1,\n          },\n        );\n      }\n    });\n  }\n\n  resolveActionParamList(data || [], startField, { level: 0 });\n\n  return {\n    data,\n    hasObjectLike,\n    itemKeysWithChildren,\n  };\n}\n\n/** Calculate Sidebar Width */\nexport const calcIDESideSheetWidth = (nodeWidth?: number) => {\n  const minWorkflowWidth = 1000;\n  const sideSheetReduceScale = 0.66;\n  const sideSheetMinWidth = 850;\n  const windowWidth = window.innerWidth;\n  const computedSideSheetWidth = windowWidth * sideSheetReduceScale;\n  const computedCanvasWidth = windowWidth - computedSideSheetWidth;\n\n  if (windowWidth < minWorkflowWidth) {\n    return computedSideSheetWidth;\n  }\n\n  if (nodeWidth && computedCanvasWidth < nodeWidth) {\n    return windowWidth - nodeWidth;\n  }\n\n  if (computedSideSheetWidth < sideSheetMinWidth) {\n    return sideSheetMinWidth;\n  } else {\n    return computedSideSheetWidth;\n  }\n};\n\ninterface TreeNode<T> {\n  children?: T[];\n  [key: string]: unknown;\n}\n\nexport function traverse<T extends TreeNode<T>>(\n  nodeOrNodes: T | T[],\n  action: (node: T) => void,\n) {\n  const nodes = Array.isArray(nodeOrNodes) ? nodeOrNodes : [nodeOrNodes];\n\n  nodes.forEach(node => {\n    action(node);\n\n    if (node.children && node.children.length > 0) {\n      traverse(node.children, action);\n    }\n  });\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createContext, useContext } from 'react';\n\ninterface OutputTreeContext {\n  testId?: string;\n}\n\nconst outputTreeContext = createContext<OutputTreeContext>({});\n\nexport const useOutputTreeContext = () => useContext(outputTreeContext);\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport const OutputTreeContextProvider = outputTreeContext.Provider;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, Suspense, lazy } from 'react';\n\nimport { nanoid } from 'nanoid';\nimport { WorkflowBatchService } from '@coze-workflow/variable';\nimport {\n  ResponseFormat,\n  useNodeTestId,\n  ViewVariableType,\n  type ViewVariableTreeNode,\n} from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconInfo } from '@coze-arch/bot-icons';\nimport { Select, Tooltip } from '@coze-arch/coze-design';\n\nimport { type TreeNodeCustomData } from '../custom-tree-node/type';\n\n// @Coze-arch/bot-md-box-adapter/lazy lazy is md-box's own lazy, mainly lazy to load large packages like mathfull, here our own lazy is for lazy md-box entire package\nconst LazyMdBox = lazy(async () => {\n  const { MdBoxLazy } = await import('@coze-arch/bot-md-box-adapter/lazy');\n  return {\n    default: MdBoxLazy,\n  };\n});\ninterface IResponseFormatSelect {\n  readonly?: boolean;\n  value?: number;\n  outputValue: TreeNodeCustomData[];\n  onlyString?: boolean;\n  onChange?: (value: TreeNodeCustomData[]) => void;\n  onResponseFormatChange?: (value: number) => void;\n  isBatch?: boolean;\n  testId: string;\n}\n\nexport const ResponseFormatSelect: FC<IResponseFormatSelect> = props => {\n  const {\n    readonly,\n    value,\n    outputValue,\n    onlyString,\n    onChange,\n    onResponseFormatChange,\n    isBatch,\n    testId,\n  } = props;\n  const { concatTestId } = useNodeTestId();\n  return (\n    <Select\n      className=\"overflow-hidden\"\n      size=\"small\"\n      disabled={readonly}\n      value={value}\n      data-testid={testId}\n      // eslint-disable-next-line complexity\n      onChange={v => {\n        // If you switch to text mode, you need to reset output to only one value of type string\n        if (onlyString) {\n          let newValue = [\n            {\n              key: nanoid(),\n              name: 'output',\n              type: ViewVariableType.String,\n            },\n          ] as TreeNodeCustomData[];\n\n          if (isBatch) {\n            newValue = WorkflowBatchService.singleOutputMetasToList(\n              newValue as ViewVariableTreeNode[],\n            ) as TreeNodeCustomData[];\n            // If there is a value in itself, take the first one, expect: reuse variable name/description\n            if (outputValue?.[0]) {\n              newValue = [outputValue[0]];\n            }\n            if (outputValue?.[0].children?.[0]) {\n              newValue[0].children = [outputValue?.[0].children?.[0]];\n            }\n            // Modify type to string only\n            if (\n              newValue?.[0].children?.[0].type &&\n              newValue?.[0].children?.[0].type !== ViewVariableType.String\n            ) {\n              newValue[0].children[0].type = ViewVariableType.String;\n            }\n          } else {\n            // If there is a value in itself, take the first one, expect: reuse variable name/description\n            if (outputValue?.[0]) {\n              newValue = [outputValue[0]];\n            }\n            // Modify type to string only\n            if (newValue[0].type !== ViewVariableType.String) {\n              newValue[0].type = ViewVariableType.String;\n            }\n          }\n          onChange?.(newValue);\n        }\n        onResponseFormatChange?.(v as number);\n      }}\n      prefix={\n        <span className=\"coz-fg-secondary text-base flex items-center ml-1 -mr-1.5\">\n          <Tooltip\n            content={\n              <Suspense fallback={null}>\n                <LazyMdBox\n                  markDown={I18n.t('model_config_response_format_explain')}\n                />\n              </Suspense>\n            }\n          >\n            <IconInfo className=\"cursor-pointer coz-fg-dim pl-[2px] pr-[4px]\" />\n          </Tooltip>\n          {I18n.t('devops_publish_multibranch_ModelInfo.ResponseFormat')}\n        </span>\n      }\n    >\n      {[\n        {\n          label: I18n.t(\n            'devops_publish_multibranch_ModelInfo.ModelResponseFormat.Text',\n          ),\n          value: ResponseFormat.Text,\n        },\n        {\n          label: I18n.t(\n            'devops_publish_multibranch_ModelInfo.ModelResponseFormat.Markdown',\n          ),\n          value: ResponseFormat.Markdown,\n        },\n        {\n          label: I18n.t(\n            'devops_publish_multibranch_ModelInfo.ModelResponseFormat.JSON',\n          ),\n          value: ResponseFormat.JSON,\n        },\n      ].map(option => (\n        <Select.Option\n          {...option}\n          data-testid={concatTestId(testId, `${option.value}`)}\n        />\n      ))}\n    </Select>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useEffect, useRef, useState, type FC } from 'react';\n\nimport { IconCrossStroked } from '@douyinfe/semi-icons';\nimport { json as languageJSON } from '@coze-editor/editor/language-json';\nimport { I18n } from '@coze-arch/i18n';\nimport { Button, IconButton, Tooltip, Modal } from '@coze-arch/coze-design';\nimport {\n  IconInfo,\n  IconUpdateOutlined,\n  IconWarningInfo,\n} from '@coze-arch/bot-icons';\n\nimport { CodeEditor, EditorProvider } from '@/components/code-editor';\n\nimport type { TreeNodeCustomData } from '../custom-tree-node/type';\n\nimport styles from './index.module.less';\n\nconst uri = 'file:///json-import/data.json';\nlanguageJSON.languageService.configureSchemas({\n  uri: 'file:///import-schema.json',\n  fileMatch: [uri],\n  schema: {\n    type: 'object',\n    properties: {},\n  },\n});\n\ninterface JSONEditorProps {\n  id: string;\n  value: string;\n  setValue: (value: string) => void;\n  onClose: () => void;\n  onChange: (value: TreeNodeCustomData[]) => void;\n}\n\nexport const JSONEditor: FC<JSONEditorProps> = props => {\n  const { id, value, setValue, onClose, onChange } = props;\n  const [schema, setSchema] = useState<TreeNodeCustomData[] | undefined>();\n  const tooltipPopContainerRef = useRef<HTMLDivElement>(null);\n\n  const change = useCallback(async () => {\n    if (!schema) {\n      return;\n    }\n    return new Promise(resolve => {\n      Modal.warning({\n        icon: (\n          <IconWarningInfo\n            className={styles.warningIcon}\n            style={{\n              width: 22,\n              height: 22,\n            }}\n          />\n        ),\n        title: I18n.t('workflow_json_node_update_tips_title'),\n        content: I18n.t('workflow_json_node_update_tips_content'),\n        okType: 'warning',\n        okText: I18n.t('Confirm'),\n        cancelText: I18n.t('Cancel'),\n        onOk: async () => {\n          const outputValue = (await convert(value)) || [];\n          onChange(outputValue);\n          resolve(true);\n        },\n        onCancel: () => resolve(false),\n      });\n    });\n  }, [schema]);\n\n  const convert = async (\n    jsonString: string,\n  ): Promise<TreeNodeCustomData[] | undefined> => {\n    const { convertSchema } = await import(\n      '@coze-workflow/code-editor-adapter'\n    );\n    if (!jsonString) {\n      return;\n    }\n    try {\n      const json = JSON.parse(jsonString);\n      const outputValue = convertSchema(\n        json,\n      ) as unknown as TreeNodeCustomData[];\n      if (\n        !outputValue ||\n        !Array.isArray(outputValue) ||\n        outputValue.length === 0\n      ) {\n        return;\n      }\n      return outputValue;\n    } catch (e) {\n      return;\n    }\n  };\n\n  // Synchronizing values and schemas\n  useEffect(() => {\n    const handler = async () => {\n      const _schema = await convert(value);\n      setSchema(_schema);\n    };\n\n    handler();\n  }, [value]);\n\n  return (\n    <div key={id} className={styles.container}>\n      <div className={styles.header}>\n        <span className={styles.leftSide}>\n          <span className={styles.title}>\n            <p>{I18n.t('workflow_json_windows_title')}</p>\n          </span>\n          <span>\n            <Tooltip\n              className={styles.tip}\n              position=\"bottom\"\n              getPopupContainer={() =>\n                tooltipPopContainerRef.current as HTMLElement\n              }\n              content={I18n.t('workflow_json_windows_title_tips')}\n            >\n              <IconInfo className={styles.info} />\n            </Tooltip>\n          </span>\n        </span>\n        <span className={styles.rightSide}>\n          <span\n            style={{\n              display: schema ? 'flex' : 'none',\n            }}\n          >\n            <IconButton\n              icon={<IconUpdateOutlined />}\n              size=\"small\"\n              color=\"primary\"\n              onClick={() => change()}\n            >\n              {I18n.t('workflow_json_button_node_update')}\n            </IconButton>\n          </span>\n          <span>\n            <Button\n              icon={<IconCrossStroked />}\n              size=\"small\"\n              color=\"secondary\"\n              aria-label=\"close\"\n              onClick={() => onClose()}\n            />\n          </span>\n        </span>\n        <span\n          className={styles.tooltipPopContainer}\n          ref={tooltipPopContainerRef}\n        ></span>\n      </div>\n      <div className={styles.content}>\n        <EditorProvider>\n          <CodeEditor\n            key={id}\n            domProps={{\n              style: {\n                width: '100%',\n                height: '100%',\n              },\n            }}\n            defaultValue={value}\n            options={{\n              uri,\n              languageId: 'json',\n              minHeight: '100%',\n              maxHeight: '100%',\n              theme: 'coze-dark',\n              fontSize: 12,\n              borderRadius: '6px',\n            }}\n            onChange={e => {\n              setValue(e.value || '');\n            }}\n          />\n        </EditorProvider>\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { nanoid } from 'nanoid';\nimport { traverse, type TraverseContext } from '@coze-workflow/base';\n\nimport type { TreeNodeCustomData } from '../../custom-tree-node/type';\n\n/** Compute Path */\nconst getTreePath = (context: TraverseContext): string => {\n  const parents = context\n    .getParents()\n    .filter(\n      node =>\n        typeof node.value === 'object' &&\n        typeof node.value.name !== 'undefined' &&\n        typeof node.value.type !== 'undefined',\n    );\n  return parents.map(node => node.value.name).join('/');\n};\n\n/** Old and new data keep keys to prevent variable system references from invalidating */\nexport const mergeData = (params: {\n  newData: TreeNodeCustomData[];\n  oldData: TreeNodeCustomData[];\n  withRequired: boolean;\n}): TreeNodeCustomData[] => {\n  const { newData, oldData, withRequired } = params;\n\n  // Compute the mapping of paths and keys in old data\n  const treeDataPathKeyMap = new Map<string, string>();\n  traverse(oldData, context => {\n    if (\n      typeof context.node.value !== 'object' ||\n      typeof context.node.value.key === 'undefined' ||\n      typeof context.node.value.type === 'undefined'\n    ) {\n      return;\n    }\n    const stringifyPath = getTreePath(context);\n    treeDataPathKeyMap.set(stringifyPath, context.node.value.key);\n  });\n\n  // The new data reuses the key of the old data, and if it fails, it is regenerated.\n  const valueWithRequired = !withRequired\n    ? newData\n    : traverse(newData, context => {\n        if (\n          typeof context.node.value !== 'object' ||\n          typeof context.node.value.type === 'undefined'\n        ) {\n          return;\n        }\n        const stringifyPath = getTreePath(context);\n        const key = treeDataPathKeyMap.get(stringifyPath) || nanoid();\n        context.node.value.key = key;\n        context.node.value.required = true;\n      });\n\n  return valueWithRequired;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ViewVariableType } from '@coze-workflow/base';\nimport {\n  traverse,\n  type TraverseContext,\n  type TraverseHandler,\n} from '@coze-workflow/base';\n\nimport type { TreeNodeCustomData } from '../../custom-tree-node/type';\n\nconst isOutputValueContext = (context: TraverseContext): boolean => {\n  if (\n    typeof context.node.value !== 'object' ||\n    typeof context.node.value.type === 'undefined'\n  ) {\n    return false;\n  } else {\n    return true;\n  }\n};\n\nconst cutOffNameLength =\n  (length: number): TraverseHandler =>\n  (context: TraverseContext): void => {\n    if (!isOutputValueContext(context)) {\n      return;\n    }\n    if (context.node.value.name.length > length) {\n      context.node.value.name = context.node.value.name.slice(0, length);\n    }\n  };\n\nconst cutOffDepth =\n  (depth: number): TraverseHandler =>\n  (context: TraverseContext): void => {\n    if (\n      !isOutputValueContext(context) ||\n      context.node.value.level !== depth ||\n      ![ViewVariableType.Object, ViewVariableType.ArrayObject].includes(\n        context.node.value.type,\n      )\n    ) {\n      return;\n    }\n    context.deleteSelf();\n  };\n\nconst cutOffDisabledTypes =\n  (params: { disabledTypes: ViewVariableType[]; isBatch: boolean }) =>\n  (context: TraverseContext): void => {\n    const { disabledTypes, isBatch } = params;\n    if (\n      !isOutputValueContext(context) ||\n      !disabledTypes.includes(context.node.value.type)\n    ) {\n      return;\n    }\n    if (isBatch && context.node.value.level === 0) {\n      return;\n    }\n    context.deleteSelf();\n  };\n\nexport const cutOffInvalidData = (params: {\n  data: TreeNodeCustomData[];\n  isBatch: boolean;\n  disabledTypes: ViewVariableType[];\n  allowDepth: number;\n  allowNameLength: number;\n}): TreeNodeCustomData[] => {\n  const { data, isBatch, disabledTypes, allowDepth, allowNameLength } = params;\n  const cutOffDisabledTypesHandler = cutOffDisabledTypes({\n    disabledTypes,\n    isBatch,\n  });\n  return traverse<TreeNodeCustomData[]>(data, [\n    cutOffNameLength(allowNameLength),\n    cutOffDepth(allowDepth),\n    cutOffDisabledTypesHandler,\n  ]);\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ViewVariableType } from '@coze-workflow/base';\n\nimport type { TreeNodeCustomData } from '../../custom-tree-node/type';\n\nexport const addBatchData = (params: {\n  data: TreeNodeCustomData[];\n  isBatch: boolean;\n}): TreeNodeCustomData[] => {\n  const { data, isBatch } = params;\n  if (!isBatch) {\n    return data;\n  }\n  return [\n    {\n      name: 'outputList',\n      type: ViewVariableType.ArrayObject,\n      children: data,\n    },\n  ] as TreeNodeCustomData[];\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { TreeNodeCustomData } from '../../custom-tree-node/type';\n\n/**\n * Supplementary readonly metas\n */\nexport const addReadOnlyData = (params: {\n  treeData: TreeNodeCustomData[];\n  data: TreeNodeCustomData[];\n  isBatch: boolean;\n}): TreeNodeCustomData[] => {\n  const { treeData, data, isBatch } = params;\n  // Batch added to data [0] .children\n  if (isBatch) {\n    const readonlyMetas = treeData?.[0].children?.filter(d => d.readonly);\n    if (readonlyMetas?.length) {\n      const [one, ...rest] = data;\n      return [\n        {\n          ...one,\n          children: [\n            ...(one.children ?? []),\n            ...readonlyMetas,\n          ] as TreeNodeCustomData[],\n        },\n        ...rest,\n      ];\n    }\n    // Single processing data\n  } else {\n    const readonlyMetas = treeData?.filter(d => d.readonly);\n    if (readonlyMetas?.length) {\n      return [...data, ...readonlyMetas];\n    }\n  }\n  return data;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, useState } from 'react';\n\nimport { JSONEditor } from '../json-editor';\nimport type { TreeNodeCustomData } from '../custom-tree-node/type';\n\nexport const JSONEditorWithState: FC<{\n  updateKey: number;\n  uniqueId: string;\n  onChange: (data: TreeNodeCustomData[]) => void;\n  onClose: () => void;\n}> = props => {\n  const { updateKey, uniqueId, onClose, onChange } = props;\n\n  const [JSONString, setJSONString] = useState('');\n\n  return (\n    <JSONEditor\n      key={updateKey}\n      id={uniqueId}\n      value={JSONString}\n      setValue={(value: string) => {\n        setJSONString(value);\n      }}\n      onClose={onClose}\n      onChange={onChange}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport { useEffect, useState, type FC } from 'react';\n\nimport classNames from 'classnames';\nimport type { ViewVariableType } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozImport } from '@coze-arch/coze-design/icons';\nimport { IconButton, Tooltip } from '@coze-arch/coze-design';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport { useNodeFormPanelState } from '@/hooks/use-node-side-sheet-store';\n\nimport { JSONEditor } from '../json-editor';\nimport type { TreeNodeCustomData } from '../custom-tree-node/type';\nimport { calcIDESideSheetWidth, formatTreeData } from '../../utils';\nimport { useFitViewport } from '../../../../hooks';\nimport { useBizIDEState } from '../../../../../hooks/use-biz-ide-state';\nimport { SingletonInnerSideSheet } from '../../../../../components/workflow-inner-side-sheet';\nimport { mergeData } from './utils/merge';\nimport { cutOffInvalidData } from './utils/cut-off';\nimport { addBatchData } from './utils/batch';\nimport { addReadOnlyData } from './utils/add-readonly-data';\nimport { JSONEditorWithState } from './json-editor-with-state';\n\nimport styles from './index.module.less';\n\ninterface JSONImportProps {\n  startField: string;\n  treeData: TreeNodeCustomData[];\n  disabledTypes: ViewVariableType[];\n  disabledTooltip?: string;\n  rules: {\n    disabled: boolean;\n    withRequired: boolean;\n    isBatch: boolean;\n    onlyString: boolean;\n    jsonImport: boolean;\n    readonly: boolean;\n    topLevelReadonly: boolean;\n  };\n  hideAddButton: boolean;\n  onChange: (value: Array<TreeNodeCustomData>) => void;\n  testId?: string;\n}\n\nexport const JSONImport: FC<JSONImportProps> = props => {\n  const {\n    startField,\n    treeData,\n    rules,\n    disabledTooltip,\n    disabledTypes,\n    testId,\n    hideAddButton,\n  } = props;\n  const {\n    disabled,\n    withRequired,\n    isBatch,\n    onlyString,\n    jsonImport,\n    readonly,\n    topLevelReadonly,\n  } = rules;\n  const node = useCurrentEntity();\n  const uniqueId = `${node.id}.json_import`;\n  const [jsonString, setJsonString] = useState<string>('');\n  const [updateKey, setUpdateKey] = useState<number>(0);\n\n  const {\n    forceCloseBizIDE,\n    isBizIDEOpen,\n    uniqueId: bizIDEUniqueId,\n  } = useBizIDEState();\n\n  const { setFullscreenPanel } = useNodeFormPanelState();\n\n  const onChange = (data: TreeNodeCustomData[]) => {\n    // Add batch data\n    const dataWithBatch = addBatchData({ data, isBatch });\n    // Merge old and new data\n    const mergedData = mergeData({\n      newData: dataWithBatch,\n      oldData: treeData,\n      withRequired,\n    });\n    // data formatting\n    const formattedTreeData: TreeNodeCustomData[] = formatTreeData(\n      mergedData,\n      startField,\n    ).data;\n    const allowDepth = 3; // Maximum depth limit\n    const allowNameLength = 20; // Name length limit\n    // Crop illegal data\n    const dataCutoff = cutOffInvalidData({\n      data: formattedTreeData,\n      isBatch,\n      disabledTypes,\n      allowDepth: isBatch ? allowDepth + 1 : allowDepth, // The lower level of the batch is deeper\n      allowNameLength,\n    });\n\n    // Add readonly data (currently only errorBody)\n    const dataWithReadonly = addReadOnlyData({\n      isBatch,\n      treeData,\n      data: dataCutoff,\n    });\n\n    // update data\n    return props.onChange(dataWithReadonly);\n  };\n\n  useFitViewport({\n    enable: isBizIDEOpen && uniqueId === bizIDEUniqueId,\n    nodeId: node.id,\n  });\n\n  useEffect(\n    () => () => {\n      forceCloseBizIDE();\n    },\n    [],\n  );\n\n  useEffect(() => {\n    // The child component onChange implicitly depends on isBatch and must force a re-render\n    setUpdateKey(updateKey + 1);\n  }, [isBatch]);\n\n  useEffect(() => {\n    if (onlyString) {\n      forceCloseBizIDE();\n    }\n  }, [onlyString]);\n\n  if (!jsonImport || readonly || topLevelReadonly || onlyString) {\n    return <></>;\n  }\n\n  return (\n    <>\n      <div\n        className={styles.buttonContainer}\n        style={{\n          right: hideAddButton ? 16 : 44,\n        }}\n        data-testid={testId}\n      >\n        <Tooltip\n          content={disabled ? disabledTooltip : I18n.t('workflow_json_import')}\n        >\n          <IconButton\n            className={classNames('!block', {\n              [styles.importButton]: true,\n              [styles.importButtonDisabled]: disabled,\n            })}\n            size=\"small\"\n            disabled={disabled}\n            icon={<IconCozImport className={styles.buttonIcon} />}\n            onClick={() => {\n              setFullscreenPanel(\n                <JSONEditorWithState\n                  updateKey={updateKey}\n                  uniqueId={uniqueId}\n                  onClose={() => {\n                    setFullscreenPanel(null);\n                  }}\n                  onChange={onChange}\n                />,\n              );\n            }}\n          ></IconButton>\n        </Tooltip>\n      </div>\n      <SingletonInnerSideSheet\n        sideSheetId={uniqueId}\n        sideSheetProps={{\n          className: styles.sideSheet,\n          width: calcIDESideSheetWidth(node?.getNodeMeta()?.size?.width),\n          style: {\n            position: 'relative',\n            overflow: 'auto',\n          },\n          bodyStyle: {\n            padding: 0,\n          },\n          headerStyle: {\n            display: 'none',\n          },\n          motion: false,\n        }}\n        mutexWithLeftSideSheet\n        closeConfirm={() => {\n          forceCloseBizIDE();\n          return true;\n        }}\n      >\n        <JSONEditor\n          key={updateKey}\n          id={uniqueId}\n          value={jsonString}\n          setValue={(value: string) => {\n            setJsonString(value);\n          }}\n          onClose={() => {\n            forceCloseBizIDE();\n          }}\n          onChange={onChange}\n        />\n      </SingletonInnerSideSheet>\n    </>\n  );\n};\n\nexport const JSONImportPlaceholder: FC<{\n  enable: boolean;\n  hideAddButton: boolean;\n}> = ({ enable, hideAddButton }) => (\n  <div style={{ width: hideAddButton ? 32 : 60 }}></div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TreeIndentWidth } from '../constants';\n\ninterface ColumnsStyle {\n  name: React.CSSProperties;\n  type: React.CSSProperties;\n}\n\nexport function useColumnsStyle(columnsRatio = '3:2', level = 0): ColumnsStyle {\n  const [nameWidth, typeWidth] = columnsRatio.split(':').map(Number);\n\n  return {\n    name: {\n      flex: `${nameWidth} ${nameWidth} 0`,\n    },\n    type: {\n      flex: `${typeWidth} ${typeWidth} ${\n        (level * TreeIndentWidth * typeWidth) / nameWidth\n      }px`,\n      minWidth: '80px',\n      maxWidth: '135px',\n    },\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/naming-convention */\n\n/** Indent width of each level of tree */\nexport const TreeIndentWidth = 15;\n/** Tree Node Expand Collapse Button Width */\nexport const TreeCollapseWidth = 10;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-magic-numbers */\nimport React from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport { useColumnsStyle } from '../../hooks/use-columns-style';\nimport { TreeCollapseWidth } from '../../constants';\n\nimport styles from './index.module.less';\n\ninterface HeaderProps {\n  readonly?: boolean;\n  config: {\n    hasObjectLike?: boolean;\n    hasCollapse?: boolean;\n    hasDescription?: boolean;\n    hasRequired?: boolean;\n  };\n  columnsRatio?: string;\n}\n\nexport default function Header({\n  readonly,\n  config,\n  columnsRatio,\n}: HeaderProps) {\n  const columnsStyle = useColumnsStyle(columnsRatio);\n\n  if (readonly) {\n    return null;\n  }\n  return (\n    <div\n      className={styles.header}\n      style={{\n        marginLeft: config.hasCollapse ? TreeCollapseWidth + 8 : 0,\n      }}\n    >\n      {/* name */}\n      <div className={styles.name} style={columnsStyle.name}>\n        <span className={styles.text}>\n          {I18n.t('workflow_detail_end_output_name')}\n        </span>\n      </div>\n\n      {/* type */}\n      <div className={styles.type} style={columnsStyle.type}>\n        <span className={styles.text}>\n          {I18n.t('workflow_detail_start_variable_type')}\n        </span>\n      </div>\n\n      <div className=\"relative flex gap-1\">\n        {/* required label */}\n        {config.hasRequired ? (\n          <div className={styles.required}>\n            <span className={styles.text}>{I18n.t('wf_20241206_001')}</span>\n          </div>\n        ) : null}\n\n        {/* description */}\n        {config.hasDescription ? (\n          <div\n            className={styles.description}\n            style={{\n              width: 24,\n            }}\n          >\n            <div className={styles.descriptionTitle}>\n              <span className={styles.text}>\n                {/* {I18n.t('workflow_detail_llm_output_decription_title')} */}\n              </span>\n            </div>\n          </div>\n        ) : null}\n\n        {/* Object operation placeholder */}\n        {config.hasObjectLike ? <div className=\"w-6\"></div> : null}\n\n        {/* Required placeholder */}\n        {config.hasRequired ? <div className=\"w-6\"></div> : null}\n\n        {/* Delete button placeholder */}\n        <div className=\"w-6\"></div>\n      </div>\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReactNode } from 'react';\n\nimport { ViewVariableType } from '@coze-workflow/base/types';\nimport {\n  IconCozNumber,\n  IconCozNumberBracket,\n  IconCozString,\n  IconCozStringBracket,\n  IconCozBoolean,\n  IconCozBooleanBracket,\n  IconCozBrace,\n  IconCozBraceBracket,\n  IconCozFolder,\n  IconCozFolderBracket,\n  IconCozImage,\n  IconCozImageBracket,\n  IconCozSound,\n  IconCozNumberInt,\n  IconCozNumberIntBracket,\n  IconCozClock,\n  IconCozClockBracket,\n} from '@coze-arch/coze-design/icons';\n\nexport const VARIABLE_TYPE_ICONS_MAP: Record<ViewVariableType, ReactNode> = {\n  [ViewVariableType.String]: <IconCozString />,\n  [ViewVariableType.Integer]: <IconCozNumberInt />,\n  [ViewVariableType.Boolean]: <IconCozBoolean />,\n  [ViewVariableType.Number]: <IconCozNumber />,\n  [ViewVariableType.Object]: <IconCozBrace />,\n  [ViewVariableType.Image]: <IconCozImage />,\n  [ViewVariableType.File]: <IconCozFolder />,\n  [ViewVariableType.Doc]: <IconCozFolder />,\n  [ViewVariableType.Code]: <IconCozFolder />,\n  [ViewVariableType.Ppt]: <IconCozFolder />,\n  [ViewVariableType.Txt]: <IconCozFolder />,\n  [ViewVariableType.Excel]: <IconCozFolder />,\n  [ViewVariableType.Audio]: <IconCozFolder />,\n  [ViewVariableType.Zip]: <IconCozFolder />,\n  [ViewVariableType.Video]: <IconCozFolder />,\n  [ViewVariableType.Svg]: <IconCozImage />,\n  [ViewVariableType.Voice]: <IconCozSound />,\n  [ViewVariableType.Time]: <IconCozClock />,\n  [ViewVariableType.ArrayString]: <IconCozStringBracket />,\n  [ViewVariableType.ArrayInteger]: <IconCozNumberIntBracket />,\n  [ViewVariableType.ArrayBoolean]: <IconCozBooleanBracket />,\n  [ViewVariableType.ArrayNumber]: <IconCozNumberBracket />,\n  [ViewVariableType.ArrayObject]: <IconCozBraceBracket />,\n  [ViewVariableType.ArrayImage]: <IconCozImageBracket />,\n  [ViewVariableType.ArrayFile]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayDoc]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayCode]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayPpt]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayTxt]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayExcel]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayAudio]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayZip]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayVideo]: <IconCozFolderBracket />,\n  [ViewVariableType.ArraySvg]: <IconCozImageBracket />,\n  [ViewVariableType.ArrayVoice]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayTime]: <IconCozClockBracket />,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport React, { useState } from 'react';\n\nimport classNames from 'classnames';\nimport {\n  FILE_TYPES,\n  VARIABLE_TYPE_ALIAS_MAP,\n  type ViewVariableType,\n  useNodeTestId,\n} from '@coze-workflow/base';\nimport { IconCozArrowDown } from '@coze-arch/coze-design/icons';\nimport { Tooltip } from '@coze-arch/coze-design';\nimport { type SelectProps } from '@coze-arch/bot-semi/Select';\n\nimport { VariableTypeSelector } from '@/form-extensions/components/variable-type-selector';\n\nimport { type TreeNodeCustomData } from '../../type';\nimport { useOutputTreeContext } from '../../../../context';\nimport { ValidationErrorWrapper } from '../../../../../validation/validation-error-wrapper';\nimport { VARIABLE_TYPE_ICONS_MAP } from './constants';\n\nimport styles from './index.module.less';\n\ninterface ParamTypeProps {\n  data: TreeNodeCustomData;\n  level: number;\n  onSelectChange?: SelectProps['onChange'];\n  disabled?: boolean;\n  /** Types not supported */\n  disabledTypes?: ViewVariableType[];\n  /** hidden type */\n  hiddenTypes?: ViewVariableType[];\n  style?: React.CSSProperties;\n}\n\nconst defaultDisabledTypes = [];\n// Currently only the start node supports declaring file type variables\nconst defaultHiddenTypes = FILE_TYPES;\n\nexport default function ParamType({\n  data,\n  onSelectChange,\n  level,\n  disabled,\n  disabledTypes = defaultDisabledTypes,\n  hiddenTypes = defaultHiddenTypes,\n  style,\n}: ParamTypeProps) {\n  const { testId } = useOutputTreeContext();\n  const { concatTestId } = useNodeTestId();\n\n  const [focused, setFocused] = useState(false);\n\n  return (\n    <ValidationErrorWrapper\n      path={`${data.field?.slice(data.field.indexOf('['))}.type`}\n      className={styles.container}\n      style={style}\n      errorCompClassName={'output-param-name-error-type'}\n    >\n      {options =>\n        disabled ? (\n          <div className=\"flex items-center w-full h-6\">\n            <div className=\"coz-fg-secondary font-medium text-xs truncate  coz-mg-plus px-1 py-0.5 rounded-[5px]\">\n              {VARIABLE_TYPE_ALIAS_MAP[data.type] || ''}\n            </div>\n          </div>\n        ) : (\n          <VariableTypeSelector\n            value={data.type}\n            level={level}\n            disabled={disabled}\n            disabledTypes={disabledTypes}\n            hiddenTypes={hiddenTypes}\n            onChange={val => {\n              let newVal = val;\n              if (Array.isArray(val)) {\n                newVal = val[val.length - 1];\n              }\n              onSelectChange?.(newVal);\n              options.onChange();\n            }}\n            onBlur={() => {\n              setFocused(false);\n              options.onBlur();\n            }}\n            onFocus={() => setFocused(true)}\n            validateStatus={options.showError ? 'error' : 'default'}\n          >\n            <div\n              className={classNames('w-full', {\n                'bg-transparent': !disabled,\n                'bg-[--semi-color-disabled-fill]': disabled,\n              })}\n            >\n              <Tooltip\n                style={{ pointerEvents: 'none' }}\n                content={VARIABLE_TYPE_ALIAS_MAP[data.type]}\n              >\n                <div\n                  data-testid={concatTestId(\n                    testId ?? '',\n                    data.field,\n                    'param-type-select',\n                  )}\n                  className={classNames(\n                    `flex items-center justify-between gap-0.5 pl-[3px] pr-[3px] rounded-[6px] ${\n                      disabled ? 'cursor-not-allowed' : 'cursor-pointer'\n                    }`,\n                    'border border-solid bg-transparent',\n                    {\n                      'semi-input-wrapper-error': options.showError,\n                      'coz-stroke-plus': !options.showError && !disabled,\n                      '!bg-transparent': focused,\n                      '!coz-stroke-hglt': focused && !options.showError,\n                      'border-stroke': disabled,\n                    },\n                    'hover:coz-mg-primary-hovered',\n                    'semi-input-wrapper semi-input-wrapper-small',\n                  )}\n                >\n                  <div className=\"coz-fg-primary truncate text-xs gap-1 items-center flex\">\n                    <div className=\"h-[12px] flex-grow coz-fg-secondary text-[16px] flex items-center\">\n                      {VARIABLE_TYPE_ICONS_MAP[data.type]}\n                    </div>\n                    <div className=\"truncate\">\n                      {VARIABLE_TYPE_ALIAS_MAP[data.type]}\n                    </div>\n                  </div>\n                  <IconCozArrowDown className=\"coz-fg-secondary min-w-[16px] text-[16px]\" />\n                </div>\n              </Tooltip>\n            </div>\n          </VariableTypeSelector>\n        )\n      }\n    </ValidationErrorWrapper>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport React from 'react';\n\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { Checkbox as UICheckbox } from '@coze-arch/coze-design';\n\nimport { type TreeNodeCustomData } from '../../type';\nimport { useOutputTreeContext } from '../../../../context';\n\nimport styles from './index.module.less';\n\ninterface ParamRequiredProps {\n  data: TreeNodeCustomData;\n  disabled?: boolean;\n  onChange: (required: boolean) => void;\n}\n\nexport default function ParamRequired({\n  data,\n  disabled,\n  onChange,\n}: ParamRequiredProps) {\n  const { concatTestId } = useNodeTestId();\n  const { testId } = useOutputTreeContext();\n  return (\n    <div className={styles.container}>\n      <div className={styles.switch}>\n        <UICheckbox\n          data-testid={concatTestId(testId ?? '', data.field, 'required')}\n          disabled={disabled}\n          checked={data.required}\n          onChange={e => onChange(e.target.checked || false)}\n        ></UICheckbox>\n      </div>\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport React from 'react';\n\nimport classNames from 'classnames';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozMinus } from '@coze-arch/coze-design/icons';\nimport { Tooltip, IconButton } from '@coze-arch/coze-design';\n\nimport { type TreeNodeCustomData } from '../../type';\nimport { ObjectLikeTypes } from '../../constants';\nimport { useOutputTreeContext } from '../../../../context';\nimport AddOperation from '../../../../../../../ui-components/add-operation';\n\nimport styles from './index.module.less';\n\ninterface ParamOperatorProps {\n  data: TreeNodeCustomData;\n  level: number;\n  onAppend: () => void;\n  onDelete: () => void;\n  onEnabledChange: (enabled: boolean) => void;\n  disableDelete: boolean;\n  hasObjectLike?: boolean;\n  needRenderAppendChild?: boolean;\n  disabled?: boolean;\n}\n\nexport default function ParamOperator({\n  data,\n  level,\n  onDelete,\n  onAppend,\n  disableDelete,\n  hasObjectLike,\n  disabled,\n  needRenderAppendChild = true,\n}: ParamOperatorProps) {\n  const { isPreset } = data;\n  const { testId } = useOutputTreeContext();\n  const { concatTestId } = useNodeTestId();\n  const isLimited = level >= 3;\n  // Whether to display the button for adding a child item\n  const _needRenderAppendChild =\n    ObjectLikeTypes.includes(data.type) && !isLimited;\n\n  return (\n    <div className={classNames(styles.container, 'gap-1')}>\n      {hasObjectLike ? (\n        <div className={styles.add}>\n          <Tooltip content={I18n.t('workflow_detail_node_output_add_subitem')}>\n            <div>\n              {_needRenderAppendChild && needRenderAppendChild ? (\n                <AddOperation\n                  data-testid={concatTestId(\n                    testId ?? '',\n                    data.field,\n                    'add-sub-param',\n                  )}\n                  size=\"small\"\n                  color=\"secondary\"\n                  className=\"cursor-pointer\"\n                  onClick={onAppend}\n                  subitem={true}\n                />\n              ) : null}\n            </div>\n          </Tooltip>\n        </div>\n      ) : null}\n      {isPreset && !disabled ? (\n        <div className=\"w-6\" />\n      ) : (\n        <IconButton\n          className=\"!block\"\n          size=\"small\"\n          color=\"secondary\"\n          disabled={disableDelete}\n          data-testid={concatTestId(testId ?? '', data.field, 'remove-param')}\n          onClick={() => {\n            if (disableDelete) {\n              return;\n            }\n            onDelete();\n          }}\n          icon={<IconCozMinus className=\"text-sm\" />}\n        />\n      )}\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport React, { useState } from 'react';\n\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { type InputProps } from '@coze-arch/bot-semi/Input';\n\nimport { type TreeNodeCustomData } from '../../type';\nimport { MAX_NAME_LENGTH } from '../../constants';\nimport { useOutputTreeContext } from '../../../../context';\nimport { ValidationErrorWrapper } from '../../../../../validation/validation-error-wrapper';\nimport WorkflowSLInput from '../../../../../../../ui-components/workflow-sl-input';\n\nimport styles from './index.module.less';\n\ninterface ParamNameProps {\n  data: TreeNodeCustomData;\n  disabled?: boolean;\n  onChange: (name: string) => void;\n  style?: React.CSSProperties;\n}\n\nexport default function ParamName({\n  data,\n  disabled,\n  onChange,\n  style,\n}: ParamNameProps) {\n  const { testId } = useOutputTreeContext();\n  const { concatTestId } = useNodeTestId();\n  const [focused, setFocused] = useState(false);\n\n  return (\n    <ValidationErrorWrapper\n      path={`${data.field?.slice(data.field.indexOf('['))}.name`}\n      className={styles.container}\n      style={style}\n      errorCompClassName={'output-param-name-error-text'}\n    >\n      {options =>\n        disabled ? (\n          <div className=\"w-full flex items-center h-6\">\n            <div className=\"coz-fg-primary font-medium text-xs truncate \">\n              {data.name}\n            </div>\n          </div>\n        ) : (\n          <WorkflowSLInput\n            className={styles.name}\n            value={data.name}\n            disabled={disabled}\n            handleBlur={name => {\n              onChange(name);\n              // There is a problem with the timing of the validator, add setTimeout to avoid the error message flashing.\n              setTimeout(() => {\n                options.onBlur();\n              }, 33);\n              setFocused(false);\n            }}\n            handleFocus={() => {\n              setFocused(true);\n            }}\n            handleChange={(name: string) => {\n              options.onChange();\n            }}\n            inputProps={\n              {\n                placeholder: I18n.t('workflow_detail_end_output_entername'),\n                disabled,\n                maxLength: !disabled && focused ? MAX_NAME_LENGTH : undefined,\n                'data-testid': concatTestId(\n                  testId ?? '',\n                  data.field,\n                  'param-name',\n                ),\n                size: 'small',\n              } as unknown as InputProps\n            }\n            validateStatus={options.showError ? 'error' : 'default'}\n          />\n        )\n      }\n    </ValidationErrorWrapper>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback } from 'react';\n\nimport { VoiceSelect } from '@coze-workflow/components';\n\nimport { type FileProps } from './types';\n\nconst VoiceAdapter: React.FC<FileProps> = props => {\n  const { value, onChange, disabled, onBlur } = props;\n\n  const handleChange = useCallback(\n    (v?: string) => {\n      onChange?.(v);\n      onBlur?.();\n    },\n    [onBlur, onChange],\n  );\n\n  return (\n    <VoiceSelect value={value} onChange={handleChange} disabled={disabled} />\n  );\n};\n\nexport { VoiceAdapter };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { VoiceAdapter } from './voice-adapter';\nimport { type BaseFileProps, type FileProps } from './types';\nimport { TypedFileInput } from './typed-file-input';\nimport { FileBaseAdapter } from './base-adapter';\n\n/** This component is still used in the setter. It will not be deleted for the time being. It will be deleted after the dependency is lifted in the future. */\nexport const FileAdapter: React.FC<FileProps> = props => {\n  if (props.fileType === 'voice') {\n    return <VoiceAdapter {...props} />;\n  }\n\n  if (props?.enableInputURL) {\n    return <TypedFileInput {...(props as BaseFileProps)} />;\n  }\n\n  return <FileBaseAdapter {...(props as BaseFileProps)} />;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState, useMemo } from 'react';\n\nimport { debounce } from 'lodash-es';\nimport { workflowApi } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { Typography, Select, type SelectProps } from '@coze-arch/coze-design';\nimport { CreateMethod, CreateEnv } from '@coze-arch/bot-api/workflow_api';\nimport { IconSearch } from '@douyinfe/semi-icons';\n\nimport { useGlobalState } from '@/hooks/use-global-state';\n\nimport styles from './index.module.less';\n\nconst MAX_LIMIT = 1000;\n\nconst RenderCustomOption = item => {\n  if (!item) {\n    return null;\n  }\n  return (\n    <Select.Option\n      value={item.value}\n      showTick={true}\n      key={item.value}\n      className={styles['bot-option']}\n    >\n      <div className=\"flex\" style={{ width: '100%' }}>\n        <div className=\"flex\" style={{ flexGrow: 1, flexShrink: 1, width: 0 }}>\n          <Typography.Text\n            ellipsis={{ showTooltip: true }}\n            style={{\n              fontSize: 12,\n              color: '#1D1C23',\n              fontWeight: 400,\n            }}\n          >\n            {item.label}\n          </Typography.Text>\n        </div>\n      </div>\n    </Select.Option>\n  );\n};\nexport type ConversationSelectProps = {\n  enableTypes?: Array<'static' | 'dynamic'>;\n  value?: string;\n  onChange?: (value: string) => void;\n} & Pick<\n  SelectProps,\n  'size' | 'disabled' | 'className' | 'onBlur' | 'defaultValue'\n>;\n\ninterface ConversationItem {\n  value: string;\n  label: string;\n  conversationId: string;\n}\n\n/**\n * Derived from @/components/conversation-select/conversations.tsx changed the value to conversation_name instead of unique_id\n */\nexport const ConversationSelect: React.FC<ConversationSelectProps> = ({\n  enableTypes = ['static', 'dynamic'],\n  // value,\n  onChange,\n  ...props\n}) => {\n  const globalState = useGlobalState();\n  const DebounceTime = 500;\n\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [search, setSearch] = useState<string>('');\n  const [staticList, setStaticList] = useState<ConversationItem[]>([]);\n  const [dynamicList, setDynamicList] = useState<ConversationItem[]>([]);\n  const { projectId = '', spaceId, projectCommitVersion } = globalState;\n\n  // The total number obtained by the interface is not the real total, and the front end may splice options.\n  const listMaxHeight = useMemo(() => {\n    const realTotal = staticList?.length + dynamicList?.length;\n    // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n    return realTotal < 7 ? realTotal * 32 : 208;\n  }, [staticList, dynamicList]);\n\n  useEffect(() => {\n    !props.disabled && fetchList();\n  }, [projectId, props.disabled]);\n\n  const fetchList = async (query?: string) => {\n    setIsLoading(true);\n\n    if (enableTypes.includes('static')) {\n      const staticListRes = await workflowApi.ListProjectConversationDef({\n        space_id: spaceId,\n        project_id: projectId,\n        project_version: projectCommitVersion,\n        create_method: CreateMethod.ManualCreate,\n        create_env: CreateEnv.Draft,\n        nameLike: query ?? search,\n        limit: MAX_LIMIT,\n      });\n      setStaticList(\n        staticListRes.data?.map(item => ({\n          value: item.conversation_name || '',\n          label: item.conversation_name || '',\n          conversationId: item.conversation_id || '',\n        })) || [],\n      );\n    }\n    if (enableTypes.includes('dynamic')) {\n      const dynamicListRes = await workflowApi.ListProjectConversationDef({\n        space_id: globalState.spaceId || '',\n        project_id: projectId,\n        project_version: projectCommitVersion,\n        create_method: CreateMethod.NodeCreate,\n        create_env: CreateEnv.Draft,\n        nameLike: query ?? search,\n        limit: MAX_LIMIT,\n      });\n      setDynamicList(\n        dynamicListRes.data?.map(item => ({\n          value: item.conversation_name || '',\n          label: item.conversation_name || '',\n          conversationId: item.conversation_id || '',\n        })) || [],\n      );\n    }\n    setIsLoading(false);\n  };\n\n  const handleSearch = query => {\n    setSearch(query);\n    fetchList(query);\n  };\n\n  return (\n    <Select\n      // value={value}\n      dropdownClassName={styles.dropdown}\n      filter\n      remote\n      placeholder={I18n.t('wf_chatflow_114')}\n      emptyContent={I18n.t('wf_chatflow_115')}\n      onSearch={debounce(handleSearch, DebounceTime)}\n      prefix={<IconSearch />}\n      loading={isLoading}\n      style={{ width: '100%' }}\n      virtualize={{\n        height: listMaxHeight,\n        width: '100%',\n        itemSize: 32,\n      }}\n      onChange={newValue => {\n        const findItem = [...staticList, ...dynamicList].find(\n          item => item.value === newValue,\n        );\n        onChange?.(findItem?.value as string);\n      }}\n      {...props}\n    >\n      <Select.OptGroup\n        key={Number(new Date())}\n        label={I18n.t('wf_chatflow_103')}\n      >\n        {staticList.map(item => RenderCustomOption(item))}\n      </Select.OptGroup>\n      <Select.OptGroup\n        key={Number(new Date())}\n        label={I18n.t('wf_chatflow_43')}\n      >\n        {dynamicList.map(item => RenderCustomOption(item))}\n      </Select.OptGroup>\n    </Select>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DatePicker } from '@coze-arch/coze-design';\n\nimport { type DefaultValueInputProps } from './types';\n\nexport function InputTime({\n  defaultValue,\n  className,\n  disabled,\n  onBlur,\n}: DefaultValueInputProps) {\n  defaultValue =\n    typeof defaultValue === 'string' &&\n    /^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}$/.test(defaultValue)\n      ? defaultValue\n      : '';\n\n  return (\n    <DatePicker\n      className={`${className} rounded-[8px]`}\n      inputStyle={{ width: '100%' }}\n      type=\"dateTime\"\n      size=\"small\"\n      defaultValue={defaultValue}\n      disabled={disabled}\n      format=\"yyyy-MM-dd HH:mm:ss\"\n      onChange={(date, dateString) => {\n        // onBlur will only trigger the save.\n        if (typeof dateString === 'string' || dateString === undefined) {\n          onBlur?.(dateString);\n        }\n      }}\n      onClear={() => {\n        onBlur?.('');\n      }}\n      showClear={true}\n    />\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type FC, useMemo, useRef } from 'react';\n\nimport { ViewVariableType, CONVERSATION_NAME } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  Input as InputCore,\n  CozInputNumber,\n  Select,\n} from '@coze-arch/coze-design';\n\nimport { getAccept } from '@/hooks/use-upload';\nimport { useGlobalState } from '@/hooks/use-global-state';\nimport { genFileTypeByViewVarType } from '@/components/test-run/utils/common';\nimport { JsonEditorAdapter } from '@/components/test-run/test-form-materials/json-editor';\nimport { FileAdapter } from '@/components/test-run/test-form-materials/file';\n\nimport { ConversationSelect as ConversationSelectCore } from '../conversation-select';\nimport { type TreeNodeCustomData, type DefaultValueType } from '../../type';\nimport {\n  type DefaultValueInputComponent,\n  type DefaultValueInputProps,\n} from './types';\nimport { InputTime } from './input-time';\n\nimport styles from './index.module.less';\n\nconst Input: DefaultValueInputComponent = ({\n  data,\n  onChange,\n  defaultValue,\n  onBlur,\n  ...props\n}) => (\n  <InputCore\n    defaultValue={defaultValue as string}\n    onChange={onChange}\n    size=\"small\"\n    placeholder={I18n.t('wf_chatflow_99')}\n    onBlur={e => {\n      onBlur?.(e.target.value);\n    }}\n    {...props}\n  />\n);\n\nconst InputNumber: DefaultValueInputComponent = ({\n  data,\n  onChange,\n  onBlur,\n  defaultValue,\n  ...props\n}) => (\n  <CozInputNumber\n    defaultValue={defaultValue as number}\n    onChange={onChange}\n    size=\"small\"\n    placeholder={I18n.t('wf_chatflow_99')}\n    onBlur={e => {\n      onBlur?.(e.target.value);\n    }}\n    {...props}\n  />\n);\n\nconst InputInteger: DefaultValueInputComponent = ({\n  data,\n  onChange,\n  onBlur,\n  defaultValue,\n  ...props\n}) => (\n  <CozInputNumber\n    defaultValue={defaultValue as number}\n    onChange={onChange}\n    precision={0.1}\n    size=\"small\"\n    placeholder={I18n.t('wf_chatflow_99')}\n    onBlur={e => {\n      // Get the rounded value\n      setTimeout(() => {\n        onBlur?.(e.target.value);\n      }, 15);\n    }}\n    {...props}\n  />\n);\n\nconst BooleanSelect: DefaultValueInputComponent = ({\n  data,\n  onChange,\n  defaultValue,\n  onBlur,\n  ...props\n}) => {\n  const valueRef = useRef(defaultValue as boolean | undefined | null);\n  const handleChange = val => {\n    if (val) {\n      const parsed = JSON.parse(val || 'false') as boolean;\n      onChange(parsed);\n      valueRef.current = parsed;\n    } else {\n      onChange(null);\n      valueRef.current = null;\n    }\n  };\n  return (\n    <Select\n      placeholder={I18n.t('wf_chatflow_99')}\n      size=\"small\"\n      optionList={[\n        {\n          label: 'true',\n          value: 'true',\n        },\n        {\n          label: 'false',\n          value: 'false',\n        },\n      ]}\n      showClear\n      defaultValue={\n        defaultValue !== undefined\n          ? JSON.stringify(Boolean(defaultValue))\n          : undefined\n      }\n      onChange={handleChange}\n      onBlur={() => onBlur?.(valueRef.current)}\n      {...props}\n    />\n  );\n};\n\nconst JSONEditor: DefaultValueInputComponent = ({\n  data,\n  onChange,\n  onBlur,\n  defaultValue,\n  ...props\n}) => {\n  const valueRef = useRef(defaultValue as string | undefined);\n  return (\n    <JsonEditorAdapter\n      value={defaultValue as string}\n      onChange={v => {\n        valueRef.current = v;\n        onChange(v || null);\n      }}\n      onBlur={() => {\n        onBlur?.(valueRef.current);\n      }}\n      {...props}\n    />\n  );\n};\nconst File: DefaultValueInputComponent = ({\n  defaultValue,\n  data: { type },\n  onChange,\n  onBlur,\n  inputType,\n  onInputTypeChange,\n  ...props\n}) => {\n  const valueRef = useRef(defaultValue as DefaultValueType | null);\n  const handleChange = (val?: string) => {\n    onChange(val || null);\n    valueRef.current = val || null;\n    onBlur?.(valueRef.current);\n  };\n  const accept = getAccept(type);\n  const multiple = ViewVariableType.isArrayType(type);\n  return (\n    <FileAdapter\n      value={defaultValue as string}\n      onChange={handleChange}\n      accept={accept}\n      multiple={multiple}\n      fileType={genFileTypeByViewVarType(type)}\n      containerClassName={styles['expand-content-file-adapter']}\n      onBlur={() => {\n        onBlur?.(valueRef.current);\n      }}\n      fileInputType={inputType}\n      onInputTypeChange={onInputTypeChange}\n      inputTypeSelectClassName={styles['file-type-select']}\n      inputURLClassName={styles['url-input']}\n      enableInputURL={true}\n      {...props}\n    />\n  );\n};\n\nconst ConversationSelect: DefaultValueInputComponent = ({\n  defaultValue,\n  onChange,\n  disabled,\n  className,\n  onBlur,\n}) => {\n  const valueRef = useRef(defaultValue as string | undefined | null);\n  const handleChange = val => {\n    onChange(val || null);\n    valueRef.current = val || null;\n  };\n  const { projectId } = useGlobalState();\n  return (\n    <ConversationSelectCore\n      className={className}\n      size=\"small\"\n      disabled={disabled || !projectId}\n      defaultValue={defaultValue as string}\n      enableTypes={['static']}\n      onChange={handleChange}\n      onBlur={() => {\n        onBlur?.(valueRef.current);\n      }}\n    />\n  );\n};\n\nconst getInputComponent = (\n  data: TreeNodeCustomData,\n): DefaultValueInputComponent => {\n  if (\n    data.name === CONVERSATION_NAME &&\n    data.type === ViewVariableType.String &&\n    data.isPreset\n  ) {\n    return ConversationSelect;\n  }\n  switch (data.type) {\n    case ViewVariableType.String:\n      return Input;\n    case ViewVariableType.Number:\n      return InputNumber;\n    case ViewVariableType.Integer:\n      return InputInteger;\n    case ViewVariableType.Boolean:\n      return BooleanSelect;\n    case ViewVariableType.Time:\n      return InputTime;\n    default:\n      break;\n  }\n  if (ViewVariableType.isFileType(data.type)) {\n    return File;\n  } else {\n    // Object/Array < String > Array < Object > and other types\n    return JSONEditor;\n  }\n};\nexport const DefaultValueInput: FC<DefaultValueInputProps> = ({\n  data,\n  ...props\n}) => {\n  const InputComponent = useMemo(() => getInputComponent(data), [data.type]);\n  return (\n    <InputComponent defaultValue={data.defaultValue} data={data} {...props} />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport classNames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { Typography, Tooltip, TextArea } from '@coze-arch/coze-design';\n\nimport { ValidationErrorWrapper } from '@/form-extensions/components/validation/validation-error-wrapper';\n\nimport { type TreeNodeCustomData, type DefaultValueType } from '../../type';\nimport { DefaultValueInput } from './default-value-input';\n\nimport styles from './index.module.less';\ninterface ExpandContentProps {\n  data: TreeNodeCustomData;\n  disabled?: boolean;\n  hasObjectLike?: boolean;\n  withDefaultValue?: boolean;\n  withDescription?: boolean;\n  onDescChange: (desc: string) => void;\n  onDefaultValueChange: (defaultValue: DefaultValueType | null) => void;\n  defaultValueInputType?: string;\n  onDefaultValueInputTypeChange?: (v: string) => void;\n  className?: string;\n}\nexport const ExpandContent: FC<ExpandContentProps> = props => {\n  const {\n    data,\n    disabled,\n    onDescChange,\n    onDefaultValueChange,\n    defaultValueInputType,\n    onDefaultValueInputTypeChange,\n    withDescription = false,\n    withDefaultValue = false,\n    className,\n  } = props;\n\n  const disabledDesc = disabled || data.isPreset;\n  const descInput = (\n    <TextArea\n      className=\"field-input\"\n      autosize={{ minRows: 1, maxRows: 5 }}\n      disabled={disabledDesc}\n      defaultValue={data.description}\n      maxLength={disabledDesc ? undefined : 1000}\n      onBlur={e => {\n        onDescChange(e.target.value);\n      }}\n      placeholder={I18n.t('wf_chatflow_98')}\n    />\n  );\n  return (\n    <div className={classNames('w-full', className)}>\n      {withDefaultValue ? (\n        <div className=\"field\">\n          <div className=\"mt-2 mb-1\">\n            <Typography.Text className=\"coz-fg-secondary text-xs leading-4 font-medium\">\n              {I18n.t('wf_chatflow_96')}\n            </Typography.Text>\n          </div>\n          <div className={styles['field-content']}>\n            <ValidationErrorWrapper\n              path={`${data.field?.slice(\n                data.field.indexOf('['),\n              )}.defaultValue`}\n              className={styles.container}\n              errorCompClassName={'output-default-value-error-text'}\n            >\n              {options => (\n                <DefaultValueInput\n                  className={'field-input'}\n                  data={data}\n                  disabled={disabled}\n                  onBlur={val => {\n                    options.onBlur();\n                    if (val !== undefined) {\n                      onDefaultValueChange?.(val);\n                    }\n                  }}\n                  onChange={val => {\n                    options.onChange();\n                  }}\n                  inputType={defaultValueInputType}\n                  onInputTypeChange={onDefaultValueInputTypeChange}\n                />\n              )}\n            </ValidationErrorWrapper>\n          </div>\n        </div>\n      ) : null}\n      {withDescription ? (\n        <div className=\"field\">\n          <div className=\"mt-2 mb-1\">\n            <Typography.Text className=\"coz-fg-secondary text-xs leading-4 font-medium\">\n              {I18n.t('wf_chatflow_97')}\n            </Typography.Text>\n          </div>\n          <div className={styles['field-content']}>\n            {disabledDesc && data.description ? (\n              <Tooltip\n                wrapperClassName=\"w-full\"\n                content={data.description}\n                position=\"top\"\n              >\n                {descInput}\n              </Tooltip>\n            ) : (\n              descInput\n            )}\n          </div>\n        </div>\n      ) : null}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { IconCozExpand, IconCozMinimize } from '@coze-arch/coze-design/icons';\nimport { IconButton } from '@coze-arch/coze-design';\nexport const ExpandBtn = ({\n  onClick,\n  expand,\n}: {\n  onClick?: () => void;\n  expand?: boolean;\n}) => (\n  <div className=\"flex flex-row items-center self-stretch h-[24px]\">\n    <IconButton\n      className=\"!block\"\n      size=\"small\"\n      color={expand ? 'highlight' : 'secondary'}\n      onClick={() => onClick?.()}\n      icon={\n        expand ? (\n          <IconCozMinimize className=\"text-sm\" />\n        ) : (\n          <IconCozExpand className=\"text-sm\" />\n        )\n      }\n    />\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback, useRef, useState, useMemo } from 'react';\n\nimport isNumber from 'lodash-es/isNumber';\nimport classNames from 'classnames';\nimport { useMemoizedFn } from 'ahooks';\nimport {\n  VARIABLE_TYPE_ALIAS_MAP,\n  type ViewVariableType,\n} from '@coze-workflow/base';\nimport { IconCozInfoCircle } from '@coze-arch/coze-design/icons';\nimport { Tooltip } from '@coze-arch/coze-design';\nimport { type RenderFullLabelProps } from '@coze-arch/bot-semi/Tree';\n\nimport { LevelLine } from '@/form-extensions/components/level-line';\n\nimport { useColumnsStyle } from '../../hooks/use-columns-style';\nimport { TreeCollapseWidth } from '../../constants';\nimport { VariableTypeTag } from '../../../variable-type-tag';\nimport {\n  type TreeNodeCustomData,\n  type ActiveMultiInfo,\n  type DefaultValueType,\n} from './type';\nimport { ChangeMode, ObjectLikeTypes } from './constants';\nimport ParamType from './components/param-type';\nimport ParamRequired from './components/param-required';\nimport ParamOperator from './components/param-operator';\nimport ParamName from './components/param-name';\n// import ParamDescription from './components/param-description';\nimport { ExpandContent } from './components/expand-content';\nimport { ExpandBtn } from './components/expand-btn';\n\nimport styles from './index.module.less';\nexport interface CustomTreeNodeProps extends RenderFullLabelProps {\n  readonly?: boolean;\n  typeReadonly?: boolean;\n  needRenderAppendChild?: boolean;\n  onChange: (mode: ChangeMode, param: TreeNodeCustomData) => void;\n  hasObjectLike?: boolean;\n  // When the Description component is transformed into multiple rows, the first child below it needs to be recorded\n  onActiveMultiInfoChange?: (info: ActiveMultiInfo) => void;\n  activeMultiInfo?: ActiveMultiInfo;\n  withDescription?: boolean;\n  withRequired?: boolean;\n  /** Types not supported */\n  disabledTypes?: ViewVariableType[];\n  /** hidden type */\n  hiddenTypes?: ViewVariableType[];\n  disableDelete?: boolean;\n  disabled?: boolean;\n  couldCollapse?: boolean;\n  collapsed?: boolean;\n  onCollapse?: (collapsed: boolean) => void;\n  withDefaultValue?: boolean;\n  defaultExpand?: boolean;\n  columnsRatio?: string;\n  readonlyTooltip?: string;\n}\n\n// eslint-disable-next-line complexity\nexport default function CustomTreeNode(props: CustomTreeNodeProps) {\n  const {\n    data,\n    className,\n    level,\n    readonly = false,\n    typeReadonly = false,\n    onChange,\n    hasObjectLike,\n    // onActiveMultiInfoChange,\n    activeMultiInfo,\n    withDescription = false,\n    withRequired = false,\n    disabledTypes,\n    hiddenTypes,\n    disableDelete = false,\n    disabled = false,\n    couldCollapse = true,\n    collapsed = true,\n    onCollapse,\n    needRenderAppendChild = true,\n    withDefaultValue = false,\n    defaultExpand = false,\n    columnsRatio,\n    readonlyTooltip,\n  } = props;\n\n  // current value\n  const value = data as TreeNodeCustomData;\n  const treeNodeRef = useRef<HTMLDivElement>(null);\n  const columnsStyle = useColumnsStyle(columnsRatio, level);\n\n  // When deleting\n  const onDelete = () => {\n    onChange(ChangeMode.Delete, value);\n  };\n\n  // When adding a child\n  const onAppend = () => {\n    onChange(ChangeMode.Append, value);\n  };\n  // When switching types\n  const onSelectChange = (\n    val?: string | number | Array<unknown> | Record<string, unknown>,\n  ) => {\n    if (val === undefined) {\n      return;\n    }\n    if (isNumber(val)) {\n      const isObjectLike = ObjectLikeTypes.includes(val);\n      if (!isObjectLike) {\n        // If it is not a class Object, determine whether there are children. If so, delete it\n        if (value.children) {\n          delete value.children;\n        }\n      }\n\n      onChange(ChangeMode.Update, {\n        ...value,\n        defaultValue: undefined,\n        type: val,\n      });\n    }\n  };\n\n  // update name\n  const onNameChange = (name: string) => {\n    if (value.name === name) {\n      return;\n    }\n    onChange(ChangeMode.Update, { ...value, name });\n  };\n\n  // Update description\n  const onDescriptionChange = useCallback(\n    (description: string) => {\n      if (value.description === description) {\n        return;\n      }\n      if (description === '' && !value.description) {\n        return;\n      }\n      onChange(ChangeMode.Update, { ...value, description });\n    },\n    [onChange, value],\n  );\n\n  // Update default values\n  const onDefaultValueChange = useMemoizedFn(\n    (defaultValue: DefaultValueType | null) => {\n      if (value.defaultValue === defaultValue) {\n        return;\n      }\n      if (defaultValue === '' && !value.defaultValue) {\n        return;\n      }\n      onChange(ChangeMode.Update, { ...value, defaultValue });\n    },\n  );\n\n  // Default value, describes the expanded state, saved in the front end\n  const [expand, setExpand] = useState(defaultExpand);\n  // Default input type, state of front-end selection\n  const [defaultValueInputType, setDefaultValueInputType] = useState('');\n  // Is the update required?\n  const onRequiredChange = useCallback(\n    (required: boolean) => {\n      onChange(ChangeMode.Update, { ...value, required });\n    },\n    [onChange, value],\n  );\n\n  /**\n   * Description When the component converts single/multiple rows, the vertical line of the first child below it needs to be shortened/lengthened\n   */\n  // const onDescriptionLineChange = useCallback(\n  //   (type: DescriptionLine) => {\n  //     const errorDoms = treeNodeRef.current?.getElementsByClassName(\n  //       'output-param-name-error-text',\n  //     );\n\n  //     if (type === DescriptionLine.Multi && value.children?.[0]?.field) {\n  //       onActiveMultiInfoChange?.({\n  //         activeMultiKey: value.children[0].field,\n  //         withNameError: Boolean(errorDoms?.length || 0),\n  //         // withNameError: Boolean(nameError || ''),\n  //       });\n  //     } else {\n  //       onActiveMultiInfoChange?.({\n  //         activeMultiKey: '',\n  //       });\n  //     }\n  //   },\n  //   [onActiveMultiInfoChange, value],\n  // );\n\n  const onEnabledChange = useCallback(\n    (enabled: boolean) => {\n      onChange(ChangeMode.Update, { ...value, enabled });\n    },\n    [onChange, value],\n  );\n  const isPreset = value?.isPreset;\n\n  const _withDefaultValue = useMemo(\n    () => withDefaultValue && value.level === 0,\n    [value, withDefaultValue],\n  );\n  const withExpandContent = useMemo(\n    () => _withDefaultValue || withDescription,\n    [_withDefaultValue, withDescription],\n  );\n\n  const showExpandContent = useMemo(\n    () => expand && !readonly && withExpandContent,\n    [withExpandContent, expand, readonly],\n  );\n\n  const paramRow = !readonly ? (\n    <div\n      className={classNames({\n        [styles.wrapper]: true,\n        [styles['preset-enabled']]: isPreset && value?.enabled,\n        [styles['preset-disabled']]: isPreset && !value?.enabled,\n      })}\n    >\n      <ParamName\n        disabled={disabled || isPreset}\n        data={value}\n        onChange={onNameChange}\n        style={columnsStyle.name}\n      />\n      <ParamType\n        disabled={typeReadonly || disabled || isPreset}\n        data={value}\n        onSelectChange={onSelectChange}\n        level={level}\n        disabledTypes={disabledTypes}\n        hiddenTypes={hiddenTypes}\n        style={columnsStyle.type}\n      />\n      {/* {withDescription ? (\n        //Comment first, future responsive layouts will be saved future responsive layouts will be saved\n        // <ParamDescription\n        //   disabled={disabled || isPreset}\n        //   data={value}\n        //   onChange={onDescriptionChange}\n        //   onLineChange={onDescriptionLineChange}\n        //   hasObjectLike={hasObjectLike}\n        // />\n        <ParamDescPopover\n          disabled={disabled || isPreset}\n          data={value}\n          onChange={onDescriptionChange}\n          hasObjectLike={hasObjectLike}\n        />\n      ) : null} */}\n      {withRequired ? (\n        <ParamRequired\n          disabled={disabled || isPreset}\n          data={value}\n          onChange={onRequiredChange}\n        />\n      ) : null}\n      {withDefaultValue || withDescription ? (\n        <ExpandBtn onClick={() => setExpand(!expand)} expand={expand} />\n      ) : null}\n      <ParamOperator\n        data={value}\n        level={level}\n        onDelete={onDelete}\n        onAppend={onAppend}\n        disableDelete={disableDelete}\n        hasObjectLike={hasObjectLike}\n        needRenderAppendChild={needRenderAppendChild}\n        onEnabledChange={onEnabledChange}\n        disabled={disabled}\n      />\n    </div>\n  ) : (\n    <div className={styles['readonly-container']}>\n      <span className={styles.name}>{value.name || '-'}</span>\n      {readonlyTooltip ? (\n        <Tooltip content={readonlyTooltip}>\n          <IconCozInfoCircle className=\"text-xs ml-1 coz-fg-secondary\" />\n        </Tooltip>\n      ) : null}\n\n      <VariableTypeTag size=\"xs\">\n        {VARIABLE_TYPE_ALIAS_MAP[value.type] || '-'}\n      </VariableTypeTag>\n    </div>\n  );\n  return (\n    <div\n      className={classNames({\n        [className]: Boolean(className),\n        [styles['param-container']]: true,\n      })}\n      ref={treeNodeRef}\n    >\n      <LevelLine\n        level={level}\n        data={value}\n        collapsed={collapsed}\n        onCollapse={onCollapse}\n        couldCollapse={couldCollapse}\n        expandContentVisible={showExpandContent}\n        readonly={readonly}\n        multiInfo={{\n          multiline: activeMultiInfo?.activeMultiKey === value.field,\n          withNameError: activeMultiInfo?.withNameError,\n        }}\n      />\n      <div\n        className=\"w-full\"\n        style={{ paddingLeft: couldCollapse ? TreeCollapseWidth : 0 }}\n      >\n        <div\n          className={classNames({\n            [styles['expand-wrapper']]: true,\n            'flex-grow': !couldCollapse,\n            'coz-mg-secondary': showExpandContent,\n          })}\n        >\n          {paramRow}\n          {showExpandContent ? (\n            <ExpandContent\n              disabled={disabled}\n              data={value}\n              onDescChange={onDescriptionChange}\n              onDefaultValueChange={onDefaultValueChange}\n              onDefaultValueInputTypeChange={setDefaultValueInputType}\n              defaultValueInputType={defaultValueInputType}\n              hasObjectLike={hasObjectLike}\n              withDefaultValue={_withDefaultValue}\n              withDescription={withDescription}\n            />\n          ) : null}\n        </div>\n      </div>\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable max-lines */\n/* eslint-disable complexity */\n/* eslint-disable max-lines-per-function */\nimport React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n  type PropsWithChildren,\n} from 'react';\n\nimport { nanoid } from 'nanoid';\nimport cloneDeep from 'lodash-es/cloneDeep';\nimport classNames from 'classnames';\nimport { useLatest } from 'ahooks';\nimport { WorkflowBatchService } from '@coze-workflow/variable';\nimport {\n  ResponseFormat,\n  ViewVariableType,\n  type ViewVariableTreeNode,\n} from '@coze-workflow/base';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { type TreeNodeData, type TreeProps } from '@coze-arch/bot-semi/Tree';\nimport { Toast, Tree } from '@coze-arch/coze-design';\n\nimport { FormCard } from '../form-card';\nimport { AddItemButton } from '../add-item-button';\nimport {\n  findCustomTreeNodeDataResult,\n  formatTreeData,\n  traverse,\n} from './utils';\nimport { OutputTreeContextProvider } from './context';\nimport { TreeCollapseWidth } from './constants';\nimport { ResponseFormatSelect } from './components/response-format';\nimport { JSONImport, JSONImportPlaceholder } from './components/json-import';\nimport Header from './components/header';\nimport {\n  type ActiveMultiInfo,\n  type TreeNodeCustomData,\n} from './components/custom-tree-node/type';\nimport { ChangeMode } from './components/custom-tree-node/constants';\nimport CustomTreeNode from './components/custom-tree-node';\n\nimport styles from './index.module.less';\n\nexport interface SimpleTreeNodeCustomData {\n  key: string;\n}\n\nexport interface OutputTreeProps {\n  id: string;\n  testId?: string;\n  // Whether to allow new root nodes, the default is true\n  allowAppendRootData?: boolean;\n  // Is it allowed to delete the last piece of data?\n  allowDeleteLast?: boolean;\n  // Is it batch processing?\n  isBatch?: boolean;\n  treeProps?: TreeProps;\n  readonly?: boolean;\n  disabled?: boolean;\n  disabledTooltip?: string;\n  /** @default I18n.t('workflow_detail_node_output') */\n  title?: string;\n  /** @default title */\n  titleTooltip?: string;\n  className?: string;\n  style?: React.CSSProperties;\n  value: Array<TreeNodeCustomData>;\n  onChange: (value: Array<TreeNodeCustomData>) => void;\n  withDescription: boolean;\n  withRequired: boolean;\n  /** Types not supported */\n  disabledTypes?: ViewVariableType[];\n  /** hidden type */\n  hiddenTypes?: ViewVariableType[];\n  topLevelReadonly?: boolean;\n  emptyPlaceholder?: string;\n  responseFormat?: {\n    visible?: boolean;\n    value?: number;\n    readonly?: boolean;\n    onChange?: (value?: number) => void;\n  };\n  /** Default variable type */\n  defaultVariableType?: ViewVariableType;\n  jsonImport?: boolean;\n  noCard?: boolean;\n  addItemTitle?: string;\n  defaultCollapse?: boolean;\n\n  // Is the outermost output folded by default?\n  formCardDefaultCollapse?: boolean;\n  children?: React.ReactNode;\n  /**  You can still add children to a node preset */\n  needAppendChildWhenNodeIsPreset?: boolean;\n  maxLimit?: number;\n  /**\n   * Can the default value be configured, the default is false\n   */\n  withDefaultValue?: boolean;\n  /**\n   * Default expanded parameter name\n   */\n  defaultExpandParams?: string[];\n  /**\n   * Column widths such as 6:4 represent 6 copies of the name and 4 copies of the type\n   */\n  columnsRatio?: string;\n}\n\nconst getDefaultAppendValue = (\n  withRequired = false,\n  defaultVariableType = ViewVariableType.String,\n) => {\n  const defaultValue: {\n    fieldRandomKey: string;\n    type: ViewVariableType;\n    required?: boolean;\n  } = {\n    fieldRandomKey: nanoid(),\n    type: defaultVariableType,\n  };\n  if (withRequired) {\n    defaultValue.required = true;\n  }\n  return defaultValue;\n};\n\nfunction useExpandedKeys(keys: string[], defaultCollapse: boolean) {\n  const [expandedKeys, setExpandedKeys] = useState(defaultCollapse ? [] : keys);\n\n  const expandTreeNode = useCallback(\n    (key: string) => {\n      setExpandedKeys([...new Set([...expandedKeys, key])]);\n    },\n    [keys],\n  );\n\n  const collapseTreeNode = useCallback(\n    (key: string) => {\n      setExpandedKeys([\n        ...expandedKeys.filter(expandedKey => expandedKey !== key),\n      ]);\n    },\n    [keys],\n  );\n\n  return { expandedKeys, expandTreeNode, collapseTreeNode };\n}\n\nexport function OutputTree(props: PropsWithChildren<OutputTreeProps>) {\n  const {\n    id,\n    testId,\n    readonly = false,\n    isBatch = false,\n    disabled,\n    disabledTooltip,\n    children,\n    allowAppendRootData = true,\n    allowDeleteLast = false,\n    treeProps,\n    title = I18n.t('workflow_detail_node_output'),\n    titleTooltip = title,\n    className,\n    style,\n    value,\n    onChange,\n    withDescription = false,\n    withRequired = false,\n    disabledTypes = [],\n    hiddenTypes,\n    topLevelReadonly = false,\n    emptyPlaceholder,\n    responseFormat = {},\n    defaultVariableType = ViewVariableType.String,\n    jsonImport = true,\n    noCard = false,\n    addItemTitle = I18n.t('workflow_add_output'),\n    defaultCollapse = false,\n    formCardDefaultCollapse = false,\n    needAppendChildWhenNodeIsPreset = true,\n    maxLimit,\n    withDefaultValue,\n    defaultExpandParams = [],\n    columnsRatio,\n  } = props;\n\n  // Monitor for changes in this value\n  const cardRef = useRef<HTMLDivElement>(null);\n  const isValueEmpty = !value || value.length === 0;\n  const {\n    data: formattedTreeData = [],\n    hasObjectLike,\n    itemKeysWithChildren,\n  } = formatTreeData(cloneDeep(value), id);\n  const isDataEmpty = formattedTreeData.length === 0;\n  const { expandedKeys, expandTreeNode, collapseTreeNode } = useExpandedKeys(\n    itemKeysWithChildren,\n    defaultCollapse,\n  );\n\n  const disableAdd = useMemo(() => {\n    if (maxLimit === undefined) {\n      return false;\n    }\n    return (value?.length ?? 0) >= maxLimit;\n  }, [value, maxLimit]);\n\n  /**\n   * The description of the parent node of which row is currently in a multi-row state (LLM node)\n   * For rendering tree vertical lines, the next vertical line in multiple lines of text should be extended\n   * If the param name has an error message, the vertical bar extends below the error message and the length changes\n   */\n  const [activeMultiInfo, setActiveMultiInfo] = useState<ActiveMultiInfo>({\n    activeMultiKey: '',\n  });\n\n  const { concatTestId } = useNodeTestId();\n\n  const onAdd = () => {\n    if (onChange) {\n      onChange(\n        (formattedTreeData || []).concat({\n          ...getDefaultAppendValue(withRequired, defaultVariableType),\n          // Add field\n          field: `[${formattedTreeData.length}]`,\n          // At this time, there is no need to specify the type, so as as is used to cancel the type and report an error.\n        } as unknown as TreeNodeCustomData),\n      );\n    }\n  };\n\n  // How to change this component\n  const onValueChange = (freshValue?: Array<TreeNodeCustomData>) => {\n    if (onChange) {\n      freshValue = (freshValue || []).concat([]);\n      // Clean up useless fields\n      traverse<TreeNodeCustomData>(freshValue, node => {\n        const {\n          key,\n          name,\n          type,\n          description,\n          required,\n          // eslint-disable-next-line @typescript-eslint/no-shadow\n          children,\n          isPreset,\n          enabled,\n          readonly: _readonly,\n          defaultValue,\n        } = node;\n        // eslint-disable-next-line guard-for-in\n        for (const prop in node) {\n          delete node[prop];\n        }\n        node.key = key || nanoid();\n        node.name = name;\n        node.type = type;\n        node.description = description;\n        if (defaultValue !== null) {\n          node.defaultValue = defaultValue;\n        }\n        if (isPreset) {\n          node.isPreset = isPreset;\n          node.enabled = enabled || false;\n        }\n\n        if (withRequired) {\n          node.required = required || false; // Undefined to false\n        }\n\n        if (children) {\n          node.children = children;\n        }\n\n        if (_readonly) {\n          node.readonly = _readonly;\n        }\n      });\n      onChange(freshValue);\n    }\n  };\n\n  // Tree node change method\n  const onTreeNodeChange = (mode: ChangeMode, param: TreeNodeCustomData) => {\n    // Clone one first, because the Tree will execute isEqual on treeData, cloning one must be false.\n    const cloneDeepTreeData = cloneDeep(\n      formattedTreeData,\n    ) as Array<TreeNodeCustomData>;\n\n    const findResult = findCustomTreeNodeDataResult(\n      cloneDeepTreeData,\n      param.field as string,\n    );\n\n    if (findResult) {\n      switch (mode) {\n        case ChangeMode.Append: {\n          // You can't use parentData as a standard for adding, you need to add it under the current data.\n          const { data } = findResult;\n          const currentChildren = data.children || [];\n          // @ts-expect-error Some values do not need to be specified at this time because format is executed during rerender\n          data.children = currentChildren.concat({\n            ...getDefaultAppendValue(false, defaultVariableType),\n            // Add field\n            field: `${data.field}.children[${currentChildren.length}]`,\n          });\n          onValueChange(cloneDeepTreeData);\n\n          // Add a new node under the current node and expand the current node\n          if (findResult?.data?.key) {\n            expandTreeNode(findResult.data.key);\n          }\n\n          break;\n        }\n        case ChangeMode.Update: {\n          const targetArray = findResult.isRoot\n            ? cloneDeepTreeData\n            : findResult.parentData?.children;\n          const index = targetArray?.findIndex(item => item.key === param.key);\n\n          if (index !== undefined) {\n            targetArray?.splice(index, 1, param);\n            onValueChange(cloneDeepTreeData);\n          }\n          break;\n        }\n        case ChangeMode.Delete: {\n          if (findResult.isRoot) {\n            const freshValue = (cloneDeepTreeData || []).filter(\n              item => item.key !== param.key,\n            );\n            onValueChange(freshValue);\n          } else {\n            const parentData = findResult.parentData as TreeNodeData;\n            parentData.children = (parentData.children || []).filter(\n              item => item.key !== param.key,\n            );\n            onValueChange(cloneDeepTreeData);\n          }\n          break;\n        }\n        case ChangeMode.DeleteChildren: {\n          const { data } = findResult;\n          data.children = [];\n          onValueChange(cloneDeepTreeData);\n          break;\n        }\n        default:\n      }\n    } else {\n      Toast.error(I18n.t('workflow_detail_node_output_parsingfailed'));\n    }\n  };\n\n  const onJSONImportChange = (freshValue?: Array<TreeNodeCustomData>) => {\n    const nextValue: Array<TreeNodeCustomData> = [];\n    value\n      .filter(item => item.isPreset)\n      .forEach(item => {\n        const matched = (freshValue || []).find(it => it.name === item.name);\n        if (matched) {\n          nextValue.push({\n            ...item,\n            enabled: true,\n          });\n        } else {\n          nextValue.push(item);\n        }\n      });\n\n    (freshValue || []).forEach(item => {\n      const matched = value.find(it => it.isPreset && it.name === item.name);\n      if (!matched) {\n        nextValue.push(item);\n      }\n    });\n\n    onChange(\n      maxLimit === undefined ? nextValue : nextValue?.slice(0, maxLimit),\n    );\n  };\n\n  const onlyString = useMemo(\n    () =>\n      ([ResponseFormat.Text, ResponseFormat.Markdown] as number[]).includes(\n        responseFormat?.value ?? ResponseFormat.JSON,\n      ),\n    [responseFormat.value],\n  );\n\n  const latestValue = useLatest(value);\n  const responseFormatValue = useRef(-1);\n  useEffect(() => {\n    const isUserChangeType =\n      responseFormatValue.current !== -1 &&\n      responseFormatValue.current !== responseFormat.value;\n\n    if (responseFormat.value !== undefined) {\n      responseFormatValue.current = responseFormat.value;\n    }\n\n    // If you switch to text mode\n    if (onlyString && isUserChangeType) {\n      let newValue = [\n        {\n          key: nanoid(),\n          name: 'output',\n          type: ViewVariableType.String,\n        },\n      ] as TreeNodeCustomData[];\n\n      const _value = latestValue.current;\n      if (isBatch) {\n        newValue = WorkflowBatchService.singleOutputMetasToList(\n          newValue as ViewVariableTreeNode[],\n        ) as TreeNodeCustomData[];\n        // If there is a value in itself, take the first one, expect: reuse variable name/description\n        if (_value?.[0]) {\n          newValue = [_value[0]];\n        }\n        if (_value?.[0].children?.[0]) {\n          const [first, ...rest] = _value[0].children;\n          newValue[0].children = [first, ...rest.filter(c => c?.readonly)];\n        }\n        // Modify type to string only\n        if (\n          newValue?.[0].children?.[0].type &&\n          newValue?.[0].children?.[0].type !== ViewVariableType.String\n        ) {\n          newValue[0].children[0].type = ViewVariableType.String;\n\n          // Remove children\n          if (newValue[0].children[0].children) {\n            delete newValue[0].children[0].children;\n          }\n        }\n      } else {\n        // If there is a value in itself, take the first one, expect: reuse variable name/description\n        if (_value?.[0]) {\n          const [first, ...rest] = _value;\n          newValue = [first, ...rest.filter(c => c?.readonly)];\n        }\n        // Modify type to string only\n        if (newValue[0].type !== ViewVariableType.String) {\n          newValue[0].type = ViewVariableType.String;\n\n          // Remove children\n          if (newValue[0].children) {\n            delete newValue[0].children;\n          }\n        }\n      }\n      onChange(newValue);\n    }\n  }, [responseFormat.value]);\n\n  if (readonly && isValueEmpty) {\n    return null;\n  }\n\n  const Card = noCard ? React.Fragment : FormCard;\n  const showAddButton =\n    !readonly &&\n    !topLevelReadonly &&\n    allowAppendRootData &&\n    !onlyString &&\n    !disableAdd;\n  return (\n    <OutputTreeContextProvider value={{ testId }}>\n      <div\n        className={classNames({\n          [styles.container]: true,\n          [styles['not-readonly']]: !readonly,\n          [className || '']: Boolean(className),\n          [styles['could-collapse']]: itemKeysWithChildren.length > 0,\n        })}\n        style={style}\n        ref={cardRef}\n      >\n        <Card\n          autoExpandWhenDomChange\n          defaultExpand={!formCardDefaultCollapse}\n          showBottomBorder\n          header={title}\n          tooltip={titleTooltip}\n          contentClassName=\"nowheel\"\n          noPadding\n          testId={testId}\n          actionButton={\n            <div className=\"flex gap-[4px] items-center\">\n              {responseFormat.visible ? (\n                <ResponseFormatSelect\n                  testId={concatTestId(testId ?? '', 'json-format')}\n                  readonly={readonly || responseFormat.readonly}\n                  value={responseFormat.value}\n                  outputValue={value}\n                  onlyString={onlyString}\n                  onChange={onChange}\n                  onResponseFormatChange={responseFormat.onChange}\n                  isBatch={isBatch}\n                />\n              ) : undefined}\n              {!readonly &&\n              !topLevelReadonly &&\n              allowAppendRootData &&\n              !onlyString ? (\n                <>\n                  <JSONImportPlaceholder\n                    enable={jsonImport}\n                    hideAddButton={isBatch || !!disabled}\n                  />\n                </>\n              ) : null}\n            </div>\n          }\n        >\n          {!isDataEmpty && (\n            <Header\n              readonly={readonly}\n              config={{\n                hasObjectLike,\n                hasCollapse: itemKeysWithChildren.length > 0,\n                hasDescription: withDescription,\n                hasRequired: withRequired,\n              }}\n              columnsRatio={columnsRatio}\n            />\n          )}\n          <Tree\n            expandAll={!readonly}\n            style={readonly ? {} : { overflow: 'inherit' }}\n            motion={false}\n            disabled={disabled}\n            className={classNames({\n              [styles.content]: true,\n              [styles.readonly]: readonly,\n              [styles['content-fix-pop-container']]: !readonly,\n            })}\n            renderFullLabel={renderFullLabelProps => {\n              const { level, data } = renderFullLabelProps;\n              const isTopLevel = level === 0;\n              const isSecondLevel = level === 1;\n              // Planting the errorbody\n              const isOnlyOneData = value.filter(v => !v.readonly).length <= 1;\n\n              const currentLevelDisabled =\n                Boolean(isTopLevel && (isBatch || topLevelReadonly)) ||\n                disabled;\n\n              const disableDelete = (() => {\n                // When disabled, deletion is not allowed\n                if (currentLevelDisabled) {\n                  return true;\n                }\n                // If there is only one non-read-only data\n                if (isOnlyOneData) {\n                  if (isTopLevel && !allowDeleteLast) {\n                    // And it is the top-level data, and the last piece of data is not allowed to be deleted. It cannot be deleted.\n                    return true;\n                  }\n                  // @Tips hack logic. When batch processing is changed to single processing, the outermost structure will be deleted. You must ensure that children are not empty data.\n                  // At this time, there is only one piece of data, and it is in batch mode, and it is currently the second layer of data, and there is only one piece of second-layer non-read-only data.\n                  // It cannot be deleted at this time.\n                  if (\n                    isBatch &&\n                    isSecondLevel &&\n                    (value.at(0)?.children || []).filter(v => !v.readonly)\n                      .length <= 1\n                  ) {\n                    return true;\n                  }\n                }\n                return false;\n              })();\n\n              const onCollapse = (collapsed: boolean) => {\n                const { key } = renderFullLabelProps.data;\n\n                if (!key) {\n                  return;\n                }\n\n                if (collapsed) {\n                  expandTreeNode(key);\n                } else {\n                  collapseTreeNode(key);\n                }\n              };\n\n              return (\n                <CustomTreeNode\n                  {...renderFullLabelProps}\n                  readonly={data.readonly || readonly}\n                  typeReadonly={onlyString}\n                  needRenderAppendChild={\n                    data.isPreset\n                      ? !onlyString && needAppendChildWhenNodeIsPreset\n                      : !onlyString\n                  }\n                  onChange={onTreeNodeChange}\n                  hasObjectLike={hasObjectLike}\n                  onActiveMultiInfoChange={setActiveMultiInfo}\n                  activeMultiInfo={activeMultiInfo}\n                  withDescription={withDescription}\n                  withRequired={withRequired}\n                  withDefaultValue={withDefaultValue}\n                  disabledTypes={disabledTypes}\n                  hiddenTypes={hiddenTypes}\n                  disableDelete={disableDelete}\n                  disabled={currentLevelDisabled}\n                  couldCollapse={itemKeysWithChildren.length > 0}\n                  collapsed={renderFullLabelProps.expandStatus.expanded}\n                  onCollapse={onCollapse}\n                  defaultExpand={defaultExpandParams?.includes(data.name)}\n                  columnsRatio={columnsRatio}\n                  readonlyTooltip={data.readonlyTooltip}\n                />\n              );\n            }}\n            emptyContent={\n              emptyPlaceholder && (\n                <p className={styles.emptyPlaceholder}>{emptyPlaceholder}</p>\n              )\n            }\n            expandedKeys={[...expandedKeys, nanoid()]} // The nanoid is added to prevent the internal memo state of the component from causing out of sync, and force a recalculation of the hidden state\n            treeData={formattedTreeData}\n            {...treeProps}\n          />\n          {showAddButton ? (\n            <AddItemButton\n              className=\"absolute right-0 top-0\"\n              // Solve the problem that onClick does not trigger due to Button displacement\n              onMouseDown={onAdd}\n              disabled={isBatch || disabled}\n              disabledTooltip={disabledTooltip}\n              testId={concatTestId(testId ?? '', 'add-output-item')}\n              style={{\n                marginLeft:\n                  itemKeysWithChildren.length > 0 ? TreeCollapseWidth : 0,\n              }}\n              title={addItemTitle}\n            />\n          ) : null}\n          {children}\n        </Card>\n        {disableAdd ? null : (\n          <JSONImport\n            startField={id}\n            testId={concatTestId(testId ?? '', 'json-import-btn')}\n            onChange={onJSONImportChange}\n            treeData={formattedTreeData}\n            disabledTypes={disabledTypes}\n            disabledTooltip={disabledTooltip}\n            hideAddButton={isBatch || !!disabled}\n            rules={{\n              jsonImport,\n              readonly,\n              topLevelReadonly,\n              disabled: Boolean(disabled),\n              isBatch,\n              withRequired,\n              onlyString,\n            }}\n          />\n        )}\n      </div>\n    </OutputTreeContextProvider>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozSetting,\n  IconCozInfoCircle,\n} from '@coze-arch/coze-design/icons';\nimport {\n  IconButton,\n  Tooltip,\n  Typography,\n  Popover,\n} from '@coze-arch/coze-design';\n\nimport { SliderWithInput } from '../slider-with-input';\n\nconst { Title } = Typography;\n\nexport const QuestionLimit = props => {\n  const { value, onChange, readonly } = props;\n\n  const { getNodeSetterId } = useNodeTestId();\n\n  const label = I18n.t(\n    'workflow_ques_ans_type_direct_exrtact_title',\n    {},\n    \"Extract variables from user's response.\",\n  );\n\n  return (\n    <div className=\"flex w-full justify-between mb-2\">\n      <Typography.Text\n        className=\"mr-[6px] text-xs\"\n        ellipsis={{\n          showTooltip: {\n            opts: {\n              content: label,\n            },\n          },\n        }}\n        style={{ maxWidth: 'calc(100% - 24px)', color: '#1C1F23' }}\n      >\n        {label}\n      </Typography.Text>\n      <Popover\n        autoAdjustOverflow={false}\n        className=\"rounded-md\"\n        trigger=\"click\"\n        position=\"bottomRight\"\n        content={\n          <div className=\"p-6\">\n            <div className=\"flex items-center\">\n              <Title heading={5}>\n                {I18n.t(\n                  'workflow_ques_ans_type_direct_exrtact_context_setting',\n                  {},\n                  'Maximum dialogue rounds',\n                )}\n              </Title>\n              <Tooltip\n                content={I18n.t(\n                  'workflow_ques_ans_type_direct_context_setting_tooltips',\n                  {},\n                  ',,Token',\n                )}\n              >\n                <IconCozInfoCircle className=\"text-[#A7A9B0] text-xs ml-1\" />\n              </Tooltip>\n            </div>\n            <SliderWithInput\n              readonly={readonly}\n              value={value}\n              onChange={onChange}\n              max={5}\n              min={1}\n            />\n          </div>\n        }\n      >\n        <IconButton\n          size=\"small\"\n          color=\"secondary\"\n          data-testid={getNodeSetterId('question-limit-setting')}\n          wrapperClass=\"flex justify-end\"\n          icon={<IconCozSetting />}\n        />\n      </Popover>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useMemo } from 'react';\n\nimport classNames from 'classnames';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { Tooltip, RadioGroup, Radio as RadioUI } from '@coze-arch/coze-design';\nimport type {\n  OptionItem,\n  RadioChangeEvent,\n  RadioType,\n} from '@coze-arch/bot-semi/Radio';\nimport { IconInfo } from '@coze-arch/bot-icons';\nimport type {\n  SetterComponentProps,\n  SetterOrDecoratorContext,\n} from '@flowgram-adapter/free-layout-editor';\n\nimport styles from './index.module.less';\n\ntype RadioItem = OptionItem & {\n  disabled?: boolean | ((context: SetterOrDecoratorContext) => boolean);\n  tooltip?: React.ReactNode;\n};\n\nexport type RadioProps = SetterComponentProps<\n  string | number | undefined,\n  {\n    mode: RadioType;\n    options: RadioItem[];\n    direction?: 'vertical' | 'horizontal';\n    customClassName?: string;\n    radioCardClassName?: string;\n    // Ignore readonly state, force interactivity\n    ignoreReadonly?: boolean;\n    disabled?: boolean;\n  }\n>;\n\nexport const Radio = props => {\n  const { value, onChange, options, readonly: _readonly, context } = props;\n\n  const {\n    options: selectOptions = [],\n    mode = 'button',\n    ignoreReadonly,\n    disabled,\n  } = options;\n\n  const readonly = ignoreReadonly ? false : _readonly;\n\n  const { getNodeSetterId, concatTestId } = useNodeTestId();\n\n  const uiOptions = useMemo(\n    () =>\n      selectOptions.map(item => {\n        const isItemDisabled = (optionItem: RadioItem) => {\n          const disabledItem:\n            | boolean\n            | ((context: SetterOrDecoratorContext) => boolean) =\n            optionItem.disabled ?? false;\n          if (typeof disabledItem === 'boolean') {\n            return disabledItem;\n          } else if (typeof disabledItem === 'function') {\n            return disabledItem(context);\n          }\n          return false;\n        };\n        return (\n          <RadioUI\n            className={classNames({\n              'border-[#1C1F23]/[8%]': mode === 'card' && item.value !== value,\n              'bg-[--semi-color-bg-0]': mode === 'card' && item.value !== value,\n              [options?.radioCardClassName as string]:\n                options?.radioCardClassName,\n            })}\n            key={item.value}\n            value={item.value}\n            disabled={isItemDisabled(item)}\n            data-testid={concatTestId(\n              getNodeSetterId(context.meta.name),\n              `${item.value}`,\n            )}\n          >\n            {item.label}\n            {item?.tooltip ? (\n              <Tooltip content={item?.tooltip}>\n                <IconInfo className=\"text-[#06070980] ml-[5px]\" />\n              </Tooltip>\n            ) : null}\n          </RadioUI>\n        );\n      }),\n    [selectOptions],\n  );\n\n  return (\n    <RadioGroup\n      disabled={readonly || disabled}\n      className={classNames({\n        [styles.workflowNodeSetterRadio]: true,\n        [options?.customClassName as string]: options?.customClassName,\n      })}\n      type={mode}\n      value={value}\n      onChange={onChange as unknown as (event: RadioChangeEvent) => void}\n      direction={options?.direction ?? 'horizontal'}\n    >\n      {uiOptions}\n    </RadioGroup>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/naming-convention */\nimport {\n  ViewVariableType,\n  type ViewVariableTreeNode,\n} from '@coze-workflow/base';\n\n// Different types of meta generate default values for JSON\nconst getDefaultValue = (type: ViewVariableType) => {\n  let rs;\n  switch (type) {\n    case ViewVariableType.String:\n      rs = '';\n      break;\n    case ViewVariableType.Integer:\n      rs = 0;\n      break;\n    case ViewVariableType.Boolean:\n      rs = false;\n      break;\n    case ViewVariableType.Number:\n      rs = 0;\n      break;\n    case ViewVariableType.ArrayString:\n      rs = [];\n      break;\n    case ViewVariableType.ArrayInteger:\n      rs = [];\n      break;\n    case ViewVariableType.ArrayBoolean:\n      rs = [];\n      break;\n    case ViewVariableType.ArrayNumber:\n      rs = [];\n      break;\n    case ViewVariableType.ArrayObject:\n      rs = [{}];\n      break;\n    case ViewVariableType.Image:\n      rs = '';\n      break;\n    case ViewVariableType.ArrayImage:\n      rs = [];\n      break;\n    case ViewVariableType.Object:\n      rs = {};\n      break;\n    default:\n      rs = '';\n      break;\n  }\n  return rs;\n};\n// {\n//   [ViewVariableType.String]: '',\n//   [ViewVariableType.Integer]: 0,\n//   [ViewVariableType.Boolean]: false,\n//   [ViewVariableType.Number]: 0,\n//   [ViewVariableType.ArrayString]: [],\n//   [ViewVariableType.ArrayInteger]: [],\n//   [ViewVariableType.ArrayBoolean]: [],\n//   [ViewVariableType.ArrayNumber]: [],\n//   [ViewVariableType.ArrayObject]: [{}],\n//   [ViewVariableType.Object]: {},\n//   [ViewVariableType.Image]: '',\n//   [ViewVariableType.ArrayImage]: [],\n// };\n\n// Generate default json according to meta\nexport const metaToJSON = (meta: ViewVariableTreeNode, obj?: object) => {\n  const { type, name, children } = meta;\n  if (!obj) {\n    obj = {};\n  }\n\n  if (type === ViewVariableType.Object) {\n    const subObj = {};\n    obj[name] = subObj;\n    children?.forEach(c => {\n      metaToJSON(c, subObj);\n    });\n  } else if (type === ViewVariableType.ArrayObject) {\n    const subObj = {};\n    obj[name] = [subObj];\n    children?.forEach(c => {\n      metaToJSON(c, subObj);\n    });\n  } else {\n    obj[name] = getDefaultValue(type);\n  }\n  return obj;\n};\n\n// Generate JSON from metas\nexport const metasToJSON = (metas?: ViewVariableTreeNode[]): object =>\n  metas ? Object.assign({}, ...metas.map(meta => metaToJSON(meta))) : {};\n\ntype ViewVariableArrayNode = ViewVariableTreeNode & {\n  parent?: ViewVariableArrayNode;\n  level: number;\n};\n\n// metas tree -> array\nexport const metasFlat = (\n  metas?: ViewVariableTreeNode[],\n): ViewVariableArrayNode[] => {\n  const treeToArray = (\n    meta: ViewVariableTreeNode,\n    parent?: ViewVariableTreeNode,\n    level = 0,\n  ) => {\n    const { children } = meta;\n    const thisMeta = { ...meta, parent, level };\n    return [\n      thisMeta,\n      ...(children?.map(c => treeToArray(c, thisMeta, level + 1)) || []).flat(),\n    ];\n  };\n  return metas && metas.length > 0 ? metas.map(m => treeToArray(m)).flat() : [];\n};\n\n// export const findLeafMeta = (meta: ViewVariableTreeNode) => {\n//   const traverse = m => {\n//     if (m.children?.length > 0) {\n//       return [...m.children.map(traverse).flat()];\n//     }\n//     return m;\n//   };\n\n//   return {\n//     leaves: traverse(meta),\n//     hasLeaf: (meta?.children?.length ?? 0) > 0,\n//   };\n// };\n\n// Compare old and new metas to find removed, retyped, renamed, added\nexport const compareMetas = (\n  newMetas: ViewVariableTreeNode[] | undefined = [],\n  oldMetas: ViewVariableTreeNode[] | undefined = [],\n): {\n  removed: ViewVariableArrayNode[];\n  retyped: {\n    from: ViewVariableArrayNode;\n    to: ViewVariableArrayNode;\n  }[];\n  renamed: {\n    from: ViewVariableArrayNode;\n    to: ViewVariableArrayNode;\n  }[];\n  added: ViewVariableArrayNode[];\n} => {\n  const newMetasArray = metasFlat(newMetas);\n  const oldMetasArray = metasFlat(oldMetas);\n\n  const removed: ViewVariableArrayNode[] = [];\n  const retyped: {\n    from: ViewVariableArrayNode;\n    to: ViewVariableArrayNode;\n  }[] = [];\n\n  const renamed: {\n    from: ViewVariableArrayNode;\n    to: ViewVariableArrayNode;\n  }[] = [];\n\n  const oldKeys = {};\n\n  oldMetasArray.forEach(oldMeta => {\n    oldKeys[oldMeta.key] = true;\n    const newMeta = newMetasArray.find(o => o.key === oldMeta.key);\n    // deleted\n    if (!newMeta) {\n      removed.push(oldMeta);\n    } else if (oldMeta.name !== newMeta.name) {\n      renamed.push({\n        from: oldMeta,\n        to: newMeta,\n      });\n    } else if (oldMeta.type !== newMeta.type) {\n      retyped.push({\n        from: oldMeta,\n        to: newMeta,\n      });\n    }\n  });\n  // If it is not in oldKeys, it is a new addition. Don't worry if it has no name.\n  const added = newMetasArray\n    .filter(d => d.key && !oldKeys[d.key])\n    .filter(d => d.name);\n\n  return {\n    removed,\n    renamed,\n    retyped,\n    added,\n  };\n};\n\n// According to meta.parent, complete the path parent1 - > parent2... - > self\nconst getMetaPath = (_meta: ViewVariableArrayNode): ViewVariableArrayNode[] => {\n  if (_meta.parent) {\n    return [...getMetaPath(_meta.parent), _meta];\n  }\n  return [_meta];\n};\n\n/**\n * Returns all reference points within obj according to the path\n * */\nconst getObjRefByMetaPath = (\n  _metaPath: ViewVariableArrayNode[],\n  _obj: object,\n) => {\n  let it = [_obj];\n  _metaPath.forEach(_meta => {\n    it = it\n      .map(_it => {\n        if (_meta.type === ViewVariableType.Object) {\n          if (!_it[_meta.name]) {\n            _it[_meta.name] = {};\n          }\n          return [_it[_meta.name]];\n        } else if (_meta.type === ViewVariableType.ArrayObject) {\n          if (!_it[_meta.name]) {\n            _it[_meta.name] = [{}];\n          }\n          return _it[_meta.name];\n        }\n      })\n      .flat();\n  });\n\n  return it;\n};\n\n/**\n *  Accurately modify json according to metas changes\n * */\n// eslint-disable-next-line max-lines-per-function\nexport const niceAssign = (\n  json?: string,\n  newMetas: ViewVariableTreeNode[] | undefined = [],\n  oldMetas: ViewVariableTreeNode[] | undefined = [],\n): string | undefined => {\n  if (!json) {\n    return json;\n  }\n\n  try {\n    const _json = JSON.parse(json);\n\n    const { removed, renamed, retyped, added } = compareMetas(\n      newMetas,\n      oldMetas,\n    );\n\n    /**\n     * What do I need to do to rename?\n     * 1. Find all fromRefs\n     * 2. Find all toRefs\n     * 3. Assign fromRefs to toRefs one-to-one, and the default value is the bottom.\n     * 4. Add fromRefs to removed\n     * */\n    renamed\n      // You need to change the name from the child - > parent step by step, otherwise the parent node will change first and the sub-node will not be found.\n      .sort((a, b) => b.from.level - a.from.level)\n      .forEach(_renameMeta => {\n        const fromMetaPath = getMetaPath(_renameMeta.from);\n        const fromRefs = getObjRefByMetaPath(\n          fromMetaPath.splice(0, fromMetaPath.length - 1),\n          _json,\n        );\n\n        fromRefs.forEach(ref => {\n          ref[_renameMeta.to.name] =\n            ref[_renameMeta.from.name] ?? getDefaultValue(_renameMeta.to.type);\n          // const sortedKeys = Object.keys(ref).sort();\n          // sortedKeys.forEach(k => {\n          //   const cache = ref[k];\n          //   delete ref[k];\n          //   ref[k] = cache;\n          // });\n        });\n\n        removed.push(_renameMeta.from);\n      });\n\n    /**\n     * What does it take to delete?\n     * 1. Set the corresponding value to undefined according to refs, and automatically filter when JSON.stringify\n     * */\n    removed\n      // You need to delete it step by step from the child - > parent, otherwise the deletion of the parent node will cause the sub-node to not be found. (It seems that it is no problem to delete the parent node first, just delete it from the sub-node to be on the safe side)\n      .sort((a, b) => b.level - a.level)\n      .forEach(_removeMeta => {\n        const removeMetaPath = getMetaPath(_removeMeta);\n        const removeRefs = getObjRefByMetaPath(\n          removeMetaPath.splice(0, removeMetaPath.length - 1),\n          _json,\n        );\n\n        removeRefs.forEach(ref => {\n          ref[_removeMeta.name] = undefined;\n        });\n      });\n\n    /**\n     * What do I need to do to change the type?\n     * 1. According to toRefs, reset the corresponding value to the default value\n     * 2. Specialization 1: ArrayObject to Object, cannot be reset to the default value. Expected: take array [0] [{a: 1}, {a: 2 }] -> { a: 1} (default value to cover the bottom)\n     * 3. Specialization 2: Object to ArrayObject, cannot be reset to the default value. Expected: wrap a layer of array [] {a: 1 } -> [{ a: 1}]\n     * */\n    retyped\n      // You need to modify it step by step from child - > parent, otherwise changing the parent node first will cause the sub-node to not be found.\n      .sort((a, b) => b.from.level - a.from.level)\n      .forEach(_retypedMeta => {\n        const { from, to } = _retypedMeta;\n        /**\n         * Specialized logic 1: arrayObject to object\n         * Expected: take array [0] [{a: 1}, {a: 2 }] -> { a: 1}\n         */\n        if (\n          from.type === ViewVariableType.ArrayObject &&\n          to.type === ViewVariableType.Object\n        ) {\n          const toMetaPath = getMetaPath(to);\n          const toRefs = getObjRefByMetaPath(\n            toMetaPath.splice(0, toMetaPath.length - 1),\n            _json,\n          );\n          toRefs.forEach(ref => {\n            ref[to.name] = ref[to.name]?.[0] ?? getDefaultValue(to.type);\n          });\n          /**\n           * Specialization logic 2: object to arrayObject\n           * Expectations: a layer [] {a: 1 } -> [{ a: 1}]\n           */\n        } else if (\n          from.type === ViewVariableType.Object &&\n          to.type === ViewVariableType.ArrayObject\n        ) {\n          const toMetaPath = getMetaPath(to);\n          const toRefs = getObjRefByMetaPath(\n            toMetaPath.splice(0, toMetaPath.length - 1),\n            _json,\n          );\n\n          toRefs.forEach(ref => {\n            ref[to.name] = [ref[to.name]];\n          });\n\n          /**\n           * In most cases, you can directly reset to the default value corresponding to the new type according to the new type.\n           */\n        } else {\n          const toMetaPath = getMetaPath(to);\n          const toRefs = getObjRefByMetaPath(\n            toMetaPath.splice(0, toMetaPath.length - 1),\n            _json,\n          );\n\n          toRefs.forEach(ref => {\n            ref[to.name] = getDefaultValue(to.type);\n          });\n        }\n      });\n\n    /**\n     * What do I need to add?\n     * 1. Set the corresponding value to the default value according to refs\n     * */\n    added\n      // You need to add it level by level from Parent - > Child, otherwise the sub-node cannot find the parent node.\n      .sort((a, b) => a.level - b.level)\n      .forEach(newMeta => {\n        const newMetaPath = getMetaPath(newMeta);\n        const newRefs = getObjRefByMetaPath(\n          newMetaPath.splice(0, newMetaPath.length - 1),\n          _json,\n        );\n\n        newRefs.forEach(ref => {\n          ref[newMeta.name] = getDefaultValue(newMeta.type);\n          // const sortedKeys = Object.keys(ref).sort();\n          // sortedKeys.forEach(k => {\n          //   const cache = ref[k];\n          //   delete ref[k];\n          //   ref[k] = cache;\n          // });\n        });\n      });\n\n    return JSON.stringify(_json, null, 4);\n  } catch (error) {\n    console.error(error);\n    return json;\n  }\n};\n\n/**\n * JSON.stringify is currently used to format JSON, leaving room for better formatting in the future\n */\nexport const jsonFormat = json => {\n  try {\n    return JSON.stringify(json, null, 4);\n  } catch (error) {\n    console.error(error);\n    return json;\n  }\n};\n\n// Check if there is a duplicate key in the output\nexport const outputsVerify = (outputs?: ViewVariableTreeNode[]): boolean => {\n  if (!outputs) {\n    return false;\n  }\n\n  let rs = true;\n  const names = outputs.map(o => o.name);\n  const namesSet = new Set(names);\n  if (names.length !== namesSet.size) {\n    rs = false;\n  } else {\n    for (const d of outputs) {\n      if (d.children) {\n        rs = outputsVerify(d.children);\n        if (!rs) {\n          break;\n        }\n      }\n    }\n  }\n\n  return rs;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo, useRef } from 'react';\n\nimport { isEqual, isNil } from 'lodash-es';\nimport { type ViewVariableTreeNode } from '@coze-workflow/base';\n\nimport { jsonFormat, metasToJSON, niceAssign, outputsVerify } from '../utils';\n\ntype IUseIgnoreJSON = (opts: {\n  isOpen?: boolean;\n  json?: string;\n  outputs?: ViewVariableTreeNode[];\n  isBatch?: boolean;\n  onJSONChange: (v: unknown) => void;\n}) => { value?: string; defaultValue?: string };\n\n// The first layer adds a new key, and there is a temporary structure without a name: {fieldRandomKey: 'OsUDuHxLYRem_njkEe8Zo', type: 1, field: '[2]'}\n// We don't care about the transient, the shift to structural consumption.\nconst transformInitOutputs = (\n  outputs?: (ViewVariableTreeNode & { fieldRandomKey?: string })[],\n): ViewVariableTreeNode[] | undefined =>\n  outputs?.map(d => {\n    if (d?.fieldRandomKey) {\n      return {\n        ...d,\n        key: d.fieldRandomKey,\n      };\n    }\n    return d;\n  });\n\nexport const useJSONWithOutputs: IUseIgnoreJSON = ({\n  json,\n  outputs: outputsInParams,\n  isOpen,\n  onJSONChange,\n  isBatch,\n}) => {\n  const outputs = transformInitOutputs(outputsInParams);\n  const lastOutputs = useRef(outputs);\n  const lastIsBatch = useRef(isBatch);\n  const lastIsOpen = useRef(isOpen);\n\n  const _json = useMemo(() => {\n    let defaultJSON;\n    if (isOpen && outputsVerify(outputs)) {\n      // Generate default value, timing: switch on for the first time\n      defaultJSON = jsonFormat(metasToJSON(outputs));\n      if (!json && isNil(lastIsOpen.current)) {\n        onJSONChange(defaultJSON);\n        lastIsOpen.current = isOpen;\n        lastOutputs.current = outputs;\n        return { value: defaultJSON, defaultValue: defaultJSON };\n      }\n\n      // Switch single/batch\n      if (lastIsBatch.current !== isBatch) {\n        lastOutputs.current = outputs;\n        lastIsBatch.current = isBatch;\n        if (!json) {\n          return { value: json, defaultValue: defaultJSON };\n        }\n        try {\n          const jsonObj = JSON.parse(json);\n\n          let newJSON;\n          // Single - > batch add outputList package\n          if (isBatch) {\n            newJSON = jsonFormat({ outputList: [jsonObj] });\n            // Batch - > single delete outputList package\n          } else {\n            newJSON = jsonFormat(jsonObj?.outputList?.[0] ?? jsonObj);\n          }\n          onJSONChange(newJSON);\n\n          return { value: newJSON, defaultValue: defaultJSON };\n        } catch (error) {\n          console.error(error);\n          return { value: json, defaultValue: defaultJSON };\n        }\n      }\n\n      // Output structure change\n      if (!isEqual(outputs, lastOutputs.current)) {\n        // It is necessary to analyze the addition, deletion, renaming, and type of attributes, and modify the json synchronously.\n        const newJSON = niceAssign(json, outputs, lastOutputs.current);\n        onJSONChange(newJSON);\n        lastOutputs.current = outputs;\n        return { value: newJSON, defaultValue: defaultJSON };\n      }\n    }\n\n    return { value: json, defaultValue: defaultJSON };\n  }, [outputs, json, isOpen, onJSONChange, isBatch]);\n\n  return _json;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useUpdateEffect } from 'ahooks';\nimport { SettingOnErrorProcessType } from '@coze-workflow/nodes';\n\nimport { type SettingOnErrorProps } from '../types';\n\ninterface Props\n  extends Pick<SettingOnErrorProps, 'isBatch' | 'value' | 'onChange'> {\n  isSettingOnErrorV2?: boolean;\n}\n\n/**\n * The batch scenario does not support abnormal branches. If abnormal branches are set when the batch is changed, it will be automatically converted to return the set content.\n */\nexport const useBatchChange = (props: Props) => {\n  const { isBatch, value, onChange, isSettingOnErrorV2 } = props;\n  useUpdateEffect(() => {\n    if (\n      isSettingOnErrorV2 &&\n      isBatch &&\n      value?.processType === SettingOnErrorProcessType.EXCEPTION\n    ) {\n      onChange?.({\n        ...value,\n        processType: SettingOnErrorProcessType.RETURN,\n      });\n    }\n  }, [isBatch, isSettingOnErrorV2, onChange, value]);\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EditorProvider, createRenderer } from '@coze-editor/editor/react';\nimport preset, { languages, themes } from '@coze-editor/editor/preset-code';\nimport { json } from '@coze-editor/editor/language-json';\nimport { EditorView, tooltips } from '@codemirror/view';\n\nimport { cozeLight } from '../../../code-editor/themes/coze-light';\nimport { cozeDark } from '../../../code-editor/themes/coze-dark';\n\nlanguages.register('json', json);\nthemes.register('coze-light', cozeLight);\nthemes.register('coze-dark', cozeDark);\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst JSONEditor: any = createRenderer(preset, [\n  EditorView.theme({\n    '.cm-selectionBackground': {\n      borderRadius: '4px',\n    },\n    '.cm-activeLineGutter': {\n      borderRadius: '4px 0 0 4px',\n    },\n    '.cm-activeLine': {\n      borderRadius: '0 4px 4px 0',\n    },\n    '&.cm-focused': {\n      outline: 'none',\n    },\n    '& *': {\n      fontFamily: 'Menlo, Monaco, \"Courier New\", monospace',\n    },\n    '.cm-tooltip': {\n      wordBreak: 'break-all',\n    },\n    '.cm-lineNumbers .cm-gutterElement': {\n      transform: 'translate(0, 1px)',\n    },\n    '.cm-foldGutter .cm-gutterElement > div': {\n      display: 'flex',\n      alignItems: 'center',\n    },\n    '.cm-completionIcon': {\n      fontSize: '11px',\n    },\n  }),\n  tooltips({\n    parent: document.body,\n    tooltipSpace() {\n      return {\n        left: 16,\n        top: 16,\n        right: window.innerWidth - 16,\n        bottom: window.innerHeight - 16,\n      };\n    },\n  }),\n]);\n\nexport { EditorProvider, JSONEditor };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nfunction IconLight() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"1em\"\n      height=\"1em\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n    >\n      <path\n        d=\"M8.32834 0.96886C8.32834 0.597733 8.6292 0.296875 9.00032 0.296875C9.37145 0.296875 9.67231 0.597733 9.67231 0.968861V1.81512C9.67231 2.18624 9.37145 2.4871 9.00032 2.4871C8.6292 2.4871 8.32834 2.18624 8.32834 1.81512V0.96886Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        d=\"M14.2043 2.84603C14.4667 2.5836 14.8922 2.5836 15.1546 2.84603C15.417 3.10846 15.417 3.53393 15.1546 3.79636L14.5562 4.39475C14.2938 4.65718 13.8683 4.65718 13.6059 4.39475C13.3435 4.13233 13.3435 3.70685 13.6059 3.44442L14.2043 2.84603Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        d=\"M17.7038 9.00032C17.7038 8.6292 17.4029 8.32834 17.0318 8.32834H16.1856C15.8144 8.32834 15.5136 8.6292 15.5136 9.00032C15.5136 9.37145 15.8144 9.67231 16.1856 9.67231H17.0318C17.4029 9.67231 17.7038 9.37145 17.7038 9.00032Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        d=\"M15.1546 14.2043C15.4171 14.4667 15.4171 14.8922 15.1546 15.1546C14.8922 15.417 14.4667 15.417 14.2043 15.1546L13.6059 14.5562C13.3435 14.2938 13.3435 13.8683 13.6059 13.6059C13.8683 13.3435 14.2938 13.3435 14.5562 13.6059L15.1546 14.2043Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        d=\"M9.00035 17.7038C9.37148 17.7038 9.67233 17.4029 9.67233 17.0318V16.1856C9.67233 15.8144 9.37148 15.5136 9.00035 15.5136C8.62922 15.5136 8.32836 15.8144 8.32836 16.1856V17.0318C8.32836 17.4029 8.62922 17.7038 9.00035 17.7038Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        d=\"M3.79639 15.1546C3.53397 15.4171 3.10849 15.4171 2.84606 15.1546C2.58364 14.8922 2.58364 14.4667 2.84606 14.2043L3.44446 13.6059C3.70688 13.3435 4.13236 13.3435 4.39479 13.6059C4.65721 13.8683 4.65721 14.2938 4.39479 14.5562L3.79639 15.1546Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        d=\"M0.296875 9.00035C0.296875 9.37148 0.597733 9.67233 0.96886 9.67233H1.81512C2.18624 9.67233 2.4871 9.37148 2.4871 9.00035C2.4871 8.62922 2.18624 8.32836 1.81512 8.32836H0.968861C0.597733 8.32836 0.296875 8.62922 0.296875 9.00035Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        d=\"M2.84603 3.79639C2.5836 3.53397 2.5836 3.10849 2.84603 2.84606C3.10846 2.58364 3.53393 2.58364 3.79636 2.84606L4.39475 3.44446C4.65718 3.70688 4.65718 4.13236 4.39475 4.39479C4.13233 4.65721 3.70685 4.65721 3.44442 4.39479L2.84603 3.79639Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M14.5913 9.00033C14.5913 12.0881 12.0882 14.5913 9.00036 14.5913C5.91257 14.5913 3.40942 12.0881 3.40942 9.00033C3.40942 5.91253 5.91257 3.40937 9.00036 3.40937C12.0882 3.40937 14.5913 5.91253 14.5913 9.00033ZM13.2484 9.00034C13.2484 11.3465 11.3465 13.2484 9.00034 13.2484C6.6542 13.2484 4.75229 11.3465 4.75229 9.00034C4.75229 6.6542 6.6542 4.75229 9.00034 4.75229C11.3465 4.75229 13.2484 6.6542 13.2484 9.00034Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n}\n\nfunction IconDark() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"1em\"\n      height=\"1em\"\n      viewBox=\"0 0 16 18\"\n      fill=\"none\"\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M11.4236 11.2192C8.85626 10.5313 7.33271 7.89246 8.02062 5.32516C8.27455 4.37747 8.66403 3.83272 9.25911 2.92849C10.0132 1.78265 9.83575 0.952788 8.91536 0.865985C5.47786 0.541789 1.56343 2.86076 0.490191 6.86615C-0.689079 11.2672 1.92273 15.791 6.32382 16.9703C10.9128 18.1999 14.6785 15.0743 15.6758 12.8972C16.0608 12.0567 15.332 11.2192 14.1862 11.2931C13.106 11.3627 12.3713 11.4732 11.4236 11.2192ZM13.8042 12.6547C14.0081 12.6165 14.1709 12.8367 14.0501 13.0054C12.4306 15.266 9.52439 16.4044 6.6797 15.6421C3.01212 14.6594 0.835614 10.8896 1.81834 7.22202C2.58057 4.37733 5.01954 2.42967 7.78701 2.15746C7.99355 2.13715 8.10286 2.38822 7.96776 2.54577C7.38427 3.22628 6.94014 4.04499 6.69247 4.96928C5.80802 8.2701 7.76687 11.6629 11.0677 12.5474C11.992 12.7951 12.9231 12.8198 13.8042 12.6547Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n}\n\nexport { IconLight, IconDark };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\n\nimport { uniqueId } from 'lodash-es';\nimport cls from 'classnames';\nimport { type SchemaObject } from 'ajv';\nimport { type EditorAPI } from '@coze-editor/editor/preset-code';\nimport { json } from '@coze-editor/editor/language-json';\nimport { I18n } from '@coze-arch/i18n';\nimport { UIButton, withField } from '@coze-arch/bot-semi';\nimport { type editor as monacoEditorNameSpace } from '@coze-arch/bot-monaco-editor/types';\nimport { IconCozBroom, IconCozRefresh } from '@coze-arch/coze-design/icons';\nimport { Tooltip } from '@coze-arch/coze-design';\nimport { EditorView } from '@codemirror/view';\n\nimport type { ComponentAdapterCommonProps } from '../../types';\nimport { EditorProvider, JSONEditor } from './json-editor';\nimport { IconDark, IconLight } from './icons';\n\nimport styles from './index.module.less';\n\nexport type JSONEditorSchema = SchemaObject;\n\ntype JsonEditorProps = ComponentAdapterCommonProps<string> & {\n  jsonSchema?: JSONEditorSchema;\n  disabled?: boolean;\n  className?: string;\n  options?: monacoEditorNameSpace.IStandaloneEditorConstructionOptions;\n  height?: number;\n  defaultValue?: string;\n  title?: string;\n} & {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any;\n};\n\nconst extensions = [\n  EditorView.theme({\n    '&': {\n      borderRadius: '8px',\n    },\n    '.cm-scroller': {\n      transition: 'height .3s ease',\n    },\n    '.cm-content': {\n      paddingTop: '16px',\n      paddingBottom: '16px',\n    },\n  }),\n];\n\nexport const JsonEditorAdapter: React.FC<JsonEditorProps> = ({\n  validateStatus,\n  onBlur,\n  onFocus,\n  jsonSchema,\n  options = {},\n  disabled,\n  value,\n  onChange,\n  className,\n  height,\n  defaultValue,\n  title,\n  ...props\n}) => {\n  const [preferNewEditor] = useState(true);\n  const [theme, setTheme] = useState('light');\n  const [focus, setFocus] = useState(false);\n\n  const valueRef = useRef<string | undefined>(value);\n\n  const handleChange = val => {\n    // No onchange is required when non-focus, avoid format triggering onchange\n    if (!focus) {\n      return;\n    }\n    if (!val) {\n      valueRef.current = undefined;\n      onChange?.(undefined);\n    } else {\n      valueRef.current = val;\n      onChange?.(val);\n    }\n  };\n\n  const handleBlur = useCallback(() => {\n    setFocus(false);\n    onBlur?.();\n  }, [onBlur]);\n\n  const handleFocus = useCallback(() => {\n    setFocus(true);\n    onFocus?.();\n  }, [onFocus]);\n\n  const newEditorRef = useRef<EditorAPI | null>(null);\n  const uri = useMemo(() => `file:///${uniqueId()}.json`, []);\n\n  function triggerFormat() {\n    if (!newEditorRef.current) {\n      return;\n    }\n\n    const currentValue = newEditorRef.current.getValue();\n\n    try {\n      const object = JSON.parse(currentValue);\n      const formatted = JSON.stringify(object, null, 4);\n      if (newEditorRef.current.getValue() !== formatted) {\n        newEditorRef.current.setValue(formatted);\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  useEffect(() => {\n    // Automatically format once when externally updating values\n    if (value !== valueRef.current) {\n      triggerFormat();\n    }\n  }, [value]);\n\n  useEffect(() => {\n    const schemaURI = `file:///${uniqueId()}`;\n\n    json.languageService.configureSchemas({\n      uri: schemaURI,\n      fileMatch: [uri],\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      schema: jsonSchema as any,\n    });\n\n    newEditorRef.current?.validate();\n\n    return () => {\n      json.languageService.deleteSchemas(schemaURI);\n    };\n  }, [uri, jsonSchema]);\n\n  useEffect(() => {\n    if (!newEditorRef.current) {\n      return;\n    }\n\n    if (value !== newEditorRef.current.getValue()) {\n      newEditorRef.current.setValue(value);\n    }\n  }, [value]);\n\n  const isJsonVerified = useMemo(() => {\n    try {\n      const rs = JSON.parse(value);\n      return typeof rs === 'object';\n      // eslint-disable-next-line @coze-arch/use-error-in-catch\n    } catch (error) {\n      return false;\n    }\n  }, [value]);\n\n  return (\n    <div\n      data-testid={props['data-testid']}\n      className={cls(\n        styles['json-editor'],\n        preferNewEditor ? styles['is-new-editor'] : '',\n        theme === 'dark' ? styles['is-dark-theme'] : styles['is-light-theme'],\n        className,\n      )}\n    >\n      <div\n        className={cls(\n          'w-full h-[28px] px-[8px] rounded-t-[8px] flex items-center justify-between',\n          styles.header,\n        )}\n      >\n        <div className={styles.title}>{title || 'json'}</div>\n        <div className={styles.icons}>\n          {typeof defaultValue !== 'undefined' ? (\n            <Tooltip content={I18n.t('Reset')}>\n              <UIButton\n                className=\"bg-transparent\"\n                disabled={disabled}\n                onClick={() => {\n                  onChange?.(defaultValue);\n                }}\n                onMouseDown={e => e.preventDefault()}\n                icon={<IconCozRefresh />}\n              />\n            </Tooltip>\n          ) : null}\n\n          <UIButton\n            className=\"bg-transparent\"\n            size=\"small\"\n            onClick={() => {\n              setTheme(t => (t === 'light' ? 'dark' : 'light'));\n            }}\n            onMouseDown={e => e.preventDefault()}\n            icon={theme === 'light' ? <IconLight /> : <IconDark />}\n          />\n\n          <Tooltip content={I18n.t('workflow_exception_ignore_format')}>\n            <UIButton\n              size={'small'}\n              className=\"bg-transparent\"\n              disabled={disabled || !isJsonVerified}\n              onClick={() => {\n                try {\n                  const formatJSON = JSON.parse(value as string);\n                  const formatedValue = JSON.stringify(formatJSON, null, 4);\n                  valueRef.current = formatedValue;\n                  onChange?.(formatedValue);\n                } catch (e) {\n                  console.error(e);\n                }\n              }}\n              onMouseDown={e => e.preventDefault()}\n              icon={<IconCozBroom />}\n            />\n          </Tooltip>\n        </div>\n      </div>\n      <div\n        className={cls('pl-[12px] transition-height duration-200 ease-in', {\n          [styles.error]: validateStatus === 'error',\n          [styles.disabled]: disabled,\n        })}\n      >\n        <EditorProvider>\n          <JSONEditor\n            defaultValue={value ?? ''}\n            options={{\n              uri,\n              languageId: 'json',\n              theme: theme === 'dark' ? 'coze-dark' : 'coze-light',\n              fontSize: 12,\n              height: height ? height : focus ? '264px' : '120px',\n              readOnly: disabled,\n              editable: !disabled,\n            }}\n            extensions={extensions}\n            onChange={e => handleChange(e.value)}\n            onFocus={handleFocus}\n            onBlur={handleBlur}\n            didMount={_ => (newEditorRef.current = _)}\n          />\n        </EditorProvider>\n      </div>\n    </div>\n  );\n};\n\n// Use the Semi Form context to use in the test set form\nconst JsonEditorSemi = withField(JsonEditorAdapter, {\n  valueKey: 'value',\n  onKeyChangeFnName: 'onChange',\n});\n\nexport { JsonEditorSemi };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/naming-convention */\nimport {\n  ViewVariableType,\n  type ViewVariableTreeNode,\n} from '@coze-workflow/base';\n\n// Type mapping to be converted\nconst ViewVariableType2JsonSchema = {\n  [ViewVariableType.ArrayObject]: {\n    type: 'array',\n    items: {\n      type: 'object',\n    },\n  },\n  [ViewVariableType.ArrayImage]: {\n    type: 'array',\n    items: {\n      type: 'string',\n    },\n  },\n  [ViewVariableType.ArrayTime]: {\n    type: 'array',\n    items: {\n      type: 'string',\n    },\n  },\n  [ViewVariableType.ArrayBoolean]: {\n    type: 'array',\n    items: {\n      type: 'boolean',\n    },\n  },\n  [ViewVariableType.ArrayNumber]: {\n    type: 'array',\n    items: {\n      type: 'number',\n    },\n  },\n  [ViewVariableType.ArrayInteger]: {\n    type: 'array',\n    items: {\n      type: 'integer',\n    },\n  },\n  [ViewVariableType.ArrayString]: {\n    type: 'array',\n    items: {\n      type: 'string',\n    },\n  },\n  [ViewVariableType.Object]: {\n    type: 'object',\n  },\n  [ViewVariableType.Image]: {\n    type: 'string',\n  },\n  [ViewVariableType.Time]: {\n    type: 'string',\n  },\n  [ViewVariableType.Boolean]: {\n    type: 'boolean',\n  },\n  [ViewVariableType.Number]: {\n    type: 'number',\n  },\n  [ViewVariableType.Integer]: {\n    type: 'integer',\n  },\n  [ViewVariableType.String]: {\n    type: 'string',\n  },\n};\n\nconst generate = (meta: ViewVariableTreeNode) => {\n  const { type, children = [] } = meta;\n  const jsonSchema = ViewVariableType2JsonSchema[type];\n  if (\n    type === ViewVariableType.Object ||\n    type === ViewVariableType.ArrayObject\n  ) {\n    const properties = {};\n    for (const child of children) {\n      properties[child.name] = generate(child);\n    }\n\n    return type === ViewVariableType.Object\n      ? {\n          ...jsonSchema,\n          properties,\n        }\n      : {\n          ...jsonSchema,\n          items: {\n            type: 'object',\n            properties,\n          },\n        };\n  }\n  return jsonSchema;\n};\n\n// Generate default JSON schema from meta\nexport const generateJSONSchema = (\n  outputs: ViewVariableTreeNode[] | undefined,\n) => ({\n  type: 'object',\n  properties: (outputs || [])\n    .filter(m => m && !(m as unknown as { readonly: boolean }).readonly)\n    .reduce(\n      (pre, cur) => ({\n        ...pre,\n        [cur.name]: generate(cur),\n      }),\n      {},\n    ),\n});\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useMemo } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Switch } from '@coze-arch/coze-design';\n\nimport { JsonEditorAdapter as JsonEditorAdapterNew } from '@/components/test-run/test-form-materials/json-editor/new';\n\nimport { FormItemFeedback } from '../form-item-feedback';\nimport { FormCard } from '../form-card';\nimport { generateJSONSchema } from './utils/generate-json-schema';\nimport { type ErrorFormProps } from './types';\n\nimport styles from './index.module.less';\n\nconst ErrorFormCard: React.FC<ErrorFormProps> = ({\n  isOpen = false,\n  onSwitchChange,\n  json,\n  onJSONChange,\n  readonly,\n  errorMsg,\n  defaultValue,\n  noPadding,\n  outputs,\n}) => (\n  <FormCard\n    header={I18n.t('workflow_exception_ignore_title')}\n    tooltip={I18n.t('workflow_exception_ignore_icon_tips')}\n    actionButton={\n      <div className=\"flex items-center h-6\">\n        <Switch\n          size=\"mini\"\n          checked={isOpen}\n          onChange={onSwitchChange}\n          disabled={readonly}\n        />\n      </div>\n    }\n    noPadding={noPadding}\n  >\n    <div className=\"text-xs leading-[16px] coz-fg-secondary\">\n      {I18n.t('workflow_exception_ignore_desc')}\n    </div>\n\n    {isOpen ? (\n      <div className=\"mt-[12px]\">\n        <div className=\"text-xs coz-fg-primary leading-[16px] font-medium\">\n          {I18n.t('workflow_exception_ignore_default_output')}\n          <span className=\"coz-fg-hglt-red\">*</span>\n        </div>\n        <div className={'mt-[4px]'}>\n          <JsonEditorAdapterNew\n            className={styles['json-editor']}\n            value={json ?? ''}\n            jsonSchema={generateJSONSchema(outputs)}\n            options={{\n              quickSuggestions: false,\n              suggestOnTriggerCharacters: false,\n            }}\n            onChange={onJSONChange}\n            disabled={readonly}\n            height={200}\n            defaultValue={defaultValue}\n          />\n        </div>\n      </div>\n    ) : undefined}\n    {errorMsg ? (\n      <FormItemFeedback feedbackText={errorMsg}></FormItemFeedback>\n    ) : undefined}\n  </FormCard>\n);\n\nexport const ErrorForm: React.FC<ErrorFormProps> = ({\n  isOpen = false,\n  json,\n  onSwitchChange,\n  onJSONChange,\n  readonly,\n  errorMsg,\n  defaultValue,\n  noPadding,\n  outputs,\n}) => {\n  const hasError = useMemo(() => {\n    if (!isOpen) {\n      return { rs: true };\n    } else {\n      // If there is an external error, just report the error directly.\n      if (errorMsg) {\n        return { rs: false, msg: errorMsg };\n      }\n      // When isOpen = true for the first time, json will be given the default value, and json = undefined for a moment. Just return true, otherwise it will flash.\n      if (json === undefined) {\n        return { rs: true };\n      }\n      try {\n        const obj = JSON.parse(json);\n        if (typeof obj !== 'object') {\n          return {\n            rs: false,\n            msg: I18n.t('workflow_exception_ignore_json_error'),\n          };\n        }\n        return { rs: true };\n        // eslint-disable-next-line @coze-arch/use-error-in-catch\n      } catch (e) {\n        return {\n          rs: false,\n          msg: I18n.t('workflow_exception_ignore_json_error'),\n        };\n      }\n    }\n  }, [isOpen, json, errorMsg]);\n\n  return (\n    <ErrorFormCard\n      isOpen={isOpen}\n      json={json}\n      onSwitchChange={onSwitchChange}\n      onJSONChange={onJSONChange}\n      readonly={readonly}\n      errorMsg={hasError.msg}\n      defaultValue={defaultValue}\n      noPadding={noPadding}\n      outputs={outputs}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport { getTimeoutConfig } from '../utils/get-timeout-config';\n\n/**\n * Get timeout configuration\n * @returns\n */\nexport const useTimeoutConfig = (): {\n  default: number;\n  max: number;\n  min: number;\n  disabled: boolean;\n} => {\n  const node = useCurrentEntity();\n  return getTimeoutConfig(node);\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type SettingOnErrorValue,\n  useTimeoutConfig,\n} from '@coze-workflow/nodes';\n\n/**\n * Whether to expand\n * @param settingOnError\n * @returns\n */\nexport const useExpand = (settingOnError: SettingOnErrorValue) => {\n  const defaultConfig = useTimeoutConfig().default;\n\n  if (settingOnError?.settingOnErrorIsOpen) {\n    return true;\n  }\n\n  if (settingOnError?.retryTimes) {\n    return true;\n  }\n\n  if (\n    settingOnError?.timeoutMs &&\n    settingOnError?.timeoutMs !== defaultConfig\n  ) {\n    return true;\n  }\n  return false;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-magic-numbers */\nimport { useEffect, useState, type FC } from 'react';\n\nimport { useTimeoutConfig } from '@coze-workflow/nodes';\nimport { logger } from '@coze-arch/logger';\nimport { Input } from '@coze-arch/coze-design';\n\nimport { type SettingOnErrorItemProps } from '../../types';\n\n// Millisecond to second (intelligently removes ending zeros)\nconst msToSeconds = (ms: number) => {\n  const formatter = new Intl.NumberFormat('en-US', {\n    maximumFractionDigits: 3,\n    minimumFractionDigits: 0,\n  });\n  return formatter.format(ms / 1000);\n};\n\n/**\n * timeout\n */\nexport const Timeout: FC<SettingOnErrorItemProps<number>> = ({\n  value,\n  onChange,\n  readonly,\n}) => {\n  const timeoutConfig = useTimeoutConfig();\n  const [inputValue, setInputValue] = useState('');\n\n  // Back-end millisecond to front-end second display\n  useEffect(() => {\n    const seconds = msToSeconds(value ?? timeoutConfig.default);\n    setInputValue(seconds);\n  }, [timeoutConfig.default, value]);\n\n  // Handling input changes\n  const handleChange = (v: string | number) => {\n    const rawValue = String(v);\n    // Limit input format: allow numbers and decimal points, up to three decimal places\n    if (/^\\d*\\.?\\d{0,3}$/.test(rawValue)) {\n      setInputValue(rawValue);\n    }\n  };\n\n  // Converted to milliseconds when submitting\n  const handleBlur = () => {\n    try {\n      let ms = Math.round(Number(inputValue) * 1000);\n      if (inputValue === '') {\n        ms = timeoutConfig.default;\n      }\n\n      if (ms < timeoutConfig.min) {\n        ms = timeoutConfig.min;\n      }\n\n      if (ms > timeoutConfig.max) {\n        ms = timeoutConfig.max;\n      }\n\n      onChange?.(ms);\n\n      // echo normalized value\n      const seconds = msToSeconds(ms);\n      setInputValue(seconds);\n    } catch (err) {\n      logger.error(err);\n    }\n  };\n\n  if (timeoutConfig.disabled) {\n    return <div>-</div>;\n  }\n\n  return (\n    <Input\n      size=\"small\"\n      data-testid=\"setting-on-error-timeout\"\n      value={inputValue}\n      onChange={handleChange}\n      onBlur={handleBlur}\n      disabled={readonly}\n      suffix=\"s\"\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Select } from '@coze-arch/coze-design';\n\nimport { type SettingOnErrorItemProps } from '../../types';\n\n/**\n * number of retries\n */\nexport const RetryTimes: FC<SettingOnErrorItemProps<number>> = ({\n  value,\n  onChange,\n  readonly,\n}) => (\n  <Select\n    size=\"small\"\n    data-testid=\"setting-on-error-retry-times\"\n    optionList={[\n      { label: I18n.t('workflow_250416_06', undefined, ''), value: 0 },\n      { label: I18n.t('workflow_250416_07', undefined, '1'), value: 1 },\n    ]}\n    value={value ?? 0}\n    onChange={v => {\n      onChange?.(v as number);\n    }}\n    disabled={readonly}\n  />\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { Tooltip } from '@coze-arch/coze-design';\n\ninterface Props {\n  label?: string;\n  tooltip?: string;\n}\n\nexport const OptionItem: FC<Props> = ({ label, tooltip }) => (\n  <Tooltip content={tooltip} position=\"left\" spacing={40}>\n    <div className=\"pl-2\">{label}</div>\n  </Tooltip>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { SettingOnErrorProcessType } from '@coze-workflow/nodes';\nimport { I18n } from '@coze-arch/i18n';\nimport { Select } from '@coze-arch/coze-design';\n\nimport { type SettingOnErrorItemProps } from '../../types';\nimport { type Option } from './types';\nimport { OptionItem } from './option-item';\n\n/**\n * timeout\n */\nexport const ProcessType: FC<\n  SettingOnErrorItemProps<SettingOnErrorProcessType> & {\n    isBatch?: boolean;\n  }\n> = ({ value, onChange, readonly, isBatch }) => {\n  const options: Option[] = [\n    {\n      value: SettingOnErrorProcessType.BREAK,\n      label: I18n.t('workflow_250407_208', undefined, ''),\n      tooltip: I18n.t(\n        'workflow_250407_209',\n        undefined,\n        '',\n      ),\n    },\n    {\n      value: SettingOnErrorProcessType.RETURN,\n      label: I18n.t('workflow_250407_210', undefined, ''),\n      tooltip: I18n.t(\n        'workflow_250407_211',\n        undefined,\n        'isSuccesserrorBody',\n      ),\n    },\n    ...(isBatch\n      ? []\n      : [\n          {\n            value: SettingOnErrorProcessType.EXCEPTION,\n            label: I18n.t('workflow_250407_212', undefined, ''),\n            tooltip: I18n.t(\n              'workflow_250407_213',\n              undefined,\n              'isSuccesserrorBody',\n            ),\n          },\n        ]),\n  ];\n\n  return (\n    <Select\n      size=\"small\"\n      data-testid=\"setting-on-error-process-type\"\n      optionList={options.map(option => ({\n        ...option,\n        label: <OptionItem label={option.label} tooltip={option.tooltip} />,\n      }))}\n      renderSelectedItem={(optionNode: unknown) => {\n        const option = options.find(\n          item =>\n            item.value ===\n            (optionNode as { value: SettingOnErrorProcessType })?.value,\n        );\n\n        if (option) {\n          return <div>{option.label}</div>;\n        }\n\n        return null;\n      }}\n      value={value || SettingOnErrorProcessType.BREAK}\n      onChange={v => {\n        onChange?.(v as SettingOnErrorProcessType);\n      }}\n      disabled={readonly}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo, type FC } from 'react';\n\nimport { SettingOnErrorProcessType } from '@coze-workflow/nodes';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { JsonEditorAdapter } from '@/components/test-run/test-form-materials/json-editor/new';\n\nimport { generateJSONSchema } from '../../utils/generate-json-schema';\nimport { type ErrorFormProps } from '../../types';\nimport styles from '../../index.module.less';\nimport { FormItemFeedback } from '../../../form-item-feedback';\n\ntype Props = Pick<\n  ErrorFormProps,\n  | 'isOpen'\n  | 'json'\n  | 'onJSONChange'\n  | 'readonly'\n  | 'defaultValue'\n  | 'errorMsg'\n  | 'outputs'\n> & {\n  processType?: SettingOnErrorProcessType;\n};\n\n/**\n * Return to content\n */\nexport const Json: FC<Props> = ({\n  isOpen,\n  json,\n  onJSONChange,\n  readonly,\n  defaultValue,\n  processType,\n  errorMsg,\n  outputs,\n}) => {\n  const jsonSchema = useMemo(() => generateJSONSchema(outputs), [outputs]);\n\n  if (!isOpen || processType !== SettingOnErrorProcessType.RETURN) {\n    return null;\n  }\n\n  return (\n    <>\n      <div className=\"mt-2\" data-testid=\"setting-on-error-json\">\n        <JsonEditorAdapter\n          className={styles['json-editor']}\n          value={json ?? ''}\n          options={{\n            quickSuggestions: false,\n            suggestOnTriggerCharacters: false,\n          }}\n          onChange={onJSONChange}\n          disabled={readonly}\n          height={170}\n          defaultValue={defaultValue}\n          jsonSchema={jsonSchema}\n          title={I18n.t('workflow_250416_08', undefined, '')}\n        />\n      </div>\n      {errorMsg ? (\n        <FormItemFeedback feedbackText={errorMsg}></FormItemFeedback>\n      ) : undefined}\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-magic-numbers */\nimport classNames from 'classnames';\nimport { useTimeoutConfig } from '@coze-workflow/nodes';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozInfoCircle } from '@coze-arch/coze-design/icons';\nimport { Tooltip } from '@coze-arch/coze-design';\n\nexport const Header = () => {\n  const { min, max, disabled } = useTimeoutConfig();\n  const minTimeout = min / 1000;\n  const maxTimeout = max / 1000;\n  const columns = [\n    {\n      title: I18n.t('workflow_250407_205', undefined, ''),\n      tooltip: disabled ? (\n        I18n.t('workflow_250508_01', undefined, '')\n      ) : (\n        <div>\n          <p>{I18n.t('workflow_250421_04', undefined, '')}</p>\n          <p>\n            {minTimeout}s - {maxTimeout}s\n          </p>\n        </div>\n      ),\n    },\n    {\n      title: I18n.t('workflow_250407_206', undefined, ''),\n    },\n    {\n      title: I18n.t('workflow_250407_207', undefined, ''),\n    },\n  ];\n  return (\n    <>\n      {columns.map(item => (\n        <div\n          key={item.title}\n          className={classNames(\n            'coz-fg-secondary text-xs font-medium leading-4 flex items-center',\n          )}\n        >\n          {item.title}\n          {item.tooltip ? (\n            <Tooltip content={item.tooltip}>\n              <IconCozInfoCircle className=\"ml-1 text-sm\" />\n            </Tooltip>\n          ) : null}\n        </div>\n      ))}\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport classNames from 'classnames';\nimport { type Model } from '@coze-arch/bot-api/developer_api';\nimport { ModelOptionThumb } from '@coze-agent-ide/model-manager/model-select-v2';\nimport { IconCozArrowDown, IconCozCross } from '@coze-arch/coze-design/icons';\n\nimport styles from './index.module.less';\n\ninterface Props {\n  readonly?: boolean;\n  model?: Model;\n  popoverVisible?: boolean;\n  placeholder?: string;\n  showClear?: boolean;\n  onClear?: () => void;\n}\n\nexport const Trigger: FC<Props> = ({\n  model,\n  popoverVisible,\n  placeholder,\n  onClear,\n  showClear,\n}) => (\n  <div\n    className={classNames(\n      'w-full p-[4px] flex items-center justify-between rounded-[8px]',\n      'overflow-hidden cursor-pointer border border-solid',\n      'hover:coz-mg-secondary-hovered active:coz-mg-secondary-pressed',\n      styles.trigger,\n      popoverVisible ? 'coz-stroke-hglt' : 'coz-stroke-primary',\n    )}\n  >\n    {model ? (\n      <ModelOptionThumb model={model} />\n    ) : (\n      <div className=\"text-xs coz-fg-dim\">{placeholder}</div>\n    )}\n    <IconCozArrowDown\n      className={classNames(\n        'coz-fg-secondary text-base',\n        styles['model-select-down-icon'],\n      )}\n    />\n    {showClear ? (\n      <span\n        className={classNames(\n          styles['model-select-clear-icon'],\n          'coze-select-clear-icon absolute right-[30px] cursor-pointer text-xs coz-fg-secondary hover:coz-mg-secondary-hovered flex items-center justify-center p-2',\n        )}\n        onClick={e => {\n          e.stopPropagation();\n          onClear?.();\n        }}\n      >\n        <IconCozCross />\n      </span>\n    ) : null}\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { isNumber } from 'lodash-es';\nimport classNames from 'classnames';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\nimport {\n  SETTING_ON_ERROR_NODES_CONFIG,\n  type SettingOnErrorExt,\n} from '@coze-workflow/nodes';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozInfoCircle } from '@coze-arch/coze-design/icons';\nimport { Tooltip } from '@coze-arch/coze-design';\n\nimport { type IModelValue } from '@/typing';\nimport { ModelSelect } from '@/components/model-select';\n\nimport { type SettingOnErrorItemProps } from '../../types';\nimport { Trigger } from './trigger';\n\nimport styles from './index.module.less';\n\ntype Props = SettingOnErrorItemProps<SettingOnErrorExt> & {\n  retryTimes?: number;\n};\n\n/**\n * Other configurations\n */\nexport const Ext: FC<Props> = ({\n  value,\n  onChange,\n  retryTimes,\n  readonly,\n}: Props) => {\n  const node = useCurrentEntity();\n  const enableBackupModel =\n    SETTING_ON_ERROR_NODES_CONFIG[node?.flowNodeType]?.enableBackupModel;\n\n  if (!enableBackupModel || !retryTimes || !isNumber(retryTimes)) {\n    return null;\n  }\n\n  const showClear = !!(!readonly && value?.backupLLmParam?.modelType);\n\n  const handleModelChange = v => {\n    const ext: SettingOnErrorExt = {\n      ...(value || {}),\n      backupLLmParam: v as IModelValue,\n    };\n    onChange?.(ext);\n  };\n\n  return (\n    <div className=\"flex items-center\">\n      <div className=\"w-[92px] text-xs font-medium coz-fg-primary flex items-center\">\n        {I18n.t('workflow_250407_203', undefined, '')}\n        <Tooltip\n          content={I18n.t(\n            'workflow_250407_204',\n            undefined,\n            '',\n          )}\n        >\n          <IconCozInfoCircle className=\"text-sm coz-fg-secondary ml-1.5\" />\n        </Tooltip>\n      </div>\n      <div className=\"flex-1\">\n        <ModelSelect\n          name=\"backupLLmParam\"\n          className={classNames(styles['model-select'], {\n            [styles['model-select-clearable']]: showClear,\n          })}\n          testName=\"setting-on-error.ext.backupLLmParam\"\n          value={\n            value?.backupLLmParam\n              ? (value.backupLLmParam as IModelValue)\n              : undefined\n          }\n          onChange={handleModelChange}\n          readonly={!!readonly}\n          popoverPosition=\"top\"\n          popoverAutoAdjustOverflow={true}\n          triggerRender={(model, popoverVisible) => (\n            <Trigger\n              model={model}\n              popoverVisible={popoverVisible}\n              placeholder={I18n.t(\n                'workflow_250416_04',\n                undefined,\n                '',\n              )}\n              showClear={showClear}\n              onClear={() => {\n                handleModelChange(undefined);\n              }}\n            />\n          )}\n        />\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  SettingOnErrorProcessType,\n  type SettingOnErrorValue,\n} from '@coze-workflow/nodes';\n\nexport const isException = (settingOnError?: SettingOnErrorValue) =>\n  !!(\n    settingOnError?.settingOnErrorIsOpen &&\n    settingOnError?.processType === SettingOnErrorProcessType.EXCEPTION\n  );\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useRef } from 'react';\n\nimport {\n  useCurrentEntity,\n  WorkflowDocument,\n  WorkflowLinesManager,\n  type WorkflowNodeEntity,\n  WorkflowNodeLinesData,\n  WorkflowNodePortsData,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  isSettingOnErrorDynamicPort,\n  type SettingOnErrorValue,\n} from '@coze-workflow/nodes';\nimport { type StandardNodeType } from '@coze-workflow/base';\n\nimport { isException } from '../utils/is-exception';\n\n/**\n * Exception wiring and port handling\n */\nconst handleLinesAndPort = ({\n  node,\n  hasException,\n}: {\n  node: WorkflowNodeEntity;\n  hasException: boolean;\n}) => {\n  const document = node.getService<WorkflowDocument>(WorkflowDocument);\n  const linesManager =\n    node.getService<WorkflowLinesManager>(WorkflowLinesManager);\n  const { outputLines } = node.getData(WorkflowNodeLinesData);\n  const portsData = node.getData<WorkflowNodePortsData>(WorkflowNodePortsData);\n\n  /**\n   * Node of dynamic port, just update the port.\n   */\n  if (isSettingOnErrorDynamicPort(node.flowNodeType as StandardNodeType)) {\n    portsData.updateDynamicPorts();\n    return;\n  }\n\n  /**\n   * Node on static port\n   * From normal to abnormal scenes, you need to change the output without portID to default, and complete the corresponding connection\n   * From an exception to an abnormal scene, you need to set the original connection with portID as default to empty, and complete the corresponding connection\n   */\n  let lines, outputPort;\n\n  if (hasException) {\n    lines = outputLines.filter(\n      l => !l.fromPort.portID && l.fromPort.portType === 'output',\n    );\n    outputPort = { type: 'output', portID: 'default' };\n  } else {\n    lines = outputLines.filter(\n      l => l.fromPort.portID === 'default' && l.fromPort.portType === 'output',\n    );\n    outputPort = { type: 'output' };\n  }\n\n  let newLines;\n  if (lines?.length) {\n    newLines = lines.map(l => ({\n      from: l.info.from,\n      to: l.info.to || '',\n      fromPort: outputPort.portID || '',\n      toPort: l.info.toPort || '',\n    }));\n    lines.forEach(l => {\n      document.removeNode(l);\n    });\n  }\n\n  portsData.updateStaticPorts([\n    {\n      type: 'input',\n    },\n    outputPort,\n  ]);\n\n  if (newLines?.length) {\n    newLines.forEach(l => {\n      linesManager.createLine(l);\n    });\n  }\n};\n\n/**\n * exception handling change triggering\n */\nexport const useExceptionChange = ({\n  value,\n}: {\n  value: SettingOnErrorValue;\n}) => {\n  const lastHasException = useRef(isException(value));\n  const node = useCurrentEntity();\n\n  useEffect(() => {\n    const hasException = isException(value);\n    if (lastHasException.current !== hasException) {\n      lastHasException.current = hasException;\n      handleLinesAndPort({\n        node,\n        hasException,\n      });\n    }\n  }, [value, node]);\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { SettingOnErrorProcessType } from '@coze-workflow/nodes';\n\nimport { Timeout } from '../timeout';\nimport { RetryTimes } from '../retry-times';\nimport { ProcessType } from '../process-type';\nimport { Json } from '../json';\nimport { Header } from '../header';\nimport { Ext } from '../ext';\nimport { type SettingOnErrorValue, type ErrorFormPropsV2 } from '../../types';\nimport { useExceptionChange } from '../../hooks/use-exception-change';\n\nexport const ErrorFormContent: React.FC<ErrorFormPropsV2> = ({\n  isOpen = false,\n  json,\n  onJSONChange,\n  readonly,\n  errorMsg,\n  defaultValue,\n  value,\n  onChange,\n  outputs,\n  isBatch,\n  syncOutputs,\n}) => {\n  useExceptionChange({ value });\n\n  const handleChange = (key: keyof SettingOnErrorValue, v) => {\n    onChange({\n      ...value,\n      [key]: v,\n    });\n  };\n\n  return (\n    <div className=\"pb-40\">\n      <div className=\"grid grid-cols-[5fr_5fr_8fr] gap-y-2 gap-x-1\">\n        <Header />\n        <Timeout\n          value={value?.timeoutMs}\n          onChange={timeoutMs => {\n            handleChange('timeoutMs', timeoutMs);\n          }}\n          readonly={readonly}\n        />\n        <RetryTimes\n          value={value?.retryTimes}\n          onChange={retryTimes => {\n            const newValue = { ...value };\n            onChange({\n              ...newValue,\n              retryTimes,\n            });\n          }}\n          readonly={readonly}\n        />\n        <ProcessType\n          value={value?.processType}\n          onChange={processType => {\n            const isBreak =\n              !processType || processType === SettingOnErrorProcessType.BREAK;\n            const settingOnErrorIsOpen = !isBreak;\n            onChange({\n              ...value,\n              processType,\n              settingOnErrorIsOpen,\n            });\n            syncOutputs?.(settingOnErrorIsOpen);\n          }}\n          readonly={readonly}\n          isBatch={isBatch}\n        />\n      </div>\n      <div className=\"mt-2\">\n        <Ext\n          value={value?.ext}\n          onChange={ext => {\n            handleChange('ext', ext);\n          }}\n          readonly={readonly}\n          retryTimes={value?.retryTimes}\n        />\n      </div>\n\n      <Json\n        isOpen={isOpen}\n        json={json}\n        onJSONChange={onJSONChange}\n        readonly={readonly}\n        defaultValue={defaultValue}\n        processType={value?.processType}\n        errorMsg={errorMsg}\n        outputs={outputs}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { StandardNodeType } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport { type ErrorFormPropsV2 } from '../../types';\nimport { FormCard } from '../../../form-card';\nimport { useExpand } from './use-exapand';\nimport { ErrorFormContent } from './content';\n\nexport const ErrorFormCard: React.FC<ErrorFormPropsV2> = ({\n  isOpen = false,\n  onSwitchChange,\n  json,\n  onJSONChange,\n  readonly,\n  errorMsg,\n  defaultValue,\n  noPadding,\n  ...props\n}) => {\n  let tooltip = I18n.t(\n    'workflow_250421_03',\n    undefined,\n    ',',\n  );\n  const node = useCurrentEntity();\n  if (node.flowNodeType === StandardNodeType.LLM) {\n    tooltip += I18n.t(\n      'workflow_250416_03',\n      undefined,\n      '',\n    );\n  }\n  const expand = useExpand(props.value);\n\n  return (\n    <FormCard\n      header={I18n.t('workflow_250416_01')}\n      tooltip={tooltip}\n      noPadding={noPadding}\n      defaultExpand={expand}\n      testId=\"setting-on-error\"\n    >\n      <ErrorFormContent\n        isOpen={isOpen}\n        onSwitchChange={onSwitchChange}\n        json={json}\n        onJSONChange={onJSONChange}\n        readonly={readonly}\n        errorMsg={errorMsg}\n        defaultValue={defaultValue}\n        noPadding={noPadding}\n        {...props}\n      />\n    </FormCard>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useMemo } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\n\nimport { type ErrorFormPropsV2 } from '../../types';\nimport { ErrorFormCard } from './card';\n\nexport const ErrorForm: React.FC<ErrorFormPropsV2> = ({\n  isOpen = false,\n  json,\n  onSwitchChange,\n  onJSONChange,\n  readonly,\n  errorMsg,\n  defaultValue,\n  noPadding,\n  ...props\n}) => {\n  const hasError = useMemo(() => {\n    if (!isOpen) {\n      return { rs: true };\n    } else {\n      // If there is an external error, just report the error directly.\n      if (errorMsg) {\n        return { rs: false, msg: errorMsg };\n      }\n      // When isOpen = true for the first time, json will be given the default value, and json = undefined for a moment. Just return true, otherwise it will flash.\n      if (json === undefined) {\n        return { rs: true };\n      }\n      try {\n        const obj = JSON.parse(json);\n        if (typeof obj !== 'object') {\n          return {\n            rs: false,\n            msg: I18n.t('workflow_exception_ignore_json_error'),\n          };\n        }\n        return { rs: true };\n        // eslint-disable-next-line @coze-arch/use-error-in-catch\n      } catch (e) {\n        return {\n          rs: false,\n          msg: I18n.t('workflow_exception_ignore_json_error'),\n        };\n      }\n    }\n  }, [isOpen, json, errorMsg]);\n\n  return (\n    <ErrorFormCard\n      isOpen={isOpen}\n      json={json}\n      onSwitchChange={onSwitchChange}\n      onJSONChange={onJSONChange}\n      readonly={readonly}\n      errorMsg={hasError.msg}\n      defaultValue={defaultValue}\n      noPadding={noPadding}\n      {...props}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { type SettingOnErrorProps } from './types';\nimport { useSettingOnError } from './hooks/use-setting-on-error';\nimport { ErrorForm } from './error-form';\nimport { ErrorForm as ErrorFormV2 } from './components';\n\nexport const SettingOnError: FC<SettingOnErrorProps> = ({\n  value,\n  onChange,\n  batchModePath,\n  outputsPath,\n  readonly,\n  context,\n  options,\n  noPadding,\n}) => {\n  const { isSettingOnErrorV2, ...settingOnError } = useSettingOnError({\n    value,\n    onChange,\n    batchModePath,\n    outputsPath,\n    context,\n    options,\n  });\n  if (isSettingOnErrorV2) {\n    return (\n      <ErrorFormV2\n        {...settingOnError}\n        readonly={readonly}\n        noPadding={noPadding}\n      />\n    );\n  }\n  return (\n    <ErrorForm {...settingOnError} readonly={readonly} noPadding={noPadding} />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable complexity */\n/* eslint-disable max-lines-per-function */\nimport { useState } from 'react';\n\nimport { useDebounceEffect } from 'ahooks';\nimport {\n  useForm,\n  isFormV2,\n  useCurrentEntity,\n} from '@flowgram-adapter/free-layout-editor';\nimport {\n  getExcludeErrorBody,\n  getOutputsWithErrorBody,\n  useIsSettingOnErrorV2,\n} from '@coze-workflow/nodes';\nimport { BatchMode, ResponseFormat } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { outputsVerify } from '../utils/';\nimport { type SettingOnErrorValue, type SettingOnErrorProps } from '../types';\nimport { useRefreshOnVariableChange } from './use-refresh-on-variable-change';\nimport { useJSONWithOutputs } from './use-json-with-outputs';\nimport { useBatchChange } from './use-batch-change';\n\ntype Props = Pick<\n  SettingOnErrorProps,\n  'value' | 'onChange' | 'batchModePath' | 'outputsPath' | 'context' | 'options'\n>;\n\nexport function useSettingOnError({\n  value,\n  onChange,\n  batchModePath,\n  outputsPath,\n  context,\n  options,\n}: Props) {\n  const { settingOnErrorIsOpen, settingOnErrorJSON } = value || {};\n  const isSettingOnErrorV2 = useIsSettingOnErrorV2();\n\n  const form = useForm();\n  const node = useCurrentEntity();\n  const formV2 = isFormV2(node);\n\n  useRefreshOnVariableChange(node);\n\n  let batchMode: BatchMode | undefined;\n\n  if (formV2) {\n    batchMode = batchModePath ? form.getValueIn(batchModePath) : undefined;\n  } else {\n    batchMode = options?.batchMode;\n  }\n\n  let outputs;\n  if (formV2) {\n    outputs = outputsPath ? form.getValueIn(outputsPath) : undefined;\n  } else {\n    outputs = options?.outputs;\n  }\n\n  const isBatch = batchMode === BatchMode.Batch;\n  useBatchChange({\n    value,\n    onChange,\n    isBatch,\n    isSettingOnErrorV2,\n  });\n\n  /**\n   * Why add anti-shake?\n   * Because the changes of isBatch outputs are not synchronized, you will get results that do not meet expectations.\n   * */\n  const [args, setArgs] = useState({\n    isOpen: settingOnErrorIsOpen,\n    json: settingOnErrorJSON,\n    isBatch,\n    outputs: getExcludeErrorBody({\n      value: outputs,\n      isBatch,\n      isSettingOnErrorV2,\n    }),\n  });\n\n  useDebounceEffect(\n    () => {\n      setArgs({\n        isOpen: settingOnErrorIsOpen,\n        json: settingOnErrorJSON,\n        isBatch,\n        outputs: getExcludeErrorBody({\n          value: outputs,\n          isBatch,\n          isSettingOnErrorV2,\n        }),\n      });\n    },\n    [settingOnErrorIsOpen, settingOnErrorJSON, isBatch, outputs],\n    {\n      wait: 100,\n    },\n  );\n\n  const { value: json, defaultValue: defaultJSON } = useJSONWithOutputs({\n    ...args,\n    /**\n     * Why pass onJSONChange?\n     * 1. output structure changes need to actively modify json\n     * 2. Turn on the switch for the first time and automatically generate json according to the output structure\n     * */\n    onJSONChange: v => {\n      onChange({\n        ...value,\n        settingOnErrorJSON: v as string,\n      });\n    },\n  });\n\n  const syncOutputs = (isOpen: boolean) => {\n    // If the ignore exception is turned on, the errorBody must be appended to the output; otherwise, it must be rejected\n    if (formV2) {\n      const outputsValue = form.getValueIn('outputs');\n      if (outputs) {\n        form.setValueIn(\n          'outputs',\n          getOutputsWithErrorBody({\n            value: outputsValue,\n            isBatch,\n            isOpen,\n            isSettingOnErrorV2,\n          }),\n        );\n      }\n    } else {\n      const outputItem = context?.form.getFormItemByPath('/outputs');\n      if (outputItem?.value) {\n        outputItem.value = getOutputsWithErrorBody({\n          value: outputItem?.value,\n          isBatch,\n          isOpen,\n          isSettingOnErrorV2,\n        });\n      }\n    }\n\n    // If the ignore exception is turned on, change the output type of the model to json (for the llm node, other nodes cannot get the modelItem).\n    if (formV2) {\n      const modelValue = form.getValueIn('model');\n      if (\n        isOpen &&\n        modelValue &&\n        modelValue?.responseFormat !== ResponseFormat.JSON\n      ) {\n        form.setValueIn('model', {\n          ...modelValue,\n          responseFormat: ResponseFormat.JSON,\n        });\n      }\n    } else {\n      const modelItem = context?.form.getFormItemByPath('/model');\n      if (\n        isOpen &&\n        modelItem?.value &&\n        modelItem?.value?.responseFormat !== ResponseFormat.JSON\n      ) {\n        modelItem.value = {\n          ...modelItem?.value,\n          responseFormat: ResponseFormat.JSON,\n        };\n      }\n    }\n  };\n\n  const settingOnError = {\n    isOpen: settingOnErrorIsOpen,\n    defaultValue: defaultJSON,\n    json,\n    onSwitchChange: isOpen => {\n      const newValue: SettingOnErrorValue = {\n        ...value,\n        settingOnErrorIsOpen: isOpen,\n      };\n\n      onChange(newValue);\n      syncOutputs(isOpen);\n    },\n    onJSONChange: v => {\n      onChange({\n        ...value,\n        settingOnErrorJSON: v ?? '',\n      });\n    },\n    errorMsg: outputsVerify(outputs)\n      ? undefined\n      : I18n.t('workflow_exception_json_error'),\n    value,\n    onChange,\n    outputs,\n    isSettingOnErrorV2,\n    isBatch,\n    syncOutputs,\n  };\n  return settingOnError;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\n\nimport {\n  useRefresh,\n  type FlowNodeEntity,\n} from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowNodeOutputVariablesData } from '@coze-workflow/variable';\n\nexport function useRefreshOnVariableChange(node: FlowNodeEntity) {\n  const refresh = useRefresh();\n\n  const outputVariablesData: WorkflowNodeOutputVariablesData = node.getData(\n    WorkflowNodeOutputVariablesData,\n  );\n\n  useEffect(() => {\n    const disposable = outputVariablesData.onAnyVariablesChange(() => {\n      // Refresh after variable type changes\n      refresh();\n    });\n\n    return () => disposable?.dispose();\n  }, [outputVariablesData, refresh]);\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type CSSProperties } from 'react';\n\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { Slider } from '@coze-arch/coze-design';\n\nexport const SliderWithInput = (props: {\n  value: number;\n  onChange: (v: number) => void;\n  max: number;\n  min: number;\n  sliderStyle?: CSSProperties;\n  inputStyle?: CSSProperties;\n  readonly: boolean;\n  marks?: {\n    [key: number]: string;\n  };\n}) => {\n  const {\n    value,\n    onChange,\n    max,\n    min,\n    sliderStyle = { width: 300 },\n    readonly,\n    marks,\n  } = props;\n\n  const { getNodeSetterId } = useNodeTestId();\n\n  return (\n    <div className=\"flex\">\n      <Slider\n        data-testid={getNodeSetterId('slider-with-input-slider')}\n        max={max}\n        min={min}\n        value={value}\n        onChange={val => {\n          onChange(val as number);\n        }}\n        style={sliderStyle}\n        readonly={readonly}\n        disabled={readonly}\n        marks={marks}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type MouseEvent } from 'react';\n\nimport { IconCozArrowDown } from '@coze-arch/coze-design/icons';\n\nexport const ExpandIcon = ({\n  onClick,\n}: {\n  onClick?: (e: MouseEvent) => void;\n}) => (\n  <IconCozArrowDown\n    className=\"coz-fg-secondary text-xs semi-tree-option-expand-icon\"\n    onClick={onClick}\n  />\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  useEffect,\n  useRef,\n  useImperativeHandle,\n  type ReactNode,\n  type CSSProperties,\n} from 'react';\n\nimport classNames from 'classnames';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { Tree } from '@coze-arch/coze-design';\nimport { type TreeNodeData, type TreeProps } from '@coze-arch/bot-semi/Tree';\n\nimport { renderLabelWithItem } from './utils';\nimport { ExpandIcon } from './expand-icon';\nimport { useTreeVariableSelectorContext } from './context';\n\nimport styles from './node-variable-tree.module.less';\n\ninterface NodeVariableTreeProps {\n  dataSource?: TreeNodeData[];\n  onSelect?: (data?: TreeNodeData) => void;\n  className?: string;\n  outerTopSlot?: ReactNode;\n  innerTreeStyle?: CSSProperties;\n  emptyContent?: ReactNode;\n}\n\nexport const NodeVariableTree = React.forwardRef(\n  (props: NodeVariableTreeProps, ref) => {\n    const {\n      value,\n      query,\n      forArrayItem,\n      testId = '',\n    } = useTreeVariableSelectorContext();\n    const {\n      dataSource = [],\n      onSelect,\n      className,\n      outerTopSlot,\n      innerTreeStyle = {},\n      emptyContent,\n    } = props;\n    const { concatTestId } = useNodeTestId();\n\n    const treeContainerRef = useRef(null);\n\n    const treeRef = useRef<Tree>(null);\n\n    useImperativeHandle(ref, () => ({\n      treeContainerRef: treeContainerRef?.current,\n      treeRef: treeRef?.current,\n    }));\n\n    useEffect(() => {\n      treeRef.current?.search(query ?? '');\n    }, [query, treeRef.current]);\n\n    const handleSelect: TreeProps['onSelect'] = (\n      selectedKey,\n      selected,\n      selectedNode,\n    ) => {\n      onSelect?.(selectedNode);\n    };\n\n    return (\n      <div\n        ref={treeContainerRef}\n        className={classNames(\n          className,\n          styles['node-variable-tree-wrapper'],\n          'overflow-auto',\n        )}\n      >\n        {outerTopSlot}\n        <Tree\n          ref={treeRef}\n          filterTreeNode\n          showFilteredOnly\n          blockNode={false}\n          searchRender={false}\n          className={styles['node-variable-tree']}\n          defaultValue={{\n            key: value?.join('-'),\n            value: value?.join('-'),\n          }}\n          defaultExpandAll\n          treeData={dataSource}\n          style={{\n            minWidth: 240,\n            ...innerTreeStyle,\n          }}\n          emptyContent={emptyContent}\n          onChangeWithObject\n          onSelect={handleSelect}\n          renderFullLabel={({\n            className: labelClassName,\n            onExpand,\n            data,\n            onCheck,\n            expandStatus,\n          }) => {\n            const isLeaf = !(data.children && data.children.length);\n            return (\n              <li\n                className={classNames(labelClassName, '!mb-0.5')}\n                role=\"treeitem\"\n                onClick={onCheck}\n                data-key={data.key}\n              >\n                {isLeaf ? (\n                  <span className=\"semi-tree-option-empty-icon\"></span>\n                ) : (\n                  <ExpandIcon onClick={onExpand} />\n                )}\n                <span className=\"text-xs pr-1 variable-tree-node-label\">\n                  {renderLabelWithItem(\n                    data,\n                    forArrayItem,\n                    query,\n                    concatTestId(testId, data?.path),\n                  )}\n                </span>\n              </li>\n            );\n          }}\n        />\n      </div>\n    );\n  },\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport classnames from 'classnames';\nimport { isGlobalVariableKey } from '@coze-workflow/variable';\nimport { useNodeTestId, type ViewVariableType } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { type TreeNodeData } from '@coze-arch/bot-semi/Tree';\nimport { IconCozArrowRight } from '@coze-arch/coze-design/icons';\nimport { Popover } from '@coze-arch/coze-design';\n\nimport { useGlobalState } from '@/hooks';\nimport {\n  BotProjectVariableSelect,\n  EmptyVariableContent,\n} from '@/components/test-run/bot-project-variable-select';\n\nimport { SelectType } from './types';\nimport { NodeVariableTree } from './node-variable-tree';\nimport { useTreeVariableSelectorContext } from './context';\n\nimport styles from './index.module.less';\n\ninterface CompositeSelectOptionProps {\n  data: TreeNodeData & { type?: ViewVariableType };\n  active?: boolean;\n  selected?: boolean;\n  onMouseOver?: React.MouseEventHandler<HTMLDivElement>;\n  onMouseLeave?: React.MouseEventHandler<HTMLDivElement>;\n  onSelect?: (data?: TreeNodeData, type?: SelectType) => void;\n  getPopupContainer?: () => HTMLElement;\n}\n\nexport const CompositeSelectOption = React.forwardRef(\n  (props: CompositeSelectOptionProps, ref) => {\n    const { testId = '' } = useTreeVariableSelectorContext();\n    const {\n      data,\n      active,\n      onMouseOver,\n      onMouseLeave,\n      onSelect,\n      getPopupContainer,\n      selected,\n    } = props;\n\n    const { isInIDE } = useGlobalState();\n    const useNewGlobalVariableCache = !isInIDE;\n    const isGlobalVar = isGlobalVariableKey(`${data.value || ''}`);\n\n    const hasContent =\n      (isGlobalVar && useNewGlobalVariableCache) ||\n      Boolean(data.children?.length);\n\n    const { concatTestId } = useNodeTestId();\n\n    return (\n      <div\n        className=\"w-full relative\"\n        onMouseOver={onMouseOver}\n        onMouseLeave={onMouseLeave}\n      >\n        <Popover\n          getPopupContainer={getPopupContainer}\n          motion={false}\n          autoAdjustOverflow\n          position=\"leftTop\"\n          trigger=\"custom\"\n          visible={active && hasContent}\n          rePosKey={Math.random()}\n          style={{\n            borderRadius: 8,\n            transform: 'translateY(-4px)',\n          }}\n          content={\n            isGlobalVar && useNewGlobalVariableCache ? (\n              <BotProjectVariableSelect\n                className={'!p-0'}\n                relatedBotPanelStyle={{\n                  width: '254px',\n                  height: 'unset',\n                  maxHeight: '290px',\n                }}\n                customVariablePanel={\n                  <NodeVariableTree\n                    ref={ref}\n                    dataSource={data.children}\n                    onSelect={onSelect}\n                    className={styles['bot-select-node-variable-tree']}\n                    innerTreeStyle={{\n                      width: '254px',\n                      minWidth: 'unset',\n                    }}\n                    outerTopSlot={\n                      data.children && data.children.length > 0 ? (\n                        <div\n                          className={\n                            'coz-fg-secondary mt-8px mb-4px pl-28px text-[12px] font-medium leading-16px'\n                          }\n                        >\n                          {I18n.t(\n                            'variable_binding_please_select_a_variable',\n                            {},\n                            '',\n                          )}\n                        </div>\n                      ) : undefined\n                    }\n                    emptyContent={\n                      <EmptyVariableContent className={'pt-32px pb-32px'} />\n                    }\n                  />\n                }\n              />\n            ) : (\n              <NodeVariableTree\n                ref={ref}\n                dataSource={data.children}\n                onSelect={onSelect}\n              />\n            )\n          }\n        >\n          <div\n            data-testid={concatTestId(testId, data.name)}\n            className={classnames(\n              'p-1 flex items-center cursor-pointer hover:coz-mg-primary active:coz-mg-primary-pressed h-6 rounded-[4px]',\n              {\n                'coz-mg-primary': active,\n              },\n            )}\n            onClick={() => {\n              onSelect?.(data, SelectType.Option);\n            }}\n          >\n            <div className={styles['option-icon-wrapper']}>{data.icon}</div>\n            <div\n              className={classnames('flex-1 ml-1 truncate text-xs', {\n                'coz-fg-hglt font-semibold': selected,\n              })}\n            >\n              {data.label}\n            </div>\n            {hasContent ? (\n              <IconCozArrowRight className=\"coz-fg-secondary\" />\n            ) : null}\n          </div>\n        </Popover>\n      </div>\n    );\n  },\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type ReactNode, useCallback, useMemo, useState } from 'react';\n\nimport classnames from 'classnames';\nimport { Divider, List } from '@coze-arch/coze-design';\nimport type { TreeNodeData } from '@coze-arch/bot-semi/Tree';\n\nimport { sortTreeDataByGroup } from './utils';\nimport type { ITreeNodeData, SelectType } from './types';\nimport { CompositeSelectOption } from './composite-select-option';\n\nimport styles from './composite-select.module.less';\n\ninterface Props {\n  treeData?: ITreeNodeData[];\n  onOptionHover?: (option: TreeNodeData) => void;\n  onSelect?: (data?: TreeNodeData, type?: SelectType) => void;\n  getOptionPopupContainer?: () => HTMLElement;\n  activeOption?: string | number | undefined;\n  emptyContent?: ReactNode;\n  extraOption?: ReactNode;\n  value?: string[];\n  controlledActive?: boolean;\n}\n\nconst CompositeSelectTreePanel = React.forwardRef(\n  (\n    {\n      treeData,\n      onOptionHover,\n      onSelect,\n      getOptionPopupContainer,\n      activeOption,\n      emptyContent,\n      extraOption,\n      value,\n      controlledActive = true,\n    }: Props,\n    treeRef,\n  ) => {\n    const treeDataSortByGroup = useMemo(\n      () => sortTreeDataByGroup(treeData),\n      [treeData],\n    );\n\n    const handleOptionHover = useCallback(\n      (option: TreeNodeData) => {\n        onOptionHover?.(option);\n      },\n      [onOptionHover],\n    );\n\n    const [isHoverOption, setIsHoverOption] = useState(false);\n\n    const treeListWrapperMaxHeight = useMemo(\n      () =>\n        treeDataSortByGroup?.find(item => item.groupId) ? '262px' : '252px',\n      [treeDataSortByGroup],\n    );\n\n    const isNodeVariable = value?.length === 1;\n\n    const renderContent = () => {\n      if (!extraOption) {\n        return treeDataSortByGroup?.length ? (\n          <List>\n            {treeDataSortByGroup?.map((item, index) => (\n              <>\n                {treeDataSortByGroup[index - 1] &&\n                treeDataSortByGroup[index - 1].groupId !== item.groupId ? (\n                  <Divider style={{ width: 'calc(100% - 8px)' }} margin={4} />\n                ) : null}\n                <List.Item className=\"!p-0 !border-none\">\n                  <CompositeSelectOption\n                    ref={treeRef}\n                    data={item}\n                    active={\n                      isHoverOption\n                        ? item.value === activeOption\n                        : item.value === activeOption && controlledActive\n                    }\n                    onMouseOver={() => {\n                      handleOptionHover(item);\n                      setIsHoverOption(true);\n                    }}\n                    onSelect={onSelect}\n                    getPopupContainer={getOptionPopupContainer}\n                  />\n                </List.Item>\n              </>\n            ))}\n          </List>\n        ) : (\n          <div className=\"px-6 py-3 coz-fg-secondary text-center\">\n            {emptyContent}\n          </div>\n        );\n      }\n\n      return (\n        <>\n          {extraOption}\n\n          <List>\n            {treeDataSortByGroup?.map((item, index) => (\n              <>\n                {treeDataSortByGroup[index - 1] &&\n                treeDataSortByGroup[index - 1].groupId !== item.groupId ? (\n                  <Divider style={{ width: 'calc(100% - 8px)' }} margin={4} />\n                ) : null}\n                <List.Item className=\"!p-0 !border-none\">\n                  <CompositeSelectOption\n                    data={item}\n                    active={\n                      isHoverOption\n                        ? item.value === activeOption\n                        : item.value === activeOption && controlledActive\n                    }\n                    selected={isNodeVariable && item.value === value?.[0]}\n                    onMouseOver={() => {\n                      handleOptionHover(item);\n                      setIsHoverOption(true);\n                    }}\n                    onSelect={onSelect}\n                    getPopupContainer={getOptionPopupContainer}\n                  />\n                </List.Item>\n              </>\n            ))}\n          </List>\n        </>\n      );\n    };\n\n    return (\n      <div\n        className={classnames('w-full', styles['node-list-wrapper'])}\n        style={{\n          maxHeight: treeListWrapperMaxHeight,\n        }}\n      >\n        {/* The Search component of coze-design will cause an error in the popover positioning. Please note for the time being. */}\n        {/* <Search className=\"mb-1\" value={query} onChange={setQuery} /> */}\n        {renderContent()}\n      </div>\n    );\n  },\n);\n\nexport default CompositeSelectTreePanel;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createContext, useContext } from 'react';\n\nimport { type ViewVariableMeta } from '@coze-workflow/variable';\nimport { type TreeNodeData } from '@coze-arch/bot-semi/Tree';\n\ninterface TreeVariableSelectorContext {\n  value?: string[];\n  dataSource?: TreeNodeData[];\n  query?: string;\n  setQuery?: (query: string) => void;\n  forArrayItem?: boolean;\n  invalidContent?: string;\n  testId?: string;\n  valueSubVariableMeta: ViewVariableMeta | null;\n  displayVarName?: string;\n  isUnknownValue?: boolean;\n}\n\nconst TreeVariableSelectorContext = createContext<TreeVariableSelectorContext>({\n  valueSubVariableMeta: null,\n});\n\nexport const useTreeVariableSelectorContext = () =>\n  useContext(TreeVariableSelectorContext);\n\nexport { TreeVariableSelectorContext };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type ReactNode } from 'react';\n\nimport { GlobalVariableKey } from '@coze-workflow/variable';\nimport {\n  IconCozFolder,\n  IconCozPeople,\n  IconCozSetting,\n} from '@coze-arch/coze-design/icons';\n\nconst GLOBAL_VAR_ICON_MAP: Record<string, ReactNode> = {\n  [GlobalVariableKey.App]: <IconCozFolder />,\n  [GlobalVariableKey.User]: <IconCozPeople />,\n  [GlobalVariableKey.System]: <IconCozSetting />,\n};\n\nexport default function GlobalVarIcon({ nodeId }: { nodeId: string }) {\n  return <>{GLOBAL_VAR_ICON_MAP[nodeId]}</>;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport classnames from 'classnames';\nimport { type WithCustomStyle } from '@coze-workflow/base/types';\nimport { Popover, Space } from '@coze-arch/coze-design';\nimport { type TreeNodeData } from '@coze-arch/bot-semi/Tree';\n\nimport { NodeIcon } from '../../../components/node-icon';\nimport { getLabelPath } from './utils';\nimport { useTreeVariableSelectorContext } from './context';\n\nimport styles from './index.module.less';\n\nconst findRootNode = (value: string[], dataSource: TreeNodeData[]) => {\n  const [nodeId] = value;\n  if (!nodeId) {\n    return {};\n  }\n\n  const nodeInfo = dataSource.find(item => item.value === nodeId);\n\n  return nodeInfo ?? {};\n};\n\nexport const ValueDisplay: FC<WithCustomStyle> = props => {\n  const {\n    value,\n    dataSource,\n    invalidContent,\n    valueSubVariableMeta,\n    displayVarName: variableName,\n    isUnknownValue,\n  } = useTreeVariableSelectorContext();\n  const { className } = props;\n\n  if (!value || !valueSubVariableMeta?.name) {\n    return null;\n  }\n\n  if (isUnknownValue) {\n    return invalidContent ? (\n      <span className=\"absolute h-full max-w-[calc(100% - 8px)] truncate\">\n        <span\n          className=\"flex items-center h-full text-sm\"\n          style={{\n            color: 'var(--semi-color-text-0)',\n          }}\n        >\n          {invalidContent}\n        </span>\n      </span>\n    ) : null;\n  }\n\n  const rootNode = findRootNode(value, dataSource ?? []);\n\n  const path = getLabelPath(dataSource ?? [], value as string[]);\n  const content = path.slice(1).join('/');\n\n  return (\n    <Popover\n      showArrow\n      position=\"top\"\n      trigger=\"hover\"\n      spacing={20}\n      className={styles.popoverContainer}\n      content={\n        <div className={classnames(styles.popover, 'cursor-pointer')}>\n          <div className={styles.header}>\n            <NodeIcon size={16} nodeId={rootNode.value as string} />\n            <p className={styles.title}>{rootNode.label}</p>\n          </div>\n          <div className={styles.content}>\n            <p>{content}</p>\n          </div>\n        </div>\n      }\n    >\n      <span\n        className={classnames(\n          'absolute h-full max-w-[calc(100% - 8px)]',\n          'semi-tree-select-selection-TriggerSearchItem',\n          className,\n        )}\n      >\n        <span\n          className={\n            'text-xs inline-block h-full truncate cursor-text max-w-full'\n          }\n        >\n          <Space spacing={4} className=\"h-full\">\n            <span\n              className=\"font-semibold\"\n              style={{\n                color: 'var(--coz-fg-secondary)',\n              }}\n            >\n              {rootNode.label}\n            </span>\n            <span\n              className=\"font-semibold\"\n              style={{\n                color: 'var(--coz-fg-secondary)',\n              }}\n            >\n              -\n            </span>\n            <span className=\"truncate\">{variableName}</span>\n          </Space>\n        </span>\n      </span>\n    </Popover>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  type FC,\n  useState,\n  type ReactNode,\n  useRef,\n  useCallback,\n} from 'react';\n\nimport classnames from 'classnames';\nimport { IconCozArrowDown } from '@coze-arch/coze-design/icons';\nimport { Popover, Input } from '@coze-arch/coze-design';\nimport type { TreeNodeData } from '@coze-arch/bot-semi/Tree';\nimport { type ValidateStatus } from '@coze-arch/bot-semi/Input';\nimport { IconClear } from '@douyinfe/semi-icons';\n\nimport { ValueDisplay } from './value-display';\nimport { type ITreeNodeData } from './types';\nimport { useTreeVariableSelectorContext } from './context';\nimport CompositeSelectTreePanel from './composite-select-tree-panel';\n\nimport styles from './composite-select.module.less';\n\ninterface CompositeSelectProps {\n  id?: string;\n  value?: string[];\n  treeData?: ITreeNodeData[];\n  onChange?: (value?: ITreeNodeData) => void;\n  onBlur?: (e: React.MouseEvent) => void;\n  invalidContent?: string;\n  placeholder?: string;\n  emptyContent?: ReactNode;\n  disabled?: boolean;\n  readonly?: boolean;\n  validateStatus?: ValidateStatus;\n  onSelect?: (data?: ITreeNodeData) => void;\n  onClear?: () => void;\n  showClear?: boolean;\n  trigger?: ReactNode;\n  onPopoverVisibleChange?: (visible: boolean) => void;\n  renderExtraOption?: (\n    data?: TreeNodeData[],\n    action?: {\n      hiddenPopover: () => void;\n    },\n  ) => ReactNode;\n  popoverStyle?: React.CSSProperties;\n}\n\nconst SELECT_POPOVER_CLASS = 'tree-variable-selector-popover';\nconst DEFAULT_MIN_WIDTH = 200;\n\nexport const CompositeSelect: FC<CompositeSelectProps> = props => {\n  const {\n    value,\n    treeData,\n    placeholder,\n    emptyContent,\n    disabled,\n    readonly,\n    validateStatus,\n    onSelect,\n    onBlur,\n    showClear,\n    onClear,\n    trigger,\n    onPopoverVisibleChange,\n    renderExtraOption,\n    popoverStyle = {},\n  } = props;\n  const { query, setQuery, testId, valueSubVariableMeta } =\n    useTreeVariableSelectorContext();\n  const [activeOption, setActiveOption] = useState<string | undefined>(\n    value?.[0],\n  );\n\n  const [focus, setFocus] = useState(false);\n  const [popoverVisible, setPopoverVisible] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const triggerRef = useRef<HTMLDivElement>(null);\n\n  const handleFocus = () => {\n    setFocus(true);\n    inputRef.current?.focus();\n  };\n\n  const handleVisibilityChange = (visibility: boolean) => {\n    if (!visibility) {\n      setFocus(false);\n      setQuery?.('');\n    }\n    setPopoverVisible(visibility);\n    onPopoverVisibleChange?.(visibility);\n  };\n\n  const getOptionPopupContainer = useCallback(\n    () =>\n      (document.querySelector(`.${SELECT_POPOVER_CLASS}`) as HTMLElement) ||\n      document.body,\n    [],\n  );\n\n  const handleOptionHover = useCallback(\n    (option: TreeNodeData) => {\n      setActiveOption(option?.value as string);\n    },\n    [setActiveOption],\n  );\n\n  const handleSelect = useCallback(\n    (data?: TreeNodeData) => {\n      onSelect?.(data);\n      setPopoverVisible(false);\n    },\n    [onSelect, setPopoverVisible],\n  );\n\n  const renderExtraOptionWithWrapper = () => {\n    const extraOptionNode = renderExtraOption?.(treeData, {\n      hiddenPopover: () => setPopoverVisible(false),\n    });\n\n    if (!extraOptionNode) {\n      return undefined;\n    }\n\n    return (\n      <div onMouseOver={() => setActiveOption(undefined)}>\n        {extraOptionNode}\n      </div>\n    );\n  };\n\n  return (\n    <Popover\n      className={SELECT_POPOVER_CLASS}\n      motion={false}\n      position=\"bottomLeft\"\n      trigger=\"click\"\n      visible={popoverVisible}\n      onVisibleChange={handleVisibilityChange}\n      style={{\n        minWidth: triggerRef.current?.clientWidth || DEFAULT_MIN_WIDTH,\n        maxWidth: 340,\n        borderRadius: 8,\n        ...popoverStyle,\n      }}\n      content={\n        <CompositeSelectTreePanel\n          treeData={treeData}\n          activeOption={activeOption}\n          emptyContent={emptyContent}\n          onSelect={handleSelect}\n          onOptionHover={handleOptionHover}\n          getOptionPopupContainer={getOptionPopupContainer}\n          extraOption={renderExtraOptionWithWrapper()}\n          value={value}\n        />\n      }\n    >\n      {trigger ? (\n        trigger\n      ) : (\n        <div\n          ref={triggerRef}\n          role=\"combobox\"\n          data-testid={testId}\n          className={classnames(\n            'semi-select semi-select-small relative !w-full flex bg-transparent rounded-[6px]',\n            styles['composite-select'],\n            {\n              [styles['composite-select-focus']]: focus,\n              'pointer-events-auto': !readonly,\n              'pointer-events-none': readonly,\n              [styles['composite-select-error']]: validateStatus === 'error',\n              [styles['has-value']]: !!value?.length,\n              [styles['show-clear']]: showClear,\n            },\n          )}\n          onFocus={handleFocus}\n          onBlur={onBlur as unknown as React.FocusEventHandler<HTMLDivElement>}\n        >\n          <div\n            className={classnames('relative pl-1 flex-1', {\n              'cursor-not-allowed': disabled || readonly,\n            })}\n            onClick={e => {\n              if (disabled || readonly) {\n                e.preventDefault();\n                e.stopPropagation();\n              }\n            }}\n          >\n            {!query && value?.length ? (\n              <ValueDisplay\n                className={classnames({\n                  'opacity-60': focus,\n                })}\n              />\n            ) : null}\n            <div className=\"h-full flex items-center\">\n              <Input\n                ref={inputRef}\n                borderless\n                placeholder={valueSubVariableMeta ? '' : placeholder}\n                className={classnames(\n                  'h-full !bg-transparent !hover:border-none !p-0.5 flex items-center',\n                  styles['composite-select-input-wrapper'],\n                )}\n                disabled={disabled}\n                value={query}\n                onChange={setQuery}\n                size=\"small\"\n              />\n            </div>\n          </div>\n\n          <div\n            className={classnames(\n              'semi-select-arrow w-6 h-full right-0 flex items-center justify-center',\n              {\n                'cursor-not-allowed': disabled || readonly,\n              },\n            )}\n            onClick={e => {\n              if (disabled || readonly) {\n                e.preventDefault();\n                e.stopPropagation();\n              }\n            }}\n          >\n            {!disabled && !readonly && (\n              <IconClear\n                className={styles['select-clear']}\n                onClick={e => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  onClear?.();\n                }}\n              />\n            )}\n            <IconCozArrowDown\n              className={`text-base ${styles['select-arrow-down']}`}\n            />\n          </div>\n        </div>\n      )}\n    </Popover>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  type FC,\n  useCallback,\n  useState,\n  useEffect,\n  useRef,\n  type ReactNode,\n} from 'react';\n\nimport { isArray } from 'lodash-es';\nimport {\n  isGlobalVariableKey,\n  useVariableRename,\n  useWorkflowVariableByKeyPath,\n} from '@coze-workflow/variable';\nimport { type ViewVariableType } from '@coze-workflow/variable';\nimport { type WithCustomStyle } from '@coze-workflow/base/types';\nimport { I18n } from '@coze-arch/i18n';\nimport { usePersistCallback, useUpdateEffect } from '@coze-arch/hooks';\nimport { type TreeSelectProps } from '@coze-arch/bot-semi/TreeSelect';\nimport { type TreeNodeData } from '@coze-arch/bot-semi/Tree';\nimport { IconCozVariables } from '@coze-arch/coze-design/icons';\n\nimport useGlobalVariableCache from '@/form-extensions/components/tree-variable-selector/use-global-variable-cache';\nimport GlobalVarIcon from '@/form-extensions/components/tree-variable-selector/global-var-icon';\n\nimport { NodeIcon } from '../../../components/node-icon';\nimport {\n  formatDataWithGlobalVariable,\n  processDataSourceLabelRender,\n} from './utils';\nimport { useFormatVariableDataSource } from './useFormatVariableDataSource';\nimport {\n  type CustomFilterVar,\n  type RenderDisplayVarName,\n  type VariableTreeDataNode,\n} from './types';\nimport { TreeVariableSelectorContext } from './context';\nimport { CompositeSelect } from './composite-select';\n\nexport type VariableSelectorProps = WithCustomStyle<{\n  testId?: string;\n  disabled?: boolean;\n  disabledTypes?: Array<ViewVariableType>;\n  forArrayItem?: boolean;\n  value?: string[];\n  onChange?: (value: string[] | undefined) => void;\n  onBlur?: (e: React.MouseEvent) => void;\n  dataSource?: VariableTreeDataNode[];\n  validateStatus?: TreeSelectProps['validateStatus'];\n  placeholder?: string;\n  emptyContent?: TreeSelectProps['emptyContent'];\n  invalidContent?: string;\n  readonly?: boolean;\n  // Can be replaced by disabledTypes\n  optionFilter?: (value: string[]) => boolean;\n  dropdownClassName?: string;\n  showClear?: boolean;\n  // Trigger onChange when variable rename occurs\n  triggerChangeWhenRename?: boolean;\n  renderDisplayVarName?: RenderDisplayVarName;\n  customFilterVar?: CustomFilterVar;\n  trigger?: ReactNode;\n  onPopoverVisibleChange?: (visible: boolean) => void;\n  renderExtraOption?: (data?: TreeNodeData[]) => ReactNode;\n  handleDataSource?: (data: TreeNodeData[]) => TreeNodeData[];\n  // Whether to allow node selection\n  enableSelectNode?: boolean;\n  popoverStyle?: React.CSSProperties;\n}>;\n\n/**\n * A stateless component where value is externally controlled\n */\n// eslint-disable-next-line complexity\nexport const VariableSelector: FC<VariableSelectorProps> = props => {\n  const {\n    dataSource: rawDataSource,\n    disabled,\n    disabledTypes = [],\n    forArrayItem,\n    className,\n    style = {},\n    onChange,\n    onBlur,\n    value,\n    placeholder,\n    emptyContent,\n    validateStatus,\n    invalidContent = I18n.t('workflow_detail_unknown_variable'),\n    readonly,\n    testId,\n    showClear,\n    triggerChangeWhenRename,\n    renderDisplayVarName,\n    customFilterVar,\n    trigger,\n    onPopoverVisibleChange,\n    renderExtraOption,\n    enableSelectNode = false,\n    popoverStyle,\n    handleDataSource,\n  } = props;\n  const [query, setQuery] = useState('');\n  const treeSelectRef = useRef<HTMLDivElement>(null);\n\n  /** Selectable variable data with default backstop */\n  const defaultVariableDataSource = useFormatVariableDataSource({\n    disabledTypes,\n  });\n\n  const dataSourceWithGlobal = useGlobalVariableCache(\n    rawDataSource || defaultVariableDataSource,\n  );\n\n  // Process DataSource data, add partial fields/renders\n  const variableDataSource = processDataSourceLabelRender({\n    dataSource: dataSourceWithGlobal,\n    disabledTypes,\n    icon: node =>\n      isGlobalVariableKey(node.value) ? (\n        <GlobalVarIcon nodeId={node.value} />\n      ) : (\n        <NodeIcon\n          size={16}\n          alt=\"logo\"\n          nodeId={node.value}\n          className=\"leading-[0px]\"\n        />\n      ),\n    renderDisplayVarName,\n    customFilterVar,\n    enableSelectNode,\n  });\n\n  const variableDataSourceWithGroup =\n    formatDataWithGlobalVariable(variableDataSource);\n\n  const dataSource = handleDataSource\n    ? handleDataSource(variableDataSourceWithGroup)\n    : variableDataSourceWithGroup;\n\n  const onValueChange = useCallback(\n    (v?: TreeNodeData) => {\n      const path: string[] = v?.path;\n      if (!Array.isArray(path) || path.length <= 0) {\n        return;\n      }\n      if (!enableSelectNode && path.length === 1) {\n        /**\n         * Disable node selection only\n         * When length is 1, node is selected and no variable is selected\n         */\n        return;\n      }\n      onChange?.(path);\n    },\n    [enableSelectNode, onChange],\n  );\n\n  const handleClear = () => {\n    onChange?.(undefined);\n  };\n\n  /** Get the currently selected subvariable according to the baseline variable and path */\n  const workflowVariable = useWorkflowVariableByKeyPath(value);\n  const valueSubVariableMeta =\n    value && workflowVariable?.viewMeta\n      ? {\n          ...workflowVariable.viewMeta,\n          key: value.join('-'),\n        }\n      : null;\n\n  const onRename = usePersistCallback(({ modifyIndex, modifyKey }) => {\n    if (isArray(value)) {\n      // Change the value reference directly to prevent triggerValidate from onChanging the old keyPath\n      value[modifyIndex] = modifyKey;\n\n      if (triggerChangeWhenRename) {\n        onChange?.(value);\n      }\n    }\n  });\n\n  // Update value when renaming, uncontrolled components also need to update internal state\n  useVariableRename({\n    keyPath: value,\n    onRename,\n  });\n\n  const isUnknownValue =\n    !valueSubVariableMeta ||\n    !dataSource?.find(_option => _option.value === value?.[0]);\n\n  const triggerValidate = usePersistCallback(() => {\n    if (value) {\n      onChange?.(value);\n    }\n  });\n\n  useUpdateEffect(() => {\n    triggerValidate();\n  }, [isUnknownValue]);\n\n  // searchPosition = \"trigger\" and hover tooltip mutual exclusion\n  // You need to actively trigger the focus of the input when you click on the selectSelection (tooltip) element\n  // So that you can hover to the selectSelection element and trigger the selectSearchInput search\n  useEffect(() => {\n    setTimeout(() => {\n      const selectSelection = treeSelectRef.current?.getElementsByClassName?.(\n        'semi-tree-select-selection-TriggerSearchItem',\n      )?.[0];\n      const selectSearchInputWrapper =\n        treeSelectRef.current?.getElementsByClassName?.(\n          'semi-tree-select-triggerSingleSearch-wrapper',\n        )?.[0];\n      const selectSearchInput =\n        selectSearchInputWrapper?.getElementsByTagName('input')?.[0];\n\n      selectSelection?.addEventListener('click', () => {\n        selectSearchInput?.focus?.();\n      });\n    }, 0);\n  }, [treeSelectRef, query]);\n\n  const displayVarName =\n    renderDisplayVarName?.({\n      meta: valueSubVariableMeta,\n      path: value,\n    }) ||\n    valueSubVariableMeta?.label ||\n    valueSubVariableMeta?.name;\n\n  return (\n    <TreeVariableSelectorContext.Provider\n      value={{\n        value,\n        dataSource,\n        query,\n        setQuery,\n        forArrayItem,\n        invalidContent,\n        testId,\n        valueSubVariableMeta,\n        displayVarName,\n        isUnknownValue,\n      }}\n    >\n      <div ref={treeSelectRef} className={className} style={style}>\n        <CompositeSelect\n          renderExtraOption={renderExtraOption}\n          treeData={dataSource}\n          onChange={onValueChange}\n          onBlur={onBlur}\n          onSelect={onValueChange}\n          value={value ?? undefined}\n          invalidContent={invalidContent}\n          placeholder={\n            placeholder || I18n.t('workflow_detail_condition_pleaseselect')\n          }\n          emptyContent={\n            emptyContent || (\n              <div className=\"text-center\">\n                <IconCozVariables fontSize={24} />\n                <div>{I18n.t('workflow_detail_node_nodata')}</div>\n              </div>\n            )\n          }\n          disabled={disabled}\n          readonly={readonly}\n          validateStatus={validateStatus}\n          showClear={showClear}\n          onClear={handleClear}\n          trigger={trigger}\n          onPopoverVisibleChange={onPopoverVisibleChange}\n          popoverStyle={popoverStyle}\n        />\n      </div>\n    </TreeVariableSelectorContext.Provider>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { TreeNodeData } from '@coze-arch/bot-semi/Tree';\n\nimport { type VariableMetaWithNode } from '../../typings';\n\nexport type VariableTreeDataNode = VariableMetaWithNode & {\n  label: string;\n  value: string;\n  isTop?: boolean;\n  parent?: VariableTreeDataNode;\n  disabled?: boolean;\n  children?: Array<VariableTreeDataNode>;\n};\n\nexport type RenderDisplayVarName = (params: {\n  meta?: VariableMetaWithNode | null;\n  path?: string[];\n}) => string;\n\nexport type CustomFilterVar = (params: {\n  meta?: VariableMetaWithNode | null;\n  path?: string[];\n}) => boolean;\n\nexport interface ITreeNodeData extends TreeNodeData {\n  groupId?: string;\n}\n\nexport enum SelectType {\n  Option = 'option',\n  Tree = 'tree',\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useGlobalState } from '@/hooks';\n\nimport { genGlobalVariableData } from './utils';\nimport { type VariableTreeDataNode } from './types';\n\nexport default function useGlobalVariableCache(\n  dataSource: VariableTreeDataNode[],\n) {\n  const { isInIDE } = useGlobalState();\n  const useNewGlobalVariableCache = !isInIDE;\n\n  const dataSourceWithGlobal = useNewGlobalVariableCache\n    ? genGlobalVariableData(dataSource)\n    : dataSource;\n\n  return dataSourceWithGlobal;\n}\n","/* eslint-disable unicorn/filename-case */\n/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ViewVariableType } from '@coze-workflow/base';\n\nimport { useNodeAvailableVariablesWithNode } from '../../hooks/use-node-available-variables';\nimport { formatWithNodeVariables } from './utils';\nimport { type VariableTreeDataNode } from './types';\n\nexport interface UseFormatVariableDataSourceProps {\n  disabledTypes: Array<ViewVariableType>;\n}\n\nexport const useFormatVariableDataSource = ({\n  disabledTypes,\n}: UseFormatVariableDataSourceProps): VariableTreeDataNode[] => {\n  const variableList = useNodeAvailableVariablesWithNode();\n\n  return formatWithNodeVariables(variableList, disabledTypes);\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReactNode } from 'react';\n\nimport { groupBy } from 'lodash-es';\nimport {\n  ViewVariableType,\n  type ViewVariableTreeNode,\n  variableUtils,\n  isGlobalVariableKey,\n  GlobalVariableKey,\n  GLOBAL_VAR_ALIAS_MAP,\n} from '@coze-workflow/variable';\nimport {\n  type StandardNodeType,\n  VARIABLE_TYPE_ALIAS_MAP,\n} from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { type TreeNodeData } from '@coze-arch/bot-semi/Tree';\nimport { Tooltip, Space } from '@coze-arch/coze-design';\n\nimport { VariableTypeTag } from '../variable-type-tag';\nimport { type VariableMetaWithNode } from '../../typings';\nimport {\n  type ITreeNodeData,\n  type CustomFilterVar,\n  type RenderDisplayVarName,\n  type VariableTreeDataNode,\n} from './types';\n\n/** Filter variables that do not match the criteria (types) */\nexport const doesNodeIncludeEnabledTypes = (\n  node: ViewVariableTreeNode,\n  enabledTypes: Array<ViewVariableType>,\n): boolean => {\n  if (enabledTypes.includes(node.type)) {\n    return true;\n  }\n\n  if (!node.children?.length) {\n    return false;\n  }\n\n  return node.children\n    .map(childNode => doesNodeIncludeEnabledTypes(childNode, enabledTypes))\n    .includes(true);\n};\n\nexport const normalizeTreeData = (\n  dataSource: Array<ViewVariableTreeNode>,\n  disabledTypes: Array<ViewVariableType>,\n) => {\n  const enabledTypes = ViewVariableType.getComplement(disabledTypes);\n  return filterTreeNode(dataSource, node =>\n    doesNodeIncludeEnabledTypes(node, enabledTypes),\n  );\n};\n\nfunction filterTreeNode(\n  treeData: Array<ViewVariableTreeNode & { nodeId?: string }>,\n  condition: (item: ViewVariableTreeNode) => boolean,\n  parent?: VariableTreeDataNode,\n): Array<VariableTreeDataNode> {\n  return treeData.reduce<Array<VariableTreeDataNode>>((buf, item) => {\n    if (!condition(item)) {\n      return buf;\n    } else {\n      const { children, ...others } = item;\n\n      let value = item.key;\n      if (parent?.value) {\n        value = `${parent?.value}-${item.key}`;\n      } else if (item?.nodeId) {\n        value = `${item.nodeId}-${item.key}`;\n      }\n\n      const newItem: VariableTreeDataNode = {\n        ...others,\n        label: item.label || item.name,\n        value,\n        parent,\n      };\n\n      if (item.children) {\n        newItem.children = filterTreeNode(item.children, condition, newItem);\n      }\n\n      buf.push(newItem);\n      return buf;\n    }\n  }, []);\n}\n\nexport function formatWithNodeVariables(\n  withNodeVariables: VariableMetaWithNode[],\n  disabledTypes: Array<ViewVariableType>,\n): VariableTreeDataNode[] {\n  const groupedVariableList = groupBy(withNodeVariables, 'nodeId');\n\n  return Object.entries(groupedVariableList)\n    .map(([key, value]) => {\n      const nodeVariables = normalizeTreeData(value, disabledTypes);\n\n      // Nodes without variables do not need to be displayed\n      if (!nodeVariables?.length) {\n        return null;\n      }\n\n      return {\n        label: value[0]?.nodeTitle ?? key,\n        value: key,\n        isTop: true,\n        type: ViewVariableType.Object,\n        children: nodeVariables,\n        nodeId: value[0]?.nodeId,\n        nodeType: value[0]?.nodeType,\n        nodeTitle: value[0]?.nodeTitle,\n      };\n    })\n    .filter(Boolean) as VariableTreeDataNode[];\n}\n\nexport const renderLabelWithItem = (\n  item?: TreeNodeData,\n  forArrayItem?: boolean,\n  searchKey?: string,\n  testId = '',\n  // eslint-disable-next-line max-params\n) => {\n  if (!item) {\n    return null;\n  }\n\n  const { label, type } = item;\n\n  let searchLabelIndex = 0;\n\n  let renderLabel = label;\n\n  if (searchKey && label) {\n    const labelStr = String(label);\n    searchLabelIndex = labelStr.toLowerCase().indexOf(searchKey.toLowerCase());\n    if (searchLabelIndex >= 0) {\n      renderLabel = (\n        <>\n          {labelStr.substring(0, searchLabelIndex)}\n          <span className=\"coz-fg-hglt-yellow\">\n            {labelStr.substring(\n              searchLabelIndex,\n              searchLabelIndex + searchKey.length,\n            )}\n          </span>\n          {labelStr.substring(\n            searchLabelIndex + searchKey.length,\n            labelStr.length,\n          )}\n        </>\n      );\n    }\n  }\n\n  if (!type) {\n    return <div data-testid={testId}>{renderLabel}</div>;\n  }\n\n  if (forArrayItem && variableUtils.ARRAY_TYPES.includes(type)) {\n    return (\n      <Tooltip\n        content={I18n.t('workflow_detail_batch_item_tooltip', {\n          name: label,\n        })}\n        position=\"left\"\n        style={{ maxWidth: 800, display: 'block', wordBreak: 'break-word' }}\n        spacing={16}\n        // The canvas can move freely, but flipping will lead to wrong positioning.\n        autoAdjustOverflow={false}\n      >\n        <Space spacing={4}>\n          <span className=\"tree-variable-select-label\">\n            {renderLabel}\n            <>{' [n]'}</>\n          </span>\n          <VariableTypeTag size=\"xs\">\n            {VARIABLE_TYPE_ALIAS_MAP[type]}\n          </VariableTypeTag>\n        </Space>\n      </Tooltip>\n    );\n  }\n\n  return (\n    <Space spacing={4}>\n      <span data-testid={testId} className=\"tree-variable-select-label\">\n        {renderLabel}\n      </span>\n      <VariableTypeTag size=\"xs\">\n        {VARIABLE_TYPE_ALIAS_MAP[type]}\n      </VariableTypeTag>\n    </Space>\n  );\n};\n\nexport const genGlobalVariableData = (\n  dataSource: VariableTreeDataNode[] = [],\n) => {\n  const global = [\n    {\n      label: GLOBAL_VAR_ALIAS_MAP[GlobalVariableKey.User],\n      value: GlobalVariableKey.User,\n      children: [],\n      isTop: true,\n      type: ViewVariableType.Object,\n      nodeId: GlobalVariableKey.User,\n      nodeType: undefined,\n      nodeTitle: GLOBAL_VAR_ALIAS_MAP[GlobalVariableKey.User],\n    },\n    {\n      label: GLOBAL_VAR_ALIAS_MAP[GlobalVariableKey.App],\n      value: GlobalVariableKey.App,\n      children: [],\n      isTop: true,\n      type: ViewVariableType.Object,\n      nodeId: GlobalVariableKey.App,\n      nodeType: undefined,\n      nodeTitle: GLOBAL_VAR_ALIAS_MAP[GlobalVariableKey.App],\n    },\n    {\n      label: GLOBAL_VAR_ALIAS_MAP[GlobalVariableKey.System],\n      value: GlobalVariableKey.System,\n      children: [],\n      isTop: true,\n      type: ViewVariableType.Object,\n      nodeId: GlobalVariableKey.System,\n      nodeType: undefined,\n      nodeTitle: GLOBAL_VAR_ALIAS_MAP[GlobalVariableKey.System],\n    },\n  ] as unknown as VariableTreeDataNode[];\n\n  const others: VariableTreeDataNode[] = [];\n\n  dataSource?.forEach(item => {\n    if (!isGlobalVariableKey(item.value)) {\n      others.push(item);\n    } else {\n      const index = global.findIndex(\n        globalVar => globalVar.value === item.value,\n      );\n      if (index !== -1) {\n        global[index] = item;\n      }\n    }\n  });\n\n  return [...global, ...others];\n};\n\n/**\n * Process DataSource data, add partial fields/renders\n * For TreeSelect, you need to put the path on each dataSource Item to help TreeSelect determine the path when selecting.\n */\nexport const processDataSourceLabelRender = (params: {\n  dataSource?: VariableTreeDataNode[];\n  disabledTypes?: Array<ViewVariableType>;\n  prevPath?: string[];\n  prevNamePath?: string[];\n  icon?: (node: VariableTreeDataNode) => ReactNode | undefined;\n  renderDisplayVarName?: RenderDisplayVarName;\n  customFilterVar?: CustomFilterVar;\n  enableSelectNode?: boolean;\n}): TreeNodeData[] | undefined => {\n  const {\n    dataSource,\n    prevPath,\n    prevNamePath,\n    disabledTypes,\n    icon,\n    renderDisplayVarName,\n    customFilterVar,\n    enableSelectNode,\n  } = params;\n\n  if (!dataSource) {\n    return undefined;\n  }\n  if (!dataSource.length) {\n    return [];\n  }\n\n  return (\n    dataSource\n      .filter(\n        item =>\n          item.isTop ||\n          (customFilterVar\n            ? customFilterVar({\n                meta: item,\n                path: [...(prevPath || []), item.key || item.value],\n              })\n            : item.name),\n      )\n      .map(item => {\n        const path: string[] = [\n          ...(prevPath || []),\n          item.key || item.value,\n        ] as string[];\n\n        const namePath: string[] = [\n          ...(prevNamePath || []),\n          item.name ?? item.value,\n        ];\n\n        let { label } = item;\n        if (renderDisplayVarName && !item.isTop) {\n          label = renderDisplayVarName({ meta: item, path });\n        }\n\n        return {\n          ...item,\n          label,\n          key: path.join('-') as string,\n          path,\n          namePath,\n          // TODO: can also be judged by disableTypes\n          // Nodes in the first layer should not be selected & & Nodes that do not pass the optionFilter cannot be selected\n          disabled:\n            path?.length === 1 ||\n            (disabledTypes &&\n              Boolean(disabledTypes.length) &&\n              disabledTypes.includes(item.type)) ||\n            item.disabled,\n          icon: icon && icon(item),\n          children: processDataSourceLabelRender({\n            dataSource: item.children,\n            prevPath: path,\n            prevNamePath: namePath,\n            disabledTypes,\n            renderDisplayVarName,\n            customFilterVar,\n          }),\n        };\n      })\n      // Filter nodes without output variables\n      .filter(_item => {\n        if (enableSelectNode) {\n          // No filtering required if root node selection is allowed\n          return true;\n        }\n        if (!_item.isTop) {\n          return true;\n        }\n\n        if (isGlobalVariableKey(_item.key)) {\n          return true;\n        }\n\n        return (_item.children || []).length > 0;\n      }) as TreeNodeData[]\n  );\n};\n\nexport const getLabelPath = (\n  dataSource: TreeNodeData[],\n  value: string[],\n): string[] => {\n  if (!value?.length) {\n    return [];\n  }\n  const path: string[] = [];\n  let i = 0;\n  let currValue = value.slice(0, i + 1).join('-');\n\n  let cur = dataSource.find(item => item.value === currValue);\n  while (cur && i < value.length) {\n    path.push(cur.label || cur.name);\n    i++;\n    currValue = value.slice(0, i + 1).join('-');\n    cur = cur.children?.find(item => item.value === currValue);\n  }\n  return path;\n};\n\n// Look up the mount node\nexport const findActivityDOM = (node?: HTMLElement | null): HTMLElement => {\n  if (!node) {\n    return document.body;\n  }\n  if (node.classList.contains('gedit-flow-activity-node')) {\n    return node;\n  }\n\n  if (node.parentElement) {\n    return findActivityDOM(node.parentElement);\n  }\n\n  return document.body;\n};\n\n/** Go up and find the node information. */\nexport const findNodeInfo = (\n  node: TreeNodeData,\n): {\n  nodeTitle?: string;\n  nodeType?: StandardNodeType;\n  nodeId?: string;\n} => {\n  if (node.parent) {\n    return findNodeInfo(node.parent);\n  }\n  return {\n    nodeTitle: node.nodeTitle,\n    nodeType: node.nodeType,\n    nodeId: node.nodeId,\n  };\n};\n\nexport const formatDataWithGlobalVariable = (data?: TreeNodeData[]) => {\n  if (!data) {\n    return [];\n  }\n\n  return data.map(item => {\n    if (item.key && isGlobalVariableKey(item.key)) {\n      return {\n        groupId: 'global_variable',\n        ...item,\n      };\n    }\n\n    return item;\n  });\n};\n\nconst matchVariableDataByType = (\n  data: VariableTreeDataNode[],\n  type: ViewVariableType,\n) =>\n  data.map(item => {\n    const { children = [], disabled, ...rest } = item;\n\n    return {\n      disabled: disabled || item.type !== type,\n      children: matchVariableDataByType(children, type),\n      ...rest,\n    };\n  });\n\nexport const formatVariableDataByMatchType = (\n  data?: VariableTreeDataNode[],\n  type?: ViewVariableType,\n) => {\n  if (!data?.length || !type) {\n    return data;\n  }\n\n  return data.map(item => {\n    const { children = [], ...rest } = item;\n    return {\n      children: matchVariableDataByType(children, type),\n      ...rest,\n    };\n  });\n};\n\nexport const sortTreeDataByGroup = (\n  treeData?: ITreeNodeData[],\n): ITreeNodeData[] => {\n  if (!treeData) {\n    return [];\n  }\n\n  const groupMap: Record<string, ITreeNodeData[]> = {};\n  const noGroupArr: ITreeNodeData[] = [];\n\n  treeData.forEach(item => {\n    if (item.groupId) {\n      return groupMap[item.groupId]\n        ? groupMap[item.groupId].push(item)\n        : (groupMap[item.groupId] = [item]);\n    }\n    noGroupArr.push(item);\n  });\n\n  return Object.keys(groupMap)\n    .reduce<ITreeNodeData[]>((acc, cur) => acc.concat(groupMap[cur]), [])\n    .concat(noGroupArr);\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FormItemFeedback } from '@flowgram-adapter/free-layout-editor';\n\nexport const feedbackStatus2ValidateStatus = (\n  feedbackStatus: FormItemFeedback['feedbackStatus'],\n) => {\n  switch (feedbackStatus) {\n    case 'error':\n      return 'error';\n    case 'warning':\n      return 'warning';\n    default:\n      return undefined;\n  }\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { createContext } from 'react';\n\nimport {\n  type ValidationContextProps,\n  type ValidationProviderProps,\n} from './type';\n\nexport const ValidationContext = createContext<\n  ValidationContextProps | undefined\n>(undefined);\n\nexport const ValidationProvider: React.FC<ValidationProviderProps> = ({\n  errors,\n  children,\n  onTestRunValidate,\n}) => (\n  <ValidationContext.Provider value={{ errors, onTestRunValidate }}>\n    {children}\n  </ValidationContext.Provider>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useContext } from 'react';\n\nimport { REPORT_EVENTS } from '@coze-arch/report-events';\nimport { CustomError } from '@coze-arch/bot-error';\n\nimport { type ValidationError } from './type';\nimport { ValidationContext } from './context';\n\nfunction parsePath(stringPath: string): (string | number)[] {\n  return stringPath\n    .split(/[\\.\\[\\]]/)\n    .filter(Boolean)\n    .map(item => (isNaN(Number(item)) ? item : Number(item)));\n}\n\nexport const useError = (\n  path: string | (string | number)[],\n): string | undefined => {\n  const context = useContext(ValidationContext);\n\n  if (!context) {\n    throw new CustomError(\n      REPORT_EVENTS.parmasValidation,\n      'useError must be used within a ValidationProvider',\n    );\n  }\n\n  const { errors } = context;\n\n  if (!errors) {\n    return undefined;\n  }\n\n  let pathArray;\n  // Convert the path to an array for unified processing\n  if (Array.isArray(path)) {\n    pathArray = path;\n  } else {\n    pathArray = parsePath(path);\n  }\n\n  // Find the corresponding error in the error list through the path\n  const findErrorInPath = (\n    errorPath: (string | number)[],\n  ): ValidationError | undefined =>\n    errors.find(error => {\n      if (Array.isArray(error.path)) {\n        return (\n          error.path.length === errorPath.length &&\n          error.path.every((segment, index) => segment === errorPath[index])\n        );\n      }\n\n      return error.path === errorPath[0];\n    });\n\n  const error = findErrorInPath(pathArray);\n\n  // Return error message\n  return error ? error.message : undefined;\n};\n\nexport const useOnTestRunValidate = () => {\n  const context = useContext(ValidationContext);\n\n  if (!context) {\n    throw new CustomError(\n      REPORT_EVENTS.parmasValidation,\n      'useError must be used within a ValidationProvider',\n    );\n  }\n\n  const { onTestRunValidate } = context;\n\n  return onTestRunValidate;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\n\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nimport { ValidationProvider } from './context';\n\ntype ValidationProps = Pick<\n  SetterComponentProps,\n  | 'children'\n  | 'feedbackStatus'\n  | 'feedbackText'\n  | 'value'\n  | 'onChange'\n  | 'flowNodeEntity'\n>;\n\nexport function withValidation<T extends ValidationProps>(\n  component: React.ComponentType<T>,\n) {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const Comp = component as any;\n\n  return (props: SetterComponentProps) => {\n    const { value, onChange, context } = props;\n\n    useEffect(() => {\n      // Trigger a verification during initialization to prevent the component onBlur from not getting the verification information.\n      onChange && onChange(value);\n    }, []);\n\n    return (\n      <ValidationProvider\n        errors={[]}\n        onTestRunValidate={callback => {\n          const { dispose } = context.onFormValidate(callback);\n          return dispose;\n        }}\n      >\n        <Comp {...props} />\n      </ValidationProvider>\n    );\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  type ReactElement,\n  type CSSProperties,\n  useEffect,\n  useState,\n  useCallback,\n} from 'react';\n\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport { WorkflowValidationService } from '@/services';\n\nimport { FormItemFeedback } from '../form-item-feedback';\nimport { useError, useOnTestRunValidate } from './hooks';\n\ninterface ValidationErrorWrapperProps {\n  path: string;\n  children: (options: {\n    showError: boolean;\n    onBlur: () => void;\n    onChange: () => void;\n    onFocus: () => void;\n  }) => React.ReactNode | ReactElement;\n  style?: CSSProperties;\n  className?: string;\n  errorCompClassName?: string;\n}\n\nexport const ValidationErrorWrapper: React.FC<ValidationErrorWrapperProps> = ({\n  path,\n  children,\n  style,\n  className,\n  errorCompClassName,\n}) => {\n  const validationService = useService<WorkflowValidationService>(\n    WorkflowValidationService,\n  );\n  const node = useCurrentEntity();\n\n  const [isFocused, setFocused] = useState(false);\n\n  const [silence, setSilence] = useState(\n    validationService.validatedNodeMap[node.id] ? false : true,\n  );\n  const error = useError(path);\n\n  const onTestRunValidate = useOnTestRunValidate();\n  const showError = Boolean(error) && !silence && !isFocused;\n\n  const onFocus = useCallback(() => {\n    setFocused(true);\n  }, []);\n\n  const onBlur = useCallback(() => {\n    setSilence(false);\n    setFocused(false);\n  }, []);\n\n  const onChange = useCallback(() => {\n    setSilence(true);\n  }, []);\n\n  useEffect(() => {\n    const dispose = onTestRunValidate(() => {\n      setSilence(false);\n    });\n\n    return () => {\n      dispose();\n    };\n  }, []);\n\n  return (\n    <div className={className} style={style}>\n      {typeof children === 'function'\n        ? children({ showError, onBlur, onChange, onFocus })\n        : children}\n      {showError ? (\n        <FormItemFeedback feedbackText={error} className={errorCompClassName} />\n      ) : null}\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createContext, useContext } from 'react';\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst ValueExpressionInputContext = createContext<{\n  testId?: string;\n}>({});\n\nexport const useValueExpressionInputContext = () =>\n  useContext(ValueExpressionInputContext);\n\nexport { ValueExpressionInputContext };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { customAlphabet } from 'nanoid';\nimport { VARIABLE_TYPE_ALIAS_MAP, ViewVariableType } from '@coze-workflow/base';\nimport { json } from '@coze-editor/editor/language-json';\n\nimport {\n  type InputComponentRegistry,\n  type InputType,\n  type LiteralValueInputProps,\n} from './type';\nimport { InputString } from './input-string';\n\nconst nanoid = customAlphabet('0123456789abcdefABCDEF', 8);\n\nconst uriMap: Record<\n  | ViewVariableType.ArrayString\n  | ViewVariableType.ArrayNumber\n  | ViewVariableType.ArrayInteger\n  | ViewVariableType.ArrayBoolean\n  | ViewVariableType.ArrayObject,\n  string\n> = {\n  [ViewVariableType.ArrayString]: `${\n    VARIABLE_TYPE_ALIAS_MAP[ViewVariableType.ArrayString]\n  }_${nanoid()}`,\n  [ViewVariableType.ArrayNumber]: `${\n    VARIABLE_TYPE_ALIAS_MAP[ViewVariableType.ArrayNumber]\n  }_${nanoid()}`,\n  [ViewVariableType.ArrayInteger]: `${\n    VARIABLE_TYPE_ALIAS_MAP[ViewVariableType.ArrayInteger]\n  }_${nanoid()}`,\n  [ViewVariableType.ArrayBoolean]: `${\n    VARIABLE_TYPE_ALIAS_MAP[ViewVariableType.ArrayBoolean]\n  }_${nanoid()}`,\n  [ViewVariableType.ArrayObject]: `${\n    VARIABLE_TYPE_ALIAS_MAP[ViewVariableType.ArrayObject]\n  }_${nanoid()}`,\n};\n\n/**\n * Generate a random JSON file URI\n * @param schemaUri jsonSchema unique identifier\n * @returns\n */\nexport const generateJsonFileUri = (schemaUri: string) =>\n  `${schemaUri}_${nanoid()}.json`;\n\nexport const getJsonSchemaUriByInputType = (inputType: ViewVariableType) =>\n  uriMap[inputType] || `${VARIABLE_TYPE_ALIAS_MAP[inputType]}_${nanoid()}`;\n\nexport const configureJsonSchemas = () => {\n  const schemas = [\n    {\n      uri: uriMap[ViewVariableType.ArrayString],\n      fileMatch: [`${uriMap[ViewVariableType.ArrayString]}_*.json`],\n      schema: { type: 'array', items: { type: 'string' } },\n    },\n    {\n      uri: uriMap[ViewVariableType.ArrayNumber],\n      fileMatch: [`${uriMap[ViewVariableType.ArrayNumber]}_*.json`],\n      schema: { type: 'array', items: { type: 'number' } },\n    },\n    {\n      uri: uriMap[ViewVariableType.ArrayInteger],\n      fileMatch: [`${uriMap[ViewVariableType.ArrayInteger]}_*.json`],\n      schema: { type: 'array', items: { type: 'integer' } },\n    },\n    {\n      uri: uriMap[ViewVariableType.ArrayBoolean],\n      fileMatch: [`${uriMap[ViewVariableType.ArrayBoolean]}_*.json`],\n      schema: { type: 'array', items: { type: 'boolean' } },\n    },\n    {\n      uri: uriMap[ViewVariableType.ArrayObject],\n      fileMatch: [`${uriMap[ViewVariableType.ArrayObject]}_*.json`],\n      schema: { type: 'array', items: { type: 'object' } },\n    },\n  ];\n\n  json.languageService.configureSchemas(schemas);\n};\n\nexport const getInputComponent = (\n  inputType: InputType,\n  optionsList: { label: string; value: string }[] | undefined,\n  componentRegistry: InputComponentRegistry[],\n): FC<LiteralValueInputProps> => {\n  const registry = componentRegistry.filter(item => {\n    if (typeof item.canHandle === 'function') {\n      return item.canHandle(inputType, optionsList);\n    }\n    return item.canHandle === inputType;\n  });\n  const { length } = registry;\n  if (registry.length === 0) {\n    console.error(`${inputType} has no input component!`);\n    return InputString;\n  }\n  return registry[length - 1]?.component;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport classNames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { Input } from '@coze-arch/coze-design';\n\nimport { type LiteralValueInputProps } from './type';\n\nimport styles from './styles.module.less';\nexport const InputString: FC<LiteralValueInputProps> = ({\n  className,\n  value,\n  defaultValue,\n  disabled,\n  testId,\n  onChange,\n  onBlur,\n  onFocus,\n  placeholder,\n  validateStatus,\n  style,\n}) => (\n  <Input\n    className={classNames(className, styles['input-string'])}\n    data-testid={testId}\n    disabled={disabled}\n    defaultValue={defaultValue as string}\n    value={value as string}\n    onChange={onChange}\n    onBlur={e => onBlur?.(e.target.value)}\n    onFocus={onFocus}\n    placeholder={\n      placeholder || I18n.t('workflow_detail_node_input_selectvalue')\n    }\n    validateStatus={validateStatus}\n    style={{ ...style, padding: '0 6px' }}\n    size=\"small\"\n  />\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { memo } from 'react';\n\nimport { ViewVariableType } from '@coze-workflow/base';\n\nimport { type InputComponentRegistry } from './type';\nimport { InputTime } from './input-time';\nimport { InputString } from './input-string';\nimport { InputSelect } from './input-select';\nimport { InputNumber } from './input-number';\nimport { InputJson } from './input-json';\nimport { InputInteger } from './input-integer';\nimport { InputBoolean } from './input-boolean';\n\nexport const DEFAULT_COMPONENT_REGISTRY: InputComponentRegistry[] = [\n  {\n    canHandle: ViewVariableType.String,\n    component: memo(InputString),\n  },\n  {\n    canHandle: ViewVariableType.Number,\n    component: memo(InputNumber),\n  },\n  {\n    canHandle: ViewVariableType.Integer,\n    component: memo(InputInteger),\n  },\n  {\n    canHandle: ViewVariableType.Boolean,\n    component: memo(InputBoolean),\n  },\n  {\n    canHandle: ViewVariableType.Time,\n    component: memo(InputTime),\n  },\n  {\n    canHandle: inputType => ViewVariableType.isJSONInputType(inputType),\n    component: memo(InputJson),\n  },\n  {\n    canHandle: (inputType, optionsList) =>\n      [ViewVariableType.String, ViewVariableType.Integer].includes(inputType) &&\n      (optionsList ?? []).length > 0,\n    component: memo(InputSelect),\n  },\n];\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport classNames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { CozInputNumber } from '@coze-arch/coze-design';\n\nimport { type LiteralValueInputProps } from './type';\n\nimport styles from './styles.module.less';\nexport const InputNumber: FC<LiteralValueInputProps> = ({\n  className,\n  value,\n  defaultValue,\n  disabled,\n  testId,\n  onChange,\n  onBlur,\n  onFocus,\n  placeholder,\n  validateStatus,\n  config = {},\n  style,\n}) => {\n  const { min, max } = config;\n  return (\n    <CozInputNumber\n      className={classNames(className, styles['input-number'])}\n      data-testid={testId}\n      disabled={disabled}\n      defaultValue={defaultValue as number}\n      value={value as number}\n      onChange={onChange}\n      onBlur={e => onBlur?.(e.target.value)}\n      onFocus={onFocus}\n      placeholder={\n        placeholder || I18n.t('workflow_detail_node_input_selectvalue')\n      }\n      validateStatus={validateStatus}\n      style={style}\n      min={min}\n      max={max}\n      size=\"small\"\n      hideButtons\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport classNames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { CozInputNumber } from '@coze-arch/coze-design';\n\nimport { type LiteralValueInputProps } from './type';\n\nimport styles from './styles.module.less';\nexport const InputInteger: FC<LiteralValueInputProps> = ({\n  className,\n  value,\n  defaultValue,\n  disabled,\n  testId,\n  onChange,\n  onBlur,\n  onFocus,\n  placeholder,\n  validateStatus,\n  config = {},\n  style,\n}) => {\n  const { min, max } = config;\n  return (\n    <CozInputNumber\n      className={classNames(className, styles['input-number'])}\n      data-testid={testId}\n      disabled={disabled}\n      defaultValue={defaultValue as number}\n      value={value as number}\n      onChange={onChange}\n      onBlur={e => {\n        // Get the rounded value\n        setTimeout(() => {\n          onBlur?.(e.target.value);\n        }, 15);\n      }}\n      onFocus={onFocus}\n      placeholder={\n        placeholder || I18n.t('workflow_detail_node_input_selectvalue')\n      }\n      precision={0.1}\n      validateStatus={validateStatus}\n      style={style}\n      min={min}\n      max={max}\n      size=\"small\"\n      hideButtons\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, useRef } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Select } from '@coze-arch/coze-design';\n\nimport { type LiteralValueInputProps } from './type';\n\nimport styles from './styles.module.less';\nexport const InputBoolean: FC<LiteralValueInputProps> = ({\n  value,\n  defaultValue,\n  disabled,\n  testId,\n  onChange,\n  onBlur,\n  onFocus,\n  placeholder,\n  validateStatus,\n  style,\n  className,\n}) => {\n  const val = defaultValue ?? value;\n  const valueRef = useRef(val as boolean | undefined | null);\n  const handleChange = newVal => {\n    if (newVal) {\n      const parsed = JSON.parse(newVal || 'false') as boolean;\n      onChange?.(parsed);\n      valueRef.current = parsed;\n    } else {\n      onChange?.(null);\n      valueRef.current = null;\n    }\n  };\n  return (\n    <div className={styles['input-boolean-wrapper']}>\n      <Select\n        className={className}\n        data-testid={testId}\n        placeholder={\n          placeholder || I18n.t('workflow_detail_node_input_entervalue')\n        }\n        size=\"small\"\n        optionList={[\n          {\n            label: 'true',\n            value: 'true',\n          },\n          {\n            label: 'false',\n            value: 'false',\n          },\n        ]}\n        showClear\n        defaultValue={val !== undefined ? JSON.stringify(val) : undefined}\n        disabled={disabled}\n        validateStatus={validateStatus}\n        onChange={handleChange}\n        onFocus={onFocus}\n        onBlur={() => onBlur?.(valueRef.current)}\n        style={style}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, useRef } from 'react';\n\nimport classNames from 'classnames';\nimport { DatePicker } from '@coze-arch/coze-design';\n\nimport { type LiteralValueInputProps } from './type';\n\nimport styles from './styles.module.less';\n\nexport const InputTime: FC<LiteralValueInputProps> = ({\n  value,\n  defaultValue,\n  disabled,\n  testId,\n  onChange,\n  onBlur,\n  onFocus,\n  placeholder,\n  validateStatus,\n  style,\n  className,\n}) => {\n  defaultValue =\n    typeof defaultValue === 'string' &&\n    /^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}$/.test(defaultValue)\n      ? defaultValue\n      : '';\n\n  const val = defaultValue ?? value;\n  const valueRef = useRef(val as string | undefined | null);\n\n  const handleChange = (newVal?: string) => {\n    onChange?.(newVal);\n    valueRef.current = newVal;\n  };\n\n  return (\n    <DatePicker\n      className={classNames(className, styles['input-time'])}\n      data-testid={testId}\n      inputStyle={{ width: '100%' }}\n      type=\"dateTime\"\n      size=\"small\"\n      placeholder={placeholder}\n      defaultValue={defaultValue}\n      value={value as string}\n      disabled={disabled}\n      format=\"yyyy-MM-dd HH:mm:ss\"\n      validateStatus={validateStatus}\n      onFocus={onFocus}\n      onChange={(date, dateString) => {\n        if (typeof dateString === 'string' || dateString === undefined) {\n          handleChange(dateString);\n        }\n      }}\n      onClear={() => {\n        handleChange('');\n        onBlur?.('');\n      }}\n      onBlur={() => {\n        onBlur?.(valueRef.current);\n      }}\n      showClear={true}\n      style={style}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\nimport { useEffect, useLayoutEffect, useMemo, useRef } from 'react';\n\nimport { type EditorAPI } from '@coze-editor/editor/preset-code';\nimport { json } from '@coze-editor/editor/language-json';\nimport { EditorView, tooltips } from '@codemirror/view';\n\nimport { CodeEditor, EditorProvider } from '@/components/code-editor';\n\nimport {\n  configureJsonSchemas,\n  getJsonSchemaUriByInputType,\n  generateJsonFileUri,\n} from './utils';\nimport { type LiteralValueInputProps } from './type';\n\nconfigureJsonSchemas();\n\nexport const InputJson: FC<LiteralValueInputProps> = ({\n  className,\n  value,\n  defaultValue,\n  readonly,\n  disabled,\n  testId,\n  onChange,\n  onBlur,\n  onFocus,\n  placeholder,\n  style,\n  inputType,\n  config = {},\n}) => {\n  const apiRef = useRef<EditorAPI | null>(null);\n  const { jsonSchema, onRequestInputExpand } = config;\n  const localSchemaConfig = useMemo(() => {\n    if (!jsonSchema) {\n      return undefined;\n    }\n    const uri = getJsonSchemaUriByInputType(inputType);\n    return {\n      uri,\n      fileMatch: [`${uri}_*.json`],\n      schema: jsonSchema,\n    };\n  }, [jsonSchema]);\n\n  const fileUri = useMemo(() => {\n    const uri =\n      localSchemaConfig?.uri || getJsonSchemaUriByInputType(inputType);\n    return uri ? generateJsonFileUri(uri) : '';\n  }, [localSchemaConfig, inputType]);\n\n  useEffect(() => {\n    if (localSchemaConfig) {\n      json.languageService.configureSchemas(localSchemaConfig);\n      apiRef.current?.validate();\n      return () => {\n        json.languageService.deleteSchemas(localSchemaConfig.uri);\n      };\n    }\n  }, [localSchemaConfig]);\n\n  const handleChange = (e: { value: string }) => {\n    onChange?.(e.value);\n  };\n\n  // Value controlled;\n  // useEffect(() => {\n  // const editor = apiRef.current;\n  // if (!editor) {\n  //   return;\n  // }\n  // if (!value && editor.getValue()) {\n  //   editor.setValue('');\n  // } else if (typeof value === 'string' && value !== editor.getValue()) {\n  //   editor.setValue(value);\n  // }\n  // }, [value]);\n\n  useLayoutEffect(() => {\n    onRequestInputExpand?.((apiRef.current?.$view?.contentHeight ?? 0) > 27);\n  }, [value, onRequestInputExpand]);\n\n  return (\n    <div className={className} data-testid={testId} style={style}>\n      <EditorProvider>\n        <CodeEditor\n          defaultValue={((value ?? defaultValue) as string) ?? ''}\n          onChange={handleChange}\n          onFocus={onFocus}\n          onBlur={() => onBlur?.(apiRef.current?.getValue())}\n          options={{\n            uri: fileUri,\n            placeholder,\n            lineWrapping: true,\n            theme: 'coze-light',\n            languageId: 'json',\n            editable: !disabled && !readonly,\n            fontSize: 12,\n            minHeight: 22,\n            maxHeight: 22 * 8.5,\n          }}\n          extensions={[\n            EditorView.theme({\n              '.cm-gutters': {\n                display: 'none',\n              },\n              '&, .cm-activeLine': {\n                backgroundColor: 'transparent !important',\n              },\n              '.cm-line': {\n                padding: '0 2px 0 6px !important',\n              },\n              '.cm-content.cm-lineWrapping': {\n                paddingTop: '5px !important',\n              },\n              '.cm-placeholder': {\n                color: 'var(--coz-fg-dim) !important',\n                opacity: '1 !important',\n              },\n            }),\n            tooltips({\n              parent: document.body,\n              tooltipSpace: () => ({\n                left: 16,\n                top: 16,\n                right: window.innerWidth - 16,\n                bottom: window.innerHeight - 16,\n              }),\n            }),\n          ]}\n          didMount={api => {\n            apiRef.current = api;\n            requestAnimationFrame(() => {\n              onRequestInputExpand?.((api?.$view?.contentHeight ?? 0) > 27);\n            });\n          }}\n        />\n      </EditorProvider>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport classNames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { Select as CozSelect } from '@coze-arch/coze-design';\n\nimport { type LiteralValueInputProps } from './type';\n\nexport const InputSelect: FC<LiteralValueInputProps> = ({\n  className,\n  value,\n  defaultValue,\n  disabled,\n  testId,\n  onChange,\n  onFocus,\n  placeholder,\n  validateStatus,\n  style,\n  config,\n}) => {\n  const { optionsList } = config || {};\n\n  return (\n    <CozSelect\n      className={classNames(className)}\n      data-testid={testId}\n      disabled={disabled}\n      defaultValue={defaultValue as string}\n      onChange={v => onChange?.(v as string)}\n      optionList={optionsList}\n      value={value as string}\n      onFocus={onFocus}\n      placeholder={\n        placeholder || I18n.t('workflow_detail_node_input_entervalue')\n      }\n      validateStatus={validateStatus}\n      style={style}\n      size=\"small\"\n      dropdownClassName=\"text-[12px]\"\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { getInputComponent } from './utils';\nimport { type LiteralValueInputProps } from './type';\nimport { DEFAULT_COMPONENT_REGISTRY } from './constants';\n\nexport const LiteralValueInput: FC<LiteralValueInputProps> = props => {\n  const {\n    inputType,\n    componentRegistry = DEFAULT_COMPONENT_REGISTRY,\n    config,\n  } = props;\n  const InputComponent = getInputComponent(\n    inputType,\n    config?.optionsList,\n    componentRegistry,\n  );\n  return <InputComponent key={inputType} {...props} />;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { nanoid } from 'nanoid';\nimport { type LiteralExpression } from '@coze-workflow/base';\n\nimport { type FileItem } from '../../../hooks/use-upload';\n\nexport const transformExpressionInputToFileList = (\n  value?: LiteralExpression,\n): FileItem[] => {\n  if (!value) {\n    return [];\n  }\n\n  let fileList: FileItem[] = [];\n\n  const { rawMeta, content } = value;\n\n  const { fileName } = rawMeta || {};\n\n  if (Array.isArray(content)) {\n    fileList = content.map((item, index) => ({\n      url: item,\n      name: fileName?.[index],\n      uid: nanoid(),\n    })) as FileItem[];\n  } else {\n    if (content) {\n      fileList = [\n        {\n          url: content,\n          name: fileName,\n          uid: nanoid(),\n        },\n      ] as FileItem[];\n    }\n  }\n\n  return fileList;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type PropsWithChildren,\n  createContext,\n  useRef,\n  useContext,\n} from 'react';\n\nimport { ViewVariableType, type LiteralExpression } from '@coze-workflow/base';\nimport { usePersistCallback, useUpdateEffect } from '@coze-arch/hooks';\n\nimport { useUpload, getAccept, type FileItem } from '../../../hooks/use-upload';\nimport { transformExpressionInputToFileList } from './transform';\n\nexport interface UploadContextProps {\n  triggerUpload: () => void;\n  fileList: FileItem[];\n  multiple: boolean;\n  handleDelete: (uid?: string) => void;\n  isImage: boolean;\n  isUploading: boolean;\n}\nexport const UploadContext = createContext<UploadContextProps | undefined>(\n  undefined,\n);\n\nexport type UploadProviderProps = PropsWithChildren<{\n  value?: LiteralExpression;\n  inputType: ViewVariableType;\n  availableFileTypes?: ViewVariableType[];\n  onChange?: (value) => void;\n  onBlur?: () => void;\n}>;\n\nexport const UploadProvider = ({\n  value,\n  inputType,\n  availableFileTypes,\n  onChange,\n  onBlur,\n  children,\n}: UploadProviderProps) => {\n  const multiple = ViewVariableType.isArrayType(inputType);\n  const accept = getAccept(inputType, availableFileTypes);\n\n  const isImage = [\n    ViewVariableType.Image,\n    ViewVariableType.ArrayImage,\n    ViewVariableType.Svg,\n    ViewVariableType.ArraySvg,\n  ].includes(inputType);\n\n  const { upload, deleteFile, fileList, isUploading } = useUpload({\n    initialValue: transformExpressionInputToFileList(value),\n    fileType: isImage ? 'image' : 'object',\n    multiple,\n    accept,\n  });\n\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const triggerUpload = () => {\n    inputRef.current?.click();\n  };\n\n  const handleChange = usePersistCallback(() => {\n    if (multiple) {\n      const val = fileList.reduce(\n        (prev, cur) => {\n          const { url, name } = prev;\n          if (cur.url) {\n            url.push(cur.url);\n            name.push(cur.name);\n          }\n          return {\n            url,\n            name,\n          };\n        },\n        {\n          url: [] as string[],\n          name: [] as string[],\n        },\n      );\n      onChange?.(val);\n    } else {\n      onChange?.(fileList[0]);\n    }\n    onBlur?.();\n  });\n\n  useUpdateEffect(() => {\n    // After all uploads are completed, onchange will be triggered to avoid state loss after refreshing the canvas.\n    if (!isUploading) {\n      handleChange();\n    }\n  }, [isUploading, fileList]);\n\n  return (\n    <UploadContext.Provider\n      value={{\n        triggerUpload,\n        fileList,\n        multiple,\n        handleDelete: deleteFile,\n        isImage,\n        isUploading,\n      }}\n    >\n      {children}\n      <input\n        ref={inputRef}\n        className=\"hidden\"\n        type=\"file\"\n        multiple={multiple}\n        accept={accept}\n        onChange={e => {\n          const { files } = e.target;\n          Object.values(files || {}).forEach(file => {\n            upload(file);\n          });\n        }}\n      />\n    </UploadContext.Provider>\n  );\n};\n\nexport const useUploadContext = () => {\n  const context = useContext(UploadContext);\n\n  return (context || {}) as UploadContextProps;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozUpload } from '@coze-arch/coze-design/icons';\nimport { Button } from '@coze-arch/coze-design';\nexport interface FileUploadBtnProps {\n  isImage?: boolean;\n}\nexport const FileUploadBtn: FC<FileUploadBtnProps> = ({ isImage }) => (\n  <Button\n    className=\"coz-fg-primary font-normal h-[20px]\"\n    color=\"primary\"\n    size=\"small\"\n    icon={<IconCozUpload />}\n    style={{ width: '100%', height: '20px', borderRadius: 'var(--coze-4)' }}\n  >\n    {isImage\n      ? I18n.t('imageflow_input_upload_placeholder')\n      : I18n.t('plugin_file_upload')}\n  </Button>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type MouseEventHandler, type CSSProperties, type FC } from 'react';\n\nimport classnames from 'classnames';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { Tag } from '@coze-arch/coze-design';\n\nimport { type FileItem } from '@/hooks/use-upload';\nimport { FileIcon } from '@/components/file-icon';\n\nexport interface FileTagProps {\n  value: FileItem;\n  onClose: MouseEventHandler<HTMLElement>;\n  style?: CSSProperties;\n  testId?: string;\n}\nexport const FileTag: FC<FileTagProps> = ({\n  value,\n  onClose,\n  style,\n  testId,\n}) => {\n  const { concatTestId } = useNodeTestId();\n  return (\n    <Tag\n      size=\"mini\"\n      closable\n      color=\"primary\"\n      onClose={(children, event) => onClose(event)}\n      className=\"w-full max-w-full min-w-[65%] overflow-hidden\"\n      visible\n      style={{\n        padding: '0 4px 0 1px',\n        height: 20,\n        ...style,\n      }}\n    >\n      <div className=\"flex w-0 grow overflow-hidden\">\n        <div\n          className=\"flex min-w-0 grow gap-[2px] items-center\"\n          data-testid={concatTestId(testId ?? '', 'file-tag')}\n        >\n          <FileIcon\n            iconStyle={{ borderRadius: 'var(--coze-3)' }}\n            file={value}\n            size={18}\n          />\n          <div\n            className={classnames(\n              'coz-fg-primary text-[12px] flex-1 truncate font-medium',\n            )}\n          >\n            {value.name}\n          </div>\n        </div>\n      </div>\n    </Tag>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport classNames from 'classnames';\n\nimport { useUploadContext } from '../upload-context';\nimport { FileUploadBtn } from './file-upload-btn';\nimport { FileTag } from './file-tag';\n\nexport const MultipleInputNew = () => {\n  const { fileList, triggerUpload, isImage, handleDelete } = useUploadContext();\n\n  const hasValue = !!fileList[0];\n\n  return (\n    <div\n      className={classNames('w-full h-full flex items-center', {\n        'cursor-pointer': !hasValue,\n      })}\n      onClick={() => triggerUpload()}\n    >\n      <div className=\"flex flex-row flex-wrap gap-0.5 w-full h-full\">\n        {hasValue\n          ? fileList.map(file => (\n              <FileTag\n                value={file}\n                onClose={e => {\n                  e.stopPropagation();\n                  handleDelete(file.uid);\n                }}\n              />\n            ))\n          : null}\n        <FileUploadBtn isImage={isImage} />\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, type PropsWithChildren } from 'react';\n\nimport classNames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { Popover, Image } from '@coze-arch/coze-design';\nimport { IconImageOverlay } from '@coze-arch/bot-icons';\n\nimport {\n  type FileItem,\n  getFileExtension,\n  PREVIEW_IMAGE_TYPE,\n} from '@/hooks/use-upload';\n\nimport styles from './index.module.less';\n\nconst ImagePreviewer = ({ file }) => {\n  const [loadError, setLoadError] = useState(false);\n\n  return (\n    <>\n      {loadError ? (\n        <div\n          className=\"flex flex-col items-center justify-center\"\n          style={{ width: 225, height: 125 }}\n        >\n          <IconImageOverlay className=\"w-8 coz-fg-dim\" />\n          <div className=\"mt-1 coz-fg-primary text-sm font-medium\">\n            {I18n.t('inifinit_list_load_fail')}\n          </div>\n        </div>\n      ) : (\n        <div\n          className={classNames(\n            'flex flex-col items-center justify-center rounded-lg overflow-hidden',\n            !loadError ? 'cursor-zoom-in' : 'cursor-default',\n          )}\n          style={{\n            minWidth: 100,\n            minHeight: 75,\n            background: 'rgba(46, 46, 56, 0.08)',\n          }}\n        >\n          <Image\n            className={classNames(\n              'object-contain object-center rounded-sm w-full h-full',\n            )}\n            imgStyle={{ maxWidth: 400, maxHeight: 300 }}\n            src={file?.url}\n            onLoad={() => {\n              setLoadError(false);\n            }}\n            onError={() => {\n              setLoadError(true);\n            }}\n          />\n        </div>\n      )}\n    </>\n  );\n};\n\nexport const ImgPreviewPopover = (\n  props: PropsWithChildren<{ file?: FileItem }>,\n): JSX.Element => {\n  const { file, children } = props;\n\n  const fileType = getFileExtension(file?.name);\n\n  if (PREVIEW_IMAGE_TYPE.includes(fileType)) {\n    return (\n      <Popover\n        position=\"top\"\n        className={styles['img-popover-content']}\n        showArrow\n        content={<ImagePreviewer file={file} />}\n      >\n        {children}\n      </Popover>\n    );\n  }\n\n  return <>{children}</>;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport classNames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozUpload, IconCozTrashCan } from '@coze-arch/coze-design/icons';\nimport { Typography } from '@coze-arch/coze-design';\n\nimport { FileIcon } from '@/components/file-icon';\n\nimport { useUploadContext } from '../upload-context';\nimport { ImgPreviewPopover } from './img-preview-popover';\nimport { FileUploadBtn } from './file-upload-btn';\nimport { FileTag } from './file-tag';\nconst { Text } = Typography;\n\nexport const SingleInputNew = () => {\n  const { fileList, triggerUpload, handleDelete, isImage } = useUploadContext();\n\n  const value = fileList[0];\n\n  return (\n    <ImgPreviewPopover file={value}>\n      <div\n        className={classNames('w-full h-full flex items-center', {\n          'cursor-pointer': !value,\n        })}\n        onClick={() => {\n          if (!value) {\n            triggerUpload();\n          }\n        }}\n      >\n        {value ? (\n          <FileTag\n            value={value}\n            onClose={e => {\n              handleDelete(value.uid);\n              e.stopPropagation();\n            }}\n          />\n        ) : (\n          <FileUploadBtn isImage={isImage} />\n        )}\n      </div>\n    </ImgPreviewPopover>\n  );\n};\n\nexport const SingleInput = () => {\n  const { fileList, triggerUpload, handleDelete, isImage } = useUploadContext();\n\n  const value = fileList[0];\n\n  const renderText = () => {\n    if (value) {\n      return (\n        <Text\n          ellipsis={{ pos: 'middle', showTooltip: true }}\n          className=\"break-words flex-1 text-xs\"\n        >\n          {value?.name}\n        </Text>\n      );\n    }\n\n    return (\n      <span className=\"text-[#1d1c2359] flex-1 text-xs\">\n        {isImage\n          ? I18n.t('imageflow_input_upload_placeholder')\n          : I18n.t('plugin_file_upload')}\n      </span>\n    );\n  };\n\n  return (\n    <ImgPreviewPopover file={value}>\n      <div\n        className={classNames('w-full h-full', {\n          'cursor-pointer': !value,\n        })}\n        onClick={() => {\n          if (!value) {\n            triggerUpload();\n          }\n        }}\n      >\n        <div className=\"flex items-center space-x-1 h-full\">\n          {value ? <FileIcon file={value} size={16} /> : null}\n\n          {renderText()}\n\n          <div\n            className={classNames(\n              'w-5 h-5',\n              'rounded-[4px]',\n              'flex items-center justify-center',\n              'hover:bg-[#0607091A]  text-[--semi-color-text-2]',\n              'cursor-pointer',\n            )}\n          >\n            {value ? (\n              <IconCozTrashCan\n                className=\"text-sm\"\n                onClick={e => {\n                  handleDelete(value.uid);\n                  e.stopPropagation();\n                }}\n              />\n            ) : (\n              <IconCozUpload className=\"text-sm\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </ImgPreviewPopover>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\n\nimport classNames from 'classnames';\nimport {\n  type LiteralExpression,\n  type ViewVariableType,\n} from '@coze-workflow/base';\nimport { type SelectProps } from '@coze-arch/bot-semi/Select';\n\nimport { UploadProvider, useUploadContext } from './upload-context';\nimport { SingleInputNew, MultipleInputNew } from './components';\nexport interface UploadInputProps {\n  inputType: ViewVariableType;\n  availableFileTypes?: ViewVariableType[];\n  onChange?: (value) => void;\n  value?: LiteralExpression;\n  validateStatus?: SelectProps['validateStatus'];\n  onBlur?: () => void;\n  onUploadChange?: (uploading: boolean) => void;\n}\n\nconst Input = ({ onUploadChange }) => {\n  const { multiple, isUploading } = useUploadContext();\n\n  useEffect(() => {\n    onUploadChange?.(isUploading);\n  }, [isUploading]);\n\n  return (\n    <div className={classNames('w-full pl-0.5', multiple ? 'h-full' : 'h-5')}>\n      {multiple ? <MultipleInputNew /> : <SingleInputNew />}\n    </div>\n  );\n};\n\nexport const FileInput = (props: UploadInputProps) => {\n  const {\n    value,\n    onChange,\n    onBlur,\n    inputType,\n    availableFileTypes,\n    onUploadChange,\n  } = props;\n\n  return (\n    <UploadProvider\n      inputType={inputType}\n      availableFileTypes={availableFileTypes}\n      value={value}\n      onChange={onChange}\n      onBlur={onBlur}\n    >\n      <Input onUploadChange={onUploadChange} />\n    </UploadProvider>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport classnames from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport { Avatar, Tag } from '@coze-arch/coze-design';\n\nimport voiceAvatar from '../assets/voice_avatar.png';\n\ninterface TagProps {\n  name?: string;\n  onClose?: () => void;\n}\n\nexport const VoiceTag = ({ name, onClose }: TagProps) => (\n  <Tag\n    size=\"mini\"\n    closable={!!onClose}\n    onClose={onClose}\n    className={classnames('max-w-full min-w-[65%] overflow-hidden w-full')}\n    style={{\n      height: 20,\n    }}\n    color=\"primary\"\n  >\n    <div\n      className={classnames('block w-full overflow-hidden', {\n        'text-[12px] coz-fg-primary font-medium': true,\n      })}\n    >\n      {name}\n    </div>\n  </Tag>\n);\n\ninterface OptionProps {\n  onClick?: () => void;\n}\n\nexport const VoiceOption = ({ onClick }: OptionProps) => (\n  <>\n    <div className=\"w-full relative\">\n      <div\n        className={classnames(\n          'p-1 flex items-center cursor-pointer hover:coz-mg-primary active:coz-mg-primary-pressed h-6 rounded-[4px] coz-mg-primary',\n        )}\n      >\n        <Avatar\n          style={{\n            width: '16px',\n            height: '16px',\n          }}\n          shape={'square'}\n          size=\"extra-extra-small\"\n          src={voiceAvatar}\n        />\n\n        <div className=\"flex-1 ml-1 truncate text-xs\" onClick={onClick}>\n          {I18n.t('workflow_variable_select_voice')}\n        </div>\n      </div>\n    </div>\n  </>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Tooltip } from '@coze-arch/coze-design';\n\nexport const ObjectRefValueDisplay: FC<{}> = props => (\n  <Tooltip\n    content={I18n.t(\n      'workflow_250310_14',\n      undefined,\n      ',',\n    )}\n  >\n    <div\n      className={'w-0 grow coz-fg-primary text-xs truncate'}\n      style={{\n        height: '20px',\n        lineHeight: '20px',\n        padding: '0 4px 0 2px',\n        margin: '0 2px 0 2px',\n      }}\n    >\n      {I18n.t('workflow_250310_15', undefined, '')}\n    </div>\n  </Tooltip>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ValueExpressionType, ViewVariableType } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\n\nimport { type InputType } from './InputField';\n\n/** input type options */\nexport const TYPE_OPTIONS = (\n  inputType: InputType,\n): {\n  value: ValueExpressionType;\n  label: string;\n  disabled?: boolean;\n}[] => [\n  {\n    value: ValueExpressionType.REF,\n    label: I18n.t('workflow_detail_node_parameter_reference'),\n  },\n  {\n    value: ValueExpressionType.LITERAL,\n    label: ViewVariableType.isFileType(inputType)\n      ? I18n.t('imageflow_input_upload')\n      : I18n.t('workflow_detail_node_parameter_input'),\n  },\n];\n\nconst EMPTY_LITERAL = {\n  type: ValueExpressionType.LITERAL,\n};\n\nconst EMPTY_REF = {\n  type: ValueExpressionType.REF,\n};\n\n/** Null values for each input type */\nexport const EMPTY_VALUE = {\n  [ValueExpressionType.REF]: EMPTY_REF,\n  [ValueExpressionType.LITERAL]: EMPTY_LITERAL,\n};\n\n/** default value */\nexport const DEFAULT_VALUE = EMPTY_REF;\n\nexport const VARIABLE_SELECTOR_STYLE = {\n  width: '100%',\n  height: '100%',\n};\n\nexport const SELECT_STYLE = {\n  width: 115,\n};\n\nexport const SELECT_POPOVER_MIN_WIDTH = 130;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable complexity -- no need to check */\nimport React, {\n  useCallback,\n  type CSSProperties,\n  useState,\n  useMemo,\n  useRef,\n} from 'react';\n\nimport classnames from 'classnames';\nimport { type SchemaObject } from 'ajv';\nimport {\n  ValueExpression,\n  ValueExpressionType,\n  ViewVariableType,\n  useNodeTestId,\n  type LiteralExpression,\n} from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { type SelectProps } from '@coze-arch/bot-semi/Select';\nimport { IconCozApply } from '@coze-arch/coze-design/icons';\nimport { IconButton } from '@coze-arch/coze-design';\n\nimport { useRefInputNode } from '@/hooks/use-ref-input';\nimport {\n  LiteralValueInput,\n  type LiteralValueType,\n  type InputType as LiteralInputType,\n} from '@/form-extensions/components/literal-value-input';\n\nimport {\n  type RenderDisplayVarName,\n  type CustomFilterVar,\n} from '../tree-variable-selector/types';\nimport { FileInput } from '../file-input';\nimport { type VariableSelectorProps } from '../../components/tree-variable-selector';\nimport { VoiceTag } from './voice/voice-option';\nimport useVoice from './voice/use-voice';\nimport {\n  type RefTagColor,\n  type RefValueDisplayProps,\n} from './ref-value-display';\nimport { ObjectRefValueDisplay } from './object-ref-display';\nimport { ValueExpressionInputContext } from './context';\nimport { SELECT_POPOVER_MIN_WIDTH, VARIABLE_SELECTOR_STYLE } from './const';\n\nimport styles from './index.module.less';\n\nexport interface ValueExpressionInputProps {\n  className?: string;\n  testId?: string;\n  value: ValueExpression | undefined;\n  onChange: (value: ValueExpression | undefined) => void;\n  onBlur?: () => void;\n  disabled?: boolean;\n  /**\n   * After specifying inputType, the parameter type is fixed and cannot be switched, but variables that are not of this data type can still be selected, and the running state will perform type conversion\n   */\n  inputType?: LiteralInputType;\n  /**\n   * You can switch between several specified types. When length = 1, the usage is the same as inputType.\n   * Effective only in TypedValueExpressionInput\n   * When inputType is specified at the same time, the union of two props is taken\n   */\n  inputTypes?: LiteralInputType[];\n  /**\n   * Default selected data type\n   */\n  defaultInputType?: LiteralInputType;\n  availableFileTypes?: Array<ViewVariableType>;\n  validateStatus?: SelectProps['validateStatus'];\n  optionFilter?: VariableSelectorProps['optionFilter'];\n  handleDataSource?: VariableSelectorProps['handleDataSource'];\n  invalidContent?: string;\n  style?: CSSProperties;\n  selectStyle?: CSSProperties;\n  literalStyle?: CSSProperties;\n  variableTagStyle?: CSSProperties;\n  readonly?: boolean;\n  /** Prohibited data types */\n  disabledTypes?: Array<ViewVariableType>;\n  literalDisabled?: boolean;\n\n  /** Whether to disable variable reference mode */\n  refDisabled?: boolean;\n  literalConfig?: {\n    min?: number;\n    max?: number;\n    optionsList?: { label: string; value: string }[];\n    /**\n     * Schema configuration of object types for json editor code hints and validation\n     */\n    jsonSchema?: SchemaObject;\n  };\n  showClear?: boolean;\n  customFilterVar?: CustomFilterVar;\n  refTagColor?: RefTagColor;\n  placeholder?: string;\n  inputPlaceholder?: string;\n  renderDisplayVarName?: RenderDisplayVarName;\n  hideSettingIcon?: boolean;\n  hideDeleteIcon?: boolean;\n  enableSelectNode?: boolean;\n  variablesDatasource?: VariableSelectorProps['dataSource'];\n  /**\n   * Forbid type conversion. Switching variable types is not supported when a reference variable (ValueExpression) is selected\n   */\n  forbidTypeCast?: boolean;\n  /* Type restrictions, when the reference type does not meet the restrictions, a warning message is displayed */\n  variableTypeConstraints?: RefValueDisplayProps['variableTypeConstraints'];\n}\n\nexport const ValueExpressionInput = ({\n  className,\n  value,\n  onChange,\n  onBlur,\n  disabled,\n  variablesDatasource: variablesDataSource,\n  inputType = ViewVariableType.String,\n  availableFileTypes = [],\n  validateStatus,\n  invalidContent,\n  style,\n  literalStyle,\n  readonly,\n  testId,\n  disabledTypes,\n  optionFilter,\n  literalDisabled = false,\n  refDisabled = false,\n  showClear = false,\n  hideDeleteIcon = false,\n  hideSettingIcon = false,\n  enableSelectNode = false,\n  renderDisplayVarName,\n  customFilterVar,\n  literalConfig = {},\n  refTagColor,\n  placeholder,\n  inputPlaceholder,\n  variableTagStyle,\n  handleDataSource,\n  variableTypeConstraints,\n}: ValueExpressionInputProps) => {\n  const { concatTestId } = useNodeTestId();\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const onLiteralChange = useCallback(\n    (v?: LiteralValueType): void => {\n      onChange({ type: ValueExpressionType.LITERAL, content: v ?? undefined });\n    },\n    [onChange],\n  );\n\n  const onImageChange = useCallback(\n    v => {\n      onChange({\n        type: ValueExpressionType.LITERAL,\n        content: v?.url || '',\n        rawMeta: { fileName: v?.name, type: inputType },\n      });\n    },\n    [onChange],\n  );\n\n  const [focused, setFocused] = useState(false);\n\n  const handleFocus = () => setFocused(true);\n  const handleBlur = () => {\n    setFocused(false);\n    onBlur?.();\n  };\n\n  const isRefValue =\n    !!value && ValueExpression.isRef(value) && !!value.content?.keyPath;\n\n  const isLiteralJsonValue = useMemo(\n    () =>\n      !!value &&\n      ValueExpression.isLiteral(value) &&\n      ViewVariableType.isJSONInputType(inputType),\n    [value, inputType],\n  );\n\n  const [isUploadingFile, setIsUploadingFile] = useState(false);\n\n  const isLiteralMultiFileValue =\n    ((value &&\n      !ValueExpression.isEmpty(value) &&\n      ValueExpression.isLiteral(value)) ||\n      isUploadingFile) &&\n    ViewVariableType.isArrayType(inputType) &&\n    ViewVariableType.isFileType(inputType) &&\n    inputType !== ViewVariableType.ArrayVoice;\n\n  const isLiteralMultiLineValue =\n    isLiteralJsonValue &&\n    String((value as LiteralExpression)?.content)?.includes('\\n');\n\n  const [expandLiteralInput, setExpandLiteralInput] = useState(false);\n\n  const isVoiceValue =\n    ViewVariableType.isVoiceType(inputType) &&\n    !!value &&\n    ValueExpression.isLiteral(value) &&\n    value.content;\n\n  const { renderVariableSelectorExtraOption, selectVoiceModal, voiceSelector } =\n    useVoice({\n      inputType,\n      onChange,\n      onBlur,\n      disabled,\n      validateStatus,\n      value,\n    });\n\n  const renderInputRight = () => {\n    if (ViewVariableType.isVoiceType(inputType)) {\n      return voiceSelector;\n    }\n\n    if (ViewVariableType.isFileType(inputType)) {\n      return (\n        <FileInput\n          value={value as LiteralExpression}\n          inputType={inputType}\n          availableFileTypes={availableFileTypes}\n          onChange={onImageChange}\n          onUploadChange={uploading => setIsUploadingFile(uploading)}\n          onBlur={onBlur}\n        />\n      );\n    }\n\n    return (\n      <LiteralValueInput\n        className={classnames(styles['literal-value-input'], {\n          'pb-[24px]':\n            isLiteralMultiLineValue ||\n            (ViewVariableType.isJSONInputType(inputType) && expandLiteralInput),\n        })}\n        testId={concatTestId(testId ?? '', 'literal-input')}\n        readonly={readonly}\n        disabled={disabled}\n        value={(value as LiteralExpression)?.content}\n        inputType={inputType}\n        onBlur={handleBlur}\n        onFocus={handleFocus}\n        onChange={onLiteralChange}\n        config={{\n          ...literalConfig,\n          onRequestInputExpand: isLiteralJsonValue\n            ? setExpandLiteralInput\n            : undefined,\n        }}\n        style={literalStyle}\n        placeholder={inputPlaceholder ?? I18n.t('workflow_241015_01')}\n      />\n    );\n  };\n\n  const { renderVariableSelect, renderVariableDisplay } = useRefInputNode({\n    value,\n    onChange,\n    onBlur,\n    disabled,\n    variablesDataSource,\n    validateStatus,\n    readonly,\n    testId,\n    disabledTypes,\n    showClear,\n    invalidContent,\n    renderDisplayVarName,\n    customFilterVar,\n    setFocused,\n    style: VARIABLE_SELECTOR_STYLE,\n    refTagColor,\n    hideDeleteIcon,\n    variableTagStyle,\n    optionFilter,\n    renderExtraOption: renderVariableSelectorExtraOption,\n    enableSelectNode,\n    handleDataSource,\n    popoverStyle: containerRef.current\n      ? {\n          minWidth: Math.max(\n            containerRef.current.clientWidth,\n            SELECT_POPOVER_MIN_WIDTH,\n          ),\n        }\n      : undefined,\n    variableTypeConstraints,\n  });\n\n  const renderInput = () => {\n    if (isVoiceValue) {\n      return renderVariableSelect(\n        <div\n          className={classnames(\n            'cursor-pointer w-full overflow-hidden flex items-center pl-0.5',\n          )}\n        >\n          <VoiceTag\n            name={\n              (value as LiteralExpression)?.rawMeta?.fileName || value?.content\n            }\n            onClose={() => onChange?.(undefined)}\n          />\n        </div>,\n      );\n    }\n\n    return isRefValue ? renderVariableDisplay() : renderInputRight();\n  };\n  const finalClassName = useMemo(\n    () =>\n      classnames(\n        className,\n        'flex items-start border border-solid bg-transparent max-w-[100%] py-[1px]',\n        {\n          'semi-input-wrapper-error': validateStatus === 'error',\n          'coz-stroke-plus': validateStatus !== 'error',\n          '!bg-transparent': focused,\n          '!coz-stroke-hglt': focused && validateStatus !== 'error',\n          'pointer-events-none': readonly,\n        },\n        'hover:coz-mg-primary-hovered',\n        isLiteralMultiLineValue || isLiteralMultiFileValue || expandLiteralInput\n          ? 'h-full'\n          : 'h-[24px]',\n        styles['value-expression-input-wrap-new'],\n        'semi-input-wrapper semi-input-wrapper-small',\n      ),\n    [\n      className,\n      validateStatus,\n      focused,\n      readonly,\n      styles,\n      isLiteralMultiLineValue,\n      isLiteralMultiFileValue,\n      expandLiteralInput,\n    ],\n  );\n\n  if (value && ValueExpression.isObjectRef(value)) {\n    return (\n      <div className={finalClassName} style={style} ref={containerRef}>\n        <ObjectRefValueDisplay />\n      </div>\n    );\n  }\n\n  return (\n    <ValueExpressionInputContext.Provider value={{ testId }}>\n      <div className={finalClassName} style={style} ref={containerRef}>\n        <div className=\"ref-wrapper flex-1 flex w-full h-full items-center overflow-hidden\">\n          {/* Determine whether the variable selects the scene */}\n          {!refDisabled && // When reference mode is enabled, check for:\n          literalDisabled && // Scenario 1: Literals are disabled\n          !isRefValue ? ( // Scenario 2: The current value is not a reference type\n            renderVariableSelect(\n              <div className=\"cursor-pointer w-full h-full overflow-hidden flex items-center px-1\">\n                <p className=\"text-[12px] text-[var(--coz-fg-secondary)] pointer-events-none whitespace-nowrap\">\n                  {placeholder || I18n.t('workflow_variable_ref_placeholder')}\n                </p>\n              </div>,\n            )\n          ) : (\n            <div className={styles['input-wrapper']}>{renderInput()}</div>\n          )}\n        </div>\n        {refDisabled || hideSettingIcon ? null : (\n          <div\n            className={classnames(\n              styles['setting-button-wrap'],\n              'flex-none leading-none',\n              {\n                [styles['pos-absolute']]: isLiteralJsonValue,\n                [styles['self-end']]: isLiteralMultiFileValue,\n              },\n            )}\n          >\n            {renderVariableSelect(\n              <IconButton\n                color=\"secondary\"\n                size=\"small\"\n                icon={<IconCozApply className=\"coz-fg-primary text-sm\" />}\n                data-testid={concatTestId(testId ?? '', 'variable-trigger')}\n              ></IconButton>,\n            )}\n          </div>\n        )}\n\n        {selectVoiceModal}\n      </div>\n    </ValueExpressionInputContext.Provider>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport {\n  type LiteralExpression,\n  type ValueExpression,\n  ValueExpressionType,\n  ViewVariableType,\n} from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozTrashCan } from '@coze-arch/coze-design/icons';\nimport { IconButton, Select } from '@coze-arch/coze-design';\nimport type { TreeNodeData } from '@coze-arch/bot-semi/Tree';\nimport type { SelectProps } from '@coze-arch/bot-semi/Select';\nimport { useSelectVoiceModal } from '@coze-workflow/resources-adapter';\n\nimport { useGlobalState } from '@/hooks';\nimport { type InputType } from '@/form-extensions/components/literal-value-input';\n\nimport { VoiceOption, VoiceTag } from './voice-option';\n\ninterface Props {\n  inputType?: InputType;\n  onChange?: (value?: ValueExpression) => void;\n  disabled?: boolean;\n  value?: ValueExpression;\n  validateStatus?: SelectProps['validateStatus'];\n  onBlur?: () => void;\n}\n\nexport default function useVoice({\n  inputType = ViewVariableType.String,\n  onChange,\n  disabled,\n  value,\n  validateStatus,\n  onBlur,\n}: Props) {\n  const { spaceId } = useGlobalState(false);\n\n  const { open: openSelectVoiceModal, modal: selectVoiceModal } =\n    useSelectVoiceModal({\n      spaceId,\n      onSelectVoice: voice => {\n        onChange?.({\n          type: ValueExpressionType.LITERAL,\n          content: voice?.voice_id || '',\n          rawMeta: {\n            fileName: voice?.voice_name,\n            type: ViewVariableType.Voice,\n          },\n        });\n      },\n    });\n\n  const renderVariableSelectorExtraOption = (\n    _data?: TreeNodeData[],\n    action?: {\n      hiddenPopover: () => void;\n    },\n  ) => {\n    // Currently only voice types have additional options.\n    if (ViewVariableType.isVoiceType(inputType)) {\n      const handleClickVoiceOption = () => {\n        openSelectVoiceModal();\n        action?.hiddenPopover();\n      };\n\n      return <VoiceOption onClick={handleClickVoiceOption} />;\n    }\n\n    return null;\n  };\n\n  const voiceSelector = (\n    <Select\n      borderless\n      emptyContent={null}\n      triggerRender={() => (\n        <div\n          className=\"cursor-pointer w-full overflow-hidden flex items-center justify-between pl-[4px]\"\n          style={{\n            fontSize: 12,\n            color: 'var(--semi-color-text-2)',\n          }}\n          onClick={() => {\n            !disabled && openSelectVoiceModal();\n          }}\n        >\n          {value?.content ? (\n            <>\n              <VoiceTag\n                name={(value as LiteralExpression)?.rawMeta?.fileName}\n              />\n              <IconButton\n                onClick={e => {\n                  e.stopPropagation();\n                  onChange?.(undefined);\n                }}\n                color=\"secondary\"\n                size=\"small\"\n                icon={<IconCozTrashCan />}\n              ></IconButton>\n            </>\n          ) : (\n            I18n.t('workflow_variable_select_voice')\n          )}\n        </div>\n      )}\n      disabled={disabled}\n      onBlur={onBlur}\n      value={(value as LiteralExpression)?.rawMeta?.fileName as string}\n      placeholder={I18n.t('workflow_variable_select_voice')}\n      validateStatus={validateStatus}\n      size=\"small\"\n      style={{\n        width: '100%',\n      }}\n    />\n  );\n\n  return {\n    renderVariableSelectorExtraOption,\n    selectVoiceModal,\n    voiceSelector,\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { memo } from 'react';\n\nimport { type ValueExpressionInputProps } from './value-expression-input';\nimport { TypedValueExpressionInput } from './typed-value-expression-input';\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst ValueExpressionInput = memo(TypedValueExpressionInput);\n\nexport { ValueExpressionInput, type ValueExpressionInputProps };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo, useState, useEffect } from 'react';\n\nimport { uniq } from 'lodash-es';\nimport classNames from 'classnames';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\nimport { useVariableTypeChange } from '@coze-workflow/variable';\nimport {\n  ValueExpression,\n  ValueExpressionType,\n  ViewVariableType,\n  useNodeTestId,\n} from '@coze-workflow/base';\n\nimport { useVariableService } from '@/hooks';\nimport { VariableTypeSelector } from '@/form-extensions/components/variable-type-selector';\nimport { type InputType } from '@/form-extensions/components/literal-value-input';\n\nimport {\n  ValueExpressionInput,\n  type ValueExpressionInputProps,\n} from './value-expression-input';\n\nimport styles from './index.module.less';\n\nexport const TypedValueExpressionInput = ({\n  className,\n  inputType,\n  inputTypes = [],\n  onChange,\n  style,\n  forbidTypeCast,\n  defaultInputType,\n  ...props\n}: ValueExpressionInputProps) => {\n  const node = useCurrentEntity();\n  const variableService = useVariableService();\n  const { concatTestId } = useNodeTestId();\n\n  const {\n    value,\n    readonly,\n    disabled,\n    disabledTypes: outerDisabledTypes,\n    testId,\n  } = props;\n  const outerInputType: ViewVariableType[] = inputTypes.concat(inputType ?? []);\n  // When the value is null, the type information will be cached in this field after switching the type. To avoid when there is no value, call onChange to trigger the form null value verification, showing an error of \"Parameter cannot be null\"\n  const [emptyValueInputType, setEmptyValueInputType] = useState<InputType>();\n  const getDefaultInputType = (): InputType => {\n    if (emptyValueInputType) {\n      return emptyValueInputType;\n    }\n\n    let targetType: InputType | undefined = undefined;\n    // The type is stored in rawMeta, and the type specified in rawMeta is returned.\n    if (value?.rawMeta?.type) {\n      targetType = value.rawMeta.type;\n    }\n    // Preferentially use the type determined above, otherwise: if it is a reference, return the type of the reference type variable\n    if (!targetType && value && ValueExpression.isRef(value)) {\n      const _refVariableType = variableService.getViewVariableByKeyPath(\n        value.content?.keyPath,\n        { node, checkScope: true },\n      )?.type;\n      if (_refVariableType && !outerDisabledTypes?.includes(_refVariableType)) {\n        targetType = _refVariableType;\n      }\n    }\n\n    // The default type is externally specified\n    if (!targetType && defaultInputType) {\n      targetType = defaultInputType;\n    }\n\n    // Take the first one from the complement of the disabled type as the default type\n    if (!targetType) {\n      const availableTypes = ViewVariableType.getComplement(\n        outerDisabledTypes ?? [],\n      );\n      targetType =\n        availableTypes?.[0] || outerInputType?.[0] || ViewVariableType.String;\n    }\n    // Determines whether the type of the type identified above is within the range specified by outerInputType\n    if (outerInputType?.length) {\n      return outerInputType.includes(targetType)\n        ? targetType\n        : outerInputType[0];\n    }\n    return targetType;\n  };\n\n  const innerInputType = useMemo(\n    () => getDefaultInputType(),\n    [value, outerInputType, outerDisabledTypes, emptyValueInputType],\n  );\n\n  const hiddenTypes = useMemo<ViewVariableType[] | undefined>(() => {\n    // outerInputType hides other types when it has a value\n    if (outerInputType?.length) {\n      return ViewVariableType.getComplement(outerInputType);\n    }\n    return outerDisabledTypes;\n  }, [outerInputType, outerDisabledTypes]);\n\n  const handleTypeChange = (\n    val?: string | number | Array<unknown> | Record<string, unknown>,\n  ) => {\n    if (!val) {\n      return;\n    }\n    const type = val as InputType;\n    const initialContent = ViewVariableType.isJSONInputType(type)\n      ? ViewVariableType.isArrayType(type)\n        ? '[]'\n        : '{}'\n      : undefined;\n    // Value is a newly added parameter when it does not exist or only has a type field\n    if (!value || ('type' in value && Object.keys(value)?.length === 1)) {\n      if (initialContent) {\n        setEmptyValueInputType(undefined);\n        onChange({\n          type: ValueExpressionType.LITERAL,\n          content: initialContent,\n          rawMeta: { type },\n        });\n      } else {\n        setEmptyValueInputType(type);\n      }\n    } else {\n      setEmptyValueInputType(undefined);\n      if (ValueExpression.isRef(value)) {\n        onChange({\n          ...value,\n          rawMeta: {\n            ...value?.rawMeta,\n            type,\n          },\n        });\n      }\n      // When switching types, clear content, different content types are not compatible\n      if (ValueExpression.isLiteral(value)) {\n        onChange({\n          type: ValueExpressionType.LITERAL,\n          content: initialContent,\n          rawMeta: {\n            ...value.rawMeta,\n            type,\n          },\n        });\n      }\n    }\n  };\n\n  const [refVariableType, setRefVariableType] = useState<ViewVariableType>();\n  useEffect(() => {\n    if (!value || ValueExpression.isEmpty(value)) {\n      setRefVariableType(undefined);\n      return;\n    }\n    if (ValueExpression.isRef(value)) {\n      const _refVariableType = variableService.getViewVariableByKeyPath(\n        value.content?.keyPath,\n        { node, checkScope: true },\n      )?.type;\n      setRefVariableType(_refVariableType);\n    }\n  }, [value]);\n  const handleChange: ValueExpressionInputProps['onChange'] = val => {\n    setEmptyValueInputType(undefined);\n    // When emptied, the innerInputType is reset.\n    if (!val || ValueExpression.isEmpty(val)) {\n      // When val is undefined (remove the ref reference), empty it all and reset the innerInputType\n      // Only empty content, do not reset innerInputType\n      onChange(\n        val\n          ? {\n              ...val,\n              rawMeta: {\n                ...val?.rawMeta,\n                type: innerInputType,\n              },\n            }\n          : val,\n      );\n      return;\n    }\n    // Update innerInputType when switching reference types\n    let _inputType = innerInputType;\n    if (ValueExpression.isRef(val)) {\n      const _refVariableType = variableService.getViewVariableByKeyPath(\n        val.content?.keyPath,\n        { node, checkScope: true },\n      )?.type;\n      if (_refVariableType) {\n        // When no external type is specified or the reference type is within the scope of the specified type, the reference variable can only update the variable type.\n        if (\n          !outerInputType?.length ||\n          outerInputType.includes(_refVariableType)\n        ) {\n          _inputType = _refVariableType;\n        }\n      }\n    }\n    onChange({\n      ...val,\n      rawMeta: {\n        ...val.rawMeta,\n        type: _inputType,\n      },\n    });\n    // Trigger onBlur validation\n    props?.onBlur?.();\n  };\n\n  const keyPath =\n    value && ValueExpression.isRef(value) ? value?.content?.keyPath ?? [] : [];\n  // Externally modified variable type\n  useVariableTypeChange({\n    keyPath,\n    onTypeChange: ({ variableMeta }) => {\n      setRefVariableType(variableMeta?.type);\n      if (variableMeta?.type && variableMeta.type !== innerInputType) {\n        handleTypeChange(variableMeta.type);\n      }\n    },\n  });\n\n  // Automatically disable the drop-down box when there is only one type available (hiddenTypes+disabledTypes complement)\n  const disableDropdown = useMemo(() => {\n    const availableTypes = ViewVariableType.getComplement(\n      uniq([...(outerDisabledTypes ?? []), ...(hiddenTypes ?? [])]),\n    );\n\n    return (\n      (value &&\n        (ValueExpression.isRef(value) || props.literalDisabled) &&\n        forbidTypeCast) ||\n      availableTypes.length <= 1\n    );\n  }, [\n    outerDisabledTypes,\n    hiddenTypes,\n    forbidTypeCast,\n    value,\n    props.literalDisabled,\n  ]);\n\n  // Show warning messages on variable labels\n  const showRefWarning =\n    // When disabling type selection\n    disableDropdown ||\n    // The reference variable type exists but is not within the scope of the specified type\n    (refVariableType &&\n      outerInputType.length &&\n      !outerInputType.includes(refVariableType));\n  return (\n    <div\n      className={classNames(\n        'typed-value-expression-input flex items-start w-full',\n        className,\n      )}\n      style={style}\n    >\n      <div className={styles['variable-type-selector-wrapper']}>\n        <VariableTypeSelector\n          readonly={readonly}\n          disabled={disabled}\n          value={innerInputType}\n          contentClassName=\"h-full\"\n          onChange={handleTypeChange}\n          disabledTypes={outerDisabledTypes}\n          testId={concatTestId(testId ?? '', 'variable-type-selector')}\n          hiddenTypes={hiddenTypes}\n          disableDropdown={disableDropdown}\n          refVariableType={showRefWarning ? undefined : refVariableType}\n        />\n      </div>\n      <ValueExpressionInput\n        {...props}\n        onChange={handleChange}\n        inputType={innerInputType}\n        variableTypeConstraints={\n          showRefWarning\n            ? {\n                mainType: innerInputType,\n                subType: ViewVariableType.isFileType(innerInputType)\n                  ? props.availableFileTypes\n                  : undefined,\n              }\n            : undefined\n        }\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable complexity */\nimport { type CSSProperties, type FC, useMemo } from 'react';\n\nimport classnames from 'classnames';\nimport {\n  getGlobalVariableAlias,\n  type RefExpression,\n  useWorkflowVariableByKeyPath,\n} from '@coze-workflow/variable';\nimport { type NodeData, WorkflowNodeData } from '@coze-workflow/nodes';\nimport {\n  useNodeTestId,\n  // FILE_TYPES,\n  VARIABLE_TYPE_ALIAS_MAP,\n  type ViewVariableType,\n  WorkflowNode,\n} from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozInfoCircle } from '@coze-arch/coze-design/icons';\nimport { Popover, Tag } from '@coze-arch/coze-design';\n\nimport GlobalVarIcon from '@/form-extensions/components/tree-variable-selector/global-var-icon';\nimport { NodeIconOutlined } from '@/components/node-icon';\n\nimport { useValueExpressionInputContext } from './context';\n\nimport styles from './index.module.less';\nexport enum RefTagColor {\n  Primary = 'primary',\n  Green = 'green',\n}\n\nexport interface RefValueDisplayProps {\n  value: RefExpression;\n  closable?: boolean;\n  onClose: () => void;\n  tagColor?: RefTagColor;\n  style?: CSSProperties;\n  /* Type restrictions, when the reference type does not meet the restrictions, a warning message is displayed */\n  variableTypeConstraints?: {\n    /** Main type restrictions, subtype restrictions are optional*/\n    mainType: ViewVariableType;\n    /** Subtype restrictions, mainly for subtypes of file types */\n    subType?: ViewVariableType[];\n  };\n  readonly?: boolean;\n}\n\nconst COLORS_MAP: Record<RefTagColor, [string, string]> = {\n  [RefTagColor.Primary]: ['coz-fg-dim', 'coz-fg-primary'],\n  [RefTagColor.Green]: ['coz-fg-hglt-green-dim', 'coz-fg-hglt-green'],\n};\n\nexport const RefValueDisplay: FC<RefValueDisplayProps> = props => {\n  const {\n    onClose,\n    value,\n    closable = true,\n    style,\n    tagColor = RefTagColor.Primary,\n    variableTypeConstraints,\n    readonly,\n  } = props;\n\n  const workflowVariable = useWorkflowVariableByKeyPath(value.content?.keyPath);\n  const isNodeVariable = workflowVariable?.keyPath?.length === 1;\n  const { testId } = useValueExpressionInputContext();\n  const { concatTestId } = useNodeTestId();\n\n  const warningMessage = useMemo(() => {\n    if (!variableTypeConstraints) {\n      return;\n    }\n    const constraintTypes = [\n      variableTypeConstraints.mainType,\n      ...(variableTypeConstraints.subType ?? []),\n    ].filter(Boolean);\n    const refVariableType = workflowVariable?.viewMeta?.type;\n    if (!constraintTypes?.length || !refVariableType) {\n      return '';\n    }\n    if (constraintTypes.includes(refVariableType)) {\n      return '';\n    }\n    return I18n.t('workflow_var_type_same', {\n      type: VARIABLE_TYPE_ALIAS_MAP[variableTypeConstraints.mainType],\n    });\n  }, [workflowVariable, variableTypeConstraints]);\n\n  if (!workflowVariable) {\n    return (\n      <Tag\n        className={classnames(\n          'w-full max-w-full min-w-[65%] overflow-hidden pointer-events-auto',\n          styles['undefined-ref-tag'],\n        )}\n        color=\"yellow\"\n        closable={readonly ? false : closable}\n        onClose={onClose}\n        visible\n        style={{\n          height: 20,\n          padding: '0 4px 0 2px',\n          ...style,\n        }}\n      >\n        <div className=\"flex min-w-0 grow gap-[2px] items-center text-[12px] font-medium coz-fg-hglt-yellow\">\n          <IconCozInfoCircle className=\"text-[14px]\" />\n          <span>{I18n.t('workflow_variable_undefined')}</span>\n        </div>\n      </Tag>\n    );\n  }\n\n  const node = workflowVariable?.node;\n  const nodeDataEntity = node?.getData<WorkflowNodeData>(WorkflowNodeData);\n  const nodeData = nodeDataEntity?.getNodeData<keyof NodeData>();\n  const [_dimColor, nameColor] = COLORS_MAP[tagColor];\n  const workflowNode = node && new WorkflowNode(node);\n  const globalVarAlias = getGlobalVariableAlias(\n    workflowVariable.globalVariableKey,\n  );\n  const renderTag = () => (\n    <Tag\n      size=\"mini\"\n      closable={readonly ? false : closable}\n      onClose={onClose}\n      className=\"w-full max-w-full min-w-[65%] overflow-hidden pointer-events-auto\"\n      color={tagColor}\n      visible\n      style={{\n        height: 20,\n        padding: '0 4px 0 1px',\n        ...style,\n        ...(warningMessage\n          ? { backgroundColor: 'var(--coz-mg-hglt-secondary-yellow)' }\n          : {}),\n      }}\n    >\n      <div className=\"flex w-0 grow overflow-hidden\">\n        <div\n          className={classnames('flex min-w-0 grow', {\n            'items-center': true,\n          })}\n          data-testid={concatTestId(testId ?? '', 'ref-value-tag')}\n        >\n          {\n            <>\n              {workflowVariable.globalVariableKey ? (\n                <span className=\"flex text-[15px]\">\n                  <GlobalVarIcon nodeId={workflowVariable.globalVariableKey} />\n                </span>\n              ) : (\n                <NodeIconOutlined\n                  icon={workflowNode?.icon || (nodeData?.icon as string)}\n                />\n              )}\n              <span className=\"coz-fg-secondary truncate ml-0.5 text-[12px] font-medium\">\n                {workflowNode?.title || nodeData?.title || globalVarAlias}\n              </span>\n              <span\n                className={classnames(\n                  'coz-fg-secondary mx-0.5 text-[12px] font-medium',\n                  {\n                    hidden: isNodeVariable,\n                  },\n                )}\n                style={{ transform: 'scaleX(0.6)' }}\n              >\n                -\n              </span>\n            </>\n          }\n          <div\n            className={classnames(nameColor, 'flex-1 truncate font-medium', {\n              'text-[12px]': true,\n              hidden: isNodeVariable,\n            })}\n          >\n            {workflowVariable.viewMeta?.name}\n          </div>\n        </div>\n      </div>\n    </Tag>\n  );\n\n  return (\n    <Popover\n      style={{\n        maxWidth: 280,\n        padding: '7px 8px',\n        border: '1px solid var(--coz-stroke-plus)',\n        background: 'var(--coz-bg-max)',\n        boxShadow:\n          '0px 8px 24px 0px rgba(0, 0, 0, 0.04), 0px 4px 12px 0px rgba(0, 0, 0, 0.08)',\n        borderRadius: 8,\n        pointerEvents: 'none',\n      }}\n      position=\"top\"\n      content={\n        <div\n          className=\"flex flex-col gap-[6px]  text-[12px]\"\n          onClick={e => e.stopPropagation()}\n        >\n          <div className=\"flex flex-wrap items-center font-medium leading-4 overflow-hidden text-ellipsis\">\n            {workflowVariable.globalVariableKey ? (\n              <span className=\"flex text-[13px]\">\n                <GlobalVarIcon nodeId={workflowVariable.globalVariableKey} />\n              </span>\n            ) : (\n              <NodeIconOutlined\n                icon={workflowNode?.icon || (nodeData?.icon as string)}\n                size={14}\n              />\n            )}\n            <span className=\"coz-fg-secondary truncate ml-1\">\n              {workflowNode?.title || nodeData?.title || globalVarAlias}\n            </span>\n            <span\n              className=\"coz-fg-secondary mx-0.5\"\n              style={{ transform: 'scaleX(0.6)' }}\n            >\n              -\n            </span>\n            <span className=\"text-[#000000] truncate\">\n              {workflowVariable.viewMeta?.name}\n            </span>\n            {workflowVariable.viewMeta?.required ? (\n              <span\n                style={{\n                  color: 'var(--light-usage-danger-color-danger,#f93920)',\n                }}\n              >\n                *\n              </span>\n            ) : null}\n            {workflowVariable.viewMeta?.type ? (\n              <span className=\"coz-fg-primary coz-mg-primary text-[10px] leading-4 inline-block ml-1 px-[3px] rounded-mini\">\n                {VARIABLE_TYPE_ALIAS_MAP[workflowVariable.viewMeta.type]}\n              </span>\n            ) : null}\n          </div>\n          {workflowVariable.viewMeta?.description ? (\n            <div className=\"coz-fg-secondary font-normal leading-4 line-clamp-5\">\n              {workflowVariable.viewMeta.description}\n            </div>\n          ) : null}\n          {warningMessage ? (\n            <div className=\"coz-fg-hglt-yellow font-normal leading-4\">\n              {warningMessage}\n            </div>\n          ) : null}\n        </div>\n      }\n    >\n      {renderTag()}\n    </Popover>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReactNode } from 'react';\n\nimport { VARIABLE_TYPE_ALIAS_MAP, ViewVariableType } from '@coze-workflow/base';\nimport { getFlags } from '@coze-arch/bot-flags';\n\nimport { ObjectLikeTypes } from '@/form-extensions/components/output-tree/components/custom-tree-node/constants';\n\nconst LEVEL_LIMIT = 3;\n\nexport const generateVariableOption = ({\n  type,\n  label,\n  display,\n  parentPath,\n}: {\n  type: ViewVariableType;\n  label?: string;\n  display?: string;\n  parentPath?: Array<number | string>;\n}) => {\n  let targetLabel: string;\n  if (label) {\n    targetLabel = label;\n  } else if (ViewVariableType.isArrayType(type)) {\n    const subType = ViewVariableType.getArraySubType(type);\n    targetLabel = VARIABLE_TYPE_ALIAS_MAP[subType];\n  } else {\n    targetLabel = VARIABLE_TYPE_ALIAS_MAP[type];\n  }\n  return {\n    value: Number(type),\n    label: targetLabel,\n    display: display || label || VARIABLE_TYPE_ALIAS_MAP[type],\n    path: [...(parentPath ?? []), type],\n  };\n};\n\nexport const VARIABLE_TYPE_DIVIDER = 'divider';\n\nexport type VariableTypeOption =\n  | {\n      // Value of type, possibly empty when not a leaf node\n      value: number | string;\n      // The display name of the option\n      label: ReactNode;\n      // Echoed display name\n      display?: string;\n      // Is the type disabled?\n      disabled?: boolean;\n      // subtype\n      children?: VariableTypeOption[];\n      path?: Array<number | string>;\n    }\n  | typeof VARIABLE_TYPE_DIVIDER;\n\nconst getFileChildren = (\n  parentPath: Array<number | string>,\n): VariableTypeOption[] => {\n  const FLAGS = getFlags();\n\n  const result: Array<VariableTypeOption | null> = [\n    generateVariableOption({\n      type: ViewVariableType.File,\n      label: 'Default',\n      display: 'File',\n      parentPath,\n    }),\n    VARIABLE_TYPE_DIVIDER,\n    generateVariableOption({ type: ViewVariableType.Image, parentPath }),\n    generateVariableOption({ type: ViewVariableType.Svg, parentPath }),\n    VARIABLE_TYPE_DIVIDER,\n    generateVariableOption({ type: ViewVariableType.Audio, parentPath }),\n    generateVariableOption({ type: ViewVariableType.Video, parentPath }),\n    // 1. Whether the auto start node is enabled to support the timbre field ability\n    // 2. Whether the voice resource function is turned on\n    FLAGS['bot.automation.start_support_voice'] &&\n    FLAGS['bot.studio.library_voice_resource']\n      ? generateVariableOption({ type: ViewVariableType.Voice })\n      : null,\n    VARIABLE_TYPE_DIVIDER,\n    generateVariableOption({ type: ViewVariableType.Doc, parentPath }),\n    generateVariableOption({ type: ViewVariableType.Ppt, parentPath }),\n    generateVariableOption({ type: ViewVariableType.Excel, parentPath }),\n    generateVariableOption({ type: ViewVariableType.Txt, parentPath }),\n    generateVariableOption({ type: ViewVariableType.Code, parentPath }),\n    VARIABLE_TYPE_DIVIDER,\n    generateVariableOption({ type: ViewVariableType.Zip, parentPath }),\n  ];\n\n  return result.filter((v): v is VariableTypeOption => Boolean(v));\n};\n\nconst getArrayChildren = (\n  parentPath: Array<number | string>,\n): Array<VariableTypeOption> => {\n  const fileArrayValue = '$file-array-category';\n  const fileArrayParentPath = parentPath.concat(fileArrayValue);\n  return [\n    generateVariableOption({ type: ViewVariableType.ArrayString, parentPath }),\n    generateVariableOption({ type: ViewVariableType.ArrayInteger, parentPath }),\n    generateVariableOption({ type: ViewVariableType.ArrayNumber, parentPath }),\n    generateVariableOption({ type: ViewVariableType.ArrayBoolean, parentPath }),\n    generateVariableOption({ type: ViewVariableType.ArrayTime, parentPath }),\n    generateVariableOption({ type: ViewVariableType.ArrayObject, parentPath }),\n    {\n      value: fileArrayValue,\n      label: 'File',\n      children: [\n        generateVariableOption({\n          type: ViewVariableType.ArrayFile,\n          label: 'Default',\n          display: 'Array<File>',\n          parentPath: fileArrayParentPath,\n        }),\n        VARIABLE_TYPE_DIVIDER,\n        generateVariableOption({\n          type: ViewVariableType.ArrayImage,\n          parentPath: fileArrayParentPath,\n        }),\n        generateVariableOption({\n          type: ViewVariableType.ArraySvg,\n          parentPath: fileArrayParentPath,\n        }),\n        VARIABLE_TYPE_DIVIDER,\n        generateVariableOption({\n          type: ViewVariableType.ArrayAudio,\n          parentPath: fileArrayParentPath,\n        }),\n        generateVariableOption({\n          type: ViewVariableType.ArrayVideo,\n          parentPath: fileArrayParentPath,\n        }),\n        VARIABLE_TYPE_DIVIDER,\n        generateVariableOption({\n          type: ViewVariableType.ArrayDoc,\n          parentPath: fileArrayParentPath,\n        }),\n        generateVariableOption({\n          type: ViewVariableType.ArrayPpt,\n          parentPath: fileArrayParentPath,\n        }),\n        generateVariableOption({\n          type: ViewVariableType.ArrayExcel,\n          parentPath: fileArrayParentPath,\n        }),\n        generateVariableOption({\n          type: ViewVariableType.ArrayTxt,\n          parentPath: fileArrayParentPath,\n        }),\n        generateVariableOption({\n          type: ViewVariableType.ArrayCode,\n          parentPath: fileArrayParentPath,\n        }),\n        VARIABLE_TYPE_DIVIDER,\n        generateVariableOption({\n          type: ViewVariableType.ArrayZip,\n          parentPath: fileArrayParentPath,\n        }),\n      ],\n    },\n  ];\n};\n\nexport const allVariableTypeList: Array<VariableTypeOption> = [\n  generateVariableOption({ type: ViewVariableType.String }),\n  generateVariableOption({ type: ViewVariableType.Integer }),\n  generateVariableOption({ type: ViewVariableType.Number }),\n  generateVariableOption({ type: ViewVariableType.Boolean }),\n  generateVariableOption({ type: ViewVariableType.Time }),\n  generateVariableOption({ type: ViewVariableType.Object }),\n  {\n    value: '$array-category',\n    label: 'Array',\n    children: getArrayChildren(['$array-category']),\n  },\n  {\n    value: '$file-category',\n    label: 'File',\n    children: getFileChildren(['$file-category']),\n  },\n];\n\nconst filterTypes = (\n  list: Array<VariableTypeOption>,\n  options?: VariableListOptions,\n): VariableTypeOption[] => {\n  const { disabledTypes = [], hiddenTypes = [], level } = options || {};\n\n  const result: VariableTypeOption[] = list.reduce((pre, cur) => {\n    if (cur === VARIABLE_TYPE_DIVIDER) {\n      return [...pre, VARIABLE_TYPE_DIVIDER];\n    }\n    const newOption = { ...cur };\n\n    if (newOption.children) {\n      newOption.children = filterTypes(newOption.children, options);\n    }\n\n    /**\n     * 1. Hide when hitting hideType\n     * 2. There are children, but when the children are all hidden, the parent is also hidden\n     * 3. File types do not allow nesting\n     */\n    const hidden =\n      hiddenTypes.some(type => type === newOption.value) ||\n      newOption.children?.length === 0 ||\n      (level &&\n        level >= 1 &&\n        ViewVariableType.isFileType(newOption.value as ViewVariableType));\n\n    /**\n     * 1. Disable when hitting disabledTypes\n     * 2. Disable the ObjectLike type when the level limit is reached to avoid too deep nesting\n     */\n    const disabled = Boolean(\n      disabledTypes?.includes(Number(newOption.value)) ||\n        (level &&\n          level >= LEVEL_LIMIT &&\n          ObjectLikeTypes.includes(Number(newOption.value))),\n    );\n\n    if (hidden) {\n      return pre;\n    }\n\n    return [\n      ...pre,\n      {\n        ...newOption,\n        disabled,\n      },\n    ];\n  }, [] as Array<VariableTypeOption>);\n  // If the separator is at the beginning and end, remove it\n  while (result[0] === VARIABLE_TYPE_DIVIDER) {\n    result.shift();\n  }\n  while (result[result.length - 1] === VARIABLE_TYPE_DIVIDER) {\n    result.pop();\n  }\n  return result;\n};\n\ninterface VariableListOptions {\n  disabledTypes?: Array<ViewVariableType>;\n  hiddenTypes?: Array<ViewVariableType>;\n  level?: number;\n}\n\nexport const getVariableTypeList = options =>\n  filterTypes(allVariableTypeList, options);\n\n/**\n * Get the path of the type in the options list\n */\nexport const getSelectedValuePath = (\n  originalVal: ViewVariableType,\n  list: Array<VariableTypeOption>,\n  path: Array<string | number> = [],\n) => {\n  let valuePath = [...path];\n  list.forEach(item => {\n    if (item === VARIABLE_TYPE_DIVIDER) {\n      return;\n    }\n    if (item.children) {\n      const childPath = getSelectedValuePath(originalVal, item.children, [\n        ...valuePath,\n        item.value,\n      ]);\n      if (childPath[childPath.length - 1] === originalVal) {\n        valuePath = childPath;\n        return;\n      }\n    } else if (item.value === originalVal) {\n      valuePath.push(originalVal);\n      return;\n    }\n  });\n\n  return valuePath;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ReactNode } from 'react';\n\nimport { ViewVariableType } from '@coze-workflow/base/types';\nimport {\n  IconCozNumberBracket,\n  IconCozString,\n  IconCozStringBracket,\n  IconCozBoolean,\n  IconCozBooleanBracket,\n  IconCozBrace,\n  IconCozBraceBracket,\n  IconCozFolder,\n  IconCozFolderBracket,\n  IconCozImage,\n  IconCozImageBracket,\n  IconCozSound,\n  IconCozNumber,\n  IconCozNumberInt,\n  IconCozNumberIntBracket,\n  IconCozClock,\n  IconCozClockBracket,\n} from '@coze-arch/coze-design/icons';\n\nexport const VARIABLE_TYPE_ICONS_MAP: Record<ViewVariableType, ReactNode> = {\n  [ViewVariableType.String]: <IconCozString />,\n  [ViewVariableType.Integer]: <IconCozNumberInt />,\n  [ViewVariableType.Boolean]: <IconCozBoolean />,\n  [ViewVariableType.Number]: <IconCozNumber />,\n  [ViewVariableType.Object]: <IconCozBrace />,\n  [ViewVariableType.Image]: <IconCozImage />,\n  [ViewVariableType.File]: <IconCozFolder />,\n  [ViewVariableType.Doc]: <IconCozFolder />,\n  [ViewVariableType.Code]: <IconCozFolder />,\n  [ViewVariableType.Ppt]: <IconCozFolder />,\n  [ViewVariableType.Txt]: <IconCozFolder />,\n  [ViewVariableType.Excel]: <IconCozFolder />,\n  [ViewVariableType.Audio]: <IconCozFolder />,\n  [ViewVariableType.Zip]: <IconCozFolder />,\n  [ViewVariableType.Video]: <IconCozFolder />,\n  [ViewVariableType.Svg]: <IconCozImage />,\n  [ViewVariableType.Voice]: <IconCozSound />,\n  [ViewVariableType.Time]: <IconCozClock />,\n  [ViewVariableType.ArrayString]: <IconCozStringBracket />,\n  [ViewVariableType.ArrayInteger]: <IconCozNumberIntBracket />,\n  [ViewVariableType.ArrayBoolean]: <IconCozBooleanBracket />,\n  [ViewVariableType.ArrayNumber]: <IconCozNumberBracket />,\n  [ViewVariableType.ArrayObject]: <IconCozBraceBracket />,\n  [ViewVariableType.ArrayImage]: <IconCozImageBracket />,\n  [ViewVariableType.ArrayFile]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayDoc]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayCode]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayPpt]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayTxt]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayExcel]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayAudio]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayZip]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayVideo]: <IconCozFolderBracket />,\n  [ViewVariableType.ArraySvg]: <IconCozImageBracket />,\n  [ViewVariableType.ArrayVoice]: <IconCozFolderBracket />,\n  [ViewVariableType.ArrayTime]: <IconCozClockBracket />,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  useMemo,\n  type CSSProperties,\n  type PropsWithChildren,\n} from 'react';\n\nimport classNames from 'classnames';\nimport {\n  VARIABLE_TYPE_ALIAS_MAP,\n  type ViewVariableType,\n} from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozArrowDown,\n  IconCozArrowRight,\n  IconCozCheckMarkFill,\n} from '@coze-arch/coze-design/icons';\nimport {\n  Dropdown,\n  Tooltip,\n  type DropdownProps,\n  type SelectProps,\n  Typography,\n} from '@coze-arch/coze-design';\n\nimport {\n  allVariableTypeList,\n  getSelectedValuePath,\n  getVariableTypeList,\n  VARIABLE_TYPE_DIVIDER,\n  type VariableTypeOption,\n} from './utils';\nimport { VARIABLE_TYPE_ICONS_MAP } from './constants';\n\nimport styles from './index.module.less';\n\nexport interface VariableTypeSelectorProps {\n  value: ViewVariableType;\n  level?: number;\n  onChange?: SelectProps['onChange'];\n  readonly?: boolean;\n  disabled?: boolean;\n  /** Types not supported */\n  disabledTypes?: ViewVariableType[];\n  /** hidden type */\n  hiddenTypes?: ViewVariableType[];\n  validateStatus?: SelectProps['validateStatus'];\n  onBlur?: () => void;\n  onFocus?: () => void;\n  testId?: string;\n  disableDropdown?: boolean;\n  contentClassName?: string;\n  contentStyle?: CSSProperties;\n  refVariableType?: ViewVariableType;\n}\n\nexport function VariableTypeSelector({\n  value,\n  onChange,\n  onFocus,\n  onBlur,\n  level,\n  readonly,\n  disabled,\n  disabledTypes = [],\n  hiddenTypes = [],\n  validateStatus,\n  testId,\n  contentClassName,\n  contentStyle,\n  disableDropdown,\n  children,\n  refVariableType,\n}: PropsWithChildren<VariableTypeSelectorProps>) {\n  const optionList = useMemo(\n    () => getVariableTypeList({ disabledTypes, hiddenTypes, level }),\n    [disabledTypes, hiddenTypes, level],\n  );\n\n  const selectedValuePath = useMemo(\n    () => getSelectedValuePath(value, allVariableTypeList),\n    [value],\n  );\n\n  const handleSelect = (val: ViewVariableType) => {\n    onChange?.(val);\n  };\n\n  const warningMessage = useMemo(() => {\n    if (disableDropdown || !refVariableType || refVariableType === value) {\n      return '';\n    }\n    return I18n.t('workflow_refer_var_type_same', {\n      type: VARIABLE_TYPE_ALIAS_MAP[refVariableType],\n    });\n  }, [refVariableType, value, disableDropdown]);\n\n  const renderContent = (selected: Array<string | number>) =>\n    children ? (\n      children\n    ) : (\n      <div className={contentClassName} style={contentStyle}>\n        <Tooltip\n          style={{\n            pointerEvents: 'none',\n            transform: warningMessage ? 'translateX(-8px)' : 'none',\n          }}\n          content={\n            <div className=\"flex flex-col items-start gap-[6px]\">\n              <Typography.Text size=\"small\" weight={500}>\n                {VARIABLE_TYPE_ALIAS_MAP[selected[selected.length - 1]]}\n              </Typography.Text>\n              {warningMessage ? (\n                <Typography.Text size=\"small\" className=\"coz-fg-hglt-yellow\">\n                  {warningMessage}\n                </Typography.Text>\n              ) : null}\n            </div>\n          }\n        >\n          <div\n            data-testid={testId}\n            className={classNames(\n              `flex items-center gap-0.5 p-[1px] h-full ${\n                readonly || disabled || disableDropdown\n                  ? 'cursor-auto'\n                  : 'cursor-pointer'\n              }`,\n              {\n                'hover:coz-mg-secondary-hovered active:coz-mg-secondary-pressed':\n                  !disableDropdown && !disabled && !readonly,\n              },\n            )}\n          >\n            <span\n              className={classNames('coz-fg-secondary p-[2px] flex', {\n                'coz-mg-hglt-secondary-yellow rounded-[4px]':\n                  Boolean(warningMessage),\n              })}\n            >\n              {VARIABLE_TYPE_ICONS_MAP[selected[selected.length - 1]]}\n            </span>\n            {disableDropdown ? null : (\n              <IconCozArrowDown className=\"coz-fg-secondary\" />\n            )}\n          </div>\n        </Tooltip>\n      </div>\n    );\n\n  const renderDropdown = (\n    menus: VariableTypeOption[],\n    content: React.ReactNode,\n    props: Pick<DropdownProps, 'trigger' | 'position'>,\n  ) => (\n    <Dropdown\n      {...props}\n      className={styles.dropdwon}\n      clickToHide={true}\n      onVisibleChange={visible => {\n        visible ? onFocus?.() : onBlur?.();\n      }}\n      motion={false}\n      render={\n        <Dropdown.Menu\n          className=\"min-w-[160px]\"\n          selectedKeys={[selectedValuePath.join('/')]}\n        >\n          {menus.map(menu => {\n            if (menu === VARIABLE_TYPE_DIVIDER) {\n              return <Dropdown.Divider />;\n            }\n            const itemContent = (\n              <Dropdown.Item\n                showTick={true}\n                icon={<IconCozCheckMarkFill className=\"coz-fg-hglt\" />}\n                itemKey={menu.path?.join('/')}\n                disabled={menu.disabled}\n                onClick={() => {\n                  if (menu.children?.length) {\n                    return;\n                  }\n                  handleSelect(menu.value as ViewVariableType);\n                }}\n              >\n                {menu.children?.length ? (\n                  <div className=\"flex items-center justify-between w-[112px]\">\n                    {menu.label}\n                    <IconCozArrowRight />\n                  </div>\n                ) : (\n                  menu.label\n                )}\n              </Dropdown.Item>\n            );\n            if (menu.children?.length) {\n              return renderDropdown(menu.children, itemContent, {\n                trigger: 'hover',\n                position: 'leftTop',\n              });\n            }\n            return itemContent;\n          })}\n        </Dropdown.Menu>\n      }\n    >\n      {content}\n    </Dropdown>\n  );\n\n  if (disableDropdown || disabled || readonly) {\n    return renderContent(selectedValuePath);\n  }\n\n  return renderDropdown(optionList, renderContent(selectedValuePath), {\n    trigger: 'click',\n    position: 'bottomLeft',\n  });\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, type PropsWithChildren } from 'react';\n\nimport classNames from 'classnames';\nimport { type WithCustomStyle } from '@coze-workflow/base/types';\n\nexport const VariableTypeTag: FC<\n  PropsWithChildren<\n    WithCustomStyle<{\n      size?: 'xs' | 'default';\n    }>\n  >\n> = props => {\n  const { children, className, size = 'default' } = props;\n  return (\n    <div\n      className={classNames(\n        {\n          'py-[1px] px-[3px] ml-1 rounded-[4px] h-4': size === 'xs',\n          'py-0.5 px-2 rounded-[6px] ml-2': size === 'default',\n        },\n        'shrink-0 flex items-center coz-mg-primary',\n        className,\n      )}\n    >\n      <span\n        className={classNames(\n          {\n            'text-mini': size === 'xs',\n            'text-xs': size === 'default',\n          },\n          'coz-fg-primary block',\n        )}\n      >\n        {children}\n      </span>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * This hooks is used to handle the scaling of the canvas after the side sheet panel is opened, ensuring that the host node is centered and visible\n */\nimport { useEffect } from 'react';\n\nimport {\n  PlaygroundConfigEntity,\n  useEntity,\n  usePlayground,\n  TransformData,\n} from '@flowgram-adapter/free-layout-editor';\nimport { SizeSchema } from '@flowgram-adapter/common';\n\nconst SCROLL_TO_VIEW_TIMEOUT = 200;\nconst BOUNDS_PAD = 30;\n\n/** Reset the canvas scale to the appropriate size for the host node when the side sheet panel is open */\nexport const useFitViewport = (params: {\n  enable?: boolean;\n  nodeId?: string;\n}) => {\n  const { enable, nodeId } = params;\n  const playgroundConfig = useEntity<PlaygroundConfigEntity>(\n    PlaygroundConfigEntity,\n  );\n  const playground = usePlayground();\n\n  useEffect(() => {\n    if (!enable || !nodeId) {\n      return;\n    }\n\n    setTimeout(() => {\n      const currentNode = playground.entityManager.getEntityById(nodeId);\n      if (!currentNode) {\n        return;\n      }\n\n      const { bounds } = currentNode.getData<TransformData>(TransformData);\n      bounds.pad(BOUNDS_PAD, BOUNDS_PAD);\n      const viewport = playgroundConfig.getViewport(false);\n      const zoom = SizeSchema.fixSize(bounds, viewport);\n\n      playgroundConfig.scrollToView({\n        bounds,\n        zoom,\n        scrollToCenter: true,\n      });\n    }, SCROLL_TO_VIEW_TIMEOUT);\n  }, [enable]);\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type NodeResult } from '@coze-workflow/base/api';\n\nfunction getPromptExecuteValue(\n  prompt: string,\n  variables: Record<string, string>,\n) {\n  const regex = /{{(.*?)}}/g;\n\n  const replacedPrompt =\n    prompt?.replace(\n      regex,\n      (match, variable) =>\n        // Check whether there is a corresponding variable value in value, and replace it if so, otherwise keep it as it is.\n        variables[variable.trim()] || match,\n    ) ?? '';\n\n  return replacedPrompt;\n}\n\nexport const useLLMPromptHistory = (\n  prompt: string,\n  testRunResult: NodeResult | undefined,\n) => {\n  const llmInputStr = testRunResult?.input;\n  const inputParams = llmInputStr ? JSON.parse(llmInputStr) : {};\n  const human = getPromptExecuteValue(prompt, inputParams);\n  const ai = testRunResult?.raw_output ?? '';\n\n  return JSON.stringify({\n    Human: human,\n    Ai: ai,\n  });\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useState } from 'react';\n\nimport { KnowledgeApi } from '@coze-arch/bot-api';\n\ninterface ModelInfo {\n  name?: string;\n}\n\nexport const useVectorModelList = () => {\n  const [vectorModellList, setVectorModelList] = useState<ModelInfo[]>([]);\n\n  useEffect(() => {\n    async function getVectorModelList() {\n      const res = await KnowledgeApi.ListModel();\n      setVectorModelList(res?.models ?? []);\n    }\n\n    getVectorModelList();\n  }, []);\n\n  return { vectorModellList };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * TODO: This hooks is temporarily used to get the inputsParameters of the current node and the type corresponding to each variable\n */\n\nimport { useState, useEffect } from 'react';\n\nimport { FlowNodeFormData } from '@flowgram-adapter/free-layout-editor';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\nimport {\n  type ValueExpression,\n  ValueExpressionType,\n  ViewVariableType,\n  WorkflowVariableService,\n} from '@coze-workflow/variable';\n\ninterface InputParameterWithType {\n  name: string;\n  input: ValueExpression;\n  type: ViewVariableType;\n}\n\nexport const useGetCurrentInputsParameters = () => {\n  const node = useCurrentEntity();\n  const formEntity = node.getData(FlowNodeFormData);\n  const [formValue, setFormValue] = useState(\n    formEntity.formModel.getFormItemValueByPath('/'),\n  );\n  const [inputsParameters, setInputsParameters] = useState<\n    Array<{\n      name: string;\n      input: ValueExpression;\n    }>\n  >([]);\n\n  useEffect(() => {\n    const disposable = formEntity.onDataChange(params => {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const newValue = (params as any).formModel.getFormItemValueByPath('/');\n      setFormValue({ ...newValue });\n    });\n\n    return () => disposable.dispose();\n  }, [formEntity]);\n\n  useEffect(() => {\n    Object.keys(formValue).forEach(key => {\n      if (key.endsWith('inputParameters')) {\n        setInputsParameters(formValue[key]);\n      }\n    });\n  }, [formValue]);\n  const variableService: WorkflowVariableService = useService(\n    WorkflowVariableService,\n  );\n\n  return inputsParameters.reduce<InputParameterWithType[]>((buf, item) => {\n    if (!item.name || !item.input) {\n      return buf;\n    }\n    let inputViewVariableType;\n    if (item.input.type === ValueExpressionType.LITERAL) {\n      inputViewVariableType = ViewVariableType.String;\n    } else if (item.input.type === ValueExpressionType.OBJECT_REF) {\n      inputViewVariableType = ViewVariableType.Object;\n    } else {\n      inputViewVariableType = variableService.getViewVariableByKeyPath(\n        item.input.content?.keyPath,\n        { node },\n      )?.type;\n    }\n\n    buf.push({\n      ...item,\n      type: inputViewVariableType,\n    });\n\n    return buf;\n  }, []);\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\n\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { useRefresh, useService } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowDocument } from '@flowgram-adapter/free-layout-editor';\nimport {\n  type WorkflowVariable,\n  useAvailableWorkflowVariables,\n  getGlobalVariableAlias,\n} from '@coze-workflow/variable';\nimport { WorkflowNodesService } from '@coze-workflow/nodes';\nimport { type StandardNodeType } from '@coze-workflow/base';\n\nimport { type VariableMetaWithNode } from '../typings';\n\nexport const useNodeServiceAndRefreshForTitleChange = () => {\n  const nodesService = useService<WorkflowNodesService>(WorkflowNodesService);\n  const doc = useService<WorkflowDocument>(WorkflowDocument);\n  const refresh = useRefresh();\n\n  useEffect(() => {\n    const dipose = nodesService.onNodesTitleChange(() => refresh());\n    // Wait until the document is loaded and rehaje is rendered before you can get the title data.\n    const dispose2 = doc.onLoaded(() => refresh());\n    return () => {\n      dipose.dispose();\n      dispose2.dispose();\n    };\n  }, []);\n\n  const getNodeInfoInVariableMeta = (node: FlowNodeEntity) => {\n    const nodeTitle = nodesService.getNodeTitle(node);\n\n    const info = {\n      nodeTitle,\n      nodeId: node.id,\n      nodeType: node.flowNodeType\n        ? (String(node.flowNodeType) as StandardNodeType)\n        : undefined,\n    };\n\n    return info;\n  };\n\n  return { nodesService, getNodeInfoInVariableMeta };\n};\n\nexport const useNodeAvailableVariablesWithNode =\n  (): Array<VariableMetaWithNode> => {\n    const variables: WorkflowVariable[] = useAvailableWorkflowVariables();\n    const { getNodeInfoInVariableMeta } =\n      useNodeServiceAndRefreshForTitleChange();\n\n    return variables\n      .map(variable => {\n        if (!variable.viewMeta) {\n          return;\n        }\n\n        return {\n          ...variable.viewMeta,\n          ...(variable.node\n            ? getNodeInfoInVariableMeta(variable.node)\n            : {\n                nodeTitle: getGlobalVariableAlias(variable.globalVariableKey),\n                nodeId: variable.globalVariableKey,\n              }),\n        };\n      })\n      .filter(Boolean) as Array<VariableMetaWithNode>;\n  };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst ASCII_CODE_A = 65; // The ASCII serial number corresponding to the letter A\n\nexport function convertNumberToLetters(n) {\n  let result = '';\n  while (n >= 0) {\n    result = String.fromCharCode((n % 26) + ASCII_CODE_A) + result;\n    n = Math.floor(n / 26) - 1;\n  }\n  return result;\n}\n\nexport const calcPortId = (index: number) => `branch_${index}`;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport {\n  type ViewVariableTreeNode,\n  ViewVariableType,\n  WorkflowVariableService,\n  type ValueExpression,\n  ValueExpressionType,\n} from '@coze-workflow/variable';\nimport { nodeUtils } from '@coze-workflow/nodes';\nimport { type InputValueVO } from '@coze-workflow/base';\n\nimport { useCodeSetterContext } from '../context';\n\nexport type InputParams = Array<{\n  name: string;\n  input: ValueExpression;\n}>;\nexport type OutputParams = ViewVariableTreeNode[];\nexport interface ParsedOutput {\n  name: string;\n  type: ViewVariableType;\n  children?: ParsedOutput[];\n}\n\nexport interface ParsedOutputWithKey extends ParsedOutput {\n  key?: string;\n}\n\nconst recursiveParseOutput = (output?: OutputParams) => {\n  if (!output) {\n    return undefined;\n  }\n\n  return output.map(item => {\n    const parsedOutput: ParsedOutput = {\n      name: item.name,\n      type: item.type,\n    };\n    if (item.children) {\n      parsedOutput.children = recursiveParseOutput(item.children);\n    }\n\n    return parsedOutput;\n  });\n};\n\nconst recursiveParseInput = (options: {\n  inputParams?: InputValueVO[];\n  workflowVariableService: WorkflowVariableService;\n  flowNodeEntity?: FlowNodeEntity;\n}) => {\n  const { inputParams, workflowVariableService, flowNodeEntity } = options;\n\n  const parsedInput: Array<{\n    name?: string;\n    type?: ViewVariableType;\n    children?: ViewVariableTreeNode[];\n  }> = [];\n\n  // eslint-disable-next-line complexity\n  inputParams?.forEach(inputValue => {\n    if (inputValue?.input?.type === ValueExpressionType.OBJECT_REF) {\n      parsedInput.push({\n        name: inputValue.name,\n        type: ViewVariableType.Object,\n        children: recursiveParseInput({\n          ...options,\n          inputParams: inputValue.children,\n        }) as ViewVariableTreeNode[],\n      });\n    } else if (inputValue?.input?.type === ValueExpressionType.LITERAL) {\n      parsedInput.push({\n        name: inputValue.name,\n        type:\n          inputValue?.input?.rawMeta?.type ||\n          nodeUtils.getLiteralExpressionViewVariableType(\n            inputValue?.input?.content,\n          ),\n      });\n    } else if (inputValue?.input?.type === ValueExpressionType.REF) {\n      const refVariableMeta = workflowVariableService.getViewVariableByKeyPath(\n        inputValue.input.content?.keyPath,\n        { node: flowNodeEntity },\n      );\n\n      // The Code node has just been dragged into the canvas. The input may only have the key and no variable is selected. At this time, the type cannot be calculated. By default, a string is given.\n      let type = refVariableMeta?.type || ViewVariableType.String;\n\n      // File types are not supported in the code, just treat them as strings.\n      if (ViewVariableType.isFileType(type)) {\n        type = ViewVariableType.String;\n      }\n\n      parsedInput.push({\n        name: inputValue.name,\n        type,\n        children: parseInputValueChildren(refVariableMeta?.children),\n      });\n    }\n  });\n\n  return parsedInput;\n};\n\nconst parseInputValueChildren = (children?: ViewVariableTreeNode[]) => {\n  if (!children) {\n    return undefined;\n  }\n  return children.map(item => ({\n    name: item.name,\n    type: item.type,\n    children: parseInputValueChildren(item.children),\n  }));\n};\n\nexport const useIDEInputOutputType = (options: {\n  inputParams?: InputParams;\n  outputParams?: OutputParams;\n  outputPath: string;\n}) => {\n  const { inputParams, outputParams } = options;\n  const { flowNodeEntity } = useCodeSetterContext();\n\n  const workflowVariableService = useService<WorkflowVariableService>(\n    WorkflowVariableService,\n  );\n\n  return {\n    parsedInput: recursiveParseInput({\n      inputParams,\n      workflowVariableService,\n      flowNodeEntity,\n    }),\n    parsedOutput: recursiveParseOutput(outputParams) ?? [],\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport React, { type FC } from 'react';\n\nimport { FlowNodeFormData } from '@flowgram-adapter/free-layout-editor';\nimport { useEntity } from '@flowgram-adapter/free-layout-editor';\nimport { type EditorProps, Editor } from '@coze-workflow/code-editor-adapter';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { IconCozPlayCircle } from '@coze-arch/coze-design/icons';\n\nimport { useTestFormState } from '@/hooks';\n\nimport { type CodeEditorValue } from '../types';\nimport {\n  type InputParams,\n  type OutputParams,\n  // type ParsedOutput,\n  useIDEInputOutputType,\n} from '../hooks/use-ide-input-output-type';\nimport { useCodeSetterContext } from '../context';\nimport {\n  DEFAULT_LANGUAGES,\n  LANG_CODE_NAME_MAP,\n  LANG_NAME_CODE_MAP,\n} from '../constants';\nimport { useBizIDEState } from '../../../../hooks/use-biz-ide-state';\nimport { WorkflowGlobalStateEntity } from '../../../../entities';\n\nimport styles from './index.module.less';\n\nexport const BizIDE: FC<{\n  value: CodeEditorValue;\n  onChange: (value?: CodeEditorValue) => void;\n  onClose: () => void;\n  languageTemplates?: EditorProps['languageTemplates'];\n  inputParams?: InputParams;\n  outputParams?: OutputParams;\n  outputPath: string;\n}> = props => {\n  const {\n    value,\n    onChange,\n    onClose,\n    inputParams,\n    outputParams,\n    outputPath,\n    languageTemplates = DEFAULT_LANGUAGES,\n  } = props;\n  const testFormState = useTestFormState();\n\n  const handleTestClick = () => {\n    testFormState.showTestNodeForm();\n  };\n\n  const { parsedInput, parsedOutput } = useIDEInputOutputType({\n    inputParams,\n    outputParams,\n    outputPath,\n  });\n  const { flowNodeEntity } = useCodeSetterContext();\n\n  const { setIsBizIDETesting } = useBizIDEState();\n  const { getNodeSetterId } = useNodeTestId();\n  const setterTestId = getNodeSetterId('biz-editor');\n\n  const globalState = useEntity<WorkflowGlobalStateEntity>(\n    WorkflowGlobalStateEntity,\n  );\n\n  // const handleOutputSchemaChange = (output: ParsedOutput[]) => {\n  //   updateOutput(output);\n  // };\n\n  const handleOnChange: EditorProps['onChange'] = (code, language) => {\n    onChange?.({\n      code,\n      language: LANG_NAME_CODE_MAP.get(language) as number,\n    });\n  };\n\n  const handleOnStatusChange = (status: string) => {\n    setIsBizIDETesting(status === 'running');\n  };\n  const formModel =\n    flowNodeEntity?.getData<FlowNodeFormData>(FlowNodeFormData).formModel;\n\n  const nodeMeta = formModel?.getFormItemValueByPath('/nodeMeta');\n\n  return (\n    <div className={styles.container} data-testid={setterTestId}>\n      <Editor\n        title={nodeMeta?.title}\n        // After the code is rendered through the panel, the readonly field is not responsive, so it is more reasonable to take it from the global\n        readonly={globalState.readonly}\n        height=\"100%\"\n        width=\"100%\"\n        input={parsedInput}\n        output={parsedOutput}\n        defaultLanguage={\n          LANG_CODE_NAME_MAP.get(value?.language) ?? 'typescript'\n        }\n        defaultContent={value?.code}\n        onTestRunStateChange={handleOnStatusChange}\n        onTestRun={handleTestClick}\n        testRunIcon={<IconCozPlayCircle />}\n        onChange={handleOnChange}\n        onClose={onClose}\n        // Instantiate the IDE by workflow, because in project-ide, multiple workflows are open simultaneously\n        uuid={globalState.workflowId}\n        languageTemplates={languageTemplates}\n        spaceId={globalState.spaceId}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC, useEffect } from 'react';\n\nimport { type FeedbackStatus } from '@flowgram-adapter/free-layout-editor';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\nimport { Previewer } from '@coze-workflow/code-editor-adapter';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozExpand } from '@coze-arch/coze-design/icons';\nimport { IconButton } from '@coze-arch/coze-design';\n\nimport { useNodeFormPanelState } from '@/hooks/use-node-side-sheet-store';\nimport { useGlobalState } from '@/hooks';\n\nimport { useFitViewport } from '../../hooks';\nimport { FormCard } from '../../components/form-card';\nimport { useBizIDEState } from '../../../hooks/use-biz-ide-state';\nimport { type CodeEditorValue } from './types';\nimport {\n  type InputParams,\n  type OutputParams,\n} from './hooks/use-ide-input-output-type';\nimport { getLanguageTemplates } from './defaults';\nimport { CodeSetterContext, useCodeSetterContext } from './context';\nimport { LANG_CODE_NAME_MAP, LanguageEnum } from './constants';\nimport { BizIDE } from './biz-ide-panel/biz-ide';\n\nimport s from './index.module.less';\n\nexport interface ContentRef {\n  enterFullscreen?: () => void;\n}\n\ninterface ValueProps {\n  value: CodeEditorValue;\n  onChange: (value?: CodeEditorValue) => void;\n}\n\nexport interface CodeProps extends ValueProps {\n  tooltip?: string;\n  inputParams?: InputParams;\n  outputParams?: OutputParams;\n  outputPath: string;\n  feedbackText?: string;\n  feedbackStatus?: FeedbackStatus;\n}\n\nexport const CodeEditorWithBizIDE: FC<CodeProps> = (props: CodeProps) => {\n  const {\n    value,\n    onChange,\n    inputParams,\n    outputParams,\n    outputPath,\n    feedbackText,\n    feedbackStatus,\n  } = props;\n\n  const codeSetterContext = useCodeSetterContext();\n\n  const node = useCurrentEntity();\n  const uniqueId = `${node.id}.code_editor`;\n  const { readonly } = useCodeSetterContext();\n\n  const { isBindDouyin } = useGlobalState(false);\n\n  const {\n    forceCloseBizIDE,\n    isBizIDEOpen,\n    uniqueId: bizIDEUniqueId,\n  } = useBizIDEState();\n\n  const { setFullscreenPanel } = useNodeFormPanelState();\n\n  useFitViewport({\n    enable: isBizIDEOpen && uniqueId === bizIDEUniqueId,\n    nodeId: node.id,\n  });\n\n  useEffect(\n    () => () => {\n      forceCloseBizIDE();\n    },\n    [],\n  );\n\n  const languageTemplates = getLanguageTemplates({\n    isBindDouyin,\n  });\n\n  return (\n    <>\n      <div className={s.container}>\n        <FormCard\n          defaultExpand\n          showBottomBorder\n          header={I18n.t('workflow_detail_code_code')}\n          tooltip={props.tooltip}\n          maxContentHeight={218}\n          feedbackText={feedbackText}\n          feedbackStatus={feedbackStatus}\n          noPadding\n        >\n          <div className={s['code-content']} style={{ minHeight: 178 }}>\n            <Previewer\n              content={value?.code ?? ''}\n              language={\n                LANG_CODE_NAME_MAP.get(\n                  value?.language ?? LanguageEnum.NODE_JS,\n                ) ?? 'javascript'\n              }\n              height={178}\n            />\n          </div>\n        </FormCard>\n        {/* Why not use FormCard's extra instead of absolute positioning?\n            Because MonacoEditor is absolutely positioned, the hierarchy will cover the hierarchy of the previous button. If you add zIndex to the button, it will be higher than the zIndex of the canvas, so put it here for absolute positioning.\n          */}\n        <div\n          style={{\n            display: 'flex',\n            position: 'absolute',\n            top: 10,\n            right: 12,\n          }}\n        >\n          <IconButton\n            color=\"highlight\"\n            size=\"small\"\n            icon={\n              readonly ? null : <IconCozExpand className={s.editInIDEIcon} />\n            }\n            // onClick={() => openBizIDE(uniqueId)}\n            onClick={() => {\n              setFullscreenPanel(\n                <CodeSetterContext.Provider value={codeSetterContext}>\n                  <BizIDE\n                    value={value}\n                    onChange={onChange}\n                    inputParams={inputParams}\n                    outputParams={outputParams}\n                    outputPath={outputPath}\n                    languageTemplates={languageTemplates}\n                    onClose={() => setFullscreenPanel(null)}\n                  />\n                </CodeSetterContext.Provider>,\n              );\n            }}\n          >\n            {readonly\n              ? I18n.t('workflow_detail_code_view_in_ide')\n              : I18n.t('workflow_detail_code_edit_in_ide')}\n          </IconButton>\n        </div>\n      </div>\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type EditorProps } from '@coze-workflow/code-editor-adapter';\nimport { I18n } from '@coze-arch/i18n';\n\nexport enum LanguageEnum {\n  NODE_JS = 1,\n  GO_LANG = 2,\n  PYTHON = 3,\n  JAVA = 4,\n  TYPESCRIPT = 5,\n}\n\nexport const DEFAULT_TYPESCRIPT_CODE_PARAMS = {\n  code: `${I18n.t('workflow_code_js_illustrate_all')}\n\nasync function main({ params }: Args): Promise<Output> {\n    ${I18n.t('workflow_code_js_illustrate_output')}\n    const ret = {\n        \"key0\": params.input + params.input, ${I18n.t(\n          'workflow_code_js_illustrate_output_param',\n        )}\n        \"key1\": [\"hello\", \"world\"], ${I18n.t(\n          'workflow_code_js_illustrate_output_arr',\n        )}\n        \"key2\": { ${I18n.t('workflow_code_js_illustrate_output_obj')}\n            \"key21\": \"hi\"\n        },\n    };\n\n    return ret;\n}`,\n  language: LanguageEnum.TYPESCRIPT,\n};\n\nexport const DEFAULT_IDE_PYTHON_CODE_PARAMS = {\n  code: `${I18n.t('workflow_code_py_illustrate_all')}\n\nasync def main(args: Args) -> Output:\n    params = args.params\n    ${I18n.t('workflow_code_py_illustrate_output')}\n    ret: Output = {\n        \"key0\": params['input'] + params['input'], ${I18n.t(\n          'workflow_code_py_illustrate_output_param',\n        )}\n        \"key1\": [\"hello\", \"world\"],  ${I18n.t(\n          'workflow_code_py_illustrate_output_arr',\n        )}\n        \"key2\": { ${I18n.t('workflow_code_py_illustrate_output_obj')}\n            \"key21\": \"hi\"\n        },\n    }\n    return ret`,\n  language: LanguageEnum.PYTHON,\n};\n\nexport const LANG_CODE_NAME_MAP = new Map<\n  number | undefined,\n  'javascript' | 'python' | 'typescript'\n>([\n  [LanguageEnum.NODE_JS, 'javascript'],\n  [LanguageEnum.PYTHON, 'python'],\n  [LanguageEnum.TYPESCRIPT, 'typescript'],\n]);\n\nexport const LANG_NAME_CODE_MAP = new Map<string, number>([\n  ['typescript', LanguageEnum.TYPESCRIPT],\n  ['python', LanguageEnum.PYTHON],\n  ['javascript', LanguageEnum.NODE_JS],\n]);\n\nexport const DEFAULT_LANGUAGES: NonNullable<EditorProps['languageTemplates']> =\n  [\n    {\n      language: 'typescript',\n      template: DEFAULT_TYPESCRIPT_CODE_PARAMS.code,\n      displayName: 'JavaScript',\n    },\n    {\n      language: 'python',\n      displayName: 'Python',\n      template: DEFAULT_IDE_PYTHON_CODE_PARAMS.code,\n    },\n  ];\n\nexport const DEFAULT_AVATAR_LANGUAGES: NonNullable<\n  EditorProps['languageTemplates']\n> = DEFAULT_LANGUAGES.filter(v => v.language === 'python');\n\nexport const DEFAULT_OPEN_SOURCE_LANGUAGES: NonNullable<\n  EditorProps['languageTemplates']\n> = DEFAULT_LANGUAGES.filter(v => v.language === 'python');\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createContext, useContext } from 'react';\n\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\nexport const CodeSetterContext = createContext<\n  Partial<Omit<SetterComponentProps, 'value' | 'onChange' | 'options'>> & {\n    readonly?: boolean;\n  }\n>({});\n\nexport const useCodeSetterContext = () => useContext(CodeSetterContext);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  DEFAULT_AVATAR_LANGUAGES,\n  DEFAULT_IDE_PYTHON_CODE_PARAMS,\n  DEFAULT_LANGUAGES,\n  DEFAULT_OPEN_SOURCE_LANGUAGES,\n  DEFAULT_TYPESCRIPT_CODE_PARAMS,\n} from './constants';\n\nfunction getLanguageTemplates(options?: { isBindDouyin?: boolean }) {\n  // open source version only support Python(limit from backend)\n  return IS_OPEN_SOURCE\n    ? DEFAULT_OPEN_SOURCE_LANGUAGES\n    : options?.isBindDouyin\n    ? DEFAULT_AVATAR_LANGUAGES\n    : DEFAULT_LANGUAGES;\n}\n\nfunction getDefaultValue(options?: { isBindDouyin?: boolean }) {\n  const templates = getLanguageTemplates(options);\n\n  if (templates[0]?.language === 'python') {\n    return DEFAULT_IDE_PYTHON_CODE_PARAMS;\n  }\n\n  return DEFAULT_TYPESCRIPT_CODE_PARAMS;\n}\n\nexport { getLanguageTemplates, getDefaultValue };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { WorkflowDocument } from '@flowgram-adapter/free-layout-editor';\nimport { useVariableTypeChange } from '@coze-workflow/variable';\n\nimport { type ConditionItem } from '../multi-condition/types';\ninterface HiddenConditionItemProps {\n  data: ConditionItem;\n  onDataChange: (data: ConditionItem) => void;\n}\n\nexport const HiddenConditionItem: FC<HiddenConditionItemProps> = props => {\n  const { data, onDataChange } = props;\n  const doc = useService<WorkflowDocument>(WorkflowDocument);\n\n  // Monitor changes in linkage variables to re-trigger the effect\n  useVariableTypeChange({\n    keyPath: data.left?.content?.keyPath,\n    onTypeChange: ({ variableMeta }) => {\n      // When the HACK historical version is loaded into the draft (loading into the draft operation, the canvas reload method is adjusted, resulting in a side effect being triggered), the UI linkage is not triggered\n      if (doc.loading) {\n        return;\n      }\n\n      if (!variableMeta) {\n        // Variables have been deleted\n        onDataChange?.({});\n        return;\n      }\n\n      onDataChange?.({\n        left: data.left,\n      });\n    },\n  });\n\n  return null;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport React, { useState, useEffect } from 'react';\n\nimport { FlowNodeFormData } from '@flowgram-adapter/free-layout-editor';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport { WorkflowValidationService } from '@/services';\n\nimport { useConditionContext } from '../context';\nimport {\n  FormItemFeedback,\n  type FormItemErrorProps,\n} from '../../../../components/form-item-feedback';\n\nexport const withValidationField =\n  <C extends React.ElementType>(\n    // eslint-disable-next-line @typescript-eslint/naming-convention -- react comp\n    Comp: C,\n  ) =>\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  (props: any) => {\n    const { value, disabled, onChange, onBlur, validateResult, ...others } =\n      props;\n    const { flowNodeEntity } = useConditionContext();\n    const node = useCurrentEntity();\n\n    const validationService = useService<WorkflowValidationService>(\n      WorkflowValidationService,\n    );\n\n    const [isShowValidate, setIsShowValidate] = useState(\n      validationService.validatedNodeMap[node.id] ? true : false,\n    );\n\n    // When listening for a canvas form submission, an error message is displayed\n    useEffect(() => {\n      if (flowNodeEntity) {\n        const disposable =\n          /* eslint-disable @typescript-eslint/no-non-null-assertion , @typescript-eslint/no-explicit-any\n          -- disable-next-line conflicts with the automatic repair of the unused-comment rule\n          */\n          (\n            flowNodeEntity.getData<FlowNodeFormData>(FlowNodeFormData)!\n              .formModel! as any\n          ).onValidate(() => {\n            setIsShowValidate(true);\n          });\n        return () => {\n          disposable.dispose();\n        };\n      }\n    }, [flowNodeEntity]);\n\n    useEffect(() => {\n      if (disabled === true) {\n        setIsShowValidate(false);\n      }\n    }, [disabled]);\n\n    const handleOnChange = (innerValue: unknown) => {\n      setIsShowValidate(true);\n      onChange?.(innerValue);\n    };\n\n    const handleOnBlur = () => {\n      setIsShowValidate(true);\n      onBlur?.();\n    };\n\n    return (\n      <>\n        <Comp\n          {...others}\n          disabled={disabled}\n          value={value}\n          onChange={handleOnChange}\n          onBlur={handleOnBlur}\n          validateStatus={\n            isShowValidate ? validateResult?.validStatus : undefined\n          }\n        />\n        {isShowValidate && validateResult?.message ? (\n          <FormItemFeedback\n            feedbackStatus={\n              validateResult?.validStatus as FormItemErrorProps['feedbackStatus']\n            }\n            feedbackText={validateResult?.message ?? ''}\n          />\n        ) : null}\n      </>\n    );\n  };\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport merge from 'lodash-es/merge';\nimport { ConditionType } from '@coze-workflow/base/api';\nimport { I18n } from '@coze-arch/i18n';\n\nexport const conditionRelationField = 'relation';\nexport const referenceNameField = 'param';\nexport const conditionField = 'conditionType';\nexport const compareValueField = 'value';\nexport const isQuotedField = 'isQuote';\nexport const quotedField = 'quotedValue';\nexport const fixedField = 'fixedValue';\nexport const compareIsQuotedField = `${compareValueField}.${isQuotedField}`;\nexport const compareQuotedField = `${compareValueField}.${quotedField}`;\nexport const compareFixedField = `${compareValueField}.${fixedField}`;\n\nexport const equalValue = {\n  [ConditionType.Equal]: () => I18n.t('workflow_detail_condition_select_equal'),\n};\nexport const notEqualValue = {\n  [ConditionType.NotEqual]: () =>\n    I18n.t('workflow_detail_condition_select_not_equal'),\n};\nexport const lengthBiggerValue = {\n  [ConditionType.LengthGt]: () =>\n    I18n.t('workflow_detail_condition_select_longer'),\n};\nexport const lengthBiggerEqualValue = {\n  [ConditionType.LengthGtEqual]: () =>\n    I18n.t('workflow_detail_condition_select_longer_equal'),\n};\nexport const lengthSmallerValue = {\n  [ConditionType.LengthLt]: () =>\n    I18n.t('workflow_detail_condition_select_shorter'),\n};\nexport const lengthSmallerEqualValue = {\n  [ConditionType.LengthLtEqual]: () =>\n    I18n.t('workflow_detail_condition_select_shorter_equal'),\n};\nexport const includeValue = {\n  [ConditionType.Contains]: () =>\n    I18n.t('workflow_detail_condition_select_contain'),\n};\nexport const excludeValue = {\n  [ConditionType.NotContains]: () =>\n    I18n.t('workflow_detail_condition_select_not_contain'),\n};\n\nexport const includeKeyValue = {\n  [ConditionType.Contains]: () => I18n.t('workflow_condition_obj_contain'),\n};\nexport const excludeKeyValue = {\n  [ConditionType.NotContains]: () =>\n    I18n.t('workflow_condition_obj_not_contain'),\n};\n\nexport const emptyValue = {\n  [ConditionType.Null]: () => I18n.t('workflow_detail_condition_select_empty'),\n};\nexport const notEmptyValue = {\n  [ConditionType.NotNull]: () =>\n    I18n.t('workflow_detail_condition_select_not_empty'),\n};\nexport const biggerValue = {\n  [ConditionType.Gt]: () => I18n.t('workflow_detail_condition_select_greater'),\n};\nexport const biggerEqualValue = {\n  [ConditionType.GtEqual]: () =>\n    I18n.t('workflow_detail_condition_select_greater_equal'),\n};\nexport const smallerValue = {\n  [ConditionType.Lt]: () => I18n.t('workflow_detail_condition_select_less'),\n};\nexport const smallerEqualValue = {\n  [ConditionType.LtEqual]: () =>\n    I18n.t('workflow_detail_condition_select_less_equal'),\n};\nexport const trueValue = {\n  [ConditionType.True]: () => I18n.t('workflow_detail_condition_select_true'),\n};\nexport const falseValue = {\n  [ConditionType.False]: () => I18n.t('workflow_detail_condition_select_false'),\n};\n\n// equal to, not equal to, length greater than, length greater than or equal to, length less than, length less than or equal to, contain, do not contain, empty, not empty\nexport const stringConditionValueMap = merge(\n  {},\n  equalValue,\n  notEqualValue,\n  lengthBiggerValue,\n  lengthBiggerEqualValue,\n  lengthSmallerValue,\n  lengthSmallerEqualValue,\n  includeValue,\n  excludeValue,\n  emptyValue,\n  notEmptyValue,\n);\n\nexport const timeConditionValueMap = merge(\n  {},\n  equalValue,\n  notEqualValue,\n  emptyValue,\n  notEmptyValue,\n  biggerValue,\n  biggerEqualValue,\n  smallerValue,\n  smallerEqualValue,\n);\n\n// equal to, not equal to, greater than, greater than or equal to, less than, less than or equal to, empty, not empty\nexport const intConditionValueMap = merge(\n  {},\n  equalValue,\n  notEqualValue,\n  emptyValue,\n  notEmptyValue,\n  biggerValue,\n  biggerEqualValue,\n  smallerValue,\n  smallerEqualValue,\n);\n\n// Equal to, not equal to, True, False, Null, Not Null\nexport const booleanConditionValueMap = merge(\n  {},\n  equalValue,\n  notEqualValue,\n  emptyValue,\n  notEmptyValue,\n  trueValue,\n  falseValue,\n);\n\n// equal to, not equal to, greater than or equal to, less than or equal to, greater than, less than, empty, not empty\nexport const numberConditionValueMap = merge(\n  {},\n  equalValue,\n  notEqualValue,\n  biggerValue,\n  biggerEqualValue,\n  smallerValue,\n  smallerEqualValue,\n  emptyValue,\n  notEmptyValue,\n);\n\n// Include, do not contain, empty, not empty\nexport const objectConditionValueMap = merge(\n  {},\n  includeKeyValue,\n  excludeKeyValue,\n  emptyValue,\n  notEmptyValue,\n);\n\n// Length greater than, length greater than or equal to, length less than, length less than or equal to, contain, do not contain, empty, not empty\nexport const arrayConditionValueMap = merge(\n  {},\n  lengthBiggerValue,\n  lengthBiggerEqualValue,\n  lengthSmallerValue,\n  lengthSmallerEqualValue,\n  includeValue,\n  excludeValue,\n  emptyValue,\n  notEmptyValue,\n);\n\n// The set of all values\nexport const totalConditionValueMap = merge(\n  {},\n  equalValue,\n  notEqualValue,\n  lengthBiggerValue,\n  lengthBiggerEqualValue,\n  lengthSmallerValue,\n  lengthSmallerEqualValue,\n  includeValue,\n  excludeValue,\n  emptyValue,\n  notEmptyValue,\n  biggerValue,\n  biggerEqualValue,\n  smallerValue,\n  smallerEqualValue,\n  trueValue,\n  falseValue,\n);\n\nexport const fileConditionValueMap = merge({}, notEmptyValue, emptyValue);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isFunction } from 'lodash-es';\n\n/**\n * Convert a structure of the form {value: label} into the options Array < {label, value} > required by Select\n *   computedValue: Convert the value value once as the value of options\n *   passItem: Determine whether the current value needs to skip the traversal\n */\nexport default function convertMap2options<Value extends number = number>(\n  map: Record<string, unknown>,\n  convertOptions: {\n    computedValue?: (val: unknown) => Value;\n    passItem?: (val: unknown) => boolean;\n    /**\n     * Due to the implementation of i18n, the copy written as a constant needs to be loaded lazily\n     * Therefore, the {value: label} structure involving i18n needs to be written as {value : () => label}\n     * When this property is enabled, an additional lazy load is performed\n     * @default false\n     * @link\n     */\n    i18n?: boolean;\n  } = {},\n) {\n  const res: Array<{ label: string; value: Value }> = [];\n\n  for (const [value, label] of Object.entries(map)) {\n    const pass = convertOptions.passItem\n      ? convertOptions.passItem(value)\n      : false;\n    if (pass) {\n      continue;\n    }\n    const computedValue = convertOptions.computedValue\n      ? convertOptions.computedValue(value)\n      : (value as unknown as Value);\n\n    const finalLabel: string = convertOptions.i18n\n      ? isFunction(label)\n        ? label()\n        : label\n      : label;\n    res.push({ label: finalLabel, value: computedValue });\n  }\n  return res;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { IconCozMinus } from '@coze-arch/coze-design/icons';\nimport { IconButton } from '@coze-arch/coze-design';\n\ninterface DeleteProps {\n  hidden?: boolean;\n  remove?: () => void;\n  testId: string;\n}\n\nexport default function Delete({ hidden, remove, testId }: DeleteProps) {\n  return (\n    <div>\n      {hidden ? null : (\n        <IconButton\n          data-testid={testId}\n          color=\"secondary\"\n          size=\"small\"\n          icon={<IconCozMinus className=\"text-sm\" />}\n          onClick={remove}\n        />\n      )}\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\nimport React, { useMemo } from 'react';\n\nimport classNames from 'classnames';\nimport { useService } from '@flowgram-adapter/free-layout-editor';\nimport { useCurrentEntity } from '@flowgram-adapter/free-layout-editor';\nimport { useVariableTypeChange } from '@coze-workflow/variable';\nimport {\n  WorkflowVariableService,\n  type RefExpression,\n  type ValueExpression,\n  ValueExpressionType,\n} from '@coze-workflow/variable';\nimport { useNodeTestId } from '@coze-workflow/base';\n\nimport { type ValueExpressionInputProps } from '@/form-extensions/components/value-expression-input';\n\nimport { withValidationField } from '../validate/ValidationField';\nimport { type ConditionValidateResult } from '../validate/validate';\nimport { type ConditionItem, type ElementOfRecord } from '../types';\nimport { useConditionContext } from '../context';\nimport { VariableSelector } from '../../../../components/tree-variable-selector';\nimport { ValueExpressionWithState } from './value-expression-with-state';\nimport {\n  calcComparisonDisabled,\n  processConditionData,\n  processLeftSourceTypeChange,\n  processRightDefaultValue,\n  getRightValueInputType,\n} from './utils';\nimport Operator from './operator';\nimport Delete from './delete';\nconst VariableSelectorField =\n  withValidationField<typeof VariableSelector>(VariableSelector);\nconst OperatorField = withValidationField<typeof Operator>(Operator);\nconst ValueExpressionInputField = withValidationField<\n  typeof ValueExpressionWithState\n>(ValueExpressionWithState);\n\nexport interface ConditionParamsItemProps {\n  branchIndex: number;\n  /**\n   * Current condition data index\n   */\n  index: number;\n  /**\n   * Current condition data\n   */\n  data: ConditionItem;\n  /**\n   * read only\n   */\n  readonly?: boolean;\n  /**\n   * Callback after the current condition data has changed\n   */\n  onDataChange: (value: ConditionItem) => void;\n  /**\n   * Remove callback on current condition\n   */\n  onDelete?: () => void;\n  /**\n   * verification result\n   */\n  conditionValidateResult?: ConditionValidateResult;\n  className?: string;\n  style?: React.CSSProperties;\n  deletable?: boolean;\n}\n\n// TODO conversion is received uniformly in one place.\nconst valueToRefExpression = (value: string[]): RefExpression => ({\n  type: ValueExpressionType.REF,\n  content: {\n    keyPath: value,\n  },\n});\n\nexport default function ConditionParamsItem({\n  index,\n  branchIndex,\n  data,\n  onDataChange,\n  onDelete,\n  className,\n  conditionValidateResult,\n  style,\n  readonly,\n  deletable,\n}: ConditionParamsItemProps) {\n  const { concatTestId } = useNodeTestId();\n  const { setterPath } = useConditionContext();\n  const workflowVariableService = useService<WorkflowVariableService>(\n    WorkflowVariableService,\n  );\n\n  const node = useCurrentEntity();\n\n  const sourceType = workflowVariableService.getWorkflowVariableByKeyPath(\n    data.left?.content?.keyPath,\n    { node },\n  )?.viewType;\n\n  const handleConditionChange =\n    <T extends ElementOfRecord<ConditionItem>>(\n      key: 'left' | 'operator' | 'right',\n    ) =>\n    (value: T): void => {\n      let newData = { ...data, [key]: value };\n\n      newData = processLeftSourceTypeChange(\n        data,\n        newData,\n        workflowVariableService,\n        node,\n      );\n\n      newData = processRightDefaultValue(sourceType, newData);\n\n      newData = processConditionData(\n        data,\n        newData,\n        workflowVariableService,\n        node,\n      );\n\n      onDataChange?.(newData);\n    };\n\n  // Monitor changes in linkage variables to re-trigger the effect\n  useVariableTypeChange({\n    keyPath: data.left?.content?.keyPath,\n    onTypeChange: ({ variableMeta }) => {\n      if (!variableMeta) {\n        // Variables have been deleted\n        onDataChange?.({});\n        return;\n      }\n\n      onDataChange?.({\n        left: data.left,\n      });\n    },\n  });\n  const rightInputTypes = getRightValueInputType({\n    sourceType,\n    operator: data.operator,\n    rightValue: data.right,\n    useCompatibleType: true,\n  });\n  const rightInputTypeProps = useMemo<\n    Pick<ValueExpressionInputProps, 'inputType' | 'inputTypes'>\n  >(() => ({ inputTypes: rightInputTypes }), [rightInputTypes]);\n\n  return (\n    <div\n      className={classNames('flex items-center gap-1 mb-2', className)}\n      style={style}\n    >\n      <div\n        className=\"overflow-hidden\"\n        style={{\n          flex: '0 0 44px',\n        }}\n      >\n        <OperatorField\n          sourceType={sourceType}\n          value={data.operator}\n          onChange={handleConditionChange<ConditionItem['operator']>(\n            'operator',\n          )}\n          validateResult={conditionValidateResult?.operator}\n          testId={concatTestId(\n            setterPath,\n            `${branchIndex}`,\n            `${index}`,\n            'operator',\n          )}\n        />\n      </div>\n      <div className=\"flex-1\">\n        <VariableSelectorField\n          style={{ width: '100%', marginBottom: 4 }}\n          readonly={readonly}\n          value={data.left?.content?.keyPath}\n          onChange={(value: string[]) =>\n            handleConditionChange<RefExpression>('left')(\n              valueToRefExpression(value),\n            )\n          }\n          validateResult={conditionValidateResult?.left}\n          testId={concatTestId(\n            setterPath,\n            `${branchIndex}`,\n            `${index}`,\n            'left',\n          )}\n        />\n        <ValueExpressionInputField\n          readonly={readonly}\n          {...rightInputTypeProps}\n          disabled={calcComparisonDisabled(data.operator)}\n          value={JSON.parse(JSON.stringify(data))?.right}\n          onChange={handleConditionChange<ValueExpression>('right')}\n          validateResult={conditionValidateResult?.right}\n          operator={data.operator}\n          testId={concatTestId(\n            setterPath,\n            `${branchIndex}`,\n            `${index}`,\n            'right',\n          )}\n        />\n      </div>\n      {readonly ? (\n        <></>\n      ) : (\n        <div\n          style={{\n            flex: '0 0 24px',\n          }}\n        >\n          <Delete\n            testId={concatTestId(\n              setterPath,\n              `${branchIndex}`,\n              `${index}`,\n              'item',\n              'remove',\n            )}\n            remove={onDelete}\n            hidden={!deletable}\n          />\n        </div>\n      )}\n    </div>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useMemo } from 'react';\n\nimport { ViewVariableType } from '@coze-workflow/base/types';\nimport { type ConditionType } from '@coze-workflow/base/api';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { Tooltip, Select } from '@coze-arch/coze-design';\nimport { type SelectProps } from '@coze-arch/bot-semi/Select';\n\nimport {\n  arrayConditionValueMap,\n  booleanConditionValueMap,\n  numberConditionValueMap,\n  intConditionValueMap,\n  objectConditionValueMap,\n  stringConditionValueMap,\n  fileConditionValueMap,\n  timeConditionValueMap,\n} from '../constants';\nimport { operatorMap } from '../../constants';\nimport convertMap2options from './convert-map2options';\n\nimport styles from './index.module.less';\n\ninterface OperatorProps {\n  value?: ConditionType;\n  onChange: (v: ConditionType) => void;\n  sourceType?: ViewVariableType;\n  onBlur?: () => void;\n  validateStatus?: SelectProps['validateStatus'];\n  testId: string;\n}\n\nexport default function Operator(props: OperatorProps) {\n  const { value, onChange, sourceType, onBlur, validateStatus, testId } = props;\n  const { concatTestId } = useNodeTestId();\n\n  // Change the corresponding options according to the reference variable\n  const options = useMemo(() => {\n    if (sourceType && ViewVariableType.isFileType(sourceType)) {\n      return convertMap2options(fileConditionValueMap, {\n        computedValue: val => Number(val),\n        i18n: true,\n      });\n    }\n\n    switch (sourceType) {\n      case ViewVariableType.ArrayBoolean:\n      case ViewVariableType.ArrayInteger:\n      case ViewVariableType.ArrayNumber:\n      case ViewVariableType.ArrayObject:\n      case ViewVariableType.ArrayString:\n      case ViewVariableType.ArrayTime: {\n        return convertMap2options(arrayConditionValueMap, {\n          computedValue: val => Number(val),\n          i18n: true,\n        });\n      }\n      case ViewVariableType.Object: {\n        return convertMap2options(objectConditionValueMap, {\n          computedValue: val => Number(val),\n          i18n: true,\n        });\n      }\n      case ViewVariableType.Boolean: {\n        return convertMap2options(booleanConditionValueMap, {\n          computedValue: val => Number(val),\n          i18n: true,\n        });\n      }\n      case ViewVariableType.Integer: {\n        return convertMap2options(intConditionValueMap, {\n          computedValue: val => Number(val),\n          i18n: true,\n        });\n      }\n      case ViewVariableType.String: {\n        return convertMap2options(stringConditionValueMap, {\n          computedValue: val => Number(val),\n          i18n: true,\n        });\n      }\n      case ViewVariableType.Number: {\n        return convertMap2options(numberConditionValueMap, {\n          computedValue: val => Number(val),\n          i18n: true,\n        });\n      }\n      case ViewVariableType.Time: {\n        return convertMap2options(timeConditionValueMap, {\n          computedValue: val => Number(val),\n          i18n: true,\n        });\n      }\n      default:\n        return [];\n    }\n  }, [sourceType]);\n\n  const renderSelectedItem = option => (\n    <Tooltip content={option.label}>{operatorMap[option.value]}</Tooltip>\n  );\n\n  return (\n    <Select\n      data-testid={testId}\n      size=\"small\"\n      value={value}\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      onChange={onChange as any}\n      onBlur={onBlur}\n      validateStatus={validateStatus}\n      // optionList={options}\n      // showClear\n      placeholder={I18n.t('workflow_detail_condition_pleaseselect')}\n      emptyContent={I18n.t('workflow_detail_node_nodata')}\n      className={styles.container}\n      renderSelectedItem={renderSelectedItem}\n    >\n      {options.map(option => (\n        <Select.Option\n          {...option}\n          data-testid={concatTestId(testId, `${option.value}`)}\n        />\n      ))}\n    </Select>\n  );\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @coze-arch/no-deep-relative-import */\n/**\n * Interactively, when the operator is selected, when the rvalue is switched between disabled and disabled, it needs to keep the type the same as last time, so here is a state store\n */\nimport React, { type FC, useEffect, useState } from 'react';\n\nimport { ConditionType } from '@coze-arch/idl/workflow_api';\nimport { Input } from '@coze-arch/coze-design';\n\nimport {\n  ValueExpressionInput,\n  type ValueExpressionInputProps,\n} from '../../../../../components/value-expression-input';\n\nexport const ValueExpressionWithState: FC<\n  ValueExpressionInputProps & {\n    operator?: ConditionType;\n  }\n> = props => {\n  const { value, operator } = props;\n\n  const [valueType, setValueType] = useState(value?.type);\n\n  useEffect(() => {\n    if (value?.type) {\n      setValueType(value?.type);\n    }\n  }, [value?.type]);\n\n  if (\n    operator &&\n    [ConditionType.Null, ConditionType.NotNull].includes(operator)\n  ) {\n    return <Input disabled value=\"empty\" size=\"small\" />;\n  }\n  if (\n    operator &&\n    [ConditionType.True, ConditionType.False].includes(operator)\n  ) {\n    if (operator === ConditionType.True) {\n      return <Input disabled value=\"true\" size=\"small\" />;\n    } else {\n      return <Input disabled value=\"false\" size=\"small\" />;\n    }\n  }\n\n  return (\n    <ValueExpressionInput\n      {...props}\n      value={value ?? (valueType ? { type: valueType } : undefined)}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Select } from '@coze-arch/coze-design';\n\nimport { Logic, logicTextMap } from './constants';\n\nimport styles from './condition-item-logic.module.less';\n\nexport interface ConditionItemLogicProps {\n  /**\n   * And Logic Or\n   */\n  logic: Logic;\n  /**\n   * And Or change the logic\n   */\n  onChange: (logic: Logic) => void;\n  showStroke?: boolean;\n}\n\nexport const ConditionItemLogic: FC<ConditionItemLogicProps> = props => {\n  const { logic, onChange, showStroke = false } = props;\n\n  return (\n    <div className=\"flex flex-col h-full\">\n      <div className=\"flex-1 relative\">\n        {showStroke ? (\n          <div className=\"absolute left-1/2 right-0 top-2.5 bottom-0 rounded-tl-lg border-solid border-0 border-t border-l coz-stroke-plus\" />\n        ) : null}\n      </div>\n      <Select\n        className={styles['condition-logic-select']}\n        placeholder={I18n.t('workflow_detail_condition_pleaseselect')}\n        style={{ marginRight: 4 }}\n        value={logic}\n        size=\"small\"\n        optionList={[\n          {\n            label: logicTextMap.get(Logic.AND),\n            value: Logic.AND,\n          },\n          {\n            label: logicTextMap.get(Logic.OR),\n            value: Logic.OR,\n          },\n        ]}\n        onChange={val => onChange(val as Logic)}\n      />\n      <div className=\"flex-1 relative\">\n        {showStroke ? (\n          <div className=\"absolute left-1/2 right-0 top-0 bottom-2.5 rounded-bl-lg border-solid border-0 border-b border-l coz-stroke-plus\" />\n        ) : null}\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { type ReactNode } from 'react';\n\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozMinus, IconCozPlus } from '@coze-arch/coze-design/icons';\nimport { IconButton, Tag } from '@coze-arch/coze-design';\n\nimport { FormCard } from '../../../components/form-card';\nimport { type ConditionValidateResult } from './validate/validate';\nimport { Logic, type ConditionBranchValueWithUid } from './types';\nimport { useConditionContext } from './context';\nimport ConditionParamsItem, {\n  type ConditionParamsItemProps,\n} from './condition-params-item';\nimport {\n  ConditionItemLogic,\n  type ConditionItemLogicProps,\n} from './condition-item-logic';\n\nimport styles from './condition-branch.module.less';\n\nfunction getDefaultConditionItems() {\n  return {\n    left: undefined,\n    operator: undefined,\n    right: undefined,\n  };\n}\n\nexport interface ConditionBranchProps {\n  index: number;\n  prefixName: string;\n  portId?: string;\n  titleIcon?: ReactNode;\n  branch: ConditionBranchValueWithUid;\n  onChange?: (branch: ConditionBranchValueWithUid) => void;\n  onDelete?: () => void;\n  deletable?: boolean;\n  priority?: number;\n  isFirstBranch?: boolean;\n  branchValidateResult?: ConditionValidateResult[];\n}\n\nexport const ConditionBranch = (props: ConditionBranchProps) => {\n  const { readonly, expanded } = useConditionContext();\n  const { concatTestId } = useNodeTestId();\n  const { setterPath } = useConditionContext();\n\n  const {\n    index: branchIndex,\n    branch,\n    onChange,\n    onDelete,\n    deletable = true,\n    prefixName,\n    priority,\n    branchValidateResult,\n    titleIcon,\n    isFirstBranch,\n  } = props;\n\n  const { condition } = branch;\n\n  const handleAdd = () => {\n    onChange?.({\n      ...branch,\n      condition: {\n        ...condition,\n        logic: condition.logic ?? Logic.AND,\n        conditions: (condition.conditions ?? []).concat([\n          getDefaultConditionItems(),\n        ]),\n      },\n    });\n  };\n\n  const handleLogicChange: ConditionItemLogicProps['onChange'] = logic => {\n    onChange?.({\n      ...branch,\n      condition: {\n        ...condition,\n        logic,\n      },\n    });\n  };\n\n  const handleConditionItemChange: (\n    index: number,\n  ) => ConditionParamsItemProps['onDataChange'] = index => conditionItem => {\n    const newConditions = condition.conditions.map((item, subIndex) => {\n      if (subIndex === index) {\n        return {\n          ...conditionItem,\n        };\n      } else {\n        return item;\n      }\n    });\n    onChange?.({\n      ...branch,\n      condition: {\n        ...condition,\n        conditions: newConditions,\n      },\n    });\n  };\n\n  const handleDeleteBranch = () => {\n    // Move the port to be deleted to the end so that the deletion does not affect other connection sequences\n    onDelete?.();\n  };\n\n  const handleDeleteConditionItem: (\n    deleteIndex: number,\n  ) => ConditionParamsItemProps['onDelete'] = deleteIndex => () => {\n    // removeValidateResult(index);\n    const newConditions = condition.conditions.filter(\n      (item, subIndex) => subIndex !== deleteIndex,\n    );\n    if (newConditions.length) {\n      onChange?.({\n        ...branch,\n        condition: {\n          ...condition,\n          conditions: newConditions,\n        },\n      });\n    } else {\n      handleDeleteBranch();\n    }\n  };\n\n  return (\n    <FormCard\n      expand={expanded}\n      motion={false}\n      className=\"coz-bg-max coz-stroke-plus border border-solid rounded-lg mb-2 !px-2 pb-2\"\n      header={\n        <div className=\"flex items-center\">\n          {titleIcon}\n          {prefixName}\n          {priority ? (\n            <Tag className=\"ml-2\" color=\"primary\">\n              {I18n.t('worklfow_condition_priority', {}, 'Priority')} {priority}\n            </Tag>\n          ) : null}\n        </div>\n      }\n      collapsible={false}\n      actionButton={\n        readonly ? (\n          <></>\n        ) : (\n          <>\n            <IconButton\n              data-testid={concatTestId(\n                setterPath,\n                `${branchIndex}`,\n                'branch',\n                'delete',\n              )}\n              color=\"secondary\"\n              size=\"small\"\n              icon={<IconCozMinus className=\"text-sm\" />}\n              disabled={!deletable}\n              onClick={handleDeleteBranch}\n            />\n          </>\n        )\n      }\n      portInfo={undefined}\n    >\n      <div>\n        <div\n          style={\n            readonly\n              ? {\n                  pointerEvents: 'none',\n                }\n              : {}\n          }\n        >\n          <div className=\"flex\">\n            {condition.conditions.length > 1 && (\n              <div className=\"flex-none w-[50px] mt-4 mb-12\">\n                <ConditionItemLogic\n                  logic={condition.logic}\n                  onChange={handleLogicChange}\n                  showStroke={condition?.conditions?.length > 1}\n                />\n              </div>\n            )}\n            <div className=\"flex-1\">\n              {condition.conditions.map((item, index) => (\n                <ConditionParamsItem\n                  key={index}\n                  branchIndex={branchIndex}\n                  index={index}\n                  readonly={readonly}\n                  deletable={!isFirstBranch || index > 0}\n                  data={item}\n                  onDataChange={handleConditionItemChange(index)}\n                  onDelete={handleDeleteConditionItem(index)}\n                  className={styles.item}\n                  conditionValidateResult={branchValidateResult?.[index]}\n                />\n              ))}\n              <IconButton\n                wrapperClass=\"ml-[48px]\"\n                size=\"small\"\n                color=\"highlight\"\n                onClick={handleAdd}\n                icon={<IconCozPlus />}\n                data-testid={concatTestId(\n                  setterPath,\n                  `${branchIndex}`,\n                  'item',\n                  'add',\n                )}\n              >\n                {I18n.t(\n                  'worklfow_condition_add_condition',\n                  {},\n                  'Add condition',\n                )}\n              </IconButton>\n            </div>\n          </div>\n        </div>\n      </div>\n    </FormCard>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozPlus } from '@coze-arch/coze-design/icons';\nimport { IconButton } from '@coze-arch/coze-design';\n\nimport { useConditionContext } from './context';\n\ninterface ConditionHeaderProps {\n  onAdd: () => void;\n}\n\nexport const ConditionHeader: FC<ConditionHeaderProps> = props => {\n  const { readonly, setterPath } = useConditionContext();\n  const { concatTestId } = useNodeTestId();\n\n  const { onAdd } = props;\n  return (\n    <div className=\"flex justify-between items-center mb-2 cursor-pointer\">\n      <div className=\"font-semibold\">\n        {I18n.t('worklfow_condition_condition_branch', {}, 'Condition branch')}\n      </div>\n      <IconButton\n        size=\"small\"\n        disabled={readonly}\n        onClick={readonly ? () => null : onAdd}\n        color=\"highlight\"\n        icon={<IconCozPlus className=\"text-sm\" />}\n        data-testid={concatTestId(setterPath, 'branch', 'add')}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isNil } from 'lodash-es';\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport {\n  type WorkflowVariableService,\n  ValueExpressionType,\n  ViewVariableType,\n  variableUtils,\n} from '@coze-workflow/variable';\nimport { ConditionType } from '@coze-workflow/base/api';\nimport { ValueExpression } from '@coze-workflow/base';\n\nimport { type InputType } from '@/form-extensions/components/value-expression-input/InputField';\n\nimport { type ConditionItem } from '../types';\n\nexport const DISABLED_CONDITION_TYPES = [\n  ConditionType.Null,\n  ConditionType.NotNull,\n  ConditionType.True,\n  ConditionType.False,\n];\n\nexport const COMPARE_LENGTH_CONDITION_TYPES = [\n  ConditionType.LengthGt,\n  ConditionType.LengthGtEqual,\n  ConditionType.LengthLt,\n  ConditionType.LengthLtEqual,\n];\n\nexport const calcComparisonDisabled = (operator: ConditionType | undefined) => {\n  if (!operator) {\n    return false;\n  }\n\n  return DISABLED_CONDITION_TYPES.includes(operator);\n};\n\n// If the lvalue type has changed, empty the rvalue; if the lvalue type has not changed, keep the rvalue\nexport const processLeftSourceTypeChange = (\n  oldData: ConditionItem,\n  newData: ConditionItem,\n  workflowVariableService: WorkflowVariableService,\n  node: FlowNodeEntity,\n  // eslint-disable-next-line max-params\n) => {\n  const oldSourceType = workflowVariableService.getWorkflowVariableByKeyPath(\n    oldData.left?.content?.keyPath,\n    { node },\n  )?.viewType;\n\n  const newSourceType = workflowVariableService.getWorkflowVariableByKeyPath(\n    newData.left?.content?.keyPath,\n    { node },\n  )?.viewType;\n\n  const { right, operator, ...others } = newData;\n\n  // If there is no variable selected on the left side, select the variable under the new operation, and clear the value of operator and right\n  if (!oldSourceType && newSourceType) {\n    return others;\n  }\n\n  // When a primitive type exists, it is not empty\n  if (oldSourceType && oldSourceType !== newSourceType) {\n    return others;\n  } else {\n    return { ...newData };\n  }\n};\n\n// If the operator does not require an rvalue (isTrue, isEmpty), then empty the rvalue\n// If the rvalue type does not match after the operator switch, clear the rvalue\nexport const processConditionData = (\n  oldData: ConditionItem,\n  newData: ConditionItem,\n  workflowVariableService: WorkflowVariableService,\n  node: FlowNodeEntity,\n  // eslint-disable-next-line max-params\n) => {\n  if (!newData.operator) {\n    return { ...newData };\n  }\n\n  const { right, ...others } = newData;\n\n  if (right && newData.operator !== oldData.operator) {\n    const newSourceType = workflowVariableService.getWorkflowVariableByKeyPath(\n      newData.left?.content?.keyPath,\n      { node },\n    )?.viewType;\n    const requiredRightInputType = getRightValueInputType({\n      rightValue: right,\n      sourceType: newSourceType,\n      operator: newData.operator,\n      useCompatibleType: false,\n    });\n    const rightInputType = variableUtils.getValueExpressionViewType(\n      right,\n      workflowVariableService,\n      { node },\n    );\n    if (rightInputType && !requiredRightInputType?.includes(rightInputType)) {\n      return others;\n    }\n  }\n  if (DISABLED_CONDITION_TYPES.includes(newData.operator)) {\n    return others;\n  } else {\n    return { ...newData };\n  }\n};\n\n// If the lvalue is boolean, add a default value of false when the rvalue selection type is literal\nexport const processRightDefaultValue = (\n  sourceType: ViewVariableType | undefined,\n  data: ConditionItem,\n) => {\n  const { right, ...others } = data;\n  if (\n    sourceType === ViewVariableType.Boolean ||\n    sourceType === ViewVariableType.ArrayBoolean\n  ) {\n    if (right?.type === ValueExpressionType.LITERAL && isNil(right.content)) {\n      const newRight: ValueExpression = {\n        ...right,\n        content: false,\n      };\n\n      right.rawMeta = { type: ViewVariableType.Boolean };\n      return {\n        ...others,\n        right: newRight,\n      };\n    } else {\n      return {\n        ...data,\n      };\n    }\n  } else {\n    return {\n      ...data,\n    };\n  }\n};\n\nconst getInputTypeFromArrayLikeSourceTypeAndOperation = (\n  operation: ConditionType | undefined,\n) => {\n  const restrictOperationInputTypeMap = new Map<\n    ConditionType | undefined,\n    InputType\n  >([\n    [ConditionType.LengthGt, ViewVariableType.Number],\n    [ConditionType.LengthGtEqual, ViewVariableType.Number],\n    [ConditionType.LengthLt, ViewVariableType.Number],\n    [ConditionType.LengthLtEqual, ViewVariableType.Number],\n  ]);\n  return restrictOperationInputTypeMap.get(operation);\n};\n\nexport const getRightValueInputType = ({\n  rightValue,\n  sourceType,\n  operator,\n  useCompatibleType,\n}: {\n  rightValue?: ValueExpression;\n  sourceType?: ViewVariableType;\n  operator?: ConditionType;\n  /**\n   * Whether to use a type compatible with old data, called when operator switches, set to false\n   */\n  useCompatibleType?: boolean;\n}): ViewVariableType[] => {\n  const compareLength =\n    operator && COMPARE_LENGTH_CONDITION_TYPES.includes(operator);\n\n  /**\n   * Array addition\n   * \"Length greater than, length greater than or equal to, length less than, length less than or equal to\", rvalue only supports int type.\n   * \"Included, not included\", rvalues follow based on the type of lvalues.\n   */\n  if (sourceType && ViewVariableType.isArrayType(sourceType)) {\n    if (compareLength) {\n      return [ViewVariableType.Integer];\n    }\n    if (\n      operator &&\n      [ConditionType.Contains, ConditionType.NotContains].includes(operator)\n    ) {\n      return [ViewVariableType.getArraySubType(sourceType), sourceType];\n    }\n  }\n\n  /**\n   * String: \"Length greater than, length greater than or equal to, length less than, length less than or equal to\" (rvalue only supports int, string)\n   * Historical data, the Str type is displayed by default.\n   * New data, default to int type.\n   */\n  if (sourceType === ViewVariableType.String) {\n    if (compareLength) {\n      // Compatible conditions are: str > rightValue scenarios, the rvalue of the stock data is string type, and the rvalue is displayed as string type by default\n      if (rightValue && useCompatibleType) {\n        const rawMetaType = rightValue.rawMeta?.type as\n          | ViewVariableType\n          | undefined;\n\n        // There is a raw meta type, the raw meta type is preferred\n        if (rawMetaType) {\n          return [\n            rawMetaType !== ViewVariableType.Integer\n              ? ViewVariableType.String\n              : ViewVariableType.Integer,\n          ];\n        }\n        // If it is a literal, it is determined according to the literal content type\n        if (\n          !ValueExpression.isEmpty(rightValue) &&\n          ValueExpression.isLiteral(rightValue)\n        ) {\n          return typeof rightValue.content === 'string'\n            ? [ViewVariableType.String]\n            : [ViewVariableType.Integer];\n        }\n      }\n      return [ViewVariableType.Integer];\n    }\n    return [ViewVariableType.String];\n  }\n\n  const sourceTypeInputTypeMap = new Map<\n    ViewVariableType | undefined,\n    ViewVariableType[]\n  >([\n    [ViewVariableType.String, [ViewVariableType.String]],\n    [\n      ViewVariableType.Integer,\n      [ViewVariableType.Integer, ViewVariableType.Number],\n    ],\n    [\n      ViewVariableType.Number,\n      [ViewVariableType.Number, ViewVariableType.Integer],\n    ],\n    [ViewVariableType.Boolean, [ViewVariableType.Boolean]],\n    [ViewVariableType.Object, [ViewVariableType.String]],\n  ]);\n  return sourceTypeInputTypeMap.get(sourceType) || [ViewVariableType.String];\n};\n\nexport const getInputTypeFromSourceTypeAndOperation = (\n  sourceType: ViewVariableType | undefined,\n  operation: ConditionType | undefined,\n): InputType => {\n  if (sourceType && ViewVariableType.isArrayType(sourceType)) {\n    const arrayLikeStrictInputType =\n      getInputTypeFromArrayLikeSourceTypeAndOperation(operation);\n    if (arrayLikeStrictInputType) {\n      return arrayLikeStrictInputType;\n    }\n  }\n\n  const sourceTypeInputTypeMap = new Map<\n    ViewVariableType | undefined,\n    InputType\n  >([\n    [ViewVariableType.String, ViewVariableType.String],\n    [ViewVariableType.Integer, ViewVariableType.Number],\n    [ViewVariableType.Number, ViewVariableType.Number],\n    [ViewVariableType.Boolean, ViewVariableType.Boolean],\n    [ViewVariableType.Object, ViewVariableType.String],\n    [ViewVariableType.ArrayBoolean, ViewVariableType.Boolean],\n    [ViewVariableType.ArrayInteger, ViewVariableType.Number],\n    [ViewVariableType.ArrayNumber, ViewVariableType.Number],\n    [ViewVariableType.ArrayObject, ViewVariableType.String],\n    [ViewVariableType.ArrayString, ViewVariableType.String],\n  ]);\n\n  return sourceTypeInputTypeMap.get(sourceType) || ViewVariableType.String;\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ConditionType } from '@coze-arch/idl/workflow_api';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozEqual,\n  IconCozEqualSlash,\n  IconCozGreater,\n  IconCozGreaterEqual,\n  IconCozLess,\n  IconCozLessEqual,\n  IconCozProperSuperset,\n  IconCozProperSupersetSlash,\n} from '@coze-arch/coze-design/icons';\n\nexport enum Logic {\n  OR = 1,\n  AND = 2,\n}\n\nexport const logicTextMap = new Map<number, string>([\n  [Logic.OR, I18n.t('workflow_detail_condition_or')],\n  [Logic.AND, I18n.t('workflow_detail_condition_and')],\n]);\n\nexport const operatorMap = {\n  [ConditionType.Equal]: <IconCozEqual />,\n  [ConditionType.NotEqual]: <IconCozEqualSlash />,\n  [ConditionType.LengthGt]: <IconCozGreater />,\n  [ConditionType.LengthGtEqual]: <IconCozGreaterEqual />,\n  [ConditionType.LengthLt]: <IconCozLess />,\n  [ConditionType.LengthLtEqual]: <IconCozLessEqual />,\n  // contain\n  [ConditionType.Contains]: <IconCozProperSuperset />,\n  // Do not include\n  [ConditionType.NotContains]: <IconCozProperSupersetSlash />,\n  // isEmpty\n  [ConditionType.Null]: <IconCozEqual />,\n  // isNotEmpty\n  [ConditionType.NotNull]: <IconCozEqualSlash />,\n  // isTrue\n  [ConditionType.True]: <IconCozEqual />,\n  // isFalse\n  [ConditionType.False]: <IconCozEqual />,\n  [ConditionType.Gt]: <IconCozGreater />,\n  [ConditionType.GtEqual]: <IconCozGreaterEqual />,\n  [ConditionType.Lt]: <IconCozLess />,\n  [ConditionType.LtEqual]: <IconCozLessEqual />,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createContext, useContext } from 'react';\n\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\n\ninterface ConditionContext {\n  flowNodeEntity: FlowNodeEntity | null;\n  readonly: boolean;\n  expanded?: boolean;\n  setterPath: string;\n}\n// eslint-disable-next-line @typescript-eslint/naming-convention -- react context\nconst ConditionContext = createContext<ConditionContext>({\n  flowNodeEntity: null,\n  readonly: false,\n  setterPath: '',\n});\nexport const useConditionContext = () => useContext(ConditionContext);\n\n// eslint-disable-next-line @typescript-eslint/naming-convention -- react context\nexport const ConditionContextProvider = ConditionContext.Provider;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport { IconHandle } from '@douyinfe/semi-icons';\n\nimport {\n  type ConditionBranchProps,\n  ConditionBranch,\n} from '../condition-branch';\n\ntype DraggableConditionBranchPreviewProps = Pick<\n  ConditionBranchProps,\n  'priority' | 'prefixName' | 'portId' | 'branch'\n> & {\n  index: number;\n};\n\nexport const DraggableConditionBranchPreview: FC<\n  DraggableConditionBranchPreviewProps\n> = props => (\n  <div className=\"opacity-100 z-50\">\n    <ConditionBranch\n      {...props}\n      titleIcon={\n        <IconHandle className=\"cursor-move pr-1\" style={{ color: '#aaa' }} />\n      }\n    />\n  </div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getEmptyImage } from 'react-dnd-html5-backend';\nimport { useDrop, useDrag } from 'react-dnd';\nimport { type FC, useRef, useEffect } from 'react';\n\nimport type { Identifier } from 'dnd-core';\nimport classNames from 'classnames';\nimport { IconHandle } from '@douyinfe/semi-icons';\n\nimport {\n  ConditionBranch,\n  type ConditionBranchProps,\n} from '../condition-branch';\nimport { ConditionBranchBlock } from './types';\n\ninterface DraggableConditionBranchProps extends ConditionBranchProps {\n  index: number;\n  showDraggable?: boolean;\n  onDragStart: (uid: number) => void;\n  onDragEnd?: (startIndex: number, endIndex: number) => void;\n  onMoveBranch: (dragIndex: number, hoverIndex: number) => void;\n}\n\ninterface DragItem {\n  index: number;\n  name: string;\n}\n\nexport const DraggableConditionBranch: FC<\n  DraggableConditionBranchProps\n> = props => {\n  const { branch, index, onDragStart, onDragEnd, onMoveBranch, showDraggable } =\n    props;\n  const ref = useRef<HTMLDivElement>(null);\n\n  const [{ isDragging }, drag, preview] = useDrag(\n    () => ({\n      type: ConditionBranchBlock,\n      item: () => {\n        onDragStart?.(branch.uid);\n        return {\n          type: ConditionBranchBlock,\n          index,\n          startIndex: index,\n          uid: branch.uid,\n        };\n      },\n      end: (item, monitor) => {\n        onDragEnd?.(item.startIndex, index);\n      },\n      collect: monitor => ({\n        isDragging: monitor.isDragging(),\n      }),\n    }),\n    [branch, onDragEnd, index],\n  );\n\n  const [, drop] = useDrop<\n    DragItem,\n    // eslint-disable-next-line @typescript-eslint/no-invalid-void-type\n    void,\n    { handlerId: Identifier | null }\n  >(\n    () => ({\n      accept: ConditionBranchBlock,\n      hover(item, monitor) {\n        if (!ref.current || !monitor) {\n          return;\n        }\n        const dragIndex = item.index;\n        const hoverIndex = index;\n\n        // If the drag and hover items are the same, do nothing\n        if (dragIndex === hoverIndex) {\n          return;\n        }\n\n        // Get the bounding rectangle of the hover item\n        const hoverBoundingRect = ref.current?.getBoundingClientRect();\n        // Calculate the vertical midpoint of the hover term\n        const hoverMiddleY =\n          (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\n        // Get the current mouse pointer position\n        const clientOffset = monitor.getClientOffset();\n        if (!clientOffset) {\n          return;\n        }\n        // Calculate the distance of the pointer from the top of the hovering item\n        const hoverClientY = clientOffset.y - hoverBoundingRect.top;\n\n        // Drag down\n        if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {\n          return;\n        }\n        // Drag up\n        if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {\n          return;\n        }\n        // Perform a move operation\n        onMoveBranch(dragIndex, hoverIndex);\n        // Update the index of the drag item\n        item.index = hoverIndex;\n      },\n    }),\n    [branch, onMoveBranch, index],\n  );\n\n  useEffect(() => {\n    preview(getEmptyImage(), { captureDraggingState: true });\n  }, []);\n\n  drag(ref);\n\n  return (\n    <div\n      className={classNames({\n        ['opacity-0']: isDragging,\n        ['opacity-100']: !isDragging,\n      })}\n      ref={drop}\n    >\n      <ConditionBranch\n        {...props}\n        titleIcon={\n          showDraggable ? (\n            <IconHandle\n              ref={ref}\n              data-disable-node-drag=\"true\"\n              className=\"cursor-move pr-1\"\n              style={{ color: '#aaa' }}\n            />\n          ) : null\n        }\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const ConditionDraggableContainer = props => (\n  <div className=\"relative\">{props.children}</div>\n);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useDragLayer } from 'react-dnd';\nimport { useRef, useEffect, type FC, type ReactNode } from 'react';\n\nimport { usePlayground } from '@flowgram-adapter/free-layout-editor';\nimport { type Disposable } from '@flowgram-adapter/common';\n\nimport { ConditionBranchBlock } from './types';\n\ninterface CustomDragLayerProps {\n  preview: ReactNode;\n}\n\nexport const CustomDragLayer: FC<CustomDragLayerProps> = props => {\n  const { preview } = props;\n  const layerRef = useRef<HTMLDivElement>(null);\n  const zoomRef = useRef<number>();\n\n  const playground = usePlayground();\n\n  useEffect(() => {\n    let dispose: Disposable;\n    if (playground) {\n      dispose = playground.onZoom(z => {\n        zoomRef.current = z;\n      });\n    }\n    return () => {\n      if (dispose) {\n        dispose.dispose();\n      }\n    };\n  }, []);\n\n  const { itemType, isDragging, initialOffset, currentOffset } = useDragLayer(\n    monitor => ({\n      item: monitor.getItem(),\n      itemType: monitor.getItemType(),\n      isDragging: monitor.isDragging(),\n      initialOffset: monitor.getInitialSourceClientOffset(),\n      currentOffset: monitor.getSourceClientOffset(),\n    }),\n  );\n  function renderItem() {\n    switch (itemType) {\n      case ConditionBranchBlock:\n        return preview;\n      default:\n        return null;\n    }\n  }\n\n  function getItemStyles() {\n    if (\n      !initialOffset ||\n      !currentOffset ||\n      !layerRef.current\n      // !zoomRef.current\n    ) {\n      return {\n        display: 'none',\n      };\n    }\n    const layerOffset = layerRef.current.getBoundingClientRect();\n\n    let { x, y } = currentOffset;\n\n    // In the new interaction of 2.0, setters are rendered in the right panel and are not affected by canvas scaling, so if it is 2.0, the scaling ratio defaults to 1.\n    const zoomRatio = 1;\n\n    x -= layerOffset.x;\n    y -= layerOffset.y;\n    const transform = `translate(${x / zoomRatio}px, ${y / zoomRatio}px)`;\n\n    return {\n      transform,\n      WebkitTransform: transform,\n    };\n  }\n\n  if (!isDragging) {\n    return null;\n  }\n\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        pointerEvents: 'none',\n        scale: 1,\n        zIndex: 100,\n        left: 0,\n        top: 0,\n        width: '100%',\n        height: '100%',\n      }}\n      ref={layerRef}\n    >\n      <div style={getItemStyles()}>{renderItem()}</div>\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport const ConditionBranchBlock = 'ConditionBranch';\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { PlaygroundContext as PlaygroudContextOrigin } from '@flowgram-adapter/free-layout-editor';\nimport {\n  type WorkflowBatchService,\n  type WorkflowVariableService,\n  type WorkflowVariableValidationService,\n} from '@coze-workflow/variable';\nimport { type StandardNodeType } from '@coze-workflow/base';\n\nimport { type WorkflowNodesService } from '../service';\nimport { type NodeTemplateInfo } from './node';\n\nexport const PlaygroundContext = PlaygroudContextOrigin;\n\nexport interface PlaygroundContext {\n  readonly variableService: WorkflowVariableService;\n  readonly batchService: WorkflowBatchService;\n  readonly nodesService: WorkflowNodesService;\n  readonly variableValidationService: WorkflowVariableValidationService;\n\n  /**\n   * Get information by meta type\n   * @param type\n   */\n  getNodeTemplateInfoByType: (\n    type: StandardNodeType,\n  ) => NodeTemplateInfo | undefined;\n  /**\n   * Yes No, non-editable mode\n   */\n  disabled: boolean;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport { create } from 'zustand';\nimport {\n  useEntityFromContext,\n  useService,\n} from '@flowgram-adapter/free-layout-editor';\nimport { type WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { PlaygroundContext } from '@coze-workflow/nodes';\n\nimport { type ConditionBranchValue } from '../types';\nimport {\n  type BranchesValidateResult,\n  validateAllBranches as originValidateAllBranches,\n} from './validate';\n\nexport const useConditionValidate = () => {\n  const validateResultStore = useMemo(\n    () =>\n      create<{\n        validateResults: BranchesValidateResult;\n        setValidateResults: (results: BranchesValidateResult) => void;\n      }>(set => ({\n        validateResults: [],\n        setValidateResults: results =>\n          set(state => ({\n            validateResults: results,\n          })),\n      })),\n    [],\n  );\n\n  const { validateResults, setValidateResults } = validateResultStore(\n    state => ({\n      validateResults: state.validateResults,\n      setValidateResults: state.setValidateResults,\n    }),\n  );\n\n  const nodeEntity = useEntityFromContext<WorkflowNodeEntity>();\n  const playgroundContext = useService<PlaygroundContext>(PlaygroundContext);\n\n  const initValidateResultsWithBranches = (\n    branches: ConditionBranchValue[],\n  ) => {\n    setValidateResults(\n      originValidateAllBranches(branches, nodeEntity, playgroundContext),\n    );\n  };\n\n  const validateAllBranches = (branches: ConditionBranchValue[]) => {\n    const r = originValidateAllBranches(\n      branches,\n      nodeEntity,\n      playgroundContext,\n    );\n\n    setValidateResults(r);\n  };\n\n  return {\n    validateResults,\n    initValidateResultsWithBranches,\n    validateAllBranches,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * This module is a temporary solution for doing verification design\n * Due to the complete separation of the checksum values, there is a problem with state synchronization\n * But due to time constraints, it's simple to do this first\n * I hope one day I can have time to model the checksum values uniformly, or completely connect with rehaje.\n */\n\nimport { isNil, isEmpty } from 'lodash-es';\nimport { type ValidatorProps } from '@flowgram-adapter/free-layout-editor';\nimport { type FlowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport { type PlaygroundContext } from '@coze-workflow/nodes';\nimport { I18n } from '@coze-arch/i18n';\n\nimport {\n  type ConditionBranchValue,\n  type ConditionItem,\n  type ElementOfRecord,\n} from '../types';\nimport { calcComparisonDisabled } from '../condition-params-item/utils';\n// eslint-disable-next-line @coze-arch/no-deep-relative-import\nimport { valueExpressionValidator } from '../../../../validators';\n\nenum ValidateStatus {\n  /**\n   * No verification has been triggered, initial state\n   */\n  DEFAULT = 'default',\n  SUCCESS = 'success',\n  ERROR = 'error',\n}\nexport interface ValidateResult {\n  isValid: boolean | null;\n  validStatus: ValidateStatus;\n  message: string | null;\n}\n\nexport const defaultValidateResult: ValidateResult = {\n  isValid: null,\n  validStatus: ValidateStatus.DEFAULT,\n  message: null,\n};\n\nconst validateSuccessResult: ValidateResult = {\n  isValid: true,\n  validStatus: ValidateStatus.SUCCESS,\n  message: null,\n};\n\ninterface Validator<T> {\n  (value: T, disabled?: boolean): ValidateResult;\n}\n\nconst createRulesWithContext = (\n  node: FlowNodeEntity,\n  playgroundContext: PlaygroundContext,\n) => {\n  const rules: {\n    left: Validator<ConditionItem['left']>;\n    operator: Validator<ConditionItem['operator']>;\n    right: Validator<ConditionItem['right']>;\n  } = {\n    left: (value: ConditionItem['left'], disabled = false) => {\n      if (disabled) {\n        return validateSuccessResult;\n      }\n\n      const requiredValidateResult = valueExpressionValidator({\n        value,\n        node,\n        playgroundContext,\n        required: true,\n      });\n\n      if (!requiredValidateResult) {\n        return validateSuccessResult;\n      } else {\n        return {\n          isValid: false,\n          validStatus: ValidateStatus.ERROR,\n          message: requiredValidateResult,\n        };\n      }\n\n      // if (isNil(value) || isNil(value.content) || isEmpty(value.content)) {\n      //   return {\n      //     isValid: false,\n      //     validStatus: ValidateStatus.ERROR,\n      //     message: I18n.t('workflow_detail_condition_error_refer_empty'),\n      //   };\n      // } else {\n      //   return validateSuccessResult;\n      // }\n    },\n    operator: (value: ConditionItem['operator'], disabled = false) => {\n      if (disabled) {\n        return validateSuccessResult;\n      }\n\n      if (isNil(value)) {\n        return {\n          isValid: false,\n          validStatus: ValidateStatus.ERROR,\n          message: I18n.t('workflow_detail_condition_condition_empty'),\n        };\n      } else {\n        return validateSuccessResult;\n      }\n    },\n    right: (value: ConditionItem['right'], disabled = false) => {\n      if (disabled) {\n        return validateSuccessResult;\n      }\n      const emptyError = {\n        isValid: false,\n        validStatus: ValidateStatus.ERROR,\n        message: I18n.t('workflow_detail_condition_error_enter_comparison'),\n      };\n\n      const requiredValidateResult = valueExpressionValidator({\n        value,\n        node,\n        playgroundContext,\n        required: true,\n      });\n\n      if (!requiredValidateResult) {\n        return validateSuccessResult;\n      } else {\n        return {\n          ...emptyError,\n          message: requiredValidateResult,\n        };\n      }\n    },\n  };\n  return rules;\n};\n\nexport interface ConditionValidateResult {\n  left: ValidateResult;\n  operator: ValidateResult;\n  right: ValidateResult;\n}\n\nexport type BranchesValidateResult = Array<ConditionValidateResult[]>;\n\nexport const validateValue = (\n  value: ElementOfRecord<ConditionItem>,\n  rule:\n    | Validator<ConditionItem['left']>\n    | Validator<ConditionItem['operator']>\n    | Validator<ConditionItem['right']>,\n  disabled?: boolean,\n) =>\n  // const rule = rules[key];\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  rule(value as any, disabled);\n\nexport const validateAllBranches = (\n  branches: ConditionBranchValue[],\n  node: FlowNodeEntity,\n  playgroundContext: PlaygroundContext,\n) => {\n  if (!branches) {\n    return [];\n  }\n  const rules = createRulesWithContext(node, playgroundContext);\n\n  const branchesValidateResult: BranchesValidateResult = [];\n\n  branches.forEach((branch, branchIndex) => {\n    branch.condition?.conditions?.forEach((condition, conditionIndex) => {\n      const { left, right, operator } = condition;\n      if (!branchesValidateResult[branchIndex]) {\n        branchesValidateResult[branchIndex] = [];\n      }\n\n      branchesValidateResult[branchIndex][conditionIndex] = {\n        left: validateValue(left, rules.left),\n        operator: validateValue(operator, rules.operator),\n        right: validateValue(\n          right,\n          rules.right,\n          calcComparisonDisabled(operator),\n        ),\n      };\n    });\n  });\n\n  return branchesValidateResult;\n};\n\n/**\n *\n * @param conditions\n * @param context\n * @returns\n * External triggered overall verification, you need to tell the external source whether the data has passed the verification.\n */\nexport const validateAllBranchesFromOutside = (\n  branches: ConditionBranchValue[],\n  context: ValidatorProps['context'],\n) => {\n  const branchesValidateResults = validateAllBranches(\n    branches,\n    context.node,\n    context.playgroundContext,\n  );\n\n  if (isEmpty(branchesValidateResults)) {\n    return true;\n  }\n\n  const errors = branchesValidateResults\n    .map(branchValidateResult =>\n      branchValidateResult.map(item =>\n        Object.entries(item).map(\n          ([_key, result]) =>\n            !result.isValid && (result.message || 'invalid condition'),\n        ),\n      ),\n    )\n    .flat(2)\n    .filter(Boolean);\n\n  return errors.length === 0 ? true : errors.join(';');\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nexport const useModal = () => {\n  const [isVisible, setIsVisible] = useState(false);\n\n  const openModal = () => setIsVisible(true);\n  const closeModal = () => setIsVisible(false);\n\n  return {\n    isVisible,\n    openModal,\n    closeModal,\n  };\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { I18n } from '@coze-arch/i18n';\nimport { Modal } from '@coze-arch/coze-design';\nimport { JsonViewer } from '@coze-common/json-viewer';\nimport { SelectDatabaseModal } from '@coze-data/database-v2';\n\nimport { useGlobalState } from '@/hooks';\nimport { LibrarySelect } from '@/form-extensions/components/library-select';\nimport { TagList } from '@/components/tag-list';\nimport { useOpenDatabaseDetail } from '@/components/database-detail-modal';\n\nimport { useTags } from './use-tags';\nimport { useModal } from './use-modal';\nimport { useLibraries } from './use-libraries';\nimport { type DatabaseSelectValue } from './types';\n\ninterface DatabaseSelectProps {\n  value?: DatabaseSelectValue;\n  onChange?: (newValue: DatabaseSelectValue) => void;\n  readonly?: boolean;\n  addButtonTestID?: string;\n  libraryCardTestID?: string;\n}\n\nexport const DatabaseSelect = ({\n  value,\n  onChange,\n  readonly = false,\n  addButtonTestID,\n  libraryCardTestID,\n}: DatabaseSelectProps) => {\n  const { spaceId, projectId, getProjectApi, playgroundProps } =\n    useGlobalState();\n  const {\n    isVisible: isSelectDatabaseModalVisible,\n    openModal: openSelectDatabaseModal,\n    closeModal: closeSelectDatabaseModal,\n  } = useModal();\n  const { openDatabaseDetail } = useOpenDatabaseDetail();\n  const currentDatabaseID = value?.[0]?.databaseInfoID;\n  const libraries = useLibraries();\n  const tags = useTags(currentDatabaseID);\n\n  function changeDatabase(id: string) {\n    onChange?.([{ databaseInfoID: id }]);\n  }\n\n  function clearDatabase() {\n    onChange?.([]);\n  }\n\n  function handleSelectDatabaseModalAdd(id: string) {\n    changeDatabase(id);\n    closeSelectDatabaseModal();\n  }\n\n  function handleLibrarySelectDelete() {\n    Modal.confirm({\n      title: I18n.t(\n        'workflow_database_delete_confirm_modal_title',\n        {},\n        '',\n      ),\n      content: I18n.t(\n        'workflow_database_delete_confirm_modal_content',\n        {},\n        '',\n      ),\n      onOk: () => {\n        clearDatabase();\n      },\n      okText: I18n.t('workflow_confirm_modal_ok', {}, ''),\n      cancelText: I18n.t('workflow_confirm_modal_cancel', {}, ''),\n    });\n  }\n\n  function handleClickLibrarySelectLibrary(id: string) {\n    openDatabaseDetailOfLibrarySelect(id);\n  }\n\n  function handleClickDatabase(id: string) {\n    openDatabaseDetailOfLibrarySelect(id);\n  }\n\n  function openDatabaseDetailOfLibrarySelect(id: string) {\n    openDatabaseDetail({\n      databaseID: id,\n    });\n  }\n\n  // In the operation and maintenance platform, you can directly display the database ID information, because the database information cannot be pulled in the operation and maintenance platform.\n  if (IS_BOT_OP && value) {\n    return <JsonViewer data={value} />;\n  }\n\n  return (\n    <>\n      <LibrarySelect\n        readonly={readonly}\n        libraries={libraries}\n        onAddLibrary={openSelectDatabaseModal}\n        onDeleteLibrary={handleLibrarySelectDelete}\n        onClickLibrary={handleClickLibrarySelectLibrary}\n        emptyText={I18n.t('workflow_database_node_database_empty')}\n        renderLibrary={({ defaultLibraryRender }) => (\n          <div>\n            {defaultLibraryRender()}\n            {tags?.length && tags.length > 0 ? (\n              <TagList className=\"mt-[6px]\" tags={tags} max={3} />\n            ) : null}\n          </div>\n        )}\n        hideAddButton={value && value?.length > 0}\n        addButtonTestID={addButtonTestID}\n        libraryCardTestID={libraryCardTestID}\n      />\n      <SelectDatabaseModal\n        spaceId={spaceId}\n        visible={isSelectDatabaseModalVisible}\n        onClose={closeSelectDatabaseModal}\n        onAddDatabase={handleSelectDatabaseModalAdd}\n        onClickDatabase={handleClickDatabase}\n        onCreateDatabase={id => {\n          closeSelectDatabaseModal();\n          playgroundProps.refetchProjectResourceList?.();\n          getProjectApi()?.navigate(`/database/${id}`);\n        }}\n        enterFrom=\"workflow\"\n        projectID={projectId}\n      />\n    </>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type WorkflowDatabase } from '@coze-workflow/base';\n\nimport { useCurrentDatabaseQuery } from '@/hooks';\nimport { type Library } from '@/form-extensions/components/library-select';\n\nfunction databaseToLibrary(databaseInfo: WorkflowDatabase, error): Library {\n  const {\n    id = '',\n    tableDesc: description,\n    tableName: name,\n    iconUrl: iconUrl,\n  } = databaseInfo;\n  return {\n    id,\n    name,\n    description,\n    iconUrl,\n    isInvalid: !!error,\n  };\n}\n\nexport function useLibraries() {\n  const { data, error } = useCurrentDatabaseQuery();\n  const libraries: Library[] = data\n    ? [databaseToLibrary((data ?? {}) as WorkflowDatabase, error)]\n    : [];\n\n  return libraries;\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCurrentDatabaseQuery } from '@/hooks';\n\nexport function useTags(id?: string) {\n  const { data } = useCurrentDatabaseQuery();\n  return data?.fields?.map(({ name }) => name as string);\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useRef, useState } from 'react';\n\nimport { escape } from 'lodash-es';\nimport cls from 'classnames';\nimport { I18n } from '@coze-arch/i18n';\nimport {\n  IconCozTrashCan,\n  IconCozCheckMarkFill,\n} from '@coze-arch/coze-design/icons';\nimport {\n  Select,\n  Checkbox,\n  Tooltip,\n  type SelectProps,\n} from '@coze-arch/coze-design';\nimport { type RenderSelectedItemFn } from '@coze-arch/bot-semi/Select';\nimport { type Select as SemiSelect } from '@coze-arch/bot-semi';\n\nimport { useSlotNode } from './use-slot-node';\n\nimport styles from './style.module.less';\n\ntype Props = {\n  /** list of options */\n  options: SelectProps['optionList'];\n\n  /** Whether to select multiple, the default is false */\n  multiple?: boolean;\n\n  /** Whether to allow custom addition, the default is false */\n  enableCustom?: boolean;\n\n  /** Is it read-only? */\n  readonly?: boolean;\n\n  /** Custom placeholder */\n  inputPlaceholder?: string;\n\n  /** When allowing custom addition (enableCustom is true), add option events */\n  onAdd?: (value: string) => Promise<boolean>;\n\n  /** When allowing custom addition (enableCustom is true), remove the option event */\n  onDelete?: (value: string) => Promise<boolean>;\n} & SelectProps;\n\ninterface OptionNode {\n  label: string;\n  value: string;\n  isDefault: boolean;\n}\n\nconst TagContent = (props: OptionNode) => {\n  // \\ N,\\ t will be displayed as spaces by default, here concretized as\\ n and\\ t\n  const mapChars = {\n    '\\n': '\\\\n',\n    '\\t': '\\\\t',\n  };\n  return (\n    <>\n      <span>{props.label}</span>\n      {props.isDefault ? (\n        <span className={styles['delimiter-description']}>\n          ({escape(mapChars[props.value] || props.value)})\n        </span>\n      ) : null}\n    </>\n  );\n};\n\nconst TagSelector: React.FC<Props> = props => {\n  const {\n    options,\n    multiple,\n    readonly,\n    value,\n    inputPlaceholder,\n    onChange,\n    enableCustom,\n    onAdd,\n    onDelete,\n    ...restProps\n  } = props;\n\n  const selectRef = useRef<SemiSelect>(null);\n\n  /** Processing deletion. Considering the scenarios that may be deleted asynchronously in the future, this is still called asynchronously. */\n  const handleDelete = async (input: string) => {\n    await onDelete?.(input);\n  };\n\n  const [dropdownVisible, setDropdownVisible] = useState(false);\n\n  const { node: outSlotNode } = useSlotNode({\n    onAdd: async (inputValue: string) => {\n      const isSuccess = await onAdd?.(inputValue);\n\n      if (!multiple && isSuccess) {\n        selectRef.current?.close();\n      }\n\n      return Boolean(isSuccess);\n    },\n    dropdownVisible,\n    placeholder: inputPlaceholder,\n  });\n\n  const renderOptionItem = renderProps => {\n    const {\n      disabled,\n      selected,\n      label,\n      value: _value,\n      focused,\n      style,\n      onMouseEnter,\n      onClick,\n      ...rest\n    } = renderProps;\n\n    const { isDefault } = rest;\n\n    // Notice\n    // 1. the style passed by props needs to be consumed on the wrapper dom, otherwise it will not work normally in the virtualization scene\n    // 2. The styles of selected, focused, disabled, etc. need to be added by yourself. You can get the relative boolean value from props.\n    // 3.onMouseEnter needs to be bound on the wrapper dom, otherwise there will be problems when operating on the upper and lower keyboards.\n    const optionCls = cls({\n      ['custom-option-render']: true,\n      ['custom-option-render-focused']: focused,\n      ['custom-option-render-disabled']: disabled || readonly,\n      ['custom-option-render-selected']: selected,\n    });\n\n    const wrapClassName = [\n      'option-right',\n      'flex',\n      'flex-1',\n      isDefault ? '' : 'justify-between',\n    ];\n\n    return (\n      <div\n        style={style}\n        className={optionCls}\n        onClick={() => onClick()}\n        onMouseEnter={e => onMouseEnter()}\n      >\n        <div className=\"w-[12px] flex items-center\">\n          {multiple ? (\n            <Checkbox checked={selected} disabled={readonly} />\n          ) : null}\n          {!multiple && selected ? (\n            <IconCozCheckMarkFill style={{ color: 'rgba(78, 64, 229, 1)' }} />\n          ) : null}\n        </div>\n        <div className={cls(wrapClassName)}>\n          <TagContent label={label} value={_value} isDefault={isDefault} />\n          {!isDefault && (\n            <Tooltip content={I18n.t('Delete')}>\n              <IconCozTrashCan\n                onClick={e => {\n                  e.stopPropagation();\n                  handleDelete(_value);\n                }}\n                className=\"text-xs\"\n              />\n            </Tooltip>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  const renderSelectedItem = optionNode => {\n    if (multiple) {\n      // multiple choice\n      return {\n        isRenderInTag: true,\n        content: <TagContent {...optionNode} />,\n      };\n    } else {\n      // radio\n      return <TagContent {...optionNode} />;\n    }\n  };\n\n  return (\n    <div className={styles['selector-wrapper']}>\n      <Select\n        {...restProps}\n        ref={selectRef}\n        multiple={multiple}\n        value={value}\n        size=\"small\"\n        dropdownMatchSelectWidth\n        dropdownClassName={styles['selector-wrapper-dropdown']}\n        showRestTagsPopover\n        onChange={values => onChange?.(values)}\n        outerBottomSlot={enableCustom ? outSlotNode : null}\n        optionList={options}\n        renderOptionItem={renderOptionItem}\n        renderSelectedItem={renderSelectedItem as RenderSelectedItemFn}\n        onDropdownVisibleChange={setDropdownVisible}\n        style={{\n          pointerEvents: readonly ? 'none' : 'auto',\n          maxWidth: '460px',\n          height: '24px',\n        }}\n      />\n    </div>\n  );\n};\n\nexport default TagSelector;\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useRef, useEffect } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { IconCozPlus } from '@coze-arch/coze-design/icons';\nimport { Typography, Input, Button } from '@coze-arch/coze-design';\n\nimport styles from './style.module.less';\n\nconst MAX_INPUT_LENGTH = 20;\n\ninterface SlotNodeProps {\n  placeholder?: string;\n  dropdownVisible?: boolean;\n  /** When allowing custom addition (enableCustom is true), add option events */\n  onAdd?: (value: string) => Promise<boolean>;\n}\n\nexport function useSlotNode({\n  onAdd,\n  placeholder,\n  dropdownVisible,\n}: SlotNodeProps) {\n  /** When allowing custom addition, whether the current state is added */\n  const [showCustomise, setShowCustomise] = useState(false);\n\n  /** Record the current input value */\n  const [inputValue, setInputValue] = useState('');\n\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  /** handle add */\n  const handleAdd = async (input: string) => {\n    await onAdd?.(input).then(isSuccess => {\n      if (isSuccess) {\n        setInputValue('');\n      }\n    });\n  };\n\n  useEffect(() => {\n    if (!dropdownVisible) {\n      setShowCustomise(false);\n    }\n  }, [dropdownVisible]);\n\n  const outSlotNode = (\n    <>\n      {!showCustomise ? (\n        <div\n          className={styles['customise-button']}\n          onClick={() => {\n            setShowCustomise(true);\n            setTimeout(() => {\n              inputRef?.current?.focus();\n            }, 100);\n          }}\n        >\n          <IconCozPlus />\n          <Typography.Text>\n            {I18n.t('workflow_stringprocess_concat_symbol_custom')}\n          </Typography.Text>\n        </div>\n      ) : (\n        <div className=\"flex bg-white p-[4px] items-center\">\n          <div className=\"flex-1\">\n            <Input\n              ref={inputRef}\n              value={inputValue}\n              onEnterPress={() => handleAdd(inputValue)}\n              onChange={v => setInputValue(v)}\n              className=\"rounded-[8px]\"\n              placeholder={placeholder}\n              maxLength={MAX_INPUT_LENGTH}\n            />\n          </div>\n          <div className=\"flex p-[2px]\">\n            <Button\n              color=\"secondary\"\n              className={styles['action-cancel-button']}\n              onClick={() => {\n                setShowCustomise(false);\n              }}\n            >\n              {I18n.t('workflow_240218_17')}\n            </Button>\n            <Button\n              color=\"brand\"\n              className={styles['action-main-button']}\n              onClick={() => handleAdd(inputValue)}\n            >\n              {I18n.t('workflow_240218_18')}\n            </Button>\n          </div>\n        </div>\n      )}\n    </>\n  );\n\n  return {\n    node: outSlotNode,\n  };\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback, useState } from 'react';\n\nimport { I18n } from '@coze-arch/i18n';\nimport { type SelectProps, Toast, withField } from '@coze-arch/coze-design';\nimport { type SetterAbilityOptions } from '@flowgram-adapter/free-layout-editor';\n\nimport TagSelector from '../../components/tag-selector';\n\nimport styles from './style.module.less';\n\nexport interface DelimiterSelectorValue {\n  value: SelectProps['value'];\n  options: Array<{\n    label: string;\n    value: string;\n    isDefault: boolean;\n  }>;\n}\n\ninterface Props {\n  value: DelimiterSelectorValue;\n  onChange: (v: DelimiterSelectorValue) => void;\n\n  /**\n   * Node engine global readonly\n   */\n  readonly: boolean;\n  hasError?: boolean;\n  children?: React.ReactNode;\n\n  options: SetterAbilityOptions & {\n    /** Whether to choose more */\n    multiple: boolean;\n\n    /** Whether to allow customization */\n    enableCustom?: boolean;\n\n    /** Maximum number of customizations */\n    maxCustomLength?: number;\n\n    /** Text box prompt */\n    inputPlaceholder?: string;\n  };\n}\n\nexport const BaseDelimiterSelector = ({\n  value: _value,\n  onChange,\n  readonly,\n  hasError,\n  options: _options,\n}: Props) => {\n  const {\n    multiple,\n    enableCustom = true,\n    maxCustomLength,\n    inputPlaceholder = '',\n    ...restOptions\n  } = _options || {};\n\n  const [options, setOptions] = useState(_value.options);\n  const [values, setValues] = useState(_value.value);\n\n  const handleAdd = useCallback(\n    async (input: string) => {\n      if (!input) {\n        return Promise.resolve(false);\n      }\n\n      if (options.find(item => item.value === input)) {\n        Toast.warning(I18n.t('workflow_stringprocess_dulpicate_hover'));\n        return Promise.resolve(false);\n      }\n\n      if (\n        maxCustomLength &&\n        !Number.isNaN(maxCustomLength) &&\n        options.filter(item => !item.isDefault).length >= maxCustomLength\n      ) {\n        Toast.warning(\n          I18n.t('workflow_stringprocess_max_length_item', {\n            maxLength: maxCustomLength,\n          }),\n        );\n        return Promise.resolve(false);\n      }\n\n      const newOptionList = [\n        ...options,\n        { label: input, value: input, isDefault: false },\n      ];\n      setOptions(newOptionList);\n      const finalValues = multiple ? [...(values as string[]), input] : input;\n      setValues(finalValues);\n      onChange?.({\n        value: finalValues,\n        options: newOptionList,\n      });\n\n      return Promise.resolve(true);\n    },\n    [values, maxCustomLength, options],\n  );\n\n  const handleChange = useCallback(\n    (changeValues: SelectProps['value']) => {\n      setValues(changeValues);\n      onChange?.({\n        value: changeValues,\n        options,\n      });\n    },\n    [options],\n  );\n\n  const handleDelete = useCallback(\n    async (input: string) => {\n      if (!input) {\n        return Promise.resolve(false);\n      }\n\n      const newOptionList = options.filter(item => item.value !== input);\n      setOptions(newOptionList);\n      let finalValues = values;\n      if (multiple && Array.isArray(values)) {\n        finalValues = (values || []).filter(item => item !== input);\n      } else if (!multiple) {\n        finalValues = options?.[0]?.value;\n      }\n\n      setValues(finalValues);\n      onChange?.({\n        value: finalValues,\n        options: newOptionList,\n      });\n\n      return Promise.resolve(true);\n    },\n    [values, options],\n  );\n\n  return (\n    <div className={styles['delimiter-selector']}>\n      <TagSelector\n        {...restOptions}\n        value={values}\n        options={options}\n        onChange={handleChange}\n        onAdd={handleAdd}\n        onDelete={handleDelete}\n        readonly={readonly}\n        enableCustom={enableCustom}\n        multiple={multiple}\n        maxHeight={250}\n        hasError={!!hasError}\n        inputPlaceholder={inputPlaceholder}\n      />\n    </div>\n  );\n};\n\nexport const DelimiterSelector = withField(BaseDelimiterSelector);\n\nexport const delimiterSelectorSetter = {\n  key: 'DelimiterSelector',\n  component: BaseDelimiterSelector,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n  type FC,\n} from 'react';\n\nimport { debounce } from 'lodash-es';\nimport classNames from 'classnames';\nimport {\n  ExpressionEditorCounter,\n  ExpressionEditorEvent,\n  ExpressionEditorModel,\n  type ExpressionEditorTreeNode,\n  Expression,\n} from '@coze-workflow/components';\nimport { useNodeTestId } from '@coze-workflow/base';\nimport { SelectorBoxConfigEntity } from '@flowgram-adapter/free-layout-editor';\nimport { type SetterOrDecoratorContext } from '@flowgram-adapter/free-layout-editor';\nimport { useEntity } from '@flowgram-adapter/free-layout-editor';\n\nimport { useParseText, useVariableTree } from '../hooks';\n\nimport styles from './index.module.less';\n\ninterface ExpressionEditorContainerProps {\n  context: SetterOrDecoratorContext;\n  value: string;\n  key?: string;\n  placeholder?: string | (() => string);\n  readonly?: boolean;\n  disableSuggestion?: boolean;\n  disableCounter?: boolean;\n  onChange?: (value: string) => void;\n  minRows?: number;\n  maxLength?: number;\n  onBlur?: () => void;\n  onFocus?: () => void;\n  isError?: boolean;\n  customClassName?: string;\n}\n\n/**\n * Aggregation layer for business logic and editor logic\n */\nexport const ExpressionEditorContainer: FC<\n  ExpressionEditorContainerProps\n> = props => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const {\n    context,\n    key,\n    onChange,\n    onBlur,\n    onFocus,\n    isError,\n    // maxLength,//temporarily disabled\n    readonly = false,\n    disableSuggestion = false,\n    disableCounter = true,\n    minRows = 4,\n  } = props;\n  const maxLength = undefined; // Temporary Disable\n  const variableTree: ExpressionEditorTreeNode[] = useVariableTree();\n  const [focus, _setFocus] = useState<boolean>(false);\n  const { getNodeSetterId } = useNodeTestId();\n\n  const selectorBoxConfig = useEntity<SelectorBoxConfigEntity>(\n    SelectorBoxConfigEntity,\n  );\n\n  const [curEditorVal, setCurEditorVal] = useState<string>(props.value || '');\n\n  const placeholder = useParseText(props.placeholder);\n  const dataTestID = getNodeSetterId(context.path);\n  const formValue: string = props.value || '';\n  const [model] = useState<ExpressionEditorModel>(\n    () => new ExpressionEditorModel(formValue),\n  );\n  model.setVariableTree(variableTree);\n  model.setFocus(focus);\n\n  // Set anti-shake to prevent onFocus/onBlur from shaking when clicked\n  const setFocus = useCallback(\n    debounce((newFocusValue: boolean) => {\n      _setFocus(newFocusValue);\n    }, 50),\n    [],\n  );\n\n  const overflow = useMemo(() => {\n    if (typeof maxLength !== 'number') {\n      return false;\n    }\n    return model.value.length > maxLength;\n  }, [model.value.length, maxLength]);\n\n  useEffect(() => {\n    const disposer = model.on<ExpressionEditorEvent.Change>(\n      ExpressionEditorEvent.Change,\n      params => {\n        onChange && onChange(params.value);\n      },\n    );\n    return () => {\n      disposer();\n    };\n  }, [onChange]);\n\n  function handlePopoverVisibilityChange(visible: boolean) {\n    if (visible) {\n      selectorBoxConfig.disabled = true;\n    } else {\n      selectorBoxConfig.disabled = false;\n    }\n  }\n\n  /**\n   * There is a situation where value and editor.getValue () are always inconsistent when entering Chinese, resulting in re-rendering\n   * So update the form data when changing to onBlur\n   */\n  const handleOnBlur = () => {\n    onChange?.(curEditorVal);\n    setFocus(false);\n    onBlur?.();\n  };\n\n  return (\n    <div\n      key={key}\n      className={classNames(styles['expression-editor-container'], {\n        [styles['expression-editor-focused']]: focus,\n        [styles['expression-editor-error']]: isError || overflow,\n        [props?.customClassName as string]: props?.customClassName,\n      })}\n      onFocus={() => {\n        setFocus(true);\n        onFocus?.();\n      }}\n      onBlur={handleOnBlur}\n      ref={containerRef}\n    >\n      <Expression.EditorProvider>\n        <Expression.Renderer\n          value={formValue}\n          variableTree={variableTree}\n          className={classNames(\n            styles['editor-render'],\n            styles['editor-render-cm-content'],\n            styles[`editor-render-cmMinRows-${minRows}`],\n            {\n              [styles['editor-render-bottom-padding']]:\n                !disableCounter || overflow,\n            },\n          )}\n          readonly={readonly}\n          placeholder={placeholder}\n          dataTestID={dataTestID}\n          onChange={setCurEditorVal}\n        />\n        {readonly || disableSuggestion ? null : (\n          <Expression.Popover\n            variableTree={variableTree}\n            getPopupContainer={() => document.body}\n            onVisibilityChange={handlePopoverVisibilityChange}\n          />\n        )}\n      </Expression.EditorProvider>\n\n      <ExpressionEditorCounter\n        model={model}\n        maxLength={maxLength}\n        disabled={disableCounter && !overflow}\n        isError={overflow}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\n\nimport {\n  type ExpressionEditorTreeNode,\n  ExpressionEditorTreeHelper,\n} from '@coze-workflow/components';\nimport { useWorkflowNode } from '@coze-workflow/base';\n\nimport { useNodeAvailableVariablesWithNode } from '../../hooks';\nimport { convertInputs } from './utils/convert-inputs';\n\nconst useInputs = (): {\n  name: string;\n  keyPath?: string[];\n}[] => {\n  const workflowNode = useWorkflowNode();\n  const inputs = workflowNode?.inputParameters ?? [];\n  return convertInputs(inputs);\n};\n\nexport const useVariableTree = (): ExpressionEditorTreeNode[] => {\n  const variables = useNodeAvailableVariablesWithNode();\n  const inputs = useInputs();\n  const availableVariables = ExpressionEditorTreeHelper.findAvailableVariables({\n    variables,\n    inputs,\n  });\n  const variableTree =\n    ExpressionEditorTreeHelper.createVariableTree(availableVariables);\n  return variableTree;\n};\n\nexport const useParseText = (\n  text?: string | (() => string),\n): string | undefined =>\n  useMemo((): string | undefined => {\n    if (!text) {\n      return;\n    }\n    if (typeof text === 'string') {\n      return text;\n    }\n    if (typeof text === 'function') {\n      return text();\n    }\n    return;\n  }, [text]);\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isObject } from 'lodash-es';\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\nimport { reporter } from '@coze-workflow/base';\n\n// import { expressionEditorValidator } from './validator';\nimport { ExpressionEditorContainer } from './container';\n\nexport type ExpressionEditorProps = SetterComponentProps<\n  string,\n  {\n    key?: string;\n    /** Maximum length */\n    maxLength?: number;\n    /** minimum number of rows */\n    minRows?: number;\n    /** placeholder text */\n    placeholder?: string | (() => string);\n    /** Whether to disable the variable reference mode, enter {{pop-up variable floating layer, enabled by default, and can be configured to close */\n    disableSuggestion?: boolean;\n    /** Whether to disable the length counter, disabled by default, configurable to turn on */\n    disableCounter?: boolean;\n    /** out of focus callback */\n    onBlur?: () => void;\n    /** focus callback */\n    onFocus?: () => void;\n    /** Whether to display the error status */\n    isError?: boolean;\n    /** Input variables (used only to trigger rehaje to rerender the form) */\n    inputParameters?: unknown[];\n    /** Custom className */\n    customClassName?: string;\n  }\n>;\n\n// TODO temporary hacking method, cover the online problem, and delete it after troubleshooting the specific reason.\nconst getAnyValueContent = (value: unknown): string => {\n  if (\n    isObject(value) &&\n    'value' in value &&\n    isObject(value.value) &&\n    'content' in value.value\n  ) {\n    reporter.event({\n      eventName: 'workflow_invalid_end_schema_format',\n    });\n    return value.value.content as string;\n  }\n\n  return value as string;\n};\n\nexport const ExpressionEditor = ({\n  value,\n  onChange,\n  options,\n  readonly,\n  context,\n  feedbackStatus,\n}: ExpressionEditorProps) => {\n  const {\n    key,\n    placeholder,\n    minRows,\n    maxLength,\n    disableSuggestion,\n    disableCounter,\n    customClassName,\n  } = options;\n\n  // TODO Temporary Hack Backup Online Issue\n  const text = getAnyValueContent(value);\n\n  return (\n    <ExpressionEditorContainer\n      context={context}\n      key={key}\n      value={text}\n      readonly={readonly}\n      onChange={onChange}\n      placeholder={placeholder}\n      minRows={minRows}\n      maxLength={maxLength}\n      disableSuggestion={disableSuggestion}\n      disableCounter={disableCounter}\n      customClassName={customClassName}\n      isError={feedbackStatus === 'error'}\n    />\n  );\n};\n\nexport const expressionEditor = {\n  key: 'ExpressionEditor',\n  component: ExpressionEditor,\n  // validator: expressionEditorValidator,\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type ExpressionEditorTreeHelper } from '@coze-workflow/components';\nimport {\n  type InputValueVO,\n  type RefExpressionContent,\n} from '@coze-workflow/base';\n\nexport function convertInputs(\n  inputs: InputValueVO[],\n): ExpressionEditorTreeHelper.Input[] {\n  return inputs\n    .map(i => {\n      const res: ExpressionEditorTreeHelper.Input = {\n        name: i.name ?? '',\n        keyPath: [\n          ...((i.input?.content as RefExpressionContent)?.keyPath || []),\n        ], // Deep copy\n      };\n\n      if (i?.children?.length) {\n        res.children = convertInputs(i.children);\n      }\n\n      return res;\n    })\n    .filter(i => !!i.name);\n}\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport classNames from 'classnames';\nimport { type Model } from '@coze-arch/bot-api/developer_api';\nimport {\n  ModelSelect,\n  type ModelSelectProps,\n} from '@coze-agent-ide/model-manager/model-select-v2';\n\nimport { useGlobalState } from '@/hooks';\n\nimport styles from './model-select-v2.module.less';\n\nexport interface ModelSelectV2Props\n  extends Pick<ModelSelectProps, 'triggerRender' | 'popoverPosition'> {\n  className?: string;\n  value: number | undefined;\n  onChange: (value: number) => void;\n  models: Model[];\n  readonly?: boolean;\n}\n\nexport const ModelSelectV2: React.FC<ModelSelectV2Props> = ({\n  className,\n  value,\n  onChange,\n  models,\n  readonly,\n  popoverPosition,\n  triggerRender,\n}) => {\n  const { spaceId, projectId, isBindDouyin } = useGlobalState();\n  return (\n    <ModelSelect\n      // will support soon\n      enableJumpDetail={isBindDouyin || IS_OPEN_SOURCE ? false : { spaceId }}\n      className={classNames(styles.select, className)}\n      popoverClassName={classNames(\n        styles['selector-popover'],\n        styles[`selector-popover-${projectId ? 'project' : 'library'}`],\n      )}\n      popoverPosition={popoverPosition || 'bottomRight'}\n      disabled={readonly}\n      selectedModelId={value ? `${value}` : ''}\n      modelList={models}\n      clickToHide\n      onModelChange={(model: Model) => {\n        if (model.model_type) {\n          onChange(Number(model.model_type));\n        }\n      }}\n      triggerRender={triggerRender}\n    />\n  );\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { last } from 'lodash-es';\nimport type { FormItemMaterialContext } from '@flowgram-adapter/free-layout-editor';\nimport type { WorkflowNodeEntity } from '@flowgram-adapter/free-layout-editor';\nimport type {\n  RefExpression,\n  WorkflowVariableFacadeService,\n} from '@coze-workflow/variable';\nimport {\n  type InputValueVO,\n  StandardNodeType,\n  WorkflowNode,\n} from '@coze-workflow/base';\n\nimport type { NodeInputNameFormat } from './type';\n\n/** Get the corresponding key name according to the value of StandardNodeType */\nexport function getStandardNodeTypeKey(\n  value: string,\n): keyof typeof StandardNodeType | undefined {\n  const entries = Object.entries(StandardNodeType);\n  const found = entries.find(([_, val]) => val === value);\n  return found ? (found[0] as keyof typeof StandardNodeType) : undefined;\n}\n\n/** Get variable name */\nexport const getVariableName = (params: {\n  /** variable expression */\n  input: RefExpression;\n  /** prefix */\n  prefix?: string;\n  /** suffix */\n  suffix?: string;\n  /** Name custom formatting */\n  format?: NodeInputNameFormat;\n  /** Node */\n  node: WorkflowNodeEntity;\n  /** Variable service */\n  variableService: WorkflowVariableFacadeService;\n}): string | undefined => {\n  const { input, node, variableService, prefix = '', suffix = '' } = params;\n  const keyPath = input?.content?.keyPath;\n\n  if (\n    input?.type !== 'ref' ||\n    !Array.isArray(keyPath) ||\n    keyPath.length === 0\n  ) {\n    return;\n  }\n\n  const fallbackName = last(keyPath);\n\n  const variable = variableService.getVariableFacadeByKeyPath(keyPath, {\n    node,\n  });\n\n  if (!variable) {\n    return fallbackName;\n  }\n\n  const name =\n    keyPath.length === 1\n      ? getStandardNodeTypeKey(variable.node?.flowNodeType as string)\n      : variable.viewMeta?.name;\n\n  if (!name) {\n    return fallbackName;\n  }\n\n  if (params.format) {\n    return params.format({\n      name,\n      prefix,\n      suffix,\n      input,\n      node,\n    });\n  }\n\n  return `${prefix}${name}${suffix}`;\n};\n\n/** Check if they have the same name */\nconst checkSameName = (\n  name: string,\n  inputParameters: InputValueVO[],\n): number => {\n  const sameNameVariables = inputParameters.filter(\n    inputParameter => inputParameter.name === name,\n  );\n  return sameNameVariables.length;\n};\n\n/** Generate non-duplicate names */\nexport const getUniqueName = (params: {\n  variableName: string;\n  inputParameters: InputValueVO[];\n}): string => {\n  const { variableName, inputParameters } = params;\n  if (!inputParameters) {\n    return variableName;\n  }\n  const sameNames = checkSameName(variableName, inputParameters);\n  if (sameNames === 0) {\n    return variableName;\n  }\n  let nameIndex = 1;\n  /** If there is a duplicate name, generate a new name */\n  while (true) {\n    const currentName = `${variableName}${nameIndex}`;\n    const currentSameNames = checkSameName(currentName, inputParameters);\n    if (currentSameNames === 0) {\n      return currentName;\n    }\n    nameIndex += 1;\n  }\n};\n\nexport const defaultGetNames = (context: FormItemMaterialContext): string[] => {\n  const workflowNode = new WorkflowNode(context.node);\n  const nodeInputParameters = workflowNode?.inputParameters ?? [];\n  return nodeInputParameters\n    .map(input => input.name)\n    .filter(Boolean) as string[];\n};\n","/*\n * Copyright 2025 coze-dev Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type FC } from 'react';\n\nimport classnames from 'classnames';\nimport { type SetterComponentProps } from '@flowgram-adapter/free-layout-editor';\n\ntype NotifyProps = SetterComponentProps;\nimport { Text } from '@/form-extensions/components/text';\n\nexport const Notify: FC<{\n  text: string;\n  align?: 'left' | 'center' | 'right';\n  className?: string;\n  // Whether to wrap\n  isBreakLine?: boolean;\n}> = ({ text, align = 'center', className = '', isBreakLine = false }) => (\n  <div\n    className={classnames(\n      'w-full !px-[8px] !py-[6px] flex flex-row items-center coz-mg-hglt-secondary text-[14px]',\n\n      {\n        'justify-center': align === 'center',\n        'justify-end': align === 'right',\n        'justify-start': align === 'left',\n      },\n      className,\n    )}\n  >\n    {isBreakLine ? text : <Text text={text} />}\n  </div>\n);\n\nconst NotifyField: FC<NotifyProps> = props => (\n  <Notify text={props.options?.text} {...props.options} />\n);\n\nexport const notify = {\n  key: 'Notify',\n  component: NotifyField,\n};\n"],"names":["copyProductErrorCodes","Text","Typography","useWorkflowAction","param","data","workFlowList","copyProductHandle","onWorkFlowListChange","onAdd","onRemove","onItemClick","onDupSuccess","onDelete","handleDeleteWorkflow","isProfessionalTemplate","context","useContext","WorkflowModalContext","botId","useParams","navigate","useNavigate","isCozePro","useCozeProRightsStore","state","getIsCozePro","useEffect","_getWorkflowItem","config","isSelectProjectCategory","getProjectWorkflow","_getProjectWorkflow","getWorkflowItemByPluginId","CustomError","_resp_data","workflowInfos","workflowApi","Toast","I18n","_getWorkflowItemByPluginId","_resp_data_plugin_list","_target_plugin_apis_at_parameters","_config_flowMode","pluginInfos","PluginDevelopApi","PluginType","target","WorkflowMode","isTypeWorkflow","DataSourceType","dupProduct","encodeURIComponent","reporter","newPluginId","newWorkflowId","resp","e","wait","_data_meta_info","newWorkflow","ProductEntityType","Space","Button","window","dupWorkflowTpl","_resp_data_","_resp_data_1","_data_workflow_id","_data_workflow_id1","_data_flow_mode","sourceFlowMode","addWorkflow","getWorkflowItem","addResult","isBoolean","deleteWorkflow","deleteConfig","item","removeWorkflow","itemClick","workflow","_flowData_workflow_id","_context_spaceId","wId","query","ret","flowData","URLSearchParams","useWorkflowProductList","pageSize","enabled","keyword","setKeyword","useState","sortType","setSortType","SortType","categoryId","setCategoryId","source","setSource","initialPageParam","useMemo","queryKey","JSON","fetchProductList","params","ProductApi","pageData","queryError","fetchNextPage","hasNextPage","isFetching","isFetchingNextPage","loadingStatus","refetch","useInfiniteQuery","pageParam","lastPage","allPages","lastPageParam","_lastPageParam_page_num","workflowProductList","result","idMap","page","_page_products","product","updatePageParam","newParam","_newParam_sort_type","copyProduct","targetSpaceId","_item_meta_info","_item_meta_info1","_res_data","_res_data1","_item_meta_info2","_item_meta_info_price","_item_meta_info_id","_item_meta_info_name","_item_meta_info_entity_id","res","workflowId","pluginId","sendTeaEvent","EVENT_NAMES","Number","useWorkflowSearch","debounceChangeSearch","cancel","useDebounceFn","search","updateSearchQuery","dataSourceType","isSpaceWorkflow","newState","undefined","UISearch","WorkflowFilter","forwardRef","ref","from","hiddenSpaceList","hiddenExplore","hiddenLibrary","hiddenWorkflowCategories","FLAGS","useFlags","getWorkflowTags","_res_data_tags","isGeneralWorkflow","currentValue","tags","useQuery","Boolean","useImperativeHandle","clickSpaceContent","category","WorkflowCategory","nodeDataList","tempList","IconCozKnowledgeFill","s","WorkflowModalFrom","nodeData","active","classNames","WorkflowModalSider","props","hiddenCreate","searchNode","UICompositionModalSider","CreateWorkflowBtn","useWorkflowModalParts","flowMode","initState","hideSider","bindBizId","bindBizType","projectId","i18nMap","spaceType","spaceId","useSpaceStore","sideRef","useRef","modalState","setModalState","_initState_status","WorkFlowListStatus","_initState_dataSourceType","_initState_creator","MineActiveEnum","_initState_workflowTag","_initState_productCategory","_initState_query","_initState_isSpaceWorkflow","_initState_listFlowMode","updateModalState","useCallback","orderBy","setOrderBy","OrderBy","createModalVisible","setCreateModalVisible","useMount","contextValue","SpaceType","ctx","isBindDouyin","BindBizType","hideSidebar","sider","QueryClientProvider","workflowQueryClient","content","WorkflowModalContent","val","_sideRef_current_getCurrent","_resourceMap_","resource","FlowResourceFrom","FlowStoreType","FlowDuplicateType","filter","WorkflowModalFilterForDouyin","WorkflowModalFilter","_WORKFLOW_MODAL_I18N_KEY_MAP_flowMode","title","ModalI18nKey","styles","_props_flowMode","className","visible","onClose","isDouyinBot","UICompositionModal","_context_flowMode","onCreateSuccess","nameValidators","i18nText","useI18nText","openWorkflowDetailPage","useOpenWorkflowDetail","createFlowMode","setCreateFlowMode","showSingleButton","menuConfig","IconCozWorkflow","IconCozChat","Menu","value","event","IconCozArrowDown","CreateWorkflowModal","WORKFLOW_LIST_STATUS_ALL","React","EncapsulateValidateErrorCode","EncapsulateCommands","EncapsulateValidateResult","Symbol","EncapsulateValidateResultFactory","EncapsulateNodeValidator","EncapsulateNodesValidator","EncapsulateWorkflowJSONValidator","EncapsulateValidateManager","EncapsulateValidateService","EncapsulateValidateManagerImpl","type","validator","excludeStartEnd","nodes","node","StandardNodeType","EncapsulateGenerateService","getNodesParentId","_nodes__parent","getNodePoint","_node_meta","WorkflowNodeEntity","positionData","PositionData","setNodePositionByRect","rect","position","EncapsulateContext","getGlobalState","getNodeTemplate","_this_globalState","_this_globalState_info","checkEncapsulateGray","getFlags","isNodesInSubCanvas","isNodeInSubCanvas","_node_parent","isSubCanvasNode","FlowNodeBaseType","getSubCanvasParent","nodeMeta","subCanvas","EncapsulateLinesService","inputLines","outputLines","Error","uniq","_line","portInfo","fromPorts","toPorts","_fromPort","_toPort","_node","WorkflowNodeLinesData","lines","isFromPortUniq","isToPortUniq","ports","subFlowNode","line","inputLine","_line_toPort","outputLine","options","startNodeId","endNodeId","idsMap","workflowJSON","edges","n","edgesGroup","groupBy","edge","internalLines","internalEdges","createdLines","inputEdges","outputEdges","_outputLine_to","_outputLine_toPort","info","_line_toPort1","_line_toPort2","_line_toPort3","randomNameSuffix","nanoid","customAlphabet","hasSubCanvasNodes","workflowDocument","_registry_meta","registry","EncapsulateApiService","ICON_URIS","EncapsulateApiServiceImpl","name","desc","json","version","OperateType","get","res1","variableOrder","orders","sortVariables","variables","a","b","_b_viewMeta","_a_viewMeta","getNodesWithSubCanvas","_subCanvas_canvasNode","EncapsulateVariableService","_nodes","vars","_workflowJSON_nodes_find","startId","produce","draft","startVars","endVars","Object","_entry","variable","traverseRefsInNodeJSON","cb","isObject","has","_key","_val","isArray","_item","_ref","_ref_content","_ref_content_name","targetKeyPath","targetEntry","_var","selectNodes","updateRefInfos","WorkflowNodeRefVariablesData","sourceNode","group","startNode","endNode","middleNodes","decapsulateNodes","sourceInputParameters","FlowNodeFormData","updateInsideRefInfos","updateOutsideRefInfos","endOutputs","_output","input","beforeKeyPath","expression","variableUtils","ValueExpressionType","nodeId","paths","formData","inputParameters","acm","isFormV2","fullData","set","selectNodeIds","_keyPath","isGlobalVariableKey","variablesMap","_variable","index","queue","EncapsulateNodesService","parentId","nodePoint","centerPoint","translate","Map","nodeJSON","pos","point","width","height","previousValue","transformData","TransformData","FreeOperationType","id","uniqueTitle","block","_nodeJSON_meta","x1","Math","x2","y1","y2","boundaryNodes","delay","nodeType","nodeRegistry","boundaryNode","nodeReact","boundaryNodeReact","translateX","ENCAPSULATE_START_END_PAD","translateY","EncapsulateServiceImpl","selectedNodes","getSubWorkflowInfo","formItem","encapsulateVars","startEndRects","error","logger","message","Emitter","EncapsulateService","EncapsulateManager","EncapsulateManagerImpl","DisposableCollection","EncapsulateGenerateServiceImpl","_this_findSubCanvasNodeJSON","_this_findSubCanvasNodeJSON1","nodeIds","defaultJSON","encapsulateNodes","parentNodes","encapsulateEdges","parentEdges","startEdges","endEdges","uniqBy","template","nodeJSONs","subCanvasNode","subCanvasId","EncapsulateValidateServiceImpl","validateResult","workflowJSONValidators","Promise","workflowJSONValidator","nodesValidator","nodeValidator","EncapsulateValidateResultImpl","errors","code","WorkflowEncapsulateContainerModule","ContainerModule","bind","EncapsulateBaseValidator","to","workflowNode","WorkflowNode","_nodeMeta_renderSubCanvas1","parent","SubCanvasValidator","sourceName","sourceIcon","StartEndValidator","filtered","LoopNodesValidator","EncapsulateSchemaValidator","_error_node_error","_error_path_error","EncapsulatePortsValidator","ignoreNodes","portsData","WorkflowNodePortsData","port","EncapsulateOutputLinesValidator","EncapsulateInputLinesValidator","EncapsulateFormValidator","_type","EncapsulateValidatorsContainerModule","bindContributions","Validator","EncapsulateRenderService","EncapsulateShortcutsContribution","console","EncapsulateRenderContainerModule","WorkflowShortcutsContribution","useSelectedNodes","selectService","useService","WorkflowSelectService","setSelectedNodes","disposable","useVariableChange","setVersion","disposables","_node_getData_public","FlowNodeVariableData","useEncapsulate","encapsulateService","encapsulateRenderService","loading","setLoading","handleEncapsulate","ErrorTitle","selectServices","playground","usePlayground","scrollToNode","success","ErrorMessage","EncapsulateTooltip","onMouseEnter","onMouseLeave","children","tooltipVisible","setTooltipVisible","hasError","groupErrors","Tooltip","isMacOS","navigator","CTRL","ENCAPSULATE_SHORTCUTS","SHIFT","EncapsulateButton","validating","useValidate","setValidating","setErrors","validationIdRef","handleValidate","currentValidationId","variableVersion","useDebounceEffect","disabled","timeOutRef","handleMouseLeave","handleMouseEnter","clearTimeout","EncapsulatePanel","length","show","setShow","display","createWorkflowEncapsulatePlugin","definePluginCreator","WorkflowOperationReportService","operation","eventName","fromPort","toPort","id1","path","snakeCase","lastPath","lastId","createOperationReportPlugin","WorkflowHistoryConfig","WorkflowHistoryShortcutsContribution","WorkflowCommands","shouldMerge","_op","prev","element","Date","operationMetas","op","document","WorkflowDocument","cloneDeep","linesManager","WorkflowLinesManager","WorklfowHistoryOperationsContribution","operationRegistry","operationMeta","WorkflowHistoryContainerModule","OperationContribution","DEFAULT_MODEL_TYPE","IS_OVERSEA","VARIABLE_NAME_REGEX","DEFAULT_NODE_META_PATH","DEFAULT_BATCH_PATH","DEFAULT_OUTPUTS_PATH","BATCH_CONCURRENT_SIZE_MIN","BATCH_CONCURRENT_SIZE_MAX","BATCH_SIZE_MIN","BATCH_SIZE_MAX","DEFAULT_BATCH_CONCURRENT_SIZE","DEFAULT_BATCH_SIZE","INTENT_NODE_MODE","MINIMAL_INTENT_ITEMS","STANDARD_INTENT_ITEMS","SYSTEM_DELIMITER","DEFAULT_DELIMITER_OPTIONS","roleInformationKeyword","DEFAULT_NODE_SIZE","LLMNodeDataSkillType","WorkflowNodeData","EntityData","WorkflowNodesService","ignoreNode","titlePrefix","ignoreTitles","allTitles","allTitlesSet","Set","startIndex","newTitle","matched","SETTING_ON_ERROR_V2_NODES","SETTING_ON_ERROR_V1_NODES","SETTING_ON_ERROR_DYNAMIC_PORT_NODES","SETTING_ON_ERROR_NODES","SETTING_ON_ERROR_PORT","SETTING_ON_ERROR_MIN_TIMEOUT","SETTING_ON_ERROR_DEFAULT_TIMEOUT","SETTING_ON_ERROR_NODES_CONFIG","ERROR_BODY_NAME","IS_SUCCESS_NAME","formatExtOnInit","ext","llmParam","getDTOProcessType","settingOnError","SettingOnErrorProcessType","settingOnErrorInitV2","isNodeContextV2","_settingOnError_retryTimes","timeoutMs","timeoutConfig","getTimeoutConfig","formatExtOnSave","playgroundContext","models","modelMeta","m","formatModelData","settingOnErrorSaveV2","_context_node","isSettingOnErrorV2","settingOnErrorToVO","settingOnErrorToDTO","formatOutputsOnInit","_value_inputs_settingOnError","_value_inputs_batch","outputs","isV2","isOpen","isBatch","getOutputsWithErrorBody","settingOnErrorInit","_value_inputs","settingOnErrorSave","useIsSettingOnErrorV2","useCurrentEntity","useIsSettingOnError","isSettingOnError","isSettingOnErrorDynamicPort","generateErrorBodyMeta","ViewVariableType","generateIsSuccessMeta","isLocalPlugin","nodeDataEntity","_SETTING_ON_ERROR_NODES_CONFIG_node_flowNodeType","settingOnErrorNames","excludeFn","v","includeFn","_value__children","_one_children","one","rest","sortErrorBody","_one_children1","getExcludeErrorBody","TriggerForm","Tab","TriggerFormEventType","_variable_key","CronJobType","getInputTypeBase","inputType","viewType","getInputType","getDefaultResponseFormat","RESPONSE_FORMAT_NAME","queryClient","QueryClient","Infinity","repairResponseFormatInModelList","modelList","_modelList_find_model_params","modelHasResponseFormatItem","_m","_m_model_params","p","_m_model_params2","_m_model_params3","_m_model_params1","_newResponseFormat_default_val","newResponseFormat","k","ResponseFormat","getLLMModels","_resp_data_model_list","ids","llmModelIds","getLLMModelIdsByNodeJSON","modelIds","Array","modelId","idstr","getTypeListParams","ModelScene","developerApi","_modelList","captureException","getSortedInputParameters","inputs","groupKey","sortKey","processedItems","grouped","sortBy","getDefaultModels","_modelMeta_model_params","defaultModel","_p_default_val_GenerationDiversity_Balance","camelCase","defaultValue","GenerationDiversity","ModelParamType","model","modelParamMap","keyBy","mapValues","key","modelParam","isString","getDefaultLLMParams","_models_find","nodeUtils","BATCH_MODE_PATH","BATCH_PATH","mapToArray","map","handle","arrayToMap","array","handler","batchToDTO","batchVO","nodeFormContext","variableService","batchSize","concurrentSize","inputLists","inputList","batchToVO","batchDTO","refExpressionToValueDTO","literalExpressionToValueDTO","isNil","String","getLiteralExpressionViewVariableType","isInteger","isNumber","refExpressionDTOToVO","literalExpressionDTOToVO","getBatchInputListFormDefaultValue","getBatchModeFormMeta","isBatchV2","formValueToDto","inputParams","formattedInputParams","mapValue","batchMode","batch","formattedBatch","BatchMode","dtoToformValue","arrayItem","formattedBatchMode","InputTreeValidator","inputValues","_inputValues_i","inputValue","i","rules","values","names","foundSames","variableValidationService","ValueExpression","inputTreeValidator","InputTreeNodeSchema","z","parsed","InputTreeSchema","issues","issue","NodeMetaSchema","nodeMetaValidator","schema","isTitleRepeated","nodesService","ajv","jsonSchemaValidator","viewVariableMeta","dtoMeta","jsonSchema","generateInputJsonSchema","Ajv","validate","OutputTreeNodeSchema","OutputTreeSchema","findDuplicates","seen","found","OutputTreeUniqueNameSchema","duplicate","checkObjectDefaultValue","outputTreeValidator","uniqueName","SettingOnErrorSchema","settingOnErrorValidator","schemeParesd","isJSONVerified","WorkflowJSONFormat","variablesMeta","WorkflowNodeVariablesMeta","doc","outputsPath","variableMetas","meta","newData","isEmpty","inputsPath","staticMeta","pick","isClone","nodeDTOType","isFunction","WorkflowDocumentWithFormat","fireRender","flattenJSON","nodeBlocks","nodeEdges","formattedJSON","nestedJSON","formatKey","args","fns","format","f","fn","compose","_rootJSON_blocks","_rootJSON_edges","rootJSON","WorkflowLineEntity","_json_nodes","_json_edges","rootNodes","rootEdges","flattenNodeJSONs","flattenEdgeJSONs","rootBlockIDs","rootEdgeIDs","blocks","blockIDs","edgeIDs","edgeID","_nodeBlocks_get","_nodeEdges_get","nestJSON","nodeMap","edgeMap","rootBlockSet","rootEdgeSet","edgeJSON","blockJSONs","blockID","edgeJSONs","WorkflowNodesContainerModule","unbind","isBound","rebind","WorkflowJSONFormatContribution","RenderCustomOption","extraOptions","disableBot","disableProject","disableBotTooltip","disableProjectTooltip","isBot","IntelligenceType","isItemDisabled","disabledTooltip","renderOptionItem","optionItem","Avatar","Tag","Select","concatTestId","RenderFootLoading","onObserver","indicatorRef","loadingObserver","IntersectionObserver","entries","Spin","Bots","onChange","idValue","globalState","useGlobalState","chatflowService","ChatflowService","relatedBotService","useRelatedBotService","isLoadMoreDate","selectList","setSelectList","isLoading","setIsLoading","isShowFoot","setIsShowFoot","setSearch","searchTotal","setTotal","containerRef","nextCursorRef","useNewGlobalVariableCache","handleChange","botInfo","_value","extraBotOption","useExtraBotOption","listMaxHeight","realTotal","fetchBotList","_chatflowService_selectItem","findItem","isReset","intelligenceApi","PUBLIC_SPACE_ID","IntelligenceStatus","intelligences","total","next_cursor_id","list","it","_it_basic_info_name","_it_basic_info_id","_it_basic_info_icon_url","totalList","loadMoreData","debounce","IconSearch","newValue","useBotInfo","PlaygroundApi","transformBotInfo","_data_bot_info_model_info","_botInfo_bot_info_name","_botInfo_bot_info_icon_url","_botInfo_bot_info_bot_id","_botInfo_bot_info","botOptionList","currentBotValue","projectItemInfo","useProjectItemInfo","botValue","botItem","projectValue","projectItem","_projectItemInfo_basic_info","_projectItemInfo_basic_info1","_projectItemInfo_basic_info2","useProjectInfo","variableList","_VariableList_filter","VariableList","MemoryApi","isProject","ChatHistoryRound","readonly","IconCozInfoCircle","CozInputNumber","w","isNaN","languages","mixLanguages","shell","themes","cozeLight","cozeDark","minHeightOption","EditorView","maxHeightOption","heightOption","paddingOption","borderRadiusOption","lineHeightOption","builtinExtensions","CodeEditor","createRenderer","preset","option","RawEditorTheme","extensions","history","keymap","defaultKeymap","historyKeymap","TextEditor","universal","createTheme","t","logicTextMap","ConditionLogic","ConditionItemLogic","logic","showStroke","testId","CopyButton","delayTime","isSuccess","setSuccess","UIIconButton","IconCozCheckMark","setTimeout","IconCozCopy","useWorkflowDetailModalStore","create","devtools","databaseID","isAddedInWorkflow","onChangeDatabaseToWorkflow","tab","DatabaseDetailModal","isVisible","close","projectCommitVersion","addRemoveButtonText","Modal","DatabaseDetailComponent","useOpenDatabaseDetail","open","setData","useWorkflowNode","databaseInfoList","dataCopy","_databaseInfoList_","currentNodeDatabaseID","ExpandEditorContainer","closeButton","editorTitle","editorTooltip","actions","editorContent","containerClassName","headerClassName","contentClassName","closeIconClassName","IconInfo","action","IconButton","IconCozSideCollapse","InnerEditorContainer","onBlur","onFocus","isError","focus","_setFocus","getNodeSetterId","useNodeTestId","dataTestID","setFocus","newFocusValue","EditorThemeProvider","editorTheme","setEditorTheme","EditorTheme","isDarkTheme","EditorThemeContext","codeExtensions","ICON_MAP","IconCozFilePptx","IconCozFileDocx","IconCozFilePdf","IconCozFileTxt","IconCozFileZip","IconCozFileXlsx","IconCozFileCode","IconCozFileVideo","IconCozFileAudio","getIconByExtension","extension","mimeType","_ICON_MAP_extension","fileIcon","IconCozFileOther","mime","FileIcon","size","file","iconStyle","loadingStyle","hideLoadingIcon","url","status","getFileExtension","FileItemStatus","PREVIEW_IMAGE_TYPE","Image","IconCozFileImage","Icon","IconPlusCircle","useVisible","selected","color","LineColors","LineAddButton","lineType","nodePanelService","WorkflowNodePanelService","dragService","WorkflowCustomDragService","isBezierLine","LineType","mid","containerNode","canDropMessage","getCamelNameName","getValueByType","cacheData","generateDefaultValueByMeta","modelParams","_defaultValue","generationDiversity","_p_default_val","_p_default_val1","_p_name","_v","min","max","ModelSelector","triggerRender","popoverPosition","ModelSelectV2","LazyMdbox","lazy","MdBoxLazy","Divider","SettingLayout","description","center","right","bolder","leftClassName","Suspense","SettingSlider","precision","_step","Slider","InputNumber","ModelSetting","_cacheData_id","settingExpand","setSettingExpand","doms","generationDiversityGroupTitle","_model_model_params_filter","groups","_m_param_class","d","generationDiversityGroup","_generationDiversityGroupTitle","_doms","_setCacheData","g","_g_label","items","label","_optionsList","RadioGroup","_e_target","_e_target1","_e_target2","Radio","IconDownArrow","defaultGenerationDiversity","ModelSelect","_useService_getModels","popoverAutoAdjustOverflow","testName","WorkflowModelsService","getDefaultValue","modelType","_model","modelOptions","useEntityFromContext","setterTestId","PopupContainer","record","j","_value_generationDiversity","_getDefaultValue_generationDiversity","_getDefaultValue_generationDiversity1","_value_responseFormat","Popover","IconCozSetting","NodeContextProvider","scene","setWorkflowNode","updateWorkflowNode","startTransition","dataChangeDisposer","initialDisposer","errorDisposer","FlowNodeErrorData","prevErrorMessage","setPrevErrorMessage","_workflowNode_registry","errorMessage","NodeRenderSceneContext","WorkflowNodeContext","PlaygroundEntityContext","NodeIconOutlined","icon","hideOutline","borderRadius","outlineColor","style","classnames","NodeIcon","nodeEntity","alt","PANEL_WIDTH","THROTTLE_INTERVAL","PAGE_SIZE","LOAD_MORE_PAGE_SIZE","LOAD_MORE_PLACEHOLDER","NodePlaceholder","Placeholder","NodePanelContext","createContext","NodePanelContextProvider","useNodePanelContext","getLoopSelected","_containerNode_getNodeMeta","containerSubCanvas","useTemplateNodeList","loopSelected","WorkflowPlaygroundContext","isSceneFlow","useGetWorkflowMode","isSupportImageflowNodes","useSupportImageflowNodesQuery","getEnabledNodeTypes","formatPluginProduct","productInfoList","_productInfoList_map","_product_meta_info_entity_id","_product_meta_info_name","_product_meta_info_icon_url","_product_meta_info_description","_product_meta_info_icon_url1","_product_plugin_extra_tools_map","pluginName","tool","createApiNodeInfo","useFavoritePluginNodeList","_context_favoritePlugins_has_more","_context_favoritePlugins1","hasMore","setHasMore","pluginNodeList","setPluginNodeList","loadMore","_context_favoritePlugins_favorite_products","_resp_has_more","_resp_favorite_products","pageNum","moreList","_context_favoritePlugins_favorite_products_length","formatWorkflow","workflow_id","plugin_id","createSubWorkflowNodeInfo","formatPlugin","plugin","tool_list","api_name","api_desc","api_id","formatBackendSearchResult","response","_panelData_project_workflow_workflow_list","_panelData_resource_workflow_workflow_list","_panelData_favorite_plugin_plugin_list","_panelData_project_plugin_plugin_list","_panelData_resource_plugin_plugin_list","_panelData_store_plugin_plugin_list","panelData","workflowCategoryData","workflow_list","has_more","next_page_or_cursor","NodePanelSearchType","wf","workflow_list1","has_more1","next_page_or_cursor1","pluginCategoryData","plugin_list","has_more2","next_page_or_cursor2","plugin_list1","has_more3","next_page_or_cursor3","plugin_list2","has_more4","next_page_or_cursor4","plugin_list3","has_more5","next_page_or_cursor5","NodeSearchSectionType","mergeSearchResult","searchType","prevSearchResult","copy","dataType","subItem","_loadMoreData_find_data","moreData","useSearchNode","atomNodeCategoryList","showSearchResult","atomNodeSearchResult","categoryName","nodeList","queryList","isPluginApiNodeTemplate","isPluginCategoryNodeTemplate","isNodeTemplate","isSearching","setIsSearching","backendSearchResult","setBackendSearchResult","debouncedBackendSearch","_keyword","cursor","searchResult","noSearchResult","acc","curr","handleKeywordChange","newKeyword","NodeCategoryPanel","LoadMoreCard","onLoadMore","IconCozLoading","CustomDragCard","_param","nodeJson","nodeDesc","tooltipPosition","nodeTemplate","workflowState","useEntity","WorkflowGlobalStateEntity","isDragging","drag","preview","useDrag","DND_ACCEPT_KEY","isSubWorkflowNodeTemplate","monitor","dragType","computedClassNames","baseContent","NodeCard","onClick","Highlight","SubWorkflowCategoryList","enableDrag","onSelect","onAddingNode","nodeVersionService","useNodeVersionService","handleSelect","versionName","getWorkflowVersionByPluginId","semver","_nodeTemplate_name","_nodeTemplate_icon_url","PluginToolCard","IconCozPluginFill","PluginNodeCard","expand","IconCozCross","IconCozExpand","PluginNode","onExpandChange","icon_url","pluginDesc","tools","renderPluginNode","pluginTool","PluginNodeList","showExploreMore","displayPluginNodeList","len","INIT_PAGE_SIZE","rawPageNum","displayLen","expandPluginIndex","setExpandPluginIndex","pluginToolsDisplayIndex","_displayPluginNodeList_length","pluginTools","_displayPluginNodeList_expandPluginIndex_tools_length","_displayPluginNodeList_expandPluginIndex","_displayPluginNodeList_expandPluginIndex1","handleSelectTool","nodeTemp","IconCozArrowRight","card","toolIndex","_pluginTool_name","PluginCategoryList","AtomCategoryList","SearchResultSection","sectionData","getScrollContainer","stickyHeaderRef","isSticky","setSticky","useLayoutEffect","scrollEl","scrollElTop","updateSticky","el","handleScroll","throttle","renderSection","SearchResultNodeList","showSpinLoading","showMaskLoading","Loading","FavoritePluginNodeList","NodeList","adaptiveHeight","nodeCategoryList","nodeListRef","showBorder","setShowBorder","setInput","_nodeListRef_current_scrollTop","_el_scrollTop","favoritePluginsRef","_favoritePluginsRef_current","Input","IconCozMagnifier","EmptyState","IconCozEmpty","Root","ScrollAreaViewport","ScrollAreaScrollbar","ScrollAreaThumb","ScrollAreaCorner","NodePanel","onSelectAsync","nodeV2Registry","selectEvent","getNodeV2Registry","panelProps","isAddingNodeRef","openPlugin","openWorkflow","openImageflow","updateAddNodePosition","useAddNodeModalContext","templateState","useTemplateService","dependencyEntity","useDependencyEntity","targetHeight","docHeight","topHeight","positionRelToWindow","bottomHeight","handleSelectNode","handlePluginRiskWarning","nodeTitle","categoryInfo","_nodeType","_this","onCloseModal","closeResult","AddNodeModalCloseResult","handleClose","_nodeListRef_current","disposer","previewVisible","isAdding","ConditionTag","LogicDisplay","VariableDisplay","keyPath","facadeService","_workflowVariable_node","_workflowVariable_viewMeta","_workflowVariable_viewMeta1","workflowVariable","valid","WorkflowVariableFacadeService","useAvailableNodeVariables","globalVariableAlias","getGlobalVariableAlias","variableText","ConditionContainer","conditions","condition","specialValueMap","ConditionType","ExpressionDisplay","_value_content","operator","MessageContent","InputParameters","MessageOutput","iconFile","IconCozFolder","iconFileArray","IconCozFolderBracket","VARIABLE_TYPE_ICON_MAP","IconCozString","IconCozNumberInt","IconCozNumber","IconCozBoolean","IconCozBrace","IconCozImage","IconCozClock","IconCozSound","IconCozStringBracket","IconCozNumberIntBracket","IconCozNumberBracket","IconCozBooleanBracket","IconCozBraceBracket","IconCozImageBracket","IconCozClockBracket","DatabaseConditionRightComponent","rightTextMap","DatabaseConditionOperatorComponent","ConditionOperatorMap","DatabaseConditionLeftComponent","DatabaseCondition","conditionList","useConditions","conditionFieldName","Field","FieldEmpty","fieldName","labelClassName","customEmptyLabel","Operator","operatorMap","IconCozEqual","IconCozEqualSlash","IconCozGreater","IconCozGreaterEqual","IconCozLess","IconCozLessEqual","IconCozProperSuperset","IconCozProperSupersetSlash","ConditionBranch","branch","_condition_left_content","Conditions","Port","calcPortId","Model","_data_model","modelName","setModelName","useWorkflowModels","CozAvatar","Intents","intents","intent","AnswerItem","Knowledge","_data_inputs_datasetParameters_datasetParam","knowledge","dataSets","useDataSetInfos","OverflowTagList","IS_BOT_OP","convertNumberToLetters","QuestionPairs","_questionParams_options","_questionParams_question","questionParams","isOptions","AnswerType","isDynamic","OptionType","dynamicOption","dynamicOptionTag","useInputParametersVariableTags","LabelWithTooltip","VariableTagList","globalVariableIconMap","GlobalVariableKey","IconCozPeople","UrlField","apiUrl","isTooltips","setTipsVisible","allVariables","useAvailableWorkflowVariables","wrapperRef","isHeightOver","setHeightOver","getVariableByKeyPath","useGetWorkflowVariableByKeyPath","getNodeInfoInVariableMeta","useNodeServiceAndRefreshForTitleChange","urlVariables","splitedUrl","useHttpUrlVariables","urlExpressionString","availableVariables","setUrlVariables","setSplitedUrl","doubleBracedPattern","apiUrlRef","variableRef","match","isUrlChange","isVariableChange","isEqual","matches","urlPieces","lastIndex","globalVariableKey","nodeName","fieldPart","fieldKeyPath","parsedKeyPath","getVariableInfoFromExpression","matchedVariable","variableInfo","findInputVariable","endIndex","useVariableWithNodeInfo","observer","ResizeObserver","_wrapperRef_current_clientHeight","innerHeight","urlPart","curVariableInfo","IconCozWarningCircleFillPalette","UrlContainer","isTipsVisible","isHover","setHover","wrapperId","_document_getElementById","HttpApiField","_data_inputs","_data_inputs_apiInfo","apiInfo","PublicScopeProvider","DatabaseSettingFields","database","useCurrentDatabaseQuery","variableTagList","getVariableTagList","fields","settingField","field","getVariableTagProps","_settingField_fieldValue","VariableTagStatus","useValue","variableTags","customClassName","maxWidth","textRef","isOverflowing","setIsOverflowing","_textRef_current","textWidth","outputContent","Outputs","useOutputsVariableTags","refresh","useRefresh","outputVariablesData","WorkflowNodeOutputVariablesData","output","_outputVariablesData_getVariableByKey","TAG_ITEM_IDENTIFIER_CLASS","defaultTagItemRenderer","tag","enableTooltip","tagItemRenderer","dropdownClassName","disableMore","renderTags","tooltip","tagItemContent","tagItem","tagListRef","showOverlay","setShowOverlay","_tagListRef_current_clientWidth","listWidth","lastTag","Dropdown","IconCozMore","showLabel","TerminatePlan","_defaultTerminalPlanOptions_find","terminatePlan","checkInvalid","inputDef","_input_content_keyPath","invalid","_registry_meta1","_input_rawMeta","_input_rawMeta1","_input_content","_input_rawMeta2","_input_content1","variable1","_detail_inputsDefinition","_inputDef_schema","_inputDef_schema1","detail","_detail_inputs","_inputDef_schema2","_inputDef_schema3","nodeData1","detail1","inputDef1","isUserInputStartParams","maxTagWidth","formattedValue","IconCozWarningCircle","VARIABLE_TYPE_ALIAS_MAP","useVariableService","Skeleton","containerName","containerStyle","_nanoid","_children","useNodeOrigin","isApi","isApiNode","isReference","isSubWorkflowNode","isFromProject","apiData","isFromStore","isFromCozeCnStore","PluginFrom","isFromLibrary","ReferenceNodeOrigin","IconCozStore","IconCozTray","checkUpdateVersionModel","resolve","BaseVersionInfo","css","OutDatedVersionInfo","onUpdate","IconCozWarningCircleFill","VersionInfo","latestVersionName","latestVersionTs","isOutdated","handleUpdateVersion","SubWorkflowVersion","_nodeData_latestVersion","myVersion","getMySubWorkflowNodeVersion","getSubWorkflowNode","latestVersion","setLatestVersion","dependencyService","useDependencyService","_curNodeData_latestVersion","curNodeData","hasVersion","ApiVersion","myVersionTs","getMyApiNodeVersion","myVersionName","getApiNodeVersion","ReferenceNodeVersion","ApiSkillVersion","versionTs","originLatestVersionTs","toString","handleUpdate","SubWorkflowSkillVersion","useSort","onDragStart","onDragMove","onDragEnd","useUpdateEffect","_data_index","draggingId","setDraggingId","dragItemType","prevData","update","SortableItem","dragRef","drop","useDrop","dragIndex","getEmptyImage","CustomDragLayer","previewRender","layerRef","playgroundScale","itemType","initialOffset","currentOffset","useDragLayer","getItemStyles","layerOffset","x","y","transform","SortableList","renderItem","dragOption","DragHandle","IconHandle","TagList","expanded","setExpanded","showMoreCount","tagsNeedShow","restTags","idx","UITag","IconChevronDown","OptionItem","cls","EmptyVariableContent","useGlobalVariableServiceState","isSelectedBotOrProject","VariablePanel","onVariableSelect","variableValue","variablePanelStyle","variablesFormatter","globalVariables","useRelatedVariable","useNodeAvailableVariablesWithNode","checked","avatar","useHover","IconCozCheckMarkFill","EmptyContent","renderCustomOption","checkedValue","Panel","relatedEntities","relatedEntityValue","isLoadMore","onRelatedSelect","relatedBotPanelStyle","globalVariableService","GlobalVariableService","formatRelatedBotValue","BotProjectVariableSelect","relatedEntityValueFromProps","customVariablePanel","selectRef","getRelatedEntityValue","timeoutRef","showBotPanel","setShowBotPanel","onRelatedEntitiesSearch","loadMoreRelatedEntities","useRelated","baseRelatedEntities","setBaseRelatedEntities","nextCursorId","setNextCursorId","setIsLoadMore","personalSpaceId","querySpaceId","defaultBotData","useQueryBotList","fetchCallback","fetchBotData","handleFocus","handleBlur","_selectRef_current","_selectRef_current1","_getRelatedEntityValue","RelatedBotPanel","setOptions","queryNeedBot","useNeedBot","getNode","useGetStartNode","testFormType","TestFormType","initOptions","hasLTMNode","hasConversationNode","needDisableBot","BaseSelect","TestRunDataSource","FieldName","NODE_FIELD_TEMPLATE","SETTING_FIELD_TEMPLATE","BATCH_FIELD_TEMPLATE","INPUT_FIELD_TEMPLATE","getConversationTemplate","chatFlowService","_chatFlowService_selectItem","conversationDefaultVisible","getBotFieldTemplate","isNeedBotEnv","showBot","validateValue","ltmEnabled","timeCapsuleMode","TimeCapsuleMode","DATASETS_FIELD_TEMPLATE","COMMON_FIELD","FILE_TYPE_FIELD_MAP","FILE_TYPES","multiple","getAccept","genFileTypeByViewVarType","NOT_FILE_TYPE_FIELD_MAP","TYPE_FIELD_MAP","TESTSET_CONNECTOR_ID","START_NODE_ID","CostPopover","popoverProps","_containerRef_current","Row","Col","TestRunCostPopover","tokenAndCost","useCancelTestRun","runService","WorkflowRunService","mutate","isPending","useMutation","cancelTestRun","testRunFormNodes","useGetStartNodeOutputs","getStartNodeOutputs","_startNode_getNodeMeta_outputsPath","_formModel_getValueIn","formModel","getEnableChatHistory","workflowJson","isIntentNode","useWorkflowOperation","isChatflow","isNeedBot","typeList","_nodeTypes_node_types","_nodeTypes_sub_workflow_node_types","_nodeTypes_nodes_properties","_nodeTypes_sub_workflow_nodes_properties","nodeTypes","flowTypeList","subFlowTypeList","sumTypeList","sumPropsList","hasVariableNode","hasVariableAssignNode","hasDatabaseNode","hasIntentNode","hasLLMNode","intersection","CONVERSATION_NODES","hasMessageNode","MESSAGE_NODES","hasConversationHistoryNode","CONVERSATION_HISTORY_NODES","propsEnableChatHistory","hasNodeUseGlobalVariable","hasChatHistoryEnabledLLM","hasSubFlowNode","needBot","needConversation","nodeIsChatflow","subWorkflowDetail","isConversationNameRef","conversationNameItem","CONVERSATION_NAME","_conversationNameItem_input","isSubworkflow","checkLLMEnableHistory","ignoreRehajeExpressionString","generateCacheValues2InitialValue","force","originType","initialValue","isUndefined","formatObjectValue","generateHistoryValues2InitialValue","historyValuesStr","_nodeField_children","_inputField_children","stringifyDefaultValue","typeSafeJSONParse","nodeField","inputField","generateCaseData2InitialValue","caseData","generateRelatedBot2InitialValue","botField","useTestFormInitialValueV2","testFormService","useTestFormService","useTestRunReporterService","relatedCaseDataService","RelatedCaseDataService","isHitGlobalCachedFg","generateInitialValues","_schema_fields","invert","defaultCaseData","NodeHistoryScene","_defaultCaseData_FieldName_Node","defaultCaseData1","useNeedSceneBot","sceneFlowHost","useGetSceneFlowBot","generateField","_commonField_decorator","required","commonValidator","commonField","decorator","_TYPE_FIELD_MAP_type","typeValidator","component","typeField","startNodeOldType2VariableType","generateObjectInputParameters","generateArrayInputParameters","generateObjectInputParametersRequired","requiredRule","_requiredRule","inputFields","_i_input","isStaticObjectRef","_i_input1","_i_input2","sortedInputFields","viewVariable","dtoMeta1","jsonSchema1","fieldItem","variableInitialValue","generateExpressionString","expressionStr","labelPrefix","namePrefix","matchesContent","varStr","formFields","nodeNameWithDot","md5","_data_input_content","_workflowVariable_viewType","generateUpdateTriggerFields","_formData_inputs","_formData_inputs_dynamicInputs","_formData_inputs2","labelMap","configFields","cronjobFields","crontab","_i_name","parameterKey","generateImageflowGenerateTestFormFields","references","referencesToArrayInputParameters","_references_filter","preprocessor","_generateDatabaseCreateTestRunFormFields","getDatabaseID","queryDatabase","convertFieldInfoToParams","_generateDatabaseUpdateTestRunFormFields","_formData_inputs_updateParam_fieldInfo","_formData_inputs_updateParam_condition_conditionList","convertConditionListToParams","generateDatabaseDeleteTestRunFormFields","_formData_inputs_deleteParam_condition_conditionList","generateDatabaseQueryTestRunFormFields","_formData_inputs_selectParam_condition_conditionList","_formData_inputs_databaseInfoList_","fieldInfo","_database_database_info_field_list","databaseField","left","useGetSceneFlowRoleListSchema","roleList","useGetSceneFlowRoleList","reg","rule","_context_indexes","parentValue","currentIndex","useGenerateTestFormFieldsMap","getSceneFlowRoleListSchema","isPresetStartParams","inputParameter","_formData_$$input_decorator$$_inputParameters","_e_left_content_keyPath","_formData_inputs1","inputDefs","_isChatflow","inputData","anwserType","optionType","urlFormFields","_formData_inputs_apiInfo","paramsFormFields","headersFormFields","authFormFields","_formData_inputs_auth","_formData_inputs_body","_formData_inputs_auth1","authType","authDataPathMap","AuthType","pathStr","bodyFormFields","bodyType","bodyDataPathMap","BodyType","dataPath","prefixName","_formData_$$input_decorator$$","roleListSchema","_formData_set","_formData_get","generateDatabaseCreateTestRunFormFields","generateDatabaseUpdateTestRunFormFields","_","_node_getNodeMeta","batchModePath","batchData","_i_decorator","_i_decorator_props","generateTestsetField","testSetIsTitle","testsetField","pattern","isPass","debuggerApi","ComponentType","TestSetIsTitle","onCreate","useTestFormSchema","canTestset","generateTestFormFieldsMap","bizCtx","useTestsetBizCtx","needSceneBot","sceneBotSchema","generate","current","startNodeEntity","reporterKey","_formData_nodeMeta","_formData_nodeMeta1","batchFields","settingFields","generateFn","isSubflow","subflowIsChatflow","botDisableOptions","_botTemplate_children","botTemplate","_v_currentTarget","_fields_","conversationTemplate","useTestRunFlowV2","floatLayoutService","useFloatLayoutService","saveService","useSaveService","useValidateWorkflow","validateFlow","testRunFlow","LayoutPanelKey","useTestRunFlow","variableScopeType","closeBizIDE","useBizIDEState","lineService","useLineService","execEntity","useExecStateEntity","validationService","WorkflowValidationService","useTestRunStatus","backendValidate","nodeErrorMap","errorMap","_item_node_error","_item_path_error","_item_path_error1","_item_path_error2","ValidateErrorType","handleNodeError","nodeError","activeId","closeSideSheet","useInnerSideSheetStoreShallow","_testFormSchema_fields","feErrorMap","backendError","beErrorMap","testFormSchema","testRunFlowV2","testFormState","WorkflowTestFormStateEntity","saving","saveLoading","viewStatus","frozen","isMineRunning","running","WorkflowExecStatus","spaceID","userInfo","userStoreService","userID","ImgLogV2","testRunResult","images","downloadImages","useImages","setImages","useDownloadImages","_parseImages","NodeExeStatus","outputsValue","log","parseImagesFromOutputData","parseImages","LogImages","useCurrentNode","downloadImage","imageSrc","_downloadImage","image","fetch","imageBlog","imageURL","URL","link","useTestRunResult","execState","useFileDragging","fileDragging","setFileDragging","useMutationObserver","mutationsList","mutation","_mutation_target_className","_mutation_target","_mutation_target_className1","_mutation_target1","genAcceptTips","accept","CustomUploadNode","fileType","fileList","setFileList","IconCozUpload","MAX_IMAGE_SIZE","MAX_FILE_SIZE","CustomOperation","IconCozTrashCan","CustomFileItem","hover","TEST_RUN_FILE_NAME_KEY","getFormatFileUrl","curFile","_curFile_name","originUrl","fileName","urlObj","getParsedFileInfo","formatUrl","_params_get","err","getInitialValue","multipleVal","FileBaseAdapter","validateStatus","focusRef","wrapperSize","useSize","maxFileCount","upload","isUploading","deleteFile","useUpload","handleUpload","fileInstance","getSubmitValue","usePersistCallback","newVal","fileUrlList","semiFileList","formatBytes","ClickAwayListener","Upload","uid","fileItem","currentFile","currentFileItem","renderProps","FileInputType","URLInput","inputURLClassName","valueRef","JsonEditorAdapter","FileInputTypeSelect","TypedFileInput","fileInputType","onInputTypeChange","setType","newType","getGlobalSchemas","monaco","setJsonSchema","uri","schemas","clearJsonSchema","disposedSchema","editorRef","triggerFormat","_editorRef_current","listenerRef","disposeListener","listener","handleDidMount","editor","_editor_getModel","blurListener","focusListener","isJsonVerified","rs","UIButton","IconCozRefresh","formatJSON","formatedValue","IconCozBroom","MonacoEditor","lightStyles","JsonEditorSemi","withField","cacheTriggerId","getTriggerId","wfId","TriggerTestRunButton","_props_triggerId","useTestFormState","useWorkflowRunService","testRunReporterService","executeId","canceling","setCanceling","innerTriggerId","setInnerTriggerId","canCancel","handleTestRun","next","handleCancelTestRun","IconCozStopCircle","IconCozPlayCircle","TestRunSingleNodeButton","_node_getNodeRegistry_meta","useValidationService","isNodeSideSheet","useNodeRenderScene","playgroundProps","handleOpenTestFormV2","IconCozPlayFill","StartTestRunButton","BaseTestButton","hasRef","vos","vo","_vo_input","stringifyValue","stringifyKeys","buf","TemplateCompZIndex","WorkflowRefreshModal","_workflowState_getProjectApi","WorkflowOuterSideSheetHolder","WORKFLOW_OUTER_SIDE_SHEET_HOLDER","ReferencingList","_workflowList_slice","workflowList","IconClose","getWorkflowHeaderTestId","List","MAX_RECENT_WORKFLOWS","_workflow_workflow_id","_workflow_workflow_id1","_workflow_space_id","referencesUrl","getWorkflowUrl","WorkflowReferencesTip","_references_workflowList","setVisible","useWorkflowReferences","toggleVisible","closePopover","IconSmallTriangleDown","useNodeErrorList","nodeErrors","nodeErrorList","warnings","results","useLineErrorList","lineErrorList","useHasError","withWarning","hasLineError","hasNodeError","systemError","commonClassNames","ExecuteState","hiddenStateText","extra","executeStatus","workflowExeCost","hasNodeResult","isCanceled","useTestRun","WorkflowExeStatus","COLOR_STYLE_MAP","ExecuteStatus","statusText","IconWorkflowRunSuccess","IconWorkflowRunFail","StatusIcon","_tokenAndCost_totalTokens","TokenCost","PublishStatus","vcsData","autoSaveTime","VCSCanvasType","IconCozCheckMarkCircleFillPalette","EditModal","createWorkflowModalVisible","openCreateWorkflowModal","closeCreateWorkflowModal","useBoolean","getLatestWorkflowJson","useLatestWorkflowJson","IconCozEdit","WorkflowInfo","isCollaboratorMode","hasChanged","isViewHistory","savingError","isPublished","useIsPublishDisabled","isExecuting","isVcsMode","TooltipWithDisabled","BasePublishButton","setStep","onPublish","publishing","VersionForm","onSubmit","onCancel","forcePushVisible","onTestRun","onForcePublish","onForceCancel","formApiRef","currentSelectCase","workflowVersion","trySaveDefaultCase","handleSubmit","handleForcePublish","Form","PublishWithVersionV2","step","tryPushCheck","onForcePushCancel","useForcePush","handlePublish","obj","PublishWithForce","ForcePushPopover","PublishWithVersion","PublishWithDiff","isInIDE","publishUpdateReferencedConfirm","usePublishReferenceConfirm","publishDataRef","passPublish","useMemoizedFn","diffConfirm","diffConfirmModal","useDiffConfirm","usePublishEnv","isDevSpace","canPublishEnv","neverPublished","onPublishEnv","PublishWithEnv","disabledPublishEnv","SplitButtonGroup","PublishButton","published","IconCozArrowLeft","DuplicateButton","ADD_NODE_BUTTON_ID","useGetPanelPosition","targetBoundingRect","getNodesCenter","allBounds","FlowNodeTransformData","Rectangle","useFocusNode","editService","WorkflowEditService","useAddSubCanvasNode","getPanelPosition","focusNode","panelPosition","_register_meta","childrenLength","containerCenter","register","centerPosition","adjustedPosition","useAddNormalNode","selectPosition","nodePanelOffset","customPositionX","nodeWidth","customNodePosition","getAntiOverlapPosition","getNodeLinage","linage","currentNode","getContainerNode","selectedNode","selectedNodeType","linageSubCanvas","useAddNode","addSubCanvasNode","addNormalNode","MINIMAP_VISIBLE_KEY","getMinimapStorageVisible","_localStorage_getItem","setMinimapStorageVisible","localStorage","useMinimapVisible","minimapVisible","setMinimapStateVisible","setMinimapVisible","useToolbarHandlers","playgroundTools","usePlaygroundTools","addNode","useAutoLayout","autoLayoutShortcut","WorkflowLayoutShortcutsContribution","EmptyRoleAvatar","img","RoleAvatar","ONBOARDING_KEY","OnBoardingPopoverContent","onOk","OnBoardingPopover","localVisible","setLocalVisible","localStorageService","RoleButton","_data_avatar","roleService","useRoleService","isInitWorkflow","isReady","useRoleServiceStore","onBoardingVisible","setOnBoardingVisible","isInitRef","roleName","roleAvatar","handlePanelClose","formValue2Data","_values_display_all_suggestions","_temp_voices_textToVoice","temp","SuggestReplyInfoMode","InputMode","nextAvatar","data2FormValue","_data_onboarding_info_display_all_suggestions","background","voice","formatVoicesObj2Arr","lang","RoleVoices","innerValue","setInnerValue","MultimediaApi","_i_data","VoicePlayer","isPlaying","togglePlayPause","useAudioPlayer","IconCozPauseFill","IconCozVolume","useVoiceOptions","_data_list","language","voiceType","space_id","searchParams","useSearchParams","loadingMore","useInfiniteScroll","currentData","_res_data_voice_list","_res_data2","VoiceScene","LoadMoreTrigger","divRef","isInView","useInViewport","voiceTabs","VoiceDataSelect","setVoiceType","selectedOption","_selectedOption_name","SegmentTab","VoiceLanguageSelect","languageOptions","disabledLanguages","optionList","VoiceSelect","useLanguageOptions","useRequest","_res_language_list_map","_item_language_code","_item_language_name","getLanguages","AddVoicesForm","handleLanguageChange","handleDelete","canAdd","IconCozPlus","cur","AddVoices","useField","voiceConfig","isEdit","TextToVoice","Switch","RoleSuggestion","_value_suggest_reply_mode","mode","prompt","isCustom","Checkbox","TextArea","RoleSuggestionSwitch","SuggestionItem","isLast","draggable","deletable","IconCozHandle","IconCozMinusCircle","SuggestionList","handleContentChange","opt","DisplayAllSwitch","_form_getValuesIn","form","useForm","SugLayoutLimit","SugLayoutFull","PROLOGUE_KEY","QUESTION_KEY","formatContent","str","parts","prologue","questions","part","questionLines","q","generating","setGenerating","CopilotType","AIButton","RoleNameInput","nextValue","RoleDefaultInput","tooltipImg","checkImageWidthAndHeight","reject","fileReader","FileReader","_event_target","getPictureValue","_value_web_background_image_origin_image_url","_value_web_background_image_origin_image_uri","getModeInfo","MODE_CONFIG","computePosition","cropperRef","_cropperRef_current","cropperObj","cropperWidth","canvasData","imgData","imgToScreenLeft","imgToScreenRight","floor","canvasPosition","getImageThemeColor","colorThief","ColorThief","thiefColor","c","computeThemeColor","cropperRefList","promises","cropperEle","resolveColor","rejectColor","_cropperEle_current","_cropperObj_getCroppedCanvas","corp","colors","useUploadImage","onUploadError","onUploadSuccess","handleError","upLoadFile","useSubmitCroppedImage","cropperWebRef","cropperMobileRef","onSuccess","currentOriginImage","handleCancel","getBackgroundInfoItem","originImageInfo","themeColorList","handleUploadAllSuccess","croppedImage","File","checkHasFileOnDrag","_e_dataTransfer","useDragImage","timer","isDragIn","setIsDragIn","clearTimer","onDragEnter","onDragOver","UploadModalFooter","onReUpload","BaseDragUploadContent","onUpload","FullDragUploadContent","DragUploadContent","dragIn","setDragIn","useCropperImg","_backgroundInfo_theme_color","backgroundInfo","gradientPosition","setGradientPosition","themeColor","setThemeColor","currentUrl","centerWidth","handleGradientPosition","handleDragLimit","_cropperRef_current1","_cropperRef_current2","_cropperRef_current3","scaleTop","scaleLeft","ceil","maxRightOffset","maxLeftOffset","cropEnd","handleThemeColor","handleReady","handleCrop","onZoom","_cropperRef_current_cropper_getCanvasData","naturalWidth","naturalHeight","Config","BubbleContent","bg","rounded","AvaterContent","CropperCover","hasUrl","IconSpin","notHasBackground","CropperImg","currentBackgroundInfo","debouncedZoom","WithRuleImgBackground","Cropper","BackgroundModal","pictureValue","setPictureValue","uploaderRef","createRef","customRequest","onError","clearAllSideEffect","_item_current_cropper","_uploaderRef_current","RoleBackground","_value_web_background_image","AddBackground","beforeUploadCustom","afterUploadCustom","fileBizType","base64","ReportEventNames","DeveloperApi","RoleAvatarUpload","generateInfo","generateTooltip","maxCandidateCount","uploadRef","showAiAvatar","setShowAiAvatar","customUploadRequest","FileBizType","RoleConfigForm","initialValues","LazyFormCore","useWorkflowTemplateList","workflowTemplateList","setWorkflowList","getWorkflowProductList","_workflowProductList_data_workflow_list","FloatPanel","panel","nodeRef","dispose","FloatLayout","components","PanelWrap","layout","ConfigPanelHeader","RoleConfigPanel","Zoom","setSelected","zoom","zoomValue","zoomOptionStyle","MinimapSwitch","handlers","IconCozRectangleMap","Interactive","interactiveType","setInteractiveType","getPreferInteractiveType","showInteractivePanel","setShowInteractivePanel","mousePadTooltip","InteractiveType","preferInteractiveType","GuidingPopover","MousePadSelector","setPreferInteractiveType","Comment","calcNodePosition","mouseEvent","mousePosition","containerTransform","createComment","_selectService_activatedNode","IconCozComment","AutoLayout","runAutoLayout","autoLayout","IconCozAutoLayout","AddNode","toolbarRef","addNodePanelVisibleRef","handleAddNode","_toolbarRef_current","toolbarRect","debounceAddNode","Tools","enableAddNode","Minimap","minimapService","FlowMinimapService","MinimapRender","ToolbarContainer","disableTraceAndTestRun","useResultSideSheetVisible","resultSideSheetVisible","resultSideSheetLoading","canTestRunHistory","handleOpen","useSingletonInnerSideSheet","resultVisible","exeHistoryStatus","openSideSheet","openSideSheetAndShowResult","showResult","processResp","subExecuteId","hasLastResult","WorkflowExeHistoryStatus","opened","closed","closeSideSheetAndHideResult","getProcess","TemplateSlideButton","onTemplateScorll","templateVisible","slidable","direction","IconComp","TemplatePreviewInner","workflowComp","initWorkflow","useWorkflowPlayground","TemplatePreview","previewInfo","templateService","TemplateCard","_workflowTemplate_url","_workflowTemplate_name","_workflowTemplate_desc","workflowTemplate","cardIndex","isDragActive","isMove","cardRef","WorkflowSaveService","handleClick","schemaJson","_res_data_workflow","_workflowTemplate_space_id","TemplateCardList","isCardsOver","setDragActive","startX","setStartX","setMove","isMouseMode","handleMouseUp","handleCardBlur","handleCardFouce","templateInfo","curRef","walk","TemplatePanel","_scrollRef_current","_templateState_templateList","_templateState_templateList1","isLeftSlidable","setLeftSlidable","isRightSlidable","setRightSlidable","scrollRef","scrollAction","handleClickSlide","_scrollContainer_scrollLeft","scrollContainer","currentScrollLeft","newScrollLeft","checkScrollability","scrollElement","resizeObserver","useRetrieve","draft_commit_id","submit_commit_id","needMerge","setNeedMerge","cancelReq","author","axios","canceler","need_merge","latest_submit_author","mergeConfirm","useMergeConfirm","handleRetrieve","showRetrieve","Banner","useScrollToError","useScrollToNode","scrollToLine","useScrollToLine","errorType","targetNodeId","ProblemPanel","layoutHeight","useFloatLayoutSize","scrollToError","problem","handleJump","isInProject","projectApi","useWatchValidateWorkflow","ProblemPanelCore","PANEL_PADDING","ModifyBanner","DragTooltip","allowDrop","_monitor_getSourceClientOffset","canDrop","tooltipRef","offset","_tooltipRef_current_clientWidth","_tooltipRef_current_clientHeight","top","IconCozInfoCircleFillPalette","Title","MessageForm","initValues","formRef","renderNickNameLabel","nickName","ArrayField","arrayFields","remove","IconPlay","ChatTestRunPauseSideSheet","_typeSafeJSONParse","_sceneChatNodeEvent_node_icon","exeState","testrunService","sceneChatNodeEvent","EventType","handleMessageFormSubmit","_sceneChatNodeEvent_id","SideSheet","useGotoNode","isProjectWorkflow","gotoLibrary","goto","inProject","TraceListPanel","gotoNode","TraceListPanelNext","span","TraceDetailPanel","TraceDetailPanelNext","useChatflowInfo","sessionInfo","setSessionInfo","conversationInfo","setConversationInfo","conversationDisposable","getConstraintWidth","useSidePanelWidth","storeWidth","useResizableSidePanelStore","layoutWidth","maxLayoutWidth","ResizableSidePanel","bypass","resizable","useResizable","setStoreWidth","initWidth","handleResizeStart","_event","_direction","_elementRef","handleResize","delta","handleResizeStop","Resizable","visitNodeLeaf","properties","groupField","generateJsonSchemaFileValue","generateJsonSchemaVoiceValue","getJsonModeFieldDefaultValue","safeJsonParse","toNumber","generateValidateJsonSchemaField","_field_xcomponentprops","getValidateJsonSchema","groupTemp","toJsonModeSchema","origin","_origin_properties","TestFormFieldName","nodeProperties","validateJsonSchema","generateFieldValidator","setDefaultValues","defaultValues","getFileInfo","uploading","getFormSchemaFileUrl","fileInfo","getFormSchemaVoiceId","generateJsonSchemaToFormValue","formatValues","_formValues_TestFormFieldName_Node","_originFormSchema_properties","originFormSchema","formValues","jsonValues","formatJsonValues","_jsonValues_groupKey","groupValues","mergeFormValues","prevValues","nextValues","ai","cover","preFormattedValues","finialValues","getValue","parentKey","toJsonValues","_schema_properties_TestFormFieldName_Node","jsonValue","formatJsonValue","nodeFieldProperties","variableType2TestsetType","FormItemSchemaType","genDefaultCaseName","dayjs","checkName","count","caseName","check","trySaveTestset","_schema_properties_TestFormFieldName_Node_properties_TestFormFieldName_Input","bot","inputProperties","TESTSET_BOT_NAME","failReason","failCode","renderDom","Comp","dom","root","createRoot","useVoiceSource","setVoice","_data_data_voices","_data_data_voices1","VoiceDisPlay","voiceId","VoiceWidget","WidgetType","view","EditorSelection","_this_root","TEST_RUN_FILE_UPLOADING_KEY","generateFileInfo","generateUrlWithFilename","FileDisplay","_file_name","isImage","isImageFile","FileWidget","UploadButton","changeEditor","insert","getFrom","fullText","loadingFlag","validateMsg","fileFlag","from1","from2","openUpload","_ref_current","VoiceButton","openSelectVoiceModal","selectVoiceModal","useSelectVoiceModal","generateHoverMap","GROUP_MAP","_field_xdecoratorprops","KeyHoverPopover","getExtensions","jsonHover","jsonUnnecessaryProperties","regexpDecorator","add","Decoration","jsonEmptyStringValueCompletion","ModeSwitch","patch","useTestRunFormStore","Conversations","enableTypes","propsProjectId","staticList","setStaticList","dynamicList","setDynamicList","fetchingProjectId","setFetchingProjectId","initFn","fetchList","_outputs_find","_list_","defaultName","_chatflowService_selectConversationItem","_staticListRes_data","_dynamicListRes_data","staticRes","dynamicRes","CreateMethod","CreateEnv","ConversationSelect","ConversationSelectWithField","Variables","tagList","useVariables","botID","useTableInfo","tableInfo","_bot_field_list","BotTableRWMode","_bot_field_list1","useProjectVariables","projectID","useLTMInfo","getMessageList","botCount","totalRound","round","conversationId","sectionId","messageList","Scene","useChatHistory","_transformBotInfo_model_short_memory_policy_history_round","isBotInfoLoading","isMessageLoading","TableInfo","columns","text","fieldList","Table","Item","defaultText","hideLabel","showDefaultText","ChatHistory","JsonViewer","BotProjectSelect","originValue","hideVariblesForce","valueId","isTableInfoLoading","isVariablesLoading","projectVariables","isProjectVariablesLoading","chatHistory","isLTMInfoLoading","botSelected","hasVariables","hasTableInfo","hasProjectVariables","hasChatHistory","showTableInfo","showVariables","showLTMInfo","showProjectVariables","sourceBotId","BotProjectSelectWithField","useModeFormSchema","schemaWithMode","setSchemaWithMode","getSchema","store","getDefaultValues","useFormDefaultValues","generateFormSchema","ModeFormKit","generateMode","originSchema","innerSchema","cacheValues","WorkflowContentChangeType","useModeFormEvent","onMounted","onFormValuesChange","TestRunFormModel","_this_modeSchema","NodeFieldCollapse","useFormSchema","FormBaseGroupCollapse","RelatedFieldCollapse","isNeedConversation","useCurrentFieldState","botErrors","conversationErrors","globalProjectId","conversationValue","isConversationVisible","FormBaseFieldItem","OriginTypedFileInput","JsonModeInput","extensionsRef","FormBaseInputJson","TestsetSave","openEditPanel","useTestsetManageStore","TestsetSelect","InnerTestsetSelect","InnerTestForm","events","isFormSchemaPropertyEmpty","InputFormEmpty","TestRunForm","TestFormV3","TestRunFormProvider","QuestionForm","nodeQuestionEvent","QuestionFormCore","InputForm","nodeInputEvent","InputFormCore","LogEndView","onMount","useLogView","logNodeRef","inputRef","statusRef","inputInViewport","scroll","useScroll","updateRunStatus","endViewRect","_logNodeRef_current","_inputRef_current","_logNodeRef_current1","logNodeRect","inputRect","scrollHeight","BotProjectSelectTestset","TestsetBotProjectSelect","RunningPanel","ResultLog","useOpenWorkflow","LogDetail","TestFormSheetHeaderV2","useOpenTraceListPanel","handleOpenTraceBottomSheet","TestRunFlowButton","TestRunNodeButton","TestFormSheetFooterV2","TestFormSheetV2","_getNode","logView","testRunFlowV3","_execEntity_getEndNodeResult","related","testsetSave","_values_TestFormFieldName_Node","empty","formValidate","checkMsg","useProject","currentNodeStatus","TestsetManageProvider","PremiumPaywallBanner","PremiumPaywallBannerScene","TestsetEditPanel","StartTestFormSheet","FormPanelLayout","TestFormHeader","useSkeleton","LazyBuilderChat","BuilderChat","workflowInfo","projectOrBotInfo","activateChat","showInputArea","onGetChatFlowExecuteId","topSlot","renderLoading","chatUserInfo","IconCozIllusAdd","conversationName","projectInfo","createChatFlowTestFormStore","createWithEqualityFn","shallow","chatFlowTestFormContext","useChatFlowTestFormStore","selector","ChatFlowTestFormProvider","TestFormFloatButton","isChatError","hasForm","IconCozAdjust","ConversationSelectTestset","ChatFlowTestForm","panelRef","testRunChatFlowV3","_panelRef_current","_values_FieldName_Node","ResizablePanel","myProjectId","setValue","OnlyConversationSelect","ChatFlowTestRunHistory","_formData_FieldName_Node","restProps","USER_INPUT","ChatflowFormPanel","init","ChatFlowTestFormPanel","_getProjectApi","getProjectApi","_store_projectInfo","useShowResultNotice","testNodeFormVisible","hasResult","TestNodeResultNotice","transition","setTransition","TestNodeFormCore","testRunNodeV3","_panelRef_current1","setting","_values_FieldName_Node1","_values_FieldName_Node2","_related_FieldName_Bot","TestNodeForm","TestRunState","NodeFormPanelProvider","fullscreenPanel","setFullscreenPanel","NodeFormPanelContext","NodeSideSheetPanel","NodeSideSheet","_node_id","showTestNodeForm","showTestRunResultNotice","useNodeFormPanelState","sideWidth","leftFullWidth","initialized","concatNodeTestId","NodeRender","NodeFormPanel","useCloseNodeFormWhenBlur","useCancelTestRunWhenClosePanel","tryCancelTestRun","WorkflowFloatLayout","workflowSaveService","loggerService","_workflowState_info","playgroundContent","resetToCommitById","useCommitAction","loadingError","addNodeRef","hasFitView","isNodesMount","useNodesMount","isMounted","setMounted","LoggerService","LoggerEvent","spaceList","inPluginUpdated","isBotUserInputUpdated","isBotUserInputChanged","_schema_nodes","_startNode_data","botUserInput","startOutputs","_addNodeRef_current","_monitor_getClientOffset","coord","executeIdOrResp","commitId","optType","resourceProps","callback","Sidebar","showTemplatePreview","WorkflowHeader","RetrieveBanner","AddNodeModalProvider","WORKFLOW_PLAYGROUND_CONTENT_ID","PlaygroundReactRenderer","Toolbar","WorkflowInnerSideSheetHolder","Helmet","ForcePushPopoverContent","mainButtonText","onOpenTestRun","onForcePush","needTestRun","_info_vcsData","WorkFlowStatus","WorkFlowDevStatus","revertConfirm","showCurrent","resetToCommit","_resp_data_version_list","viewCommit","publishPPE","viewCommitNewPage","targetUrl","isFromExplore","showSpaceModal","setShowSpaceModal","useShallow","getCopyUrl","_spaceID","handleCopy","openNewWindow","handleDuplicate","IconCopyStroked","SelectSpaceModal","navigateResource","DependencyOrigin","NodeType","LinkNode","extraInfo","isStorePlugin","storePluginId","usePluginDetail","IconCozLongArrowTopRight","TooltipContent","ChangeType","DiffItems","Retained","CHANGE_TYPE_TAG_STYLES","MERGE_KEY_MAP","DIFF_ITEM_NAMES","DIFF_ITEM_MODIFY_MSG","ReferenceTable","num","PublishConfirmContent","transformDiffContent","diffContent","changes","DiffTable","operateType","isNoDiff","UIEmpty","IconYesFilled","UITable","DiffModal","withQueryClient","referenceNum","onDescChange","needDesc","showDiff","setShowDiff","confirmText","DiffConfirmModal","submitHandle","refetchReferences","okParam","setDesc","setReferenceNum","okText","UIModal","targetFuc","modal","useUnmount","transformMergeDiff","submitDiff","draftDiff","_submitDiff_key","_draftDiff_key","_submitDiff_key1","_draftDiff_key1","MergeContext","MergeProvider","retainedResult","setRetainedResult","mergeDiff","hasConflict","mergeable","handleRetained","useMerge","handleMerge","_submitDiff_name_dif","mergeResults","mergeResult","_submitDiff_key2","MergeFooter","ModalContent","_submitDiff_schema_dif","versionUrl","needNotice","useInnerSideSheetStore","sideSheetMap","sideSheetId","closeFns","closeFn","closeConfirm","SingletonInnerSideSheet","mutexWithLeftSideSheet","sideSheetProps","registerSideSheet","unRegisterSideSheet","getWorkflowInnerSideSheetHolder","forceUpdateActiveId","forceClose","WORKFLOW_INNER_SIDE_SHEET_HOLDER","IconCozElementOf","IconCozElementOfSlash","IconCozMatch","IconCozMatchSlash","createSelectAndSetFieldsFieldName","databaseSelectFieldName","orderByFieldName","queryFieldsFieldName","queryLimitFieldName","queryConditionFieldName","queryConditionListFieldName","queryConditionLogicFieldName","updateSelectAndSetFieldsFieldName","updateConditionFieldName","updateConditionListFieldName","updateConditionLogicFieldName","deleteConditionFieldName","deleteConditionListFieldName","deleteConditionLogicFieldName","DependencySourceType","WorkflowRenderKey","CommentEditorFormField","CommentEditorEvent","CommentEditorBlockFormat","CommentEditorLeafFormat","CommentEditorTextParser","convertLeafToText","convertParagraphToText","convertHeadingToText","convertBlockquoteToText","convertListToText","convertBlockToText","CommentEditorMarkdownParser","convertLeafToMarkdown","convertParagraphToMarkdown","convertHeadingToMarkdown","convertBlockquoteToMarkdown","convertListToMarkdown","convertBlockToMarkdown","CommentEditorJSONParser","processNode","addLeafType","CommentEditorHTMLParser","convertLeafToHtml","convertParagraphToHtml","convertHeadingToHtml","convertBlockquoteToHtml","convertListToHtml","convertBlockToHtml","CommentEditorParser","WorkflowNodeTestRunData","addBasicNodeData","WorkflowNodesV2Contribution","NODES_V2","nodeV2RegistryUtils","isNodeV2","PlaygroundContext","withValidation","workflowReadonly","withDescription","withRequired","topLevelReadonly","allowDeleteLast","emptyPlaceholder","hiddenTypes","showResponseFormat","responseFormat","needErrorBody","hide","defaultCollapse","needAppendChildWhenNodeIsPreset","withDefaultValue","historyService","HistoryService","curBatchMode","onChangeWithoutHistory","outputTreeValue","WorkflowBatchService","OutputTree","nameValidationRule","NodeHeaderWithValidation","subTitle","hideTest","extraOperation","showTrigger","triggerIsOpen","nodeDisabled","NodeHeader","messageVisibilityContext","MessageVisibilityContextProvider","useMessageVisibilityContext","PlayerCheckboxGroup","roleValues","hostUserSetting","RoleType","placeholderIdx","CheckboxGroup","intersectionWith","VariableTypeTag","NicknameVariableCheckboxGroup","nicknameVariables","NicknameVariableLabel","RefVariableLabel","variableType","useVariableType","getInitialRoleType","userSettings","RoleSelectPanel","roleType","setRoleType","selectedSettings","setSelectedSettings","_roleType","RoleSelectOptionItem","optionValue","focused","handleValueChange","popupVisible","setPopupVisible","selectedRoles","IconTick","IconChevronRight","normalOptions","messageVisibility","toStandardSetter","useGetCurrentInputsParameters","handleRemoveUserSetting","userSetting","_value_user_settings","_value_user_settings1","_roleList_find","role","InputWithValidation","InputTree","Images","useElementWidth","setWidth","updateSize","onlyOneImage","itemWidth","itemHeight","ImagePreview","imageUrl","ImagesWithDownload","useParseImages","outputData","useTestRunOutputsValue","outputList","IconDownloadStroked","Empty","waitIcon","isRunning","isFail","runningIcon","failIcon","ImgLog","isShowTestRunResult","FormCard","inputAsOutputNodes","isInputAsOutput","flowNodeType","useRefVariablePathList","pathList","setPathList","keyPathList","_i_input_content","variablePath","useListenVariableChange","variablePathList","toDispose","useInputContainsImage","inputContainsImage","setInputContainsImage","getInputContainsImage","useImagePreviewVisible","isContainsImage","checkValue","_value_children_some","getDefaultPropsByViewVariableType","viewVariableType","CustomPort","portId","portType","collapsedClassName","collapsedStyle","nodeElement","useNodeRenderData","createPortal","hoursLeaf","weekDaysNode","monthDaysNode","intervalDaysNode","triggeredEveryday","triggeredEveryweek","triggeredMonthly","triggeredInterval","treeData","createCron","schedule","head","cronGenerator","CronGenerator","hour","day","hour1","parseCron","cronExpr","_cronExpr_split_call","cronUnits","dayOfMonth","dayOfWeek","numberHour","renderDisplay","_dayNode_match","formatHours","hours","dayNode","days","numberRegx","formattedHours","FixCronjobSelect","_onChange","displayText","Cascader","Suffix","setPrompt","cronjob","setCronjob","aiGenerating","setAIGenerating","cancelRequest","Popconfirm","_rs_data_content","AICronjobSelect","needRefInput","onLiteralChange","isRef","renderVariableSelect","renderVariableDisplay","useRefInput","IconCozApply","HiddenCondition","handleConditionItemChange","branchIndex","conditionItemIndex","conditionItem","newConditions","activeBranch","subIndex","HiddenConditionItem","CONDITION_PORT_ID_PREFIX","ConditionSetter","getNodeTestId","branches","setBranches","draggingBranchUid","setDraggingBranchUid","updateSortedPortLines","useUpdateSortedPortLines","validateResults","initValidateResultsWithBranches","validateAllBranches","useConditionValidate","useAutoSyncRenameData","_branches","handleBranchChange","innerIndex","calcUid","uidArr","handleDeleteBranch","handleMoveBranch","hoverIndex","prevBranches","handleDragEnd","draggingBranch","draggingIndex","ConditionContextProvider","ConditionHeader","Logic","ConditionDraggableContainer","DraggableConditionBranch","DraggableConditionBranchPreview","VALUE","CanvasLazy","CanvasNode","canDrag","optionName","disableDelete","setterContext","showOptionName","optionPlaceholder","optionEnableInterpolation","ValidationErrorWrapper","ExpressionEditorContainer","IconCozMinus","AnswerOption","showTitleRow","defaultOptionText","maxItems","addButtonClassName","showDisableAddTooltip","customDisabledAddTooltip","onItemDelete","onItemChange","AddActionButton","isPreview","setters","triggerBindWorkflow","triggerList","triggerParameterTitle","_Object_assign","restOptions","_fileList_","timezone","_value_type","feedbackStatus","cronjobTranslateText","cronJobTranslator","onValueChange","UIInput","isNewNodeRender","validateAllBranchesFromOutside","select","switchSetter","textArea","expressionEditor","temperature","radio","others","InputNumberUI","notify","feedbackText","othersSetterProps","ConfigProvider","CodeSetterContext","CodeEditorWithBizIDE","variableSelect","viewVariableSelect","LoopOutputSelectComponent","valueExpressionValidator","MutableVariableAssignComponent","BaseDatasetSelect","_value_vectorModel","vectorModellList","useVectorModelList","vectorModelOptions","defaultModelName","CheckboxWithLabel","selectDataSet","BaseDataSetSetting","valueExpressionInput","initValidate","isPureText","prefix","suffix","setInitialized","userEdited","setUserEdited","variableName","setVariableName","setText","computedVariableName","getVariableName","onInputChange","newInputValue","feedbackStatus2ValidateStatus","computedUniqueName","getUniqueName","_validatorConfig_rule","_validatorConfig_errorMessage","validatorConfig","getNames","defaultGetNames","invalidValues","validatorRule","validatorErrorMessage","LimitCountNode","foundSame","nodeInputParameters","OutputsParamDisplay","sql","portID","systemPrompt","delimiterSelectorSetter","slider","useInputVariables","Enum","DatabaseSelect","EnumImageModel","BaseCheckbox","questionLimit","textDisplay","disabledTypes","allowedTypes","inputsParameters","renderOption","speakerMessageSetArray","SizeSelect","BaseDatasetWriteParser","BaseDatasetWriteChunk","settingOnErrorSetter","extractRealChildFromRehajeReactNode","propsChildren","realChildren","formCardAction","COLUMNS","decorators","renderContent","cols","gutter","gridColumns","isSplit","setOpen","chunkSize","childrenChunk","previous","IconCozArrowDownFill","AutoSizeTooltip","Collapsible","subChildren","_content_ratio","ColumnsTitle","formItemMeta","FormItem","FormItemFeedback","FormAbilityExtensionsFormContribution","formManager","setter","SetterAbility","DecoratorAbility","useParentNode","useNodeRender","useSubCanvasRenderProps","renderPorts","SubCanvasHeader","startDrag","parentNode","bgColor","parentNodeData","parentNodeDataEntity","getBgColor","SubCanvasBackground","SubCanvasContainer","selectNode","setHeight","_parentTransform_bounds_width","_parentTransform_bounds_height","parentTransform","SubCanvasBorder","SubCanvasPorts","WorkflowPortRender","STORAGE_KEY","STORAGE_VALUE","TipsGlobalStore","useControlTips","globalStore","nodeIntoContainerService","NodeIntoContainerService","closeForever","inDisposer","NodeIntoContainerType","outDisposer","SubCanvasTips","IconCozeCross","SubCanvasRender","ExecuteLogId","executeLogId","logID","ExecuteResultPanel","onOpenWorkflowLink","entity","executeResult","handleStepPropagation","ViewDataButton","openDatabaseDetail","generateAuth","safeJSONParse","authLink","needAuth","transformNodeError","warning","pending","useStatus","runProjectId","nodeStatus","nodeExeCost","errorLevel","errorInfo","handleAuth","_outputJSON_errorBody","outputJSON","useSettingOnErrorDesc","_useWorkflowNode_data","processType","ExecuteStatusBarContent","isLLM","hasExecuteResult","settingOnErrorDesc","isNodeSuccess","isNodeRunning","isNodeWarning","isNodeError","isNodePending","defaultResultCollapseMode","hasConversation","tagColor","NodeStatusBar","IconWorkflowRunning","getDesc","ExecuteStatusBarV2","executeNodeResult","isNodeWaiting","showStatusBar","isInvalidNode","getNodeError","Wrapper","setIsDragging","getPopupContainer","useClickPort","getContainer","fromNode","fromContainer","sourceRect","offsetPosition","Ports","clickPort","Header","defaultNodeMeta","useDefaultNodeMeta","renderNodeV2Header","formControl","wrappedNode","_wrappedNode_registry_meta","_wrappedNode_registry_meta1","_wrappedNode_registry_meta2","_wrappedNode_registry_meta3","_wrappedNode_registry4","fieldState","SystemError","errorData","showDeleteButton","IconAlertFilled","nodeSystemErrorRender","ExceptionPort","ExceptionField","hasException","VariableMergeItem","mergeGroup","Inputs","useVariableAssignTags","setVariableInputs","_left_content","_left_content_keyPath","_left_rawMeta_type","_variableLeft_viewMeta_name","_right_content","variableLeft","pathLabel","getSkillTag","_value_name","SkillTags","skillTags","Skill","useSkillTags","_fcParam_pluginFCParam","_this1","fcParam","skillsDetail","useQuerySettingDetail","isSkillsEmpty","getSkillsQueryParams","_props_extra_nodeIds","skills","_skillsDetail_plugin_detail_map","_skillsDetail_workflow_detail_map","_skillsDetail_dataset_detail_map","updateNodeSkills","_fcParam_workflowFCParam","_fcParam_knowledgeFCParam","_skillsDetail_plugin_api_detail_map","pluginDetail","apiDetail","DatasetContent","src","thumbnails","thumbnail2","thumbnail3","thumbnail4","thumbnail5","thumbnail6","thumbnail7","References","thumbnail8","Database","useCurrentDatabaseID","CommonContent","ContentMap","StartContent","EndContent","IfContent","IntentContent","SubWorkflowContentV2","OutputContent","LoopContent","BreakContent","ContinueContent","SetVariableContent","BatchContent","InputContent","mergeGroups","useVariableMergeVariableTags","groupIndex","_variableTags_","_v_content","_v_content1","_v_rawMeta_type","_v_content2","_variable_viewMeta_name","isLiteral","isOutput","isOutputVariable","LtmContent","CodeContent","TriggerUpsertContent","ImageCanvasContent","TriggerDeleteContent","TriggerReadContent","PluginContent","VariableContent","JsonStringifyContent","Content","NodeContent","NodeRenderNew","isInitialized","openNodeSideSheet","useNodeSideSheetStore","ErrorBoundary","cx","IconLineErrorCaseI18n","IconFactory","SvgLineErrorCaseI18n","IconLineErrorCaseCn","SvgLineErrorCaseCn","SvgLineError","LineErrorTip","currentLang","LinePopover","isHovered","other","bezier","bbox","toRelative","fromPos","toPos","CommentEditorListBlockFormat","CommentEditorDefaultBlocks","CommentEditorDefaultValue","CommentDefaultLink","leaf","child","indent","itemContent","grandChild","level","isNumbered","markdown","listTag","CommentEditorModel","ReactEditor","command","ctrlKey","metaKey","shiftKey","modifierKey","matchedCommands","fragment","decoded","decodeURIComponent","Editor","lastNodeEntry","endPoint","Transforms","selection","Range","isMarked","isListBlock","SlateElement","marks","emptyResult","entry","SlateNode","beforeRange","before","after","withReact","withHistory","createEditor","insertBreak","blockType","newPath","SlatePath","EventEmitter","selectAllCommand","boldCommand","italicCommand","underlineCommand","strikethroughCommand","paragraphCommand","headingOneCommand","headingTwoCommand","headingThreeCommand","clearFormatEnterCommand","isEmptyBlock","hasBlockFormat","clearFormatBackspaceCommand","isAtBlockStart","blockPrefixConfig","deleteText","handleBlockPrefix","matchedConfig","blockPrefixCommand","beforeText","createModel","useModel","_formSize_width","_formSize_height","formSize","newSize","onResize","resizeState","resizing","bottom","newWidth","newHeight","newOffsetX","newOffsetY","newPositionX","newPositionY","resizeEnd","useOverflow","overflow","setOverflow","isOverflow","containerHeight","editorHeight","updateOverflow","changeDispose","CommentToolbar","linkValue","toolItemClass","toolItemMarkedClass","separatorClass","textItemClass","textItemMarkedClass","IconCozTextStyle","IconCozH1","IconCozH2","IconCozH3","IconCozBold","IconCozItalic","IconCozUnderscore","IconCozStrikethrough","IconCozListDisorder","IconCozListOrder","IconCozQuotation","IconCozLink","usePosition","setPosition","calcPosition","containerRect","selectionRect","selectionWidth","selectionX","selectionY","containerX","containerY","multiSelectDispose","useActivate","activated","_setActivated","setActivated","disposers","mouseHandler","Portal","container","ReactDOM","CommentToolbarContainer","shouldRender","attributes","Leaf","Block","CommentEditor","renderBlock","blockProps","renderLeaf","leafProps","Slate","Editable","DragArea","stopEvent","onStartDrag","ContentDragArea","setActive","mouseDownEvent","startY","mouseMoveEvent","deltaX","deltaY","_model_element","containerElement","maxScroll","newScrollTop","CommentContainer","ResizeArea","getDelta","handleMouseMove","BorderArea","BlankArea","CommentRender","WorkflowPageContribution","renderer","FlowRendererKey","WorkflowNodeContribution","nodeManager","registerNodeErrorRender","registerNodePlaceholderRender","WorkflowPageContainerModule","_unbind","_isbound","ValidationService","TestRunReporterService","WorkflowTestRunReporterService","TestRunService","WorkflowOperationService","WorkflowFloatLayoutService","NodeVersionService","RoleService","PluginNodeService","SubWorkflowNodeService","WorkflowDependencyService","WorkflowOperationServiceProvider","WorkflowDocumentCustomOptions","WorkflowDocumentOptions","WorkflowLinesService","WorkflowDragService","WorkflowLinesServiceProvider","bindConfigEntity","WorkflowExecStateEntity","WorkflowDependencyStateEntity","FlowDocumentContribution","FlowRendererContribution","bindShortcuts","WorkflowCopyShortcutsContribution","WorkflowPasteShortcutsContribution","WorkflowZoomShortcutsContribution","WorkflowExportShortcutsContribution","WorkflowLoadShortcutsContribution","WorkflowSelectAllShortcutsContribution","FormContribution","NodeContribution","ValueExpressionService","ValueExpressionServiceImpl","DatabaseNodeService","DatabaseNodeServiceImpl","TriggerService","AddNodeModalContext","modals","isDrag","ConfigEntity","_this_formSchema","_globalState_config_playgroundProps_testFormDefaultValues","_this_formDefaultValue_find","WorkflowTemplateStateEntity","BigInt","nextVersion","func","nodeResults","nodeEvents","eventType","DataSetStore","existDataInfoIds","needQueryInfoIds","needAddToQueryQueueIds","dataSetInfos","dataset_list","knowledgeApi","unUseIds","l","isQueryDone","_l","getAutoSaveTime","timestamp","time","now","SpaceMode","REPORT_EVENTS","_workflowInfo_creator","_workflowInfo_vcsData","_this_entityManager_getEntity","CollaboratorMode","isReadOnly","isGuanFangType","WorkFlowType","isProjectPreview","isUserType","hasSingleEditPermission","hasVcsEditPermission","jsonStr","getIsInitWorkflow","PlaygroundConfigEntity","commit_id","env","log_id","execute_id","sub_execute_id","describe","flow_mode","bind_biz_id","bind_biz_type","bot_space_list","currentSpace","space","space_type","space_mode","_this_config","_target_id","_db_data_status","vcs_data","db_data","operation_info","is_bind_agent","workflow_version","_this_config_info","PersistenceModel","_this_info_creator","_this_info_vcsData","persistence_model","outGetProjectApi","AddItemButton","onMouseDown","ButtonContent","tipWrapperClassName","needCheckBox","dataTestId","itemTooltip","SemiCheckbox","getActionColumns","actionWidth","ColumnsTitleWithAction","colStyle","useDouyinKnowledgeListModal","DouyinKnowledgeListModal","DatasetSelect","addButtonTestID","libraryCardTestID","cacheDataSetInfo","isDatasetWrite","knowledgeType","FilterKnowledgeType","hiddenAddBtn","addKnowledge","knowledgePreviewModalClose","removeKnowledge","buttonType","setButtonType","curDateSetID","setCurDateSetID","curDataset","button","DatasetStatus","knowledgePreviewModal","knowledgePreviewModalOpen","useBizWorkflowKnowledgeIDEFullScreenModal","bindBizID","useSpaceId","newWindowRef","useKnowledgeListModal","datasetID","shouldUpload","unitType","IDENav","douyinModal","openDouyinModal","closeDouyinModal","LibrarySelect","dataset_id","create_time","creator_id","SliderArea","onMouseUp","onClickDefault","customStyles","isDataSet","TitleArea","tip","titleClassName","Strategy","SearchStrategy","DataSetSetting","dataSetInfo","onDataSetInfoChange","minScore","topK","strategy","useNl2sql","useRerank","useRewrite","isPersonalOnly","isDatasetEmpty","setDatasetEmpty","isContainSqlDataSet","dataset","FormatType","initDataSetInfo","omit","minScoreVisible","setMinScoreVisible","nextDataSetInfo","topKSuggestVisible","setTopKSuggestVisible","IconWarningInfo","isDatasetWriteActive","RewriteTips","RerankTips","DatasetWriteChunk","_getSeperatorOptionList","customInputComp","seperatorOptionList","isCustomChunk","isCustomSeparator","SeperatorType","_v_target","nextChunkType","DatasetWriteParser","_data_inputs_datasetWriteParameters_chunkStrategy","isPresice","isImageOcrDisable","nextParsingType","CUSTOM_ACTION_BUTTON_CLASS","Slots","Slot","createSlots","header","actionButton","actionButtonStyle","maxContentHeight","tooltipClassName","collapsible","defaultExpand","autoExpandWhenDomChange","onRef","noPadding","disableFeedback","motion","hidden","headerStyle","setIsOpen","childNodeRef","childNode","MutationObserver","mutationList","EmptyFunction","slots","hideRequiredTag","labelAlign","labelCol","wrapperCol","labelBlockStyle","labelStyle","labelColStyle","wrapperColStyle","renderLabelContent","TooltipAction","testID","IconNameDescCard","nameSuffix","isInvalid","showDeleteBtn","alwaysShowActions","descriptionTooltipPosition","ChangeMode","isObjectTreeNode","_item_input_rawMeta","inputTreeContext","useInputTreeContext","InputTreeContextProvider","InputValue","_data_field","finalDisabledTypes","ValueExpressionInput","InputOperator","onAppend","hasObject","needRenderAppendChild","_needRenderAppendChild","AddOperation","InputName","NodeInputName","useColumnsStyle","columnsRatio","nameWidth","valueWidth","InputTreeNode","couldCollapse","collapsed","onCollapse","isNamePureText","treeNodeRef","columnsStyle","nameRef","paramRow","LevelLine","InputHeader","TreeCollapseWidth","getDefaultAppendValue","defaultAppendValue","itemKeysWithChildren","allowAppendRootData","treeProps","titleTooltip","noCard","addItemTitle","formCardDefaultCollapse","maxLimit","nthCannotDeleted","isValueEmpty","formattedTreeData","resolveActionParamList","parentData","keyField","isDataEmpty","expandedKeys","expandTreeNode","collapseTreeNode","useExpandedKeys","keys","setExpandedKeys","expandedKey","disableAdd","_value_length","freshValue","traverse","nodeOrNodes","prop","convertObjectRef","_data_input_rawMeta","_data_input1","_data_input_rawMeta1","_data_input3","onTreeNodeChange","cloneDeepTreeData","findResult","findField","dataInRoot","findDataInChildrenLoop","customChildren","customData","_parentData","childResult","_findResult_data","currentChildren","_findResult_parentData","targetArray","data1","Card","showAddButton","rootLength","Tree","renderFullLabelProps","isDeleteDisabled","_data_parent_children","LineShowResult","Triangle","EmptyBlock","HelpLineBlock","HalfTopRoot","HalfTopRootWithChildren","HalfBottomRoot","HalfBottomRootWithChildren","FullRoot","FullRootWithChildren","HalfTopChild","HalfTopChildWithChildren","FullChild","FullChildWithChildren","RootWithChildren","_data_children","multiInfo","expandContentVisible","treeIndentWidth","lineShowResult","getLineShowResult","isRootWithChildren","isRootWithoutChildren","isChildWithChildren","isChildWithoutChildren","showMap","LibraryCard","library","libraries","onDeleteLibrary","onAddLibrary","onClickLibrary","renderLibrary","emptyText","hideAddButton","defaultLibraryRender","LoopOutputSelect","validation","setValidation","computedTestId","WorkflowVariableService","isLoopSelfVariable","typeLabel","useVariableTypeChange","variableMeta","_meta","datasource","_newValue_content_keyPath","MutableVariableAssign","_value_content_keyPath","_right_content_keyPath","leftKeyPath","leftVariable","rightKeyPath","rightVariable","rightStringPaths","_input_left_content","optionFilter","subVariableMeta","_newValue_content","stringPath","rightStringPath","useMoveOut","onHandle","canMoveOut","setCanMoveOut","updateCanMoveOut","handleMoveOut","requestAnimationFrame","DescriptionDisplay","Description","setIsEdit","textareaRef","localPluginTag","_textareaRef_current","_info_creator","_workflowNode_data_inputs_apiParam","_node_getData_getNodeData","apiParams","apiOutputs","BlockInput","apiId","apiName","MockSetSelect","TrafficScene","HelpLinkButton","helpLink","IconCozQuestionMarkCircle","CloseButton","readonlyAllowDeleteOperation","onTitleChange","onDescriptionChange","showCloseButton","titleInput","editableTitle","setEditableTitle","editable","setEditable","menusVisible","setMenusVisible","closeNodeSideSheet","canMockset","showMockset","usePlaygroundContainer","copyService","pasteService","handleEditState","_titleInput_current","useError","quitEditable","handleTitleChange","needShowOperations","showError","_readonly","IconCozTrigger","PluginMockSet","mainColor","opacity","r","hexToRgb","hex","parseInt","rgbaToHexWithBackground","bgR","bgG","bgB","newR","newG","newB","toHex","outputInfo","customClassNames","ObjectLikeTypes","MAX_NAME_LENGTH","formatTreeData","startField","hasObjectLike","calcIDESideSheetWidth","windowWidth","computedSideSheetWidth","computedCanvasWidth","outputTreeContext","useOutputTreeContext","OutputTreeContextProvider","LazyMdBox","ResponseFormatSelect","outputValue","onlyString","onResponseFormatChange","_outputValue__children","_newValue__children","_newValue__children1","_outputValue__children1","languageJSON","JSONEditor","setSchema","tooltipPopContainerRef","change","convert","jsonString","convertSchema","IconUpdateOutlined","IconCrossStroked","EditorProvider","getTreePath","parents","mergeData","oldData","treeDataPathKeyMap","stringifyPath","isOutputValueContext","cutOffNameLength","cutOffDepth","depth","cutOffDisabledTypes","cutOffInvalidData","allowDepth","allowNameLength","cutOffDisabledTypesHandler","addBatchData","addReadOnlyData","readonlyMetas","_treeData__children","readonlyMetas1","JSONEditorWithState","updateKey","uniqueId","JSONString","setJSONString","JSONImport","_node_getNodeMeta_size","jsonImport","setJsonString","setUpdateKey","forceCloseBizIDE","isBizIDEOpen","bizIDEUniqueId","dataCutoff","dataWithReadonly","useFitViewport","IconCozImport","JSONImportPlaceholder","enable","typeWidth","VARIABLE_TYPE_ICONS_MAP","defaultDisabledTypes","defaultHiddenTypes","ParamType","onSelectChange","setFocused","VariableTypeSelector","ParamRequired","UICheckbox","ParamOperator","isPreset","ParamName","WorkflowSLInput","VoiceAdapter","FileAdapter","InputTime","DatePicker","date","dateString","InputCore","InputInteger","BooleanSelect","ConversationSelectCore","getInputComponent","DefaultValueInput","InputComponent","ExpandContent","onDefaultValueChange","defaultValueInputType","onDefaultValueInputTypeChange","disabledDesc","descInput","ExpandBtn","IconCozMinimize","CustomTreeNode","typeReadonly","activeMultiInfo","readonlyTooltip","setExpand","setDefaultValueInputType","onRequiredChange","onEnabledChange","_withDefaultValue","withExpandContent","showExpandContent","defaultVariableType","defaultExpandParams","setActiveMultiInfo","_responseFormat_value","latestValue","useLatest","responseFormatValue","isUserChangeType","first","first1","rest1","isTopLevel","isSecondLevel","isOnlyOneData","currentLevelDisabled","_value_at","QuestionLimit","SliderWithInput","_options_direction","selectOptions","ignoreReadonly","uiOptions","_optionItem_disabled","disabledItem","RadioUI","metaToJSON","subObj","subObj1","metasToJSON","metas","metasFlat","treeToArray","thisMeta","compareMetas","newMetas","oldMetas","newMetasArray","oldMetasArray","removed","retyped","renamed","oldKeys","oldMeta","newMeta","o","added","getMetaPath","getObjRefByMetaPath","_metaPath","_obj","_it","niceAssign","_json","_renameMeta","fromMetaPath","fromRefs","_ref__renameMeta_from_name","_removeMeta","removeMetaPath","removeRefs","_retypedMeta","toMetaPath","toRefs","_ref_to_name_","toMetaPath1","toRefs1","toMetaPath2","toRefs2","newMetaPath","newRefs","jsonFormat","outputsVerify","namesSet","transformInitOutputs","useJSONWithOutputs","outputsInParams","onJSONChange","lastOutputs","lastIsBatch","lastIsOpen","newJSON","_jsonObj_outputList_","jsonObj","newJSON1","useBatchChange","tooltips","IconLight","IconDark","preferNewEditor","theme","setTheme","newEditorRef","object","formatted","_newEditorRef_current","schemaURI","ViewVariableType2JsonSchema","generateJSONSchema","pre","ErrorFormCard","onSwitchChange","errorMsg","JsonEditorAdapterNew","ErrorForm","useTimeoutConfig","useExpand","defaultConfig","msToSeconds","ms","formatter","Intl","Timeout","setInputValue","rawValue","seconds","RetryTimes","ProcessType","optionNode","Json","Trigger","popoverVisible","placeholder","onClear","showClear","ModelOptionThumb","Ext","_value_backupLLmParam","retryTimes","enableBackupModel","handleModelChange","isException","handleLinesAndPort","outputPort","newLines","useExceptionChange","lastHasException","ErrorFormContent","syncOutputs","settingOnErrorIsOpen","SettingOnError","_useSettingOnError","settingOnErrorJSON","formV2","setArgs","outputItem","modelValue","_modelItem_value","modelItem","ErrorFormV2","sliderStyle","ExpandIcon","NodeVariableTree","forArrayItem","useTreeVariableSelectorContext","dataSource","outerTopSlot","innerTreeStyle","emptyContent","treeContainerRef","treeRef","_treeRef_current","selectedKey","onExpand","onCheck","expandStatus","isLeaf","renderLabelWithItem","CompositeSelectOption","onMouseOver","isGlobalVar","hasContent","SelectType","onOptionHover","getOptionPopupContainer","activeOption","extraOption","controlledActive","treeDataSortByGroup","sortTreeDataByGroup","handleOptionHover","isHoverOption","setIsHoverOption","treeListWrapperMaxHeight","isNodeVariable","TreeVariableSelectorContext","GLOBAL_VAR_ICON_MAP","GlobalVarIcon","findRootNode","nodeInfo","ValueDisplay","invalidContent","valueSubVariableMeta","isUnknownValue","rootNode","getLabelPath","SELECT_POPOVER_CLASS","CompositeSelect","_triggerRef_current","trigger","onPopoverVisibleChange","renderExtraOption","popoverStyle","setQuery","setActiveOption","setPopoverVisible","triggerRef","visibility","CompositeSelectTreePanel","renderExtraOptionWithWrapper","extraOptionNode","IconClear","VariableSelector","rawDataSource","triggerChangeWhenRename","renderDisplayVarName","customFilterVar","enableSelectNode","handleDataSource","treeSelectRef","defaultVariableDataSource","useFormatVariableDataSource","dataSourceWithGlobal","useGlobalVariableCache","variableDataSource","processDataSourceLabelRender","variableDataSourceWithGroup","formatDataWithGlobalVariable","useWorkflowVariableByKeyPath","onRename","modifyIndex","modifyKey","useVariableRename","_option","triggerValidate","_treeSelectRef_current_getElementsByClassName","_treeSelectRef_current_getElementsByClassName2","_selectSearchInputWrapper_getElementsByTagName","selectSelection","selectSearchInputWrapper","selectSearchInput","displayVarName","IconCozVariables","genGlobalVariableData","formatWithNodeVariables","doesNodeIncludeEnabledTypes","enabledTypes","_node_children","normalizeTreeData","filterTreeNode","newItem","withNodeVariables","_value__nodeTitle","_value_1","_value_2","_value_3","nodeVariables","searchKey","searchLabelIndex","renderLabel","labelStr","global","GLOBAL_VAR_ALIAS_MAP","globalVar","prevPath","prevNamePath","_item_name","namePath","_cur_children","currValue","matchVariableDataByType","formatVariableDataByMatchType","groupMap","noGroupArr","ValidationContext","ValidationProvider","onTestRunValidate","errorPath","pathArray","segment","useOnTestRunValidate","errorCompClassName","isFocused","silence","setSilence","ValueExpressionInputContext","useValueExpressionInputContext","InputString","uriMap","generateJsonFileUri","schemaUri","getJsonSchemaUriByInputType","optionsList","componentRegistry","_registry_","DEFAULT_COMPONENT_REGISTRY","memo","apiRef","onRequestInputExpand","localSchemaConfig","fileUri","_apiRef_current","_apiRef_current_$view_contentHeight","api","_api_$view_contentHeight","CozSelect","LiteralValueInput","transformExpressionInputToFileList","rawMeta","UploadContext","UploadProvider","availableFileTypes","triggerUpload","files","useUploadContext","FileUploadBtn","FileTag","MultipleInputNew","hasValue","ImagePreviewer","loadError","setLoadError","IconImageOverlay","ImgPreviewPopover","SingleInputNew","onUploadChange","FileInput","VoiceTag","VoiceOption","voiceAvatar","ObjectRefValueDisplay","VARIABLE_SELECTOR_STYLE","_String","variablesDataSource","literalStyle","literalDisabled","refDisabled","hideDeleteIcon","hideSettingIcon","literalConfig","refTagColor","inputPlaceholder","variableTagStyle","variableTypeConstraints","onImageChange","isRefValue","isLiteralJsonValue","isUploadingFile","setIsUploadingFile","isLiteralMultiFileValue","isLiteralMultiLineValue","expandLiteralInput","setExpandLiteralInput","isVoiceValue","renderVariableSelectorExtraOption","voiceSelector","useVoice","_value_rawMeta","_data","renderInputRight","useRefInputNode","finalClassName","renderInput","inputTypes","forbidTypeCast","defaultInputType","outerDisabledTypes","outerInputType","emptyValueInputType","setEmptyValueInputType","getDefaultInputType","targetType","_variableService_getViewVariableByKeyPath","_refVariableType","availableTypes","innerInputType","handleTypeChange","_Object_keys","initialContent","refVariableType","setRefVariableType","disableDropdown","showRefWarning","_inputType","_val_content","RefTagColor","COLORS_MAP","RefValueDisplay","_workflowVariable_keyPath","_workflowVariable_viewMeta2","_workflowVariable_viewMeta3","closable","warningMessage","_variableTypeConstraints_subType","constraintTypes","_dimColor","nameColor","globalVarAlias","parentPath","fileArrayValue","fileArrayParentPath","generateVariableOption","targetLabel","subType","VARIABLE_TYPE_DIVIDER","allVariableTypeList","filterTypes","_newOption_children","newOption","getVariableTypeList","getSelectedValuePath","originalVal","valuePath","childPath","contentStyle","selectedValuePath","renderDropdown","menus","menu","_menu_path","_menu_children","_menu_children1","playgroundConfig","bounds","viewport","SizeSchema","useLLMPromptHistory","_prompt_replace","_testRunResult_raw_output","llmInputStr","setVectorModelList","_getVectorModelList","_res_models","KnowledgeApi","getVectorModelList","formEntity","formValue","setFormValue","setInputsParameters","inputViewVariableType","_item_input_content","dipose","dispose2","recursiveParseOutput","parsedOutput","recursiveParseInput","workflowVariableService","flowNodeEntity","parsedInput","_inputValue_input","_inputValue_input1","_inputValue_input_rawMeta","_inputValue_input4","_inputValue_input2","_inputValue_input_content","refVariableMeta","parseInputValueChildren","useIDEInputOutputType","_recursiveParseOutput","outputParams","useCodeSetterContext","BizIDE","_LANG_CODE_NAME_MAP_get","outputPath","languageTemplates","DEFAULT_LANGUAGES","setIsBizIDETesting","LANG_NAME_CODE_MAP","_value_code","_value_language","codeSetterContext","getLanguageTemplates","Previewer","LanguageEnum","DEFAULT_TYPESCRIPT_CODE_PARAMS","DEFAULT_IDE_PYTHON_CODE_PARAMS","LANG_CODE_NAME_MAP","DEFAULT_OPEN_SOURCE_LANGUAGES","IS_OPEN_SOURCE","_templates_","_data_left_content","onDataChange","withValidationField","_validateResult_message","useConditionContext","isShowValidate","setIsShowValidate","compareValueField","isQuotedField","quotedField","fixedField","equalValue","notEqualValue","lengthBiggerValue","lengthBiggerEqualValue","lengthSmallerValue","lengthSmallerEqualValue","includeValue","excludeValue","includeKeyValue","excludeKeyValue","emptyValue","notEmptyValue","biggerValue","biggerEqualValue","smallerValue","smallerEqualValue","trueValue","falseValue","stringConditionValueMap","merge","timeConditionValueMap","intConditionValueMap","booleanConditionValueMap","numberConditionValueMap","objectConditionValueMap","arrayConditionValueMap","fileConditionValueMap","convertMap2options","convertOptions","computedValue","finalLabel","Delete","VariableSelectorField","OperatorField","sourceType","ValueExpressionInputField","valueType","setValueType","valueToRefExpression","ConditionParamsItem","_workflowVariableService_getWorkflowVariableByKeyPath","_data_left_content1","_data_left_content2","_JSON_parse","conditionValidateResult","setterPath","handleConditionChange","processLeftSourceTypeChange","processRightDefaultValue","processConditionData","rightInputTypes","getRightValueInputType","rightInputTypeProps","calcComparisonDisabled","_condition_conditions","priority","branchValidateResult","titleIcon","isFirstBranch","handleDeleteConditionItem","deleteIndex","_condition_logic","DISABLED_CONDITION_TYPES","COMPARE_LENGTH_CONDITION_TYPES","_oldData_left_content","_workflowVariableService_getWorkflowVariableByKeyPath1","_newData_left_content","oldSourceType","newSourceType","requiredRightInputType","rightInputType","newRight","rightValue","useCompatibleType","compareLength","_rightValue_rawMeta","rawMetaType","sourceTypeInputTypeMap","ConditionContext","onMoveBranch","showDraggable","ConditionBranchBlock","hoverBoundingRect","hoverMiddleY","clientOffset","hoverClientY","zoomRef","PlaygroudContextOrigin","setValidateResults","validateResultStore","originValidateAllBranches","validateSuccessResult","createRulesWithContext","requiredValidateResult","emptyError","branchesValidateResult","_branch_condition_conditions","conditionIndex","branchesValidateResults","useModal","setIsVisible","openModal","closeModal","_value_","isSelectDatabaseModalVisible","openSelectDatabaseModal","closeSelectDatabaseModal","currentDatabaseID","useLibraries","databaseToLibrary","databaseInfo","iconUrl","useTags","_data_fields","openDatabaseDetailOfLibrarySelect","SelectDatabaseModal","TagContent","escape","mapChars","enableCustom","dropdownVisible","setDropdownVisible","outSlotNode","useSlotNode","showCustomise","setShowCustomise","handleAdd","isDefault","optionCls","BaseDelimiterSelector","_options","maxCustomLength","setValues","newOptionList","finalValues","changeValues","_options_","TagSelector","disableSuggestion","disableCounter","minRows","maxLength","variableTree","useVariableTree","selectorBoxConfig","SelectorBoxConfigEntity","curEditorVal","setCurEditorVal","useParseText","ExpressionEditorModel","ExpressionEditorEvent","Expression","ExpressionEditorCounter","useInputs","_workflowNode_inputParameters","convertInputs","ExpressionEditorTreeHelper","getAnyValueContent","ExpressionEditor","_i_children","_variable_node","_variable_viewMeta","fallbackName","last","checkSameName","sameNameVariables","sameNames","nameIndex","currentName","currentSameNames","Notify","align","isBreakLine","_props_options"],"mappings":"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"}